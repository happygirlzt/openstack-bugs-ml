{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:11:56.172882+00:00", 
    "description": "The refactor of libvirt disk mappings appears to have broken boot from volume and possibly some other things.\nCommit: 7be531fe9462f2b07d4a1abf6687f649d1dfbb89\n\nI've identified this commit as the introduction of the issue, but haven't looked through the patch to find exactly where the issue is yet.  Here's the sequence and the resultant trace:\n\nnova boot --flavor 1 --block-device-mapping vda=beb80227-a551-4b7d-a110-950cf2add29d --image 9eb77f33-9a97-40d1-8516-8ec811e6c9a8 bfv-test\n\n`````````````````````````````````````````````````````````````````\n\n2013-02-07 16:09:20.920 ERROR nova.compute.manager [req-ce998359-cf8d-48a3-9b1e-32de65051dfa demo demo] [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72] Instance failed to spawn\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72] Traceback (most recent call last):\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]   File \"/opt/stack/nova/nova/compute/manager.py\", line 984, in _spawn\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]     block_device_info)\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1177, in spawn\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]     block_device_info=block_device_info)\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1959, in to_xml\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]     disk_info, rescue, block_device_info)\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1790, in get_guest_config\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]     {'root_device_name': '/dev/' + disk_mapping['disk']['dev']})\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72] KeyError: 'disk'\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1118829", 
    "owner": "https://api.launchpad.net/1.0/~john-griffith", 
    "id": 1118829, 
    "index": 3391, 
    "created": "2013-02-07 23:10:34.743435+00:00", 
    "title": "libvirt driver looking for non-existent keys in diskmapping", 
    "comments": [
        {
            "content": "The refactor of libvirt disk mappings appears to have broken boot from volume and possibly some other things.\nCommit: 7be531fe9462f2b07d4a1abf6687f649d1dfbb89\n\nI've identified this commit as the introduction of the issue, but haven't looked through the patch to find exactly where the issue is yet.  Here's the sequence and the resultant trace:\n\nnova boot --flavor 1 --block-device-mapping vda=beb80227-a551-4b7d-a110-950cf2add29d --image 9eb77f33-9a97-40d1-8516-8ec811e6c9a8 bfv-test\n\n`````````````````````````````````````````````````````````````````\n\n2013-02-07 16:09:20.920 ERROR nova.compute.manager [req-ce998359-cf8d-48a3-9b1e-32de65051dfa demo demo] [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72] Instance failed to spawn\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72] Traceback (most recent call last):\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]   File \"/opt/stack/nova/nova/compute/manager.py\", line 984, in _spawn\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]     block_device_info)\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1177, in spawn\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]     block_device_info=block_device_info)\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1959, in to_xml\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]     disk_info, rescue, block_device_info)\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1790, in get_guest_config\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]     {'root_device_name': '/dev/' + disk_mapping['disk']['dev']})\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72] KeyError: 'disk'\n2013-02-07 16:09:20.920 TRACE nova.compute.manager [instance: 5b79c048-c994-4c8f-99b8-4ad25ad33a72]", 
            "date_created": "2013-02-07 23:10:34.743435+00:00", 
            "author": "https://api.launchpad.net/1.0/~john-griffith"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/21473", 
            "date_created": "2013-02-07 23:49:08.687397+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/21473\nCommitted: http://github.com/openstack/nova/commit/e1921703395cdc8807caa92813dcf1936d0ab64f\nSubmitter: Jenkins\nBranch:    master\n\ncommit e1921703395cdc8807caa92813dcf1936d0ab64f\nAuthor: John Griffith <email address hidden>\nDate:   Thu Feb 7 16:45:03 2013 -0700\n\n    Fix missing key error in libvirt.driver\n    \n    The libvirt disk mapping refactor change introduced\n    a bug in libvirt.driver.get_guest_config where we were\n    attempting to perform instance_update using a non-existent\n    key in the disk_mapping.\n    \n    Given that we already parsed out the root_device_name and stored\n    it in a variable, and then verify that it's set in an if\n    statement before this method we should be just using what\n    we've already parsed.\n    \n    Fixes bug: 1118829\n    \n    Change-Id: Ifd80e67740d6f257ee537b68e9afe028273484d2\n", 
            "date_created": "2013-02-09 04:43:27.723214+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}