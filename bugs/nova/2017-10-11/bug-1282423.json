{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:36:28.023359+00:00", 
    "description": "I launch a vm with lvm-type image successfully, whose flavor includes \"OS-FLV-EXT-DATA:ephemeral\" flag, the size is 1G.\nSo, I can see two logical volumes have beed created by \"lvs\" command.\nThen I call \u201cnova rebuild $SERVERID $IMAGEID\u201d, try to rebuild it with the same image. Error occur, the vm'state get to ERROR, the two volumes disapear sametime. \n\nnova-compute's log is:\n\n\"\"\"\n2014-02-18 19:54:39.290 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): lvs -o lv_size --noheadings --units b --nosuffix /dev/cinder-volumes/instance-0000007c_disk.local execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:39.626 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): dd bs=1048576 if=/dev/zero of=/dev/cinder-volumes/instance-0000007c_disk.local seek=0 count=1024 oflag=direct execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:47.622 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): lvremove -f /dev/cinder-volumes/instance-0000007c_disk /dev/cinder-volumes/instance-0000007c_disk.local execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:48.061 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Result was 5 execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:172\n2014-02-18 19:54:48.066 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] ['lvremove', '-f', '/dev/cinder-volumes/instance-0000007c_disk', '/dev/cinder-volumes/instance-0000007c_disk.local'] failed. Retrying. execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:184\n2014-02-18 19:54:49.081 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): lvremove -f /dev/cinder-volumes/instance-0000007c_disk /dev/cinder-volumes/instance-0000007c_disk.local execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:49.279 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Result was 5 execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:172\n2014-02-18 19:54:49.286 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] ['lvremove', '-f', '/dev/cinder-volumes/instance-0000007c_disk', '/dev/cinder-volumes/instance-0000007c_disk.local'] failed. Retrying. execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:184\n2014-02-18 19:54:50.222 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): lvremove -f /dev/cinder-volumes/instance-0000007c_disk /dev/cinder-volumes/instance-0000007c_disk.local execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:50.359 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Result was 5 execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:172\n2014-02-18 19:54:50.364 2368 ERROR nova.compute.manager [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Setting instance vm_state to ERROR\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Traceback (most recent call last):\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 4967, in _error_out_instance_on_exception\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     yield\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 2037, in rebuild_instance\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     block_device_info=block_device_info)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 835, in destroy\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     destroy_disks, context=context)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 935, in _cleanup\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     self._cleanup_lvm(instance)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 957, in _cleanup_lvm\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     libvirt_utils.remove_logical_volumes(*disks)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/utils.py\", line 392, in remove_logical_volumes\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     execute(*lvremove, attempts=3, run_as_root=True)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/utils.py\", line 50, in execute\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     return utils.execute(*args, **kwargs)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/utils.py\", line 177, in execute\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     return processutils.execute(*cmd, **kwargs)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py\", line 178, in execute\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     cmd=' '.join(cmd))\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] ProcessExecutionError: Unexpected error while running command.\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Command: lvremove -f /dev/cinder-volumes/instance-0000007c_disk /dev/cinder-volumes/instance-0000007c_disk.local\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Exit code: 5\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Stdout: ''\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Stderr: '  One or more specified logical volume(s) not found.\\n'\n\"\"\"\n\nIn nova.virt.libvirt.utils.py:\n\"\"\"\ndef remove_logical_volumes(*paths):\n    \"\"\"Remove one or more logical volume.\"\"\"\n\n    for path in paths:\n        clear_logical_volume(path)\n\n    if paths:\n        lvremove = ('lvremove', '-f') + paths\n        execute(*lvremove, attempts=3, run_as_root=True)\n\"\"\"\nIt will try 3 times to remove two volumes (instance-0000007c_disk and instance-0000007c_disk.local).\n\nThen I trace the problem in another example, when it happed again, pdb result show below.\n\nThe 1st try:\n\n\"\"\"\n2014-02-18 22:33:48.579 24156 DEBUG nova.openstack.common.processutils [req-a97ce6d7-ee76-4349-9d89-7c2e7325f2d5 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Result was 5 execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:172\n> /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py(173)execute()\n-> if not ignore_exit_code and _returncode not in check_exit_code:\n(Pdb) p cmd\n['lvremove', '-f', '/dev/cinder-volumes/instance-0000007e_disk', '/dev/cinder-volumes/instance-0000007e_disk.local']\n(Pdb) p result\n('  Logical volume \"instance-0000007e_disk\" successfully removed\\n', '  Can\\'t remove open logical volume \"instance-0000007e_disk.local\"\\n')\n(Pdb) c\n...\n\"\"\"\nIt shows that remove ephemeral disk fail, but image disk success.\n\n2nd try begin:\n\n\"\"\"\n-> if not ignore_exit_code and _returncode not in check_exit_code:\n(Pdb) p cmd\n['lvremove', '-f', '/dev/cinder-volumes/instance-0000007e_disk', '/dev/cinder-volumes/instance-0000007e_disk.local']\n(Pdb) p result\n('  Logical volume \"instance-0000007e_disk.local\" successfully removed\\n', '  One or more specified logical volume(s) not found.\\n')\n(Pdb) c\n...\n\"\"\"\n\nThe ephemeral disk is remove in this time, but image disk have been removed in last step, so the whole command still fail.\n\n3rd try:\n\n\"\"\"\n-> if not ignore_exit_code and _returncode not in check_exit_code:\n(Pdb) p cmd\n['lvremove', '-f', '/dev/cinder-volumes/instance-0000007e_disk', '/dev/cinder-volumes/instance-0000007e_disk.local']\n(Pdb) p result\n('', '  One or more specified logical volume(s) not found.\\n')\n(Pdb) \n\"\"\"\n\nOpenstack think remove_logical_volumes fail, though two volumes have been removed in fact.\n\nIt seems that retry to remove open volume is useful, but if the situation that not all volumes were removed once time happen, the retry are useless, and remove_logical_volume must fail.", 
    "tags": [
        "libvirt", 
        "rebuild", 
        "volumes"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1282423", 
    "owner": "https://api.launchpad.net/1.0/~vladik-romanovsky", 
    "id": 1282423, 
    "index": 4581, 
    "created": "2014-02-20 07:27:05.473878+00:00", 
    "title": "rebuild vm fail when using lvm type image", 
    "comments": [
        {
            "content": "I launch a vm with lvm-type image successfully, whose flavor includes \"OS-FLV-EXT-DATA:ephemeral\" flag, the size is 1G.\nSo, I can see two logical volumes have beed created by \"lvs\" command.\nThen I call \u201cnova rebuild $SERVERID $IMAGEID\u201d, try to rebuild it with the same image. Error occur, the vm'state get to ERROR, the two volumes disapear sametime. \n\nnova-compute's log is:\n\n\"\"\"\n2014-02-18 19:54:39.290 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): lvs -o lv_size --noheadings --units b --nosuffix /dev/cinder-volumes/instance-0000007c_disk.local execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:39.626 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): dd bs=1048576 if=/dev/zero of=/dev/cinder-volumes/instance-0000007c_disk.local seek=0 count=1024 oflag=direct execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:47.622 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): lvremove -f /dev/cinder-volumes/instance-0000007c_disk /dev/cinder-volumes/instance-0000007c_disk.local execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:48.061 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Result was 5 execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:172\n2014-02-18 19:54:48.066 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] ['lvremove', '-f', '/dev/cinder-volumes/instance-0000007c_disk', '/dev/cinder-volumes/instance-0000007c_disk.local'] failed. Retrying. execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:184\n2014-02-18 19:54:49.081 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): lvremove -f /dev/cinder-volumes/instance-0000007c_disk /dev/cinder-volumes/instance-0000007c_disk.local execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:49.279 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Result was 5 execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:172\n2014-02-18 19:54:49.286 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] ['lvremove', '-f', '/dev/cinder-volumes/instance-0000007c_disk', '/dev/cinder-volumes/instance-0000007c_disk.local'] failed. Retrying. execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:184\n2014-02-18 19:54:50.222 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Running cmd (subprocess): lvremove -f /dev/cinder-volumes/instance-0000007c_disk /dev/cinder-volumes/instance-0000007c_disk.local execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:147\n2014-02-18 19:54:50.359 2368 DEBUG nova.openstack.common.processutils [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Result was 5 execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:172\n2014-02-18 19:54:50.364 2368 ERROR nova.compute.manager [req-5e803aa8-329b-4536-941b-c6f91c71dcb0 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Setting instance vm_state to ERROR\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Traceback (most recent call last):\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 4967, in _error_out_instance_on_exception\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     yield\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 2037, in rebuild_instance\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     block_device_info=block_device_info)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 835, in destroy\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     destroy_disks, context=context)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 935, in _cleanup\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     self._cleanup_lvm(instance)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 957, in _cleanup_lvm\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     libvirt_utils.remove_logical_volumes(*disks)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/utils.py\", line 392, in remove_logical_volumes\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     execute(*lvremove, attempts=3, run_as_root=True)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/virt/libvirt/utils.py\", line 50, in execute\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     return utils.execute(*args, **kwargs)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/utils.py\", line 177, in execute\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     return processutils.execute(*cmd, **kwargs)\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]   File \"/usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py\", line 178, in execute\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146]     cmd=' '.join(cmd))\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] ProcessExecutionError: Unexpected error while running command.\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Command: lvremove -f /dev/cinder-volumes/instance-0000007c_disk /dev/cinder-volumes/instance-0000007c_disk.local\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Exit code: 5\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Stdout: ''\n2014-02-18 19:54:50.364 2368 TRACE nova.compute.manager [instance: f9dfdb34-4b89-43e2-9b65-1a59d4705146] Stderr: '  One or more specified logical volume(s) not found.\\n'\n\"\"\"\n\nIn nova.virt.libvirt.utils.py:\n\"\"\"\ndef remove_logical_volumes(*paths):\n    \"\"\"Remove one or more logical volume.\"\"\"\n\n    for path in paths:\n        clear_logical_volume(path)\n\n    if paths:\n        lvremove = ('lvremove', '-f') + paths\n        execute(*lvremove, attempts=3, run_as_root=True)\n\"\"\"\nIt will try 3 times to remove two volumes (instance-0000007c_disk and instance-0000007c_disk.local).\n\nThen I trace the problem in another example, when it happed again, pdb result show below.\n\nThe 1st try:\n\n\"\"\"\n2014-02-18 22:33:48.579 24156 DEBUG nova.openstack.common.processutils [req-a97ce6d7-ee76-4349-9d89-7c2e7325f2d5 72d393e2d21d4d71837a4a57e36eb06c 99eced3f5f6d4a8089ec7a8f3e3b5f13] Result was 5 execute /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py:172\n> /usr/local/lib/python2.7/site-packages/nova/openstack/common/processutils.py(173)execute()\n-> if not ignore_exit_code and _returncode not in check_exit_code:\n(Pdb) p cmd\n['lvremove', '-f', '/dev/cinder-volumes/instance-0000007e_disk', '/dev/cinder-volumes/instance-0000007e_disk.local']\n(Pdb) p result\n('  Logical volume \"instance-0000007e_disk\" successfully removed\\n', '  Can\\'t remove open logical volume \"instance-0000007e_disk.local\"\\n')\n(Pdb) c\n...\n\"\"\"\nIt shows that remove ephemeral disk fail, but image disk success.\n\n2nd try begin:\n\n\"\"\"\n-> if not ignore_exit_code and _returncode not in check_exit_code:\n(Pdb) p cmd\n['lvremove', '-f', '/dev/cinder-volumes/instance-0000007e_disk', '/dev/cinder-volumes/instance-0000007e_disk.local']\n(Pdb) p result\n('  Logical volume \"instance-0000007e_disk.local\" successfully removed\\n', '  One or more specified logical volume(s) not found.\\n')\n(Pdb) c\n...\n\"\"\"\n\nThe ephemeral disk is remove in this time, but image disk have been removed in last step, so the whole command still fail.\n\n3rd try:\n\n\"\"\"\n-> if not ignore_exit_code and _returncode not in check_exit_code:\n(Pdb) p cmd\n['lvremove', '-f', '/dev/cinder-volumes/instance-0000007e_disk', '/dev/cinder-volumes/instance-0000007e_disk.local']\n(Pdb) p result\n('', '  One or more specified logical volume(s) not found.\\n')\n(Pdb) \n\"\"\"\n\nOpenstack think remove_logical_volumes fail, though two volumes have been removed in fact.\n\nIt seems that retry to remove open volume is useful, but if the situation that not all volumes were removed once time happen, the retry are useless, and remove_logical_volume must fail.", 
            "date_created": "2014-02-20 07:27:05.473878+00:00", 
            "author": "https://api.launchpad.net/1.0/~lvhancy"
        }, 
        {
            "content": "This prolem dose not happen in every rebuild operation.", 
            "date_created": "2014-02-20 07:37:25.404518+00:00", 
            "author": "https://api.launchpad.net/1.0/~lvhancy"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/76954", 
            "date_created": "2014-02-27 20:14:56.575285+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/76954\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=0192898e30035028b002f9aed3199be69a18efb3\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0192898e30035028b002f9aed3199be69a18efb3\nAuthor: Vladik Romanovsky <email address hidden>\nDate:   Mon Feb 24 09:36:34 2014 -0500\n\n    libvirt: remove_logical_volumes should remove each separately\n    \n    Currently, remove_logical_volumes() is trying to remove\n    all of the provided volumes path in a single lvremove command,\n    while retrying it several times.\n    This is causing the command to fail, when the deleted volumes\n    are reappearing in the next iteration of the retry loop.\n    \n    Handling the removal of each volume separately\n    and raising an exception for volumes which failed to be removed.\n    This will increase the chance for individual volume to be removed.\n    \n    Closes-Bug: #1282423\n    Change-Id: Ib25f5603929c3038716661a589a41116b4c48909\n", 
            "date_created": "2014-04-14 13:05:08.218480+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}