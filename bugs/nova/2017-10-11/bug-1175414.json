{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:40:24.909867+00:00", 
    "description": "During server creation, if an instance type is disabled an InstanceTypeNotFound is raised.  This is caught in nova/api/openstack/compute/servers.py and the exception is stuffed into a HTTPBadRequest.  Because the exception is put in there and not the exception message, when the wsgi layer tries to serialize it it results in:\n\n2013-05-02 01:24:20.157 DEBUG nova.api.openstack.wsgi [req-9e8649fa-902d-4edc-99ba-cf1f88291bac demo demo] Calling method <bound method Controller.create of <nova.api.openstack.compute.servers.Controller object at 0x3efb890>> from (pid=16849) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:920\n2013-05-02 01:24:20.172 INFO nova.api.openstack.wsgi [req-9e8649fa-902d-4edc-99ba-cf1f88291bac demo demo] HTTP exception thrown: Instance type 2 could not be found.\n2013-05-02 01:24:20.172 DEBUG nova.api.openstack.wsgi [req-9e8649fa-902d-4edc-99ba-cf1f88291bac demo demo] Returning 400 to user: Instance type 2 could not be found. from (pid=16849) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1173\n2013-05-02 01:24:20.172 ERROR nova.api.openstack [req-9e8649fa-902d-4edc-99ba-cf1f88291bac demo demo] Caught error: Circular reference detected\n2013-05-02 01:24:20.172 TRACE nova.api.openstack Traceback (most recent call last):\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 81, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 451, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1195, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     self.wrapped_exc.body = serializer.serialize(fault_data)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 321, in serialize\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return self.dispatch(data, action=action)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 186, in dispatch\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return action_method(*args, **kwargs)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 331, in default\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return jsonutils.dumps(data)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/openstack/common/jsonutils.py\", line 149, in dumps\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return json.dumps(value, default=default, **kwargs)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/lib/python2.7/json/__init__.py\", line 238, in dumps\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     **kw).encode(obj)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/lib/python2.7/json/encoder.py\", line 201, in encode\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     chunks = self.iterencode(o, _one_shot=True)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/lib/python2.7/json/encoder.py\", line 264, in iterencode\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return _iterencode(o, 0)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack ValueError: Circular reference detected\n2013-05-02 01:24:20.172 TRACE nova.api.openstack \n\n\nThe exception has a format_message() method for this, it just needs to be used.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1175414", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1175414, 
    "index": 3619, 
    "created": "2013-05-02 01:29:24.643278+00:00", 
    "title": "Circular reference serializing InstanceTypeNotFound", 
    "comments": [
        {
            "content": "During server creation, if an instance type is disabled an InstanceTypeNotFound is raised.  This is caught in nova/api/openstack/compute/servers.py and the exception is stuffed into a HTTPBadRequest.  Because the exception is put in there and not the exception message, when the wsgi layer tries to serialize it it results in:\n\n2013-05-02 01:24:20.157 DEBUG nova.api.openstack.wsgi [req-9e8649fa-902d-4edc-99ba-cf1f88291bac demo demo] Calling method <bound method Controller.create of <nova.api.openstack.compute.servers.Controller object at 0x3efb890>> from (pid=16849) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:920\n2013-05-02 01:24:20.172 INFO nova.api.openstack.wsgi [req-9e8649fa-902d-4edc-99ba-cf1f88291bac demo demo] HTTP exception thrown: Instance type 2 could not be found.\n2013-05-02 01:24:20.172 DEBUG nova.api.openstack.wsgi [req-9e8649fa-902d-4edc-99ba-cf1f88291bac demo demo] Returning 400 to user: Instance type 2 could not be found. from (pid=16849) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1173\n2013-05-02 01:24:20.172 ERROR nova.api.openstack [req-9e8649fa-902d-4edc-99ba-cf1f88291bac demo demo] Caught error: Circular reference detected\n2013-05-02 01:24:20.172 TRACE nova.api.openstack Traceback (most recent call last):\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 81, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 451, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1195, in __call__\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     self.wrapped_exc.body = serializer.serialize(fault_data)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 321, in serialize\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return self.dispatch(data, action=action)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 186, in dispatch\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return action_method(*args, **kwargs)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 331, in default\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return jsonutils.dumps(data)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/openstack/common/jsonutils.py\", line 149, in dumps\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return json.dumps(value, default=default, **kwargs)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/lib/python2.7/json/__init__.py\", line 238, in dumps\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     **kw).encode(obj)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/lib/python2.7/json/encoder.py\", line 201, in encode\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     chunks = self.iterencode(o, _one_shot=True)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack   File \"/usr/lib/python2.7/json/encoder.py\", line 264, in iterencode\n2013-05-02 01:24:20.172 TRACE nova.api.openstack     return _iterencode(o, 0)\n2013-05-02 01:24:20.172 TRACE nova.api.openstack ValueError: Circular reference detected\n2013-05-02 01:24:20.172 TRACE nova.api.openstack \n\n\nThe exception has a format_message() method for this, it just needs to be used.", 
            "date_created": "2013-05-02 01:29:24.643278+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/28002", 
            "date_created": "2013-05-02 01:33:37.126734+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/28002\nCommitted: http://github.com/openstack/nova/commit/051cf0d756d9a9e1d0a5ea1169fa97d89b7885bc\nSubmitter: Jenkins\nBranch:    master\n\ncommit 051cf0d756d9a9e1d0a5ea1169fa97d89b7885bc\nAuthor: Andrew Laski <email address hidden>\nDate:   Wed May 1 21:30:52 2013 -0400\n\n    Call format_message on InstanceTypeNotFound exception\n    \n    Put the exception message from InstanceTypeNotFound into the\n    HTTPBadRequest rather than the exception itself.  Prevents a Circular\n    reference error during serialization later.\n    \n    Bug 1175414\n    \n    Change-Id: I4811e727311af670cd964a6d16ac5fce0fe3186e\n", 
            "date_created": "2013-05-02 04:53:25.779927+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/28076", 
            "date_created": "2013-05-02 19:07:59.012385+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}