{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:00:53.975507+00:00", 
    "description": "I got the following errors in a tempest test at http://logs.openstack.org/97/62397/1/check/check-tempest-dsvm-full/3f7b8c3:\n\n\n\n2013-12-16 16:07:52.189 27621 DEBUG nova.openstack.common.processutils [-] Result was 1 execute /opt/stack/new/nova/nova/openstack/common/processutils.py:172\n2013-12-16 16:07:52.189 27621 ERROR nova.openstack.common.periodic_task [-] Error during ComputeManager._run_image_cache_manager_pass: Unexpected error while running command.\nCommand: env LC_ALL=C LANG=C qemu-img info /opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk\nExit code: 1\nStdout: ''\nStderr: \"qemu-img: Could not open '/opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk': No such file or directory\\n\"\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Traceback (most recent call last):\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/openstack/common/periodic_task.py\", line 180, in run_periodic_tasks\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     task(self, context)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 5210, in _run_image_cache_manager_pass\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     self.driver.manage_image_cache(context, filtered_instances)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4650, in manage_image_cache\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     self.image_cache_manager.verify_base_images(context, all_instances)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/libvirt/imagecache.py\", line 603, in verify_base_images\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     inuse_backing_images = self._list_backing_images()\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/libvirt/imagecache.py\", line 345, in _list_backing_images\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     backing_file = virtutils.get_disk_backing_file(disk_path)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/libvirt/utils.py\", line 442, in get_disk_backing_file\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     backing_file = images.qemu_img_info(path).backing_file\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/images.py\", line 56, in qemu_img_info\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     'qemu-img', 'info', path)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/utils.py\", line 175, in execute\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     return processutils.execute(*cmd, **kwargs)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/openstack/common/processutils.py\", line 178, in execute\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     cmd=' '.join(cmd))\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task ProcessExecutionError: Unexpected error while running command.\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Command: env LC_ALL=C LANG=C qemu-img info /opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Exit code: 1\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Stdout: ''\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Stderr: \"qemu-img: Could not open '/opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk': No such file or directory\\n\"\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1261442", 
    "owner": "https://api.launchpad.net/1.0/~jichenjc", 
    "id": 1261442, 
    "index": 6001, 
    "created": "2013-12-16 16:31:56.970954+00:00", 
    "title": "Spurious error from ComputeManager._run_image_cache_manager_pass", 
    "comments": [
        {
            "content": "I got the following errors in a tempest test at http://logs.openstack.org/97/62397/1/check/check-tempest-dsvm-full/3f7b8c3:\n\n\n\n2013-12-16 16:07:52.189 27621 DEBUG nova.openstack.common.processutils [-] Result was 1 execute /opt/stack/new/nova/nova/openstack/common/processutils.py:172\n2013-12-16 16:07:52.189 27621 ERROR nova.openstack.common.periodic_task [-] Error during ComputeManager._run_image_cache_manager_pass: Unexpected error while running command.\nCommand: env LC_ALL=C LANG=C qemu-img info /opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk\nExit code: 1\nStdout: ''\nStderr: \"qemu-img: Could not open '/opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk': No such file or directory\\n\"\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Traceback (most recent call last):\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/openstack/common/periodic_task.py\", line 180, in run_periodic_tasks\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     task(self, context)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 5210, in _run_image_cache_manager_pass\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     self.driver.manage_image_cache(context, filtered_instances)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4650, in manage_image_cache\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     self.image_cache_manager.verify_base_images(context, all_instances)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/libvirt/imagecache.py\", line 603, in verify_base_images\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     inuse_backing_images = self._list_backing_images()\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/libvirt/imagecache.py\", line 345, in _list_backing_images\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     backing_file = virtutils.get_disk_backing_file(disk_path)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/libvirt/utils.py\", line 442, in get_disk_backing_file\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     backing_file = images.qemu_img_info(path).backing_file\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/virt/images.py\", line 56, in qemu_img_info\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     'qemu-img', 'info', path)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/utils.py\", line 175, in execute\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     return processutils.execute(*cmd, **kwargs)\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task   File \"/opt/stack/new/nova/nova/openstack/common/processutils.py\", line 178, in execute\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task     cmd=' '.join(cmd))\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task ProcessExecutionError: Unexpected error while running command.\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Command: env LC_ALL=C LANG=C qemu-img info /opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Exit code: 1\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Stdout: ''\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task Stderr: \"qemu-img: Could not open '/opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk': No such file or directory\\n\"\n2013-12-16 16:07:52.189 27621 TRACE nova.openstack.common.periodic_task", 
            "date_created": "2013-12-16 16:31:56.970954+00:00", 
            "author": "https://api.launchpad.net/1.0/~therve"
        }, 
        {
            "content": "from the log screen-n-cpu.txt\n\n2013-12-16 16:07:52.132</a> 27621 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): env LC_ALL=C LANG=C qemu-img info /opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a/disk execute /opt/stack/new/nova/nova/openstack/common/processutils.py:147\n2013-12-16 16:07:52.181[instance: 95dbf14f-3abb-42c7-94c5-dd7355ecd78a] Deleting instance files /opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a\n2013-12-16 16:07:52.185 [instance: 95dbf14f-3abb-42c7-94c5-dd7355ecd78a] Deletion of /opt/stack/data/nova/instances/95dbf14f-3abb-42c7-94c5-dd7355ecd78a complete\n</span><span class='DEBUG _2013-12-16_16_07_52_189'><a name='_2013-12-16_16_07_52_189' class='date' href='#_2013-12-16_16_07_52_189'>2013-12-16 16:07:52.189</a> 27621 DEBUG nova.openstack.common.processutils [-] Result was 1 execute /opt/stack/new/nova/nova/openstack/common/processutils.py:172\n\n\nthis is a very rare case that the instance 95dbf14f-3abb-42c7-94c5-dd7355ecd78a was deleted between check disk file and get qemu info from it , at 16:07:52.132, t's still there  (because the file exist check logic before), but at 16:07:52.181, it was deleted \nthen the process switch back to original one , it find the file was gone and return a error \n\nthe solution  with lock might be a candidate, but catch the exception and ignore it is much more simple ", 
            "date_created": "2013-12-27 14:45:33.396443+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/64277", 
            "date_created": "2013-12-27 14:49:55.894794+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/64277\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=52f9994aab8b60de2ba22579f923beb050e92bca\nSubmitter: Jenkins\nBranch:    master\n\ncommit 52f9994aab8b60de2ba22579f923beb050e92bca\nAuthor: jichenjc <email address hidden>\nDate:   Sun Dec 22 06:52:27 2013 +0800\n\n    Fix image cache periodic task concurrent access bug\n    \n    This fix catch the exception and ignore a disk file absent\n    exception. It will defer the image cache clean to next round\n    image cache periodic task because it's not harmful.\n    Refer to detailed info, log analysis and root cause in defect.\n    \n    Change-Id: I3a431bf389658f976edf5c847c04b7e0aac496fd\n    Closes-Bug: #1261442\n", 
            "date_created": "2014-01-11 10:33:10.507165+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}