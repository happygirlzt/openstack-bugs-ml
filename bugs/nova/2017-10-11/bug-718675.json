{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:36:43.072200+00:00", 
    "description": "Tried to setup fresh nova db, version from trunk:\nnova-manage db sync\nwith PostgreSQL 9.0 and got following error:\n\n$ sudo -u nova nova-manage --flagfile=/etc/nova/nova.conf db sync\n2011-02-14 14:27:05,238 INFO migrate.versioning.api [-] 0 -> 1... \n2011-02-14 14:27:05,351 INFO nova.root [-] Table('export_devices', MetaData(Engine(postgresql+psycopg2://nova:nova@localhost/nova)), Column('created_at', DateTime(timezone=False), table=<export_devices>), Column('updated_at', DateTime(timezone=False), table=<export_devices>), Column('deleted_at', DateTime(timezone=False), table=<export_devices>), Column('deleted', Boolean(create_constraint=True, name=None), table=<export_devices>), Column('id', Integer(), table=<export_devices>, primary_key=True, nullable=False), Column('shelf_id', Integer(), table=<export_devices>), Column('blade_id', Integer(), table=<export_devices>), Column('volume_id', Integer(), ForeignKey('volumes.id'), table=<export_devices>), schema=None)\n2011-02-14 14:27:05,351 ERROR nova.root [-] Exception while creating table\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/migrate_repo/versions/001_austin.py\", line 518, in upgrade\n(nova.root): TRACE:     table.create()\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/schema.py\", line 439, in create\n(nova.root): TRACE:     bind.create(self, checkfirst=checkfirst)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1647, in create\n(nova.root): TRACE:     connection=connection, **kwargs)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1682, in _run_visitor\n(nova.root): TRACE:     **kwargs).traverse_single(element)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/sql/visitors.py\", line 77, in traverse_single\n(nova.root): TRACE:     return meth(obj, **kw)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/ddl.py\", line 58, in visit_table\n(nova.root): TRACE:     self.connection.execute(schema.CreateTable(table))\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1157, in execute\n(nova.root): TRACE:     params)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1210, in _execute_ddl\n(nova.root): TRACE:     return self.__execute_context(context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1268, in __execute_context\n(nova.root): TRACE:     context.parameters[0], context=context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1367, in _cursor_execute\n(nova.root): TRACE:     context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1360, in _cursor_execute\n(nova.root): TRACE:     context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/default.py\", line 288, in do_execute\n(nova.root): TRACE:     cursor.execute(statement, parameters)\n(nova.root): TRACE: ProgrammingError: (ProgrammingError) relation \"volumes\" does not exist\n(nova.root): TRACE:  '\\nCREATE TABLE export_devices (\\n\\tcreated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tupdated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted BOOLEAN, \\n\\tid SERIAL NOT NULL, \\n\\tshelf_id INTEGER, \\n\\tblade_id INTEGER, \\n\\tvolume_id INTEGER, \\n\\tPRIMARY KEY (id), \\n\\tFOREIGN KEY(volume_id) REFERENCES volumes (id)\\n)\\n\\n' {}\n(nova.root): TRACE: \n2011-02-14 14:27:05,372 CRITICAL nova.root [-] (ProgrammingError) relation \"volumes\" does not exist\n '\\nCREATE TABLE export_devices (\\n\\tcreated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tupdated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted BOOLEAN, \\n\\tid SERIAL NOT NULL, \\n\\tshelf_id INTEGER, \\n\\tblade_id INTEGER, \\n\\tvolume_id INTEGER, \\n\\tPRIMARY KEY (id), \\n\\tFOREIGN KEY(volume_id) REFERENCES volumes (id)\\n)\\n\\n' {}\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"/usr/bin/nova-manage\", line 694, in <module>\n(nova.root): TRACE:     main()\n(nova.root): TRACE:   File \"/usr/bin/nova-manage\", line 686, in main\n(nova.root): TRACE:     fn(*argv)\n(nova.root): TRACE:   File \"/usr/bin/nova-manage\", line 565, in sync\n(nova.root): TRACE:     return migration.db_sync(version)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/migration.py\", line 33, in db_sync\n(nova.root): TRACE:     return IMPL.db_sync(version=version)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/migration.py\", line 33, in db_sync\n(nova.root): TRACE:     return versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/api.py\", line 185, in upgrade\n(nova.root): TRACE:     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n(nova.root): TRACE:   File \"<string>\", line 2, in _migrate\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/util/__init__.py\", line 160, in with_engine\n(nova.root): TRACE:     return f(*a, **kw)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/api.py\", line 364, in _migrate\n(nova.root): TRACE:     schema.runchange(ver, change, changeset.step)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/schema.py\", line 83, in runchange\n(nova.root): TRACE:     change.run(self.engine, step)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/script/py.py\", line 140, in run\n(nova.root): TRACE:     script_func(engine)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/migrate_repo/versions/001_austin.py\", line 518, in upgrade\n(nova.root): TRACE:     table.create()\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/schema.py\", line 439, in create\n(nova.root): TRACE:     bind.create(self, checkfirst=checkfirst)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1647, in create\n(nova.root): TRACE:     connection=connection, **kwargs)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1682, in _run_visitor\n(nova.root): TRACE:     **kwargs).traverse_single(element)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/sql/visitors.py\", line 77, in traverse_single\n(nova.root): TRACE:     return meth(obj, **kw)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/ddl.py\", line 58, in visit_table\n(nova.root): TRACE:     self.connection.execute(schema.CreateTable(table))\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1157, in execute\n(nova.root): TRACE:     params)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1210, in _execute_ddl\n(nova.root): TRACE:     return self.__execute_context(context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1268, in __execute_context\n(nova.root): TRACE:     context.parameters[0], context=context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1367, in _cursor_execute\n(nova.root): TRACE:     context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1360, in _cursor_execute\n(nova.root): TRACE:     context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/default.py\", line 288, in do_execute\n(nova.root): TRACE:     cursor.execute(statement, parameters)\n(nova.root): TRACE: ProgrammingError: (ProgrammingError) relation \"volumes\" does not exist\n(nova.root): TRACE:  '\\nCREATE TABLE export_devices (\\n\\tcreated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tupdated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted BOOLEAN, \\n\\tid SERIAL NOT NULL, \\n\\tshelf_id INTEGER, \\n\\tblade_id INTEGER, \\n\\tvolume_id INTEGER, \\n\\tPRIMARY KEY (id), \\n\\tFOREIGN KEY(volume_id) REFERENCES volumes (id)\\n)\\n\\n' {}\n(nova.root): TRACE:", 
    "tags": [
        "bexar-post-release"
    ], 
    "importance": "Medium", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/718675", 
    "owner": "https://api.launchpad.net/1.0/~vash-vasiliyshlykov", 
    "id": 718675, 
    "index": 2275, 
    "created": "2011-02-14 11:38:46.690415+00:00", 
    "title": "Can't create db with PostgreSQL backend", 
    "comments": [
        {
            "content": "Tried to setup fresh nova db, version from trunk:\nnova-manage db sync\nwith PostgreSQL 9.0 and got following error:\n\n$ sudo -u nova nova-manage --flagfile=/etc/nova/nova.conf db sync\n2011-02-14 14:27:05,238 INFO migrate.versioning.api [-] 0 -> 1... \n2011-02-14 14:27:05,351 INFO nova.root [-] Table('export_devices', MetaData(Engine(postgresql+psycopg2://nova:nova@localhost/nova)), Column('created_at', DateTime(timezone=False), table=<export_devices>), Column('updated_at', DateTime(timezone=False), table=<export_devices>), Column('deleted_at', DateTime(timezone=False), table=<export_devices>), Column('deleted', Boolean(create_constraint=True, name=None), table=<export_devices>), Column('id', Integer(), table=<export_devices>, primary_key=True, nullable=False), Column('shelf_id', Integer(), table=<export_devices>), Column('blade_id', Integer(), table=<export_devices>), Column('volume_id', Integer(), ForeignKey('volumes.id'), table=<export_devices>), schema=None)\n2011-02-14 14:27:05,351 ERROR nova.root [-] Exception while creating table\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/migrate_repo/versions/001_austin.py\", line 518, in upgrade\n(nova.root): TRACE:     table.create()\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/schema.py\", line 439, in create\n(nova.root): TRACE:     bind.create(self, checkfirst=checkfirst)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1647, in create\n(nova.root): TRACE:     connection=connection, **kwargs)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1682, in _run_visitor\n(nova.root): TRACE:     **kwargs).traverse_single(element)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/sql/visitors.py\", line 77, in traverse_single\n(nova.root): TRACE:     return meth(obj, **kw)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/ddl.py\", line 58, in visit_table\n(nova.root): TRACE:     self.connection.execute(schema.CreateTable(table))\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1157, in execute\n(nova.root): TRACE:     params)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1210, in _execute_ddl\n(nova.root): TRACE:     return self.__execute_context(context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1268, in __execute_context\n(nova.root): TRACE:     context.parameters[0], context=context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1367, in _cursor_execute\n(nova.root): TRACE:     context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1360, in _cursor_execute\n(nova.root): TRACE:     context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/default.py\", line 288, in do_execute\n(nova.root): TRACE:     cursor.execute(statement, parameters)\n(nova.root): TRACE: ProgrammingError: (ProgrammingError) relation \"volumes\" does not exist\n(nova.root): TRACE:  '\\nCREATE TABLE export_devices (\\n\\tcreated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tupdated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted BOOLEAN, \\n\\tid SERIAL NOT NULL, \\n\\tshelf_id INTEGER, \\n\\tblade_id INTEGER, \\n\\tvolume_id INTEGER, \\n\\tPRIMARY KEY (id), \\n\\tFOREIGN KEY(volume_id) REFERENCES volumes (id)\\n)\\n\\n' {}\n(nova.root): TRACE: \n2011-02-14 14:27:05,372 CRITICAL nova.root [-] (ProgrammingError) relation \"volumes\" does not exist\n '\\nCREATE TABLE export_devices (\\n\\tcreated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tupdated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted BOOLEAN, \\n\\tid SERIAL NOT NULL, \\n\\tshelf_id INTEGER, \\n\\tblade_id INTEGER, \\n\\tvolume_id INTEGER, \\n\\tPRIMARY KEY (id), \\n\\tFOREIGN KEY(volume_id) REFERENCES volumes (id)\\n)\\n\\n' {}\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"/usr/bin/nova-manage\", line 694, in <module>\n(nova.root): TRACE:     main()\n(nova.root): TRACE:   File \"/usr/bin/nova-manage\", line 686, in main\n(nova.root): TRACE:     fn(*argv)\n(nova.root): TRACE:   File \"/usr/bin/nova-manage\", line 565, in sync\n(nova.root): TRACE:     return migration.db_sync(version)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/migration.py\", line 33, in db_sync\n(nova.root): TRACE:     return IMPL.db_sync(version=version)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/migration.py\", line 33, in db_sync\n(nova.root): TRACE:     return versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/api.py\", line 185, in upgrade\n(nova.root): TRACE:     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n(nova.root): TRACE:   File \"<string>\", line 2, in _migrate\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/util/__init__.py\", line 160, in with_engine\n(nova.root): TRACE:     return f(*a, **kw)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/api.py\", line 364, in _migrate\n(nova.root): TRACE:     schema.runchange(ver, change, changeset.step)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/schema.py\", line 83, in runchange\n(nova.root): TRACE:     change.run(self.engine, step)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/migrate/versioning/script/py.py\", line 140, in run\n(nova.root): TRACE:     script_func(engine)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/migrate_repo/versions/001_austin.py\", line 518, in upgrade\n(nova.root): TRACE:     table.create()\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/schema.py\", line 439, in create\n(nova.root): TRACE:     bind.create(self, checkfirst=checkfirst)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1647, in create\n(nova.root): TRACE:     connection=connection, **kwargs)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1682, in _run_visitor\n(nova.root): TRACE:     **kwargs).traverse_single(element)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/sql/visitors.py\", line 77, in traverse_single\n(nova.root): TRACE:     return meth(obj, **kw)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/ddl.py\", line 58, in visit_table\n(nova.root): TRACE:     self.connection.execute(schema.CreateTable(table))\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1157, in execute\n(nova.root): TRACE:     params)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1210, in _execute_ddl\n(nova.root): TRACE:     return self.__execute_context(context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1268, in __execute_context\n(nova.root): TRACE:     context.parameters[0], context=context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1367, in _cursor_execute\n(nova.root): TRACE:     context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 1360, in _cursor_execute\n(nova.root): TRACE:     context)\n(nova.root): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/default.py\", line 288, in do_execute\n(nova.root): TRACE:     cursor.execute(statement, parameters)\n(nova.root): TRACE: ProgrammingError: (ProgrammingError) relation \"volumes\" does not exist\n(nova.root): TRACE:  '\\nCREATE TABLE export_devices (\\n\\tcreated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tupdated_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted_at TIMESTAMP WITHOUT TIME ZONE, \\n\\tdeleted BOOLEAN, \\n\\tid SERIAL NOT NULL, \\n\\tshelf_id INTEGER, \\n\\tblade_id INTEGER, \\n\\tvolume_id INTEGER, \\n\\tPRIMARY KEY (id), \\n\\tFOREIGN KEY(volume_id) REFERENCES volumes (id)\\n)\\n\\n' {}\n(nova.root): TRACE:", 
            "date_created": "2011-02-14 11:38:46.690415+00:00", 
            "author": "https://api.launchpad.net/1.0/~vash-vasiliyshlykov"
        }, 
        {
            "content": "Ok, I investigated this issue. It seems that table creation table is wrong or maybe this point for only PostgreSQL. I provided fix in separate branch: https://code.launchpad.net/~vash-vasiliyshlykov/nova/lp718675", 
            "date_created": "2011-02-14 13:08:27.335696+00:00", 
            "author": "https://api.launchpad.net/1.0/~vash-vasiliyshlykov"
        }
    ]
}