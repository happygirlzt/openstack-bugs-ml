{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:01:31.658530+00:00", 
    "description": "\n We are using Essex version. \n(And we found out that the current nova still uses the same method to attach a volume to an LXC instance.)\nWe are testing volume attachment to an LXC instance.\nFrom the code, the volume is mounted by the host machine to the file system of the LXC instance.\n\n# nova/virt/disk/api.py\nutils.execute('mount', '-o', 'bind', src, target,\n                run_as_root=True)\n\nFrom the host machine, it is visible.\nBut, inside of the LXC instance, it is not visible.\nDoes this method work?\n\n Before Essex, we used \"lxc-attach\" command to run \"mknod\" command inside of the LXC instance\ninstead of \"mount\" it by the host outside of the LXC instance.\nIt did work.\n \n As I know, dynamic changes in 'devices' done by the host outside of the LXC instance is not shown inside of the LXC instance.\n(Dynamic changes in 'files' in the LXC file system done by the host outside of the LXC instance can be seen inside of the LXC instance.)\nAs I understand, the current way of attaching volume to an LXC instance does not work.\n\n Here are the content of the dev directory shown inside of the LXC instance, and at the host side.\nBoth are different. \n\n1. Inside the LXC instance \n$ ls /dev\nconsole  full  null  nvidia0  nvidia1  nvidia2  nvidia3  nvidiactl  ptmx  pts  random  tty  tty1  urandom  zero\n\n2. At the host\n$ ls /usr/local/nova/instances/instance-0000004f/rootfs/dev/\nblock            crash  full       kmsg   loop5    mapper  nbd13  nbd7                oldmem  ram11  ram5    rtc   sg2  shm       tty0   tty16  tty23  tty30  tty38  tty45  tty52  tty6   ttyS0    usbmon3  vcs2   vcsa3        zero\nbsg              disk   fuse       kvm    loop6    mcelog  nbd14  nbd8                port    ram12  ram6    rtc0  sg3  snapshot  tty1   tty17  tty24  tty31  tty39  tty46  tty53  tty60  ttyS1    usbmon4  vcs3   vcsa4\nbus              dm-0   fw0        log    loop7    mem     nbd15  nbd9                ppp     ram13  ram7    sda   sg4  snd       tty10  tty18  tty25  tty32  tty4   tty47  tty54  tty61  ttyS2    usbmon5  vcs4   vcsa5\nchar             dm-1   hidraw0    loop0  lp0      nbd0    nbd2   net                 ptmx    ram14  ram8    sda1  sg5  stderr    tty11  tty19  tty26  tty33  tty40  tty48  tty55  tty62  ttyS3    usbmon6  vcs5   vcsa6\nconsole          dm-2   hidraw1    loop1  lp1      nbd1    nbd3   network_latency     pts     ram15  ram9    sdb   sg6  stdin     tty12  tty2   tty27  tty34  tty41  tty49  tty56  tty63  urandom  usbmon7  vcs6   vdc\ncore             fb     hugepages  loop2  lp2      nbd10   nbd4   network_throughput  ram0    ram2   random  sdb1  sg7  stdout    tty13  tty20  tty28  tty35  tty42  tty5   tty57  tty7   usbmon0  usbmon8  vcsa   vga_arbiter\ncpu              fb0    hvc0       loop3  lp3      nbd11   nbd5   null                ram1    ram3   raw     sg0   sg8  systty    tty14  tty21  tty29  tty36  tty43  tty50  tty58  tty8   usbmon1  vcs      vcsa1  vhost-net\ncpu_dma_latency  fd     input      loop4  MAKEDEV  nbd12   nbd6   nvram               ram10   ram4   root    sg1   sg9  tty       tty15  tty22  tty3   tty37  tty44  tty51  tty59  tty9   usbmon2  vcs1     vcsa2  VolGroup\n\n Thanks,\n David", 
    "tags": [
        "lxc"
    ], 
    "importance": "High", 
    "heat": 22, 
    "link": "https://bugs.launchpad.net/nova/+bug/1009701", 
    "owner": "https://api.launchpad.net/1.0/~zulcss", 
    "id": 1009701, 
    "index": 702, 
    "created": "2012-06-06 19:56:48.944280+00:00", 
    "title": "LXC volume attachment code does not work", 
    "comments": [
        {
            "content": "\n We are using Essex version. \n(And we found out that the current nova still uses the same method to attach a volume to an LXC instance.)\nWe are testing volume attachment to an LXC instance.\nFrom the code, the volume is mounted by the host machine to the file system of the LXC instance.\n\n# nova/virt/disk/api.py\nutils.execute('mount', '-o', 'bind', src, target,\n                run_as_root=True)\n\nFrom the host machine, it is visible.\nBut, inside of the LXC instance, it is not visible.\nDoes this method work?\n\n Before Essex, we used \"lxc-attach\" command to run \"mknod\" command inside of the LXC instance\ninstead of \"mount\" it by the host outside of the LXC instance.\nIt did work.\n \n As I know, dynamic changes in 'devices' done by the host outside of the LXC instance is not shown inside of the LXC instance.\n(Dynamic changes in 'files' in the LXC file system done by the host outside of the LXC instance can be seen inside of the LXC instance.)\nAs I understand, the current way of attaching volume to an LXC instance does not work.\n\n Here are the content of the dev directory shown inside of the LXC instance, and at the host side.\nBoth are different. \n\n1. Inside the LXC instance \n$ ls /dev\nconsole  full  null  nvidia0  nvidia1  nvidia2  nvidia3  nvidiactl  ptmx  pts  random  tty  tty1  urandom  zero\n\n2. At the host\n$ ls /usr/local/nova/instances/instance-0000004f/rootfs/dev/\nblock            crash  full       kmsg   loop5    mapper  nbd13  nbd7                oldmem  ram11  ram5    rtc   sg2  shm       tty0   tty16  tty23  tty30  tty38  tty45  tty52  tty6   ttyS0    usbmon3  vcs2   vcsa3        zero\nbsg              disk   fuse       kvm    loop6    mcelog  nbd14  nbd8                port    ram12  ram6    rtc0  sg3  snapshot  tty1   tty17  tty24  tty31  tty39  tty46  tty53  tty60  ttyS1    usbmon4  vcs3   vcsa4\nbus              dm-0   fw0        log    loop7    mem     nbd15  nbd9                ppp     ram13  ram7    sda   sg4  snd       tty10  tty18  tty25  tty32  tty4   tty47  tty54  tty61  ttyS2    usbmon5  vcs4   vcsa5\nchar             dm-1   hidraw0    loop0  lp0      nbd0    nbd2   net                 ptmx    ram14  ram8    sda1  sg5  stderr    tty11  tty19  tty26  tty33  tty40  tty48  tty55  tty62  ttyS3    usbmon6  vcs5   vcsa6\nconsole          dm-2   hidraw1    loop1  lp1      nbd1    nbd3   network_latency     pts     ram15  ram9    sdb   sg6  stdin     tty12  tty2   tty27  tty34  tty41  tty49  tty56  tty63  urandom  usbmon7  vcs6   vdc\ncore             fb     hugepages  loop2  lp2      nbd10   nbd4   network_throughput  ram0    ram2   random  sdb1  sg7  stdout    tty13  tty20  tty28  tty35  tty42  tty5   tty57  tty7   usbmon0  usbmon8  vcsa   vga_arbiter\ncpu              fb0    hvc0       loop3  lp3      nbd11   nbd5   null                ram1    ram3   raw     sg0   sg8  systty    tty14  tty21  tty29  tty36  tty43  tty50  tty58  tty8   usbmon1  vcs      vcsa1  vhost-net\ncpu_dma_latency  fd     input      loop4  MAKEDEV  nbd12   nbd6   nvram               ram10   ram4   root    sg1   sg9  tty       tty15  tty22  tty3   tty37  tty44  tty51  tty59  tty9   usbmon2  vcs1     vcsa2  VolGroup\n\n Thanks,\n David", 
            "date_created": "2012-06-06 19:56:48.944280+00:00", 
            "author": "https://api.launchpad.net/1.0/~dkang"
        }, 
        {
            "content": "This openstack code is just plain broken. The /dev inside the container is a custom tmpfs instance. Since containers have a private filesystem namespace, the is not visible to the host filesystem in any way.\n\nThis broken code should just be removed, since there is no reasonable way to make this work without kernel support for /proc/self/ns/mount, and once that exists, libvirt will be able to provide proper APIs for this operation.", 
            "date_created": "2012-09-07 15:08:36.183256+00:00", 
            "author": "https://api.launchpad.net/1.0/~berrange"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/13046", 
            "date_created": "2012-09-14 20:17:36.796711+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/17861\nCommitted: http://github.com/openstack/nova/commit/b8831091a8d097bb55a0e65c3af254a8bfa88811\nSubmitter: Jenkins\nBranch:    master\n\ncommit b8831091a8d097bb55a0e65c3af254a8bfa88811\nAuthor: Chuck Short <email address hidden>\nDate:   Tue Dec 11 10:02:28 2012 -0600\n\n    Remove lxc attaching/detaching of volumes\n    \n    Remove lxc attach and detach of volumes since this\n    will be handled by libvirt in upcoming versions of\n    libvirt.\n    \n    This is expected to be in libvirt 1.0.1 or 1.0.2.\n    This resolves (LP: #1067638) and (LP: #1009701)\n    \n    This removes a non-functional feature of the\n    lxc driver with functionalilty that is coming\n    with newer versions of libvirt.\n    \n    Change-Id: Iaf4bc2769632ba2e7dcfc67892dded7b4dfbb3ae\n    Signed-off-by: Chuck Short <email address hidden>\n", 
            "date_created": "2012-12-28 11:25:24.331345+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}