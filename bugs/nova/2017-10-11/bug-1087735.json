{
    "status": "Fix Released", 
    "last_updated": "2013-10-11 10:02:12.241456+00:00", 
    "description": "Cinder fails to attach a volume to an instance if multiple endpoints of Cinder are configured in Keystone and \nthe endpoints are unique to a region.\n\nPre-config: Create a Cinder endpoint for two different regions (say, RegionOne and RegionTwo) in Keystone\n\nCreate a volume and try to attach it to an instance fails with the following error:\n\nAmbiguousEndpoints: [{u'adminURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009', u'region': u'RegionOne', u'internalURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009', 'serviceName': u'cinder', u'id': u'1ebcb30a728948a29e594cdabe1d3ca5', u'publicURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009'}, {u'adminURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009', u'region': u'RegionTwo', u'internalURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009', 'serviceName': u'cinder', u'id': u'6f17a81430cb4409af0026d543d362f7', u'publicURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009'}]\n\nNova API Log snip: http://paste.openstack.org/show/27572/", 
    "tags": [
        "canonistack", 
        "ntt"
    ], 
    "importance": "Undecided", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1087735", 
    "owner": "https://api.launchpad.net/1.0/~rohitk", 
    "id": 1087735, 
    "index": 3253, 
    "created": "2012-12-07 15:07:35.737645+00:00", 
    "title": "Attaching volume fails if keystone has multiple endpoints of Cinder", 
    "comments": [
        {
            "content": "Cinder fails to attach a volume to an instance if multiple endpoints of Cinder are configured in Keystone and \nthe endpoints are unique to a region.\n\nPre-config: Create a Cinder endpoint for two different regions (say, RegionOne and RegionTwo) in Keystone\n\nCreate a volume and try to attach it to an instance fails with the following error:\n\nAmbiguousEndpoints: [{u'adminURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009', u'region': u'RegionOne', u'internalURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009', 'serviceName': u'cinder', u'id': u'1ebcb30a728948a29e594cdabe1d3ca5', u'publicURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009'}, {u'adminURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009', u'region': u'RegionTwo', u'internalURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009', 'serviceName': u'cinder', u'id': u'6f17a81430cb4409af0026d543d362f7', u'publicURL': u'http://10.2.3.102:8776/v1/4f272085adb34eef8a8b6e61e15f5009'}]\n\nNova API Log snip: http://paste.openstack.org/show/27572/", 
            "date_created": "2012-12-07 15:07:35.737645+00:00", 
            "author": "https://api.launchpad.net/1.0/~rohitk"
        }, 
        {
            "content": "This looks like a bug in cinder client. I think nova gets this fixed for free if cinderclient is tweaked?", 
            "date_created": "2012-12-08 08:27:28.687004+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "this is expected, you need to specify the REGION_NAME by add  OS_REGION_NAME=RegionOne  to you env. \nall clients now cann't works if  multi endpoints is returns after filtering by using credentials offerred by user .\n\nsee the logic\n\n\nif not matching_endpoints:\n 80             raise exceptions.EndpointNotFound()\n 81         elif len(matching_endpoints) > 1:\n 82             raise exceptions.AmbiguousEndpoints(message=matching_endpoints)\n 83         else:\n 84             return matching_endpoints[0][endpoint_type]\n\nthe issue is should we allow multi endpoints being used at the same time. ", 
            "date_created": "2012-12-10 07:55:26.669344+00:00", 
            "author": "https://api.launchpad.net/1.0/~heut2008"
        }, 
        {
            "content": "@heut2008: IMO, this is a valid bug, the cinderclient code does not utilize the OS_REGION_NAME environment variable even if it's set.\n\nIt seems none of the clients/API seem to utilize the os-region-name parameter when passed.\n\nUsing novaclient:--->\n\n$ nova --os-username demo --os-password pass --os-tenant-name demo --os-auth-url http://10.2.3.102:5000/v2.0 --os-region-name RegionTwo volume-attach 1dc1a92e-9668-42cc-9d9e-b00074d2e1e3 3e12340c-dc3c-4e6b-a69d-0495508b3821 /dev/vdc\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-387766dd-7e41-48d7-aed9-f375427819ae)\n\nn-api log shows the same error as pasted in the description\n\nUsing cinderclient to list endpoints for a specific region, \n(the client does not honor the region (I think this is a separate bug)): --->\n\n$ cinder --os-region-name RegionTwo endpoints\nCould not find any suitable endpoint. Correct region?\nERROR: \n\nUsing keystone client to list endpoints specific to a region (lists all the endpoints): --->\n\n$ keystone --os-region-name RegionTwo endpoint-list\n+----------------------------------+-----------+---------------------------------------------------------+---------------------------------------------------------+---------------------------------------------------------+----------------------------------+\n|                id                |   region  |                        publicurl                        |                       internalurl                       |                         adminurl                        |            service_id            |\n+----------------------------------+-----------+---------------------------------------------------------+---------------------------------------------------------+---------------------------------------------------------+----------------------------------+\n| 1a8e75a0b34f44768ee49780ff71e6e0 | RegionOne |         http://10.2.3.102:8776/v1/$(tenant_id)s         |         http://10.2.3.102:8776/v1/$(tenant_id)s         |         http://10.2.3.102:8776/v1/$(tenant_id)s         | caed87251c8f436ab3da6d40ca728dd3 |\n| 2c21d0a2320f458a97789c51238c62e7 | RegionOne |                  http://10.2.3.102:9292                 |                  http://10.2.3.102:9292                 |                  http://10.2.3.102:9292                 | e9714b9423d8462f8d9332bfe1d03b8f |\n| 3d22976758a0419e94527686fd52a667 | RegionTwo | http://10.2.3.102:8776$(compute_port)s/v2/$(tenant_id)s | http://10.2.3.102:8776$(compute_port)s/v2/$(tenant_id)s | http://10.2.3.102:8776$(compute_port)s/v2/$(tenant_id)s | caed87251c8f436ab3da6d40ca728dd3 |\n| 44d7ea8d003c453e80b0ffc710acd4a5 | RegionOne |          http://10.2.3.102:8773/services/Cloud          |          http://10.2.3.102:8773/services/Cloud          |          http://10.2.3.102:8773/services/Admin          | 5a4d70b8959448f089046bbe79016136 |\n| 45bb2976c3274c8a86629ce9fbe3e478 | RegionOne |          http://10.2.3.102:$(public_port)s/v2.0         |          http://10.2.3.102:$(public_port)s/v2.0         |          http://10.2.3.102:$(admin_port)s/v2.0          | 606ab90bff4a41d08bd3f1be14592014 |\n| 970eca3c262c47fa988124af35320512 | RegionOne |                  http://10.2.3.102:3333                 |                  http://10.2.3.102:3333                 |                  http://10.2.3.102:3333                 | 6eef37eeb55b40f4adf3a9ceaa67873e |\n| b659c758d9be44e488e647c3853379f2 | RegionOne |                 http://10.2.3.102:9696/                 |                 http://10.2.3.102:9696/                 |                 http://10.2.3.102:9696/                 | 2ebbd36f58784ff281f5ac7ebedf8c9e |\n| d9e4ac40ae2e4b67b256523fc5047e78 | RegionOne |   http://10.2.3.102:$(compute_port)s/v2/$(tenant_id)s   |   http://10.2.3.102:$(compute_port)s/v2/$(tenant_id)s   |   http://10.2.3.102:$(compute_port)s/v2/$(tenant_id)s   | 32895713dc8342b8ace5d49f974f5266 |\n+----------------------------------+-----------+---------------------------------------------------------+---------------------------------------------------------+---------------------------------------------------------+----------------------------------+\n\nThe above command should have returned only RegionTwo endpoints.", 
            "date_created": "2012-12-10 13:54:31.339573+00:00", 
            "author": "https://api.launchpad.net/1.0/~rohitk"
        }, 
        {
            "content": "Rohit:\n\nare you using the latest code? I have tested that both python-novaclient and python-cinderclient can handle the --os-region-name\noption. when specify the --os-region-name the client can get the endpoints to that region. \n\n\nroot@yaguang-ThinkPad-X230:~/working/openstack/python-novaclient# nova --os-region-name Regiontwo endpoints\n+-------------+-------------------------------------------------------------+\n| nova        | Value                                                       |\n+-------------+-------------------------------------------------------------+\n| adminURL    | http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19 |\n| id          | 9c1ac5fc96a4473ba159a0fb94b92b3b                            |\n| internalURL | http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19 |\n| publicURL   | http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19 |\n| region      | RegionOne                                                   |\n+-------------+-------------------------------------------------------------+\n+-------------+----------------------------------+\n| quantum     | Value                            |\n+-------------+----------------------------------+\n| adminURL    | http://127.0.0.1:9696            |\n| id          | c06bfb948bc846debc5ff44f876f3871 |\n| internalURL | http://127.0.0.1:9696            |\n| publicURL   | http://127.0.0.1:9696            |\n| region      | RegionOne                        |\n+-------------+----------------------------------+\n+-------------+----------------------------------+\n| glance      | Value                            |\n+-------------+----------------------------------+\n| adminURL    | http://localhost:9292/v1         |\n| id          | 7d95ee08e9974694b2193e9bc1259234 |\n| internalURL | http://localhost:9292/v1         |\n| publicURL   | http://localhost:9292/v1         |\n| region      | RegionOne                        |\n+-------------+----------------------------------+\n+-------------+-----------------------------------------------------------+\n| nova-volume | Value                                                     |\n+-------------+-----------------------------------------------------------+\n| adminURL    | http://localhost:8776/v1/f9cd6823327b4ce4b76c68270006fb19 |\n| id          | 7450aa27aae74801a18e53dfcc549148                          |\n| internalURL | http://localhost:8776/v1/f9cd6823327b4ce4b76c68270006fb19 |\n| publicURL   | http://localhost:8776/v1/f9cd6823327b4ce4b76c68270006fb19 |\n| region      | RegionOne                                                 |\n+-------------+-----------------------------------------------------------+\n+-------------+--------------------------------------+\n| ec2         | Value                                |\n+-------------+--------------------------------------+\n| adminURL    | http://localhost:8773/services/Admin |\n| id          | 816b17f4be6c4d329ad804d9c2cef93e     |\n| internalURL | http://localhost:8773/services/Cloud |\n| publicURL   | http://localhost:8773/services/Cloud |\n| region      | RegionOne                            |\n+-------------+--------------------------------------+\n+-------------+----------------------------------+\n| keystone    | Value                            |\n+-------------+----------------------------------+\n| adminURL    | http://localhost:35357/v2.0      |\n| id          | afbd503262f9462192b2077f0f23b940 |\n| internalURL | http://localhost:35357/v2.0      |\n| publicURL   | http://localhost:5000/v2.0       |\n| region      | RegionOne                        |\n+-------------+----------------------------------+\nroot@yaguang-ThinkPad-X230:~/working/openstack/python-novaclient# nova  endpoints\nFound more than one valid endpoint. Use a more restrictive filter\nERROR: AmbiguousEndpoints: [{u'adminURL': u'http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19', u'region': u'RegionOne', u'id': u'9c1ac5fc96a4473ba159a0fb94b92b3b', 'serviceName': u'nova', u'internalURL': u'http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19', u'publicURL': u'http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19'}, {u'adminURL': u'http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19', u'region': u'Regiontwo', u'id': u'9c1ac5fc96a4473ba159a0fb94b92b3c', 'serviceName': u'nova', u'internalURL': u'http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19', u'publicURL': u'http://localhost:8774/v1.1/f9cd6823327b4ce4b76c68270006fb19'}]\n\n\n", 
            "date_created": "2012-12-11 14:51:15.049774+00:00", 
            "author": "https://api.launchpad.net/1.0/~heut2008"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/18048", 
            "date_created": "2012-12-13 15:46:37.587310+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/18048\nCommitted: http://github.com/openstack/nova/commit/4db98faa1c55c6f369ec84ed478338141ad5e7d8\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4db98faa1c55c6f369ec84ed478338141ad5e7d8\nAuthor: Rohit Karajgi <email address hidden>\nDate:   Mon Jan 7 03:22:16 2013 -0800\n\n    Adds a flag to allow configuring a region\n    \n    If multiple regions contain an endpoint, extract\n    the correct endpoint URL from the os_region_name parameter\n    in nova.conf\n    \n    Fixes LP Bug #1087735\n    \n    Change-Id: Id4e4f56f336cd2b092a173b3c8e695b173c76f2a\n", 
            "date_created": "2013-01-15 21:03:16.053429+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}