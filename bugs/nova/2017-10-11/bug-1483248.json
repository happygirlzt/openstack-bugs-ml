{
    "status": "Expired", 
    "last_updated": "2015-11-23 04:22:13.226568+00:00", 
    "description": "unable to start nova-compute service due to netaddr library is not able to resolve the hostname of the VM on which I am installing Openstack(1:2015.1.0-0ubuntu1.1~cloud0). \n\nI have added hostname entry in /etc/hosts file. Glance and Keystone services were able to resolve the hostname and services are running successfully.\n\nBelow is the error which I am getting in nova-compute.log file(server is my hostname)\n\nValueError: failed to detect a valid IP address from u'server'\n\nAfter changing /usr/lib/python2.7/dist-packages/nova/objects/fields.py:340 small code in this file which is like bypassing  the variable value to replace hostname with my ip  then i am able to make sure my compute service is up and running.\n\nclass IPAddress(FieldType):\n    @staticmethod\n    def coerce(obj, attr, value):\n        try:\n            if value == 'server':\n                return 'xx.xx.xx.xx'\n            else:\n                return netaddr.IPAddress(value)\n\nPlease suggest if this is problem with netaddr library version(0.7.12-2~cloud0) or a bug.", 
    "tags": [
        "compute"
    ], 
    "importance": "Undecided", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1483248", 
    "owner": "None", 
    "id": 1483248, 
    "index": 5697, 
    "created": "2015-08-10 13:01:03.648492+00:00", 
    "title": "unable to start compute service Kilo", 
    "comments": [
        {
            "content": "unable to start nova-compute service due to netaddr library is not able to resolve the hostname of the VM on which I am installing Openstack(1:2015.1.0-0ubuntu1.1~cloud0). \n\nI have added hostname entry in /etc/hosts file. Glance and Keystone services were able to resolve the hostname and services are running successfully.\n\nBelow is the error which I am getting in nova-compute.log file(server is my hostname)\n\nValueError: failed to detect a valid IP address from u'server'\n\nAfter changing /usr/lib/python2.7/dist-packages/nova/objects/fields.py:340 small code in this file which is like bypassing  the variable value to replace hostname with my ip  then i am able to make sure my compute service is up and running.\n\nclass IPAddress(FieldType):\n    @staticmethod\n    def coerce(obj, attr, value):\n        try:\n            if value == 'server':\n                return 'xx.xx.xx.xx'\n            else:\n                return netaddr.IPAddress(value)\n\nPlease suggest if this is problem with netaddr library version(0.7.12-2~cloud0) or a bug.", 
            "date_created": "2015-08-10 13:01:03.648492+00:00", 
            "author": "https://api.launchpad.net/1.0/~narasimha18sv"
        }, 
        {
            "content": "not sure glance and other services running, but seems the value 'server' is not correct value to IPAddress\nwhat's the root cause of 'netaddr library is not able to resolve the hostname ' ? maybe we should fix it first? thanks", 
            "date_created": "2015-08-10 14:31:39.744237+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "According to netaddr document, it doesn't support using hostname to construct an IPAddress object:\nhttps://pythonhosted.org/netaddr/introduction.html\n\nI can reproduce this issue with latest nova code.  I agree with jichenjc that we may support hostname at first. ", 
            "date_created": "2015-08-11 05:33:56.214420+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhenzan-zhou"
        }, 
        {
            "content": "@Zhenzan Zhou:\n\nI couldn't reproduce this issue with:\n* Nova: 1dde7509 2015-08-11 Merge \"libvirt: set caps on ma[...]\n* Devstack: 2f605b09 2015-08-10 Merge \"Install cryptsetup on t[...]\n* netaddr version 0.7.15\n* python 2.7\n\nThe unit-tests show, that the value \"server\" is a wrong value for the \"netaddr.IPAddress\" constructor [1]. I agree with jichenjc that we need to know who passes this value down the the constructor. Would you please provide a log with the stacktrace which shows the call chain? I'll put this bug to the status \"incomplete\" until this information is available. Please put it back to \"new\" when you've provided the log.\n\n[1] https://github.com/openstack/nova/blob/2015.1.0/nova/tests/unit/objects/test_fields.py#L176", 
            "date_created": "2015-08-11 11:17:31.749096+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Below is the stacktrace from nova-compute.log file\n____________________________________________________\n2015-05-20 20:29:21.251 18670 ERROR nova.openstack.common.threadgroup [req-583986e8-da4d-40c8-b272-38500f1e7d20 - - - - -] failed to detect a valid IP address from 'server'\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 145, in wait\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     x.wait()\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 175, in wait\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 214, in main\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/service.py\", line 497, in run_service\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     service.start()\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 183, in start\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1291, in pre_start_hook\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6240, in update_available_resource\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/resource_tracker.py\", line 402, in update_available_resource\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     self._update_available_resource(context, resources)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 445, in inner\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/resource_tracker.py\", line 476, in _update_available_resource\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     self._update(context, resources)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/resource_tracker.py\", line 600, in _update\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     self._update_resource_stats(context, values)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/resource_tracker.py\", line 608, in _update_resource_stats\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     context, (self.host, self.nodename), stats)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/scheduler/client/__init__.py\", line 61, in update_resource_stats\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     self.reportclient.update_resource_stats(context, name, stats)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/scheduler/client/__init__.py\", line 37, in __run_method\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     return getattr(self.instance, __name)(*args, **kwargs)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/scheduler/client/report.py\", line 70, in update_resource_stats\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     setattr(compute_node, k, v)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/objects/base.py\", line 77, in setter\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     field_value = field.coerce(self, name, value)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/objects/fields.py\", line 191, in coerce\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     return self._type.coerce(obj, attr, value)\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/objects/fields.py\", line 340, in coerce\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup     raise ValueError(six.text_type(e))\n2015-05-20 20:29:21.251 18670 TRACE nova.openstack.common.threadgroup ValueError: failed to detect a valid IP address from 'server'\n", 
            "date_created": "2015-08-11 11:34:28.104642+00:00", 
            "author": "https://api.launchpad.net/1.0/~narasimha18sv"
        }, 
        {
            "content": "Below is the nova.conf in my setup.\n\n_____________________________\ndhcpbridge_flagfile=/etc/nova/nova.conf\ndhcpbridge=/usr/bin/nova-dhcpbridge\nlogdir=/var/log/nova\nstate_path=/var/lib/nova\nlock_path=/var/lock/nova\nforce_dhcp_release=True\nlibvirt_use_virtio_for_bridges=True\nverbose=True\nec2_private_dns_show_ip=True\napi_paste_config=/etc/nova/api-paste.ini\nenabled_apis=ec2,osapi_compute,metadata\nrpc_backend = rabbit\nauth_strategy = keystone\nmy_ip = xx.xx.xx.xx\nvncserver_listen = 0.0.0.0\nvncserver_proxyclient_address = server\nvnc_enabled = True\nnovncproxy_base_url = http://server:6080/vnc_auto.html\nnetwork_api_class = nova.network.neutronv2.api.API\nsecurity_group_api = neutron\nlinuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver\nfirewall_driver = nova.virt.firewall.NoopFirewallDriver\n\n[glance]\nhost = server\n\n[neutron]\nurl = http://server:9696\nauth_strategy = keystone\nadmin_auth_url = http://server:35357/v2.0\nadmin_tenant_name = service\nadmin_username = neutron\nadmin_password = cloud123\nservice_metadata_proxy = True\nmetadata_proxy_shared_secret = METADATA_SECRET\n\n[database]\nconnection = mysql://nova:cloud123@server/nova\n\n[oslo_concurrency]\nlock_path = /var/lib/nova/tmp\n\n[oslo_messaging_rabbit]\nrabbit_host = server\nrabbit_password = cloud123\nrabbit_port = 5672\n\n[keystone_authtoken]\nauth_uri = http://server:5000\nauth_url = http://server:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = nova\npassword = cloud123\n", 
            "date_created": "2015-08-11 11:35:22.334697+00:00", 
            "author": "https://api.launchpad.net/1.0/~narasimha18sv"
        }, 
        {
            "content": "Installed Openstack Manually by following the steps in \nhttp://docs.openstack.org/kilo/install-guide/install/apt/content/ch_preface.html\n\nI have created a single node installation.", 
            "date_created": "2015-08-11 12:03:07.078675+00:00", 
            "author": "https://api.launchpad.net/1.0/~narasimha18sv"
        }, 
        {
            "content": "Hi..\nNot able to reproduce.So unassigning myself also changed state back to \"New\".\n\nI tried to reproduce this issue following same steps ,http://docs.openstack.org/kilo/install-guide/install/apt/content/ch_preface.html ,  as Narsimha mentioned.\n\nSomebody who will be able to reproduce can take this up to fix.", 
            "date_created": "2015-08-17 07:51:04.635474+00:00", 
            "author": "https://api.launchpad.net/1.0/~choudharyvikas16"
        }, 
        {
            "content": "What is the value of 'server' in your /etc/hosts. The install guide depends on all those values being assigned explicit ips there.", 
            "date_created": "2015-09-23 14:13:51.492569+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2015-11-23 04:22:09.006645+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}