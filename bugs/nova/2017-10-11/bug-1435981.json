{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:27:14.967893+00:00", 
    "description": "When booting a VM with pci devices the PciPassthroughFilter will raise an exception if one of the  hosts doesn't have any assignable pci devices (because pci_stats is set to None on host_state in that case) \n\n\nTraceback (most recent call last):\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_repl\ny\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 142, in inner\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     return func(*args, **kwargs)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/manager.py\", line 86, in select_destinations\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     filter_properties)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/filter_scheduler.py\", line 67, in select_destinations\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     filter_properties)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/filter_scheduler.py\", line 138, in _schedule\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     filter_properties, index=num)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/host_manager.py\", line 451, in get_filtered_hosts\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     hosts, filter_properties, index)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/filters.py\", line 78, in get_filtered_objects\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     list_objs = list(objs)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/filters.py\", line 44, in filter_all\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     if self._filter_one(obj, filter_properties):\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/filters/__init__.py\", line 27, in _filter_one\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     return self.host_passes(obj, filter_properties)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/filters/pci_passthrough_filter.py\", line 48, in host_passes\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     if not host_state.pci_stats.support_requests(pci_requests.requests):\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher AttributeError: 'NoneType' object has no attribute 'support_requests'", 
    "tags": [
        "pci-passthrough"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1435981", 
    "owner": "https://api.launchpad.net/1.0/~james-p-chapman", 
    "id": 1435981, 
    "index": 1703, 
    "created": "2015-03-24 17:23:42.823611+00:00", 
    "title": "PciPassthroughFilter throws exception if host has no pci devices", 
    "comments": [
        {
            "content": "When booting a VM with pci devices the PciPassthroughFilter will raise an exception if one of the  hosts doesn't have any assignable pci devices (because pci_stats is set to None on host_state in that case) \n\n\nTraceback (most recent call last):\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_repl\ny\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 142, in inner\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     return func(*args, **kwargs)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/manager.py\", line 86, in select_destinations\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     filter_properties)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/filter_scheduler.py\", line 67, in select_destinations\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     filter_properties)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/filter_scheduler.py\", line 138, in _schedule\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     filter_properties, index=num)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/host_manager.py\", line 451, in get_filtered_hosts\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     hosts, filter_properties, index)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/filters.py\", line 78, in get_filtered_objects\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     list_objs = list(objs)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/filters.py\", line 44, in filter_all\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     if self._filter_one(obj, filter_properties):\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/filters/__init__.py\", line 27, in _filter_one\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     return self.host_passes(obj, filter_properties)\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher   File \"/shared/stack/nova/nova/scheduler/filters/pci_passthrough_filter.py\", line 48, in host_passes\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher     if not host_state.pci_stats.support_requests(pci_requests.requests):\n2015-03-24 16:51:46.744 TRACE oslo_messaging.rpc.dispatcher AttributeError: 'NoneType' object has no attribute 'support_requests'", 
            "date_created": "2015-03-24 17:23:42.823611+00:00", 
            "author": "https://api.launchpad.net/1.0/~pczesno"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/167817", 
            "date_created": "2015-03-25 22:14:01.311078+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Sounds a good candidate for fixing it in RC1", 
            "date_created": "2015-04-08 15:15:49.831936+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/167817\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=69ec3b6f0ceba5db714e35f6d72d40f14ef51ad3\nSubmitter: Jenkins\nBranch:    master\n\ncommit 69ec3b6f0ceba5db714e35f6d72d40f14ef51ad3\nAuthor: James Chapman <email address hidden>\nDate:   Wed Apr 8 10:31:04 2015 +0100\n\n    Manage compute node that exposes no pci devices\n    \n    Booting a VM with a pci device causes an exception when the host doesnt\n    have any assignable pci devices.\n    If a host doesnt expose any pci devices to nova, its pci_stats are set\n    to None. This causes an exception when the PciPassthroughFilter checks\n    if the host can support the pci requests.\n    \n    Closes-Bug: #1435981\n    Change-Id: Ia9fbec9c7a3afa9b7ea73c43b21db0909a195a36\n", 
            "date_created": "2015-04-09 05:57:47.851353+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}