{
    "status": "Fix Released", 
    "last_updated": "2012-04-24 15:06:51.656255+00:00", 
    "description": "When starting nova-network on the oneiric package from the ubuntu archive, it refuses to start:\n\n2011-07-14 15:32:05,841 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig set_name_type VLAN_PLUS_VID_NO_PAD from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-07-14 15:32:05,880 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig add None 100 from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-07-14 15:32:05,981 DEBUG nova.utils [-] Result was 3 from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:161\n2011-07-14 15:32:05,983 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 87, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 334, in run_instance\n(nova.exception): TRACE:     self._run_instance(context, instance_id, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 297, in _run_instance\n(nova.exception): TRACE:     instance_id)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/manager.py\", line 827, in setup_compute_network\n(nova.exception): TRACE:     network['bridge_interface'])\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 456, in ensure_vlan_bridge\n(nova.exception): TRACE:     interface = ensure_vlan(vlan_num, bridge_interface)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/utils.py\", line 613, in inner\n(nova.exception): TRACE:     retval = f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 467, in ensure_vlan\n(nova.exception): TRACE:     _execute('sudo', 'vconfig', 'add', bridge_interface, vlan_num)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 689, in _execute\n(nova.exception): TRACE:     return utils.execute(*cmd, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/utils.py\", line 169, in execute\n(nova.exception): TRACE:     cmd=' '.join(cmd))\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: sudo vconfig add None 100\n(nova.exception): TRACE: Exit code: 3\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:None:-  error: No such device\\n'\n(nova.exception): TRACE: \n2011-07-14 15:32:05,985 ERROR nova [-] Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/rpc.py\", line 232, in _process_data\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 93, in _wrap\n(nova): TRACE:     raise Error(str(e))\n(nova): TRACE: Error: Unexpected error while running command.\n(nova): TRACE: Command: sudo vconfig add None 100\n(nova): TRACE: Exit code: 3\n(nova): TRACE: Stdout: ''\n(nova): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:None:-  error: No such device\\n'\n(nova): TRACE:", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 40, 
    "link": "https://bugs.launchpad.net/nova/+bug/810563", 
    "owner": "https://api.launchpad.net/1.0/~tr3buchet", 
    "id": 810563, 
    "index": 2459, 
    "created": "2011-07-14 16:05:31.052240+00:00", 
    "title": "nova-manage lets you create broken networks (was: trying to add VLAN #100 to IF -:None:- error: No such device)", 
    "comments": [
        {
            "content": "When starting nova-network on the oneiric package from the ubuntu archive, it refuses to start:\n\n2011-07-14 15:32:05,841 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig set_name_type VLAN_PLUS_VID_NO_PAD from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-07-14 15:32:05,880 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig add None 100 from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-07-14 15:32:05,981 DEBUG nova.utils [-] Result was 3 from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:161\n2011-07-14 15:32:05,983 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 87, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 334, in run_instance\n(nova.exception): TRACE:     self._run_instance(context, instance_id, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 297, in _run_instance\n(nova.exception): TRACE:     instance_id)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/manager.py\", line 827, in setup_compute_network\n(nova.exception): TRACE:     network['bridge_interface'])\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 456, in ensure_vlan_bridge\n(nova.exception): TRACE:     interface = ensure_vlan(vlan_num, bridge_interface)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/utils.py\", line 613, in inner\n(nova.exception): TRACE:     retval = f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 467, in ensure_vlan\n(nova.exception): TRACE:     _execute('sudo', 'vconfig', 'add', bridge_interface, vlan_num)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 689, in _execute\n(nova.exception): TRACE:     return utils.execute(*cmd, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/utils.py\", line 169, in execute\n(nova.exception): TRACE:     cmd=' '.join(cmd))\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: sudo vconfig add None 100\n(nova.exception): TRACE: Exit code: 3\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:None:-  error: No such device\\n'\n(nova.exception): TRACE: \n2011-07-14 15:32:05,985 ERROR nova [-] Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/rpc.py\", line 232, in _process_data\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 93, in _wrap\n(nova): TRACE:     raise Error(str(e))\n(nova): TRACE: Error: Unexpected error while running command.\n(nova): TRACE: Command: sudo vconfig add None 100\n(nova): TRACE: Exit code: 3\n(nova): TRACE: Stdout: ''\n(nova): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:None:-  error: No such device\\n'\n(nova): TRACE:", 
            "date_created": "2011-07-14 16:05:31.052240+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "I believe I also see this issue in Natty:\nnova-compute                    2011.3~d3~20110716.1281-0ubuntu0ppa1~natty1", 
            "date_created": "2011-07-18 20:55:08.873485+00:00", 
            "author": "https://api.launchpad.net/1.0/~jsalisbury"
        }, 
        {
            "content": "I wonder if this is an upgrade issue. Does this also affect new installs (i.e. if you start from a clean DB) ?", 
            "date_created": "2011-07-22 13:19:12.272924+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Workaround: run \"sudo vconfig add br100 100\"", 
            "date_created": "2011-07-22 13:21:10.122455+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "This happens on new installs as well.", 
            "date_created": "2011-07-22 14:26:37.502593+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "You have to start an instance on a fresh setup to hit ensure_vlan and the issue. Then, on subsequent startups, it will hit the issue. Investigating a bit more.", 
            "date_created": "2011-07-25 13:02:07.831888+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "The issue is that bridge_interface is None by default ({vlan,flat}_interface flag is None by default and nova-manage uses flag if you don't specify a bridge interface when creating network).\n\nThen ensure_vlan_bridge (and ensure_vlan) happily try to use \"None\" as the bridge interface name.", 
            "date_created": "2011-07-25 13:25:06.310141+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "This looks to me like a configuration issue. When networks are created, the physical interface for the created bridges (bridge_interface) needs to be specified. The problem is that without being able to create the bridge to connect to, the network host would be useless, so I don't think catching this error and moving on is a good solution.\n\nI also don't think updating flags is a solution to this. After multi-nic we shouldn't be using that flag anymore. I left it there as a sortof deprecated feature to be backwards compatible.\n\nTake a look at the arguments to nova-manage create network. \"bridge_interface\" must be specified if using FlatDHCP or Vlan network managers.", 
            "date_created": "2011-07-25 15:27:19.441596+00:00", 
            "author": "https://api.launchpad.net/1.0/~tr3buchet"
        }, 
        {
            "content": "<ttx> tr3buchet: currently nova-manage lets you create broken networks, maybe that's the issue\r\n<ttx> tr3buchet: and our docs also advise to just run \"sudo nova-manage network create novanetwork 10.0.0.0/8 1 64\"\r\n<ttx> If there is no sane default now, we should make it mandatory in nova-manage, and update doc ?", 
            "date_created": "2011-07-25 15:37:21.225323+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Vish I have the same Issue after upgrading to D4 from ppa on ubuntu 11.04 my nova-network pack is version:\n\n\n dpkg -l | grep nova-network\nii  nova-network                    2011.3~d4-0ubuntu0~ppa1~natty1              OpenStack Compute - Network manager\n\nCan you please advice what I can do in order to fix this issue ?", 
            "date_created": "2011-09-16 23:00:45.014990+00:00", 
            "author": "https://api.launchpad.net/1.0/~bnight"
        }, 
        {
            "content": "it should default to br100 with a warning when you create networks.  It won't automatically fix existing networks for you though.  You will need to recreate them or manually add a bridge in the db.\n\nVish\n\nOn Sep 16, 2011, at 4:00 PM, bnight wrote:\n\n> Vish I have the same Issue after upgrading to D4 from ppa on ubuntu\n> 11.04 my nova-network pack is version:\n> \n> \n> dpkg -l | grep nova-network\n> ii  nova-network                    2011.3~d4-0ubuntu0~ppa1~natty1              OpenStack Compute - Network manager\n> \n> Can you please advice what I can do in order to fix this issue ?\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/810563\n> \n> Title:\n>  nova-manage lets you create broken networks (was: trying to add VLAN\n>  #100 to IF -:None:- error: No such device)\n> \n> Status in OpenStack Compute (Nova):\n>  Fix Committed\n> \n> Bug description:\n>  When starting nova-network on the oneiric package from the ubuntu\n>  archive, it refuses to start:\n> \n>  2011-07-14 15:32:05,841 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig set_name_type VLAN_PLUS_VID_NO_PAD from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n>  2011-07-14 15:32:05,880 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig add None 100 from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n>  2011-07-14 15:32:05,981 DEBUG nova.utils [-] Result was 3 from (pid=22131) execute /usr/lib/pymodules/python2.7/nova/utils.py:161\n>  2011-07-14 15:32:05,983 ERROR nova.exception [-] Uncaught exception\n>  (nova.exception): TRACE: Traceback (most recent call last):\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 87, in _wrap\n>  (nova.exception): TRACE:     return f(*args, **kw)\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 334, in run_instance\n>  (nova.exception): TRACE:     self._run_instance(context, instance_id, **kwargs)\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 297, in _run_instance\n>  (nova.exception): TRACE:     instance_id)\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/manager.py\", line 827, in setup_compute_network\n>  (nova.exception): TRACE:     network['bridge_interface'])\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 456, in ensure_vlan_bridge\n>  (nova.exception): TRACE:     interface = ensure_vlan(vlan_num, bridge_interface)\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/utils.py\", line 613, in inner\n>  (nova.exception): TRACE:     retval = f(*args, **kwargs)\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 467, in ensure_vlan\n>  (nova.exception): TRACE:     _execute('sudo', 'vconfig', 'add', bridge_interface, vlan_num)\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/network/linux_net.py\", line 689, in _execute\n>  (nova.exception): TRACE:     return utils.execute(*cmd, **kwargs)\n>  (nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/utils.py\", line 169, in execute\n>  (nova.exception): TRACE:     cmd=' '.join(cmd))\n>  (nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n>  (nova.exception): TRACE: Command: sudo vconfig add None 100\n>  (nova.exception): TRACE: Exit code: 3\n>  (nova.exception): TRACE: Stdout: ''\n>  (nova.exception): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:None:-  error: No such device\\n'\n>  (nova.exception): TRACE: \n>  2011-07-14 15:32:05,985 ERROR nova [-] Exception during message handling\n>  (nova): TRACE: Traceback (most recent call last):\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/rpc.py\", line 232, in _process_data\n>  (nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 93, in _wrap\n>  (nova): TRACE:     raise Error(str(e))\n>  (nova): TRACE: Error: Unexpected error while running command.\n>  (nova): TRACE: Command: sudo vconfig add None 100\n>  (nova): TRACE: Exit code: 3\n>  (nova): TRACE: Stdout: ''\n>  (nova): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:None:-  error: No such device\\n'\n>  (nova): TRACE:\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/810563/+subscriptions\n\n", 
            "date_created": "2011-09-17 02:33:05+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ]
}