{
    "status": "Fix Released", 
    "last_updated": "2017-09-22 16:22:44.453612+00:00", 
    "description": "[0] removed options [vnc]vncserver_proxyclient_address and [vnc]vncserver_listen without a deprecation period.  Lemme splain:\n\nTake for example vncserver_proxyclient_address.  It was originally [DEFAULT]vncserver_proxyclient_address.  That was moved to [vnc]vncserver_proxyclient_address via [1].  We've had a nice long deprecation period (~18mo) during which either of those would work.  So it would be reasonable at this time to remove support for [DEFAULT]vncserver_proxyclient_address.  But by renaming the option without changing its deprecated_group to `vnc`, we've instead *left* support for [DEFAULT]vncserver_proxyclient_address while *removing* support for the newer [vnc]vncserver_proxyclient_address without a deprecation period.\n\nI noticed this when running tox against nova-powervm with the latest nova.  nova-powervm paid attention to the deprecation and switched over to [vnc]vncserver_proxyclient_address.  Now it fails a test with:\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/mock/mock.py\", line 1305, in patched\n        return func(*args, **keywargs)\n      File \"nova_powervm/tests/virt/powervm/test_driver.py\", line 1666, in test_get_vnc_console\n        resp = self.drv.get_vnc_console(mock.ANY, self.inst)\n      File \"nova_powervm/virt/powervm/driver.py\", line 1727, in get_vnc_console\n        host = CONF.vnc.vncserver_proxyclient_address\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/oslo_config/cfg.py\", line 3363, in __getattr__\n        return self._conf._get(name, self._group)\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/oslo_config/cfg.py\", line 2925, in _get\n        value = self._do_get(name, group, namespace)\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/oslo_config/cfg.py\", line 2942, in _do_get\n        info = self._get_opt_info(name, group)\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/oslo_config/cfg.py\", line 3099, in _get_opt_info\n        raise NoSuchOptError(opt_name, group)\n    oslo_config.cfg.NoSuchOptError: no such option vncserver_proxyclient_address in group [vnc]\n\nBut anyone should be able to repro by spinning up compute with [vnc]vncserver_proxyclient_address and trying to open a console.\n\n[0] https://review.openstack.org/#/c/498387/\n[1] https://review.openstack.org/#/c/263763/", 
    "tags": [
        "config"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1718545", 
    "owner": "https://api.launchpad.net/1.0/~stephenfinucane", 
    "id": 1718545, 
    "index": 2153, 
    "created": "2017-09-20 21:58:04.699813+00:00", 
    "title": "[vnc]vncserver_proxyclient_address and [vnc]vncserver_listen removed without deprecation", 
    "comments": [
        {
            "content": "[0] removed options [vnc]vncserver_proxyclient_address and [vnc]vncserver_listen without a deprecation period.  Lemme splain:\n\nTake for example vncserver_proxyclient_address.  It was originally [DEFAULT]vncserver_proxyclient_address.  That was moved to [vnc]vncserver_proxyclient_address via [1].  We've had a nice long deprecation period (~18mo) during which either of those would work.  So it would be reasonable at this time to remove support for [DEFAULT]vncserver_proxyclient_address.  But by renaming the option without changing its deprecated_group to `vnc`, we've instead *left* support for [DEFAULT]vncserver_proxyclient_address while *removing* support for the newer [vnc]vncserver_proxyclient_address without a deprecation period.\n\nI noticed this when running tox against nova-powervm with the latest nova.  nova-powervm paid attention to the deprecation and switched over to [vnc]vncserver_proxyclient_address.  Now it fails a test with:\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/mock/mock.py\", line 1305, in patched\n        return func(*args, **keywargs)\n      File \"nova_powervm/tests/virt/powervm/test_driver.py\", line 1666, in test_get_vnc_console\n        resp = self.drv.get_vnc_console(mock.ANY, self.inst)\n      File \"nova_powervm/virt/powervm/driver.py\", line 1727, in get_vnc_console\n        host = CONF.vnc.vncserver_proxyclient_address\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/oslo_config/cfg.py\", line 3363, in __getattr__\n        return self._conf._get(name, self._group)\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/oslo_config/cfg.py\", line 2925, in _get\n        value = self._do_get(name, group, namespace)\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/oslo_config/cfg.py\", line 2942, in _do_get\n        info = self._get_opt_info(name, group)\n      File \"/home/efried/Neo/nova-powervm/.tox/py27/local/lib/python2.7/site-packages/oslo_config/cfg.py\", line 3099, in _get_opt_info\n        raise NoSuchOptError(opt_name, group)\n    oslo_config.cfg.NoSuchOptError: no such option vncserver_proxyclient_address in group [vnc]\n\nBut anyone should be able to repro by spinning up compute with [vnc]vncserver_proxyclient_address and trying to open a console.\n\n[0] https://review.openstack.org/#/c/498387/\n[1] https://review.openstack.org/#/c/263763/", 
            "date_created": "2017-09-20 21:58:04.699813+00:00", 
            "author": "https://api.launchpad.net/1.0/~efried"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/505831", 
            "date_created": "2017-09-20 22:12:22.344368+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/505843", 
            "date_created": "2017-09-20 22:43:47.587912+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/505831\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9d4c792ac986fae13d8fff1f2de7ee198f4de450\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9d4c792ac986fae13d8fff1f2de7ee198f4de450\nAuthor: Eric Fried <email address hidden>\nDate:   Wed Sep 20 17:07:53 2017 -0500\n\n    Restore '[vnc] vnc_*' option support\n    \n    Changing an option's name when the option's group has been changed in a\n    previous release results in retained support for only the original\n    group-name combination and not the intermediate combination.\n    \n    This behavior can be seen in change Ic05c2c836, which effectively\n    removed support for the options '[vnc] vncserver_proxyclient_address'\n    and '[vnc] vncserver_listen' without a deprecation period.\n    \n    Re-add this support by using the 'deprecated_opts' parameter, which\n    clearly _is_ still useful [1].\n    \n    [1] https://review.openstack.org/#/c/364260/\n    \n    Change-Id: I6405a8024b2bb4df067325b3335008865fd4fdf2\n    Co-Authored-By: Stephen Finucane <email address hidden>\n    Closes-Bug: #1718545\n", 
            "date_created": "2017-09-21 16:33:17.298301+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/505843\nCommitted: https://git.openstack.org/cgit/openstack/nova-powervm/commit/?id=5f3b641ce28b20b0a0e3c8bc57dd5f64c9ef0805\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5f3b641ce28b20b0a0e3c8bc57dd5f64c9ef0805\nAuthor: Eric Fried <email address hidden>\nDate:   Wed Sep 20 17:40:48 2017 -0500\n\n    Rename [vnc]vncserver_proxyclient_address\n    \n    Change [1] renamed [vnc]vncserver_proxyclient_address to\n    [vnc]server_proxyclient_address without deprecating the former.  The\n    deprecation snafu is being addressed via [2]; but we'll need to move to\n    the new name anyway.  No time like the present.\n    \n    [1] https://review.openstack.org/498387\n    [2] https://review.openstack.org/505831\n    \n    Change-Id: Iac3113639cb30289b7f3dcdd6843af8602de1115\n    Related-Bug: #1718545\n", 
            "date_created": "2017-09-22 15:55:50.654255+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}