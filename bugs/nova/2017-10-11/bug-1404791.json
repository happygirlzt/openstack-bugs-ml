{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:23:48.129936+00:00", 
    "description": "can not delete an instance if the instance's rescue lvm can not be found.\n\nhow to reproduce:\n\n1.  configure images_type lvm for libvirt dirver.\n[libvirt]\nimages_type = lvm <---- \nimages_volume_group = stack-volumes-lvmdriver-1 <-- lvm used\n\n2. rescue the instance, will generate uuid.rescue lvm\n3. unrescue the instance, the rescue lvm can not be deleted due to bug   https://bugs.launchpad.net/nova/+bug/1385480\n4. delete the uuid.rescue lvm manually.\n5. delete the instance(failed and set to error state)\n\nbelow is the call trace of nova-compute driver.\n\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     self._cleanup_lvm(instance)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 944, in _cleanup_lvm\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     lvm.remove_volumes(disks)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/lvm.py\", line 272, in remove_volumes\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     clear_volume(path)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/lvm.py\", line 250, in clear_volume\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     volume_size = get_volume_size(path)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/lvm.py\", line 66, in decorated_function\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     return function(path)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/lvm.py\", line 197, in get_volume_size\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     run_as_root=True)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 53, in execute\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     return utils.execute(*args, **kwargs)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/utils.py\", line 164, in execute\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     return processutils.execute(*cmd, **kwargs)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     cmd=sanitized_cmd)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher ProcessExecutionError: Unexpected error while running command.\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher Command: sudo nova-rootwrap /etc/nova/rootwrap.conf blockdev --getsize64 /dev/stack-volumes-lvmdriver-1/b09687ee-f525-4edc-aaf4-1272562d46fd_disk.rescue\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher Exit code: 1\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher Stdout: u''\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher Stderr: u'blockdev: cannot open /dev/stack-volumes-lvmdriver-1/b09687ee-f525-4edc-aaf4-1272562d46fd_disk.rescue: No such file or directory\\n'\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1404791", 
    "owner": "https://api.launchpad.net/1.0/~alexisl", 
    "id": 1404791, 
    "index": 200, 
    "created": "2014-12-22 05:24:40.728376+00:00", 
    "title": "can not delete an instance if the instance's rescue volume is not found", 
    "comments": [
        {
            "content": "can not delete an instance if the instance's rescue lvm can not be found.\n\nhow to reproduce:\n\n1.  configure images_type lvm for libvirt dirver.\n[libvirt]\nimages_type = lvm <---- \nimages_volume_group = stack-volumes-lvmdriver-1 <-- lvm used\n\n2. rescue the instance, will generate uuid.rescue lvm\n3. unrescue the instance, the rescue lvm can not be deleted due to bug   https://bugs.launchpad.net/nova/+bug/1385480\n4. delete the uuid.rescue lvm manually.\n5. delete the instance(failed and set to error state)\n\nbelow is the call trace of nova-compute driver.\n\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     self._cleanup_lvm(instance)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 944, in _cleanup_lvm\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     lvm.remove_volumes(disks)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/lvm.py\", line 272, in remove_volumes\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     clear_volume(path)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/lvm.py\", line 250, in clear_volume\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     volume_size = get_volume_size(path)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/lvm.py\", line 66, in decorated_function\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     return function(path)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/lvm.py\", line 197, in get_volume_size\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     run_as_root=True)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 53, in execute\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     return utils.execute(*args, **kwargs)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/utils.py\", line 164, in execute\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     return processutils.execute(*cmd, **kwargs)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher     cmd=sanitized_cmd)\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher ProcessExecutionError: Unexpected error while running command.\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher Command: sudo nova-rootwrap /etc/nova/rootwrap.conf blockdev --getsize64 /dev/stack-volumes-lvmdriver-1/b09687ee-f525-4edc-aaf4-1272562d46fd_disk.rescue\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher Exit code: 1\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher Stdout: u''\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher Stderr: u'blockdev: cannot open /dev/stack-volumes-lvmdriver-1/b09687ee-f525-4edc-aaf4-1272562d46fd_disk.rescue: No such file or directory\\n'\n2014-12-22 13:18:29.691 TRACE oslo.messaging.rpc.dispatcher", 
            "date_created": "2014-12-22 05:24:40.728376+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "beside , in this case the error instance can not be deleted any more.", 
            "date_created": "2014-12-22 05:36:01.083096+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/143374", 
            "date_created": "2014-12-22 06:40:23.446986+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/143374\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=11fb3936a1ad01af2a96a4eb4c00d1b158bd6f40\nSubmitter: Jenkins\nBranch:    master\n\ncommit 11fb3936a1ad01af2a96a4eb4c00d1b158bd6f40\nAuthor: Eli Qiao <email address hidden>\nDate:   Mon Feb 16 11:23:42 2015 +0800\n\n    Libvirt: Allow missing volumes during delete\n    \n    When deleting an instance, libvirt driver will clear all the volumes\n    of the instance. Ignore exception when clearing a missing volume\n    to avoid delete instance error.\n    \n    Closes-Bug: 1404791\n    Change-Id: I8a663e8f0396bf2303642610ae1001c330159b75\n", 
            "date_created": "2015-02-24 17:23:33.226638+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}