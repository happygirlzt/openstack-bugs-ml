{
    "status": "Fix Released", 
    "last_updated": "2017-06-08 21:52:47.701966+00:00", 
    "description": "Seen here:\n\nhttp://logs.openstack.org/48/461448/1/check/gate-tempest-dsvm-multinode-live-migration-ubuntu-xenial/a3f4426/logs/screen-n-cpu.txt.gz?level=TRACE#_May_01_22_15_43_039605\n\nMay 01 22:15:43.039605 ubuntu-xenial-2-node-osic-cloud1-s3500-8668392 nova-compute[22173]: ERROR oslo_messaging.rpc.server [req-233741a8-bb50-4bf6-a9ec-6c67e6360d39 tempest-LiveBlockMigrationTestJSON-978755190 tempest-LiveBlockMigrationTestJSON-978755190] Exception during message handling\n                                                                                           ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 157, in _process_incoming\n                                                                                           ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n                                                                                           ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n                                                                                           ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/exception_wrapper.py\", line 77, in wrapped\n                                                                                           ERROR oslo_messaging.rpc.server     function_name, call_dict, binary)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n                                                                                           ERROR oslo_messaging.rpc.server     self.force_reraise()\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n                                                                                           ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/exception_wrapper.py\", line 68, in wrapped\n                                                                                           ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/utils.py\", line 660, in decorated_function\n                                                                                           ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 215, in decorated_function\n                                                                                           ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n                                                                                           ERROR oslo_messaging.rpc.server     self.force_reraise()\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n                                                                                           ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 203, in decorated_function\n                                                                                           ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 5178, in check_can_live_migrate_destination\n                                                                                           ERROR oslo_messaging.rpc.server     disk_over_commit)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 5194, in _do_check_can_live_migrate_destination\n                                                                                           ERROR oslo_messaging.rpc.server     dest_check_data)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/rpcapi.py\", line 478, in check_can_live_migrate_source\n                                                                                           ERROR oslo_messaging.rpc.server     dest_check_data=dest_check_data)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 169, in call\n                                                                                           ERROR oslo_messaging.rpc.server     retry=self.retry)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 98, in _send\n                                                                                           ERROR oslo_messaging.rpc.server     timeout=timeout, retry=retry)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 505, in send\n                                                                                           ERROR oslo_messaging.rpc.server     retry=retry)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 496, in _send\n                                                                                           ERROR oslo_messaging.rpc.server     raise result\n                                                                                           ERROR oslo_messaging.rpc.server InvalidSharedStorage_Remote: ubuntu-xenial-2-node-osic-cloud1-s3500-8668392-565309 is not on shared storage: Live migration can not be used without shared storage except a booted from volume VM which does not have a local disk.\n\n\nLooks like this just started today (5/1):\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22is%20not%20on%20shared%20storage%3A%20Live%20migration%20can%20not%20be%20used%20without%20shared%20storage%20except%20a%20booted%20from%20volume%20VM%20which%20does%20not%20have%20a%20local%20disk%5C%22%20AND%20tags%3A%5C%22screen-n-cpu.txt%5C%22&from=7d", 
    "tags": [
        "ceph", 
        "live-migration"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1687511", 
    "owner": "https://api.launchpad.net/1.0/~sdague", 
    "id": 1687511, 
    "index": 2073, 
    "created": "2017-05-02 01:00:43.653217+00:00", 
    "title": "live migration job blowing up with 'InvalidSharedStorage: ubuntu-xenial-2-node-osic-cloud1-s3500-8668392-565309 is not on shared storage: Live migration can not be used without shared storage except a booted from volume VM which does not have a local disk.'", 
    "comments": [
        {
            "content": "Seen here:\n\nhttp://logs.openstack.org/48/461448/1/check/gate-tempest-dsvm-multinode-live-migration-ubuntu-xenial/a3f4426/logs/screen-n-cpu.txt.gz?level=TRACE#_May_01_22_15_43_039605\n\nMay 01 22:15:43.039605 ubuntu-xenial-2-node-osic-cloud1-s3500-8668392 nova-compute[22173]: ERROR oslo_messaging.rpc.server [req-233741a8-bb50-4bf6-a9ec-6c67e6360d39 tempest-LiveBlockMigrationTestJSON-978755190 tempest-LiveBlockMigrationTestJSON-978755190] Exception during message handling\n                                                                                           ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 157, in _process_incoming\n                                                                                           ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n                                                                                           ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n                                                                                           ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/exception_wrapper.py\", line 77, in wrapped\n                                                                                           ERROR oslo_messaging.rpc.server     function_name, call_dict, binary)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n                                                                                           ERROR oslo_messaging.rpc.server     self.force_reraise()\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n                                                                                           ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/exception_wrapper.py\", line 68, in wrapped\n                                                                                           ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/utils.py\", line 660, in decorated_function\n                                                                                           ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 215, in decorated_function\n                                                                                           ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n                                                                                           ERROR oslo_messaging.rpc.server     self.force_reraise()\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n                                                                                           ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 203, in decorated_function\n                                                                                           ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 5178, in check_can_live_migrate_destination\n                                                                                           ERROR oslo_messaging.rpc.server     disk_over_commit)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 5194, in _do_check_can_live_migrate_destination\n                                                                                           ERROR oslo_messaging.rpc.server     dest_check_data)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/compute/rpcapi.py\", line 478, in check_can_live_migrate_source\n                                                                                           ERROR oslo_messaging.rpc.server     dest_check_data=dest_check_data)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 169, in call\n                                                                                           ERROR oslo_messaging.rpc.server     retry=self.retry)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 98, in _send\n                                                                                           ERROR oslo_messaging.rpc.server     timeout=timeout, retry=retry)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 505, in send\n                                                                                           ERROR oslo_messaging.rpc.server     retry=retry)\n                                                                                           ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 496, in _send\n                                                                                           ERROR oslo_messaging.rpc.server     raise result\n                                                                                           ERROR oslo_messaging.rpc.server InvalidSharedStorage_Remote: ubuntu-xenial-2-node-osic-cloud1-s3500-8668392-565309 is not on shared storage: Live migration can not be used without shared storage except a booted from volume VM which does not have a local disk.\n\n\nLooks like this just started today (5/1):\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22is%20not%20on%20shared%20storage%3A%20Live%20migration%20can%20not%20be%20used%20without%20shared%20storage%20except%20a%20booted%20from%20volume%20VM%20which%20does%20not%20have%20a%20local%20disk%5C%22%20AND%20tags%3A%5C%22screen-n-cpu.txt%5C%22&from=7d", 
            "date_created": "2017-05-02 01:00:43.653217+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "The non-shared storage live migration test run is passing. Things fail when running against ceph, which starts the setup here:\n\nhttp://logs.openstack.org/48/461448/1/check/gate-tempest-dsvm-multinode-live-migration-ubuntu-xenial/a3f4426/console.html#_2017-05-01_22_14_21_133356", 
            "date_created": "2017-05-02 13:59:09.396390+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "My guess is the switch to systemd in devstack yesterday broke something in the ceph job:\n\nhttps://review.openstack.org/#/c/460062/", 
            "date_created": "2017-05-02 14:01:58.735221+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Yeah it's definitely something with using systemd now, which the in-tree ceph setup scripts aren't setup to handle for the live migration job. So we might need to disable those temporarily and then fix them to work with systemd, since I think USE_SCREEN in devstack is going away, but that's another temporary alternative.", 
            "date_created": "2017-05-02 14:12:36.731703+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/461801", 
            "date_created": "2017-05-02 14:16:13.925973+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "https://review.openstack.org/#/c/461803/", 
            "date_created": "2017-05-02 14:28:15.386917+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Change abandoned by Matt Riedemann (<email address hidden>) on branch: master\nReview: https://review.openstack.org/461801\nReason: https://review.openstack.org/#/c/461803/ works.", 
            "date_created": "2017-05-02 15:09:52.208689+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/461803\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e59eee6db5876fa86954f1cab10c667c80f35763\nSubmitter: Jenkins\nBranch:    master\n\ncommit e59eee6db5876fa86954f1cab10c667c80f35763\nAuthor: Sean Dague <email address hidden>\nDate:   Tue May 2 10:16:51 2017 -0400\n\n    Use systemctl to restart services\n    \n    The restart code for the live migration configure on the fly tests was\n    really really fragile clippings of old bits of devstack code that\n    barely worked (and assumed a very specific run environment).\n    \n    Given that we're going to get rid of everything other than systemd in\n    devstack, just jump straight to using systemd primitives here. This\n    dramatically simplifies the code, and will ensure things actually\n    restart correctly.\n    \n    Closes-Bug: #1687511\n    \n    Change-Id: I914430d68f64d29932c9409d055b15e4cb384ec4\n", 
            "date_created": "2017-05-02 16:07:03.800954+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/465766", 
            "date_created": "2017-05-17 23:47:27.935353+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Matt Riedemann (<email address hidden>) on branch: stable/ocata\nReview: https://review.openstack.org/465766\nReason: We don't need this in ocata since we don't run systemd in newton or ocata.", 
            "date_created": "2017-05-18 14:09:06.561903+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b2 development milestone.", 
            "date_created": "2017-06-08 21:52:47.435997+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}