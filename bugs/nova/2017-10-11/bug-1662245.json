{
    "status": "Invalid", 
    "last_updated": "2017-02-07 09:26:48.248918+00:00", 
    "description": "Description\n===========\nRunning Mitaka installed on Ubuntu 14.04 (upgraded from Juno all the way to Mitaka). The dashboard reports success even though no snapshot is created.\n\n\nSteps to reproduce\n==================\nTake snapshot using dashboard or the Openstack client.\n \nExpected result\n===============\nNew snapshot gets created, image registered in Glance.\n\nActual result\n=============\nDashboard reports success right away, the image shows up in the images tab in Dashboard shortly before changing status to \"Deleted\" and disappearing.\n\nThe following message gets logged in \"/var/log/nova/nova-compute.log\".\n\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher [req-81b0372a-b2d4-4e30-b0bf-1f54de71f7d9 1344234bf2e54520bbcc9585e442ce78 2fb7b98d74134a37b9fba88856f60b78 - - -] Exception during message handling: internal error: unable to execute QEMU command 'migrate': Migration disabled: failed to allocate shared memory\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     incoming.message))\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 185, in _dispatch\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 110, in wrapped\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     payload)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 89, in wrapped\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 359, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance=instance)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 328, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 387, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 375, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 435, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     instance=instance)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 425, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3158, in snapshot_instance\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     task_states.IMAGE_SNAPSHOT)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3188, in _snapshot_instance\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     update_task_state)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1667, in snapshot\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     instance)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1760, in _prepare_domain_for_snapshot\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.suspend(context, instance)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2649, in suspend\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     guest.save_memory_state()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/guest.py\", line 379, in save_memory_state\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self._domain.managedSave(0)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 186, in doit\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 144, in proxy_call\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     rv = execute(f, *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 125, in execute\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(c, e, tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 83, in tworker\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     rv = meth(*args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 1403, in managedSave\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     if ret == -1: raise libvirtError ('virDomainManagedSave() failed', dom=self)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher libvirtError: internal error: unable to execute QEMU command 'migrate': Migration disabled: failed to allocate shared memory\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher\n\n\nEnvironment\n===========\n\nroot@compute9-r2:~# dpkg -l | egrep \"qemu|libvirt|kvm|nova\"\nii  ipxe-qemu                             1.0.0+git-20131111.c3d1e78-2ubuntu1.1 all          PXE boot firmware - ROM images for qemu\nii  libvirt-bin                           1.3.1-1ubuntu10.6~cloud0              amd64        programs for the libvirt library\nii  libvirt0:amd64                        1.3.1-1ubuntu10.6~cloud0              amd64        library for interfacing with different virtualization systems\nii  nova-common                           2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute - common files\nii  nova-compute                          2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute - compute node base\nii  nova-compute-kvm                      2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                  2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute - compute node libvirt support\nii  python-libvirt                        1.3.1-1ubuntu1~cloud0                 amd64        libvirt Python bindings\nii  python-nova                           2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute Python libraries\nii  python-novaclient                     2:3.3.1-2ubuntu1~cloud0               all          client library for OpenStack Compute API - Python 2.7\nii  qemu-block-extra:amd64                1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        extra block backend modules for qemu-system and qemu-utils\nii  qemu-slof                             20151103+dfsg-1ubuntu1~cloud0         all          Slimline Open Firmware -- QEMU PowerPC version\nii  qemu-system                           1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries\nii  qemu-system-arm                       1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (arm)\nii  qemu-system-common                    1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (common files)\nii  qemu-system-mips                      1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (mips)\nii  qemu-system-misc                      1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (miscelaneous)\nii  qemu-system-ppc                       1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (ppc)\nii  qemu-system-sparc                     1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (sparc)\nii  qemu-system-x86                       1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (x86)\nii  qemu-utils                            1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU utilities\n\n\n\n\nResearching the error message I found https://bugs.launchpad.net/fuel/+bug/1638269.\n\nAfter I applied the patch https://review.fuel-infra.org/#/c/28086/2/debian/apparmor/libvirt-qemu and restarting the instance, the snapshot is working fine.\n\n\nI'm not sure if this bug should be recorded with Nova or Ubuntu..\n\nThank you.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1662245", 
    "owner": "None", 
    "id": 1662245, 
    "index": 6661, 
    "created": "2017-02-06 16:49:33.119614+00:00", 
    "title": "Snapshoting fails in Mitaka", 
    "comments": [
        {
            "content": "Description\n===========\nRunning Mitaka installed on Ubuntu 14.04 (upgraded from Juno all the way to Mitaka). The dashboard reports success even though no snapshot is created.\n\n\nSteps to reproduce\n==================\nTake snapshot using dashboard or the Openstack client.\n \nExpected result\n===============\nNew snapshot gets created, image registered in Glance.\n\nActual result\n=============\nDashboard reports success right away, the image shows up in the images tab in Dashboard shortly before changing status to \"Deleted\" and disappearing.\n\nThe following message gets logged in \"/var/log/nova/nova-compute.log\".\n\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher [req-81b0372a-b2d4-4e30-b0bf-1f54de71f7d9 1344234bf2e54520bbcc9585e442ce78 2fb7b98d74134a37b9fba88856f60b78 - - -] Exception during message handling: internal error: unable to execute QEMU command 'migrate': Migration disabled: failed to allocate shared memory\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     incoming.message))\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 185, in _dispatch\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 110, in wrapped\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     payload)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 89, in wrapped\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 359, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance=instance)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 328, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 387, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 375, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 435, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     instance=instance)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 425, in decorated_function\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3158, in snapshot_instance\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     task_states.IMAGE_SNAPSHOT)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3188, in _snapshot_instance\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     update_task_state)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1667, in snapshot\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     instance)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1760, in _prepare_domain_for_snapshot\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self.suspend(context, instance)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2649, in suspend\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     guest.save_memory_state()\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/guest.py\", line 379, in save_memory_state\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     self._domain.managedSave(0)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 186, in doit\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 144, in proxy_call\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     rv = execute(f, *args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 125, in execute\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     six.reraise(c, e, tb)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 83, in tworker\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     rv = meth(*args, **kwargs)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 1403, in managedSave\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher     if ret == -1: raise libvirtError ('virDomainManagedSave() failed', dom=self)\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher libvirtError: internal error: unable to execute QEMU command 'migrate': Migration disabled: failed to allocate shared memory\n2017-02-06 10:51:36.258 12196 ERROR oslo_messaging.rpc.dispatcher\n\n\nEnvironment\n===========\n\nroot@compute9-r2:~# dpkg -l | egrep \"qemu|libvirt|kvm|nova\"\nii  ipxe-qemu                             1.0.0+git-20131111.c3d1e78-2ubuntu1.1 all          PXE boot firmware - ROM images for qemu\nii  libvirt-bin                           1.3.1-1ubuntu10.6~cloud0              amd64        programs for the libvirt library\nii  libvirt0:amd64                        1.3.1-1ubuntu10.6~cloud0              amd64        library for interfacing with different virtualization systems\nii  nova-common                           2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute - common files\nii  nova-compute                          2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute - compute node base\nii  nova-compute-kvm                      2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                  2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute - compute node libvirt support\nii  python-libvirt                        1.3.1-1ubuntu1~cloud0                 amd64        libvirt Python bindings\nii  python-nova                           2:13.1.2-0ubuntu2~cloud0              all          OpenStack Compute Python libraries\nii  python-novaclient                     2:3.3.1-2ubuntu1~cloud0               all          client library for OpenStack Compute API - Python 2.7\nii  qemu-block-extra:amd64                1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        extra block backend modules for qemu-system and qemu-utils\nii  qemu-slof                             20151103+dfsg-1ubuntu1~cloud0         all          Slimline Open Firmware -- QEMU PowerPC version\nii  qemu-system                           1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries\nii  qemu-system-arm                       1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (arm)\nii  qemu-system-common                    1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (common files)\nii  qemu-system-mips                      1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (mips)\nii  qemu-system-misc                      1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (miscelaneous)\nii  qemu-system-ppc                       1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (ppc)\nii  qemu-system-sparc                     1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (sparc)\nii  qemu-system-x86                       1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU full system emulation binaries (x86)\nii  qemu-utils                            1:2.5+dfsg-5ubuntu10.5~cloud0         amd64        QEMU utilities\n\n\n\n\nResearching the error message I found https://bugs.launchpad.net/fuel/+bug/1638269.\n\nAfter I applied the patch https://review.fuel-infra.org/#/c/28086/2/debian/apparmor/libvirt-qemu and restarting the instance, the snapshot is working fine.\n\n\nI'm not sure if this bug should be recorded with Nova or Ubuntu..\n\nThank you.", 
            "date_created": "2017-02-06 16:49:33.119614+00:00", 
            "author": "https://api.launchpad.net/1.0/~lmihaiescu"
        }, 
        {
            "content": "> I'm not sure if this bug should be recorded with Nova or Ubuntu..\n\nThanks for the report, IMHO this needs to be addressed by Ubuntu or who ever is providing libvirt packages as these apparmor profiles are not shipped within the nova project.", 
            "date_created": "2017-02-07 09:26:47.671181+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyarwood"
        }
    ]
}