{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:21:13.064747+00:00", 
    "description": "I just tried devstack master branch with a fresh installed ubuntu 12.04. The db sync error is as follows:\n\n\n+ /opt/stack/nova/bin/nova-manage db sync\n2012-04-30 16:18:08 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.migration' from '/opt/stack/nova/nova/db/sqlalchemy/migration.pyc'> from (pid=18353) __get_backend /opt/stack/nova/nova/utils.py:631\n2012-04-30 16:18:08 WARNING nova.utils [-] /usr/lib/python2.7/dist-packages/sqlalchemy/pool.py:639: SADeprecationWarning: The 'listeners' argument to Pool (and create_engine()) is deprecated.  Use event.listen().\n  Pool.__init__(self, creator, **kw)\n\n2012-04-30 16:18:08 WARNING nova.utils [-] /usr/lib/python2.7/dist-packages/sqlalchemy/pool.py:145: SADeprecationWarning: Pool.add_listener is deprecated.  Use event.listen()\n  self.add_listener(l)\n\n2012-04-30 16:18:12 WARNING nova.utils [-] /opt/stack/nova/nova/db/sqlalchemy/migrate_repo/versions/075_convert_bw_usage_to_store_network_id.py:49: SADeprecationWarning: useexisting is deprecated.  Use extend_existing.\n  useexisting=True)\n\n2012-04-30 16:18:13 WARNING nova.utils [-] /opt/stack/nova/nova/db/sqlalchemy/migrate_repo/versions/081_drop_instance_id_bw_cache.py:40: SADeprecationWarning: useexisting is deprecated.  Use extend_existing.\n  useexisting=True)\n\nCommand failed, please check log for more info\n2012-04-30 16:18:13 CRITICAL nova [-] (OperationalError) (1025, \"Error on rename of './nova/#sql-44f3_29' to './nova/dns_domains' (errno: 150)\") 'ALTER TABLE dns_domains Engine=InnoDB' ()\n2012-04-30 16:18:13 TRACE nova Traceback (most recent call last):\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1754, in <module>\n2012-04-30 16:18:13 TRACE nova     main()\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1741, in main\n2012-04-30 16:18:13 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1106, in sync\n2012-04-30 16:18:13 TRACE nova     return migration.db_sync(version)\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 30, in db_sync\n2012-04-30 16:18:13 TRACE nova     return IMPL.db_sync(version=version)\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 83, in db_sync\n2012-04-30 16:18:13 TRACE nova     return versioning_api.upgrade(get_engine(), repository, version)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2012-04-30 16:18:13 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2012-04-30 16:18:13 TRACE nova   File \"<string>\", line 2, in _migrate\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 39, in patched_with_engine\n2012-04-30 16:18:13 TRACE nova     return f(*a, **kw)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 366, in _migrate\n2012-04-30 16:18:13 TRACE nova     schema.runchange(ver, change, changeset.step)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 91, in runchange\n2012-04-30 16:18:13 TRACE nova     change.run(self.engine, step)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/script/py.py\", line 145, in run\n2012-04-30 16:18:13 TRACE nova     script_func(engine)\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migrate_repo/versions/086_set_engine_mysql_innodb.py\", line 33, in upgrade\n2012-04-30 16:18:13 TRACE nova     migrate_engine.execute(\"ALTER TABLE dns_domains Engine=InnoDB\")\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2297, in execute\n2012-04-30 16:18:13 TRACE nova     return connection.execute(statement, *multiparams, **params)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1405, in execute\n2012-04-30 16:18:13 TRACE nova     params)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1582, in _execute_text\n2012-04-30 16:18:13 TRACE nova     statement, parameters\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1646, in _execute_context\n2012-04-30 16:18:13 TRACE nova     context)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_context\n2012-04-30 16:18:13 TRACE nova     context)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 330, in do_execute\n2012-04-30 16:18:13 TRACE nova     cursor.execute(statement, parameters)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\n2012-04-30 16:18:13 TRACE nova     self.errorhandler(self, exc, value)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n2012-04-30 16:18:13 TRACE nova     raise errorclass, errorvalue\n2012-04-30 16:18:13 TRACE nova OperationalError: (OperationalError) (1025, \"Error on rename of './nova/#sql-44f3_29' to './nova/dns_domains' (errno: 150)\") 'ALTER TABLE dns_domains Engine=InnoDB' ()\n2012-04-30 16:18:13 TRACE nova \n++ failed\n++ local r=1", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/992206", 
    "owner": "None", 
    "id": 992206, 
    "index": 2885, 
    "created": "2012-04-30 20:30:29.109713+00:00", 
    "title": "nova-manage db sync error", 
    "comments": [
        {
            "content": "I just tried devstack master branch with a fresh installed ubuntu 12.04. The db sync error is as follows:\n\n\n+ /opt/stack/nova/bin/nova-manage db sync\n2012-04-30 16:18:08 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.migration' from '/opt/stack/nova/nova/db/sqlalchemy/migration.pyc'> from (pid=18353) __get_backend /opt/stack/nova/nova/utils.py:631\n2012-04-30 16:18:08 WARNING nova.utils [-] /usr/lib/python2.7/dist-packages/sqlalchemy/pool.py:639: SADeprecationWarning: The 'listeners' argument to Pool (and create_engine()) is deprecated.  Use event.listen().\n  Pool.__init__(self, creator, **kw)\n\n2012-04-30 16:18:08 WARNING nova.utils [-] /usr/lib/python2.7/dist-packages/sqlalchemy/pool.py:145: SADeprecationWarning: Pool.add_listener is deprecated.  Use event.listen()\n  self.add_listener(l)\n\n2012-04-30 16:18:12 WARNING nova.utils [-] /opt/stack/nova/nova/db/sqlalchemy/migrate_repo/versions/075_convert_bw_usage_to_store_network_id.py:49: SADeprecationWarning: useexisting is deprecated.  Use extend_existing.\n  useexisting=True)\n\n2012-04-30 16:18:13 WARNING nova.utils [-] /opt/stack/nova/nova/db/sqlalchemy/migrate_repo/versions/081_drop_instance_id_bw_cache.py:40: SADeprecationWarning: useexisting is deprecated.  Use extend_existing.\n  useexisting=True)\n\nCommand failed, please check log for more info\n2012-04-30 16:18:13 CRITICAL nova [-] (OperationalError) (1025, \"Error on rename of './nova/#sql-44f3_29' to './nova/dns_domains' (errno: 150)\") 'ALTER TABLE dns_domains Engine=InnoDB' ()\n2012-04-30 16:18:13 TRACE nova Traceback (most recent call last):\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1754, in <module>\n2012-04-30 16:18:13 TRACE nova     main()\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1741, in main\n2012-04-30 16:18:13 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1106, in sync\n2012-04-30 16:18:13 TRACE nova     return migration.db_sync(version)\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 30, in db_sync\n2012-04-30 16:18:13 TRACE nova     return IMPL.db_sync(version=version)\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 83, in db_sync\n2012-04-30 16:18:13 TRACE nova     return versioning_api.upgrade(get_engine(), repository, version)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2012-04-30 16:18:13 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2012-04-30 16:18:13 TRACE nova   File \"<string>\", line 2, in _migrate\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 39, in patched_with_engine\n2012-04-30 16:18:13 TRACE nova     return f(*a, **kw)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 366, in _migrate\n2012-04-30 16:18:13 TRACE nova     schema.runchange(ver, change, changeset.step)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 91, in runchange\n2012-04-30 16:18:13 TRACE nova     change.run(self.engine, step)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/script/py.py\", line 145, in run\n2012-04-30 16:18:13 TRACE nova     script_func(engine)\n2012-04-30 16:18:13 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migrate_repo/versions/086_set_engine_mysql_innodb.py\", line 33, in upgrade\n2012-04-30 16:18:13 TRACE nova     migrate_engine.execute(\"ALTER TABLE dns_domains Engine=InnoDB\")\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2297, in execute\n2012-04-30 16:18:13 TRACE nova     return connection.execute(statement, *multiparams, **params)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1405, in execute\n2012-04-30 16:18:13 TRACE nova     params)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1582, in _execute_text\n2012-04-30 16:18:13 TRACE nova     statement, parameters\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1646, in _execute_context\n2012-04-30 16:18:13 TRACE nova     context)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_context\n2012-04-30 16:18:13 TRACE nova     context)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 330, in do_execute\n2012-04-30 16:18:13 TRACE nova     cursor.execute(statement, parameters)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\n2012-04-30 16:18:13 TRACE nova     self.errorhandler(self, exc, value)\n2012-04-30 16:18:13 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n2012-04-30 16:18:13 TRACE nova     raise errorclass, errorvalue\n2012-04-30 16:18:13 TRACE nova OperationalError: (OperationalError) (1025, \"Error on rename of './nova/#sql-44f3_29' to './nova/dns_domains' (errno: 150)\") 'ALTER TABLE dns_domains Engine=InnoDB' ()\n2012-04-30 16:18:13 TRACE nova \n++ failed\n++ local r=1", 
            "date_created": "2012-04-30 20:30:29.109713+00:00", 
            "author": "https://api.launchpad.net/1.0/~yunmao"
        }, 
        {
            "content": "This has been recently fixed by:\r\n\r\n\r\nhttps://github.com/openstack/nova/commit/7b5fdac84b513c6b606848cc353995d6abb9a7c9#nova/db/sqlalchemy/migrate_repo/versions/096_recreate_dns_domains.py", 
            "date_created": "2012-05-16 00:42:10.602315+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "When running sudo nova-manage db sync command\nThen getting this error :-\nvishal@Cloud2SME1:~$ sudo nova-manage db sync\n2012-06-03 01:23:56 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.mig                                                                                        ration' from '/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.pyc'                                                                                        > from (pid=2770) __get_backend /usr/lib/python2.7/dist-packages/nova/utils.py:6                                                                                        58\n\n\n\n^C2012-06-03 01:24:14 CRITICAL nova [-]\n2012-06-03 01:24:14 TRACE nova Traceback (most recent call last):\n2012-06-03 01:24:14 TRACE nova   File \"/usr/bin/nova-manage\", line 1744, in <module>\n2012-06-03 01:24:14 TRACE nova     main()\n2012-06-03 01:24:14 TRACE nova   File \"/usr/bin/nova-manage\", line 1731, in main\n2012-06-03 01:24:14 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/bin/nova-manage\", line 1102, in sync\n2012-06-03 01:24:14 TRACE nova     return migration.db_sync(version)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/migration.py\", line 30, in db_sync\n2012-06-03 01:24:14 TRACE nova     return IMPL.db_sync(version=version)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.py\", line 51, in db_sync\n2012-06-03 01:24:14 TRACE nova     return versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2012-06-03 01:24:14 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2012-06-03 01:24:14 TRACE nova   File \"<string>\", line 2, in _migrate\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 159, in with_engine\n2012-06-03 01:24:14 TRACE nova     return f(*a, **kw)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 366, in _migrate\n2012-06-03 01:24:14 TRACE nova     schema.runchange(ver, change, changeset.step)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/\n2012-06-03 01:24:14 TRACE nova     change.run(self.engine, step)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/\n2012-06-03 01:24:14 TRACE nova     script_func(engine)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/\n2012-06-03 01:24:14 TRACE nova     migrate_engine.execute(\"ALTER TABLE migration\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalche\n2012-06-03 01:24:14 TRACE nova     return connection.execute(statement, *multipa\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalche\n2012-06-03 01:24:14 TRACE nova     params)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalche\n2012-06-03 01:24:14 TRACE nova     statement, parameters\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalche\n2012-06-03 01:24:14 TRACE nova     context)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalche\n2012-06-03 01:24:14 TRACE nova     cursor.execute(statement, parameters)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/\n2012-06-03 01:24:14 TRACE nova     self.errorhandler(self, exc, value)\n2012-06-03 01:24:14 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/\n2012-06-03 01:24:14 TRACE nova     raise errorclass, errorvalue\n2012-06-03 01:24:14 TRACE nova KeyboardInterrupt\n2012-06-03 01:24:14 TRACE nova\n\n\nPlease update documentation either aware us <email address hidden>", 
            "date_created": "2012-06-02 20:07:47.247592+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishal-gupta"
        }
    ]
}