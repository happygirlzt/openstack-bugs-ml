{
    "status": "In Progress", 
    "last_updated": "2017-05-16 11:29:22.862220+00:00", 
    "description": "\nNova sometimes raises an exception when running the periodic instance deleted,\nsee below. The error is quite spurious, and it is not happening always so I\ncannot get the reason why this is happening. The periodic reclaim is trying to\ndelete the instance, but the DB is not returning the instance as it is marked\nas deleted.\n\n    ERROR nova.compute.manager Traceback (most recent call last):\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 447, in _object_dispatch\n    ERROR nova.compute.manager     return getattr(target, method)(*args, **kwargs)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 213, in wrapper\n    ERROR nova.compute.manager     return fn(self, *args, **kwargs)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 673, in save\n    ERROR nova.compute.manager     columns_to_join=_expected_cols(expected_attrs))\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 765, in instance_update_and_get_original\n    ERROR nova.compute.manager     expected=expected)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 216, in wrapper\n    ERROR nova.compute.manager     return f(*args, **kwargs) \n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_db/api.py\", line 146, in wrapper\n    ERROR nova.compute.manager     ectxt.value = e.inner_exc \n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n    ERROR nova.compute.manager     six.reraise(self.type_, self.value, self.tb)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_db/api.py\", line 136, in wrapper\n    ERROR nova.compute.manager     return f(*args, **kwargs) \n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2478, in instance_update_and_get_original\n    ERROR nova.compute.manager     session=session)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1733, in _instance_get_by_uuid\n    ERROR nova.compute.manager     raise exception.InstanceNotFound(instance_id=uuid)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager InstanceNotFound: Instance aceb4514-915e-4687-ac99-20f6b7d5ed6d could not be found.\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager\n    WARNING nova.compute.manager [req-e62c7e7c-0799-4f87-8f06-a46cf5663733 - - - - -] [instance: aceb4514-915e-4687-ac99-20f6b7d5ed6d] Periodic reclaim failed to delete instance: Instance aceb4514-915e-4687-ac99-20f6b7d5ed6d could not be found.\n\nAs I said, this is an spurious error, but from time to time we get a bunch of\nthese errors and we need to manually delete those instances.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1587356", 
    "owner": "https://api.launchpad.net/1.0/~aloga", 
    "id": 1587356, 
    "index": 6252, 
    "created": "2016-05-31 09:11:56.364212+00:00", 
    "title": "nova raises 'InstanceNotFound' when running the periodic reclaim", 
    "comments": [
        {
            "content": "\nNova sometimes raises an exception when running the periodic instance deleted,\nsee below. The error is quite spurious, and it is not happening always so I\ncannot get the reason why this is happening. The periodic reclaim is trying to\ndelete the instance, but the DB is not returning the instance as it is marked\nas deleted.\n\n    ERROR nova.compute.manager Traceback (most recent call last):\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 447, in _object_dispatch\n    ERROR nova.compute.manager     return getattr(target, method)(*args, **kwargs)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 213, in wrapper\n    ERROR nova.compute.manager     return fn(self, *args, **kwargs)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 673, in save\n    ERROR nova.compute.manager     columns_to_join=_expected_cols(expected_attrs))\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 765, in instance_update_and_get_original\n    ERROR nova.compute.manager     expected=expected)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 216, in wrapper\n    ERROR nova.compute.manager     return f(*args, **kwargs) \n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_db/api.py\", line 146, in wrapper\n    ERROR nova.compute.manager     ectxt.value = e.inner_exc \n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n    ERROR nova.compute.manager     six.reraise(self.type_, self.value, self.tb)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_db/api.py\", line 136, in wrapper\n    ERROR nova.compute.manager     return f(*args, **kwargs) \n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2478, in instance_update_and_get_original\n    ERROR nova.compute.manager     session=session)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1733, in _instance_get_by_uuid\n    ERROR nova.compute.manager     raise exception.InstanceNotFound(instance_id=uuid)\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager InstanceNotFound: Instance aceb4514-915e-4687-ac99-20f6b7d5ed6d could not be found.\n    ERROR nova.compute.manager\n    ERROR nova.compute.manager\n    WARNING nova.compute.manager [req-e62c7e7c-0799-4f87-8f06-a46cf5663733 - - - - -] [instance: aceb4514-915e-4687-ac99-20f6b7d5ed6d] Periodic reclaim failed to delete instance: Instance aceb4514-915e-4687-ac99-20f6b7d5ed6d could not be found.\n\nAs I said, this is an spurious error, but from time to time we get a bunch of\nthese errors and we need to manually delete those instances.", 
            "date_created": "2016-05-31 09:11:56.364212+00:00", 
            "author": "https://api.launchpad.net/1.0/~aloga"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/323250", 
            "date_created": "2016-05-31 09:36:03.840132+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "You don't have the full trace, but what's probably happening here is that the code is lazy-loading attributes on the instance object but because the instance is deleted, it fails to lazy-load the full instance from the database because of the InstanceNotFound. The question is what's getting lazy-loaded and causing this to fail?", 
            "date_created": "2016-12-15 15:29:36.532917+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Also, what release are you hitting this on? Newton? master? Mitaka, other?", 
            "date_created": "2016-12-15 15:34:31.430151+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "copy from \nhttp://paste.openstack.org/show/592513/\n\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager Traceback (most recent call last):\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2358, in _delete_instance\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     self._shutdown_instance(context, instance, bdms)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2278, in _shutdown_instance\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     requested_networks)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     self.force_reraise()\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     six.reraise(self.type_, self.value, self.tb)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2266, in _shutdown_instance\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     block_device_info)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 816, in destroy\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     destroy_disks, migrate_data)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 926, in cleanup\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     instance.save()\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 207, in wrapper\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     ctxt, self, fn.__name__, args, kwargs)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/conductor/rpcapi.py\", line 242, in object_action\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     objmethod=objmethod, args=args, kwargs=kwargs)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     retry=self.retry)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     timeout=timeout, retry=retry)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 470, in send\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     retry=retry)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 461, in _send\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     raise result\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager InstanceNotFound_Remote: Instance aceb4514-915e-4687-ac99-20f6b7d5ed6d could not be found.\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager Traceback (most recent call last):\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 447, in _object_dispatch\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     return getattr(target, method)(*args, **kwargs)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 213, in wrapper\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     return fn(self, *args, **kwargs)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 673, in save\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     columns_to_join=_expected_cols(expected_attrs))\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 765, in instance_update_and_get_original\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 765, in instance_update_and_get_original\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     expected=expected)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 216, in wrapper\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     return f(*args, **kwargs)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_db/api.py\", line 146, in wrapper\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     ectxt.value = e.inner_exc\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     six.reraise(self.type_, self.value, self.tb)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/oslo_db/api.py\", line 136, in wrapper\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     return f(*args, **kwargs)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2478, in instance_update_and_get_original\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     session=session)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1733, in _instance_get_by_uuid\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager     raise exception.InstanceNotFound(instance_id=uuid)\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager InstanceNotFound: Instance aceb4514-915e-4687-ac99-20f6b7d5ed6d could not be found.\n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.335 30103 ERROR nova.compute.manager \n2016-05-30 13:23:03.361 30103 WARNING nova.compute.manager [req-aa59ab4b-0f08-4330-82c8-f45671147a09 - - - - -] [instance: aceb4514-915e-4687-ac99-20f6b7d5ed6d] Periodic reclaim failed to delete instance: Instance aceb4514-915e-4687-ac99-20f6b7d5ed6d could not be found.\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 447, in _object_dispatch\n    return getattr(target, method)(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 213, in wrapper\n    return fn(self, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 673, in save\n    columns_to_join=_expected_cols(expected_attrs))\n\n  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 765, in instance_update_and_get_original\n    expected=expected)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 216, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_db/api.py\", line 146, in wrapper\n    ectxt.value = e.inner_exc\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_db/api.py\", line 136, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2478, in instance_update_and_get_original\n    session=session)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1733, in _instance_get_by_uuid\n    raise exception.InstanceNotFound(instance_id=uuid)\n\nInstanceNotFound: Instance aceb4514-915e-4687-ac99-20f6b7d5ed6d could not be found.", 
            "date_created": "2017-01-09 13:26:17.859551+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Hi Matt,\n\nthis has happened at our cloud since several releases, IIRC: uno, Kilo, Liberty and now, Mitaka.", 
            "date_created": "2017-05-16 11:29:22.231672+00:00", 
            "author": "https://api.launchpad.net/1.0/~aloga"
        }
    ]
}