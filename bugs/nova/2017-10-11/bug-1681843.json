{
    "status": "Fix Released", 
    "last_updated": "2017-06-08 21:53:04.640371+00:00", 
    "description": "Since https://github.com/openstack/nova/commit/6dd047a3307a1056077608fd5bc2d1c3b3285338 we're seeing errors for Nova-placement service in the OpenStack-Ansible gate jobs:\n\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack [req-a9cb7079-b603-4c2c-9f99-8bc4293f9700 78e46f12329c4f71a7f6b97aa3a7eb57 f7d6ca89f4fb446eaebef93f7f235a50 - default default] Caught error: invalid literal for int() with base 10: ''\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack Traceback (most recent call last):\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/nova/api/openstack/__init__.py\", line 85, in __call__\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     return req.get_response(self.application)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/request.py\", line 1316, in send\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     application, catch_exc_info=False)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/request.py\", line 1280, in call_application\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/dec.py\", line 131, in __call__\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/dec.py\", line 196, in call_func\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/nova/api/openstack/placement/microversion.py\", line 123, in __call__\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     response = req.get_response(self.application)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/request.py\", line 1316, in send\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     application, catch_exc_info=False)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/request.py\", line 1280, in call_application\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/nova/api/openstack/placement/handler.py\", line 182, in __call__\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     if int(environ.get('CONTENT_LENGTH', 0)):\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack ValueError: invalid literal for int() with base 10: ''\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack \n\n================================\n\nThe Error is occurring because \"CONTENT_LENGTH\" is present but = '' and the change attempts to set \"None\" to an int - which fails.\n\nWe're using Nginx /w uWSGI and I believe a default uwsgi param is set to always send a CONTENT_LENGTH and CONTENT_TYPE header even when those are empty.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1681843", 
    "owner": "https://api.launchpad.net/1.0/~andrew-mccrae", 
    "id": 1681843, 
    "index": 6780, 
    "created": "2017-04-11 13:15:34.587182+00:00", 
    "title": "Nova-placement returns 'ValueError: invalid literal for int() with base 10: '''", 
    "comments": [
        {
            "content": "Since https://github.com/openstack/nova/commit/6dd047a3307a1056077608fd5bc2d1c3b3285338 we're seeing errors for Nova-placement service in the OpenStack-Ansible gate jobs:\n\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack [req-a9cb7079-b603-4c2c-9f99-8bc4293f9700 78e46f12329c4f71a7f6b97aa3a7eb57 f7d6ca89f4fb446eaebef93f7f235a50 - default default] Caught error: invalid literal for int() with base 10: ''\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack Traceback (most recent call last):\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/nova/api/openstack/__init__.py\", line 85, in __call__\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     return req.get_response(self.application)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/request.py\", line 1316, in send\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     application, catch_exc_info=False)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/request.py\", line 1280, in call_application\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/dec.py\", line 131, in __call__\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/dec.py\", line 196, in call_func\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/nova/api/openstack/placement/microversion.py\", line 123, in __call__\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     response = req.get_response(self.application)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/request.py\", line 1316, in send\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     application, catch_exc_info=False)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/webob/request.py\", line 1280, in call_application\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack   File \"/openstack/venvs/nova-master/lib/python2.7/site-packages/nova/api/openstack/placement/handler.py\", line 182, in __call__\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack     if int(environ.get('CONTENT_LENGTH', 0)):\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack ValueError: invalid literal for int() with base 10: ''\n2017-04-10 17:43:45.761 2477 ERROR nova.api.openstack \n\n================================\n\nThe Error is occurring because \"CONTENT_LENGTH\" is present but = '' and the change attempts to set \"None\" to an int - which fails.\n\nWe're using Nginx /w uWSGI and I believe a default uwsgi param is set to always send a CONTENT_LENGTH and CONTENT_TYPE header even when those are empty.", 
            "date_created": "2017-04-11 13:15:34.587182+00:00", 
            "author": "https://api.launchpad.net/1.0/~andrew-mccrae"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/455710", 
            "date_created": "2017-04-11 13:31:04.009247+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/455710\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=d8be75b3b8d80598dd6375a8c029fe9906e00b9f\nSubmitter: Jenkins\nBranch:    master\n\ncommit d8be75b3b8d80598dd6375a8c029fe9906e00b9f\nAuthor: Andy McCrae <email address hidden>\nDate:   Tue Apr 11 14:19:44 2017 +0100\n\n    Allow CONTENT_LENGTH to be present but empty\n    \n    The CONTENT_LENGTH environ can be present, but empty, which returns\n    None, and causes a ValueError when attempting to use .int().\n    \n    This patch removes the setting of CONTENT_LENGTH to an integer, but\n    instead ensures that if CONTENT_LENGTH is not empty it is an integer, to\n    prevent a situation where a bogus \"CONTENT_LENGTH\" header is specified.\n    \n    Additionally, as the CONTENT_TYPE environ can similarly be present but\n    empty, we should .get() it in a similar fashion to ensure it isn't\n    present but None when CONTENT_LENGTH is specified.\n    \n    Change-Id: I66b6f9afbea8bf037997a59ba0b976f83c9825fb\n    Closes-Bug: #1681843\n", 
            "date_created": "2017-04-26 12:06:31.372166+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b2 development milestone.", 
            "date_created": "2017-06-08 21:53:04.396833+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}