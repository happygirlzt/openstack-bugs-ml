{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 11:07:03.118830+00:00", 
    "description": "It looks like vcpu_weights needs to be cast to a string in order for this to work properly.\n\nHere's an example stack trace\n\n2012-02-29 15:52:20 ERROR nova.virt.xenapi.vmops [-] instance 41a65b58-1ac8-4a0a-8e3e-190b345f0685: Failed to spawn\n(nova.virt.xenapi.vmops): TRACE: Traceback (most recent call last):\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 240, in spawn\n(nova.virt.xenapi.vmops): TRACE:     self._spawn(instance, vm_ref)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 525, in _spawn\n(nova.virt.xenapi.vmops): TRACE:     self._configure_instance(ctx, instance, vm_ref, no_agent)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 474, in _configure_instance\n(nova.virt.xenapi.vmops): TRACE:     \"weight\", vcpu_weight)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi_conn.py\", line 600, in call_xenapi\n(nova.virt.xenapi.vmops): TRACE:     return tpool.execute(f, *args)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/tpool.py\", line 76, in tworker\n(nova.virt.xenapi.vmops): TRACE:     rv = meth(*args,**kwargs)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 229, in __call__\n(nova.virt.xenapi.vmops): TRACE:     return self.__send(self.__name, args)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 133, in xenapi_request\n(nova.virt.xenapi.vmops): TRACE:     result = _parse_result(getattr(self, methodname)(*full_params))\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 203, in _parse_result\n(nova.virt.xenapi.vmops): TRACE:     raise Failure(result['ErrorDescription'])\n(nova.virt.xenapi.vmops): TRACE: Failure: ['FIELD_TYPE_ERROR', 'value']\n(nova.virt.xenapi.vmops): TRACE:\n2012-02-29 15:52:20 DEBUG nova.virt.xenapi.vmops [-] Instance 1927 failed to spawn - performing clean-up from (pid=19471) spawn /usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py:251\n2012-02-29 15:52:20 DEBUG nova.virt.xenapi.vmops [-] Resources to remove:[{'file': None, 'vdi_type': u'os', 'vdi_uuid': u'ac7d261e-5b90-48db-b20b-5f5aebe7a6a7'}] from (pid=19471) _handle_spawn_error /usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py:540\n2012-02-29 15:52:20 DEBUG nova.virt.xenapi.vmops [-] Removing VDI OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386(uuid:ac7d261e-5b90-48db-b20b-5f5aebe7a6a7) from (pid=19471) _handle_spawn_error /usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py:552\n2012-02-29 15:52:21 WARNING nova.virt.xenapi_conn [-] Task [Async.VDI.destroy] OpaqueRef:521a40ba-3c74-9d43-391f-4e9dc193ff32 status: failure    ['VDI_IN_USE', 'OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386']\n2012-02-29 15:52:21 ERROR nova.virt.xenapi.vm_utils [-] ['VDI_IN_USE', 'OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386']\n(nova.virt.xenapi.vm_utils): TRACE: Traceback (most recent call last):\n(nova.virt.xenapi.vm_utils): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vm_utils.py\", line 297, in destroy_vdi\n(nova.virt.xenapi.vm_utils): TRACE:     session.wait_for_task(task)\n(nova.virt.xenapi.vm_utils): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi_conn.py\", line 664, in wait_for_task\n(nova.virt.xenapi.vm_utils): TRACE:     raise self.XenAPI.Failure(error_info)\n(nova.virt.xenapi.vm_utils): TRACE: Failure: ['VDI_IN_USE', 'OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386']\n(nova.virt.xenapi.vm_utils): TRACE:\n2012-02-29 15:52:21 ERROR nova.compute.manager [-] [instance: 41a65b58-1ac8-4a0a-8e3e-190b345f0685] Instance failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 593, in _spawn\n(nova.compute.manager): TRACE:     self._legacy_nw_info(network_info), block_device_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi_conn.py\", line 225, in spawn\n(nova.compute.manager): TRACE:     self._vmops.spawn(context, instance, image_meta, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 252, in spawn\n(nova.compute.manager): TRACE:     self._handle_spawn_error(vdis, spawn_error)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 553, in _handle_spawn_error\n(nova.compute.manager): TRACE:     VMHelper.destroy_vdi(self._session, vdi_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vm_utils.py\", line 301, in destroy_vdi\n(nova.compute.manager): TRACE:     _('Unable to destroy VDI %s') % vdi_ref)\n(nova.compute.manager): TRACE: StorageError: Unable to destroy VDI OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386\n(nova.compute.manager): TRACE:", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/943490", 
    "owner": "https://api.launchpad.net/1.0/~markwash", 
    "id": 943490, 
    "index": 2632, 
    "created": "2012-02-29 18:57:27.352655+00:00", 
    "title": "xen instance build fails when vcpu_weights set", 
    "comments": [
        {
            "content": "It looks like vcpu_weights needs to be cast to a string in order for this to work properly.\n\nHere's an example stack trace\n\n2012-02-29 15:52:20 ERROR nova.virt.xenapi.vmops [-] instance 41a65b58-1ac8-4a0a-8e3e-190b345f0685: Failed to spawn\n(nova.virt.xenapi.vmops): TRACE: Traceback (most recent call last):\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 240, in spawn\n(nova.virt.xenapi.vmops): TRACE:     self._spawn(instance, vm_ref)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 525, in _spawn\n(nova.virt.xenapi.vmops): TRACE:     self._configure_instance(ctx, instance, vm_ref, no_agent)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 474, in _configure_instance\n(nova.virt.xenapi.vmops): TRACE:     \"weight\", vcpu_weight)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi_conn.py\", line 600, in call_xenapi\n(nova.virt.xenapi.vmops): TRACE:     return tpool.execute(f, *args)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/tpool.py\", line 76, in tworker\n(nova.virt.xenapi.vmops): TRACE:     rv = meth(*args,**kwargs)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 229, in __call__\n(nova.virt.xenapi.vmops): TRACE:     return self.__send(self.__name, args)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 133, in xenapi_request\n(nova.virt.xenapi.vmops): TRACE:     result = _parse_result(getattr(self, methodname)(*full_params))\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 203, in _parse_result\n(nova.virt.xenapi.vmops): TRACE:     raise Failure(result['ErrorDescription'])\n(nova.virt.xenapi.vmops): TRACE: Failure: ['FIELD_TYPE_ERROR', 'value']\n(nova.virt.xenapi.vmops): TRACE:\n2012-02-29 15:52:20 DEBUG nova.virt.xenapi.vmops [-] Instance 1927 failed to spawn - performing clean-up from (pid=19471) spawn /usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py:251\n2012-02-29 15:52:20 DEBUG nova.virt.xenapi.vmops [-] Resources to remove:[{'file': None, 'vdi_type': u'os', 'vdi_uuid': u'ac7d261e-5b90-48db-b20b-5f5aebe7a6a7'}] from (pid=19471) _handle_spawn_error /usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py:540\n2012-02-29 15:52:20 DEBUG nova.virt.xenapi.vmops [-] Removing VDI OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386(uuid:ac7d261e-5b90-48db-b20b-5f5aebe7a6a7) from (pid=19471) _handle_spawn_error /usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py:552\n2012-02-29 15:52:21 WARNING nova.virt.xenapi_conn [-] Task [Async.VDI.destroy] OpaqueRef:521a40ba-3c74-9d43-391f-4e9dc193ff32 status: failure    ['VDI_IN_USE', 'OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386']\n2012-02-29 15:52:21 ERROR nova.virt.xenapi.vm_utils [-] ['VDI_IN_USE', 'OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386']\n(nova.virt.xenapi.vm_utils): TRACE: Traceback (most recent call last):\n(nova.virt.xenapi.vm_utils): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vm_utils.py\", line 297, in destroy_vdi\n(nova.virt.xenapi.vm_utils): TRACE:     session.wait_for_task(task)\n(nova.virt.xenapi.vm_utils): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi_conn.py\", line 664, in wait_for_task\n(nova.virt.xenapi.vm_utils): TRACE:     raise self.XenAPI.Failure(error_info)\n(nova.virt.xenapi.vm_utils): TRACE: Failure: ['VDI_IN_USE', 'OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386']\n(nova.virt.xenapi.vm_utils): TRACE:\n2012-02-29 15:52:21 ERROR nova.compute.manager [-] [instance: 41a65b58-1ac8-4a0a-8e3e-190b345f0685] Instance failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 593, in _spawn\n(nova.compute.manager): TRACE:     self._legacy_nw_info(network_info), block_device_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi_conn.py\", line 225, in spawn\n(nova.compute.manager): TRACE:     self._vmops.spawn(context, instance, image_meta, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 252, in spawn\n(nova.compute.manager): TRACE:     self._handle_spawn_error(vdis, spawn_error)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 553, in _handle_spawn_error\n(nova.compute.manager): TRACE:     VMHelper.destroy_vdi(self._session, vdi_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vm_utils.py\", line 301, in destroy_vdi\n(nova.compute.manager): TRACE:     _('Unable to destroy VDI %s') % vdi_ref)\n(nova.compute.manager): TRACE: StorageError: Unable to destroy VDI OpaqueRef:39c1203a-47eb-b434-a73a-4d9d7b665386\n(nova.compute.manager): TRACE:", 
            "date_created": "2012-02-29 18:57:27.352655+00:00", 
            "author": "https://api.launchpad.net/1.0/~markwash"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/4709", 
            "date_created": "2012-02-29 19:03:27.579208+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/4709\nCommitted: http://github.com/openstack/nova/commit/fd915aa78d8fbc09395c77ca84728b361edab416\nSubmitter: Jenkins\nBranch:    master\n\ncommit fd915aa78d8fbc09395c77ca84728b361edab416\nAuthor: Mark Washenberger <email address hidden>\nDate:   Wed Feb 29 13:54:27 2012 -0500\n\n    Cast vcpu_weight to string before calling xen api\n    \n    Fixes bug 943490\n    \n    - style changes per s1rp\n    \n    Change-Id: If6444aa0bff35c54c6c3d57f97507b16b1e27d6a\n", 
            "date_created": "2012-02-29 19:59:59.982431+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}