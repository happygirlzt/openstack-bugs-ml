{
    "status": "Fix Released", 
    "last_updated": "2011-02-07 13:58:05.307385+00:00", 
    "description": "trying to build docs or run setup.py fails without sphinx, which isn't required by tools/pip-requires nor our wiki instructions ...\n\n(.nova-venv)k:trunk kpepple$ python setup.py install\nTraceback (most recent call last):\n  File \"setup.py\", line 24, in <module>\n    from sphinx.setup_command import BuildDoc\nImportError: No module named sphinx.setup_command\n\nAsking to just include this as part of pip-requires so that it just works.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/706683", 
    "owner": "https://api.launchpad.net/1.0/~ken-pepple", 
    "id": 706683, 
    "index": 2011, 
    "created": "2011-01-23 20:46:45.224654+00:00", 
    "title": "setup.py errors and docs won't build without sphinx", 
    "comments": [
        {
            "content": "trying to build docs or run setup.py fails without sphinx, which isn't required by tools/pip-requires nor our wiki instructions ...\n\n(.nova-venv)k:trunk kpepple$ python setup.py install\nTraceback (most recent call last):\n  File \"setup.py\", line 24, in <module>\n    from sphinx.setup_command import BuildDoc\nImportError: No module named sphinx.setup_command\n\nAsking to just include this as part of pip-requires so that it just works.", 
            "date_created": "2011-01-23 20:46:45.224654+00:00", 
            "author": "https://api.launchpad.net/1.0/~ken-pepple"
        }, 
        {
            "content": "Our hudson server still had trouble building nova trunk with clean virtual environment \"./run_tests.sh -f\".  I hacked in the following into our hpc_trunk branch as a workaround.  It looks like the dependencies are getting triggered out of order.\n\nbschott@ironman:~/Source/nova/hpc-trunk$ bzr diff -r 465 tools/install_venv.py\n=== modified file 'tools/install_venv.py'\n--- tools/install_venv.py\t2011-01-11 18:11:30 +0000\n+++ tools/install_venv.py\t2011-01-24 16:23:31 +0000\n@@ -93,6 +93,17 @@\n   # get it in stalled in the right order\n   run_command(['tools/with_venv.sh', 'pip', 'install', '-E', venv, 'greenlet'],\n               redirect_output=False)\n+  #\n+  # BFS workaround for glance build error, remove when fixed\n+  #\n+  run_command(['tools/with_venv.sh', 'pip', 'install', '-E', venv, 'sphinx'],\n+              redirect_output=False)\n+  run_command(['tools/with_venv.sh', 'pip', 'install', '-E', venv, 'argparse'],\n+              redirect_output=False)\n+  #\n+  # BFS end workaround\n+  #\n+\n   run_command(['tools/with_venv.sh', 'pip', 'install', '-E', venv, '-r', PIP_REQUIRES],\n               redirect_output=False)\n   run_command(['tools/with_venv.sh', 'pip', 'install', '-E', venv, TWISTED_NOVA],\n\n--- log ---\n\nbschott@ironman:~/Source/nova/trunk$ bzr pull\nUsing saved parent location: bzr+ssh://bazaar.launchpad.net/%2Bbranch/nova/\n M  nova/virt/xenapi/vmops.py                                                                                                       \n M  tools/pip-requires\nAll changes applied successfully.                                                                                                   \nNow on revision 604.\nbschott@ironman:~/Source/nova/trunk$ ls -al\ntotal 144\ndrwxr-xr-x  30 bschott  staff   1020 Jan 22 12:29 .\ndrwxr-xr-x   9 bschott  staff    306 Jan 24 11:33 ..\ndrwxr-xr-x   7 bschott  staff    238 Jan 11 11:24 .bzr\n-rw-r--r--   1 bschott  staff    200 Jan 11 11:24 .bzrignore\n-rw-r--r--   1 bschott  staff    125 Jan 11 11:24 .gitignore\n-rw-r--r--   1 bschott  staff   1646 Jan 22 12:29 .mailmap\n-rw-r--r--   1 bschott  staff   2072 Jan 22 12:29 Authors\ndrwxr-xr-x  11 bschott  staff    374 Jan 11 11:24 CA\n-rw-r--r--   1 bschott  staff   1345 Jan 11 11:24 HACKING\n-rw-r--r--   1 bschott  staff  10143 Jan 11 11:24 LICENSE\n-rw-r--r--   1 bschott  staff   1070 Jan 22 12:29 MANIFEST.in\n-rw-r--r--   1 bschott  staff    837 Jan 22 12:29 README\n-rw-r--r--   1 bschott  staff     17 Jan 11 11:24 babel.cfg\ndrwxr-xr-x  19 bschott  staff    646 Jan 22 12:29 bin\n-rwxr-xr-x   1 bschott  staff    787 Jan 11 11:24 builddeb.sh\ndrwxr-xr-x   3 bschott  staff    102 Jan 11 11:24 bzrplugins\ndrwxr-xr-x   5 bschott  staff    170 Jan 22 12:29 contrib\ndrwxr-xr-x   9 bschott  staff    306 Jan 11 11:24 doc\ndrwxr-xr-x   3 bschott  staff    102 Jan 22 12:29 etc\n-rw-r--r--   1 bschott  staff     41 Jan 22 12:29 krm_mapping.json.sample\ndrwxr-xr-x   3 bschott  staff    102 Jan 11 11:24 locale\ndrwxr-xr-x  33 bschott  staff   1122 Jan 22 12:29 nova\ndrwxr-xr-x   3 bschott  staff    102 Jan 11 11:24 plugins\n-rw-r--r--   1 bschott  staff    829 Jan 11 11:24 pylintrc\n-rw-r--r--   1 bschott  staff   2240 Jan 22 12:29 run_tests.py\n-rwxr-xr-x   1 bschott  staff   2205 Jan 22 12:29 run_tests.sh\n-rw-r--r--   1 bschott  staff    372 Jan 11 11:24 setup.cfg\n-rw-r--r--   1 bschott  staff   3481 Jan 22 12:29 setup.py\ndrwxr-xr-x  10 bschott  staff    340 Jan 22 12:29 smoketests\ndrwxr-xr-x  10 bschott  staff    340 Jan 24 11:51 tools\nbschott@ironman:~/Source/nova/trunk$ ./run_tests.sh -f\nCleaning virtualenv...\nNo virtual environment found...create one? (Y/n) \ndone.\nCreating venv... done.\nInstalling pip in virtualenv... done.\nInstalling dependencies with pip (this can take a while)...\nDownloading/unpacking greenlet\n  Downloading greenlet-0.3.1.tar.gz\n  Running setup.py egg_info for package greenlet\n    /System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/distutils/dist.py:266: UserWarning: Unknown distribution option: 'repository'\n      warnings.warn(msg)\nInstalling collected packages: greenlet\n  Running setup.py install for greenlet\n    /System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/distutils/dist.py:266: UserWarning: Unknown distribution option: 'repository'\n      warnings.warn(msg)\n    building 'greenlet' extension\n    gcc-4.2 -fno-strict-aliasing -fno-common -dynamic -DNDEBUG -g -fwrapv -Os -Wall -Wstrict-prototypes -DENABLE_DTRACE -arch i386 -arch ppc -arch x86_64 -pipe -I/System/Library/Frameworks/Python.framework/Versions/2.6/include/python2.6 -c greenlet.c -o build/temp.macosx-10.6-universal-2.6/greenlet.o\n    gcc-4.2 -Wl,-F. -bundle -undefined dynamic_lookup -arch i386 -arch ppc -arch x86_64 build/temp.macosx-10.6-universal-2.6/greenlet.o -o build/lib.macosx-10.6-universal-2.6/greenlet.so\nSuccessfully installed greenlet\nCleaning up...\nDownloading/unpacking zope.interface==3.6.1 (from -r /Users/bschott/Source/nova/trunk/tools/pip-requires (line 19))\n  Downloading zope.interface-3.6.1.tar.gz (125Kb): 125Kb downloaded\n  Running setup.py egg_info for package zope.interface\nDownloading/unpacking Twisted>=10.1.0 (from -r /Users/bschott/Source/nova/trunk/tools/pip-requires (line 25))\n  Downloading Twisted-10.2.0.tar.bz2 (2.7Mb): 2.7Mb downloaded\n  Running setup.py egg_info for package Twisted\nDownloading/unpacking SQLAlchemy==0.6.3 (from -r /Users/bschott/Source/nova/trunk/tools/pip-requires (line 1))\n  Downloading SQLAlchemy-0.6.3.tar.gz (1.9Mb): 1.9Mb downloaded\n  Running setup.py egg_info for package SQLAlchemy\n    no previously-included directories found matching 'doc/build/output'\nDownloading/unpacking Cheetah==2.4.2.1 (from -r /Users/bschott/Source/nova/trunk/tools/pip-requires (line 5))\n  Downloading Cheetah-2.4.2.1.tar.gz (189Kb): 189Kb downloaded\n  Running setup.py egg_info for package Cheetah\n    /System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/distutils/dist.py:266: UserWarning: Unknown distribution option: 'line'\n      warnings.warn(msg)\n    warning: no files found matching 'examples'\n    warning: no files found matching 'docs'\n    warning: no files found matching 'bin'\n    warning: no files found matching '*' under directory 'docs'\n    warning: no files found matching '*' under directory 'examples'\n    warning: no previously-included files matching '*.pyc' found under directory 'cheetah'\n    warning: no previously-included files matching '*~' found under directory 'cheetah'\n    warning: no previously-included files matching '*.aux' found under directory 'cheetah'\n    warning: no previously-included files matching '*~' found under directory 'docs'\n    warning: no previously-included files matching '*.aux' found under directory 'docs'\nDownloading/unpacking glance (from -r /Users/bschott/Source/nova/trunk/tools/pip-requires (line 31))\n  Downloading glance-0.1.3.tar.gz (67Kb): 67Kb downloaded\n  Running setup.py egg_info for package glance\n    Traceback (most recent call last):\n      File \"<string>\", line 14, in <module>\n      File \"/Users/bschott/Source/nova/trunk/.nova-venv/build/glance/setup.py\", line 22, in <module>\n        from sphinx.setup_command import BuildDoc\n    ImportError: No module named sphinx.setup_command\n    Complete output from command python setup.py egg_info:\n    Traceback (most recent call last):\n\n  File \"<string>\", line 14, in <module>\n\n  File \"/Users/bschott/Source/nova/trunk/.nova-venv/build/glance/setup.py\", line 22, in <module>\n\n    from sphinx.setup_command import BuildDoc\n\nImportError: No module named sphinx.setup_command\n\n----------------------------------------\nCommand python setup.py egg_info failed with error code 1\nStoring complete log in /Users/bschott/.pip/pip.log\nTraceback (most recent call last):\n  File \"/Users/bschott/Source/nova/trunk/.nova-venv/lib/python2.6/site-packages/pip-0.8.1-py2.6.egg/pip/runner.py\", line 16, in <module>\n    exit = run()\n  File \"/Users/bschott/Source/nova/trunk/.nova-venv/lib/python2.6/site-packages/pip-0.8.1-py2.6.egg/pip/runner.py\", line 12, in run\n    return pip.main()\n  File \"/Users/bschott/Source/nova/trunk/.nova-venv/lib/python2.6/site-packages/pip-0.8.1-py2.6.egg/pip/__init__.py\", line 116, in main\n    return command.main(initial_args, args[1:], options)\n  File \"/Users/bschott/Source/nova/trunk/.nova-venv/lib/python2.6/site-packages/pip-0.8.1-py2.6.egg/pip/basecommand.py\", line 149, in main\n    log_fp = open_logfile(log_fn, 'w')\n  File \"/Users/bschott/Source/nova/trunk/.nova-venv/lib/python2.6/site-packages/pip-0.8.1-py2.6.egg/pip/basecommand.py\", line 178, in open_logfile\n    log_fp = open(filename, mode)\nIOError: [Errno 13] Permission denied: '/Users/bschott/.pip/pip.log'\nCommand \"tools/with_venv.sh pip install -E /Users/bschott/Source/nova/trunk/.nova-venv -r /Users/bschott/Source/nova/trunk/tools/pip-requires\" failed.\nNone\nbschott@ironman:~/Source/nova/trunk$ \n\n\n\n", 
            "date_created": "2011-01-24 16:54:35.274225+00:00", 
            "author": "https://api.launchpad.net/1.0/~bfschott"
        }, 
        {
            "content": "I'm wondering why, since Nova also requires sphinx to build, there is a problem when installing Glance but not a problem when installing Nova?  There's GOT to be a better solution than requiring Sphinx in order to just build Glance...", 
            "date_created": "2011-01-24 18:12:34.285455+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "It got added to nova pip-requires as well.\n\nVish\n\nOn Jan 24, 2011, at 10:12 AM, Jay Pipes wrote:\n\n> I'm wondering why, since Nova also requires sphinx to build, there is a\n> problem when installing Glance but not a problem when installing Nova?\n> There's GOT to be a better solution than requiring Sphinx in order to\n> just build Glance...\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/706683\n> \n> Title:\n>  setup.py errors and docs won't build without sphinx\n> \n> Status in OpenStack Compute (Nova):\n>  Fix Committed\n> \n> Bug description:\n>  trying to build docs or run setup.py fails without sphinx, which isn't\n>  required by tools/pip-requires nor our wiki instructions ...\n> \n>  (.nova-venv)k:trunk kpepple$ python setup.py install\n>  Traceback (most recent call last):\n>    File \"setup.py\", line 24, in <module>\n>      from sphinx.setup_command import BuildDoc\n>  ImportError: No module named sphinx.setup_command\n> \n>  Asking to just include this as part of pip-requires so that it just\n>  works.\n> \n> \n\n", 
            "date_created": "2011-01-24 18:23:11+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "I am not seeing this sphinx problem after the pip-requires addition ... i can `run_test.sh -f` on both  glance from glance/trunk (revno 50) and nova/trunk (rev 604) without issue ... however if this is a problem elsewhere, it might be prudent include the  run_command(['tools/with_venv.sh', 'pip', 'install', '-E', venv, 'sphinx'] but probably not the argvparse as it doesn't error out", 
            "date_created": "2011-01-24 19:49:31.798935+00:00", 
            "author": "https://api.launchpad.net/1.0/~ken-pepple"
        }, 
        {
            "content": "I think I've found the bug here: the tools/pip-requires file in glance-0.1.3.tar.gz is not the same as the tools/pip-requires in glance/trunk (revno: 50). The file in the glance dist tarball is still using the pre-revno 49 version of the file. \n\nwil contact jay.pipes and/or file glance bug to see what is amiss in the dist process ...", 
            "date_created": "2011-01-24 22:19:50.806089+00:00", 
            "author": "https://api.launchpad.net/1.0/~ken-pepple"
        }, 
        {
            "content": "I am new to nova and wanted to pick up a bug to work on.  I am working on getting my development environment setup.\n\nI am on a Mac using Python 2.6.6 following the Mac instructions at : http://nova.openstack.org/devref/development.environment.html\n\nI continually run into the problem reported in the original report.\n\nIt looks as though the PIP_REQUIRES are evaluated in a different order than specified in the file (at least on my system),\nand installs glance before sphinx _or_ as Ken pointed out will pip resolve glance's dependencies on install?\n\nI am on irc if you want details on my environment.\n\n", 
            "date_created": "2011-01-24 23:34:39.244829+00:00", 
            "author": "https://api.launchpad.net/1.0/~retr0h"
        }, 
        {
            "content": "This may be a semi convoluted test, however it does indicate pip doesn't evaluate the dependencies in the order listed. \n\n$:~% pip install -r pip_deps \nDownloading/unpacking zzyzz (from -r pip_deps (line 4))\n  Could not find any downloads that satisfy the requirement zzyzz (from -r pip_deps (line 4))\nNo distributions at all found for zzyzz (from -r pip_deps (line 4))\nStoring complete log in /Users/jdewey/.pip/pip.log\n\n$:~% cat pip_deps \nfoo\nbar\nbaz\nzzyzz", 
            "date_created": "2011-01-24 23:41:13.478242+00:00", 
            "author": "https://api.launchpad.net/1.0/~retr0h"
        }, 
        {
            "content": "Ken, you're right.  We figured the change hadn't propagated out to the tarball yet.  So, pip doesn't know that glance requires sphinx.  Wasn't sure about argparse from your earlier patch, so I just included it in my hack.  I pushed this into our team hpc-trunk branch, just to keep our local hudson server happy.\n\nJohn, my fix above solves the problem in a brute-force fashion if you want to just hack your tools/install_venv.py file temporarily.  The problem is as Ken describes.  There is no guarantee on build order because pip traverses the dependency tree and the glance package is missing sphinx dependency.  Nothing to fix in nova or pip for that matter.  \n\nIf you want to tackle a mac-related bug, I've given up on my circular dependency on OpenSSL 1.0a loaded via macports.  I just let the X509 unit tests fail on mac for now.  Not sure the details.  It has been around for a long time there is NO WAY to easily revert to an older package via macports.  So, basically, this bug breaks most macports package dependencies on OpenSSL.\nhttps://bugs.launchpad.net/nova/+bug/615518\n\n", 
            "date_created": "2011-01-25 02:04:05.027715+00:00", 
            "author": "https://api.launchpad.net/1.0/~bfschott"
        }, 
        {
            "content": "Hey guys, working on cutting a new tarball for Glance as we speak...sorry for the delay. Reference: https://bugs.launchpad.net/glance/+bug/707180", 
            "date_created": "2011-01-25 16:54:32.540002+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }
    ]
}