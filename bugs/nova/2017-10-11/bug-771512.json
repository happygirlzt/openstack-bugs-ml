{
    "status": "Invalid", 
    "last_updated": "2011-08-10 07:13:46.792968+00:00", 
    "description": "Running cactus, I attempted a build of 50 VMs at once via the API and ran into a timeout where 12 of the 50 VMs timed out and are stuck in build.  The remaining went active.    \n\nfor i in `seq 1 50`; do nova boot test --flavor 1 --image 10 &  > /dev/null ; echo $i ; done\n\nAPI Limits were raised well past this in limits.py for stress testing.\n\n2011-04-26 17:36:51,852 ERROR nova.api.openstack [-] Caught error: timed out\n(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/__init__.py\", line 59, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/wsgi.py\", line 356, in __call__\n(nova.api.openstack): TRACE:     result = method(**arg_dict)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 171, in create\n(nova.api.openstack): TRACE:     injected_files=injected_files)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/api.py\", line 256, in create\n(nova.api.openstack): TRACE:     \"injected_files\": injected_files}})\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 394, in cast\n(nova.api.openstack): TRACE:     publisher = TopicPublisher(connection=conn, topic=topic)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 241, in __init__\n(nova.api.openstack): TRACE:     super(TopicPublisher, self).__init__(connection=connection)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/messaging.py\", line 653, in __init__\n(nova.api.openstack): TRACE:     self.declare()\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/messaging.py\", line 664, in declare\n(nova.api.openstack): TRACE:     auto_delete=self.auto_delete)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 240, in exchange_declare\n(nova.api.openstack): TRACE:     return self.channel.exchange_declare(exchange=exchange,\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 179, in channel\n(nova.api.openstack): TRACE:     self._channel_ref = weakref.ref(self.connection.get_channel())\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 150, in get_channel\n(nova.api.openstack): TRACE:     return self.connection.channel()\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 120, in connection\n(nova.api.openstack): TRACE:     self._connection = self._establish_connection()\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 133, in _establish_connection\n(nova.api.openstack): TRACE:     return self.create_backend().establish_connection()\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 195, in establish_connection\n(nova.api.openstack): TRACE:     connect_timeout=conninfo.connect_timeout)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/connection.py\", line 125, in __init__\n(nova.api.openstack): TRACE:     self.transport = create_transport(host, connect_timeout, ssl)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/transport.py\", line 220, in create_transport\n(nova.api.openstack): TRACE:     return TCPTransport(host, connect_timeout)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/transport.py\", line 58, in __init__\n(nova.api.openstack): TRACE:     self.sock.connect((host, port))\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/greenio.py\", line 178, in connect\n(nova.api.openstack): TRACE:     timeout_exc=socket.timeout(\"timed out\"))\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/hubs/__init__.py\", line 121, in trampoline\n(nova.api.openstack): TRACE:     return hub.switch()\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/hubs/hub.py\", line 177, in switch\n(nova.api.openstack): TRACE:     return self.greenlet.switch()\n(nova.api.openstack): TRACE: timeout: timed out\n(nova.api.openstack): TRACE:", 
    "tags": [], 
    "importance": "High", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/771512", 
    "owner": "https://api.launchpad.net/1.0/~cbehrens", 
    "id": 771512, 
    "index": 402, 
    "created": "2011-04-26 21:45:59.028404+00:00", 
    "title": "Timeout from API with 50 Simultaneous Builds", 
    "comments": [
        {
            "content": "Running cactus, I attempted a build of 50 VMs at once via the API and ran into a timeout where 12 of the 50 VMs timed out and are stuck in build.  The remaining went active.    \n\nfor i in `seq 1 50`; do nova boot test --flavor 1 --image 10 &  > /dev/null ; echo $i ; done\n\nAPI Limits were raised well past this in limits.py for stress testing.\n\n2011-04-26 17:36:51,852 ERROR nova.api.openstack [-] Caught error: timed out\n(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/__init__.py\", line 59, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/wsgi.py\", line 356, in __call__\n(nova.api.openstack): TRACE:     result = method(**arg_dict)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 171, in create\n(nova.api.openstack): TRACE:     injected_files=injected_files)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/api.py\", line 256, in create\n(nova.api.openstack): TRACE:     \"injected_files\": injected_files}})\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 394, in cast\n(nova.api.openstack): TRACE:     publisher = TopicPublisher(connection=conn, topic=topic)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 241, in __init__\n(nova.api.openstack): TRACE:     super(TopicPublisher, self).__init__(connection=connection)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/messaging.py\", line 653, in __init__\n(nova.api.openstack): TRACE:     self.declare()\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/messaging.py\", line 664, in declare\n(nova.api.openstack): TRACE:     auto_delete=self.auto_delete)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 240, in exchange_declare\n(nova.api.openstack): TRACE:     return self.channel.exchange_declare(exchange=exchange,\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 179, in channel\n(nova.api.openstack): TRACE:     self._channel_ref = weakref.ref(self.connection.get_channel())\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 150, in get_channel\n(nova.api.openstack): TRACE:     return self.connection.channel()\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 120, in connection\n(nova.api.openstack): TRACE:     self._connection = self._establish_connection()\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 133, in _establish_connection\n(nova.api.openstack): TRACE:     return self.create_backend().establish_connection()\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 195, in establish_connection\n(nova.api.openstack): TRACE:     connect_timeout=conninfo.connect_timeout)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/connection.py\", line 125, in __init__\n(nova.api.openstack): TRACE:     self.transport = create_transport(host, connect_timeout, ssl)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/transport.py\", line 220, in create_transport\n(nova.api.openstack): TRACE:     return TCPTransport(host, connect_timeout)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/transport.py\", line 58, in __init__\n(nova.api.openstack): TRACE:     self.sock.connect((host, port))\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/greenio.py\", line 178, in connect\n(nova.api.openstack): TRACE:     timeout_exc=socket.timeout(\"timed out\"))\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/hubs/__init__.py\", line 121, in trampoline\n(nova.api.openstack): TRACE:     return hub.switch()\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/hubs/hub.py\", line 177, in switch\n(nova.api.openstack): TRACE:     return self.greenlet.switch()\n(nova.api.openstack): TRACE: timeout: timed out\n(nova.api.openstack): TRACE:", 
            "date_created": "2011-04-26 21:45:59.028404+00:00", 
            "author": "https://api.launchpad.net/1.0/~antonym"
        }, 
        {
            "content": "I've managed to reproduce this locally by stubbing out quotas, ratelimiting, and the virt driver.", 
            "date_created": "2011-04-26 23:48:55.118710+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "My current working hypothesis is that something in Nova is blocking. This causes the connect_timeout to trigger (because once eventlet context switches back into the main greenthread (or whatever it is that it does)), the timeout has expired without being cancelled. This would explain the log message in rabbit saying that the connection was abruptly terminated (meaning the connection was actually established, in spite of Nova saying it timed out).\n\nIf that's indeed the case, yes, we shouldn't be blocking, but eventlet also should check if the connection has been established before it kills the connection attempt.", 
            "date_created": "2011-04-27 00:18:18.702596+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "Full logs from api and scheduler from 50 instance build:\n\nhttp://paste.openstack.org/show/1271/ - nova-api\nhttp://paste.openstack.org/show/1272/ - nova-scheduler", 
            "date_created": "2011-04-27 22:36:10.721075+00:00", 
            "author": "https://api.launchpad.net/1.0/~antonym"
        }, 
        {
            "content": "I'm still blaming eventlet for this. Looking at the logs, it looks like the sheer volume of requests simply makes it take more than 5 seconds before the event loop in eventlet gets back to the attempt to establish a connection. We can optimise the time-per-request, but that'll won't solve anything, it'll just hide the problem until we try 100 or 200 requests at a time. Same if we increase the timeout.", 
            "date_created": "2011-05-04 20:58:15.811960+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "Wasn't there some idea that this was because nova-api doesn't monkeypatch all of the libraries?\n\nVish\n\nOn May 4, 2011, at 1:58 PM, Soren Hansen wrote:\n\n> I'm still blaming eventlet for this. Looking at the logs, it looks like\n> the sheer volume of requests simply makes it take more than 5 seconds\n> before the event loop in eventlet gets back to the attempt to establish\n> a connection. We can optimise the time-per-request, but that'll won't\n> solve anything, it'll just hide the problem until we try 100 or 200\n> requests at a time. Same if we increase the timeout.\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/771512\n> \n> Title:\n>  Timeout from API with 50 Simultaneous Builds\n> \n> Status in OpenStack Compute (Nova):\n>  Confirmed\n> \n> Bug description:\n>  Running cactus, I attempted a build of 50 VMs at once via the API and\n>  ran into a timeout where 12 of the 50 VMs timed out and are stuck in\n>  build.  The remaining went active.\n> \n>  for i in `seq 1 50`; do nova boot test --flavor 1 --image 10 &  >\n>  /dev/null ; echo $i ; done\n> \n>  API Limits were raised well past this in limits.py for stress testing.\n> \n>  2011-04-26 17:36:51,852 ERROR nova.api.openstack [-] Caught error: timed out\n>  (nova.api.openstack): TRACE: Traceback (most recent call last):\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/__init__.py\", line 59, in __call__\n>  (nova.api.openstack): TRACE:     return req.get_response(self.application)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n>  (nova.api.openstack): TRACE:     application, catch_exc_info=False)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n>  (nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n>  (nova.api.openstack): TRACE:     return resp(environ, start_response)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n>  (nova.api.openstack): TRACE:     return resp(environ, start_response)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n>  (nova.api.openstack): TRACE:     return resp(environ, start_response)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n>  (nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n>  (nova.api.openstack): TRACE:     return resp(environ, start_response)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n>  (nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n>  (nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/wsgi.py\", line 356, in __call__\n>  (nova.api.openstack): TRACE:     result = method(**arg_dict)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 171, in create\n>  (nova.api.openstack): TRACE:     injected_files=injected_files)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/api.py\", line 256, in create\n>  (nova.api.openstack): TRACE:     \"injected_files\": injected_files}})\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 394, in cast\n>  (nova.api.openstack): TRACE:     publisher = TopicPublisher(connection=conn, topic=topic)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 241, in __init__\n>  (nova.api.openstack): TRACE:     super(TopicPublisher, self).__init__(connection=connection)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/messaging.py\", line 653, in __init__\n>  (nova.api.openstack): TRACE:     self.declare()\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/messaging.py\", line 664, in declare\n>  (nova.api.openstack): TRACE:     auto_delete=self.auto_delete)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 240, in exchange_declare\n>  (nova.api.openstack): TRACE:     return self.channel.exchange_declare(exchange=exchange,\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 179, in channel\n>  (nova.api.openstack): TRACE:     self._channel_ref = weakref.ref(self.connection.get_channel())\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 150, in get_channel\n>  (nova.api.openstack): TRACE:     return self.connection.channel()\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 120, in connection\n>  (nova.api.openstack): TRACE:     self._connection = self._establish_connection()\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/connection.py\", line 133, in _establish_connection\n>  (nova.api.openstack): TRACE:     return self.create_backend().establish_connection()\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/backends/pyamqplib.py\", line 195, in establish_connection\n>  (nova.api.openstack): TRACE:     connect_timeout=conninfo.connect_timeout)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/connection.py\", line 125, in __init__\n>  (nova.api.openstack): TRACE:     self.transport = create_transport(host, connect_timeout, ssl)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/transport.py\", line 220, in create_transport\n>  (nova.api.openstack): TRACE:     return TCPTransport(host, connect_timeout)\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/amqplib/client_0_8/transport.py\", line 58, in __init__\n>  (nova.api.openstack): TRACE:     self.sock.connect((host, port))\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/greenio.py\", line 178, in connect\n>  (nova.api.openstack): TRACE:     timeout_exc=socket.timeout(\"timed out\"))\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/hubs/__init__.py\", line 121, in trampoline\n>  (nova.api.openstack): TRACE:     return hub.switch()\n>  (nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/eventlet/hubs/hub.py\", line 177, in switch\n>  (nova.api.openstack): TRACE:     return self.greenlet.switch()\n>  (nova.api.openstack): TRACE: timeout: timed out\n>  (nova.api.openstack): TRACE:\n\n", 
            "date_created": "2011-05-04 21:08:07+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "2011/5/4 Vish Ishaya <email address hidden>:\n> Wasn't there some idea that this was because nova-api doesn't\n> monkeypatch all of the libraries?\n\nThere was. It wasn't.\n", 
            "date_created": "2011-05-04 21:32:42+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "Reproduced outside of Nova (in accordance with my previous analysis). Reported it upstream:\n\n    https://bitbucket.org/which_linden/eventlet/issue/87/socket-connects-are-incorrectly-reported\n\nI think we can say at this point that the problem is well understood and just needs someone to fix it. Marking Triaged accordingly.", 
            "date_created": "2011-05-10 15:31:46.664713+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "In my opinion, this should be a Critical priority bug...", 
            "date_created": "2011-05-10 16:29:06.184538+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Additionally (another bug?), OS API really needs to take a num_instances parameter like EC2 so we can get the benefits of the load balancer/scheduler. ", 
            "date_created": "2011-05-10 16:42:01.426147+00:00", 
            "author": "https://api.launchpad.net/1.0/~sandy-walsh"
        }, 
        {
            "content": "I added a comment to the above bitbucket thread with a potential patch.  I'll attach it here as well.  Comments are in the patch along with more on the bitbucket thread.", 
            "date_created": "2011-05-11 08:29:44.466644+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "My above patch makes an improvement, but there's still timeouts.  Unclear whether the timeouts are real or not yet.  However, after talking with soren again, I've decided to try to fix eventlet more correctly by checking if a timeout exception was returned... and then re-trying a non-blocking event once more.  If this 2nd non-blocking event fails, it returns original timeout exception. Attached is a start to the patch.  My test case passes, but I need to fix the rest of the socket wrapper calls, yet.  I've done connect(), recv(), recvfrom() so far.  (See attached patch).", 
            "date_created": "2011-05-12 07:28:38.246486+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "Sorry, the connect_ex() modification was wrong in the above.  Here's an updated version of patch.", 
            "date_created": "2011-05-12 07:34:10.903636+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "Maybe finished version, though it appears some tests need fixed.  Either way, tests are failing in eventlet trunk without this patch.", 
            "date_created": "2011-05-12 10:00:46.817336+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "I have tested the above patch with 50 simultaneous builds and the timeouts are gone.\n\n(Additionally, after testing this and applying the merge prop diff for: https://bugs.launchpad.net/nova/+bug/766404\nand a proposed fix for: https://bugs.launchpad.net/nova/+bug/781435\n\nwe can now get 50 instances all in the ACTIVE state when building them in parallel.  Woo!)\n\nThere's another issue when we go to 100 instances, now.  Getting lots of 'IOError: Socket closed' when carrot tries to connect to rabbit.  Ultimately, I think we need to make some changes to nova-api to make it handle this level of concurrent sessions.  I have some ideas, but I want to look at the api code, which I'm not that familiar with, before I make some statements that might be idiotic. :)\n", 
            "date_created": "2011-05-13 04:54:07.777267+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "About Importance: I think \"High\" is about right, the impact is very serious but does not disable completely the use of the system, corrupts or exposes your data. See bottom of http://wiki.openstack.org/BugsLifecycle for guidelines.\n\nThat said, it's very much something we need to fix ASAP, so it should be targeted to a milestone :) Importance/Impact and urgency being two different (though very inter-related) things.", 
            "date_created": "2011-05-16 09:30:58.516160+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Linked lp:~cbehrens/nova/rpc-improvements here also.  This implements a connection pool for connections to rabbit, as well as changes the 3 Service topic consumers to use a single connection that has a single wait() for events.  That eliminates 3 threads that are reach repeatedly polling rabbit every 0.1 seconds.\n\nAll of that should:\n\n1) Reduce bombing rabbit with new connections\n2) Reduce overall number of connections to rabbit\n3) Reduce a lot of context switches\n4) Remove possible unnecessary 0.1 second delay in services processing requests.\n\netc.", 
            "date_created": "2011-05-18 05:25:01.473658+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "Thanks, Chris!\n\nI've applied your changes and it allowed me run 400 instances on 3 nodes without errors for the first time!\n\n(RHEL6, KVM)", 
            "date_created": "2011-05-18 11:46:42.689288+00:00", 
            "author": "https://api.launchpad.net/1.0/~abrindeyev"
        }, 
        {
            "content": "This bug was fixed in the package python-eventlet - 0.9.15-0ubuntu2\n\n---------------\npython-eventlet (0.9.15-0ubuntu2) oneiric; urgency=low\n\n  * retry-on-timeout.patch: This addresses a problem where a timeout fires\n    even though the connection was actually correctly established. (LP:\n    #771512)\n  * reuseaddr.patch: Make sure SO_REUSEADDR is set.\n  * mysql-import-traceback.patch: Add missing import in the mysql tests.\n  * Add python-greenlet dependency.\n -- Soren Hansen <email address hidden>   Wed, 25 May 2011 22:02:42 +0200", 
            "date_created": "2011-05-25 20:05:17.432477+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}