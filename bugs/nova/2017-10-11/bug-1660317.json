{
    "status": "Fix Released", 
    "last_updated": "2017-04-14 09:24:22.380674+00:00", 
    "description": "When baremetal instance deleted there is a harmless but annoying trace in nova-compute output.\n\nnova.compute.manager[26553]: INFO [instance: e265be67-9e87-44ea-95b6-641fc2dcaad8] Terminating instance [req-5f1eba69-239a-4dd4-8677-f28542b190bc 5a08515f35d749068a6327e387ca04e2 7d450ecf00d64399aeb93bc122cb6dae - - -]\nnova.compute.resource_tracker[26553]: INFO Auditing locally available compute resources for node d02c7361-5e3a-4fdf-89b5-f29b3901f0fc [req-d34e2b7b-386f-4a3c-ae85-16860a4a9c28 - - - - -]\nnova.compute.resource_tracker[26553]: INFO Final resource view: name=d02c7361-5e3a-4fdf-89b5-f29b3901f0fc phys_ram=0MB used_ram=8096MB phys_disk=0GB used_disk=480GB total_vcpus=0 used_vcpus=0 pci_stats=[] [req-d34e2b7b-386f-4a3c-ae85-16860a4a9c28 - - - - -]\nnova.compute.resource_tracker[26553]: INFO Compute_service record updated for bare-compute1:d02c7361-5e3a-4fdf-89b5-f29b3901f0fc [req-d34e2b7b-386f-4a3c-ae85-16860a4a9c28 - - - - -]\nnova.compute.manager[26553]: INFO [instance: e265be67-9e87-44ea-95b6-641fc2dcaad8] Neutron deleted interface 6b563aa7-64d3-4105-9ed5-c764fee7b536; detaching it from the instance and deleting it from the info cache [req-fdfeee26-a860-40a5-b2e3-2505973ffa75 11b95cf353f74788938f580e13b652d8 93c697ef6c2649eb9966900a8d6a73d8 - - -]\noslo_messaging.rpc.server[26553]: ERROR Exception during message handling [req-fdfeee26-a860-40a5-b2e3-2505973ffa75 11b95cf353f74788938f580e13b652d8 93c697ef6c2649eb9966900a8d6a73d8 - - -]\noslo_messaging.rpc.server[26553]: TRACE Traceback (most recent call last):\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming\noslo_messaging.rpc.server[26553]: TRACE     res = self.dispatcher.dispatch(message)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\noslo_messaging.rpc.server[26553]: TRACE     return self._do_dispatch(endpoint, method, ctxt, args)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch\noslo_messaging.rpc.server[26553]: TRACE     result = func(ctxt, **new_args)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/exception_wrapper.py\", line 75, in wrapped\noslo_messaging.rpc.server[26553]: TRACE     function_name, call_dict, binary)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\noslo_messaging.rpc.server[26553]: TRACE     self.force_reraise()\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\noslo_messaging.rpc.server[26553]: TRACE     six.reraise(self.type_, self.value, self.tb)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/exception_wrapper.py\", line 66, in wrapped\noslo_messaging.rpc.server[26553]: TRACE     return f(self, context, *args, **kw)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6691, in external_instance_event\noslo_messaging.rpc.server[26553]: TRACE     event.tag)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6660, in _process_instance_vif_deleted_event\noslo_messaging.rpc.server[26553]: TRACE     self.driver.detach_interface(instance, vif)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/virt/driver.py\", line 524, in detach_interface\noslo_messaging.rpc.server[26553]: TRACE     raise NotImplementedError()\noslo_messaging.rpc.server[26553]: TRACE NotImplementedError\noslo_messaging.rpc.server[26553]: TRACE\n\n\nAffected version:\nnova 14.0.3\nneutron 6.0.0\nironic 6.2.1\n\nconfiguration for nova-compute:\ncompute_driver = ironic.IronicDriver\n\nIronic is configured to use neutron networks with generic switch as mechanism driver for ML2 pluging.", 
    "tags": [
        "ironic", 
        "nova-driver"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1660317", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1660317, 
    "index": 6645, 
    "created": "2017-01-30 12:23:36.480809+00:00", 
    "title": "NotImplementedError for detach_interface in nova-compute during instance deletion", 
    "comments": [
        {
            "content": "When baremetal instance deleted there is a harmless but annoying trace in nova-compute output.\n\nnova.compute.manager[26553]: INFO [instance: e265be67-9e87-44ea-95b6-641fc2dcaad8] Terminating instance [req-5f1eba69-239a-4dd4-8677-f28542b190bc 5a08515f35d749068a6327e387ca04e2 7d450ecf00d64399aeb93bc122cb6dae - - -]\nnova.compute.resource_tracker[26553]: INFO Auditing locally available compute resources for node d02c7361-5e3a-4fdf-89b5-f29b3901f0fc [req-d34e2b7b-386f-4a3c-ae85-16860a4a9c28 - - - - -]\nnova.compute.resource_tracker[26553]: INFO Final resource view: name=d02c7361-5e3a-4fdf-89b5-f29b3901f0fc phys_ram=0MB used_ram=8096MB phys_disk=0GB used_disk=480GB total_vcpus=0 used_vcpus=0 pci_stats=[] [req-d34e2b7b-386f-4a3c-ae85-16860a4a9c28 - - - - -]\nnova.compute.resource_tracker[26553]: INFO Compute_service record updated for bare-compute1:d02c7361-5e3a-4fdf-89b5-f29b3901f0fc [req-d34e2b7b-386f-4a3c-ae85-16860a4a9c28 - - - - -]\nnova.compute.manager[26553]: INFO [instance: e265be67-9e87-44ea-95b6-641fc2dcaad8] Neutron deleted interface 6b563aa7-64d3-4105-9ed5-c764fee7b536; detaching it from the instance and deleting it from the info cache [req-fdfeee26-a860-40a5-b2e3-2505973ffa75 11b95cf353f74788938f580e13b652d8 93c697ef6c2649eb9966900a8d6a73d8 - - -]\noslo_messaging.rpc.server[26553]: ERROR Exception during message handling [req-fdfeee26-a860-40a5-b2e3-2505973ffa75 11b95cf353f74788938f580e13b652d8 93c697ef6c2649eb9966900a8d6a73d8 - - -]\noslo_messaging.rpc.server[26553]: TRACE Traceback (most recent call last):\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming\noslo_messaging.rpc.server[26553]: TRACE     res = self.dispatcher.dispatch(message)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\noslo_messaging.rpc.server[26553]: TRACE     return self._do_dispatch(endpoint, method, ctxt, args)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch\noslo_messaging.rpc.server[26553]: TRACE     result = func(ctxt, **new_args)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/exception_wrapper.py\", line 75, in wrapped\noslo_messaging.rpc.server[26553]: TRACE     function_name, call_dict, binary)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\noslo_messaging.rpc.server[26553]: TRACE     self.force_reraise()\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\noslo_messaging.rpc.server[26553]: TRACE     six.reraise(self.type_, self.value, self.tb)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/exception_wrapper.py\", line 66, in wrapped\noslo_messaging.rpc.server[26553]: TRACE     return f(self, context, *args, **kw)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6691, in external_instance_event\noslo_messaging.rpc.server[26553]: TRACE     event.tag)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6660, in _process_instance_vif_deleted_event\noslo_messaging.rpc.server[26553]: TRACE     self.driver.detach_interface(instance, vif)\noslo_messaging.rpc.server[26553]: TRACE   File \"/usr/lib/python2.7/dist-packages/nova/virt/driver.py\", line 524, in detach_interface\noslo_messaging.rpc.server[26553]: TRACE     raise NotImplementedError()\noslo_messaging.rpc.server[26553]: TRACE NotImplementedError\noslo_messaging.rpc.server[26553]: TRACE\n\n\nAffected version:\nnova 14.0.3\nneutron 6.0.0\nironic 6.2.1\n\nconfiguration for nova-compute:\ncompute_driver = ironic.IronicDriver\n\nIronic is configured to use neutron networks with generic switch as mechanism driver for ML2 pluging.", 
            "date_created": "2017-01-30 12:23:36.480809+00:00", 
            "author": "https://api.launchpad.net/1.0/~george-shuklin"
        }, 
        {
            "content": "Could I just confirm that the versions are correct? Notably, the nova one (14.0.3). A quick perusal of the code suggests this shouldn't happen [1]. The linked change exists in stable/newton, from what I can tell.\n\n  $ git branch --contains 4ad414f3\n  * master\n    stable/newton\n\n[1] https://github.com/openstack/nova/commit/4ad414f3b1216393301ef268a64e61ca1a3d5be9", 
            "date_created": "2017-01-31 13:23:37.875579+00:00", 
            "author": "https://api.launchpad.net/1.0/~stephenfinucane"
        }, 
        {
            "content": "It is 14.0.3. I rechecked it now: nova-14.0.3 on host, that patch is present in the code running on server. (And I restarted all novas, nova-compute, conductor and api, after upgrade).\n\nIt happens on each port. If instance have 2 ports, there are two traces.\n\nI just reconfirm it, it still happens.\n", 
            "date_created": "2017-01-31 13:44:37.686040+00:00", 
            "author": "https://api.launchpad.net/1.0/~george-shuklin"
        }, 
        {
            "content": "This is separate from the detach_interface API, it's an async event from neutron that the vif was unplugged, which the compute manager tries to detach the interface, but the Ironic virt driver doesn't implement that method since it doesn't attach/detach interfaces (but plugs/unplugs vifs on server create/destroy).", 
            "date_created": "2017-02-02 00:01:03.813601+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/427974", 
            "date_created": "2017-02-02 00:05:15.490202+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/427974\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=00c0830c3e227b3a278cf10cfd68f724e433f38c\nSubmitter: Jenkins\nBranch:    master\n\ncommit 00c0830c3e227b3a278cf10cfd68f724e433f38c\nAuthor: Matt Riedemann <email address hidden>\nDate:   Wed Feb 1 19:03:03 2017 -0500\n\n    Handle NotImplementedError in _process_instance_vif_deleted_event\n    \n    The Ironic virt driver does not support attach/detach of VIFs (yet)\n    so when Neutron sends an asynchronous event back to Nova that\n    VIFs were unplugged on instance delete, we do not need to trace\n    all over the logs when the Ironic driver does not implement\n    detach_interface().\n    \n    Change-Id: I6f6533322c1179b3396e56b37c4f3f4228d8da01\n    Closes-Bug: #1660317\n", 
            "date_created": "2017-02-03 21:13:17.993272+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This occurred in, and was fixed in, nova. Marking invalid for Ironic.", 
            "date_created": "2017-02-06 18:54:09.968206+00:00", 
            "author": "https://api.launchpad.net/1.0/~jason-oldos"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b1 development milestone.", 
            "date_created": "2017-04-14 09:24:21.473770+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}