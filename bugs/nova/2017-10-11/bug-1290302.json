{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:14:01.973407+00:00", 
    "description": "With current nova in master, when booting an instance using an existing volume without specifying the device_name fails with the following traceback in nova compute:\n\n$ nova boot --boot-volume f1f2de9c-eedf-41cf-9089-a41ec0706b3e --flavor m1.custom --key-name default server --poll\n\n2014-03-10 05:48:27.735 DEBUG oslo.messaging._drivers.amqp [-] UNIQUE_ID is 38af8a6ad88649449919434f9facd899. from (pid=21192) _add_unique_id /opt/stack/oslo.messaging/oslo/messaging/_drivers/amqp.py:338\n2014-03-10 05:48:27.750 ERROR nova.compute.manager [req-f7b15296-7be8-4cc5-9e8c-1ea3658baa7e admin admin] [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] Error: '<class 'nova.objects.block_device.BlockDeviceMapping'>' object has no attribute 'mount_device'\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] Traceback (most recent call last):\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1242, in _build_instance\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     bdms)\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1573, in _default_block_device_names\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     root_bdm)\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1530, in _default_root_device_name\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     root_bdm)\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5084, in default_root_device_name\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     cdrom_bus)\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/virt/libvirt/blockinfo.py\", line 422, in get_root_info\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     if not get_device_name(root_bdm) and root_device_name:\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/virt/libvirt/blockinfo.py\", line 392, in get_device_name\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     return bdm.get('device_name') or bdm.get('mount_device')\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/objects/base.py\", line 411, in get\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     self.__class__, key))\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] AttributeError: '<class 'nova.objects.block_device.BlockDeviceMapping'>' object has no attribute 'mount_device'\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] \n2014-03-10 05:48:27.753 DEBUG nova.compute.utils [req-f7b15296-7be8-4cc5-9e8c-1ea3658baa7e admin admin] [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] Build of instance 7ce5a209-49a3-417b-aa0d-0ccf066dc660 was re-scheduled: '<class 'nova.objects.block_device.BlockDeviceMapping'>' object has no attribute 'mount_device' from (pid=21192) notify_about_instance_usage /opt/stack/nova/nova/compute/utils.py:334\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] Traceback (most recent call last):\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1134, in _run_instance\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     instance, image_meta, legacy_bdm_in_spec)\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1293, in _build_instance\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     reason=unicode(exc_info[1]))\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] RescheduledException: Build of instance 7ce5a209-49a3-417b-aa0d-0ccf066dc660 was re-scheduled: '<class 'nova.objects.block_device.BlockDeviceMapping'>' object has no attribute 'mount_device'\n2014-03-10 05:48:27.753 TRACE nova.compute.", 
    "tags": [
        "libvirt"
    ], 
    "importance": "High", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1290302", 
    "owner": "https://api.launchpad.net/1.0/~ndipanov", 
    "id": 1290302, 
    "index": 1418, 
    "created": "2014-03-10 10:15:12.447710+00:00", 
    "title": "Booting from volume fails when the device_name is not specified", 
    "comments": [
        {
            "content": "With current nova in master, when booting an instance using an existing volume without specifying the device_name fails with the following traceback in nova compute:\n\n$ nova boot --boot-volume f1f2de9c-eedf-41cf-9089-a41ec0706b3e --flavor m1.custom --key-name default server --poll\n\n2014-03-10 05:48:27.735 DEBUG oslo.messaging._drivers.amqp [-] UNIQUE_ID is 38af8a6ad88649449919434f9facd899. from (pid=21192) _add_unique_id /opt/stack/oslo.messaging/oslo/messaging/_drivers/amqp.py:338\n2014-03-10 05:48:27.750 ERROR nova.compute.manager [req-f7b15296-7be8-4cc5-9e8c-1ea3658baa7e admin admin] [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] Error: '<class 'nova.objects.block_device.BlockDeviceMapping'>' object has no attribute 'mount_device'\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] Traceback (most recent call last):\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1242, in _build_instance\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     bdms)\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1573, in _default_block_device_names\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     root_bdm)\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1530, in _default_root_device_name\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     root_bdm)\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5084, in default_root_device_name\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     cdrom_bus)\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/virt/libvirt/blockinfo.py\", line 422, in get_root_info\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     if not get_device_name(root_bdm) and root_device_name:\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/virt/libvirt/blockinfo.py\", line 392, in get_device_name\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     return bdm.get('device_name') or bdm.get('mount_device')\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/objects/base.py\", line 411, in get\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     self.__class__, key))\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] AttributeError: '<class 'nova.objects.block_device.BlockDeviceMapping'>' object has no attribute 'mount_device'\n2014-03-10 05:48:27.750 TRACE nova.compute.manager [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] \n2014-03-10 05:48:27.753 DEBUG nova.compute.utils [req-f7b15296-7be8-4cc5-9e8c-1ea3658baa7e admin admin] [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] Build of instance 7ce5a209-49a3-417b-aa0d-0ccf066dc660 was re-scheduled: '<class 'nova.objects.block_device.BlockDeviceMapping'>' object has no attribute 'mount_device' from (pid=21192) notify_about_instance_usage /opt/stack/nova/nova/compute/utils.py:334\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] Traceback (most recent call last):\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1134, in _run_instance\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     instance, image_meta, legacy_bdm_in_spec)\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1293, in _build_instance\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660]     reason=unicode(exc_info[1]))\n2014-03-10 05:48:27.753 TRACE nova.compute.utils [instance: 7ce5a209-49a3-417b-aa0d-0ccf066dc660] RescheduledException: Build of instance 7ce5a209-49a3-417b-aa0d-0ccf066dc660 was re-scheduled: '<class 'nova.objects.block_device.BlockDeviceMapping'>' object has no attribute 'mount_device'\n2014-03-10 05:48:27.753 TRACE nova.compute.", 
            "date_created": "2014-03-10 10:15:12.447710+00:00", 
            "author": "https://api.launchpad.net/1.0/~xqueralt-deactivatedaccount"
        }, 
        {
            "content": "Posted a fix here - https://review.openstack.org/#/c/79319/1\n\nNot sure why LP didn't pick it up.", 
            "date_created": "2014-03-10 13:22:10.836072+00:00", 
            "author": "https://api.launchpad.net/1.0/~ndipanov"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/79319\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=181bcf77c429ecdde1f28b1884f0aa9144eb0851\nSubmitter: Jenkins\nBranch:    master\n\ncommit 181bcf77c429ecdde1f28b1884f0aa9144eb0851\nAuthor: Nikola Dipanov <email address hidden>\nDate:   Mon Mar 10 13:56:54 2014 +0100\n\n    libvirt: fix blockinfo get_device_name helper\n    \n    Currently all the methods in libvirt's blockinfo module will either\n    be called with block device objects (when attempting to default device\n    names)  or with a DriverBlockDevice subclass (all other operations in\n    the virt driver that expect such format to be passed).\n    \n    This patch updates the get_device_name method to honor the above\n    situation introduced by I055651b5fd415092787d9487a69467a9bbcf073e.\n    \n    Closes-bug: #1290302\n    Change-Id: I7099ea4502da2108c4bcba530a8ace173d2dafc9\n", 
            "date_created": "2014-03-12 02:13:32.485511+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}