{
    "status": "Invalid", 
    "last_updated": "2013-06-14 21:54:50.220683+00:00", 
    "description": "CI tests for mysql fail when running from run_tests.sh\n\nRunning './run_tests.sh test_mysql_opportunistically' on a setup with both postgres and mysql CI testing configured fails. \n\nkrtaylor:~/test/nova$ cat /etc/issue\nUbuntu 12.10 \\n \\l\n\nkrtaylor:~/test/nova$ git log -1\ncommit 3ddd1aeda69b1d8d0bc689fea8d4c2c530d55fc0\nMerge: 1cad17a 78ebb44\nAuthor: Jenkins <email address hidden>\nDate:   Tue Jan 29 12:22:20 2013 +0000\n\n    Merge \"Merge LibvirtBridgeDriver class into LibvirtGenericVIFDriver\"\nkrtaylor:~/test/nova$ sudo ./run_tests.sh test_mysql_opportunistically\nRunning `tools/with_venv.sh python setup.py testr  --slowest --testr-args='test_mysql_opportunistically'`\nrunning testr\nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests --list \nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests  --load-list /tmp/tmpOVMbTQ\n2013-01-29 07:53:12.701 23007 WARNING nova.virt.libvirt.firewall [-] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\n======================================================================\nERROR: nova.tests.test_migrations.TestMigrations.test_mysql_opportunistically\ntags: worker-0\n----------------------------------------------------------------------\nEmpty attachments:\n  stdout\n\npythonlogging:'nova': {{{\nLoading network driver 'nova.network.linux_net'\nThis shouldn't be getting called except during testing.\nThis shouldn't be getting called except during testing.\n}}}\n\nstderr: {{{\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'bw_in'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'bw_out'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'last_ctr_in'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'last_ctr_out'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'tot_reads'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'tot_read_bytes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'tot_writes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'tot_write_bytes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'curr_reads'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'curr_read_bytes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'curr_writes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'curr_write_bytes'\n  default, primary_key))\n}}}\n\nTraceback (most recent call last):\n  File \"/home/krtaylor/test/nova/nova/tests/test_migrations.py\", line 233, in test_mysql_opportunistically\n    self._check_mysql_migration_149(engine)\n  File \"/home/krtaylor/test/nova/nova/tests/test_migrations.py\", line 303, in _check_mysql_migration_149\n    self._reset_databases()\n  File \"/home/krtaylor/test/nova/nova/tests/test_migrations.py\", line 175, in _reset_databases\n    execute_cmd(cmd)\n  File \"/home/krtaylor/test/nova/nova/tests/test_migrations.py\", line 143, in execute_cmd\n    status, output = commands.getstatusoutput(cmd)\n  File \"/usr/lib/python2.7/commands.py\", line 60, in getstatusoutput\n    text = pipe.read()\n  File \"/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/fixtures/_fixtures/timeout.py\", line 52, in signal_handler\n    raise TimeoutException()\nTimeoutException\nRan 1 tests in 60.202s (-0.150s)\nFAILED (id=5, failures=1)\nerror: testr failed (1)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1105284", 
    "owner": "None", 
    "id": 1105284, 
    "index": 3352, 
    "created": "2013-01-25 17:18:08.164577+00:00", 
    "title": "mysql CI tests fail when run from run_tests.sh", 
    "comments": [
        {
            "content": "CI tests for mysql fail when running from run_tests.sh \n\n ./run_tests.sh test_migrations\n\nproduces:\n\nRunning `tools/with_venv.sh python setup.py testr  --slowest --testr-args='test_migrations'`\nrunning testr\nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests --list \nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests  --load-list /tmp/tmpEOu9qL\nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests  --load-list /tmp/tmpYFNxPy\nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests  --load-list /tmp/tmpkEVjZa\nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests  --load-list /tmp/tmpahYIMP\nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests  --load-list /tmp/tmpuut7hQ\nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests  --load-list /tmp/tmp_GsOct\nrunning=OS_STDOUT_CAPTURE=1 OS_STDERR_CAPTURE=1 OS_TEST_TIMEOUT=60 ${PYTHON:-python} -m subunit.run discover -t ./ ./nova/tests  --load-list /tmp/tmpjvOYP4\n2013-01-25 12:08:50.298 30027 WARNING nova.virt.libvirt.firewall [-] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\n2013-01-25 12:08:50.298 30029 WARNING nova.virt.libvirt.firewall [-] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\n2013-01-25 12:08:50.301 30039 WARNING nova.virt.libvirt.firewall [-] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\n2013-01-25 12:08:50.305 30033 WARNING nova.virt.libvirt.firewall [-] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\n2013-01-25 12:08:50.308 30031 WARNING nova.virt.libvirt.firewall [-] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\n2013-01-25 12:08:50.327 30035 WARNING nova.virt.libvirt.firewall [-] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\n2013-01-25 12:08:50.331 30037 WARNING nova.virt.libvirt.firewall [-] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\n======================================================================\nERROR: nova.tests.test_migrations.TestMigrations.test_mysql_opportunistically\ntags: worker-0\n----------------------------------------------------------------------\nEmpty attachments:\n  stdout\n\npythonlogging:'nova': {{{\nLoading network driver 'nova.network.linux_net'\nThis shouldn't be getting called except during testing.\nThis shouldn't be getting called except during testing.\n}}}\n\nstderr: {{{\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'bw_in'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'bw_out'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'last_ctr_in'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'last_ctr_out'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'tot_reads'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'tot_read_bytes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'tot_writes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'tot_write_bytes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'curr_reads'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'curr_read_bytes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'curr_writes'\n  default, primary_key))\n/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/dialects/sqlite/base.py:723: SAWarning: Did not recognize type 'BIGINT' of column 'curr_write_bytes'\n  default, primary_key))\n}}}\n\nTraceback (most recent call last):\n  File \"/home/krtaylor/test/nova/nova/tests/test_migrations.py\", line 233, in test_mysql_opportunistically\n    self._check_mysql_migration_149(engine)\n  File \"/home/krtaylor/test/nova/nova/tests/test_migrations.py\", line 303, in _check_mysql_migration_149\n    self._reset_databases()\n  File \"/home/krtaylor/test/nova/nova/tests/test_migrations.py\", line 175, in _reset_databases\n    execute_cmd(cmd)\n  File \"/home/krtaylor/test/nova/nova/tests/test_migrations.py\", line 143, in execute_cmd\n    status, output = commands.getstatusoutput(cmd)\n  File \"/usr/lib/python2.7/commands.py\", line 60, in getstatusoutput\n    text = pipe.read()\n  File \"/home/krtaylor/test/nova/.venv/local/lib/python2.7/site-packages/fixtures/_fixtures/timeout.py\", line 52, in signal_handler\n    raise TimeoutException()\nTimeoutException\nRan 7 (+6) tests in 60.559s (-0.114s)\nFAILED (id=2, failures=1, skips=1)\nerror: testr failed (1)", 
            "date_created": "2013-01-25 17:18:08.164577+00:00", 
            "author": "https://api.launchpad.net/1.0/~krtaylor"
        }, 
        {
            "content": "Did you modify the test_migrations.conf?", 
            "date_created": "2013-02-04 19:06:47.758056+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "No, it is a stock upstream test_migrations.conf, which doesn't need to be modified for mysql and postgresql CI tests. The CI opportunistic tests are run only if the openstack_citest parameters have been configured for the database being tested.", 
            "date_created": "2013-02-06 05:11:35.468129+00:00", 
            "author": "https://api.launchpad.net/1.0/~krtaylor"
        }, 
        {
            "content": "This is similar to https://bugs.launchpad.net/glance/+bug/966243/comments/8", 
            "date_created": "2013-03-05 20:40:27.790623+00:00", 
            "author": "https://api.launchpad.net/1.0/~kaushikc"
        }, 
        {
            "content": "Kurt, can you please confirm that this is still a problem? I know that I've seen it try to run the opportunistic tests locally when run_tests.sh is used. I suspect this is not (or is no longer) an issue at this point.\r\n\r\nThanks!", 
            "date_created": "2013-03-18 16:30:36.050526+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "I think the timeout value was changed and this is no longer a problem. I will retest.", 
            "date_created": "2013-03-18 17:13:17.069780+00:00", 
            "author": "https://api.launchpad.net/1.0/~krtaylor"
        }, 
        {
            "content": "I was able to re-create the problem, and the timeout was not changed as I thought (see#5)  in .testr.conf (OS_TEST_TIMEOUT=60). We discussed changing the value to 100 or 120 several weeks ago in irc but I guess it never got changed. \n\nWhen I change the value to 100, as expected, it passes fine.  I removed the database and user/pw, re-created them and I can still produce test times greater than 60 seconds:\n\n\nnova.tests.test_migrations.TestNovaMigrations.test_mysql_opportunistically       78.152\nnova.tests.test_migrations.TestBaremetalMigrations.test_mysql_opportunistically   0.882\n\n----------------------------------------------------------------------\nRan 2 tests in 83.330s\n", 
            "date_created": "2013-03-26 21:09:48.269212+00:00", 
            "author": "https://api.launchpad.net/1.0/~krtaylor"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/25438", 
            "date_created": "2013-03-26 21:15:44.245868+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Not able to reproduce the error with the latest tree.", 
            "date_created": "2013-06-14 21:54:07.775244+00:00", 
            "author": "https://api.launchpad.net/1.0/~krtaylor"
        }
    ]
}