{
    "status": "Confirmed", 
    "last_updated": "2016-08-29 18:39:30.731934+00:00", 
    "description": "I have issue when nova try to create cache for new image. My image is store in my control node.\n\nCreate image good.\nLaunch image with cache good.\nLaunch image without cache not good (fail create cache).\n\nFor reproduce  :\n\nGlance (http) <=====>  apache proxy (https) <======> nova compute\n\nnova compute log :\n\n2015-07-29 09:12:50.248 910 DEBUG oslo_vmware.rw_handles [-] Creating HTTP connection to write to file with size = 15032385536 and URL = https://vcenter01:443/folder/vmware_temp/d18b930c-13ce-4ce7-8285-f48b9c9dc40c/9b6845ac-56d0-4699-8b90-847acd7cfadf/9b6845ac-56d0-4699-8b90-847acd7cfadf-flat.vmdk?dsName=DS-03&dcPath=datacenter-opk-01. _create_write_connection /usr/lib/python2.7/site-packages/oslo_vmware/rw_handles.py:91\n2015-07-29 09:12:50.277 910 ERROR nova.virt.vmwareapi.io_util [-] Read/Write data failed\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util Traceback (most recent call last):\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/io_util.py\", line 175, in _inner\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = self.input.read(None)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/oslo_vmware/rw_handles.py\", line 613, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = next(self._iter)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/oslo_vmware/rw_handles.py\", line 621, in get_next\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     for data in self._glance_read_iter:\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/glanceclient/common/utils.py\", line 394, in integrity_iter\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     for chunk in iter:\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/glanceclient/common/http.py\", line 280, in _close_after_stream\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     for chunk in response.iter_content(chunk_size=chunk_size):\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/requests/models.py\", line 673, in generate\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     for chunk in self.raw.stream(chunk_size, decode_content=True):\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/requests/packages/urllib3/response.py\", line 307, in stream\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = self.read(amt=amt, decode_content=decode_content)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/requests/packages/urllib3/response.py\", line 243, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = self._fp.read(amt)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib64/python2.7/httplib.py\", line 567, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     s = self.fp.read(amt)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib64/python2.7/socket.py\", line 380, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = self._sock.recv(left)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/eventlet/green/OpenSSL/SSL.py\", line 57, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     trampoline(self.fd.fileno(),\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib64/python2.7/socket.py\", line 224, in meth\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     return getattr(self._sock,name)(*args)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib64/python2.7/socket.py\", line 170, in _dummy\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     raise error(EBADF, 'Bad file descriptor')\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util error: [Errno 9] Bad file descriptor\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util\n2015-07-29 09:12:50.282 910 ERROR nova.virt.vmwareapi.images [-] Transfer data failed\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images Traceback (most recent call last):\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/images.py\", line 192, in start_transfer\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images     read_event.wait()\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 121, in wait\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images     return hubs.get_hub().switch()\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images     return self.greenlet.switch()\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images error: [Errno 9] Bad file descriptor\n\nGlance log :\n\n2015-07-29 09:12:50.267 1310 INFO eventlet.wsgi.server [req-a350fc34-2ae7-4e77-8d8c-78ceb8513b00 2d3e8f76f3f9429c869e5a085837d2f1 d6f612ae52a9411f86ab5e2a79b4fd7e - - -] Traceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/eventlet/wsgi.py\", line 477, in handle_one_response\n    write(b''.join(towrite))\n  File \"/usr/lib/python2.7/site-packages/eventlet/wsgi.py\", line 426, in write\n    _writelines(towrite)\n  File \"/usr/lib64/python2.7/socket.py\", line 334, in writelines\n    self.flush()\n  File \"/usr/lib64/python2.7/socket.py\", line 303, in flush\n    self._sock.sendall(view[write_offset:write_offset+buffer_size])\n  File \"/usr/lib/python2.7/site-packages/eventlet/greenio/base.py\", line 376, in sendall\n    tail = self.send(data, flags)\n  File \"/usr/lib/python2.7/site-packages/eventlet/greenio/base.py\", line 359, in send\n    total_sent += fd.send(data[total_sent:], flags)\nerror: [Errno 104] Connection reset by peer\n\n\nI resolve this issue with :\n\nGlance (http)  <======> nova compute\nand \nGlance (https) <======> nova compute.\n\nSo nova no support if glance use a proxy for expose https.", 
    "tags": [
        "vmware"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1479662", 
    "owner": "None", 
    "id": 1479662, 
    "index": 4305, 
    "created": "2015-07-30 07:55:59.854414+00:00", 
    "title": "Vmware: Fail to create image cache 'Bad file descriptor'", 
    "comments": [
        {
            "content": "I have issue when nova try to create cache for new image. My image is store in my control node.\n\nCreate image good.\nLaunch image with cache good.\nLaunch image without cache not good (fail create cache).\n\nFor reproduce  :\n\nGlance (http) <=====>  apache proxy (https) <======> nova compute\n\nnova compute log :\n\n2015-07-29 09:12:50.248 910 DEBUG oslo_vmware.rw_handles [-] Creating HTTP connection to write to file with size = 15032385536 and URL = https://vcenter01:443/folder/vmware_temp/d18b930c-13ce-4ce7-8285-f48b9c9dc40c/9b6845ac-56d0-4699-8b90-847acd7cfadf/9b6845ac-56d0-4699-8b90-847acd7cfadf-flat.vmdk?dsName=DS-03&dcPath=datacenter-opk-01. _create_write_connection /usr/lib/python2.7/site-packages/oslo_vmware/rw_handles.py:91\n2015-07-29 09:12:50.277 910 ERROR nova.virt.vmwareapi.io_util [-] Read/Write data failed\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util Traceback (most recent call last):\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/io_util.py\", line 175, in _inner\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = self.input.read(None)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/oslo_vmware/rw_handles.py\", line 613, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = next(self._iter)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/oslo_vmware/rw_handles.py\", line 621, in get_next\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     for data in self._glance_read_iter:\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/glanceclient/common/utils.py\", line 394, in integrity_iter\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     for chunk in iter:\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/glanceclient/common/http.py\", line 280, in _close_after_stream\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     for chunk in response.iter_content(chunk_size=chunk_size):\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/requests/models.py\", line 673, in generate\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     for chunk in self.raw.stream(chunk_size, decode_content=True):\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/requests/packages/urllib3/response.py\", line 307, in stream\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = self.read(amt=amt, decode_content=decode_content)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/requests/packages/urllib3/response.py\", line 243, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = self._fp.read(amt)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib64/python2.7/httplib.py\", line 567, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     s = self.fp.read(amt)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib64/python2.7/socket.py\", line 380, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     data = self._sock.recv(left)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/site-packages/eventlet/green/OpenSSL/SSL.py\", line 57, in read\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     trampoline(self.fd.fileno(),\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib64/python2.7/socket.py\", line 224, in meth\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     return getattr(self._sock,name)(*args)\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib64/python2.7/socket.py\", line 170, in _dummy\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util     raise error(EBADF, 'Bad file descriptor')\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util error: [Errno 9] Bad file descriptor\n2015-07-29 09:12:50.277 910 TRACE nova.virt.vmwareapi.io_util\n2015-07-29 09:12:50.282 910 ERROR nova.virt.vmwareapi.images [-] Transfer data failed\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images Traceback (most recent call last):\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/images.py\", line 192, in start_transfer\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images     read_event.wait()\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 121, in wait\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images     return hubs.get_hub().switch()\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images     return self.greenlet.switch()\n2015-07-29 09:12:50.282 910 TRACE nova.virt.vmwareapi.images error: [Errno 9] Bad file descriptor\n\nGlance log :\n\n2015-07-29 09:12:50.267 1310 INFO eventlet.wsgi.server [req-a350fc34-2ae7-4e77-8d8c-78ceb8513b00 2d3e8f76f3f9429c869e5a085837d2f1 d6f612ae52a9411f86ab5e2a79b4fd7e - - -] Traceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/eventlet/wsgi.py\", line 477, in handle_one_response\n    write(b''.join(towrite))\n  File \"/usr/lib/python2.7/site-packages/eventlet/wsgi.py\", line 426, in write\n    _writelines(towrite)\n  File \"/usr/lib64/python2.7/socket.py\", line 334, in writelines\n    self.flush()\n  File \"/usr/lib64/python2.7/socket.py\", line 303, in flush\n    self._sock.sendall(view[write_offset:write_offset+buffer_size])\n  File \"/usr/lib/python2.7/site-packages/eventlet/greenio/base.py\", line 376, in sendall\n    tail = self.send(data, flags)\n  File \"/usr/lib/python2.7/site-packages/eventlet/greenio/base.py\", line 359, in send\n    total_sent += fd.send(data[total_sent:], flags)\nerror: [Errno 104] Connection reset by peer\n\n\nI resolve this issue with :\n\nGlance (http)  <======> nova compute\nand \nGlance (https) <======> nova compute.\n\nSo nova no support if glance use a proxy for expose https.", 
            "date_created": "2015-07-30 07:55:59.854414+00:00", 
            "author": "https://api.launchpad.net/1.0/~kodokuu"
        }
    ]
}