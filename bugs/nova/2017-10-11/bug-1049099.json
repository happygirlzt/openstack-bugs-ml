{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:32:32.080446+00:00", 
    "description": "The general host aggregates change has broken the XenServer Pools features that is required for live-migration using shared storage.\n\nIt seems that both add and remove host from aggregate does not work due to errors with RPC.\n\nFor details on how to set this up see:\nhttp://wiki.openstack.org/XenServer/LiveMigration\n\n\n------\n\n\nMore detailed repro steps:\n\n\nI have an aggregate set up:\n\nstack@DevStackOSDomU:~/devstack$ nova aggregate-list\n+----+--------------+-------------------+\n| Id | Name         | Availability Zone |\n+----+--------------+-------------------+\n| 1  | my_test_pool | nova              |\n+----+--------------+-------------------+\n\nstack@DevStackOSDomU:~/devstack$ nova aggregate-details 1\n+----+--------------+-------------------+---------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Id | Name         | Availability Zone | Hosts               | Metadata                                                                                                                                                         |\n+----+--------------+-------------------+---------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| 1  | my_test_pool | nova              | [u'DevStackOSDomU'] | {u'master_compute': u'DevStackOSDomU', u'operational_state': u'active', u'DevStackOSDomU': u'50cc08bb-4aef-49ed-a0e1-b5e90f5fdcac', u'hypervisor_pool': u'true'} |\n+----+--------------+-------------------+---------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\nAnd I want to add an additional host:\nstack@DevStackOSDomU:~/devstack$ nova aggregate-add-host 1 DevStackComputeSlave\n\nThe return value suggests success, however the host is not added to the pool. On the compute log, the following appears:\n...\nnova.openstack.common.rpc.amqp [-] Exception during message handling\nnova.openstack.common.rpc.amqp Traceback (most recent call last):\nnova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\nnova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\nnova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 150, in dispatch\nnova.openstack.common.rpc.amqp     raise rpc_common.UnsupportedRpcVersion(version=version)\nnova.openstack.common.rpc.amqp UnsupportedRpcVersion: Specified RPC version, 1.0, not supported by this endpoint.\nnova.openstack.common.rpc.amqp Exception during message handling\nnova.openstack.common.rpc.amqp Traceback (most recent call last):\nnova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\nnova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\nnova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 150, in dispatch\nnova.openstack.common.rpc.amqp     raise rpc_common.UnsupportedRpcVersion(version=version)\nnova.openstack.common.rpc.amqp UnsupportedRpcVersion: Specified RPC version, 1.0, not supported by this endpoint.\n...", 
    "tags": [
        "xenserver"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1049099", 
    "owner": "https://api.launchpad.net/1.0/~mate-lakat", 
    "id": 1049099, 
    "index": 802, 
    "created": "2012-09-11 12:50:41.971377+00:00", 
    "title": "XenAPI: cannot add/remove host to hypervisor pool", 
    "comments": [
        {
            "content": "I have an aggregate set up:\n\nstack@DevStackOSDomU:~/devstack$ nova aggregate-list\n+----+--------------+-------------------+\n| Id | Name         | Availability Zone |\n+----+--------------+-------------------+\n| 1  | my_test_pool | nova              |\n+----+--------------+-------------------+\n\nstack@DevStackOSDomU:~/devstack$ nova aggregate-details 1\n+----+--------------+-------------------+---------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Id | Name         | Availability Zone | Hosts               | Metadata                                                                                                                                                         |\n+----+--------------+-------------------+---------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| 1  | my_test_pool | nova              | [u'DevStackOSDomU'] | {u'master_compute': u'DevStackOSDomU', u'operational_state': u'active', u'DevStackOSDomU': u'50cc08bb-4aef-49ed-a0e1-b5e90f5fdcac', u'hypervisor_pool': u'true'} |\n+----+--------------+-------------------+---------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\nAnd I want to add an additional host:\nstack@DevStackOSDomU:~/devstack$ nova aggregate-add-host 1 DevStackComputeSlave\n\nThe return value suggests success, however the host is not added to the pool. On the compute log, the following appears:\n...\nnova.openstack.common.rpc.amqp [-] Exception during message handling\nnova.openstack.common.rpc.amqp Traceback (most recent call last):\nnova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\nnova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\nnova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 150, in dispatch\nnova.openstack.common.rpc.amqp     raise rpc_common.UnsupportedRpcVersion(version=version)\nnova.openstack.common.rpc.amqp UnsupportedRpcVersion: Specified RPC version, 1.0, not supported by this endpoint.\nnova.openstack.common.rpc.amqp Exception during message handling\nnova.openstack.common.rpc.amqp Traceback (most recent call last):\nnova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\nnova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\nnova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 150, in dispatch\nnova.openstack.common.rpc.amqp     raise rpc_common.UnsupportedRpcVersion(version=version)\nnova.openstack.common.rpc.amqp UnsupportedRpcVersion: Specified RPC version, 1.0, not supported by this endpoint.\n...", 
            "date_created": "2012-09-11 12:50:41.971377+00:00", 
            "author": "https://api.launchpad.net/1.0/~mate-lakat"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/12795", 
            "date_created": "2012-09-11 16:15:47.407857+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/12964", 
            "date_created": "2012-09-13 17:42:57.476846+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/12795\nCommitted: http://github.com/openstack/nova/commit/b8b46cbd6c06cb4979fa2f443892a2a1d60cc7bb\nSubmitter: Jenkins\nBranch:    master\n\ncommit b8b46cbd6c06cb4979fa2f443892a2a1d60cc7bb\nAuthor: Mate Lakat <email address hidden>\nDate:   Tue Sep 11 16:53:05 2012 +0100\n\n    xapi: fix create hypervisor pool\n    \n    Fixes bug 1049099.\n    \n    Fixing problems with the rpc api when creating hypervisor pools with\n    xenapi. Rpc calls were not using the compute_rpcapi approach, thus were\n    not properly versioned. Apart from that, the slave parameters were not\n    forwarded to the master. A new (2.2) version is introduced where the rpc\n    calls have the slave_info payload. Added tests to cover the pool cases.\n    Some trivial extract methods performed on pool, to decouple the pool\n    functionality from its dependencies.\n    \n    Change-Id: Ie44a1c09ef204affc4a657c71557691e83b22c22\n", 
            "date_created": "2012-09-19 15:00:08.768953+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: milestone-proposed\nReview: https://review.openstack.org/13289", 
            "date_created": "2012-09-19 15:50:00.575291+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/13289\nCommitted: http://github.com/openstack/nova/commit/d23cac1a769e3928a85d40e056f5cd41a9731f4a\nSubmitter: Jenkins\nBranch:    milestone-proposed\n\ncommit d23cac1a769e3928a85d40e056f5cd41a9731f4a\nAuthor: Mate Lakat <email address hidden>\nDate:   Tue Sep 11 16:53:05 2012 +0100\n\n    xapi: fix create hypervisor pool\n    \n    Fixes bug 1049099.\n    \n    Fixing problems with the rpc api when creating hypervisor pools with\n    xenapi. Rpc calls were not using the compute_rpcapi approach, thus were\n    not properly versioned. Apart from that, the slave parameters were not\n    forwarded to the master. A new (2.2) version is introduced where the rpc\n    calls have the slave_info payload. Added tests to cover the pool cases.\n    Some trivial extract methods performed on pool, to decouple the pool\n    functionality from its dependencies.\n    \n    Change-Id: Ie44a1c09ef204affc4a657c71557691e83b22c22\n    (cherry picked from commit b8b46cbd6c06cb4979fa2f443892a2a1d60cc7bb)\n", 
            "date_created": "2012-09-19 16:23:14.097819+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}