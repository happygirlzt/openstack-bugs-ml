{
    "status": "Invalid", 
    "last_updated": "2014-07-28 08:52:29.487714+00:00", 
    "description": "Environment: grizzly\n\nAfter live-migration is done, check DB table compute_nodes, the counter of running_vms of source hypervisor will be decreased but the counter of running_vms of destination hypervisor won't be increased. (Actually the counter \"num_instances\" from compute_node_stats will not be increased as well)\n\n\n1. Three compute nodes in the system, and for each of them have one active instance:\n\n[root@rhel8233 ~]# nova list\n+--------------------------------------+-------+--------+----------+\n| ID                                   | Name  | Status | Networks |\n+--------------------------------------+-------+--------+----------+\n| 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | ACTIVE |          |     ---> on host rhel8234\n| 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE |          |     ---> on host rhel8235\n| e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE |          |        ---> on host rhel8236\n+--------------------------------------+-------+--------+----------+\n\nCheck mysql, the counter is correct.\n\nmysql> select * from compute_nodes;\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n| created_at          | updated_at          | deleted_at | id | service_id | vcpus | memory_mb | local_gb | vcpus_used | memory_mb_used | local_gb_used | hypervisor_type | hypervisor_version | cpu_info                                                                                                                                                                                        | disk_available_least | free_ram_mb | free_disk_gb | current_workload | running_vms | hypervisor_hostname | deleted |\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n| 2013-03-05 05:05:29 | 2013-03-07 08:37:44 | NULL       |  1 |          5 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   88 |         853 |          546 |                1 |           1 | rhel8234            |       0 |\n| 2013-03-05 05:11:26 | 2013-03-07 07:48:41 | NULL       |  2 |          7 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8235            |       0 |\n| 2013-03-05 05:12:36 | 2013-03-07 07:48:07 | NULL       |  3 |          9 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8236            |       0 |\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n\n\n2.  trigger live-migration for myvm1 to rhel8235\n\n+--------------------------------------+-------+-----------+----------+\n| ID                                   | Name  | Status    | Networks |\n+--------------------------------------+-------+-----------+----------+\n| 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | MIGRATING |          |\n| 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE    |          |\n| e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE    |          |\n+--------------------------------------+-------+-----------+----------+\n\n3. after live-migration is done, wait for a while, check DB:\n\n+--------------------------------------+-------+--------+----------+\n| ID                                   | Name  | Status | Networks |\n+--------------------------------------+-------+--------+----------+\n| 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | ACTIVE |          |\n| 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE |          |\n| e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE |          |\n+--------------------------------------+-------+--------+----------+\n\n[root@rhel8233 ~]# nova show myvm1\n+-------------------------------------+------------------------------------------------------------+\n| Property                            | Value                                                      |\n+-------------------------------------+------------------------------------------------------------+\n| status                              | ACTIVE                                                     |\n| updated                             | 2013-03-07T08:37:45Z                                       |\n| OS-EXT-STS:task_state               | None                                                       |\n| OS-EXT-SRV-ATTR:host                | rhel8235                                                   |\n| key_name                            | None                                                       |\n| image                               | cirros-0.3.0-x86_64 (15b8a04c-9207-4ab1-b69e-43c5c5a46525) |\n| hostId                              | a9e1ff745b20b8c20c7f1b9f55f1957609cc40d57e2a68959bcf1b80   |\n| OS-EXT-STS:vm_state                 | active                                                     |\n| OS-EXT-SRV-ATTR:instance_name       | instance-00000014                                          |\n| OS-EXT-SRV-ATTR:hypervisor_hostname | rhel8235                                                   |\n| flavor                              | m1.tiny (1)                                                |\n| id                                  | 4b25db8e-b3a1-4177-aed1-32506b94eb88                       |\n| security_groups                     | [{u'name': u'default'}]                                    |\n| user_id                             | 75a5e821c5db4c3aba3280c28bb6db2c                           |\n| name                                | myvm1                                                      |\n| created                             | 2013-03-07T07:47:48Z                                       |\n| tenant_id                           | c6e0a21705b04c0fb06185c72d5173d3                           |\n| OS-DCF:diskConfig                   | MANUAL                                                     |\n| metadata                            | {}                                                         |\n| accessIPv4                          |                                                            |\n| accessIPv6                          |                                                            |\n| progress                            | 0                                                          |\n| OS-EXT-STS:power_state              | 1                                                          |\n| OS-EXT-AZ:availability_zone         | nova                                                       |\n| config_drive                        |                                                            |\n+-------------------------------------+------------------------------------------------------------+\n\nThe running_vms from the source hypervisor has been decreased, that's correct, but the counter in destination hypervisor was not increased:\n\nmysql> select * from compute_nodes;\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n| created_at          | updated_at          | deleted_at | id | service_id | vcpus | memory_mb | local_gb | vcpus_used | memory_mb_used | local_gb_used | hypervisor_type | hypervisor_version | cpu_info                                                                                                                                                                                        | disk_available_least | free_ram_mb | free_disk_gb | current_workload | running_vms | hypervisor_hostname | deleted |\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n| 2013-03-05 05:05:29 | 2013-03-07 08:38:45 | NULL       |  1 |          5 |     4 |      1877 |      546 |          0 |            512 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   88 |        1365 |          546 |                0 |           0 | rhel8234            |       0 |\n| 2013-03-05 05:11:26 | 2013-03-07 07:48:41 | NULL       |  2 |          7 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8235            |       0 |\n| 2013-03-05 05:12:36 | 2013-03-07 07:48:07 | NULL       |  3 |          9 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8236            |       0 |\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n\nmysql> select * from compute_node_stats where compute_node_id=2;\n| 2013-03-07 07:47:53 | 2013-03-07 08:38:49 | NULL                | 218 |               2 | num_instances                             | 1     |       0 |", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1151845", 
    "owner": "None", 
    "id": 1151845, 
    "index": 3485, 
    "created": "2013-03-07 09:53:08.968434+00:00", 
    "title": "Instance counter is incorrect after live-migration is done", 
    "comments": [
        {
            "content": "Environment: grizzly\n\nAfter live-migration is done, check DB table compute_nodes, the counter of running_vms of source hypervisor will be decreased but the counter of running_vms of destination hypervisor won't be increased. (Actually the counter \"num_instances\" from compute_node_stats will not be increased as well)\n\n\n1. Three compute nodes in the system, and for each of them have one active instance:\n\n[root@rhel8233 ~]# nova list\n+--------------------------------------+-------+--------+----------+\n| ID                                   | Name  | Status | Networks |\n+--------------------------------------+-------+--------+----------+\n| 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | ACTIVE |          |     ---> on host rhel8234\n| 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE |          |     ---> on host rhel8235\n| e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE |          |        ---> on host rhel8236\n+--------------------------------------+-------+--------+----------+\n\nCheck mysql, the counter is correct.\n\nmysql> select * from compute_nodes;\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n| created_at          | updated_at          | deleted_at | id | service_id | vcpus | memory_mb | local_gb | vcpus_used | memory_mb_used | local_gb_used | hypervisor_type | hypervisor_version | cpu_info                                                                                                                                                                                        | disk_available_least | free_ram_mb | free_disk_gb | current_workload | running_vms | hypervisor_hostname | deleted |\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n| 2013-03-05 05:05:29 | 2013-03-07 08:37:44 | NULL       |  1 |          5 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   88 |         853 |          546 |                1 |           1 | rhel8234            |       0 |\n| 2013-03-05 05:11:26 | 2013-03-07 07:48:41 | NULL       |  2 |          7 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8235            |       0 |\n| 2013-03-05 05:12:36 | 2013-03-07 07:48:07 | NULL       |  3 |          9 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8236            |       0 |\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n\n\n2.  trigger live-migration for myvm1 to rhel8235\n\n+--------------------------------------+-------+-----------+----------+\n| ID                                   | Name  | Status    | Networks |\n+--------------------------------------+-------+-----------+----------+\n| 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | MIGRATING |          |\n| 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE    |          |\n| e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE    |          |\n+--------------------------------------+-------+-----------+----------+\n\n3. after live-migration is done, wait for a while, check DB:\n\n+--------------------------------------+-------+--------+----------+\n| ID                                   | Name  | Status | Networks |\n+--------------------------------------+-------+--------+----------+\n| 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | ACTIVE |          |\n| 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE |          |\n| e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE |          |\n+--------------------------------------+-------+--------+----------+\n\n[root@rhel8233 ~]# nova show myvm1\n+-------------------------------------+------------------------------------------------------------+\n| Property                            | Value                                                      |\n+-------------------------------------+------------------------------------------------------------+\n| status                              | ACTIVE                                                     |\n| updated                             | 2013-03-07T08:37:45Z                                       |\n| OS-EXT-STS:task_state               | None                                                       |\n| OS-EXT-SRV-ATTR:host                | rhel8235                                                   |\n| key_name                            | None                                                       |\n| image                               | cirros-0.3.0-x86_64 (15b8a04c-9207-4ab1-b69e-43c5c5a46525) |\n| hostId                              | a9e1ff745b20b8c20c7f1b9f55f1957609cc40d57e2a68959bcf1b80   |\n| OS-EXT-STS:vm_state                 | active                                                     |\n| OS-EXT-SRV-ATTR:instance_name       | instance-00000014                                          |\n| OS-EXT-SRV-ATTR:hypervisor_hostname | rhel8235                                                   |\n| flavor                              | m1.tiny (1)                                                |\n| id                                  | 4b25db8e-b3a1-4177-aed1-32506b94eb88                       |\n| security_groups                     | [{u'name': u'default'}]                                    |\n| user_id                             | 75a5e821c5db4c3aba3280c28bb6db2c                           |\n| name                                | myvm1                                                      |\n| created                             | 2013-03-07T07:47:48Z                                       |\n| tenant_id                           | c6e0a21705b04c0fb06185c72d5173d3                           |\n| OS-DCF:diskConfig                   | MANUAL                                                     |\n| metadata                            | {}                                                         |\n| accessIPv4                          |                                                            |\n| accessIPv6                          |                                                            |\n| progress                            | 0                                                          |\n| OS-EXT-STS:power_state              | 1                                                          |\n| OS-EXT-AZ:availability_zone         | nova                                                       |\n| config_drive                        |                                                            |\n+-------------------------------------+------------------------------------------------------------+\n\nThe running_vms from the source hypervisor has been decreased, that's correct, but the counter in destination hypervisor was not increased:\n\nmysql> select * from compute_nodes;\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n| created_at          | updated_at          | deleted_at | id | service_id | vcpus | memory_mb | local_gb | vcpus_used | memory_mb_used | local_gb_used | hypervisor_type | hypervisor_version | cpu_info                                                                                                                                                                                        | disk_available_least | free_ram_mb | free_disk_gb | current_workload | running_vms | hypervisor_hostname | deleted |\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n| 2013-03-05 05:05:29 | 2013-03-07 08:38:45 | NULL       |  1 |          5 |     4 |      1877 |      546 |          0 |            512 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   88 |        1365 |          546 |                0 |           0 | rhel8234            |       0 |\n| 2013-03-05 05:11:26 | 2013-03-07 07:48:41 | NULL       |  2 |          7 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8235            |       0 |\n| 2013-03-05 05:12:36 | 2013-03-07 07:48:07 | NULL       |  3 |          9 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8236            |       0 |\n+---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n\nmysql> select * from compute_node_stats where compute_node_id=2;\n| 2013-03-07 07:47:53 | 2013-03-07 08:38:49 | NULL                | 218 |               2 | num_instances                             | 1     |       0 |", 
            "date_created": "2013-03-07 09:53:08.968434+00:00", 
            "author": "https://api.launchpad.net/1.0/~chieh-chu"
        }, 
        {
            "content": "Could you attach some log files when this happens?\r\n\r\nThanks\r\nchuck", 
            "date_created": "2013-03-18 13:56:19.116769+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "Try to reproduce the problem again, and attached includes nova-compute logs both src and dest for live migration case.", 
            "date_created": "2013-03-21 03:46:01.758863+00:00", 
            "author": "https://api.launchpad.net/1.0/~chieh-chu"
        }, 
        {
            "content": "Just wondering if this is still being investigated?\n\nThanks,\nJoe", 
            "date_created": "2013-04-18 20:17:47.006824+00:00", 
            "author": "https://api.launchpad.net/1.0/~jwcroppe"
        }, 
        {
            "content": "Hi Jason!\nAny update on this?", 
            "date_created": "2014-07-15 01:23:34.672261+00:00", 
            "author": "https://api.launchpad.net/1.0/~h-tanizawa"
        }, 
        {
            "content": "Sorry, I haven't had much opportunity to contribute lately. The bug corrects itself after a couple minute once an audit runs. Please feel free to take it or unassign it.\n\nThanks.\n\nSent from my iPhone\n\n> On Jul 14, 2014, at 9:31 PM, haruka tanizawa <email address hidden> wrote:\n> \n> Hi Jason!\n> Any update on this?\n> \n> -- \n> You received this bug notification because you are a bug assignee.\n> https://bugs.launchpad.net/bugs/1151845\n> \n> Title:\n>  Instance counter is incorrect after live-migration is done\n> \n> Status in OpenStack Compute (Nova):\n>  In Progress\n> \n> Bug description:\n>  Environment: grizzly\n> \n>  After live-migration is done, check DB table compute_nodes, the\n>  counter of running_vms of source hypervisor will be decreased but the\n>  counter of running_vms of destination hypervisor won't be increased.\n>  (Actually the counter \"num_instances\" from compute_node_stats will not\n>  be increased as well)\n> \n> \n>  1. Three compute nodes in the system, and for each of them have one active instance:\n> \n>  [root@rhel8233 ~]# nova list\n>  +--------------------------------------+-------+--------+----------+\n>  | ID                                   | Name  | Status | Networks |\n>  +--------------------------------------+-------+--------+----------+\n>  | 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | ACTIVE |          |     ---> on host rhel8234\n>  | 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE |          |     ---> on host rhel8235\n>  | e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE |          |        ---> on host rhel8236\n>  +--------------------------------------+-------+--------+----------+\n> \n>  Check mysql, the counter is correct.\n> \n>  mysql> select * from compute_nodes;\n>  +---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n>  | created_at          | updated_at          | deleted_at | id | service_id | vcpus | memory_mb | local_gb | vcpus_used | memory_mb_used | local_gb_used | hypervisor_type | hypervisor_version | cpu_info                                                                                                                                                                                        | disk_available_least | free_ram_mb | free_disk_gb | current_workload | running_vms | hypervisor_hostname | deleted |\n>  +---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n>  | 2013-03-05 05:05:29 | 2013-03-07 08:37:44 | NULL       |  1 |          5 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   88 |         853 |          546 |                1 |           1 | rhel8234            |       0 |\n>  | 2013-03-05 05:11:26 | 2013-03-07 07:48:41 | NULL       |  2 |          7 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8235            |       0 |\n>  | 2013-03-05 05:12:36 | 2013-03-07 07:48:07 | NULL       |  3 |          9 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8236            |       0 |\n>  +---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n> \n> \n>  2.  trigger live-migration for myvm1 to rhel8235\n> \n>  +--------------------------------------+-------+-----------+----------+\n>  | ID                                   | Name  | Status    | Networks |\n>  +--------------------------------------+-------+-----------+----------+\n>  | 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | MIGRATING |          |\n>  | 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE    |          |\n>  | e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE    |          |\n>  +--------------------------------------+-------+-----------+----------+\n> \n>  3. after live-migration is done, wait for a while, check DB:\n> \n>  +--------------------------------------+-------+--------+----------+\n>  | ID                                   | Name  | Status | Networks |\n>  +--------------------------------------+-------+--------+----------+\n>  | 4b25db8e-b3a1-4177-aed1-32506b94eb88 | myvm1 | ACTIVE |          |\n>  | 00565dce-4828-4eb2-ab29-9ef0403e5ec0 | myvm2 | ACTIVE |          |\n>  | e4871da2-3a6f-4f34-93cf-bb2511b46cf8 | myvm3 | ACTIVE |          |\n>  +--------------------------------------+-------+--------+----------+\n> \n>  [root@rhel8233 ~]# nova show myvm1\n>  +-------------------------------------+------------------------------------------------------------+\n>  | Property                            | Value                                                      |\n>  +-------------------------------------+------------------------------------------------------------+\n>  | status                              | ACTIVE                                                     |\n>  | updated                             | 2013-03-07T08:37:45Z                                       |\n>  | OS-EXT-STS:task_state               | None                                                       |\n>  | OS-EXT-SRV-ATTR:host                | rhel8235                                                   |\n>  | key_name                            | None                                                       |\n>  | image                               | cirros-0.3.0-x86_64 (15b8a04c-9207-4ab1-b69e-43c5c5a46525) |\n>  | hostId                              | a9e1ff745b20b8c20c7f1b9f55f1957609cc40d57e2a68959bcf1b80   |\n>  | OS-EXT-STS:vm_state                 | active                                                     |\n>  | OS-EXT-SRV-ATTR:instance_name       | instance-00000014                                          |\n>  | OS-EXT-SRV-ATTR:hypervisor_hostname | rhel8235                                                   |\n>  | flavor                              | m1.tiny (1)                                                |\n>  | id                                  | 4b25db8e-b3a1-4177-aed1-32506b94eb88                       |\n>  | security_groups                     | [{u'name': u'default'}]                                    |\n>  | user_id                             | 75a5e821c5db4c3aba3280c28bb6db2c                           |\n>  | name                                | myvm1                                                      |\n>  | created                             | 2013-03-07T07:47:48Z                                       |\n>  | tenant_id                           | c6e0a21705b04c0fb06185c72d5173d3                           |\n>  | OS-DCF:diskConfig                   | MANUAL                                                     |\n>  | metadata                            | {}                                                         |\n>  | accessIPv4                          |                                                            |\n>  | accessIPv6                          |                                                            |\n>  | progress                            | 0                                                          |\n>  | OS-EXT-STS:power_state              | 1                                                          |\n>  | OS-EXT-AZ:availability_zone         | nova                                                       |\n>  | config_drive                        |                                                            |\n>  +-------------------------------------+------------------------------------------------------------+\n> \n>  The running_vms from the source hypervisor has been decreased, that's\n>  correct, but the counter in destination hypervisor was not increased:\n> \n>  mysql> select * from compute_nodes;\n>  +---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n>  | created_at          | updated_at          | deleted_at | id | service_id | vcpus | memory_mb | local_gb | vcpus_used | memory_mb_used | local_gb_used | hypervisor_type | hypervisor_version | cpu_info                                                                                                                                                                                        | disk_available_least | free_ram_mb | free_disk_gb | current_workload | running_vms | hypervisor_hostname | deleted |\n>  +---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n>  | 2013-03-05 05:05:29 | 2013-03-07 08:38:45 | NULL       |  1 |          5 |     4 |      1877 |      546 |          0 |            512 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   88 |        1365 |          546 |                0 |           0 | rhel8234            |       0 |\n>  | 2013-03-05 05:11:26 | 2013-03-07 07:48:41 | NULL       |  2 |          7 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8235            |       0 |\n>  | 2013-03-05 05:12:36 | 2013-03-07 07:48:07 | NULL       |  3 |          9 |     4 |      1877 |      546 |          1 |           1024 |             0 | QEMU            |              12001 | {\"vendor\": \"Intel\", \"model\": \"Penryn\", \"arch\": \"x86_64\", \"features\": [\"hypervisor\", \"osxsave\", \"xsave\", \"ht\", \"ss\", \"acpi\", \"ds\", \"vme\"], \"topology\": {\"cores\": 2, \"threads\": 1, \"sockets\": 2}} |                   87 |         853 |          546 |                0 |           1 | rhel8236            |       0 |\n>  +---------------------+---------------------+------------+----+------------+-------+-----------+----------+------------+----------------+---------------+-----------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+-------------+--------------+------------------+-------------+---------------------+---------+\n> \n>  mysql> select * from compute_node_stats where compute_node_id=2;\n>  | 2013-03-07 07:47:53 | 2013-03-07 08:38:49 | NULL                | 218 |               2 | num_instances                             | 1     |       0 |\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/1151845/+subscriptions\n", 
            "date_created": "2014-07-15 01:45:52+00:00", 
            "author": "https://api.launchpad.net/1.0/~jdillaman"
        }
    ]
}