{
    "status": "Opinion", 
    "last_updated": "2016-05-17 16:30:29.153554+00:00", 
    "description": "I'm doing openstack icehouse controller installation inside virtualbox with ipv6 configurations when I'm installing nova.\n\nWhen I use ipv6 address for the metadata API (metadata_listen = 2001:db8:0::1, metadata_host = 2001:db8:0::1), nova-api crashes soon after launching and with ipv4 everything seems to be running like charm(metadata_listen = 198.168.0.1, metadata_host = 198.168.0.1).\n\ne.g. when i restart my nova processes and run 'nova list' command twice as root following things occurs:\n\n# nova list\n+----+------+--------+------------+-------------+----------+\n| ID | Name | Status | Task State | Power State | Networks |\n+----+------+--------+------------+-------------+----------+\n+----+------+--------+------------+-------------+----------+\n\n# nova list\nERROR: HTTPConnectionPool(host='ctrl', port=8774): Max retries exceeded with url: /v2/d117e271b78248de8a26e572197fd149/servers/detail (Caused by <class 'socket.error'>: [Errno 111] Connection refused)\n\nHere is the trace from nova-api.log:\n\n2014-05-16 20:41:28.602 22728 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:154\n2014-05-16 20:41:28.646 22728 DEBUG nova.openstack.common.processutils [-] Result was 2 execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:187\n2014-05-16 20:41:28.646 22728 DEBUG nova.openstack.common.processutils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:199\n2014-05-16 20:41:30.278 22728 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:154\n2014-05-16 20:41:30.348 22728 DEBUG nova.openstack.common.processutils [-] Result was 2 execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:187\n2014-05-16 20:41:30.348 22728 DEBUG nova.openstack.common.lockutils [-] Released file lock \"iptables\" at /run/lock/nova/nova-iptables lock /usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py:210\n2014-05-16 20:41:30.349 22728 DEBUG nova.openstack.common.lockutils [-] Semaphore / lock released \"_apply\" inner /usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py:252\n2014-05-16 20:41:30.349 22728 CRITICAL nova [-] ProcessExecutionError: Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\nExit code: 2\nStdout: ''\nStderr: \"iptables-restore v1.4.21: host/network `::1' not found\\nError occurred at line: 17\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2014-05-16 20:41:30.349 22728 TRACE nova Traceback (most recent call last):\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/bin/nova-api\", line 10, in <module>\n2014-05-16 20:41:30.349 22728 TRACE nova     sys.exit(main())\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/cmd/api.py\", line 53, in main\n2014-05-16 20:41:30.349 22728 TRACE nova     server = service.WSGIService(api, use_ssl=should_use_ssl)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 329, in __init__\n2014-05-16 20:41:30.349 22728 TRACE nova     self.manager = self._get_manager()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 373, in _get_manager\n2014-05-16 20:41:30.349 22728 TRACE nova     return manager_class()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/api/manager.py\", line 30, in __init__\n2014-05-16 20:41:30.349 22728 TRACE nova     self.network_driver.metadata_accept()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 660, in metadata_accept\n2014-05-16 20:41:30.349 22728 TRACE nova     iptables_manager.apply()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 428, in apply\n2014-05-16 20:41:30.349 22728 TRACE nova     self._apply()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 249, in inner\n2014-05-16 20:41:30.349 22728 TRACE nova     return f(*args, **kwargs)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 457, in _apply\n2014-05-16 20:41:30.349 22728 TRACE nova     attempts=5)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 1205, in _execute\n2014-05-16 20:41:30.349 22728 TRACE nova     return utils.execute(*cmd, **kwargs)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 164, in execute\n2014-05-16 20:41:30.349 22728 TRACE nova     return processutils.execute(*cmd, **kwargs)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py\", line 193, in execute\n2014-05-16 20:41:30.349 22728 TRACE nova     cmd=' '.join(cmd))\n2014-05-16 20:41:30.349 22728 TRACE nova ProcessExecutionError: Unexpected error while running command.\n2014-05-16 20:41:30.349 22728 TRACE nova Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\n2014-05-16 20:41:30.349 22728 TRACE nova Exit code: 2\n2014-05-16 20:41:30.349 22728 TRACE nova Stdout: ''\n2014-05-16 20:41:30.349 22728 TRACE nova Stderr: \"iptables-restore v1.4.21: host/network `::1' not found\\nError occurred at line: 17\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2014-05-16 20:41:30.349 22728 TRACE nova\n2014-05-16 20:41:30.496 22854 INFO nova.openstack.common.service [-] Parent process has died unexpectedly, exiting\n2014-05-16 20:41:30.501 22854 INFO nova.wsgi [-] Stopping WSGI server.\n2014-05-16 20:41:30.498 22828 INFO nova.openstack.common.service [-] Parent process has died unexpectedly, exiting\n2014-05-16 20:41:30.502 22828 INFO nova.wsgi [-] Stopping WSGI server.\n\nMy nova.conf file is following:\n\n[DEFAULT]\n\nuse_ipv6 = True\nmy_ip = 2001:db8:0::1\n\nrpc_backend = rabbit\nrabbit_host = ctrl\n\n# verbose = True\ndebug = True\nlogdir = /var/log/nova\nstate_path = /var/lib/nova\nlock_path = /run/lock/nova\n\ns3_host = ctrl\nec2_host = ctrl\nec2_dmz_host = ctrl\ncc_host = ctrl\n\nec2_url = http://ctrl:8773/services/Cloud\nnova_url = http://ctrl:8774/v1.1/\n\napi_paste_config = /etc/nova/api-paste.ini\n\nroot_helper = sudo nova-rootwrap /etc/nova/rootwrap.conf\n\nresume_guests_state_on_host_boot = True\n\nosapi_compute_listen = 2001:db8:0::1\nosapi_compute_listen_port = 8774\n\n# Scheduler\n# scheduler_driver = nova.scheduler.simple.SimpleScheduler\ncompute_scheduler_driver = nova.scheduler.filter_scheduler.FilterScheduler\n\n# Metadata stuff\nmetadata_listen = 2001:db8:0::1\nmetadata_host = 2001:db8:0::1\nmetadata_port = 8775\nservice_neutron_metadata_proxy = True\nneutron_metadata_proxy_shared_secret = metasecret13\n\n# Auth\nuse_deprecated_auth = false\nauth_strategy = keystone\nkeystone_ec2_url = http://ctrl:5000/v2.0/ec2tokens\n\n# Imaging service\nglance_api_servers = ctrl:9292\nimage_service = nova.image.glance.GlanceImageService\n\n# INSTANCE DISK BACKEND\nlibvirt_images_type = lvm\nlibvirt_images_volume_group = nova-local\nlibvirt_sparse_logical_volumes = false\n\n# VNC configuration - Dual-Stacked - DISABLED, go for SPICE instead!\nvnc_enabled = False\nnovnc_enabled = False\n# novncproxy_base_url = http://ctrl:6080/vnc_auto.html\n# novncproxy_host = ::\n# novncproxy_port = 6080\n\n# NETWORK - NEUTRON\nnetwork_api_class = nova.network.neutronv2.api.API\nneutron_url = http://ctrl:9696/\nneutron_auth_strategy = keystone\nneutron_admin_tenant_name = service\nneutron_admin_username = neutron\nneutron_admin_password = service_pass\nneutron_admin_auth_url = http://ctrl:35357/v2.0/\nlinuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver\nfirewall_driver = nova.virt.firewall.NoopFirewallDriver\nsecurity_group_api = neutron\n\n# firewall_driver = nova.virt.libvirt.firewall.IptablesFirewallDriver\n\nlibvirt_vif_driver = nova.virt.libvirt.vif.LibvirtGenericVIFDriver\n# libvirt_vif_driver = nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver\n# libvirt_vif_driver = nova.virt.libvirt.vif.LibvirtOpenVswitchVirtualPortDriver\n\n# Cinder\nvolume_api_class = nova.volume.cinder.API\nosapi_volume_listen_port = 5900\n\n# SPICE configuration - Dual-Stacked\n[spice]\nenabled = True\nspicehtml5proxy_host = ::\nhtml5proxy_base_url = http://ctrl:6082/spice_auto.html\nkeymap = en-us\n\n[database]\nconnection = mysql://novaUser:novaPass@ctrl/nova\n\n[keystone_authtoken]\nauth_uri = http://ctrl:5000\nauth_host = ctrl\nauth_port = 35357\nauth_protocol = http\nadmin_tenant_name = service\nadmin_user = nova\nadmin_password = service_pass", 
    "tags": [
        "ipv6", 
        "nova-api"
    ], 
    "importance": "Low", 
    "heat": 26, 
    "link": "https://bugs.launchpad.net/nova/+bug/1340641", 
    "owner": "None", 
    "id": 1340641, 
    "index": 36, 
    "created": "2014-07-11 09:47:17.504398+00:00", 
    "title": "nova-api crashes when using ipv6-address for metadata API", 
    "comments": [
        {
            "content": "I'm doing openstack icehouse controller installation inside virtualbox with ipv6 configurations when I'm installing nova.\n\nWhen I use ipv6 address for the metadata API (metadata_listen = 2001:db8:0::1, metadata_host = 2001:db8:0::1), nova-api crashes soon after launching and with ipv4 everything seems to be running like charm(metadata_listen = 198.168.0.1, metadata_host = 198.168.0.1).\n\ne.g. when i restart my nova processes and run 'nova list' command twice as root following things occurs:\n \n# nova list\n+----+------+--------+------------+-------------+----------+\n| ID | Name | Status | Task State | Power State | Networks |\n+----+------+--------+------------+-------------+----------+\n+----+------+--------+------------+-------------+----------+\n\n# nova list\nERROR: HTTPConnectionPool(host='ctrl', port=8774): Max retries exceeded with url: /v2/d117e271b78248de8a26e572197fd149/servers/detail (Caused by <class 'socket.error'>: [Errno 111] Connection refused)\n\n\nHere is the trace from nova-api.log:\n\n2014-05-16 20:41:28.602 22728 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:154\n2014-05-16 20:41:28.646 22728 DEBUG nova.openstack.common.processutils [-] Result was 2 execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:187\n2014-05-16 20:41:28.646 22728 DEBUG nova.openstack.common.processutils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:199\n2014-05-16 20:41:30.278 22728 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:154\n2014-05-16 20:41:30.348 22728 DEBUG nova.openstack.common.processutils [-] Result was 2 execute /usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py:187\n2014-05-16 20:41:30.348 22728 DEBUG nova.openstack.common.lockutils [-] Released file lock \"iptables\" at /run/lock/nova/nova-iptables lock /usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py:210\n2014-05-16 20:41:30.349 22728 DEBUG nova.openstack.common.lockutils [-] Semaphore / lock released \"_apply\" inner /usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py:252\n2014-05-16 20:41:30.349 22728 CRITICAL nova [-] ProcessExecutionError: Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\nExit code: 2\nStdout: ''\nStderr: \"iptables-restore v1.4.21: host/network `::1' not found\\nError occurred at line: 17\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2014-05-16 20:41:30.349 22728 TRACE nova Traceback (most recent call last):\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/bin/nova-api\", line 10, in <module>\n2014-05-16 20:41:30.349 22728 TRACE nova     sys.exit(main())\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/cmd/api.py\", line 53, in main\n2014-05-16 20:41:30.349 22728 TRACE nova     server = service.WSGIService(api, use_ssl=should_use_ssl)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 329, in __init__\n2014-05-16 20:41:30.349 22728 TRACE nova     self.manager = self._get_manager()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 373, in _get_manager\n2014-05-16 20:41:30.349 22728 TRACE nova     return manager_class()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/api/manager.py\", line 30, in __init__\n2014-05-16 20:41:30.349 22728 TRACE nova     self.network_driver.metadata_accept()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 660, in metadata_accept\n2014-05-16 20:41:30.349 22728 TRACE nova     iptables_manager.apply()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 428, in apply\n2014-05-16 20:41:30.349 22728 TRACE nova     self._apply()\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 249, in inner\n2014-05-16 20:41:30.349 22728 TRACE nova     return f(*args, **kwargs)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 457, in _apply\n2014-05-16 20:41:30.349 22728 TRACE nova     attempts=5)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 1205, in _execute\n2014-05-16 20:41:30.349 22728 TRACE nova     return utils.execute(*cmd, **kwargs)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 164, in execute\n2014-05-16 20:41:30.349 22728 TRACE nova     return processutils.execute(*cmd, **kwargs)\n2014-05-16 20:41:30.349 22728 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py\", line 193, in execute\n2014-05-16 20:41:30.349 22728 TRACE nova     cmd=' '.join(cmd))\n2014-05-16 20:41:30.349 22728 TRACE nova ProcessExecutionError: Unexpected error while running command.\n2014-05-16 20:41:30.349 22728 TRACE nova Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\n2014-05-16 20:41:30.349 22728 TRACE nova Exit code: 2\n2014-05-16 20:41:30.349 22728 TRACE nova Stdout: ''\n2014-05-16 20:41:30.349 22728 TRACE nova Stderr: \"iptables-restore v1.4.21: host/network `::1' not found\\nError occurred at line: 17\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2014-05-16 20:41:30.349 22728 TRACE nova\n2014-05-16 20:41:30.496 22854 INFO nova.openstack.common.service [-] Parent process has died unexpectedly, exiting\n2014-05-16 20:41:30.501 22854 INFO nova.wsgi [-] Stopping WSGI server.\n2014-05-16 20:41:30.498 22828 INFO nova.openstack.common.service [-] Parent process has died unexpectedly, exiting\n2014-05-16 20:41:30.502 22828 INFO nova.wsgi [-] Stopping WSGI server.\n\nMy nova.conf file is following:\n\n[DEFAULT]\n\nuse_ipv6 = True\nmy_ip = 2001:db8:0::1\n\nrpc_backend = rabbit\nrabbit_host = ctrl\n\n# verbose = True\ndebug = True\nlogdir = /var/log/nova\nstate_path = /var/lib/nova\nlock_path = /run/lock/nova\n\ns3_host = ctrl\nec2_host = ctrl\nec2_dmz_host = ctrl\ncc_host = ctrl\n\nec2_url = http://ctrl:8773/services/Cloud\nnova_url = http://ctrl:8774/v1.1/\n\napi_paste_config = /etc/nova/api-paste.ini\n\nroot_helper = sudo nova-rootwrap /etc/nova/rootwrap.conf\n\nresume_guests_state_on_host_boot = True\n\nosapi_compute_listen = 2607:f0d0:2001:a::10\nosapi_compute_listen_port = 8774\n\n# Scheduler\n# scheduler_driver = nova.scheduler.simple.SimpleScheduler\ncompute_scheduler_driver = nova.scheduler.filter_scheduler.FilterScheduler\n\n# Metadata stuff\nmetadata_listen = 2001:db8:0::1\nmetadata_host = 2001:db8:0::1\nmetadata_port = 8775\nservice_neutron_metadata_proxy = True\nneutron_metadata_proxy_shared_secret = metasecret13\n\n# Auth\nuse_deprecated_auth = false\nauth_strategy = keystone\nkeystone_ec2_url = http://ctrl:5000/v2.0/ec2tokens\n\n# Imaging service\nglance_api_servers = ctrl:9292\nimage_service = nova.image.glance.GlanceImageService\n\n# INSTANCE DISK BACKEND\nlibvirt_images_type = lvm\nlibvirt_images_volume_group = nova-local\nlibvirt_sparse_logical_volumes = false\n\n# VNC configuration - Dual-Stacked - DISABLED, go for SPICE instead!\nvnc_enabled = False\nnovnc_enabled = False\n# novncproxy_base_url = http://ctrl:6080/vnc_auto.html\n# novncproxy_host = ::\n# novncproxy_port = 6080\n\n# NETWORK - NEUTRON\nnetwork_api_class = nova.network.neutronv2.api.API\nneutron_url = http://ctrl:9696/\nneutron_auth_strategy = keystone\nneutron_admin_tenant_name = service\nneutron_admin_username = neutron\nneutron_admin_password = service_pass\nneutron_admin_auth_url = http://ctrl:35357/v2.0/\nlinuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver\nfirewall_driver = nova.virt.firewall.NoopFirewallDriver\nsecurity_group_api = neutron\n\n# firewall_driver = nova.virt.libvirt.firewall.IptablesFirewallDriver\n\nlibvirt_vif_driver = nova.virt.libvirt.vif.LibvirtGenericVIFDriver\n# libvirt_vif_driver = nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver\n# libvirt_vif_driver = nova.virt.libvirt.vif.LibvirtOpenVswitchVirtualPortDriver\n\n# Cinder\nvolume_api_class = nova.volume.cinder.API\nosapi_volume_listen_port = 5900\n\n# SPICE configuration - Dual-Stacked\n[spice]\nenabled = True\nspicehtml5proxy_host = ::\nhtml5proxy_base_url = http://ctrl:6082/spice_auto.html\nkeymap = en-us\n\n[database]\nconnection = mysql://novaUser:novaPass@ctrl/nova\n\n[keystone_authtoken]\nauth_uri = http://ctrl:5000\nauth_host = ctrl\nauth_port = 35357\nauth_protocol = http\nadmin_tenant_name = service\nadmin_user = nova\nadmin_password = service_pass", 
            "date_created": "2014-07-11 09:47:17.504398+00:00", 
            "author": "https://api.launchpad.net/1.0/~viossalm"
        }, 
        {
            "content": "i am using the same guide as Ville Salmela : https://gist.github.com/tmartinx/9177697\n\nA workarround will be to use 127.0.0.1 aka localhost. For me that is the solution.\nNow i hae other errors regarding this guide so maybe Salmela you can get in touch with me and lets figure out the problems :)", 
            "date_created": "2014-07-16 13:14:15.300748+00:00", 
            "author": "https://api.launchpad.net/1.0/~danalbu85"
        }, 
        {
            "content": "The problem seems to be that command \"sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\" is trying to append iptables with ipv6 rules wihle it should be appending ip6tables.", 
            "date_created": "2014-07-18 07:08:19.750277+00:00", 
            "author": "https://api.launchpad.net/1.0/~viossalm"
        }, 
        {
            "content": "Soon as this BUG becomes fixed, I'll kiss IPv4 a goodbye!     :-D\n\nOpenStack Metadata needs support to work over IPv6. I don't think that just replacing iptables by ip6tables, will fix it.\n\nProbably, the Metadata will work within the \"fe80::\" network and that will require more code re-factoring (I believe, I'm not a coder)...\n\nCheers!", 
            "date_created": "2014-08-18 22:38:39.444485+00:00", 
            "author": "https://api.launchpad.net/1.0/~martinx"
        }, 
        {
            "content": "Just hit this bug too. The bug is in nova/network/linux_net.py lines 447-449.\n\n        s = [('iptables', self.ipv4)]\n        if CONF.use_ipv6:\n            s += [('ip6tables', self.ipv6)]\n\nBasically, by default the command 'iptables' is used and when the use_ipv6 flag is True, the 'ip6tables' is only appended to the s list while I think it should actually replace the 'iptables' command.\n\nI have thus fixed it by changing the line:\ns += [('ip6tables', self.ipv6)]\nto:\ns = [('ip6tables', self.ipv6)]\n\nNot sure if my fix has an other impact so YMMV.", 
            "date_created": "2014-11-02 16:52:56.342576+00:00", 
            "author": "https://api.launchpad.net/1.0/~admiralobvious"
        }, 
        {
            "content": "Back in the original log, there is this line:\n\nStderr: \"iptables-restore v1.4.21: host/network `::1' not found\\nError occurred at line: 17\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n\nIt took me a while when I got pretty much the same error, but the real problem is that an error message has been appended to an iptables command.  And the reason I've found every time is an unguarded config var that is missing but used anyway (that's where the 'not found' part comes from).\n\nI'm new to OpenStack so maybe this is a dumb question, but I have searched and didn't find an answer. Is there a style guide that has a suggestion for guarding configuration variables? I'd love to fix at least the ones that have bitten me, but since this problem is so pervasive, it seems reasonable to have a policy for using config vars. \n\nMaybe \"At the point of use, if the var doesn't exist log an error\" OR \"on config load, verify that all required vars are set and use a default (?) if not.\"", 
            "date_created": "2014-12-16 23:24:37.969418+00:00", 
            "author": "https://api.launchpad.net/1.0/~kls-2"
        }, 
        {
            "content": "This one is more interesting:\n\nThe proposed solution will break the user-data url. So for example there can be setup where we have ipv6 for infra and ipv4 for guests with only one ipv4 gateway. In that case we wouldn't have 169.254.169.254 but overall with neutron nova should not touch iptables at all :/", 
            "date_created": "2015-03-16 14:45:06.824352+00:00", 
            "author": "https://api.launchpad.net/1.0/~social-b"
        }, 
        {
            "content": "This bug report is pretty old. If you can reproduce it on a currently supported release [1], please reopen this report and add the steps to reproduce.\n\nReferences:\nhttp://releases.openstack.org/", 
            "date_created": "2016-05-17 16:30:28.666846+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}