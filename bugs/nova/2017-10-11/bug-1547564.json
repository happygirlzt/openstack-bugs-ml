{
    "status": "Invalid", 
    "last_updated": "2016-04-18 17:46:26.714027+00:00", 
    "description": "$ nova baremetal-node-list\n\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'ironicclient.exc.AmbiguousAuthSystem'> (HTTP 500) (Request-ID: req-78138575-cdcc-408e-a232-dc717bfe96d9)\n\nNova API log.\n2016-02-19 15:38:04.507 DEBUG nova.osapi_compute.wsgi.server [req-48a19e8f-00dd-4fdf-a079-5cd17a030f7e None None] (31654) accepted ('10.0.0.150', 37341) from (pid=31654) server /usr/lib/python2.7/site-packages/eventlet/wsgi.py:867\n2016-02-19 15:38:04.508 DEBUG keystoneauth.session [-] REQ: curl -g -i --cacert \"/opt/stack/data/ca-bundle.pem\" -X GET http://10.0.0.150:35357/v3/auth/tokens -H \"X-Subject-Token: {SHA1}2548654be6a35b05a064f0bd15e4da50119ebeda\" -H \"User-Agent: python-keystoneclient\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}05b09de98dd6820f5766b21e415cbc27190125e6\" from (pid=31654) _http_log_request /usr/lib/python2.7/site-packages/keystoneauth1/session.py:248\n2016-02-19 15:38:04.524 DEBUG keystoneauth.session [-] RESP: [200] Content-Length: 4227 X-Subject-Token: {SHA1}2548654be6a35b05a064f0bd15e4da50119ebeda Vary: X-Auth-Token Keep-Alive: timeout=5, max=100 Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.1e-fips mod_wsgi/3.4 Python/2.7.5 Connection: Keep-Alive Date: Fri, 19 Feb 2016 15:38:04 GMT Content-Type: application/json x-openstack-request-id: req-4dd14b09-bc0e-4dfb-ae6c-76d77cbc0bd4\nRESP BODY: {\"token\": {\"methods\": [\"password\", \"token\"], \"roles\": [{\"id\": \"16109acaf0c640e4b96abeb2eca388e1\", \"name\": \"admin\"}], \"expires_at\": \"2016-02-19T16:38:04.000000Z\", \"project\": {\"domain\": {\"id\": \"default\", \"name\": \"Default\"}, \"id\": \"0b130fa37b9a44a696b64559e713e032\", \"name\": \"admin\"}, \"catalog\": \"<removed>\", \"user\": {\"domain\": {\"id\": \"default\", \"name\": \"Default\"}, \"id\": \"4e6697fd84604775b097bb53bd290367\", \"name\": \"admin\"}, \"audit_ids\": [\"kEE5cM-hRHyH50QppYnuOw\"], \"issued_at\": \"2016-02-19T15:38:04.499020\"}}\n from (pid=31654) _http_log_response /usr/lib/python2.7/site-packages/keystoneauth1/session.py:277\n2016-02-19 15:38:04.525 INFO nova.osapi_compute.wsgi.server [req-82377dd1-15fb-439c-959b-c1afec33091b admin admin] 10.0.0.150 \"GET /v2.1/0b130fa37b9a44a696b64559e713e032 HTTP/1.1\" status: 404 len: 264 time: 0.0177109\n2016-02-19 15:38:04.529 DEBUG nova.api.openstack.wsgi [req-24e38a23-d0ba-46aa-84ba-f6dfc27961e9 admin admin] Calling method '<bound method VersionsController.show of <nova.api.openstack.compute.versionsV21.VersionsController object at 0x7df5a10>>' from (pid=31654) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:699\n2016-02-19 15:38:04.530 INFO nova.osapi_compute.wsgi.server [req-24e38a23-d0ba-46aa-84ba-f6dfc27961e9 admin admin] 10.0.0.150 \"GET /v2.1/ HTTP/1.1\" status: 200 len: 652 time: 0.0027330\n2016-02-19 15:38:04.600 DEBUG nova.api.openstack.wsgi [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] Calling method '<bound method BareMetalNodeController.index of <nova.api.openstack.compute.baremetal_nodes.BareMetalNodeController object at 0x76b68d0>>' from (pid=31654) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:699\n2016-02-19 15:38:04.601 ERROR nova.api.openstack.extensions [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] Unexpected exception in API method\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 478, in wrapped\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/baremetal_nodes.py\", line 105, in index\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions     icli = _get_ironic_client()\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/baremetal_nodes.py\", line 76, in _get_ironic_client\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions     icli = ironic_client.get_client(CONF.ironic.api_version, **kwargs)\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/ironicclient/client.py\", line 106, in get_client\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions     raise exc.AmbiguousAuthSystem(e)\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions AmbiguousAuthSystem: Must provide Keystone credentials or user-defined endpoint and token\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions\n2016-02-19 15:38:04.601 INFO nova.api.openstack.wsgi [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'ironicclient.exc.AmbiguousAuthSystem'>\n2016-02-19 15:38:04.601 DEBUG nova.api.openstack.wsgi [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'ironicclient.exc.AmbiguousAuthSystem'> from (pid=31654) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1070\n2016-02-19 15:38:04.602 INFO nova.osapi_compute.wsgi.server [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] 10.0.0.150 \"GET /v2.1/0b130fa37b9a44a696b64559e713e032/os-baremetal-nodes HTTP/1.1\" status: 500 len: 513 time: 0.0036349\n\n\n* bug guideline stuff\n> git log -1\ncommit 4bcf6529d5096c16fd1b9c418d5c40d2bb8a2831\nMerge: 772e914 edc11c2\nAuthor: Jenkins <email address hidden>\nDate:   Thu Feb 18 06:50:18 2016 +0000\n\n    Merge \"Keystone support deploy in uwsgi\"\n\n\n> CentOS Linux release 7.2.1511 (Core) fresh install minimal\n> yum -y install wget telnet git\n> git clone https://git.openstack.org/openstack-dev/devstack\n> and have pretty much done nothing else but read the manuals.  \n\nTrying to launch instance in horizon and got:\nPlease try again later [Error: No valid host was found. There are not enough hosts available.].\n\nGoogled error and got https://ask.openstack.org/en/question/6445/no-valid-host-was-found-when-launching-an-instance/\nread that, and so thought to try the bare-metal-node list and it said to report it.\n\nExpected result: VM instance starts on default cirros image\n\nSorry too inexperienced with devstakc to produce script.\n\nGood luck", 
    "tags": [
        "api", 
        "ironic"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1547564", 
    "owner": "https://api.launchpad.net/1.0/~hussain-kamal", 
    "id": 1547564, 
    "index": 685, 
    "created": "2016-02-19 15:46:14.564388+00:00", 
    "title": "nova baremetal-node-list unexpected API error 500", 
    "comments": [
        {
            "content": "$ nova baremetal-node-list\n\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'ironicclient.exc.AmbiguousAuthSystem'> (HTTP 500) (Request-ID: req-78138575-cdcc-408e-a232-dc717bfe96d9)\n\nNova API log.\n2016-02-19 15:38:04.507 DEBUG nova.osapi_compute.wsgi.server [req-48a19e8f-00dd-4fdf-a079-5cd17a030f7e None None] (31654) accepted ('10.0.0.150', 37341) from (pid=31654) server /usr/lib/python2.7/site-packages/eventlet/wsgi.py:867\n2016-02-19 15:38:04.508 DEBUG keystoneauth.session [-] REQ: curl -g -i --cacert \"/opt/stack/data/ca-bundle.pem\" -X GET http://10.0.0.150:35357/v3/auth/tokens -H \"X-Subject-Token: {SHA1}2548654be6a35b05a064f0bd15e4da50119ebeda\" -H \"User-Agent: python-keystoneclient\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}05b09de98dd6820f5766b21e415cbc27190125e6\" from (pid=31654) _http_log_request /usr/lib/python2.7/site-packages/keystoneauth1/session.py:248\n2016-02-19 15:38:04.524 DEBUG keystoneauth.session [-] RESP: [200] Content-Length: 4227 X-Subject-Token: {SHA1}2548654be6a35b05a064f0bd15e4da50119ebeda Vary: X-Auth-Token Keep-Alive: timeout=5, max=100 Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.1e-fips mod_wsgi/3.4 Python/2.7.5 Connection: Keep-Alive Date: Fri, 19 Feb 2016 15:38:04 GMT Content-Type: application/json x-openstack-request-id: req-4dd14b09-bc0e-4dfb-ae6c-76d77cbc0bd4\nRESP BODY: {\"token\": {\"methods\": [\"password\", \"token\"], \"roles\": [{\"id\": \"16109acaf0c640e4b96abeb2eca388e1\", \"name\": \"admin\"}], \"expires_at\": \"2016-02-19T16:38:04.000000Z\", \"project\": {\"domain\": {\"id\": \"default\", \"name\": \"Default\"}, \"id\": \"0b130fa37b9a44a696b64559e713e032\", \"name\": \"admin\"}, \"catalog\": \"<removed>\", \"user\": {\"domain\": {\"id\": \"default\", \"name\": \"Default\"}, \"id\": \"4e6697fd84604775b097bb53bd290367\", \"name\": \"admin\"}, \"audit_ids\": [\"kEE5cM-hRHyH50QppYnuOw\"], \"issued_at\": \"2016-02-19T15:38:04.499020\"}}\n from (pid=31654) _http_log_response /usr/lib/python2.7/site-packages/keystoneauth1/session.py:277\n2016-02-19 15:38:04.525 INFO nova.osapi_compute.wsgi.server [req-82377dd1-15fb-439c-959b-c1afec33091b admin admin] 10.0.0.150 \"GET /v2.1/0b130fa37b9a44a696b64559e713e032 HTTP/1.1\" status: 404 len: 264 time: 0.0177109\n2016-02-19 15:38:04.529 DEBUG nova.api.openstack.wsgi [req-24e38a23-d0ba-46aa-84ba-f6dfc27961e9 admin admin] Calling method '<bound method VersionsController.show of <nova.api.openstack.compute.versionsV21.VersionsController object at 0x7df5a10>>' from (pid=31654) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:699\n2016-02-19 15:38:04.530 INFO nova.osapi_compute.wsgi.server [req-24e38a23-d0ba-46aa-84ba-f6dfc27961e9 admin admin] 10.0.0.150 \"GET /v2.1/ HTTP/1.1\" status: 200 len: 652 time: 0.0027330\n2016-02-19 15:38:04.600 DEBUG nova.api.openstack.wsgi [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] Calling method '<bound method BareMetalNodeController.index of <nova.api.openstack.compute.baremetal_nodes.BareMetalNodeController object at 0x76b68d0>>' from (pid=31654) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:699\n2016-02-19 15:38:04.601 ERROR nova.api.openstack.extensions [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] Unexpected exception in API method\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 478, in wrapped\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/baremetal_nodes.py\", line 105, in index\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions     icli = _get_ironic_client()\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/baremetal_nodes.py\", line 76, in _get_ironic_client\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions     icli = ironic_client.get_client(CONF.ironic.api_version, **kwargs)\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/ironicclient/client.py\", line 106, in get_client\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions     raise exc.AmbiguousAuthSystem(e)\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions AmbiguousAuthSystem: Must provide Keystone credentials or user-defined endpoint and token\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions\n2016-02-19 15:38:04.601 INFO nova.api.openstack.wsgi [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'ironicclient.exc.AmbiguousAuthSystem'>\n2016-02-19 15:38:04.601 DEBUG nova.api.openstack.wsgi [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'ironicclient.exc.AmbiguousAuthSystem'> from (pid=31654) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1070\n2016-02-19 15:38:04.602 INFO nova.osapi_compute.wsgi.server [req-78138575-cdcc-408e-a232-dc717bfe96d9 admin admin] 10.0.0.150 \"GET /v2.1/0b130fa37b9a44a696b64559e713e032/os-baremetal-nodes HTTP/1.1\" status: 500 len: 513 time: 0.0036349\n\n\n* bug guideline stuff\n> git log -1\ncommit 4bcf6529d5096c16fd1b9c418d5c40d2bb8a2831\nMerge: 772e914 edc11c2\nAuthor: Jenkins <email address hidden>\nDate:   Thu Feb 18 06:50:18 2016 +0000\n\n    Merge \"Keystone support deploy in uwsgi\"\n\n\n> CentOS Linux release 7.2.1511 (Core) fresh install minimal\n> yum -y install wget telnet git\n> git clone https://git.openstack.org/openstack-dev/devstack\n> and have pretty much done nothing else but read the manuals.  \n\nTrying to launch instance in horizon and got:\nPlease try again later [Error: No valid host was found. There are not enough hosts available.].\n\nGoogled error and got https://ask.openstack.org/en/question/6445/no-valid-host-was-found-when-launching-an-instance/\nread that, and so thought to try the bare-metal-node list and it said to report it.\n\nExpected result: VM instance starts on default cirros image\n\nSorry too inexperienced with devstakc to produce script.\n\nGood luck", 
            "date_created": "2016-02-19 15:46:14.564388+00:00", 
            "author": "https://api.launchpad.net/1.0/~q-w"
        }, 
        {
            "content": "It does look like this no longer works. The recommended approach is to access ironic directly. ", 
            "date_created": "2016-02-19 20:11:22.260191+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "The error is when nova is trying to talk to ironic via the ironic client, there is an auth error:\n\nTRACE nova.api.openstack.extensions raise exc.AmbiguousAuthSystem(e)\n2016-02-19 15:38:04.601 TRACE nova.api.openstack.extensions AmbiguousAuthSystem: Must provide Keystone credentials or user-defined endpoint and token\n\nSo you need to check your configuration in nova.conf to make sure it has the proper credentials to be able to talk to ironic.", 
            "date_created": "2016-04-18 14:40:59.543966+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Make sure you have the [ironic] section of nova.conf configured properly:\n\n[ironic]\n\n#\n# From nova.conf\n#\n\n# Version of Ironic API service endpoint. DEPRECATED: Setting the API version\n# is not possible anymore. (integer value)\n# This option is deprecated for removal.\n# Its value may be silently ignored in the future.\n#api_version = 1\n\n# URL for Ironic API endpoint. (string value)\n#api_endpoint = <None>\n\n# Ironic keystone admin name (string value)\n#admin_username = <None>\n\n# Ironic keystone admin password. (string value)\n#admin_password = <None>\n\n# Ironic keystone auth token.DEPRECATED: use admin_username, admin_password,\n# and admin_tenant_name instead (string value)\n# This option is deprecated for removal.\n# Its value may be silently ignored in the future.\n#admin_auth_token = <None>\n\n# Keystone public API endpoint. (string value)\n#admin_url = <None>\n\n# PEM encoded Certificate Authority to use when verifying HTTPs connections.\n# (string value)\n#cafile = <None>\n\n# Log level override for ironicclient. Set this in order to override the global\n# \"default_log_levels\", \"verbose\", and \"debug\" settings. DEPRECATED: use\n# standard logging configuration. (string value)\n# This option is deprecated for removal.\n# Its value may be silently ignored in the future.\n#client_log_level = <None>\n\n# Ironic keystone tenant name. (string value)\n#admin_tenant_name = <None>\n\n# How many retries when a request does conflict. If <= 0, only try once, no\n# retries. (integer value)\n#api_max_retries = 60\n\n# How often to retry in seconds when a request does conflict (integer value)\n#api_retry_interval = 2", 
            "date_created": "2016-04-18 14:43:15.252965+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "If you're using devstack and have just setup a basic environment, ironic is not enabled by default so that's probably your issue.", 
            "date_created": "2016-04-18 14:44:19.391319+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Thanks Matt for the input. I did verify that this is indeed a problem with the devstack configuration. I modified the local.conf based on the instructions from this link - http://docs.openstack.org/developer/ironic/dev/dev-quickstart.html\n\nAfter that, the command showed the right output:\n\nubuntu@devstack-kamal:~$ nova baremetal-node-list\n+--------------------------------------+----------------+------------+------+-----------+---------+-------------+------------+-------------+-------------+---------------+\n| ID                                   | Host           | Task State | CPUs | Memory_MB | Disk_GB | MAC Address | PM Address | PM Username | PM Password | Terminal Port |\n+--------------------------------------+----------------+------------+------+-----------+---------+-------------+------------+-------------+-------------+---------------+\n| fcb9de55-71d1-4a93-91fd-7771bcf5b676 | IRONIC MANAGED | available  | 1    | 1024      | 10      |             |            |             |             |               |\n| 09e70ef4-2e04-427d-af0c-1bcb4b792d0d | IRONIC MANAGED | available  | 1    | 1024      | 10      |             |            |             |             |               |\n| 465cadc8-99ce-42c4-8e97-a3693d34d9b4 | IRONIC MANAGED | available  | 1    | 1024      | 10      |             |            |             |             |               |\n+--------------------------------------+----------------+------------+------+-----------+---------+-------------+------------+-------------+-------------+---------------+\n\nThis issue can be closed.", 
            "date_created": "2016-04-18 17:46:26.267371+00:00", 
            "author": "https://api.launchpad.net/1.0/~hussain-kamal"
        }
    ]
}