{
    "status": "Invalid", 
    "last_updated": "2016-07-13 13:20:37.244840+00:00", 
    "description": "Hi all,\n\nI have a Centos 7.1 kilo deployment, using sr-iov ports to my instances. I'm trying to configure NUMA topology and CPU pinning for some telco based workloads.\n\nI have 3 compute nodes, I'm trying to use one of them to use cpu pinning.\n\nI've configured it like this:\nCompute Node (total 24 cpus)\n\n/etc/nova/nova.conf\nvcpu_pin_set=2,3,4,5,6,7,8,9,10,11,12,13,14,15,18,19,22,23\n\nChanged grub to isolate my cpus:\n#grubby --update-kernel=ALL --args=\"isolcpus=2,3,4,5,6,7,8,9,10,11,12,13,14,15,18,19,22,23\"\n#grub2-install /dev/sda\n\n\nController Nodes:\n\n/etc/nova/nova.conf\nscheduler_default_filters=RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,ComputeCapabilitiesFilter,ImagePropertiesFilter,ServerGroupAntiAffinityFilter,ServerGroupAffinityFilter,PciPassthroughFilter,NUMATopologyFilter,AggregateInstanceExtraSpecsFilter\nscheduler_available_filters = nova.scheduler.filters.all_filters\nscheduler_available_filters = nova.scheduler.filters.pci_passthrough_filter.PciPassthroughFilter\n\nCreated host aggregate performance \n#nova aggregate-create performance\n#nova aggregate-set-metadata 1 pinned=true\n#nova aggregate-add-host 1 compute03\n\nCreated host aggregate normal\n#nova aggregate-create normal\n#nova aggregate-set-metadata 2 pinned=false\n#nova aggregate-add-host 2 compute01\n#nova aggregate-add-host 2 compute02\n\nCreated the flavor with cpu pinning\n#nova flavor-create m1.performance 6 2048 20 4\n#nova flavor-key 6 set hw:cpu_policy=dedicated\n#nova flavor-key 6 set aggregate_instance_extra_specs:pinned=true\n\nThe issue is:\nWith SR-IOV ports it only let's me create instances with 6 vcpus in total with the conf described above. Without SR-IOV, using OVS, I don't have that limitation. Is this a bug or something? I've seen this: https://bugs.launchpad.net/nova/+bug/1441169, however I have the patch, and as I said it works for the first 6 vcpus with my configuration. \n\nSome relevant logs:\n/var/log/nova/nova-scheduler.log\n2015-11-06 11:18:17.955 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Starting with 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:70\n2015-11-06 11:18:17.955 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter RetryFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.955 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter AvailabilityZoneFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.955 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter RamFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ComputeFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ComputeCapabilitiesFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ImagePropertiesFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ServerGroupAntiAffinityFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ServerGroupAffinityFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.957 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter PciPassthroughFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.959 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter NUMATopologyFilter returned 2 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84", 
    "tags": [
        "scheduler"
    ], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1513808", 
    "owner": "None", 
    "id": 1513808, 
    "index": 5830, 
    "created": "2015-11-06 11:39:09.297191+00:00", 
    "title": "cannot schedule instances in NUMA topology with more than 6 vcpus using SR-IOV ports", 
    "comments": [
        {
            "content": "Hi all,\n\nI have a Centos 7.1 kilo deployment, using sr-iov ports to my instances. I'm trying to configure NUMA topology and CPU pinning for some telco based workloads.\n\nI have 3 compute nodes, I'm trying to use one of them to use cpu pinning.\n\nI've configured it like this:\nCompute Node (total 24 cpus)\n\n/etc/nova/nova.conf\nvcpu_pin_set=2,3,4,5,6,7,8,9,10,11,12,13,14,15,18,19,22,23\n\nChanged grub to isolate my cpus:\n#grubby --update-kernel=ALL --args=\"isolcpus=2,3,4,5,6,7,8,9,10,11,12,13,14,15,18,19,22,23\"\n#grub2-install /dev/sda\n\n\nController Nodes:\n\n/etc/nova/nova.conf\nscheduler_default_filters=RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,ComputeCapabilitiesFilter,ImagePropertiesFilter,ServerGroupAntiAffinityFilter,ServerGroupAffinityFilter,PciPassthroughFilter,NUMATopologyFilter,AggregateInstanceExtraSpecsFilter\nscheduler_available_filters = nova.scheduler.filters.all_filters\nscheduler_available_filters = nova.scheduler.filters.pci_passthrough_filter.PciPassthroughFilter\n\nCreated host aggregate performance \n#nova aggregate-create performance\n#nova aggregate-set-metadata 1 pinned=true\n#nova aggregate-add-host 1 compute03\n\nCreated host aggregate normal\n#nova aggregate-create normal\n#nova aggregate-set-metadata 2 pinned=false\n#nova aggregate-add-host 2 compute01\n#nova aggregate-add-host 2 compute02\n\nCreated the flavor with cpu pinning\n#nova flavor-create m1.performance 6 2048 20 4\n#nova flavor-key 6 set hw:cpu_policy=dedicated\n#nova flavor-key 6 set aggregate_instance_extra_specs:pinned=true\n\nThe issue is:\nWith SR-IOV ports it only let's me create instances with 6 vcpus in total with the conf described above. Without SR-IOV, using OVS, I don't have that limitation. Is this a bug or something? I've seen this: https://bugs.launchpad.net/nova/+bug/1441169, however I have the patch, and as I said it works for the first 6 vcpus with my configuration. \n\nSome relevant logs:\n/var/log/nova/nova-scheduler.log\n2015-11-06 11:18:17.955 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Starting with 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:70\n2015-11-06 11:18:17.955 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter RetryFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.955 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter AvailabilityZoneFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.955 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter RamFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ComputeFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ComputeCapabilitiesFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ImagePropertiesFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ServerGroupAntiAffinityFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.956 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter ServerGroupAffinityFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.957 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter PciPassthroughFilter returned 3 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84\n2015-11-06 11:18:17.959 59494 DEBUG nova.filters [req-9e20f8a9-384f-45c2-aa99-2d7b3100c98d 9340dc4e70a14aeb82013e5a1631de80 d5ecb0eea96f4996b565fd983a768b11 - - -] Filter NUMATopologyFilter returned 2 host(s) get_filtered_objects /usr/lib/python2.7/site-packages/nova/filters.py:84", 
            "date_created": "2015-11-06 11:39:09.297191+00:00", 
            "author": "https://api.launchpad.net/1.0/~pgsousa"
        }, 
        {
            "content": "Hi Pedro, I'm sorry that it's taken so long to follow up with you on this issue. Are you still experiencing this issue?", 
            "date_created": "2016-03-29 23:54:27.384441+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "Pedro, which version of Nova are you experiencing this issue with? Is this on the latest master, Mitaka, Liberty, Kilo, etc?", 
            "date_created": "2016-05-17 18:18:22.989370+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "\nThis bug lacks the necessary information to effectively reproduce and\nfix it, therefore it has been closed. Feel free to reopen the bug by\nproviding the requested information and set the bug status back to \"New\".\n", 
            "date_created": "2016-07-13 13:20:36.536158+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}