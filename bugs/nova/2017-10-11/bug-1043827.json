{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:31:43.362004+00:00", 
    "description": "When I try to launch an instance with a quantum network without subnet, allocate_for_instance() returns non-related subnet info for a port on a network without subnet.\n\nTo reproduce this bug, we need to have at least one network with subnet and one network without subnet.\n\nubuntu@test1:/opt/stack/nova (master)$ quantum net-list\n+----------------+--------------------------------------+------+--------+--------+--------------------------------------+----------------------------------+\n| admin_state_up | id                                   | name | shared | status | subnets                              | tenant_id                        |\n+----------------+--------------------------------------+------+--------+--------+--------------------------------------+----------------------------------+\n| True           | 210d15fe-107a-4449-9891-28fae7ac4436 | net1 | False  | ACTIVE | 1f1b9f14-8740-41d9-9e08-b1c7badb67ba | c018797b92a44d32be665a8663a723c3 |\n| True           | 622a98dd-bd0c-4fb7-a2c5-a639290a5073 | net2 | False  | ACTIVE |                                      | c018797b92a44d32be665a8663a723c3 |\n+----------------+--------------------------------------+------+--------+--------+--------------------------------------+----------------------------------+\nubuntu@test1:/opt/stack/nova (master)$ quantum subnet-list\n+--------------------------------------------+-------------+-----------------+-------------+------------+-------------+--------------------------------------+------------+------+--------------------------------------+----------------------------------+\n| allocation_pools                           | cidr        | dns_nameservers | enable_dhcp | gateway_ip | host_routes | id                                   | ip_version | name | network_id                           | tenant_id                        |\n+--------------------------------------------+-------------+-----------------+-------------+------------+-------------+--------------------------------------+------------+------+--------------------------------------+----------------------------------+\n| {\"start\": \"10.0.0.2\", \"end\": \"10.0.0.254\"} | 10.0.0.0/24 | []              | True        | 10.0.0.1   | []          | 1f1b9f14-8740-41d9-9e08-b1c7badb67ba |          4 |      | 210d15fe-107a-4449-9891-28fae7ac4436 | c018797b92a44d32be665a8663a723c3 |\n+--------------------------------------------+-------------+-----------------+-------------+------------+-------------+--------------------------------------+------------+------+--------------------------------------+----------------------------------+\n\nThen, launch an instance: nova boot --image c5b29b5f-3252-4c18-809b-407dc9eb9d13 --flavor 1 --nic net-id=622a98dd-bd0c-4fb7-a2c5-a639290a5073 s1\n\nnova-compute log says:\n\nInstance network_info: |[VIF({'network': Network({'bridge': '', 'subnets': [Subnet({'ips': [], 'version': 4, 'meta': {}, 'dns': [], \n'routes': [], 'cidr': u'10.0.0.0/24', 'gateway': IP({'meta': {}, 'version': 4, 'type': 'gateway', 'address': u'10.0.0.1'})})], 'meta': \n{'injected': False, 'tenant_id': u'c018797b92a44d32be665a8663a723c3'}, 'id': u'622a98dd-bd0c-4fb7-a2c5-a639290a5073', 'label': u'net2'}), \n'meta': {}, 'id': u'9db0c542-36ae-4565-ac51-de4aee9fee89', 'address': u'fa:16:3e:66:51:97'})]|\n\nThe port is created on a network without subnet and no subnet is associated with the port.\n\nIf there is no subnet, network_info returned by allocate_for_instance() is as follows. It is an expected behavior.\n\nInstance network_info: |[VIF({'network': Network({'bridge': '', 'subnets': [], 'meta': {'injected': False, 'tenant_id': u'c018797b92a44d32be665a8663a723c3'}, 'id': u'622a98dd-bd0c-4fb7-a2c5-a639290a5073', 'label': u'net2'}), 'meta': {}, 'id': u'62c0f806-ca9f-4e91-bd81-41c1fdd29f26', 'address': u'fa:16:3e:b6:19:f5'})]|", 
    "tags": [
        "quantum"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1043827", 
    "owner": "https://api.launchpad.net/1.0/~amotoki", 
    "id": 1043827, 
    "index": 780, 
    "created": "2012-08-30 13:23:12.291340+00:00", 
    "title": "quantum allocate_for_instance() returns non-related subnet info for a port on a network without subnet", 
    "comments": [
        {
            "content": "When I try to launch an instance with a quantum network without subnet, allocate_for_instance() returns non-related subnet info for a port on a network without subnet.\n\nTo reproduce this bug, we need to have at least one network with subnet and one network without subnet.\n\nubuntu@test1:/opt/stack/nova (master)$ quantum net-list\n+----------------+--------------------------------------+------+--------+--------+--------------------------------------+----------------------------------+\n| admin_state_up | id                                   | name | shared | status | subnets                              | tenant_id                        |\n+----------------+--------------------------------------+------+--------+--------+--------------------------------------+----------------------------------+\n| True           | 210d15fe-107a-4449-9891-28fae7ac4436 | net1 | False  | ACTIVE | 1f1b9f14-8740-41d9-9e08-b1c7badb67ba | c018797b92a44d32be665a8663a723c3 |\n| True           | 622a98dd-bd0c-4fb7-a2c5-a639290a5073 | net2 | False  | ACTIVE |                                      | c018797b92a44d32be665a8663a723c3 |\n+----------------+--------------------------------------+------+--------+--------+--------------------------------------+----------------------------------+\nubuntu@test1:/opt/stack/nova (master)$ quantum subnet-list\n+--------------------------------------------+-------------+-----------------+-------------+------------+-------------+--------------------------------------+------------+------+--------------------------------------+----------------------------------+\n| allocation_pools                           | cidr        | dns_nameservers | enable_dhcp | gateway_ip | host_routes | id                                   | ip_version | name | network_id                           | tenant_id                        |\n+--------------------------------------------+-------------+-----------------+-------------+------------+-------------+--------------------------------------+------------+------+--------------------------------------+----------------------------------+\n| {\"start\": \"10.0.0.2\", \"end\": \"10.0.0.254\"} | 10.0.0.0/24 | []              | True        | 10.0.0.1   | []          | 1f1b9f14-8740-41d9-9e08-b1c7badb67ba |          4 |      | 210d15fe-107a-4449-9891-28fae7ac4436 | c018797b92a44d32be665a8663a723c3 |\n+--------------------------------------------+-------------+-----------------+-------------+------------+-------------+--------------------------------------+------------+------+--------------------------------------+----------------------------------+\n\nThen, launch an instance: nova boot --image c5b29b5f-3252-4c18-809b-407dc9eb9d13 --flavor 1 --nic net-id=622a98dd-bd0c-4fb7-a2c5-a639290a5073 s1\n\nnova-compute log says:\n\nInstance network_info: |[VIF({'network': Network({'bridge': '', 'subnets': [Subnet({'ips': [], 'version': 4, 'meta': {}, 'dns': [], \n'routes': [], 'cidr': u'10.0.0.0/24', 'gateway': IP({'meta': {}, 'version': 4, 'type': 'gateway', 'address': u'10.0.0.1'})})], 'meta': \n{'injected': False, 'tenant_id': u'c018797b92a44d32be665a8663a723c3'}, 'id': u'622a98dd-bd0c-4fb7-a2c5-a639290a5073', 'label': u'net2'}), \n'meta': {}, 'id': u'9db0c542-36ae-4565-ac51-de4aee9fee89', 'address': u'fa:16:3e:66:51:97'})]|\n\nThe port is created on a network without subnet and no subnet is associated with the port.\n\nIf there is no subnet, network_info returned by allocate_for_instance() is as follows. It is an expected behavior.\n\nInstance network_info: |[VIF({'network': Network({'bridge': '', 'subnets': [], 'meta': {'injected': False, 'tenant_id': u'c018797b92a44d32be665a8663a723c3'}, 'id': u'622a98dd-bd0c-4fb7-a2c5-a639290a5073', 'label': u'net2'}), 'meta': {}, 'id': u'62c0f806-ca9f-4e91-bd81-41c1fdd29f26', 'address': u'fa:16:3e:b6:19:f5'})]|", 
            "date_created": "2012-08-30 13:23:12.291340+00:00", 
            "author": "https://api.launchpad.net/1.0/~amotoki"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/12195", 
            "date_created": "2012-08-30 14:36:07.019703+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/12195\nCommitted: http://github.com/openstack/nova/commit/0874cb9b69a0e82c527497c5d98b5b19039b5947\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0874cb9b69a0e82c527497c5d98b5b19039b5947\nAuthor: Akihiro MOTOKI <email address hidden>\nDate:   Thu Aug 30 23:27:59 2012 +0900\n\n    Make sure to return an empty subnet list for a network without sunbet.\n    \n    Fixes bug 1043827.\n    \n    This commit fixes a bug that when launching an instance with a quantum\n    network without subnet allocate_for_instance() in network/quantumv2/api.py\n    returns non-related subnet info as instance_nw_info.\n    A port created on a network without subnet is associated with no subnet and\n    subnet info in instance_nw_info should be an empty list.\n    \n    Change-Id: I2cfb78886ab10dd94eb795f5288b26b77f379998\n", 
            "date_created": "2012-09-18 21:03:25.895860+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}