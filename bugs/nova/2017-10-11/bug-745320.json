{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:34:57.707368+00:00", 
    "description": "When using nova-manage instance_type, it is difficult to change existing instance types.  Delete / Create leads to the following issue:\n\n(nova.instance_types): TRACE: Traceback (most recent call last):\n(nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/compute/instance_types.py\", line 60, in create\n(nova.instance_types): TRACE:     rxtx_cap=rxtx_cap))\n(nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/api.py\", line 1119, in instance_type_create\n(nova.instance_types): TRACE:     return IMPL.instance_type_create(context, values)\n(nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/sqlalchemy/api.py\", line 98, in wrapper\n(nova.instance_types): TRACE:     return f(*args, **kwargs)\n(nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/sqlalchemy/api.py\", line 2343, in instance_type_create\n(nova.instance_types): TRACE:     raise exception.DBError(e)\n(nova.instance_types): TRACE: DBError: (IntegrityError) (1062, \"Duplicate entry 'm1.tiny' for key 'name'\") 'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2011, 3, 29, 22, 17, 58, 491739), None, None, False, 'm1.tiny', '512', '1', '0', '9', 0, 0, 0)\n(nova.instance_types): TRACE: \n\nThe problem is that delete instance type just marks the field deleted, and flavor_id and name are both marked unique.  They should either be changed to not unique, or there should be some logic in delete to actaully permanently remove the record instead of just marking it deleted.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/745320", 
    "owner": "https://api.launchpad.net/1.0/~ken-pepple", 
    "id": 745320, 
    "index": 2342, 
    "created": "2011-03-29 22:22:52.895077+00:00", 
    "title": "nova-manage delete / create can't replace instance types.", 
    "comments": [
        {
            "content": "When using nova-manage instance_type, it is difficult to change existing instance types.  Delete / Create leads to the following issue:\n\n(nova.instance_types): TRACE: Traceback (most recent call last):\n(nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/compute/instance_types.py\", line 60, in create\n(nova.instance_types): TRACE:     rxtx_cap=rxtx_cap))\n(nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/api.py\", line 1119, in instance_type_create\n(nova.instance_types): TRACE:     return IMPL.instance_type_create(context, values)\n(nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/sqlalchemy/api.py\", line 98, in wrapper\n(nova.instance_types): TRACE:     return f(*args, **kwargs)\n(nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/sqlalchemy/api.py\", line 2343, in instance_type_create\n(nova.instance_types): TRACE:     raise exception.DBError(e)\n(nova.instance_types): TRACE: DBError: (IntegrityError) (1062, \"Duplicate entry 'm1.tiny' for key 'name'\") 'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2011, 3, 29, 22, 17, 58, 491739), None, None, False, 'm1.tiny', '512', '1', '0', '9', 0, 0, 0)\n(nova.instance_types): TRACE: \n\nThe problem is that delete instance type just marks the field deleted, and flavor_id and name are both marked unique.  They should either be changed to not unique, or there should be some logic in delete to actaully permanently remove the record instead of just marking it deleted.", 
            "date_created": "2011-03-29 22:22:52.895077+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "there is a way to permanently delete (use the --purge option with $ nova-manage instance_type delete) but it shouldn't stack trace and there should be better output to alert admins to the problem. \n\nI will correct this.\n", 
            "date_created": "2011-03-29 22:27:51.276422+00:00", 
            "author": "https://api.launchpad.net/1.0/~ken-pepple"
        }, 
        {
            "content": "vishy -- is this a better output ? It tells you probable problem at bottom with full list of current instance_types ...\n\n(nova)k-2:lp745320 kpepple$ bin/nova-manage instance_type create x1.gigantic 256 2 10 10\n2011-04-07 15:05:09,259 ERROR nova.exception [-] DB exception wrapped\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/exception.py\", line 109, in _wrap\n(nova.exception): TRACE:     return f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1346, in flush\n(nova.exception): TRACE:     self._flush(objects)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1427, in _flush\n(nova.exception): TRACE:     flush_context.execute()\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 299, in execute\n(nova.exception): TRACE:     rec.execute(self)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 443, in execute\n(nova.exception): TRACE:     uow\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/mapper.py\", line 1833, in _save_obj\n(nova.exception): TRACE:     execute(statement, params)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1157, in execute\n(nova.exception): TRACE:     params)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1237, in _execute_clauseelement\n(nova.exception): TRACE:     return self.__execute_context(context)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1268, in __execute_context\n(nova.exception): TRACE:     context.parameters[0], context=context)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1367, in _cursor_execute\n(nova.exception): TRACE:     context)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1360, in _cursor_execute\n(nova.exception): TRACE:     context)\n(nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/default.py\", line 288, in do_execute\n(nova.exception): TRACE:     cursor.execute(statement, parameters)\n(nova.exception): TRACE: IntegrityError: (IntegrityError) column name is not unique u'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)' ('2011-04-07 22:05:09.256953', None, None, False, 'x1.gigantic', '256', '2', '10', '10', 0, 0, 0)\n(nova.exception): TRACE: \n2011-04-07 15:05:09,264 ERROR nova.instance_types [-] DB error: (IntegrityError) column name is not unique u'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)' ('2011-04-07 22:05:09.256953', None, None, False, 'x1.gigantic', '256', '2', '10', '10', 0, 0, 0)\n(nova.instance_types): TRACE: Traceback (most recent call last):\n(nova.instance_types): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/compute/instance_types.py\", line 60, in create\n(nova.instance_types): TRACE:     rxtx_cap=rxtx_cap))\n(nova.instance_types): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/db/api.py\", line 1119, in instance_type_create\n(nova.instance_types): TRACE:     return IMPL.instance_type_create(context, values)\n(nova.instance_types): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/db/sqlalchemy/api.py\", line 98, in wrapper\n(nova.instance_types): TRACE:     return f(*args, **kwargs)\n(nova.instance_types): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/db/sqlalchemy/api.py\", line 2343, in instance_type_create\n(nova.instance_types): TRACE:     raise exception.DBError(e)\n(nova.instance_types): TRACE: DBError: (IntegrityError) column name is not unique u'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)' ('2011-04-07 22:05:09.256953', None, None, False, 'x1.gigantic', '256', '2', '10', '10', 0, 0, 0)\n(nova.instance_types): TRACE: \n/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/exception.py:50: DeprecationWarning: BaseException.message has been deprecated as of Python 2.6\n  self.message = message\nPlease ensure instance_type name and flavor id are unique\nHere are the already defined instance_type names and flavorids:\nm1.medium: Memory: 4096MB, VCPUS: 2, Storage: 40GB, FlavorID: 3, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\nm1.small: Memory: 2048MB, VCPUS: 1, Storage: 20GB, FlavorID: 2, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\nm1.large: Memory: 8192MB, VCPUS: 4, Storage: 80GB, FlavorID: 4, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\nm1.tiny: Memory: 512MB, VCPUS: 1, Storage: 0GB, FlavorID: 1, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\nx1.gigantic: Memory: 256MB, VCPUS: 2, Storage: 10GB, FlavorID: 10, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\nm1.xlarge: Memory: 16384MB, VCPUS: 8, Storage: 160GB, FlavorID: 5, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\n$ ", 
            "date_created": "2011-04-07 22:07:29.195990+00:00", 
            "author": "https://api.launchpad.net/1.0/~ken-pepple"
        }, 
        {
            "content": "Seems like it might be nice to mention the --purge option somewhere if it is needed to change an existing type.\n\nVish\n\nOn Apr 7, 2011, at 3:07 PM, Ken Pepple wrote:\n\n> vishy -- is this a better output ? It tells you probable problem at\n> bottom with full list of current instance_types ...\n> \n> (nova)k-2:lp745320 kpepple$ bin/nova-manage instance_type create x1.gigantic 256 2 10 10\n> 2011-04-07 15:05:09,259 ERROR nova.exception [-] DB exception wrapped\n> (nova.exception): TRACE: Traceback (most recent call last):\n> (nova.exception): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/exception.py\", line 109, in _wrap\n> (nova.exception): TRACE:     return f(*args, **kwargs)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1346, in flush\n> (nova.exception): TRACE:     self._flush(objects)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1427, in _flush\n> (nova.exception): TRACE:     flush_context.execute()\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 299, in execute\n> (nova.exception): TRACE:     rec.execute(self)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 443, in execute\n> (nova.exception): TRACE:     uow\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/orm/mapper.py\", line 1833, in _save_obj\n> (nova.exception): TRACE:     execute(statement, params)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1157, in execute\n> (nova.exception): TRACE:     params)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1237, in _execute_clauseelement\n> (nova.exception): TRACE:     return self.__execute_context(context)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1268, in __execute_context\n> (nova.exception): TRACE:     context.parameters[0], context=context)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1367, in _cursor_execute\n> (nova.exception): TRACE:     context)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1360, in _cursor_execute\n> (nova.exception): TRACE:     context)\n> (nova.exception): TRACE:   File \"/Users/kpepple/.virtualenvs/nova/lib/python2.6/site-packages/sqlalchemy/engine/default.py\", line 288, in do_execute\n> (nova.exception): TRACE:     cursor.execute(statement, parameters)\n> (nova.exception): TRACE: IntegrityError: (IntegrityError) column name is not unique u'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)' ('2011-04-07 22:05:09.256953', None, None, False, 'x1.gigantic', '256', '2', '10', '10', 0, 0, 0)\n> (nova.exception): TRACE: \n> 2011-04-07 15:05:09,264 ERROR nova.instance_types [-] DB error: (IntegrityError) column name is not unique u'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)' ('2011-04-07 22:05:09.256953', None, None, False, 'x1.gigantic', '256', '2', '10', '10', 0, 0, 0)\n> (nova.instance_types): TRACE: Traceback (most recent call last):\n> (nova.instance_types): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/compute/instance_types.py\", line 60, in create\n> (nova.instance_types): TRACE:     rxtx_cap=rxtx_cap))\n> (nova.instance_types): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/db/api.py\", line 1119, in instance_type_create\n> (nova.instance_types): TRACE:     return IMPL.instance_type_create(context, values)\n> (nova.instance_types): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/db/sqlalchemy/api.py\", line 98, in wrapper\n> (nova.instance_types): TRACE:     return f(*args, **kwargs)\n> (nova.instance_types): TRACE:   File \"/Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/db/sqlalchemy/api.py\", line 2343, in instance_type_create\n> (nova.instance_types): TRACE:     raise exception.DBError(e)\n> (nova.instance_types): TRACE: DBError: (IntegrityError) column name is not unique u'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)' ('2011-04-07 22:05:09.256953', None, None, False, 'x1.gigantic', '256', '2', '10', '10', 0, 0, 0)\n> (nova.instance_types): TRACE: \n> /Users/kpepple/Documents/dev/openstack/src/nova/lp745320/nova/exception.py:50: DeprecationWarning: BaseException.message has been deprecated as of Python 2.6\n>  self.message = message\n> Please ensure instance_type name and flavor id are unique\n> Here are the already defined instance_type names and flavorids:\n> m1.medium: Memory: 4096MB, VCPUS: 2, Storage: 40GB, FlavorID: 3, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\n> m1.small: Memory: 2048MB, VCPUS: 1, Storage: 20GB, FlavorID: 2, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\n> m1.large: Memory: 8192MB, VCPUS: 4, Storage: 80GB, FlavorID: 4, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\n> m1.tiny: Memory: 512MB, VCPUS: 1, Storage: 0GB, FlavorID: 1, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\n> x1.gigantic: Memory: 256MB, VCPUS: 2, Storage: 10GB, FlavorID: 10, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\n> m1.xlarge: Memory: 16384MB, VCPUS: 8, Storage: 160GB, FlavorID: 5, Swap: 0GB, RXTX Quota: 0GB, RXTX Cap: 0MB\n> $ \n> \n> ** Branch linked: lp:~ken-pepple/nova/lp745320\n> \n> -- \n> You received this bug notification because you are a direct subscriber\n> of the bug.\n> https://bugs.launchpad.net/bugs/745320\n> \n> Title:\n>  nova-manage delete / create can't replace instance types.\n> \n> Status in OpenStack Compute (Nova):\n>  In Progress\n> \n> Bug description:\n>  When using nova-manage instance_type, it is difficult to change\n>  existing instance types.  Delete / Create leads to the following\n>  issue:\n> \n>  (nova.instance_types): TRACE: Traceback (most recent call last):\n>  (nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/compute/instance_types.py\", line 60, in create\n>  (nova.instance_types): TRACE:     rxtx_cap=rxtx_cap))\n>  (nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/api.py\", line 1119, in instance_type_create\n>  (nova.instance_types): TRACE:     return IMPL.instance_type_create(context, values)\n>  (nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/sqlalchemy/api.py\", line 98, in wrapper\n>  (nova.instance_types): TRACE:     return f(*args, **kwargs)\n>  (nova.instance_types): TRACE:   File \"/home/vishvananda/trunk/nova/db/sqlalchemy/api.py\", line 2343, in instance_type_create\n>  (nova.instance_types): TRACE:     raise exception.DBError(e)\n>  (nova.instance_types): TRACE: DBError: (IntegrityError) (1062, \"Duplicate entry 'm1.tiny' for key 'name'\") 'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, local_gb, flavorid, swap, rxtx_quota, rxtx_cap) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2011, 3, 29, 22, 17, 58, 491739), None, None, False, 'm1.tiny', '512', '1', '0', '9', 0, 0, 0)\n>  (nova.instance_types): TRACE: \n> \n>  The problem is that delete instance type just marks the field deleted,\n>  and flavor_id and name are both marked unique.  They should either be\n>  changed to not unique, or there should be some logic in delete to\n>  actaully permanently remove the record instead of just marking it\n>  deleted.\n> \n> To unsubscribe from this bug, go to:\n> https://bugs.launchpad.net/nova/+bug/745320/+subscribe\n\n", 
            "date_created": "2011-04-07 22:38:07+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "now we are just coddling our admins ... :)\n\nchanged and re-pushed.\n", 
            "date_created": "2011-04-08 00:39:40.422588+00:00", 
            "author": "https://api.launchpad.net/1.0/~ken-pepple"
        }
    ]
}