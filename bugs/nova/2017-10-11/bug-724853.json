{
    "status": "Invalid", 
    "last_updated": "2011-02-25 19:51:33.988748+00:00", 
    "description": "In the past new images were available after a few seconds or minutes after finished the upload. Now we only see the state \"decrypting\" and only files \"image.encrypted\". We're using bzrrev 732. Also we don't have running processes on the nova-objectstore system with high cpu usage.\n\nIn objectstore.log we have the following error:\n\n---snip---\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Process Process-3:\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Traceback (most recent call last):\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/multiprocessing/process.py\", line 231, in _bootstrap\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     self.run()\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/multiprocessing/process.py\", line 88, in run\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     self._target(*self._args, **self._kwargs)\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/site-packages/nova/objectstore/image.py\", line 242, in register_aws_image\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     cloud_private_key, decrypted_filename)\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/site-packages/nova/objectstore/image.py\", line 263, in decrypt_image\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     % err)\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Error: Failed to decrypt private key: RSA operation error\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] 1918:error:0407106B:rsa routines:RSA_padding_check_PKCS1_type_2:block type is not 02:rsa_pk1.c:190:\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] 1918:error:04065072:rsa routines:RSA_EAY_PRIVATE_DECRYPT:padding check failed:rsa_eay.c:596:\n---snap---\n\nI think the CA stuff looks good:\n---snip---\nchronos:/var/lib/nova/CA # ./genrootca.sh \nNot installing, it's already done.\n---snap---\n\n---snip---\nIMAGE\tami-0h5aejwo\tdebian_kernel/vmlinuz-2.6.28-11-generic.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tkernel\t\ttrue\nIMAGE\tami-0zt2o6tu\tdebian_image/debian.5-0.x86-64.img.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tmachine\tami-qbqcxp5d\tami-0h5aejwo\nIMAGE\tami-qbqcxp5d\tdebian_ramdisk/initrd.img-2.6.28-11-generic.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tramdisk\ttrue\t\n---snap---\n\n---snip---\nchronos:/srv/images # find .\n.\n./ami-0h5aejwo\n./ami-0h5aejwo/image.encrypted\n./ami-0h5aejwo/info.json\n./ami-0zt2o6tu\n./ami-0zt2o6tu/image.encrypted\n./ami-0zt2o6tu/info.json\n./lost+found\n./ami-qbqcxp5d\n./ami-qbqcxp5d/image.encrypted\n./ami-qbqcxp5d/info.json\n---snap---", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/724853", 
    "owner": "None", 
    "id": 724853, 
    "index": 2047, 
    "created": "2011-02-25 10:09:06.718308+00:00", 
    "title": "after uploading images to nova-objectstore they are only decrypting ", 
    "comments": [
        {
            "content": "In the past new images were available after a few seconds or minutes after finished the upload. Now we only see the state \"decrypting\" and only files \"image.encrypted\". We're using bzrrev 732. Also we don't have running processes on the nova-objectstore system with high cpu usage.\n\nIn objectstore.log we have the following error:\n\n---snip---\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Process Process-3:\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Traceback (most recent call last):\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/multiprocessing/process.py\", line 231, in _bootstrap\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     self.run()\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/multiprocessing/process.py\", line 88, in run\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     self._target(*self._args, **self._kwargs)\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/site-packages/nova/objectstore/image.py\", line 242, in register_aws_image\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     cloud_private_key, decrypted_filename)\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/site-packages/nova/objectstore/image.py\", line 263, in decrypt_image\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     % err)\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Error: Failed to decrypt private key: RSA operation error\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] 1918:error:0407106B:rsa routines:RSA_padding_check_PKCS1_type_2:block type is not 02:rsa_pk1.c:190:\n2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] 1918:error:04065072:rsa routines:RSA_EAY_PRIVATE_DECRYPT:padding check failed:rsa_eay.c:596:\n---snap---\n\nI think the CA stuff looks good:\n---snip---\nchronos:/var/lib/nova/CA # ./genrootca.sh \nNot installing, it's already done.\n---snap---\n\n---snip---\nIMAGE\tami-0h5aejwo\tdebian_kernel/vmlinuz-2.6.28-11-generic.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tkernel\t\ttrue\nIMAGE\tami-0zt2o6tu\tdebian_image/debian.5-0.x86-64.img.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tmachine\tami-qbqcxp5d\tami-0h5aejwo\nIMAGE\tami-qbqcxp5d\tdebian_ramdisk/initrd.img-2.6.28-11-generic.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tramdisk\ttrue\t\n---snap---\n\n---snip---\nchronos:/srv/images # find .\n.\n./ami-0h5aejwo\n./ami-0h5aejwo/image.encrypted\n./ami-0h5aejwo/info.json\n./ami-0zt2o6tu\n./ami-0zt2o6tu/image.encrypted\n./ami-0zt2o6tu/info.json\n./lost+found\n./ami-qbqcxp5d\n./ami-qbqcxp5d/image.encrypted\n./ami-qbqcxp5d/info.json\n---snap---", 
            "date_created": "2011-02-25 10:09:06.718308+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "seems to be a problem with /var/lib/nova/CA. I copied all files from an other system and now I can create decrypted images. Can anybody give me a hint what we have done in the wrong way when moving nova-objectstore to an other system?", 
            "date_created": "2011-02-25 10:13:41.423255+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "No clue, but can't reproduce it with current trunk, looks like a local issue ?", 
            "date_created": "2011-02-25 12:54:28.195092+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "I think the problem is that there are certificates registered in the table certificates. I moved the objectstore to an other systems and so he couldn't find the those certificates on the new system. After copien those certificates to the new systems all is working fine.\r\n\r\nmysql> select * from certificates;\r\n+---------------------+------------+------------+---------+----+---------+------------+-----------------------------------+\r\n| created_at          | updated_at | deleted_at | deleted | id | user_id | project_id | file_name                         |\r\n+---------------------+------------+------------+---------+----+---------+------------+-----------------------------------+\r\n| 2011-02-24 08:21:01 | NULL       | NULL       |       0 |  1 | berendt | testing    | /var/lib/nova/CA/newcerts/12\r\n.pem | \r\n| 2011-02-24 08:37:47 | NULL       | NULL       |       0 |  2 | berendt | openstack  | /var/lib/nova/CA/newcerts/13\r\n.pem | \r\n| 2011-02-24 08:38:01 | NULL       | NULL       |       0 |  3 | berendt | openstack  | /var/lib/nova/CA/newcerts/14\r\n.pem | \r\n+---------------------+------------+------------+---------+----+---------+------------+-----------------------------------+\r\n", 
            "date_created": "2011-02-25 13:35:33.734977+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "you have to run api and obectstore on the same host currently.\n\nVish\nOn Feb 25, 2011, at 5:35 AM, Christian Berendt wrote:\n\n> I think the problem is that there are certificates registered in the\n> table certificates. I moved the objectstore to an other systems and so\n> he couldn't find the those certificates on the new system. After copien\n> those certificates to the new systems all is working fine.\n> \n> mysql> select * from certificates;\n> +---------------------+------------+------------+---------+----+---------+------------+-----------------------------------+\n> | created_at          | updated_at | deleted_at | deleted | id | user_id | project_id | file_name                         |\n> +---------------------+------------+------------+---------+----+---------+------------+-----------------------------------+\n> | 2011-02-24 08:21:01 | NULL       | NULL       |       0 |  1 | berendt | testing    | /var/lib/nova/CA/newcerts/12\n> .pem | \n> | 2011-02-24 08:37:47 | NULL       | NULL       |       0 |  2 | berendt | openstack  | /var/lib/nova/CA/newcerts/13\n> .pem | \n> | 2011-02-24 08:38:01 | NULL       | NULL       |       0 |  3 | berendt | openstack  | /var/lib/nova/CA/newcerts/14\n> .pem | \n> +---------------------+------------+------------+---------+----+---------+------------+-----------------------------------+\n> \n> \n> ** Changed in: nova\n>       Status: Incomplete => Invalid\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/724853\n> \n> Title:\n>  after uploading images to nova-objectstore they are only decrypting\n> \n> Status in OpenStack Compute (Nova):\n>  Invalid\n> \n> Bug description:\n>  In the past new images were available after a few seconds or minutes\n>  after finished the upload. Now we only see the state \"decrypting\" and\n>  only files \"image.encrypted\". We're using bzrrev 732. Also we don't\n>  have running processes on the nova-objectstore system with high cpu\n>  usage.\n> \n>  In objectstore.log we have the following error:\n> \n>  ---snip---\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Process Process-3:\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Traceback (most recent call last):\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/multiprocessing/process.py\", line 231, in _bootstrap\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     self.run()\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/multiprocessing/process.py\", line 88, in run\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     self._target(*self._args, **self._kwargs)\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/site-packages/nova/objectstore/image.py\", line 242, in register_aws_image\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     cloud_private_key, decrypted_filename)\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/site-packages/nova/objectstore/image.py\", line 263, in decrypt_image\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     % err)\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Error: Failed to decrypt private key: RSA operation error\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] 1918:error:0407106B:rsa routines:RSA_padding_check_PKCS1_type_2:block type is not 02:rsa_pk1.c:190:\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] 1918:error:04065072:rsa routines:RSA_EAY_PRIVATE_DECRYPT:padding check failed:rsa_eay.c:596:\n>  ---snap---\n> \n>  I think the CA stuff looks good:\n>  ---snip---\n>  chronos:/var/lib/nova/CA # ./genrootca.sh \n>  Not installing, it's already done.\n>  ---snap---\n> \n>  ---snip---\n>  IMAGE\tami-0h5aejwo\tdebian_kernel/vmlinuz-2.6.28-11-generic.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tkernel\t\ttrue\n>  IMAGE\tami-0zt2o6tu\tdebian_image/debian.5-0.x86-64.img.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tmachine\tami-qbqcxp5d\tami-0h5aejwo\n>  IMAGE\tami-qbqcxp5d\tdebian_ramdisk/initrd.img-2.6.28-11-generic.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tramdisk\ttrue\t\n>  ---snap---\n> \n>  ---snip---\n>  chronos:/srv/images # find .\n>  .\n>  ./ami-0h5aejwo\n>  ./ami-0h5aejwo/image.encrypted\n>  ./ami-0h5aejwo/info.json\n>  ./ami-0zt2o6tu\n>  ./ami-0zt2o6tu/image.encrypted\n>  ./ami-0zt2o6tu/info.json\n>  ./lost+found\n>  ./ami-qbqcxp5d\n>  ./ami-qbqcxp5d/image.encrypted\n>  ./ami-qbqcxp5d/info.json\n>  ---snap---\n\n", 
            "date_created": "2011-02-25 18:59:50+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Yes, I figured that out after some coffee ;) But the problem is that I moved nova-objectstore, nova-api and nova-scheduler to an other host. When moving all that services you have to also move /var/lib/nova/CA to the new system. ", 
            "date_created": "2011-02-25 19:38:00.657643+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "ah, yes, that is correct.\n\nVish\n\nOn Feb 25, 2011, at 11:38 AM, Christian Berendt wrote:\n\n> Yes, I figured that out after some coffee ;) But the problem is that I\n> moved nova-objectstore, nova-api and nova-scheduler to an other host.\n> When moving all that services you have to also move /var/lib/nova/CA to\n> the new system.\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/724853\n> \n> Title:\n>  after uploading images to nova-objectstore they are only decrypting\n> \n> Status in OpenStack Compute (Nova):\n>  Invalid\n> \n> Bug description:\n>  In the past new images were available after a few seconds or minutes\n>  after finished the upload. Now we only see the state \"decrypting\" and\n>  only files \"image.encrypted\". We're using bzrrev 732. Also we don't\n>  have running processes on the nova-objectstore system with high cpu\n>  usage.\n> \n>  In objectstore.log we have the following error:\n> \n>  ---snip---\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Process Process-3:\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Traceback (most recent call last):\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/multiprocessing/process.py\", line 231, in _bootstrap\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     self.run()\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/multiprocessing/process.py\", line 88, in run\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     self._target(*self._args, **self._kwargs)\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/site-packages/nova/objectstore/image.py\", line 242, in register_aws_image\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     cloud_private_key, decrypted_filename)\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]   File \"/usr/lib64/python2.6/site-packages/nova/objectstore/image.py\", line 263, in decrypt_image\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130]     % err)\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] Error: Failed to decrypt private key: RSA operation error\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] 1918:error:0407106B:rsa routines:RSA_padding_check_PKCS1_type_2:block type is not 02:rsa_pk1.c:190:\n>  2011-02-25 10:46:16+0100 [HTTPChannel,4,192.168.2.130] 1918:error:04065072:rsa routines:RSA_EAY_PRIVATE_DECRYPT:padding check failed:rsa_eay.c:596:\n>  ---snap---\n> \n>  I think the CA stuff looks good:\n>  ---snip---\n>  chronos:/var/lib/nova/CA # ./genrootca.sh \n>  Not installing, it's already done.\n>  ---snap---\n> \n>  ---snip---\n>  IMAGE\tami-0h5aejwo\tdebian_kernel/vmlinuz-2.6.28-11-generic.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tkernel\t\ttrue\n>  IMAGE\tami-0zt2o6tu\tdebian_image/debian.5-0.x86-64.img.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tmachine\tami-qbqcxp5d\tami-0h5aejwo\n>  IMAGE\tami-qbqcxp5d\tdebian_ramdisk/initrd.img-2.6.28-11-generic.manifest.xml\ttesting\tdecrypting\tprivate\t\tx86_64\tramdisk\ttrue\t\n>  ---snap---\n> \n>  ---snip---\n>  chronos:/srv/images # find .\n>  .\n>  ./ami-0h5aejwo\n>  ./ami-0h5aejwo/image.encrypted\n>  ./ami-0h5aejwo/info.json\n>  ./ami-0zt2o6tu\n>  ./ami-0zt2o6tu/image.encrypted\n>  ./ami-0zt2o6tu/info.json\n>  ./lost+found\n>  ./ami-qbqcxp5d\n>  ./ami-qbqcxp5d/image.encrypted\n>  ./ami-qbqcxp5d/info.json\n>  ---snap---\n\n", 
            "date_created": "2011-02-25 19:49:47+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ]
}