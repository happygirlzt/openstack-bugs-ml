{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:38:23.680434+00:00", 
    "description": "In a multi-node setup where I have 1 node running all services (compute,api,network,objectstore,scheduler) and another running compute - when an instance tries to spawn on the compute only node it fails to spawn with the following trace:\n\n2011-03-17 10:28:10,358 DEBUG nova.utils [-] Attempting to grab iptables for method apply... from (pid=1458) inner /usr/lib/pymodules/python2.6/nova/utils.py:535\n2011-03-17 10:28:10,370 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,389 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,410 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,427 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,455 DEBUG nova.utils [-] Running cmd (subprocess): mkdir -p /var/lib/nova/instances/instance-00000042/ from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,467 INFO nova.virt.libvirt_conn [-] instance instance-00000042: Creating image\n2011-03-17 10:28:10,569 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/5ee40cc4 /var/lib/nova/instances/instance-00000042/kernel from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,613 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/310e4e6b /var/lib/nova/instances/instance-00000042/ramdisk from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,670 ERROR nova.compute.manager [YM1X-1RU8X8VLFWWWFAL kevinj myproject] instance 66: Failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 218, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 120, in _wrap\n(nova.compute.manager): TRACE:     return f(*args, **kw)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 424, in spawn\n(nova.compute.manager): TRACE:     self._create_image(instance, xml)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 638, in _create_image\n(nova.compute.manager): TRACE:     size=size)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 559, in _cache_image\n(nova.compute.manager): TRACE:     fn(target=base, *args, **kwargs)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 572, in _fetch_image\n(nova.compute.manager): TRACE:     images.fetch(image_id, target, user, project)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/images.py\", line 51, in fetch\n(nova.compute.manager): TRACE:     metadata = image_service.get(elevated, image_id, image_file)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/image/local.py\", line 95, in get\n(nova.compute.manager): TRACE:     raise exception.NotFound\n(nova.compute.manager): TRACE: NotFound: None\n(nova.compute.manager): TRACE: \n\nRunning an instance on the first node works fine.", 
    "tags": [], 
    "importance": "Low", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/736754", 
    "owner": "https://api.launchpad.net/1.0/~jk0", 
    "id": 736754, 
    "index": 5025, 
    "created": "2011-03-17 10:38:52.531911+00:00", 
    "title": "Doc fix needed around local image store (was Image not found on nova-compute only node)", 
    "comments": [
        {
            "content": "In a multi-node setup where I have 1 node running all services (compute,api,network,objectstore,scheduler) and another running compute - when an instance tries to spawn on the compute only node it fails to spawn with the following trace:\n\n2011-03-17 10:28:10,358 DEBUG nova.utils [-] Attempting to grab iptables for method apply... from (pid=1458) inner /usr/lib/pymodules/python2.6/nova/utils.py:535\n2011-03-17 10:28:10,370 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,389 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,410 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,427 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,455 DEBUG nova.utils [-] Running cmd (subprocess): mkdir -p /var/lib/nova/instances/instance-00000042/ from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,467 INFO nova.virt.libvirt_conn [-] instance instance-00000042: Creating image\n2011-03-17 10:28:10,569 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/5ee40cc4 /var/lib/nova/instances/instance-00000042/kernel from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,613 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/310e4e6b /var/lib/nova/instances/instance-00000042/ramdisk from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n2011-03-17 10:28:10,670 ERROR nova.compute.manager [YM1X-1RU8X8VLFWWWFAL kevinj myproject] instance 66: Failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 218, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 120, in _wrap\n(nova.compute.manager): TRACE:     return f(*args, **kw)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 424, in spawn\n(nova.compute.manager): TRACE:     self._create_image(instance, xml)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 638, in _create_image\n(nova.compute.manager): TRACE:     size=size)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 559, in _cache_image\n(nova.compute.manager): TRACE:     fn(target=base, *args, **kwargs)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 572, in _fetch_image\n(nova.compute.manager): TRACE:     images.fetch(image_id, target, user, project)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/images.py\", line 51, in fetch\n(nova.compute.manager): TRACE:     metadata = image_service.get(elevated, image_id, image_file)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/image/local.py\", line 95, in get\n(nova.compute.manager): TRACE:     raise exception.NotFound\n(nova.compute.manager): TRACE: NotFound: None\n(nova.compute.manager): TRACE: \n\nRunning an instance on the first node works fine.", 
            "date_created": "2011-03-17 10:38:52.531911+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "I can confirm this bug. Exact same stack trace.\n\nNova bzr815.", 
            "date_created": "2011-03-17 12:12:46.340337+00:00", 
            "author": "https://api.launchpad.net/1.0/~j0rd4n"
        }, 
        {
            "content": "Local Image service is exactly that, a local image service.  If you want multiple machines to access the images locally, you will need to share the local image service folder to all of your compute hosts via nfs or something like that.  The recommended setup for a multiple machine service would be to install and run glance and use:\n--image_service=nova.image.glance.GlanceImageService\n\nVish\n\nOn Mar 17, 2011, at 5:12 AM, pjordan wrote:\n\n> I can confirm this bug. Exact same stack trace.\n> \n> Nova bzr815.\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/736754\n> \n> Title:\n>  Image not found when instance tries to spawn on nova-compute only node\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  In a multi-node setup where I have 1 node running all services\n>  (compute,api,network,objectstore,scheduler) and another running\n>  compute - when an instance tries to spawn on the compute only node it\n>  fails to spawn with the following trace:\n> \n>  2011-03-17 10:28:10,358 DEBUG nova.utils [-] Attempting to grab iptables for method apply... from (pid=1458) inner /usr/lib/pymodules/python2.6/nova/utils.py:535\n>  2011-03-17 10:28:10,370 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n>  2011-03-17 10:28:10,389 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n>  2011-03-17 10:28:10,410 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n>  2011-03-17 10:28:10,427 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n>  2011-03-17 10:28:10,455 DEBUG nova.utils [-] Running cmd (subprocess): mkdir -p /var/lib/nova/instances/instance-00000042/ from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n>  2011-03-17 10:28:10,467 INFO nova.virt.libvirt_conn [-] instance instance-00000042: Creating image\n>  2011-03-17 10:28:10,569 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/5ee40cc4 /var/lib/nova/instances/instance-00000042/kernel from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n>  2011-03-17 10:28:10,613 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/310e4e6b /var/lib/nova/instances/instance-00000042/ramdisk from (pid=1458) execute /usr/lib/pymodules/python2.6/nova/utils.py:148\n>  2011-03-17 10:28:10,670 ERROR nova.compute.manager [YM1X-1RU8X8VLFWWWFAL kevinj myproject] instance 66: Failed to spawn\n>  (nova.compute.manager): TRACE: Traceback (most recent call last):\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 218, in run_instance\n>  (nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 120, in _wrap\n>  (nova.compute.manager): TRACE:     return f(*args, **kw)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 424, in spawn\n>  (nova.compute.manager): TRACE:     self._create_image(instance, xml)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 638, in _create_image\n>  (nova.compute.manager): TRACE:     size=size)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 559, in _cache_image\n>  (nova.compute.manager): TRACE:     fn(target=base, *args, **kwargs)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 572, in _fetch_image\n>  (nova.compute.manager): TRACE:     images.fetch(image_id, target, user, project)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/images.py\", line 51, in fetch\n>  (nova.compute.manager): TRACE:     metadata = image_service.get(elevated, image_id, image_file)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/image/local.py\", line 95, in get\n>  (nova.compute.manager): TRACE:     raise exception.NotFound\n>  (nova.compute.manager): TRACE: NotFound: None\n>  (nova.compute.manager): TRACE: \n> \n>  Running an instance on the first node works fine.\n\n", 
            "date_created": "2011-03-21 00:04:38+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Thanks for clarifying (it makes sense) - I think the issue then is of documentation or some other assumption because the default isn't what the documentation says.\n\nhttp://docs.openstack.org/openstack-compute/admin/content/ch05s08.html\n\nThis says the following, where the default should be S3 as what was working before upgrading to this release.\n\n\nThe service to use for retrieving and searching for images. Images must be registered using euca2ools. Options:\n\n    *\n\n      nova.image.s3.S3ImageService\n\n      S3 backend for the imaging service; This is the default setting if no image manager is defined here.\n    *\n\n      nova.image.local.LocalImageService\n\n      Image service storing images to local disk. It assumes that image_ids are integers.\n    *\n\n      nova.image.glance.GlanceImageService\n\n      Glance back end for storing and retrieving images; See http://glance.openstack.org for more info.\n\n", 
            "date_created": "2011-03-21 09:08:07.816687+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "Pulled the latest openstack-manuals trunk and this seems to have been fixed.", 
            "date_created": "2011-04-06 16:10:54.272435+00:00", 
            "author": "https://api.launchpad.net/1.0/~jk0"
        }, 
        {
            "content": "Yep, I fixed it in source, but don't have it published to the site yet so yeah, Fix Committed is right. Sorry to have you chase it, but thanks for the assist!\n", 
            "date_created": "2011-04-06 16:35:33.620410+00:00", 
            "author": "https://api.launchpad.net/1.0/~annegentle"
        }
    ]
}