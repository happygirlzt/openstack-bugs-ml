{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:59:54.898203+00:00", 
    "description": "Compute instance task states represent what is happening to the instance at the current moment. When the instance is 'ERROR' state, the 'spawning' task_state make users confused, 'spawning' job had been done and failed, it should been set to 'None'.\n\n1. Version of Nova\n\n$ git log -1\ncommit 4cf6ef68199183697a0209751575f88fe5b2a733\nMerge: f40619b 70ba331\nAuthor: Jenkins <email address hidden>\nDate:   Wed May 27 22:14:34 2015 +0000\n\n    Merge \"improve speed of some ec2 keypair tests\"\n\n2. Log files\n\nstack@devstack:/home/devstack/logs$  [master]$ nova list\n+--------------------------------------+---------------+--------+------------+-------------+--------------------------------------------------------+\n| ID                                   | Name          | Status | Task State | Power State | Networks                                               |\n+--------------------------------------+---------------+--------+------------+-------------+--------------------------------------------------------+\n| 5fa49075-f0a0-4806-bdf3-0cedd09c7c6f | chenrui_again | ERROR  | spawning   | NOSTATE     |                                                        |\n| 19920850-86b0-4904-8431-bf1ed6f9cea7 | chenrui_vm    | ACTIVE | -          | Running     | private=fd6b:c8ae:7d0d:0:f816:3eff:fe96:bbfa, 10.0.0.3 |\n+--------------------------------------+---------------+--------+------------+-------------+--------------------------------------------------------+\n\n\n2015-05-28 10:42:14.618 4705 WARNING nova.network.neutronv2.api [-] [instance: 5fa49075-f0a0-4806-bdf3-0cedd09c7c6f] Neutron error: No more fixed IPs in network: ecf5d5d3-6198-4c95-84d4-db633fb09526\n2015-05-28 10:42:14.619 4705 ERROR nova.compute.manager [-] Instance failed network setup after 1 attempt(s)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager Traceback (most recent call last):\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/opt/stack/nova/nova/compute/manager.py\", line 1535, in _allocate_network_async\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     dhcp_options=dhcp_options)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 667, in allocate_for_instance\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     self._delete_ports(neutron, instance, created_port_ids)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     six.reraise(self.type_, self.value, self.tb)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 659, in allocate_for_instance\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     security_group_ids, available_macs, dhcp_opts)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 321, in _create_port\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     raise exception.NoMoreFixedIps(net=network_id)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager NoMoreFixedIps: No fixed IP addresses available for network: ecf5d5d3-6198-4c95-84d4-db633fb09526\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/poll.py\", line 115, in wait\n    listener.cb(fileno)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 214, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1552, in _allocate_network_async\n    six.reraise(*exc_info)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1535, in _allocate_network_async\n    dhcp_options=dhcp_options)\n  File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 667, in allocate_for_instance\n    self._delete_ports(neutron, instance, created_port_ids)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 659, in allocate_for_instance\n    security_group_ids, available_macs, dhcp_opts)\n  File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 321, in _create_port\n    raise exception.NoMoreFixedIps(net=network_id)\nNoMoreFixedIps: No fixed IP addresses available for network: ecf5d5d3-6198-4c95-84d4-db633fb09526\nRemoving descriptor: 19\n\n3.  Reproduce steps:\n\n* create a neutron network and subnet, there is only 1 fixed ip in the subnet.\n   neutron subnet-create --allocation-pool start=100.100.1.5,end=100.100.1.5 ecf5d5d3-6198-4c95-84d4-db633fb09526 100.100.1.1/24\n* boot a instance with the network_id.\n\nExpected result:\n* booting failed, instance is 'ERROR' state and task_state is 'None'\n\nActual result:\n* booting failed, instance is 'ERROR' state and task_state is 'spawning'", 
    "tags": [
        "compute"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1459496", 
    "owner": "https://api.launchpad.net/1.0/~kiwik-chenrui", 
    "id": 1459496, 
    "index": 476, 
    "created": "2015-05-28 03:31:24.594281+00:00", 
    "title": "task_state is not 'None' when vm stay in 'ERROR' state", 
    "comments": [
        {
            "content": "Compute instance task states represent what is happening to the instance at the current moment. When the instance is 'ERROR' state, the 'spawning' task_state make users confused, 'spawning' job had been done and failed, it should been set to 'None'.\n\n1. Version of Nova\n\n$ git log -1\ncommit 4cf6ef68199183697a0209751575f88fe5b2a733\nMerge: f40619b 70ba331\nAuthor: Jenkins <email address hidden>\nDate:   Wed May 27 22:14:34 2015 +0000\n\n    Merge \"improve speed of some ec2 keypair tests\"\n\n2. Log files\n\nstack@devstack:/home/devstack/logs$  [master]$ nova list\n+--------------------------------------+---------------+--------+------------+-------------+--------------------------------------------------------+\n| ID                                   | Name          | Status | Task State | Power State | Networks                                               |\n+--------------------------------------+---------------+--------+------------+-------------+--------------------------------------------------------+\n| 5fa49075-f0a0-4806-bdf3-0cedd09c7c6f | chenrui_again | ERROR  | spawning   | NOSTATE     |                                                        |\n| 19920850-86b0-4904-8431-bf1ed6f9cea7 | chenrui_vm    | ACTIVE | -          | Running     | private=fd6b:c8ae:7d0d:0:f816:3eff:fe96:bbfa, 10.0.0.3 |\n+--------------------------------------+---------------+--------+------------+-------------+--------------------------------------------------------+\n\n\n2015-05-28 10:42:14.618 4705 WARNING nova.network.neutronv2.api [-] [instance: 5fa49075-f0a0-4806-bdf3-0cedd09c7c6f] Neutron error: No more fixed IPs in network: ecf5d5d3-6198-4c95-84d4-db633fb09526\n2015-05-28 10:42:14.619 4705 ERROR nova.compute.manager [-] Instance failed network setup after 1 attempt(s)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager Traceback (most recent call last):\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/opt/stack/nova/nova/compute/manager.py\", line 1535, in _allocate_network_async\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     dhcp_options=dhcp_options)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 667, in allocate_for_instance\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     self._delete_ports(neutron, instance, created_port_ids)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     six.reraise(self.type_, self.value, self.tb)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 659, in allocate_for_instance\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     security_group_ids, available_macs, dhcp_opts)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 321, in _create_port\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager     raise exception.NoMoreFixedIps(net=network_id)\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager NoMoreFixedIps: No fixed IP addresses available for network: ecf5d5d3-6198-4c95-84d4-db633fb09526\n2015-05-28 10:42:14.619 4705 TRACE nova.compute.manager\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/poll.py\", line 115, in wait\n    listener.cb(fileno)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 214, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1552, in _allocate_network_async\n    six.reraise(*exc_info)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1535, in _allocate_network_async\n    dhcp_options=dhcp_options)\n  File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 667, in allocate_for_instance\n    self._delete_ports(neutron, instance, created_port_ids)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 659, in allocate_for_instance\n    security_group_ids, available_macs, dhcp_opts)\n  File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 321, in _create_port\n    raise exception.NoMoreFixedIps(net=network_id)\nNoMoreFixedIps: No fixed IP addresses available for network: ecf5d5d3-6198-4c95-84d4-db633fb09526\nRemoving descriptor: 19\n\n3.  Reproduce steps:\n\n* create a neutron network and subnet, there is only 1 fixed ip in the subnet.\n   neutron subnet-create --allocation-pool start=100.100.1.5,end=100.100.1.5 ecf5d5d3-6198-4c95-84d4-db633fb09526 100.100.1.1/24\n* boot a instance with the network_id.\n\nExpected result:\n* booting failed, instance is 'ERROR' state and task_state is 'None'\n\nActual result:\n* booting failed, instance is 'ERROR' state and task_state is 'spawning'", 
            "date_created": "2015-05-28 03:31:24.594281+00:00", 
            "author": "https://api.launchpad.net/1.0/~kiwik-chenrui"
        }, 
        {
            "content": "guess it's because NetworkInfoAsyncWrapper is async so the reverts_task_state is not helpful", 
            "date_created": "2015-05-29 16:26:33.679223+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/187145", 
            "date_created": "2015-06-01 09:30:49.932944+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/187145\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=67f29b196c3bbbde413c9176b83c8b878753a38d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 67f29b196c3bbbde413c9176b83c8b878753a38d\nAuthor: Rui Chen <email address hidden>\nDate:   Mon Jun 1 17:20:42 2015 +0800\n\n    Set task_state=None when booting instance failed\n    \n    When booting instance failed in nova-compute, the\n    instance is ERROR state, but the instance.task_state\n    is not None. According to the definition of task_state,\n    instance task states represent what is happening to\n    the instance at the current moment. The users will be confused\n    when they find a instance with vm_state=ERROR and task_state=\n    spawning.\n    \n    Change-Id: I6e8d1bd549052317a8b60052e2a0ffbf800af13f\n    Closes-Bug: #1459496\n", 
            "date_created": "2015-08-29 23:56:05.287051+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}