{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:32:44.696232+00:00", 
    "description": "when we try to create a backup for an instance, the instance task_state is stuck at image_backup and never resets to None thus failing the call\n\nthe compute manager logs look like this:\n\n\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 167, in decorated_function\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 196, in decorated_function\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1143, in snapshot_instance\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     expected_task_state=task_states.IMAGE_SNAPSHOT)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 254, in _instance_update\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     context, instance_uuid, kwargs)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/db/api.py\", line 675, in instance_update_and_get_original\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     values)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kwargs)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1768, in instance_update_and_get_original\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     copy_old_instance=True)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1788, in _instance_update\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp     expected=expected)\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp UnexpectedTaskStateError: unexpected task state: expecting ('image_snapshot',) but the actual state is image_backup\n2012-09-14 20:36:22 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1051069", 
    "owner": "https://api.launchpad.net/1.0/~eddie-sheffield", 
    "id": 1051069, 
    "index": 811, 
    "created": "2012-09-14 20:39:46.785481+00:00", 
    "title": "backup fails to reset instance task_state to None", 
    "comments": [
        {
            "content": "when we try to create a backup for an instance, the instance task_state is stuck at image_backup and never resets to None thus failing the call", 
            "date_created": "2012-09-14 20:39:46.785481+00:00", 
            "author": "https://api.launchpad.net/1.0/~nikhil-komawar"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/13152", 
            "date_created": "2012-09-17 20:56:44.354882+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/13152\nCommitted: http://github.com/openstack/nova/commit/73e8d5a7b668e3a9700101b2fcd742ed349e0b26\nSubmitter: Jenkins\nBranch:    master\n\ncommit 73e8d5a7b668e3a9700101b2fcd742ed349e0b26\nAuthor: eddie-sheffield <email address hidden>\nDate:   Mon Sep 17 11:10:06 2012 -0400\n\n    Reset the task state after backup done.\n    \n    The compute manager needs to reset the task state after a backup\n    is complete. However it was only correctly reseting after a\n    snapshot due to the current expected state being hardcoded.\n    Now looks for the correct expected state depending on whether a\n    backup or snapshot was being executed.\n    \n    Fixes bug 1051069\n    \n    Change-Id: Ie91f7745b98232370be6c99d318a8033a93cc50c\n", 
            "date_created": "2012-09-17 22:43:06.333852+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}