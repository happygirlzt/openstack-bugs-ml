{
    "status": "Invalid", 
    "last_updated": "2017-06-08 12:29:26.567807+00:00", 
    "description": "I'm trying to live migration from systen with Westmere to system with Broadwell but fails\n\nAdditional info:\noperating system: centos 7.3\nopenstack: Ocata\n\n/etc/nova/nova.conf \ncpu_mode=none\ncpu_model=none\nvirt_type=kvm\n\nError report:\n*********************************************\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server [req-98ec383e-d18d-4e79-89e9-725a7e244ce5 - - - - -] Exception during message handling\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 155, in _process_incoming\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/exception_wrapper.py\", line 75, in wrapped\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     function_name, call_dict, binary)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/exception_wrapper.py\", line 66, in wrapped\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/utils.py\", line 685, in decorated_function\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 216, in decorated_function\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 204, in decorated_function\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5213, in check_can_live_migrate_destination\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     disk_over_commit)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5224, in _do_check_can_live_migrate_destination\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     block_migration, disk_over_commit)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5655, in check_can_live_migrate_destination\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     self._compare_cpu(None, source_cpu_info, instance)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5923, in _compare_cpu\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     raise exception.InvalidCPUInfo(reason=m % {'ret': ret, 'u': u})\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server InvalidCPUInfo: Unacceptable CPU info: CPU doesn't have compatibility.\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server 0\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server Refer to http://libvirt.org/html/libvirt-libvirt-host.html#virCPUCompareResult\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server\n\n****************************************************************", 
    "tags": [
        "live", 
        "live-migration"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1677426", 
    "owner": "None", 
    "id": 1677426, 
    "index": 6762, 
    "created": "2017-03-30 01:20:06.317108+00:00", 
    "title": "Live Migration fails as different cpu types", 
    "comments": [
        {
            "content": "I'm trying to live migration from systen with Westmere to system with Broadwell but fails\n\nAdditional info:\noperating system: centos 7.3\nopenstack: Ocata\n\n/etc/nova/nova.conf \ncpu_mode=none\ncpu_model=none\nvirt_type=kvm\n\nError report:\n*********************************************\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server [req-98ec383e-d18d-4e79-89e9-725a7e244ce5 - - - - -] Exception during message handling\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 155, in _process_incoming\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/exception_wrapper.py\", line 75, in wrapped\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     function_name, call_dict, binary)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/exception_wrapper.py\", line 66, in wrapped\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/utils.py\", line 685, in decorated_function\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 216, in decorated_function\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 204, in decorated_function\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5213, in check_can_live_migrate_destination\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     disk_over_commit)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5224, in _do_check_can_live_migrate_destination\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     block_migration, disk_over_commit)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5655, in check_can_live_migrate_destination\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     self._compare_cpu(None, source_cpu_info, instance)\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5923, in _compare_cpu\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server     raise exception.InvalidCPUInfo(reason=m % {'ret': ret, 'u': u})\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server InvalidCPUInfo: Unacceptable CPU info: CPU doesn't have compatibility.\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server 0\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server Refer to http://libvirt.org/html/libvirt-libvirt-host.html#virCPUCompareResult\n2017-03-29 20:31:44.979 4051 ERROR oslo_messaging.rpc.server\n\n****************************************************************", 
            "date_created": "2017-03-30 01:20:06.317108+00:00", 
            "author": "https://api.launchpad.net/1.0/~lanrui456"
        }, 
        {
            "content": "Live migration fails because of different cpu capabilities. For instance, Broadwell has a AVX, AVX2, TXT, TSX extensions, which are not available in Westmere.", 
            "date_created": "2017-03-30 14:24:40.444678+00:00", 
            "author": "https://api.launchpad.net/1.0/~mszankin"
        }, 
        {
            "content": "Oops, I did read it wrong, you are performing LM from westmere to broadwell.", 
            "date_created": "2017-03-30 14:27:56.503744+00:00", 
            "author": "https://api.launchpad.net/1.0/~mszankin"
        }, 
        {
            "content": "yeah,I modified both nova.conf like:\n/etc/nova/nova.conf\ncpu_mode=custom\ncpu_model=kvm64 or cpu_model=westmere \n\nAllthings is ok!", 
            "date_created": "2017-04-01 00:10:53.985818+00:00", 
            "author": "https://api.launchpad.net/1.0/~lanrui456"
        }, 
        {
            "content": "Was working as designed, the right config is now in the bug", 
            "date_created": "2017-06-08 12:29:26.373413+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}