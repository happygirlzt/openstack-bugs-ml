{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:54:36.995351+00:00", 
    "description": "When running tests using run_tests.sh, if one of the tests fails I am seeing the following error:\n\nTraceback (most recent call last):\n  File \"tools/colorizer.py\", line 329, in <module>\n    if runner.run(test).wasSuccessful():\n  File \"/usr/lib/python2.7/unittest/runner.py\", line 151, in run\n    test(result)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 1196, in __call__\n    return self.run(result)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 1204, in run\n    protocol.lineReceived(line)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 574, in lineReceived\n    self._state.lineReceived(line)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 411, in lineReceived\n    self.details_parser.lineReceived(line)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/details.py\", line 119, in lineReceived\n    self._parse_state(line)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/details.py\", line 84, in _look_for_content\n    self._state.endDetails()\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 406, in endDetails\n    self._report_outcome()\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 437, in _report_outcome\n    details=self.details_parser.get_details())\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/testtools/testresult/real.py\", line 1151, in addFailure\n    return self.decorated.addFailure(test, err)\n  File \"tools/colorizer.py\", line 236, in addFailure\n    self._addResult(test, 'FAIL', 'red', 'F', False)\n  File \"tools/colorizer.py\", line 205, in _addResult\n    test_class, test_name = name.rsplit('.', 1)\nValueError: need more than 1 value to unpack\nclose failed in file object destructor:\nsys.excepthook is missing\nlost sys.stderr\n\nThis makes it impossible to even tell which test failed.  I suspect it may be related to https://bugs.launchpad.net/nova/+bug/1168516 .  I made a change to colorizer.py which somewhat fixes the problem, although it still leaves a bogus process-returncode test in the output.  I'll go ahead and submit my change and maybe somebody who knows more about this than me can suggest a better fix.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1183602", 
    "owner": "https://api.launchpad.net/1.0/~michael-kerrin-w", 
    "id": 1183602, 
    "index": 3679, 
    "created": "2013-05-23 22:36:12.319906+00:00", 
    "title": "Colorizer throws exception on failed tests", 
    "comments": [
        {
            "content": "When running tests using run_tests.sh, if one of the tests fails I am seeing the following error:\n\nTraceback (most recent call last):\n  File \"tools/colorizer.py\", line 329, in <module>\n    if runner.run(test).wasSuccessful():\n  File \"/usr/lib/python2.7/unittest/runner.py\", line 151, in run\n    test(result)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 1196, in __call__\n    return self.run(result)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 1204, in run\n    protocol.lineReceived(line)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 574, in lineReceived\n    self._state.lineReceived(line)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 411, in lineReceived\n    self.details_parser.lineReceived(line)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/details.py\", line 119, in lineReceived\n    self._parse_state(line)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/details.py\", line 84, in _look_for_content\n    self._state.endDetails()\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 406, in endDetails\n    self._report_outcome()\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/subunit/__init__.py\", line 437, in _report_outcome\n    details=self.details_parser.get_details())\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/testtools/testresult/real.py\", line 1151, in addFailure\n    return self.decorated.addFailure(test, err)\n  File \"tools/colorizer.py\", line 236, in addFailure\n    self._addResult(test, 'FAIL', 'red', 'F', False)\n  File \"tools/colorizer.py\", line 205, in _addResult\n    test_class, test_name = name.rsplit('.', 1)\nValueError: need more than 1 value to unpack\nclose failed in file object destructor:\nsys.excepthook is missing\nlost sys.stderr\n\nThis makes it impossible to even tell which test failed.  I suspect it may be related to https://bugs.launchpad.net/nova/+bug/1168516 .  I made a change to colorizer.py which somewhat fixes the problem, although it still leaves a bogus process-returncode test in the output.  I'll go ahead and submit my change and maybe somebody who knows more about this than me can suggest a better fix.", 
            "date_created": "2013-05-23 22:36:12.319906+00:00", 
            "author": "https://api.launchpad.net/1.0/~bnemec"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/30883", 
            "date_created": "2013-05-29 13:57:30.086091+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/30883\nCommitted: http://github.com/openstack/nova/commit/c182319039822346e9bc3f31a796fd45dcc35450\nSubmitter: Jenkins\nBranch:    master\n\ncommit c182319039822346e9bc3f31a796fd45dcc35450\nAuthor: Michael Kerrin <email address hidden>\nDate:   Wed May 29 12:43:53 2013 +0000\n\n    Fix colorizier thowing exception when a test fails\n    \n    This failure in colorizier was hidding the actual error\n    in the tests. If we ran enough tests it also became difficult\n    to see which test had actually failed.\n    \n    Fixes: bug 1183602\n    \n    Change-Id: I806da8f13040b38258de7f3e0fa7b62700bdcead\n", 
            "date_created": "2013-05-30 02:21:41.362897+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}