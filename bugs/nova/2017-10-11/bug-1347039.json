{
    "status": "Expired", 
    "last_updated": "2016-07-05 09:51:05.525735+00:00", 
    "description": "Currently the with vmware backend nova hypervisor-list. \nThe local_gb, free_disk_gb, local_gb_used  are not displaying correct values if the compute node(cluster) have more than 1 datastores. Currently the code only report the resource update picking up the first datastore which is incorrect. \n\nThe real situation is for example, 20 datastores availabel for the compute cluster node, but it only calculate the 1 for resource report. Which will cause easily deployment failure saying no freespace, in fact there are enough disk for vm deployments.\n\n\n[root@RegionServer1 nova]# nova hypervisor-show 1                                                   +---------------------------+----\n| Property                  | Value                                                                                                                                                                                  +---------------------------+-----\n| cpu_info_model            | [\"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU     \n     X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\"] | | cpu_info_topology_cores   | 156                                                                                                                                                                                    \n| cpu_info_topology_threads | 312                                                                                                                                                                                    \n| cpu_info_vendor    \"IBM\"]                                                                                            \n| current_workload          | 0                                                                                                                                                                                      \n| disk_available_least      | -                                                                                                                                                                                      \n| free_disk_gb              | -2682                                                                                                                                                                                  \n| free_ram_mb               | 1545886                                                                                                                                                                                \n| host_ip                   | 172.18.152.120                                                                                                                                                                         \n| hypervisor_hostname       | domain-c661(BC1-Cluster)                                                                                                                                                               \n| hypervisor_type           | VMware vCenter Server                                                                                                                                                                  \n| hypervisor_version        | 5001000                                                                                                                                                                                \n| id                        | 1                                                                                                                                                                                      \n| local_gb                  | 1799                                                                                                                                                                                   \n| local_gb_used             | 4481                                                                                                                                                                                  \n| memory_mb                 | 1833630                                                                                                                                                                                \n| memory_mb_used            | 287744                                                                                                                                                                                 \n| running_vms               | 281                                                                                                                                                                                    \n| service_host              | RegionServer1                                                                                                                                                                          \n| service_id                | 6                                                                                                                                                                                      \n| vcpus                     | 312                                                                                                                                                                                   \n| vcpus_used                | 281                                                                                                                                                                                   \n+---------------------------+-------------", 
    "tags": [
        "vmware"
    ], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1347039", 
    "owner": "None", 
    "id": 1347039, 
    "index": 5019, 
    "created": "2014-07-22 17:02:28.928655+00:00", 
    "title": "VMWare: available disk spaces(hypervisor-list) only based on a single datastore instead of all available datastores from cluster", 
    "comments": [
        {
            "content": "Currently the with vmware backend nova hypervisor-list. \nThe local_gb, free_disk_gb, local_gb_used  are not displaying correct values if the compute node(cluster) have more than 1 datastores. Currently the code only report the resource update picking up the first datastore which is incorrect. \n\nThe real situation is for example, 20 datastores availabel for the compute cluster node, but it only calculate the 1 for resource report. Which will cause easily deployment failure saying no freespace, in fact there are enough disk for vm deployments.\n\n\n[root@RegionServer1 nova]# nova hypervisor-show 1                                                   +---------------------------+----\n| Property                  | Value                                                                                                                                                                                  +---------------------------+-----\n| cpu_info_model            | [\"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU     \n     X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\", \"Intel(R) Xeon(R) CPU           X5675  @ 3.07GHz\"] | | cpu_info_topology_cores   | 156                                                                                                                                                                                    \n| cpu_info_topology_threads | 312                                                                                                                                                                                    \n| cpu_info_vendor    \"IBM\"]                                                                                            \n| current_workload          | 0                                                                                                                                                                                      \n| disk_available_least      | -                                                                                                                                                                                      \n| free_disk_gb              | -2682                                                                                                                                                                                  \n| free_ram_mb               | 1545886                                                                                                                                                                                \n| host_ip                   | 172.18.152.120                                                                                                                                                                         \n| hypervisor_hostname       | domain-c661(BC1-Cluster)                                                                                                                                                               \n| hypervisor_type           | VMware vCenter Server                                                                                                                                                                  \n| hypervisor_version        | 5001000                                                                                                                                                                                \n| id                        | 1                                                                                                                                                                                      \n| local_gb                  | 1799                                                                                                                                                                                   \n| local_gb_used             | 4481                                                                                                                                                                                  \n| memory_mb                 | 1833630                                                                                                                                                                                \n| memory_mb_used            | 287744                                                                                                                                                                                 \n| running_vms               | 281                                                                                                                                                                                    \n| service_host              | RegionServer1                                                                                                                                                                          \n| service_id                | 6                                                                                                                                                                                      \n| vcpus                     | 312                                                                                                                                                                                   \n| vcpus_used                | 281                                                                                                                                                                                   \n+---------------------------+-------------", 
            "date_created": "2014-07-22 17:02:28.928655+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhuzhubj"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/108777", 
            "date_created": "2014-07-22 17:09:38.404947+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "https://review.openstack.org/108777", 
            "date_created": "2014-07-22 17:09:50.975598+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhuzhubj"
        }, 
        {
            "content": "Change abandoned by Sean Dague (<email address hidden>) on branch: master\nReview: https://review.openstack.org/108777\nReason: This review is > 4 weeks without comment, and failed Jenkins the last time it was checked. We are abandoning this for now. Feel free to reactivate the review by pressing the restore button and leaving a 'recheck' comment to get fresh test results.", 
            "date_created": "2015-01-23 15:26:08.248211+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Removing \"In Progress\" status and assignee as change is abandoned.\n", 
            "date_created": "2015-02-12 15:31:07.829192+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/158815", 
            "date_created": "2015-02-24 18:41:59.982161+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "The bug description is not entirely correct. It is true that we don't report the \"actual\" aggregated storage but doing so will lead to the following problem: suppose that you have two datastores each with 10GB free space and you try to deploy 15GB image. The driver will report 20GB space but spawn() will fail because there is no datastore that can hold the image.\n\nThe current behavior is that we always report the largest free space from the available datastores. This guarantees that deployment will not fail because of disk space.\n\nThe only way to fix this is to make the scheduler aware of aggregated storage and drivers to report largest free space for deployment and aggregated free space for stats. Until we have this I believe it is better to report largest free space instead of aggregated free space.", 
            "date_created": "2015-02-26 07:51:24.842644+00:00", 
            "author": "https://api.launchpad.net/1.0/~rgerganov"
        }, 
        {
            "content": "Change abandoned by Timofey Durakov (<email address hidden>) on branch: master\nReview: https://review.openstack.org/158815\nReason: base on Radoslav Georganov comments, better to fix stats issue another way", 
            "date_created": "2015-02-27 10:56:46.329058+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "\nThis is an automated cleanup. This bug report has been closed because it\nis older than 18 months and there is no open code change to fix this.\nAfter this time it is unlikely that the circumstances which lead to\nthe observed issue can be reproduced.\n\nIf you can reproduce the bug, please:\n* reopen the bug report (set to status \"New\")\n* AND add the detailed steps to reproduce the issue (if applicable)\n* AND leave a comment \"CONFIRMED FOR: <RELEASE_NAME>\"\n  Only still supported release names are valid (LIBERTY, MITAKA, OCATA, NEWTON).\n  Valid example: CONFIRMED FOR: LIBERTY\n", 
            "date_created": "2016-07-05 09:51:04.794537+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}