{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 12:12:53.812768+00:00", 
    "description": "When an instance is not found on the hypervisor during the sync_power_states periodic task, possibly because it's being resized/migrated, there's a traceback in the compute logs.\n\n2013-09-10 17:46:27.736 32525 ERROR nova.openstack.common.periodic_task [-] Error during ComputeManager._sync_power_states: Could not find VM with name instance-00ab07fd-b5b0-44cb-8b62-9df838c7f468\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task Traceback (most recent call last):\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/openstack/common/periodic_task.py\", line 180, in run_periodic_tasks\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     task(self, context)\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/compute/manager.py\", line 4623, in _sync_power_states\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     vm_instance = self.driver.get_info(db_instance)\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/virt/xenapi/driver.py\", line 318, in get_info\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     return self._vmops.get_info(instance)\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 1488, in get_info\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     vm_ref = vm_ref or self._get_vm_opaque_ref(instance)\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 800, in _get_vm_opaque_ref\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     instance['name'])\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task NotFound: Could not find VM with name instance-00ab07fd-b5b0-44cb-8b62-9df838c7f468\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task\n\n\nThis is happening because the xenapi raises a NotFound exception but the sync_power_states task is expecting an InstanceNotFound exception.   NotFound is a general exception and InstanceNotFound is a more specific one so it would be better to raise InstanceNotFound and catch NotFound.  But for this case it should be ok to just raise InstanceNotFound.", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1226756", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1226756, 
    "index": 5883, 
    "created": "2013-09-17 18:32:05.784180+00:00", 
    "title": "xenapi sync_power_states peridodic task can traceback when instance not found", 
    "comments": [
        {
            "content": "When an instance is not found on the hypervisor during the sync_power_states periodic task, possibly because it's being resized/migrated, there's a traceback in the compute logs.\n\n2013-09-10 17:46:27.736 32525 ERROR nova.openstack.common.periodic_task [-] Error during ComputeManager._sync_power_states: Could not find VM with name instance-00ab07fd-b5b0-44cb-8b62-9df838c7f468\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task Traceback (most recent call last):\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/openstack/common/periodic_task.py\", line 180, in run_periodic_tasks\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     task(self, context)\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/compute/manager.py\", line 4623, in _sync_power_states\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     vm_instance = self.driver.get_info(db_instance)\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/virt/xenapi/driver.py\", line 318, in get_info\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     return self._vmops.get_info(instance)\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 1488, in get_info\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     vm_ref = vm_ref or self._get_vm_opaque_ref(instance)\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task   File \"/opt/rackstack/410.23/nova/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 800, in _get_vm_opaque_ref\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task     instance['name'])\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task NotFound: Could not find VM with name instance-00ab07fd-b5b0-44cb-8b62-9df838c7f468\n2013-09-10 17:46:27.736 32525 TRACE nova.openstack.common.periodic_task\n\n\nThis is happening because the xenapi raises a NotFound exception but the sync_power_states task is expecting an InstanceNotFound exception.   NotFound is a general exception and InstanceNotFound is a more specific one so it would be better to raise InstanceNotFound and catch NotFound.  But for this case it should be ok to just raise InstanceNotFound.", 
            "date_created": "2013-09-17 18:32:05.784180+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/47012", 
            "date_created": "2013-09-17 19:22:40.643640+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/47012\nCommitted: http://github.com/openstack/nova/commit/983d815a80039d1f4e0d735c3041882833ecc488\nSubmitter: Jenkins\nBranch:    master\n\ncommit 983d815a80039d1f4e0d735c3041882833ecc488\nAuthor: Andrew Laski <email address hidden>\nDate:   Tue Sep 17 15:14:56 2013 -0400\n\n    XenAPI raise InstanceNotFound in _get_vm_opaque_ref\n    \n    If _get_vm_opaque_ref doesn't find an instance it should raise a\n    specific InstanceNotFound exception rather than the general NotFound\n    exception.  Callers of this method may try to catch InstanceNotFound or\n    NotFound and now both will work.\n    \n    This fix will prevent a traceback during the _sync_power_states periodic\n    task which is expecting an InstanceNotFound exception.\n    \n    Change-Id: Ia28fe33d69520806dab878c843fe435e018a20de\n    Closes-Bug: 1226756\n", 
            "date_created": "2013-09-23 20:05:56.587415+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}