{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:52:38.265195+00:00", 
    "description": "I see the following traceback in nova-api log:\n\n2014-04-22 17:56:40.228 5004 ERROR nova.api.metadata.handler [-] Failed to get metadata for instance id: 9ac5c1ae-c481-4a3e-8b36-a567b146c42f\n2014-04-22 17:56:40.229 5004 ERROR nova.api.ec2 [-] FaultWrapper: 'NoneType' object has no attribute 'instance'\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2 Traceback (most recent call last):\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py\", line 87, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     return req.get_response(self.application)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/request.py\", line 1296, in send\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     application, catch_exc_info=False)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/request.py\", line 1260, in call_application\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     app_iter = application(self.environ, start_response)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/dec.py\", line 130, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     resp = self.call_func(req, *args, **self.kwargs)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/dec.py\", line 195, in call_func\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     return self.func(req, *args, **kwargs)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py\", line 99, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     rv = req.get_response(self.application)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/request.py\", line 1296, in send\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     application, catch_exc_info=False)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/request.py\", line 1260, in call_application\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     app_iter = application(self.environ, start_response)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/dec.py\", line 130, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     resp = self.call_func(req, *args, **self.kwargs)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/dec.py\", line 195, in call_func\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     return self.func(req, *args, **kwargs)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/nova/api/metadata/handler.py\", line 107, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     meta_data = self._handle_instance_id_request(req)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/nova/api/metadata/handler.py\", line 203, in _handle_instance_id_request\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     if meta_data.instance['project_id'] != tenant_id:\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2 AttributeError: 'NoneType' object has no attribute 'instance'\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2", 
    "tags": [
        "ec2"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1324091", 
    "owner": "https://api.launchpad.net/1.0/~ihar-hrachyshka", 
    "id": 1324091, 
    "index": 4885, 
    "created": "2014-05-28 11:58:47.314069+00:00", 
    "title": "ec2 metadata request fails with: AttributeError: 'NoneType' object has no attribute 'instance'", 
    "comments": [
        {
            "content": "I see the following traceback in nova-api log:\n\n2014-04-22 17:56:40.228 5004 ERROR nova.api.metadata.handler [-] Failed to get metadata for instance id: 9ac5c1ae-c481-4a3e-8b36-a567b146c42f\n2014-04-22 17:56:40.229 5004 ERROR nova.api.ec2 [-] FaultWrapper: 'NoneType' object has no attribute 'instance'\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2 Traceback (most recent call last):\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py\", line 87, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     return req.get_response(self.application)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/request.py\", line 1296, in send\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     application, catch_exc_info=False)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/request.py\", line 1260, in call_application\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     app_iter = application(self.environ, start_response)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/dec.py\", line 130, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     resp = self.call_func(req, *args, **self.kwargs)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/dec.py\", line 195, in call_func\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     return self.func(req, *args, **kwargs)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py\", line 99, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     rv = req.get_response(self.application)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/request.py\", line 1296, in send\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     application, catch_exc_info=False)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/request.py\", line 1260, in call_application\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     app_iter = application(self.environ, start_response)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/dec.py\", line 130, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     resp = self.call_func(req, *args, **self.kwargs)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/WebOb-1.2.3-py2.6.egg/webob/dec.py\", line 195, in call_func\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     return self.func(req, *args, **kwargs)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/nova/api/metadata/handler.py\", line 107, in __call__\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     meta_data = self._handle_instance_id_request(req)\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2   File \"/usr/lib/python2.6/site-packages/nova/api/metadata/handler.py\", line 203, in _handle_instance_id_request\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2     if meta_data.instance['project_id'] != tenant_id:\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2 AttributeError: 'NoneType' object has no attribute 'instance'\n2014-04-22 17:56:40.229 5004 TRACE nova.api.ec2", 
            "date_created": "2014-05-28 11:58:47.314069+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "Can you provide some more context of how to reproduce this issue.", 
            "date_created": "2014-07-10 17:53:41.380350+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "@Joe, I've seen this when e.g. metadata-agent stops to respond due to its own bug.", 
            "date_created": "2014-07-10 18:06:14.847954+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "I'm experiencing the same behavior.", 
            "date_created": "2014-08-08 07:41:33.518035+00:00", 
            "author": "https://api.launchpad.net/1.0/~felipe-alfaro-gmail"
        }, 
        {
            "content": "BTW there is a patch in review for that: https://review.openstack.org/96147", 
            "date_created": "2014-08-08 08:30:13.396084+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/96147\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=904fad326b249672908c94daf03c8c35cd4c7365\nSubmitter: Jenkins\nBranch:    master\n\ncommit 904fad326b249672908c94daf03c8c35cd4c7365\nAuthor: Ihar Hrachyshka <email address hidden>\nDate:   Wed May 28 14:00:14 2014 +0200\n\n    EC2: fixed AttributeError when metadata is not found\n    \n    Change-Id: I91e0141bd89cd18596ccae2ea213f641ba4d7f74\n    Closes-Bug: 1324091\n", 
            "date_created": "2014-08-11 20:30:21.487532+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}