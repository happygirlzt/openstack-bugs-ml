{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 09:02:42.674578+00:00", 
    "description": "The message is \"InvalidBDM: Block Device Mapping is Invalid.\" Exceeding quota is a problem that should be solved by the user, not a cloud admin. So the message should be one telling the user that the error was caused by quota.\n\nExample:\n\nA user has 2 GB of volume quota.\n\nubuntu@dev-1:~/devstack$ cinder quota-usage b926f718a7d345cb9f57b4e4dc98f674\n+-----------------------+--------+----------+-------+\n|          Type         | In_use | Reserved | Limit |\n+-----------------------+--------+----------+-------+\n|    backup_gigabytes   |   0    |    0     |  1000 |\n|        backups        |   0    |    0     |   10  |\n|       gigabytes       |   0    |    0     |   2   | \n| gigabytes_lvmdriver-1 |   0    |    0     |   2   |\n|  per_volume_gigabytes |   0    |    0     |   -1  |\n|       snapshots       |   0    |    0     |   10  |\n| snapshots_lvmdriver-1 |   0    |    0     |   -1  |\n|        volumes        |   0    |    0     |   10  |\n|  volumes_lvmdriver-1  |   0    |    0     |   -1  |\n+-----------------------+--------+----------+-------+\n\nThen, create an instance with 3 GB volume creation\n\nubuntu@dev-1:~/devstack$ nova boot --flavor m1.tiny --block-device source=image,id=535ec234-5522-4cdc-598-4050a62d5135,dest=volume,size=3,bootindex=0 vb\n+--------------------------------------+-------------------------------------------------+\n| Property                             | Value                                           |\n+--------------------------------------+-------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                          |\n| OS-EXT-AZ:availability_zone          | nova                                            |\n| OS-EXT-STS:power_state               | 0                                               |\n| OS-EXT-STS:task_state                | scheduling                                      |\n| OS-EXT-STS:vm_state                  | building                                        |\n| OS-SRV-USG:launched_at               | -                                               |\n| OS-SRV-USG:terminated_at             | -                                               |\n| accessIPv4                           |                                                 |\n| accessIPv6                           |                                                 |\n| adminPass                            | znMzRMuCJx99                                    |\n| config_drive                         |                                                 |\n| created                              | 2015-08-06T11:34:53Z                            |\n| flavor                               | m1.tiny (1)                                     |\n| hostId                               |                                                 |\n| id                                   | 5934a4f5-4d89-465b-956b-f53b2ebdad43            |\n| image                                | Attempt to boot from volume - no image supplied |\n| key_name                             | -                                               |\n| metadata                             | {}                                              |\n| name                                 | vb                                              |\n| os-extended-volumes:volumes_attached | []                                              |\n| progress                             | 0                                               |\n| security_groups                      | default                                         |\n| status                               | BUILD                                           |\n| tenant_id                            | b926f718a7d345cb9f57b4e4dc98f674                |\n| updated                              | 2015-08-06T11:34:54Z                            |\n| user_id                              | 386255bb3f05410dae7856633f0e611e                |\n+--------------------------------------+-------------------------------------------------+\n\nFails with a message \"Failure prepping block device\". It is difficult to know the quota is a cause of the error by seeing the message.\n\nubuntu@dev-1:~/devstack$ nova show vb\n+--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                                                                         |\n+--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                                                                        |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                                                                          |\n| OS-EXT-STS:power_state               | 0                                                                                                                                                             |\n| OS-EXT-STS:task_state                | block_device_mapping                                                                                                                                          |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                         |\n| OS-SRV-USG:launched_at               | -                                                                                                                                                             |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                             |\n| accessIPv4                           |                                                                                                                                                               |\n| accessIPv6                           |                                                                                                                                                               |\n| config_drive                         |                                                                                                                                                               |\n| created                              | 2015-08-06T11:34:53Z                                                                                                                                          |\n| fault                                | {\"message\": \"Build of instance 5934a4f5-4d89-465b-956b-f53b2ebdad43 aborted: Failure prepping block device.\", \"code\": 500, \"created\": \"2015-08-06T11:34:58Z\"} |\n| flavor                               | m1.tiny (1)                                                                                                                                                   |\n| hostId                               | c44fcd09b907ebe036f7d5e486e6392f06a46af3a333abd0160c972d                                                                                                      |\n| id                                   | 5934a4f5-4d89-465b-956b-f53b2ebdad43                                                                                                                          |\n| image                                | Attempt to boot from volume - no image supplied                                                                                                               |\n| key_name                             | -                                                                                                                                                             |\n| metadata                             | {}                                                                                                                                                            |\n| name                                 | vb                                                                                                                                                            |\n| os-extended-volumes:volumes_attached | []                                                                                                                                                            |\n| private network                      | 10.0.0.2                                                                                                                                                      |\n| security_groups                      | default                                                                                                                                                       |\n| status                               | ERROR                                                                                                                                                         |\n| tenant_id                            | b926f718a7d345cb9f57b4e4dc98f674                                                                                                                              |\n| updated                              | 2015-08-06T11:34:58Z                                                                                                                                          |\n| user_id                              | 386255bb3f05410dae7856633f0e611e                                                                                                                              |\n+--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1482191", 
    "owner": "https://api.launchpad.net/1.0/~arata776", 
    "id": 1482191, 
    "index": 5689, 
    "created": "2015-08-06 11:45:17.113141+00:00", 
    "title": "Error message is too generic when boot with volume creation fails with exceeded quota", 
    "comments": [
        {
            "content": "The message is \"InvalidBDM: Block Device Mapping is Invalid.\" Exceeding quota is a problem that should be solved by the user, not a cloud admin. So the message should be one telling the user that the error was caused by quota.\n\nExample:\n\nA user has 2 GB of volume quota.\n\nubuntu@dev-1:~/devstack$ cinder quota-usage b926f718a7d345cb9f57b4e4dc98f674\n+-----------------------+--------+----------+-------+\n|          Type         | In_use | Reserved | Limit |\n+-----------------------+--------+----------+-------+\n|    backup_gigabytes   |   0    |    0     |  1000 |\n|        backups        |   0    |    0     |   10  |\n|       gigabytes       |   0    |    0     |   2   | \n| gigabytes_lvmdriver-1 |   0    |    0     |   2   |\n|  per_volume_gigabytes |   0    |    0     |   -1  |\n|       snapshots       |   0    |    0     |   10  |\n| snapshots_lvmdriver-1 |   0    |    0     |   -1  |\n|        volumes        |   0    |    0     |   10  |\n|  volumes_lvmdriver-1  |   0    |    0     |   -1  |\n+-----------------------+--------+----------+-------+\n\nThen, create an instance with 3 GB volume creation\n\nubuntu@dev-1:~/devstack$ nova boot --flavor m1.tiny --block-device source=image,id=535ec234-5522-4cdc-598-4050a62d5135,dest=volume,size=3,bootindex=0 vb\n+--------------------------------------+-------------------------------------------------+\n| Property                             | Value                                           |\n+--------------------------------------+-------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                          |\n| OS-EXT-AZ:availability_zone          | nova                                            |\n| OS-EXT-STS:power_state               | 0                                               |\n| OS-EXT-STS:task_state                | scheduling                                      |\n| OS-EXT-STS:vm_state                  | building                                        |\n| OS-SRV-USG:launched_at               | -                                               |\n| OS-SRV-USG:terminated_at             | -                                               |\n| accessIPv4                           |                                                 |\n| accessIPv6                           |                                                 |\n| adminPass                            | znMzRMuCJx99                                    |\n| config_drive                         |                                                 |\n| created                              | 2015-08-06T11:34:53Z                            |\n| flavor                               | m1.tiny (1)                                     |\n| hostId                               |                                                 |\n| id                                   | 5934a4f5-4d89-465b-956b-f53b2ebdad43            |\n| image                                | Attempt to boot from volume - no image supplied |\n| key_name                             | -                                               |\n| metadata                             | {}                                              |\n| name                                 | vb                                              |\n| os-extended-volumes:volumes_attached | []                                              |\n| progress                             | 0                                               |\n| security_groups                      | default                                         |\n| status                               | BUILD                                           |\n| tenant_id                            | b926f718a7d345cb9f57b4e4dc98f674                |\n| updated                              | 2015-08-06T11:34:54Z                            |\n| user_id                              | 386255bb3f05410dae7856633f0e611e                |\n+--------------------------------------+-------------------------------------------------+\n\nFails with a message \"Failure prepping block device\". It is difficult to know the quota is a cause of the error by seeing the message.\n\nubuntu@dev-1:~/devstack$ nova show vb\n+--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                                                                         |\n+--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                                                                        |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                                                                          |\n| OS-EXT-STS:power_state               | 0                                                                                                                                                             |\n| OS-EXT-STS:task_state                | block_device_mapping                                                                                                                                          |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                         |\n| OS-SRV-USG:launched_at               | -                                                                                                                                                             |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                             |\n| accessIPv4                           |                                                                                                                                                               |\n| accessIPv6                           |                                                                                                                                                               |\n| config_drive                         |                                                                                                                                                               |\n| created                              | 2015-08-06T11:34:53Z                                                                                                                                          |\n| fault                                | {\"message\": \"Build of instance 5934a4f5-4d89-465b-956b-f53b2ebdad43 aborted: Failure prepping block device.\", \"code\": 500, \"created\": \"2015-08-06T11:34:58Z\"} |\n| flavor                               | m1.tiny (1)                                                                                                                                                   |\n| hostId                               | c44fcd09b907ebe036f7d5e486e6392f06a46af3a333abd0160c972d                                                                                                      |\n| id                                   | 5934a4f5-4d89-465b-956b-f53b2ebdad43                                                                                                                          |\n| image                                | Attempt to boot from volume - no image supplied                                                                                                               |\n| key_name                             | -                                                                                                                                                             |\n| metadata                             | {}                                                                                                                                                            |\n| name                                 | vb                                                                                                                                                            |\n| os-extended-volumes:volumes_attached | []                                                                                                                                                            |\n| private network                      | 10.0.0.2                                                                                                                                                      |\n| security_groups                      | default                                                                                                                                                       |\n| status                               | ERROR                                                                                                                                                         |\n| tenant_id                            | b926f718a7d345cb9f57b4e4dc98f674                                                                                                                              |\n| updated                              | 2015-08-06T11:34:58Z                                                                                                                                          |\n| user_id                              | 386255bb3f05410dae7856633f0e611e                                                                                                                              |\n+--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+", 
            "date_created": "2015-08-06 11:45:17.113141+00:00", 
            "author": "https://api.launchpad.net/1.0/~arata776"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/209897", 
            "date_created": "2015-08-06 11:49:08.946419+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/209897\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=b292f47e1b2575a97c40935df87f799fe487400d\nSubmitter: Jenkins\nBranch:    master\n\ncommit b292f47e1b2575a97c40935df87f799fe487400d\nAuthor: Arata Notsu <email address hidden>\nDate:   Thu Aug 6 19:47:46 2015 +0900\n\n    More specific error messages on building BDM\n    \n    When a user failed to create an instance with BDM because of\n    exceeded quota, its error message should be one that contains\n    the reason rather than generic 'Failure prepping block device'.\n    \n    For this purpose, we catch VolumeLimitExceeded explicitly in\n    _build_resources(). As a result, the user will get a clearer\n    message 'Volume resource quota exceeded'.\n    \n    We catch InvalidBDM explicitly as well. With this, although its\n    error message ('Block Device Mapping is Invalid.') is still not\n    user-friendly, it gets rid of a meaningless stack trace in log;\n    operator-friendly.\n    \n    Change-Id: Ia72a3cdde640f8e18fe3778e903204930e96d402\n    Closes-bug: #1482191\n", 
            "date_created": "2015-08-13 00:04:54.670986+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}