{
    "status": "Fix Released", 
    "last_updated": "2016-02-11 11:16:13.842216+00:00", 
    "description": "It seems that nova expects and validates that the os:scheduler_hints group key contains an UUID. However if it is not a UUID HTTP 500 is returned instead of HTTP 400.\n\nThis was visible in devstack with nova from master branch (b558d616c3b123dbe2a0914162b45765192f3a12)\n\nTo reproduce:\n\n$ nova server-group-create affin-group-1 affinity\n+--------------------------------------+---------------+---------------+---------+----------+\n| Id                                   | Name          | Policies      | Members | Metadata |\n+--------------------------------------+---------------+---------------+---------+----------+\n| b087079c-cfc8-4a7d-a578-ccfbb7a85cf5 | affin-group-1 | [u'affinity'] | []      | {}       |\n+--------------------------------------+---------------+---------------+---------+----------+\nnova --debug boot --flavor 42 --image cirros-0.3.4-x86_64-uec --hint group=affin-group-1 inst-1\n<snip>\nDEBUG (session:225) REQ: curl -g -i -X POST http://192.168.200.200:8774/v2.1/91b11b772c4d400f9a44ab1bbfd4ddd8/servers -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-OpenStack-Nova-API-Version: 2.12\" -H \"X-Auth-Token: {SHA1}71a9fd700ffb3e625648e4423b3bd3c409d23246\" -d '{\"os:scheduler_hints\": {\"group\": \"affin-group-1\"}, \"server\": {\"min_count\": 1, \"flavorRef\": \"42\", \"name\": \"inst-1\", \"imageRef\": \"75a189fa-389b-4386-a731-a3bfccdfe352\", \"max_count\": 1}}'\nDEBUG (connectionpool:387) \"POST /v2.1/91b11b772c4d400f9a44ab1bbfd4ddd8/servers HTTP/1.1\" 500 201\nDEBUG (session:254) RESP: [500] Content-Length: 201 X-Compute-Request-Id: req-5a167ca6-6828-4724-ba7f-246202b0a9ec Vary: X-OpenStack-Nova-API-Version Connection: keep-alive X-Openstack-Nova-Api-Version: 2.12 Date: Tue, 05 Jan 2016 22:48:57 GMT Content-Type: application/json; charset=UTF-8 \nRESP BODY: {\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'nova.exception.InvalidInput'>\", \"code\": 500}}\n\nDEBUG (shell:896) Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InvalidInput'> (HTTP 500) (Request-ID: req-5a167ca6-6828-4724-ba7f-246202b0a9ec)\nTraceback (most recent call last):\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 894, in main\n    OpenStackComputeShell().main(argv)\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 821, in main\n    args.func(self.cs, args)\n  File \"/opt/stack/python-novaclient/novaclient/v2/shell.py\", line 542, in do_boot\n    server = cs.servers.create(*boot_args, **boot_kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/v2/servers.py\", line 1024, in create\n    **boot_kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/v2/servers.py\", line 555, in _boot\n    return_raw=return_raw, **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/base.py\", line 175, in _create\n    _resp, body = self.api.client.post(url, body=body)\n  File \"/usr/local/lib/python2.7/dist-packages/keystoneauth1/adapter.py\", line 179, in post\n    return self.request(url, 'POST', **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 92, in request\n    raise exceptions.from_response(resp, body, url, method)\nClientException: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InvalidInput'> (HTTP 500) (Request-ID: req-5a167ca6-6828-4724-ba7f-246202b0a9ec)\n\n\nFrom the nova-api log:\n2016-01-05 22:48:57.786 ERROR nova.api.openstack.extensions [req-5a167ca6-6828-4724-ba7f-246202b0a9ec admin admin] Unexpected exception in API method\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 478, in wrapped\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 604, in create\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     **create_kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 149, in inner\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1504, in create\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1122, in _create_instance\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     scheduler_hints, check_server_group_quota)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1041, in _get_requested_instance_group\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     raise exception.InvalidInput(reason=msg)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions InvalidInput: Invalid input received: Server group scheduler hint must be a UUID.\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions", 
    "tags": [
        "api"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1535759", 
    "owner": "https://api.launchpad.net/1.0/~balazs-gibizer", 
    "id": 1535759, 
    "index": 663, 
    "created": "2016-01-19 14:59:15.107572+00:00", 
    "title": "Booting server with --hint group=group-name throws http 500", 
    "comments": [
        {
            "content": "It seems that nova expects and validates that the os:scheduler_hints group key contains an UUID. However if it is not a UUID HTTP 500 is returned instead of HTTP 400.\n\nThis was visible in devstack with nova from master branch (b558d616c3b123dbe2a0914162b45765192f3a12)\n\nTo reproduce:\n\n$ nova server-group-create affin-group-1 affinity\n+--------------------------------------+---------------+---------------+---------+----------+\n| Id                                   | Name          | Policies      | Members | Metadata |\n+--------------------------------------+---------------+---------------+---------+----------+\n| b087079c-cfc8-4a7d-a578-ccfbb7a85cf5 | affin-group-1 | [u'affinity'] | []      | {}       |\n+--------------------------------------+---------------+---------------+---------+----------+\nnova --debug boot --flavor 42 --image cirros-0.3.4-x86_64-uec --hint group=affin-group-1 inst-1\n<snip>\nDEBUG (session:225) REQ: curl -g -i -X POST http://192.168.200.200:8774/v2.1/91b11b772c4d400f9a44ab1bbfd4ddd8/servers -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-OpenStack-Nova-API-Version: 2.12\" -H \"X-Auth-Token: {SHA1}71a9fd700ffb3e625648e4423b3bd3c409d23246\" -d '{\"os:scheduler_hints\": {\"group\": \"affin-group-1\"}, \"server\": {\"min_count\": 1, \"flavorRef\": \"42\", \"name\": \"inst-1\", \"imageRef\": \"75a189fa-389b-4386-a731-a3bfccdfe352\", \"max_count\": 1}}'\nDEBUG (connectionpool:387) \"POST /v2.1/91b11b772c4d400f9a44ab1bbfd4ddd8/servers HTTP/1.1\" 500 201\nDEBUG (session:254) RESP: [500] Content-Length: 201 X-Compute-Request-Id: req-5a167ca6-6828-4724-ba7f-246202b0a9ec Vary: X-OpenStack-Nova-API-Version Connection: keep-alive X-Openstack-Nova-Api-Version: 2.12 Date: Tue, 05 Jan 2016 22:48:57 GMT Content-Type: application/json; charset=UTF-8 \nRESP BODY: {\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'nova.exception.InvalidInput'>\", \"code\": 500}}\n\nDEBUG (shell:896) Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InvalidInput'> (HTTP 500) (Request-ID: req-5a167ca6-6828-4724-ba7f-246202b0a9ec)\nTraceback (most recent call last):\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 894, in main\n    OpenStackComputeShell().main(argv)\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 821, in main\n    args.func(self.cs, args)\n  File \"/opt/stack/python-novaclient/novaclient/v2/shell.py\", line 542, in do_boot\n    server = cs.servers.create(*boot_args, **boot_kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/v2/servers.py\", line 1024, in create\n    **boot_kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/v2/servers.py\", line 555, in _boot\n    return_raw=return_raw, **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/base.py\", line 175, in _create\n    _resp, body = self.api.client.post(url, body=body)\n  File \"/usr/local/lib/python2.7/dist-packages/keystoneauth1/adapter.py\", line 179, in post\n    return self.request(url, 'POST', **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 92, in request\n    raise exceptions.from_response(resp, body, url, method)\nClientException: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InvalidInput'> (HTTP 500) (Request-ID: req-5a167ca6-6828-4724-ba7f-246202b0a9ec)\n\n\nFrom the nova-api log:\n2016-01-05 22:48:57.786 ERROR nova.api.openstack.extensions [req-5a167ca6-6828-4724-ba7f-246202b0a9ec admin admin] Unexpected exception in API method\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 478, in wrapped\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 604, in create\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     **create_kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 149, in inner\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1504, in create\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1122, in _create_instance\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     scheduler_hints, check_server_group_quota)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1041, in _get_requested_instance_group\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions     raise exception.InvalidInput(reason=msg)\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions InvalidInput: Invalid input received: Server group scheduler hint must be a UUID.\n2016-01-05 22:48:57.786 TRACE nova.api.openstack.extensions", 
            "date_created": "2016-01-19 14:59:15.107572+00:00", 
            "author": "https://api.launchpad.net/1.0/~balazs-gibizer"
        }, 
        {
            "content": "Bug skimming result\n===================\nLooks like a valid bug in the REST API area => CONFIRMED", 
            "date_created": "2016-01-22 15:54:14.117438+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/272737", 
            "date_created": "2016-01-26 21:13:56.440344+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/272737\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=5cc5a841109b082395d9664edcfc11e31fb678fa\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5cc5a841109b082395d9664edcfc11e31fb678fa\nAuthor: Balazs Gibizer <email address hidden>\nDate:   Tue Jan 26 22:10:12 2016 +0100\n\n    Return HTTP 400 for invalid server-group uuid\n    \n    Nova API checks that the value of the group scheduler hint\n    shall be a valid server-group uuid, however it was done by custom\n    code not jsonschema. Moreover the exception was not handled by the API\n    so both v2.0 and v.2.1 returned HTTP 500 if the group hint wasn't a valid\n    uuid of an existing server group.\n    \n    The custom code to check for the validity of the group uuid is kept in\n    nova.compute.api as it is still needed in v2.0.\n    \n    In v2.0 InstanceGroupNotFound exception are now translated to HTTPBadRequest.\n    \n    In v2.1 the scheduler_hint jsonschema is now extended to check the format\n    of the group hint and the api is now translates the InstanceGroupNotFound\n    to HTTPBadRequest.\n    \n    Closes-bug: #1535759\n    Change-Id: I38d98c74f6cceed5b4becf9ed67f7189cba479fa\n", 
            "date_created": "2016-02-11 11:16:13.285897+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}