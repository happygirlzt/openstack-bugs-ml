{
    "status": "Invalid", 
    "last_updated": "2014-12-12 10:57:51.933200+00:00", 
    "description": "Description of problem\n----------------------\n\nFrom the proposed Nova specification \"Virt driver large page allocation\nfor guest RAM\"[*], if you set the Nova flavor extra_spec for huge pages\nas 'any' ('nova flavor-key m1.hugepages set hw:mem_page_size=any',\nit means: \"leave policy upto the compute driver implementation to\ndecide. When seeing 'any' the libvirt driver might try to find large\npages, but fallback to small pages\"\n\nHowever, booting a guest with a Nova flavor defined with huge pages size\nset to 'any', results in:\n\n    libvirtError: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\n\n\nFrom Nova Conductor logs:\n\n. . .\n2014-12-11 13:06:34.738 ERROR nova.scheduler.utils [req-7812c740-ec60-461e-a6b7-66b4bd4359ee admin admin] [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c\n9fb] Error from last host: fedvm1 (node fedvm1): [u'Traceback (most recent call last):\\n', u'  File \"/home/kashyapc/src/cloud/nova/nova/compute/manage\nr.py\", line 2060, in _do_build_and_run_instance\\n    filter_properties)\\n', u'  File \"/home/kashyapc/src/cloud/nova/nova/compute/manager.py\", line 220\n0, in _build_and_run_instance\\n    instance_uuid=instance.uuid, reason=six.text_type(e))\\n', u'RescheduledException: Build of instance c8e1093b-81d6-4\nbc8-a319-7a8ea384c9fb was re-scheduled: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\\n']\n. . .\n\n \n[*] http://specs.openstack.org/openstack/nova-specs/specs/kilo/approved/virt-driver-large-pages.html#proposed-change\n\n\nVersion\n-------\n\nApply the virt-driver-large-pages patch series to Nova git, and test via\nDevStack:\n\n    https://review.openstack.org/#/q/status:open+project:openstack/nova+branch:master+topic:bp/virt-driver-large-pages,n,z\n\n    $ git log | grep \"commit\\ \" | head -8\n    commit c0c5d6a497c0e275e6f2037c1f7d45983a077cbc\n    commit 9d1d59bd82a7f2747487884d5880270bfdc9734a\n    commit eda126cce41fd5061b630a1beafbf5c37292946e\n    commit 6980502683bdcf514b386038ca0e0ef8226c27ca\n    commit b1ddc34efdba271f406a6db39c8deeeeadcb8cc9\n        This commit also add a new exceptions MemoryPageSizeInvalid and\n    commit 2fcfc675aa04ef2760f0e763697c73b6d90a4fca\n    commit 567987035bc3ef685ea09ac2b82be55aa5e23ca5\n\n    $ git describe\n    2014.2-1358-gc0c5d6a\n\n\nlibvirt version: libvirt-1.2.11 (built from libvirt git)\n\n    $ git log | head -1 \n    commit a2a35d0164f4244b9c6f143f54e9bb9f3c9af7d3a\n    $ git describe\n    CVE-2014-7823-247-ga2a35d0\n\n\n\nSteps to Reproduce\n------------------\n\nTest environment: I was testing Nova huge pages in a DevStack VM with KVM\nnested virtualization, i.e. the Nova instances will be the nested guests.\n\nCheck if the 'hugetlbfs' is present in /proc filesystem:\n\n    $ cat /proc/filesystems  | grep hugetlbfs\n    nodev   hugetlbfs\n\nGet the number of total huge pages:\n\n    $ grep HugePages_Total /proc/meminfo\n    HugePages_Total:     512\n\nGet the number of free huge pages:\n\n    $ grep HugePages_Free /proc/meminfo\n    HugePages_Free:      512\n\nCreate flavor:\n\n    nova flavor-create m1.hugepages 999 2048 1 4\n\nSet extra_spec values for NUMA and Huge pages, with value as 'any':\n\n    nova flavor-key m1.hugepages set hw:numa_nodes=1\n    nova flavor-key m1.hugepages set hw:mem_page_size=any\n\nEnumerate the newly created flavor properties:\n\n    $ nova flavor-show m1.hugepages\n    +----------------------------+-----------------------------------------------------+\n    | Property                   | Value                                               |\n    +----------------------------+-----------------------------------------------------+\n    | OS-FLV-DISABLED:disabled   | False                                               |\n    | OS-FLV-EXT-DATA:ephemeral  | 0                                                   |\n    | disk                       | 1                                                   |\n    | extra_specs                | {\"hw:mem_page_size\": \"any\", \"hw:numa_nodes\": \"1\"}   |\n    | id                         | 999                                                 |\n    | name                       | m1.hugepages                                        |\n    | os-flavor-access:is_public | True                                                |\n    | ram                        | 2048                                                |\n    | rxtx_factor                | 1.0                                                 |\n    | swap                       |                                                     |\n    | vcpus                      | 4                                                   |\n    +----------------------------+-----------------------------------------------------+\n\n\nBoot a guest with the above falvor:\n\n\nActual results\n--------------\n\n\n(1) Contextual error messages from Nova Compute log (screen-n-cpu.log):\n\n. . .\n2014-12-11 13:06:34.141 ERROR nova.compute.manager [-] [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb] Instance failed to spawn\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb] Traceback (most recent call last):\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/compute\n/manager.py\", line 2282, in _build_resources\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     yield resources\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/compute\n/manager.py\", line 2152, in _build_and_run_instance\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     flavor=flavor)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/virt/li\nbvirt/driver.py\", line 2384, in spawn\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     block_device_info=block_device_info)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/virt/libvirt/driver.py\", line 4278, in _create_domain_and_network\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     power_on=power_on)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/virt/libvirt/driver.py\", line 4211, in _create_domain\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     LOG.error(err)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/oslo/utils/excutils.py\", line 82, in __exit__\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     six.reraise(self.type_, self.value, self.tb)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/virt/libvirt/driver.py\", line 4201, in _create_domain\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     domain.createWithFlags(launch_flags)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     rv = execute(f, *args, **kwargs)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     six.reraise(c, e, tb)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     rv = meth(*args, **kwargs)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 1033, in createWithFlags\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb] libvirtError: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\n. . .\n\n\nExpected results\n----------------\n\nAs specified in the SPEC, Compute driver\n\nAdditional info\n---------------\n\n(2) Contextual error messages from Nova Conductor log (screen-n-cond.log):\n----------------------------------------\n. . .\n2014-12-11 13:06:34.738 ERROR nova.scheduler.utils [req-7812c740-ec60-461e-a6b7-66b4bd4359ee admin admin] [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c\n9fb] Error from last host: fedvm1 (node fedvm1): [u'Traceback (most recent call last):\\n', u'  File \"/home/kashyapc/src/cloud/nova/nova/compute/manage\nr.py\", line 2060, in _do_build_and_run_instance\\n    filter_properties)\\n', u'  File \"/home/kashyapc/src/cloud/nova/nova/compute/manager.py\", line 220\n0, in _build_and_run_instance\\n    instance_uuid=instance.uuid, reason=six.text_type(e))\\n', u'RescheduledException: Build of instance c8e1093b-81d6-4\nbc8-a319-7a8ea384c9fb was re-scheduled: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\\n']\n. . .\n----------------------------------------\n\n\n(3) This error comes from libvirt, added in this commit:\n\n    http://libvirt.org/git/?p=libvirt.git;a=commitdiff;h=281f70013e", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1401647", 
    "owner": "https://api.launchpad.net/1.0/~sahid-ferdjaoui", 
    "id": 1401647, 
    "index": 4113, 
    "created": "2014-12-11 19:47:58.966094+00:00", 
    "title": "Huge pages: Compute driver fails to set appropriate page size when using flavor extra spec --  'hw:mem_page_size=any'", 
    "comments": [
        {
            "content": "Description of problem\n----------------------\n\nFrom the proposed Nova specification \"Virt driver large page allocation\nfor guest RAM\"[*], if you set the Nova flavor extra_spec for huge pages\nas 'any' ('nova flavor-key m1.hugepages set hw:mem_page_size=any',\nit means: \"leave policy upto the compute driver implementation to\ndecide. When seeing 'any' the libvirt driver might try to find large\npages, but fallback to small pages\"\n\nHowever, booting a guest with a Nova flavor defined with huge pages size\nset to 'any', results in:\n\n    libvirtError: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\n\n\nFrom Nova Conductor logs:\n\n. . .\n2014-12-11 13:06:34.738 ERROR nova.scheduler.utils [req-7812c740-ec60-461e-a6b7-66b4bd4359ee admin admin] [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c\n9fb] Error from last host: fedvm1 (node fedvm1): [u'Traceback (most recent call last):\\n', u'  File \"/home/kashyapc/src/cloud/nova/nova/compute/manage\nr.py\", line 2060, in _do_build_and_run_instance\\n    filter_properties)\\n', u'  File \"/home/kashyapc/src/cloud/nova/nova/compute/manager.py\", line 220\n0, in _build_and_run_instance\\n    instance_uuid=instance.uuid, reason=six.text_type(e))\\n', u'RescheduledException: Build of instance c8e1093b-81d6-4\nbc8-a319-7a8ea384c9fb was re-scheduled: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\\n']\n. . .\n\n \n[*] http://specs.openstack.org/openstack/nova-specs/specs/kilo/approved/virt-driver-large-pages.html#proposed-change\n\n\nVersion\n-------\n\nApply the virt-driver-large-pages patch series to Nova git, and test via\nDevStack:\n\n    https://review.openstack.org/#/q/status:open+project:openstack/nova+branch:master+topic:bp/virt-driver-large-pages,n,z\n\n    $ git log | grep \"commit\\ \" | head -8\n    commit c0c5d6a497c0e275e6f2037c1f7d45983a077cbc\n    commit 9d1d59bd82a7f2747487884d5880270bfdc9734a\n    commit eda126cce41fd5061b630a1beafbf5c37292946e\n    commit 6980502683bdcf514b386038ca0e0ef8226c27ca\n    commit b1ddc34efdba271f406a6db39c8deeeeadcb8cc9\n        This commit also add a new exceptions MemoryPageSizeInvalid and\n    commit 2fcfc675aa04ef2760f0e763697c73b6d90a4fca\n    commit 567987035bc3ef685ea09ac2b82be55aa5e23ca5\n\n    $ git describe\n    2014.2-1358-gc0c5d6a\n\n\nlibvirt version: libvirt-1.2.11 (built from libvirt git)\n\n    $ git log | head -1 \n    commit a2a35d0164f4244b9c6f143f54e9bb9f3c9af7d3a\n    $ git describe\n    CVE-2014-7823-247-ga2a35d0\n\n\n\nSteps to Reproduce\n------------------\n\nTest environment: I was testing Nova huge pages in a DevStack VM with KVM\nnested virtualization, i.e. the Nova instances will be the nested guests.\n\nCheck if the 'hugetlbfs' is present in /proc filesystem:\n\n    $ cat /proc/filesystems  | grep hugetlbfs\n    nodev   hugetlbfs\n\nGet the number of total huge pages:\n\n    $ grep HugePages_Total /proc/meminfo\n    HugePages_Total:     512\n\nGet the number of free huge pages:\n\n    $ grep HugePages_Free /proc/meminfo\n    HugePages_Free:      512\n\nCreate flavor:\n\n    nova flavor-create m1.hugepages 999 2048 1 4\n\nSet extra_spec values for NUMA and Huge pages, with value as 'any':\n\n    nova flavor-key m1.hugepages set hw:numa_nodes=1\n    nova flavor-key m1.hugepages set hw:mem_page_size=any\n\nEnumerate the newly created flavor properties:\n\n    $ nova flavor-show m1.hugepages\n    +----------------------------+-----------------------------------------------------+\n    | Property                   | Value                                               |\n    +----------------------------+-----------------------------------------------------+\n    | OS-FLV-DISABLED:disabled   | False                                               |\n    | OS-FLV-EXT-DATA:ephemeral  | 0                                                   |\n    | disk                       | 1                                                   |\n    | extra_specs                | {\"hw:mem_page_size\": \"any\", \"hw:numa_nodes\": \"1\"}   |\n    | id                         | 999                                                 |\n    | name                       | m1.hugepages                                        |\n    | os-flavor-access:is_public | True                                                |\n    | ram                        | 2048                                                |\n    | rxtx_factor                | 1.0                                                 |\n    | swap                       |                                                     |\n    | vcpus                      | 4                                                   |\n    +----------------------------+-----------------------------------------------------+\n\n\nBoot a guest with the above falvor:\n\n\nActual results\n--------------\n\n\n(1) Contextual error messages from Nova Compute log (screen-n-cpu.log):\n\n. . .\n2014-12-11 13:06:34.141 ERROR nova.compute.manager [-] [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb] Instance failed to spawn\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb] Traceback (most recent call last):\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/compute\n/manager.py\", line 2282, in _build_resources\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     yield resources\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/compute\n/manager.py\", line 2152, in _build_and_run_instance\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     flavor=flavor)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/virt/li\nbvirt/driver.py\", line 2384, in spawn\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     block_device_info=block_device_info)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/virt/libvirt/driver.py\", line 4278, in _create_domain_and_network\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     power_on=power_on)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/virt/libvirt/driver.py\", line 4211, in _create_domain\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     LOG.error(err)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/oslo/utils/excutils.py\", line 82, in __exit__\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     six.reraise(self.type_, self.value, self.tb)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/home/kashyapc/src/cloud/nova/nova/virt/libvirt/driver.py\", line 4201, in _create_domain\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     domain.createWithFlags(launch_flags)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     rv = execute(f, *args, **kwargs)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     six.reraise(c, e, tb)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     rv = meth(*args, **kwargs)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 1033, in createWithFlags\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2014-12-11 13:06:34.141 TRACE nova.compute.manager [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb] libvirtError: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\n. . .\n\n\nExpected results\n----------------\n\nAs specified in the SPEC, Compute driver\n\nAdditional info\n---------------\n\n(2) Contextual error messages from Nova Conductor log (screen-n-cond.log):\n----------------------------------------\n. . .\n2014-12-11 13:06:34.738 ERROR nova.scheduler.utils [req-7812c740-ec60-461e-a6b7-66b4bd4359ee admin admin] [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c\n9fb] Error from last host: fedvm1 (node fedvm1): [u'Traceback (most recent call last):\\n', u'  File \"/home/kashyapc/src/cloud/nova/nova/compute/manage\nr.py\", line 2060, in _do_build_and_run_instance\\n    filter_properties)\\n', u'  File \"/home/kashyapc/src/cloud/nova/nova/compute/manager.py\", line 220\n0, in _build_and_run_instance\\n    instance_uuid=instance.uuid, reason=six.text_type(e))\\n', u'RescheduledException: Build of instance c8e1093b-81d6-4\nbc8-a319-7a8ea384c9fb was re-scheduled: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\\n']\n. . .\n----------------------------------------\n\n\n(3) This error comes from libvirt, added in this commit:\n\n    http://libvirt.org/git/?p=libvirt.git;a=commitdiff;h=281f70013e", 
            "date_created": "2014-12-11 19:47:58.966094+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "Nova guest XML that Compute driver (libvirt) tries to set:\n\n. . .\n2014-12-11 13:06:34.140 ERROR nova.virt.libvirt.driver [-] Error launching a defined domain with XML: <domain type='kvm'>\n  <name>instance-00000004</name>\n  <uuid>c8e1093b-81d6-4bc8-a319-7a8ea384c9fb</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"2015.1\"/>\n      <nova:name>cirrvm16</nova:name>\n      <nova:creationTime>2014-12-11 18:06:32</nova:creationTime>\n      <nova:flavor name=\"m1.hugepages\">\n        <nova:memory>2048</nova:memory>\n        <nova:disk>1</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>4</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"1682eea4d412456493b0ea68ac48d9b0\">admin</nova:user>\n        <nova:project uuid=\"b51e61d5963d4c25a7ff763859d8f56a\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"7f7f8c64-4e32-496d-8575-7d68f8f1094f\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>2097152</memory>\n  <currentMemory unit='KiB'>2097152</currentMemory>\n  <memoryBacking>\n    <hugepages>\n      <page size='4' unit='KiB' nodeset='0'/>\n    </hugepages>\n  </memoryBacking>\n  <vcpu placement='static'>4</vcpu>\n  <cputune>\n    <vcpupin vcpu='0' cpuset='0-3'/>\n    <vcpupin vcpu='1' cpuset='0-3'/>\n    <vcpupin vcpu='2' cpuset='0-3'/>\n    <vcpupin vcpu='3' cpuset='0-3'/>\n    <emulatorpin cpuset='0-3'/>\n  </cputune>\n  <numatune>\n    <memory mode='strict' nodeset='0'/>\n    <memnode cellid='0' mode='strict' nodeset='0'/>\n  </numatune>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2015.1</entry>\n      <entry name='serial'>bf6b5391-2390-df4f-b3dc-aa80d05468bb</entry>\n      <entry name='uuid'>c8e1093b-81d6-4bc8-a319-7a8ea384c9fb</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-2.2'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu>\n  <cpu>\n    <topology sockets='4' cores='1' threads='1'/>\n    <numa>\n      <cell id='0' cpus='0-3' memory='2097152' unit='KiB'/>\n    </numa>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-kvm</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/home/kashyapc/src/cloud/data/nova/instances/c8e1093b-81d6-4bc8-a319-7a8ea384c9fb/disk'/>\n      <target dev='vda' bus='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/home/kashyapc/src/cloud/data/nova/instances/c8e1093b-81d6-4bc8-a319-7a8ea384c9fb/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <controller type='ide' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:74:ab:29'/>\n      <source bridge='qbrd15d136e-1f'/>\n      <target dev='tapd15d136e-1f'/>\n      <model type='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/home/kashyapc/src/cloud/data/nova/instances/c8e1093b-81d6-4bc8-a319-7a8ea384c9fb/console.log'/>\n      <target port='0'/>\n    </serial>\n    <console type='file'>\n      <source path='/home/kashyapc/src/cloud/data/nova/instances/c8e1093b-81d6-4bc8-a319-7a8ea384c9fb/console.log'/>\n      <target type='serial' port='0'/>\n    </console>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n      <stats period='10'/>\n    </memballoon>\n  </devices>\n</domain>\n\n2014-12-11 13:06:34.141 ERROR nova.compute.manager [-] [instance: c8e1093b-81d6-4bc8-a319-7a8ea384c9fb] Instance failed to spawn\n. . .", 
            "date_created": "2014-12-11 20:02:54.462654+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "`virsh capabilities` of the DevStack host (where Compute node is runnning):\n\n-----\n<capabilities>\n\n  <host>\n    <uuid>6c62250e-7f7e-475e-94a6-a4963160d859</uuid>\n    <cpu>\n      <arch>x86_64</arch>\n      <model>Nehalem</model>\n      <vendor>Intel</vendor>\n      <topology sockets='1' cores='8' threads='1'/>\n      <feature name='rdtscp'/>\n      <feature name='hypervisor'/>\n      <feature name='x2apic'/>\n      <feature name='vmx'/>\n      <feature name='ss'/>\n      <feature name='vme'/>\n      <pages unit='KiB' size='4'/>\n      <pages unit='KiB' size='2048'/>\n    </cpu>\n    <power_management>\n      <suspend_mem/>\n      <suspend_disk/>\n      <suspend_hybrid/>\n    </power_management>\n    <migration_features>\n      <live/>\n      <uri_transports>\n        <uri_transport>tcp</uri_transport>\n        <uri_transport>rdma</uri_transport>\n      </uri_transports>\n    </migration_features>\n    <topology>\n      <cells num='3'>\n        <cell id='0'>\n          <memory unit='KiB'>3949740</memory>\n          <pages unit='KiB' size='4'>899883</pages>\n          <pages unit='KiB' size='2048'>171</pages>\n          <distances>\n            <sibling id='0' value='10'/>\n            <sibling id='1' value='20'/>\n            <sibling id='2' value='20'/>\n          </distances>\n          <cpus num='4'>\n            <cpu id='0' socket_id='0' core_id='0' siblings='0'/>\n            <cpu id='1' socket_id='1' core_id='0' siblings='1'/>\n            <cpu id='2' socket_id='2' core_id='0' siblings='2'/>\n            <cpu id='3' socket_id='3' core_id='0' siblings='3'/>\n          </cpus>\n        </cell>\n        <cell id='1'>\n          <memory unit='KiB'>2016864</memory>\n          <pages unit='KiB' size='4'>416664</pages>\n          <pages unit='KiB' size='2048'>171</pages>\n          <distances>\n            <sibling id='0' value='20'/>\n            <sibling id='1' value='10'/>\n            <sibling id='2' value='20'/>\n          </distances>\n          <cpus num='2'>\n            <cpu id='4' socket_id='4' core_id='0' siblings='4'/>\n            <cpu id='5' socket_id='5' core_id='0' siblings='5'/>\n          </cpus>\n        </cell>\n        <cell id='2'>\n          <memory unit='KiB'>2014304</memory>\n          <pages unit='KiB' size='4'>416536</pages>\n          <pages unit='KiB' size='2048'>170</pages>\n          <distances>\n            <sibling id='0' value='20'/>\n            <sibling id='1' value='20'/>\n            <sibling id='2' value='10'/>\n          </distances>\n          <cpus num='2'>\n            <cpu id='6' socket_id='6' core_id='0' siblings='6'/>\n            <cpu id='7' socket_id='7' core_id='0' siblings='7'/>\n          </cpus>\n        </cell>\n      </cells>\n    </topology>\n    <secmodel>\n      <model>selinux</model>\n      <doi>0</doi>\n      <baselabel type='kvm'>system_u:system_r:svirt_t:s0</baselabel>\n      <baselabel type='qemu'>system_u:system_r:svirt_tcg_t:s0</baselabel>\n    </secmodel>\n  </host>\n\n  <guest>\n    <os_type>hvm</os_type>\n    <arch name='i686'>\n      <wordsize>32</wordsize>\n      <emulator>/usr/bin/qemu-system-i386</emulator>\n      <machine canonical='pc-i440fx-2.2' maxCpus='255'>pc</machine>\n      <machine maxCpus='255'>pc-0.12</machine>\n      <machine maxCpus='255'>pc-1.3</machine>\n      <machine maxCpus='255'>pc-q35-1.6</machine>\n      <machine maxCpus='255'>pc-q35-1.5</machine>\n      <machine maxCpus='255'>pc-i440fx-1.6</machine>\n      <machine canonical='pc-q35-2.2' maxCpus='255'>q35</machine>\n      <machine maxCpus='1'>xenpv</machine>\n      <machine maxCpus='255'>pc-i440fx-1.7</machine>\n      <machine maxCpus='255'>pc-q35-2.1</machine>\n      <machine maxCpus='255'>pc-0.11</machine>\n      <machine maxCpus='255'>pc-0.10</machine>\n      <machine maxCpus='255'>pc-1.2</machine>\n      <machine maxCpus='1'>isapc</machine>\n      <machine maxCpus='255'>pc-q35-1.4</machine>\n      <machine maxCpus='128'>xenfv</machine>\n      <machine maxCpus='255'>pc-0.15</machine>\n      <machine maxCpus='255'>pc-i440fx-1.5</machine>\n      <machine maxCpus='255'>pc-0.14</machine>\n      <machine maxCpus='255'>pc-q35-2.0</machine>\n      <machine maxCpus='255'>pc-i440fx-1.4</machine>\n      <machine maxCpus='255'>pc-1.1</machine>\n      <machine maxCpus='255'>pc-q35-1.7</machine>\n      <machine maxCpus='255'>pc-i440fx-2.1</machine>\n      <machine maxCpus='255'>pc-1.0</machine>\n      <machine maxCpus='255'>pc-i440fx-2.0</machine>\n      <machine maxCpus='255'>pc-0.13</machine>\n      <domain type='qemu'>\n      </domain>\n      <domain type='kvm'>\n        <emulator>/usr/bin/qemu-kvm</emulator>\n        <machine canonical='pc-i440fx-2.2' maxCpus='255'>pc</machine>\n        <machine maxCpus='255'>pc-1.3</machine>\n        <machine maxCpus='255'>pc-0.12</machine>\n        <machine maxCpus='255'>pc-q35-1.6</machine>\n        <machine maxCpus='255'>pc-q35-1.5</machine>\n        <machine maxCpus='255'>pc-i440fx-1.6</machine>\n        <machine canonical='pc-q35-2.2' maxCpus='255'>q35</machine>\n        <machine maxCpus='255'>pc-i440fx-1.7</machine>\n        <machine maxCpus='1'>xenpv</machine>\n        <machine maxCpus='255'>pc-q35-2.1</machine>\n        <machine maxCpus='255'>pc-0.11</machine>\n        <machine maxCpus='255'>pc-0.10</machine>\n        <machine maxCpus='255'>pc-1.2</machine>\n        <machine maxCpus='1'>isapc</machine>\n        <machine maxCpus='255'>pc-q35-1.4</machine>\n        <machine maxCpus='128'>xenfv</machine>\n        <machine maxCpus='255'>pc-0.15</machine>\n        <machine maxCpus='255'>pc-i440fx-1.5</machine>\n        <machine maxCpus='255'>pc-i440fx-1.4</machine>\n        <machine maxCpus='255'>pc-q35-2.0</machine>\n        <machine maxCpus='255'>pc-0.14</machine>\n        <machine maxCpus='255'>pc-1.1</machine>\n        <machine maxCpus='255'>pc-q35-1.7</machine>\n        <machine maxCpus='255'>pc-i440fx-2.1</machine>\n        <machine maxCpus='255'>pc-1.0</machine>\n        <machine maxCpus='255'>pc-i440fx-2.0</machine>\n        <machine maxCpus='255'>pc-0.13</machine>\n      </domain>\n    </arch>\n    <features>\n      <cpuselection/>\n      <deviceboot/>\n      <disksnapshot default='on' toggle='no'/>\n      <acpi default='on' toggle='yes'/>\n      <apic default='on' toggle='no'/>\n      <pae/>\n      <nonpae/>\n    </features>\n  </guest>\n\n  <guest>\n    <os_type>hvm</os_type>\n    <arch name='x86_64'>\n      <wordsize>64</wordsize>\n      <emulator>/usr/bin/qemu-system-x86_64</emulator>\n      <machine canonical='pc-i440fx-2.2' maxCpus='255'>pc</machine>\n      <machine maxCpus='255'>pc-1.3</machine>\n      <machine maxCpus='255'>pc-0.12</machine>\n      <machine maxCpus='255'>pc-q35-1.6</machine>\n      <machine maxCpus='255'>pc-q35-1.5</machine>\n      <machine maxCpus='255'>pc-i440fx-1.6</machine>\n      <machine canonical='pc-q35-2.2' maxCpus='255'>q35</machine>\n      <machine maxCpus='255'>pc-i440fx-1.7</machine>\n      <machine maxCpus='1'>xenpv</machine>\n      <machine maxCpus='255'>pc-q35-2.1</machine>\n      <machine maxCpus='255'>pc-0.11</machine>\n      <machine maxCpus='255'>pc-0.10</machine>\n      <machine maxCpus='255'>pc-1.2</machine>\n      <machine maxCpus='1'>isapc</machine>\n      <machine maxCpus='255'>pc-q35-1.4</machine>\n      <machine maxCpus='128'>xenfv</machine>\n      <machine maxCpus='255'>pc-0.15</machine>\n      <machine maxCpus='255'>pc-i440fx-1.5</machine>\n      <machine maxCpus='255'>pc-i440fx-1.4</machine>\n      <machine maxCpus='255'>pc-q35-2.0</machine>\n      <machine maxCpus='255'>pc-0.14</machine>\n      <machine maxCpus='255'>pc-1.1</machine>\n      <machine maxCpus='255'>pc-q35-1.7</machine>\n      <machine maxCpus='255'>pc-i440fx-2.1</machine>\n      <machine maxCpus='255'>pc-1.0</machine>\n      <machine maxCpus='255'>pc-i440fx-2.0</machine>\n      <machine maxCpus='255'>pc-0.13</machine>\n      <domain type='qemu'>\n      </domain>\n      <domain type='kvm'>\n        <emulator>/usr/bin/qemu-kvm</emulator>\n        <machine canonical='pc-i440fx-2.2' maxCpus='255'>pc</machine>\n        <machine maxCpus='255'>pc-1.3</machine>\n        <machine maxCpus='255'>pc-0.12</machine>\n        <machine maxCpus='255'>pc-q35-1.6</machine>\n        <machine maxCpus='255'>pc-q35-1.5</machine>\n        <machine maxCpus='255'>pc-i440fx-1.6</machine>\n        <machine canonical='pc-q35-2.2' maxCpus='255'>q35</machine>\n        <machine maxCpus='255'>pc-i440fx-1.7</machine>\n        <machine maxCpus='1'>xenpv</machine>\n        <machine maxCpus='255'>pc-q35-2.1</machine>\n        <machine maxCpus='255'>pc-0.11</machine>\n        <machine maxCpus='255'>pc-0.10</machine>\n        <machine maxCpus='255'>pc-1.2</machine>\n        <machine maxCpus='1'>isapc</machine>\n        <machine maxCpus='255'>pc-q35-1.4</machine>\n        <machine maxCpus='128'>xenfv</machine>\n        <machine maxCpus='255'>pc-0.15</machine>\n        <machine maxCpus='255'>pc-i440fx-1.5</machine>\n        <machine maxCpus='255'>pc-i440fx-1.4</machine>\n        <machine maxCpus='255'>pc-q35-2.0</machine>\n        <machine maxCpus='255'>pc-0.14</machine>\n        <machine maxCpus='255'>pc-1.1</machine>\n        <machine maxCpus='255'>pc-q35-1.7</machine>\n        <machine maxCpus='255'>pc-i440fx-2.1</machine>\n        <machine maxCpus='255'>pc-1.0</machine>\n        <machine maxCpus='255'>pc-i440fx-2.0</machine>\n        <machine maxCpus='255'>pc-0.13</machine>\n      </domain>\n    </arch>\n    <features>\n      <cpuselection/>\n      <deviceboot/>\n      <disksnapshot default='on' toggle='no'/>\n      <acpi default='on' toggle='yes'/>\n      <apic default='on' toggle='no'/>\n    </features>\n  </guest>\n\n</capabilities>\n-----", 
            "date_created": "2014-12-11 20:05:04.557897+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "We have a bug reported for something still in WIP ?", 
            "date_created": "2014-12-12 08:10:09.174824+00:00", 
            "author": "https://api.launchpad.net/1.0/~sahid-ferdjaoui"
        }, 
        {
            "content": "Indeed, it is not appropriate to post bug reports for code which is not even merged yet. Put your feedback in gerrit if you have found problems with the proposed code.\n", 
            "date_created": "2014-12-12 09:27:36.748568+00:00", 
            "author": "https://api.launchpad.net/1.0/~berrange"
        }, 
        {
            "content": "Actually, it did briefly cross my mind that I was posting a bug for which that's WIP, and still I ended up posting it, maybe thinking just to track it. But I could rather post this info on the review.", 
            "date_created": "2014-12-12 10:05:23.411726+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": " libvirt developers suggested to file a libvirt bug, as it can be handled there\n\n    https://bugzilla.redhat.com/show_bug.cgi?id=1173507 -- \n    Huge pages: \"libvirtError: internal error: Unable to find any usable hugetlbfs mount for 4 KiB\"", 
            "date_created": "2014-12-12 10:57:50.681991+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }
    ]
}