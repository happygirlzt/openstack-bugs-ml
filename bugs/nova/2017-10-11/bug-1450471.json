{
    "status": "Expired", 
    "last_updated": "2015-10-19 04:17:26.271553+00:00", 
    "description": "Kilo RC from Ubuntu Cloudarchive for trusty. Patches https://review.openstack.org/174307 and https://review.openstack.org/174059 are applied manually without which live-migration fails due to parameter changes.\n\nKVM, libvirt, 4 compute hosts, a 9 host ceph cluster for shared storage. Newly created instances work fine on all computes. When initiating live-migrate either from Horizon or from CLI, status switches back from MIGRATING very fast but VM stays on original host. Message\nMigrationError: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\nis found in log of compute host.\n\nBlock-Migration option is explicitly not set, setting it for a try causes a different error message earlier.\n\nPkg-Versions:\nii  nova-common                         1:2015.1~rc1-0ubuntu1~cloud0          all          OpenStack Compute - common files\nii  nova-compute                        1:2015.1~rc1-0ubuntu1~cloud0          all          OpenStack Compute - compute node base\nii  nova-compute-kvm                    1:2015.1~rc1-0ubuntu1~cloud0          all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                1:2015.1~rc1-0ubuntu1~cloud0          all          OpenStack Compute - compute node libvirt support\n\n\nFull log:\n\n\n2015-04-30 13:42:46.985 17619 ERROR nova.compute.manager [req-ecbf0446-079a-45db-9000-539f06a9e9e4 382e4cb7197e43bf9b11fc1c6fa9d692 9984ba4fc07c475e84a109967a897e4e - - -] [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] Pre live migration failed at compute04\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] Traceback (most recent call last):\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5217, in live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     block_migration, disk, dest, migrate_data)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/rpcapi.py\", line 621, in pre_live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     disk=disk, migrate_data=migrate_data)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     retry=self.retry)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     timeout=timeout, retry=retry)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 350, in send\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     retry=retry)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 341, in _send\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     raise result\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] MigrationError_Remote: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] Traceback (most recent call last):\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     executor_callback))\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     executor_callback)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     result = func(ctxt, **new_args)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6676, in pre_live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     disk, migrate_data=None)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 440, in decorated_function\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     payload)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     return f(self, context, *args, **kw)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 352, in decorated_function\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     kwargs['instance'], e, sys.exc_info())\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 340, in decorated_function\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5159, in pre_live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     migrate_data)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5825, in pre_live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     raise exception.MigrationError(reason=msg)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] MigrationError: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:47.124 17619 ERROR oslo_messaging.rpc.dispatcher [req-ecbf0446-079a-45db-9000-539f06a9e9e4 382e4cb7197e43bf9b11fc1c6fa9d692 9984ba4fc07c475e84a109967a897e4e - - -] Exception during message handling: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n    executor_callback))\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n    executor_callback)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n    result = func(ctxt, **new_args)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6676, in pre_live_migration\n    disk, migrate_data=None)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 440, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n    payload)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 352, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 340, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5159, in pre_live_migration\n    migrate_data)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5825, in pre_live_migration\n    raise exception.MigrationError(reason=msg)\n\nMigrationError: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6663, in live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     migrate_data=migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 352, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 340, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5225, in live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     block_migration, migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5217, in live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     block_migration, disk, dest, migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/rpcapi.py\", line 621, in pre_live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     disk=disk, migrate_data=migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 350, in send\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     retry=retry)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 341, in _send\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     raise result\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher MigrationError_Remote: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6676, in pre_live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     disk, migrate_data=None)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 440, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 352, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 340, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5159, in pre_live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5825, in pre_live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     raise exception.MigrationError(reason=msg)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher MigrationError: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher", 
    "tags": [
        "libvirt", 
        "live-migrate"
    ], 
    "importance": "Low", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1450471", 
    "owner": "None", 
    "id": 1450471, 
    "index": 447, 
    "created": "2015-04-30 13:16:59.876811+00:00", 
    "title": "live-migration fails on shared storage with 'Cannot block migrate'", 
    "comments": [
        {
            "content": "Kilo RC from Ubuntu Cloudarchive for trusty. Patches https://review.openstack.org/174307 and https://review.openstack.org/174059 are applied manually without which live-migration fails due to parameter changes.\n\nKVM, libvirt, 4 compute hosts, a 9 host ceph cluster for shared storage. Newly created instances work fine on all computes. When initiating live-migrate either from Horizon or from CLI, status switches back from MIGRATING very fast but VM stays on original host. Message\nMigrationError: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\nis found in log of compute host.\n\nBlock-Migration option is explicitly not set, setting it for a try causes a different error message earlier.\n\nPkg-Versions:\nii  nova-common                         1:2015.1~rc1-0ubuntu1~cloud0          all          OpenStack Compute - common files\nii  nova-compute                        1:2015.1~rc1-0ubuntu1~cloud0          all          OpenStack Compute - compute node base\nii  nova-compute-kvm                    1:2015.1~rc1-0ubuntu1~cloud0          all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                1:2015.1~rc1-0ubuntu1~cloud0          all          OpenStack Compute - compute node libvirt support\n\n\nFull log:\n\n\n2015-04-30 13:42:46.985 17619 ERROR nova.compute.manager [req-ecbf0446-079a-45db-9000-539f06a9e9e4 382e4cb7197e43bf9b11fc1c6fa9d692 9984ba4fc07c475e84a109967a897e4e - - -] [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] Pre live migration failed at compute04\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] Traceback (most recent call last):\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5217, in live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     block_migration, disk, dest, migrate_data)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/rpcapi.py\", line 621, in pre_live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     disk=disk, migrate_data=migrate_data)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     retry=self.retry)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     timeout=timeout, retry=retry)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 350, in send\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     retry=retry)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 341, in _send\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     raise result\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] MigrationError_Remote: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] Traceback (most recent call last):\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     executor_callback))\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     executor_callback)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     result = func(ctxt, **new_args)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6676, in pre_live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     disk, migrate_data=None)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 440, in decorated_function\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     payload)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     return f(self, context, *args, **kw)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 352, in decorated_function\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     kwargs['instance'], e, sys.exc_info())\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 340, in decorated_function\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5159, in pre_live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     migrate_data)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5825, in pre_live_migration\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3]     raise exception.MigrationError(reason=msg)\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] MigrationError: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:46.985 17619 TRACE nova.compute.manager [instance: 53d225ac-1915-4cff-8f15-54b5c66c20a3] \n2015-04-30 13:42:47.124 17619 ERROR oslo_messaging.rpc.dispatcher [req-ecbf0446-079a-45db-9000-539f06a9e9e4 382e4cb7197e43bf9b11fc1c6fa9d692 9984ba4fc07c475e84a109967a897e4e - - -] Exception during message handling: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n    executor_callback))\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n    executor_callback)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n    result = func(ctxt, **new_args)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6676, in pre_live_migration\n    disk, migrate_data=None)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 440, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n    payload)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 352, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 340, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5159, in pre_live_migration\n    migrate_data)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5825, in pre_live_migration\n    raise exception.MigrationError(reason=msg)\n\nMigrationError: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6663, in live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     migrate_data=migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 352, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 340, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5225, in live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     block_migration, migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5217, in live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     block_migration, disk, dest, migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/rpcapi.py\", line 621, in pre_live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     disk=disk, migrate_data=migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 350, in send\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     retry=retry)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 341, in _send\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     raise result\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher MigrationError_Remote: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6676, in pre_live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     disk, migrate_data=None)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 440, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 352, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 340, in decorated_function\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 5159, in pre_live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     migrate_data)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5825, in pre_live_migration\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher     raise exception.MigrationError(reason=msg)\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher MigrationError: Migration error: Cannot block migrate instance 53d225ac-1915-4cff-8f15-54b5c66c20a3 with mapped volumes\n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher \n2015-04-30 13:42:47.124 17619 TRACE oslo_messaging.rpc.dispatcher", 
            "date_created": "2015-04-30 13:16:59.876811+00:00", 
            "author": "https://api.launchpad.net/1.0/~ren6"
        }, 
        {
            "content": "Thanks to help from IRC from mjg I found out that changing the\nis_block_migration at https://github.com/openstack/nova/blob/master/nova/virt/libvirt/driver.py#L5773 to False, the migration proceeds until it throws \nLive Migration failure: Unable to pre-create chardev file '/var/lib/nova/instances/53d225ac-1915-4cff-8f15-54b5c66c20a3/console.log': No such file or directory\n\nThis might be a seperate issue or a configuration issue on my side. In any case this might indicate that the migrate_data object is missing here.", 
            "date_created": "2015-04-30 14:14:29.285221+00:00", 
            "author": "https://api.launchpad.net/1.0/~ren6"
        }, 
        {
            "content": "I've had similar problems. I tried to run the command live-migration with shared instance path and disks. It turned out only after some changes for /usr/lib/python2.7/dist-packages/nova/compute/manager.py --\n\n--- manager.py~ 2015-04-10 12:31:08.000000000 +0300\n+++ manager.py  2015-05-10 16:29:39.000000000 +0300\n@@ -6582,10 +6582,10 @@\n     def change_instance_metadata(self, ctxt, instance, diff):\n         return self.manager.change_instance_metadata(ctxt, instance, diff)\n \n-    def check_can_live_migrate_destination(self, ctxt, instance, destination,\n+    def check_can_live_migrate_destination(self, ctxt, instance, \n                                            block_migration, disk_over_commit):\n         return self.manager.check_can_live_migrate_destination(\n-            ctxt, instance, destination, block_migration, disk_over_commit)\n+            ctxt, instance, block_migration, disk_over_commit)\n \n     def check_can_live_migrate_source(self, ctxt, instance, dest_check_data):\n         return self.manager.check_can_live_migrate_source(ctxt, instance,\n@@ -6656,9 +6656,9 @@\n     def inject_network_info(self, ctxt, instance):\n         return self.manager.inject_network_info(ctxt, instance)\n \n-    def live_migration(self, ctxt, instance, dest, block_migration,\n+    def live_migration(self, ctxt, dest, instance, block_migration,\n                        migrate_data=None):\n-        return self.manager.live_migration(ctxt, instance, dest,\n+        return self.manager.live_migration(ctxt, dest, instance,\n                                            block_migration,\n                                            migrate_data=migrate_data)\n \n@@ -6673,7 +6673,7 @@\n     def pre_live_migration(self, ctxt, instance, block_migration, disk,\n                            migrate_data=None):\n         return self.manager.pre_live_migration(ctxt, instance, block_migration,\n-                                               disk, migrate_data=None)\n+                                               disk, migrate_data=migrate_data)\n \n     def prep_resize(self, ctxt, image, instance, instance_type,\n                     reservations=None, request_spec=None,\n\n", 
            "date_created": "2015-05-10 18:54:44.968411+00:00", 
            "author": "https://api.launchpad.net/1.0/~oll-j"
        }, 
        {
            "content": "I tried the same change as Ren\u00e8 in comment 1 and got the same results:\n\n'Live Migration failure: Unable to pre-create chardev file '/var/lib/nova/instances/53d225ac-1915-4cff-8f15-54b5c66c20a3/console.log': No such file or directory'\n\n\nI was able to get past this by making a similar change in pre_live_migration() in nova/virt/libvirt/driver.py and setting the three variables at the top as follows:\nis_shared_block_storage = True\nis_shared_instance_path = False\nis_block_migration = False\n\nthe is_block_migration appears to be what causes it to bomb out and not allow the migration with a mapped device, and once that was set to False the is_shared_instance_path appears to be what caused the console.log file to not be created, since it expects it to exist thinking it has a shared instance path, which I don't.\n\nClearly this is a workaround that works for me because I only use volume backed instances and the proper fix is better detection of which (if any) storage resources are shared.\n\nHope this is helpful.\n\n", 
            "date_created": "2015-05-15 17:36:33.537194+00:00", 
            "author": "https://api.launchpad.net/1.0/~dozure"
        }, 
        {
            "content": "After testing I can confirm that applying the changes from Oleg Lazo from #2 https://bugs.launchpad.net/nova/+bug/1450471/comments/2 resolved the issue for me. I did not have to additionally change driver.py as detailed in #3. I suspect the big change from Oleg to the previous mentioned patch is the migrate_data=migrate_data fix in pre_live_migration which passes the dict on with the proper variables.\n", 
            "date_created": "2015-05-20 14:20:42.484476+00:00", 
            "author": "https://api.launchpad.net/1.0/~ren6"
        }, 
        {
            "content": "will this get fixed in https://review.openstack.org/#/c/54493/8/nova/compute/manager.py ?", 
            "date_created": "2015-08-19 08:54:00.168085+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2015-10-19 04:17:22.725055+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}