{
    "status": "Invalid", 
    "last_updated": "2016-10-20 13:37:57.643828+00:00", 
    "description": "While compute manager was trying to authenticate with neutronclient, we see the following:\n\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager Traceback (most recent call last):\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager   File \"/usr/lib/python2.7/site-packages/powervc_nova/compute/manager.py\", line 672, in _populate_admin_context\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager     nclient.authenticate()\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager   File \"/usr/lib/python2.7/site-packages/neutronclient/client.py\", line 231, in authenticate\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager     self._authenticate_keystone()\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager   File \"/usr/lib/python2.7/site-packages/neutronclient/client.py\", line 209, in _authenticate_keystone\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager     allow_redirects=True)\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager   File \"/usr/lib/python2.7/site-packages/neutronclient/client.py\", line 113, in _cs_request\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager     raise exceptions.ConnectionFailed(reason=e)\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager ConnectionFailed: Connection to neutron failed: 'HTTPSConnectionPool' object has no attribute 'insecure'\n\nSetting a pdb breakpoint and stepping into the code, I see that the requests library is getting a connection object from a pool.  The interesting thing is that the connection object is actually from glanceclient.common.https.HTTPSConnectionPool.  It seems odd to me that neutronclient is using a connection object from glanceclient pool, but I do not know this requests code.  Here is the stack just before failure:\n\n  /usr/lib/python2.7/site-packages/neutronclient/client.py(234)authenticate()\n-> self._authenticate_keystone()\n  /usr/lib/python2.7/site-packages/neutronclient/client.py(212)_authenticate_keystone()\n-> allow_redirects=True)\n  /usr/lib/python2.7/site-packages/neutronclient/client.py(106)_cs_request()\n-> resp, body = self.request(*args, **kargs)\n  /usr/lib/python2.7/site-packages/neutronclient/client.py(151)request()\n-> **kwargs)\n  /usr/lib/python2.7/site-packages/requests/api.py(44)request()\n-> return session.request(method=method, url=url, **kwargs)\n  /usr/lib/python2.7/site-packages/requests/sessions.py(335)request()\n-> resp = self.send(prep, **send_kwargs)\n  /usr/lib/python2.7/site-packages/requests/sessions.py(438)send()\n-> r = adapter.send(request, **kwargs)\n  /usr/lib/python2.7/site-packages/requests/adapters.py(292)send()\n-> timeout=timeout\n  /usr/lib/python2.7/site-packages/urllib3/connectionpool.py(454)urlopen()\n-> conn = self._get_conn(timeout=pool_timeout)\n  /usr/lib/python2.7/site-packages/urllib3/connectionpool.py(272)_get_conn()\n-> return conn or self._new_conn()\n> /usr/lib/python2.7/site-packages/glanceclient/common/https.py(100)_new_conn()\n-> return VerifiedHTTPSConnection(host=self.host,\n\nThe code about to run there is this:\n\nclass HTTPSConnectionPool(connectionpool.HTTPSConnectionPool):\n    \"\"\"\n    HTTPSConnectionPool will be instantiated when a new\n    connection is requested to the HTTPSAdapter.This\n    implementation overwrites the _new_conn method and\n    returns an instances of glanceclient's VerifiedHTTPSConnection\n    which handles no compression.\n\n    ssl_compression is hard-coded to False because this will\n    be used just when the user sets --no-ssl-compression.\n    \"\"\"\n\n    scheme = 'https'\n\n    def _new_conn(self):\n        self.num_connections += 1\n        return VerifiedHTTPSConnection(host=self.host,\n                                       port=self.port,\n                                       key_file=self.key_file,\n                                       cert_file=self.cert_file,\n                                       cacert=self.ca_certs,\n                                       insecure=self.insecure,\n                                       ssl_compression=False)\n\nNote the self.insecure, which does not exist here.  I see the following fairly recent change in the glanceclient.common.https code that added this:\n\nhttps://github.com/openstack/python-glanceclient/commit/dbb242b776908ca50ed8557ebfe7cfcd879366c8#diff-524c1a0b226fa8e5fb4df6ff5574e153R104\n\nI do not understand this whole flow and if self.insecure was supposed to have been initialized somewhere else, but it's obviously not.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 48, 
    "link": "https://bugs.launchpad.net/nova/+bug/1362766", 
    "owner": "None", 
    "id": 1362766, 
    "index": 5123, 
    "created": "2014-08-28 18:51:20.868256+00:00", 
    "title": "ConnectionFailed: Connection to XXXXXX failed: 'HTTPSConnectionPool' object has no attribute 'insecure'", 
    "comments": [
        {
            "content": "While compute manager was trying to authenticate with neutronclient, we see the following:\n\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager Traceback (most recent call last):\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager   File \"/usr/lib/python2.7/site-packages/powervc_nova/compute/manager.py\", line 672, in _populate_admin_context\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager     nclient.authenticate()\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager   File \"/usr/lib/python2.7/site-packages/neutronclient/client.py\", line 231, in authenticate\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager     self._authenticate_keystone()\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager   File \"/usr/lib/python2.7/site-packages/neutronclient/client.py\", line 209, in _authenticate_keystone\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager     allow_redirects=True)\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager   File \"/usr/lib/python2.7/site-packages/neutronclient/client.py\", line 113, in _cs_request\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager     raise exceptions.ConnectionFailed(reason=e)\n2014-08-28 05:03:33.052 29982 TRACE powervc_nova.compute.manager ConnectionFailed: Connection to neutron failed: 'HTTPSConnectionPool' object has no attribute 'insecure'\n\nSetting a pdb breakpoint and stepping into the code, I see that the requests library is getting a connection object from a pool.  The interesting thing is that the connection object is actually from glanceclient.common.https.HTTPSConnectionPool.  It seems odd to me that neutronclient is using a connection object from glanceclient pool, but I do not know this requests code.  Here is the stack just before failure:\n\n  /usr/lib/python2.7/site-packages/neutronclient/client.py(234)authenticate()\n-> self._authenticate_keystone()\n  /usr/lib/python2.7/site-packages/neutronclient/client.py(212)_authenticate_keystone()\n-> allow_redirects=True)\n  /usr/lib/python2.7/site-packages/neutronclient/client.py(106)_cs_request()\n-> resp, body = self.request(*args, **kargs)\n  /usr/lib/python2.7/site-packages/neutronclient/client.py(151)request()\n-> **kwargs)\n  /usr/lib/python2.7/site-packages/requests/api.py(44)request()\n-> return session.request(method=method, url=url, **kwargs)\n  /usr/lib/python2.7/site-packages/requests/sessions.py(335)request()\n-> resp = self.send(prep, **send_kwargs)\n  /usr/lib/python2.7/site-packages/requests/sessions.py(438)send()\n-> r = adapter.send(request, **kwargs)\n  /usr/lib/python2.7/site-packages/requests/adapters.py(292)send()\n-> timeout=timeout\n  /usr/lib/python2.7/site-packages/urllib3/connectionpool.py(454)urlopen()\n-> conn = self._get_conn(timeout=pool_timeout)\n  /usr/lib/python2.7/site-packages/urllib3/connectionpool.py(272)_get_conn()\n-> return conn or self._new_conn()\n> /usr/lib/python2.7/site-packages/glanceclient/common/https.py(100)_new_conn()\n-> return VerifiedHTTPSConnection(host=self.host,\n\nThe code about to run there is this:\n\nclass HTTPSConnectionPool(connectionpool.HTTPSConnectionPool):\n    \"\"\"\n    HTTPSConnectionPool will be instantiated when a new\n    connection is requested to the HTTPSAdapter.This\n    implementation overwrites the _new_conn method and\n    returns an instances of glanceclient's VerifiedHTTPSConnection\n    which handles no compression.\n\n    ssl_compression is hard-coded to False because this will\n    be used just when the user sets --no-ssl-compression.\n    \"\"\"\n\n    scheme = 'https'\n\n    def _new_conn(self):\n        self.num_connections += 1\n        return VerifiedHTTPSConnection(host=self.host,\n                                       port=self.port,\n                                       key_file=self.key_file,\n                                       cert_file=self.cert_file,\n                                       cacert=self.ca_certs,\n                                       insecure=self.insecure,\n                                       ssl_compression=False)\n\nNote the self.insecure, which does not exist here.  I see the following fairly recent change in the glanceclient.common.https code that added this:\n\nhttps://github.com/openstack/python-glanceclient/commit/dbb242b776908ca50ed8557ebfe7cfcd879366c8#diff-524c1a0b226fa8e5fb4df6ff5574e153R104\n\nI do not understand this whole flow and if self.insecure was supposed to have been initialized somewhere else, but it's obviously not.", 
            "date_created": "2014-08-28 18:51:20.868256+00:00", 
            "author": "https://api.launchpad.net/1.0/~wpward"
        }, 
        {
            "content": "Not sure how neutron client depends on glance client.\n\nThere is no such dependency in upstream python-neutronclient.\n\nCould you please clarify?", 
            "date_created": "2014-09-07 08:42:04.683459+00:00", 
            "author": "https://api.launchpad.net/1.0/~enikanorov"
        }, 
        {
            "content": "I don't know how/why there would be that interdependence either.  It's been a while, but I think I was just seeing that the neutron client was getting a connection object from the pool (via requests library), and apparently the object it got was actually one created by glance.  Is this just one big pool that ALL clients throw their connection objects into when done to be reused by anyone?  Or is it wrong that neutronclient somehow got a hold of a glanceclient connection object?\n\nI will see if I can still reproduce this.  We've since rebased on Juno and perhaps it has changed.", 
            "date_created": "2014-09-25 13:46:06.613600+00:00", 
            "author": "https://api.launchpad.net/1.0/~wpward"
        }, 
        {
            "content": "I am seeing exactly the same issue running nova trunk:\n\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/nova/network/security_group/neutron_driver.py\", line 305, in _get_ports_from_server_list\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     ports.extend(neutron.list_ports(**search_opts).get('ports'))\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\", line 98, in with_params\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     ret = self.function(instance, *args, **kwargs)\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\", line 312, in list_ports\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     **_params)\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\", line 1335, in list\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     for r in self._pagination(collection, path, **params):\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\", line 1348, in _pagination\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     res = self.get(path, params=params)\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\", line 1321, in get\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     headers=headers, params=params)\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\", line 1298, in retry_request\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     headers=headers, params=params)\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\", line 1241, in do_request\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     content_type=self.content_type())\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/client.py\", line 181, in do_request\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     **kwargs)\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack   File \"/opt/stack/deploy/nova/06ce4ba4-8a2a-461a-90e9-f2021d198f7e/local/lib/python2.7/site-packages/neutronclient/client.py\", line 134, in _cs_request\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack     raise exceptions.ConnectionFailed(reason=e)\n2014-09-26 19:54:47.605 636477 TRACE nova.api.openstack ConnectionFailed: Connection to neutron failed: 'HTTPSConnectionPool' object has no attribute 'insecure'\n", 
            "date_created": "2014-09-26 19:58:14.970358+00:00", 
            "author": "https://api.launchpad.net/1.0/~xchenum"
        }, 
        {
            "content": "This is not a but in neutron client but in the glance client.\nThere is a bug opened against the glance client for this issue: https://bugs.launchpad.net/python-glanceclient/+bug/1347150\nRegards\n", 
            "date_created": "2014-10-14 09:28:05.676914+00:00", 
            "author": "https://api.launchpad.net/1.0/~andrea-rosa-m"
        }, 
        {
            "content": "https://review.openstack.org/#/c/110574/9", 
            "date_created": "2014-11-05 18:08:23.187412+00:00", 
            "author": "https://api.launchpad.net/1.0/~nikhil-komawar"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/110574\nCommitted: https://git.openstack.org/cgit/openstack/python-glanceclient/commit/?id=052904ba32f6e6075b023065bff684042c640c6a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 052904ba32f6e6075b023065bff684042c640c6a\nAuthor: Flavio Percoco <email address hidden>\nDate:   Wed Jul 30 10:57:46 2014 +0200\n\n    Don't replace the https handler in the poolmanager\n    \n    In order to keep the support for `--ssl-nocompression` it was decided to\n    overwrite the https HTTPAdapter in `requests` poolmanager. Although this\n    seemed to work correctly, it was causing some issues when using\n    glanceclient from other services that rely on requests and that were\n    also configured to use TLS.\n    \n    THis patch changes implements a different strategy by using\n    `glance+https` as the scheme to use when `no-compression` is requested.\n    \n    Closes-bug: #1350251\n    Closes-bug: #1347150\n    Closes-bug: #1362766\n    \n    Change-Id: Ib25237ba821ee20a561a163b79402d1375ebed0b\n", 
            "date_created": "2014-11-05 19:06:21.294180+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Running Juno I'm getting the error below in nova-api.log after enabling SSL for neutron server. Set nova.conf [neutron] section variables url= to https, and tried setting ca_certificates_file and api_insecure, but those don't seem to make a difference.\n\nSeems like this bug hasn't been fixed or am I wrong?\n\n\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack Traceback (most recent call last):\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 124, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     return req.get_response(self.application)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     application, catch_exc_info=False)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 661, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     return self._app(env, start_response)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 910, in __call__\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     content_type, body, accept)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 975, in _process_stack\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1059, in dispatch\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     return method(req=request, **action_args)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/floating_ips.py\", line 135, in index\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     floating_ips = self.network_api.get_floating_ips_by_project(context)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 1099, in get_floating_ips_by_project\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     fips = client.list_floatingips(tenant_id=project_id)['floatingips']\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 99, in with_params\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     ret = self.function(instance, *args, **kwargs)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 444, in list_floatingips\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     **_params)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 1335, in list\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     for r in self._pagination(collection, path, **params):\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 1348, in _pagination\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     res = self.get(path, params=params)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 1321, in get\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     headers=headers, params=params)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 1298, in retry_request\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     headers=headers, params=params)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 1241, in do_request\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     content_type=self.content_type())\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/client.py\", line 180, in do_request\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     **kwargs)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/neutronclient/client.py\", line 133, in _cs_request\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack     raise exceptions.ConnectionFailed(reason=e)\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack ConnectionFailed: Connection to neutron failed: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-16 13:42:09.381 32053 TRACE nova.api.openstack \n\n", 
            "date_created": "2015-03-16 12:57:29.724368+00:00", 
            "author": "https://api.launchpad.net/1.0/~tom-verdaat"
        }, 
        {
            "content": "I'm getting this in nova-api too, we don't use neutron.\n\nI get it when I do a nova list or nova show. Restarting nova-api fixed it for a while but then it comes back again.\n\n==> /var/log/nova/nova-api.log <==\n2015-03-27 13:56:06.649 10962 WARNING keystonemiddleware.auth_token [-] Retrying on HTTP connection exception: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-27 13:56:07.153 10962 WARNING keystonemiddleware.auth_token [-] Retrying on HTTP connection exception: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-27 13:56:08.156 10962 WARNING keystonemiddleware.auth_token [-] Retrying on HTTP connection exception: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-27 13:56:10.159 10962 ERROR keystonemiddleware.auth_token [-] HTTP connection exception: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-27 13:56:10.161 10962 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-03-27 13:56:10.162 10962 INFO nova.osapi_compute.wsgi.server [-] 128.250.116.173,172.26.9.144 \"GET /v1.1/0bdf024c921848c4b74d9e69af9edf08/servers/detail HTTP/1.1\" status: 401 len: 282 time: 3.5197592\n", 
            "date_created": "2015-03-27 02:56:25.671982+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "please run \"pip freeze\" and send us the output for the different pythonclients and keystone components as well.", 
            "date_created": "2015-03-27 20:34:29.635730+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Hi,\n\nI'm not using pip, this is using the ubuntu cloud archive juno packages", 
            "date_created": "2015-03-30 04:32:15.794713+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Hey Sam,\n\ncan you try patching keystonemiddleware/auth_token.py to print where exactly the exception is thrown from? LOG.exception('got an exception') should do the trick\n\nthanks,\ndims", 
            "date_created": "2015-03-30 11:33:02.577207+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "OK I turned on keystonemiddleware DEBUG and get the below stack trace, I also ran it through PDB and it fails when it's getting the revocation list. It works the first time and then requests work, when it goes to get it again it the consistently fails from then onwards.\n\nKeystone is definitely working and responding to requests. The weird thing is that restarting nova-api fixes it and will work for several requests before going back to the broken state.\n\n \n\n\n2015-03-31 10:01:41.042 30520 WARNING keystonemiddleware.auth_token [-] Retrying on HTTP connection exception: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-31 10:01:41.545 30520 WARNING keystonemiddleware.auth_token [-] Retrying on HTTP connection exception: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-31 10:01:42.547 30520 WARNING keystonemiddleware.auth_token [-] Retrying on HTTP connection exception: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-31 10:01:44.549 30520 ERROR keystonemiddleware.auth_token [-] HTTP connection exception: 'HTTPSConnectionPool' object has no attribute 'insecure'\n2015-03-31 10:01:44.550 30520 DEBUG keystonemiddleware.auth_token [-] Token validation failure. _validate_user_token /usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py:922\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token Traceback (most recent call last):\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 913, in _validate_user_token\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token     verified = self._verify_signed_token(user_token, token_ids)\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 1185, in _verify_signed_token\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token     if self._is_signed_token_revoked(token_ids):\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 1137, in _is_signed_token_revoked\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token     if self._is_token_id_in_revoked_list(token_id):\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 1144, in _is_token_id_in_revoked_list\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token     revocation_list = self._token_revocation_list\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 1251, in _token_revocation_list\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token     self._token_revocation_list = self._fetch_revocation_list()\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 1286, in _fetch_revocation_list\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token     additional_headers=headers)\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 828, in _json_request\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token     response = self._http_request(method, path, **kwargs)\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token   File \"/usr/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 795, in _http_request\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token     raise NetworkError('Unable to communicate with keystone')\n2015-03-31 10:01:44.550 30520 TRACE keystonemiddleware.auth_token NetworkError: Unable to communicate with keystone\n\n\n\n", 
            "date_created": "2015-03-30 23:45:13.333421+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "I debugged it further and looks like something in python-requests, juno cloud archive has 2.3.0-1~cloud0", 
            "date_created": "2015-03-30 23:52:14.953992+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Also can confirm changing my nova.conf so that it connects to keystone over http as opposed to https fixes the issue", 
            "date_created": "2015-03-31 00:34:13.061919+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Changing back to new as details given", 
            "date_created": "2015-03-31 00:34:59.145555+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "pip freeze will return distro installed packages as well, please provide that output.", 
            "date_created": "2015-03-31 11:51:39.799815+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "I think this is probably still in glanceclient, so putting to incomplete in Nova until the pip results are in.", 
            "date_created": "2015-03-31 11:53:01.587560+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Ah OK didn't realise this, here are the results. I'll try patching glanceclient to see if that fixes it.\n\n\n\nBabel==1.3\nCheetah==2.4.4\nFormEncode==1.2.6\nJinja2==2.7.2\nM2Crypto==0.21.1\nMako==0.9.1\nMarkupSafe==0.18\nMySQL-python==1.2.3\nPAM==0.4.2\nPaste==1.7.5.1\nPasteDeploy==1.5.2\nPyYAML==3.10\nRoutes==2.0\nSQLAlchemy==0.9.7\nTempita==0.5.2\nTwisted-Core==13.2.0\nTwisted-Names==13.2.0\nTwisted-Web==13.2.0\nWSME==0.6\nWebOb==1.3.1\nalembic==0.6.5\namqp==1.4.5\namqplib==1.0.2\nanyjson==0.3.3\napt-xapian-index==0.45\nargparse==1.2.1\nboto==2.20.1\nbzr-etckeeper==0.0.0\nchardet==2.0.1\ncinder==1-2014.2.2-a22-g7b415fa-trusty-1\ncliff==1.7.0\ncloud-init==0.7.5\ncmd2==0.6.7\ncolorama==0.2.5\nconfigobj==4.7.2\ndecorator==3.4.0\ndogpile.cache==0.5.4\ndogpile.core==0.4.1\necdsa==0.11\neventlet==0.15.2\nfutures==2.1.6\nglance==2014.2.2\nglance-store==0.1.8\ngreenlet==0.4.2\nhtml5lib==0.999\nhttplib2==0.8\nipaddr==2.1.10\niso8601==0.1.10\njsonpatch==1.3\njsonpointer==1.0\njsonschema==2.3.0\nkeystone==1-2014.2.2-a17-gb06a63a-trusty-4\nkeystonemiddleware==1.0.0\nkombu==3.0.7\nldappool==1.0\nlibrabbitmq==1.0.3\nlockfile==0.8\nlxml==3.3.3\nmock==1.0.1\nnetaddr==0.7.12\nnetworkx==1.8.1\nnova==2014.2.1-a74-g9256373-trusty\noauth==1.0.1\noauthlib==0.6.1\noslo.config==1.4.0.0\noslo.db==1.0.0\noslo.i18n==1.0.0\noslo.messaging==1.5.1-a1-g06c67fb-trusty-1\noslo.middleware==0.2.0\noslo.rootwrap==1.3.0\noslo.serialization==1.0.0\noslo.utils==1.0.0\noslo.vmware==0.6.0\nosprofiler==0.3.0\nparamiko==1.15.1\npasslib==1.5.3\npbr==0.10.0\nposix-ipc==0.9.8\nprettytable==0.7.2\npyOpenSSL==0.13\npyasn1==0.1.7\npycadf==0.6.0\npycrypto==2.6.1\npycurl==7.19.3\npydns==2.3.6\npyparsing==2.0.1\npyserial==2.6\npython-apt==0.9.3.5ubuntu1\npython-barbicanclient==2.2.1\npython-cinderclient==1.1.0\npython-debian==0.1.21-nmu2ubuntu2\npython-glanceclient==0.14.0\npython-keystoneclient==0.10.1\npython-ldap==2.4.10\npython-memcached==1.53\npython-neutronclient==2.3.8\npython-novaclient==2.19.0\npython-swiftclient==2.3.0\npytz==2012c\nrepoze.lru==0.6\nrequests==2.3.0\nretrying==1.2.3\nrfc3986==0.2.0\nsimplegeneric==0.8.1\nsimplejson==3.3.1\nsix==1.7.3\nsqlalchemy-migrate==0.9.1\nssh-import-id==3.21\nstevedore==1.1.0\nsuds==0.4.1\ntaskflow==0.3.21\nurllib3==1.7.1\nwarlock==1.1.0\nwsgiref==0.1.2\nzope.interface==4.0.5\n", 
            "date_created": "2015-03-31 23:18:24.834817+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "OK I can confirm this is a glanceclient issue, sorry for the noise nova.\n\nTo fix I installed the glanceclient package available in vivid. 1:0.15.0-0ubuntu1 \n\nThis affects Juno Ubuntu installs", 
            "date_created": "2015-03-31 23:29:25.936791+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Fixed in 0.14.2", 
            "date_created": "2015-03-31 23:30:08.775890+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "This bug is in the version of glance client in the juno cloud archive.", 
            "date_created": "2015-03-31 23:31:13.265165+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Sam Morrison, how is a stack trace that seems entirely located in keystonemiddleware a bug in glanceclient?", 
            "date_created": "2015-04-02 03:18:48.327105+00:00", 
            "author": "https://api.launchpad.net/1.0/~icordasc"
        }, 
        {
            "content": "I'm not entirely sure, but glance client is doing something with the underlying connection pool classes that keystonemiddleware and nova also use I think.\n\nI don't understand it myself but I do know that by using a newer glanceclient the problem goes away.\n\nI'm hoping someone who knows more than me will chime in :-)\n\n", 
            "date_created": "2015-04-02 05:22:47.299307+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Status changed to 'Confirmed' because the bug affects multiple users.", 
            "date_created": "2015-04-07 14:39:51.611561+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "looks like this has been resolved for a while, and the fix was in glanceclient, marking keystonemiddleware as invalid, please comment if anyone feels differently. ", 
            "date_created": "2016-01-12 07:53:42.721089+00:00", 
            "author": "https://api.launchpad.net/1.0/~stevemar"
        }, 
        {
            "content": "This should be fixed in Ubuntu now.", 
            "date_created": "2016-10-20 13:37:50.848887+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "This should be fixed in Ubuntu now.", 
            "date_created": "2016-10-20 13:37:56.309122+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }
    ]
}