{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:18:59.580588+00:00", 
    "description": "When I try to boot an instance with the boot image specified as BDM the API accepts the request but the instance ends up in ERROR state due to an exception in the nova-compute. Furter investigation shows that image to local mapping is not supported in the --block-device parameter at all but the API does not validate and reject this kind of requests.\n\n\nstack@stack:~/devstack$ nova flavor-create install-test 100 1024 0 1\n+-----+--------------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID  | Name         | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+-----+--------------+-----------+------+-----------+------+-------+-------------+-----------+\n| 100 | install-test | 1024      | 0    | 0         |      | 1     | 1.0         | True      |\n+-----+--------------+-----------+------+-----------+------+-------+-------------+-----------+\nstack@stack:~/devstack$ glance image-create --file ../mini.iso  --name ubuntu-mini.iso --is-public=True --disk-format iso --container-format bare+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | a2502844750ecb6477d8fb4ff6b9aaf8     |\n| container_format | bare                                 |\n| created_at       | 2014-10-06T13:45:48                  |\n| deleted          | False                                |\n| deleted_at       | None                                 |\n| disk_format      | iso                                  |\n| id               | e3bb2e81-e5ed-43a0-9cc5-62ff9de97c37 |\n| is_public        | True                                 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | ubuntu-mini.iso                      |\n| owner            | 8acb24eaeaee44f481aa7c73f179a4da     |\n| protected        | False                                |\n| size             | 32505856                             |\n| status           | active                               |\n| updated_at       | 2014-10-06T13:45:48                  |\n| virtual_size     | None                                 |\n+------------------+--------------------------------------+\nstack@stack:~/devstack$ nova boot --flavor 100 --block-device source=image,id=e3bb2e81-e5ed-43a0-9cc5-62ff9de97c37,type=cdrom,dest=local,bootindex=0,shutdown=delete vm4\n+--------------------------------------+-------------------------------------------------+\n| Property                             | Value                                           |\n+--------------------------------------+-------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                          |\n| OS-EXT-AZ:availability_zone          | nova                                            |\n| OS-EXT-SRV-ATTR:host                 | -                                               |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                               |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                               |\n| OS-EXT-STS:power_state               | 0                                               |\n| OS-EXT-STS:task_state                | scheduling                                      |\n| OS-EXT-STS:vm_state                  | building                                        |\n| OS-SRV-USG:launched_at               | -                                               |\n| OS-SRV-USG:terminated_at             | -                                               |\n| accessIPv4                           |                                                 |\n| accessIPv6                           |                                                 |\n| adminPass                            | PHD2yuKTVbDA                                    |\n| config_drive                         |                                                 |\n| created                              | 2014-10-06T13:46:01Z                            |\n| flavor                               | install-test (100)                              |\n| hostId                               |                                                 |\n| id                                   | bbc3a863-a62f-4676-9100-a34a93b191cc            |\n| image                                | Attempt to boot from volume - no image supplied |\n| key_name                             | -                                               |\n| metadata                             | {}                                              |\n| name                                 | vm4                                             |\n| os-extended-volumes:volumes_attached | []                                              |\n| progress                             | 0                                               |\n| security_groups                      | default                                         |\n| status                               | BUILD                                           |\n| tenant_id                            | 8acb24eaeaee44f481aa7c73f179a4da                |\n| updated                              | 2014-10-06T13:46:01Z                            |\n| user_id                              | 2957e97d89fd4aeb80e314653ea34663                |\n+--------------------------------------+-------------------------------------------------+\nstack@stack:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| bbc3a863-a62f-4676-9100-a34a93b191cc | vm4  | ERROR  | -          | NOSTATE     | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\nstack@stack:~/devstack$ \nstack@stack:~/devstack$ nova show vm4\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                                                                |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                                                               |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                                                                 |\n| OS-EXT-SRV-ATTR:host                 | stack                                                                                                                                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | stack                                                                                                                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                                                                                                                    |\n| OS-EXT-STS:power_state               | 0                                                                                                                                                    |\n| OS-EXT-STS:task_state                | -                                                                                                                                                    |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                |\n| OS-SRV-USG:launched_at               | -                                                                                                                                                    |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                    |\n| accessIPv4                           |                                                                                                                                                      |\n| accessIPv6                           |                                                                                                                                                      |\n| config_drive                         |                                                                                                                                                      |\n| created                              | 2014-10-06T13:46:01Z                                                                                                                                 |\n| fault                                | {\"message\": \"No valid host was found. \", \"code\": 500, \"details\": \"  File \\\"/opt/stack/nova/nova/conductor/manager.py\\\", line 614, in build_instances |\n|                                      |     request_spec, filter_properties)                                                                                                                 |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/__init__.py\\\", line 49, in select_destinations                                                        |\n|                                      |     context, request_spec, filter_properties)                                                                                                        |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/__init__.py\\\", line 35, in __run_method                                                               |\n|                                      |     return getattr(self.instance, __name)(*args, **kwargs)                                                                                           |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/query.py\\\", line 34, in select_destinations                                                           |\n|                                      |     context, request_spec, filter_properties)                                                                                                        |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/rpcapi.py\\\", line 108, in select_destinations                                                                |\n|                                      |     request_spec=request_spec, filter_properties=filter_properties)                                                                                  |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\\\", line 152, in call                                                    |\n|                                      |     retry=self.retry)                                                                                                                                |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\\\", line 90, in _send                                                     |\n|                                      |     timeout=timeout, retry=retry)                                                                                                                    |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\\\", line 408, in send                                           |\n|                                      |     retry=retry)                                                                                                                                     |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\\\", line 399, in _send                                          |\n|                                      |     raise result                                                                                                                                     |\n|                                      | \", \"created\": \"2014-10-06T13:46:05Z\"}                                                                                                                |\n| flavor                               | install-test (100)                                                                                                                                   |\n| hostId                               | 9c365e0da6ac63e8559079a640a533242d5252a56bf76ed160011e25                                                                                             |\n| id                                   | bbc3a863-a62f-4676-9100-a34a93b191cc                                                                                                                 |\n| image                                | Attempt to boot from volume - no image supplied                                                                                                      |\n| key_name                             | -                                                                                                                                                    |\n| metadata                             | {}                                                                                                                                                   |\n| name                                 | vm4                                                                                                                                                  |\n| os-extended-volumes:volumes_attached | []                                                                                                                                                   |\n| private network                      | 10.0.0.2                                                                                                                                             |\n| security_groups                      | default                                                                                                                                              |\n| status                               | ERROR                                                                                                                                                |\n| tenant_id                            | 8acb24eaeaee44f481aa7c73f179a4da                                                                                                                     |\n| updated                              | 2014-10-06T13:46:05Z                                                                                                                                 |\n| user_id                              | 2957e97d89fd4aeb80e314653ea34663                                                                                                                     |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+\nstack@stack:~/devstack$ \n\nThe following exception is visible in the nova-cpu.log \n\n2014-10-06 15:46:04.712 ERROR nova.compute.manager [req-a8ccaca2-b3e8-492c-8f82-20a72ce1d7ff admin demo] [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] Instance failed to spawn\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] Traceback (most recent call last):\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2231, in _build_resources\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     yield resources\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2101, in _build_and_run_instance\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     block_device_info=block_device_info)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2600, in spawn\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     block_device_info, disk_info=disk_info)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4393, in _create_domain_and_network\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     power_on=power_on)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4317, in _create_domain\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     LOG.error(err)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     six.reraise(self.type_, self.value, self.tb)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4308, in _create_domain\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     domain.createWithFlags(launch_flags)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     rv = execute(f, *args, **kwargs)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     six.reraise(c, e, tb)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     rv = meth(*args, **kwargs)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] libvirtError: Failed to open file '/opt/stack/data/nova/instances/bbc3a863-a62f-4676-9100-a34a93b191cc/disk': No such file or directory\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]\n2014-10-06 15:46:04.899 AUDIT nova.compute.manager [req-a8ccaca2-b3e8-492c-8f82-20a72ce1d7ff admin demo] [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] Terminating instance\n2014-10-06 15:46:04.907 INFO nova.virt.libvirt.driver [-] [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] Instance destroyed successfully.\n\nHere is the related section of the domain xml:\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/bbc3a863-a62f-4676-9100-a34a93b191cc/disk'/>\n      <target dev='hda' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='0' target='0' unit='0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/bbc3a863-a62f-4676-9100-a34a93b191cc/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n \n\n\nAlso if thea boot images is specified with the --image parameter and an extra image to local mapping is specified with the --block-device parameter then the instance is booted from the boot image but the secondary image is not attach.\n\nstack@stack:~/devstack$ nova boot --flavor 100 --image b30661ed-f176-4b7c-997f-32ca724cbaad  --block-device source=image,id=e3bb2e81-e5ed-43a0-9cc5-62ff9de97c37,type=cdrom,dest=local,bootindex=1,shutdown=delete vm4\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | -                                                              |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                              |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                              |\n| OS-EXT-STS:power_state               | 0                                                              |\n| OS-EXT-STS:task_state                | scheduling                                                     |\n| OS-EXT-STS:vm_state                  | building                                                       |\n| OS-SRV-USG:launched_at               | -                                                              |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| adminPass                            | Mir6yrXKehJP                                                   |\n| config_drive                         |                                                                |\n| created                              | 2014-10-06T13:57:03Z                                           |\n| flavor                               | install-test (100)                                             |\n| hostId                               |                                                                |\n| id                                   | 1f7ab5b2-6388-4b0f-b6cd-8ddc43295d43                           |\n| image                                | cirros-0.3.2-x86_64-uec (b30661ed-f176-4b7c-997f-32ca724cbaad) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | vm4                                                            |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | BUILD                                                          |\n| tenant_id                            | 8acb24eaeaee44f481aa7c73f179a4da                               |\n| updated                              | 2014-10-06T13:57:03Z                                           |\n| user_id                              | 2957e97d89fd4aeb80e314653ea34663                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@stack:~/devstack$ nova show\nusage: nova show [--minimal] <server>\nerror: too few arguments\nTry 'nova help show' for more information.\nstack@stack:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| 1f7ab5b2-6388-4b0f-b6cd-8ddc43295d43 | vm4  | ACTIVE | -          | Running     | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n\nHere is the related part of the domain xml:\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/1f7ab5b2-6388-4b0f-b6cd-8ddc43295d43/disk'/>\n      <target dev='vda' bus='virtio'/>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/1f7ab5b2-6388-4b0f-b6cd-8ddc43295d43/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <alias name='ide0-1-1'/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>", 
    "tags": [
        "volumes"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1377958", 
    "owner": "https://api.launchpad.net/1.0/~balazs-gibizer", 
    "id": 1377958, 
    "index": 149, 
    "created": "2014-10-06 14:07:24.585547+00:00", 
    "title": "image to local block device mapping doesnt work but accepted by the API", 
    "comments": [
        {
            "content": "When I try to boot an instance with the boot image specified as BDM the API accepts the request but the instance ends up in ERROR state due to an exception in the nova-compute. Furter investigation shows that image to local mapping is not supported in the --block-device parameter at all but the API does not validate and reject this kind of requests.\n\n\nstack@stack:~/devstack$ nova flavor-create install-test 100 1024 0 1\n+-----+--------------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID  | Name         | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+-----+--------------+-----------+------+-----------+------+-------+-------------+-----------+\n| 100 | install-test | 1024      | 0    | 0         |      | 1     | 1.0         | True      |\n+-----+--------------+-----------+------+-----------+------+-------+-------------+-----------+\nstack@stack:~/devstack$ glance image-create --file ../mini.iso  --name ubuntu-mini.iso --is-public=True --disk-format iso --container-format bare+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | a2502844750ecb6477d8fb4ff6b9aaf8     |\n| container_format | bare                                 |\n| created_at       | 2014-10-06T13:45:48                  |\n| deleted          | False                                |\n| deleted_at       | None                                 |\n| disk_format      | iso                                  |\n| id               | e3bb2e81-e5ed-43a0-9cc5-62ff9de97c37 |\n| is_public        | True                                 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | ubuntu-mini.iso                      |\n| owner            | 8acb24eaeaee44f481aa7c73f179a4da     |\n| protected        | False                                |\n| size             | 32505856                             |\n| status           | active                               |\n| updated_at       | 2014-10-06T13:45:48                  |\n| virtual_size     | None                                 |\n+------------------+--------------------------------------+\nstack@stack:~/devstack$ nova boot --flavor 100 --block-device source=image,id=e3bb2e81-e5ed-43a0-9cc5-62ff9de97c37,type=cdrom,dest=local,bootindex=0,shutdown=delete vm4\n+--------------------------------------+-------------------------------------------------+\n| Property                             | Value                                           |\n+--------------------------------------+-------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                          |\n| OS-EXT-AZ:availability_zone          | nova                                            |\n| OS-EXT-SRV-ATTR:host                 | -                                               |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                               |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                               |\n| OS-EXT-STS:power_state               | 0                                               |\n| OS-EXT-STS:task_state                | scheduling                                      |\n| OS-EXT-STS:vm_state                  | building                                        |\n| OS-SRV-USG:launched_at               | -                                               |\n| OS-SRV-USG:terminated_at             | -                                               |\n| accessIPv4                           |                                                 |\n| accessIPv6                           |                                                 |\n| adminPass                            | PHD2yuKTVbDA                                    |\n| config_drive                         |                                                 |\n| created                              | 2014-10-06T13:46:01Z                            |\n| flavor                               | install-test (100)                              |\n| hostId                               |                                                 |\n| id                                   | bbc3a863-a62f-4676-9100-a34a93b191cc            |\n| image                                | Attempt to boot from volume - no image supplied |\n| key_name                             | -                                               |\n| metadata                             | {}                                              |\n| name                                 | vm4                                             |\n| os-extended-volumes:volumes_attached | []                                              |\n| progress                             | 0                                               |\n| security_groups                      | default                                         |\n| status                               | BUILD                                           |\n| tenant_id                            | 8acb24eaeaee44f481aa7c73f179a4da                |\n| updated                              | 2014-10-06T13:46:01Z                            |\n| user_id                              | 2957e97d89fd4aeb80e314653ea34663                |\n+--------------------------------------+-------------------------------------------------+\nstack@stack:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| bbc3a863-a62f-4676-9100-a34a93b191cc | vm4  | ERROR  | -          | NOSTATE     | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\nstack@stack:~/devstack$ \nstack@stack:~/devstack$ nova show vm4\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                                                                |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                                                               |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                                                                 |\n| OS-EXT-SRV-ATTR:host                 | stack                                                                                                                                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | stack                                                                                                                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                                                                                                                    |\n| OS-EXT-STS:power_state               | 0                                                                                                                                                    |\n| OS-EXT-STS:task_state                | -                                                                                                                                                    |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                |\n| OS-SRV-USG:launched_at               | -                                                                                                                                                    |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                    |\n| accessIPv4                           |                                                                                                                                                      |\n| accessIPv6                           |                                                                                                                                                      |\n| config_drive                         |                                                                                                                                                      |\n| created                              | 2014-10-06T13:46:01Z                                                                                                                                 |\n| fault                                | {\"message\": \"No valid host was found. \", \"code\": 500, \"details\": \"  File \\\"/opt/stack/nova/nova/conductor/manager.py\\\", line 614, in build_instances |\n|                                      |     request_spec, filter_properties)                                                                                                                 |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/__init__.py\\\", line 49, in select_destinations                                                        |\n|                                      |     context, request_spec, filter_properties)                                                                                                        |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/__init__.py\\\", line 35, in __run_method                                                               |\n|                                      |     return getattr(self.instance, __name)(*args, **kwargs)                                                                                           |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/query.py\\\", line 34, in select_destinations                                                           |\n|                                      |     context, request_spec, filter_properties)                                                                                                        |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/rpcapi.py\\\", line 108, in select_destinations                                                                |\n|                                      |     request_spec=request_spec, filter_properties=filter_properties)                                                                                  |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\\\", line 152, in call                                                    |\n|                                      |     retry=self.retry)                                                                                                                                |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\\\", line 90, in _send                                                     |\n|                                      |     timeout=timeout, retry=retry)                                                                                                                    |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\\\", line 408, in send                                           |\n|                                      |     retry=retry)                                                                                                                                     |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\\\", line 399, in _send                                          |\n|                                      |     raise result                                                                                                                                     |\n|                                      | \", \"created\": \"2014-10-06T13:46:05Z\"}                                                                                                                |\n| flavor                               | install-test (100)                                                                                                                                   |\n| hostId                               | 9c365e0da6ac63e8559079a640a533242d5252a56bf76ed160011e25                                                                                             |\n| id                                   | bbc3a863-a62f-4676-9100-a34a93b191cc                                                                                                                 |\n| image                                | Attempt to boot from volume - no image supplied                                                                                                      |\n| key_name                             | -                                                                                                                                                    |\n| metadata                             | {}                                                                                                                                                   |\n| name                                 | vm4                                                                                                                                                  |\n| os-extended-volumes:volumes_attached | []                                                                                                                                                   |\n| private network                      | 10.0.0.2                                                                                                                                             |\n| security_groups                      | default                                                                                                                                              |\n| status                               | ERROR                                                                                                                                                |\n| tenant_id                            | 8acb24eaeaee44f481aa7c73f179a4da                                                                                                                     |\n| updated                              | 2014-10-06T13:46:05Z                                                                                                                                 |\n| user_id                              | 2957e97d89fd4aeb80e314653ea34663                                                                                                                     |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+\nstack@stack:~/devstack$ \n\nThe following exception is visible in the nova-cpu.log \n\n2014-10-06 15:46:04.712 ERROR nova.compute.manager [req-a8ccaca2-b3e8-492c-8f82-20a72ce1d7ff admin demo] [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] Instance failed to spawn\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] Traceback (most recent call last):\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2231, in _build_resources\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     yield resources\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2101, in _build_and_run_instance\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     block_device_info=block_device_info)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2600, in spawn\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     block_device_info, disk_info=disk_info)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4393, in _create_domain_and_network\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     power_on=power_on)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4317, in _create_domain\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     LOG.error(err)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     six.reraise(self.type_, self.value, self.tb)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4308, in _create_domain\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     domain.createWithFlags(launch_flags)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     rv = execute(f, *args, **kwargs)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     six.reraise(c, e, tb)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     rv = meth(*args, **kwargs)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] libvirtError: Failed to open file '/opt/stack/data/nova/instances/bbc3a863-a62f-4676-9100-a34a93b191cc/disk': No such file or directory\n2014-10-06 15:46:04.712 TRACE nova.compute.manager [instance: bbc3a863-a62f-4676-9100-a34a93b191cc]\n2014-10-06 15:46:04.899 AUDIT nova.compute.manager [req-a8ccaca2-b3e8-492c-8f82-20a72ce1d7ff admin demo] [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] Terminating instance\n2014-10-06 15:46:04.907 INFO nova.virt.libvirt.driver [-] [instance: bbc3a863-a62f-4676-9100-a34a93b191cc] Instance destroyed successfully.\n\nHere is the related section of the domain xml:\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/bbc3a863-a62f-4676-9100-a34a93b191cc/disk'/>\n      <target dev='hda' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='0' target='0' unit='0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/bbc3a863-a62f-4676-9100-a34a93b191cc/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n \n\n\nAlso if thea boot images is specified with the --image parameter and an extra image to local mapping is specified with the --block-device parameter then the instance is booted from the boot image but the secondary image is not attach.\n\nstack@stack:~/devstack$ nova boot --flavor 100 --image b30661ed-f176-4b7c-997f-32ca724cbaad  --block-device source=image,id=e3bb2e81-e5ed-43a0-9cc5-62ff9de97c37,type=cdrom,dest=local,bootindex=1,shutdown=delete vm4\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | -                                                              |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                              |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                              |\n| OS-EXT-STS:power_state               | 0                                                              |\n| OS-EXT-STS:task_state                | scheduling                                                     |\n| OS-EXT-STS:vm_state                  | building                                                       |\n| OS-SRV-USG:launched_at               | -                                                              |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| adminPass                            | Mir6yrXKehJP                                                   |\n| config_drive                         |                                                                |\n| created                              | 2014-10-06T13:57:03Z                                           |\n| flavor                               | install-test (100)                                             |\n| hostId                               |                                                                |\n| id                                   | 1f7ab5b2-6388-4b0f-b6cd-8ddc43295d43                           |\n| image                                | cirros-0.3.2-x86_64-uec (b30661ed-f176-4b7c-997f-32ca724cbaad) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | vm4                                                            |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | BUILD                                                          |\n| tenant_id                            | 8acb24eaeaee44f481aa7c73f179a4da                               |\n| updated                              | 2014-10-06T13:57:03Z                                           |\n| user_id                              | 2957e97d89fd4aeb80e314653ea34663                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@stack:~/devstack$ nova show\nusage: nova show [--minimal] <server>\nerror: too few arguments\nTry 'nova help show' for more information.\nstack@stack:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| 1f7ab5b2-6388-4b0f-b6cd-8ddc43295d43 | vm4  | ACTIVE | -          | Running     | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n\nHere is the related part of the domain xml:\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/1f7ab5b2-6388-4b0f-b6cd-8ddc43295d43/disk'/>\n      <target dev='vda' bus='virtio'/>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/1f7ab5b2-6388-4b0f-b6cd-8ddc43295d43/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <alias name='ide0-1-1'/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>", 
            "date_created": "2014-10-06 14:07:24.585547+00:00", 
            "author": "https://api.launchpad.net/1.0/~balazs-gibizer"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/126303", 
            "date_created": "2014-10-06 14:17:00.845801+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/126303\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=67bcff461497e674ccdf5d335d983fe9a16639fa\nSubmitter: Jenkins\nBranch:    master\n\ncommit 67bcff461497e674ccdf5d335d983fe9a16639fa\nAuthor: Balazs Gibizer <email address hidden>\nDate:   Mon Oct 6 15:38:46 2014 +0200\n\n    Reject unsupported image to local BDM\n    \n    Specifying image to local BDM at nova boot is not supported.\n    This patch adds a validation to the API to reject this not supported\n    mapping.\n    \n    Closes-bug: #1377958\n    Change-Id: I0c38134e2aacca83d98ed0b341f15c480afe14f1\n", 
            "date_created": "2015-02-02 17:47:54.237823+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}