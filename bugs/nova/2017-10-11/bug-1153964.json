{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:20:56.927849+00:00", 
    "description": "The master code.\n\nIf  an exception raised in libvirt._create_domain(), the resouce( like iptable rules, vif , etc.) will forever stay in the host.\n\nAn easy reproduction:\n 0. setup all-in-one devstack.\n 1.  settting vncserver_listen = 1.2.3.4 in nova.conf.  The configuration is to make libvirt._create_domain() raise an exception. In production environment, other reason can lead to an excetion. for example:  (see attachment).\n\n\n2.  nova boot --flavor 1 --image XXXX vm1\n\n3.  \nubuntu@dev-stack:~$ nova list\n+--------------------------------------+------+--------+------------------+\n| ID                                   | Name | Status | Networks         |\n+--------------------------------------+------+--------+------------------+\n| a8872a5a-4ba1-43fa-9ce3-6d52e7b166a1 | vm1  | ERROR  | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------------+\n\nnova show vm1\n+-----------------------------+---------------------------------------------------------------------------------+\n| Property                    | Value                                                                           |\n+-----------------------------+---------------------------------------------------------------------------------+\n| status                      | ERROR                                                                           |\n| updated                     | 2013-03-12T08:31:20Z                                                            |\n| OS-EXT-STS:task_state       | None                                                                            |\n| key_name                    | None                                                                            |\n| image                       | cirros-0.3.1-x86_64-uec (f8b011a1-dac2-48be-ba8a-3d9241628bc1)                  |\n| hostId                      | 409593d0d130d1be6902b6dd565e259e4c874ac03e1ba26c3a3c7787                        |\n| OS-EXT-STS:vm_state         | error                                                                           |\n| flavor                      | m1.tiny (1)                                                                     |\n| id                          | a8872a5a-4ba1-43fa-9ce3-6d52e7b166a1                                            |\n| security_groups             | [{u'name': u'default'}]                                                         |\n| user_id                     | 9694194fd660483ea427faf2da47795c                                                |\n| name                        | vm1                                                                             |\n| created                     | 2013-03-12T08:31:04Z                                                            |\n| fault                       | {u'message': u'NoValidHost', u'code': 500, u'created': u'2013-03-12T08:31:20Z'} |\n| OS-DCF:diskConfig           | MANUAL                                                                          |\n| metadata                    | {}                                                                              |\n| accessIPv4                  |                                                                                 |\n| accessIPv6                  |                                                                                 |\n| tenant_id                   | 6cc57820330644c98d606a15890678ff                                                |\n| OS-EXT-STS:power_state      | 0                                                                               |\n| OS-EXT-AZ:availability_zone | nova                                                                            |\n| config_drive                |                                                                                 |\n+-----------------------------+---------------------------------------------------------------------------------+\n\n4. ubuntu@dev-stack:~$ sudo iptables-save |grep 10.0.0.2\n-A nova-compute-local -d 10.0.0.2/32 -j nova-compute-inst-1\n\nIf there is more than one host, the instance will be rescheduled to other host. but the resources in this host will not release forever.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1153964", 
    "owner": "https://api.launchpad.net/1.0/~gtt116", 
    "id": 1153964, 
    "index": 3506, 
    "created": "2013-03-12 08:47:49.389127+00:00", 
    "title": "forget to release resource before rescheduling", 
    "comments": [
        {
            "content": "The master code.\n\nIf  an exception raised in libvirt._create_domain(), the resouce( like iptable rules, vif , etc.) will forever stay in the host.\n\nAn easy reproduction:\n 0. setup all-in-one devstack.\n 1.  settting vncserver_listen = 1.2.3.4 in nova.conf.  The configuration is to make libvirt._create_domain() raise an exception. In production environment, other reason can lead to an excetion. for example:  (see attachment).\n\n\n2.  nova boot --flavor 1 --image XXXX vm1\n\n3.  \nubuntu@dev-stack:~$ nova list\n+--------------------------------------+------+--------+------------------+\n| ID                                   | Name | Status | Networks         |\n+--------------------------------------+------+--------+------------------+\n| a8872a5a-4ba1-43fa-9ce3-6d52e7b166a1 | vm1  | ERROR  | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------------+\n\nnova show vm1\n+-----------------------------+---------------------------------------------------------------------------------+\n| Property                    | Value                                                                           |\n+-----------------------------+---------------------------------------------------------------------------------+\n| status                      | ERROR                                                                           |\n| updated                     | 2013-03-12T08:31:20Z                                                            |\n| OS-EXT-STS:task_state       | None                                                                            |\n| key_name                    | None                                                                            |\n| image                       | cirros-0.3.1-x86_64-uec (f8b011a1-dac2-48be-ba8a-3d9241628bc1)                  |\n| hostId                      | 409593d0d130d1be6902b6dd565e259e4c874ac03e1ba26c3a3c7787                        |\n| OS-EXT-STS:vm_state         | error                                                                           |\n| flavor                      | m1.tiny (1)                                                                     |\n| id                          | a8872a5a-4ba1-43fa-9ce3-6d52e7b166a1                                            |\n| security_groups             | [{u'name': u'default'}]                                                         |\n| user_id                     | 9694194fd660483ea427faf2da47795c                                                |\n| name                        | vm1                                                                             |\n| created                     | 2013-03-12T08:31:04Z                                                            |\n| fault                       | {u'message': u'NoValidHost', u'code': 500, u'created': u'2013-03-12T08:31:20Z'} |\n| OS-DCF:diskConfig           | MANUAL                                                                          |\n| metadata                    | {}                                                                              |\n| accessIPv4                  |                                                                                 |\n| accessIPv6                  |                                                                                 |\n| tenant_id                   | 6cc57820330644c98d606a15890678ff                                                |\n| OS-EXT-STS:power_state      | 0                                                                               |\n| OS-EXT-AZ:availability_zone | nova                                                                            |\n| config_drive                |                                                                                 |\n+-----------------------------+---------------------------------------------------------------------------------+\n\n4. ubuntu@dev-stack:~$ sudo iptables-save |grep 10.0.0.2\n-A nova-compute-local -d 10.0.0.2/32 -j nova-compute-inst-1\n\nIf there is more than one host, the instance will be rescheduled to other host. but the resources in this host will not release forever.", 
            "date_created": "2013-03-12 08:47:49.389127+00:00", 
            "author": "https://api.launchpad.net/1.0/~gtt116"
        }, 
        {
            "content": "", 
            "date_created": "2013-03-12 08:47:49.389127+00:00", 
            "author": "https://api.launchpad.net/1.0/~gtt116"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/24282", 
            "date_created": "2013-03-13 03:52:27.840012+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/24282\nCommitted: http://github.com/openstack/nova/commit/22e8e37e45c69136b252a494d8398b0b98e35b9e\nSubmitter: Jenkins\nBranch:    master\n\ncommit 22e8e37e45c69136b252a494d8398b0b98e35b9e\nAuthor: gtt116 <gtt116@126.com>\nDate:   Wed Mar 13 03:43:16 2013 +0000\n\n    Do cleaning up resource before rescheduling.\n    \n    Fix bug: #1153964\n    \n    If some exception raised when spawn instance, the instance will be\n    rescheduled to other host. But just deallocate network before\n    rescheduling is not enough, like security group filters and volumes\n    will stay on old host.\n    \n    So shutdown instance and clean up volumes instead of just deallocate\n    network before rescheduling.\n    \n    Change-Id: Ieb6220ae66f0b97a92c50f6998f456968b516fcb\n", 
            "date_created": "2013-03-14 23:54:53.602325+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}