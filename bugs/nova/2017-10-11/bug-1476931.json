{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 09:02:20.352784+00:00", 
    "description": "With monkey_patch enabled, it would patch specified modules with decorator to trace all the function call. But it broken by some minor bugs:\n\n=============================bug 1============================================\n2015-07-21 09:52:16.707 TRACE nova   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 349, in __init__\n2015-07-21 09:52:16.707 TRACE nova     self.controller = importutils.import_object(controller)\n2015-07-21 09:52:16.707 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 38, in import_object\n2015-07-21 09:52:16.707 TRACE nova     return import_class(import_str)(*args, **kwargs)\n2015-07-21 09:52:16.707 TRACE nova   File \"/opt/stack/nova/nova/notifications.py\", line 89, in wrapped_func\n2015-07-21 09:52:16.707 TRACE nova     method = notifier.getattr(CONF.default_notification_level.lower(),\n2015-07-21 09:52:16.707 TRACE nova AttributeError: '_SubNotifier' object has no attribute 'getattr'\n2015-07-21 09:52:16.707 TRACE nova\n\n=============================bug 2==========================================\n2015-07-21 09:56:51.836 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 38, in import_object\n2015-07-21 09:56:51.836 TRACE nova     return import_class(import_str)(*args, **kwargs)\n2015-07-21 09:56:51.836 TRACE nova   File \"/opt/stack/nova/nova/notifications.py\", line 91, in wrapped_func\n2015-07-21 09:56:51.836 TRACE nova     method(ctxt, name, body)\n2015-07-21 09:56:51.836 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/notify/notifier.py\", line 228, in info\n2015-07-21 09:56:51.836 TRACE nova     self._notify(ctxt, event_type, payload, 'INFO')\n2015-07-21 09:56:51.836 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/notify/notifier.py\", line 309, in _notify\n2015-07-21 09:56:51.836 TRACE nova     super(_SubNotifier, self)._notify(ctxt, event_type, payload, priority)\n2015-07-21 09:56:51.836 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/notify/notifier.py\", line 168, in _notify\n2015-07-21 09:56:51.836 TRACE nova     ctxt = self._serializer.serialize_context(ctxt)\n2015-07-21 09:56:51.836 TRACE nova   File \"/opt/stack/nova/nova/rpc.py\", line 114, in serialize_context\n2015-07-21 09:56:51.836 TRACE nova     return context.to_dict()\n2015-07-21 09:56:51.836 TRACE nova AttributeError: 'NoneType' object has no attribute 'to_dict'", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1476931", 
    "owner": "https://api.launchpad.net/1.0/~edwin-zhai", 
    "id": 1476931, 
    "index": 5659, 
    "created": "2015-07-22 06:14:16.541050+00:00", 
    "title": "monkey_patch broken", 
    "comments": [
        {
            "content": "With monkey_patch enabled, it would patch specified modules with decorator to trace all the function call. But it broken by some minor bugs:\n\n=============================bug 1============================================\n2015-07-21 09:52:16.707 TRACE nova   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 349, in __init__\n2015-07-21 09:52:16.707 TRACE nova     self.controller = importutils.import_object(controller)\n2015-07-21 09:52:16.707 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 38, in import_object\n2015-07-21 09:52:16.707 TRACE nova     return import_class(import_str)(*args, **kwargs)\n2015-07-21 09:52:16.707 TRACE nova   File \"/opt/stack/nova/nova/notifications.py\", line 89, in wrapped_func\n2015-07-21 09:52:16.707 TRACE nova     method = notifier.getattr(CONF.default_notification_level.lower(),\n2015-07-21 09:52:16.707 TRACE nova AttributeError: '_SubNotifier' object has no attribute 'getattr'\n2015-07-21 09:52:16.707 TRACE nova\n\n=============================bug 2==========================================\n2015-07-21 09:56:51.836 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 38, in import_object\n2015-07-21 09:56:51.836 TRACE nova     return import_class(import_str)(*args, **kwargs)\n2015-07-21 09:56:51.836 TRACE nova   File \"/opt/stack/nova/nova/notifications.py\", line 91, in wrapped_func\n2015-07-21 09:56:51.836 TRACE nova     method(ctxt, name, body)\n2015-07-21 09:56:51.836 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/notify/notifier.py\", line 228, in info\n2015-07-21 09:56:51.836 TRACE nova     self._notify(ctxt, event_type, payload, 'INFO')\n2015-07-21 09:56:51.836 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/notify/notifier.py\", line 309, in _notify\n2015-07-21 09:56:51.836 TRACE nova     super(_SubNotifier, self)._notify(ctxt, event_type, payload, priority)\n2015-07-21 09:56:51.836 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/notify/notifier.py\", line 168, in _notify\n2015-07-21 09:56:51.836 TRACE nova     ctxt = self._serializer.serialize_context(ctxt)\n2015-07-21 09:56:51.836 TRACE nova   File \"/opt/stack/nova/nova/rpc.py\", line 114, in serialize_context\n2015-07-21 09:56:51.836 TRACE nova     return context.to_dict()\n2015-07-21 09:56:51.836 TRACE nova AttributeError: 'NoneType' object has no attribute 'to_dict'", 
            "date_created": "2015-07-22 06:14:16.541050+00:00", 
            "author": "https://api.launchpad.net/1.0/~edwin-zhai"
        }, 
        {
            "content": "\nBug1 is caused by getattr usage.\nBug2 is caused by None oslo_context with serialization when no context in the API parameter.\n\nPatch will be out soon.", 
            "date_created": "2015-07-22 06:31:27.685668+00:00", 
            "author": "https://api.launchpad.net/1.0/~edwin-zhai"
        }, 
        {
            "content": "Review\nhttps://review.openstack.org/#/c/203573/", 
            "date_created": "2015-07-22 07:37:44.097538+00:00", 
            "author": "https://api.launchpad.net/1.0/~edwin-zhai"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/203573\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=2045b75bea6e570df372ea6bdd2a9c9af1da0a57\nSubmitter: Jenkins\nBranch:    master\n\ncommit 2045b75bea6e570df372ea6bdd2a9c9af1da0a57\nAuthor: Edwin Zhai <email address hidden>\nDate:   Tue Jul 21 10:10:21 2015 +0800\n\n    Fix notify_decorator errors\n    \n    * getattr is built-in function, so should not be used as attribute.\n    * When ctxt is None, rpc.get_notifier('api').info(ctxt, name, body)\n      leads NoneType exception at context.to_dict(). So we need guarantee\n      one valid context here.\n    \n    Closes-Bug: #1476931\n    \n    Change-Id: I25953467aca641448d25b2d63352f756ec3655aa\n", 
            "date_created": "2015-08-19 20:04:28.036763+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}