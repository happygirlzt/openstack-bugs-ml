{
    "status": "Invalid", 
    "last_updated": "2014-09-04 18:22:23.143972+00:00", 
    "description": "We tried to installed the Folsom release (python-nova_2012.2-0ubuntu3~cloud0) on a precise ubuntu-server installation and use an ESX Host as compute node.\n\nAfter fixing the problem described in #1063885 we are running in MemoryErrors:\n\nCreating a new instance with:\n\nnova boot --flavor 2 --image 6e4deabd-ccd6-412e-9bed-e3293f45a2db test1\n\nwe get the following error in nova-computelog:\n\n\n2012-10-08 17:40:47 DEBUG nova.virt.vmwareapi.vmware_images [req-b1d31b85-f637-4a2c-9aa0-82365775c18c 4d3ed50af55d43e1ac3c2279e7fcded8 1ff95471d60b431b84a161d2e70bfa03] [instance: a65b235a-27b0-45b8-9c2f-6c93f5ee3f1c] Downloading image 6e4deabd-ccd6-412e-9bed-e3293f45a2db from glance image server from (pid=4140) fetch_image /usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/vmware_images.py:92\n\n\n2012-10-08 17:41:55 ERROR nova.virt.vmwareapi.io_util [-] \n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util Traceback (most recent call last):\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/io_util.py\", line 154, in _inner\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     data = self.input.read(None)\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/read_write_util.py\", line 53, in read\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     return self.iter.next()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/read_write_util.py\", line 59, in get_next\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     for data in self.glance_read_iter:\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/StringIO.py\", line 76, in next\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     r = self.readline()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/StringIO.py\", line 154, in readline\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     self.buf += ''.join(self.buflist)\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util MemoryError\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util \n2012-10-08 17:41:55 ERROR nova.virt.vmwareapi.vmware_images [req-b1d31b85-f637-4a2c-9aa0-82365775c18c 4d3ed50af55d43e1ac3c2279e7fcded8 1ff95471d60b431b84a161d2e70bfa03] \n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images Traceback (most recent call last):\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/vmware_images.py\", line 69, in start_transfer\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images     read_event.wait()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images     return hubs.get_hub().switch()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 177, in switch\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images     return self.greenlet.switch()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images MemoryError\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images", 
    "tags": [
        "vmware"
    ], 
    "importance": "Wishlist", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1063889", 
    "owner": "None", 
    "id": 1063889, 
    "index": 1295, 
    "created": "2012-10-08 16:09:47.080902+00:00", 
    "title": "MemoryError while uploading Image from Glance to ESX", 
    "comments": [
        {
            "content": "We tried to installed the Folsom release (python-nova_2012.2-0ubuntu3~cloud0) on a precise ubuntu-server installation and use an ESX Host as compute node.\n\nAfter fixing the problem described in #1063885 we are running in MemoryErrors:\n\nCreating a new instance with:\n\nnova boot --flavor 2 --image 6e4deabd-ccd6-412e-9bed-e3293f45a2db test1\n\nwe get the following error in nova-computelog:\n\n\n2012-10-08 17:40:47 DEBUG nova.virt.vmwareapi.vmware_images [req-b1d31b85-f637-4a2c-9aa0-82365775c18c 4d3ed50af55d43e1ac3c2279e7fcded8 1ff95471d60b431b84a161d2e70bfa03] [instance: a65b235a-27b0-45b8-9c2f-6c93f5ee3f1c] Downloading image 6e4deabd-ccd6-412e-9bed-e3293f45a2db from glance image server from (pid=4140) fetch_image /usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/vmware_images.py:92\n\n\n2012-10-08 17:41:55 ERROR nova.virt.vmwareapi.io_util [-] \n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util Traceback (most recent call last):\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/io_util.py\", line 154, in _inner\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     data = self.input.read(None)\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/read_write_util.py\", line 53, in read\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     return self.iter.next()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/read_write_util.py\", line 59, in get_next\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     for data in self.glance_read_iter:\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/StringIO.py\", line 76, in next\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     r = self.readline()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util   File \"/usr/lib/python2.7/StringIO.py\", line 154, in readline\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util     self.buf += ''.join(self.buflist)\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util MemoryError\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.io_util \n2012-10-08 17:41:55 ERROR nova.virt.vmwareapi.vmware_images [req-b1d31b85-f637-4a2c-9aa0-82365775c18c 4d3ed50af55d43e1ac3c2279e7fcded8 1ff95471d60b431b84a161d2e70bfa03] \n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images Traceback (most recent call last):\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/vmware_images.py\", line 69, in start_transfer\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images     read_event.wait()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images     return hubs.get_hub().switch()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 177, in switch\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images     return self.greenlet.switch()\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images MemoryError\n2012-10-08 17:41:55 TRACE nova.virt.vmwareapi.vmware_images", 
            "date_created": "2012-10-08 16:09:47.080902+00:00", 
            "author": "https://api.launchpad.net/1.0/~christoph-lukas"
        }, 
        {
            "content": "Christoph -\n\nRan into same problem, you can work around it by increasing the memory your compute node.\n\nAppears that behavior has changed from ESSEX to FOLSOM which leads to a next problem.\n\nAfter you kludge the memory problem you will most likely run into the VMDK issue we mentioned on the other bug you have opened.\n\nHope this helps.\n\nCould you confer that the VMDK doesn't transfer to the hypervisor - maybe it will be different in your configuration with ubuntu....  semmed like that was your OS.\n\nbob", 
            "date_created": "2012-10-15 15:55:46.384178+00:00", 
            "author": "https://api.launchpad.net/1.0/~robert-k-shiflet"
        }, 
        {
            "content": "For us the image transfer from Glance to the Esx-Server failed. \n\nAt first nova-compute got killed by the OOM-Killer. Increasing the system memory we found the above Memory Error. But the effect was always the same:\n\nnova-compute created the folder on the Esx server's datastore, created the vmx file, created the dummy vmdk file, removed it and started the upload of the real vmdk from Glance to the Esx server which was never finished.\n\nThis problem still occured using a 2GB image file and 4 GB of Ram.\n\nWe used the Folsom release on Ubuntu server 12.04.1 and Esx 5.0.", 
            "date_created": "2012-10-15 17:32:47.537424+00:00", 
            "author": "https://api.launchpad.net/1.0/~christoph-lukas"
        }, 
        {
            "content": "Christoph -\n\nWe received a memory error when attempting to use a 2GB image file and 2GB of Ram on our nova-compute node when running Folsom on RHEL 6.2 with ESXi 4.1 update 2.  After I increased the memory to 10GB of Ram on the nova-compute node the Memory error went away.  However, the vmdk still fails to transfer to the hypervisor.  We are seeing the same thing you are \"nova-compute created the folder on the Esx server's datastore, created the vmx file, created the dummy vmdk file, removed it and started the upload of the real vmdk from Glance.\"  Our vmdk file shows up under the newly created folder on the hypervisor, but remains at 0.00 KB.\n\nIt appears that the image is transferred from Glance into the nova-compute process memory on the nova-compute node, but never getting pushed out the hypervisor.  It may be getting stuck somewhere in vmwareapi/read_write_util.py.\n\nHave you had any success getting past this?\n\n", 
            "date_created": "2012-10-15 18:13:41.046883+00:00", 
            "author": "https://api.launchpad.net/1.0/~robert-k-shiflet"
        }, 
        {
            "content": "Hi Bob,\n\n> Christoph -\n> \n> We received a memory error when attempting to use a 2GB image file and\n> 2GB of Ram on our nova-compute node when running Folsom on RHEL 6.2 with\n> ESXi 4.1 update 2.  After I increased the memory to 10GB of Ram on the\n> nova-compute node the Memory error went away.  However, the vmdk still\n> fails to transfer to the hypervisor.  We are seeing the same thing you\n> are \"nova-compute created the folder on the Esx server's datastore,\n> created the vmx file, created the dummy vmdk file, removed it and\n> started the upload of the real vmdk from Glance.\"  Our vmdk file shows\n> up under the newly created folder on the hypervisor, but remains at 0.00\n> KB.\n\nare you sure that nova-compute is still running after this? And if it is still running can't you see any information in the nova-compute.log?\n\n>> Mat said that everything was fine after going to 10GB, we just went to 10 rather than scaling up through higher numbers.  Log said all was fine.\n\n> It appears that the image is transferred from Glance into the nova-\n> compute process memory on the nova-compute node, but never getting\n> pushed out the hypervisor.  It may be getting stuck somewhere in\n> vmwareapi/read_write_util.py.\n\nThe code looks like some kind of pipelining: Reading the image in chunks from glance while sending the chunks to the esx server in parallel.\nBut I did not find out what the real problem was.\n\n>> Same methodology they had in ESSEX, they just changed the code.\n\n> Have you had any success getting past this?\n\nSorry, no. :(\nAs we have not been able to fix the upload code and as we were just evaluation openstack in combination with Esx we have switch to kvm as hypervisor.\nAdditionally we found out that the use of the ESX server's API is restricted when using the 'free' version. You are only able to read information from the API but every write request is blocked.\n\n>> KVM seems to be what most folks are using and ubunu for O/S so there should be quite a bit more community support.\n\n>> We are lucky enough to have licensed versions.  Before going to license we were using 60-day trial versions, that might be a way to get full functionality for free to do an evaluation.\n\n>> Let me know if you decide to try the 60-day trial version for eval, I'll keep you in the loop on our progress.\n\n>> tsch\u00fc\u00df, bob\n\n\n\nHope you will be more successful.\n\nRegards,\nChristoph\n\n", 
            "date_created": "2012-10-16 14:45:02.118606+00:00", 
            "author": "https://api.launchpad.net/1.0/~robert-k-shiflet"
        }, 
        {
            "content": "We are staying with the 10GB work around, if anyone thinks this may cause unintended consequences for some other facet of the configuration, a heads up would be most appreciated.", 
            "date_created": "2012-10-17 14:43:40.027170+00:00", 
            "author": "https://api.launchpad.net/1.0/~robert-k-shiflet"
        }, 
        {
            "content": "Is this bug still valid? It was filed against Folsom and we are now on Icehouse (Folsom -> Grizzly -> Icehouse)", 
            "date_created": "2014-07-12 19:15:48.806276+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }
    ]
}