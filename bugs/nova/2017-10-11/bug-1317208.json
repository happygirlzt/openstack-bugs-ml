{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:32:33.618492+00:00", 
    "description": "The relevant portion of an example stack trace is below:\n\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packa\nges/nova/virt/xenapi/vmops.py\", line 2316, in attach_block_device_volumes\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     volume_utils.forget_sr(self._session, sr_uuid_map[sr_re\nf])\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 2307, in attach_block_device_volumes\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     hotplug=False)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/volumeops.py\", line 53, in attach_volume\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     vm_ref = vm_utils.vm_ref_or_raise(self._session, instance_name)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/vm_utils.py\", line 2661, in vm_ref_or_raise\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     vm_ref = lookup(session, instance_name)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/vm_utils.py\", line 1743, in lookup\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     vm_refs = session.call_xenapi(\"VM.get_by_name_label\", name_label)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/client/session.py\", line 179, in call_xenapi\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     return session.xenapi_request(method, args)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/XenAPI.py\", line 133, in xenapi_request\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     result = _parse_result(getattr(self, methodname)(*full_params))\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/XenAPI.py\", line 203, in _parse_result\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     raise Failure(result['ErrorDescription'])\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher Failure: ['FIELD_TYPE_ERROR', 'label']\n\n\nattach_block_device_volumes() in nova/virt/xenapi/vmops.py calls attach_volume() in nova/virt/xenapi/volumops.py and passes None for instance_name,  and this causes a failure when looking up the vm_ref.", 
    "tags": [
        "xenserver"
    ], 
    "importance": "Medium", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1317208", 
    "owner": "https://api.launchpad.net/1.0/~johngarbutt", 
    "id": 1317208, 
    "index": 3896, 
    "created": "2014-05-07 17:43:00.638943+00:00", 
    "title": "Xen live-migrate with volume attached ends with FIELD_TYPE_ERROR failure", 
    "comments": [
        {
            "content": "The relevant portion of an example stack trace is below:\n\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packa\nges/nova/virt/xenapi/vmops.py\", line 2316, in attach_block_device_volumes\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     volume_utils.forget_sr(self._session, sr_uuid_map[sr_re\nf])\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 2307, in attach_block_device_volumes\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     hotplug=False)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/volumeops.py\", line 53, in attach_volume\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     vm_ref = vm_utils.vm_ref_or_raise(self._session, instance_name)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/vm_utils.py\", line 2661, in vm_ref_or_raise\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     vm_ref = lookup(session, instance_name)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/vm_utils.py\", line 1743, in lookup\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     vm_refs = session.call_xenapi(\"VM.get_by_name_label\", name_label)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/nova/virt/xenapi/client/session.py\", line 179, in call_xenapi\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     return session.xenapi_request(method, args)\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/XenAPI.py\", line 133, in xenapi_request\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     result = _parse_result(getattr(self, methodname)(*full_params))\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/rackstack/615.44/nova/lib/python2.6/site-packages/XenAPI.py\", line 203, in _parse_result\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher     raise Failure(result['ErrorDescription'])\n2014-05-01 10:25:37.027 13905 TRACE oslo.messaging.rpc.dispatcher Failure: ['FIELD_TYPE_ERROR', 'label']\n\n\nattach_block_device_volumes() in nova/virt/xenapi/vmops.py calls attach_volume() in nova/virt/xenapi/volumops.py and passes None for instance_name,  and this causes a failure when looking up the vm_ref.", 
            "date_created": "2014-05-07 17:43:00.638943+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/92656", 
            "date_created": "2014-05-07 18:44:02.399969+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/92656\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=1e2b7fbf73a9d6b9088396cd41091911d35279ef\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1e2b7fbf73a9d6b9088396cd41091911d35279ef\nAuthor: John Garbutt <email address hidden>\nDate:   Wed May 7 19:32:14 2014 +0100\n\n    xenapi: fix live-migrate with volume attached\n    \n    We need to attach the volume SR on the destination host during\n    pre-live-migrate, so XenAPI spots the volume is present, and does't try\n    to block migrate the volume to the destination host, instead it just\n    connects to the remote volume before resuming the VM on the destination\n    host.\n    \n    The fix is done by calling connect_volume instead of attach_volume. The\n    None passed into instance was causing the lookup of the vm_ref to\n    (correctly) fail, with:\n    Failure: ['FIELD_TYPE_ERROR', 'label']\n    \n    Change-Id: I7eaf90582508b42a202da79072c891c216d137d1\n    Closes-Bug: #1317208\n", 
            "date_created": "2014-05-27 03:07:11.575044+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}