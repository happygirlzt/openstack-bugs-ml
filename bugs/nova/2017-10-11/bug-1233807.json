{
    "status": "Invalid", 
    "last_updated": "2013-10-04 20:28:52.403537+00:00", 
    "description": "It looks like nova-api is calling aggregate_metadata_get_by_host via conductor.\n\nnova-api has access to to the DB so no reason to use conductor\n\nFrom devstack:\n\n2013-10-01 16:57:35.856 DEBUG nova.api.ec2 [req-9e08da97-2f00-4d0f-b645-e638009df417 demo demo] arg: InstanceId.1\t\tval: i-00000014 __call__ /opt/stack/new/nova/nova/api/ec2/__init__.py:328\n2013-10-01 16:57:35.917 DEBUG nova.openstack.common.rpc.amqp [req-6dfd54f4-ffac-425f-9aa9-deb5666616cb None None] Making synchronous call on conductor ... multicall /opt/stack/new/nova/nova/openstack/common/rpc/amqp.py:553\n2013-10-01 16:57:35.918 DEBUG nova.openstack.common.rpc.amqp [req-6dfd54f4-ffac-425f-9aa9-deb5666616cb None None] MSG_ID is a119b074c3594ea79a2c51f9aa7103e3 multicall /opt/stack/new/nova/nova/openstack/common/rpc/amqp.py:556\n2013-10-01 16:57:35.918 DEBUG nova.openstack.common.rpc.amqp [req-6dfd54f4-ffac-425f-9aa9-deb5666616cb None None] UNIQUE_ID is 87bd8d5b142949989a9aa7f3ddf0d60d. _add_unique_id /opt/stack/new/nova/nova/openstack/common/rpc/amqp.py:341\n2013-10-01 16:57:35.920 1344 DEBUG amqp [-] Closed channel #1 _do_close /usr/local/lib/python2.7/dist-packages/amqp/channel.py:88\n\nhttp://logs.openstack.org/98/49198/1/check/check-tempest-devstack-vm-neutron/e3cd6d8/logs/screen-n-api.txt.gz#_2013-10-01_16_57_35_917\n\n\n2013-10-01 16:57:35.920 2453 DEBUG nova.openstack.common.rpc.amqp [-] received {u'_msg_id': u'a119b074c3594ea79a2c51f9aa7103e3', u'_context_quota_class': None, u'_context_request_id': u'req-00b30081-1bfa-4ebc-ac6e-6883dc353d61', u'_context_service_catalog': [], u'_context_auth_token': '<SANITIZED>', u'_context_user_id': None, u'_reply_q': u'reply_8c54921e1e344d4e8a738ea13a2006ae', u'namespace': None, u'_context_is_admin': True, u'version': u'1.42', u'_context_timestamp': u'2013-10-01T16:57:35.917069', u'_context_user': None, u'method': u'aggregate_metadata_get_by_host', u'_context_remote_address': None, u'_context_roles': [], u'args': {u'host': u'devstack-precise-check-rax-ord-434176.slave.openstack.org', u'key': u'availability_zone'}, u'_unique_id': u'87bd8d5b142949989a9aa7f3ddf0d60d', u'_context_project_name': None, u'_context_read_deleted': u'no', u'_context_tenant': None, u'_context_instance_lock_checked': False, u'_context_project_id': None, u'_context_user_name': None} _safe_log /opt/stack/new/nova/nova/openstack/common/rpc/common.py:277\n2013-10-01 16:57:35.921 2453 DEBUG nova.openstack.common.rpc.amqp [-] unpacked context: {'tenant': None, 'project_name': None, 'user_id': None, 'roles': [], 'timestamp': u'2013-10-01T16:57:35.917069', 'auth_token': '<SANITIZED>', 'remote_address': None, 'quota_class': None, 'is_admin': True, 'user': None, 'service_catalog': [], 'request_id': u'req-00b30081-1bfa-4ebc-ac6e-6883dc353d61', 'instance_lock_checked': False, 'project_id': None, 'user_name': None, 'read_deleted': u'no'} _safe_log /opt/stack/new/nova/nova/openstack/common/rpc/common.py:277\n2013-10-01 16:57:35.926 DEBUG nova.openstack.common.rpc.amqp [req-00b30081-1bfa-4ebc-ac6e-6883dc353d61 None None] UNIQUE_ID is c08fca49e0194795809267ae6aad40ee. _add_unique_id /opt/stack/new/nova/nova/openstack/common/rpc/amqp.py:341\n\n\nhttp://logs.openstack.org/98/49198/1/check/check-tempest-devstack-vm-neutron/e3cd6d8/logs/screen-n-cond.txt.gz#_2013-10-01_16_57_35_920", 
    "tags": [
        "conductor", 
        "ec2", 
        "testing"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1233807", 
    "owner": "None", 
    "id": 1233807, 
    "index": 4140, 
    "created": "2013-10-01 18:50:50.229138+00:00", 
    "title": "nova-api  EC2 API is making synchronous calls to conductor", 
    "comments": [
        {
            "content": "It looks like nova-api is calling aggregate_metadata_get_by_host via conductor.\n\nnova-api has access to to the DB so no reason to use conductor\n\nFrom devstack:\n\n2013-10-01 16:57:35.856 DEBUG nova.api.ec2 [req-9e08da97-2f00-4d0f-b645-e638009df417 demo demo] arg: InstanceId.1\t\tval: i-00000014 __call__ /opt/stack/new/nova/nova/api/ec2/__init__.py:328\n2013-10-01 16:57:35.917 DEBUG nova.openstack.common.rpc.amqp [req-6dfd54f4-ffac-425f-9aa9-deb5666616cb None None] Making synchronous call on conductor ... multicall /opt/stack/new/nova/nova/openstack/common/rpc/amqp.py:553\n2013-10-01 16:57:35.918 DEBUG nova.openstack.common.rpc.amqp [req-6dfd54f4-ffac-425f-9aa9-deb5666616cb None None] MSG_ID is a119b074c3594ea79a2c51f9aa7103e3 multicall /opt/stack/new/nova/nova/openstack/common/rpc/amqp.py:556\n2013-10-01 16:57:35.918 DEBUG nova.openstack.common.rpc.amqp [req-6dfd54f4-ffac-425f-9aa9-deb5666616cb None None] UNIQUE_ID is 87bd8d5b142949989a9aa7f3ddf0d60d. _add_unique_id /opt/stack/new/nova/nova/openstack/common/rpc/amqp.py:341\n2013-10-01 16:57:35.920 1344 DEBUG amqp [-] Closed channel #1 _do_close /usr/local/lib/python2.7/dist-packages/amqp/channel.py:88\n\nhttp://logs.openstack.org/98/49198/1/check/check-tempest-devstack-vm-neutron/e3cd6d8/logs/screen-n-api.txt.gz#_2013-10-01_16_57_35_917\n\n\n2013-10-01 16:57:35.920 2453 DEBUG nova.openstack.common.rpc.amqp [-] received {u'_msg_id': u'a119b074c3594ea79a2c51f9aa7103e3', u'_context_quota_class': None, u'_context_request_id': u'req-00b30081-1bfa-4ebc-ac6e-6883dc353d61', u'_context_service_catalog': [], u'_context_auth_token': '<SANITIZED>', u'_context_user_id': None, u'_reply_q': u'reply_8c54921e1e344d4e8a738ea13a2006ae', u'namespace': None, u'_context_is_admin': True, u'version': u'1.42', u'_context_timestamp': u'2013-10-01T16:57:35.917069', u'_context_user': None, u'method': u'aggregate_metadata_get_by_host', u'_context_remote_address': None, u'_context_roles': [], u'args': {u'host': u'devstack-precise-check-rax-ord-434176.slave.openstack.org', u'key': u'availability_zone'}, u'_unique_id': u'87bd8d5b142949989a9aa7f3ddf0d60d', u'_context_project_name': None, u'_context_read_deleted': u'no', u'_context_tenant': None, u'_context_instance_lock_checked': False, u'_context_project_id': None, u'_context_user_name': None} _safe_log /opt/stack/new/nova/nova/openstack/common/rpc/common.py:277\n2013-10-01 16:57:35.921 2453 DEBUG nova.openstack.common.rpc.amqp [-] unpacked context: {'tenant': None, 'project_name': None, 'user_id': None, 'roles': [], 'timestamp': u'2013-10-01T16:57:35.917069', 'auth_token': '<SANITIZED>', 'remote_address': None, 'quota_class': None, 'is_admin': True, 'user': None, 'service_catalog': [], 'request_id': u'req-00b30081-1bfa-4ebc-ac6e-6883dc353d61', 'instance_lock_checked': False, 'project_id': None, 'user_name': None, 'read_deleted': u'no'} _safe_log /opt/stack/new/nova/nova/openstack/common/rpc/common.py:277\n2013-10-01 16:57:35.926 DEBUG nova.openstack.common.rpc.amqp [req-00b30081-1bfa-4ebc-ac6e-6883dc353d61 None None] UNIQUE_ID is c08fca49e0194795809267ae6aad40ee. _add_unique_id /opt/stack/new/nova/nova/openstack/common/rpc/amqp.py:341\n\n\nhttp://logs.openstack.org/98/49198/1/check/check-tempest-devstack-vm-neutron/e3cd6d8/logs/screen-n-cond.txt.gz#_2013-10-01_16_57_35_920", 
            "date_created": "2013-10-01 18:50:50.229138+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "The method being called here is:\n\n    u'aggregate_metadata_get_by_host'\n\nnova.api.metadata.base calls:\n\n         self.availability_zone = ec2utils.get_availability_zone_by_host(\n                instance['host'], capi)\n\nSo, the metadata server will correct use the conductor, and it goes through some ec2 related code to get there.  Perhaps that's causing confusion here?  It sounds like it's working as expected here.", 
            "date_created": "2013-10-04 20:26:15.880882+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "Also note that if you don't want the metadata server using remote conductor, it should honor the use_local option for conductor in nova.conf", 
            "date_created": "2013-10-04 20:28:51.238500+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }
    ]
}