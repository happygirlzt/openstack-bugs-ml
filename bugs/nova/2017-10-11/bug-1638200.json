{
    "status": "Fix Released", 
    "last_updated": "2016-12-19 12:02:01.302582+00:00", 
    "description": "Description\n===========\nFailed to boot vm with pci_alias's name including space in nova.conf.\n\n\nSteps to reproduce\n==================\n1.modify the key pci_alias, pci_passthrough_whitelist and scheduler_default_filters in /etc/nova/nova.conf\npci_alias = {\"name\": \"Cirrus Logic\", \"product_id\": \"0ff2\", \"vendor_id\": \"10de\"}\npci_passthrough_whitelist = [{\"product_id\": \"0ff2\", \"vendor_id\": \"10de\"}]\nscheduler_default_filters = ...,PciPassthroughFilter\n\n2.restart nova-api, nova-scheduler, nova-conductor, nova-compute serivces\n\n3.update a flavor's metadata with command\nnova flavor-key  m1.tiny set \"pci_passthrough:alias\"=\"Cirrus Logic:1\"\n\n4.create instance with command\nnova boot --flavor m1.tiny --image cirror --nic net-id=xxxxxxxxx vm_name\n\n\nExpected result\n===============\nThere will be a vm with gpu passthrough.\n\n\nActual result\n=============\nFailed to boot vm.\nError occurs in nova-api.log\n\n\nEnvironment\n===========\n1. Devstack with newton version\n\n\nLogs\n==============\n2016-11-01 12:13:27.523 ^[[01;31mERROR nova.api.openstack.extensions [^[[01;36mreq-82f58a79-76b9-49e7-a8e9-44e8b43eaea4 ^[[00;36madmin admin^[[01;31m] ^[[01;35m^[[01;31mUnexpected exception in API method^[[00m\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00mTraceback (most recent call last):\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 478, in wrapped\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    return f(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    return func(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    return func(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    return func(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 629, in create\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    **create_kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    rv = f(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 1563, in create\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    check_server_group_quota=check_server_group_quota)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 1146, in _create_instance\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    reservation_id, max_count)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 871, in _validate_and_build_base_options\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    instance_type)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/pci/request.py\", line 177, in get_pci_requests_from_flavor\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    flavor['extra_specs']['pci_passthrough:alias'])\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/pci/request.py\", line 129, in _translate_alias_to_requests\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    raise exception.PciRequestAliasNotDefined(alias=name)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00mPciRequestAliasNotDefined: PCI alias CirrusLogic is not defined\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m\n2016-11-01 12:13:27.527 ^[[00;36mINFO nova.api.openstack.wsgi [^[[01;36mreq-82f58a79-76b9-49e7-a8e9-44e8b43eaea4 ^[[00;36madmin admin^[[00;36m] ^[[01;35m^[[00;36mHTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.<class 'nova.exception.PciRequestAliasNotDefined'>^[[00m", 
    "tags": [
        "pci"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1638200", 
    "owner": "https://api.launchpad.net/1.0/~xuhj", 
    "id": 1638200, 
    "index": 846, 
    "created": "2016-11-01 08:01:59.328162+00:00", 
    "title": "Failed to boot vm with pci_alias's name including space in nova.conf", 
    "comments": [
        {
            "content": "Description\n===========\nFailed to boot vm with pci_alias's name including space in nova.conf.\n\n\nSteps to reproduce\n==================\n1.modify the key pci_alias, pci_passthrough_whitelist and scheduler_default_filters in /etc/nova/nova.conf\npci_alias = {\"name\": \"Cirrus Logic\", \"product_id\": \"0ff2\", \"vendor_id\": \"10de\"}\npci_passthrough_whitelist = [{\"product_id\": \"0ff2\", \"vendor_id\": \"10de\"}]\nscheduler_default_filters = ...,PciPassthroughFilter\n\n2.restart nova-api, nova-scheduler, nova-conductor, nova-compute serivces\n\n3.update a flavor's metadata with command\nnova flavor-key  m1.tiny set \"pci_passthrough:alias\"=\"Cirrus Logic:1\"\n\n4.create instance with command\nnova boot --flavor m1.tiny --image cirror --nic net-id=xxxxxxxxx vm_name\n\n\nExpected result\n===============\nThere will be a vm with gpu passthrough.\n\n\nActual result\n=============\nFailed to boot vm.\nError occurs in nova-api.log\n\n\nEnvironment\n===========\n1. Devstack with newton version\n\n\nLogs\n==============\n2016-11-01 12:13:27.523 ^[[01;31mERROR nova.api.openstack.extensions [^[[01;36mreq-82f58a79-76b9-49e7-a8e9-44e8b43eaea4 ^[[00;36madmin admin^[[01;31m] ^[[01;35m^[[01;31mUnexpected exception in API method^[[00m\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00mTraceback (most recent call last):\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 478, in wrapped\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    return f(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    return func(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    return func(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    return func(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 629, in create\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    **create_kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    rv = f(*args, **kwargs)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 1563, in create\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    check_server_group_quota=check_server_group_quota)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 1146, in _create_instance\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    reservation_id, max_count)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 871, in _validate_and_build_base_options\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    instance_type)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/pci/request.py\", line 177, in get_pci_requests_from_flavor\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    flavor['extra_specs']['pci_passthrough:alias'])\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/pci/request.py\", line 129, in _translate_alias_to_requests\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m    raise exception.PciRequestAliasNotDefined(alias=name)\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00mPciRequestAliasNotDefined: PCI alias CirrusLogic is not defined\n^[[01;31m2016-11-01 12:13:27.523 TRACE nova.api.openstack.extensions ^[[01;35m^[[00m\n2016-11-01 12:13:27.527 ^[[00;36mINFO nova.api.openstack.wsgi [^[[01;36mreq-82f58a79-76b9-49e7-a8e9-44e8b43eaea4 ^[[00;36madmin admin^[[00;36m] ^[[01;35m^[[00;36mHTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.<class 'nova.exception.PciRequestAliasNotDefined'>^[[00m", 
            "date_created": "2016-11-01 08:01:59.328162+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhaolh"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/392077", 
            "date_created": "2016-11-01 08:44:38.732455+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/392077\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9b88e755d93200811487d2f778735869f8fe07af\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9b88e755d93200811487d2f778735869f8fe07af\nAuthor: zhaolihui <email address hidden>\nDate:   Tue Nov 1 16:09:04 2016 +0800\n\n    Fix pci_alias that include white spaces\n    \n    When the PCI alias was getting translated to a PCI request,\n    all the white spaces were getting removed. So the pci_passthrough:alias\n    specified in the flavor never matched the device in pci_alias.\n    This patch fixes the bug by only stripping the white spaces\n    at the beginning or the end of the elements\n    \n    Change-Id: I2888b03faf6c25bcb6011db40100d925972c2231\n    Closes-Bug: #1638200\n", 
            "date_created": "2016-12-02 09:23:06.882726+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/406075", 
            "date_created": "2016-12-02 11:32:32.250663+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/406075\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e58af8e32d415e112e491abce9f4e8b8d882fb80\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit e58af8e32d415e112e491abce9f4e8b8d882fb80\nAuthor: zhaolihui <email address hidden>\nDate:   Tue Nov 1 16:09:04 2016 +0800\n\n    Fix pci_alias that include white spaces\n    \n    When the PCI alias was getting translated to a PCI request,\n    all the white spaces were getting removed. So the pci_passthrough:alias\n    specified in the flavor never matched the device in pci_alias.\n    This patch fixes the bug by only stripping the white spaces\n    at the beginning or the end of the elements\n    \n    Conflicts:\n      nova/tests/unit/pci/test_request.py\n    \n    NOTE(lyarwood): Test conflict caused by the reorganisation of PCI options\n    as part of I886045ab4e6bdb8418fd1ccdcd811417ecb4ad4a.\n    \n    Change-Id: I2888b03faf6c25bcb6011db40100d925972c2231\n    Closes-Bug: #1638200\n    (cherry picked from commit 9b88e755d93200811487d2f778735869f8fe07af)\n", 
            "date_created": "2016-12-09 18:26:10.428841+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b2 development milestone.", 
            "date_created": "2016-12-15 17:34:47.552975+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.3 release.", 
            "date_created": "2016-12-19 12:02:00.625553+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}