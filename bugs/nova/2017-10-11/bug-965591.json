{
    "status": "Invalid", 
    "last_updated": "2012-04-12 22:59:52.610918+00:00", 
    "description": "\nGiven a security group\n\n$ euca-describe-group juju-stack\nGROUP   kapil_project   juju-stack      juju group for stack\nPERMISSION      kapil_project   juju-stack      ALLOWS  tcp     22      22      FROM    CIDR    0.0.0.0/0\nPERMISSION      kapil_project   juju-stack      ALLOWS  icmp    -1      -1      GRPNAME juju-stack\nPERMISSION      kapil_project   juju-stack      ALLOWS  tcp     1       65535   GRPNAME juju-stack\nPERMISSION      kapil_project   juju-stack      ALLOWS  udp     1       65536   GRPNAME juju-stack\n\nAnd an attempt to launch an instance with that group\n\n$ euca-run-instances -k kapil -t m1.small -g juju-stack ami-00000078\n\nWill always result in a failure to launch the instance, it transitions from pending to error.\n\n$ euca-describe-instances\n\nRESERVATION     r-ssme0x7j      kapil_project   juju-stack\nINSTANCE        i-00001ceb      ami-00000078    server-7403     server-7403     error   kapil   0               m1.small        2012-03-26T18:40:18Z    nova                            monitoring-disabled         instance-store", 
    "tags": [
        "canonistack"
    ], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/965591", 
    "owner": "None", 
    "id": 965591, 
    "index": 2725, 
    "created": "2012-03-26 18:48:06.161174+00:00", 
    "title": "failure to launch instance with self-referential security group", 
    "comments": [
        {
            "content": "\nGiven a security group\n\n$ euca-describe-group juju-stack\nGROUP   kapil_project   juju-stack      juju group for stack\nPERMISSION      kapil_project   juju-stack      ALLOWS  tcp     22      22      FROM    CIDR    0.0.0.0/0\nPERMISSION      kapil_project   juju-stack      ALLOWS  icmp    -1      -1      GRPNAME juju-stack\nPERMISSION      kapil_project   juju-stack      ALLOWS  tcp     1       65535   GRPNAME juju-stack\nPERMISSION      kapil_project   juju-stack      ALLOWS  udp     1       65536   GRPNAME juju-stack\n\nAnd an attempt to launch an instance with that group\n\n$ euca-run-instances -k kapil -t m1.small -g juju-stack ami-00000078\n\nWill always result in a failure to launch the instance, it transitions from pending to error.\n\n$ euca-describe-instances\n\nRESERVATION     r-ssme0x7j      kapil_project   juju-stack\nINSTANCE        i-00001ceb      ami-00000078    server-7403     server-7403     error   kapil   0               m1.small        2012-03-26T18:40:18Z    nova                            monitoring-disabled         instance-store", 
            "date_created": "2012-03-26 18:48:06.161174+00:00", 
            "author": "https://api.launchpad.net/1.0/~hazmat"
        }, 
        {
            "content": "These are the tracebacks we're seeing when this bug is invoked.\n\n2012-03-26 19:21:28 ERROR nova.compute.manager [-] [instance: 2967f7b5-ae4a-4511-a8b0-10f330b7d5df] Instance failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 592, in _spawn\n(nova.compute.manager): TRACE:     self._legacy_nw_info(network_info), block_device_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n(nova.compute.manager): TRACE:     return f(*args, **kw)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 926, in spawn\n(nova.compute.manager): TRACE:     self.firewall_driver.prepare_instance_filter(instance, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 136, in prepare_instance_filter\n(nova.compute.manager): TRACE:     self.add_filters_for_instance(instance)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 178, in add_filters_for_instance\n(nova.compute.manager): TRACE:     ipv4_rules, ipv6_rules = self.instance_rules(instance, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 334, in instance_rules\n(nova.compute.manager): TRACE:     ips.extend(net[1]['ips'])\n(nova.compute.manager): TRACE: KeyError: 1\n(nova.compute.manager): TRACE:\n\nThen again when trying to deallocate the network for the instance.\n\n2012-03-26 19:21:28 DEBUG nova.compute.manager [-] [instance: 2967f7b5-ae4a-4511-a8b0-10f330b7d5df] Deallocating network for instance from (pid=32203) _deallocate_network /usr/lib/python2.7/dist-packages/nova/compute/manager.py:616\n2012-03-26 19:21:28 DEBUG nova.rpc.amqp [-] Making asynchronous cast on network... from (pid=32203) cast /usr/lib/python2.7/dist-packages/nova/rpc/amqp.py:346\n2012-03-26 19:21:28 ERROR nova.rpc.amqp [-] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 648, in run_instance\n(nova.rpc.amqp): TRACE:     self._run_instance(context, instance_uuid, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 451, in _run_instance\n(nova.rpc.amqp): TRACE:     self._set_instance_error_state(context, instance_uuid)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 432, in _run_instance\n(nova.rpc.amqp): TRACE:     self._deallocate_network(context, instance)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 429, in _run_instance\n(nova.rpc.amqp): TRACE:     injected_files, admin_password)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 592, in _spawn\n(nova.rpc.amqp): TRACE:     self._legacy_nw_info(network_info), block_device_info)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 926, in spawn\n(nova.rpc.amqp): TRACE:     self.firewall_driver.prepare_instance_filter(instance, network_info)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 136, in prepare_instance_filter\n(nova.rpc.amqp): TRACE:     self.add_filters_for_instance(instance)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 178, in add_filters_for_instance\n(nova.rpc.amqp): TRACE:     ipv4_rules, ipv6_rules = self.instance_rules(instance, network_info)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 334, in instance_rules\n(nova.rpc.amqp): TRACE:     ips.extend(net[1]['ips'])\n(nova.rpc.amqp): TRACE: KeyError: 1\n(nova.rpc.amqp): TRACE:", 
            "date_created": "2012-03-26 19:28:53.421982+00:00", 
            "author": "https://api.launchpad.net/1.0/~deej"
        }, 
        {
            "content": "I can't replicate this issue with current trunk, but i did find another issue with self-referential groups in the openstack api:\n\nhttps://bugs.launchpad.net/nova/+bug/965674\n", 
            "date_created": "2012-03-26 20:53:18.264075+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ]
}