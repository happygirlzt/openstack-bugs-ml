{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:42:14.130192+00:00", 
    "description": "[root@camel-nova nova]# nova volume-create 10\n\n[root@camel-nova nova]# tgt-admin --show ALL\nTarget 1: iqn.2010-10.org.openstack:volume-0000000e\n    System information:\n        Driver: iscsi\n        State: ready\n    I_T nexus information:\n    LUN information:\n        LUN: 0\n            Type: controller\n            SCSI ID: IET     00010000\n            SCSI SN: beaf10\n            Size: 0 MB, Block size: 1\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            Backing store type: null\n            Backing store path: None\n            Backing store flags: \n        LUN: 1\n            Type: disk\n            SCSI ID: IET     00010001\n            SCSI SN: beaf11\n            Size: 10737 MB, Block size: 512\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            Backing store type: rdwr\n            Backing store path: /dev/nova-volumes/volume-0000000e\n            Backing store flags: \n    Account information:\n    ACL information:\n        ALL\nTarget 3: iqn.2010-10.org.openstack:volume-0000000b\n    System information:\n        Driver: iscsi\n        State: ready\n    I_T nexus information:\n    LUN information:\n        LUN: 0\n            Type: controller\n            SCSI ID: IET     00030000\n            SCSI SN: beaf30\n            Size: 0 MB, Block size: 1\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            Backing store type: null\n            Backing store path: None\n            Backing store flags: \n        LUN: 1\n            Type: disk\n            SCSI ID: IET     00030001\n            SCSI SN: beaf31\n            Size: 2147 MB, Block size: 512\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            Backing store type: rdwr\n            Backing store path: /dev/nova-volumes/volume-0000000b\n            Backing store flags: \n    Account information:\n    ACL information:\n        ALL\n[root@camel-nova nova]# /etc/init.d/tgtd restart\nStopping SCSI target daemon:                               [  OK  ]\nStarting SCSI target daemon:                               [  OK  ]\n[root@camel-nova nova]# tgt-admin --show ALL\n[root@camel-nova nova]# \n\n[root@camel-nova nova]# nova volume-attach toattach 14 /dev/vdc\n\n2012-06-10 16:18:08 ERROR nova.rpc.amqp [req-9e485674-61b2-4d6b-9a28-119636879512 2f4edfa99cab42de92eacda360043116 7eed65dd55474b9e94cd412d9f66b406] Exception during message handling\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 153, in decorated_function\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     function(self, context, instance_uuid, *args, **kwargs)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 177, in decorated_function\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     sys.exc_info())\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 171, in decorated_function\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1729, in attach_volume\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     connector)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1721, in attach_volume\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     mountpoint)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 532, in attach_volume\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     mount_device)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 524, in volume_driver_method\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     return method(connection_info, *args, **kwargs)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 946, in inner\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     retval = f(*args, **kwargs)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/volume.py\", line 153, in connect_volume\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     check_exit_code=[0, 255])\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/volume.py\", line 110, in _run_iscsiadm\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     check_exit_code=check_exit_code)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n2012-06-10 16:18:08 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Command: sudo nova-rootwrap iscsiadm -m node -T iqn.2010-10.org.openstack:volume-0000000e -p 10.35.97.20:3260 --login\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Exit code: 19\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Stdout: 'Logging in to [iface: default, target: iqn.2010-10.org.openstack:volume-0000000e, portal: 10.35.97.20,3260] (multiple)\\n'\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Stderr: 'iscsiadm: Could not login to [iface: default, target: iqn.2010-10.org.openstack:volume-0000000e, portal: 10.35.97.20,3260].\\niscsiadm: initiator reported error (19 - encountered non-retryable iSCSI login failure)\\niscsiadm: Could not log into all portals\\n'\n2012-06-10 16:18:08 TRACE nova.rpc.amqp", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1011159", 
    "owner": "https://api.launchpad.net/1.0/~zulcss", 
    "id": 1011159, 
    "index": 2873, 
    "created": "2012-06-10 13:22:18.845752+00:00", 
    "title": "[Nova-volume][tgtd] targets are not persistent", 
    "comments": [
        {
            "content": "[root@camel-nova nova]# nova volume-create 10\n\n[root@camel-nova nova]# tgt-admin --show ALL\nTarget 1: iqn.2010-10.org.openstack:volume-0000000e\n    System information:\n        Driver: iscsi\n        State: ready\n    I_T nexus information:\n    LUN information:\n        LUN: 0\n            Type: controller\n            SCSI ID: IET     00010000\n            SCSI SN: beaf10\n            Size: 0 MB, Block size: 1\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            Backing store type: null\n            Backing store path: None\n            Backing store flags: \n        LUN: 1\n            Type: disk\n            SCSI ID: IET     00010001\n            SCSI SN: beaf11\n            Size: 10737 MB, Block size: 512\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            Backing store type: rdwr\n            Backing store path: /dev/nova-volumes/volume-0000000e\n            Backing store flags: \n    Account information:\n    ACL information:\n        ALL\nTarget 3: iqn.2010-10.org.openstack:volume-0000000b\n    System information:\n        Driver: iscsi\n        State: ready\n    I_T nexus information:\n    LUN information:\n        LUN: 0\n            Type: controller\n            SCSI ID: IET     00030000\n            SCSI SN: beaf30\n            Size: 0 MB, Block size: 1\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            Backing store type: null\n            Backing store path: None\n            Backing store flags: \n        LUN: 1\n            Type: disk\n            SCSI ID: IET     00030001\n            SCSI SN: beaf31\n            Size: 2147 MB, Block size: 512\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            Backing store type: rdwr\n            Backing store path: /dev/nova-volumes/volume-0000000b\n            Backing store flags: \n    Account information:\n    ACL information:\n        ALL\n[root@camel-nova nova]# /etc/init.d/tgtd restart\nStopping SCSI target daemon:                               [  OK  ]\nStarting SCSI target daemon:                               [  OK  ]\n[root@camel-nova nova]# tgt-admin --show ALL\n[root@camel-nova nova]# \n\n[root@camel-nova nova]# nova volume-attach toattach 14 /dev/vdc\n\n2012-06-10 16:18:08 ERROR nova.rpc.amqp [req-9e485674-61b2-4d6b-9a28-119636879512 2f4edfa99cab42de92eacda360043116 7eed65dd55474b9e94cd412d9f66b406] Exception during message handling\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 153, in decorated_function\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     function(self, context, instance_uuid, *args, **kwargs)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 177, in decorated_function\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     sys.exc_info())\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 171, in decorated_function\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1729, in attach_volume\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     connector)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1721, in attach_volume\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     mountpoint)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 532, in attach_volume\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     mount_device)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 524, in volume_driver_method\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     return method(connection_info, *args, **kwargs)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 946, in inner\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     retval = f(*args, **kwargs)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/volume.py\", line 153, in connect_volume\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     check_exit_code=[0, 255])\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/volume.py\", line 110, in _run_iscsiadm\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     check_exit_code=check_exit_code)\n2012-06-10 16:18:08 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n2012-06-10 16:18:08 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n2012-06-10 16:18:08 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Command: sudo nova-rootwrap iscsiadm -m node -T iqn.2010-10.org.openstack:volume-0000000e -p 10.35.97.20:3260 --login\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Exit code: 19\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Stdout: 'Logging in to [iface: default, target: iqn.2010-10.org.openstack:volume-0000000e, portal: 10.35.97.20,3260] (multiple)\\n'\n2012-06-10 16:18:08 TRACE nova.rpc.amqp Stderr: 'iscsiadm: Could not login to [iface: default, target: iqn.2010-10.org.openstack:volume-0000000e, portal: 10.35.97.20,3260].\\niscsiadm: initiator reported error (19 - encountered non-retryable iSCSI login failure)\\niscsiadm: Could not log into all portals\\n'\n2012-06-10 16:18:08 TRACE nova.rpc.amqp", 
            "date_created": "2012-06-10 13:22:18.845752+00:00", 
            "author": "https://api.launchpad.net/1.0/~davidnaori3"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/10414", 
            "date_created": "2012-07-27 15:52:55.389363+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/10414\nCommitted: http://github.com/openstack/nova/commit/1ba3dfec786c60e53ceb3b682bcf927224102a0b\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1ba3dfec786c60e53ceb3b682bcf927224102a0b\nAuthor: Chuck Short <email address hidden>\nDate:   Fri Jul 27 10:25:51 2012 -0500\n\n    Add persistent volumes for tgtd.\n    \n    Currently if you restart the server running nova-volume\n    or restart tgt, you will loose your iscsi targets that\n    have been created. This is not good.\n    \n    In order for iscsi targets to be persistent across\n    reboots or restarts, one has to have the target's configuration\n    information in /etc/tgt/targets.conf or /etc/tgt/conf.d.\n    So when tgtd is restarted then the iscsi targets will be there\n    as expected.\n    \n    This patch will add a configuration file to $state_path/volumes\n    when the volume is created. The configuration file is identified by\n    the volume uuid. It creates a logicalunit when the volume is created\n    as well. The iscsi target and configuration file\n    will be removed once the volume has been removed as well.\n    \n    In order to use this, you have to include the following in\n    your /etc/tgt/targets.conf\n    \n    include $state_path/volumes/*\n    \n    For upgrades, it will just re-create the volumes\n    already in the volumes table.\n    \n    Fixes LP: #1011159\n    \n    Change-Id: I38fc096ab881ccb52cb688ae46d9d36b0a7b3a45\n    Signed-off-by: Chuck Short <email address hidden>\n", 
            "date_created": "2012-07-28 03:56:01.273603+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Chuck Short has submitted https://review.openstack.org/#/c/10417/ to address this on Cinder\r\n\r\nWe're currently waiting for the needed devstack change to land:\r\nhttps://review.openstack.org/#/c/10467/\r\n\r\nAfter this jenkins/gate jobs should pass and fix can be merged.", 
            "date_created": "2012-08-01 17:26:57.595425+00:00", 
            "author": "https://api.launchpad.net/1.0/~john-griffith"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/10417\nCommitted: http://github.com/openstack/cinder/commit/c401895f8f2b6f1693601f7996da88d7b3d45fa0\nSubmitter: Jenkins\nBranch:    master\n\ncommit c401895f8f2b6f1693601f7996da88d7b3d45fa0\nAuthor: Chuck Short <email address hidden>\nDate:   Fri Jul 27 12:05:55 2012 -0500\n\n    Add persistent volumes for tgtd.\n    \n    Currently if you restart the server running nova-volume\n    or restart tgt, you will loose your iscsi targets that\n    have been created. This is not good.\n    \n    In order for iscsi targets to be persistent across\n    reboots or restarts, one has to have the target's configuration\n    information in /etc/tgt/targets.conf or /etc/tgt/conf.d.\n    So when tgtd is restarted then the iscsi targets will be there\n    as expected.\n    \n    This patch will add a configuration file to $state_path/volumes\n    when the volume is created. The configuration file is identified by\n    the volume uuid. It creates a logicalunit when the volume is created\n    as well. The iscsi target and configuration file\n    will be removed once the volume has been removed as well.\n    \n    In order to use this, you have to include the following in\n    your /etc/tgt/targets.conf\n    \n    include $state_path/volumes/*\n    \n    For upgrades, it will just re-create the volumes\n    already in the volumes table.\n    \n    Fixes LP: #1011159\n    \n    Change-Id: Ib74dcc1efa0332842041b4c045ca5fa85d4a32ca\n    Signed-off-by: Chuck Short <email address hidden>\n", 
            "date_created": "2012-08-07 04:09:05.034908+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This patch looks broken with ISCSIDriver/TgtAdm for us. (d2babbfd4b59bde09fe17f7b69c86d857a82d104)\nAnyone else?", 
            "date_created": "2012-08-17 05:38:51.910472+00:00", 
            "author": "https://api.launchpad.net/1.0/~yosshy"
        }
    ]
}