{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:36:53.308716+00:00", 
    "description": "When I boot an instance that failed by image size bigger than flavor size, then nova begin to reschedule the instance infinitely.\n\n$ glance index\nID                                   Name                           Disk Format          Container Format     Size          \n------------------------------------ ------------------------------ -------------------- -------------------- --------------\n0d366543-54de-48dd-8f49-d62cac6e7c6b Fedora-x86_64-20-20131211.1-sd qcow2                bare                      214106112\n\n$ nova boot --flavor 1 --image 0d366543-54de-48dd-8f49-d62cac6e7c6b --nic net-id=c2d921a0-1474-4731-a8b5-c1cc8b9069f4 vm1\n+--------------------------------------+------------------------------------------------------------------------+\n| Property                             | Value                                                                  |\n+--------------------------------------+------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                 |\n| OS-EXT-AZ:availability_zone          | nova                                                                   |\n| OS-EXT-SRV-ATTR:host                 | -                                                                      |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                                      |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000002b                                                      |\n| OS-EXT-STS:power_state               | 0                                                                      |\n| OS-EXT-STS:task_state                | -                                                                      |\n| OS-EXT-STS:vm_state                  | building                                                               |\n| OS-SRV-USG:launched_at               | -                                                                      |\n| OS-SRV-USG:terminated_at             | -                                                                      |\n| accessIPv4                           |                                                                        |\n| accessIPv6                           |                                                                        |\n| adminPass                            | 8a7ru8z7bUQ6                                                           |\n| config_drive                         |                                                                        |\n| created                              | 2014-06-04T03:24:38Z                                                   |\n| flavor                               | m1.tiny (1)                                                            |\n| hostId                               |                                                                        |\n| id                                   | cd5a4327-d3ee-45bb-95fa-da7817b3b0b9                                   |\n| image                                | Fedora-x86_64-20-20131211.1-sda (0d366543-54de-48dd-8f49-d62cac6e7c6b) |\n| key_name                             | -                                                                      |\n| metadata                             | {}                                                                     |\n| name                                 | vm1                                                                    |\n| os-extended-volumes:volumes_attached | []                                                                     |\n| progress                             | 0                                                                      |\n| security_groups                      | default                                                                |\n| status                               | BUILD                                                                  |\n| tenant_id                            | ac99aeb3fbb24494b3bbb68a8e94cbff                                       |\n| updated                              | 2014-06-04T03:24:38Z                                                   |\n| user_id                              | 2c08e17d6fb54dea96cc6d70ba0ee75f                                       |\n+--------------------------------------+------------------------------------------------------------------------+\n\n\n\nThe first error at compute node:\n\n2014-06-04 11:24:58.121 ERROR nova.virt.libvirt.imagebackend [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] /opt/stack/data/nova/instances/_base/d1a823\nd9305ec292d5f3e13da6755ee8f057b01e virtual size 2147483648 larger than flavor root disk size 1073741824\n2014-06-04 11:24:58.121 ERROR nova.compute.manager [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] Inst\nance failed to spawn\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] Traceback (most recent call last):\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/compute/manager.py\", line 2059, in _build_resources\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     yield resources\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/compute/manager.py\", line 1962, in _build_and_run_instance\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     block_device_info=block_device_info)\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2281, in spawn\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     admin_pass=admin_password)\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2655, in _create_image\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     project_id=instance['project_id'])\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 192, in cache\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     *args, **kwargs)\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 386, in create_image\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     self.verify_base_size(base, size)\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 243, in verify_base_size\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     raise exception.FlavorDiskTooSmall()\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] FlavorDiskTooSmall: Flavor's disk is too small for requested image.\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] \n2014-06-04 11:24:58.122 ERROR root [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py\", line 2059, in _build_resources\\n    yield resources\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py\", line 1962, in _build_and_run_instance\\n    block_device_info=block_device_info)\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2281, in spawn\\n    admin_pass=admin_password)\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2655, in _create_image\\n    project_id=instance[\\'project_id\\'])\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 192, in cache\\n    *args, **kwargs)\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 386, in create_image\\n    self.verify_base_size(base, size)\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 243, in verify_base_size\\n    raise exception.FlavorDiskTooSmall()\\n', \"FlavorDiskTooSmall: Flavor's disk is too small for requested image.\\n\"]\n\n\nThe second:\n\n2014-06-04 11:24:58.174 DEBUG nova.compute.utils [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] 'NetworkInfo' object has no attribute 'wait' from (pid=26712) notify_about_instance_usage /media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/utils.py:291\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] Traceback (most recent call last):\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py\", line 1966, in _build_and_run_instance\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     network_info=network_info)\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/usr/lib/python2.7/contextlib.py\", line 35, in __exit__\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     self.gen.throw(type, value, traceback)\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py\", line 2065, in _build_resources\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     network_info.wait(do_raise=False)\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] AttributeError: 'NetworkInfo' object has no attribute 'wait'\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] \n2014-06-04 11:24:58.175 DEBUG nova.compute.manager [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] Build of instance cd5a4327-d3ee-45bb-95fa-da7817b3b0b9 was re-scheduled: 'NetworkInfo' object has no attribute 'wait' from (pid=26712) do_build_and_run_instance /media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py:1895\n\n\nThe third is nova reschedule the instance infinitely\n\n\nFor the first error, the nova api check the image size with flavor size, but the image size is actually size that different with virtual size. In libvirt driver check the virtual size.\n\nthe image properties as blow:\n$ glance show 01efb526-8046-40d0-b276-ba32e570c965\nURI: http://cloudcontroller:9292/v1/images/01efb526-8046-40d0-b276-ba32e570c965\nId: 01efb526-8046-40d0-b276-ba32e570c965\nPublic: Yes\nProtected: No\nName: cirros-0.3.2-x86_64-uec\nStatus: active\nSize: 25165824\nDisk format: ami\nContainer format: ami\nMinimum Ram Required (MB): 0\nMinimum Disk Required (GB): 0\nOwner: ac99aeb3fbb24494b3bbb68a8e94cbff\nProperty 'kernel_id': efa41ea7-22f0-4e08-82b7-74eb0368b28f\nProperty 'ramdisk_id': eb736431-a77b-4994-ad2b-e090c590e57a\nCreated at: 2014-05-27T07:34:27\nUpdated at: 2014-05-27T07:34:27\n\nIn nova api, it will check the 'Minimum Disk Required'. User should specific the 'Minimum Disk Required' for image. So I think this isn't a bug for nova\n\nFor second error, that is wrong way to use network_info object, this should be fixed.\n\nFor third error, after change conductor to build new instance, the retry info is missing. we should fix is also.", 
    "tags": [
        "icehouse-rc-potential"
    ], 
    "importance": "Critical", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1326207", 
    "owner": "https://api.launchpad.net/1.0/~xuhj", 
    "id": 1326207, 
    "index": 191, 
    "created": "2014-06-04 03:58:58.858274+00:00", 
    "title": "infinitely reschedule instance when boot instance failed", 
    "comments": [
        {
            "content": "When I boot an instance that failed by image size bigger than flavor size, then nova begin to reschedule the instance infinitely.\n\n$ glance index\nID                                   Name                           Disk Format          Container Format     Size          \n------------------------------------ ------------------------------ -------------------- -------------------- --------------\n0d366543-54de-48dd-8f49-d62cac6e7c6b Fedora-x86_64-20-20131211.1-sd qcow2                bare                      214106112\n\n$ nova boot --flavor 1 --image 0d366543-54de-48dd-8f49-d62cac6e7c6b --nic net-id=c2d921a0-1474-4731-a8b5-c1cc8b9069f4 vm1\n+--------------------------------------+------------------------------------------------------------------------+\n| Property                             | Value                                                                  |\n+--------------------------------------+------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                 |\n| OS-EXT-AZ:availability_zone          | nova                                                                   |\n| OS-EXT-SRV-ATTR:host                 | -                                                                      |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                                      |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000002b                                                      |\n| OS-EXT-STS:power_state               | 0                                                                      |\n| OS-EXT-STS:task_state                | -                                                                      |\n| OS-EXT-STS:vm_state                  | building                                                               |\n| OS-SRV-USG:launched_at               | -                                                                      |\n| OS-SRV-USG:terminated_at             | -                                                                      |\n| accessIPv4                           |                                                                        |\n| accessIPv6                           |                                                                        |\n| adminPass                            | 8a7ru8z7bUQ6                                                           |\n| config_drive                         |                                                                        |\n| created                              | 2014-06-04T03:24:38Z                                                   |\n| flavor                               | m1.tiny (1)                                                            |\n| hostId                               |                                                                        |\n| id                                   | cd5a4327-d3ee-45bb-95fa-da7817b3b0b9                                   |\n| image                                | Fedora-x86_64-20-20131211.1-sda (0d366543-54de-48dd-8f49-d62cac6e7c6b) |\n| key_name                             | -                                                                      |\n| metadata                             | {}                                                                     |\n| name                                 | vm1                                                                    |\n| os-extended-volumes:volumes_attached | []                                                                     |\n| progress                             | 0                                                                      |\n| security_groups                      | default                                                                |\n| status                               | BUILD                                                                  |\n| tenant_id                            | ac99aeb3fbb24494b3bbb68a8e94cbff                                       |\n| updated                              | 2014-06-04T03:24:38Z                                                   |\n| user_id                              | 2c08e17d6fb54dea96cc6d70ba0ee75f                                       |\n+--------------------------------------+------------------------------------------------------------------------+\n\n\n\nThe first error at compute node:\n\n2014-06-04 11:24:58.121 ERROR nova.virt.libvirt.imagebackend [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] /opt/stack/data/nova/instances/_base/d1a823\nd9305ec292d5f3e13da6755ee8f057b01e virtual size 2147483648 larger than flavor root disk size 1073741824\n2014-06-04 11:24:58.121 ERROR nova.compute.manager [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] Inst\nance failed to spawn\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] Traceback (most recent call last):\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/compute/manager.py\", line 2059, in _build_resources\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     yield resources\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/compute/manager.py\", line 1962, in _build_and_run_instance\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     block_device_info=block_device_info)\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2281, in spawn\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     admin_pass=admin_password)\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2655, in _create_image\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     project_id=instance['project_id'])\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 192, in cache\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     *args, **kwargs)\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce55413\n7d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 386, in create_image\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     self.verify_base_size(base, size)\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 243, in verify_base_size\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     raise exception.FlavorDiskTooSmall()\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] FlavorDiskTooSmall: Flavor's disk is too small for requested image.\n2014-06-04 11:24:58.121 TRACE nova.compute.manager [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] \n2014-06-04 11:24:58.122 ERROR root [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py\", line 2059, in _build_resources\\n    yield resources\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py\", line 1962, in _build_and_run_instance\\n    block_device_info=block_device_info)\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2281, in spawn\\n    admin_pass=admin_password)\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2655, in _create_image\\n    project_id=instance[\\'project_id\\'])\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 192, in cache\\n    *args, **kwargs)\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 386, in create_image\\n    self.verify_base_size(base, size)\\n', '  File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 243, in verify_base_size\\n    raise exception.FlavorDiskTooSmall()\\n', \"FlavorDiskTooSmall: Flavor's disk is too small for requested image.\\n\"]\n\n\nThe second:\n\n2014-06-04 11:24:58.174 DEBUG nova.compute.utils [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] 'NetworkInfo' object has no attribute 'wait' from (pid=26712) notify_about_instance_usage /media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/utils.py:291\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] Traceback (most recent call last):\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py\", line 1966, in _build_and_run_instance\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     network_info=network_info)\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/usr/lib/python2.7/contextlib.py\", line 35, in __exit__\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     self.gen.throw(type, value, traceback)\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]   File \"/media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py\", line 2065, in _build_resources\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9]     network_info.wait(do_raise=False)\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] AttributeError: 'NetworkInfo' object has no attribute 'wait'\n2014-06-04 11:24:58.174 TRACE nova.compute.utils [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] \n2014-06-04 11:24:58.175 DEBUG nova.compute.manager [req-45fbcfec-7440-4193-9caa-53b9322e440c admin admin] [instance: cd5a4327-d3ee-45bb-95fa-da7817b3b0b9] Build of instance cd5a4327-d3ee-45bb-95fa-da7817b3b0b9 was re-scheduled: 'NetworkInfo' object has no attribute 'wait' from (pid=26712) do_build_and_run_instance /media/soulxu1404/da43e419-d334-4dae-9274-04ce554137d9/opt/stack/nova/nova/compute/manager.py:1895\n\n\nThe third is nova reschedule the instance infinitely\n\n\nFor the first error, the nova api check the image size with flavor size, but the image size is actually size that different with virtual size. In libvirt driver check the virtual size.\n\nthe image properties as blow:\n$ glance show 01efb526-8046-40d0-b276-ba32e570c965\nURI: http://cloudcontroller:9292/v1/images/01efb526-8046-40d0-b276-ba32e570c965\nId: 01efb526-8046-40d0-b276-ba32e570c965\nPublic: Yes\nProtected: No\nName: cirros-0.3.2-x86_64-uec\nStatus: active\nSize: 25165824\nDisk format: ami\nContainer format: ami\nMinimum Ram Required (MB): 0\nMinimum Disk Required (GB): 0\nOwner: ac99aeb3fbb24494b3bbb68a8e94cbff\nProperty 'kernel_id': efa41ea7-22f0-4e08-82b7-74eb0368b28f\nProperty 'ramdisk_id': eb736431-a77b-4994-ad2b-e090c590e57a\nCreated at: 2014-05-27T07:34:27\nUpdated at: 2014-05-27T07:34:27\n\nIn nova api, it will check the 'Minimum Disk Required'. User should specific the 'Minimum Disk Required' for image. So I think this isn't a bug for nova\n\nFor second error, that is wrong way to use network_info object, this should be fixed.\n\nFor third error, after change conductor to build new instance, the retry info is missing. we should fix is also.", 
            "date_created": "2014-06-04 03:58:58.858274+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/97727", 
            "date_created": "2014-06-04 09:12:23.305381+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/97728", 
            "date_created": "2014-06-04 09:12:31.352909+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Just from reading the tracebacks above, the two issues I see are:\n\n1) FlavorDiskTooSmall raised by driver.spawn() is going to result in a reschedule attempt which cannot succeed\n\n2) In the exception handling of _build_resources() we do\n\n                # Make sure the async call finishes\n                if network_info is not None:\n                    network_info.wait(do_raise=False)\n\n    and get:\n\n      'NetworkInfo' object has no attribute 'wait'\n\n    We obviously expect it to be a NetworkInfoAsyncWrapper but it isn't for some reason.\n", 
            "date_created": "2014-06-05 12:00:23.569386+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Ok, I see the infinite rescheduling issue now too - with the new build_instances() code path, we're not keeping track of retry attempts", 
            "date_created": "2014-06-05 15:21:03.823035+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "The FlavorDiskTooSmall issue is being tracked at https://bugs.launchpad.net/nova/+bug/1325670\n\nLooking at the other issue and fix now.", 
            "date_created": "2014-06-05 15:26:00.640492+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Note that https://review.openstack.org/97728 should be backported to stable/icehouse", 
            "date_created": "2014-06-05 15:34:58.554079+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Icehouse should be unaffected since build_and_run_instance wasn't used there.", 
            "date_created": "2014-06-05 15:38:32.133129+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Icehouse's build_and_run_instance() will be used during an upgrade where you have an Icehouse compute and Juno conductor", 
            "date_created": "2014-06-05 16:11:55.525790+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/98309", 
            "date_created": "2014-06-06 07:09:04.427289+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/97727\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9639b55b614082206207e67af7dde7af85a9b614\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9639b55b614082206207e67af7dde7af85a9b614\nAuthor: He Jie Xu <email address hidden>\nDate:   Wed Jun 4 14:56:33 2014 +0800\n\n    Fix infinitely reschedule instance due to miss retry info\n    \n    The logic of building instance is moved from scheduler to conductor,\n    But 'retry' info is still populated at scheduler manager, and that\n    can't be take back from rpc call. This patch moves the retry checking\n    logic into conductor, and keep the old 'schedule_run_instance'\n    same as before.\n    \n    Change-Id: I4efafe815e8623881e6c037eb9d04c0dbb7052a2\n    Partial-Bug: #1326207\n", 
            "date_created": "2014-06-14 07:29:18.819346+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/98309\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=24a04c405ab2c98e52ea1edf8775489907526c6d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 24a04c405ab2c98e52ea1edf8775489907526c6d\nAuthor: He Jie Xu <email address hidden>\nDate:   Fri Jun 6 14:57:47 2014 +0800\n\n    Check the network_info obj type before invoke wait function\n    \n    When instance schedule to host and it isn't first time schedule,\n    the instance may already allocated network. And then the code\n    will return an NetworkInfo object, not an NetworkInfoAsyncWrapper.\n    The checking code only assume it is NetworkInfoAsyncWrapper object.\n    \n    Change-Id: I987902fc47e509e4fd08f762d66b16c09eaf5008\n    Partial-Bug: #1326207\n", 
            "date_created": "2014-06-17 16:35:18.310054+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/97728\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=ea3e03a626118fbee1626eb1a17224629299757f\nSubmitter: Jenkins\nBranch:    master\n\ncommit ea3e03a626118fbee1626eb1a17224629299757f\nAuthor: He Jie Xu <email address hidden>\nDate:   Wed Jun 4 16:51:41 2014 +0800\n\n    Disable rescheduling instance when no retry info\n    \n    When scheduler_max_attempts=1 means disable rescheduling, compute\n    won't reschedule instance before. But build_and_run_instance didn't\n    hornor this behavior. And cause nova reschedule instance infinitely.\n    This patch fix this problem, make build_and_run_instance won't reschedule\n    instance without retry info.\n    \n    Change-Id: I52d6569c1731b5fd5a10f39ff04a40b43d3857a1\n    Partial-Bug: #1326207\n", 
            "date_created": "2014-06-27 03:36:31.762655+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Alex, what further work (if any) is needed for this bug?", 
            "date_created": "2014-07-09 02:20:17.720635+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "Michael, there isn't any more work for this bug.", 
            "date_created": "2014-07-15 07:42:26.241676+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }
    ]
}