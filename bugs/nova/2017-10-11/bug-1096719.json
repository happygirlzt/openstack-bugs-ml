{
    "status": "Fix Released", 
    "last_updated": "2013-04-11 19:54:33.051819+00:00", 
    "description": "2013-01-05 08:02:23 WARNING nova.scheduler.manager [req-c243dee7-fc00-42d8-8654-603b899d471b admin demo] Failed to schedule_run_instance: can't compare datetime.datetime to NoneType\n2013-01-05 08:02:23 WARNING nova.scheduler.manager [req-c243dee7-fc00-42d8-8654-603b899d471b admin demo] [instance: 6e4d25bd-9ad8-4e92-b5b4-00fabeed477d] Setting instance to ERROR state.\n2013-01-05 08:02:23 ERROR nova.openstack.common.rpc.amqp [req-c243dee7-fc00-42d8-8654-603b899d471b admin demo] Exception during message handling\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 277, in _process_data\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 147, in dispatch\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 121, in run_instance\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     context, ex, request_spec)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 109, in run_instance\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     requested_networks, is_first_time, filter_properties)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 60, in schedule_run_instance\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     filter_properties, instance_uuids)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 275, in _schedule\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     hosts = self.host_manager.get_all_host_states(elevated)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/host_manager.py\", line 386, in get_all_host_states\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     host_state.update_from_compute_node(compute)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/host_manager.py\", line 143, in update_from_compute_node\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     if self.updated and self.updated > compute['updated_at']:\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp TypeError: can't compare datetime.datetime to NoneType\n\n\nthis is from HEAD + pending baremetal patches.", 
    "tags": [
        "baremetal"
    ], 
    "importance": "High", 
    "heat": 28, 
    "link": "https://bugs.launchpad.net/nova/+bug/1096719", 
    "owner": "https://api.launchpad.net/1.0/~lifeless", 
    "id": 1096719, 
    "index": 920, 
    "created": "2013-01-07 01:39:54.594200+00:00", 
    "title": "comparing datetime to None in update-time handling", 
    "comments": [
        {
            "content": "2013-01-05 08:02:23 WARNING nova.scheduler.manager [req-c243dee7-fc00-42d8-8654-603b899d471b admin demo] Failed to schedule_run_instance: can't compare datetime.datetime to NoneType\n2013-01-05 08:02:23 WARNING nova.scheduler.manager [req-c243dee7-fc00-42d8-8654-603b899d471b admin demo] [instance: 6e4d25bd-9ad8-4e92-b5b4-00fabeed477d] Setting instance to ERROR state.\n2013-01-05 08:02:23 ERROR nova.openstack.common.rpc.amqp [req-c243dee7-fc00-42d8-8654-603b899d471b admin demo] Exception during message handling\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 277, in _process_data\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 147, in dispatch\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 121, in run_instance\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     context, ex, request_spec)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 109, in run_instance\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     requested_networks, is_first_time, filter_properties)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 60, in schedule_run_instance\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     filter_properties, instance_uuids)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 275, in _schedule\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     hosts = self.host_manager.get_all_host_states(elevated)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/host_manager.py\", line 386, in get_all_host_states\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     host_state.update_from_compute_node(compute)\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/host_manager.py\", line 143, in update_from_compute_node\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp     if self.updated and self.updated > compute['updated_at']:\n2013-01-05 08:02:23 TRACE nova.openstack.common.rpc.amqp TypeError: can't compare datetime.datetime to NoneType\n\n\nthis is from HEAD + pending baremetal patches.", 
            "date_created": "2013-01-07 01:39:54.594200+00:00", 
            "author": "https://api.launchpad.net/1.0/~lifeless"
        }, 
        {
            "content": "I met the same question when i used the \"nova boot\" command.", 
            "date_created": "2013-01-08 04:55:26.319928+00:00", 
            "author": "https://api.launchpad.net/1.0/~xu-haiwei"
        }, 
        {
            "content": "I have set tow nodes: precise64 and slave101, and both of them seems to work properly.\n\nvagrant@precise64:~$ nova-manage service list\nBinary           Host                                 Zone             Status     State Updated_At\nnova-network     slave101                             nova             enabled    :-)   2013-01-08 05:28:24\nnova-compute     slave101                             nova             enabled    :-)   2013-01-08 05:28:24\nnova-conductor   precise64                            nova             enabled    :-)   2013-01-08 05:28:22\nnova-cert        precise64                            nova             enabled    :-)   2013-01-08 05:28:24\nnova-compute     precise64                            nova             enabled    :-)   2013-01-08 05:28:24\nnova-network     precise64                            nova             enabled    :-)   2013-01-08 05:28:26\nnova-scheduler   precise64                            nova             enabled    :-)   2013-01-08 05:28:26\nnova-consoleauth precise64                            nova             enabled    :-)   2013-01-08 05:28:24\n\nwhen i try to create an instance with \"nova boot\",the error happens:\nvagrant@precise64:~$ nova boot --hint force_hosts=slave101 --flavor 1 --image a566bbb7-ef41-4fea-8f60-157d86873b22 image01\n\n2013-01-08 05:29:17 DEBUG nova.scheduler.filter_scheduler [req-dff32077-fe8c-49d9-8784-25be8f692d8a admin demo] Attempting to build 1 instance(s) from (pid=9080) schedule_run_instance /opt/stack/nova/nova/scheduler/filter_scheduler.py:53\n2013-01-08 05:29:17 WARNING nova.scheduler.manager [req-dff32077-fe8c-49d9-8784-25be8f692d8a admin demo] Failed to schedule_run_instance: can't compare datetime.datetime to NoneType\n2013-01-08 05:29:17 WARNING nova.scheduler.manager [req-dff32077-fe8c-49d9-8784-25be8f692d8a admin demo] [instance: 631f69ff-9827-427f-a5d0-e59359687519] Setting instance to ERROR state.\n2013-01-08 05:29:17 ERROR nova.openstack.common.rpc.amqp [req-dff32077-fe8c-49d9-8784-25be8f692d8a admin demo] Exception during message handling\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 277, in _process_data\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 147, in dispatch\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 121, in run_instance\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     context, ex, request_spec)\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 109, in run_instance\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     requested_networks, is_first_time, filter_properties)\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 60, in schedule_run_instance\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     filter_properties, instance_uuids)\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 256, in _schedule\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     hosts = self.host_manager.get_all_host_states(elevated)\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/host_manager.py\", line 388, in get_all_host_states\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     host_state.update_from_compute_node(compute)\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/host_manager.py\", line 143, in update_from_compute_node\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp     if self.updated and self.updated > compute['updated_at']:\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp TypeError: can't compare datetime.datetime to NoneType\n2013-01-08 05:29:17 TRACE nova.openstack.common.rpc.amqp\n\nanyone can help me?  thank you", 
            "date_created": "2013-01-08 05:31:37.059908+00:00", 
            "author": "https://api.launchpad.net/1.0/~xu-haiwei"
        }, 
        {
            "content": "hi,\n\ni have solved this problem by editing the /etc/nova/nova.conf\n\nI deleted the line \"allow_admin_api=True\"\n\n", 
            "date_created": "2013-01-08 07:14:00.004007+00:00", 
            "author": "https://api.launchpad.net/1.0/~xu-haiwei"
        }, 
        {
            "content": "I have the exact same error, I did not have \"allow_admin_api=True\" in my nova.conf. Can someone point me to the code changes for this fix?", 
            "date_created": "2013-01-13 21:18:42.820840+00:00", 
            "author": "https://api.launchpad.net/1.0/~josh-ni1sr89"
        }, 
        {
            "content": "The commit that addresses this bug is here: https://github.com/openstack/nova/commit/fad69df25ffcea2a44cbf3ef636a68863a2d64d9", 
            "date_created": "2013-01-14 16:44:25.436854+00:00", 
            "author": "https://api.launchpad.net/1.0/~richmgb"
        }, 
        {
            "content": "This bug also appears to affect Folsom with the .1 backport branch.\n\nI also confirmed that the patch appears to fix the issue.", 
            "date_created": "2013-02-11 23:06:20.583855+00:00", 
            "author": "https://api.launchpad.net/1.0/~ryan-richard"
        }, 
        {
            "content": "I hit this in Folsom as well, any chance of a backport to fix this?", 
            "date_created": "2013-03-20 14:13:16.091354+00:00", 
            "author": "https://api.launchpad.net/1.0/~lorinh"
        }, 
        {
            "content": "I seem to recall someone backporting this in the last week or so.", 
            "date_created": "2013-03-20 14:26:09.297735+00:00", 
            "author": "https://api.launchpad.net/1.0/~lifeless"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/23758\nCommitted: http://github.com/openstack/nova/commit/5b43cef510b68cff1f6e2f80742d3204b0b51e45\nSubmitter: Jenkins\nBranch:    stable/folsom\n\ncommit 5b43cef510b68cff1f6e2f80742d3204b0b51e45\nAuthor: Robert Collins <email address hidden>\nDate:   Mon Jan 7 15:12:39 2013 +1300\n\n    Handle compute node records with no timestamp.\n    \n    Commit 94560ab57d9fc23673f42017e6f2a78cb2b66b7a added a fast-path\n    to avoid work when baremetal compute nodes haven't changed, but if\n    the compute message has None for its updated-at timestamp (which\n    can happen during startup) the comparison crashes.\n    \n    Fixes bug: 1096719\n    Change-Id: Ib8add431d975eee133deefea62eb53479a97396e\n    (cherry picked from commit fad69df25ffcea2a44cbf3ef636a68863a2d64d9)\n", 
            "date_created": "2013-03-21 13:43:47.407357+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}