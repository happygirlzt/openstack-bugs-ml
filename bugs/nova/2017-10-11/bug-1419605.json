{
    "status": "Invalid", 
    "last_updated": "2015-03-05 00:56:05.146615+00:00", 
    "description": "Environment:\nnova 2014.2.1\npython-novaclient 2.20.0\nUbuntu 14.04.1 LTS\n\nTwo host aggregates in same AZ(availability zone) have same compute node.\nAnd then one host aggregate is updated to a different AZ.\nAs a result, the compute node belongs to host aggregates in defferent AZs at the same time.\n\n[Steps to Reproduce]\nstack@devstack-juno:/opt/devstack$ nova aggregate-list\n+----+------+-------------------+\n| Id | Name | Availability Zone |\n+----+------+-------------------+\n| 1  | agg1 | AZ1               |\n| 2  | agg2 | AZ1               |\n+----+------+-------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-details agg1\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 1  | agg1 | AZ1               | 'devstack-juno' | 'availability_zone=AZ1' |\n+----+------+-------------------+-----------------+-------------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-details agg2\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 2  | agg2 | AZ1               | 'devstack-juno' | 'availability_zone=AZ1' |\n+----+------+-------------------+-----------------+-------------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-update agg2 agg2 AZ2\nAggregate 2 has been successfully updated.\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 2  | agg2 | AZ2               | 'devstack-juno' | 'availability_zone=AZ2' |\n+----+------+-------------------+-----------------+-------------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-details agg1\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 1  | agg1 | AZ1               | 'devstack-juno' | 'availability_zone=AZ1' |\n+----+------+-------------------+-----------------+-------------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-details agg2\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 2  | agg2 | AZ2               | 'devstack-juno' | 'availability_zone=AZ2' |\n+----+------+-------------------+-----------------+-------------------------+\n\nBecause the cause of the bug is wrong check logic in is_safe_to_update_az method in nova/compute/api.py,\nthe bug would occur in master.", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1419605", 
    "owner": "https://api.launchpad.net/1.0/~hanlind", 
    "id": 1419605, 
    "index": 256, 
    "created": "2015-02-09 05:01:34.255481+00:00", 
    "title": "A compute node can belong to host aggregates in defferent AZs", 
    "comments": [
        {
            "content": "Environment:\nnova 2014.2.1\npython-novaclient 2.20.0\nUbuntu 14.04.1 LTS\n\nTwo host aggregates in same AZ(availability zone) have same compute node.\nAnd then one host aggregate is updated to a different AZ.\nAs a result, the compute node belongs to host aggregates in defferent AZs at the same time.\n\n[Steps to Reproduce]\nstack@devstack-juno:/opt/devstack$ nova aggregate-list\n+----+------+-------------------+\n| Id | Name | Availability Zone |\n+----+------+-------------------+\n| 1  | agg1 | AZ1               |\n| 2  | agg2 | AZ1               |\n+----+------+-------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-details agg1\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 1  | agg1 | AZ1               | 'devstack-juno' | 'availability_zone=AZ1' |\n+----+------+-------------------+-----------------+-------------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-details agg2\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 2  | agg2 | AZ1               | 'devstack-juno' | 'availability_zone=AZ1' |\n+----+------+-------------------+-----------------+-------------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-update agg2 agg2 AZ2\nAggregate 2 has been successfully updated.\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 2  | agg2 | AZ2               | 'devstack-juno' | 'availability_zone=AZ2' |\n+----+------+-------------------+-----------------+-------------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-details agg1\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 1  | agg1 | AZ1               | 'devstack-juno' | 'availability_zone=AZ1' |\n+----+------+-------------------+-----------------+-------------------------+\nstack@devstack-juno:/opt/devstack$ nova aggregate-details agg2\n+----+------+-------------------+-----------------+-------------------------+\n| Id | Name | Availability Zone | Hosts           | Metadata                |\n+----+------+-------------------+-----------------+-------------------------+\n| 2  | agg2 | AZ2               | 'devstack-juno' | 'availability_zone=AZ2' |\n+----+------+-------------------+-----------------+-------------------------+\n\nBecause the cause of the bug is wrong check logic in is_safe_to_update_az method in nova/compute/api.py,\nthe bug would occur in master.", 
            "date_created": "2015-02-09 05:01:34.255481+00:00", 
            "author": "https://api.launchpad.net/1.0/~natsume-takashi"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/153938", 
            "date_created": "2015-02-09 07:15:45.660960+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "New fix proposed is https://review.openstack.org/154593", 
            "date_created": "2015-02-17 16:08:14.007992+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanlind"
        }, 
        {
            "content": "Change abandoned by Takashi NATSUME (<email address hidden>) on branch: master\nReview: https://review.openstack.org/153938\nReason: Sylvain,\n\nThank you for your comment.\nThe bug will be fixed by Hans's patch.\nSo I abandoned this patch.", 
            "date_created": "2015-02-26 00:02:22.862734+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "this  bug doesn't make sense. Furthermore, this is actually a valid behavior IMHO.\nI don't see why a host can't be part of two AZs.\nAZs are internally defined as a special metadata key/value in an aggregate (availability_zone key in metadata).\nThe bug says \"Two host aggregates in same AZ(availability zone) have same compute node.\" This doesn't make sense. host aggregates with the availability_zone key set in metadata are AZs and cannot 'belong to an AZ'.\nSo this test, and the related bug are actually creating two host_aggregates that represent the same AZ. Which is a bad idea. And then changing one of the AZs.\n\nCopied from my comments on the fix: https://review.openstack.org/#/c/154593/4", 
            "date_created": "2015-02-28 00:53:04.713552+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Joe,\n\ncould you see the following patches?\n\nImprove performance for checking hosts AZs\nhttps://review.openstack.org/#/c/88283/\n\nIn the commit message,\n> When updating aggregate metadata or when adding a host into aggregate,\n> a check is done to make sure that hosts can't be in multiple AZs.\n\nFix AvailabilityZone check for hosts in multiple aggregates\nhttps://review.openstack.org/#/c/85961/\n\nIn the commit message,\n> Nova as of now preventing to have one host in two distinct AZs.\n\nIn the past, it has been modified in such a policy.\nSo it is proper to prevent a host from belonging to multiple AZs.\n", 
            "date_created": "2015-03-05 00:56:04.541676+00:00", 
            "author": "https://api.launchpad.net/1.0/~natsume-takashi"
        }
    ]
}