{
    "status": "Invalid", 
    "last_updated": "2013-03-18 01:29:41.501304+00:00", 
    "description": "Issue Description:\n   I created a volume on RedHat6.3  with \"volume_driver=cinder.volume.drivers.lvm.LVMISCSIDriver\" and created a instance on HyPer-V (windows 2012),  then tried to attach the volume to the instance ,but failed . It throwes Exception  <x_wmi: Unexpected COM Error (-2147352567, 'Exception occurred.', (0, u'SWbemObjectEx', u'Generic failure ', None, 0, -2147217407), None)>\n\nTest steps:\n\n1. create  a  volume and boot a instance :\n    cinder create  1 --display-name iscsi_volume1\n     nova boot --image e73592aa-ea41-4d44-84df-2911483bacca  --flavor 1 gcb_iscsi1\n\n 2. check status \n [root@localhost /]# cinder list\n+--------------------------------------+-----------+---------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  |  Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+---------------+------+-------------+----------+-------------+\n| 7f4adee1-a615-41c2-955e-4a266dc18693 | available | iscsi_volume1 |  1   |     None    |  false   |             |\n| a1af7c46-ed5e-49f2-a2f8-5e725bf89ed6 | available | iscsi_volume2 |  1   |     None    |  false   |             |\n+--------------------------------------+-----------+---------------+------+-------------+----------+-------------+\n[root@localhost /]# nova list\n+--------------------------------------+------------+--------+----------------------+\n| ID                                   | Name       | Status | Networks             |\n+--------------------------------------+------------+--------+----------------------+\n| d1501b79-073e-4f68-9849-e4b767b2e258 | gcb_iscsi1 | ACTIVE | private=192.168.88.2 |\n| 58ea7ef2-efee-4434-8b85-57e3cdce63a2 | gcb_iscsi2 | ACTIVE | private=192.168.88.3 |\n+--------------------------------------+------------+--------+----------------------+\n\n3. attach volume\n nova volume-attach d1501b79-073e-4f68-9849-e4b767b2e258 7f4adee1-a615-41c2-955e-4a266dc18693 /dev/sdf", 
    "tags": [
        "hyper-v"
    ], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1153435", 
    "owner": "None", 
    "id": 1153435, 
    "index": 3497, 
    "created": "2013-03-11 03:45:15.263406+00:00", 
    "title": "Hyper-V attach iscsi base volume failed due to WMI  exception", 
    "comments": [
        {
            "content": "Issue Description:\n   I created a volume on RedHat6.3  with \"volume_driver=cinder.volume.drivers.lvm.LVMISCSIDriver\" and created a instance on HyPer-V (windows 2012),  then tried to attach the volume to the instance ,but failed . It throwes Exception  <x_wmi: Unexpected COM Error (-2147352567, 'Exception occurred.', (0, u'SWbemObjectEx', u'Generic failure ', None, 0, -2147217407), None)>\n\nTest steps:\n\n1. create  a  volume and boot a instance :\n    cinder create  1 --display-name iscsi_volume1\n     nova boot --image e73592aa-ea41-4d44-84df-2911483bacca  --flavor 1 gcb_iscsi1\n\n 2. check status \n [root@localhost /]# cinder list\n+--------------------------------------+-----------+---------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  |  Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+---------------+------+-------------+----------+-------------+\n| 7f4adee1-a615-41c2-955e-4a266dc18693 | available | iscsi_volume1 |  1   |     None    |  false   |             |\n| a1af7c46-ed5e-49f2-a2f8-5e725bf89ed6 | available | iscsi_volume2 |  1   |     None    |  false   |             |\n+--------------------------------------+-----------+---------------+------+-------------+----------+-------------+\n[root@localhost /]# nova list\n+--------------------------------------+------------+--------+----------------------+\n| ID                                   | Name       | Status | Networks             |\n+--------------------------------------+------------+--------+----------------------+\n| d1501b79-073e-4f68-9849-e4b767b2e258 | gcb_iscsi1 | ACTIVE | private=192.168.88.2 |\n| 58ea7ef2-efee-4434-8b85-57e3cdce63a2 | gcb_iscsi2 | ACTIVE | private=192.168.88.3 |\n+--------------------------------------+------------+--------+----------------------+\n\n3. attach volume\n nova volume-attach d1501b79-073e-4f68-9849-e4b767b2e258 7f4adee1-a615-41c2-955e-4a266dc18693 /dev/sdf", 
            "date_created": "2013-03-11 03:45:15.263406+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "This the log from nova compute :\n 2013-03-10 17:53:25.342 DEBUG nova.virt.hyperv.volumeops [req-98f2def7-3dfc-463f-b500-1db316a95c5e ecb94ad4584f45e5ad0078e4251c34ca 249ac2e3091843c3841797f58e1326bc] Attach_volume: {u'driver_volume_type': u'iscsi', 'serial': u'7f4adee1-a615-41c2-955e-4a266dc18693', u'data': {u'target_discovered': \n False, u'target_iqn': u'iqn.2010-10.org.openstack:mqx_volume-7f4adee1-a615-41c2-955e-4a266dc18693', u'target_portal': u'9.125.13.248:3260', u'volume_id': u'7f4adee1-a615-41c2-955e-4a266dc18693', u'target_lun': 1, u'auth_password': u'rv6m4y65yRUtbf72DL39', u'auth_userna        me': u'nzY8Fakyy8pnQUqrSBKN', u'auth_method': u'CHAP'}} to mengqxqx-plinux248-020 attach_volume C:\\OpenStack\\gcb_backup\\nova\\nova\\virt\\hyperv\\volumeops.py:92\n    639 2013-03-10 17:53:25.497 ERROR nova.compute.manager [req-98f2def7-3dfc-463f-b500-1db316a95c5e ecb94ad4584f45e5ad0078e4251c34ca 249ac2e3091843c3841797f58e1326bc] [instance: d1501b79-073e-4f68-9849-e4b767b2e258] Failed to attach volume 7f4adee1-a615-41c2-955e-4a266dc18693 at /dev/sdf\n    640 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258] Traceback (most recent call last):\n    641 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]   File \"C:\\OpenStack\\gcb_backup\\nova\\nova\\compute\\manager.py\", line 2657, in _attach_volume\n    642 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]     mountpoint)\n    643 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]   File \"C:\\OpenStack\\gcb_backup\\nova\\nova\\virt\\hyperv\\driver.py\", line 70, in attach_volume\n    644 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]     instance['name'])\n    645 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]   File \"C:\\OpenStack\\gcb_backup\\nova\\nova\\virt\\hyperv\\volumeops.py\", line 98, in attach_volume\n    646 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]     target_portal)\n    647 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]   File \"C:\\OpenStack\\gcb_backup\\nova\\nova\\virt\\hyperv\\volumeutilsv2.py\", line 54, in login_storage_target\n    648 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]     TargetPortalPortNumber=target_port)\n    649 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]   File \"C:\\Program Files (x86)\\Cloudbase Solutions\\OpenStack\\Nova\\Python27\\lib\\site-packages\\wmi.py\", line 431, in __call__\n    650 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]     handle_com_error ()\n    651 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]   File \"C:\\Program Files (x86)\\Cloudbase Solutions\\OpenStack\\Nova\\Python27\\lib\\site-packages\\wmi.py\", line 241, in handle_com_error\n    652 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]     raise klass (com_error=err)\n    653 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258] x_wmi: <x_wmi: Unexpected COM Error (-2147352567, 'Exception occurred.', (0, u'SWbemObjectEx', u'Generic failure ', None, 0, -2147217407), None)>\n    654 2013-03-10 17:53:25.497 13924 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]\n", 
            "date_created": "2013-03-11 03:46:21.421744+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "It seems  that  there is  error  occurred  when Windows iSCSI Initiator  add  target portal  for iSCSI volume  on Linux  . \n\nFirewalls of Linux and Windows are both disabled .\n\n1)I can  discovery the target  from another Linux  by  command  'iscsiadm -m discovery -t sendtargets' .\n\n2)I tried   the following on Windows PowerShell .  Windows iSCSI Initiator can add target portal for iSCSI volume on itself .\nPS C:\\Users\\Administrator> iscsicli AddTargetPortal   9.111.36.88 3260 * * * * * * * * * * * * *\nMicrosoft iSCSI Initiator Version 6.2 Build 9200\n\nThe operation completed successfully.\nPS C:\\Users\\Administrator> iscsicli AddTargetPortal 9.125.13.248 3260 * * * * * * * * * * * * *\nMicrosoft iSCSI Initiator Version 6.2 Build 9200\n\nTCP Transport Error\n\n3) I use strace to track the  process of tgtd ,  it shows  windows server can connect to the linux  as follow:\n\n[pid 13445] accept(4, {sa_family=AF_INET, sin_port=htons(59452), sin_addr=inet_addr(\"9.111.36.88\")}, [16]) = 10\n[pid 13445] setsockopt(10, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0\n[pid 13445] setsockopt(10, SOL_TCP, TCP_KEEPIDLE, [1800], 4) = 0\n[pid 13445] setsockopt(10, SOL_TCP, TCP_KEEPCNT, [6], 4) = 0\n[pid 13445] setsockopt(10, SOL_TCP, TCP_KEEPINTVL, [300], 4) = 0\n[pid 13445] setsockopt(10, SOL_TCP, TCP_NODELAY, [1], 4) = 0\n[pid 13445] fcntl(10, F_GETFL)          = 0x2 (flags O_RDWR)\n[pid 13445] fcntl(10, F_SETFL, O_RDWR|O_NONBLOCK) = 0\n[pid 13445] epoll_ctl(3, EPOLL_CTL_ADD, 10, {EPOLLIN, {u32=256, u64=1100297868880}}) = 0\n[pid 13445] epoll_wait(3, {{EPOLLIN, {u32=256, u64=1100297868880}}}, 1024, -1) = 1\n[pid 13445] read(10, \"C\\201\\0\\0\\0\\0\\0^@\\0\\0017\\0\\0\\0\\0\\0\\0\\0\\1\\0\\1\\0\\0\\0\\0\\0\\1\\0\\0\\0\\1\"..., 48) = 48\n[pid 13445] read(10, \"InitiatorName=iqn.1991-05.com.mi\"..., 96) = 96\n[pid 13445] epoll_ctl(3, EPOLL_CTL_MOD, 10, {EPOLLOUT, {u32=256, u64=1100297868880}}) = 0\n[pid 13445] epoll_wait(3, {{EPOLLOUT, {u32=256, u64=1100297868880}}}, 1024, -1) = 1\n[pid 13445] setsockopt(10, SOL_TCP, TCP_CORK, [1], 4) = 0\n[pid 13445] write(10, \"#\\201\\0\\0\\0\\0\\0'@\\0\\0017\\0\\0\\0\\0\\0\\0\\0\\1\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\1\"..., 48) = 48\n[pid 13445] epoll_wait(3, {{EPOLLOUT, {u32=256, u64=1100297868880}}}, 1024, -1) = 1\n[pid 13445] setsockopt(10, SOL_TCP, TCP_CORK, [1], 4) = 0\n[pid 13445] write(10, \"TargetPortalGroupTag=1\\0AuthMetho\"..., 40) = 40\n[pid 13445] setsockopt(10, SOL_TCP, TCP_CORK, [0], 4) = 0\n[pid 13445] epoll_ctl(3, EPOLL_CTL_MOD, 10, {EPOLLIN, {u32=256, u64=1100297868880}}) = 0\n[pid 13445] epoll_wait(3, {{EPOLLIN, {u32=256, u64=1100297868880}}}, 1024, -1) = 1\n[pid 13445] read(10, \"C\\207\\0\\0\\0\\0\\0x@\\0\\0017\\0\\0\\0\\0\\0\\0\\0\\1\\0\\1\\0\\0\\0\\0\\0\\1\\0\\0\\0\\1\"..., 48) = 48\n[pid 13445] read(10, \"HeaderDigest=None,CRC32C\\0DataDig\"..., 120) = 120\n[pid 13445] epoll_ctl(3, EPOLL_CTL_MOD, 10, {EPOLLOUT, {u32=256, u64=1100297868880}}) = 0\n[pid 13445] epoll_wait(3, {{EPOLLOUT, {u32=256, u64=1100297868880}}}, 1024, -1) = 1\n[pid 13445] setsockopt(10, SOL_TCP, TCP_CORK, [1], 4) = 0\n[pid 13445] write(10, \"#\\207\\0\\0\\0\\0\\0K@\\0\\0017\\0\\0\\0\\1\\0\\0\\0\\1\\0\\0\\0\\0\\0\\0\\0\\1\\0\\0\\0\\1\"..., 48) = 48\n[pid 13445] epoll_wait(3, {{EPOLLOUT, {u32=256, u64=1100297868880}}}, 1024, -1) = 1\n[pid 13445] setsockopt(10, SOL_TCP, TCP_CORK, [1], 4) = 0\n[pid 13445] write(10, \"HeaderDigest=None\\0DataDigest=Non\"..., 76) = 76\n[pid 13445] setsockopt(10, SOL_TCP, TCP_CORK, [0], 4) = 0\n[pid 13445] epoll_ctl(3, EPOLL_CTL_MOD, 10, {EPOLLIN, {u32=256, u64=1100297868880}}) = 0\n[pid 13445] epoll_wait(3, {{EPOLLIN, {u32=256, u64=1100297868880}}}, 1024, -1) = 1\n[pid 13445] read(10, \"\\4\\200\\0\\0\\0\\0\\0\\20\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\1\\377\\377\\377\\377\\0\\0\\0\\1\\0\\0\\0\\2\"..., 48) = 48\n[pid 13445] read(10, \"SendTargets=All\\0\", 16) = 16\n[pid 13445] epoll_ctl(3, EPOLL_CTL_MOD, 10, {EPOLLOUT, {u32=256, u64=1100297868880}}) = 0\n[pid 13445] getsockname(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(\"9.125.13.248\")}, [16]) = 0\n[pid 13445] getpeername(10, {sa_family=AF_INET, sin_port=htons(59452), sin_addr=inet_addr(\"9.111.36.88\")}, [16]) = 0\n[pid 13445] getpeername(10, {sa_family=AF_INET, sin_port=htons(59452), sin_addr=inet_addr(\"9.111.36.88\")}, [16]) = 0\n[pid 13445] getpeername(10, {sa_family=AF_INET, sin_port=htons(59452), sin_addr=inet_addr(\"9.111.36.88\")}, [16]) = 0\n[pid 13445] getpeername(10, {sa_family=AF_INET, sin_port=htons(59452), sin_addr=inet_addr(\"9.111.36.88\")}, [16]) = 0\n\nIs anyone else met this issue before , or there is some \n\n\n\n", 
            "date_created": "2013-03-12 03:58:51.442896+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "I can telnet the Linux on port 3260 from windows .I also find the Event log  as  follow :\n\n iSCSI discovery via SendTargets failed with error code 0xefff0024 to target portal *9.125.13.248 0003260 B06BDRV\\L4SC&PCI_163914E4&SUBSYS_190714E4&REV_20\\5&30f94f27&0&30051100_0 .\n\nAny ideas about this ?\nThanks", 
            "date_created": "2013-03-12 04:45:26.422302+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "Can you please try by adding to the configuration file:\n\n[hyperv]\nforce_volumeutils_v1=True\n\nThe previous v1 volume utils use iscsicli.exe to perform the connection. Although less efficient, they might provide more error details.\n", 
            "date_created": "2013-03-12 10:55:57.857589+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexpilotti"
        }, 
        {
            "content": "Thanks  for your reply . \n\nI tried  it and got some log , It  shows as follow. that means the iscsi initiator doesn't work well ,right ?\n\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]   File \"C:\\OpenStack\\gcb_backup\\nova\\nova\\virt\\hyperv\\volumeutils.py\", line 64, in login_storage_target\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]     ' * * * * * * * * * * * * *')\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]   File \"C:\\OpenStack\\gcb_backup\\nova\\nova\\virt\\hyperv\\volumeutils.py\", line 54, in execute\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]     % stdout_value)\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258] HyperVException: An error has occurred when calling the iscsi initiator: Microsoft iSCSI Initiator Version 6.2 Build 9200\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258] TCP Transport Error\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]\n2013-03-12 22:49:36.881 9780 TRACE nova.compute.manager [instance: d1501b79-073e-4f68-9849-e4b767b2e258]\n\n", 
            "date_created": "2013-03-12 15:07:28.704205+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "Can you please check this patch?\n\nhttps://review.openstack.org/#/c/24161/\n", 
            "date_created": "2013-03-12 15:40:51.956553+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexpilotti"
        }, 
        {
            "content": "I have  worked  around  the issue   which  was  fixing   by https://review.openstack.org/#/c/24161/  before .\nThe work around is  use  initiator_name = connector['initiator']['initiator'] instead of initiator_name = connector['initiator'] ,\nSo this bug is not about  initiator_name , it seems the iscsi initiator  can't work well with Linux  iscsi  storage .\n\nAs you mentioned before  , you run  your tests using cinder-volume on devstack  .  The  cinder-voluem running on  Windows  or Linux ?  I want to know if anyone  run  tests  using cinder-volume on Linux  with HyperV compute driver ?\n\nI'm not familiar with  iscsi  usage . Is there any method to debug  Microsoft iSCSI Initiator ?\n\nThanks\n\n\n\n\n", 
            "date_created": "2013-03-13 02:09:46.087989+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "I want to update info about it and hope get some suggestions .\n\nThe issue is that calling windows iscsi initiator command failed . This is not the issue of OpenStack codes itself .\nIt occurred only in the scenario : Windows  iscsi initiator discovery  target on Linux.\nOther scenarios were OK .\n\nWindows iscsi initiator can discover other targets on Windows .\nLinux iscsi initiator can discover  targets  on Windows and Linux .\n\nWhere can I get the info  about what kind of  target type windows iscsi initiator supports ?\nAny ideas ?\n", 
            "date_created": "2013-03-13 11:14:12.434572+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "iSCSI is a standard protocol, so I expect the same behaviour at least for a large subset of features between MS iSCSI, Linux tgt, Open-iSCSI, etc\n\nHere's a pointer on the MS implementation: http://technet.microsoft.com/en-us/library/ee338476(v=ws.10).aspx\nWikipedia is as usual a good starting point: http://en.wikipedia.org/wiki/ISCSI\n\n\n", 
            "date_created": "2013-03-14 01:02:36.240569+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexpilotti"
        }
    ]
}