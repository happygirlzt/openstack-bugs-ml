{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:56:43.045962+00:00", 
    "description": "I write a test for  nova v3 api: fixed_ip,\n\n    def test_set_reserve_with_invalid_ip(self):\n        # NOTE(maurosr): since this exercises the same code snippet, we do it\n        # only for reserve action\n        body = {\"reserve\": \"None\"}\n        self.assertRaises(exceptions.NotFound,\n                          self.client.reserve_fixed_ip,\n                          \"my.invalid.ip\", body)\n\n\nwhen test it with mysql, it can work. But  When test it on CI with postgres, it failed. The traceback in nova log is the following:\n2013-07-23 07:47:30.446 19334 DEBUG routes.middleware [-] Matched POST /os-fixed-ips/my.invalid.ip/action __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:100\n2013-07-23 07:47:30.446 19334 DEBUG routes.middleware [-] Route path: '/os-fixed-ips/:(id)/action', defaults: {'action': u'action', 'controller': <nova.api.openstack.wsgi.Resource object at 0x3d965d0>} __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:102\n2013-07-23 07:47:30.446 19334 DEBUG routes.middleware [-] Match dict: {'action': u'action', 'controller': <nova.api.openstack.wsgi.Resource object at 0x3d965d0>, 'id': u'my.invalid.ip'} __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:103\n2013-07-23 07:47:30.447 DEBUG nova.api.openstack.wsgi [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Action: 'action', body: {\"reserve\": \"None\"} _process_stack /opt/stack/new/nova/nova/api/openstack/wsgi.py:926\n2013-07-23 07:47:30.447 DEBUG nova.api.openstack.wsgi [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Calling method <bound method FixedIPController.action of <nova.api.openstack.compute.plugins.v3.fixed_ips.FixedIPController object at 0x3d89cd0>> _process_stack /opt/stack/new/nova/nova/api/openstack/wsgi.py:927\n2013-07-23 07:47:30.447 DEBUG nova.api.openstack.compute.plugins.v3.fixed_ips [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Reserving IP address my.invalid.ip action /opt/stack/new/nova/nova/api/openstack/compute/plugins/v3/fixed_ips.py:64\n2013-07-23 07:47:30.450 WARNING nova.db.sqlalchemy.api [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Invalid fixed IP Address my.invalid.ip in request\n2013-07-23 07:47:30.451 ERROR nova.api.openstack.extensions [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Unexpected exception in API method\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/extensions.py\", line 468, in wrapped\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/plugins/v3/fixed_ips.py\", line 65, in action\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return self._set_reserved(context, id, True)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/plugins/v3/fixed_ips.py\", line 75, in _set_reserved\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     fixed_ip = db.fixed_ip_get_by_address(context, address)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/api.py\", line 480, in fixed_ip_get_by_address\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return IMPL.fixed_ip_get_by_address(context, address)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 121, in wrapper\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 1184, in fixed_ip_get_by_address\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return _fixed_ip_get_by_address(context, address)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 121, in wrapper\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 1202, in _fixed_ip_get_by_address\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     raise exception.FixedIpInvalid(msg)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions FixedIpInvalid: Invalid fixed IP Address my.invalid.ip in request\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions \n2013-07-23 07:47:30.454 INFO nova.api.openstack.wsgi [req-45127994-dded-470f-a0cb-10e441933351 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.FixedIpInvalid'>\n2013-07-23 07:47:30.454 DEBUG nova.api.openstack.wsgi [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.FixedIpInvalid'> __call__ /opt/stack/new/nova/nova/api/openstack/wsgi.py:1186\n2013-07-23 07:47:30.454 INFO nova.osapi_compute.wsgi.server [req-45127994-dded-470f-a0cb-10e441933351 admin admin] 127.0.0.1 \"POST /v3/os-fixed-ips/my.invalid.ip/action HTTP/1.1\" status: 500 len: 410 time: 0.0099280\n\n\n\nYou can also find it in the link: http://logs.openstack.org/03/29703/18/check/gate-tempest-devstack-vm-postgres-full/34370/logs/screen-n-api.txt.gz", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1204503", 
    "owner": "https://api.launchpad.net/1.0/~maurosr", 
    "id": 1204503, 
    "index": 1164, 
    "created": "2013-07-24 12:52:08.483004+00:00", 
    "title": "the exception.FixedIpInvalid(msg) hasn't been handled", 
    "comments": [
        {
            "content": "I write a test for  nova v3 api: fixed_ip,\n\n    def test_set_reserve_with_invalid_ip(self):\n        # NOTE(maurosr): since this exercises the same code snippet, we do it\n        # only for reserve action\n        body = {\"reserve\": \"None\"}\n        self.assertRaises(exceptions.NotFound,\n                          self.client.reserve_fixed_ip,\n                          \"my.invalid.ip\", body)\n\n\nwhen test it with mysql, it can work. But  When test it on CI with postgres, it failed. The traceback in nova log is the following:\n2013-07-23 07:47:30.446 19334 DEBUG routes.middleware [-] Matched POST /os-fixed-ips/my.invalid.ip/action __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:100\n2013-07-23 07:47:30.446 19334 DEBUG routes.middleware [-] Route path: '/os-fixed-ips/:(id)/action', defaults: {'action': u'action', 'controller': <nova.api.openstack.wsgi.Resource object at 0x3d965d0>} __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:102\n2013-07-23 07:47:30.446 19334 DEBUG routes.middleware [-] Match dict: {'action': u'action', 'controller': <nova.api.openstack.wsgi.Resource object at 0x3d965d0>, 'id': u'my.invalid.ip'} __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:103\n2013-07-23 07:47:30.447 DEBUG nova.api.openstack.wsgi [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Action: 'action', body: {\"reserve\": \"None\"} _process_stack /opt/stack/new/nova/nova/api/openstack/wsgi.py:926\n2013-07-23 07:47:30.447 DEBUG nova.api.openstack.wsgi [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Calling method <bound method FixedIPController.action of <nova.api.openstack.compute.plugins.v3.fixed_ips.FixedIPController object at 0x3d89cd0>> _process_stack /opt/stack/new/nova/nova/api/openstack/wsgi.py:927\n2013-07-23 07:47:30.447 DEBUG nova.api.openstack.compute.plugins.v3.fixed_ips [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Reserving IP address my.invalid.ip action /opt/stack/new/nova/nova/api/openstack/compute/plugins/v3/fixed_ips.py:64\n2013-07-23 07:47:30.450 WARNING nova.db.sqlalchemy.api [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Invalid fixed IP Address my.invalid.ip in request\n2013-07-23 07:47:30.451 ERROR nova.api.openstack.extensions [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Unexpected exception in API method\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/extensions.py\", line 468, in wrapped\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/plugins/v3/fixed_ips.py\", line 65, in action\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return self._set_reserved(context, id, True)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/plugins/v3/fixed_ips.py\", line 75, in _set_reserved\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     fixed_ip = db.fixed_ip_get_by_address(context, address)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/api.py\", line 480, in fixed_ip_get_by_address\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return IMPL.fixed_ip_get_by_address(context, address)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 121, in wrapper\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 1184, in fixed_ip_get_by_address\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return _fixed_ip_get_by_address(context, address)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 121, in wrapper\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 1202, in _fixed_ip_get_by_address\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions     raise exception.FixedIpInvalid(msg)\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions FixedIpInvalid: Invalid fixed IP Address my.invalid.ip in request\n2013-07-23 07:47:30.451 19334 TRACE nova.api.openstack.extensions \n2013-07-23 07:47:30.454 INFO nova.api.openstack.wsgi [req-45127994-dded-470f-a0cb-10e441933351 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.FixedIpInvalid'>\n2013-07-23 07:47:30.454 DEBUG nova.api.openstack.wsgi [req-45127994-dded-470f-a0cb-10e441933351 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.FixedIpInvalid'> __call__ /opt/stack/new/nova/nova/api/openstack/wsgi.py:1186\n2013-07-23 07:47:30.454 INFO nova.osapi_compute.wsgi.server [req-45127994-dded-470f-a0cb-10e441933351 admin admin] 127.0.0.1 \"POST /v3/os-fixed-ips/my.invalid.ip/action HTTP/1.1\" status: 500 len: 410 time: 0.0099280\n\n\n\nYou can also find it in the link: http://logs.openstack.org/03/29703/18/check/gate-tempest-devstack-vm-postgres-full/34370/logs/screen-n-api.txt.gz", 
            "date_created": "2013-07-24 12:52:08.483004+00:00", 
            "author": "https://api.launchpad.net/1.0/~ivan-zhu"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/38688\nCommitted: http://github.com/openstack/nova/commit/df3ac534f099712485a71488812b799ca82cfc6e\nSubmitter: Jenkins\nBranch:    master\n\ncommit df3ac534f099712485a71488812b799ca82cfc6e\nAuthor: Mauro S. M. Rodrigues <email address hidden>\nDate:   Thu Jul 25 15:36:30 2013 -0400\n\n    Fix postgresql failures related to Data type to API-v3 fixed-ip\n    \n    Postgresql is kind of sensitive about different kind of data in a query, so it\n    was failing in cases like looking for an ip using a filter which wasn't a valid\n    ip or ids values greater than the id type on the table.\n    \n    This patch fix this behavior to fixed ips in API-v3.\n    In v2 this was fixed by change I83d532c28c9aec690e8e1ffad8b58e71d619d728\n    \n    Fixes bug 1182754\n    Fixes bug 1204503\n    \n    Change-Id: I9aa14bea2f29f1df85dfd1f07eb0b1947d2c1100\n", 
            "date_created": "2013-07-29 14:43:52.488042+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}