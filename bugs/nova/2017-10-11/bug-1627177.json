{
    "status": "Invalid", 
    "last_updated": "2016-12-09 15:19:39.778582+00:00", 
    "description": "Liberty to Mitaka Upgrade\n\nNova list fails when a user forces a compute creation on one of the nova computes that is in a bad state. \n\nnova list limiting to the other hypervisors works though and all other api commands work, except for the nova list. \n\nThis is happening when u create a vm on a bad compute else it works fine. \n\n\nLog \n\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack [req-16a27bf2-bebe-4f13-a408-4b5b09129d6c 111ea8c6602e44bc8d7b9a125c86f12a 48d9424cadf145e59c98d5ca53c54f11 - - -] Caught error: 'str' object has no attribute 'metadata'\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack Traceback (most recent call last):\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/__init__.py\", line 139, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return req.get_response(self.application)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/request.py\", line 1317, in send\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     application, catch_exc_info=False)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/request.py\", line 1281, in call_application\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py\", line 467, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     response = req.get_response(self._app)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/request.py\", line 1317, in send\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     application, catch_exc_info=False)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/request.py\", line 1281, in call_application\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/routes/middleware.py\", line 136, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     response = self.app(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 672, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     content_type, body, accept)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 756, in _process_stack\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     request, action_args)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 619, in post_process_extensions\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     **action_args)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/compute/extended_availability_zone.py\", line 51, in detail\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     self._extend_server(context, server, db_instance)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/compute/extended_availability_zone.py\", line 33, in _extend_server\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     az = avail_zone.get_instance_availability_zone(context, instance)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/availability_zones.py\", line 169, in get_instance_availability_zone\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     az = cache.get(cache_key)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/cache_utils.py\", line 151, in get\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     value = self.region.get(key)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/dogpile/cache/region.py\", line 456, in get\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     expiration_time, ignore_expiration)(value)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/dogpile/cache/region.py\", line 475, in value_fn\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     current_time - value.metadata[\"ct\"] > expiration_time:\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack AttributeError: 'str' object has no attribute 'metadata'\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack\n2016-09-23 12:51:24.480 2241 INFO nova.api.openstack [req-16a27bf2-bebe-4f13-a408-4b5b09129d6c 111ea8c6602e44bc8d7b9a125c86f12a 48d9424cadf145e59c98d5ca53c54f11 - - -] http://xxxxxxxxxxxxxxxxxxxxx:8774/v2.1/48d9424cadf145e59c98d5ca53c54f11/servers/detail returned with HTTP 500", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1627177", 
    "owner": "None", 
    "id": 1627177, 
    "index": 6453, 
    "created": "2016-09-23 19:52:27.546708+00:00", 
    "title": "Liberty to Mitaka nova list fails when force create a VM on a bad compute node that is not reachable ", 
    "comments": [
        {
            "content": "Liberty to Mitaka Upgrade\n\nNova list fails when a user forces a compute creation on one of the nova computes that is in a bad state. \n\nnova list limiting to the other hypervisors works though and all other api commands work, except for the nova list. \n\nThis is happening when u create a vm on a bad compute else it works fine. \n\n\nLog \n\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack [req-16a27bf2-bebe-4f13-a408-4b5b09129d6c 111ea8c6602e44bc8d7b9a125c86f12a 48d9424cadf145e59c98d5ca53c54f11 - - -] Caught error: 'str' object has no attribute 'metadata'\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack Traceback (most recent call last):\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/__init__.py\", line 139, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return req.get_response(self.application)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/request.py\", line 1317, in send\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     application, catch_exc_info=False)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/request.py\", line 1281, in call_application\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py\", line 467, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     response = req.get_response(self._app)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/request.py\", line 1317, in send\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     application, catch_exc_info=False)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/request.py\", line 1281, in call_application\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/routes/middleware.py\", line 136, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     response = self.app(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 672, in __call__\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     content_type, body, accept)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 756, in _process_stack\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     request, action_args)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 619, in post_process_extensions\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     **action_args)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/compute/extended_availability_zone.py\", line 51, in detail\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     self._extend_server(context, server, db_instance)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/api/openstack/compute/extended_availability_zone.py\", line 33, in _extend_server\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     az = avail_zone.get_instance_availability_zone(context, instance)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/availability_zones.py\", line 169, in get_instance_availability_zone\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     az = cache.get(cache_key)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/cache_utils.py\", line 151, in get\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     value = self.region.get(key)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/dogpile/cache/region.py\", line 456, in get\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     expiration_time, ignore_expiration)(value)\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/dogpile/cache/region.py\", line 475, in value_fn\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack     current_time - value.metadata[\"ct\"] > expiration_time:\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack AttributeError: 'str' object has no attribute 'metadata'\n2016-09-23 12:51:24.479 2241 ERROR nova.api.openstack\n2016-09-23 12:51:24.480 2241 INFO nova.api.openstack [req-16a27bf2-bebe-4f13-a408-4b5b09129d6c 111ea8c6602e44bc8d7b9a125c86f12a 48d9424cadf145e59c98d5ca53c54f11 - - -] http://xxxxxxxxxxxxxxxxxxxxx:8774/v2.1/48d9424cadf145e59c98d5ca53c54f11/servers/detail returned with HTTP 500", 
            "date_created": "2016-09-23 19:52:27.546708+00:00", 
            "author": "https://api.launchpad.net/1.0/~munnangi2010"
        }, 
        {
            "content": "Could you provide more details please?\n\nI am not sure it's an OSA related bug, it looks more like a nova related bug.\n\nIn OSA we are expecting the cloud to be in a proper state before doing the upgrade, and we rely on/trust the deployer to check that.\n\nCould you give us ways to reproduce please?\n\nElse we'd have to classify this as invalid for OSA.\n\nThank you in advance.", 
            "date_created": "2016-09-27 16:24:07.344525+00:00", 
            "author": "https://api.launchpad.net/1.0/~jean-philippe-evrard"
        }, 
        {
            "content": "Ya looks to be more of nova. \n\n\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack     az = cache.get(cache_key)\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/nova/cache_utils.py\", line 151, in get\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack     value = self.region.get(key)\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/dogpile/cache/region.py\", line 456, in get\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack     expiration_time, ignore_expiration)(value)\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack   File \"/openstack/venvs/nova-13.3.3/lib/python2.7/site-packages/dogpile/cache/region.py\", line 475, in value_fn\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack     current_time - value.metadata[\"ct\"] > expiration_time:\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack AttributeError: 'str' object has no attribute 'metadata'\n2016-09-27 14:02:38.275 2152 ERROR nova.api.openstack\n\n\nIf you see the last 3 lines in the above trace shows \"current_time - value.metadata[\"ct\"] > expiration_time:\" , so whenever i force a vm create on a bad node it breaks the nova list. After a time works by itself without doing any thing. So restarting memcached brings nova list functionality back again. Its kind of odd as a bad node can break the api, but below is some other reference where its a similar problem \n\nhttps://bugs.launchpad.net/charms/+source/nova-cloud-controller/+bug/1595966\n\nWorkaround is to restart memcached and then it works all fine ", 
            "date_created": "2016-09-27 21:17:22.471002+00:00", 
            "author": "https://api.launchpad.net/1.0/~munnangi2010"
        }, 
        {
            "content": "As listed, this is an issue with memcache needing to be flushed after upgrade. This should be handled at the orchestration layer for upgrade. ", 
            "date_created": "2016-12-09 15:19:30.550830+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}