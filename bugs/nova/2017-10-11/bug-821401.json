{
    "status": "Invalid", 
    "last_updated": "2011-08-30 23:35:31.583846+00:00", 
    "description": "# echo \"SELECT cidr, bridge, bridge_interface, vlan FROM networks;\" | mysql -unova -pnova nova\ncidr\tbridge\tbridge_interface\tvlan\n10.20.0.0/23\tbr100\tbr100\t100\n10.20.2.0/23\tbr101\tbr100\t101\n10.20.4.0/23\tbr102\tbr100\t102\n10.20.6.0/23\tbr103\tbr100\t103\n\n# brctl show\nbridge name\tbridge id\t\tSTP enabled\tinterfaces\nvirbr0\t\t8000.525400940269\tyes\t\tvirbr0-nic\n\n2011-08-05 14:43:40,882 nova.rpc: received {u'_context_roles': [u'projectmanager'], u'_context_request_id': u'a2743846-0edb-436f-91c0-336afdecfea9', u'_context_read_deleted': False, u'args': {u'instance_id': 1, u'request_spec': {u'instance_properties': {u'state_description': u'scheduling', u'availability_zone': None, u'ramdisk_id': 2, u'instance_type_id': 2, u'user_data': u'', u'vm_mode': None, u'reservation_id': u'r-gbrp8l84', u'root_device_name': None, u'user_id': u'abr', u'display_description': None, u'key_data': u'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEAw8Y55w0TWwagtVdC36+oL+8wIUOWmomJXMwm2NtKmyajjDfTb3/sdQv9PhqlCxrkXI4uZyqK/7b2ZQ/DyQUUKNDWZ+BD/cLwfYvB25B9pKQUh/ExJ1jJOOgKvATDLQdcaAakywLYx9y966qxz7WdFuBqaO63g7WMkF2wYqLaVLE= nova@n5\\n', u'state': 0, u'project_id': u'rhelimg', u'metadata': {}, u'kernel_id': 1, u'key_name': u'rhelkey', u'display_name': None, u'local_gb': 0, u'locked': False, u'launch_time': u'2011-08-05T10:43:40Z', u'memory_mb': 512, u'vcpus': 1, u'image_ref': 3, u'architecture': None, u'os_type': None}, u'instance_type': {u'rxtx_quota': 0, u'deleted_at': None, u'name': u'm1.tiny', u'deleted': False, u'created_at': None, u'updated_at': None, u'memory_mb': 512, u'vcpus': 1, u'rxtx_cap': 0, u'extra_specs': {}, u'swap': 0, u'flavorid': 1, u'id': 2, u'local_gb': 0}, u'num_instances': 1, u'filter': u'nova.scheduler.host_filter.InstanceTypeFilter', u'blob': None}, u'admin_password': None, u'injected_files': None, u'availability_zone': None}, u'_context_auth_token': None, u'_context_is_admin': True, u'_context_project_id': u'rhelimg', u'_context_timestamp': u'2011-08-05T10:43:40.239047', u'_context_user_id': u'abr', u'method': u'run_instance', u'_context_remote_address': u'172.31.0.15'}\n2011-08-05 14:43:40,883 nova.rpc: unpacked context: {'user_id': u'abr', 'roles': [u'projectmanager'], 'timestamp': u'2011-08-05T10:43:40.239047', 'auth_token': None, 'msg_id': None, 'remote_address': u'172.31.0.15', 'is_admin': True, 'request_id': u'a2743846-0edb-436f-91c0-336afdecfea9', 'project_id': u'rhelimg', 'read_deleted': False}\n2011-08-05 14:43:41,135 nova.rpc: Making asynchronous call on network ...\n2011-08-05 14:43:41,136 nova.rpc: MSG_ID is 6f5aa7f25150416f8a9246b5ef9c8aef\n2011-08-05 14:43:41,136 nova.rpc: Creating new connection\n2011-08-05 14:43:42,088 nova: Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 230, in _process_data\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 97, in wrapped\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 379, in run_instance\n(nova): TRACE:     self._run_instance(context, instance_id, **kwargs)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 342, in _run_instance\n(nova): TRACE:     instance, vpn=is_vpn)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/api.py\", line 156, in allocate_for_instance\n(nova): TRACE:     'args': args})\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/__init__.py\", line 54, in call\n(nova): TRACE:     return RPCIMPL.call(context, topic, msg)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 525, in call\n(nova): TRACE:     rv = list(rv)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 514, in wait\n(nova): TRACE:     raise result\n(nova): TRACE: RemoteError: ProcessExecutionError Unexpected error while running command.\n(nova): TRACE: Command: sudo vconfig add br100 100\n(nova): TRACE: Exit code: 3\n(nova): TRACE: Stdout: ''\n(nova): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:br100:-  error: No such device\\n'\n\n# grep -i vlan /etc/nova/nova.conf \n--network_manager=nova.network.manager.VlanManager\n--vlan_interface=eth1\n\n# nova-manage version list\n2011.3-dev (2011.3-nova-tarball:tarmac-20110805022736-x8qgfav0gub7biuc)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/821401", 
    "owner": "None", 
    "id": 821401, 
    "index": 2224, 
    "created": "2011-08-05 10:45:37.320902+00:00", 
    "title": "Nova doesn't create a bridge anymore when configured using VlanManager", 
    "comments": [
        {
            "content": "# echo \"SELECT cidr, bridge, bridge_interface, vlan FROM networks;\" | mysql -unova -pnova nova\ncidr\tbridge\tbridge_interface\tvlan\n10.20.0.0/23\tbr100\tbr100\t100\n10.20.2.0/23\tbr101\tbr100\t101\n10.20.4.0/23\tbr102\tbr100\t102\n10.20.6.0/23\tbr103\tbr100\t103\n\n# brctl show\nbridge name\tbridge id\t\tSTP enabled\tinterfaces\nvirbr0\t\t8000.525400940269\tyes\t\tvirbr0-nic\n\n2011-08-05 14:43:40,882 nova.rpc: received {u'_context_roles': [u'projectmanager'], u'_context_request_id': u'a2743846-0edb-436f-91c0-336afdecfea9', u'_context_read_deleted': False, u'args': {u'instance_id': 1, u'request_spec': {u'instance_properties': {u'state_description': u'scheduling', u'availability_zone': None, u'ramdisk_id': 2, u'instance_type_id': 2, u'user_data': u'', u'vm_mode': None, u'reservation_id': u'r-gbrp8l84', u'root_device_name': None, u'user_id': u'abr', u'display_description': None, u'key_data': u'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEAw8Y55w0TWwagtVdC36+oL+8wIUOWmomJXMwm2NtKmyajjDfTb3/sdQv9PhqlCxrkXI4uZyqK/7b2ZQ/DyQUUKNDWZ+BD/cLwfYvB25B9pKQUh/ExJ1jJOOgKvATDLQdcaAakywLYx9y966qxz7WdFuBqaO63g7WMkF2wYqLaVLE= nova@n5\\n', u'state': 0, u'project_id': u'rhelimg', u'metadata': {}, u'kernel_id': 1, u'key_name': u'rhelkey', u'display_name': None, u'local_gb': 0, u'locked': False, u'launch_time': u'2011-08-05T10:43:40Z', u'memory_mb': 512, u'vcpus': 1, u'image_ref': 3, u'architecture': None, u'os_type': None}, u'instance_type': {u'rxtx_quota': 0, u'deleted_at': None, u'name': u'm1.tiny', u'deleted': False, u'created_at': None, u'updated_at': None, u'memory_mb': 512, u'vcpus': 1, u'rxtx_cap': 0, u'extra_specs': {}, u'swap': 0, u'flavorid': 1, u'id': 2, u'local_gb': 0}, u'num_instances': 1, u'filter': u'nova.scheduler.host_filter.InstanceTypeFilter', u'blob': None}, u'admin_password': None, u'injected_files': None, u'availability_zone': None}, u'_context_auth_token': None, u'_context_is_admin': True, u'_context_project_id': u'rhelimg', u'_context_timestamp': u'2011-08-05T10:43:40.239047', u'_context_user_id': u'abr', u'method': u'run_instance', u'_context_remote_address': u'172.31.0.15'}\n2011-08-05 14:43:40,883 nova.rpc: unpacked context: {'user_id': u'abr', 'roles': [u'projectmanager'], 'timestamp': u'2011-08-05T10:43:40.239047', 'auth_token': None, 'msg_id': None, 'remote_address': u'172.31.0.15', 'is_admin': True, 'request_id': u'a2743846-0edb-436f-91c0-336afdecfea9', 'project_id': u'rhelimg', 'read_deleted': False}\n2011-08-05 14:43:41,135 nova.rpc: Making asynchronous call on network ...\n2011-08-05 14:43:41,136 nova.rpc: MSG_ID is 6f5aa7f25150416f8a9246b5ef9c8aef\n2011-08-05 14:43:41,136 nova.rpc: Creating new connection\n2011-08-05 14:43:42,088 nova: Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 230, in _process_data\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 97, in wrapped\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 379, in run_instance\n(nova): TRACE:     self._run_instance(context, instance_id, **kwargs)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 342, in _run_instance\n(nova): TRACE:     instance, vpn=is_vpn)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/api.py\", line 156, in allocate_for_instance\n(nova): TRACE:     'args': args})\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/__init__.py\", line 54, in call\n(nova): TRACE:     return RPCIMPL.call(context, topic, msg)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 525, in call\n(nova): TRACE:     rv = list(rv)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 514, in wait\n(nova): TRACE:     raise result\n(nova): TRACE: RemoteError: ProcessExecutionError Unexpected error while running command.\n(nova): TRACE: Command: sudo vconfig add br100 100\n(nova): TRACE: Exit code: 3\n(nova): TRACE: Stdout: ''\n(nova): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:br100:-  error: No such device\\n'\n\n# grep -i vlan /etc/nova/nova.conf \n--network_manager=nova.network.manager.VlanManager\n--vlan_interface=eth1\n\n# nova-manage version list\n2011.3-dev (2011.3-nova-tarball:tarmac-20110805022736-x8qgfav0gub7biuc)", 
            "date_created": "2011-08-05 10:45:37.320902+00:00", 
            "author": "https://api.launchpad.net/1.0/~abrindeyev"
        }, 
        {
            "content": "nova-network.log:\n\n2011-08-05 14:43:41,225 nova.rpc: received {u'_context_roles': [u'projectmanager'], u'_msg_id': u'6f5aa7f25150416f8a9246b5ef9c8aef', u'_context_read_deleted': False, u'_context_request_id': u'a2743846-0edb-43\n6f-91c0-336afdecfea9', u'args': {u'instance_id': 1, u'instance_type_id': 2, u'host': u'n5', u'project_id': u'rhelimg', u'vpn': False}, u'_context_auth_token': None, u'_context_is_admin': True, u'_context_proj\nect_id': u'rhelimg', u'_context_timestamp': u'2011-08-05T10:43:40.239047', u'_context_user_id': u'abr', u'method': u'allocate_for_instance', u'_context_remote_address': u'172.31.0.15'}\n2011-08-05 14:43:41,225 nova.rpc: unpacked context: {'user_id': u'abr', 'roles': [u'projectmanager'], 'timestamp': u'2011-08-05T10:43:40.239047', 'auth_token': None, 'msg_id': u'6f5aa7f25150416f8a9246b5ef9c8a\nef', 'remote_address': u'172.31.0.15', 'is_admin': True, 'request_id': u'a2743846-0edb-436f-91c0-336afdecfea9', 'project_id': u'rhelimg', 'read_deleted': False}\n2011-08-05 14:43:41,293 nova.network.manager: [<nova.db.sqlalchemy.models.Network object at 0x3efb2d0>]\n2011-08-05 14:43:41,335 nova.rpc: Making asynchronous call on network ...\n2011-08-05 14:43:41,336 nova.rpc: MSG_ID is 573e03d1212b44e28d1a4a3cf85725b7\n2011-08-05 14:43:41,336 nova.rpc: Creating new connection\n2011-08-05 14:43:41,425 nova.rpc: received {u'_context_roles': [u'projectmanager'], u'_msg_id': u'573e03d1212b44e28d1a4a3cf85725b7', u'_context_read_deleted': False, u'_context_request_id': u'a2743846-0edb-436f-91c0-336afdecfea9', u'args': {u'network_ref': {u'bridge': u'br100', u'vpn_public_port': 1000, u'dhcp_start': u'10.20.0.3', u'bridge_interface': u'br100', u'updated_at': u'2011-08-05 10:43:41.240897', u'id': 1, u'cidr_v6': None, u'deleted_at': None, u'gateway': u'10.20.0.1', u'label': u'novanet_0', u'project_id': u'rhelimg', u'netmask_v6': None, u'deleted': False, u'vlan': 100, u'broadcast': u'10.20.1.255', u'netmask': u'255.255.254.0', u'injected': False, u'cidr': u'10.20.0.0/23', u'vpn_public_address': None, u'multi_host': False, u'dns2': None, u'dns1': None, u'host': None, u'gateway_v6': None, u'vpn_private_address': u'10.20.0.2', u'created_at': u'2011-08-05 10:40:26'}}, u'_context_auth_token': None, u'_context_is_admin': True, u'_context_project_id': u'rhelimg', u'_context_timestamp': u'2011-08-05T10:43:40.239047', u'_context_user_id': u'abr', u'method': u'set_network_host', u'_context_remote_address': u'172.31.0.15'}\n2011-08-05 14:43:41,426 nova.rpc: unpacked context: {'user_id': u'abr', 'roles': [u'projectmanager'], 'timestamp': u'2011-08-05T10:43:40.239047', 'auth_token': None, 'msg_id': u'573e03d1212b44e28d1a4a3cf85725b7', 'remote_address': u'172.31.0.15', 'is_admin': True, 'request_id': u'a2743846-0edb-436f-91c0-336afdecfea9', 'project_id': u'rhelimg', 'read_deleted': False}\n2011-08-05 14:43:41,485 nova.rpc: Creating new connection\n2011-08-05 14:43:41,935 nova.utils: Attempting to grab semaphore \"get_dhcp\" for method \"_get_dhcp_ip\"...\n2011-08-05 14:43:41,936 nova.utils: Attempting to grab semaphore \"ensure_vlan\" for method \"ensure_vlan\"...\n2011-08-05 14:43:41,936 nova.utils: Attempting to grab file lock \"ensure_vlan\" for method \"ensure_vlan\"...\n2011-08-05 14:43:41,937 nova.utils: Running cmd (subprocess): ip link show dev vlan100\n2011-08-05 14:43:41,941 nova.utils: Result was 255\n2011-08-05 14:43:41,942 nova.linux_net: Starting VLAN inteface vlan100\n2011-08-05 14:43:41,942 nova.utils: Running cmd (subprocess): sudo vconfig set_name_type VLAN_PLUS_VID_NO_PAD\n2011-08-05 14:43:41,954 nova.utils: Running cmd (subprocess): sudo vconfig add br100 100\n2011-08-05 14:43:41,966 nova.utils: Result was 3\n2011-08-05 14:43:41,967 nova: Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 230, in _process_data\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 205, in allocate_for_instance\n(nova): TRACE:     ips = super(FloatingIP, self).allocate_for_instance(context, **kwargs)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 403, in allocate_for_instance\n(nova): TRACE:     vpn=vpn)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 156, in _allocate_fixed_ips\n(nova): TRACE:     self.allocate_fixed_ip(context, instance_id, network, vpn=vpn)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 867, in allocate_fixed_ip\n(nova): TRACE:     self._setup_network(context, network)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 909, in _setup_network\n(nova): TRACE:     network_ref)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 456, in ensure_vlan_bridge\n(nova): TRACE:     interface = ensure_vlan(vlan_num, bridge_interface)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 674, in inner\n(nova): TRACE:     retval = f(*args, **kwargs)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 468, in ensure_vlan\n(nova): TRACE:     _execute('sudo', 'vconfig', 'add', bridge_interface, vlan_num)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 689, in _execute\n(nova): TRACE:     return utils.execute(*cmd, **kwargs)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 184, in execute\n(nova): TRACE:     cmd=' '.join(cmd))\n(nova): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova): TRACE: Command: sudo vconfig add br100 100\n(nova): TRACE: Exit code: 3\n(nova): TRACE: Stdout: ''\n(nova): TRACE: Stderr: 'ERROR: trying to add VLAN #100 to IF -:br100:-  error: No such device\\n'\n(nova): TRACE:", 
            "date_created": "2011-08-05 10:48:05.941170+00:00", 
            "author": "https://api.launchpad.net/1.0/~abrindeyev"
        }, 
        {
            "content": "you can't add a vlan to a bridge.\n\nIt looks like bridge_interface was set incorrectly when you created your networks. It needs to be something like eth0, not br100", 
            "date_created": "2011-08-30 23:35:30.131994+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ]
}