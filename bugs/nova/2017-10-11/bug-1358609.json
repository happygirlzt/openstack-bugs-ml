{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:49:29.612102+00:00", 
    "description": "ENOENT error breaks update_status() during PowerKVM testing. It should be a bug of libvirt driver.\n\nException log:\n\n2014-08-15 16:03:59.038 42817 ERROR nova.openstack.common.periodic_task [-] Error during PowerVCComputeManager.update_available_resource: [Errno 2] No such file or directory: '/mnt//nova/instances/2132a870-ad5e-4d42-a43c-\nca1e93fe7eeb/disk'\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task Traceback (most recent call last):\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/periodic_task.py\", line 198, in run_periodic_tasks\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     task(self, context)\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5667, in update_available_resource\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     rt.update_available_resource(context)\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/powervc_nova/compute/manager.py\", line 3805, in update_available_resource\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     self.driver.get_host_stats(refresh=True)\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5026, in get_host_stats\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     return self.host_state.get_host_stats(refresh=refresh)\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/powervc_nova/virt/powerkvm/driver.py\", line 1688, in get_host_stats\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     self._data = self.update_status()\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/powervc_nova/virt/powerkvm/driver.py\", line 1693, in update_status\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     data = super(PowerKVMHostState, self).update_status()\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5515, in update_status\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     data['disk_available_least'] = _get_disk_available_least()\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5488, in _get_disk_available_least\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     disk_over_committed = (self.driver.\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4984, in _get_disk_over_committed_size_total\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     self._get_instance_disk_info(dom.name(), xml))\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4937, in _get_instance_disk_info\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     dk_size = int(os.path.getsize(path))\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib64/python2.7/genericpath.py\", line 49, in getsize\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     return os.stat(filename).st_size\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task OSError: [Errno 2] No such file or directory: '/mnt//nova/instances/2132a870-ad5e-4d42-a43c-ca1e93fe7eeb/disk'\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task", 
    "tags": [
        "icehouse-backport-potential", 
        "libvirt"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1358609", 
    "owner": "https://api.launchpad.net/1.0/~zhaoqin", 
    "id": 1358609, 
    "index": 5085, 
    "created": "2014-08-19 06:20:43.270050+00:00", 
    "title": "ENOENT error breaks update_status() of libvirt driver", 
    "comments": [
        {
            "content": "ENOENT error breaks update_status() during PowerKVM testing. It should be a bug of libvirt driver.\n\nException log:\n\n2014-08-15 16:03:59.038 42817 ERROR nova.openstack.common.periodic_task [-] Error during PowerVCComputeManager.update_available_resource: [Errno 2] No such file or directory: '/mnt//nova/instances/2132a870-ad5e-4d42-a43c-\nca1e93fe7eeb/disk'\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task Traceback (most recent call last):\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/periodic_task.py\", line 198, in run_periodic_tasks\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     task(self, context)\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5667, in update_available_resource\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     rt.update_available_resource(context)\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/powervc_nova/compute/manager.py\", line 3805, in update_available_resource\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     self.driver.get_host_stats(refresh=True)\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5026, in get_host_stats\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     return self.host_state.get_host_stats(refresh=refresh)\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/powervc_nova/virt/powerkvm/driver.py\", line 1688, in get_host_stats\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     self._data = self.update_status()\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/powervc_nova/virt/powerkvm/driver.py\", line 1693, in update_status\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     data = super(PowerKVMHostState, self).update_status()\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5515, in update_status\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     data['disk_available_least'] = _get_disk_available_least()\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5488, in _get_disk_available_least\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     disk_over_committed = (self.driver.\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4984, in _get_disk_over_committed_size_total\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     self._get_instance_disk_info(dom.name(), xml))\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4937, in _get_instance_disk_info\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     dk_size = int(os.path.getsize(path))\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task   File \"/usr/lib64/python2.7/genericpath.py\", line 49, in getsize\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task     return os.stat(filename).st_size\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task OSError: [Errno 2] No such file or directory: '/mnt//nova/instances/2132a870-ad5e-4d42-a43c-ca1e93fe7eeb/disk'\n2014-08-15 16:03:59.038 42817 TRACE nova.openstack.common.periodic_task", 
            "date_created": "2014-08-19 06:20:43.270050+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhaoqin"
        }, 
        {
            "content": "If errno is ENOENT, the code will print a warning and continue to raise the exception. I feel the correct behavior is not throwing this exception.\n\n            except OSError as e:\n                if e.errno == errno.ENOENT:\n                    LOG.warn(_LW('Periodic task is updating the host stat, '\n                                 'it is trying to get disk %(i_name)s, '\n                                 'but disk file was removed by concurrent '\n                                 'operations such as resize.'),\n                                {'i_name': dom.name()})\n                if e.errno == errno.EACCES:\n                    LOG.warn(_LW('Periodic task is updating the host stat, '\n                                 'it is trying to get disk %(i_name)s, '\n                                 'but access is denied. It is most likely '\n                                 'due to a VM that exists on the compute '\n                                 'node but is not managed by Nova.'),\n                             {'i_name': dom.name()})\n                else:\n                    raise", 
            "date_created": "2014-08-19 06:24:41.227814+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhaoqin"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/115194", 
            "date_created": "2014-08-19 07:06:58.073803+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/115194\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=3ca0817d1f78e8f63610b5d7667752f7f4a05b51\nSubmitter: Jenkins\nBranch:    master\n\ncommit 3ca0817d1f78e8f63610b5d7667752f7f4a05b51\nAuthor: Qin Zhao <email address hidden>\nDate:   Tue Aug 19 14:56:12 2014 +0800\n\n    Libvirt: Do not raise ENOENT exception\n    \n    If the disk disappears during update_status(), only need to print\n    a warning, and do not need to raise an exception.\n    \n    Change-Id: I87800c855c7b349f69163e33031404ad25e2a9ca\n    Closes-Bug: 1358609\n", 
            "date_created": "2014-08-21 21:38:32.742015+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}