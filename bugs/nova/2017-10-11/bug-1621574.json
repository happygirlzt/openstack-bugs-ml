{
    "status": "Fix Released", 
    "last_updated": "2016-10-18 17:02:07.073384+00:00", 
    "description": "Seeing this in a cells v1 job here:\n\nhttp://logs.openstack.org/55/367455/1/check/gate-tempest-dsvm-cells/1d8af83/logs/screen-n-api.txt.gz#_2016-09-08_15_59_02_553\n\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions [req-0f23fed6-0aaf-461f-96d8-f4aa5055b208 tempest-ListServersNegativeTestJSON-1414534476 tempest-ListServersNegativeTestJSON-1414534476] Unexpected exception in API method\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 915, in delete\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     self._delete(req.environ['nova.context'], req, id)\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 767, in _delete\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     self.compute_api.delete(context, instance)\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/cells_api.py\", line 213, in delete\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     self._handle_cell_delete(context, instance, 'delete')\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/cells_api.py\", line 224, in _handle_cell_delete\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     if self._delete_while_booting(context, instance):\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 1648, in _delete_while_booting\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     instance.destroy()\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 226, in wrapper\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     return fn(self, *args, **kwargs)\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 555, in destroy\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     reason='host changed')\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions ObjectActionError: Object action destroy failed because: host changed\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions \n\nhttp://logs.openstack.org/55/367455/1/check/gate-tempest-dsvm-cells/1d8af83/console.html#_2016-09-08_16_13_48_892443\n\nlogs.openstack.org/55/367455/1/check/gate-tempest-dsvm-cells/1d8af83/logs/tempest.txt.gz#_2016-09-08_15_59_02_558\n\nIn this test it creates a server and then immediately deletes it without waiting for it to be ACTIVE first.\n\nI wonder if we're racing with any of the BuildRequest stuff that's new in Newton.\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22ObjectActionError%3A%20Object%20action%20destroy%20failed%20because%3A%20host%20changed%5C%22%20AND%20message%3A%5C%22_handle_cell_delete%5C%22%20AND%20tags%3A%5C%22screen-n-api.txt%5C%22&from=7d\n\n10 hits in the last 7 days, check and gate, master (newton) only at this point.", 
    "tags": [
        "cells"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1621574", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1621574, 
    "index": 4615, 
    "created": "2016-09-08 18:06:59.561715+00:00", 
    "title": "Instance fails to delete while building in cells v1 due to 'ObjectActionError: Object action destroy failed because: host changed'", 
    "comments": [
        {
            "content": "Seeing this in a cells v1 job here:\n\nhttp://logs.openstack.org/55/367455/1/check/gate-tempest-dsvm-cells/1d8af83/logs/screen-n-api.txt.gz#_2016-09-08_15_59_02_553\n\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions [req-0f23fed6-0aaf-461f-96d8-f4aa5055b208 tempest-ListServersNegativeTestJSON-1414534476 tempest-ListServersNegativeTestJSON-1414534476] Unexpected exception in API method\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 915, in delete\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     self._delete(req.environ['nova.context'], req, id)\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 767, in _delete\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     self.compute_api.delete(context, instance)\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/cells_api.py\", line 213, in delete\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     self._handle_cell_delete(context, instance, 'delete')\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/cells_api.py\", line 224, in _handle_cell_delete\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     if self._delete_while_booting(context, instance):\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 1648, in _delete_while_booting\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     instance.destroy()\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 226, in wrapper\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     return fn(self, *args, **kwargs)\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 555, in destroy\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions     reason='host changed')\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions ObjectActionError: Object action destroy failed because: host changed\n2016-09-08 15:59:02.553 15924 ERROR nova.api.openstack.extensions \n\nhttp://logs.openstack.org/55/367455/1/check/gate-tempest-dsvm-cells/1d8af83/console.html#_2016-09-08_16_13_48_892443\n\nlogs.openstack.org/55/367455/1/check/gate-tempest-dsvm-cells/1d8af83/logs/tempest.txt.gz#_2016-09-08_15_59_02_558\n\nIn this test it creates a server and then immediately deletes it without waiting for it to be ACTIVE first.\n\nI wonder if we're racing with any of the BuildRequest stuff that's new in Newton.\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22ObjectActionError%3A%20Object%20action%20destroy%20failed%20because%3A%20host%20changed%5C%22%20AND%20message%3A%5C%22_handle_cell_delete%5C%22%20AND%20tags%3A%5C%22screen-n-api.txt%5C%22&from=7d\n\n10 hits in the last 7 days, check and gate, master (newton) only at this point.", 
            "date_created": "2016-09-08 18:06:59.561715+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/367597", 
            "date_created": "2016-09-08 19:46:18.911277+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/367597\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=193e71bd30bbc6dd0a22b4e07d98e8a763ddda7b\nSubmitter: Jenkins\nBranch:    master\n\ncommit 193e71bd30bbc6dd0a22b4e07d98e8a763ddda7b\nAuthor: Andrew Laski <email address hidden>\nDate:   Thu Sep 8 15:42:36 2016 -0400\n\n    Handle ObjectActionError during cells instance delete\n    \n    There was logic in place to handle an ObjectActionError being raised\n    when deleting an instance with cellsv1, however a second\n    instance.destroy() call was added which did not have the same logic\n    applied. This adds appropriate handling for that case.\n    \n    Change-Id: I007f249f772dbb53cf24a9bf06d2962001cb8384\n    Closes-Bug: 1621574\n", 
            "date_created": "2016-09-09 18:31:14.352265+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0rc1 release candidate.", 
            "date_created": "2016-09-26 20:14:29.903870+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0rc1 release candidate.", 
            "date_created": "2016-10-18 17:02:06.305874+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}