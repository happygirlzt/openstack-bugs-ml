{
    "status": "Opinion", 
    "last_updated": "2016-04-16 11:16:23.623394+00:00", 
    "description": "shelve_offloading a server, and then resetting it state, makes it unavailable for any command:\n\nshoham@ubuntu:~/devstack$ nova list\nnova s+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| 1abddec6-06a3-4e91-bf47-899a0b76c1dd | b    | ACTIVE | -          | Running     | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\nshoham@ubuntu:~/devstack$ nova shelve b \nshoham@ubuntu:~/devstack$ nova list\n+--------------------------------------+------+-------------------+------------+-------------+------------------+\n| ID                                   | Name | Status            | Task State | Power State | Networks         |\n+--------------------------------------+------+-------------------+------------+-------------+------------------+\n| 1abddec6-06a3-4e91-bf47-899a0b76c1dd | b    | SHELVED_OFFLOADED | -          | Shutdown    | private=10.0.0.2 |\n+--------------------------------------+------+-------------------+------------+-------------+------------------+\nshoham@ubuntu:~/devstack$ nova reset-state --active b\nReset state for server b succeeded; new state is active\nshoham@ubuntu:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| 1abddec6-06a3-4e91-bf47-899a0b76c1dd | b    | ACTIVE | -          | Shutdown    | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\nshoham@ubuntu:~/devstack$ nova stop b\nInstance 1abddec6-06a3-4e91-bf47-899a0b76c1dd is not ready (HTTP 409) (Request-ID: req-35fbdc75-9465-48dc-a2b6-321568d953cd)\nERROR (CommandError): Unable to stop the specified server(s).\nshoham@ubuntu:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| 1abddec6-06a3-4e91-bf47-899a0b76c1dd | b    | ACTIVE | -          | Shutdown    | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\nshoham@ubuntu:~/devstack$ nova shelve b\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.NovaException'> (HTTP 500) (Request-ID: req-d019cdc2-e02c-42ec-a8f7-a6ce85087ff3)\n\nnova version is 13.0.0.0b3.dev169", 
    "tags": [
        "api", 
        "compute"
    ], 
    "importance": "Low", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1570471", 
    "owner": "None", 
    "id": 1570471, 
    "index": 728, 
    "created": "2016-04-14 16:34:59.413334+00:00", 
    "title": "reset-state on shelve-offloaded server makes it unusable", 
    "comments": [
        {
            "content": "shelve_offloading a server, and then resetting it state, makes it unavailable for any command:\n\nshoham@ubuntu:~/devstack$ nova list\nnova s+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| 1abddec6-06a3-4e91-bf47-899a0b76c1dd | b    | ACTIVE | -          | Running     | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\nshoham@ubuntu:~/devstack$ nova shelve b \nshoham@ubuntu:~/devstack$ nova list\n+--------------------------------------+------+-------------------+------------+-------------+------------------+\n| ID                                   | Name | Status            | Task State | Power State | Networks         |\n+--------------------------------------+------+-------------------+------------+-------------+------------------+\n| 1abddec6-06a3-4e91-bf47-899a0b76c1dd | b    | SHELVED_OFFLOADED | -          | Shutdown    | private=10.0.0.2 |\n+--------------------------------------+------+-------------------+------------+-------------+------------------+\nshoham@ubuntu:~/devstack$ nova reset-state --active b\nReset state for server b succeeded; new state is active\nshoham@ubuntu:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| 1abddec6-06a3-4e91-bf47-899a0b76c1dd | b    | ACTIVE | -          | Shutdown    | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\nshoham@ubuntu:~/devstack$ nova stop b\nInstance 1abddec6-06a3-4e91-bf47-899a0b76c1dd is not ready (HTTP 409) (Request-ID: req-35fbdc75-9465-48dc-a2b6-321568d953cd)\nERROR (CommandError): Unable to stop the specified server(s).\nshoham@ubuntu:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| 1abddec6-06a3-4e91-bf47-899a0b76c1dd | b    | ACTIVE | -          | Shutdown    | private=10.0.0.2 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\nshoham@ubuntu:~/devstack$ nova shelve b\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.NovaException'> (HTTP 500) (Request-ID: req-d019cdc2-e02c-42ec-a8f7-a6ce85087ff3)\n\nnova version is 13.0.0.0b3.dev169", 
            "date_created": "2016-04-14 16:34:59.413334+00:00", 
            "author": "https://api.launchpad.net/1.0/~shoham-peller"
        }, 
        {
            "content": "Not sure it's something Nova should support. Using reset-state should be only for ERROR states IMHO, not for others (at the moment, until we have better Tasks management).\n\nMaybe we could change the API behaviour to return a 401 when someone is asking to reset-state ", 
            "date_created": "2016-04-15 10:25:43.690867+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "(meh, tab+space posted my comment)\n\nI was saying :\n\n\nMaybe we could change the API behaviour to return a 401 when someone is asking to reset-state when the instance is not in ERROR state?", 
            "date_created": "2016-04-15 10:26:37.912183+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "@sylvain-bauza Not sure I agree.\nreset-state is useful in other cases, for example if the server is stuck in a certain task:\nhttp://lists.openstack.org/pipermail/openstack-dev/2016-April/092239.html\n\nIf reset-state would only be for servers in error state, this might take from the users the power to manually bypass bugs.", 
            "date_created": "2016-04-16 11:16:22.909349+00:00", 
            "author": "https://api.launchpad.net/1.0/~shoham-peller"
        }
    ]
}