{
    "status": "Opinion", 
    "last_updated": "2017-07-27 03:12:09.379663+00:00", 
    "description": "Description\n===========\nAfter launching a instance in AArch64 via Nova, running nova console log I can get some messy code information. Due to the console type is not correct.\n==================\n1.Using devstack to deploy openstack. Using default local.conf.\n\n2.Upload the aarch64 image with glance.\n$ source ~/devstack/openrc admin admin\n$ glance image-create --name image-arm64.img --disk-format qcow2 --container-format bare --visibility public --file images/image-arm64-wily.qcow2 --progress\n$ glance image-create --name image-arm64.vmlinuz --disk-format aki --container-format aki --visibility public --file images/image-arm64-wily.vmlinuz --progress\n$ glance image-create --name image-arm64.initrd --disk-format ari --container-format ari --visibility public --file images/image-arm64-wily.initrd --progress\n$ IMAGE_UUID=$(glance image-list | grep image-arm64.img | awk '{ print $2 }')\n$ IMAGE_KERNEL_UUID=$(glance image-list | grep image-arm64.vmlinuz | awk '{ print $2 }')\n$ IMAGE_INITRD_UUID=$(glance image-list | grep image-arm64.initrd | awk '{ print $2 }')\n$ glance image-update --kernel-id ${IMAGE_KERNEL_UUID} --ramdisk-id ${IMAGE_INITRD_UUID} ${IMAGE_UUID}\n3.Set the scsi model:\n$ glance image-update --property hw_disk_bus --property hw_scsi_model=virtio-scsi ${IMAGE_UUID}\n\n4.nova add keypair\n$ nova keypair-add default --pub-key ~/.ssh/id_rsa.pub\n\n5.Launch the instance:\n$ image=$(nova image-list | egrep \"image-arm64.img\"'[^-]' | awk '{ print $2 }')\n$ nova boot --flavor m1.small--image ${image} --key-name default test-arm64\n\n6.nova console-log <instanceid>\n\nExpected result\n===============\nGet the console information\n\nActual result\n=============\nMessy Code or No information.\n\nThe default kernel command line is not properly in AArch64. \"console=tty0 console=ttyS0\" is not supported in AArch64.\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running. See the following\n  list for all releases: http://docs.openstack.org/releases/\n   Nova development, commit code: 3e96b0fde010c3f800a539eec5376c3c379c8594\n\n2. Which hypervisor did you use?\n    Libvirt+KVM\n    $ kvm --version\n    QEMU emulator version 2.5.0 (Debian 1:2.5+dfsg-5ubuntu10.1), Copyright (c) 2003-2008 Fabrice Bellard\n    $ libvirtd --version\n    libvirtd (libvirt) 1.3.1\n\n2. Which storage type did you use?\n   In the host file system,all in one physics machine.\nstack@u202154:/opt/stack/nova$ df -hl\nFilesystem Size Used Avail Use% Mounted on\nudev 7.8G 0 7.8G 0% /dev\ntmpfs 1.6G 21M 1.6G 2% /run\n/dev/sda2 917G 12G 859G 2% /\ntmpfs 7.9G 0 7.9G 0% /dev/shm\ntmpfs 5.0M 0 5.0M 0% /run/lock\ntmpfs 7.9G 0 7.9G 0% /sys/fs/cgroup\n/dev/sda1 511M 888K 511M 1% /boot/efi\ncgmfs 100K 0 100K 0% /run/cgmanager/fs\ntmpfs 1.6G 0 1.6G 0% /run/user/1002\n\n3. Which networking type did you use?\n   nova-network\n\n4. Environment information:\n   Architecture : AARCH64\n   OS: Ubuntu 16.04\n\nDetailed log info is in the accessory.\nThe guest xml is:\n<domain type=\"kvm\">\n  <uuid>c1be4539-43ba-4c88-b725-cdaf0fbccf8e</uuid>\n  <name>instance-00000015</name>\n  <memory>4194304</memory>\n  <vcpu>2</vcpu>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"14.0.0\"/>\n      <nova:name>test-cirros</nova:name>\n      <nova:creationTime>2016-07-20 06:09:32</nova:creationTime>\n      <nova:flavor name=\"m1.medium\">\n        <nova:memory>4096</nova:memory>\n        <nova:disk>40</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>2</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"0d6bdadb64b0465f91c29ed99bcfdc1b\">admin</nova:user>\n        <nova:project uuid=\"515d0c47f9834dd2be2295e5a6232548\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"96c15ae2-7a6c-429f-8c73-0a06b76110ee\"/>\n    </nova:instance>\n  </metadata>\n  <os>\n    <type machine=\"virt\">hvm</type>\n    <kernel>/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/kernel</kernel>\n    <initrd>/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/ramdisk</initrd>\n    <cmdline>root=/dev/vda console=ttyAMA0</cmdline>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cputune>\n    <shares>2048</shares>\n  </cputune>\n  <clock offset=\"utc\">\n    <timer name=\"pit\" tickpolicy=\"delay\"/>\n    <timer name=\"rtc\" tickpolicy=\"catchup\"/>\n  </clock>\n  <cpu mode=\"host-passthrough\" match=\"exact\">\n    <topology sockets=\"2\" cores=\"1\" threads=\"1\"/>\n  </cpu>\n  <devices>\n    <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/disk\"/>\n      <target bus=\"virtio\" dev=\"vda\"/>\n    </disk>\n    <disk type=\"file\" device=\"cdrom\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source file=\"/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/disk.config\"/>\n      <target bus=\"scsi\" dev=\"sdz\"/>\n    </disk>\n    <interface type=\"bridge\">\n      <mac address=\"fa:16:3e:cb:13:a1\"/>\n      <model type=\"virtio\"/>\n      <source bridge=\"br100\"/>\n      <filterref filter=\"nova-instance-instance-00000015-fa163ecb13a1\"/>\n    </interface>\n    <serial type=\"file\">\n      <source path=\"/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/console.log\"/>\n    </serial>\n    <serial type=\"pty\"/>\n    <memballoon model=\"virtio\">\n      <stats period=\"10\"/>\n    </memballoon>\n  </devices>\n</domain>", 
    "tags": [], 
    "importance": "Wishlist", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1604677", 
    "owner": "https://api.launchpad.net/1.0/~kevin-zhao", 
    "id": 1604677, 
    "index": 1812, 
    "created": "2016-07-20 06:10:28.965219+00:00", 
    "title": "Got messy code via console log in AArch64", 
    "comments": [
        {
            "content": "Description\n===========\nAfter launching a instance in AArch64 via Nova, running nova console log I can get some messy code information. Due to the console type is not correct.\n==================\n1.Using devstack to deploy openstack. Using default local.conf.\n\n2.Upload the aarch64 image with glance.\n$ source ~/devstack/openrc admin admin\n$ glance image-create --name image-arm64.img --disk-format qcow2 --container-format bare --visibility public --file images/image-arm64-wily.qcow2 --progress\n$ glance image-create --name image-arm64.vmlinuz --disk-format aki --container-format aki --visibility public --file images/image-arm64-wily.vmlinuz --progress\n$ glance image-create --name image-arm64.initrd --disk-format ari --container-format ari --visibility public --file images/image-arm64-wily.initrd --progress\n$ IMAGE_UUID=$(glance image-list | grep image-arm64.img | awk '{ print $2 }')\n$ IMAGE_KERNEL_UUID=$(glance image-list | grep image-arm64.vmlinuz | awk '{ print $2 }')\n$ IMAGE_INITRD_UUID=$(glance image-list | grep image-arm64.initrd | awk '{ print $2 }')\n$ glance image-update --kernel-id ${IMAGE_KERNEL_UUID} --ramdisk-id ${IMAGE_INITRD_UUID} ${IMAGE_UUID}\n3.Set the scsi model:\n$ glance image-update --property hw_disk_bus --property hw_scsi_model=virtio-scsi ${IMAGE_UUID}\n\n4.nova add keypair\n$ nova keypair-add default --pub-key ~/.ssh/id_rsa.pub\n\n5.Launch the instance:\n$ image=$(nova image-list | egrep \"image-arm64.img\"'[^-]' | awk '{ print $2 }')\n$ nova boot --flavor m1.small--image ${image} --key-name default test-arm64\n\n6.nova console-log <instanceid>\n\nExpected result\n===============\nGet the console information\n\nActual result\n=============\nMessy Code or No information.\n\nThe default kernel command line is not properly in AArch64. \"console=tty0 console=ttyS0\" is not supported in AArch64.\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running. See the following\n  list for all releases: http://docs.openstack.org/releases/\n   Nova development, commit code: 3e96b0fde010c3f800a539eec5376c3c379c8594\n\n2. Which hypervisor did you use?\n    Libvirt+KVM\n    $ kvm --version\n    QEMU emulator version 2.5.0 (Debian 1:2.5+dfsg-5ubuntu10.1), Copyright (c) 2003-2008 Fabrice Bellard\n    $ libvirtd --version\n    libvirtd (libvirt) 1.3.1\n\n2. Which storage type did you use?\n   In the host file system,all in one physics machine.\nstack@u202154:/opt/stack/nova$ df -hl\nFilesystem Size Used Avail Use% Mounted on\nudev 7.8G 0 7.8G 0% /dev\ntmpfs 1.6G 21M 1.6G 2% /run\n/dev/sda2 917G 12G 859G 2% /\ntmpfs 7.9G 0 7.9G 0% /dev/shm\ntmpfs 5.0M 0 5.0M 0% /run/lock\ntmpfs 7.9G 0 7.9G 0% /sys/fs/cgroup\n/dev/sda1 511M 888K 511M 1% /boot/efi\ncgmfs 100K 0 100K 0% /run/cgmanager/fs\ntmpfs 1.6G 0 1.6G 0% /run/user/1002\n\n3. Which networking type did you use?\n   nova-network\n\n4. Environment information:\n   Architecture : AARCH64\n   OS: Ubuntu 16.04\n\nDetailed log info is in the accessory.\nThe guest xml is:\n<domain type=\"kvm\">\n  <uuid>c1be4539-43ba-4c88-b725-cdaf0fbccf8e</uuid>\n  <name>instance-00000015</name>\n  <memory>4194304</memory>\n  <vcpu>2</vcpu>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"14.0.0\"/>\n      <nova:name>test-cirros</nova:name>\n      <nova:creationTime>2016-07-20 06:09:32</nova:creationTime>\n      <nova:flavor name=\"m1.medium\">\n        <nova:memory>4096</nova:memory>\n        <nova:disk>40</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>2</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"0d6bdadb64b0465f91c29ed99bcfdc1b\">admin</nova:user>\n        <nova:project uuid=\"515d0c47f9834dd2be2295e5a6232548\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"96c15ae2-7a6c-429f-8c73-0a06b76110ee\"/>\n    </nova:instance>\n  </metadata>\n  <os>\n    <type machine=\"virt\">hvm</type>\n    <kernel>/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/kernel</kernel>\n    <initrd>/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/ramdisk</initrd>\n    <cmdline>root=/dev/vda console=ttyAMA0</cmdline>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cputune>\n    <shares>2048</shares>\n  </cputune>\n  <clock offset=\"utc\">\n    <timer name=\"pit\" tickpolicy=\"delay\"/>\n    <timer name=\"rtc\" tickpolicy=\"catchup\"/>\n  </clock>\n  <cpu mode=\"host-passthrough\" match=\"exact\">\n    <topology sockets=\"2\" cores=\"1\" threads=\"1\"/>\n  </cpu>\n  <devices>\n    <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/disk\"/>\n      <target bus=\"virtio\" dev=\"vda\"/>\n    </disk>\n    <disk type=\"file\" device=\"cdrom\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source file=\"/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/disk.config\"/>\n      <target bus=\"scsi\" dev=\"sdz\"/>\n    </disk>\n    <interface type=\"bridge\">\n      <mac address=\"fa:16:3e:cb:13:a1\"/>\n      <model type=\"virtio\"/>\n      <source bridge=\"br100\"/>\n      <filterref filter=\"nova-instance-instance-00000015-fa163ecb13a1\"/>\n    </interface>\n    <serial type=\"file\">\n      <source path=\"/opt/stack/data/nova/instances/c1be4539-43ba-4c88-b725-cdaf0fbccf8e/console.log\"/>\n    </serial>\n    <serial type=\"pty\"/>\n    <memballoon model=\"virtio\">\n      <stats period=\"10\"/>\n    </memballoon>\n  </devices>\n</domain>", 
            "date_created": "2016-07-20 06:10:28.965219+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-zhao"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/344769", 
            "date_created": "2016-07-20 11:34:25.371766+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/344769\nReason: This patch has been sitting unchanged for more than 12 weeks. I am therefore going to abandon it to keep the review queue sane. Please feel free to restore the change if you're still working on it.", 
            "date_created": "2017-01-25 05:51:32.694458+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "\nThere are no currently open reviews on this bug, changing\nthe status back to the previous state and unassigning. If\nthere are active reviews related to this bug, please include\nlinks in comments.\n", 
            "date_created": "2017-06-23 12:50:44.943158+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "The previous patch seems to have died because no unit tests were provided. Please feel free to update the bug with a new patch. ", 
            "date_created": "2017-07-25 15:09:39.637009+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Thanks @Sean, I will do this ASAP", 
            "date_created": "2017-07-27 03:12:01.503215+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-zhao"
        }
    ]
}