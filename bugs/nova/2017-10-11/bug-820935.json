{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:09:43.702340+00:00", 
    "description": "Using Glance trunk (revision 179).\n\nGlance doesn't appear to be returning user created properties. Some properties get returned (os_type for example). However most other properties don't.\n\nFor image 18 I have the following data in the image_properties table:\n\n\nsqlite> select * from image_properties where image_id = 18;\n100|18|backup_type||2011-08-04 13:26:35.983018|2011-08-04 13:26:44.004689||1\n96|18|image_state|creating|2011-08-04 13:26:35.978061|2011-08-04 13:26:44.000496||1\n98|18|image_type|snapshot|2011-08-04 13:26:35.980809|2011-08-04 13:26:44.002573||1\n99|18|instance_id|28|2011-08-04 13:26:35.981914|2011-08-04 13:26:44.003690||1\n95|18|instance_uuid|656055c9-d821-474e-a516-55d46cd3836f|2011-08-04 13:26:35.976770|2011-08-04 13:26:43.994884||1\n101|18|os_type|linux|2011-08-04 13:26:43.993645|||0\n97|18|user_id|admin|2011-08-04 13:26:35.979677|2011-08-04 13:26:44.001566||1\n\n---\n\nBut I get back the following HTTP headers when using the API:\n\n\n  HTTP/1.1 200 OK\n  Content-Length: 263864320\n  Content-Type: application/octet-stream\n  X-Image-Meta-Id: 18\n  X-Image-Meta-Deleted: False\n  X-Image-Meta-Container_format: ovf\n  X-Image-Meta-Location: file:///var/lib/glance/images/18\n  X-Image-Meta-Deleted_at:\n  X-Image-Meta-Created_at: 2011-08-04T13:26:35.972744\n  X-Image-Meta-Size: 263864320\n  X-Image-Meta-Status: active\n  X-Image-Meta-Property-Os_type: linux\n  X-Image-Meta-Is_public: True\n  X-Image-Meta-Owner:\n  X-Image-Meta-Updated_at: 2011-08-04T13:27:58.379366\n  X-Image-Meta-Checksum: 5912e9768978c3725ad401ea637aa065\n  X-Image-Meta-Disk_format: vhd\n  X-Image-Meta-Name: Just In Case\n  Location: http://localhost:9292/v1/images/18\n  Etag: 5912e9768978c3725ad401ea637aa065\n  Date: Thu, 04 Aug 2011 13:39:11 GMT\n  Connection: keep-alive\n\n---\n\nA request directly to the registry on  port 9191 returns similar results:\n\n\n{\"image\": {\"status\": \"active\", \"name\": \"Just In Case\", \"deleted\": false, \"container_format\": \"ovf\", \"created_at\": \"2011-08-04T13:26:35.972744\", \"disk_format\": \"vhd\", \"updated_at\": \"2011-08-04T13:27:58.379366\", \"properties\": {\"os_type\": \"linux\"}, \"location\": \"file:///var/lib/glance/images/18\", \"checksum\": \"5912e9768978c3725ad401ea637aa065\", \"owner\": null, \"is_public\": true, \"deleted_at\": null, \"id\": 18, \"size\": 263864320}}", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/820935", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 820935, 
    "index": 441, 
    "created": "2011-08-04 13:51:12.739306+00:00", 
    "title": "Xenapi glance plugin resets custom image properties", 
    "comments": [
        {
            "content": "Using Glance trunk (revision 179).\n\nGlance doesn't appear to be returning user created properties. Some properties get returned (os_type for example). However most other properties don't.\n\nFor image 18 I have the following data in the image_properties table:\n\n\nsqlite> select * from image_properties where image_id = 18;\n100|18|backup_type||2011-08-04 13:26:35.983018|2011-08-04 13:26:44.004689||1\n96|18|image_state|creating|2011-08-04 13:26:35.978061|2011-08-04 13:26:44.000496||1\n98|18|image_type|snapshot|2011-08-04 13:26:35.980809|2011-08-04 13:26:44.002573||1\n99|18|instance_id|28|2011-08-04 13:26:35.981914|2011-08-04 13:26:44.003690||1\n95|18|instance_uuid|656055c9-d821-474e-a516-55d46cd3836f|2011-08-04 13:26:35.976770|2011-08-04 13:26:43.994884||1\n101|18|os_type|linux|2011-08-04 13:26:43.993645|||0\n97|18|user_id|admin|2011-08-04 13:26:35.979677|2011-08-04 13:26:44.001566||1\n\n---\n\nBut I get back the following HTTP headers when using the API:\n\n\n  HTTP/1.1 200 OK\n  Content-Length: 263864320\n  Content-Type: application/octet-stream\n  X-Image-Meta-Id: 18\n  X-Image-Meta-Deleted: False\n  X-Image-Meta-Container_format: ovf\n  X-Image-Meta-Location: file:///var/lib/glance/images/18\n  X-Image-Meta-Deleted_at:\n  X-Image-Meta-Created_at: 2011-08-04T13:26:35.972744\n  X-Image-Meta-Size: 263864320\n  X-Image-Meta-Status: active\n  X-Image-Meta-Property-Os_type: linux\n  X-Image-Meta-Is_public: True\n  X-Image-Meta-Owner:\n  X-Image-Meta-Updated_at: 2011-08-04T13:27:58.379366\n  X-Image-Meta-Checksum: 5912e9768978c3725ad401ea637aa065\n  X-Image-Meta-Disk_format: vhd\n  X-Image-Meta-Name: Just In Case\n  Location: http://localhost:9292/v1/images/18\n  Etag: 5912e9768978c3725ad401ea637aa065\n  Date: Thu, 04 Aug 2011 13:39:11 GMT\n  Connection: keep-alive\n\n---\n\nA request directly to the registry on  port 9191 returns similar results:\n\n\n{\"image\": {\"status\": \"active\", \"name\": \"Just In Case\", \"deleted\": false, \"container_format\": \"ovf\", \"created_at\": \"2011-08-04T13:26:35.972744\", \"disk_format\": \"vhd\", \"updated_at\": \"2011-08-04T13:27:58.379366\", \"properties\": {\"os_type\": \"linux\"}, \"location\": \"file:///var/lib/glance/images/18\", \"checksum\": \"5912e9768978c3725ad401ea637aa065\", \"owner\": null, \"is_public\": true, \"deleted_at\": null, \"id\": 18, \"size\": 263864320}}", 
            "date_created": "2011-08-04 13:51:12.739306+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "The issue here appears to be related to the fact that the user created properties are marked as deleted.\n\nThis is happening on images created on snapshots via nova... Looking into whether the cause is on that end.", 
            "date_created": "2011-08-04 14:00:13.293021+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "Yeah. This is a nova issue. When creating snapshots nova:\n\n1) initially creates the image with all its metadata.\n\n2) When using XenServer the glance plugin does an image update to add some properties for the image type ('ovf', etc). All of the properties in the initial set that aren't in this request are marked as deleted.\n\nWe need to update the XenServer plugin to re-send these initial properties (if possible).", 
            "date_created": "2011-08-04 14:09:25.574174+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }
    ]
}