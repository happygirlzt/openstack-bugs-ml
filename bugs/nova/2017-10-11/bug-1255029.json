{
    "status": "Opinion", 
    "last_updated": "2014-09-17 13:48:00.165828+00:00", 
    "description": "I can not start the nova-network when set the dmz_cidr is empty in nova.conf:\n\n2013-11-26 04:50:49.916 23022 ERROR nova.openstack.common.threadgroup [-] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\nExit code: 2\nStdout: ''\nStderr: \"iptables-restore v1.4.7: host/network `None' not found\\nError occurred at line: 64\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     x.wait()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 168, in wait\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 187, in switch\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 194, in main\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\", line 448, in run_service\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     service.start()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 154, in start\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1713, in init_host\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     self.l3driver.initialize(fixed_range=False, networks=networks)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/l3.py\", line 90, in initialize\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     self.initialize_network(network['cidr'])\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/l3.py\", line 101, in initialize_network\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     linux_net.init_host(cidr)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 700, in init_host\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     iptables_manager.apply()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 421, in apply\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     self._apply()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 248, in inner\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 452, in _apply\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     attempts=5)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 1194, in _execute\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return utils.execute(*cmd, **kwargs)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 174, in execute\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return processutils.execute(*cmd, **kwargs)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/processutils.py\", line 178, in execute\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     cmd=' '.join(cmd))\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup ProcessExecutionError: Unexpected error while running command.\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Exit code: 2\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Stdout: ''\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Stderr: \"iptables-restore v1.4.7: host/network `None' not found\\nError occurred at line: 64\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"", 
    "tags": [], 
    "importance": "Wishlist", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1255029", 
    "owner": "https://api.launchpad.net/1.0/~genggjh", 
    "id": 1255029, 
    "index": 1450, 
    "created": "2013-11-26 09:59:24.697193+00:00", 
    "title": "Fail to start nova-network when set dmz_cidr is empty", 
    "comments": [
        {
            "content": "I can not start the nova-network when set the dmx_cidr is empty in nova.conf:\n\n2013-11-26 04:50:49.916 23022 ERROR nova.openstack.common.threadgroup [-] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\nExit code: 2\nStdout: ''\nStderr: \"iptables-restore v1.4.7: host/network `None' not found\\nError occurred at line: 64\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     x.wait()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 168, in wait\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 187, in switch\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 194, in main\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\", line 448, in run_service\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     service.start()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 154, in start\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1713, in init_host\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     self.l3driver.initialize(fixed_range=False, networks=networks)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/l3.py\", line 90, in initialize\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     self.initialize_network(network['cidr'])\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/l3.py\", line 101, in initialize_network\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     linux_net.init_host(cidr)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 700, in init_host\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     iptables_manager.apply()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 421, in apply\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     self._apply()\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 248, in inner\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 452, in _apply\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     attempts=5)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 1194, in _execute\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return utils.execute(*cmd, **kwargs)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 174, in execute\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     return processutils.execute(*cmd, **kwargs)\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/processutils.py\", line 178, in execute\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup     cmd=' '.join(cmd))\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup ProcessExecutionError: Unexpected error while running command.\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Exit code: 2\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Stdout: ''\n2013-11-26 04:50:49.916 23022 TRACE nova.openstack.common.threadgroup Stderr: \"iptables-restore v1.4.7: host/network `None' not found\\nError occurred at line: 64\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"", 
            "date_created": "2013-11-26 09:59:24.697193+00:00", 
            "author": "https://api.launchpad.net/1.0/~genggjh"
        }, 
        {
            "content": "The attribute like this in nova.conf:\n\nmulti_host=true\nnetwork_manager=nova.network.manager.VlanManager\npublic_interface=eth0.1000\nfixed_range=192.168.100.0/24\ndmz_cidr=[]\n\n", 
            "date_created": "2013-11-26 10:02:06.279238+00:00", 
            "author": "https://api.launchpad.net/1.0/~genggjh"
        }, 
        {
            "content": "I think the root cause is the python load the dmz_cidr=[] is a list like: '['[]']' instead of an empty list:\n\n2013-11-26 04:50:45.703 23022 DEBUG nova.network.linux_net [req-7079d0e8-7dea-44a9-8c7a-26057de8077c None None] dmz_cidr-test-['[]'] init_host /usr/lib/python2.6/site-packages/nova/network/linux_net.py:688\n\n\nI tried the settings like this : 'dmz_cidr= ' in nova.conf, it still does not work:\n2013-11-26 05:05:01.777 23401 DEBUG nova.network.linux_net [req-b5a7bd98-a76b-4b15-bf6e-cfa29d548c08 None None] dmz_cidr-test-[''] init_host /usr/lib/python2.6/site-packages/nova/network/linux_net.py:688", 
            "date_created": "2013-11-26 10:07:00.984279+00:00", 
            "author": "https://api.launchpad.net/1.0/~genggjh"
        }, 
        {
            "content": "So, i think we need enhance the error check when load dmz cidr at least.", 
            "date_created": "2013-11-26 10:07:41.130590+00:00", 
            "author": "https://api.launchpad.net/1.0/~genggjh"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/58491", 
            "date_created": "2013-11-26 10:35:43.562866+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "The patch was abandoned, is this bug still valid?", 
            "date_created": "2014-07-10 17:37:15.371930+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }
    ]
}