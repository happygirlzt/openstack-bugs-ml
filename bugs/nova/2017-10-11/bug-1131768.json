{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:16:54.113546+00:00", 
    "description": "Using OpenStack Nova w/ libvirt on Fedora 18:\n\nWhen I boot an instance and inject files (with libguestfs) I get the following stack trace in Nova's compute.log file:\n\n2013-02-20 21:14:55.706 ERROR nova.virt.libvirt.driver [req-0834ec7c-d875-469f-9277-00e4fbfd20e8 696e681d17df4f8eb3f20c26dec5f093 3efc0abe163f44b9a890f66242dfcf73] [instance: 2e8e19f1-137d-496b-b206-abc8919f5856] Error injecting data into image 93e67150-0f43-43d1-9ac6-6ff1777fdc69 (Error mounting /var/lib/nova/instances/2e8e19f1-137d-496b-b206-abc8919f5856/disk with libguestfs (could not connect to libvirt (URI = NULL): Failed to connect socket to '/home/nova/.cache/libvirt/libvirt-sock': No such file or directory [code=38 domain=7]))\n2013-02-20 21:14:55.711 ERROR nova.compute.manager [req-0834ec7c-d875-469f-9277-00e4fbfd20e8 696e681d17df4f8eb3f20c26dec5f093 3efc0abe163f44b9a890f66242dfcf73] [instance: 2e8e19f1-137d-496b-b206-abc8919f5856] Instance failed to spawn\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856] Traceback (most recent call last):\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1028, in _spawn\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     block_device_info)\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1438, in spawn\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     admin_pass=admin_password)\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1815, in _create_image\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     mandatory=('files',))\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/virt/disk/api.py\", line 304, in inject_data\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     fs.setup()\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/virt/disk/vfs/guestfs.py\", line 108, in setup\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     {'imgfile': self.imgfile, 'e': e})\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856] NovaException: Error mounting /var/lib/nova/instances/2e8e19f1-137d-496b-b206-abc8919f5856/disk with libguestfs (could not connect to libvirt (URI = NULL): Failed to connect socket to '/home/nova/.cache/libvirt/libvirt-sock': No such file or directory [code=38 domain=7])\n\n-----\n\nThis issue seems to be that because libguestfs doesn't use the same libvirt URI as Nova and thus fails.\n\nFull thread on the issue here:\n\nhttps://bugzilla.redhat.com/show_bug.cgi?id=913345", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1131768", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 1131768, 
    "index": 977, 
    "created": "2013-02-22 14:50:18.759458+00:00", 
    "title": "libguestfs: update to use Nova's libvirt URI", 
    "comments": [
        {
            "content": "Using OpenStack Nova w/ libvirt on Fedora 18:\n\nWhen I boot an instance and inject files (with libguestfs) I get the following stack trace in Nova's compute.log file:\n\n2013-02-20 21:14:55.706 ERROR nova.virt.libvirt.driver [req-0834ec7c-d875-469f-9277-00e4fbfd20e8 696e681d17df4f8eb3f20c26dec5f093 3efc0abe163f44b9a890f66242dfcf73] [instance: 2e8e19f1-137d-496b-b206-abc8919f5856] Error injecting data into image 93e67150-0f43-43d1-9ac6-6ff1777fdc69 (Error mounting /var/lib/nova/instances/2e8e19f1-137d-496b-b206-abc8919f5856/disk with libguestfs (could not connect to libvirt (URI = NULL): Failed to connect socket to '/home/nova/.cache/libvirt/libvirt-sock': No such file or directory [code=38 domain=7]))\n2013-02-20 21:14:55.711 ERROR nova.compute.manager [req-0834ec7c-d875-469f-9277-00e4fbfd20e8 696e681d17df4f8eb3f20c26dec5f093 3efc0abe163f44b9a890f66242dfcf73] [instance: 2e8e19f1-137d-496b-b206-abc8919f5856] Instance failed to spawn\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856] Traceback (most recent call last):\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1028, in _spawn\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     block_device_info)\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1438, in spawn\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     admin_pass=admin_password)\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1815, in _create_image\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     mandatory=('files',))\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/virt/disk/api.py\", line 304, in inject_data\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     fs.setup()\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]   File \"/usr/lib/python2.7/site-packages/nova/virt/disk/vfs/guestfs.py\", line 108, in setup\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856]     {'imgfile': self.imgfile, 'e': e})\n2013-02-20 21:14:55.711 18959 TRACE nova.compute.manager [instance: 2e8e19f1-137d-496b-b206-abc8919f5856] NovaException: Error mounting /var/lib/nova/instances/2e8e19f1-137d-496b-b206-abc8919f5856/disk with libguestfs (could not connect to libvirt (URI = NULL): Failed to connect socket to '/home/nova/.cache/libvirt/libvirt-sock': No such file or directory [code=38 domain=7])\n\n-----\n\nThis issue seems to be that because libguestfs doesn't use the same libvirt URI as Nova and thus fails.\n\nFull thread on the issue here:\n\nhttps://bugzilla.redhat.com/show_bug.cgi?id=913345", 
            "date_created": "2013-02-22 14:50:18.759458+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "https://review.openstack.org/#/c/22597/", 
            "date_created": "2013-02-22 15:09:42.832542+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/22596\nCommitted: http://github.com/openstack/nova/commit/4f0c2ddcf69d838b4954749091ae0056aa46ef07\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4f0c2ddcf69d838b4954749091ae0056aa46ef07\nAuthor: Dan Prince <email address hidden>\nDate:   Thu Feb 21 15:25:39 2013 -0500\n\n    Make LibvirtDriver.uri() a staticmethod.\n    \n    LibvirtDriver's uri() function seems to be the most logical place\n    where one can access the libvirt URL used by Nova. I would like\n    access to this outside the scope of the internal libvirt\n    driver (for libguestfs) so exposing it as a static\n    resource seems to make sense.\n    \n    Partial fix for LP Bug #1131768.\n    \n    Change-Id: I653296414716b4e799d68f6bfc868e6039d6ea4a\n", 
            "date_created": "2013-02-23 03:34:48.652807+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/22597\nCommitted: http://github.com/openstack/nova/commit/014499acf5d6d6a557c9415aa49c536817a02a0a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 014499acf5d6d6a557c9415aa49c536817a02a0a\nAuthor: Dan Prince <email address hidden>\nDate:   Thu Feb 21 15:28:38 2013 -0500\n\n    Make guestfs use same libvirt URI as Nova.\n    \n    Updates our libguestfs vfs implementation so that it makes use of\n    the same libvirt connection URI as Nova does when using\n    attach mode 'libvirt'. Previously when libguestfs used attach\n    mode 'libvirt' (the default on some newer distros like Fedora 18)\n    you could get permissions issues and ultimately get a libvirt\n    connection error from libguestfs:\n    \n      could not connect to libvirt (URI = NULL)\n    \n    Docs on guestfs attach method can be found here:\n    \n      http://libguestfs.org/guestfs.3.html#attach-method\n    \n    Having libguestfs use the same connection URL as Nova makes sense\n    and gets past these permission issues. (avoiding things like forcing\n    you to create a $HOME dir for the nova user among other things)\n    \n    Full thread on this is here:\n    \n      https://bugzilla.redhat.com/show_bug.cgi?id=913345\n    \n    Note that on most distros the default libguestfs attach method\n    is still 'appliance' so this would have no affect unless explicitly\n    enabled via LIBGUESTFS_ATTACH_METHOD.\n    \n    Fixes LP Bug #1131768.\n    \n    Change-Id: I7e9f010022731a43e8d793cf8415ec12b346fdb4\n", 
            "date_created": "2013-02-23 03:35:03.280563+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}