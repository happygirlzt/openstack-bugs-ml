{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:23:53.534471+00:00", 
    "description": "Using nova bzr 1269 with Xenserver. I'm creating instances using a Squeeze image with nova-agent 0.0.1.28 installed.\n\nWhen I create a new instance and try to inject a file I get the following error in /var/log/nova/nova-agent.log:\n\n---\n2011-07-14 13:24:22,552 [INFO] Received command 'file_inject' with argument: '{'b64_file': 'c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFERWdWTlgrWFBQVFFuTTgvaG5CM1ptajJad3I4QmU4TXpXL0libWxXaERWN3IzU0pMLzRVNVlueWdFb2lLQ2IzTGJHRmdOMkgxdTNRcS9VWjAvZ1AwK0p1Mk5nTVpkdWRqVWo3d3VsNU1QUXFNV1IvV0xlbkJWY2NYREFMcWxUYjFacGxPRDI2QWNwNUR0SlNmdk1EaVdscTVZM2RxbVd4OE91aDRoZTZjN3BTbGtKamZFOFQzRVJaNFZIRzRJRkk0bEtyVVVDVGVBQlE0ZDdvMjlkYUFUMStGR2ZFVDl1Y3ZNRzdhYmUrUTlrMWc5NTJZZ1lWWVhXekt6NkpvUTFOdjIxRW15RG40NmNDNWpQcWVwYlVpUkFidTF6T0huYlNBeXpYTVlWNzU5aEw2SiszSVZ5a3J5anVnbTUxZXRCMUpjeXp2cTVramVZYndqbU5uTE0wVGIgcm9vdEBub3ZhMQo=', 'b64_path': 'L3Jvb3QvLnNzaC9hdXRob3JpemVkX2tleXM='}'\n2011-07-14 13:24:22,553 [WARNING] No such agent command 'file_inject'\n---\n\nIn nova-compute.log I see the following:\n\n2011-07-14 13:24:17,063 DEBUG nova.virt.xenapi.vmops [-] Injecting file path: '/root/.ssh/authorized_keys' from (pid=6569) _inject_files /usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py:320\n2011-07-14 13:24:20,243 INFO nova.virt.xenapi [-] Task [Async.host.call_plugin] OpaqueRef:fc1a875e-f609-97a4-42fb-e664df556d37 status: success    <value>&quot;{\\&quot;message\\&quot;: \\&quot;No such agent command 'file_inject'\\&quot;, \\&quot;returncode\\&quot;: \\&quot;404\\&quot;}&quot;</value>\n2011-07-14 13:24:20,250 WARNING nova.virt.xenapi.vmops [-] string indices must be integers\n2011-07-14 13:24:20,251 ERROR nova.virt.xenapi.vmops [-] Instance instance-00000017: failed to boot\n(nova.virt.xenapi.vmops): TRACE: Traceback (most recent call last):\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 341, in _wait_for_boot\n(nova.virt.xenapi.vmops): TRACE:     _inject_files()\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 321, in _inject_files\n(nova.virt.xenapi.vmops): TRACE:     self.inject_file(instance, path, contents)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 706, in inject_file\n(nova.virt.xenapi.vmops): TRACE:     if resp_dict['returncode'] != '0':\n(nova.virt.xenapi.vmops): TRACE: TypeError: string indices must be integers\n(nova.virt.xenapi.vmops): TRACE:\n\n---\n\nI looks like the Xenserver agent plugin isn't detecting the correct file injection method for instances.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/810657", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 810657, 
    "index": 2461, 
    "created": "2011-07-14 18:18:41.857064+00:00", 
    "title": "agent plugin fails to detect correct file injection capability", 
    "comments": [
        {
            "content": "Using nova bzr 1269 with Xenserver. I'm creating instances using a Squeeze image with nova-agent 0.0.1.28 installed.\n\nWhen I create a new instance and try to inject a file I get the following error in /var/log/nova/nova-agent.log:\n\n---\n2011-07-14 13:24:22,552 [INFO] Received command 'file_inject' with argument: '{'b64_file': 'c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFERWdWTlgrWFBQVFFuTTgvaG5CM1ptajJad3I4QmU4TXpXL0libWxXaERWN3IzU0pMLzRVNVlueWdFb2lLQ2IzTGJHRmdOMkgxdTNRcS9VWjAvZ1AwK0p1Mk5nTVpkdWRqVWo3d3VsNU1QUXFNV1IvV0xlbkJWY2NYREFMcWxUYjFacGxPRDI2QWNwNUR0SlNmdk1EaVdscTVZM2RxbVd4OE91aDRoZTZjN3BTbGtKamZFOFQzRVJaNFZIRzRJRkk0bEtyVVVDVGVBQlE0ZDdvMjlkYUFUMStGR2ZFVDl1Y3ZNRzdhYmUrUTlrMWc5NTJZZ1lWWVhXekt6NkpvUTFOdjIxRW15RG40NmNDNWpQcWVwYlVpUkFidTF6T0huYlNBeXpYTVlWNzU5aEw2SiszSVZ5a3J5anVnbTUxZXRCMUpjeXp2cTVramVZYndqbU5uTE0wVGIgcm9vdEBub3ZhMQo=', 'b64_path': 'L3Jvb3QvLnNzaC9hdXRob3JpemVkX2tleXM='}'\n2011-07-14 13:24:22,553 [WARNING] No such agent command 'file_inject'\n---\n\nIn nova-compute.log I see the following:\n\n2011-07-14 13:24:17,063 DEBUG nova.virt.xenapi.vmops [-] Injecting file path: '/root/.ssh/authorized_keys' from (pid=6569) _inject_files /usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py:320\n2011-07-14 13:24:20,243 INFO nova.virt.xenapi [-] Task [Async.host.call_plugin] OpaqueRef:fc1a875e-f609-97a4-42fb-e664df556d37 status: success    <value>&quot;{\\&quot;message\\&quot;: \\&quot;No such agent command 'file_inject'\\&quot;, \\&quot;returncode\\&quot;: \\&quot;404\\&quot;}&quot;</value>\n2011-07-14 13:24:20,250 WARNING nova.virt.xenapi.vmops [-] string indices must be integers\n2011-07-14 13:24:20,251 ERROR nova.virt.xenapi.vmops [-] Instance instance-00000017: failed to boot\n(nova.virt.xenapi.vmops): TRACE: Traceback (most recent call last):\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 341, in _wait_for_boot\n(nova.virt.xenapi.vmops): TRACE:     _inject_files()\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 321, in _inject_files\n(nova.virt.xenapi.vmops): TRACE:     self.inject_file(instance, path, contents)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 706, in inject_file\n(nova.virt.xenapi.vmops): TRACE:     if resp_dict['returncode'] != '0':\n(nova.virt.xenapi.vmops): TRACE: TypeError: string indices must be integers\n(nova.virt.xenapi.vmops): TRACE:\n\n---\n\nI looks like the Xenserver agent plugin isn't detecting the correct file injection method for instances.", 
            "date_created": "2011-07-14 18:18:41.857064+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }
    ]
}