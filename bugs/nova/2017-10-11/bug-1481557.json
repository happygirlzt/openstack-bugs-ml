{
    "status": "Expired", 
    "last_updated": "2015-10-05 04:17:36.481710+00:00", 
    "description": "Prior to Kilo, not having a:\n[cinder]\nos_region_name=SET\n\nset meant that nova would look in the region the nova call went to. As of Kilo, it appears to do an endpoint list and pull the first cinder endpoint it finds (even if it is in a different region.)\n\nI've not yet reproduced this in devstack but a multi-region devstack should see the right behavior prior to kilo and the wrong behavior in kilo (and presumably in Liberty.)\n\nThis has a VERY STRONG OPERATIONS IMPACT due to the difficulty in debugging a cross region error like this (it's extraordinarily opaque).\n\nThe simplest reproducer is to have a multi region openstack (for both nova and cinder) and create instances and volumes in both regions. In each region, try and attach a volume to a running instance. One side (whichever is uuid-numerically-lower) will likely succeed and the one that is numerically higher will fail (as it will try and find the volume in the wrong region.\n\nThe workaround is straight-forward--set \n[cinder]\nos_region_name=REGION\nin the nova.conf file but as this is a behavior change, it should have been called out in the release notes.\n\nRunning:\nopenstack kilo 2015.1.0 (nova and cinder) in a multi (well two) region env.\n\ndistro info:\n\n[STAGING] medberry@chrcnc02-control-003:~$ dpkg -l \\*nova\\* \\*cinder\\* \\*keystone\\* \\*neutron\\* |cat |grep ii\nii  cinder-api                           1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - API server\nii  cinder-backup                        1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - Scheduler server\nii  cinder-common                        1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - common files\nii  cinder-scheduler                     1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - Scheduler server\nii  cinder-volume                        1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - Volume server\nii  neutron-common                       1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - common\nii  neutron-dhcp-agent                   1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - DHCP agent\nii  neutron-l3-agent                     1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - l3 agent\nii  neutron-metadata-agent               1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - metadata agent\nii  neutron-plugin-ml2                   1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - ML2 plugin\nii  neutron-plugin-openvswitch-agent     1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - Open vSwitch plugin agent\nii  neutron-server                       1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - server\nii  nova-api                             1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - API frontend\nii  nova-cert                            1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - certificate management\nii  nova-common                          1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - common files\nii  nova-conductor                       1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - conductor service\nii  nova-consoleauth                     1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - Console Authenticator\nii  nova-novncproxy                      1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - NoVNC proxy\nii  nova-objectstore                     1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - object store\nii  nova-scheduler                       1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - virtual machine scheduler\nii  python-cinder                        1:2015.1.0-0ubuntu1~cloud0            all          Cinder Python libraries\nii  python-cinderclient                  1:1.1.1-0ubuntu1~cloud0               all          python bindings to the OpenStack Volume API\nii  python-keystone                      1:2015.1.0-0ubuntu1~cloud0            all          OpenStack identity service - Python library\nii  python-keystoneclient                1:1.2.0-0ubuntu1~cloud0               all          Client library for OpenStack Identity API\nii  python-keystonemiddleware            1.5.0-0ubuntu1~cloud0                 all          Middleware for OpenStack Identity (Keystone) - Python 2.x\nii  python-neutron                       1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - Python library\nii  python-neutron-fwaas                 2015.1.0-0ubuntu1~cloud0              all          Firewall-as-a-Service driver for OpenStack Neutron\nii  python-neutron-lbaas                 1:2015.1.0-0ubuntu1~cloud0            all          Loadbalancer-as-a-Service driver for OpenStack Neutron\nii  python-neutronclient                 1:2.3.11-0ubuntu1~cloud0              all          client - Neutron is a virtual network service for Openstack\nii  python-nova                          1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute Python libraries\nii  python-novaclient                    1:2.22.0-0ubuntu1~cloud0              all          client library for OpenStack Compute API\n[STAGING] medberry@chrcnc02-control-003:~$", 
    "tags": [
        "ops"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1481557", 
    "owner": "None", 
    "id": 1481557, 
    "index": 5683, 
    "created": "2015-08-05 02:53:26.755722+00:00", 
    "title": "kilo default cinder behavior changed", 
    "comments": [
        {
            "content": "Prior to Kilo, not having a:\n[cinder]\nos_region_name=SET\n\nset meant that nova would look in the region the nova call went to. As of Kilo, it appears to do an endpoint list and pull the first cinder endpoint it finds (even if it is in a different region.)\n\nI've not yet reproduced this in devstack but a multi-region devstack should see the right behavior prior to kilo and the wrong behavior in kilo (and presumably in Liberty.)\n\nThis has a VERY STRONG OPERATIONS IMPACT due to the difficulty in debugging a cross region error like this (it's extraordinarily opaque).\n\nThe simplest reproducer is to have a multi region openstack (for both nova and cinder) and create instances and volumes in both regions. In each region, try and attach a volume to a running instance. One side (whichever is uuid-numerically-lower) will likely succeed and the one that is numerically higher will fail (as it will try and find the volume in the wrong region.\n\nThe workaround is straight-forward--set \n[cinder]\nos_region_name=REGION\nin the nova.conf file but as this is a behavior change, it should have been called out in the release notes.\n\nRunning:\nopenstack kilo 2015.1.0 (nova and cinder) in a multi (well two) region env.\n\ndistro info:\n\n[STAGING] medberry@chrcnc02-control-003:~$ dpkg -l \\*nova\\* \\*cinder\\* \\*keystone\\* \\*neutron\\* |cat |grep ii\nii  cinder-api                           1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - API server\nii  cinder-backup                        1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - Scheduler server\nii  cinder-common                        1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - common files\nii  cinder-scheduler                     1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - Scheduler server\nii  cinder-volume                        1:2015.1.0-0ubuntu1~cloud0            all          Cinder storage service - Volume server\nii  neutron-common                       1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - common\nii  neutron-dhcp-agent                   1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - DHCP agent\nii  neutron-l3-agent                     1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - l3 agent\nii  neutron-metadata-agent               1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - metadata agent\nii  neutron-plugin-ml2                   1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - ML2 plugin\nii  neutron-plugin-openvswitch-agent     1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - Open vSwitch plugin agent\nii  neutron-server                       1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - server\nii  nova-api                             1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - API frontend\nii  nova-cert                            1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - certificate management\nii  nova-common                          1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - common files\nii  nova-conductor                       1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - conductor service\nii  nova-consoleauth                     1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - Console Authenticator\nii  nova-novncproxy                      1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - NoVNC proxy\nii  nova-objectstore                     1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - object store\nii  nova-scheduler                       1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - virtual machine scheduler\nii  python-cinder                        1:2015.1.0-0ubuntu1~cloud0            all          Cinder Python libraries\nii  python-cinderclient                  1:1.1.1-0ubuntu1~cloud0               all          python bindings to the OpenStack Volume API\nii  python-keystone                      1:2015.1.0-0ubuntu1~cloud0            all          OpenStack identity service - Python library\nii  python-keystoneclient                1:1.2.0-0ubuntu1~cloud0               all          Client library for OpenStack Identity API\nii  python-keystonemiddleware            1.5.0-0ubuntu1~cloud0                 all          Middleware for OpenStack Identity (Keystone) - Python 2.x\nii  python-neutron                       1:2015.1.0-0ubuntu1~cloud0            all          Neutron is a virtual network service for Openstack - Python library\nii  python-neutron-fwaas                 2015.1.0-0ubuntu1~cloud0              all          Firewall-as-a-Service driver for OpenStack Neutron\nii  python-neutron-lbaas                 1:2015.1.0-0ubuntu1~cloud0            all          Loadbalancer-as-a-Service driver for OpenStack Neutron\nii  python-neutronclient                 1:2.3.11-0ubuntu1~cloud0              all          client - Neutron is a virtual network service for Openstack\nii  python-nova                          1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute Python libraries\nii  python-novaclient                    1:2.22.0-0ubuntu1~cloud0              all          client library for OpenStack Compute API\n[STAGING] medberry@chrcnc02-control-003:~$", 
            "date_created": "2015-08-05 02:53:26.755722+00:00", 
            "author": "https://api.launchpad.net/1.0/~med"
        }, 
        {
            "content": "Can you please share the service catalog fields for both cinder and both nova entries?", 
            "date_created": "2015-08-05 12:37:17.187763+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "DIMS\n\ndnvrco01-control-001.tgz is \"NCW\"\n\nand\n\nchrcnc01-control-001.tgz is region \"NCE\"\n\ncinder.conf and nova.conf for each (with slight cleanup)", 
            "date_created": "2015-08-05 16:31:49.173989+00:00", 
            "author": "https://api.launchpad.net/1.0/~med"
        }, 
        {
            "content": "DIMS\n\ndnvrco01-control-001.tgz is \"NCW\"\n\nand\n\nchrcnc01-control-001.tgz is region \"NCE\"\n\ncinder.conf and nova.conf for each (with slight cleanup)", 
            "date_created": "2015-08-05 16:32:21.552309+00:00", 
            "author": "https://api.launchpad.net/1.0/~med"
        }, 
        {
            "content": "DIMS,\n\nThis is our current Juno deployment. Using this for Kilo means that volumes can't be attached (as it seems to use a non-region specific keystone endpoint list to determine where the volume comes from.) In our case (2 regions), one will succeed in regression tests, and one will fail. The one that succeeds is random (based on endpoint id as near as I can tell). The one that fails has a higher endpoint id for cinder and fails as it selects the lower.\n\nThis works fine in Juno but fails in Kilo.\n\nPoke \"med_\" in #openstack-nova IRC if you need more info (or update the bug).", 
            "date_created": "2015-08-05 16:34:53.768343+00:00", 
            "author": "https://api.launchpad.net/1.0/~med"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2015-10-05 04:17:33.208796+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}