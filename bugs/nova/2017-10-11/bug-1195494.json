{
    "status": "Invalid", 
    "last_updated": "2014-09-04 18:48:14.891389+00:00", 
    "description": "Hi All,\n\nGrizzly - I was successfully able to implement one controller node and a compute node, BUT when I tried to add another compute node with the controller I got below error. Per document I followed till stopping of the required services and then \"nova-manage db sync\". Not sure if it is because of nova database is already present in Controller and I had done the db sync for my first controller-compute configuration. If we need to drop the old nova database then its not the solution as every time it would be required when you will be adding the additional compute node.\n\nPlease advise.\n\nNova.conf is exactly the copy of working compute node and with my_ip, vnc details changed.\n\nError on new compute node:\n\n2013-06-27 22:48:50 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.migration' from '/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.pyc'> from (pid=2029) __get_backend /usr/lib/python2.7/dist-packages/nova/utils.py:663\nCommand failed, please check log for more info\n2013-06-27 22:48:50 CRITICAL nova [-] <VerNum(184)>\n2013-06-27 22:48:50 TRACE nova Traceback (most recent call last):\n2013-06-27 22:48:50 TRACE nova   File \"/usr/bin/nova-manage\", line 1746, in <module>\n2013-06-27 22:48:50 TRACE nova     main()\n2013-06-27 22:48:50 TRACE nova   File \"/usr/bin/nova-manage\", line 1733, in main\n2013-06-27 22:48:50 TRACE nova     fn(*fn_args, **fn_kwargs)\n2013-06-27 22:48:50 TRACE nova   File \"/usr/bin/nova-manage\", line 1102, in sync\n2013-06-27 22:48:50 TRACE nova     return migration.db_sync(version)\n2013-06-27 22:48:50 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/migration.py\", line 30, in db_sync\n2013-06-27 22:48:50 TRACE nova     return IMPL.db_sync(version=version)\n2013-06-27 22:48:50 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.py\", line 53, in db_sync\n2013-06-27 22:48:50 TRACE nova     versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)", 
    "tags": [
        "db"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1195494", 
    "owner": "None", 
    "id": 1195494, 
    "index": 3802, 
    "created": "2013-06-27 22:52:50.195867+00:00", 
    "title": "Nova Compute Error in nova-manage db sync", 
    "comments": [
        {
            "content": "Hi All,\n\nGrizzly - I was successfully able to implement one controller node and a compute node, BUT when I tried to add another compute node with the controller I got below error. Per document I followed till stopping of the required services and then \"nova-manage db sync\". Not sure if it is because of nova database is already present in Controller and I had done the db sync for my first controller-compute configuration. If we need to drop the old nova database then its not the solution as every time it would be required when you will be adding the additional compute node.\n\nPlease advise.\n\nNova.conf is exactly the copy of working compute node and with my_ip, vnc details changed.\n\nError on new compute node:\n\n2013-06-27 22:48:50 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.migration' from '/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.pyc'> from (pid=2029) __get_backend /usr/lib/python2.7/dist-packages/nova/utils.py:663\nCommand failed, please check log for more info\n2013-06-27 22:48:50 CRITICAL nova [-] <VerNum(184)>\n2013-06-27 22:48:50 TRACE nova Traceback (most recent call last):\n2013-06-27 22:48:50 TRACE nova   File \"/usr/bin/nova-manage\", line 1746, in <module>\n2013-06-27 22:48:50 TRACE nova     main()\n2013-06-27 22:48:50 TRACE nova   File \"/usr/bin/nova-manage\", line 1733, in main\n2013-06-27 22:48:50 TRACE nova     fn(*fn_args, **fn_kwargs)\n2013-06-27 22:48:50 TRACE nova   File \"/usr/bin/nova-manage\", line 1102, in sync\n2013-06-27 22:48:50 TRACE nova     return migration.db_sync(version)\n2013-06-27 22:48:50 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/migration.py\", line 30, in db_sync\n2013-06-27 22:48:50 TRACE nova     return IMPL.db_sync(version=version)\n2013-06-27 22:48:50 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.py\", line 53, in db_sync\n2013-06-27 22:48:50 TRACE nova     versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)", 
            "date_created": "2013-06-27 22:52:50.195867+00:00", 
            "author": "https://api.launchpad.net/1.0/~amoghpatel4u"
        }, 
        {
            "content": "Also, nova-manage version is not the updated one.\n\nroot@sjcubuntu08:~# nova-manage version\n2012.1.4-dev (2012.1.4-LOCALBRANCH:LOCALREVISION)", 
            "date_created": "2013-06-27 23:00:09.865061+00:00", 
            "author": "https://api.launchpad.net/1.0/~amoghpatel4u"
        }, 
        {
            "content": "I think it is for nova.", 
            "date_created": "2013-06-27 23:56:18.636628+00:00", 
            "author": "https://api.launchpad.net/1.0/~gongysh"
        }, 
        {
            "content": "Could anyone please help on this error?", 
            "date_created": "2013-07-01 19:35:44.113050+00:00", 
            "author": "https://api.launchpad.net/1.0/~amoghpatel4u"
        }, 
        {
            "content": "The log you provided isn't really enough to show which migration failed or why.  Do you have any more details?  Can you do a \"select * from migrate_version\" in your nova DB and paste the results here?  Thanks.", 
            "date_created": "2013-07-03 17:20:54.817825+00:00", 
            "author": "https://api.launchpad.net/1.0/~dripton"
        }, 
        {
            "content": "Hi David, Thanks for replying.\n\nActually, there was a \"nova-manage version\" mismatch in Controller and Compute. I got it fixed by running \"apt-get dist-upgrade\" which upgraded the nova-compute and nova-network along with many python dependencies. Then I stopped the nova services in both the controller and compute and ran \"nova-manage db sync\" again. I received some message again but I was able to see my new compute node updated in \"nova service-list\" with UP and running and I was able to create VMs in that.\n\nBelow message comes when running db sync on either Controller or Compute:\n\nCommand failed, please check log for more info\n2013-07-03 17:40:10.442 13997 CRITICAL nova [-] <VerNum(184)>\n2013-07-03 17:40:10.442 13997 TRACE nova Traceback (most recent call last):\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/bin/nova-manage\", line 1263, in <module>\n2013-07-03 17:40:10.442 13997 TRACE nova     main()\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/bin/nova-manage\", line 1255, in main\n2013-07-03 17:40:10.442 13997 TRACE nova     fn(*fn_args, **fn_kwargs)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/bin/nova-manage\", line 798, in sync\n2013-07-03 17:40:10.442 13997 TRACE nova     return migration.db_sync(version)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/migration.py\", line 32,                                                                                                                            in db_sync\n2013-07-03 17:40:10.442 13997 TRACE nova     return IMPL.db_sync(version=version)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.py\"                                                                                                                           , line 78, in db_sync\n2013-07-03 17:40:10.442 13997 TRACE nova     return versioning_api.upgrade(get_engine(), repository, version)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line                                                                                                                            186, in upgrade\n2013-07-03 17:40:10.442 13997 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **op                                                                                                                           ts)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"<string>\", line 2, in _migrate\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.py\"                                                                                                                           , line 43, in patched_with_engine\n2013-07-03 17:40:10.442 13997 TRACE nova     return f(*a, **kw)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line                                                                                                                            345, in _migrate\n2013-07-03 17:40:10.442 13997 TRACE nova     changeset = schema.changeset(version)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/schema.py\", l                                                                                                                           ine 80, in changeset\n2013-07-03 17:40:10.442 13997 TRACE nova     changeset = self.repository.changeset(database, start_ver, version)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/repository.py                                                                                                                           \", line 225, in changeset\n2013-07-03 17:40:10.442 13997 TRACE nova     changes = [self.version(v).script(database, op) for v in versions]\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/repository.py                                                                                                                           \", line 189, in version\n2013-07-03 17:40:10.442 13997 TRACE nova     return self.versions.version(*p, **k)\n2013-07-03 17:40:10.442 13997 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/version.py\",                                                                                                                            line 140, in version\n2013-07-03 17:40:10.442 13997 TRACE nova     return self.versions[VerNum(vernum)]\n2013-07-03 17:40:10.442 13997 TRACE nova KeyError: <VerNum(184)>\n2013-07-03 17:40:10.442 13997 TRACE nova\n\n\nAlso below is the result of your asked query:\n\nmysql> select * from migrate_version;\n+--------------------+----------------------------------------------------------------------------------------------------------+------------+\n| repository_id | repository_path                                                                                                          | version |\n+--------------------+----------------------------------------------------------------------------------------------------------+------------+\n| nova                 | /usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migrate_repo    |     184    |\n+--------------------+----------------------------------------------------------------------------------------------------------+-----------+\n1 row in set (0.00 sec)\n\nmysql>", 
            "date_created": "2013-07-03 17:47:27.181733+00:00", 
            "author": "https://api.launchpad.net/1.0/~amoghpatel4u"
        }, 
        {
            "content": "I have seen this error when there are old .pyc files lying around during development. First off, why are you running an out of date nova-manage? You need to use the nova-manage which came with the latest version of the code.\n\nHow are you installing nova?", 
            "date_created": "2013-07-05 03:40:50.234668+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "Hi Mike,\n\nApologies for the delayed response.\n\nI had installed nova like below:\n1. apt-get update\n2. apt-get install nova-*\n3. apt-get dist-upgrade\n\nMy current nova version is - 2013.1.1\n\nThis db sync error doesn't come when we delete nova database from controller, recreate it with appropriate access wrights, stop the nova services on both and then rerun the \"nova-manage db sync\".\n\nI had to try this deleting option and ran db sync and it worked but I'm not sure if this is the correct way.", 
            "date_created": "2013-07-08 22:52:20.472919+00:00", 
            "author": "https://api.launchpad.net/1.0/~amoghpatel4u"
        }
    ]
}