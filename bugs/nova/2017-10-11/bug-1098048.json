{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:43:56.906548+00:00", 
    "description": "This is not about Nova API behaving badly. This is merely to point out that tracebacks are printed into nova-api.log when cinderclient raises an exception.\n\nFor example, here is a section of nova-api log corresponding to the (correct) behavior of a Tempest negative test case against Volumes:\n\n2013-01-10 03:02:04.843 ERROR nova.api.openstack [req-ac772de2-6048-4007-9ccc-ce6c52e1deca VolumesNegativeTestJSON-user VolumesNegativeTestJSON-tenant] Caught error: Invalid input received: Volume size '#$%' must be an integer and greater than 0 (HTTP 400) (Request-ID: req-b497ba96-3406-4c83-81ac-43809d82589c)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack Traceback (most recent call last):\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 81, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 329, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 895, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     content_type, body, accept)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 951, in _process_stack\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 1040, in dispatch\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/contrib/volumes.py\", line 252, in create\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     availability_zone=availability_zone\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 242, in create\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     item = cinderclient(context).volumes.create(size, **kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/v1/volumes.py\", line 155, in create\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return self._create('/volumes', body, 'volume')\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/base.py\", line 149, in _create\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     resp, body = self.api.client.post(url, body=body)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/client.py\", line 192, in post\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return self._cs_request(url, 'POST', **kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/client.py\", line 157, in _cs_request\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     **kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/client.py\", line 140, in request\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     raise exceptions.from_response(resp, body)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack BadRequest: Invalid input received: Volume size '#$%' must be an integer and greater than 0 (HTTP 400) (Request-ID: req-b497ba96-3406-4c83-81ac-43809d82589c)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack \n2013-01-10 03:02:04.917 INFO nova.api.openstack [req-ac772de2-6048-4007-9ccc-ce6c52e1deca VolumesNegativeTestJSON-user VolumesNegativeTestJSON-tenant] http://127.0.0.1:8774/v2/bb9e881613e0486492630ef01979237a/os-volumes returned with HTTP 400\n\nI believe the solution here is to just not log the traceback, instead, only logging the last couple lines above...", 
    "tags": [
        "low-hanging-fruit"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1098048", 
    "owner": "https://api.launchpad.net/1.0/~cyeoh-0", 
    "id": 1098048, 
    "index": 5654, 
    "created": "2013-01-10 05:03:33.127951+00:00", 
    "title": "Traceback from cinderclient in nova-api log for BadRequest errors", 
    "comments": [
        {
            "content": "This is not about Nova API behaving badly. This is merely to point out that tracebacks are printed into nova-api.log when cinderclient raises an exception.\n\nFor example, here is a section of nova-api log corresponding to the (correct) behavior of a Tempest negative test case against Volumes:\n\n2013-01-10 03:02:04.843 ERROR nova.api.openstack [req-ac772de2-6048-4007-9ccc-ce6c52e1deca VolumesNegativeTestJSON-user VolumesNegativeTestJSON-tenant] Caught error: Invalid input received: Volume size '#$%' must be an integer and greater than 0 (HTTP 400) (Request-ID: req-b497ba96-3406-4c83-81ac-43809d82589c)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack Traceback (most recent call last):\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 81, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 329, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 895, in __call__\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     content_type, body, accept)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 951, in _process_stack\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 1040, in dispatch\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/contrib/volumes.py\", line 252, in create\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     availability_zone=availability_zone\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 242, in create\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     item = cinderclient(context).volumes.create(size, **kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/v1/volumes.py\", line 155, in create\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return self._create('/volumes', body, 'volume')\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/base.py\", line 149, in _create\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     resp, body = self.api.client.post(url, body=body)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/client.py\", line 192, in post\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     return self._cs_request(url, 'POST', **kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/client.py\", line 157, in _cs_request\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     **kwargs)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack   File \"/opt/stack/new/python-cinderclient/cinderclient/client.py\", line 140, in request\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack     raise exceptions.from_response(resp, body)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack BadRequest: Invalid input received: Volume size '#$%' must be an integer and greater than 0 (HTTP 400) (Request-ID: req-b497ba96-3406-4c83-81ac-43809d82589c)\n2013-01-10 03:02:04.843 12151 TRACE nova.api.openstack \n2013-01-10 03:02:04.917 INFO nova.api.openstack [req-ac772de2-6048-4007-9ccc-ce6c52e1deca VolumesNegativeTestJSON-user VolumesNegativeTestJSON-tenant] http://127.0.0.1:8774/v2/bb9e881613e0486492630ef01979237a/os-volumes returned with HTTP 400\n\nI believe the solution here is to just not log the traceback, instead, only logging the last couple lines above...", 
            "date_created": "2013-01-10 05:03:33.127951+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Looks like some reworking of the logging in the error handler in nova/api/openstack/__init__.py.", 
            "date_created": "2013-01-14 21:36:34.817024+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/28506", 
            "date_created": "2013-05-08 06:10:44.052314+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/28506\nCommitted: http://github.com/openstack/nova/commit/46ce2e345bce18c2e2f645bb90aea11ca53ba825\nSubmitter: Jenkins\nBranch:    master\n\ncommit 46ce2e345bce18c2e2f645bb90aea11ca53ba825\nAuthor: Chris Yeoh <email address hidden>\nDate:   Wed May 8 15:36:28 2013 +0930\n\n    Catch volume create exception\n    \n    Catch InvalidInput exception from cinder when the parameters\n    are invalid such as an invalid size. Currently the exception\n    is not caught which results in a 400 Bad Request correctly being\n    returned, but also leaving a traceback in the logs. Correctly\n    catching the exception and explicitly raising an HTTPBadRequest\n    removes the production of the traceback\n    \n    Fixes bug #1098048\n    \n    Change-Id: Ia66e67f302cf20e96417f4ff3c1430b755a4a861\n", 
            "date_created": "2013-05-14 07:57:47.886184+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/29431", 
            "date_created": "2013-05-16 20:31:19.900341+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/29431\nCommitted: http://github.com/openstack/nova/commit/fdb33fb2bb27a17aa7c3c7d9cf97812ad7803569\nSubmitter: Jenkins\nBranch:    stable/grizzly\n\ncommit fdb33fb2bb27a17aa7c3c7d9cf97812ad7803569\nAuthor: Chris Yeoh <email address hidden>\nDate:   Wed May 8 15:36:28 2013 +0930\n\n    Catch volume create exception\n    \n    Catch InvalidInput exception from cinder when the parameters\n    are invalid such as an invalid size. Currently the exception\n    is not caught which results in a 400 Bad Request correctly being\n    returned, but also leaving a traceback in the logs. Correctly\n    catching the exception and explicitly raising an HTTPBadRequest\n    removes the production of the traceback\n    \n    Fixes bug #1098048\n    \n    Change-Id: Ia66e67f302cf20e96417f4ff3c1430b755a4a861\n    (cherry picked from commit 46ce2e345bce18c2e2f645bb90aea11ca53ba825)\n", 
            "date_created": "2013-05-31 04:59:28.734429+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}