{
    "status": "Opinion", 
    "last_updated": "2013-02-15 10:17:25.244681+00:00", 
    "description": "First, a caveat: This might be very well related to a misconfig behaving badly. Still, as no error is reported I'll treat this as a bug:\n\nSetup\n--------\n\n3-node setup -- Controller (\"Folsom 1\"), Compute (\"Folsom 2\") and Network (\"Folsom 3\")\nOS: Ubuntu 12.04\nCode:  OVS and Quamtum directly from trunk; all the rest  as per Ubuntu packages in 12.04.\n\nOpenStack  Services: \n(Folsom 1, Controller -- 10 ):   \nKeystone, Swift, Glance on Swift, Quantum server.  For Nova, the _only_ Nova services on the controller are:\n        nova-api\n        nova-scheduler\n        \n(Folsom 2, Compute):  \nQuantum OVS plugin and agent. \n For Nova, this node is only running \"nova-compute\" (not:  metadata, novnc, nova-cert, nova-consoleatuth... etc... etc...See below the rationale) \n\n(Folsom 3): \nQuntum OVS agent, Quantum DHCP agent. \n\nPlease note that I do not run \"novnc\" \"nova-consoleauth\" \"nova-novncproxy\"  (nor Horizon for that matter) as my interest is only in console/SSH  access to the instances  (no  VNC / GUI / Dashboard )\n\nAlso, as per above, I am not running \"nova-api-metadata\" either. \n\nProblem synopsis\n------------------------\n\nInstances are spawned successfully --  shown as \"ACTIVE\" ---  but \"console.log\" are empty (0 bytes) files and with no console listed.  This is disregarding what image is tested (tried: CirrOS, TTY-linux and Ubuntu-12.04 server images, all with same effect):\n\nOn \"Compute\" (Folsom 2) node: \n\n root@Folsom-2:~# nova list\n\n+--------------------------------------+--------------+--------+------------------------+\n| ID                                   | Name         | Status | Networks               |\n+--------------------------------------+--------------+--------+------------------------+\n| c4bd7d22-a859-4603-9ec4-9f91f25f81a4 | Cirros0Sv8   | ACTIVE | SvcIntNet1=169.254.1.3 |\n| 2c4e0e56-9140-46a6-b07d-89a2f3b44730 | TTY-linux-v1 | ACTIVE | SvcIntNet1=169.254.1.4 |\n+--------------------------------------+--------------+--------+------------------------+\n\n\n######## The KVM processes: \n\nroot@server-1355685201-az-2-region-a-geo-1:~# ps axuww | grep -i kvm\n107       3487  0.3  0.1 3607676 48196 ?       Sl   Jan25  48:09 /usr/bin/qemu-system-x86_64 -S -M pc-1.0 -cpu qemu32 -no-kvm -m 2048 -smp 1,sockets=1,cores=1,threads=1 -name VM-00000009 -uuid 2c4e0e56-9140-46a6-b07d-89a2f3b44730 -nodefconfig -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/VM-00000009.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -kernel /var/lib/nova/instances/VM-00000009/kernel -initrd /var/lib/nova/instances/VM-00000009/ramdisk -append root=/dev/vda console=ttyS0 -drive file=/var/lib/nova/instances/VM-00000009/disk,if=none,id=drive-virtio-disk0,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0 -drive file=/var/lib/nova/instances/VM-00000009/disk.local,if=none,id=drive-virtio-disk1,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x5,drive=drive-virtio-disk1,id=virtio-disk1 -netdev tap,ifname=tapcb09e56c-45,script=,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=fa:16:3e:d9:33:cb,bus=pci.0,addr=0x3 -chardev file,id=charserial0,path=/var/lib/nova/instances/VM-00000009/console.log -device isa-serial,chardev=charserial0,id=serial0 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -usb -device usb-tablet,id=input0 -vnc 127.0.0.1:1 -k en-us -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x6\n107      28392  0.3  0.1 3662384 38420 ?       Sl   Jan25  48:07 /usr/bin/qemu-system-x86_64 -S -M pc-1.0 -cpu qemu32 -no-kvm -m 2048 -smp 1,sockets=1,cores=1,threads=1 -name VM-00000008 -uuid c4bd7d22-a859-4603-9ec4-9f91f25f81a4 -nodefconfig -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/VM-00000008.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -drive file=/var/lib/nova/instances/VM-00000008/disk,if=none,id=drive-virtio-disk0,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/var/lib/nova/instances/VM-00000008/disk.local,if=none,id=drive-virtio-disk1,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x5,drive=drive-virtio-disk1,id=virtio-disk1 -netdev tap,ifname=tap620a3e4d-cb,script=,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=fa:16:3e:d9:d3:89,bus=pci.0,addr=0x3 -chardev file,id=charserial0,path=/var/lib/nova/instances/VM-00000008/console.log -device isa-serial,chardev=charserial0,id=serial0 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -usb -device usb-tablet,id=input0 -vnc 127.0.0.1:0 -k en-us -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x6\n\n\n######## The instance details in Nova: \n\nroot@Folsom2:~# ll /var/lib/nova/instances/VM-00000008/\ntotal 740\ndrwxr-xr-x 2 root         root   4096 Jan 25 11:34 ./\ndrwxr-xr-x 5 nova         nova   4096 Jan 25 11:58 ../\n-rw-rw---- 1 libvirt-qemu kvm       0 Jan 25 11:35 console.log\n-rw-r--r-- 1 libvirt-qemu kvm  720896 Jan 25 11:34 disk\n-rw-r--r-- 1 libvirt-qemu kvm  197120 Jan 25 11:34 disk.local\n-rw-r--r-- 1 root         root   1253 Jan 25 11:34 libvirt.xml\n\n\nroot@Folsom2:~# ll /var/lib/nova/instances/VM-00000009\ntotal 10816\ndrwxr-xr-x 2 root         root    4096 Jan 25 11:58 ./\ndrwxr-xr-x 5 nova         nova    4096 Jan 25 11:58 ../\n-rw-rw---- 1 libvirt-qemu kvm        0 Jan 25 11:58 console.log\n-rw-r--r-- 1 libvirt-qemu kvm   720896 Jan 25 11:58 disk\n-rw-r--r-- 1 libvirt-qemu kvm   197120 Jan 25 11:58 disk.local\n-rw-r--r-- 1 libvirt-qemu kvm  4404752 Jan 25 11:58 kernel\n-rw-r--r-- 1 root         root    1412 Jan 25 11:58 libvirt.xml\n-rw-r--r-- 1 libvirt-qemu kvm  5882349 Jan 25 11:58 ramdisk\n\n######## The \"libvirt.xml\" file for \"VM-00000008\":\n\nroot@server-1355685201-az-2-region-a-geo-1:~# cat /var/lib/nova/instances/VM-00000008/libvirt.xml \n<domain type=\"qemu\">\n  <uuid>c4bd7d22-a859-4603-9ec4-9f91f25f81a4</uuid>\n  <name>VM-00000008</name>\n  <memory>2097152</memory>\n  <vcpu>1</vcpu>\n  <os>\n    <type>hvm</type>\n    <boot dev=\"hd\"/>\n  </os>\n  <features>\n    <acpi/>\n  </features>\n  <clock offset=\"utc\"/>\n  <cpu match=\"exact\">\n    <arch>x86_64</arch>\n    <model>qemu32</model>\n    <vendor>Intel</vendor>\n  </cpu>\n  <devices>\n    <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/var/lib/nova/instances/VM-00000008/disk\"/>\n      <target bus=\"virtio\" dev=\"vda\"/>\n    </disk>\n    <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/var/lib/nova/instances/VM-00000008/disk.local\"/>\n      <target bus=\"virtio\" dev=\"vdb\"/>\n    </disk>\n    <interface type=\"ethernet\">\n      <mac address=\"fa:16:3e:d9:d3:89\"/>\n      <model type=\"virtio\"/>\n      <script path=\"\"/>\n      <target dev=\"tap620a3e4d-cb\"/>\n    </interface>\n    <serial type=\"file\">\n      <source path=\"/var/lib/nova/instances/VM-00000008/console.log\"/>\n    </serial>\n    <serial type=\"pty\"/>\n    <input type=\"tablet\" bus=\"usb\"/>\n    <graphics type=\"vnc\" autoport=\"yes\" keymap=\"en-us\" listen=\"127.0.0.1\"/>\n  </devices>\n</domain>\n\n\n\n######## Virsh: \n\nroot@server-1355685201-az-2-region-a-geo-1:~# virsh -c qemu:///system list\n Id Name                 State\n----------------------------------\n  7 VM-00000008          running\n  8 VM-00000009          running\n\n\n########  No serial console for neither of the VMs. \n\nroot@server-1355685201-az-2-region-a-geo-1:~# virsh console VM-00000008\nConnected to domain VM-00000008\nEscape character is ^]\nerror: internal error character device (null) is not using a PTY\n\nroot@server-1355685201-az-2-region-a-geo-1:~# virsh console VM-00000009\nConnected to domain VM-00000009\nEscape character is ^]\nerror: internal error character device (null) is not using a PTY\n\nIn other words the instances are reported up and running where in fact they are unreachable /  unresponsive. \n\nAttached is the \"nova-compute.log\", covering spawning \"VM-00000008\".  The \"nova.conf\" file included below. \n\nThanks,\n\nFlorian \n\n-------\n\nP.S. The \"nova.conf\" file. Idenitical on both \"Compute\" and \"Controller\".   In the config below \"10.7.68.179\" is the IP address of the Controller (Folsom1) \n\nroot@Folsom2:~# cat /etc/nova/nova.conf\n[DEFAULT]\n\n# LOGS/STATE\nverbose=True\nlogdir=/var/log/nova\nstate_path=/var/lib/nova\nlock_path=/var/lock/nova\n\n# AUTHENTICATION\nauth_strategy=keystone\n\n# DATABASE\nsql_connection=mysql://novadbadmin:novadbadminpasswd@10.7.68.179/nova\n\n# COMPUTE \nconnection_type=libvirt\nlibvirt_type=qemu\ninstance_name_template=VM-%08x\napi_paste_config=/etc/nova/api-paste.ini\nallow_resize_to_same_host=True\nlibvirt_vif_driver=nova.virt.libvirt.vif.LibvirtOpenVswitchDriver\nlibvirt_use_virtio_for_bridges=True\n\n\n# APIs -- Only enable compute and metadata (without EC2 compat) \nenabled_apis = osapi_compute,metadata\nosapi_compute_extension=nova.api.openstack.compute.contrib.standard_extensions\n\n# RABBITMQ\nrabbit_host=10.7.68.179\nrabbbit_user=guest\nrabbit_password=guest\n\n# SCHEDULER\ncompute_scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler\n\n# GLANCE\nimage_service=nova.image.glance.GlanceImageService\nglance_api_servers=10.7.68.179:9292\n\n# NETWORK -- Quantum\nnetwork_api_class=nova.network.quantumv2.api.API\nquantum_url=http://10.7.68.179:9696\nquantum_auth_strategy=keystone\nquantum_admin_tenant_name=service\nquantum_admin_username=quantumadmin\nquantum_admin_password=quantumadminpasswd\nquantum_admin_auth_url=http://10.7.68.179:5001/v2.0/", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1115153", 
    "owner": "None", 
    "id": 1115153, 
    "index": 3377, 
    "created": "2013-02-04 11:22:50.777944+00:00", 
    "title": "Instances do not get a (serial) console", 
    "comments": [
        {
            "content": "First, a caveat: This might be very well related to a misconfig behaving badly. Still, as no error is reported I'll treat this as a bug:\n\nSetup\n--------\n\n3-node setup -- Controller (\"Folsom 1\"), Compute (\"Folsom 2\") and Network (\"Folsom 3\")\nOS: Ubuntu 12.04\nCode:  OVS and Quamtum directly from trunk; all the rest  as per Ubuntu packages in 12.04.\n\nOpenStack  Services: \n(Folsom 1, Controller -- 10 ):   \nKeystone, Swift, Glance on Swift, Quantum server.  For Nova, the _only_ Nova services on the controller are:\n        nova-api\n        nova-scheduler\n        \n(Folsom 2, Compute):  \nQuantum OVS plugin and agent. \n For Nova, this node is only running \"nova-compute\" (not:  metadata, novnc, nova-cert, nova-consoleatuth... etc... etc...See below the rationale) \n\n(Folsom 3): \nQuntum OVS agent, Quantum DHCP agent. \n\nPlease note that I do not run \"novnc\" \"nova-consoleauth\" \"nova-novncproxy\"  (nor Horizon for that matter) as my interest is only in console/SSH  access to the instances  (no  VNC / GUI / Dashboard )\n\nAlso, as per above, I am not running \"nova-api-metadata\" either. \n\nProblem synopsis\n------------------------\n\nInstances are spawned successfully --  shown as \"ACTIVE\" ---  but \"console.log\" are empty (0 bytes) files and with no console listed.  This is disregarding what image is tested (tried: CirrOS, TTY-linux and Ubuntu-12.04 server images, all with same effect):\n\nOn \"Compute\" (Folsom 2) node: \n\n root@Folsom-2:~# nova list\n\n+--------------------------------------+--------------+--------+------------------------+\n| ID                                   | Name         | Status | Networks               |\n+--------------------------------------+--------------+--------+------------------------+\n| c4bd7d22-a859-4603-9ec4-9f91f25f81a4 | Cirros0Sv8   | ACTIVE | SvcIntNet1=169.254.1.3 |\n| 2c4e0e56-9140-46a6-b07d-89a2f3b44730 | TTY-linux-v1 | ACTIVE | SvcIntNet1=169.254.1.4 |\n+--------------------------------------+--------------+--------+------------------------+\n\n\n######## The KVM processes: \n\nroot@server-1355685201-az-2-region-a-geo-1:~# ps axuww | grep -i kvm\n107       3487  0.3  0.1 3607676 48196 ?       Sl   Jan25  48:09 /usr/bin/qemu-system-x86_64 -S -M pc-1.0 -cpu qemu32 -no-kvm -m 2048 -smp 1,sockets=1,cores=1,threads=1 -name VM-00000009 -uuid 2c4e0e56-9140-46a6-b07d-89a2f3b44730 -nodefconfig -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/VM-00000009.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -kernel /var/lib/nova/instances/VM-00000009/kernel -initrd /var/lib/nova/instances/VM-00000009/ramdisk -append root=/dev/vda console=ttyS0 -drive file=/var/lib/nova/instances/VM-00000009/disk,if=none,id=drive-virtio-disk0,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0 -drive file=/var/lib/nova/instances/VM-00000009/disk.local,if=none,id=drive-virtio-disk1,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x5,drive=drive-virtio-disk1,id=virtio-disk1 -netdev tap,ifname=tapcb09e56c-45,script=,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=fa:16:3e:d9:33:cb,bus=pci.0,addr=0x3 -chardev file,id=charserial0,path=/var/lib/nova/instances/VM-00000009/console.log -device isa-serial,chardev=charserial0,id=serial0 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -usb -device usb-tablet,id=input0 -vnc 127.0.0.1:1 -k en-us -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x6\n107      28392  0.3  0.1 3662384 38420 ?       Sl   Jan25  48:07 /usr/bin/qemu-system-x86_64 -S -M pc-1.0 -cpu qemu32 -no-kvm -m 2048 -smp 1,sockets=1,cores=1,threads=1 -name VM-00000008 -uuid c4bd7d22-a859-4603-9ec4-9f91f25f81a4 -nodefconfig -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/VM-00000008.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -drive file=/var/lib/nova/instances/VM-00000008/disk,if=none,id=drive-virtio-disk0,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/var/lib/nova/instances/VM-00000008/disk.local,if=none,id=drive-virtio-disk1,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x5,drive=drive-virtio-disk1,id=virtio-disk1 -netdev tap,ifname=tap620a3e4d-cb,script=,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=fa:16:3e:d9:d3:89,bus=pci.0,addr=0x3 -chardev file,id=charserial0,path=/var/lib/nova/instances/VM-00000008/console.log -device isa-serial,chardev=charserial0,id=serial0 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -usb -device usb-tablet,id=input0 -vnc 127.0.0.1:0 -k en-us -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x6\n\n\n######## The instance details in Nova: \n\nroot@Folsom2:~# ll /var/lib/nova/instances/VM-00000008/\ntotal 740\ndrwxr-xr-x 2 root         root   4096 Jan 25 11:34 ./\ndrwxr-xr-x 5 nova         nova   4096 Jan 25 11:58 ../\n-rw-rw---- 1 libvirt-qemu kvm       0 Jan 25 11:35 console.log\n-rw-r--r-- 1 libvirt-qemu kvm  720896 Jan 25 11:34 disk\n-rw-r--r-- 1 libvirt-qemu kvm  197120 Jan 25 11:34 disk.local\n-rw-r--r-- 1 root         root   1253 Jan 25 11:34 libvirt.xml\n\n\nroot@Folsom2:~# ll /var/lib/nova/instances/VM-00000009\ntotal 10816\ndrwxr-xr-x 2 root         root    4096 Jan 25 11:58 ./\ndrwxr-xr-x 5 nova         nova    4096 Jan 25 11:58 ../\n-rw-rw---- 1 libvirt-qemu kvm        0 Jan 25 11:58 console.log\n-rw-r--r-- 1 libvirt-qemu kvm   720896 Jan 25 11:58 disk\n-rw-r--r-- 1 libvirt-qemu kvm   197120 Jan 25 11:58 disk.local\n-rw-r--r-- 1 libvirt-qemu kvm  4404752 Jan 25 11:58 kernel\n-rw-r--r-- 1 root         root    1412 Jan 25 11:58 libvirt.xml\n-rw-r--r-- 1 libvirt-qemu kvm  5882349 Jan 25 11:58 ramdisk\n\n######## The \"libvirt.xml\" file for \"VM-00000008\":\n\nroot@server-1355685201-az-2-region-a-geo-1:~# cat /var/lib/nova/instances/VM-00000008/libvirt.xml \n<domain type=\"qemu\">\n  <uuid>c4bd7d22-a859-4603-9ec4-9f91f25f81a4</uuid>\n  <name>VM-00000008</name>\n  <memory>2097152</memory>\n  <vcpu>1</vcpu>\n  <os>\n    <type>hvm</type>\n    <boot dev=\"hd\"/>\n  </os>\n  <features>\n    <acpi/>\n  </features>\n  <clock offset=\"utc\"/>\n  <cpu match=\"exact\">\n    <arch>x86_64</arch>\n    <model>qemu32</model>\n    <vendor>Intel</vendor>\n  </cpu>\n  <devices>\n    <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/var/lib/nova/instances/VM-00000008/disk\"/>\n      <target bus=\"virtio\" dev=\"vda\"/>\n    </disk>\n    <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/var/lib/nova/instances/VM-00000008/disk.local\"/>\n      <target bus=\"virtio\" dev=\"vdb\"/>\n    </disk>\n    <interface type=\"ethernet\">\n      <mac address=\"fa:16:3e:d9:d3:89\"/>\n      <model type=\"virtio\"/>\n      <script path=\"\"/>\n      <target dev=\"tap620a3e4d-cb\"/>\n    </interface>\n    <serial type=\"file\">\n      <source path=\"/var/lib/nova/instances/VM-00000008/console.log\"/>\n    </serial>\n    <serial type=\"pty\"/>\n    <input type=\"tablet\" bus=\"usb\"/>\n    <graphics type=\"vnc\" autoport=\"yes\" keymap=\"en-us\" listen=\"127.0.0.1\"/>\n  </devices>\n</domain>\n\n\n\n######## Virsh: \n\nroot@server-1355685201-az-2-region-a-geo-1:~# virsh -c qemu:///system list\n Id Name                 State\n----------------------------------\n  7 VM-00000008          running\n  8 VM-00000009          running\n\n\n########  No serial console for neither of the VMs. \n\nroot@server-1355685201-az-2-region-a-geo-1:~# virsh console VM-00000008\nConnected to domain VM-00000008\nEscape character is ^]\nerror: internal error character device (null) is not using a PTY\n\nroot@server-1355685201-az-2-region-a-geo-1:~# virsh console VM-00000009\nConnected to domain VM-00000009\nEscape character is ^]\nerror: internal error character device (null) is not using a PTY\n\nIn other words the instances are reported up and running where in fact they are unreachable /  unresponsive. \n\nAttached is the \"nova-compute.log\", covering spawning \"VM-00000008\".  The \"nova.conf\" file included below. \n\nThanks,\n\nFlorian \n\n-------\n\nP.S. The \"nova.conf\" file. Idenitical on both \"Compute\" and \"Controller\".   In the config below \"10.7.68.179\" is the IP address of the Controller (Folsom1) \n\nroot@Folsom2:~# cat /etc/nova/nova.conf\n[DEFAULT]\n\n# LOGS/STATE\nverbose=True\nlogdir=/var/log/nova\nstate_path=/var/lib/nova\nlock_path=/var/lock/nova\n\n# AUTHENTICATION\nauth_strategy=keystone\n\n# DATABASE\nsql_connection=mysql://novadbadmin:novadbadminpasswd@10.7.68.179/nova\n\n# COMPUTE \nconnection_type=libvirt\nlibvirt_type=qemu\ninstance_name_template=VM-%08x\napi_paste_config=/etc/nova/api-paste.ini\nallow_resize_to_same_host=True\nlibvirt_vif_driver=nova.virt.libvirt.vif.LibvirtOpenVswitchDriver\nlibvirt_use_virtio_for_bridges=True\n\n\n# APIs -- Only enable compute and metadata (without EC2 compat) \nenabled_apis = osapi_compute,metadata\nosapi_compute_extension=nova.api.openstack.compute.contrib.standard_extensions\n\n# RABBITMQ\nrabbit_host=10.7.68.179\nrabbbit_user=guest\nrabbit_password=guest\n\n# SCHEDULER\ncompute_scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler\n\n# GLANCE\nimage_service=nova.image.glance.GlanceImageService\nglance_api_servers=10.7.68.179:9292\n\n# NETWORK -- Quantum\nnetwork_api_class=nova.network.quantumv2.api.API\nquantum_url=http://10.7.68.179:9696\nquantum_auth_strategy=keystone\nquantum_admin_tenant_name=service\nquantum_admin_username=quantumadmin\nquantum_admin_password=quantumadminpasswd\nquantum_admin_auth_url=http://10.7.68.179:5001/v2.0/", 
            "date_created": "2013-02-04 11:22:50.777944+00:00", 
            "author": "https://api.launchpad.net/1.0/~florian-otel"
        }, 
        {
            "content": "", 
            "date_created": "2013-02-04 11:22:50.777944+00:00", 
            "author": "https://api.launchpad.net/1.0/~florian-otel"
        }, 
        {
            "content": "Which version of libvirt and distro?", 
            "date_created": "2013-02-04 18:21:56.636356+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "As per above, the distro is Ubuntu 12.04, updated as per latest packages. \n\nWrt libvirt, on the \"Compute\" node (Folsom2): \n\nroot@Folsom2:~# dpkg -l | grep -i libvirt\nii  libvirt-bin                        0.9.8-2ubuntu17.4                                    programs for the libvirt library\nii  libvirt0                           0.9.8-2ubuntu17.4                                    library for interfacing with different virtualization systems\nii  python-libvirt                     0.9.8-2ubuntu17.4                                    libvirt Python bindings\n\n\nAttached is also the /etc/libvirt/qemu.conf on that node\n\n", 
            "date_created": "2013-02-05 00:38:11.205562+00:00", 
            "author": "https://api.launchpad.net/1.0/~florian-otel"
        }, 
        {
            "content": "Hello all, \n\nAfter further investigation it seems that the problem might be with libvirt / QEMU: \n\n\nroot@Folsom2:~# nova list\n+--------------------------------------+----------+--------+------------------------+\n| ID                                   | Name     | Status | Networks               |\n+--------------------------------------+----------+--------+------------------------+\n| ccd78864-f606-4f98-9091-57c2d1ed7f26 | CirrOSv8 | ACTIVE | SvcIntNet1=169.254.1.3 |\n+--------------------------------------+----------+--------+------------------------+\n\nroot@Folsom2:~# nova show ccd78864-f606-4f98-9091-57c2d1ed7f26\n+-------------------------------------+------------------------------------------------------------+\n| Property                            | Value                                                      |\n+-------------------------------------+------------------------------------------------------------+\n| OS-DCF:diskConfig                   | MANUAL                                                     |\n| OS-EXT-SRV-ATTR:host                | Folsom2                      |\n| OS-EXT-SRV-ATTR:hypervisor_hostname | Folsom2.novalocal            |\n| OS-EXT-SRV-ATTR:instance_name       | VM-0000000b                                                |\n| OS-EXT-STS:power_state              | 1                                                          |\n| OS-EXT-STS:task_state               | None                                                       |\n| OS-EXT-STS:vm_state                 | active                                                     |\n| SvcIntNet1 network                  | 169.254.1.3                                                |\n| accessIPv4                          |                                                            |\n| accessIPv6                          |                                                            |\n| config_drive                        |                                                            |\n| created                             | 2013-02-11T13:43:37Z                                       |\n| flavor                              | m1.small (2)                                               |\n| hostId                              | e587a763c5788b4c3106893ad09a707a4560d17609c7682ef71fe558   |\n| id                                  | ccd78864-f606-4f98-9091-57c2d1ed7f26                       |\n| image                               | CirrOS-0.3.0-x86_64 (7789ebb5-14e8-4c44-a4ea-1bffdc52df51) |\n| key_name                            | F2-keypair                                                 |\n| metadata                            | {}                                                         |\n| name                                | CirrOSv8                                                   |\n| progress                            | 0                                                          |\n| security_groups                     | [{u'name': u'default'}]                                    |\n| status                              | ACTIVE                                                     |\n| tenant_id                           | 8032be08210a424687ff3622338ffe23                           |\n| updated                             | 2013-02-11T13:43:44Z                                       |\n| user_id                             | 910e23997c394646ab18298228363774                           |\n+-------------------------------------+------------------------------------------------------------+\n\nThe KVM process that runns that \"VM-0000000b\" is: \n\n107      26221  0.3  0.1 3662352 38636 ?       Sl   13:43   0:23 /usr/bin/qemu-system-x86_64 -S -M pc-1.0 -cpu qemu32 -no-kvm -m 2048 -smp 1,sockets=1,cores=1,threads=1 -name VM-0000000b -uuid ccd78864-f606-4f98-9091-57c2d1ed7f26 -nodefconfig -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/VM-0000000b.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -drive file=/var/lib/nova/instances/VM-0000000b/disk,if=none,id=drive-virtio-disk0,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/var/lib/nova/instances/VM-0000000b/disk.local,if=none,id=drive-virtio-disk1,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x5,drive=drive-virtio-disk1,id=virtio-disk1 -netdev tap,ifname=tap59663690-18,script=,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=fa:16:3e:4b:94:c3,bus=pci.0,addr=0x3 -chardev file,id=charserial0,path=/var/lib/nova/instances/VM-0000000b/console.log -device isa-serial,chardev=charserial0,id=serial0 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -usb -device usb-tablet,id=input0 -vnc 0.0.0.0:0 -k en-us -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x6\n\n\n(or as paste please see http://paste.openstack.org/show/30990/)\n\nNow, the problem is that the QEMU log for that VM says:\n\nroot@Folsom2:~# cat /var/log/libvirt/qemu/VM-0000000b.log \n2013-02-11 13:43:43.582+0000: starting up\nLC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/sbin:/sbin:/bin QEMU_AUDIO_DRV=none /usr/bin/qemu-system-x86_64 -S -M pc-1.0 -cpu qemu32 -no-kvm -m 2048 -smp 1,sockets=1,cores=1,threads=1 -name VM-0000000b -uuid ccd78864-f606-4f98-9091-57c2d1ed7f26 -nodefconfig -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/VM-0000000b.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -drive file=/var/lib/nova/instances/VM-0000000b/disk,if=none,id=drive-virtio-disk0,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/var/lib/nova/instances/VM-0000000b/disk.local,if=none,id=drive-virtio-disk1,format=qcow2,cache=none -device virtio-blk-pci,bus=pci.0,addr=0x5,drive=drive-virtio-disk1,id=virtio-disk1 -netdev tap,ifname=tap59663690-18,script=,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=fa:16:3e:4b:94:c3,bus=pci.0,addr=0x3 -chardev file,id=charserial0,path=/var/lib/nova/instances/VM-0000000b/console.log -device isa-serial,chardev=charserial0,id=serial0 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -usb -device usb-tablet,id=input0 -vnc 0.0.0.0:0 -k en-us -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x6\nDomain id=10 is tainted: shell-scripts\nchar device redirected to /dev/pts/15\n\n(see this as a  paste at http://paste.openstack.org/show/30988/ )\n\nNow, the obvious question is why I have that last line \"char device redirected to /dev/pts/15\" ? I strongly suspect that's a strong suspect as to why my VMs don't get a serial console / do not boot. \n\nThe \"qemu.conf\" on that node is attached to the previous comment. \n\nThanks again,\n\nFlorian\n\n\n", 
            "date_created": "2013-02-11 15:48:07.386053+00:00", 
            "author": "https://api.launchpad.net/1.0/~florian-otel"
        }, 
        {
            "content": "Hello again, \n\nWhile I cannot accurately point the actual bug, the problem turned out to be in the underlying libvirt and QEMU. \n\nIt seems that the latest version in stock Ubuntu 12.04 LTS (as of today) are buggy.   After switched to the libvirt and QEMU versions as per the Ubuntu cloud archive (\"deb http://ubuntu-cloud.archive.canonical.com/ubuntu precise-updates/folsom main\") problem was \"magically\" solved: \n\nNamely my current versions of libvirt and QEMU are now: \n\nroot@Folsom2:~# dpkg -l | grep -i libvirt\nii  libvirt-bin                        0.9.13-0ubuntu12.2~cloud0                            programs for the libvirt library\nii  libvirt0                           0.9.13-0ubuntu12.2~cloud0                            library for interfacing with different virtualization systems\nii  python-libvirt                     0.9.8-2ubuntu17.4                                    libvirt Python bindings\n\nroot@Folsom2:~# dpkg -l | grep -i qemu\nii  qemu-common                        1.0+noroms-0ubuntu14.7                               qemu common functionality (bios, documentation, etc)\nii  qemu-kvm                           1.0+noroms-0ubuntu14.7                               Full virtualization on i386 and amd64 hardware\nii  qemu-utils                         1.0+noroms-0ubuntu14.7                               qemu utilities\nii  vgabios                            0.6c-2ubuntu3                                        VGA BIOS software for the Bochs and Qemu emulated VGA card\n\n\nWhile after the upgrade there is no discernable difference in the libvirt and QEMU logs (output / behaviour / logs are same as prior to upgrade) now the VMs in Nova boot properly. \n\nMost frustrating parts of the experience were that:\n\n- From a Nova perspective the issue is undetected (I still consider this as a Nova bug).\n\n- From a libvirt / QEMU perspective I was so far unable to pinpoint the bug \n\nJust FYI / whomever will encounter this problem.\n\n", 
            "date_created": "2013-02-15 08:53:43.859550+00:00", 
            "author": "https://api.launchpad.net/1.0/~florian-otel"
        }
    ]
}