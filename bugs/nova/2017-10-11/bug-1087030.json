{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:05:16.791614+00:00", 
    "description": "When ephemeral disks are created, they sometimes get None in the fileneame. This happens if the glance image has no os_type set. The purpose of putting the image type in the filename is that different os types cause the fs to be formatted differently. Therefore, the None should at the very least be 'default' but it would be nice if it could search through the virt_mkfs option to see if another option matches default. For example, in the default config options the default option matches the linux option so it should really be using linux instead of None.\n\nin _base:\n\nephemeral_0_20_None\nephemeral_0_20_None_20", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1087030", 
    "owner": "https://api.launchpad.net/1.0/~mikal", 
    "id": 1087030, 
    "index": 5620, 
    "created": "2012-12-05 22:25:16.087210+00:00", 
    "title": "libvirt: Ephemeral disks are labeled with None", 
    "comments": [
        {
            "content": "When ephemeral disks are created, they sometimes get None in the fileneame. This happens if the glance image has no os_type set. The purpose of putting the image type in the filename is that different os types cause the fs to be formatted differently. Therefore, the None should at the very least be 'default' but it would be nice if it could search through the virt_mkfs option to see if another option matches default. For example, in the default config options the default option matches the linux option so it should really be using linux instead of None.\n\nin _base:\n\nephemeral_0_20_None\nephemeral_0_20_None_20", 
            "date_created": "2012-12-05 22:25:16.087210+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "This code was re-written as part of moving to not caching ephemeral disks, so this bug is no longer relevant.", 
            "date_created": "2012-12-10 06:03:04.835679+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "Re-opening this to take another look.", 
            "date_created": "2012-12-11 00:18:55.238438+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "this could caused instance failed to boot:\n\nlogs:\n\n2012-12-14 02:18:27 DEBUG nova.utils [req-bf622be9-fa2b-4930-a5f9-7627e1ee2cf0 admin admin] Result was 0 from (pid=16046) execute /opt/stack/nova/nova/utils.py:199\n2012-12-14 02:18:27 DEBUG nova.utils [req-bf622be9-fa2b-4930-a5f9-7627e1ee2cf0 admin admin] Running cmd (subprocess): mkfs.ext3 -L ephemeral0 -F /opt/stack/data/nova/instances/_base/ephemeral_0_1_None from (pid=16046) execute /opt/stack/nova/nova/utils.py:183\n2012-12-14 02:18:27 ERROR nova.compute.manager [req-bf622be9-fa2b-4930-a5f9-7627e1ee2cf0 admin admin] [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5] Instance failed to spawn\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5] Traceback (most recent call last):\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/compute/manager.py\", line 843, in _spawn\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     block_device_info)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     temp_level, payload)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     self.gen.next()\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     return f(*args, **kw)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1074, in spawn\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     admin_pass=admin_password)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1348, in _create_image\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     ephemeral_size=ephemeral_gb)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 126, in cache\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     *args, **kwargs)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 173, in create_image\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     prepare_template(target=base, *args, **kwargs)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/utils.py\", line 752, in inner\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     retval = f(*args, **kwargs)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 117, in call_if_not_exists\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     fetch_func(target=target, *args, **kwargs)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1232, in _create_ephemeral\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     disk.mkfs(os_type, fs_label, target)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/virt/disk/api.py\", line 100, in mkfs\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     utils.execute(*mkfs_command.split())\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/opt/stack/nova/nova/utils.py\", line 191, in execute\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     shell=shell)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/green/subprocess.py\", line 25, in __init__\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/usr/lib/python2.7/subprocess.py\", line 679, in __init__\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     errread, errwrite)\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]   File \"/usr/lib/python2.7/subprocess.py\", line 1249, in _execute_child\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5]     raise child_exception\n2012-12-14 02:18:27 TRACE nova.compute.manager [instance: 48f811a7-ca48-40ae-8330-f876e1b1c6f5] OSError: [Errno 2] No such file or directory\n\n\nmy environment:\n\ndevstack + ubuntu precise 64", 
            "date_created": "2012-12-14 02:58:11.373882+00:00", 
            "author": "https://api.launchpad.net/1.0/~xiaohanyu1988"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/18293\nCommitted: http://github.com/openstack/nova/commit/0cecdf4b8632d3a4eea816869796b03e8b928256\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0cecdf4b8632d3a4eea816869796b03e8b928256\nAuthor: Michael Still <email address hidden>\nDate:   Tue Dec 18 16:32:14 2012 +1100\n\n    Reliably include OS type in ephemeral filenames.\n    \n    Either include the OS type, or \"default\" if this isn't specified.\n    \n    Also, I don't see why we care what ephemeral disk number this disk\n    was created as (they're all empty images in base, right?) so I've\n    removed that.\n    \n    Resolves bug 1087030.\n    \n    Change-Id: Iee7f8e9033a2e6a829421763090ed0e67c6b2da8\n", 
            "date_created": "2012-12-22 20:51:50.665111+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}