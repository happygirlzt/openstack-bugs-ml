{
    "status": "Fix Released", 
    "last_updated": "2017-04-18 06:13:46.810882+00:00", 
    "description": "Nova is failing to start on centos7 jobs [1] \n\n---\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service [-] Error starting thread.\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service Traceback (most recent call last):\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/oslo_service/service.py\", line 722, in run_service\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service     service.start()\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/service.py\", line 144, in start\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service     self.manager.init_host()\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1138, in init_host\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service     self.driver.init_host(host=self.host)\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 498, in init_host\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service     self._version_to_string(MIN_QEMU_VERSION))\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service InternalError: Nova requires QEMU version 2.1.0 or greater.\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service \n---\n\nI have ensured we are using qemu-kvm-ev from the virt repos [2] (WIP change at [3], but actually the qemu-kvm-ev package obsoletes the qemu-kvm package so i think this is not the problem at all).\n\n---\n2017-02-27 00:43:14.858 | Installing:\n2017-02-27 00:43:14.858 |  qemu-kvm-ev      x86_64     10:2.6.0-28.el7_3.3.1        rdo-qemu-ev     2.4 M\n---\n\nThis seems to have started after [4]\n\nWe seem to be returning the right thing\n\n---\n[ianw@centos-7-rax-iad-7489471 ~]$ /usr/libexec/qemu-kvm --version\nQEMU emulator version 2.6.0 (qemu-kvm-ev-2.6.0-28.el7_3.3.1), Copyright (c) 2003-2008 Fabrice Bellard\n\n[ianw@centos-7-rax-iad-7489471 ~]$ sudo virsh -c qemu:///system version --daemon\nCompiled against library: libvirt 2.0.0\nUsing library: libvirt 2.0.0\nUsing API: QEMU 2.0.0\nRunning hypervisor: QEMU 2.6.0\nRunning against daemon: 2.0.0\n\n>>> import libvirt\n>>> c=libvirt.openReadOnly(None)\n>>> c.getVersion()\n2006000\n---\n\n\n[1] http://logs.openstack.org/02/438302/3/check/gate-tempest-dsvm-platform-centos7-nv/9549abc/logs/screen-n-cpu.txt.gz\n[2] http://logs.openstack.org/02/438302/3/check/gate-tempest-dsvm-platform-centos7-nv/9549abc/logs/devstacklog.txt.gz#_2017-02-27_00_43_14_858\n[3] https://review.openstack.org/#/c/438325/\n[4] https://review.openstack.org/#/c/432700/", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1668164", 
    "owner": "None", 
    "id": 1668164, 
    "index": 6699, 
    "created": "2017-02-27 06:22:11.530540+00:00", 
    "title": "centos7: nova not detecting version of qemu-kvm-ev ", 
    "comments": [
        {
            "content": "Nova is failing to start on centos7 jobs [1] \n\n---\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service [-] Error starting thread.\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service Traceback (most recent call last):\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/oslo_service/service.py\", line 722, in run_service\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service     service.start()\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/service.py\", line 144, in start\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service     self.manager.init_host()\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1138, in init_host\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service     self.driver.init_host(host=self.host)\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 498, in init_host\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service     self._version_to_string(MIN_QEMU_VERSION))\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service InternalError: Nova requires QEMU version 2.1.0 or greater.\n2017-02-27 00:53:52.638 20698 ERROR oslo_service.service \n---\n\nI have ensured we are using qemu-kvm-ev from the virt repos [2] (WIP change at [3], but actually the qemu-kvm-ev package obsoletes the qemu-kvm package so i think this is not the problem at all).\n\n---\n2017-02-27 00:43:14.858 | Installing:\n2017-02-27 00:43:14.858 |  qemu-kvm-ev      x86_64     10:2.6.0-28.el7_3.3.1        rdo-qemu-ev     2.4 M\n---\n\nThis seems to have started after [4]\n\nWe seem to be returning the right thing\n\n---\n[ianw@centos-7-rax-iad-7489471 ~]$ /usr/libexec/qemu-kvm --version\nQEMU emulator version 2.6.0 (qemu-kvm-ev-2.6.0-28.el7_3.3.1), Copyright (c) 2003-2008 Fabrice Bellard\n\n[ianw@centos-7-rax-iad-7489471 ~]$ sudo virsh -c qemu:///system version --daemon\nCompiled against library: libvirt 2.0.0\nUsing library: libvirt 2.0.0\nUsing API: QEMU 2.0.0\nRunning hypervisor: QEMU 2.6.0\nRunning against daemon: 2.0.0\n\n>>> import libvirt\n>>> c=libvirt.openReadOnly(None)\n>>> c.getVersion()\n2006000\n---\n\n\n[1] http://logs.openstack.org/02/438302/3/check/gate-tempest-dsvm-platform-centos7-nv/9549abc/logs/screen-n-cpu.txt.gz\n[2] http://logs.openstack.org/02/438302/3/check/gate-tempest-dsvm-platform-centos7-nv/9549abc/logs/devstacklog.txt.gz#_2017-02-27_00_43_14_858\n[3] https://review.openstack.org/#/c/438325/\n[4] https://review.openstack.org/#/c/432700/", 
            "date_created": "2017-02-27 06:22:11.530540+00:00", 
            "author": "https://api.launchpad.net/1.0/~iwienand"
        }, 
        {
            "content": "Actually, i've held a failing node.  There seems to be a mismatch maybe ...\n\n---\n$ sudo virsh -c qemu:///system version --daemon\nCompiled against library: libvirt 2.0.0\nUsing library: libvirt 2.0.0\nUsing API: QEMU 2.0.0\nRunning hypervisor: QEMU 2.0.0\nRunning against daemon: 2.0.0\n\n[ianw@centos-7-rax-iad-7489763 ~]$ /usr/libexec/qemu-kvm --version\nQEMU emulator version 2.6.0 (qemu-kvm-ev-2.6.0-28.el7_3.3.1), Copyright (c) 2003-2008 Fabrice Bellard\n---", 
            "date_created": "2017-02-27 07:38:00.315897+00:00", 
            "author": "https://api.launchpad.net/1.0/~iwienand"
        }, 
        {
            "content": "ok, it's qemu-system getting in the way I think\n\n\n---\n[ianw@centos-7-rax-iad-7489763 ~]$ qemu-\nqemu-img            qemu-io             qemu-nbd            qemu-system-i386    qemu-system-x86_64  \n[ianw@centos-7-rax-iad-7489763 ~]$ qemu-system-x86_64 --version\n\n(process:27574): GLib-WARNING **: gmem.c:482: custom memory allocation vtable not supported\nQEMU emulator version 2.0.0, Copyright (c) 2003-2008 Fabrice Bellard\n\n[ianw@centos-7-rax-iad-7489763 ~]$ whereis qemu-system-x86_64\nqemu-system-x86_64: /usr/bin/qemu-system-x86_64 /usr/share/man/man1/qemu-system-x86_64.1.gz\n\n[ianw@centos-7-rax-iad-7489763 ~]$ rpm -qf /usr/bin/qemu-system-x86_64\nqemu-system-x86-2.0.0-1.el7.6.x86_64\n\n[ianw@centos-7-rax-iad-7489763 ~]$ sudo yum uninstall qemu-system-x86\n...\n\n[ianw@centos-7-rax-iad-7489763 ~]$ sudo virsh -c qemu:///system version --daemon\nCompiled against library: libvirt 2.0.0\nUsing library: libvirt 2.0.0\nUsing API: QEMU 2.0.0\nerror: failed to get the hypervisor version\nerror: Cannot check QEMU binary /usr/bin/qemu-system-x86_64: No such file or directory\n\n[ianw@centos-7-rax-iad-7489763 ~]$ sudo service libvirtd restart\nRedirecting to /bin/systemctl restart  libvirtd.service\n\n[ianw@centos-7-rax-iad-7489763 ~]$ sudo virsh -c qemu:///system version --daemon\nCompiled against library: libvirt 2.0.0\nUsing library: libvirt 2.0.0\nUsing API: QEMU 2.0.0\nRunning hypervisor: QEMU 2.6.0\nRunning against daemon: 2.0.0\n---\n", 
            "date_created": "2017-02-27 07:41:26.651826+00:00", 
            "author": "https://api.launchpad.net/1.0/~iwienand"
        }, 
        {
            "content": "I have modified the packages installed by devstack in [1] (forgot to tag this bug).  I have also filed [2] to see if there's any way to make this clearer\n\n[1] https://review.openstack.org/438325\n[2] https://bugzilla.redhat.com/show_bug.cgi?id=1427703", 
            "date_created": "2017-02-28 22:33:41.043811+00:00", 
            "author": "https://api.launchpad.net/1.0/~iwienand"
        }, 
        {
            "content": "Hi\n\nhow did you solve this problem?\n\nI am getting similar error in nova compute logs on redhat 7.3 \n\n\"InternalError: Nova requires QEMU version 1.5.3 or greater\"\n\nHowever I can't seems to get qemu hypervisor version.\n\n# sudo virsh -c qemu:///system version --daemon\nCompiled against library: libvirt 2.0.0\nUsing library: libvirt 2.0.0\nUsing API: QEMU 2.0.0\nerror: failed to get the hypervisor version\nerror: internal error: Cannot find suitable emulator for x86_64\n\nand my libvirtd service shows below error.\n\n# systemctl status libvirtd.service -l\n\u25cf libvirtd.service - Virtualization daemon\n   Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; vendor preset: enabled)\n   Active: active (running) since Fri 2017-03-10 10:48:32 EET; 7min ago\n     Docs: man:libvirtd(8)\n           http://libvirt.org\n Main PID: 1500 (libvirtd)\n   CGroup: /system.slice/libvirtd.service\n           \u251c\u25001500 /usr/sbin/libvirtd\n           \u251c\u25003486 /sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/libexec/libvirt_leaseshelper\n           \u2514\u25003487 /sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/libexec/libvirt_leaseshelper\n\nMar 10 10:55:55 airframe-controller libvirtd[1500]: Failed to probe capabilities for /usr/bin/qemu-system-unicore32: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-system-unicore32 -help) unexpected exit status 127: /usr/bin/qemu-system-unicore32: error while loading shared libraries: libiscsi.so.2: cannot open shared object file: No such file or directory\nMar 10 10:55:55 airframe-controller libvirtd[1500]: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/libexec/qemu-kvm -help) unexpected exit status 127: /usr/libexec/qemu-kvm: error while loading shared libraries: libiscsi.so.2: cannot open shared object file: No such file or directory\nMar 10 10:55:55 airframe-controller libvirtd[1500]: Failed to probe capabilities for /usr/libexec/qemu-kvm: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/libexec/qemu-kvm -help) unexpected exit status 127: /usr/libexec/qemu-kvm: error while loading shared libraries: libiscsi.so.2: cannot open shared object file: No such file or directory\nMar 10 10:55:55 airframe-controller libvirtd[1500]: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-system-xtensa -help) unexpected exit status 127: /usr/bin/qemu-system-xtensa: error while loading shared libraries: libiscsi.so.2: cannot open shared object file: No such file or directory\nMar 10 10:55:55 airframe-controller libvirtd[1500]: Failed to probe capabilities for /usr/bin/qemu-system-xtensa: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-system-xtensa -help) unexpected exit status 127: /usr/bin/qemu-system-xtensa: error while loading shared libraries: libiscsi.so.2: cannot open shared object file: No such file or directory\nMar 10 10:55:55 airframe-controller libvirtd[1500]: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-system-xtensaeb -help) unexpected exit status 127: /usr/bin/qemu-system-xtensaeb: error while loading shared libraries: libiscsi.so.2: cannot open shared object file: No such file or directory\nMar 10 10:55:55 airframe-controller libvirtd[1500]: Failed to probe capabilities for /usr/bin/qemu-system-xtensaeb: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/bin/qemu-system-xtensaeb -help) unexpected exit status 127: /usr/bin/qemu-system-xtensaeb: error while loading shared libraries: libiscsi.so.2: cannot open shared object file: No such file or directory\nMar 10 10:55:55 airframe-controller libvirtd[1500]: invalid argument: could not find capabilities for arch=x86_64 domaintype=qemu\nMar 10 10:55:55 airframe-controller libvirtd[1500]: internal error: Cannot find suitable emulator for x86_64\nMar 10 10:55:55 airframe-controller libvirtd[1500]: End of file while reading data: Input/output error\n\n\n", 
            "date_created": "2017-03-10 09:01:52.874099+00:00", 
            "author": "https://api.launchpad.net/1.0/~shalal"
        }, 
        {
            "content": "Hi,\n\nStill facing the same issue with latest devstack(master) while installing devstack with ovs-dpdk on Centos.", 
            "date_created": "2017-04-18 06:13:45.498195+00:00", 
            "author": "https://api.launchpad.net/1.0/~sirisha-1"
        }
    ]
}