{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 12:02:49.924031+00:00", 
    "description": "Hi\n\nI have XCP pool with shared storage working on LVM over ISCSI. When I try to create a VM I get the following (version 2013.1):\n\n2013-03-30 22:49:02.711 ERROR nova.compute.manager [req-34dfe80c-76ab-40e9-81ba-4d20af45ea33 admin admin] [instance: 4436ad73-8d86-4982-97db-49f921beac55] Instance failed to spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55] Traceback (most recent call last):\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1055, in _spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     block_device_info)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 171, in spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     admin_password, network_info, block_device_info)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 468, in spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     undo_mgr.rollback_and_reraise(msg=msg, instance=instance)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/utils.py\", line 1250, in rollback_and_reraise\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     self._rollback()\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     self.gen.next()\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 451, in spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     vdis = create_disks_step(undo_mgr, disk_image_type, image_meta)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 142, in inner\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     rv = f(*args, **kwargs)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 334, in create_disks_step\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     block_device_info=block_device_info)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 305, in _create_disks\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     block_device_info=block_device_info)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 518, in get_vdis_for_instance\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     context, session, instance, name_label, image, image_type)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 974, in _create_image\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     image_id, image_type)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 931, in _create_cached_image\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     new_vdi_ref = _safe_copy_vdi(session, sr_ref, instance, root_vdi_ref)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 566, in _safe_copy_vdi\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     vdi_uuids=vdi_uuids, uuid_stack=_make_uuid_stack())\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 733, in call_plugin_serialized\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     rv = self.call_plugin(plugin, fn, params)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 729, in call_plugin\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     host, plugin, fn, args)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 743, in _unwrap_plugin_exceptions\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     return func(*args, **kwargs)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 229, in __call__\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     return self.__send(self.__name, args)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 133, in xenapi_request\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     result = _parse_result(getattr(self, methodname)(*full_params))\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 203, in _parse_result\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     raise Failure(result['ErrorDescription'])\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55] Failure: ['XENAPI_PLUGIN_FAILURE', 'safe_copy_vdis', 'OSError', \"[Errno 2] No such file or directory: '/var/run/sr-mount/4bf0449e-4a06-9324-0688-08c553b3ab57/tmpm9WMto'\"]\n\nI'm new to openstack, but seems like nova tries to use it as ext local storage. Is this a bug or this type of storage is not supported?\n\nThanks", 
    "tags": [
        "xenserver"
    ], 
    "importance": "Low", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1162382", 
    "owner": "https://api.launchpad.net/1.0/~bob-ball", 
    "id": 1162382, 
    "index": 5724, 
    "created": "2013-03-31 00:16:14.366312+00:00", 
    "title": "LVM over ISCSI as default SR not working", 
    "comments": [
        {
            "content": "Hi \n\nI have XCP pool with shared storage working on LVM over ISCSI. When I try to create a VM I get the following:\n\n2013-03-30 22:49:02.711 ERROR nova.compute.manager [req-34dfe80c-76ab-40e9-81ba-4d20af45ea33 admin admin] [instance: 4436ad73-8d86-4982-97db-49f921beac55] Instance failed to spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55] Traceback (most recent call last):\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1055, in _spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     block_device_info)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 171, in spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     admin_password, network_info, block_device_info)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 468, in spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     undo_mgr.rollback_and_reraise(msg=msg, instance=instance)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/utils.py\", line 1250, in rollback_and_reraise\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     self._rollback()\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     self.gen.next()\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 451, in spawn\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     vdis = create_disks_step(undo_mgr, disk_image_type, image_meta)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 142, in inner\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     rv = f(*args, **kwargs)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 334, in create_disks_step\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     block_device_info=block_device_info)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 305, in _create_disks\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     block_device_info=block_device_info)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 518, in get_vdis_for_instance\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     context, session, instance, name_label, image, image_type)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 974, in _create_image\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     image_id, image_type)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 931, in _create_cached_image\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     new_vdi_ref = _safe_copy_vdi(session, sr_ref, instance, root_vdi_ref)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 566, in _safe_copy_vdi\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     vdi_uuids=vdi_uuids, uuid_stack=_make_uuid_stack())\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 733, in call_plugin_serialized\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     rv = self.call_plugin(plugin, fn, params)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 729, in call_plugin\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     host, plugin, fn, args)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 743, in _unwrap_plugin_exceptions\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     return func(*args, **kwargs)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 229, in __call__\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     return self.__send(self.__name, args)\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 133, in xenapi_request\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     result = _parse_result(getattr(self, methodname)(*full_params))\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]   File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 203, in _parse_result\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55]     raise Failure(result['ErrorDescription'])\n2013-03-30 22:49:02.711 TRACE nova.compute.manager [instance: 4436ad73-8d86-4982-97db-49f921beac55] Failure: ['XENAPI_PLUGIN_FAILURE', 'safe_copy_vdis', 'OSError', \"[Errno 2] No such file or directory: '/var/run/sr-mount/4bf0449e-4a06-9324-0688-08c553b3ab57/tmpm9WMto'\"]\n\nI'm new to openstack, but seems like nova tries to use it as ext local storage. Is this a bug or this type of storage is not supported?\n\nThanks", 
            "date_created": "2013-03-31 00:16:14.366312+00:00", 
            "author": "https://api.launchpad.net/1.0/~nikita-gubenko"
        }, 
        {
            "content": "Currently only VHD based SRs are supported. It would work if you use NFS.\n\nUnfortunately, LVHD is also not supported with Cinder right now either. It doesn't really fit the model Cinder has. However, if your array is supported over raw iSCSI with Cinder, it should work with XCP.\n\nThe LVHD SR does not work with VHD files, so does not work as the root SR. Given how things work right now, you might find the RAW image will work, but more by accident than by planning. It is quite hard to change this right now, but patches welcome, and I may be able to help.\n\nThis is already covered in the docs. Do raise a doc bug if it seems unclear.", 
            "date_created": "2013-05-08 09:04:33.996853+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/43252", 
            "date_created": "2013-08-22 07:54:37.991622+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/43252\nCommitted: http://github.com/openstack/nova/commit/9301e0490474afb7cc0b6d1d6e7eb95a17c87ce1\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9301e0490474afb7cc0b6d1d6e7eb95a17c87ce1\nAuthor: Bob Ball <email address hidden>\nDate:   Tue Aug 20 21:29:07 2013 +0100\n\n    XenAPI: More operations with LVM-based SRs\n    \n    Some operations require Files-based SRs (ext3/NFS) - such as resize\n    and VHD download.  However, if using 3-part images or RAW then most\n    operations can be successful with this simple fix.\n    \n    Fixes bug 1162382\n    \n    Change-Id: Ia3d1c64871d78ab1bf6e197edaeee170d2b5dea8\n", 
            "date_created": "2013-08-30 17:31:09.725855+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}