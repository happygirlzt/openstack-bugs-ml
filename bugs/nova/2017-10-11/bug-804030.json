{
    "status": "Invalid", 
    "last_updated": "2011-07-22 07:34:18.634029+00:00", 
    "description": "It`s a fresh install of last nova package(from ubuntu repo) on Ubuntu 11.04, all services is on one node plus nova-compute on Node2.  This basic manual ( http://wiki.openstack.org/GettingImages ) offer to run two images ttylinux etc. I run from node1 to be on Node2, instance go in launching state then a few secs go in \"shutdown\" state.\nThe files on Node2 is img, libvirt.xml & kernel for second example from manual, and plus ramdisk file for ttylinux-img. The nova-compute.log look like in this bug https://bugs.launchpad.net/nova/+bug/761324 ,the same error, but what is real that size of kernel & ramdisk file is ZERO(!!!) (for second example there is registered kernel an no ramdisk, for first one nothing at all ). Apparently libvirt has error becouse inappropriate format of these zero files. \nIf all do on Node1(with all services) instance files and dir doesn`t even created. Log the same  \n\n2011-06-30 22:51:44,690 DEBUG nova.virt.libvirt_conn [-] instance instance-0000001f: finished toXML method from (pid=1\n1437) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:1041\n2011-06-30 22:51:44,753 INFO nova [-] called setup_basic_filtering in nwfilter\n2011-06-30 22:51:44,753 INFO nova [-] ensuring static filters\n2011-06-30 22:51:44,893 INFO nova [-] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0xa116d8c>\n2011-06-30 22:51:44,894 INFO nova [-] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0xa261cec>\n2011-06-30 22:51:44,899 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"apply\"... from (pid=1\n1437) inner /usr/lib/pymodules/python2.6/nova/utils.py:594\n2011-06-30 22:51:44,899 DEBUG nova.utils [-] Attempting to grab file lock \"iptables\" for method \"apply\"... from (pid=1\n1437) inner /usr/lib/pymodules/python2.6/nova/utils.py:599\n2011-06-30 22:51:44,905 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=11437) e\nxecute /usr/lib/pymodules/python2.6/nova/utils.py:150\n2011-06-30 22:51:44,920 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 120, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 615, in spawn\n(nova.exception): TRACE:     self.firewall_driver.prepare_instance_filter(instance, network_info)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 1986, in prepare_instan\nce_filter\n(nova.exception): TRACE:     self.iptables.apply()\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 607, in inner\n(nova.exception): TRACE:     retval = f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 286, in apply\n(nova.exception): TRACE:     attempts=5)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 666, in _execute\n(nova.exception): TRACE:     return utils.execute(*cmd, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 158, in execute\n(nova.exception): TRACE:     env=env)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/green/subprocess.py\", line 31, in __init__\n(nova.exception): TRACE:     wrapped_pipe = greenio.GreenPipe(pipe, pipe.mode, bufsize)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/greenio.py\", line 376, in __init__\n(nova.exception): TRACE:     raise TypeError('f(ile) should be int, str, unicode or file, not %r' % f)\n(nova.exception): TRACE: TypeError: f(ile) should be int, str, unicode or file, not <open GreenPipe '<fd:16>', mode 'w\nb' at 0xa583dac>\n(nova.exception): TRACE: \n2011-06-30 22:51:45,025 ERROR nova.compute.manager [90CSW2T4FFL4F1O7SZIR nadmin ikitest] Instance '31' failed to spawn\n. Is virtualization enabled in the BIOS?\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 234, in run_instanc\ne\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 126, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: f(ile) should be int, str, unicode or file, not <open GreenPipe '<fd:16>', mode 'wb' at 0xa583dac>\n(nova.compute.manager): TRACE:\n\n\nNetwork is Flat mode. bridge is on second real interface with 192.168.** address, nova network is in its subnet. Was some problems during first config and initial tasks.\nIs this a misconfig or a bug, can someone say?", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/804030", 
    "owner": "None", 
    "id": 804030, 
    "index": 2185, 
    "created": "2011-06-30 19:01:29.808205+00:00", 
    "title": "instance terminates a sec after launching", 
    "comments": [
        {
            "content": "It`s a fresh install of last nova package(from ubuntu repo) on Ubuntu 11.04, all services is on one node plus nova-compute on Node2.  This basic manual ( http://wiki.openstack.org/GettingImages ) offer to run two images ttylinux etc. I run from node1 to be on Node2, instance go in launching state then a few secs go in \"shutdown\" state.\nThe files on Node2 is img, libvirt.xml & kernel for second example from manual, and plus ramdisk file for ttylinux-img. The nova-compute.log look like in this bug https://bugs.launchpad.net/nova/+bug/761324 ,the same error, but what is real that size of kernel & ramdisk file is ZERO(!!!) (for second example there is registered kernel an no ramdisk, for first one nothing at all ). Apparently libvirt has error becouse inappropriate format of these zero files. \nIf all do on Node1(with all services) instance files and dir doesn`t even created. Log the same  \n\n2011-06-30 22:51:44,690 DEBUG nova.virt.libvirt_conn [-] instance instance-0000001f: finished toXML method from (pid=1\n1437) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:1041\n2011-06-30 22:51:44,753 INFO nova [-] called setup_basic_filtering in nwfilter\n2011-06-30 22:51:44,753 INFO nova [-] ensuring static filters\n2011-06-30 22:51:44,893 INFO nova [-] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0xa116d8c>\n2011-06-30 22:51:44,894 INFO nova [-] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0xa261cec>\n2011-06-30 22:51:44,899 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"apply\"... from (pid=1\n1437) inner /usr/lib/pymodules/python2.6/nova/utils.py:594\n2011-06-30 22:51:44,899 DEBUG nova.utils [-] Attempting to grab file lock \"iptables\" for method \"apply\"... from (pid=1\n1437) inner /usr/lib/pymodules/python2.6/nova/utils.py:599\n2011-06-30 22:51:44,905 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=11437) e\nxecute /usr/lib/pymodules/python2.6/nova/utils.py:150\n2011-06-30 22:51:44,920 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 120, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 615, in spawn\n(nova.exception): TRACE:     self.firewall_driver.prepare_instance_filter(instance, network_info)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 1986, in prepare_instan\nce_filter\n(nova.exception): TRACE:     self.iptables.apply()\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 607, in inner\n(nova.exception): TRACE:     retval = f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 286, in apply\n(nova.exception): TRACE:     attempts=5)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 666, in _execute\n(nova.exception): TRACE:     return utils.execute(*cmd, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 158, in execute\n(nova.exception): TRACE:     env=env)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/green/subprocess.py\", line 31, in __init__\n(nova.exception): TRACE:     wrapped_pipe = greenio.GreenPipe(pipe, pipe.mode, bufsize)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/greenio.py\", line 376, in __init__\n(nova.exception): TRACE:     raise TypeError('f(ile) should be int, str, unicode or file, not %r' % f)\n(nova.exception): TRACE: TypeError: f(ile) should be int, str, unicode or file, not <open GreenPipe '<fd:16>', mode 'w\nb' at 0xa583dac>\n(nova.exception): TRACE: \n2011-06-30 22:51:45,025 ERROR nova.compute.manager [90CSW2T4FFL4F1O7SZIR nadmin ikitest] Instance '31' failed to spawn\n. Is virtualization enabled in the BIOS?\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 234, in run_instanc\ne\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 126, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: f(ile) should be int, str, unicode or file, not <open GreenPipe '<fd:16>', mode 'wb' at 0xa583dac>\n(nova.compute.manager): TRACE:\n\n\nNetwork is Flat mode. bridge is on second real interface with 192.168.** address, nova network is in its subnet. Was some problems during first config and initial tasks.\nIs this a misconfig or a bug, can someone say?", 
            "date_created": "2011-06-30 19:01:29.808205+00:00", 
            "author": "https://api.launchpad.net/1.0/~novikov"
        }, 
        {
            "content": "The issue is explained here:\r\nhttps://answers.launchpad.net/nova/+question/146545\r\n", 
            "date_created": "2011-07-04 09:12:11.835488+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Sorry, is not that case. Here update.\nI`ve sync`ed versions of releases and may be do some reconfig.\nRelease from http://ppa.launchpad.net/nova-core/release/ubuntu natty main (ubuntu 11.04).\n\nProblem the same - files go to the node in not fully copied manner: kernel is zero size and  disk  size is eq 6144Kb. There is enough space on /var /tmp\n\n\n!!!=============\nFound error - cached images at /var/lib/nova/instances/_base were corrupted (may be cancelled when downloading or smth).\nMay be it is supposed to be checked by nova-service somehow - CRC periodicaly or flag of guaranteed downloading. \n!!!=============\n\nThank for attention!\n\nLog is useless for this error:\n\n2011-07-08 19:04:39,809 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img create -f qcow2 -o cluster_size=2M,backing_file=/var/lib/nova/instances/_base/00000002_sm /var/lib/nova/instances/instance-00000016/disk from (pid=12900) execute /usr/lib/pymodules/python2.7/nova/utils.py:150\n2011-07-08 19:04:39,883 INFO nova.virt.libvirt_conn [-] instance instance-00000016: injecting key into image 2\n2011-07-08 19:04:39,883 INFO nova.virt.libvirt_conn [-] instance instance-00000016: injecting net into image 2\n2011-07-08 19:04:39,892 DEBUG nova.utils [-] Running cmd (subprocess): sudo qemu-nbd -c /dev/nbd15 /var/lib/nova/instances/instance-00000016/disk from (pid=12900) execute /usr/lib/pymodules/python2.7/nova/utils.py:150\n2011-07-08 19:04:40,919 DEBUG nova.utils [-] Running cmd (subprocess): sudo tune2fs -c 0 -i 0 /dev/nbd15 from (pid=12900) execute /usr/lib/pymodules/python2.7/nova/utils.py:150\n2011-07-08 19:04:40,937 DEBUG nova.utils [-] Result was 1 from (pid=12900) execute /usr/lib/pymodules/python2.7/nova/utils.py:166\n2011-07-08 19:04:40,937 DEBUG nova.utils [-] Running cmd (subprocess): sudo qemu-nbd -d /dev/nbd15 from (pid=12900) execute /usr/lib/pymodules/python2.7/nova/utils.py:150\n2011-07-08 19:04:40,966 WARNING nova.virt.libvirt_conn [-] instance instance-00000016: ignoring error injecting data into image 2 (Unexpected error while running command.\nCommand: sudo tune2fs -c 0 -i 0 /dev/nbd15\nExit code: 1\nStdout: 'tune2fs 1.41.14 (22-Dec-2010)\\n'\nStderr: \"tune2fs: Invalid argument while trying to open /dev/nbd15\\nCouldn't find valid filesystem superblock.\\n\")\n2011-07-08 19:05:12,644 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 120, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt_conn.py\", line 617, in spawn\n(nova.exception): TRACE:     domain = self._create_new_domain(xml)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt_conn.py\", line 1079, in _create_new_domain\n(nova.exception): TRACE:     domain.createWithFlags(launch_flags)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 337, in createWithFlags\n(nova.exception): TRACE:     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n(nova.exception): TRACE: libvirtError: internal error process exited while connecting to monitor: char device redirected to /dev/pts/1\n(nova.exception): TRACE: qemu: could not load kernel '/var/lib/nova/instances/instance-00000016/kernel': Inappropriate ioctl for device\n(nova.exception): TRACE: \n(nova.exception): TRACE: \n2011-07-08 19:05:12,645 ERROR nova.compute.manager [F-XYUG17UL6AY7SUGKS6 nadmin testiki] Instance '22' failed to spawn. Is virtualization enabled in the BIOS?\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 234, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 126, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: internal error process exited while connecting to monitor: char device redirected to /dev/pts/1\n(nova.compute.manager): TRACE: qemu: could not load kernel '/var/lib/nova/instances/instance-00000016/kernel': Inappropriate ioctl for device\n(nova.compute.manager): TRACE: \n(nova.compute.manager): TRACE: \n2011-07-08 19:05:12,821 INFO nova.compute.manager [-] Found instance 'instance-00000016' in DB but no VM. State=5, so setting state to shutoff", 
            "date_created": "2011-07-08 16:05:02.084202+00:00", 
            "author": "https://api.launchpad.net/1.0/~novikov"
        }, 
        {
            "content": "Which version of the python-eventlet package are you actually using ?", 
            "date_created": "2011-07-21 15:38:39.425477+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "python-eventlet       0.9.14-0ubuntu2\n\nfrom apt-repo\ndeb http://ppa.launchpad.net/nova-core/release/ubuntu natty main\n\nHow else can I describe this? :)\nI suppose it is cactus release.\n\nI cannot describe how exactly I`ve got this situation. But mb it was caused by communication of nova services  from cactus(main node) and trunk(nova-compute) releases in one system.\nYou may simply close, sorry for bothering.", 
            "date_created": "2011-07-21 16:16:58.924376+00:00", 
            "author": "https://api.launchpad.net/1.0/~novikov"
        }, 
        {
            "content": "Oh sorry\n\nProbably another subject, but the same nature  - if compute-node somehow halted - the instance (may) remains in /var/lib/nova/instances and moreover in nova-compute.log when trying to terminate said \"Error: trying to destroy already destroyed instance: 38\" (euca-describe-instance says this instance gone)", 
            "date_created": "2011-07-21 18:27:33.681314+00:00", 
            "author": "https://api.launchpad.net/1.0/~novikov"
        }, 
        {
            "content": "For your last question: there may indeed be some sync issues when nova-compute is not running but the host is still running guests. If you care, you can file a new bug with a precise step-by-step procedure to reproduce the behavior. Thanks !", 
            "date_created": "2011-07-22 07:34:16.940291+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ]
}