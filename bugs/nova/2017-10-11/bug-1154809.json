{
    "status": "Fix Released", 
    "last_updated": "2015-11-27 04:17:11.606991+00:00", 
    "description": "Not sure if this is a cinderclient bug or nova.  Attempting to detach a volume via the OSAPI ends with an AmbiguousEndpoints exception:\n\n2013-03-13 17:30:40.314 ERROR nova.api.openstack [req-9dc2a448-c2ed-4db3-be2f-6e1f8971d463 f1a96ff6310042f7b7a9b5acbb634a43 e00a289cba9b45169f054067d7dd74e1] Caught error: AmbiguousEndpoints: [{u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'internal', u'id': u'3b41c544eb24440b89946ab4da3c2524'}, {u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'public', u'id': u'981469fb6b4f4928b1a59783bec445c4'}, {u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'admin', u'id': u'c578676fd1c6404c9a4fddd8daf531a4'}]\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack Traceback (most recent call last):\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 81, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 451, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 895, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     content_type, body, accept)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 955, in _process_stack\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1035, in dispatch\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/volumes.py\", line 452, in delete\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     volume_id=volume_id)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 2332, in detach_volume\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     volume = self.volume_api.get(context, volume_id)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 191, in get\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     self._reraise_translated_volume_exception(volume_id)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 188, in get\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     item = cinderclient(context).volumes.get(volume_id)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 92, in cinderclient\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     endpoint_type=endpoint_type)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/cinderclient/service_catalog.py\", line 85, in url_for\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     endpoints=matching_endpoints)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack AmbiguousEndpoints: AmbiguousEndpoints: [{u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'internal', u'id': u'3b41c544eb24440b89946ab4da3c2524'}, {u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'public', u'id': u'981469fb6b4f4928b1a59783bec445c4'}, {u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'admin', u'id': u'c578676fd1c6404c9a4fddd8daf531a4'}]\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack \n\n\nThe configured keystone services and catalog looks like:\n\nadam@test-01:~$ keystone catalog\nService: compute\n+-------------+-----------------------------------------------------------------------------------+\n|   Property  |                                       Value                                       |\n+-------------+-----------------------------------------------------------------------------------+\n|   adminURL  | http://test-05.os.magners.qa.lexington:8774/v1.1/e00a289cba9b45169f054067d7dd74e1 |\n|      id     |                          10b0009cd95a45d899eee12ce0bb1253                         |\n| internalURL | http://test-05.os.magners.qa.lexington:8774/v1.1/e00a289cba9b45169f054067d7dd74e1 |\n|  publicURL  | http://test-05.os.magners.qa.lexington:8774/v1.1/e00a289cba9b45169f054067d7dd74e1 |\n|    region   |                                     RegionOne                                     |\n+-------------+-----------------------------------------------------------------------------------+\nService: s3\n+-------------+---------------------------------------------+\n|   Property  |                    Value                    |\n+-------------+---------------------------------------------+\n|   adminURL  | http://test-05.os.magners.qa.lexington:3333 |\n|      id     |       519b3206ab584bbaa5e0166eaac2bea5      |\n| internalURL | http://test-05.os.magners.qa.lexington:3333 |\n|  publicURL  | http://test-05.os.magners.qa.lexington:3333 |\n|    region   |                  RegionOne                  |\n+-------------+---------------------------------------------+\nService: image\n+-------------+------------------------------------------------+\n|   Property  |                     Value                      |\n+-------------+------------------------------------------------+\n|   adminURL  | http://test-11.os.magners.qa.lexington:9292/v1 |\n|      id     |        5c870d37fdba4cf58b43a53f291b8e59        |\n| internalURL | http://test-11.os.magners.qa.lexington:9292/v1 |\n|  publicURL  | http://test-11.os.magners.qa.lexington:9292/v1 |\n|    region   |                   RegionOne                    |\n+-------------+------------------------------------------------+\nService: volume\n+-------------+---------------------------------------------------------------------------------+\n|   Property  |                                      Value                                      |\n+-------------+---------------------------------------------------------------------------------+\n|   adminURL  | http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1 |\n|      id     |                         3b41c544eb24440b89946ab4da3c2524                        |\n| internalURL | http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1 |\n|  publicURL  | http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1 |\n|    region   |                                    RegionOne                                    |\n+-------------+---------------------------------------------------------------------------------+\nService: ec2\n+-------------+------------------------------------------------------------+\n|   Property  |                           Value                            |\n+-------------+------------------------------------------------------------+\n|   adminURL  | http://test-05.os.magners.qa.lexington:8773/services/Cloud |\n|      id     |              5dc0b588166f496a9f7e38343cea582b              |\n| internalURL | http://test-05.os.magners.qa.lexington:8773/services/Cloud |\n|  publicURL  | http://test-05.os.magners.qa.lexington:8773/services/Cloud |\n|    region   |                         RegionOne                          |\n+-------------+------------------------------------------------------------+\nService: identity\n+-------------+---------------------------------------------------+\n|   Property  |                       Value                       |\n+-------------+---------------------------------------------------+\n|   adminURL  | http://test-02.os.magners.qa.lexington:35357/v2.0 |\n|      id     |          2469befa176047e9a2307b590bd49016         |\n| internalURL |  http://test-02.os.magners.qa.lexington:5000/v2.0 |\n|  publicURL  |  http://test-02.os.magners.qa.lexington:5000/v2.0 |\n|    region   |                     RegionOne                     |\n+-------------+---------------------------------------------------+\nadam@test-01:~$ keystone service-list\n+----------------------------------+----------+----------+----------------------------+\n|                id                |   name   |   type   |        description         |\n+----------------------------------+----------+----------+----------------------------+\n| 1a803d81a1754abc9d1b4f9f806b8343 |  cinder  |  volume  |   Cinder Volume Service    |\n| 30c39e60f05244bbb5a648e8d4f5b365 |   ec2    |   ec2    |  EC2 Compatibility Layer   |\n| 57e567fc7af5404ba2a9e2643cd1b35a | keystone | identity | Keystone Identity Service  |\n| 7ad8e13d1cc24473a011bdc2fa6e227e |  glance  |  image   |    Glance Image Service    |\n| 863bb1c4ce364858a9eaffa006ed9a44 |   nova   | compute  |    Nova Compute Service    |\n| a89a355e152e48e49a46ee592110d241 |    s3    |    s3    | S3 Compatible object-store |\n+----------------------------------+----------+----------+----------------------------+\nadam@test-01:~$", 
    "tags": [], 
    "importance": "Critical", 
    "heat": 52, 
    "link": "https://bugs.launchpad.net/nova/+bug/1154809", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 1154809, 
    "index": 120, 
    "created": "2013-03-13 21:35:50.992126+00:00", 
    "title": "Volume detach fails via OSAPI: AmbiguousEndpoints", 
    "comments": [
        {
            "content": "Not sure if this is a cinderclient bug or nova.  Attempting to detach a volume via the OSAPI ends with an AmbiguousEndpoints exception:\n\n2013-03-13 17:30:40.314 ERROR nova.api.openstack [req-9dc2a448-c2ed-4db3-be2f-6e1f8971d463 f1a96ff6310042f7b7a9b5acbb634a43 e00a289cba9b45169f054067d7dd74e1] Caught error: AmbiguousEndpoints: [{u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'internal', u'id': u'3b41c544eb24440b89946ab4da3c2524'}, {u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'public', u'id': u'981469fb6b4f4928b1a59783bec445c4'}, {u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'admin', u'id': u'c578676fd1c6404c9a4fddd8daf531a4'}]\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack Traceback (most recent call last):\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 81, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 451, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 895, in __call__\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     content_type, body, accept)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 955, in _process_stack\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1035, in dispatch\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/volumes.py\", line 452, in delete\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     volume_id=volume_id)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 2332, in detach_volume\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     volume = self.volume_api.get(context, volume_id)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 191, in get\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     self._reraise_translated_volume_exception(volume_id)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 188, in get\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     item = cinderclient(context).volumes.get(volume_id)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 92, in cinderclient\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     endpoint_type=endpoint_type)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/cinderclient/service_catalog.py\", line 85, in url_for\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack     endpoints=matching_endpoints)\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack AmbiguousEndpoints: AmbiguousEndpoints: [{u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'internal', u'id': u'3b41c544eb24440b89946ab4da3c2524'}, {u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'public', u'id': u'981469fb6b4f4928b1a59783bec445c4'}, {u'url': u'http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1', u'region': u'RegionOne', u'legacy_endpoint_id': u'8012ff386ffa4955b3eab965a4826b0e', 'serviceName': None, u'interface': u'admin', u'id': u'c578676fd1c6404c9a4fddd8daf531a4'}]\n2013-03-13 17:30:40.314 8945 TRACE nova.api.openstack \n\n\nThe configured keystone services and catalog looks like:\n\nadam@test-01:~$ keystone catalog\nService: compute\n+-------------+-----------------------------------------------------------------------------------+\n|   Property  |                                       Value                                       |\n+-------------+-----------------------------------------------------------------------------------+\n|   adminURL  | http://test-05.os.magners.qa.lexington:8774/v1.1/e00a289cba9b45169f054067d7dd74e1 |\n|      id     |                          10b0009cd95a45d899eee12ce0bb1253                         |\n| internalURL | http://test-05.os.magners.qa.lexington:8774/v1.1/e00a289cba9b45169f054067d7dd74e1 |\n|  publicURL  | http://test-05.os.magners.qa.lexington:8774/v1.1/e00a289cba9b45169f054067d7dd74e1 |\n|    region   |                                     RegionOne                                     |\n+-------------+-----------------------------------------------------------------------------------+\nService: s3\n+-------------+---------------------------------------------+\n|   Property  |                    Value                    |\n+-------------+---------------------------------------------+\n|   adminURL  | http://test-05.os.magners.qa.lexington:3333 |\n|      id     |       519b3206ab584bbaa5e0166eaac2bea5      |\n| internalURL | http://test-05.os.magners.qa.lexington:3333 |\n|  publicURL  | http://test-05.os.magners.qa.lexington:3333 |\n|    region   |                  RegionOne                  |\n+-------------+---------------------------------------------+\nService: image\n+-------------+------------------------------------------------+\n|   Property  |                     Value                      |\n+-------------+------------------------------------------------+\n|   adminURL  | http://test-11.os.magners.qa.lexington:9292/v1 |\n|      id     |        5c870d37fdba4cf58b43a53f291b8e59        |\n| internalURL | http://test-11.os.magners.qa.lexington:9292/v1 |\n|  publicURL  | http://test-11.os.magners.qa.lexington:9292/v1 |\n|    region   |                   RegionOne                    |\n+-------------+------------------------------------------------+\nService: volume\n+-------------+---------------------------------------------------------------------------------+\n|   Property  |                                      Value                                      |\n+-------------+---------------------------------------------------------------------------------+\n|   adminURL  | http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1 |\n|      id     |                         3b41c544eb24440b89946ab4da3c2524                        |\n| internalURL | http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1 |\n|  publicURL  | http://test-07.os.magners.qa.lexington:8776/v1/e00a289cba9b45169f054067d7dd74e1 |\n|    region   |                                    RegionOne                                    |\n+-------------+---------------------------------------------------------------------------------+\nService: ec2\n+-------------+------------------------------------------------------------+\n|   Property  |                           Value                            |\n+-------------+------------------------------------------------------------+\n|   adminURL  | http://test-05.os.magners.qa.lexington:8773/services/Cloud |\n|      id     |              5dc0b588166f496a9f7e38343cea582b              |\n| internalURL | http://test-05.os.magners.qa.lexington:8773/services/Cloud |\n|  publicURL  | http://test-05.os.magners.qa.lexington:8773/services/Cloud |\n|    region   |                         RegionOne                          |\n+-------------+------------------------------------------------------------+\nService: identity\n+-------------+---------------------------------------------------+\n|   Property  |                       Value                       |\n+-------------+---------------------------------------------------+\n|   adminURL  | http://test-02.os.magners.qa.lexington:35357/v2.0 |\n|      id     |          2469befa176047e9a2307b590bd49016         |\n| internalURL |  http://test-02.os.magners.qa.lexington:5000/v2.0 |\n|  publicURL  |  http://test-02.os.magners.qa.lexington:5000/v2.0 |\n|    region   |                     RegionOne                     |\n+-------------+---------------------------------------------------+\nadam@test-01:~$ keystone service-list\n+----------------------------------+----------+----------+----------------------------+\n|                id                |   name   |   type   |        description         |\n+----------------------------------+----------+----------+----------------------------+\n| 1a803d81a1754abc9d1b4f9f806b8343 |  cinder  |  volume  |   Cinder Volume Service    |\n| 30c39e60f05244bbb5a648e8d4f5b365 |   ec2    |   ec2    |  EC2 Compatibility Layer   |\n| 57e567fc7af5404ba2a9e2643cd1b35a | keystone | identity | Keystone Identity Service  |\n| 7ad8e13d1cc24473a011bdc2fa6e227e |  glance  |  image   |    Glance Image Service    |\n| 863bb1c4ce364858a9eaffa006ed9a44 |   nova   | compute  |    Nova Compute Service    |\n| a89a355e152e48e49a46ee592110d241 |    s3    |    s3    | S3 Compatible object-store |\n+----------------------------------+----------+----------+----------------------------+\nadam@test-01:~$", 
            "date_created": "2013-03-13 21:35:50.992126+00:00", 
            "author": "https://api.launchpad.net/1.0/~gandelman-a"
        }, 
        {
            "content": "I see the same when trying to attach volumes", 
            "date_created": "2013-03-13 21:42:36.975930+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "Added keystone because it doesn't look like the service name attribute should be null here.", 
            "date_created": "2013-03-13 23:16:19.210822+00:00", 
            "author": "https://api.launchpad.net/1.0/~dolph"
        }, 
        {
            "content": "I can't reproduce this in devstack, but this seems to be an issue with auth_token middleware trying to use v3 api and getting an incompatible catalog.\n\nCan you try setting:\n\nauth_version = v2.0\n\nin the\n\n[filter:authtoken]\n\nsection of /etc/nova/api-paste.ini\n\nto see if that fixes it ?", 
            "date_created": "2013-03-13 23:17:48.636651+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "It also occurs to me that v3 pki tokens will not work at all since the catalog will be in the wrong format in the token. We may need a fix in nova to do some translation of the service catalog to make that work.", 
            "date_created": "2013-03-13 23:18:48.445600+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Configuring v2.0 auth_version fixes the issue here, for both UUID + PKI token_formats.  Thanks, Vish.", 
            "date_created": "2013-03-13 23:41:59.793015+00:00", 
            "author": "https://api.launchpad.net/1.0/~gandelman-a"
        }, 
        {
            "content": "This is an incompatiblilty between v2 and v3 service catalogs. This only happens with UUID tokens currently.\n\nNova gets the service catalog from auth_token middleware and then passes that to cinderclient. The problem breaks down as follows:\n\nUsing PKI:\n\nnovaclient still uses v2.0 so it gets a v2.0 pki token. The auth_token middleware simply extracts the catalog from the token and passes it along. The catalog is in v2.0 format\n\nUsing uuid:\nnovaclient uses v2.0 and gets a v2.0 uuid token. The auth_token middleware uses the most recent (v3.0) api to validate the token so it gives back a v3.0 catalog. This catalog is then passed in to cinderclient which blows up.\n\nSo clearly cinderclient need to support parsing the new catalog, but in the meantime we can get around this issue by forcing nova to use the v2.0 api Unfortunately if people start sending in v3 PKI tokens we will see a similar issue, so we really need either:\n\na) something that can translate v3-v2 catalogs in nova or b) an updated cinderclient that can understand v3 catalogs.", 
            "date_created": "2013-03-13 23:44:32.644036+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/24386", 
            "date_created": "2013-03-13 23:49:55.866970+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/24386\nCommitted: http://github.com/openstack/nova/commit/4bf35503c21a2f54474634f0de4b19489384d56f\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4bf35503c21a2f54474634f0de4b19489384d56f\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Wed Mar 13 16:48:33 2013 -0700\n\n    Force nova to use keystone v2.0 for auth_token\n    \n    This is a workaround for bug 1154809 until cinderclient supports\n    v3 service catalogs or we have some workaround in place.\n    \n    Change-Id: I832ef1735579b240a367c051c44f97b1619f8d3d\n", 
            "date_created": "2013-03-14 02:05:11.654340+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Continuing vish's line of thought... keystoneclient is working towards exposing the catalog through a python API (c.service_catalog) rather than as a raw dict, so that other clients can utilize the catalog without having to understand it's HTTP format. Attached this bug to keystoneclient as I want to make sure that we have test coverage for the use case presented here.", 
            "date_created": "2013-06-10 17:33:39.783000+00:00", 
            "author": "https://api.launchpad.net/1.0/~dolph"
        }, 
        {
            "content": "My two cents: all python bindings should rely on python-keystoneclient for obtaining token and url from catalogue, rather than duplicating the logic to get a token and parse the catalogue, like cinder and nova client do. This will make it easier in future to support new version of the identity API.", 
            "date_created": "2014-02-16 21:47:33.571380+00:00", 
            "author": "https://api.launchpad.net/1.0/~andrea-frittoli"
        }, 
        {
            "content": "\"\"\"\nsetting:\nauth_version = v2.0\nin the\n[filter:authtoken]\nsection of /etc/nova/api-paste.ini\n\"\"\"\ndoes it just work in UUID token_formats? I don't think so, because for PKI,  \"auth_version\" seems not used(self.verify_signed_token called).  \nAgree to Andrea.", 
            "date_created": "2014-02-17 12:36:17.816529+00:00", 
            "author": "https://api.launchpad.net/1.0/~lvhancy"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/80563", 
            "date_created": "2014-03-14 13:25:21.848676+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I am also hitting this. Two workarounds worked for me (Icehouse, Keystone v2) :\nEither set auth_version = v2.0\n!Or! set auth_port = 5000\n\n", 
            "date_created": "2014-05-22 15:20:50.574954+00:00", 
            "author": "https://api.launchpad.net/1.0/~jordan-pittier"
        }, 
        {
            "content": "I think this patch would allow novaclient to work with keystone v3:\r\n\r\nhttps://review.openstack.org/#/c/85920/", 
            "date_created": "2014-06-04 22:26:32.162786+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }, 
        {
            "content": "I'm trying to get the dashboard working with multi-domains with IceHouse. Basically it looks like the same sort of thing - see this post https://ask.openstack.org/en/question/45872/icehouse-dashboard-problems-using-multi-domain-support/. It seems to authenticate with a domain-scoped token, but when it tries to query nova for resources I get a 401. I've tried explicitly setting auth_version = v2.0 in nova.conf to no avail... Is this related, or something else?", 
            "date_created": "2014-08-25 22:11:56.076203+00:00", 
            "author": "https://api.launchpad.net/1.0/~edward-chapin"
        }, 
        {
            "content": "Change abandoned by Mike Perez (<email address hidden>) on branch: master\nReview: https://review.openstack.org/80563", 
            "date_created": "2014-11-25 01:03:04.794195+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I think this has been fixed by:\r\n\r\nhttps://review.openstack.org/#/c/85920/\r\nhttps://review.openstack.org/#/c/105900/\r\n\r\nI tested in devstack by:\r\n\r\nOS_PROJECT_DOMAIN_ID=default\r\nOS_REGION_NAME=RegionOne\r\nOS_USER_DOMAIN_ID=default\r\nOS_IDENTITY_API_VERSION=3.0\r\nOS_AUTH_URL=http://10.0.2.15:5000/v3\r\nOS_USERNAME=demo\r\nOS_TENANT_NAME=demo\r\n\r\n$ nova boot --image cirros-0.3.2-x86_64-uec --flavor  m1.tiny --poll test\r\n$ cinder create 4\r\n$ nova volume-attach 6af88e0d-e208-4364-8881-c8b2e4166292 7fbaa508-adb7-4357-a9e4-7cb656b2e5c1 /dev/vdb", 
            "date_created": "2014-12-02 20:20:20.324669+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }, 
        {
            "content": "I don't believe this is an issue with Cinder anymore. If it is, please reopen.", 
            "date_created": "2015-10-18 16:50:36.598732+00:00", 
            "author": "https://api.launchpad.net/1.0/~sean-mcginnis"
        }, 
        {
            "content": "finding the service catalog through python bindings is available now, following sean's comment i don't believe this is an issue any longer. if it is, please re-open", 
            "date_created": "2015-11-27 04:17:01.010619+00:00", 
            "author": "https://api.launchpad.net/1.0/~stevemar"
        }
    ]
}