{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:22:37.393515+00:00", 
    "description": "http://logs.openstack.org/02/153902/2/gate/gate-devstack-dsvm-cells/14ce82b/console.html#_2015-02-10_04_21_33_685\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiZGV2c3RhY2svZXhlcmNpc2VzL3ZvbHVtZXMuc2hcIiBBTkQgbWVzc2FnZTpcIlNlcnZlciBleC12b2wtaW5zdCBub3QgZGVsZXRlZFwiIEFORCB0YWdzOlwiY29uc29sZVwiIiwiZmllbGRzIjpbXSwib2Zmc2V0IjowLCJ0aW1lZnJhbWUiOiI2MDQ4MDAiLCJncmFwaG1vZGUiOiJjb3VudCIsInRpbWUiOnsidXNlcl9pbnRlcnZhbCI6MH0sInN0YW1wIjoxNDIzNTc5NDY1MDQ0fQ==\n\n6 hits in 7 days, check and gate, all failures.", 
    "tags": [
        "cells", 
        "libvirt", 
        "pci", 
        "unified-objects"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1420322", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1420322, 
    "index": 4147, 
    "created": "2015-02-10 14:47:05.700033+00:00", 
    "title": "gate-devstack-dsvm-cells fails in volumes exercise with 'Server ex-vol-inst not deleted'", 
    "comments": [
        {
            "content": "http://logs.openstack.org/02/153902/2/gate/gate-devstack-dsvm-cells/14ce82b/console.html#_2015-02-10_04_21_33_685\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiZGV2c3RhY2svZXhlcmNpc2VzL3ZvbHVtZXMuc2hcIiBBTkQgbWVzc2FnZTpcIlNlcnZlciBleC12b2wtaW5zdCBub3QgZGVsZXRlZFwiIEFORCB0YWdzOlwiY29uc29sZVwiIiwiZmllbGRzIjpbXSwib2Zmc2V0IjowLCJ0aW1lZnJhbWUiOiI2MDQ4MDAiLCJncmFwaG1vZGUiOiJjb3VudCIsInRpbWUiOnsidXNlcl9pbnRlcnZhbCI6MH0sInN0YW1wIjoxNDIzNTc5NDY1MDQ0fQ==\n\n6 hits in 7 days, check and gate, all failures.", 
            "date_created": "2015-02-10 14:47:05.700033+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "It first tries to delete here:\n\nhttp://logs.openstack.org/02/153902/2/gate/gate-devstack-dsvm-cells/14ce82b/console.html#_2015-02-10_04_18_50_557\n\nThis is the instance uuid: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb", 
            "date_created": "2015-02-10 14:49:57.248316+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Looks like the exercise is first trying to delete the instance, which doesn't exist, then does a loop doing nova show on the instance until it's gone (times out at 90 seconds).\n\nThen it boots the instance:\n\nhttp://logs.openstack.org/02/153902/2/gate/gate-devstack-dsvm-cells/14ce82b/console.html#_2015-02-10_04_18_52_638\n\nThen it loops for about a minute waiting for the instance to be ACTIVE.\n\nThen the test creates a volume and then tries to attach the volume to the instance.  The volume attach completes in 12 seconds.\n\nThen detaches the volume (that takes 6 seconds).  Deletes the volume in 4 seconds.  Then it loops for a minute waiting for the server to delete and times out.\n\nThe delete starts at:\n\nhttp://logs.openstack.org/02/153902/2/gate/gate-devstack-dsvm-cells/14ce82b/console.html#_2015-02-10_04_20_32_450\n\nAnd times out at:\n\nhttp://logs.openstack.org/02/153902/2/gate/gate-devstack-dsvm-cells/14ce82b/console.html#_2015-02-10_04_21_33_683\n\nAfter the delete request, I see this error in the n-cpu logs:\n\nhttp://logs.openstack.org/02/153902/2/gate/gate-devstack-dsvm-cells/14ce82b/logs/screen-n-cpu.txt.gz#_2015-02-10_04_20_36_663\n\n2015-02-10 04:20:36.663 ERROR nova.compute.manager [req-d2130958-4f41-4c39-9794-55c249ced5b5 demo demo] [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb] Setting instance vm_state to ERROR\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb] Traceback (most recent call last):\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2585, in do_terminate_instance\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     self._delete_instance(context, instance, bdms, quotas)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/hooks.py\", line 149, in inner\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     rv = f(*args, **kwargs)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2554, in _delete_instance\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     quotas.rollback()\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     six.reraise(self.type_, self.value, self.tb)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2530, in _delete_instance\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     self._shutdown_instance(context, instance, bdms)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2461, in _shutdown_instance\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     requested_networks)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     six.reraise(self.type_, self.value, self.tb)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2450, in _shutdown_instance\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     block_device_info)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 706, in destroy\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     destroy_disks, migrate_data)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 826, in cleanup\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     self._delete_instance_files(instance)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 6236, in _delete_instance_files\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     inst_obj.save()\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/objects/base.py\", line 191, in wrapper\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     ctxt, self, fn.__name__, args, kwargs)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/opt/stack/new/nova/nova/conductor/rpcapi.py\", line 370, in object_action\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     objmethod=objmethod, args=args, kwargs=kwargs)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     retry=self.retry)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     timeout=timeout, retry=retry)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 417, in send\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     retry=retry)\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 408, in _send\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb]     raise result\n2015-02-10 04:20:36.663 18842 TRACE nova.compute.manager [instance: d76c4dc3-4fbb-45f0-a62a-24f6d470d8fb] RemoteError: Remote error: DetachedInstanceError Parent instance <InstanceExtra at 0x7f65d57a1090> is not bound to a Session; deferred load operation of attribute 'pci_requests' cannot proceed", 
            "date_created": "2015-02-10 14:58:56.917957+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "e-r query: https://review.openstack.org/#/c/154508/", 
            "date_created": "2015-02-10 15:08:09.655865+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/154566", 
            "date_created": "2015-02-10 17:05:54.623685+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/154567", 
            "date_created": "2015-02-10 17:06:07.891358+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/154566\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=0ff69b5660a22463915429911cc4cea53882f9db\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0ff69b5660a22463915429911cc4cea53882f9db\nAuthor: Matt Riedemann <email address hidden>\nDate:   Tue Feb 10 07:23:39 2015 -0800\n\n    Use dot notation on instance object fields in _delete_instance\n    \n    The _delete_instance method is getting object parameters now so update\n    the docstring to specify the types on the formal parameters and also\n    access the instance.vm_state field using dot notation.\n    \n    Related-Bug: #1420322\n    \n    Change-Id: Iecaabeba4181983d2b6dca9de6521408d5384c24\n", 
            "date_created": "2015-02-12 21:21:50.294406+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/154567\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9dafd17c8208a507d97c5aa3ca9f22062b521f07\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9dafd17c8208a507d97c5aa3ca9f22062b521f07\nAuthor: Matt Riedemann <email address hidden>\nDate:   Tue Feb 10 08:20:14 2015 -0800\n\n    libvirt: remove _destroy_instance_files shim\n    \n    The instance parameter passed to _destroy_instance_files is a nova\n    object now so we can remove the shim and todo and move that code up to\n    the cleanup method. A note is added to clarify the usage of the\n    'clean_attempts' system_metadata.\n    \n    The cleanup method is called by destroy and _create_domain_and_network\n    which are also getting an instance object.\n    \n    Also changes one remaining place in _create_domain_and_network where the\n    instance.uuid field was accessed like a dict (changed to use dot\n    notation to re-enforce that it's an object).\n    \n    Partial-Bug: #1420322\n    \n    Change-Id: Ia4d204df233fd40a9008e6cc010446c62e18a3b9\n", 
            "date_created": "2015-02-13 03:52:39.220469+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "https://review.openstack.org/#/c/155659/", 
            "date_created": "2015-02-18 22:08:49.284446+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }
    ]
}