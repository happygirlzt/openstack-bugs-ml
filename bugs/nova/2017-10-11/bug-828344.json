{
    "status": "Invalid", 
    "last_updated": "2011-10-21 13:07:52.867551+00:00", 
    "description": "A user of mine uploaded a bundled image which failed decryption. When the user (or an admin user) tries to list the available images using 'euca-describe-images' an 'UnknownError' is returned instead of the image listing.\n\nIf I list the image using the 'glance' tool, I can see the status correctly. Once I update the image's 'Location', the instance can be listed.\n\nWhat I expect:\n\nAll images, including the failed image, should be listed.\n\nWhat I see:\n\nAn 'UnknownError' is returned instead of the image listing.\n\n= Displaying the image using euca-describe-images =\n\n$ euca-describe-images ami-00000042\nUnknownError: An unknown error has occurred. Please try your request again.\n\n$ euca-describe-images \nUnknownError: An unknown error has occurred. Please try your request again.\n\n= Displaying the image using glance =\n\n$ glance show 66\nURI: http://0.0.0.0/images/66\nId: 66\nPublic: No\nName: None\nStatus: queued\nSize: 0\nLocation: None\nDisk format: ami\nContainer format: ami\nProperty 'image_location': testing/image.manifest.xml\nProperty 'image_state': failed_decrypt\nProperty 'mappings': [{'device': 'sda1', 'virtual': 'ami'}, {'device': '/dev/sda1', 'virtual': 'root'}, {'device': 'sda2', 'virtual': 'ephemeral0'}, {'device': 'sda3', 'virtual': 'swap'}]\nProperty 'kernel_id': 1\nProperty 'architecture': x86_64\nProperty 'project_id': user_project\n\n= nova-api log =\n\n2011-08-17 18:22:11,511 AUDIT nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] Authenticated Request For admin:admin_project)\n2011-08-17 18:22:11,512 DEBUG nova.api [-] action: DescribeImages from (pid=31632) __call__ /usr/lib/pymodules/python2.7/nova/api/ec2/__init__.py:214\n2011-08-17 18:22:11,512 DEBUG nova.api [-] arg: Owner.1         val: self from (pid=31632) __call__ /usr/lib/pymodules/python2.7/nova/api/ec2/__init__.py:216\n2011-08-17 18:22:11,561 ERROR nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] Unexpected error raised: string indices must be integers\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/__init__.py\", line 323, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/apirequest.py\", line 78, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/cloud.py\", line 1343, in describe_images\n(nova.api): TRACE:     images = [self._format_image(i) for i in images]\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/cloud.py\", line 1317, in _format_image\n(nova.api): TRACE:     root_device_name = ec2utils.properties_root_device_name(properties)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/ec2utils.py\", line 148, in properties_root_device_name\n(nova.api): TRACE:     if bdm['virtual'] == 'root':\n(nova.api): TRACE: TypeError: string indices must be integers\n(nova.api): TRACE: \n2011-08-17 18:22:11,561 ERROR nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] Environment: {\"HTTP_AUTHORIZATION\": \"AWS XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:admin_project:XXXXXXXXXXXXXXXXXXXXXXXXXXX=\", \"CONTENT_TYPE\": \"text/plain\", \"SCRIPT_NAME\": \"/services/Cloud\", \"HTTP_DATE\": \"Wed, 17 Aug 2011 17:22:11 GMT\", \"REQUEST_METHOD\": \"GET\", \"HTTP_HOST\": \"172.16.16.65:8773\", \"PATH_INFO\": \"/\", \"SERVER_PROTOCOL\": \"HTTP/1.0\", \"QUERY_STRING\": \"AWSAccessKeyId=XXXXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXX%3Aadmin_project&Action=DescribeImages&Owner.1=self&SignatureMethod=HmacSHA256&SignatureVersion=2&Timestamp=2011-08-17T17%3A22%3A11&Version=2009-11-30&Signature=XXXXXXXXXXXXXXXXXXXXXXXXXXXXX%3D\", \"CONTENT_LENGTH\": \"0\", \"HTTP_USER_AGENT\": \"Boto/1.9b (linux2)\", \"SERVER_NAME\": \"172.16.16.65\", \"REMOTE_ADDR\": \"10.10.27.71\", \"wsgi.url_scheme\": \"http\", \"SERVER_PORT\": \"8773\", \"GATEWAY_INTERFACE\": \"CGI/1.1\", \"HTTP_ACCEPT_ENCODING\": \"identity\"}\n2011-08-17 18:22:11,562 ERROR nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] UnknownError: An unknown error has occurred. Please try your request again.\n2011-08-17 18:22:11,562 INFO nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] 0.63897s 10.10.27.71 GET /services/Cloud/ CloudController:DescribeImages 400 [Boto/1.9b (linux2)] text/plain text/xml\n\n= Update the image =\n\n$ glance update 66 location=file:///var/lib/glance/images/66\nUpdated image 66\n\n= Display the image again =\n\n$ euca-describe-images ami-00000042\nIMAGE   ami-00000042                    queued  private                 machine           instance-store", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/828344", 
    "owner": "None", 
    "id": 828344, 
    "index": 2247, 
    "created": "2011-08-17 20:47:22.116271+00:00", 
    "title": "euca-describe-images returns an UnknownError when an image fails to decrypt", 
    "comments": [
        {
            "content": "A user of mine uploaded a bundled image which failed decryption. When the user (or an admin user) tries to list the available images using 'euca-describe-images' an 'UnknownError' is returned instead of the image listing.\n\nIf I list the image using the 'glance' tool, I can see the status correctly. Once I update the image's 'Location', the instance can be listed.\n\nWhat I expect:\n\nAll images, including the failed image, should be listed.\n\nWhat I see:\n\nAn 'UnknownError' is returned instead of the image listing.\n\n= Displaying the image using euca-describe-images =\n\n$ euca-describe-images ami-00000042\nUnknownError: An unknown error has occurred. Please try your request again.\n\n$ euca-describe-images \nUnknownError: An unknown error has occurred. Please try your request again.\n\n= Displaying the image using glance =\n\n$ glance show 66\nURI: http://0.0.0.0/images/66\nId: 66\nPublic: No\nName: None\nStatus: queued\nSize: 0\nLocation: None\nDisk format: ami\nContainer format: ami\nProperty 'image_location': testing/image.manifest.xml\nProperty 'image_state': failed_decrypt\nProperty 'mappings': [{'device': 'sda1', 'virtual': 'ami'}, {'device': '/dev/sda1', 'virtual': 'root'}, {'device': 'sda2', 'virtual': 'ephemeral0'}, {'device': 'sda3', 'virtual': 'swap'}]\nProperty 'kernel_id': 1\nProperty 'architecture': x86_64\nProperty 'project_id': user_project\n\n= nova-api log =\n\n2011-08-17 18:22:11,511 AUDIT nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] Authenticated Request For admin:admin_project)\n2011-08-17 18:22:11,512 DEBUG nova.api [-] action: DescribeImages from (pid=31632) __call__ /usr/lib/pymodules/python2.7/nova/api/ec2/__init__.py:214\n2011-08-17 18:22:11,512 DEBUG nova.api [-] arg: Owner.1         val: self from (pid=31632) __call__ /usr/lib/pymodules/python2.7/nova/api/ec2/__init__.py:216\n2011-08-17 18:22:11,561 ERROR nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] Unexpected error raised: string indices must be integers\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/__init__.py\", line 323, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/apirequest.py\", line 78, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/cloud.py\", line 1343, in describe_images\n(nova.api): TRACE:     images = [self._format_image(i) for i in images]\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/cloud.py\", line 1317, in _format_image\n(nova.api): TRACE:     root_device_name = ec2utils.properties_root_device_name(properties)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/api/ec2/ec2utils.py\", line 148, in properties_root_device_name\n(nova.api): TRACE:     if bdm['virtual'] == 'root':\n(nova.api): TRACE: TypeError: string indices must be integers\n(nova.api): TRACE: \n2011-08-17 18:22:11,561 ERROR nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] Environment: {\"HTTP_AUTHORIZATION\": \"AWS XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:admin_project:XXXXXXXXXXXXXXXXXXXXXXXXXXX=\", \"CONTENT_TYPE\": \"text/plain\", \"SCRIPT_NAME\": \"/services/Cloud\", \"HTTP_DATE\": \"Wed, 17 Aug 2011 17:22:11 GMT\", \"REQUEST_METHOD\": \"GET\", \"HTTP_HOST\": \"172.16.16.65:8773\", \"PATH_INFO\": \"/\", \"SERVER_PROTOCOL\": \"HTTP/1.0\", \"QUERY_STRING\": \"AWSAccessKeyId=XXXXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXX%3Aadmin_project&Action=DescribeImages&Owner.1=self&SignatureMethod=HmacSHA256&SignatureVersion=2&Timestamp=2011-08-17T17%3A22%3A11&Version=2009-11-30&Signature=XXXXXXXXXXXXXXXXXXXXXXXXXXXXX%3D\", \"CONTENT_LENGTH\": \"0\", \"HTTP_USER_AGENT\": \"Boto/1.9b (linux2)\", \"SERVER_NAME\": \"172.16.16.65\", \"REMOTE_ADDR\": \"10.10.27.71\", \"wsgi.url_scheme\": \"http\", \"SERVER_PORT\": \"8773\", \"GATEWAY_INTERFACE\": \"CGI/1.1\", \"HTTP_ACCEPT_ENCODING\": \"identity\"}\n2011-08-17 18:22:11,562 ERROR nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] UnknownError: An unknown error has occurred. Please try your request again.\n2011-08-17 18:22:11,562 INFO nova.api [XXXXXXXXXXXXXXXXXXXX admin admin_project] 0.63897s 10.10.27.71 GET /services/Cloud/ CloudController:DescribeImages 400 [Boto/1.9b (linux2)] text/plain text/xml\n\n= Update the image =\n\n$ glance update 66 location=file:///var/lib/glance/images/66\nUpdated image 66\n\n= Display the image again =\n\n$ euca-describe-images ami-00000042\nIMAGE   ami-00000042                    queued  private                 machine           instance-store", 
            "date_created": "2011-08-17 20:47:22.116271+00:00", 
            "author": "https://api.launchpad.net/1.0/~aglenyoung"
        }, 
        {
            "content": "Which nova version are you using? I'm afraid you're using d-3 release verison.\r\nIt's because of moving to glance.\r\nIf so it is fixed by rev 1400.", 
            "date_created": "2011-08-19 01:40:13.832186+00:00", 
            "author": "https://api.launchpad.net/1.0/~yamahata"
        }, 
        {
            "content": "Unfortunately, upgrading nova version doesn't fix it.\r\nYou have to deleing the image and re-register it again.\r\nSorry for inconvinience.", 
            "date_created": "2011-08-19 01:44:43.860410+00:00", 
            "author": "https://api.launchpad.net/1.0/~yamahata"
        }, 
        {
            "content": "Andrew, please confirm if this solves it for you.", 
            "date_created": "2011-08-19 09:10:00.766096+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Closing -- please reopen if above solution is not solving the issue for you.", 
            "date_created": "2011-10-21 13:07:51.446213+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ]
}