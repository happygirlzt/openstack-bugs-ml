{
    "status": "Invalid", 
    "last_updated": "2014-09-03 20:56:30.721111+00:00", 
    "description": "Doing a fresh install from http://docs.openstack.org/trunk/install-guide/install/apt/content/index.html  Running Ubuntu 12.04.4 LTS + cloud-archive:havana PPA as per guide.  The only variation from the guide is that I have setup a RBD store for Glance.\n\nHere are the package versions:\n# dpkg -l | grep nova\nii  nova-ajax-console-proxy          1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - AJAX console proxy - transitional package\nii  nova-api                         1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - API frontend\nii  nova-cert                        1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - certificate management\nii  nova-common                      1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - common files\nii  nova-compute                     1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - compute node\nii  nova-compute-kvm                 1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - compute node (KVM)\nii  nova-conductor                   1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - conductor service\nii  nova-consoleauth                 1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - Console Authenticator\nii  nova-doc                         1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - documentation\nii  nova-network                     1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - Network manager\nii  nova-novncproxy                  1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - NoVNC proxy\nii  nova-scheduler                   1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - virtual machine scheduler\nii  python-nova                      1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute Python libraries\nii  python-novaclient                1:2.15.0-0ubuntu1~cloud0                            client library for OpenStack Compute API\n\nEverything is smooth up to setting up nova-compute.  Other nova services seem to be working correctly, but when I got to deploying the first image the instance didn't start.  I am attaching the nova-compute.log file.  The nova-compute process crashes immediately when you attempt to start it.\n\nAccording to the errors it appears that there is a missing field (metrics) in the compute_nodes table.  The error doesn't mention it, but the table also appears to be missing the extra_resources column as well.\n\nHere is what my MySQL says the schema is for compute_nodes\nCREATE TABLE `compute_nodes` (\n  `created_at` datetime DEFAULT NULL,\n  `updated_at` datetime DEFAULT NULL,\n  `deleted_at` datetime DEFAULT NULL,\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `service_id` int(11) NOT NULL,\n  `vcpus` int(11) NOT NULL,\n  `memory_mb` int(11) NOT NULL,\n  `local_gb` int(11) NOT NULL,\n  `vcpus_used` int(11) NOT NULL,\n  `memory_mb_used` int(11) NOT NULL,\n  `local_gb_used` int(11) NOT NULL,\n  `hypervisor_type` mediumtext NOT NULL,\n  `hypervisor_version` int(11) NOT NULL,\n  `cpu_info` mediumtext NOT NULL,\n  `disk_available_least` int(11) DEFAULT NULL,\n  `free_ram_mb` int(11) DEFAULT NULL,\n  `free_disk_gb` int(11) DEFAULT NULL,\n  `current_workload` int(11) DEFAULT NULL,\n  `running_vms` int(11) DEFAULT NULL,\n  `hypervisor_hostname` varchar(255) DEFAULT NULL,\n  `deleted` int(11) DEFAULT NULL,\n  `host_ip` varchar(39) DEFAULT NULL,\n  `supported_instances` text,\n  `pci_stats` text,\n  PRIMARY KEY (`id`),\n  KEY `fk_compute_nodes_service_id` (`service_id`),\n  CONSTRAINT `fk_compute_nodes_service_id` FOREIGN KEY (`service_id`) REFERENCES `services` (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8$$\n\nSo it would appear that there is no metrics column to select as the error indicates.  I thought this might have been an issue with `nova-manage db sync`, so I dropped, recreated, ran `nova-manage db sync` again on the DB, and restarted the services but I am getting the same issue.  The nova-manage log for the db schema updates doesn't have anything that would indicate any issues (schema appears to be at version 216).", 
    "tags": [
        "db"
    ], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1281748", 
    "owner": "None", 
    "id": 1281748, 
    "index": 4573, 
    "created": "2014-02-18 19:26:58.127603+00:00", 
    "title": "nova-compute crash due to missing DB column 'compute_nodes_1.metrics'", 
    "comments": [
        {
            "content": "Doing a fresh install from http://docs.openstack.org/trunk/install-guide/install/apt/content/index.html  Running Ubuntu 12.04.4 LTS + cloud-archive:havana PPA as per guide.  The only variation from the guide is that I have setup a RBD store for Glance.\n\nHere are the package versions:\n# dpkg -l | grep nova\nii  nova-ajax-console-proxy          1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - AJAX console proxy - transitional package\nii  nova-api                         1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - API frontend\nii  nova-cert                        1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - certificate management\nii  nova-common                      1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - common files\nii  nova-compute                     1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - compute node\nii  nova-compute-kvm                 1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - compute node (KVM)\nii  nova-conductor                   1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - conductor service\nii  nova-consoleauth                 1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - Console Authenticator\nii  nova-doc                         1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - documentation\nii  nova-network                     1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - Network manager\nii  nova-novncproxy                  1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - NoVNC proxy\nii  nova-scheduler                   1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute - virtual machine scheduler\nii  python-nova                      1:2013.2.1-0ubuntu1~cloud0                          OpenStack Compute Python libraries\nii  python-novaclient                1:2.15.0-0ubuntu1~cloud0                            client library for OpenStack Compute API\n\nEverything is smooth up to setting up nova-compute.  Other nova services seem to be working correctly, but when I got to deploying the first image the instance didn't start.  I am attaching the nova-compute.log file.  The nova-compute process crashes immediately when you attempt to start it.\n\nAccording to the errors it appears that there is a missing field (metrics) in the compute_nodes table.  The error doesn't mention it, but the table also appears to be missing the extra_resources column as well.\n\nHere is what my MySQL says the schema is for compute_nodes\nCREATE TABLE `compute_nodes` (\n  `created_at` datetime DEFAULT NULL,\n  `updated_at` datetime DEFAULT NULL,\n  `deleted_at` datetime DEFAULT NULL,\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `service_id` int(11) NOT NULL,\n  `vcpus` int(11) NOT NULL,\n  `memory_mb` int(11) NOT NULL,\n  `local_gb` int(11) NOT NULL,\n  `vcpus_used` int(11) NOT NULL,\n  `memory_mb_used` int(11) NOT NULL,\n  `local_gb_used` int(11) NOT NULL,\n  `hypervisor_type` mediumtext NOT NULL,\n  `hypervisor_version` int(11) NOT NULL,\n  `cpu_info` mediumtext NOT NULL,\n  `disk_available_least` int(11) DEFAULT NULL,\n  `free_ram_mb` int(11) DEFAULT NULL,\n  `free_disk_gb` int(11) DEFAULT NULL,\n  `current_workload` int(11) DEFAULT NULL,\n  `running_vms` int(11) DEFAULT NULL,\n  `hypervisor_hostname` varchar(255) DEFAULT NULL,\n  `deleted` int(11) DEFAULT NULL,\n  `host_ip` varchar(39) DEFAULT NULL,\n  `supported_instances` text,\n  `pci_stats` text,\n  PRIMARY KEY (`id`),\n  KEY `fk_compute_nodes_service_id` (`service_id`),\n  CONSTRAINT `fk_compute_nodes_service_id` FOREIGN KEY (`service_id`) REFERENCES `services` (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8$$\n\nSo it would appear that there is no metrics column to select as the error indicates.  I thought this might have been an issue with `nova-manage db sync`, so I dropped, recreated, ran `nova-manage db sync` again on the DB, and restarted the services but I am getting the same issue.  The nova-manage log for the db schema updates doesn't have anything that would indicate any issues (schema appears to be at version 216).", 
            "date_created": "2014-02-18 19:26:58.127603+00:00", 
            "author": "https://api.launchpad.net/1.0/~ajodock"
        }, 
        {
            "content": "", 
            "date_created": "2014-02-18 19:26:58.127603+00:00", 
            "author": "https://api.launchpad.net/1.0/~ajodock"
        }, 
        {
            "content": "Attaching nova-manage.log", 
            "date_created": "2014-02-18 19:28:18.532575+00:00", 
            "author": "https://api.launchpad.net/1.0/~ajodock"
        }, 
        {
            "content": "IIRC, the metrics is added post Havana release,  strange that it will be reported by compute node in Havana release.", 
            "date_created": "2014-02-21 19:54:29.608384+00:00", 
            "author": "https://api.launchpad.net/1.0/~yunhong-jiang"
        }, 
        {
            "content": "I have the same problem. Also, related bug: https://bugs.launchpad.net/nova/+bug/1279642\n\nI can confirm that I have the file \"228_add_metrics_in_compute_nodes.py\" in my release (installed through Devstack, nova compute version 2013.2.2) but for some reason the patch has not been applied. Looking in nova/sqlalchemy/migrate_repo/versions/ I can see that there are .pyc files up until patch 216, but after that neither of the patches (seems to be three of them after 10 placeholders) have been compiled to .pyc files which indicates they have not been executed.", 
            "date_created": "2014-03-04 14:09:36.954418+00:00", 
            "author": "https://api.launchpad.net/1.0/~setomidor-l"
        }, 
        {
            "content": "Running 'nova-manage db sync' manually resolved this issue for me.", 
            "date_created": "2014-03-04 14:14:27.074168+00:00", 
            "author": "https://api.launchpad.net/1.0/~setomidor-l"
        }, 
        {
            "content": "This is a support request, I see a solution attached", 
            "date_created": "2014-09-03 20:56:29.870870+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}