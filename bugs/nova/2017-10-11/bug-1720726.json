{
    "status": "In Progress", 
    "last_updated": "2017-10-03 01:12:41.553573+00:00", 
    "description": "Description\n===========\nIf policy allow attaching external network, Attach a 'public' network return 500.\n\nSteps to reproduce\n==================\n1. Run devstack with default configuration.\n2. Add policy.json to allow attaching external network. \n3. Source demo credential\n4. Create an instance and wait for the instance to become active. \n5. Attach the instance with the 'public' network.\n\n$ nova interface-attach --net-id 2b7e8a86-c5c6-4396-84bc-14cdc741e033 test\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'> (HTTP 500) (Request-ID: req-3e353c62-a356-4d7d-bd73-28cf4406e447)\n\nExpected result\n===============\nNova should return 4xx response\n\nActual result\n=============\nNova returned 500 response\n\nEnvironment\n===========\nDevstack with master\n\nLogs & Configs\n==============\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server [None req-3e125907-0419-418a-a03c-154b99e97610 demo demo] Exception during message handling: TypeError: <class 'neutronclient.common.exceptions.Forbidden'> can't be encoded\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server Traceback (most recent call last):\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 160, in _process_incoming\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 76, in wrapped\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     function_name, call_dict, binary)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     self.force_reraise()\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 67, in wrapped\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 217, in decorated_function\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/utils.py\", line 99, in add_instance_fault_from_exc\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     fault_obj.update(exception_to_dict(fault, message=fault_message))\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/utils.py\", line 76, in exception_to_dict\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     u_message = utils.safe_truncate(message, 255)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/utils.py\", line 1193, in safe_truncate\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     b_value = encodeutils.safe_encode(value)[:length]\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/encodeutils.py\", line 85, in safe_encode\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     raise TypeError(\"%s can't be encoded\" % type(text))\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server TypeError: <class 'neutronclient.common.exceptions.Forbidden'> can't be encoded\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server\nOct 02 04:39:13 testzun <email address hidden>[24253]: ERROR nova.api.openstack.extensions [None req-3e125907-0419-418a-a03c-154b99e97610 demo demo] Unexpected exception in API method: TypeError: <class 'neutronclient.common.exceptions.Forbidden'> can't be encoded", 
    "tags": [
        "api"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1720726", 
    "owner": "https://api.launchpad.net/1.0/~hongbin034", 
    "id": 1720726, 
    "index": 7061, 
    "created": "2017-10-02 04:39:56.695489+00:00", 
    "title": "Attach public network return 500", 
    "comments": [
        {
            "content": "Description\n===========\nIf policy allow attaching external network, Attach a 'public' network return 500.\n\nSteps to reproduce\n==================\n1. Run devstack with default configuration.\n2. Add policy.json to allow attaching external network. \n3. Source demo credential\n4. Create an instance and wait for the instance to become active. \n5. Attach the instance with the 'public' network.\n\n$ nova interface-attach --net-id 2b7e8a86-c5c6-4396-84bc-14cdc741e033 test\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'> (HTTP 500) (Request-ID: req-3e353c62-a356-4d7d-bd73-28cf4406e447)\n\nExpected result\n===============\nNova should return 4xx response\n\nActual result\n=============\nNova returned 500 response\n\nEnvironment\n===========\nDevstack with master\n\nLogs & Configs\n==============\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server [None req-3e125907-0419-418a-a03c-154b99e97610 demo demo] Exception during message handling: TypeError: <class 'neutronclient.common.exceptions.Forbidden'> can't be encoded\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server Traceback (most recent call last):\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 160, in _process_incoming\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 76, in wrapped\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     function_name, call_dict, binary)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     self.force_reraise()\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 67, in wrapped\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 217, in decorated_function\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/utils.py\", line 99, in add_instance_fault_from_exc\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     fault_obj.update(exception_to_dict(fault, message=fault_message))\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/utils.py\", line 76, in exception_to_dict\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     u_message = utils.safe_truncate(message, 255)\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/utils.py\", line 1193, in safe_truncate\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     b_value = encodeutils.safe_encode(value)[:length]\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/encodeutils.py\", line 85, in safe_encode\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server     raise TypeError(\"%s can't be encoded\" % type(text))\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server TypeError: <class 'neutronclient.common.exceptions.Forbidden'> can't be encoded\nOct 02 04:39:13 testzun nova-compute[24239]: ERROR oslo_messaging.rpc.server\nOct 02 04:39:13 testzun <email address hidden>[24253]: ERROR nova.api.openstack.extensions [None req-3e125907-0419-418a-a03c-154b99e97610 demo demo] Unexpected exception in API method: TypeError: <class 'neutronclient.common.exceptions.Forbidden'> can't be encoded", 
            "date_created": "2017-10-02 04:39:56.695489+00:00", 
            "author": "https://api.launchpad.net/1.0/~hongbin034"
        }
    ]
}