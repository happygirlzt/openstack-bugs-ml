{
    "status": "Invalid", 
    "last_updated": "2016-04-19 11:55:52.855523+00:00", 
    "description": "Suppose I have two VMs running and they are under the same subnet, they are assigned with the floating IPs.  (See attached image). I am using nova network model.\n\nI cannot get ping working if I ping from one VM to another VM via the floating IP. \n\nPing to another vm which resides in another subnet via floating IP seems fine.\n\nI did some investigation and looks like the packet is being dropped after the PREROUTING rules. Here is the modprobe iptable log:\n\nJul 17 10:15:40 localhost kernel: [ 1846.629048] TRACE: raw:PREROUTING:rule:2 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0\nJul 17 10:15:40 localhost kernel: [ 1846.629055] TRACE: raw:PREROUTING:policy:3 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0\nJul 17 10:15:40 localhost kernel: [ 1846.629063] TRACE: mangle:PREROUTING:policy:1 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0\nJul 17 10:15:40 localhost kernel: [ 1846.629068] TRACE: nat:PREROUTING:rule:1 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0\nJul 17 10:15:40 localhost kernel: [ 1846.629074] TRACE: nat:nova-network-PREROUTING:rule:3 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0\n\nAnd from the iptables counter, nothing got incremented after the PREROUTING rule:\n\nsudo iptables -t nat -L -v -n\nChain PREROUTING (policy ACCEPT 0 packets, 0 bytes)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a01    84 nova-network-PREROUTING  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\u00a0\u00a0\u00a0\u00a00     0 nova-api-PREROUTING  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\nChain INPUT (policy ACCEPT 0 packets, 0 bytes)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\nChain OUTPUT (policy ACCEPT 0 packets, 0 bytes)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 nova-network-OUTPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\u00a0\u00a0\u00a0\u00a00     0 nova-api-OUTPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\nChain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 nova-network-POSTROUTING  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\u00a0\u00a0\u00a0\u00a00     0 nova-api-POSTROUTING  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\u00a0\u00a0\u00a0\u00a00     0 nova-postrouting-bottom  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\nChain nova-api-OUTPUT (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\nChain nova-api-POSTROUTING (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\nChain nova-api-PREROUTING (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\nChain nova-api-float-snat (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\nChain nova-api-snat (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 nova-api-float-snat  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\nChain nova-network-OUTPUT (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.1           to:11.0.0.3\n\u00a0\u00a0\u00a0\u00a00     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.2           to:10.0.0.4\n\u00a0\u00a0\u00a0\u00a00     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.3           to:10.0.0.3\n\u00a0\u00a0\u00a0\u00a00     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.4           to:11.0.0.4\n\nChain nova-network-POSTROUTING (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 ACCEPT     all  --  *      *       10.0.0.0/24          192.168.62.100\n\u00a0\u00a0\u00a0\u00a00     0 ACCEPT     all  --  *      *       10.0.0.0/24          10.0.0.0/24          ! ctstate DNAT\n\u00a0\u00a0\u00a0\u00a00     0 ACCEPT     all  --  *      *       11.0.0.0/24          192.168.62.100\n\u00a0\u00a0\u00a0\u00a00     0 ACCEPT     all  --  *      *       11.0.0.0/24          11.0.0.0/24          ! ctstate DNAT\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      *       11.0.0.3             0.0.0.0/0            ctstate DNAT to:172.24.4.1\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      *       10.0.0.4             0.0.0.0/0            ctstate DNAT to:172.24.4.2\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      *       10.0.0.3             0.0.0.0/0            ctstate DNAT to:172.24.4.3\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      *       11.0.0.4             0.0.0.0/0            ctstate DNAT to:172.24.4.4\n\nChain nova-network-PREROUTING (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 DNAT       tcp  --  *      *       0.0.0.0/0            169.254.169.254      tcp dpt:80 to:192.168.62.100:8775\n\u00a0\u00a0\u00a0\u00a00     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.1           to:11.0.0.3\n\u00a0\u00a0\u00a0\u00a01    84 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.2           to:10.0.0.4\n\u00a0\u00a0\u00a0\u00a00     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.3           to:10.0.0.3\n\u00a0\u00a0\u00a0\u00a00     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.4           to:11.0.0.4\n\nChain nova-network-float-snat (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      *       11.0.0.3             11.0.0.3             to:172.24.4.1\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      eth1    11.0.0.3             0.0.0.0/0            to:172.24.4.1\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      *       10.0.0.4             10.0.0.4             to:172.24.4.2\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      eth1    10.0.0.4             0.0.0.0/0            to:172.24.4.2\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      *       10.0.0.3             10.0.0.3             to:172.24.4.3\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      eth1    10.0.0.3             0.0.0.0/0            to:172.24.4.3\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      *       11.0.0.4             11.0.0.4             to:172.24.4.4\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      eth1    11.0.0.4             0.0.0.0/0            to:172.24.4.4\n\nChain nova-network-snat (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 nova-network-float-snat  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      eth1    10.0.0.0/24          0.0.0.0/0            to:192.168.62.100\n\u00a0\u00a0\u00a0\u00a00     0 SNAT       all  --  *      eth1    11.0.0.0/24          0.0.0.0/0            to:192.168.62.100\n\nChain nova-postrouting-bottom (1 references)\n\u00a0pkts bytes target     prot opt in     out     source               destination\n\u00a0\u00a0\u00a0\u00a00     0 nova-network-snat  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n\u00a0\u00a0\u00a0\u00a00     0 nova-api-snat  all  --  *      *       0.0.0.0/0            0.0.0.0/0", 
    "tags": [
        "network"
    ], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1475786", 
    "owner": "None", 
    "id": 1475786, 
    "index": 5653, 
    "created": "2015-07-17 20:50:06.675163+00:00", 
    "title": "Cannot ping to a same subnet VM via floating IP", 
    "comments": [
        {
            "content": "Suppose I have two VMs running and they are under the same subnet, they are assigned with the floating IPs.  (See attached image). I am using nova network model.\n\nI cannot get ping working if I ping from one VM to another VM via the floating IP. Ping to another vm which resides in another subnet via floating IP seems fine.\n\nI did some investigation, looks like the packet is being dropped after the PREROUTING rules. Here is the modprobe iptable log:\n\nJul 17 10:15:40 localhost kernel: [ 1846.629048] TRACE: raw:PREROUTING:rule:2 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0 \nJul 17 10:15:40 localhost kernel: [ 1846.629055] TRACE: raw:PREROUTING:policy:3 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0 \nJul 17 10:15:40 localhost kernel: [ 1846.629063] TRACE: mangle:PREROUTING:policy:1 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0 \nJul 17 10:15:40 localhost kernel: [ 1846.629068] TRACE: nat:PREROUTING:rule:1 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0 \nJul 17 10:15:40 localhost kernel: [ 1846.629074] TRACE: nat:nova-network-PREROUTING:rule:3 IN=br100 OUT= PHYSIN=vlan100 MAC=fa:16:3e:c2:b9:7d:fa:16:3e:dd:e7:c9:08:00 SRC=10.0.0.3 DST=172.24.4.2 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=3620 DF PROTO=ICMP TYPE=8 CODE=0 ID=8705 SEQ=0 \n\nAnd from the iptables counter, nothing got incremented after the PREROUTING rule:\n\nsudo iptables -t nat -L -v -n \nChain PREROUTING (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n    1    84 nova-network-PREROUTING  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n    0     0 nova-api-PREROUTING  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n\nChain INPUT (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n\nChain OUTPUT (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 nova-network-OUTPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n    0     0 nova-api-OUTPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n\nChain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 nova-network-POSTROUTING  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n    0     0 nova-api-POSTROUTING  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n    0     0 nova-postrouting-bottom  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n\nChain nova-api-OUTPUT (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n\nChain nova-api-POSTROUTING (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n\nChain nova-api-PREROUTING (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n\nChain nova-api-float-snat (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n\nChain nova-api-snat (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 nova-api-float-snat  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n\nChain nova-network-OUTPUT (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.1           to:11.0.0.3\n    0     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.2           to:10.0.0.4\n    0     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.3           to:10.0.0.3\n    0     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.4           to:11.0.0.4\n\nChain nova-network-POSTROUTING (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 ACCEPT     all  --  *      *       10.0.0.0/24          192.168.62.100      \n    0     0 ACCEPT     all  --  *      *       10.0.0.0/24          10.0.0.0/24          ! ctstate DNAT\n    0     0 ACCEPT     all  --  *      *       11.0.0.0/24          192.168.62.100      \n    0     0 ACCEPT     all  --  *      *       11.0.0.0/24          11.0.0.0/24          ! ctstate DNAT\n    0     0 SNAT       all  --  *      *       11.0.0.3             0.0.0.0/0            ctstate DNAT to:172.24.4.1\n    0     0 SNAT       all  --  *      *       10.0.0.4             0.0.0.0/0            ctstate DNAT to:172.24.4.2\n    0     0 SNAT       all  --  *      *       10.0.0.3             0.0.0.0/0            ctstate DNAT to:172.24.4.3\n    0     0 SNAT       all  --  *      *       11.0.0.4             0.0.0.0/0            ctstate DNAT to:172.24.4.4\n\nChain nova-network-PREROUTING (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 DNAT       tcp  --  *      *       0.0.0.0/0            169.254.169.254      tcp dpt:80 to:192.168.62.100:8775\n    0     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.1           to:11.0.0.3\n    1    84 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.2           to:10.0.0.4\n    0     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.3           to:10.0.0.3\n    0     0 DNAT       all  --  *      *       0.0.0.0/0            172.24.4.4           to:11.0.0.4\n\nChain nova-network-float-snat (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 SNAT       all  --  *      *       11.0.0.3             11.0.0.3             to:172.24.4.1\n    0     0 SNAT       all  --  *      eth1    11.0.0.3             0.0.0.0/0            to:172.24.4.1\n    0     0 SNAT       all  --  *      *       10.0.0.4             10.0.0.4             to:172.24.4.2\n    0     0 SNAT       all  --  *      eth1    10.0.0.4             0.0.0.0/0            to:172.24.4.2\n    0     0 SNAT       all  --  *      *       10.0.0.3             10.0.0.3             to:172.24.4.3\n    0     0 SNAT       all  --  *      eth1    10.0.0.3             0.0.0.0/0            to:172.24.4.3\n    0     0 SNAT       all  --  *      *       11.0.0.4             11.0.0.4             to:172.24.4.4\n    0     0 SNAT       all  --  *      eth1    11.0.0.4             0.0.0.0/0            to:172.24.4.4\n\nChain nova-network-snat (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 nova-network-float-snat  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n    0     0 SNAT       all  --  *      eth1    10.0.0.0/24          0.0.0.0/0            to:192.168.62.100\n    0     0 SNAT       all  --  *      eth1    11.0.0.0/24          0.0.0.0/0            to:192.168.62.100\n\nChain nova-postrouting-bottom (1 references)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 nova-network-snat  all  --  *      *       0.0.0.0/0            0.0.0.0/0           \n    0     0 nova-api-snat  all  --  *      *       0.0.0.0/0            0.0.0.0/0", 
            "date_created": "2015-07-17 20:50:06.675163+00:00", 
            "author": "https://api.launchpad.net/1.0/~kahou82"
        }, 
        {
            "content": "", 
            "date_created": "2015-07-17 20:50:06.675163+00:00", 
            "author": "https://api.launchpad.net/1.0/~kahou82"
        }, 
        {
            "content": "@Kahou Lei:\n\nIt's been over 2 months since you are set as assignee but without\na commit to solve this bug. To signalize to other contributors that \nthis is not in progress and can be worked on, I remove you as assignee.\nIf you still plan to work on this, please set yourself as assignee\nagain and provide a patch in Gerrit in the near future.\n\nPlease consider updating your Launchpad profile with your IRC nickname\nand hanging around in #openstack-nova on irc.freenode.net this makes\nit easier to communicate with each other (see [1] for more).\n\nIf you have any questions about this process, just ping me (markus_z) \nin IRC.\n\n[1] https://wiki.openstack.org/wiki/Nova/Mentoring#Top_Tips_for_working_with_the_Nova_community", 
            "date_created": "2015-10-16 13:02:36.441495+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "I'm working on triaging this and attempting to reproduce the issue.", 
            "date_created": "2016-02-03 22:20:16.573905+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "Not sure if this is related - https://bugs.launchpad.net/nova/+bug/1349590", 
            "date_created": "2016-03-08 18:43:02.633430+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "HI, I test the scenario as below and works fine (using Liberty)\n\ntenant_net : 193.160.15.0/24\next_net :  192.168.0.0/16 \n\n2 vm for testing( both have floating IP ):\n[root@controller ~(keystone_admin)]# nova list\n+--------------------------------------+-----------+--------+------------+-------------+-----------------------------------+\n| ID                                   | Name      | Status | Task State | Power State | Networks                          |\n+--------------------------------------+-----------+--------+------------+-------------+-----------------------------------+\n| 2803a146-7b30-4ac8-ab0e-f28eb950a0c4 | test1    | ACTIVE | -          | Running     | t1=193.160.15.43, 192.168.100.134\n| 9fac083f-4e73-44d2-9166-10a0e67f8b6c | test2 | ACTIVE | -          | Running     | t1=193.160.15.45, 192.168.100.135\n\nThe result of test is in the attachment.\n\n", 
            "date_created": "2016-04-08 02:47:29.145239+00:00", 
            "author": "https://api.launchpad.net/1.0/~onlyellow"
        }, 
        {
            "content": "This bug lacks the necessary information to effectively reproduce and fix it, therefore it has been closed. Feel free to reopen the bug by providing the requested information and set the bug status back to ''New''.", 
            "date_created": "2016-04-19 11:55:36.353046+00:00", 
            "author": "https://api.launchpad.net/1.0/~luis-ramirez"
        }
    ]
}