{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:26:49.580633+00:00", 
    "description": "Run instance and make sure it's ACTIVE:\n\nnova list\n+----+-------+--------+-----------+------------+\n| ID |  Name | Status | Public IP | Private IP |\n+----+-------+--------+-----------+------------+\n| 6  | test6 | ACTIVE |           | 10.0.0.3   |\n+----+-------+--------+-----------+------------+\nCreate snapshot from it:\n# nova image-create 6 mike-snap\n\nCheck it's status with nova image-list:\n| 1433335351 | mike-snap         | None   |\nIn nova-compute log:\n\n2011-05-10 22:36:50,979 DEBUG nova.rpc [-] received {'_context_request_id': 'KNQWMVVM-YJVE-Z0GLJ8', '_context_read_deleted': False, 'args': {'instance_id': 6, 'image_id': 1433335351}, '_context_is_admin': True, '_context_timestamp': '2011-05-10T22:36:50Z', '_context_user': 'admin', 'method': 'snapshot_instance', '_context_project': 'admin', '_context_remote_address': None} from (pid=1710) _receive /opt/nova/nova/rpc.py:177\n2011-05-10 22:36:50,980 DEBUG nova.rpc [-] unpacked context: {'timestamp': '2011-05-10T22:36:50Z', 'remote_address': None, 'project': 'admin', 'is_admin': True, 'user': 'admin', 'request_id': 'KNQWMVVM-YJVE-Z0GLJ8', 'read_deleted': False} from (pid=1710) _unpack_context /opt/nova/nova/rpc.py:350\n2011-05-10 22:36:51,229 AUDIT nova.compute.manager [KNQWMVVM-YJVE-Z0GLJ8 admin admin] instance 6: snapshotting\n2011-05-10 22:36:51,237 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/opt/nova/nova/exception.py\", line 87, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/opt/nova/nova/virt/libvirt_conn.py\", line 459, in snapshot\n(nova.exception): TRACE:     'properties': {'architecture': base['architecture'],\n(nova.exception): TRACE: KeyError: 'architecture'\n(nova.exception): TRACE:\n2011-05-10 22:36:51,239 ERROR nova [-] Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/opt/nova/nova/rpc.py\", line 198, in _receive\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/opt/nova/nova/exception.py\", line 87, in _wrap\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/opt/nova/nova/compute/manager.py\", line 400, in snapshot_instance\n(nova): TRACE:\n(nova): TRACE:   File \"/opt/nova/nova/exception.py\", line 93, in _wrap\n(nova): TRACE:     raise Error(str(e))\n(nova): TRACE: Error: 'architecture'\n(nova): TRACE:\n\nThis is for trunk rev.1061", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/780784", 
    "owner": "https://api.launchpad.net/1.0/~mihgen", 
    "id": 780784, 
    "index": 2400, 
    "created": "2011-05-10 22:45:38.780033+00:00", 
    "title": "KeyError in image snapshotting", 
    "comments": [
        {
            "content": "Run instance and make sure it's ACTIVE:\n\nnova list\n+----+-------+--------+-----------+------------+\n| ID |  Name | Status | Public IP | Private IP |\n+----+-------+--------+-----------+------------+\n| 6  | test6 | ACTIVE |           | 10.0.0.3   |\n+----+-------+--------+-----------+------------+\nCreate snapshot from it:\n# nova image-create 6 mike-snap\n\nCheck it's status with nova image-list:\n| 1433335351 | mike-snap         | None   |\nIn nova-compute log:\n\n2011-05-10 22:36:50,979 DEBUG nova.rpc [-] received {'_context_request_id': 'KNQWMVVM-YJVE-Z0GLJ8', '_context_read_deleted': False, 'args': {'instance_id': 6, 'image_id': 1433335351}, '_context_is_admin': True, '_context_timestamp': '2011-05-10T22:36:50Z', '_context_user': 'admin', 'method': 'snapshot_instance', '_context_project': 'admin', '_context_remote_address': None} from (pid=1710) _receive /opt/nova/nova/rpc.py:177\n2011-05-10 22:36:50,980 DEBUG nova.rpc [-] unpacked context: {'timestamp': '2011-05-10T22:36:50Z', 'remote_address': None, 'project': 'admin', 'is_admin': True, 'user': 'admin', 'request_id': 'KNQWMVVM-YJVE-Z0GLJ8', 'read_deleted': False} from (pid=1710) _unpack_context /opt/nova/nova/rpc.py:350\n2011-05-10 22:36:51,229 AUDIT nova.compute.manager [KNQWMVVM-YJVE-Z0GLJ8 admin admin] instance 6: snapshotting\n2011-05-10 22:36:51,237 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/opt/nova/nova/exception.py\", line 87, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/opt/nova/nova/virt/libvirt_conn.py\", line 459, in snapshot\n(nova.exception): TRACE:     'properties': {'architecture': base['architecture'],\n(nova.exception): TRACE: KeyError: 'architecture'\n(nova.exception): TRACE:\n2011-05-10 22:36:51,239 ERROR nova [-] Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/opt/nova/nova/rpc.py\", line 198, in _receive\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/opt/nova/nova/exception.py\", line 87, in _wrap\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/opt/nova/nova/compute/manager.py\", line 400, in snapshot_instance\n(nova): TRACE:\n(nova): TRACE:   File \"/opt/nova/nova/exception.py\", line 93, in _wrap\n(nova): TRACE:     raise Error(str(e))\n(nova): TRACE: Error: 'architecture'\n(nova): TRACE:\n\nThis is for trunk rev.1061", 
            "date_created": "2011-05-10 22:45:38.780033+00:00", 
            "author": "https://api.launchpad.net/1.0/~mihgen"
        }, 
        {
            "content": "I've pushed two more commits.\n- Unit test for LibvirtConnection snapshot method.\nI had to make singleton for fake image service and assume that one image with id '123456' already there. Images are expected to be in service before snapshot call, so I have not figure out any other way providing it. If have one in mind, please share.\n- Some improvements:\n  1. After nova-image create <id> <name>, we will now get 'CREATING' status in image-list, not 'None'\n  2. After operation is complete, we will get name of the image as we provided, not 'ami-tty.26372324'  ('<base_image_name>.<new_image_id>')\n", 
            "date_created": "2011-05-15 11:27:21.662846+00:00", 
            "author": "https://api.launchpad.net/1.0/~mihgen"
        }
    ]
}