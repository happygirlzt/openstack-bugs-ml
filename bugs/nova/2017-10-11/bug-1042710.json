{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:34:04.382818+00:00", 
    "description": "I am using the lvm function of nova-compute , It is successful when creating the vm, but failed when deleting it\n\nthe following is failed information:\nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 869, in terminate_instance                                                                                \n  do_terminate_instance()                                                                                                                                                       \nFile \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 679, in inner                                                                                                       \n  retval = f(*args, **kwargs)                                                                                                                                                   \nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 862, in do_terminate_instance                                                                             \n  self._delete_instance(context, instance)                                                                                                                                      \nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 839, in _delete_instance                                                                                  \n  self._shutdown_instance(context, instance)                                                                                                                                    \nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 804, in _shutdown_instance                                                                                \n  block_device_info)                                                                                                                                                            \nFile \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 498, in destroy                                                                                       \n  self._cleanup(instance, network_info, block_device_info)                                                                                                                      \nFile \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 564, in _cleanup                                                                                      \n  self._cleanup_lvm(instance)                                                                                                                                                   \nFile \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 568, in _cleanup_lvm                                                                                  \n  disks = self._lvm_disks(instance)                                                                                                                                             \nFile \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 586, in _lvm_disks                                                                                    \n  disk_names = filter(belongs_to_instance, os.listdir(vg))                                                                                                                      \nError: [Errno 13] Permission denied: '/dev/xenvg1'   \n\nthis error show that nova-compute process whch runned in nova user has not Permission for vgs directory /dev/xenvg1\n\n# ls -l /dev/\ndrwx------ 2 root root         80 Aug 28 17:13 xenvg1\n\nCan I must use the chmod command to change the permission of vg directory ? \n I think this problem may be one bug ,because creating vg ,the default permission is drwx------\n\nmy nova.conf about lvm :\n\nlibvirt_images_type=lvm\nlibvirt_images_volume_group=xenvg1", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1042710", 
    "owner": "https://api.launchpad.net/1.0/~bfilippov", 
    "id": 1042710, 
    "index": 3068, 
    "created": "2012-08-28 12:03:45.561288+00:00", 
    "title": "deleting vm is failed  for lvm type", 
    "comments": [
        {
            "content": "I am using the lvm function of nova-compute , It is successful when creating the vm, but failed when deleting it\n\nthe following is failed information:\nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 869, in terminate_instance                                                                                \n  do_terminate_instance()                                                                                                                                                       \nFile \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 679, in inner                                                                                                       \n  retval = f(*args, **kwargs)                                                                                                                                                   \nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 862, in do_terminate_instance                                                                             \n  self._delete_instance(context, instance)                                                                                                                                      \nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 839, in _delete_instance                                                                                  \n  self._shutdown_instance(context, instance)                                                                                                                                    \nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 804, in _shutdown_instance                                                                                \n  block_device_info)                                                                                                                                                            \nFile \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 498, in destroy                                                                                       \n  self._cleanup(instance, network_info, block_device_info)                                                                                                                      \nFile \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 564, in _cleanup                                                                                      \n  self._cleanup_lvm(instance)                                                                                                                                                   \nFile \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 568, in _cleanup_lvm                                                                                  \n  disks = self._lvm_disks(instance)                                                                                                                                             \nFile \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 586, in _lvm_disks                                                                                    \n  disk_names = filter(belongs_to_instance, os.listdir(vg))                                                                                                                      \nError: [Errno 13] Permission denied: '/dev/xenvg1'   \n\nthis error show that nova-compute process whch runned in nova user has not Permission for vgs directory /dev/xenvg1\n\n# ls -l /dev/\ndrwx------ 2 root root         80 Aug 28 17:13 xenvg1\n\nCan I must use the chmod command to change the permission of vg directory ? \n I think this problem may be one bug ,because creating vg ,the default permission is drwx------\n\nmy nova.conf about lvm :\n\nlibvirt_images_type=lvm\nlibvirt_images_volume_group=xenvg1", 
            "date_created": "2012-08-28 12:03:45.561288+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhoudongshu"
        }, 
        {
            "content": "You're right. This is a bug, because lvm creation/deletion goes through rootwrap anyway, and compute user doesn't neccessary have permission to list /dev/vg directory.", 
            "date_created": "2012-09-05 23:05:07.556991+00:00", 
            "author": "https://api.launchpad.net/1.0/~bfilippov"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/12478", 
            "date_created": "2012-09-06 00:10:38.442787+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/12478\nCommitted: http://github.com/openstack/nova/commit/08f172bb6c14f75171ac29e1c257f9581202b7e9\nSubmitter: Jenkins\nBranch:    master\n\ncommit 08f172bb6c14f75171ac29e1c257f9581202b7e9\nAuthor: Boris Filippov <email address hidden>\nDate:   Thu Sep 6 04:00:41 2012 +0400\n\n    Use lvs instead of os.listdir in _cleanup_lvm\n    \n    Compute user may not have permission to list /dev/<VolGroup>\n    directory. This results in error during instance cleanup and not\n    deleted lvm images, if libvirt driver use lvm images backend.\n    To prevent this, _cleanup_lvm use lvs command instead of os.listdir.\n    \n    This fixes bug 1042710\n    \n    Change-Id: I82ab4ca5ba3320f50c84e23839fcf6ed8f02be8c\n", 
            "date_created": "2012-09-06 09:26:32.311414+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}