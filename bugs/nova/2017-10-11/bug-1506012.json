{
    "status": "Fix Released", 
    "last_updated": "2016-01-07 08:04:04.827260+00:00", 
    "description": "Since yesterday we see a spike in qemu-img info calls failing:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiQ29tbWFuZDogZW52IExDX0FMTD1DIExBTkc9QyBxZW11LWltZyBpbmZvXCIiLCJmaWVsZHMiOltdLCJvZmZzZXQiOjAsInRpbWVmcmFtZSI6IjYwNDgwMCIsImdyYXBobW9kZSI6ImNvdW50IiwidGltZSI6eyJ1c2VyX2ludGVydmFsIjowfSwic3RhbXAiOjE0NDQ4MTQ3ODIzMTJ9\n\neg\n\n\t[req-20a22603-59e7-425d-ba06-2a9a5505b5\n6b tempest-ServersAdminTestJSON-917741884 tempest-ServersAdminTestJSON-747301663] [instance: bebbcf1a-104f-4d98-a02b-ccd20601890b] Terminating instance\n2015-10-13 17:52:40.436 ERROR nova.compute.manager [req-ef37b368-b686-42fd-bbfe-b6c3a69d063f tempest-ServersTestJSON-1340739681 tempest-ServersTestJSON-1992588300] [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Instance failed to spawn\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Traceback (most recent call last):\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2172, in _build_resources\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     yield resources\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2019, in _build_and_run_instance\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     block_device_info=block_device_info)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2437, in spawn\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     admin_pass=admin_password)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2861, in _create_image\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     instance, size, fallback_from_host)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 6282, in _try_fetch_image_cache\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     size=size)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 249, in cache\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     *args, **kwargs)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 567, in create_image\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     copy_qcow2_image(base, self.path, size)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 254, in inner\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     return f(*args, **kwargs)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 529, in copy_qcow2_image\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     libvirt_utils.create_cow_image(base, target)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/utils.py\", line 87, in create_cow_image\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     base_details = images.qemu_img_info(backing_file)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/images.py\", line 68, in qemu_img_info\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     preexec_fn=_qemu_resources)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/utils.py\", line 390, in execute\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     return processutils.execute(*cmd, **kwargs)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/processutils.py\", line 275, in execute\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     cmd=sanitized_cmd)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] ProcessExecutionError: Unexpected error while running command.\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Command: env LC_ALL=C LANG=C qemu-img info /opt/stack/data/nova/instances/_base/17293870eb69e986dd7779e8bb4f42652df5977e\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Exit code: -11\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Stdout: u''\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Stderr: u''\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] \n\n\nThis spike co-incides with merging of\n\ncommit da217205f53f9a38a573fb151898fbbeae41021d\nAuthor: Tristan Cacqueray <email address hidden>\nDate:   Wed Aug 5 17:17:04 2015 +0000\n\n    virt: Use preexec_fn to ulimit qemu-img info call\n    \n    This uses the preexec_fn oslo.concurrency execute parameter to set user limit\n    before calling qemu-img info. The process is limitted to 2 seconds of cpu\n    and 1GB of virtual memory\n    \n    Change-Id: Ib47f1116c94c8f76d2a4a525af24439a4aa15854\n    Closes-Bug: #1449062", 
    "tags": [], 
    "importance": "Critical", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1506012", 
    "owner": "https://api.launchpad.net/1.0/~ihar-hrachyshka", 
    "id": 1506012, 
    "index": 263, 
    "created": "2015-10-14 11:12:29.033161+00:00", 
    "title": "Gate tests randomly failing qemu-img info calls", 
    "comments": [
        {
            "content": "Since yesterday we see a spike in qemu-img info calls failing:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiQ29tbWFuZDogZW52IExDX0FMTD1DIExBTkc9QyBxZW11LWltZyBpbmZvXCIiLCJmaWVsZHMiOltdLCJvZmZzZXQiOjAsInRpbWVmcmFtZSI6IjYwNDgwMCIsImdyYXBobW9kZSI6ImNvdW50IiwidGltZSI6eyJ1c2VyX2ludGVydmFsIjowfSwic3RhbXAiOjE0NDQ4MTQ3ODIzMTJ9\n\neg\n\n\t[req-20a22603-59e7-425d-ba06-2a9a5505b5\n6b tempest-ServersAdminTestJSON-917741884 tempest-ServersAdminTestJSON-747301663] [instance: bebbcf1a-104f-4d98-a02b-ccd20601890b] Terminating instance\n2015-10-13 17:52:40.436 ERROR nova.compute.manager [req-ef37b368-b686-42fd-bbfe-b6c3a69d063f tempest-ServersTestJSON-1340739681 tempest-ServersTestJSON-1992588300] [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Instance failed to spawn\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Traceback (most recent call last):\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2172, in _build_resources\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     yield resources\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2019, in _build_and_run_instance\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     block_device_info=block_device_info)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2437, in spawn\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     admin_pass=admin_password)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2861, in _create_image\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     instance, size, fallback_from_host)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 6282, in _try_fetch_image_cache\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     size=size)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 249, in cache\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     *args, **kwargs)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 567, in create_image\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     copy_qcow2_image(base, self.path, size)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 254, in inner\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     return f(*args, **kwargs)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 529, in copy_qcow2_image\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     libvirt_utils.create_cow_image(base, target)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/libvirt/utils.py\", line 87, in create_cow_image\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     base_details = images.qemu_img_info(backing_file)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/virt/images.py\", line 68, in qemu_img_info\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     preexec_fn=_qemu_resources)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/opt/stack/new/nova/nova/utils.py\", line 390, in execute\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     return processutils.execute(*cmd, **kwargs)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/processutils.py\", line 275, in execute\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d]     cmd=sanitized_cmd)\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] ProcessExecutionError: Unexpected error while running command.\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Command: env LC_ALL=C LANG=C qemu-img info /opt/stack/data/nova/instances/_base/17293870eb69e986dd7779e8bb4f42652df5977e\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Exit code: -11\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Stdout: u''\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] Stderr: u''\n2015-10-13 17:52:40.436 23002 ERROR nova.compute.manager [instance: 94a3b99d-b8b2-4e2a-a26a-fd7ff6e4f67d] \n\n\nThis spike co-incides with merging of\n\ncommit da217205f53f9a38a573fb151898fbbeae41021d\nAuthor: Tristan Cacqueray <email address hidden>\nDate:   Wed Aug 5 17:17:04 2015 +0000\n\n    virt: Use preexec_fn to ulimit qemu-img info call\n    \n    This uses the preexec_fn oslo.concurrency execute parameter to set user limit\n    before calling qemu-img info. The process is limitted to 2 seconds of cpu\n    and 1GB of virtual memory\n    \n    Change-Id: Ib47f1116c94c8f76d2a4a525af24439a4aa15854\n    Closes-Bug: #1449062", 
            "date_created": "2015-10-14 11:12:29.033161+00:00", 
            "author": "https://api.launchpad.net/1.0/~berrange"
        }, 
        {
            "content": "More accurate logstash query\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiQ29tbWFuZDogZW52IExDX0FMTD1DIExBTkc9QyBxZW11LWltZyBpbmZvXCIgIEFORCBcIkV4aXQgY29kZTogLTExXCIiLCJmaWVsZHMiOltdLCJvZmZzZXQiOjAsInRpbWVmcmFtZSI6IjYwNDgwMCIsImdyYXBobW9kZSI6ImNvdW50IiwidGltZSI6eyJ1c2VyX2ludGVydmFsIjowfSwic3RhbXAiOjE0NDQ4MjE1MzQ4NTB9", 
            "date_created": "2015-10-14 11:21:29.268561+00:00", 
            "author": "https://api.launchpad.net/1.0/~berrange"
        }, 
        {
            "content": "Relevant QEMU and libvirt log snippets (from log files of this test job -- gate-tempest-dsvm-full/33cef79:\n\n\nFrom [...]/logs/libvirt/qemu/instance-0000000a.txt.gz:\n\n    \"qemu: terminating on signal 15 from pid 32611\"\n\nWhere \"singal 15\" corresponds to SIGTERM. And, process '32611' (from ps.txt.gz) is:\n\n    32611     1 32611  0.7  0.1 820416 14868 /usr/sbin/libvirtd -d\n\n\nFrom [...]/logs/libvirt/libvirtd.txt.gz:\n\n[...]\n2015-10-14 08:56:51.397+0000: 32617: debug : virDomainDestroy:2173 : dom=0x7f33c000b920, (VM: name=instance-00000025, uuid=a7127411-8602-41c9-856c-d704b1c6b5e7)\n2015-10-14 08:56:51.397+0000: 32617: debug : qemuProcessKill:4193 : vm=0x7f33ac008f00 name=instance-00000025 pid=470 flags=1\n2015-10-14 08:56:51.397+0000: 32617: debug : virProcessKillPainfully:274 : vpid=470 force=1\n2015-10-14 08:56:51.416+0000: 32611: error : qemuMonitorIO:656 : internal error: End of file from monitor\n2015-10-14 08:56:51.416+0000: 32611: debug : qemuMonitorIO:710 : Error on monitor internal error: End of file from monitor\n2015-10-14 08:56:51.416+0000: 32611: debug : qemuMonitorIO:731 : Triggering EOF callback\n2015-10-14 08:56:51.416+0000: 32611: debug : qemuProcessHandleMonitorEOF:300 : Received EOF on 0x7f33ac008f00 'instance-00000025'\n[...]\n", 
            "date_created": "2015-10-14 11:40:32.559964+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/234696\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=54c83186e8f49a297ca041c8b8f240b3c825e74a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 54c83186e8f49a297ca041c8b8f240b3c825e74a\nAuthor: Ihar Hrachyshka <email address hidden>\nDate:   Wed Oct 14 09:54:08 2015 +0000\n\n    Revert \"virt: Use preexec_fn to ulimit qemu-img info call\"\n    \n    This reverts commit da217205f53f9a38a573fb151898fbbeae41021d.\n    \n    The patch made nova-compute to segfault, among other things\n    resulting in instances not being spawned successfully.\n    \n    Closes-Bug: #1506012\n    Change-Id: I0065dd194a7c910cc9f9d9b468e5d43bf5c9b7c0\n", 
            "date_created": "2015-10-14 18:46:27.283850+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.0.0.0b1 development milestone.", 
            "date_created": "2015-12-02 16:17:39.288558+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ]
}