{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:26:47.028531+00:00", 
    "description": "[Issue]\n\nI tried to reload nova.conf with sending SIGHUP to nova-compute.\nIn my understanding, nova-compute can reload nova.conf by receiving SIGHUP when it has started as daemon.\n\nReloading config is succeed.\nHowever, booting new instance doesn't work correctly after sending SIGHUP.\nTask State would never change from \"scheduling\".\n\n$ nova list\n+--------------------------------------+------+--------+------------+-------------+----------+\n| ID                                   | Name | Status | Task State | Power State | Networks |\n+--------------------------------------+------+--------+------------+-------------+----------+\n| 9aa89186-28fa-44ee-8e97-84bd0de23f91 | vm   | BUILD  | scheduling | NOSTATE     |          |\n+--------------------------------------+------+--------+------------+-------------+----------+\n\n[How to reproduce]\n\nnova's commit id: 33fc957a5aeb9d310cbff3ac22c7a3c97a794f72\n\n1) Start nova-compute as daemon.\n\n$ sudo cat /etc/init/nova-compute.conf\ndescription \"nova-compute\"\nauthor \"openstack\"\n\nstart on (local-filesystems and net-device-up IFACE!=lo)\nstop on runlevel [016]\n\nexec su -s /bin/sh -c \"exec /usr/local/bin/nova-compute --config-file /etc/nova/nova.conf --log-file /home/devstack/log/nova-compute.log > /dev/null 2>&1\" devstack\n\n$ sudo service nova-compute start\nnova-compute start/running, process 10521\n\n2) Send SIGHUP to nova-compute's PID.\n\n$ ps aux|grep nova-compute\nroot     10521  0.0  0.0   4052  1548 ?        Ss   15:42   0:00 su -s /bin/sh -c exec /usr/local/bin/nova-compute --config-file /etc/nova/nova.conf --log-file /home/devstack/log/nova-compute.log > /dev/null 2>&1 devstack\ndevstack 10523 19.5  1.5 220744 32796 ?        Ssl  15:42   0:00 /usr/bin/python /usr/local/bin/nova-compute --config-file /etc/nova/nova.conf --log-file /home/devstack/log/nova-compute.log\n$ sudo kill -SIGHUP 10523\n\n3) Verify nova-compute.log and check reload success.\n\n$ cat /home/devstack/log/nova-compute.log\n    :\n2014-04-07 15:46:18.791 INFO nova.openstack.common.service [-] Caught SIGHUP, exiting\n2014-04-07 15:46:18.811 DEBUG nova.openstack.common.service [-] Full set of CONF: from (pid=10523) _wait_for_exit_or_signal /opt/stack/nova/nova/openstack/common/service.py:167\n    :\n\n4) Boot new instance and check Task State of new instance repeatedly.\n\n$ nova boot --flavor 1 --image dee24998-10f7-42a3-8cd7-d46d185281ca vm\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n    :\n\n5) Task State would never change from scheduling.\n\n$ nova list\n+--------------------------------------+------+--------+------------+-------------+----------+\n| ID                                   | Name | Status | Task State | Power State | Networks |\n+--------------------------------------+------+--------+------------+-------------+----------+\n| 9aa89186-28fa-44ee-8e97-84bd0de23f91 | vm   | BUILD  | scheduling | NOSTATE     |          |\n+--------------------------------------+------+--------+------------+-------------+----------+", 
    "tags": [
        "compute"
    ], 
    "importance": "High", 
    "heat": 28, 
    "link": "https://bugs.launchpad.net/nova/+bug/1303615", 
    "owner": "https://api.launchpad.net/1.0/~ankitagrawal", 
    "id": 1303615, 
    "index": 1465, 
    "created": "2014-04-07 07:08:06.706356+00:00", 
    "title": "Instance's Task state never change from 'scheduling' after sending SIGHUP to nova-compute", 
    "comments": [
        {
            "content": "[Issue]\n\nI tried to reload nova.conf with sending SIGHUP to nova-compute.\nIn my understanding, nova-compute can reload nova.conf by receiving SIGHUP when it has started as daemon.\n\nReloading config is succeed.\nHowever, booting new instance doesn't work correctly after sending SIGHUP.\nTask State would never change from \"scheduling\".\n\n$ nova list\n+--------------------------------------+------+--------+------------+-------------+----------+\n| ID                                   | Name | Status | Task State | Power State | Networks |\n+--------------------------------------+------+--------+------------+-------------+----------+\n| 9aa89186-28fa-44ee-8e97-84bd0de23f91 | vm   | BUILD  | scheduling | NOSTATE     |          |\n+--------------------------------------+------+--------+------------+-------------+----------+\n\n[How to reproduce]\n\nnova's commit id: 33fc957a5aeb9d310cbff3ac22c7a3c97a794f72\n\n1) Start nova-compute as daemon.\n\n$ sudo cat /etc/init/nova-compute.conf\ndescription \"nova-compute\"\nauthor \"openstack\"\n\nstart on (local-filesystems and net-device-up IFACE!=lo)\nstop on runlevel [016]\n\nexec su -s /bin/sh -c \"exec /usr/local/bin/nova-compute --config-file /etc/nova/nova.conf --log-file /home/devstack/log/nova-compute.log > /dev/null 2>&1\" devstack\n\n$ sudo service nova-compute start\nnova-compute start/running, process 10521\n\n2) Send SIGHUP to nova-compute's PID.\n\n$ ps aux|grep nova-compute\nroot     10521  0.0  0.0   4052  1548 ?        Ss   15:42   0:00 su -s /bin/sh -c exec /usr/local/bin/nova-compute --config-file /etc/nova/nova.conf --log-file /home/devstack/log/nova-compute.log > /dev/null 2>&1 devstack\ndevstack 10523 19.5  1.5 220744 32796 ?        Ssl  15:42   0:00 /usr/bin/python /usr/local/bin/nova-compute --config-file /etc/nova/nova.conf --log-file /home/devstack/log/nova-compute.log\n$ sudo kill -SIGHUP 10523\n\n3) Verify nova-compute.log and check reload success.\n\n$ cat /home/devstack/log/nova-compute.log\n    :\n2014-04-07 15:46:18.791 INFO nova.openstack.common.service [-] Caught SIGHUP, exiting\n2014-04-07 15:46:18.811 DEBUG nova.openstack.common.service [-] Full set of CONF: from (pid=10523) _wait_for_exit_or_signal /opt/stack/nova/nova/openstack/common/service.py:167\n    :\n\n4) Boot new instance and check Task State of new instance repeatedly.\n\n$ nova boot --flavor 1 --image dee24998-10f7-42a3-8cd7-d46d185281ca vm\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n    :\n\n5) Task State would never change from scheduling.\n\n$ nova list\n+--------------------------------------+------+--------+------------+-------------+----------+\n| ID                                   | Name | Status | Task State | Power State | Networks |\n+--------------------------------------+------+--------+------------+-------------+----------+\n| 9aa89186-28fa-44ee-8e97-84bd0de23f91 | vm   | BUILD  | scheduling | NOSTATE     |          |\n+--------------------------------------+------+--------+------------+-------------+----------+", 
            "date_created": "2014-04-07 07:08:06.706356+00:00", 
            "author": "https://api.launchpad.net/1.0/~kanabuchi"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/98076", 
            "date_created": "2014-06-05 10:10:58.848131+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Ankit Agrawal (<email address hidden>) on branch: master\nReview: https://review.openstack.org/98076\nReason: Abandoning this patch as it has been taken care by following patches:\nhttps://review.openstack.org/#/c/104887\n\nhttps://review.openstack.org/#/c/104099", 
            "date_created": "2014-08-06 08:49:14.304696+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue is still there and it is because of oslo.messaging.  After sending SIGHUP to nova-compute,  connections opened by listeners are not being closed after stopping service. And it is creating new listeners on service restart . Here listener object is not garbage collected after stopping service.\n \nOslo.messaging patch to fix this issue is still under review : https://review.openstack.org/#/c/103186/", 
            "date_created": "2014-08-20 06:40:01.439200+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhijeet-malawade"
        }, 
        {
            "content": "Patch https://review.openstack.org/#/c/103186/ is merged and I don't see this issue anymore.", 
            "date_created": "2014-10-09 21:17:42.814665+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }
    ]
}