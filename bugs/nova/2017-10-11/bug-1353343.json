{
    "status": "Expired", 
    "last_updated": "2016-07-05 09:51:25.664684+00:00", 
    "description": "Single Node Environment:\nWhen we resize an instance in single node environment, instance directory is renamed to \u201c<instance_id>_resize\u201d directory.\nThen a new directory is created with the instance path on the same node and all instance files with new configuration will be copied to this directory.\nIf there is not enough space left on this node to create or copying instance files then disk full error occurs and VM goes into \"error\" state.\n\nMulti Node Environment:\nWhen we resize an instance in multi node environment, directory is renamed to \u201c<instance_id>_resize\u201d directory on source node. \nThen a new directory is created with the instance path on the destination node and all instance files with new configuration will be copied to this directory.\nIf there is not enough space left on destination node to create or copying instance files then disk full error occurs and VM goes to \"error\" state.\n\nAs of now in both the cases there is no way to recover instance from the error state which is not good from end users perspective.\nIdeally it should log the warning if disk space is full and should keep the instance up and running with old configuration.\n\nStack trace for reference:\n2014-07-22 03:50:04.618 ERROR nova.compute.manager [req-d45a250c-bef9-4b42-96d3-187296dba8b0 admin demo] [instance: 30003b95-d88a-41f7-8ee2-44bffc524576] Setting instance vm_state to ERROR\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576] Traceback (most recent call last):\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/compute/manager.py\", line 3656, in finish_resize\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     disk_info, image)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/compute/manager.py\", line 3624, in _finish_resize\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     block_device_info, power_on)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5053, in finish_migration\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     block_device_info=None, inject_files=False)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2559, in _create_image\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     fileutils.ensure_tree(libvirt_utils.get_instance_path(instance))\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/openstack/common/fileutils.py\", line 35, in ensure_tree\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     os.makedirs(path)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/usr/lib/python2.7/os.py\", line 157, in makedirs\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     mkdir(name, mode)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576] OSError: [Errno 28] No space left on device: '/mnt/stack/data/nova/instances/30003b95-d88a-41f7-8ee2-44bffc524576'\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]", 
    "tags": [
        "compute"
    ], 
    "importance": "Undecided", 
    "heat": 24, 
    "link": "https://bugs.launchpad.net/nova/+bug/1353343", 
    "owner": "None", 
    "id": 1353343, 
    "index": 5055, 
    "created": "2014-08-06 08:29:00.142180+00:00", 
    "title": "Cannot recover instance if error occurs during resize", 
    "comments": [
        {
            "content": "Single Node Environment:\nWhen we resize an instance in single node environment, instance directory is renamed to \u201c<instance_id>_resize\u201d directory.\nThen a new directory is created with the instance path on the same node and all instance files with new configuration will be copied to this directory.\nIf there is not enough space left on this node to create or copying instance files then disk full error occurs and VM goes into \"error\" state.\n\nMulti Node Environment:\nWhen we resize an instance in multi node environment, directory is renamed to \u201c<instance_id>_resize\u201d directory on source node. \nThen a new directory is created with the instance path on the destination node and all instance files with new configuration will be copied to this directory.\nIf there is not enough space left on destination node to create or copying instance files then disk full error occurs and VM goes to \"error\" state.\n\nAs of now in both the cases there is no way to recover instance from the error state which is not good from end users perspective.\nIdeally it should log the warning if disk space is full and should keep the instance up and running with old configuration.\n\nStack trace for reference:\n2014-07-22 03:50:04.618 ERROR nova.compute.manager [req-d45a250c-bef9-4b42-96d3-187296dba8b0 admin demo] [instance: 30003b95-d88a-41f7-8ee2-44bffc524576] Setting instance vm_state to ERROR\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576] Traceback (most recent call last):\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/compute/manager.py\", line 3656, in finish_resize\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     disk_info, image)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/compute/manager.py\", line 3624, in _finish_resize\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     block_device_info, power_on)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5053, in finish_migration\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     block_device_info=None, inject_files=False)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2559, in _create_image\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     fileutils.ensure_tree(libvirt_utils.get_instance_path(instance))\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/opt/stack/nova/nova/openstack/common/fileutils.py\", line 35, in ensure_tree\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     os.makedirs(path)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]   File \"/usr/lib/python2.7/os.py\", line 157, in makedirs\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]     mkdir(name, mode)\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576] OSError: [Errno 28] No space left on device: '/mnt/stack/data/nova/instances/30003b95-d88a-41f7-8ee2-44bffc524576'\n2014-07-22 03:50:04.618 TRACE nova.compute.manager [instance: 30003b95-d88a-41f7-8ee2-44bffc524576]", 
            "date_created": "2014-08-06 08:29:00.142180+00:00", 
            "author": "https://api.launchpad.net/1.0/~ankitagrawal"
        }, 
        {
            "content": "This seems like something we should fix.", 
            "date_created": "2014-09-10 13:27:00.547714+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Hi,\n\nThis issue gets reproduced after setting 'disk_allocation_ratio' configuration greater than 1 and when disk is full.\n\nAlso after getting exception '_resize' directory is getting deleted in 'migrate_disk_and_power_off' call (https://github.com/openstack/nova/blob/master/nova/virt/libvirt/driver.py#L6740). \nAfter this instance is set to error state.\n\nIf instance goes in to error state because of disk full error while resizing,\nthen normal user can recover instance using hard reboot api.", 
            "date_created": "2015-09-15 06:11:06.876172+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhijeet-malawade"
        }, 
        {
            "content": "Abhijeet Malawade, are you still working on this bug?\n\n\"If instance goes in to error state because of disk full error while resizing,\nthen normal user can recover instance using hard reboot api.\"\n\nFrom the above message looks like the issue is fixed right?", 
            "date_created": "2016-06-15 17:50:39.963268+00:00", 
            "author": "https://api.launchpad.net/1.0/~anusha-unnam"
        }, 
        {
            "content": "\nThis is an automated cleanup. This bug report has been closed because it\nis older than 18 months and there is no open code change to fix this.\nAfter this time it is unlikely that the circumstances which lead to\nthe observed issue can be reproduced.\n\nIf you can reproduce the bug, please:\n* reopen the bug report (set to status \"New\")\n* AND add the detailed steps to reproduce the issue (if applicable)\n* AND leave a comment \"CONFIRMED FOR: <RELEASE_NAME>\"\n  Only still supported release names are valid (LIBERTY, MITAKA, OCATA, NEWTON).\n  Valid example: CONFIRMED FOR: LIBERTY\n", 
            "date_created": "2016-07-05 09:51:24.881285+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}