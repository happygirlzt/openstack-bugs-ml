{
    "status": "In Progress", 
    "last_updated": "2017-05-24 21:09:40.949765+00:00", 
    "description": "I was seeing a user pass an uppercase UUID from their app to the Nova API's. Their calls failed with a 500 error and the following exception in the nova-api log:\n\n017-05-24 11:20:27.176 68631 ERROR nova.api.openstack [req-674b4fd1-9a22-488e-97d2-29fca9ca3b7c 98afbc5675e059f7b1dde34c44d615712e3aafed8afcdfb5d890276ec554e737 951955d46e3a45c99e4c8649e8abe247 - - -] Caught error: 'NoneType' object has no attribute 'get'\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack Traceback (most recent call last):\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/__init__.py\", line 139, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return req.get_response(self.application)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1317, in send\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     application, catch_exc_info=False)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1281, in call_application\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return resp(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py\", line 467, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     response = req.get_response(self._app)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1317, in send\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     application, catch_exc_info=False)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1281, in call_application\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return resp(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return resp(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/routes/middleware.py\", line 131, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     response = self.app(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return resp(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 672, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     content_type, body, accept)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 756, in _process_stack\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     request, action_args)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 619, in post_process_extensions\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     **action_args)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/hide_server_addresses.py\", line 63, in show\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     self._perhaps_hide_addresses(instance, resp.obj['server'])\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/hide_server_addresses.py\", line 52, in _perhaps_hide_addresses\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     if instance.get('vm_state') in self.hide_address_states:\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack AttributeError: 'NoneType' object has no attribute 'get'\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack\n2017-05-24 11:20:27.177 68631 INFO nova.api.openstack [req-674b4fd1-9a22-488e-97d2-29fca9ca3b7c 98afbc5675e059f7b1dde34c44d615712e3aafed8afcdfb5d890276ec554e737 - - -] http://api.d1cp1.ttc.openstack.target.com:8774/v2.1/<>/servers/5100C340-8967-4DB1-97F7-BFA1C155F250 returned with HTTP 500\n\nHaving the user pass lowercase UUID's in their app fixes the client issue, but it would be nice if the API's would sanitize UUID's or at least kick out a more friendly error.", 
    "tags": [
        "api"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1693335", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1693335, 
    "index": 4827, 
    "created": "2017-05-24 19:25:22.451026+00:00", 
    "title": "UUID case sensitivity causing unfriendly and unexpected API errors", 
    "comments": [
        {
            "content": "I was seeing a user pass an uppercase UUID from their app to the Nova API's. Their calls failed with a 500 error and the following exception in the nova-api log:\n\n017-05-24 11:20:27.176 68631 ERROR nova.api.openstack [req-674b4fd1-9a22-488e-97d2-29fca9ca3b7c 98afbc5675e059f7b1dde34c44d615712e3aafed8afcdfb5d890276ec554e737 951955d46e3a45c99e4c8649e8abe247 - - -] Caught error: 'NoneType' object has no attribute 'get'\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack Traceback (most recent call last):\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/__init__.py\", line 139, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return req.get_response(self.application)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1317, in send\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     application, catch_exc_info=False)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1281, in call_application\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return resp(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py\", line 467, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     response = req.get_response(self._app)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1317, in send\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     application, catch_exc_info=False)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1281, in call_application\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return resp(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return resp(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/routes/middleware.py\", line 131, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     response = self.app(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return resp(environ, start_response)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 672, in __call__\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     content_type, body, accept)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 756, in _process_stack\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     request, action_args)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py\", line 619, in post_process_extensions\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     **action_args)\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/hide_server_addresses.py\", line 63, in show\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     self._perhaps_hide_addresses(instance, resp.obj['server'])\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/hide_server_addresses.py\", line 52, in _perhaps_hide_addresses\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack     if instance.get('vm_state') in self.hide_address_states:\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack AttributeError: 'NoneType' object has no attribute 'get'\n2017-05-24 11:20:27.176 68631 ERROR nova.api.openstack\n2017-05-24 11:20:27.177 68631 INFO nova.api.openstack [req-674b4fd1-9a22-488e-97d2-29fca9ca3b7c 98afbc5675e059f7b1dde34c44d615712e3aafed8afcdfb5d890276ec554e737 951955d46e3a45c99e4c8649e8abe247 - - -] http://api.d1cp1.ttc.openstack.target.com:8774/v2.1/951955d46e3a45c99e4c8649e8abe247/servers/5100C340-8967-4DB1-97F7-BFA1C155F250 returned with HTTP 500\n\nHaving the user pass lowercase UUID's in their app fixes the client issue, but it would be nice if the API's would sanitize UUID's or at least kick out a more friendly error.", 
            "date_created": "2017-05-24 19:25:22.451026+00:00", 
            "author": "https://api.launchpad.net/1.0/~ryan-tidwell"
        }, 
        {
            "content": "I forgot to mention I'm seeing this on stable/mitaka, but looks like it could still be an issue on master.", 
            "date_created": "2017-05-24 19:27:36.201517+00:00", 
            "author": "https://api.launchpad.net/1.0/~ryan-tidwell"
        }, 
        {
            "content": "The problem is the hide_server_addresses extension is looking for the instance in the request cache using the id passed in via the client, which is upper case, and the id key in the cache is from the db, which is lower-case, so it doesn't find the instance and blows up with a TypeError because it's not checking for None. This is something you'll hit with mysql which is case insensitive so it can find the instance but doesn't cache it using the same key.", 
            "date_created": "2017-05-24 21:03:56.650295+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/467772", 
            "date_created": "2017-05-24 21:09:40.546713+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}