{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:04:30.167579+00:00", 
    "description": "I am trying to track down why DNS domains are not being returned from API calls, from both the python-novaclient library and also from calls in OpenStack to nova/network/manager:NetworkManager._validate_instance_zone_for_dns_domain , which calls self.db.dnsdomain_get, which returns a null set from the database.\n\n2012-07-20 15:47:42 ERROR nova.rpc.amqp [req-4dc9eba4-8f68-463d-a2b0-5d4afcca8d16 923149ed7a08452c96063f3829fef039611ab6c4f3874215986cddb00030498a] Exception during message handling\n2012-07-20 15:47:42 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 253, in _rocess_data\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 25, in wrapped\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 32, in allocate_for_instance\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     **kwargs)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 25, in wrapped\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 90, in allocate_for_instance\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     requested_networks=requested_networks)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 21, in _allocate_fixed_ips\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     vpn=vpn, address=address)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 118, in allocate_fixed_ip\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     if self._validate_instance_zone_for_dns_domain(context, instance_id):\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 119, in _validate_instance_zone_for_dns_domain\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     dns_zone = domainref.availability_zone\n2012-07-20 15:47:42 TRACE nova.rpc.amqp AttributeError: 'NoneType' object has no attribute 'availability_zone'\n2012-07-20 15:47:42 TRACE nova.rpc.amqp \n2012-07-20 15:47:42 ERROR nova.rpc.amqp [req-4dc9eba4-8f68-463d-a2b0-5d4afcca8d16 923149ed7a08452c96063f3829fef039 611ab6c4f3874215986cddb00030498a] Returning exception 'NoneType' object has no attribute 'availability_zone' to caller\n\nstack@devstack:~$ mysql -e \"use nova; SELECT * FROM dns_domains\"\nstack@devstack:~$ nova dns-create-private-domain test1.net\nPlease input your password for the keyring\nstack@devstack:~$ mysql -e \"use nova; SELECT * FROM dns_domains\"\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\n| created_at          | updated_at | deleted_at | deleted | domain    | scope   | availability_zone | project_id |\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\n| 2012-07-19 22:25:09 | NULL       | NULL       |       0 | test1.net | private | NULL              | NULL       |\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\nstack@devstack:~$ nova dns-domains\nPlease input your password for the keyring\n\nstack@devstack:~$ nova dns-create-public-domain test2.net\nPlease input your password for the keyring\nstack@devstack:~$ mysql -e \"use nova; SELECT * FROM dns_domains\"\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\n| created_at          | updated_at | deleted_at | deleted | domain    | scope   | availability_zone | project_id |\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\n| 2012-07-19 22:25:09 | NULL       | NULL       |       0 | test1.net | private | NULL              | NULL       |\n| 2012-07-19 22:31:06 | NULL       | NULL       |       0 | test2.net | public  | NULL              | NULL       |\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\nstack@devstack:~$ nova dns-domains\nPlease input your password for the keyring", 
    "tags": [], 
    "importance": "Low", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1027998", 
    "owner": "https://api.launchpad.net/1.0/~dims-v", 
    "id": 1027998, 
    "index": 5517, 
    "created": "2012-07-23 15:32:57.412925+00:00", 
    "title": "db.dnsdomain_get API calls return no results", 
    "comments": [
        {
            "content": "I am trying to track down why DNS domains are not being returned from API calls, from both the python-novaclient library and also from calls in OpenStack to nova/network/manager:NetworkManager._validate_instance_zone_for_dns_domain , which calls self.db.dnsdomain_get, which returns a null set from the database.\n\n2012-07-20 15:47:42 ERROR nova.rpc.amqp [req-4dc9eba4-8f68-463d-a2b0-5d4afcca8d16 923149ed7a08452c96063f3829fef039611ab6c4f3874215986cddb00030498a] Exception during message handling\n2012-07-20 15:47:42 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 253, in _rocess_data\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 25, in wrapped\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 32, in allocate_for_instance\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     **kwargs)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 25, in wrapped\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 90, in allocate_for_instance\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     requested_networks=requested_networks)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 21, in _allocate_fixed_ips\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     vpn=vpn, address=address)\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 118, in allocate_fixed_ip\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     if self._validate_instance_zone_for_dns_domain(context, instance_id):\n2012-07-20 15:47:42 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 119, in _validate_instance_zone_for_dns_domain\n2012-07-20 15:47:42 TRACE nova.rpc.amqp     dns_zone = domainref.availability_zone\n2012-07-20 15:47:42 TRACE nova.rpc.amqp AttributeError: 'NoneType' object has no attribute 'availability_zone'\n2012-07-20 15:47:42 TRACE nova.rpc.amqp \n2012-07-20 15:47:42 ERROR nova.rpc.amqp [req-4dc9eba4-8f68-463d-a2b0-5d4afcca8d16 923149ed7a08452c96063f3829fef039 611ab6c4f3874215986cddb00030498a] Returning exception 'NoneType' object has no attribute 'availability_zone' to caller\n\nstack@devstack:~$ mysql -e \"use nova; SELECT * FROM dns_domains\"\nstack@devstack:~$ nova dns-create-private-domain test1.net\nPlease input your password for the keyring\nstack@devstack:~$ mysql -e \"use nova; SELECT * FROM dns_domains\"\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\n| created_at          | updated_at | deleted_at | deleted | domain    | scope   | availability_zone | project_id |\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\n| 2012-07-19 22:25:09 | NULL       | NULL       |       0 | test1.net | private | NULL              | NULL       |\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\nstack@devstack:~$ nova dns-domains\nPlease input your password for the keyring\n\nstack@devstack:~$ nova dns-create-public-domain test2.net\nPlease input your password for the keyring\nstack@devstack:~$ mysql -e \"use nova; SELECT * FROM dns_domains\"\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\n| created_at          | updated_at | deleted_at | deleted | domain    | scope   | availability_zone | project_id |\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\n| 2012-07-19 22:25:09 | NULL       | NULL       |       0 | test1.net | private | NULL              | NULL       |\n| 2012-07-19 22:31:06 | NULL       | NULL       |       0 | test2.net | public  | NULL              | NULL       |\n+---------------------+------------+------------+---------+-----------+---------+-------------------+------------+\nstack@devstack:~$ nova dns-domains\nPlease input your password for the keyring", 
            "date_created": "2012-07-23 15:32:57.412925+00:00", 
            "author": "https://api.launchpad.net/1.0/~scollins"
        }, 
        {
            "content": "Hi Sean,\n\nDo you have floating_ip_dns_manager and instance_dns_manager set to something other than nova.network.dns_driver.DNSDriver in your nova.conf file?\n\nBy default Nova uses dns_driver.DNSDriver which is meant to be an interface only but actually returns empty results sets or 'pass' for many of its functions. This can be a bit confusing (like you mention above).\n\nI think perhaps we should just update that default interface to raise NotImplementedError instead which would make it much more clear that using this functionally requires a bit more configuration.", 
            "date_created": "2012-08-22 19:02:06.400247+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "I still don't understand how that would affect the db.dnsdomain_get call - which uses the SQLAlchemy backend to query the MySQL database - and that is returning no results.", 
            "date_created": "2012-09-11 17:58:45.237535+00:00", 
            "author": "https://api.launchpad.net/1.0/~scollins"
        }, 
        {
            "content": "i have a review in progress to switch defaults totally. right now the defaults are already set to the correct minidns based instance manager in devstack\n\nhttps://review.openstack.org/#/c/17494/", 
            "date_created": "2012-12-08 23:23:11.152148+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/17494\nCommitted: http://github.com/openstack/nova/commit/6b50880c6e9e01c4f4b12579592155dfd94b4b96\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6b50880c6e9e01c4f4b12579592155dfd94b4b96\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Tue Dec 4 13:09:09 2012 -0500\n\n    Raise NotImplementedError in dns_driver.DNSDriver.\n    \n    Updates dns_driver.DNSDriver so that we raise NotImplementedError\n    instead of returning empty result sets or passing. Since this\n    class is the default dns_driver for Nova it can be quite\n    confusing when it returns empty results (which actually\n    causes some HTTP 500 errors as well).\n    \n    We really need to switch the default floating/instance\n    dns managers to MiniDNS as smoketests fail otherwise we\n    currently use nova.network.dns_driver.DNSDriver which is\n    not correct\n    \n    Fixes LP Bug #1040236\n    Fixes LP Bug #1027998\n    \n    Change-Id: Id818bb00e0689d96db948872842c07d2cf1edd57\n", 
            "date_created": "2012-12-10 16:56:54.657592+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}