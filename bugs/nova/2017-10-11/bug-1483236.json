{
    "status": "Opinion", 
    "last_updated": "2016-07-12 15:46:06.955994+00:00", 
    "description": "I have multiple nova compute nodes and for maintenance reasons I want to disable one of them.\n\nMigration of a virtual machine is not possible, due to bug https://bugs.launchpad.net/cinder/+bug/1348811, so it would be ok, if it is not possible, to start a machine on that compute node.\n\nI stopped virtual machine \"foo\" on compute node \"bar\"\n$ nova stop 86db11f7-a1e4-4be0-880c-0720cd24c3aa\n\ndisabled nova-compute service\n$ sudo nova-manage service disable bar nova-compute\n\nand checked it with \n$ sudo nova-manage service list --host bar\n------------------------------------------\nBinary           Host                                 Zone             Status     State Updated_At\nnova-compute     bar                            Cluster X        disabled   :-)   2015-08-10 12:29:10\n------------------------------------------\n\nExpected result:\nVM foo is not able to run on that host\n\nActual result:\nVM foo is able to run on that host\n\n$ nova start 86db11f7-a1e4-4be0-880c-0720cd24c3aa\nThe machine is running \n\nI tested, if its possible to create new virtual machines on that compute node bar with the disabled nova-compute service\n$ nova boot --image \"c196615d-d3ed-49d7-8bc6-c65f8360aa02\" --flavor m1.smaller --nic net-id=6a38402f-4a5b-4239-a683-ceb4ae220c30 --availability-zone \"Cluster X\":bar foo2\n\nThis machine is also running. \n\nVersions:\n\n$ dpkg -l | grep nova\nii  nova-common                         1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute - common files\nii  nova-compute                        1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute - compute node base\nii  nova-compute-kvm                    1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute - compute node libvirt support\nii  python-nova                         1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute Python libraries\nii  python-novaclient                   1:2.17.0-0ubuntu1.2                   all          client library for OpenStack Compute API\n\n$ dpkg -l | grep ceph\nii  ceph-common                         0.94.1-1trusty                        amd64        common utilities to mount and interact with a ceph storage cluster\nii  ceph-fs-common                      0.94.1-1trusty                        amd64        common utilities to mount and interact with a ceph file system\nii  ceph-fuse                           0.94.1-1trusty                        amd64        FUSE-based client for the Ceph distributed file system\nii  libcephfs1                          0.94.1-1trusty                        amd64        Ceph distributed file system client library\nii  python-cephfs                       0.94.1-1trusty                        amd64        Python libraries for the Ceph libcephfs library", 
    "tags": [
        "compute", 
        "nova-manage"
    ], 
    "importance": "Wishlist", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1483236", 
    "owner": "None", 
    "id": 1483236, 
    "index": 1720, 
    "created": "2015-08-10 12:39:56.107414+00:00", 
    "title": "It\u00b4s not possible to disable the nova compute service on one compute node", 
    "comments": [
        {
            "content": "I have multiple nova compute nodes and for maintenance reasons I want to disable one of them.\n\nMigration of a virtual machine is not possible, due to bug https://bugs.launchpad.net/cinder/+bug/1348811, so it would be ok, if it is not possible, to start a machine on that compute node.\n\nI stopped virtual machine \"foo\" on compute node \"bar\"\n$ nova stop 86db11f7-a1e4-4be0-880c-0720cd24c3aa\n\ndisabled nova-compute service\n$ sudo nova-manage service disable bar nova-compute\n\nand checked it with \n$ sudo nova-manage service list --host bar\n------------------------------------------\nBinary           Host                                 Zone             Status     State Updated_At\nnova-compute     bar                            Cluster X        disabled   :-)   2015-08-10 12:29:10\n------------------------------------------\n\nExpected result:\nVM foo is not able to run on that host\n\nActual result:\nVM foo is able to run on that host\n\n$ nova start 86db11f7-a1e4-4be0-880c-0720cd24c3aa\nThe machine is running \n\nI tested, if its possible to create new virtual machines on that compute node bar with the disabled nova-compute service\n$ nova boot --image \"c196615d-d3ed-49d7-8bc6-c65f8360aa02\" --flavor m1.smaller --nic net-id=6a38402f-4a5b-4239-a683-ceb4ae220c30 --availability-zone \"Cluster X\":bar foo2\n\nThis machine is also running. \n\nVersions:\n\n$ dpkg -l | grep nova\nii  nova-common                         1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute - common files\nii  nova-compute                        1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute - compute node base\nii  nova-compute-kvm                    1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute - compute node libvirt support\nii  python-nova                         1:2014.1.4-0ubuntu2.1                 all          OpenStack Compute Python libraries\nii  python-novaclient                   1:2.17.0-0ubuntu1.2                   all          client library for OpenStack Compute API\n\n$ dpkg -l | grep ceph\nii  ceph-common                         0.94.1-1trusty                        amd64        common utilities to mount and interact with a ceph storage cluster\nii  ceph-fs-common                      0.94.1-1trusty                        amd64        common utilities to mount and interact with a ceph file system\nii  ceph-fuse                           0.94.1-1trusty                        amd64        FUSE-based client for the Ceph distributed file system\nii  libcephfs1                          0.94.1-1trusty                        amd64        Ceph distributed file system client library\nii  python-cephfs                       0.94.1-1trusty                        amd64        Python libraries for the Ceph libcephfs library", 
            "date_created": "2015-08-10 12:39:56.107414+00:00", 
            "author": "https://api.launchpad.net/1.0/~christian-schmitz-1"
        }, 
        {
            "content": "So that behaviour is as designed.\n\nDisabled only stops new instances landing on that host. You can still manage your existing instances. The intent is to allow an admin to migrate or live-migrate instances off the host.\n\nI think we probably want some extra level of disabled to signal that existing VMs should not bar allowed to have any action performed.\n\nFWIW stopping nova-compute might be what you want to do. That would stop instance from running again. In fact if you configure nova correctly, when you start nova-compute it will start back up only the VMs that were running when it shutdown.", 
            "date_created": "2016-07-12 15:45:07.316121+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "To reopen this, it's best to submit a spec or backlog spec to spark discussion on the topic. I consider this a feature not a bug.", 
            "date_created": "2016-07-12 15:46:05.842217+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }
    ]
}