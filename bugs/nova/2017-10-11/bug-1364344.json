{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:59:04.585872+00:00", 
    "description": "Description of problem:\n=======================\npyhton-novaclient produces a wrong exception when user tries to boot an instance without specific network UUID.\nThe issue will only reproduce when an external network is shared with the tenant, but not created from within it (I created it in admin tenant).\n\nVersion-Release:\n================\npython-novaclient-2.17.0-2\n\nHow reproducible:\n=================\nAlways\n\nSteps to Reproduce:\n===================\n1. Have 2 tenants (admin + additional tenant would do).\n2. In tenant A (admin), Create a network and mark it as both shared and external.\n3. In tenant B, Create a network which is not shared or external.\n4. Boot an instance within tenant B (I tested this via CLI), do not use the --nic option.\n\nActual results:\n===============\nDEBUG (shell:783) It is not allowed to create an interface on external network 49d0cb8a-2631-4308-89c4-cac502ef0bad (HTTP 403) (Request-ID: req-caacfa72-82f8-492a-8ce2-9476be8f3e0c)\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/novaclient/shell.py\", line 780, in main\n    OpenStackComputeShell().main(map(strutils.safe_decode, sys.argv[1:]))\n  File \"/usr/lib/python2.7/site-packages/novaclient/shell.py\", line 716, in main\n    args.func(self.cs, args)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/shell.py\", line 433, in do_boot\n    server = cs.servers.create(*boot_args, **boot_kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/servers.py\", line 871, in create\n    **boot_kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/servers.py\", line 534, in _boot\n    return_raw=return_raw, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/base.py\", line 152, in _create\n    _resp, body = self.api.client.post(url, body=body)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 312, in post\n    return self._cs_request(url, 'POST', **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 286, in _cs_request\n    **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 268, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 262, in request\n    raise exceptions.from_response(resp, body, url, method)\nForbidden: It is not allowed to create an interface on external network 49d0cb8a-2631-4308-89c4-cac502ef0bad (HTTP 403) (Request-ID: req-afce2569-6902-4b25-a9b8-9ebf1a6ce1b9)\nERROR: It is not allowed to create an interface on external network 49d0cb8a-2631-4308-89c4-cac502ef0bad (HTTP 403) (Request-ID: req-afce2569-6902-4b25-a9b8-9ebf1a6ce1b9)\n\nExpected results:\n=================\nThis is what happens if:\n1. The shared network is no longer marked as external.\n2. The tenant itself has two networks.\n\n(+ no network UUID is speficied in the 'nova boot' command)\n\n\nDEBUG (shell:783) Multiple possible networks found, use a Network ID to be more specific. (HTTP 400) (Request-ID: req-a4e90abd-2ad7-4342-aa3c-1a9aa9f5e2a0)\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/novaclient/shell.py\", line 780, in main\n    OpenStackComputeShell().main(map(strutils.safe_decode, sys.argv[1:]))\n  File \"/usr/lib/python2.7/site-packages/novaclient/shell.py\", line 716, in main\n    args.func(self.cs, args)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/shell.py\", line 433, in do_boot\n    server = cs.servers.create(*boot_args, **boot_kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/servers.py\", line 871, in create\n    **boot_kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/servers.py\", line 534, in _boot\n    return_raw=return_raw, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/base.py\", line 152, in _create\n    _resp, body = self.api.client.post(url, body=body)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 312, in post\n    return self._cs_request(url, 'POST', **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 286, in _cs_request\n    **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 268, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 262, in request\n    raise exceptions.from_response(resp, body, url, method)\nBadRequest: Multiple possible networks found, use a Network ID to be more specific. (HTTP 400) (Request-ID: req-a4e90abd-2ad7-4342-aa3c-1a9aa9f5e2a0)\nERROR: Multiple possible networks found, use a Network ID to be more specific. (HTTP 400) (Request-ID: req-a4e90abd-2ad7-4342-aa3c-1a9aa9f5e2a0)", 
    "tags": [
        "neutron"
    ], 
    "importance": "Medium", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1364344", 
    "owner": "https://api.launchpad.net/1.0/~melwitt", 
    "id": 1364344, 
    "index": 4006, 
    "created": "2014-09-02 11:58:19.450112+00:00", 
    "title": "Nova client produces a wrong exception when user tries to boot an instance without specific network UUID", 
    "comments": [
        {
            "content": "Description of problem:\n=======================\npyhton-novaclient produces a wrong exception when user tries to boot an instance without specific network UUID.\nThe issue will only reproduce when an external network is shared with the tenant, but not created from within it (I created it in admin tenant).\n\nVersion-Release:\n================\npython-novaclient-2.17.0-2\n\nHow reproducible:\n=================\nAlways\n\nSteps to Reproduce:\n===================\n1. Have 2 tenants (admin + additional tenant would do).\n2. In tenant A (admin), Create a network and mark it as both shared and external.\n3. In tenant B, Create a network which is not shared or external.\n4. Boot an instance within tenant B (I tested this via CLI), do not use the --nic option.\n\nActual results:\n===============\nDEBUG (shell:783) It is not allowed to create an interface on external network 49d0cb8a-2631-4308-89c4-cac502ef0bad (HTTP 403) (Request-ID: req-caacfa72-82f8-492a-8ce2-9476be8f3e0c)\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/novaclient/shell.py\", line 780, in main\n    OpenStackComputeShell().main(map(strutils.safe_decode, sys.argv[1:]))\n  File \"/usr/lib/python2.7/site-packages/novaclient/shell.py\", line 716, in main\n    args.func(self.cs, args)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/shell.py\", line 433, in do_boot\n    server = cs.servers.create(*boot_args, **boot_kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/servers.py\", line 871, in create\n    **boot_kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/servers.py\", line 534, in _boot\n    return_raw=return_raw, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/base.py\", line 152, in _create\n    _resp, body = self.api.client.post(url, body=body)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 312, in post\n    return self._cs_request(url, 'POST', **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 286, in _cs_request\n    **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 268, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 262, in request\n    raise exceptions.from_response(resp, body, url, method)\nForbidden: It is not allowed to create an interface on external network 49d0cb8a-2631-4308-89c4-cac502ef0bad (HTTP 403) (Request-ID: req-afce2569-6902-4b25-a9b8-9ebf1a6ce1b9)\nERROR: It is not allowed to create an interface on external network 49d0cb8a-2631-4308-89c4-cac502ef0bad (HTTP 403) (Request-ID: req-afce2569-6902-4b25-a9b8-9ebf1a6ce1b9)\n\nExpected results:\n=================\nThis is what happens if:\n1. The shared network is no longer marked as external.\n2. The tenant itself has two networks.\n\n(+ no network UUID is speficied in the 'nova boot' command)\n\n\nDEBUG (shell:783) Multiple possible networks found, use a Network ID to be more specific. (HTTP 400) (Request-ID: req-a4e90abd-2ad7-4342-aa3c-1a9aa9f5e2a0)\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/novaclient/shell.py\", line 780, in main\n    OpenStackComputeShell().main(map(strutils.safe_decode, sys.argv[1:]))\n  File \"/usr/lib/python2.7/site-packages/novaclient/shell.py\", line 716, in main\n    args.func(self.cs, args)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/shell.py\", line 433, in do_boot\n    server = cs.servers.create(*boot_args, **boot_kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/servers.py\", line 871, in create\n    **boot_kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/v1_1/servers.py\", line 534, in _boot\n    return_raw=return_raw, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/base.py\", line 152, in _create\n    _resp, body = self.api.client.post(url, body=body)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 312, in post\n    return self._cs_request(url, 'POST', **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 286, in _cs_request\n    **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 268, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/novaclient/client.py\", line 262, in request\n    raise exceptions.from_response(resp, body, url, method)\nBadRequest: Multiple possible networks found, use a Network ID to be more specific. (HTTP 400) (Request-ID: req-a4e90abd-2ad7-4342-aa3c-1a9aa9f5e2a0)\nERROR: Multiple possible networks found, use a Network ID to be more specific. (HTTP 400) (Request-ID: req-a4e90abd-2ad7-4342-aa3c-1a9aa9f5e2a0)", 
            "date_created": "2014-09-02 11:58:19.450112+00:00", 
            "author": "https://api.launchpad.net/1.0/~nmagnezi"
        }, 
        {
            "content": "I tried to replicate this bug on the following version:\nName: python-novaclient\nVersion: 2.18.2.dev42.g9758ffc\n\nWhen I try to boot an instance within tenant B without  the --nic option, It throws the expected error,\nERROR (BadRequest): Multiple possible networks found, use a Network ID to be more specific. (HTTP 400) (Request-ID: \nreq-dfc746f5-50c1-4b63-9137-66ec6e52cf91)\n\nSo, as per the expected reslut mentioned in the bug description it seems that it has been fixed.\n\n\n", 
            "date_created": "2014-09-04 12:01:26.969261+00:00", 
            "author": "https://api.launchpad.net/1.0/~kanchan-gupta1"
        }, 
        {
            "content": "This is a bug in nova neutronv2 api.", 
            "date_created": "2014-09-13 08:11:28.393944+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/121330", 
            "date_created": "2014-09-13 08:14:44.758757+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/121330\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=3e11db0e3b832703feafe8317c0c12fb0a149e53\nSubmitter: Jenkins\nBranch:    master\n\ncommit 3e11db0e3b832703feafe8317c0c12fb0a149e53\nAuthor: melanie witt <email address hidden>\nDate:   Sat Sep 13 08:04:12 2014 +0000\n\n    check network ambiguity before external network auth\n    \n    This change refactors the logic in the neutronv2 api to check for\n    network ambiguity before checking permission to attach external\n    network. In the scenario when there is a network available in the\n    client's tenant and an external shared network available in a\n    different tenant, the client was receiving a Forbidden error\n    because the external network was in the list of available networks\n    even though the client did have access to the other network in the\n    list.\n    \n    With this change, the client receives a NetworkAmbiguous error instead\n    the same scenario, as they could succeed in booting an instance while\n    specifying --nic with the net-id of the network they can access.\n    \n    Closes-Bug: #1364344\n    \n    Change-Id: Ia94c25ff0ffd6a368da272fc6d883986156a0362\n", 
            "date_created": "2014-09-15 21:43:07.273816+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}