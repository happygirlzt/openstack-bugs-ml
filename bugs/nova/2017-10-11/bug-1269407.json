{
    "status": "Invalid", 
    "last_updated": "2014-03-19 17:31:02.429894+00:00", 
    "description": "When deleting an instance, the port list is not updated immediately. As a result - deleting net/subnet fails with error:\n\n409-{u'NeutronError': {u'message': u'Unable to complete operation on subnet UUID. One or more ports have an IP allocation from this subnet.', u'type': u'SubnetInUse', u'detail': u''}}\n\n(*) Happens only on automated scripts, since manual input isn't quick enough to catch this.\n\n(**) Happens only when Floating IP is attached - error doesn't happen when Floating IP isn't used.\nmy guess: Nova delays in deleting the VM while checking with neutron DB that Floating IP was deleted.\n\n(***) nova delete command returns BEFORE instance is deleted:\n> nova delete $instance_id ; nova show $instance_id\nwill return the instance without failure\n\n(*****) might also affect Tempest during tearDown execution\n\n\nVersion:\nopenstack-nova-api-2014.1-0.5.b1.el6.noarch\nopenstack-nova-compute-2014.1-0.5.b1.el6.noarch\nopenstack-nova-scheduler-2014.1-0.5.b1.el6.noarch\nopenstack-nova-console-2014.1-0.5.b1.el6.noarch\nopenstack-nova-conductor-2014.1-0.5.b1.el6.noarch\nopenstack-nova-cert-2014.1-0.5.b1.el6.noarch\n\npython-neutron-2014.1-0.1.b1.el6.noarch\nopenstack-neutron-2014.1-0.1.b1.el6.noarch\nopenstack-neutron-openvswitch-2014.1-0.1.b1.el6.noarch\n\nHow to reproduce:\n**** script attached ****\nassumes:\n1. external network exists with floating ip range available (\"public\")\n2. image exists\n\nSetup:\n1 create network \"private\"\n2. create subnet\n3. create router:\n3.1 set router gateway to \"public\"\n3.2 set router interface to \"private\"\n4. create VM\n5. assign Floating IP to VM\n\nTearDown\n1. Delete / Disassociate Floating IP\n2. Delete VM\n3. detach router interface from subnet (router-interface-delete)\n4. Delete subnet/net\n\nExpected Result:\nsubnet/net should be successfully deleted.\n\nActual Results:\n\"Unable to complete operation on subnet UUID. One or more ports have an IP allocation from this subnet\"\n\n409-{u'NeutronError': {u'message': u'Unable to complete operation on subnet UUID. One or more ports have an IP allocation from this subnet.', u'type': u'SubnetInUse', u'detail': u''}}\n\nscript log:\n\nline 101 - VM port still in port list even though VM was deleted\nline 105 - subnet fails to delete\nline 117 - network successfully deleted after enough time passed for port list to update\n\n\u00a0\u00a01 + EXT_NET_NAME=public\n\u00a0\u00a02 + NET_NAME=my_net\n\u00a0\u00a03 + SUBNET_NAME=my_subnet\n\u00a0\u00a04 + ROUTER_NAME=my_router\n\u00a0\u00a05 + SERVER_NAME=my_server\n\u00a0\u00a06 + IMAGE_NAME='cirros-0.3.1-x86_64-uec '\n\u00a0\u00a07 + MASK=54.0.0\n\u00a0\u00a08 + SERVER_IP=54.0.0.6\n\u00a0\u00a09 ++ neutron net-list\n\u00a010 ++ grep public\n\u00a011 ++ awk '{print $2;}'\n\u00a012 + EXT_NET_ID=200a91cf-5376-4095-8722-2f247ddb01c9\n\u00a013 ++ nova image-list\n\u00a014 ++ grep -w ' cirros-0.3.1-x86_64-uec  '\n\u00a015 ++ awk '{print $2;}'\n\u00a016 + IMAGE_ID=1f16b297-aeaa-4fa9-9640-269695b6eb48\n\u00a017 ++ grep -w id\n\u00a018 ++ neutron net-create my_net\n\u00a019 ++ awk '{print $4;}'\n\u00a020 + NET_ID=6ec5ef65-5279-4bbd-919a-b45a27bb31cd\n\u00a021 ++ neutron subnet-create --name my_subnet 6ec5ef65-5279-4bbd-919a-b45a27bb31cd 54.0.0.0/24\n\u00a022 ++ grep -w id\n\u00a023 ++ awk '{print $4;}'\n\u00a024 + SUBNET_ID=76abfa0f-938a-4be1-abd5-804af306fa2d\n\u00a025 ++ neutron router-create my_router\n\u00a026 ++ awk '{print $4;}'\n\u00a027 ++ grep -w id\n\u00a028 + ROUTER_ID=df211133-0513-44fc-bec5-38f9bca74025\n\u00a029 + neutron router-gateway-set df211133-0513-44fc-bec5-38f9bca74025 200a91cf-5376-4095-8722-2f247ddb01c9\n\u00a030 Set gateway for router df211133-0513-44fc-bec5-38f9bca74025\n\u00a031 + neutron router-interface-add df211133-0513-44fc-bec5-38f9bca74025 76abfa0f-938a-4be1-abd5-804af306fa2d\n\u00a032 Added interface cafd4161-f840-4c87-a80b-71b0ef374b9e to router df211133-0513-44fc-bec5-38f9bca74025.\n\u00a033 + nova boot --flavor 2 --image 1f16b297-aeaa-4fa9-9640-269695b6eb48 my_server --nic net-id=6ec5ef65-5279-4bbd-919a-b45a27bb31cd,v4-fixed-ip=54.0.0.6\n\u00a034 +--------------------------------------+--------------------------------------+\n\u00a035 | Property                             | Value                                |\n\u00a036 +--------------------------------------+--------------------------------------+\n\u00a037 | OS-DCF:diskConfig                    | MANUAL                               |\n\u00a038 | OS-EXT-AZ:availability_zone          | nova                                 |\n\u00a039 | OS-EXT-STS:power_state               | 0                                    |\n\u00a040 | OS-EXT-STS:task_state                | scheduling                           |\n\u00a041 | OS-EXT-STS:vm_state                  | building                             |\n\u00a042 | OS-SRV-USG:launched_at               | None                                 |\n\u00a043 | OS-SRV-USG:terminated_at             | None                                 |\n\u00a044 | accessIPv4                           |                                      |\n\u00a045 | accessIPv6                           |                                      |\n\u00a046 | adminPass                            | 9VJ9XMrtFghW                         |\n\u00a047 | config_drive                         |                                      |\n\u00a048 | created                              | 2014-01-15T12:56:30Z                 |\n\u00a049 | flavor                               | m1.small                             |\n\u00a050 | hostId                               |                                      |\n\u00a051 | id                                   | d09bbee1-599c-4042-a409-a90e0ae80e3c |\n\u00a052 | image                                | cirros-0.3.1-x86_64-uec              |\n\u00a053 | key_name                             | None                                 |\n\u00a054 | metadata                             | {}                                   |\n\u00a055 | name                                 | my_server                            |\n\u00a056 | os-extended-volumes:volumes_attached | []                                   |\n\u00a057 | progress                             | 0                                    |\n\u00a058 | security_groups                      | [{\"name\": \"default\"}]                |\n\u00a059 | status                               | BUILD                                |\n\u00a060 | tenant_id                            | 66293febf7164c849b694a8d3f14cc1a     |\n\u00a061 | updated                              | 2014-01-15T12:56:30Z                 |\n\u00a062 | user_id                              | e895d5bf0dc64d44b707b9fbf5cbf6e0     |\n\u00a063 +--------------------------------------+--------------------------------------+\n\u00a064 ++ nova list\n\u00a065 ++ grep my_server\n\u00a066 ++ awk '{print $2;}'\n\u00a067 + SERVER_ID=d09bbee1-599c-4042-a409-a90e0ae80e3c\n\u00a068 ++ neutron port-list\n\u00a069 ++ grep 54.0.0.6\n\u00a070 ++ awk '{print $2;}'\n\u00a071 + SERVER_PORT_ID=21981e00-6fe2-4f6e-a265-d0c357a1a449\n\u00a072 ++ neutron floatingip-create 200a91cf-5376-4095-8722-2f247ddb01c9 --port_id 21981e00-6fe2-4f6e-a265-d0c357a1a449\n\u00a073 ++ grep floating_ip_address\n\u00a074 ++ awk '{print $4;}'\n\u00a075 + FLOATING_IP=172.24.4.4\n\u00a076 ++ neutron floatingip-list\n\u00a077 ++ awk '{print $2;}'\n\u00a078 ++ grep 172.24.4.4\n\u00a079 + FLOATING_IP_ID=1d77d791-9205-4ee4-8ae4-1a1dcf8dd153\n\u00a080 + neutron port-list\n\u00a081 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n\u00a082 | id                                   | name | mac_address       | fixed_ips                                                                       |\n\u00a083 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n\u00a084 | 06b3022f-5492-4baf-b7d9-43f0259337e3 |      | fa:16:3e:70:9e:bb | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.2\"} |\n\u00a085 | 13630e5f-51c2-42b9-901a-2a208e5f986a |      | fa:16:3e:08:63:0b | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.2\"} |\n\u00a086 | 21981e00-6fe2-4f6e-a265-d0c357a1a449 |      | fa:16:3e:38:5f:74 | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.6\"} |\n\u00a087 | 2a0a4134-37f2-4582-86ad-de0ce04b8f7e |      | fa:16:3e:aa:0d:b1 | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.1\"} |\n\u00a088 | cafd4161-f840-4c87-a80b-71b0ef374b9e |      | fa:16:3e:e3:75:36 | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.1\"} |\n\u00a089 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n\u00a090 + neutron floatingip-delete 1d77d791-9205-4ee4-8ae4-1a1dcf8dd153\n\u00a091 Deleted floatingip: 1d77d791-9205-4ee4-8ae4-1a1dcf8dd153\n\u00a092 + nova delete d09bbee1-599c-4042-a409-a90e0ae80e3c\n\u00a093 + neutron router-interface-delete df211133-0513-44fc-bec5-38f9bca74025 76abfa0f-938a-4be1-abd5-804af306fa2d\n\u00a094 Removed interface from router df211133-0513-44fc-bec5-38f9bca74025.\n\u00a095 + neutron port-list\n\u00a096 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n\u00a097 | id                                   | name | mac_address       | fixed_ips                                                                       |\n\u00a098 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n\u00a099 | 06b3022f-5492-4baf-b7d9-43f0259337e3 |      | fa:16:3e:70:9e:bb | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.2\"} |\n100 | 13630e5f-51c2-42b9-901a-2a208e5f986a |      | fa:16:3e:08:63:0b | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.2\"} |\n101 | 21981e00-6fe2-4f6e-a265-d0c357a1a449 |      | fa:16:3e:38:5f:74 | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.6\"} |\n102 | 2a0a4134-37f2-4582-86ad-de0ce04b8f7e |      | fa:16:3e:aa:0d:b1 | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.1\"} |\n103 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n104 + neutron subnet-delete 76abfa0f-938a-4be1-abd5-804af306fa2d\n105 409-{u'NeutronError': {u'message': u'Unable to complete operation on subnet 76abfa0f-938a-4be1-abd5-804af306fa2d. One or more ports have an IP allocation from this subnet.', u'type': u'SubnetInUse', u'detail': u''}}\n106 + neutron port-list\n107 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n108 | id                                   | name | mac_address       | fixed_ips                                                                       |\n109 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n110 | 06b3022f-5492-4baf-b7d9-43f0259337e3 |      | fa:16:3e:70:9e:bb | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.2\"} |\n111 | 13630e5f-51c2-42b9-901a-2a208e5f986a |      | fa:16:3e:08:63:0b | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.2\"} |\n112 | 2a0a4134-37f2-4582-86ad-de0ce04b8f7e |      | fa:16:3e:aa:0d:b1 | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.1\"} |\n113 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n114 + neutron router-delete df211133-0513-44fc-bec5-38f9bca74025\n115 Deleted router: df211133-0513-44fc-bec5-38f9bca74025\n116 + neutron net-delete 6ec5ef65-5279-4bbd-919a-b45a27bb31cd\n117 Deleted network: 6ec5ef65-5279-4bbd-919a-b45a27bb31cd\n118 + set +x", 
    "tags": [
        "network"
    ], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1269407", 
    "owner": "None", 
    "id": 1269407, 
    "index": 4475, 
    "created": "2014-01-15 13:04:27.093058+00:00", 
    "title": "Instance Termination delays in updating port list", 
    "comments": [
        {
            "content": "When deleting an instance, the port list is not updated immediately. As a result - deleting net/subnet fails with error: \n\n409-{u'NeutronError': {u'message': u'Unable to complete operation on subnet UUID. One or more ports have an IP allocation from this subnet.', u'type': u'SubnetInUse', u'detail': u''}}\n\n(*) Happens only on automated scripts, since manual input isn't quick enough to catch this.\n\n(**) Happens only when Floating IP is attached - error doesn't happen when Floating IP isn't used.\nmy guess: Nova delays in deleting the VM while checking with neutron DB that Floating IP was deleted.\n\n(***) nova delete command returns BEFORE instance is deleted:\n> nova delete $instance_id ; nova show $instance_id\nwill return the instance without failure\n\nHow to reproduce:\nassumes:\n1. external network exists with floating ip range available (\"public\")\n2. image exists\n\nSetup:\n1 create network \"private\"\n2. create subnet\n3. create router:\n3.1 set router gateway to \"public\"\n3.2 set router interface to \"private\"\n4. create VM\n5. assign Floating IP to VM\n\nTearDown\n1. Delete / Disassociate Floating IP\n2. Delete VM\n3. detach router interface from subnet (router-interface-delete)\n4. Delete subnet/net\n\nExpected Result:\nsubnet/net should be successfully deleted.\n\nActual Results:\n\"Unable to complete operation on subnet UUID. One or more ports have an IP allocation from this subnet\"\n\n409-{u'NeutronError': {u'message': u'Unable to complete operation on subnet UUID. One or more ports have an IP allocation from this subnet.', u'type': u'SubnetInUse', u'detail': u''}}\n\n\nscript log:\n\nline 101 - VM port still in port list even though VM was deleted\nline 105 - subnet fails to delete\nline 117 - network successfully deleted after enough time passed for port list to update\n\n\n  1 + EXT_NET_NAME=public\n  2 + NET_NAME=my_net\n  3 + SUBNET_NAME=my_subnet\n  4 + ROUTER_NAME=my_router\n  5 + SERVER_NAME=my_server\n  6 + IMAGE_NAME='cirros-0.3.1-x86_64-uec '\n  7 + MASK=54.0.0\n  8 + SERVER_IP=54.0.0.6\n  9 ++ neutron net-list\n 10 ++ grep public\n 11 ++ awk '{print $2;}'\n 12 + EXT_NET_ID=200a91cf-5376-4095-8722-2f247ddb01c9\n 13 ++ nova image-list\n 14 ++ grep -w ' cirros-0.3.1-x86_64-uec  '\n 15 ++ awk '{print $2;}'\n 16 + IMAGE_ID=1f16b297-aeaa-4fa9-9640-269695b6eb48\n 17 ++ grep -w id\n 18 ++ neutron net-create my_net\n 19 ++ awk '{print $4;}'\n 20 + NET_ID=6ec5ef65-5279-4bbd-919a-b45a27bb31cd\n 21 ++ neutron subnet-create --name my_subnet 6ec5ef65-5279-4bbd-919a-b45a27bb31cd 54.0.0.0/24\n 22 ++ grep -w id\n 23 ++ awk '{print $4;}'\n 24 + SUBNET_ID=76abfa0f-938a-4be1-abd5-804af306fa2d\n 25 ++ neutron router-create my_router\n 26 ++ awk '{print $4;}'\n 27 ++ grep -w id\n 28 + ROUTER_ID=df211133-0513-44fc-bec5-38f9bca74025\n 29 + neutron router-gateway-set df211133-0513-44fc-bec5-38f9bca74025 200a91cf-5376-4095-8722-2f247ddb01c9\n 30 Set gateway for router df211133-0513-44fc-bec5-38f9bca74025\n 31 + neutron router-interface-add df211133-0513-44fc-bec5-38f9bca74025 76abfa0f-938a-4be1-abd5-804af306fa2d\n 32 Added interface cafd4161-f840-4c87-a80b-71b0ef374b9e to router df211133-0513-44fc-bec5-38f9bca74025.\n 33 + nova boot --flavor 2 --image 1f16b297-aeaa-4fa9-9640-269695b6eb48 my_server --nic net-id=6ec5ef65-5279-4bbd-919a-b45a27bb31cd,v4-fixed-ip=54.0.0.6\n 34 +--------------------------------------+--------------------------------------+\n 35 | Property                             | Value                                |\n 36 +--------------------------------------+--------------------------------------+\n 37 | OS-DCF:diskConfig                    | MANUAL                               |\n 38 | OS-EXT-AZ:availability_zone          | nova                                 |\n 39 | OS-EXT-STS:power_state               | 0                                    |\n 40 | OS-EXT-STS:task_state                | scheduling                           |\n 41 | OS-EXT-STS:vm_state                  | building                             |\n 42 | OS-SRV-USG:launched_at               | None                                 |\n 43 | OS-SRV-USG:terminated_at             | None                                 |\n 44 | accessIPv4                           |                                      |\n 45 | accessIPv6                           |                                      |\n 46 | adminPass                            | 9VJ9XMrtFghW                         |\n 47 | config_drive                         |                                      |\n 48 | created                              | 2014-01-15T12:56:30Z                 |\n 49 | flavor                               | m1.small                             |\n 50 | hostId                               |                                      |\n 51 | id                                   | d09bbee1-599c-4042-a409-a90e0ae80e3c |\n 52 | image                                | cirros-0.3.1-x86_64-uec              |\n 53 | key_name                             | None                                 |\n 54 | metadata                             | {}                                   |\n 55 | name                                 | my_server                            |\n 56 | os-extended-volumes:volumes_attached | []                                   |\n 57 | progress                             | 0                                    |\n 58 | security_groups                      | [{\"name\": \"default\"}]                |\n 59 | status                               | BUILD                                |\n 60 | tenant_id                            | 66293febf7164c849b694a8d3f14cc1a     |\n 61 | updated                              | 2014-01-15T12:56:30Z                 |\n 62 | user_id                              | e895d5bf0dc64d44b707b9fbf5cbf6e0     |\n 63 +--------------------------------------+--------------------------------------+\n 64 ++ nova list\n 65 ++ grep my_server\n 66 ++ awk '{print $2;}'\n 67 + SERVER_ID=d09bbee1-599c-4042-a409-a90e0ae80e3c\n 68 ++ neutron port-list\n 69 ++ grep 54.0.0.6\n 70 ++ awk '{print $2;}'\n 71 + SERVER_PORT_ID=21981e00-6fe2-4f6e-a265-d0c357a1a449\n 72 ++ neutron floatingip-create 200a91cf-5376-4095-8722-2f247ddb01c9 --port_id 21981e00-6fe2-4f6e-a265-d0c357a1a449\n 73 ++ grep floating_ip_address\n 74 ++ awk '{print $4;}'\n 75 + FLOATING_IP=172.24.4.4\n 76 ++ neutron floatingip-list\n 77 ++ awk '{print $2;}'\n 78 ++ grep 172.24.4.4\n 79 + FLOATING_IP_ID=1d77d791-9205-4ee4-8ae4-1a1dcf8dd153\n 80 + neutron port-list\n 81 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n 82 | id                                   | name | mac_address       | fixed_ips                                                                       |\n 83 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n 84 | 06b3022f-5492-4baf-b7d9-43f0259337e3 |      | fa:16:3e:70:9e:bb | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.2\"} |\n 85 | 13630e5f-51c2-42b9-901a-2a208e5f986a |      | fa:16:3e:08:63:0b | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.2\"} |\n 86 | 21981e00-6fe2-4f6e-a265-d0c357a1a449 |      | fa:16:3e:38:5f:74 | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.6\"} |\n 87 | 2a0a4134-37f2-4582-86ad-de0ce04b8f7e |      | fa:16:3e:aa:0d:b1 | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.1\"} |\n 88 | cafd4161-f840-4c87-a80b-71b0ef374b9e |      | fa:16:3e:e3:75:36 | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.1\"} |\n 89 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n 90 + neutron floatingip-delete 1d77d791-9205-4ee4-8ae4-1a1dcf8dd153\n 91 Deleted floatingip: 1d77d791-9205-4ee4-8ae4-1a1dcf8dd153\n 92 + nova delete d09bbee1-599c-4042-a409-a90e0ae80e3c\n 93 + neutron router-interface-delete df211133-0513-44fc-bec5-38f9bca74025 76abfa0f-938a-4be1-abd5-804af306fa2d\n 94 Removed interface from router df211133-0513-44fc-bec5-38f9bca74025.\n 95 + neutron port-list\n 96 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n 97 | id                                   | name | mac_address       | fixed_ips                                                                       |\n 98 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n 99 | 06b3022f-5492-4baf-b7d9-43f0259337e3 |      | fa:16:3e:70:9e:bb | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.2\"} |\n100 | 13630e5f-51c2-42b9-901a-2a208e5f986a |      | fa:16:3e:08:63:0b | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.2\"} |\n101 | 21981e00-6fe2-4f6e-a265-d0c357a1a449 |      | fa:16:3e:38:5f:74 | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.6\"} |\n102 | 2a0a4134-37f2-4582-86ad-de0ce04b8f7e |      | fa:16:3e:aa:0d:b1 | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.1\"} |\n103 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n104 + neutron subnet-delete 76abfa0f-938a-4be1-abd5-804af306fa2d\n105 409-{u'NeutronError': {u'message': u'Unable to complete operation on subnet 76abfa0f-938a-4be1-abd5-804af306fa2d. One or more ports have an IP allocation from this subnet.', u'type': u'SubnetInUse', u'detail': u''}}\n106 + neutron port-list\n107 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n108 | id                                   | name | mac_address       | fixed_ips                                                                       |\n109 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n110 | 06b3022f-5492-4baf-b7d9-43f0259337e3 |      | fa:16:3e:70:9e:bb | {\"subnet_id\": \"76abfa0f-938a-4be1-abd5-804af306fa2d\", \"ip_address\": \"54.0.0.2\"} |\n111 | 13630e5f-51c2-42b9-901a-2a208e5f986a |      | fa:16:3e:08:63:0b | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.2\"} |\n112 | 2a0a4134-37f2-4582-86ad-de0ce04b8f7e |      | fa:16:3e:aa:0d:b1 | {\"subnet_id\": \"2f2bc3c9-2daa-477e-a38c-e7a02b03e06e\", \"ip_address\": \"10.0.0.1\"} |\n113 +--------------------------------------+------+-------------------+---------------------------------------------------------------------------------+\n114 + neutron router-delete df211133-0513-44fc-bec5-38f9bca74025\n115 Deleted router: df211133-0513-44fc-bec5-38f9bca74025\n116 + neutron net-delete 6ec5ef65-5279-4bbd-919a-b45a27bb31cd\n117 Deleted network: 6ec5ef65-5279-4bbd-919a-b45a27bb31cd\n118 + set +x", 
            "date_created": "2014-01-15 13:04:27.093058+00:00", 
            "author": "https://api.launchpad.net/1.0/~yfried"
        }, 
        {
            "content": "", 
            "date_created": "2014-01-15 13:04:27.093058+00:00", 
            "author": "https://api.launchpad.net/1.0/~yfried"
        }, 
        {
            "content": "I tried several times and I could not reproduce it with the provided script, maybe some configuration is missing in my devstack environment, although I could reproduce the nova delete/list sequence issue, but when the nova show is called it has task state 'deleting' and status ACTIVE (and that is why it is showed), so at least task state is changed, maybe we could change the behavior to not show/list servers in deleting state, IMHO it would be better.\n\nAnyway, I don't think this is a bug but the natural downside of choose to do some resource operations asynchronously ( and I'm ok with it).\n\nAbout tempest I don't think that is a problem cause we can use wait_for_server_termination method, defined in the servers_client. Can you check if that works for you?\n\nThanks", 
            "date_created": "2014-01-15 19:51:11.920906+00:00", 
            "author": "https://api.launchpad.net/1.0/~maurosr"
        }, 
        {
            "content": "Just wanted to point out that I see this on:\nIcehouse:\n1. devstack on Ubuntu\n2. RDO on rhel6.5\n\nHavana\nRHOS on rhel6.5", 
            "date_created": "2014-01-15 21:47:07.271327+00:00", 
            "author": "https://api.launchpad.net/1.0/~yfried"
        }, 
        {
            "content": "Yair, do you think this should be fixed in tempest?", 
            "date_created": "2014-01-16 21:59:52.110684+00:00", 
            "author": "https://api.launchpad.net/1.0/~salvatore-orlando"
        }, 
        {
            "content": "@Salvatore - not sure. if it's not an error, than tempest will need to work around this during teardown (which I guess it already does, since I didn't see anyone else running into this but me)", 
            "date_created": "2014-01-19 07:11:24.203153+00:00", 
            "author": "https://api.launchpad.net/1.0/~yfried"
        }, 
        {
            "content": "so use wait_for_server_termination didn't work for you?", 
            "date_created": "2014-01-20 12:36:40.244937+00:00", 
            "author": "https://api.launchpad.net/1.0/~maurosr"
        }, 
        {
            "content": "maurosr - I worked around it in tempest.\n", 
            "date_created": "2014-02-23 15:42:45.519445+00:00", 
            "author": "https://api.launchpad.net/1.0/~yfried"
        }, 
        {
            "content": "Hi Yair, \n\nI looked into this and could reproduce this with your script. The reason why this occurs is because the events to nova-api are async. When nova delete  is done the instance isn't actually deleted till sometime after which removes the port. This is why you are getting the error that multiple ports exist when you go to delete the subnet. In order to do this you'd need to loop on nova list/show on that instance till it is gone. Then you can delete the subnet without a problem. ", 
            "date_created": "2014-03-19 17:29:50.743753+00:00", 
            "author": "https://api.launchpad.net/1.0/~arosen"
        }
    ]
}