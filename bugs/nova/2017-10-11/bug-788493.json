{
    "status": "Won't Fix", 
    "last_updated": "2012-02-02 17:02:08.952573+00:00", 
    "description": "First off, let me apologize if the nova-manage image conversion tool handles this somehow (I wasn't able to get that tool to work).  With that in mind....\n\nI just completed an upgrade from bexar (release) to cactus (release) on a multi-node install.  I did the db sync and can launch new instances, and view those specific instances when using the euca2ools.\n\nHowever, I had a bunch of VMs running before the upgrade which I cannot successfully query (via euca-describe-instances) since the upgrade.  The VMs are still running on the various compute nodes, but the old-style db entries associated with those vms (in the instances table) are not compatible with the api code:\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0image_id     | kernel_id    | ramdisk_id\nOld db entries have:     ami-v87b8hc5 | ami-cf7z6yob | ami-p0cbdeta\nNew db entries have:            6           | 4            | 5\n\nA query for 'euca-describe-instances' gives me this error in the nova-api.log:\n\n2011-05-25 22:44:46,005 DEBUG nova.api [-] action: DescribeInstances from (pid=28878) __call__ /usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py:220\n2011-05-25 22:44:46,048 ERROR nova.api [983JG3Z0FWKNZHDI-VER admin default-project] Unexpected error raised: invalid literal for int() with base 10: 'ami-v87b8hc5'\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py\", line 328, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/apirequest.py\", line 150, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 674, in describe_instances\n(nova.api): TRACE:     return self._format_describe_instances(context, **kwargs)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 681, in _format_describe_instances\n(nova.api): TRACE:     return {'reservationSet': self._format_instances(context, **kwargs)}\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 712, in _format_instances\n(nova.api): TRACE:     i['imageId'] = self._image_ec2_id(instance['image_id'])\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 904, in _image_ec2_id\n(nova.api): TRACE:     return ec2utils.id_to_ec2_id(int(image_id), template=template)\n(nova.api): TRACE: ValueError: invalid literal for int() with base 10: 'ami-v87b8hc5'\n(nova.api): TRACE:\n\nI can see how it would be difficult to 'convert' an ami id on db upgrade, at least, without looking at the registered images first.  If there isn't a plan to automate this than I would vote that there be some sort of backwards compatibility, or that the instances table gets purged on upgrade (since instances are never really removed from the table), or something.\n\n--ryan", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/788493", 
    "owner": "None", 
    "id": 788493, 
    "index": 2410, 
    "created": "2011-05-26 06:42:58.245949+00:00", 
    "title": "Nova bexar to cactus upgrade does not convert db entries for running instances", 
    "comments": [
        {
            "content": "First off, let me apologize if the nova-manage image conversion tool handles this somehow (I wasn't able to get that tool to work).  With that in mind....\n\nI just completed an upgrade from bexar (release) to cactus (release) on a multi-node install.  I did the db sync and can launch new instances, and view those specific instances when using the euca2ools.\n\nHowever, I had a bunch of VMs running before the upgrade which I cannot successfully query (via euca-describe-instances) since the upgrade.  The VMs are still running on the various compute nodes, but the old-style db entries associated with those vms (in the instances table) are not compatible with the api code:\n\n                                     image_id     | kernel_id    | ramdisk_id   \nOld db entries have:     ami-v87b8hc5 | ami-cf7z6yob | ami-p0cbdeta\nNew db entries have:            6           | 4            | 5           \n\nA query for 'euca-describe-instances' gives me this error in the nova-api.log:\n\n2011-05-25 22:44:46,005 DEBUG nova.api [-] action: DescribeInstances from (pid=28878) __call__ /usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py:220\n2011-05-25 22:44:46,048 ERROR nova.api [983JG3Z0FWKNZHDI-VER admin default-project] Unexpected error raised: invalid literal for int() with base 10: 'ami-v87b8hc5'\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py\", line 328, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/apirequest.py\", line 150, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 674, in describe_instances\n(nova.api): TRACE:     return self._format_describe_instances(context, **kwargs)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 681, in _format_describe_instances\n(nova.api): TRACE:     return {'reservationSet': self._format_instances(context, **kwargs)}\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 712, in _format_instances\n(nova.api): TRACE:     i['imageId'] = self._image_ec2_id(instance['image_id'])\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 904, in _image_ec2_id\n(nova.api): TRACE:     return ec2utils.id_to_ec2_id(int(image_id), template=template)\n(nova.api): TRACE: ValueError: invalid literal for int() with base 10: 'ami-v87b8hc5'\n(nova.api): TRACE:", 
            "date_created": "2011-05-26 06:42:58.245949+00:00", 
            "author": "https://api.launchpad.net/1.0/~rlucio"
        }, 
        {
            "content": "I guess with Essex looming, we're unlikely to fix a Bexar->Cactus upgrade issue\n\nThanks for the report, though, sorry no-one got to it!", 
            "date_created": "2012-02-02 17:01:59.817265+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }
    ]
}