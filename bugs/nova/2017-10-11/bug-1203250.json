{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 12:05:44.979070+00:00", 
    "description": "\nStep 1) Create an aggregate\nroot@liugya-ubuntu:~# nova  aggregate-create  agg1 nova\n+----+------+-------------------+-------+---------------------------------+\n| Id | Name | Availability Zone | Hosts | Metadata                        |\n+----+------+-------------------+-------+---------------------------------+\n| 1  | agg1 | nova              | []    | {u'availability_zone': u'nova'} |\n+----+------+-------------------+-------+---------------------------------+\nroot@liugya-ubuntu:~# nova aggregate-add-host 1 liugya-ubuntu\nAggregate 1 has been successfully updated.\n+----+------+-------------------+--------------------+---------------------------------+\n| Id | Name | Availability Zone | Hosts              | Metadata                        |\n+----+------+-------------------+--------------------+---------------------------------+\n| 1  | agg1 | nova              | [u'liugya-ubuntu'] | {u'availability_zone': u'nova'} |\n+----+------+-------------------+--------------------+---------------------------------+\nroot@liugya-ubuntu:~# nova    aggregate-list   \n+----+------+-------------------+\n| Id | Name | Availability Zone |\n+----+------+-------------------+\n| 1  | agg1 | nova              |\n+----+------+-------------------+\n\nStep 2) Update aggregate\nroot@liugya-ubuntu:~# nova aggregate-update 1 agg1 nova1\nAggregate 1 has been successfully updated.\n+----+------+-------------------+--------------------+----------------------------------+\n| Id | Name | Availability Zone | Hosts              | Metadata                         |\n+----+------+-------------------+--------------------+----------------------------------+\n| 1  | agg1 | nova1             | [u'liugya-ubuntu'] | {u'availability_zone': u'nova1'} |\n+----+------+-------------------+--------------------+----------------------------------+\nroot@liugya-ubuntu:~# nova aggregate-list\n+----+------+-------------------+\n| Id | Name | Availability Zone |\n+----+------+-------------------+\n| 1  | agg1 | nova1             |\n+----+------+-------------------+\n\nStep 3) Boot one instance\nroot@liugya-ubuntu:~# nova boot --image cirros-0.3.1-x86_64-uec    --flavor 1 vm2\n+--------------------------------------+--------------------------------------+\n| Property                             | Value                                |\n+--------------------------------------+--------------------------------------+\n| OS-EXT-STS:task_state                | scheduling                           |\n| image                                | cirros-0.3.1-x86_64-uec              |\n| OS-EXT-STS:vm_state                  | building                             |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                    |\n| OS-SRV-USG:launched_at               | None                                 |\n| flavor                               | m1.tiny                              |\n| id                                   | 59b66dd5-1484-4471-ba64-fc41d1dfa8b1 |\n| security_groups                      | [{u'name': u'default'}]              |\n| user_id                              | 5d988016150c4de0bed7f5b480b0cec8     |\n| OS-DCF:diskConfig                    | MANUAL                               |\n| accessIPv4                           |                                      |\n| accessIPv6                           |                                      |\n| progress                             | 0                                    |\n| OS-EXT-STS:power_state               | 0                                    |\n| OS-EXT-AZ:availability_zone          | nova                                 |\n| config_drive                         |                                      |\n| status                               | BUILD                                |\n| updated                              | 2013-07-20T03:35:55Z                 |\n| hostId                               |                                      |\n| OS-EXT-SRV-ATTR:host                 | None                                 |\n| OS-SRV-USG:terminated_at             | None                                 |\n| key_name                             | None                                 |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | None                                 |\n| name                                 | vm2                                  |\n| adminPass                            | 5oxXcm5N6LQK                         |\n| tenant_id                            | 9215cf095ae844f5aa2e7d8f1f966c1a     |\n| created                              | 2013-07-20T03:35:55Z                 |\n| os-extended-volumes:volumes_attached | []                                   |\n| metadata                             | {}                                   |\nroot@liugya-ubuntu:~# nova show vm2\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| status                               | ACTIVE                                                         |\n| updated                              | 2013-07-20T03:36:04Z                                           |\n| OS-EXT-STS:task_state                | None                                                           |\n| OS-EXT-SRV-ATTR:host                 | liugya-ubuntu                                                  |\n| key_name                             | None                                                           |\n| image                                | cirros-0.3.1-x86_64-uec (67d33b7f-cd36-4d8d-8163-4703930f84e4) |\n| private network                      | 10.0.0.3                                                       |\n| hostId                               | 8ca66826661862c21e5cce57d3351767e30685ed53c7e6ae02094563       |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                              |\n| OS-SRV-USG:launched_at               | 2013-07-20T03:36:04.000000                                     |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | liugya-ubuntu                                                  |\n| flavor                               | m1.tiny (1)                                                    |\n| id                                   | 59b66dd5-1484-4471-ba64-fc41d1dfa8b1                           |\n| security_groups                      | [{u'name': u'default'}]                                        |\n| OS-SRV-USG:terminated_at             | None                                                           |\n| user_id                              | 5d988016150c4de0bed7f5b480b0cec8                               |\n| name                                 | vm2                                                            |\n| created                              | 2013-07-20T03:35:55Z                                           |\n| tenant_id                            | 9215cf095ae844f5aa2e7d8f1f966c1a                               |\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| metadata                             | {}                                                             |\n| os-extended-volumes:volumes_attached | []                                                             |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| progress                             | 0                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-AZ:availability_zone          | nova                                                           |  <<< Still nova, not right, should be nova1\n| config_drive                         |                                                                |\n+--------------------------------------+----------------------------------------------------------------+\nroot@liugya-ubuntu:~# nova aggregate-list\n+----+------+-------------------+\n| Id | Name | Availability Zone |\n+----+------+-------------------+\n| 1  | agg1 | nova1             |\n+----+------+-------------------+\n\nStep 4) Restart nova api, availability_zone update to the latest value of nova1\n\nroot@liugya-ubuntu:~# nova show vm2\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| status                               | ACTIVE                                                         |\n| updated                              | 2013-07-20T03:36:04Z                                           |\n| OS-EXT-STS:task_state                | None                                                           |\n| OS-EXT-SRV-ATTR:host                 | liugya-ubuntu                                                  |\n| key_name                             | None                                                           |\n| image                                | cirros-0.3.1-x86_64-uec (67d33b7f-cd36-4d8d-8163-4703930f84e4) |\n| private network                      | 10.0.0.3                                                       |\n| hostId                               | 8ca66826661862c21e5cce57d3351767e30685ed53c7e6ae02094563       |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                              |\n| OS-SRV-USG:launched_at               | 2013-07-20T03:36:04.000000                                     |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | liugya-ubuntu                                                  |\n| flavor                               | m1.tiny (1)                                                    |\n| id                                   | 59b66dd5-1484-4471-ba64-fc41d1dfa8b1                           |\n| security_groups                      | [{u'name': u'default'}]                                        |\n| OS-SRV-USG:terminated_at             | None                                                           |\n| user_id                              | 5d988016150c4de0bed7f5b480b0cec8                               |\n| name                                 | vm2                                                            |\n| created                              | 2013-07-20T03:35:55Z                                           |\n| tenant_id                            | 9215cf095ae844f5aa2e7d8f1f966c1a                               |\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| metadata                             | {}                                                             |\n| os-extended-volumes:volumes_attached | []                                                             |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| progress                             | 0                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-AZ:availability_zone          | nova1                                                          |  <<<<<<<<\n| config_drive                         |                                                                |\n+--------------------------------------+----------------------------------------------------------------+", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1203250", 
    "owner": "https://api.launchpad.net/1.0/~jay-lau-513", 
    "id": 1203250, 
    "index": 3861, 
    "created": "2013-07-20 07:27:13.505117+00:00", 
    "title": "availability_zone was not updated on time", 
    "comments": [
        {
            "content": "\nStep 1) Create an aggregate\nroot@liugya-ubuntu:~# nova  aggregate-create  agg1 nova\n+----+------+-------------------+-------+---------------------------------+\n| Id | Name | Availability Zone | Hosts | Metadata                        |\n+----+------+-------------------+-------+---------------------------------+\n| 1  | agg1 | nova              | []    | {u'availability_zone': u'nova'} |\n+----+------+-------------------+-------+---------------------------------+\nroot@liugya-ubuntu:~# nova aggregate-add-host 1 liugya-ubuntu\nAggregate 1 has been successfully updated.\n+----+------+-------------------+--------------------+---------------------------------+\n| Id | Name | Availability Zone | Hosts              | Metadata                        |\n+----+------+-------------------+--------------------+---------------------------------+\n| 1  | agg1 | nova              | [u'liugya-ubuntu'] | {u'availability_zone': u'nova'} |\n+----+------+-------------------+--------------------+---------------------------------+\nroot@liugya-ubuntu:~# nova    aggregate-list   \n+----+------+-------------------+\n| Id | Name | Availability Zone |\n+----+------+-------------------+\n| 1  | agg1 | nova              |\n+----+------+-------------------+\n\nStep 2) Update aggregate\nroot@liugya-ubuntu:~# nova aggregate-update 1 agg1 nova1\nAggregate 1 has been successfully updated.\n+----+------+-------------------+--------------------+----------------------------------+\n| Id | Name | Availability Zone | Hosts              | Metadata                         |\n+----+------+-------------------+--------------------+----------------------------------+\n| 1  | agg1 | nova1             | [u'liugya-ubuntu'] | {u'availability_zone': u'nova1'} |\n+----+------+-------------------+--------------------+----------------------------------+\nroot@liugya-ubuntu:~# nova aggregate-list\n+----+------+-------------------+\n| Id | Name | Availability Zone |\n+----+------+-------------------+\n| 1  | agg1 | nova1             |\n+----+------+-------------------+\n\nStep 3) Boot one instance\nroot@liugya-ubuntu:~# nova boot --image cirros-0.3.1-x86_64-uec    --flavor 1 vm2\n+--------------------------------------+--------------------------------------+\n| Property                             | Value                                |\n+--------------------------------------+--------------------------------------+\n| OS-EXT-STS:task_state                | scheduling                           |\n| image                                | cirros-0.3.1-x86_64-uec              |\n| OS-EXT-STS:vm_state                  | building                             |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                    |\n| OS-SRV-USG:launched_at               | None                                 |\n| flavor                               | m1.tiny                              |\n| id                                   | 59b66dd5-1484-4471-ba64-fc41d1dfa8b1 |\n| security_groups                      | [{u'name': u'default'}]              |\n| user_id                              | 5d988016150c4de0bed7f5b480b0cec8     |\n| OS-DCF:diskConfig                    | MANUAL                               |\n| accessIPv4                           |                                      |\n| accessIPv6                           |                                      |\n| progress                             | 0                                    |\n| OS-EXT-STS:power_state               | 0                                    |\n| OS-EXT-AZ:availability_zone          | nova                                 |\n| config_drive                         |                                      |\n| status                               | BUILD                                |\n| updated                              | 2013-07-20T03:35:55Z                 |\n| hostId                               |                                      |\n| OS-EXT-SRV-ATTR:host                 | None                                 |\n| OS-SRV-USG:terminated_at             | None                                 |\n| key_name                             | None                                 |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | None                                 |\n| name                                 | vm2                                  |\n| adminPass                            | 5oxXcm5N6LQK                         |\n| tenant_id                            | 9215cf095ae844f5aa2e7d8f1f966c1a     |\n| created                              | 2013-07-20T03:35:55Z                 |\n| os-extended-volumes:volumes_attached | []                                   |\n| metadata                             | {}                                   |\nroot@liugya-ubuntu:~# nova show vm2\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| status                               | ACTIVE                                                         |\n| updated                              | 2013-07-20T03:36:04Z                                           |\n| OS-EXT-STS:task_state                | None                                                           |\n| OS-EXT-SRV-ATTR:host                 | liugya-ubuntu                                                  |\n| key_name                             | None                                                           |\n| image                                | cirros-0.3.1-x86_64-uec (67d33b7f-cd36-4d8d-8163-4703930f84e4) |\n| private network                      | 10.0.0.3                                                       |\n| hostId                               | 8ca66826661862c21e5cce57d3351767e30685ed53c7e6ae02094563       |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                              |\n| OS-SRV-USG:launched_at               | 2013-07-20T03:36:04.000000                                     |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | liugya-ubuntu                                                  |\n| flavor                               | m1.tiny (1)                                                    |\n| id                                   | 59b66dd5-1484-4471-ba64-fc41d1dfa8b1                           |\n| security_groups                      | [{u'name': u'default'}]                                        |\n| OS-SRV-USG:terminated_at             | None                                                           |\n| user_id                              | 5d988016150c4de0bed7f5b480b0cec8                               |\n| name                                 | vm2                                                            |\n| created                              | 2013-07-20T03:35:55Z                                           |\n| tenant_id                            | 9215cf095ae844f5aa2e7d8f1f966c1a                               |\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| metadata                             | {}                                                             |\n| os-extended-volumes:volumes_attached | []                                                             |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| progress                             | 0                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-AZ:availability_zone          | nova                                                           |  <<< Still nova, not right, should be nova1\n| config_drive                         |                                                                |\n+--------------------------------------+----------------------------------------------------------------+\nroot@liugya-ubuntu:~# nova aggregate-list\n+----+------+-------------------+\n| Id | Name | Availability Zone |\n+----+------+-------------------+\n| 1  | agg1 | nova1             |\n+----+------+-------------------+\n\nStep 4) Restart nova api, availability_zone update to the latest value of nova1\n\nroot@liugya-ubuntu:~# nova show vm2\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| status                               | ACTIVE                                                         |\n| updated                              | 2013-07-20T03:36:04Z                                           |\n| OS-EXT-STS:task_state                | None                                                           |\n| OS-EXT-SRV-ATTR:host                 | liugya-ubuntu                                                  |\n| key_name                             | None                                                           |\n| image                                | cirros-0.3.1-x86_64-uec (67d33b7f-cd36-4d8d-8163-4703930f84e4) |\n| private network                      | 10.0.0.3                                                       |\n| hostId                               | 8ca66826661862c21e5cce57d3351767e30685ed53c7e6ae02094563       |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                              |\n| OS-SRV-USG:launched_at               | 2013-07-20T03:36:04.000000                                     |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | liugya-ubuntu                                                  |\n| flavor                               | m1.tiny (1)                                                    |\n| id                                   | 59b66dd5-1484-4471-ba64-fc41d1dfa8b1                           |\n| security_groups                      | [{u'name': u'default'}]                                        |\n| OS-SRV-USG:terminated_at             | None                                                           |\n| user_id                              | 5d988016150c4de0bed7f5b480b0cec8                               |\n| name                                 | vm2                                                            |\n| created                              | 2013-07-20T03:35:55Z                                           |\n| tenant_id                            | 9215cf095ae844f5aa2e7d8f1f966c1a                               |\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| metadata                             | {}                                                             |\n| os-extended-volumes:volumes_attached | []                                                             |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| progress                             | 0                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-AZ:availability_zone          | nova1                                                          |  <<<<<<<<\n| config_drive                         |                                                                |\n+--------------------------------------+----------------------------------------------------------------+", 
            "date_created": "2013-07-20 07:27:13.505117+00:00", 
            "author": "https://api.launchpad.net/1.0/~jay-lau-513"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/38026", 
            "date_created": "2013-07-20 08:27:04.614595+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/38026\nCommitted: http://github.com/openstack/nova/commit/43a9ffbaf83c6d7e7cfc5d2eb77d52ee55c7f895\nSubmitter: Jenkins\nBranch:    master\n\ncommit 43a9ffbaf83c6d7e7cfc5d2eb77d52ee55c7f895\nAuthor: Guangya Liu <email address hidden>\nDate:   Sat Jul 20 16:23:22 2013 +0800\n\n    Update availability_zone on time if it was changed\n    \n    The problem is that when the availability_zones for one host\n    aggregation was updated, the VM attribute of availability_zones\n    which belong to the host in the availability_zones was\n    not updated on time.\n    \n    If updated values include availability_zones, then the cache\n    which stored availability_zones and host need to be reset.\n    \n    Fix bug 1203250\n    \n    Change-Id: Ib3f08fbe3c74d5aa101da78faed43b0bc03cb988\n", 
            "date_created": "2013-08-28 06:42:29.756076+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}