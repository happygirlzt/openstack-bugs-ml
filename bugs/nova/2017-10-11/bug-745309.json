{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:35:18.740964+00:00", 
    "description": "I have revno: 905 installed using nova.sh, using a mysql database, which created an admin user and installed a ttylinux image locally on the node for me.\n\nI created user test_user and added roles of sysadmin and netadmin.\nVarious documents suggested adding a projectmanager role but nova-manage returned \"CRITICAL nova [-] The projectmanager role can not be found\" when I tried.\nrunning euca-describe-images as the admin user reports the available ttylinux images as public.\n\nrunning euca-describe-images as test_user fails with \"UnknownError: An unknown error has occurred. Please try your request again.\"\nnova-api reports the following when euca-describe-images fails:\n2011-03-29 22:03:57,674 ERROR nova.api [1GKQEYMPB17VO2BYBREO test_user test_users_project] Unexpected error raised: 'owner_id'\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/__init__.py\", line 321, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/apirequest.py\", line 150, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/cloud.py\", line 912, in describe_images\n(nova.api): TRACE:     images = self.image_service.detail(context)\n(nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 78, in detail\n(nova.api): TRACE:     return self._filter(context, images)\n(nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 90, in _filter\n(nova.api): TRACE:     if not cls._is_visible(context, image):\n(nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 83, in _is_visible\n(nova.api): TRACE:     or context.project_id == image['properties']['owner_id']\n(nova.api): TRACE: KeyError: 'owner_id'\n\neuca-run-instance fails with the same error. Any commands that do not require access to the image store seem to run fine.\n\nIf I set is_admin to 1 on the users table in the nova database for test_user euca-describe-images runs fine.", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/745309", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 745309, 
    "index": 387, 
    "created": "2011-03-29 22:09:05.629243+00:00", 
    "title": "LocalImageService images only accessable by admin user", 
    "comments": [
        {
            "content": "I have revno: 905 installed using nova.sh, using a mysql database, which created an admin user and installed a ttylinux image locally on the node for me.\n\nI created user test_user and added roles of sysadmin and netadmin.\nVarious documents suggested adding a projectmanager role but nova-manage returned \"CRITICAL nova [-] The projectmanager role can not be found\" when I tried.\nrunning euca-describe-images as the admin user reports the available ttylinux images as public.\n\nrunning euca-describe-images as test_user fails with \"UnknownError: An unknown error has occurred. Please try your request again.\"\nnova-api reports the following when euca-describe-images fails:\n2011-03-29 22:03:57,674 ERROR nova.api [1GKQEYMPB17VO2BYBREO test_user test_users_project] Unexpected error raised: 'owner_id'\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/__init__.py\", line 321, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/apirequest.py\", line 150, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/cloud.py\", line 912, in describe_images\n(nova.api): TRACE:     images = self.image_service.detail(context)\n(nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 78, in detail\n(nova.api): TRACE:     return self._filter(context, images)\n(nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 90, in _filter\n(nova.api): TRACE:     if not cls._is_visible(context, image):\n(nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 83, in _is_visible\n(nova.api): TRACE:     or context.project_id == image['properties']['owner_id']\n(nova.api): TRACE: KeyError: 'owner_id'\n\neuca-run-instance fails with the same error. Any commands that do not require access to the image store seem to run fine.\n\nIf I set is_admin to 1 on the users table in the nova database for test_user euca-describe-images runs fine.", 
            "date_created": "2011-03-29 22:09:05.629243+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomvn"
        }, 
        {
            "content": "Interesting.\n\nIt looks like owner_id isn't being set properly on the image when it is converted.  I'm investigating how this might happen.\n\nVish\n\nOn Mar 29, 2011, at 3:09 PM, Tom vN wrote:\n\n> Public bug reported:\n> \n> I have revno: 905 installed using nova.sh, using a mysql database, which\n> created an admin user and installed a ttylinux image locally on the node\n> for me.\n> \n> I created user test_user and added roles of sysadmin and netadmin.\n> Various documents suggested adding a projectmanager role but nova-manage returned \"CRITICAL nova [-] The projectmanager role can not be found\" when I tried.\n> running euca-describe-images as the admin user reports the available ttylinux images as public.\n> \n> running euca-describe-images as test_user fails with \"UnknownError: An unknown error has occurred. Please try your request again.\"\n> nova-api reports the following when euca-describe-images fails:\n> 2011-03-29 22:03:57,674 ERROR nova.api [1GKQEYMPB17VO2BYBREO test_user test_users_project] Unexpected error raised: 'owner_id'\n> (nova.api): TRACE: Traceback (most recent call last):\n> (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/__init__.py\", line 321, in __call__\n> (nova.api): TRACE:     result = api_request.invoke(context)\n> (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/apirequest.py\", line 150, in invoke\n> (nova.api): TRACE:     result = method(context, **args)\n> (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/cloud.py\", line 912, in describe_images\n> (nova.api): TRACE:     images = self.image_service.detail(context)\n> (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 78, in detail\n> (nova.api): TRACE:     return self._filter(context, images)\n> (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 90, in _filter\n> (nova.api): TRACE:     if not cls._is_visible(context, image):\n> (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 83, in _is_visible\n> (nova.api): TRACE:     or context.project_id == image['properties']['owner_id']\n> (nova.api): TRACE: KeyError: 'owner_id'\n> \n> euca-run-instance fails with the same error. Any commands that do not\n> require access to the image store seem to run fine.\n> \n> If I set is_admin to 1 on the users table in the nova database for\n> test_user euca-describe-images runs fine.\n> \n> ** Affects: nova\n>     Importance: Undecided\n>         Status: New\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/745309\n> \n> Title:\n>  LocalImageService images only accessable by admin user\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  I have revno: 905 installed using nova.sh, using a mysql database,\n>  which created an admin user and installed a ttylinux image locally on\n>  the node for me.\n> \n>  I created user test_user and added roles of sysadmin and netadmin.\n>  Various documents suggested adding a projectmanager role but nova-manage returned \"CRITICAL nova [-] The projectmanager role can not be found\" when I tried.\n>  running euca-describe-images as the admin user reports the available ttylinux images as public.\n> \n>  running euca-describe-images as test_user fails with \"UnknownError: An unknown error has occurred. Please try your request again.\"\n>  nova-api reports the following when euca-describe-images fails:\n>  2011-03-29 22:03:57,674 ERROR nova.api [1GKQEYMPB17VO2BYBREO test_user test_users_project] Unexpected error raised: 'owner_id'\n>  (nova.api): TRACE: Traceback (most recent call last):\n>  (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/__init__.py\", line 321, in __call__\n>  (nova.api): TRACE:     result = api_request.invoke(context)\n>  (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/apirequest.py\", line 150, in invoke\n>  (nova.api): TRACE:     result = method(context, **args)\n>  (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/cloud.py\", line 912, in describe_images\n>  (nova.api): TRACE:     images = self.image_service.detail(context)\n>  (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 78, in detail\n>  (nova.api): TRACE:     return self._filter(context, images)\n>  (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 90, in _filter\n>  (nova.api): TRACE:     if not cls._is_visible(context, image):\n>  (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 83, in _is_visible\n>  (nova.api): TRACE:     or context.project_id == image['properties']['owner_id']\n>  (nova.api): TRACE: KeyError: 'owner_id'\n> \n>  euca-run-instance fails with the same error. Any commands that do not\n>  require access to the image store seem to run fine.\n> \n>  If I set is_admin to 1 on the users table in the nova database for\n>  test_user euca-describe-images runs fine.\n\n", 
            "date_created": "2011-03-29 22:32:10+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Fix pushed up.\n\nAs a workaround, if you edit the info.json files in your images directory and replace 'owner' with 'owner_id' it will work as expected.\n\nOn Mar 29, 2011, at 3:09 PM, Tom vN wrote:\n\n> Public bug reported:\n> \n> I have revno: 905 installed using nova.sh, using a mysql database, which\n> created an admin user and installed a ttylinux image locally on the node\n> for me.\n> \n> I created user test_user and added roles of sysadmin and netadmin.\n> Various documents suggested adding a projectmanager role but nova-manage returned \"CRITICAL nova [-] The projectmanager role can not be found\" when I tried.\n> running euca-describe-images as the admin user reports the available ttylinux images as public.\n> \n> running euca-describe-images as test_user fails with \"UnknownError: An unknown error has occurred. Please try your request again.\"\n> nova-api reports the following when euca-describe-images fails:\n> 2011-03-29 22:03:57,674 ERROR nova.api [1GKQEYMPB17VO2BYBREO test_user test_users_project] Unexpected error raised: 'owner_id'\n> (nova.api): TRACE: Traceback (most recent call last):\n> (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/__init__.py\", line 321, in __call__\n> (nova.api): TRACE:     result = api_request.invoke(context)\n> (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/apirequest.py\", line 150, in invoke\n> (nova.api): TRACE:     result = method(context, **args)\n> (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/cloud.py\", line 912, in describe_images\n> (nova.api): TRACE:     images = self.image_service.detail(context)\n> (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 78, in detail\n> (nova.api): TRACE:     return self._filter(context, images)\n> (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 90, in _filter\n> (nova.api): TRACE:     if not cls._is_visible(context, image):\n> (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 83, in _is_visible\n> (nova.api): TRACE:     or context.project_id == image['properties']['owner_id']\n> (nova.api): TRACE: KeyError: 'owner_id'\n> \n> euca-run-instance fails with the same error. Any commands that do not\n> require access to the image store seem to run fine.\n> \n> If I set is_admin to 1 on the users table in the nova database for\n> test_user euca-describe-images runs fine.\n> \n> ** Affects: nova\n>     Importance: Undecided\n>         Status: New\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/745309\n> \n> Title:\n>  LocalImageService images only accessable by admin user\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  I have revno: 905 installed using nova.sh, using a mysql database,\n>  which created an admin user and installed a ttylinux image locally on\n>  the node for me.\n> \n>  I created user test_user and added roles of sysadmin and netadmin.\n>  Various documents suggested adding a projectmanager role but nova-manage returned \"CRITICAL nova [-] The projectmanager role can not be found\" when I tried.\n>  running euca-describe-images as the admin user reports the available ttylinux images as public.\n> \n>  running euca-describe-images as test_user fails with \"UnknownError: An unknown error has occurred. Please try your request again.\"\n>  nova-api reports the following when euca-describe-images fails:\n>  2011-03-29 22:03:57,674 ERROR nova.api [1GKQEYMPB17VO2BYBREO test_user test_users_project] Unexpected error raised: 'owner_id'\n>  (nova.api): TRACE: Traceback (most recent call last):\n>  (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/__init__.py\", line 321, in __call__\n>  (nova.api): TRACE:     result = api_request.invoke(context)\n>  (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/apirequest.py\", line 150, in invoke\n>  (nova.api): TRACE:     result = method(context, **args)\n>  (nova.api): TRACE:   File \"/opt/nova/nova/api/ec2/cloud.py\", line 912, in describe_images\n>  (nova.api): TRACE:     images = self.image_service.detail(context)\n>  (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 78, in detail\n>  (nova.api): TRACE:     return self._filter(context, images)\n>  (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 90, in _filter\n>  (nova.api): TRACE:     if not cls._is_visible(context, image):\n>  (nova.api): TRACE:   File \"/opt/nova/nova/image/s3.py\", line 83, in _is_visible\n>  (nova.api): TRACE:     or context.project_id == image['properties']['owner_id']\n>  (nova.api): TRACE: KeyError: 'owner_id'\n> \n>  euca-run-instance fails with the same error. Any commands that do not\n>  require access to the image store seem to run fine.\n> \n>  If I set is_admin to 1 on the users table in the nova database for\n>  test_user euca-describe-images runs fine.\n\n", 
            "date_created": "2011-03-29 22:38:57+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ]
}