{
    "status": "Opinion", 
    "last_updated": "2014-09-15 12:47:21.633041+00:00", 
    "description": "The \"updated\" field in output from \"nova show\" gets updated when certain fields, such as server name are changed.  However, changing metadata doesn't cause the field to be updated.\n\nSteps to recreate:\n- Run the \"nova show\" command on an existing instance and note the timestamp in the \"updated\" field.\n- Add or change metadata on the instance:\n\ncurl -i http://[Server IP Address]:8774/v2/[Tenant ID]/servers/[Instance ID]/metadata -X POST -H \"X-Auth-Project-Id: admin\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: [Token from Keystone]\" -d '{\"metadata\": {\"new_key\": \"new_value\"}}'\n\n- Run the \"nova show\" command on the instance and note that although the metadata has been added/changed, the timestamp in the \"updated\" field hasn't changed.\n\nExpected result:\n- The timestamp in the \"updated\" field should be changed to show when the metadata was changed.\n\n\nThe reason it doesn't currently get changed is that the timestamp for the last update of an instance is stored in the instances table, while the last update of metadata is stored in the instance_metadata table.  When metadata is updated, only the instance_metadata table gets updated, and the \"nova show\" output only queries the instances table to fill in the \"updated\" timestamp.\n\nThis is an issue for a user who has access to the API's/CLI and wants to see when metadata was last updated for an instance.  There's not currently a way to see when metadata was last updated via the API's/CLI.\n\nHere are a few options for fixing:\n- Update the nova code so that whenever metadata is updated, the \"updated\" timestamp in the instances table is also updated.\nPros: Existing users of the API's and CLI (using \"nova show\") who want to know when updates happen to metadata don't need to make changes.\nCons: Changes the behavior of \"nova show\".  Possibly requires a dummy update to the instances table just to update the timestamp on it.\n\n- Change the \"nova show\" code (in python-novaclient) so that it looks for the latest update date for the instance *and* the lists included in the output and shows the latest one for the \"update\" field.\nPros: Existing users of the API's and CLI (using \"nova show\") who want to know when updates happen to metadata don't need to make changes.\nCons: Changes the behavior of \"nova show\".  Possibly confusing when debugging and trying to figure out what table the \"update\" field is comes from.\n\n- Update the \"List Metadata\" (http://docs.openstack.org/api/openstack-compute/2/content/List_Metadata-d1e5089.html) API output so that it returns the updated_at timestamp for each metadata object in the response and provide a new CLI command (nova meta show?) so that CLI users could call the API.\nPros: Doesn't change behavior of existing CLI commands.\nCons: Existing users of the CLI (using \"nova show\") who want to know when updates happen to metadata need to start using a new command.  Not as intuitive to users as having the date updated in the \"nova show\" output\n\n\nI'd appreciate any comments or suggestions.", 
    "tags": [], 
    "importance": "Wishlist", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1237106", 
    "owner": "None", 
    "id": 1237106, 
    "index": 1429, 
    "created": "2013-10-08 22:01:03.593928+00:00", 
    "title": "'updated' field from nova show output doesn't reflect updates to metadata", 
    "comments": [
        {
            "content": "The \"updated\" field in output from \"nova show\" gets updated when certain fields, such as server name are changed.  However, changing metadata doesn't cause the field to be updated.\n\nSteps to recreate:\n- Run the \"nova show\" command on an existing instance and note the timestamp in the \"updated\" field.\n- Add or change metadata on the instance:\n\ncurl -i http://[Server IP Address]:8774/v2/[Tenant ID]/servers/[Instance ID]/metadata -X POST -H \"X-Auth-Project-Id: admin\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: [Token from Keystone]\" -d '{\"metadata\": {\"new_key\": \"new_value\"}}'\n\n- Run the \"nova show\" command on the instance and note that although the metadata has been added/changed, the timestamp in the \"updated\" field hasn't changed.\n\nExpected result:\n- The timestamp in the \"updated\" field should be changed to show when the metadata was changed.\n\n\nThe reason it doesn't currently get changed is that the timestamp for the last update of an instance is stored in the instances table, while the last update of metadata is stored in the instance_metadata table.  When metadata is updated, only the instance_metadata table gets updated, and the \"nova show\" output only queries the instances table to fill in the \"updated\" timestamp.\n\nThis is an issue for a user who has access to the API's/CLI and wants to see when metadata was last updated for an instance.  There's not currently a way to see when metadata was last updated via the API's/CLI.\n\nHere are a few options for fixing:\n- Update the nova code so that whenever metadata is updated, the \"updated\" timestamp in the instances table is also updated.\nPros: Existing users of the API's and CLI (using \"nova show\") who want to know when updates happen to metadata don't need to make changes.\nCons: Changes the behavior of \"nova show\".  Possibly requires a dummy update to the instances table just to update the timestamp on it.\n\n- Change the \"nova show\" code (in python-novaclient) so that it looks for the latest update date for the instance *and* the lists included in the output and shows the latest one for the \"update\" field.\nPros: Existing users of the API's and CLI (using \"nova show\") who want to know when updates happen to metadata don't need to make changes.\nCons: Changes the behavior of \"nova show\".  Possibly confusing when debugging and trying to figure out what table the \"update\" field is comes from.\n\n- Update the \"List Metadata\" (http://docs.openstack.org/api/openstack-compute/2/content/List_Metadata-d1e5089.html) API output so that it returns the updated_at timestamp for each metadata object in the response and provide a new CLI command (nova meta show?) so that CLI users could call the API.\nPros: Doesn't change behavior of existing CLI commands.\nCons: Existing users of the CLI (using \"nova show\") who want to know when updates happen to metadata need to start using a new command.  Not as intuitive to users as having the date updated in the \"nova show\" output\n\n\nI'd appreciate any comments or suggestions.", 
            "date_created": "2013-10-08 22:01:03.593928+00:00", 
            "author": "https://api.launchpad.net/1.0/~bpokorny"
        }, 
        {
            "content": "I proposed a fix in this review:\nhttps://review.openstack.org/#/c/53680/\n\nBut there were concerns about changing the current behavior.  See the discussion in the review for further info.", 
            "date_created": "2013-10-25 19:20:22.151429+00:00", 
            "author": "https://api.launchpad.net/1.0/~bpokorny"
        }, 
        {
            "content": "I think this should be addressed in nova only. Please comment if you disagree.", 
            "date_created": "2013-12-07 00:53:14.031060+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }
    ]
}