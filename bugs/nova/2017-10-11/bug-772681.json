{
    "status": "Fix Released", 
    "last_updated": "2012-05-16 13:54:15.497330+00:00", 
    "description": "HostedOSCC1# euca-run-instances ami-335e2dd1 -k ami-335e2dd1\n\nInstance became stuck in a networking state on the remote host HostedOS1.\n\nNova Version:   2011.3~bzr1033-0ubuntu0ppa1~lucid1\n\nNova config:\nroot@HostedOS1:/var/log/nova# cat /etc/nova/nova.conf\n--daemonize=1\n--dhcpbridge_flagfile=/etc/nova/nova.conf\n--dhcpbridge=/usr/bin/nova-dhcpbridge\n--logdir=/var/log/nova\n--state_path=/var/lib/nova\n--lock_path=/var/lock/nova\n--verbose=1\n--sql_connection=mysql://root:nova@192.168.12.59/nova\n--s3_host=192.168.12.59\n--rabbit_host=192.168.12.59\n--cc_host=192.168.12.59\n--ec2_url=http://192.168.12.59:8773/services/Cloud\n--network_manager=nova.network.manager.FlatDHCPManager\n--fixed_range=192.168.2.48/28\n--network_size=13\n--flat_network_dhcp_start=192.168.2.50\n\n\n\nLog:\n\nnova-compute.log-2011-04-28 10:10:53,936 DEBUG nova.rpc [-] received {u'_context_request_id': u'CY6GJ4RK7C597B72E04-', u'_context_read_deleted': False, u'args': {u'instance_id': 25, u'injected_files': None, u'availability_zone': None}, u'_context_is_admin': True, u'_context_timestamp': u'2011-04-28T14:10:53Z', u'_context_user': u'root', u'method': u'run_instance', u'_context_project': u'testproject', u'_context_remote_address': u'192.168.12.59'} from (pid=27312) _receive /usr/lib/pymodules/python2.6/nova/rpc.py:167\nnova-compute.log-2011-04-28 10:10:53,937 DEBUG nova.rpc [-] unpacked context: {'timestamp': u'2011-04-28T14:10:53Z', 'remote_address': u'192.168.12.59', 'project': u'testproject', 'is_admin': True, 'user': u'root', 'request_id': u'CY6GJ4RK7C597B72E04-', 'read_deleted': False} from (pid=27312) _unpack_context /usr/lib/pymodules/python2.6/nova/rpc.py:331\nnova-compute.log-2011-04-28 10:10:53,994 AUDIT nova.compute.manager [CY6GJ4RK7C597B72E04- root testproject] instance 25: starting...\nnova-compute.log-2011-04-28 10:10:54,148 DEBUG nova.rpc [-] Making asynchronous call on network.HostedOSCC1 ... from (pid=27312) call /usr/lib/pymodules/python2.6/nova/rpc.py:350\nnova-compute.log-2011-04-28 10:10:54,148 DEBUG nova.rpc [-] MSG_ID is f35e1919189e4938a99f28f0ea77636c from (pid=27312) call /usr/lib/pymodules/python2.6/nova/rpc.py:353\nnova-compute.log-2011-04-28 10:10:54,557 ERROR nova [-] Exception during message handling\nnova-compute.log-(nova): TRACE: Traceback (most recent call last):\nnova-compute.log-(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 188, in _receive\nnova-compute.log-(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\nnova-compute.log-(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 120, in _wrap\nnova-compute.log-(nova): TRACE:     return f(*args, **kw)\nnova-compute.log-(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 222, in run_instance\nnova-compute.log-(nova): TRACE:     \"vpn\": is_vpn}})\nnova-compute.log-(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 385, in call\nnova-compute.log-(nova): TRACE:     raise wait_msg.result\nnova-compute.log:(nova): TRACE: RemoteError: TypeError 'NoneType' object is unsubscriptable\nnova-compute.log:(nova): TRACE: [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 188, in _receive\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 459, in allocate_fixed_ip\\n    self.driver.update_dhcp(context, network_ref[\\'id\\'])\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 607, in inner\\n    retval = f(*args, **kwargs)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 564, in update_dhcp\\n    f.write(get_dhcp_hosts(context, network_id))\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 546, in get_dhcp_hosts\\n    hosts.append(_host_dhcp(fixed_ip_ref))\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 654, in _host_dhcp\\n    return \"%s,%s.%s,%s\" % (instance_ref[\\'mac_address\\'],\\n', u\"TypeError: 'NoneType' object is unsubscriptable\\n\"]\nnova-compute.log-(nova): TRACE:", 
    "tags": [], 
    "importance": "Low", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/772681", 
    "owner": "https://api.launchpad.net/1.0/~kobagana-kumar", 
    "id": 772681, 
    "index": 5069, 
    "created": "2011-04-28 20:41:30.075050+00:00", 
    "title": "Instance becomes stuck in 'Networking' state due to nova-compute error", 
    "comments": [
        {
            "content": "HostedOSCC1# euca-run-instances ami-335e2dd1 -k ami-335e2dd1\n\nInstance became stuck in a networking state on the remote host HostedOS1.\n\nNova Version:   2011.3~bzr1033-0ubuntu0ppa1~lucid1\n\nNova config:\nroot@HostedOS1:/var/log/nova# cat /etc/nova/nova.conf\n--daemonize=1\n--dhcpbridge_flagfile=/etc/nova/nova.conf\n--dhcpbridge=/usr/bin/nova-dhcpbridge\n--logdir=/var/log/nova\n--state_path=/var/lib/nova\n--lock_path=/var/lock/nova\n--verbose=1\n--sql_connection=mysql://root:nova@192.168.12.59/nova\n--s3_host=192.168.12.59\n--rabbit_host=192.168.12.59\n--cc_host=192.168.12.59\n--ec2_url=http://192.168.12.59:8773/services/Cloud\n--network_manager=nova.network.manager.FlatDHCPManager\n--fixed_range=192.168.2.48/28\n--network_size=13\n--flat_network_dhcp_start=192.168.2.50\n\n\n\nLog:\n\nnova-compute.log-2011-04-28 10:10:53,936 DEBUG nova.rpc [-] received {u'_context_request_id': u'CY6GJ4RK7C597B72E04-', u'_context_read_deleted': False, u'args': {u'instance_id': 25, u'injected_files': None, u'availability_zone': None}, u'_context_is_admin': True, u'_context_timestamp': u'2011-04-28T14:10:53Z', u'_context_user': u'root', u'method': u'run_instance', u'_context_project': u'testproject', u'_context_remote_address': u'192.168.12.59'} from (pid=27312) _receive /usr/lib/pymodules/python2.6/nova/rpc.py:167\nnova-compute.log-2011-04-28 10:10:53,937 DEBUG nova.rpc [-] unpacked context: {'timestamp': u'2011-04-28T14:10:53Z', 'remote_address': u'192.168.12.59', 'project': u'testproject', 'is_admin': True, 'user': u'root', 'request_id': u'CY6GJ4RK7C597B72E04-', 'read_deleted': False} from (pid=27312) _unpack_context /usr/lib/pymodules/python2.6/nova/rpc.py:331\nnova-compute.log-2011-04-28 10:10:53,994 AUDIT nova.compute.manager [CY6GJ4RK7C597B72E04- root testproject] instance 25: starting...\nnova-compute.log-2011-04-28 10:10:54,148 DEBUG nova.rpc [-] Making asynchronous call on network.HostedOSCC1 ... from (pid=27312) call /usr/lib/pymodules/python2.6/nova/rpc.py:350\nnova-compute.log-2011-04-28 10:10:54,148 DEBUG nova.rpc [-] MSG_ID is f35e1919189e4938a99f28f0ea77636c from (pid=27312) call /usr/lib/pymodules/python2.6/nova/rpc.py:353\nnova-compute.log-2011-04-28 10:10:54,557 ERROR nova [-] Exception during message handling\nnova-compute.log-(nova): TRACE: Traceback (most recent call last):\nnova-compute.log-(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 188, in _receive\nnova-compute.log-(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\nnova-compute.log-(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 120, in _wrap\nnova-compute.log-(nova): TRACE:     return f(*args, **kw)\nnova-compute.log-(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 222, in run_instance\nnova-compute.log-(nova): TRACE:     \"vpn\": is_vpn}})\nnova-compute.log-(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 385, in call\nnova-compute.log-(nova): TRACE:     raise wait_msg.result\nnova-compute.log:(nova): TRACE: RemoteError: TypeError 'NoneType' object is unsubscriptable\nnova-compute.log:(nova): TRACE: [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 188, in _receive\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 459, in allocate_fixed_ip\\n    self.driver.update_dhcp(context, network_ref[\\'id\\'])\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 607, in inner\\n    retval = f(*args, **kwargs)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 564, in update_dhcp\\n    f.write(get_dhcp_hosts(context, network_id))\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 546, in get_dhcp_hosts\\n    hosts.append(_host_dhcp(fixed_ip_ref))\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 654, in _host_dhcp\\n    return \"%s,%s.%s,%s\" % (instance_ref[\\'mac_address\\'],\\n', u\"TypeError: 'NoneType' object is unsubscriptable\\n\"]\nnova-compute.log-(nova): TRACE:", 
            "date_created": "2011-04-28 20:41:30.075050+00:00", 
            "author": "https://api.launchpad.net/1.0/~janet-post"
        }, 
        {
            "content": "Looks like network manager failed to retrieve the instance from the database. Possibly a race condition? Are you still able to reproduce this, Janet?", 
            "date_created": "2011-08-30 20:57:39.959603+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "This bug is fixed in Essex version. I tried with:\n\"euca-run-instances ami-335e2dd1 -k ami-335e2dd1\"\n\nThen it creates instance and the instance comes to active state and not raising any error.", 
            "date_created": "2012-04-12 05:40:19.290196+00:00", 
            "author": "https://api.launchpad.net/1.0/~kobagana-kumar"
        }
    ]
}