{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:39:32.217228+00:00", 
    "description": "Fedora-x86_64-20-20140407-sda has 2 GiB virtual size.\n\n$ nova boot fed_1G_2  --image Fedora-x86_64-20-20140407-sda --flavor 1 --key-name mykey\n$ nova show fed_1G_2\n+--------------------------------------+------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                    |\n+--------------------------------------+------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                   |\n| OS-EXT-AZ:availability_zone          | nova                                                                                     |\n| OS-EXT-STS:power_state               | 0                                                                                        |\n| OS-EXT-STS:task_state                | -                                                                                        |\n| OS-EXT-STS:vm_state                  | error                                                                                    |\n| OS-SRV-USG:launched_at               | -                                                                                        |\n| OS-SRV-USG:terminated_at             | -                                                                                        |\n| accessIPv4                           |                                                                                          |\n| accessIPv6                           |                                                                                          |\n| config_drive                         |                                                                                          |\n| created                              | 2014-06-17T07:35:43Z                                                                     |\n| fault                                | {\"message\": \"No valid host was found. \", \"code\": 500, \"created\": \"2014-06-17T07:35:44Z\"} |\n| flavor                               | m1.tiny (1)                                                                              |\n| hostId                               | a904a292f4eb7f6735bef786c4a240a0b9240a6bc4f002519cb0e2b7                                 |\n| id                                   | 3c908a54-9682-40ad-8f12-a5bf64066660                                                     |\n| image                                | Fedora-x86_64-20-20140407-sda (085610a8-77ae-4bc8-9a28-3bcc1020e06e)                     |\n| key_name                             | mykey                                                                                    |\n| metadata                             | {}                                                                                       |\n| name                                 | fed_1G_2                                                                                 |\n| os-extended-volumes:volumes_attached | []                                                                                       |\n| private network                      | 10.1.0.5                                                                                 |\n| security_groups                      | default                                                                                  |\n| status                               | ERROR                                                                                    |\n| tenant_id                            | 1d26ad7003cf47e5b0107313be4832c3                                                         |\n| updated                              | 2014-06-17T07:35:44Z                                                                     |\n| user_id                              | bf52e56b9ca14648b391c5b6d490a0c1                                                         |\n+--------------------------------------+------------------------------------------------------------------------------------------+\n\n$ # nova flavor-list\n+-----+-----------+-----------+------+-----------+---------+-------+-------------+-----------+\n| ID  | Name      | Memory_MB | Disk | Ephemeral | Swap_MB | VCPUs | RXTX_Factor | Is_Public |\n+-----+-----------+-----------+------+-----------+---------+-------+-------------+-----------+\n| 1   | m1.tiny   | 512       | 1    | 0         |         | 1     | 1.0         | True      |\n| 2   | m1.small  | 2048      | 20   | 0         |         | 1     | 1.0         | True      |\n| 3   | m1.medium | 4096      | 40   | 0         |         | 2     | 1.0         | True      |\n| 4   | m1.large  | 8192      | 80   | 0         |         | 4     | 1.0         | True      |\n| 42  | m1.nano   | 64        | 0    | 0         |         | 1     | 1.0         | True      |\n| 451 | m1.heat   | 1024      | 0    | 0         |         | 2     | 1.0         | True      |\n| 5   | m1.xlarge | 16384     | 160  | 0         |         | 8     | 1.0         | True      |\n| 84  | m1.micro  | 128       | 0    | 0         |         | 1     | 1.0         | True      |\n+-----+-----------+-----------+------+-----------+---------+-------+-------------+-----------+\n\nMany images requires minimum 2,5,10 Gib as minimum disk size, the 1 used by m1.tiny is frequently not enough.\nIt might be increased to 10 or the original 0 should be restored.\n\nThis bug is about why I see 'message\": \"No valid host was found. \", \"code\": 500, \"created\": \"2014-06-17T07:35:44Z\"'\nwhen \"Flavor's disk is too small for requested image'\" was raised on the n-cpu side.\nIt is confusing, 'No valid host was found' type of messages sounds like there is no  n-cpu running, or all of them full.\n\n\n\ninstance: f62b56da-d1fa-4dc2-ae37-42b8fde3d3a5] Instance failed to spawn\n\u00a0Traceback (most recent call last):\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2064, in _build_resources\n\u00a0\u00a0\u00a0\u00a0\u00a0yield resources\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1966, in _build_and_run_instance\n\u00a0\u00a0\u00a0\u00a0\u00a0block_device_info=block_device_info)\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2233, in spawn\n\u00a0\u00a0\u00a0\u00a0\u00a0admin_pass=admin_password)\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2607, in _create_image\n\u00a0\u00a0\u00a0\u00a0\u00a0project_id=instance['project_id'])\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 182, in cache\n\u00a0\u00a0\u00a0\u00a0\u00a0*args, **kwargs)\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 374, in create_image\n\u00a0\u00a0\u00a0\u00a0\u00a0prepare_template(target=base, max_size=size, *args, **kwargs)\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/openstack/common/lockutils.py\", line 249, in inner\n\u00a0\u00a0\u00a0\u00a0\u00a0return f(*args, **kwargs)\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 172, in fetch_func_sync\n\u00a0\u00a0\u00a0\u00a0\u00a0fetch_func(target=target, *args, **kwargs)\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/virt/libvirt/utils.py\", line 658, in fetch_image\n\u00a0\u00a0\u00a0\u00a0\u00a0max_size=max_size)\n\u00a0\u00a0\u00a0File \"/opt/stack/new/nova/nova/virt/images.py\", line 110, in fetch_to_raw\n\u00a0\u00a0\u00a0\u00a0\u00a0raise exception.FlavorDiskTooSmall()\n\u00a0FlavorDiskTooSmall: Flavor's disk is too small for requested image.", 
    "tags": [
        "api"
    ], 
    "importance": "Medium", 
    "heat": 32, 
    "link": "https://bugs.launchpad.net/nova/+bug/1330856", 
    "owner": "https://api.launchpad.net/1.0/~thang-pham", 
    "id": 1330856, 
    "index": 3928, 
    "created": "2014-06-17 07:46:39.221397+00:00", 
    "title": "Confusing fault reasion when the flavors disk size was too small", 
    "comments": [
        {
            "content": "Fedora-x86_64-20-20140407-sda has 2 GiB virtual size.\n\n$ nova boot fed_1G_2  --image Fedora-x86_64-20-20140407-sda --flavor 1 --key-name mykey\n$ nova show fed_1G_2\n+--------------------------------------+------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                    |\n+--------------------------------------+------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                   |\n| OS-EXT-AZ:availability_zone          | nova                                                                                     |\n| OS-EXT-STS:power_state               | 0                                                                                        |\n| OS-EXT-STS:task_state                | -                                                                                        |\n| OS-EXT-STS:vm_state                  | error                                                                                    |\n| OS-SRV-USG:launched_at               | -                                                                                        |\n| OS-SRV-USG:terminated_at             | -                                                                                        |\n| accessIPv4                           |                                                                                          |\n| accessIPv6                           |                                                                                          |\n| config_drive                         |                                                                                          |\n| created                              | 2014-06-17T07:35:43Z                                                                     |\n| fault                                | {\"message\": \"No valid host was found. \", \"code\": 500, \"created\": \"2014-06-17T07:35:44Z\"} |\n| flavor                               | m1.tiny (1)                                                                              |\n| hostId                               | a904a292f4eb7f6735bef786c4a240a0b9240a6bc4f002519cb0e2b7                                 |\n| id                                   | 3c908a54-9682-40ad-8f12-a5bf64066660                                                     |\n| image                                | Fedora-x86_64-20-20140407-sda (085610a8-77ae-4bc8-9a28-3bcc1020e06e)                     |\n| key_name                             | mykey                                                                                    |\n| metadata                             | {}                                                                                       |\n| name                                 | fed_1G_2                                                                                 |\n| os-extended-volumes:volumes_attached | []                                                                                       |\n| private network                      | 10.1.0.5                                                                                 |\n| security_groups                      | default                                                                                  |\n| status                               | ERROR                                                                                    |\n| tenant_id                            | 1d26ad7003cf47e5b0107313be4832c3                                                         |\n| updated                              | 2014-06-17T07:35:44Z                                                                     |\n| user_id                              | bf52e56b9ca14648b391c5b6d490a0c1                                                         |\n+--------------------------------------+------------------------------------------------------------------------------------------+\n\n$ # nova flavor-list \n+-----+-----------+-----------+------+-----------+---------+-------+-------------+-----------+\n| ID  | Name      | Memory_MB | Disk | Ephemeral | Swap_MB | VCPUs | RXTX_Factor | Is_Public |\n+-----+-----------+-----------+------+-----------+---------+-------+-------------+-----------+\n| 1   | m1.tiny   | 512       | 1    | 0         |         | 1     | 1.0         | True      |\n| 2   | m1.small  | 2048      | 20   | 0         |         | 1     | 1.0         | True      |\n| 3   | m1.medium | 4096      | 40   | 0         |         | 2     | 1.0         | True      |\n| 4   | m1.large  | 8192      | 80   | 0         |         | 4     | 1.0         | True      |\n| 42  | m1.nano   | 64        | 0    | 0         |         | 1     | 1.0         | True      |\n| 451 | m1.heat   | 1024      | 0    | 0         |         | 2     | 1.0         | True      |\n| 5   | m1.xlarge | 16384     | 160  | 0         |         | 8     | 1.0         | True      |\n| 84  | m1.micro  | 128       | 0    | 0         |         | 1     | 1.0         | True      |\n+-----+-----------+-----------+------+-----------+---------+-------+-------------+-----------+\n\n\nMany images requires minimum 2,5,10 Gib as minimum disk size, the 1 used by m1.tiny is frequently not enough.\nIt might be increased to 10 or the original 0 should be restored.\n\nThis bug is about why I see 'message\": \"No valid host was found. \", \"code\": 500, \"created\": \"2014-06-17T07:35:44Z\"'\nwhen \"Flavor's disk is too small for requested image'\" was raised on the n-cpu side.\n\ninstance: f62b56da-d1fa-4dc2-ae37-42b8fde3d3a5] Instance failed to spawn\n Traceback (most recent call last):\n   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2064, in _build_resources\n     yield resources\n   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1966, in _build_and_run_instance\n     block_device_info=block_device_info)\n   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2233, in spawn\n     admin_pass=admin_password)\n   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2607, in _create_image\n     project_id=instance['project_id'])\n   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 182, in cache\n     *args, **kwargs)\n   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 374, in create_image\n     prepare_template(target=base, max_size=size, *args, **kwargs)\n   File \"/opt/stack/new/nova/nova/openstack/common/lockutils.py\", line 249, in inner\n     return f(*args, **kwargs)\n   File \"/opt/stack/new/nova/nova/virt/libvirt/imagebackend.py\", line 172, in fetch_func_sync\n     fetch_func(target=target, *args, **kwargs)\n   File \"/opt/stack/new/nova/nova/virt/libvirt/utils.py\", line 658, in fetch_image\n     max_size=max_size)\n   File \"/opt/stack/new/nova/nova/virt/images.py\", line 110, in fetch_to_raw\n     raise exception.FlavorDiskTooSmall()\n FlavorDiskTooSmall: Flavor's disk is too small for requested image.\n\nIt is confusing,  this type of message sounds like there is no  n-cpu running, or all of them full.", 
            "date_created": "2014-06-17 07:46:39.221397+00:00", 
            "author": "https://api.launchpad.net/1.0/~afazekas"
        }, 
        {
            "content": "Here's a theory:\n\nWe should catch the 3 Exceptions from _check_requested_image [1] in _build_and_run_instance [2] and NOT throw RescheduledException. Currently the FlavorDiskTooSmall ends up in the last Exception block which reschedules the deploy a few times and finally ends up throwing NoValidHost.\n\n[1] https://github.com/openstack/nova/blob/master/nova/compute/api.py#L598\n[2] https://github.com/openstack/nova/blob/master/nova/compute/manager.py#L1999\n", 
            "date_created": "2014-06-17 13:51:46.859114+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/101090", 
            "date_created": "2014-06-19 04:35:08.049245+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/101090\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=da9891a30b3a3eac39458d829abdd5bc50cf876e\nSubmitter: Jenkins\nBranch:    master\n\ncommit da9891a30b3a3eac39458d829abdd5bc50cf876e\nAuthor: Thang Pham <email address hidden>\nDate:   Thu Jun 19 00:19:13 2014 -0400\n\n    Catch image and flavor exceptions in _build_and_run_instance\n    \n    If a user selects a flavor with a disk size that is smaller than\n    the requested image, a FlavorDiskTooSmall exception is thrown.\n    However, this exception is not specifically caught in\n    _build_and_run_instance, but is caught as generic exception,\n    causing a RescheduledException to be thrown. This forces the\n    instance to be rescheduled a few times before finally throwing\n    a NoValidHost exception. It causes confusion because the actual\n    cause of it is that the disk size is smaller than the requested\n    image. The following patch properly catches exceptions thrown by\n    _check_requested_image in _build_and_run_instance.\n    \n    Change-Id: Ic8b435ba7e8721aa8ca54f29c1ad808833a7608d\n    Closes-Bug: #1330856\n", 
            "date_created": "2014-07-11 21:10:52.422289+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}