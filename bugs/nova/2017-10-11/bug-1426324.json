{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:52:19.553187+00:00", 
    "description": "kilo-2 introduce blkid calls for fs detection on all new instances; if the specified key is not found on the block device, blkid will return 2 instead of 0 - nova needs to deal with this:\n\n2015-02-27 10:48:51.270 3062 INFO nova.virt.disk.vfs.api [-] Unable to import guestfs, falling back to VFSLocalFS\n2015-02-27 10:48:51.476 3062 ERROR nova.compute.manager [-] [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Instance failed to spawn\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Traceback (most recent call last):\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2328, in _build_resources\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     yield resources\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2198, in _build_and_run_instance\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     flavor=flavor)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2329, in spawn\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     admin_pass=admin_password)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2728, in _create_image\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     project_id=instance['project_id'])\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 230, in cache\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     *args, **kwargs)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 507, in create_image\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     copy_qcow2_image(base, self.path, size)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 431, in inner\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     return f(*args, **kwargs)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 473, in copy_qcow2_image\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     disk.extend(target, size, use_cow=True)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/disk/api.py\", line 183, in extend\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     if not is_image_extendable(image, use_cow):\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/disk/api.py\", line 235, in is_image_extendable\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     if fs.get_image_fs() in SUPPORTED_FS_TO_EXTEND:\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/disk/vfs/localfs.py\", line 167, in get_image_fs\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     run_as_root=True)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 190, in execute\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     return processutils.execute(*cmd, **kwargs)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/oslo_concurrency/processutils.py\", line 228, in execute\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     cmd=sanitized_cmd)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] ProcessExecutionError: Unexpected error while running command.\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf blkid -o value -s TYPE /dev/nbd2\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Exit code: 2\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Stdout: u''\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Stderr: u''\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]\n\nProblemType: Bug\nDistroRelease: Ubuntu 14.04\nPackage: python-nova 1:2015.1~b2-0ubuntu5~cloud0 [modified: usr/lib/python2.7/dist-packages/nova/virt/disk/vfs/localfs.py] [origin: Canonical]\nProcVersionSignature: User Name 3.16.0-31.41~14.04.1-generic 3.16.7-ckt5\nUname: Linux 3.16.0-31-generic x86_64\nApportVersion: 2.14.1-0ubuntu3.7\nArchitecture: amd64\nCrashDB:\n {\n                \"impl\": \"launchpad\",\n                \"project\": \"cloud-archive\",\n                \"bug_pattern_url\": \"http://people.canonical.com/~ubuntu-archive/bugpatterns/bugpatterns.xml\",\n             }\nDate: Fri Feb 27 11:13:43 2015\nNovaConf: Error: [Errno 13] Permission denied: '/etc/nova/nova.conf'\nPackageArchitecture: all\nSourcePackage: nova\nUpgradeStatus: No upgrade log present (probably fresh install)", 
    "tags": [
        "amd64", 
        "apport-bug", 
        "in-stable-kilo", 
        "kilo-backport-potential", 
        "package-from-proposed", 
        "third-party-packages", 
        "trusty", 
        "uec-images"
    ], 
    "importance": "Low", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1426324", 
    "owner": "https://api.launchpad.net/1.0/~james-page", 
    "id": 1426324, 
    "index": 296, 
    "created": "2015-02-27 11:15:40.908199+00:00", 
    "title": "VFS blkid calls need to handle 0 or 2 return codes", 
    "comments": [
        {
            "content": "kilo-2 introduce blkid calls for fs detection on all new instances; if the specified key is not found on the block device, blkid will return 2 instead of 0 - nova needs to deal with this:\n\n2015-02-27 10:48:51.270 3062 INFO nova.virt.disk.vfs.api [-] Unable to import guestfs, falling back to VFSLocalFS\n2015-02-27 10:48:51.476 3062 ERROR nova.compute.manager [-] [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Instance failed to spawn\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Traceback (most recent call last):\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2328, in _build_resources\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     yield resources\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2198, in _build_and_run_instance\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     flavor=flavor)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2329, in spawn\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     admin_pass=admin_password)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2728, in _create_image\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     project_id=instance['project_id'])\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 230, in cache\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     *args, **kwargs)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 507, in create_image\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     copy_qcow2_image(base, self.path, size)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 431, in inner\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     return f(*args, **kwargs)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 473, in copy_qcow2_image\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     disk.extend(target, size, use_cow=True)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/disk/api.py\", line 183, in extend\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     if not is_image_extendable(image, use_cow):\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/disk/api.py\", line 235, in is_image_extendable\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     if fs.get_image_fs() in SUPPORTED_FS_TO_EXTEND:\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/virt/disk/vfs/localfs.py\", line 167, in get_image_fs\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     run_as_root=True)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 190, in execute\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     return processutils.execute(*cmd, **kwargs)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]   File \"/usr/lib/python2.7/dist-packages/oslo_concurrency/processutils.py\", line 228, in execute\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]     cmd=sanitized_cmd)\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] ProcessExecutionError: Unexpected error while running command.\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf blkid -o value -s TYPE /dev/nbd2\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Exit code: 2\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Stdout: u''\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b] Stderr: u''\n2015-02-27 10:48:51.476 3062 TRACE nova.compute.manager [instance: 1aa12a52-c91b-49b4-9636-63c39f7ba72b]\n\nProblemType: Bug\nDistroRelease: Ubuntu 14.04\nPackage: python-nova 1:2015.1~b2-0ubuntu5~cloud0 [modified: usr/lib/python2.7/dist-packages/nova/virt/disk/vfs/localfs.py] [origin: Canonical]\nProcVersionSignature: User Name 3.16.0-31.41~14.04.1-generic 3.16.7-ckt5\nUname: Linux 3.16.0-31-generic x86_64\nApportVersion: 2.14.1-0ubuntu3.7\nArchitecture: amd64\nCrashDB:\n {\n                \"impl\": \"launchpad\",\n                \"project\": \"cloud-archive\",\n                \"bug_pattern_url\": \"http://people.canonical.com/~ubuntu-archive/bugpatterns/bugpatterns.xml\",\n             }\nDate: Fri Feb 27 11:13:43 2015\nNovaConf: Error: [Errno 13] Permission denied: '/etc/nova/nova.conf'\nPackageArchitecture: all\nSourcePackage: nova\nUpgradeStatus: No upgrade log present (probably fresh install)", 
            "date_created": "2015-02-27 11:15:40.908199+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "", 
            "date_created": "2015-02-27 11:15:40.908199+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "Running this always was introduced by:\n\n  https://github.com/openstack/nova/commit/f2ab814f531f015561aebc46b3573c050b9c117d", 
            "date_created": "2015-02-27 11:18:52.406801+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "Confirming this is >= kilo-2 only.", 
            "date_created": "2015-02-27 11:19:02.548630+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/159797", 
            "date_created": "2015-02-27 11:31:27.614335+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This bug was fixed in the package nova - 1:2015.1~b2-0ubuntu6\n\n---------------\nnova (1:2015.1~b2-0ubuntu6) vivid; urgency=medium\n\n  * d/p/fixup-blkid.patch: Cherry pick inflight fix for return code\n    handling of blkid calls in libvirt kvm compute driver (LP: #1426324).\n -- James Page <email address hidden>   Tue, 03 Mar 2015 14:42:44 +0000", 
            "date_created": "2015-03-03 16:13:00.445157+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/159797\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=051fced477cdead4e307c23fc343da427beb6c81\nSubmitter: Jenkins\nBranch:    master\n\ncommit 051fced477cdead4e307c23fc343da427beb6c81\nAuthor: James Page <email address hidden>\nDate:   Fri Feb 27 11:27:30 2015 +0000\n\n    Handle return code 2 from blkid calls\n    \n    blkid returns code 2 if the requested TYPE key is not found\n    for the specified device.\n    \n    Ensure that this situation is handled correctly; blkid will\n    not return any data, so the return value will be empty.\n    \n    Change-Id: I38cd7b53cdfd694c0eba1b6054d8e4c33759b0b8\n    Closes-Bug: #1426324\n", 
            "date_created": "2015-05-11 18:44:06.550734+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/kilo\nReview: https://review.openstack.org/182716", 
            "date_created": "2015-05-13 15:24:46.634328+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/182716\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=1b941f1d61ed830cc43aa99b105a1c5629ceab42\nSubmitter: Jenkins\nBranch:    stable/kilo\n\ncommit 1b941f1d61ed830cc43aa99b105a1c5629ceab42\nAuthor: James Page <email address hidden>\nDate:   Fri Feb 27 11:27:30 2015 +0000\n\n    Handle return code 2 from blkid calls\n    \n    blkid returns code 2 if the requested TYPE key is not found\n    for the specified device.\n    \n    Ensure that this situation is handled correctly; blkid will\n    not return any data, so the return value will be empty.\n    \n    Change-Id: I38cd7b53cdfd694c0eba1b6054d8e4c33759b0b8\n    Closes-Bug: #1426324\n    (cherry picked from commit 051fced477cdead4e307c23fc343da427beb6c81)\n", 
            "date_created": "2015-05-15 02:03:42.647303+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}