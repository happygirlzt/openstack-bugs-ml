{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:10:17.130235+00:00", 
    "description": "nova rev 1388 on Ubuntu 11.04\n\nIf an error occur in injecting data in the image befor the boot, the libvirt driver raises an exception an just puts a warning log (cf. nova/virt/libvirt/connection.py\", line 919). But with the revision 1388, I get this error in nova-compute log and the instance fails :\n\n2011-08-08 14:40:18,776 INFO nova.virt.libvirt_conn [-] instance instance-00000015 : injection de clef dans l'image 6\n2011-08-08 14:40:18,776 DEBUG nova.utils [-] Execution de la commande (sous-processus) : sudo qemu-nbd -c /dev/nbd15 /var/lib/nova/instance\ns/instance-00000015/disk from (pid=18279) execute /usr/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:19,796 DEBUG nova.utils [-] Execution de la commande (sous-processus) : sudo tune2fs -c 0 -i 0 /dev/nbd15 from (pid=18279)\n execute /usr/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:21,372 DEBUG nova.utils [-] Execution de la commande (sous-processus) : sudo mount /dev/nbd15 /tmp/tmpcz0Gtc from (pid=182\n79) execute /usr/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:21,391 DEBUG nova.utils [-] Le r\u00e9sultat \u00e9tait 32 from (pid=18279) execute /usr/lib/pymodules/python2.7/nova/utils.py:176\n2011-08-08 14:40:21,391 DEBUG nova.utils [-] Execution de la commande (sous-processus) : rmdir /tmp/tmpcz0Gtc from (pid=18279) execute /usr\n/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:21,401 DEBUG nova.utils [-] Execution de la commande (sous-processus) : sudo qemu-nbd -d /dev/nbd15 from (pid=18279) execu\nte /usr/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:21,417 ERROR nova.exception [-] Exception non pr\u00e9vue\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 97, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 585, in spawn\n(nova.exception): TRACE:     block_device_mapping=block_device_mapping)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 919, in _create_image\n(nova.exception): TRACE:     ' data into image %(img_id)s (%(e)s)') % locals())\n(nova.exception): TRACE: UnicodeEncodeError: 'ascii' codec can't encode character u'\\xe9' in position 11: ordinal not in range(128)\n(nova.exception): TRACE: \n2011-08-08 14:40:21,418 ERROR nova.compute.manager [-] Instance '21' failed to spawn. Is virtualization enabled in the BIOS? Details: 'asci\ni' codec can't encode character u'\\xe9' in position 11: ordinal not in range(128)\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 357, in _run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(context, instance, network_info, bd_mapping)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 124, in wrapped\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: 'ascii' codec can't encode character u'\\xe9' in position 11: ordinal not in range(128)\n(nova.compute.manager): TRACE: \n2011-08-08 14:40:21,523 DEBUG nova.compute.manager [-] V\u00e9rification de l'\u00e9tat de instance-00000015 from (pid=18279) _update_state /usr/lib/\npymodules/python2.7/nova/compute/manager.py:183", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/822666", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 822666, 
    "index": 2495, 
    "created": "2011-08-08 12:48:32.766611+00:00", 
    "title": "Exception injecting key results in another error in some i18n cases", 
    "comments": [
        {
            "content": "nova rev 1388 on Ubuntu 11.04\n\nIf an error occur in injecting data in the image befor the boot, the libvirt driver raises an exception an just puts a warning log (cf. nova/virt/libvirt/connection.py\", line 919). But with the revision 1388, I get this error in nova-compute log and the instance fails :\n\n2011-08-08 14:40:18,776 INFO nova.virt.libvirt_conn [-] instance instance-00000015 : injection de clef dans l'image 6\n2011-08-08 14:40:18,776 DEBUG nova.utils [-] Execution de la commande (sous-processus) : sudo qemu-nbd -c /dev/nbd15 /var/lib/nova/instance\ns/instance-00000015/disk from (pid=18279) execute /usr/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:19,796 DEBUG nova.utils [-] Execution de la commande (sous-processus) : sudo tune2fs -c 0 -i 0 /dev/nbd15 from (pid=18279)\n execute /usr/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:21,372 DEBUG nova.utils [-] Execution de la commande (sous-processus) : sudo mount /dev/nbd15 /tmp/tmpcz0Gtc from (pid=182\n79) execute /usr/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:21,391 DEBUG nova.utils [-] Le r\u00e9sultat \u00e9tait 32 from (pid=18279) execute /usr/lib/pymodules/python2.7/nova/utils.py:176\n2011-08-08 14:40:21,391 DEBUG nova.utils [-] Execution de la commande (sous-processus) : rmdir /tmp/tmpcz0Gtc from (pid=18279) execute /usr\n/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:21,401 DEBUG nova.utils [-] Execution de la commande (sous-processus) : sudo qemu-nbd -d /dev/nbd15 from (pid=18279) execu\nte /usr/lib/pymodules/python2.7/nova/utils.py:158\n2011-08-08 14:40:21,417 ERROR nova.exception [-] Exception non pr\u00e9vue\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 97, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 585, in spawn\n(nova.exception): TRACE:     block_device_mapping=block_device_mapping)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 919, in _create_image\n(nova.exception): TRACE:     ' data into image %(img_id)s (%(e)s)') % locals())\n(nova.exception): TRACE: UnicodeEncodeError: 'ascii' codec can't encode character u'\\xe9' in position 11: ordinal not in range(128)\n(nova.exception): TRACE: \n2011-08-08 14:40:21,418 ERROR nova.compute.manager [-] Instance '21' failed to spawn. Is virtualization enabled in the BIOS? Details: 'asci\ni' codec can't encode character u'\\xe9' in position 11: ordinal not in range(128)\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 357, in _run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(context, instance, network_info, bd_mapping)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 124, in wrapped\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: 'ascii' codec can't encode character u'\\xe9' in position 11: ordinal not in range(128)\n(nova.compute.manager): TRACE: \n2011-08-08 14:40:21,523 DEBUG nova.compute.manager [-] V\u00e9rification de l'\u00e9tat de instance-00000015 from (pid=18279) _update_state /usr/lib/\npymodules/python2.7/nova/compute/manager.py:183", 
            "date_created": "2011-08-08 12:48:32.766611+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "I found the problem. I use a system configure in french language.\nIn this case, the return error message contains some accentuated letters and the log message cannot decode this warning.\n\nIs it a bug ?", 
            "date_created": "2011-08-09 10:32:49.400724+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "Looks like a resurgence of bug 733079", 
            "date_created": "2011-08-09 13:45:58.346693+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "There is the same type of error hiding in case a utils.execute calls fails:\r\n\r\nin exception.py, see ProcessExecutionError\r\n\r\n message = _('%(description)s\\nCommand: %(cmd)s\\n'\r\n                    'Exit code: %(exit_code)s\\nStdout: %(stdout)r\\n'\r\n                    'Stderr: %(stderr)r') % locals()\r\n\r\ndescription unfortunately may contain unicode from i18n.", 
            "date_created": "2011-08-11 13:46:44.420315+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Here what I've diagnosed:\n\n* Python 3 uses unicode strings everywhere, but Python 2 has two different string types - str and unicode\n\n* If you call str(s) on a unicode string with extended characters, it tries to convert to ascii (the default python 2 encoding) and it fails with the exception above\n\n* If we use unicode types everywhere, we'd be OK.\n\n* _ returns unicode strings (because we called install with unicode=1).  This is good.\n\n* I think this bug report relates to this call:\n(nova.compute.manager): TRACE: raise Error(str(e))\n\n* That call was removed in this commit, so this particular bug has been fixed:\ngit show 19b3b7a0c50dd6a68238daf8\n\n* However, this does mean that everywhere we call str(x) is potentially problematic (?).  I'm going to open another bug on this issue.", 
            "date_created": "2012-02-02 21:41:27.827190+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }
    ]
}