{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:16:50.701893+00:00", 
    "description": "When I called Nova V3 API 'GET v3/os-cells/capacities', an 'Unexpected API Error.' occurred.\n\nhttp://logs.openstack.org/57/78157/1/check/check-tempest-dsvm-full/bcb3b6b/console.html#_2014-03-05_11_56_34_285\nconsole.html\n------------------------------------------------------------------------------------------------------------------------------------------\n2014-03-05 11:56:34.283 | pythonlogging:'': {{{\n2014-03-05 11:56:34.283 | 2014-03-05 11:30:18,083 Request: POST http://127.0.0.1:5000/v2.0/tokens\n2014-03-05 11:56:34.283 | 2014-03-05 11:30:18,083 Request Headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,083 Request Body: {\"auth\": {\"tenantName\": \"CellsV3Test-1270506035\", \"passwordCredentials\": {\"username\": \"CellsV3Test-365545871\", \"password\": \"pass\"}}}\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,312 Response Status: 200\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,312 Response Headers: {'content-length': '10648', 'date': 'Wed, 05 Mar 2014 11:30:18 GMT', 'content-type': 'application/json', 'vary': 'X-Auth-Token', 'connection': 'close'}\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,312 Response Body: {\"access\": {\"token\": {\"issued_at\": \"2014-03-05T11:30:18.255082\", \"expires\": \"2014-03-05T12:30:18Z\", \"id\": \"<TOKEN>\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,312 Large body (10648) md5 summary: a72282e83c228bfcf861c768bbcbdf79\n2014-03-05 11:56:34.285 | 2014-03-05 11:30:18,313 Request: GET http://127.0.0.1:8774/v3/os-cells/capacities\n2014-03-05 11:56:34.285 | 2014-03-05 11:30:18,313 Request Headers: {'Content-Type': 'application/json', 'Accept': 'application/json', 'X-Auth-Token': '<Token omitted>'}\n2014-03-05 11:56:34.285 | 2014-03-05 11:31:18,373 Response Status: 500\n2014-03-05 11:56:34.285 | 2014-03-05 11:31:18,373 Nova/Cinder request id: req-ae22c360-c3b8-4ad5-86d1-37e5664fb9ea\n2014-03-05 11:56:34.285 | 2014-03-05 11:31:18,373 Response Headers: {'content-length': '216', 'date': 'Wed, 05 Mar 2014 11:31:18 GMT', 'content-type': 'application/json; charset=UTF-8', 'connection': 'close'}\n2014-03-05 11:56:34.285 | 2014-03-05 11:31:18,373 Response Body: {\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'oslo.messaging.exceptions.MessagingTimeout'>\", \"code\": 500}}\n2014-03-05 11:56:34.285 | }}}\n------------------------------------------------------------------------------------------------------------------------------------------\n\nFull logs are:\nhttp://logs.openstack.org/57/78157/1/check/check-tempest-dsvm-full/bcb3b6b", 
    "tags": [
        "api"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1288214", 
    "owner": "https://api.launchpad.net/1.0/~cyeoh-0", 
    "id": 1288214, 
    "index": 6081, 
    "created": "2014-03-05 12:09:07.845810+00:00", 
    "title": "Calling GET v3/os-cells/capacities causes an 'Unexpected API Error.'", 
    "comments": [
        {
            "content": "When I called Nova V3 API 'GET v3/os-cells/capacities', an 'Unexpected API Error.' occurred.\n\nhttp://logs.openstack.org/57/78157/1/check/check-tempest-dsvm-full/bcb3b6b/console.html#_2014-03-05_11_56_34_285\nconsole.html\n------------------------------------------------------------------------------------------------------------------------------------------\n2014-03-05 11:56:34.283 | pythonlogging:'': {{{\n2014-03-05 11:56:34.283 | 2014-03-05 11:30:18,083 Request: POST http://127.0.0.1:5000/v2.0/tokens\n2014-03-05 11:56:34.283 | 2014-03-05 11:30:18,083 Request Headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,083 Request Body: {\"auth\": {\"tenantName\": \"CellsV3Test-1270506035\", \"passwordCredentials\": {\"username\": \"CellsV3Test-365545871\", \"password\": \"pass\"}}}\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,312 Response Status: 200\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,312 Response Headers: {'content-length': '10648', 'date': 'Wed, 05 Mar 2014 11:30:18 GMT', 'content-type': 'application/json', 'vary': 'X-Auth-Token', 'connection': 'close'}\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,312 Response Body: {\"access\": {\"token\": {\"issued_at\": \"2014-03-05T11:30:18.255082\", \"expires\": \"2014-03-05T12:30:18Z\", \"id\": \"<TOKEN>\n2014-03-05 11:56:34.284 | 2014-03-05 11:30:18,312 Large body (10648) md5 summary: a72282e83c228bfcf861c768bbcbdf79\n2014-03-05 11:56:34.285 | 2014-03-05 11:30:18,313 Request: GET http://127.0.0.1:8774/v3/os-cells/capacities\n2014-03-05 11:56:34.285 | 2014-03-05 11:30:18,313 Request Headers: {'Content-Type': 'application/json', 'Accept': 'application/json', 'X-Auth-Token': '<Token omitted>'}\n2014-03-05 11:56:34.285 | 2014-03-05 11:31:18,373 Response Status: 500\n2014-03-05 11:56:34.285 | 2014-03-05 11:31:18,373 Nova/Cinder request id: req-ae22c360-c3b8-4ad5-86d1-37e5664fb9ea\n2014-03-05 11:56:34.285 | 2014-03-05 11:31:18,373 Response Headers: {'content-length': '216', 'date': 'Wed, 05 Mar 2014 11:31:18 GMT', 'content-type': 'application/json; charset=UTF-8', 'connection': 'close'}\n2014-03-05 11:56:34.285 | 2014-03-05 11:31:18,373 Response Body: {\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'oslo.messaging.exceptions.MessagingTimeout'>\", \"code\": 500}}\n2014-03-05 11:56:34.285 | }}}\n------------------------------------------------------------------------------------------------------------------------------------------\n\nFull logs are:\nhttp://logs.openstack.org/57/78157/1/check/check-tempest-dsvm-full/bcb3b6b", 
            "date_created": "2014-03-05 12:09:07.845810+00:00", 
            "author": "https://api.launchpad.net/1.0/~igawa"
        }, 
        {
            "content": "This is the corresponding nova-api log message.\n\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/extensions.py\", line 472, in wrapped\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/plugins/v3/cells.py\", line 152, in capacities\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     cell_name=id)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/cells/rpcapi.py\", line 349, in get_capacities\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     return cctxt.call(ctxt, 'get_capacities', cell_name=cell_name)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/oslo.messaging/oslo/messaging/rpc/client.py\", line 150, in call\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     wait_for_reply=True, timeout=timeout)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/oslo.messaging/oslo/messaging/transport.py\", line 90, in _send\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     timeout=timeout)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/oslo.messaging/oslo/messaging/_drivers/amqpdriver.py\", line 409, in send\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     return self._send(target, ctxt, message, wait_for_reply, timeout)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/oslo.messaging/oslo/messaging/_drivers/amqpdriver.py\", line 400, in _send\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     result = self._waiter.wait(msg_id, timeout)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/oslo.messaging/oslo/messaging/_drivers/amqpdriver.py\", line 267, in wait\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     reply, ending = self._poll_connection(msg_id, timeout)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions   File \"/opt/stack/new/oslo.messaging/oslo/messaging/_drivers/amqpdriver.py\", line 217, in _poll_connection\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions     % msg_id)\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions MessagingTimeout: Timed out waiting for a reply to message ID 47f8ba13bf9841d5a24c6339e0f2561c\n2014-03-05 11:31:18.368 27772 TRACE nova.api.openstack.extensions \n\nIt looks like cells is not configured for the test system as the rpc is timing out. We could handle MessagingTimeout exceptions, but I think theoretically we'd have to handle that for every rpc call.  I think for tempest though we should not be calling the cells API unless we know the target system is configured with cells enabled. Maybe we should catch this all earlier if cells is not enabled\n\n", 
            "date_created": "2014-03-17 06:22:23.050703+00:00", 
            "author": "https://api.launchpad.net/1.0/~cyeoh-0"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/81155", 
            "date_created": "2014-03-18 03:22:25.470320+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/81155\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=dcc760238053da90ac1b83212a004f67fffebee2\nSubmitter: Jenkins\nBranch:    master\n\ncommit dcc760238053da90ac1b83212a004f67fffebee2\nAuthor: Christopher Yeoh <email address hidden>\nDate:   Tue Mar 18 14:16:28 2014 +1100\n\n    Cells API calls return 501 when cells disabled\n    \n    When cells is not enabled the cells API calls should return\n    a 501 NotImplemented rather than have the internals\n    eventually raise various errors which may include timeout\n    errors.\n    \n    +DocImpact: cells API calls will now return a 501 if cells is disabled\n    Closes-Bug: 1288214\n    \n    Change-Id: I07e69bbe11ec88cd3f07b47846f3a0a5c9e6f3dc\n", 
            "date_created": "2014-03-18 21:04:06.071044+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}