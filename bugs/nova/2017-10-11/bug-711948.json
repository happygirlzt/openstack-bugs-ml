{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:36:22.296928+00:00", 
    "description": "Sometimes when starting nova network, it crashes trying to create iptables rules for floating forward with the following traceback:\n\nAUDIT [N/A] Starting network node\nTraceback (most recent call last):\n  File \"/usr/bin/nova-network\", line 44, in <module>\n    service.serve()\n  File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 239, in serve\n    x.start()\n  File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 80, in start\n    self.manager.init_host()\n  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 448, in init_host\n    super(VlanManager, self).init_host()\n  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 131, in init_host\n    fixed_address)\n  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 155, in ensure_floating_forward\n    % (fixed_ip, floating_ip))\n  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 296, in _confirm_rule\n    _execute(\"sudo iptables %s %s %s\" % (loc, chain, cmd))\n  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 277, in _execute\n    return utils.execute(cmd, *args, **kwargs)\n  File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 144, in execute\n    cmd=cmd)\nnova.exception.ProcessExecutionError: Unexpected error while running command.\nCommand: sudo iptables -I SNATTING -t nat -s 10.0.0.3 -j SNAT --to 140.221.100.12\nExit code: 1\nStdout: ''\nStderr: 'iptables: No chain/target/match by that name.\\n'\n\nThis happens if the iptables rules have been flushed due to manual changes or node restart.  It is due to two commands being run out of order.  Manual workaround is as follows:\n\non the network host:\nsudo iptables -t nat -N SNATTING\nsudo iptables -t nat -A POSTROUTING -j SNATTING\n\nthen nova-network should start normally\n\nif you have --use_nova_chains set to true, the error message will reference nova_snatting instead of SNATTING and the workouround is the following commands:\nsudo iptables -t nat -N nova_snatting\nsudo iptables -t nat -A POSTROUTING -j nova_snatting\n\nThis can be fixed by moving where init_host is run.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/711948", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 711948, 
    "index": 2268, 
    "created": "2011-02-02 16:10:28.877668+00:00", 
    "title": "nova-network crashes on restart with floating ips assigned", 
    "comments": [
        {
            "content": "Sometimes when starting nova network, it crashes trying to create iptables rules for floating forward with the following traceback:\n\nAUDIT [N/A] Starting network node\nTraceback (most recent call last):\n  File \"/usr/bin/nova-network\", line 44, in <module>\n    service.serve()\n  File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 239, in serve\n    x.start()\n  File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 80, in start\n    self.manager.init_host()\n  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 448, in init_host\n    super(VlanManager, self).init_host()\n  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 131, in init_host\n    fixed_address)\n  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 155, in ensure_floating_forward\n    % (fixed_ip, floating_ip))\n  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 296, in _confirm_rule\n    _execute(\"sudo iptables %s %s %s\" % (loc, chain, cmd))\n  File \"/usr/lib/pymodules/python2.6/nova/network/linux_net.py\", line 277, in _execute\n    return utils.execute(cmd, *args, **kwargs)\n  File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 144, in execute\n    cmd=cmd)\nnova.exception.ProcessExecutionError: Unexpected error while running command.\nCommand: sudo iptables -I SNATTING -t nat -s 10.0.0.3 -j SNAT --to 140.221.100.12\nExit code: 1\nStdout: ''\nStderr: 'iptables: No chain/target/match by that name.\\n'\n\nThis happens if the iptables rules have been flushed due to manual changes or node restart.  It is due to two commands being run out of order.  Manual workaround is as follows:\n\non the network host:\nsudo iptables -t nat -N SNATTING\nsudo iptables -t nat -A POSTROUTING -j SNATTING\n\nthen nova-network should start normally\n\nif you have --use_nova_chains set to true, the error message will reference nova_snatting instead of SNATTING and the workouround is the following commands:\nsudo iptables -t nat -N nova_snatting\nsudo iptables -t nat -A POSTROUTING -j nova_snatting\n\nThis can be fixed by moving where init_host is run.", 
            "date_created": "2011-02-02 16:10:28.877668+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ]
}