{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:13:11.381754+00:00", 
    "description": "How to reproduce:\n\ninstall from the master branch. Make sure resume_guests_state_on_host_boot=True\n\nStart an instance. Once the instance is in running, reboot the compute node.\n\nAfter reboot, the nova-compute daemon can no longer start. Here is the traceback:\n\n2013-02-18 20:13:10.703 INFO nova.compute.manager [req-2399728a-770e-469a-98d2-018caa9cc482 None None] [instance:\n 3422520b-0c31-4f99-8cb0-8c6416a5f15a] Rebooting instance after nova-compute restart.\n2013-02-18 20:13:10.703 DEBUG nova.openstack.common.rpc.amqp [req-2399728a-770e-469a-98d2-018caa9cc482 None None]\n Making synchronous call on conductor ... multicall /usr/local/lib/python2.7/dist-packages/nova/openstack/common/\nrpc/amqp.py:362\n2013-02-18 20:13:10.703 DEBUG nova.openstack.common.rpc.amqp [req-2399728a-770e-469a-98d2-018caa9cc482 None None]\n MSG_ID is 387dff66e09f4c489a53afbafb9d8906 multicall /usr/local/lib/python2.7/dist-packages/nova/openstack/commo\nn/rpc/amqp.py:365\n2013-02-18 20:13:10.779 1291 CRITICAL nova [-] string indices must be integers\nTraceback (most recent call last):\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 235, in block_device_mapping_get_\nall_by_instance\n    context, instance['uuid'])\n\nTypeError: string indices must be integers\n2013-02-18 20:13:10.779 1291 TRACE nova Traceback (most recent call last):\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/bin/nova-compute\", line 84, in <module>\n2013-02-18 20:13:10.779 1291 TRACE nova     service.wait()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/service.py\", line 209\n, in wait\n2013-02-18 20:13:10.779 1291 TRACE nova     super(ServiceLauncher, self).wait()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/service.py\", line 179\n, in wait\n2013-02-18 20:13:10.779 1291 TRACE nova     service.wait()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\",\nline 168, in wait\n2013-02-18 20:13:10.779 1291 TRACE nova     return self._exit_event.wait()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 1\n16, in wait\n2013-02-18 20:13:10.779 1291 TRACE nova     return hubs.get_hub().switch()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", lin\ne 187, in switch\n2013-02-18 20:13:10.779 1291 TRACE nova     return self.greenlet.switch()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\",\nline 194, in main\n2013-02-18 20:13:10.779 1291 TRACE nova     result = function(*args, **kwargs)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/service.py\", line 147\n, in run_server\n2013-02-18 20:13:10.779 1291 TRACE nova     server.start()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/service.py\", line 429\n, in start\n2013-02-18 20:13:10.779 1291 TRACE nova     self.manager.init_host()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/compute/manager.py\",\nline 516, in init_host\n2013-02-18 20:13:10.779 1291 TRACE nova     self._init_instance(context, instance)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/compute/manager.py\",\nline 475, in _init_instance\n2013-02-18 20:13:10.779 1291 TRACE nova     context, instance['uuid'])\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/compute/manager.py\",\nline 1039, in _get_instance_volume_block_device_info\n2013-02-18 20:13:10.779 1291 TRACE nova     bdms = self._get_instance_volume_bdms(context, instance)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/compute/manager.py\",\nline 1023, in _get_instance_volume_bdms\n2013-02-18 20:13:10.779 1291 TRACE nova     context, instance))\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/api.py\", li\nne 535, in block_device_mapping_get_all_by_instance\n2013-02-18 20:13:10.779 1291 TRACE nova     context, instance)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/rpcapi.py\",\n line 233, in block_device_mapping_get_all_by_instance\n2013-02-18 20:13:10.779 1291 TRACE nova     return self.call(context, msg, version='1.13')\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\nproxy.py\", line 80, in call\n2013-02-18 20:13:10.779 1291 TRACE nova     return rpc.call(context, self._get_topic(topic), msg, timeout)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\n__init__.py\", line 139, in call\n2013-02-18 20:13:10.779 1291 TRACE nova     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\nimpl_kombu.py\", line 772, in call\n2013-02-18 20:13:10.779 1291 TRACE nova     rpc_amqp.get_connection_pool(conf, Connection))\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\namqp.py\", line 379, in call\n2013-02-18 20:13:10.779 1291 TRACE nova     rv = list(rv)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\namqp.py\", line 347, in __iter__\n2013-02-18 20:13:10.779 1291 TRACE nova     raise result\n2013-02-18 20:13:10.779 1291 TRACE nova TypeError: string indices must be integers\n2013-02-18 20:13:10.779 1291 TRACE nova Traceback (most recent call last):\n2013-02-18 20:13:10.779 1291 TRACE nova\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\namqp.py\", line 276, in _process_data\n2013-02-18 20:13:10.779 1291 TRACE nova     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-02-18 20:13:10.779 1291 TRACE nova\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\ndispatcher.py\", line 133, in dispatch\n2013-02-18 20:13:10.779 1291 TRACE nova     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-02-18 20:13:10.779 1291 TRACE nova\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/manager.py\"\n, line 235, in block_device_mapping_get_all_by_instance\n2013-02-18 20:13:10.779 1291 TRACE nova     context, instance['uuid'])\n2013-02-18 20:13:10.779 1291 TRACE nova\n2013-02-18 20:13:10.779 1291 TRACE nova TypeError: string indices must be integers\n2013-02-18 20:13:10.779 1291 TRACE nova", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1129441", 
    "owner": "https://api.launchpad.net/1.0/~yunmao", 
    "id": 1129441, 
    "index": 3235, 
    "created": "2013-02-18 20:20:15.621519+00:00", 
    "title": "nova-compute no longer work after reboot with instances running", 
    "comments": [
        {
            "content": "How to reproduce:\n\ninstall from the master branch. Make sure resume_guests_state_on_host_boot=True\n\nStart an instance. Once the instance is in running, reboot the compute node.\n\nAfter reboot, the nova-compute daemon can no longer start. Here is the traceback:\n\n2013-02-18 20:13:10.703 INFO nova.compute.manager [req-2399728a-770e-469a-98d2-018caa9cc482 None None] [instance:\n 3422520b-0c31-4f99-8cb0-8c6416a5f15a] Rebooting instance after nova-compute restart.\n2013-02-18 20:13:10.703 DEBUG nova.openstack.common.rpc.amqp [req-2399728a-770e-469a-98d2-018caa9cc482 None None]\n Making synchronous call on conductor ... multicall /usr/local/lib/python2.7/dist-packages/nova/openstack/common/\nrpc/amqp.py:362\n2013-02-18 20:13:10.703 DEBUG nova.openstack.common.rpc.amqp [req-2399728a-770e-469a-98d2-018caa9cc482 None None]\n MSG_ID is 387dff66e09f4c489a53afbafb9d8906 multicall /usr/local/lib/python2.7/dist-packages/nova/openstack/commo\nn/rpc/amqp.py:365\n2013-02-18 20:13:10.779 1291 CRITICAL nova [-] string indices must be integers\nTraceback (most recent call last):\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 235, in block_device_mapping_get_\nall_by_instance\n    context, instance['uuid'])\n\nTypeError: string indices must be integers\n2013-02-18 20:13:10.779 1291 TRACE nova Traceback (most recent call last):\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/bin/nova-compute\", line 84, in <module>\n2013-02-18 20:13:10.779 1291 TRACE nova     service.wait()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/service.py\", line 209\n, in wait\n2013-02-18 20:13:10.779 1291 TRACE nova     super(ServiceLauncher, self).wait()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/service.py\", line 179\n, in wait\n2013-02-18 20:13:10.779 1291 TRACE nova     service.wait()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\",\nline 168, in wait\n2013-02-18 20:13:10.779 1291 TRACE nova     return self._exit_event.wait()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 1\n16, in wait\n2013-02-18 20:13:10.779 1291 TRACE nova     return hubs.get_hub().switch()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", lin\ne 187, in switch\n2013-02-18 20:13:10.779 1291 TRACE nova     return self.greenlet.switch()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\",\nline 194, in main\n2013-02-18 20:13:10.779 1291 TRACE nova     result = function(*args, **kwargs)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/service.py\", line 147\n, in run_server\n2013-02-18 20:13:10.779 1291 TRACE nova     server.start()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/service.py\", line 429\n, in start\n2013-02-18 20:13:10.779 1291 TRACE nova     self.manager.init_host()\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/compute/manager.py\",\nline 516, in init_host\n2013-02-18 20:13:10.779 1291 TRACE nova     self._init_instance(context, instance)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/compute/manager.py\",\nline 475, in _init_instance\n2013-02-18 20:13:10.779 1291 TRACE nova     context, instance['uuid'])\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/compute/manager.py\",\nline 1039, in _get_instance_volume_block_device_info\n2013-02-18 20:13:10.779 1291 TRACE nova     bdms = self._get_instance_volume_bdms(context, instance)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/compute/manager.py\",\nline 1023, in _get_instance_volume_bdms\n2013-02-18 20:13:10.779 1291 TRACE nova     context, instance))\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/api.py\", li\nne 535, in block_device_mapping_get_all_by_instance\n2013-02-18 20:13:10.779 1291 TRACE nova     context, instance)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/rpcapi.py\",\n line 233, in block_device_mapping_get_all_by_instance\n2013-02-18 20:13:10.779 1291 TRACE nova     return self.call(context, msg, version='1.13')\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\nproxy.py\", line 80, in call\n2013-02-18 20:13:10.779 1291 TRACE nova     return rpc.call(context, self._get_topic(topic), msg, timeout)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\n__init__.py\", line 139, in call\n2013-02-18 20:13:10.779 1291 TRACE nova     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\nimpl_kombu.py\", line 772, in call\n2013-02-18 20:13:10.779 1291 TRACE nova     rpc_amqp.get_connection_pool(conf, Connection))\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\namqp.py\", line 379, in call\n2013-02-18 20:13:10.779 1291 TRACE nova     rv = list(rv)\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\namqp.py\", line 347, in __iter__\n2013-02-18 20:13:10.779 1291 TRACE nova     raise result\n2013-02-18 20:13:10.779 1291 TRACE nova TypeError: string indices must be integers\n2013-02-18 20:13:10.779 1291 TRACE nova Traceback (most recent call last):\n2013-02-18 20:13:10.779 1291 TRACE nova\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\namqp.py\", line 276, in _process_data\n2013-02-18 20:13:10.779 1291 TRACE nova     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-02-18 20:13:10.779 1291 TRACE nova\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/openstack/common/rpc/\ndispatcher.py\", line 133, in dispatch\n2013-02-18 20:13:10.779 1291 TRACE nova     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-02-18 20:13:10.779 1291 TRACE nova\n2013-02-18 20:13:10.779 1291 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/manager.py\"\n, line 235, in block_device_mapping_get_all_by_instance\n2013-02-18 20:13:10.779 1291 TRACE nova     context, instance['uuid'])\n2013-02-18 20:13:10.779 1291 TRACE nova\n2013-02-18 20:13:10.779 1291 TRACE nova TypeError: string indices must be integers\n2013-02-18 20:13:10.779 1291 TRACE nova", 
            "date_created": "2013-02-18 20:20:15.621519+00:00", 
            "author": "https://api.launchpad.net/1.0/~yunmao"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/22235", 
            "date_created": "2013-02-18 20:26:58.662700+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/22235\nCommitted: http://github.com/openstack/nova/commit/376dafd32f8b985e2af556315d9f33cfb62df96f\nSubmitter: Jenkins\nBranch:    master\n\ncommit 376dafd32f8b985e2af556315d9f33cfb62df96f\nAuthor: Yun Mao <email address hidden>\nDate:   Mon Feb 18 15:25:01 2013 -0500\n\n    Fix _get_instance_volume_block_device_info call parameter\n    \n    _get_instance_volume_block_device_info() is expecting an\n    instance dict-like object instead of instance_uuid\n    \n    Fix bug 1129441\n    \n    Change-Id: Id4d536553ce9858434c377653fa79562e1282a34\n", 
            "date_created": "2013-02-19 10:13:12.500907+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}