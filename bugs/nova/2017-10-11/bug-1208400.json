{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 12:00:14.677547+00:00", 
    "description": "Currently, user quota could be updated exceed the project quota, if the user quota was not set before.\n\nReproduce:\n# keystone tenant-list\n+----------------------------------+------------------+---------+\n|                id                |       name       | enabled |\n+----------------------------------+------------------+---------+\n| 21f7a02dbfd94979b83b3b551c78e380 |      admin       |   True  |\n| ebe1d1e9734143f0a0939166c546347a |     service      |   True  |\n| 846576498dc24660943784e25e2b5b1a |       test       |   True  |\n+----------------------------------+------------------+---------+\n\n# keystone user-list --tenant-id 846576498dc24660943784e25e2b5b1a\n+----------------------------------+--------+---------+-----------------+\n|                id                |  name  | enabled |      email      |\n+----------------------------------+--------+---------+-----------------+\n| 6a120d1a6034481fa7e905d422dceb76 |  test  |   True  |  <email address hidden>  |\n+----------------------------------+--------+---------+-----------------+\n\nSet quota for project:\n# nova-manage project quota --project 846576498dc24660943784e25e2b5b1a --key instances --value 3\nQuota                                Limit      In Use     Reserved  \nmetadata_items                       128        0          0         \ninjected_file_content_bytes          10240      0          0         \nram                                  51200      0          0         \nfloating_ips                         10         0          0         \nsecurity_group_rules                 20         0          0         \ninstances                            3          0          0         \nkey_pairs                            100        0          0         \ninjected_files                       5          0          0         \ncores                                20         0          0         \nfixed_ips                            unlimited  0          0         \ninjected_file_path_bytes             255        0          0         \nsecurity_groups                      10         0          0 \n\nSet quota for user under the project:\n# nova-manage project quota --project 846576498dc24660943784e25e2b5b1a --user 6a120d1a6034481fa7e905d422dceb76 --key instances --value 4\nQuota                                Limit      In Use     Reserved  \nmetadata_items                       128        0          0         \ninjected_file_content_bytes          10240      0          0         \nram                                  51200      0          0         \nfloating_ips                         10         0          0         \nsecurity_group_rules                 20         0          0         \ninstances                            4          0          0         \nkey_pairs                            100        0          0         \ninjected_files                       5          0          0         \ncores                                20         0          0         \nfixed_ips                            unlimited  0          0         \ninjected_file_path_bytes             255        0          0         \nsecurity_groups                      10         0          0 \n\nSet quota for user under the project again:\n# nova-manage project quota --project 846576498dc24660943784e25e2b5b1a --user 6a120d1a6034481fa7e905d422dceb76 --key instances --value 4\nQuota limit must less than 3.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1208400", 
    "owner": "https://api.launchpad.net/1.0/~liyingjun", 
    "id": 1208400, 
    "index": 3921, 
    "created": "2013-08-05 09:42:43.860106+00:00", 
    "title": "User quota update should not exceed project quota", 
    "comments": [
        {
            "content": "Currently, user quota could be updated exceed the project quota, if the user quota was not set before.\n\nReproduce:\n# keystone tenant-list\n+----------------------------------+------------------+---------+\n|                id                |       name       | enabled |\n+----------------------------------+------------------+---------+\n| 21f7a02dbfd94979b83b3b551c78e380 |      admin       |   True  |\n| ebe1d1e9734143f0a0939166c546347a |     service      |   True  |\n| 846576498dc24660943784e25e2b5b1a |       test       |   True  |\n+----------------------------------+------------------+---------+\n\n# keystone user-list --tenant-id 846576498dc24660943784e25e2b5b1a\n+----------------------------------+--------+---------+-----------------+\n|                id                |  name  | enabled |      email      |\n+----------------------------------+--------+---------+-----------------+\n| 6a120d1a6034481fa7e905d422dceb76 |  test  |   True  |  <email address hidden>  |\n+----------------------------------+--------+---------+-----------------+\n\nSet quota for project:\n# nova-manage project quota --project 846576498dc24660943784e25e2b5b1a --key instances --value 3\nQuota                                Limit      In Use     Reserved  \nmetadata_items                       128        0          0         \ninjected_file_content_bytes          10240      0          0         \nram                                  51200      0          0         \nfloating_ips                         10         0          0         \nsecurity_group_rules                 20         0          0         \ninstances                            3          0          0         \nkey_pairs                            100        0          0         \ninjected_files                       5          0          0         \ncores                                20         0          0         \nfixed_ips                            unlimited  0          0         \ninjected_file_path_bytes             255        0          0         \nsecurity_groups                      10         0          0 \n\nSet quota for user under the project:\n# nova-manage project quota --project 846576498dc24660943784e25e2b5b1a --user 6a120d1a6034481fa7e905d422dceb76 --key instances --value 4\nQuota                                Limit      In Use     Reserved  \nmetadata_items                       128        0          0         \ninjected_file_content_bytes          10240      0          0         \nram                                  51200      0          0         \nfloating_ips                         10         0          0         \nsecurity_group_rules                 20         0          0         \ninstances                            4          0          0         \nkey_pairs                            100        0          0         \ninjected_files                       5          0          0         \ncores                                20         0          0         \nfixed_ips                            unlimited  0          0         \ninjected_file_path_bytes             255        0          0         \nsecurity_groups                      10         0          0 \n\nSet quota for user under the project again:\n# nova-manage project quota --project 846576498dc24660943784e25e2b5b1a --user 6a120d1a6034481fa7e905d422dceb76 --key instances --value 4\nQuota limit must less than 3.", 
            "date_created": "2013-08-05 09:42:43.860106+00:00", 
            "author": "https://api.launchpad.net/1.0/~liyingjun"
        }, 
        {
            "content": "It is caused by this fix: https://review.openstack.org/#/c/28232/", 
            "date_created": "2013-08-05 09:45:03.180146+00:00", 
            "author": "https://api.launchpad.net/1.0/~liyingjun"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/40189", 
            "date_created": "2013-08-05 09:59:50.475573+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/40779", 
            "date_created": "2013-08-08 01:29:34.618172+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/40189\nCommitted: http://github.com/openstack/nova/commit/b4905b40fd20fd01927ab13420a34a7135f3f565\nSubmitter: Jenkins\nBranch:    master\n\ncommit b4905b40fd20fd01927ab13420a34a7135f3f565\nAuthor: liyingjun <email address hidden>\nDate:   Mon Aug 5 17:57:15 2013 +0800\n\n    User quota update should not exceed project quota\n    \n    Move the default user quota setting code from db to quota.py,\n    because it is necessary to check if user quota is set in db\n    to get the settable quota for the user under a project.\n    \n    Fixes bug 1208400\n    \n    Change-Id: I83a4a7fcd8bf80b20e4e700bad7dd31294f8ed0b\n", 
            "date_created": "2013-08-12 19:43:34.713566+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/40779\nCommitted: http://github.com/openstack/oslo-incubator/commit/4d5ce859c61e24b287be33a2b821aded3577cddb\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4d5ce859c61e24b287be33a2b821aded3577cddb\nAuthor: liyingjun <email address hidden>\nDate:   Thu Aug 8 09:24:40 2013 +0800\n\n    User quota update should not exceed project quota\n    \n    When user quota is not set, the default quota set in\n    config file will be used as the default user quota,\n    this will break the logic of user quota (the default\n    user quota should be restricted by the project quota)\n    \n    Fixes bug 1208400\n    Fixes bug 1205582\n    \n    Change-Id: Id98d504d8f5e0dda642fa5e7c550acea79520c3d\n", 
            "date_created": "2013-08-26 02:58:46.242656+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}