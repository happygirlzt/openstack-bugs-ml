{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 10:56:14.563972+00:00", 
    "description": "Looks like \"nova diagnostics ID\" is not working when using libvirt as driver (with Xen as hypervisor) on nova-compute. I received the following error.\n\nIn the code is also an hint that it's maybe not working:\n\n---snip---\n        # memoryStats might launch an exception if the method\n        # is not supported by the underlying hypervisor being\n        # used by libvirt\n---snap---\n\nI think there should be place some exception handling...\n\n\n2012-11-08 20:21:06 AUDIT nova.compute.manager [req-57acccff-f970-47c0-9c8a-6befb4f3fc9e 5d795ef6a803425e902922bb8f817828 5536f9774f2f42f4a5d4bbc47a484ae8] [instance: f781c989-0b7e-4311-9133-7fdc933b60e5] Retrieving diagnostics\n2012-11-08 20:21:06 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 117, in wrapped\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 92, in wrapped\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 202, in decorated_function\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 196, in decorated_function\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 1786, in get_diagnostics\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     return self.driver.get_diagnostics(instance)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2985, in get_diagnostics\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     for key in mem.keys():\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp AttributeError: 'NoneType' object has no attribute 'keys'\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp\n2012-11-08 20:21:06 ERROR nova.openstack.common.rpc.common [-] Returning exception 'NoneType' object has no attribute 'keys' to caller", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1076527", 
    "owner": "https://api.launchpad.net/1.0/~berendt", 
    "id": 1076527, 
    "index": 3195, 
    "created": "2012-11-08 19:25:12.989417+00:00", 
    "title": "'diagnostics' not working for libvirt driver", 
    "comments": [
        {
            "content": "Looks like \"nova diagnostics ID\" is not working when using libvirt as driver (with Xen as hypervisor) on nova-compute. I received the following error.\n\nIn the code is also an hint that it's maybe not working:\n\n---snip---\n        # memoryStats might launch an exception if the method\n        # is not supported by the underlying hypervisor being\n        # used by libvirt\n---snap---\n\nI think there should be place some exception handling...\n\n\n2012-11-08 20:21:06 AUDIT nova.compute.manager [req-57acccff-f970-47c0-9c8a-6befb4f3fc9e 5d795ef6a803425e902922bb8f817828 5536f9774f2f42f4a5d4bbc47a484ae8] [instance: f781c989-0b7e-4311-9133-7fdc933b60e5] Retrieving diagnostics\n2012-11-08 20:21:06 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 117, in wrapped\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 92, in wrapped\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 202, in decorated_function\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 196, in decorated_function\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 1786, in get_diagnostics\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     return self.driver.get_diagnostics(instance)\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2985, in get_diagnostics\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp     for key in mem.keys():\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp AttributeError: 'NoneType' object has no attribute 'keys'\n2012-11-08 20:21:06 TRACE nova.openstack.common.rpc.amqp\n2012-11-08 20:21:06 ERROR nova.openstack.common.rpc.common [-] Returning exception 'NoneType' object has no attribute 'keys' to caller", 
            "date_created": "2012-11-08 19:25:12.989417+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "exception handling has to be more generic to also fetch the AttributeError. I'll commit a bugfix.", 
            "date_created": "2012-11-08 19:33:29.073910+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/15662", 
            "date_created": "2012-11-08 19:42:00.097332+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/15662\nCommitted: http://github.com/openstack/nova/commit/0406d1f85fa93db4e4d5ab8b37d298951d4c4193\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0406d1f85fa93db4e4d5ab8b37d298951d4c4193\nAuthor: Christian Berendt <email address hidden>\nDate:   Thu Nov 8 20:41:07 2012 +0100\n\n    make diagnostics workable for libvirt with Xen\n    \n    When using \"diagnostics\" with libvirt as driver on nova-compute\n    and Xen as hypervisor the call to domain.memoryStats() in\n    get_diagnostics() doesn't fail with a libvirt.libvirtError,\n    but with an AttributeError. This exception should be catched, too.\n    \n    The method virDomainMemoryStats is not implemented in libvirt\n    for Xen.\n    \n    fixes bug 1076527\n    \n    Change-Id: I16645654b346e3c40ff3dd63f20600c802cbeb3f\n", 
            "date_created": "2012-11-09 02:53:54.820204+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}