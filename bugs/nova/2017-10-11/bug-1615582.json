{
    "status": "Expired", 
    "last_updated": "2017-10-01 04:17:27.725553+00:00", 
    "description": "Description\n===========\nAfter upgrading fresh OpenStack Liberty installation to Mitaka on Trusty with Juju, I am no longer able to create Nova instances.\n\nSteps to reproduce\n==================\n* Install OpenStack Liberty with Juju from the attached \"bundle.yaml\" file.\n* Upgrade OpenStack Liberty to Mitaka by executing the following commands:\n\njuju upgrade-charm keystone\njuju upgrade-charm ceilometer\njuju upgrade-charm ceilometer-agent\njuju upgrade-charm ceph\njuju upgrade-charm ceph-osd\njuju upgrade-charm cinder\njuju upgrade-charm glance\njuju upgrade-charm nova-cloud-controller\njuju upgrade-charm nova-compute\njuju upgrade-charm neutron-api\njuju upgrade-charm neutron-gateway\njuju upgrade-charm openstack-dashboard\njuju set-config ceph source=\"cloud:trusty-mitaka\"\njuju set-config ceph-osd source=\"cloud:trusty-mitaka\"\njuju set-config keystone openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh keystone/0 sudo keystone-manage db_sync\njuju set-config ceilometer openstack-origin=\"cloud:trusty-mitaka\"\njuju set-config ceilometer-agent openstack-origin=\"cloud:trusty-mitaka\"\njuju set-config cinder openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh cinder/0 sudo cinder-manage db sync\njuju set-config glance openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh glance/0 sudo glance-manage db_sync\njuju set-config nova-cloud-controller openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh nova-cloud-controller/0 sudo nova-manage db sync\njuju set-config nova-compute openstack-origin=\"cloud:trusty-mitaka\"\njuju set-config neutron-api openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh neutron-api/0 sudo neutron-db-manage upgrade heads\njuju set-config neutron-gateway openstack-origin=\"cloud:trusty-mitaka\"\njuju set-config openstack-dashboard openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh ceph/0 sudo reboot\njuju ssh ceph/1 sudo reboot\njuju ssh ceph/2 sudo reboot\njuju ssh ceph-osd/0 sudo service ceph restart\njuju ssh ceph-osd/1 sudo service ceph restart\njuju ssh ceph-osd/2 sudo service ceph restart\njuju ssh keystone/0 sudo reboot\njuju ssh keystone/1 sudo reboot\njuju ssh keystone/2 sudo reboot\njuju ssh ceilometer/0 sudo reboot\njuju ssh ceilometer/1 sudo reboot\njuju ssh ceilometer/2 sudo reboot\njuju ssh ceilometer-agent/0 sudo service ceilometer-agent-compute restart\njuju ssh ceilometer-agent/1 sudo service ceilometer-agent-compute restart\njuju ssh ceilometer-agent/2 sudo service ceilometer-agent-compute restart\njuju ssh cinder/0 sudo reboot\njuju ssh cinder/1 sudo reboot\njuju ssh cinder/2 sudo reboot\njuju ssh glance/0 sudo reboot\njuju ssh glance/1 sudo reboot\njuju ssh glance/2 sudo reboot\njuju ssh nova-cloud-controller/0 sudo reboot\njuju ssh nova-cloud-controller/1 sudo reboot\njuju ssh nova-cloud-controller/2 sudo reboot\njuju ssh nova-compute/0 sudo service nova-compute restart\njuju ssh nova-compute/1 sudo service nova-compute restart\njuju ssh nova-compute/2 sudo service nova-compute restart\njuju ssh neutron-api/0 sudo reboot\njuju ssh neutron-api/1 sudo reboot\njuju ssh neutron-api/2 sudo reboot\njuju ssh neutron-gateway/0 sudo service neutron-dhcp-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-lbaas-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-metadata-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-metering-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-openvswitch-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-vpn-agent restart\njuju ssh nova-compute/0 sudo service neutron-openvswitch-agent restart\njuju ssh nova-compute/1 sudo service neutron-openvswitch-agent restart\njuju ssh nova-compute/2 sudo service neutron-openvswitch-agent restart\njuju ssh openstack-dashboard/0 sudo reboot\njuju ssh openstack-dashboard/1 sudo reboot\njuju ssh openstack-dashboard/2 sudo reboot\n\n* Attempt to create Nova instance.\n\nExpected result\n===============\nNova instance being created.\n\nActual result\n=============\n* Nova instance not being created.\n* The following error messages being displayed:\n** from GUI:\n\n\u00a0\u00a0\u00a0Error: Unable to create the server.\n\n** from CLI:\n\n\u00a0\u00a0\u00a0Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n\u00a0\u00a0\u00a0<type 'exceptions.AttributeError'> (HTTP 500) (Request-ID: req-c035d518-50c0-4cab-913e-9a5263392a2a)\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running.\n\nubuntu@tkurek-maas:~$ juju ssh nova-cloud-controller/0 sudo dpkg-query -l | grep nova\nii  nova-api-os-compute                           2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - OpenStack Compute API frontend\nii  nova-cert                                     2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - certificate management\nii  nova-common                                   2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - common files\nii  nova-conductor                                2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - conductor service\nii  nova-consoleauth                              2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - Console Authenticator\nii  nova-novncproxy                               2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - NoVNC proxy\nii  nova-scheduler                                2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - virtual machine scheduler\nii  python-nova                                   2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute Python libraries\nii  python-novaclient                             2:3.3.1-2~cloud0            all                         client library for OpenStack Compute API - Python 2.7\nConnection to 10.230.126.81 closed.\nubuntu@tkurek-maas:~$ juju ssh nova-compute/0 sudo dpkg-query -l | grep nova\nii  nova-common                                   2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - common files\nii  nova-compute                                  2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - compute node base\nii  nova-compute-kvm                              2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                          2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - compute node libvirt support\nii  python-nova                                   2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute Python libraries\nii  python-novaclient                             2:3.3.1-2~cloud0            all                         client library for OpenStack Compute API - Python 2.7\nConnection to 10.230.126.54 closed.\n\n2. Which hypervisor did you use?\n\nKVM\n\n\u00a0\u00a0\u00a0What's the version of that?\n\nubuntu@tkurek-maas:~$ juju ssh nova-compute/0 sudo dpkg-query -l | grep kvm\nii  nova-compute-kvm                              2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - compute node (KVM)\nConnection to 10.230.126.54 closed.\n\n3. Which storage type did you use?\n\nCeph\n\n\u00a0\u00a0\u00a0What's the version of that?\n\nubuntu@tkurek-maas:~$ juju ssh ceph/0 sudo dpkg-query -l | grep ceph\nii  ceph                                          10.2.2-0ubuntu0.16.04.2~clo amd64                       distributed storage and file system\nii  ceph-common                                   10.2.2-0ubuntu0.16.04.2~clo amd64                       common utilities to mount and interact with a ceph storage cluster\nii  libcephfs1                                    10.2.2-0ubuntu0.16.04.2~clo amd64                       Ceph distributed file system client library\nii  python-ceph                                   10.2.2-0ubuntu0.16.04.2~clo all                         Meta-package for python libraries for the Ceph libraries\nii  python-cephfs                                 10.2.2-0ubuntu0.16.04.2~clo amd64                       Python libraries for the Ceph libcephfs library\nConnection to 10.230.126.65 closed.\nubuntu@tkurek-maas:~$ juju ssh ceph-osd/0 sudo dpkg-query -l | grep ceph\nii  ceph                                          10.2.2-0ubuntu0.16.04.2~clo amd64                       distributed storage and file system\nii  ceph-common                                   10.2.2-0ubuntu0.16.04.2~clo amd64                       common utilities to mount and interact with a ceph storage cluster\nii  libcephfs1                                    10.2.2-0ubuntu0.16.04.2~clo amd64                       Ceph distributed file system client library\nii  python-ceph                                   10.2.2-0ubuntu0.16.04.2~clo all                         Meta-package for python libraries for the Ceph libraries\nii  python-cephfs                                 10.2.2-0ubuntu0.16.04.2~clo amd64                       Python libraries for the Ceph libcephfs library\nConnection to 10.230.126.54 closed.\n\n4. Which networking type did you use?\n\nNeutron with Openvswitch\n\n5. Additional information:\n\nubuntu@tkurek-maas:~$ juju ssh nova-cloud-controller/0 sudo dpkg -S /usr/lib/python2.7/dist-packages/dogpile/cache/region.py\npython-dogpile.cache: /usr/lib/python2.7/dist-packages/dogpile/cache/region.py\nConnection to 10.230.126.81 closed.\nubuntu@tkurek-maas:~$ juju ssh nova-cloud-controller/0 sudo dpkg-query -l python-dogpile.cache\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                          Version                     Architecture                Description\n+++-=============================================-===========================-===========================-===============================================================================================\nii  python-dogpile.cache                          0.5.7-1ubuntu1~cloud0       all                         caching front-end based on the Dogpile lock - Python 2.x\nConnection to 10.230.126.81 closed.\n\nLogs & Configs\n==============\nAttached \"/var/log/nova/nova-api-os-compute.log\" file errors:\n\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions [req-b2f38657-7eae-4714-a1e1-0217950e7e29 d12595ae6b2d418eaf9ffd209fa25479 64c87895e12b4f4fb0bfd979b1ac70a4 - - -] Unexpected exception in API method\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/extensions.py\", line 478, in wrapped\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/servers.py\", line 629, in create\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     **create_kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/hooks.py\", line 154, in inner\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1562, in create\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1175, in _create_instance\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     instance_group, check_server_group_quota, filter_properties)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1033, in _provision_instances\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     quotas.rollback()\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     self.force_reraise()\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 988, in _provision_instances\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     num_instances, i, shutdown_terminate)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1445, in create_db_entry_for_new_instance\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     instance.create()\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 223, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return fn(self, *args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 471, in create\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     self._load_ec2_ids()\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 818, in _load_ec2_ids\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     self.ec2_ids = objects.EC2Ids.get_by_instance(self._context, self)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 181, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     result = fn(cls, context, *args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/objects/ec2.py\", line 218, in get_by_instance\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     ec2_ids = cls._get_ec2_ids(context, instance)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/objects/ec2.py\", line 204, in _get_ec2_ids\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     instance.image_ref)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/ec2/ec2utils.py\", line 128, in glance_id_to_ec2_id\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     image_id = glance_id_to_id(context, glance_id)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/ec2/ec2utils.py\", line 48, in memoizer\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     value = _CACHE.get(key)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/cache_utils.py\", line 151, in get\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     value = self.region.get(key)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/dogpile/cache/region.py\", line 456, in get\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     expiration_time, ignore_expiration)(value)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/dogpile/cache/region.py\", line 475, in value_fn\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     current_time - value.metadata[\"ct\"] > expiration_time:\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions AttributeError: 'int' object has no attribute 'metadata'\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions", 
    "tags": [
        "memcache", 
        "openstack-version.mitaka", 
        "upgrades"
    ], 
    "importance": "High", 
    "heat": 28, 
    "link": "https://bugs.launchpad.net/nova/+bug/1615582", 
    "owner": "None", 
    "id": 1615582, 
    "index": 1977, 
    "created": "2016-08-22 10:35:15.581059+00:00", 
    "title": "Liberty -> Mitaka Upgrade: Error: Unable to create the server. Unexpected API Error.", 
    "comments": [
        {
            "content": "Description\n===========\nAfter upgrading fresh OpenStack Liberty installation to Mitaka on Trusty with Juju, I am no longer able to create Nova instances.\n\nSteps to reproduce\n==================\n* Install OpenStack Liberty with Juju from the attached \"bundle.yaml\" file.\n* Upgrade OpenStack Liberty to Mitaka by executing the following commands:\n\njuju upgrade-charm keystone\njuju upgrade-charm ceilometer\njuju upgrade-charm ceilometer-agent\njuju upgrade-charm ceph\njuju upgrade-charm ceph-osd\njuju upgrade-charm cinder\njuju upgrade-charm glance\njuju upgrade-charm nova-cloud-controller\njuju upgrade-charm nova-compute\njuju upgrade-charm neutron-api\njuju upgrade-charm neutron-gateway\njuju upgrade-charm openstack-dashboard\njuju set-config ceph source=\"cloud:trusty-mitaka\"\njuju set-config ceph-osd source=\"cloud:trusty-mitaka\"\njuju set-config keystone openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh keystone/0 sudo keystone-manage db_sync\njuju set-config ceilometer openstack-origin=\"cloud:trusty-mitaka\"\njuju set-config ceilometer-agent openstack-origin=\"cloud:trusty-mitaka\"\njuju set-config cinder openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh cinder/0 sudo cinder-manage db sync\njuju set-config glance openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh glance/0 sudo glance-manage db_sync\njuju set-config nova-cloud-controller openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh nova-cloud-controller/0 sudo nova-manage db sync\njuju set-config nova-compute openstack-origin=\"cloud:trusty-mitaka\"\njuju set-config neutron-api openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh neutron-api/0 sudo neutron-db-manage upgrade heads\njuju set-config neutron-gateway openstack-origin=\"cloud:trusty-mitaka\"\njuju set-config openstack-dashboard openstack-origin=\"cloud:trusty-mitaka\"\njuju ssh ceph/0 sudo reboot\njuju ssh ceph/1 sudo reboot\njuju ssh ceph/2 sudo reboot\njuju ssh ceph-osd/0 sudo service ceph restart\njuju ssh ceph-osd/1 sudo service ceph restart\njuju ssh ceph-osd/2 sudo service ceph restart\njuju ssh keystone/0 sudo reboot\njuju ssh keystone/1 sudo reboot\njuju ssh keystone/2 sudo reboot\njuju ssh ceilometer/0 sudo reboot\njuju ssh ceilometer/1 sudo reboot\njuju ssh ceilometer/2 sudo reboot\njuju ssh ceilometer-agent/0 sudo service ceilometer-agent-compute restart\njuju ssh ceilometer-agent/1 sudo service ceilometer-agent-compute restart\njuju ssh ceilometer-agent/2 sudo service ceilometer-agent-compute restart\njuju ssh cinder/0 sudo reboot\njuju ssh cinder/1 sudo reboot\njuju ssh cinder/2 sudo reboot\njuju ssh glance/0 sudo reboot\njuju ssh glance/1 sudo reboot\njuju ssh glance/2 sudo reboot\njuju ssh nova-cloud-controller/0 sudo reboot\njuju ssh nova-cloud-controller/1 sudo reboot\njuju ssh nova-cloud-controller/2 sudo reboot\njuju ssh nova-compute/0 sudo service nova-compute restart\njuju ssh nova-compute/1 sudo service nova-compute restart\njuju ssh nova-compute/2 sudo service nova-compute restart\njuju ssh neutron-api/0 sudo reboot\njuju ssh neutron-api/1 sudo reboot\njuju ssh neutron-api/2 sudo reboot\njuju ssh neutron-gateway/0 sudo service neutron-dhcp-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-lbaas-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-metadata-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-metering-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-openvswitch-agent restart\njuju ssh neutron-gateway/0 sudo service neutron-vpn-agent restart\njuju ssh nova-compute/0 sudo service neutron-openvswitch-agent restart\njuju ssh nova-compute/1 sudo service neutron-openvswitch-agent restart\njuju ssh nova-compute/2 sudo service neutron-openvswitch-agent restart\njuju ssh openstack-dashboard/0 sudo reboot\njuju ssh openstack-dashboard/1 sudo reboot\njuju ssh openstack-dashboard/2 sudo reboot\n\n* Attempt to create Nova instance.\n\nExpected result\n===============\nNova instance being created.\n\nActual result\n=============\n* Nova instance not being created.\n* The following error messages being displayed:\n** from GUI:\n\n   Error: Unable to create the server.\n\n** from CLI:\n\n   Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n   <type 'exceptions.AttributeError'> (HTTP 500) (Request-ID: req-c035d518-50c0-4cab-913e-9a5263392a2a)\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running.\n\nubuntu@tkurek-maas:~$ juju ssh nova-cloud-controller/0 sudo dpkg-query -l | grep nova\nii  nova-api-os-compute                           2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - OpenStack Compute API frontend\nii  nova-cert                                     2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - certificate management\nii  nova-common                                   2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - common files\nii  nova-conductor                                2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - conductor service\nii  nova-consoleauth                              2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - Console Authenticator\nii  nova-novncproxy                               2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - NoVNC proxy\nii  nova-scheduler                                2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - virtual machine scheduler\nii  python-nova                                   2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute Python libraries\nii  python-novaclient                             2:3.3.1-2~cloud0            all                         client library for OpenStack Compute API - Python 2.7\nConnection to 10.230.126.81 closed.\nubuntu@tkurek-maas:~$ juju ssh nova-compute/0 sudo dpkg-query -l | grep nova\nii  nova-common                                   2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - common files\nii  nova-compute                                  2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - compute node base\nii  nova-compute-kvm                              2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                          2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - compute node libvirt support\nii  python-nova                                   2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute Python libraries\nii  python-novaclient                             2:3.3.1-2~cloud0            all                         client library for OpenStack Compute API - Python 2.7\nConnection to 10.230.126.54 closed.\n\n\n2. Which hypervisor did you use?\n\nKVM\n\n   What's the version of that?\n\nubuntu@tkurek-maas:~$ juju ssh nova-compute/0 sudo dpkg-query -l | grep kvm\nii  nova-compute-kvm                              2:13.1.0-0ubuntu1~cloud0    all                         OpenStack Compute - compute node (KVM)\nConnection to 10.230.126.54 closed.\n\n3. Which storage type did you use?\n\nCeph\n\n   What's the version of that?\n\nubuntu@tkurek-maas:~$ juju ssh ceph/0 sudo dpkg-query -l | grep ceph\nii  ceph                                          10.2.2-0ubuntu0.16.04.2~clo amd64                       distributed storage and file system\nii  ceph-common                                   10.2.2-0ubuntu0.16.04.2~clo amd64                       common utilities to mount and interact with a ceph storage cluster\nii  libcephfs1                                    10.2.2-0ubuntu0.16.04.2~clo amd64                       Ceph distributed file system client library\nii  python-ceph                                   10.2.2-0ubuntu0.16.04.2~clo all                         Meta-package for python libraries for the Ceph libraries\nii  python-cephfs                                 10.2.2-0ubuntu0.16.04.2~clo amd64                       Python libraries for the Ceph libcephfs library\nConnection to 10.230.126.65 closed.\nubuntu@tkurek-maas:~$ juju ssh ceph-osd/0 sudo dpkg-query -l | grep ceph\nii  ceph                                          10.2.2-0ubuntu0.16.04.2~clo amd64                       distributed storage and file system\nii  ceph-common                                   10.2.2-0ubuntu0.16.04.2~clo amd64                       common utilities to mount and interact with a ceph storage cluster\nii  libcephfs1                                    10.2.2-0ubuntu0.16.04.2~clo amd64                       Ceph distributed file system client library\nii  python-ceph                                   10.2.2-0ubuntu0.16.04.2~clo all                         Meta-package for python libraries for the Ceph libraries\nii  python-cephfs                                 10.2.2-0ubuntu0.16.04.2~clo amd64                       Python libraries for the Ceph libcephfs library\nConnection to 10.230.126.54 closed.\n\n\n4. Which networking type did you use?\n\nNeutron with Openvswitch\n\nLogs & Configs\n==============\nAttached \"/var/log/nova/nova-api-os-compute.log\" file errors:\n\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions [req-b2f38657-7eae-4714-a1e1-0217950e7e29 d12595ae6b2d418eaf9ffd209fa25479 64c87895e12b4f4fb0bfd979b1ac70a4 - - -] Unexpected exception in API method\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/extensions.py\", line 478, in wrapped\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/servers.py\", line 629, in create\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     **create_kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/hooks.py\", line 154, in inner\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1562, in create\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1175, in _create_instance\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     instance_group, check_server_group_quota, filter_properties)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1033, in _provision_instances\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     quotas.rollback()\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     self.force_reraise()\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 988, in _provision_instances\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     num_instances, i, shutdown_terminate)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1445, in create_db_entry_for_new_instance\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     instance.create()\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 223, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     return fn(self, *args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 471, in create\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     self._load_ec2_ids()\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 818, in _load_ec2_ids\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     self.ec2_ids = objects.EC2Ids.get_by_instance(self._context, self)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 181, in wrapper\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     result = fn(cls, context, *args, **kwargs)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/objects/ec2.py\", line 218, in get_by_instance\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     ec2_ids = cls._get_ec2_ids(context, instance)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/objects/ec2.py\", line 204, in _get_ec2_ids\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     instance.image_ref)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/ec2/ec2utils.py\", line 128, in glance_id_to_ec2_id\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     image_id = glance_id_to_id(context, glance_id)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/api/ec2/ec2utils.py\", line 48, in memoizer\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     value = _CACHE.get(key)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/nova/cache_utils.py\", line 151, in get\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     value = self.region.get(key)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/dogpile/cache/region.py\", line 456, in get\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     expiration_time, ignore_expiration)(value)\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/dist-packages/dogpile/cache/region.py\", line 475, in value_fn\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions     current_time - value.metadata[\"ct\"] > expiration_time:\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions AttributeError: 'int' object has no attribute 'metadata'\n2016-08-20 11:03:48.780 558458 ERROR nova.api.openstack.extensions", 
            "date_created": "2016-08-22 10:35:15.581059+00:00", 
            "author": "https://api.launchpad.net/1.0/~tkurek"
        }, 
        {
            "content": "", 
            "date_created": "2016-08-22 10:35:15.581059+00:00", 
            "author": "https://api.launchpad.net/1.0/~tkurek"
        }, 
        {
            "content": "You are going to need to unwind the juju bundle into something the dev team understands, or poke the juju folks.", 
            "date_created": "2016-08-26 15:20:08.696221+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "The cloud has already gone, but the issue is reproducible. How can I poke juju folks?", 
            "date_created": "2016-08-29 04:41:36.891951+00:00", 
            "author": "https://api.launchpad.net/1.0/~tkurek"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2016-10-29 04:17:17.823814+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "Reopening this bug, going through an upgrade from liberty -> mitaka and getting this bug", 
            "date_created": "2016-11-14 03:04:35.800896+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Happy to provide more details, we are using stable/mitaka version of conductor with the rest still at liberty\n\ndogpile.cache==0.6.2\n", 
            "date_created": "2016-11-14 03:06:13.995862+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Hello,\nI am hitting this bug as well.\n\nWe dont use Juju, but we also run the same ubuntu packages for trusty", 
            "date_created": "2016-11-24 15:17:08.477779+00:00", 
            "author": "https://api.launchpad.net/1.0/~zioproto"
        }, 
        {
            "content": "Hello Sam,\n\nI managed to fix the bug.\n\nIt happens when you have liberty stuff in nova.conf that you dont need anymore.\n\nFirst test I did was to copy the nova.conf.dpkg-dist to nova.conf and then run puppet. This fixed the problem immediately.\n\nThen I tracked down what was the line giving the problem.\n\nMake sure you remove from nova.conf the memcached_servers options form the [DEFAULT] section, having it only in the [keystone_authtoken] fixed this problem for me.\n", 
            "date_created": "2016-11-24 16:14:22.120502+00:00", 
            "author": "https://api.launchpad.net/1.0/~zioproto"
        }, 
        {
            "content": "Apparently this is a misconfiguration issue with memcached_servers. Can people post their nova.conf to understand what went wrong here? If we need to add a warning on that option it would be good to know.", 
            "date_created": "2016-12-09 13:46:23.093445+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Automatically discovered version mitaka in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 15:54:26.177023+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Did this give a deprecation warning on Liberty? Or did we just miss that one entirely?", 
            "date_created": "2017-08-01 09:39:01.959185+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "I'm marking this incomplete, it would be good to get the answer, however these branches are so outside support there really isn't an upstream fix. ", 
            "date_created": "2017-08-01 09:40:17.200152+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2017-10-01 04:17:25.008816+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}