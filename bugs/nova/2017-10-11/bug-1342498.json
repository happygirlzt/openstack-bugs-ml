{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:44:22.950453+00:00", 
    "description": "With the recent merging of https://review.openstack.org/73428, test_live_migration_(changes_listen_addresses|raises_exception) requires fakelibvirt to have the migrateToURI2() method (if libvirt, at least v0.9.2, is not installed) so that it can be mocked out by those tests, otherwise the following mox errors occur during unit testing.\n\nUnknownMethodCallError: Method called is not a member of the object: migrateToURI2\n\npatch attached (which i may submit properly in the next 24 hours if someone doesn't beat me to it),  with signature taken from upstream libvirt and mocking stolen from fakelibvirt's migrateToURI().\n\nfull error log:\n\n$ ./run_tests.sh nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_*\nRunning `tools/with_venv.sh python -m nova.openstack.common.lockutils python setup.py testr --testr-args='--subunit --concurrency 0  nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_*'`\nnova.tests.virt.libvirt.test_driver.LibvirtConnTestCase\n    test_live_migration_changes_listen_addresses                      FAIL\n    test_live_migration_uses_migrateToURI_without_dest_listen_addrs   OK  0.27\n    test_live_migration_raises_exception                              FAIL\n    test_live_migration_fails_without_migratable_flag_or_0_addr       OK  3.32\n    test_live_migration_uses_migrateToURI_without_migratable_flag     OK  0.43\n\nSlowest 5 tests took 8.80 secs:\nnova.tests.virt.libvirt.test_driver.LibvirtConnTestCase\n    test_live_migration_changes_listen_addresses                          2.10\n    test_live_migration_fails_without_migratable_flag_or_0_addr           3.32\n    test_live_migration_raises_exception                                  2.68\n    test_live_migration_uses_migrateToURI_without_dest_listen_addrs       0.27\n    test_live_migration_uses_migrateToURI_without_migratable_flag         0.43\n\n======================================================================\nFAIL: nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_changes_listen_addresses\n----------------------------------------------------------------------\nTraceback (most recent call last):\n_StringException: Empty attachments:\n  stderr\n  stdout\n\npythonlogging:'': {{{\nINFO [migrate.versioning.api] 215 -> 216... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 216 -> 217... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 217 -> 218... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 218 -> 219... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 219 -> 220... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 220 -> 221... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 221 -> 222... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 222 -> 223... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 223 -> 224... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 224 -> 225... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 225 -> 226... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 226 -> 227... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 227 -> 228... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 228 -> 229... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 229 -> 230... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 230 -> 231... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 231 -> 232... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 232 -> 233... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 233 -> 234... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 234 -> 235... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 235 -> 236... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 236 -> 237... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 237 -> 238... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 238 -> 239... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 239 -> 240... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 240 -> 241... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 241 -> 242... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 242 -> 243... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 243 -> 244... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 244 -> 245... \nINFO [migrate.versioning.api] done\nINFO [nova.network.driver] Loading network driver 'nova.network.linux_net'\nINFO [nova.virt.driver] Loading compute driver 'nova.virt.fake.FakeDriver'\n}}}\n\nTraceback (most recent call last):\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mock.py\", line 1201, in patched\n    return func(*args, **keywargs)\n  File \"/home/dev/Desktop/nova/nova/tests/virt/libvirt/test_driver.py\", line 4418, in test_live_migration_changes_listen_addresses\n    self.mox.StubOutWithMock(vdmock, \"migrateToURI2\")\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mox.py\", line 308, in StubOutWithMock\n    attr_to_replace = getattr(obj, attr_name)\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mox.py\", line 608, in __getattr__\n    raise UnknownMethodCallError(name)\nUnknownMethodCallError: Method called is not a member of the object: migrateToURI2\n\n\n======================================================================\nFAIL: nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_raises_exception\n----------------------------------------------------------------------\nTraceback (most recent call last):\n_StringException: Empty attachments:\n  stderr\n  stdout\n\npythonlogging:'': {{{\nINFO [migrate.versioning.api] 215 -> 216... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 216 -> 217... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 217 -> 218... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 218 -> 219... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 219 -> 220... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 220 -> 221... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 221 -> 222... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 222 -> 223... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 223 -> 224... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 224 -> 225... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 225 -> 226... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 226 -> 227... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 227 -> 228... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 228 -> 229... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 229 -> 230... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 230 -> 231... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 231 -> 232... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 232 -> 233... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 233 -> 234... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 234 -> 235... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 235 -> 236... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 236 -> 237... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 237 -> 238... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 238 -> 239... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 239 -> 240... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 240 -> 241... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 241 -> 242... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 242 -> 243... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 243 -> 244... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 244 -> 245... \nINFO [migrate.versioning.api] done\nINFO [nova.network.driver] Loading network driver 'nova.network.linux_net'\nINFO [nova.virt.driver] Loading compute driver 'nova.virt.fake.FakeDriver'\n}}}\n\nTraceback (most recent call last):\n  File \"/home/dev/Desktop/nova/nova/tests/virt/libvirt/test_driver.py\", line 4584, in test_live_migration_raises_exception\n    self.mox.StubOutWithMock(vdmock, \"migrateToURI2\")\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mox.py\", line 308, in StubOutWithMock\n    attr_to_replace = getattr(obj, attr_name)\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mox.py\", line 608, in __getattr__\n    raise UnknownMethodCallError(name)\nUnknownMethodCallError: Method called is not a member of the object: migrateToURI2\n\n\nRan 7 tests in 18.406s\n\nFAILED (failures=2)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1342498", 
    "owner": "https://api.launchpad.net/1.0/~berrange", 
    "id": 1342498, 
    "index": 5004, 
    "created": "2014-07-16 03:10:02.789444+00:00", 
    "title": "test_live_migration_* tests fail with fakelibvirt", 
    "comments": [
        {
            "content": "With the recent merging of https://review.openstack.org/73428, test_live_migration_(changes_listen_addresses|raises_exception) requires fakelibvirt to have the migrateToURI2() method (if libvirt, at least v0.9.2, is not installed) so that it can be mocked out by those tests, otherwise the following mox errors occur during unit testing.\n\nUnknownMethodCallError: Method called is not a member of the object: migrateToURI2\n\npatch attached (which i may submit properly in the next 24 hours if someone doesn't beat me to it),  with signature taken from upstream libvirt and mocking stolen from fakelibvirt's migrateToURI().\n\nfull error log:\n\n$ ./run_tests.sh nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_*\nRunning `tools/with_venv.sh python -m nova.openstack.common.lockutils python setup.py testr --testr-args='--subunit --concurrency 0  nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_*'`\nnova.tests.virt.libvirt.test_driver.LibvirtConnTestCase\n    test_live_migration_changes_listen_addresses                      FAIL\n    test_live_migration_uses_migrateToURI_without_dest_listen_addrs   OK  0.27\n    test_live_migration_raises_exception                              FAIL\n    test_live_migration_fails_without_migratable_flag_or_0_addr       OK  3.32\n    test_live_migration_uses_migrateToURI_without_migratable_flag     OK  0.43\n\nSlowest 5 tests took 8.80 secs:\nnova.tests.virt.libvirt.test_driver.LibvirtConnTestCase\n    test_live_migration_changes_listen_addresses                          2.10\n    test_live_migration_fails_without_migratable_flag_or_0_addr           3.32\n    test_live_migration_raises_exception                                  2.68\n    test_live_migration_uses_migrateToURI_without_dest_listen_addrs       0.27\n    test_live_migration_uses_migrateToURI_without_migratable_flag         0.43\n\n======================================================================\nFAIL: nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_changes_listen_addresses\n----------------------------------------------------------------------\nTraceback (most recent call last):\n_StringException: Empty attachments:\n  stderr\n  stdout\n\npythonlogging:'': {{{\nINFO [migrate.versioning.api] 215 -> 216... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 216 -> 217... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 217 -> 218... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 218 -> 219... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 219 -> 220... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 220 -> 221... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 221 -> 222... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 222 -> 223... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 223 -> 224... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 224 -> 225... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 225 -> 226... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 226 -> 227... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 227 -> 228... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 228 -> 229... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 229 -> 230... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 230 -> 231... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 231 -> 232... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 232 -> 233... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 233 -> 234... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 234 -> 235... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 235 -> 236... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 236 -> 237... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 237 -> 238... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 238 -> 239... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 239 -> 240... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 240 -> 241... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 241 -> 242... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 242 -> 243... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 243 -> 244... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 244 -> 245... \nINFO [migrate.versioning.api] done\nINFO [nova.network.driver] Loading network driver 'nova.network.linux_net'\nINFO [nova.virt.driver] Loading compute driver 'nova.virt.fake.FakeDriver'\n}}}\n\nTraceback (most recent call last):\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mock.py\", line 1201, in patched\n    return func(*args, **keywargs)\n  File \"/home/dev/Desktop/nova/nova/tests/virt/libvirt/test_driver.py\", line 4418, in test_live_migration_changes_listen_addresses\n    self.mox.StubOutWithMock(vdmock, \"migrateToURI2\")\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mox.py\", line 308, in StubOutWithMock\n    attr_to_replace = getattr(obj, attr_name)\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mox.py\", line 608, in __getattr__\n    raise UnknownMethodCallError(name)\nUnknownMethodCallError: Method called is not a member of the object: migrateToURI2\n\n\n======================================================================\nFAIL: nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_raises_exception\n----------------------------------------------------------------------\nTraceback (most recent call last):\n_StringException: Empty attachments:\n  stderr\n  stdout\n\npythonlogging:'': {{{\nINFO [migrate.versioning.api] 215 -> 216... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 216 -> 217... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 217 -> 218... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 218 -> 219... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 219 -> 220... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 220 -> 221... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 221 -> 222... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 222 -> 223... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 223 -> 224... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 224 -> 225... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 225 -> 226... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 226 -> 227... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 227 -> 228... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 228 -> 229... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 229 -> 230... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 230 -> 231... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 231 -> 232... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 232 -> 233... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 233 -> 234... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 234 -> 235... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 235 -> 236... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 236 -> 237... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 237 -> 238... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 238 -> 239... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 239 -> 240... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 240 -> 241... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 241 -> 242... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 242 -> 243... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 243 -> 244... \nINFO [migrate.versioning.api] done\nINFO [migrate.versioning.api] 244 -> 245... \nINFO [migrate.versioning.api] done\nINFO [nova.network.driver] Loading network driver 'nova.network.linux_net'\nINFO [nova.virt.driver] Loading compute driver 'nova.virt.fake.FakeDriver'\n}}}\n\nTraceback (most recent call last):\n  File \"/home/dev/Desktop/nova/nova/tests/virt/libvirt/test_driver.py\", line 4584, in test_live_migration_raises_exception\n    self.mox.StubOutWithMock(vdmock, \"migrateToURI2\")\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mox.py\", line 308, in StubOutWithMock\n    attr_to_replace = getattr(obj, attr_name)\n  File \"/home/dev/Desktop/nova/.venv/local/lib/python2.7/site-packages/mox.py\", line 608, in __getattr__\n    raise UnknownMethodCallError(name)\nUnknownMethodCallError: Method called is not a member of the object: migrateToURI2\n\n\nRan 7 tests in 18.406s\n\nFAILED (failures=2)", 
            "date_created": "2014-07-16 03:10:02.789444+00:00", 
            "author": "https://api.launchpad.net/1.0/~coreywright"
        }, 
        {
            "content": "", 
            "date_created": "2014-07-16 03:10:02.789444+00:00", 
            "author": "https://api.launchpad.net/1.0/~coreywright"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/107329", 
            "date_created": "2014-07-16 11:51:40.030962+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/107329\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=0c96d46e08af1419764fcbb9c2e3d8b0eed1005a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0c96d46e08af1419764fcbb9c2e3d8b0eed1005a\nAuthor: Daniel P. Berrange <email address hidden>\nDate:   Wed Jul 16 12:48:14 2014 +0100\n\n    libvirt: add migrateToURI2 method to fakelibvirt\n    \n    With the merge of\n    \n      commit ea7da5152cdca7ba674e2137c3899909995e2287\n      Author: Solly Ross <email address hidden>\n      Date:   Tue Feb 4 14:27:51 2014 -0500\n    \n        Change listen address on libvirt live-migration\n    \n    the libvirt driver uses migrateToURI2 instead of\n    migrateToURI. The fakelibvirt class did not define\n    this method so it was unable to be mocked out.\n    \n    Change-Id: I74c28119c979e511cece6b839e25a40197b0e5d9\n    Closes-bug: 1342498\n    Signed-off-by: Daniel P. Berrange <email address hidden>\n", 
            "date_created": "2014-07-16 16:47:06.949874+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "the committed fix works for me", 
            "date_created": "2014-07-17 18:58:26.259671+00:00", 
            "author": "https://api.launchpad.net/1.0/~coreywright"
        }
    ]
}