{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:42:54.578540+00:00", 
    "description": "A recent change to the xen layer seems to have broken file injection, now this exception is thrown:\n\nglobal name 'base64' is not defined\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 204, in decorated_function\n    return function(self, context, instance_uuid, *args, **kwargs)\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 758, in run_instance\n    do_run_instance()\n  File \"/usr/lib/python2.6/dist-packages/nova/utils.py\", line 680, in inner\n    retval = f(*args, **kwargs)\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 757, in do_run_instance\n    self._run_instance(context, instance_uuid, **kwargs)\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 532, in _run_instance\n    self._set_instance_error_state(context, instance_uuid)\n  File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 520, in _run_instance\n    self._deallocate_network(context, instance)\n  File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 517, in _run_instance\n    injected_files, admin_password)\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 690, in _spawn\n    self._legacy_nw_info(network_info), block_device_info)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/driver.py\", line 180, in spawn\n    block_device_info)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 405, in spawn\n    undo_mgr.rollback_and_reraise(msg=msg, instance=instance)\n  File \"/usr/lib/python2.6/dist-packages/nova/utils.py\", line 1266, in rollback_and_reraise\n    self._rollback()\n  File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 400, in spawn\n    boot_instance_step(undo_mgr, vm_ref)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 182, in inner\n    rv = f(*args, **kwargs)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 375, in boot_instance_step\n    self._boot_new_instance(instance, vm_ref, image_meta)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 588, in _boot_new_instance\n    path, contents)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/agent.py\", line 178, in inject_file\n    b64_path = base64.b64encode(path)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1023698", 
    "owner": "https://api.launchpad.net/1.0/~westmaas", 
    "id": 1023698, 
    "index": 2936, 
    "created": "2012-07-12 03:28:28.662215+00:00", 
    "title": "File injection on xen doesn't work due to import error", 
    "comments": [
        {
            "content": "A recent change to the xen layer seems to have broken file injection, now this exception is thrown:\n\nglobal name 'base64' is not defined\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 204, in decorated_function\n    return function(self, context, instance_uuid, *args, **kwargs)\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 758, in run_instance\n    do_run_instance()\n  File \"/usr/lib/python2.6/dist-packages/nova/utils.py\", line 680, in inner\n    retval = f(*args, **kwargs)\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 757, in do_run_instance\n    self._run_instance(context, instance_uuid, **kwargs)\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 532, in _run_instance\n    self._set_instance_error_state(context, instance_uuid)\n  File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 520, in _run_instance\n    self._deallocate_network(context, instance)\n  File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 517, in _run_instance\n    injected_files, admin_password)\n  File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 690, in _spawn\n    self._legacy_nw_info(network_info), block_device_info)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/driver.py\", line 180, in spawn\n    block_device_info)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 405, in spawn\n    undo_mgr.rollback_and_reraise(msg=msg, instance=instance)\n  File \"/usr/lib/python2.6/dist-packages/nova/utils.py\", line 1266, in rollback_and_reraise\n    self._rollback()\n  File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 400, in spawn\n    boot_instance_step(undo_mgr, vm_ref)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 182, in inner\n    rv = f(*args, **kwargs)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 375, in boot_instance_step\n    self._boot_new_instance(instance, vm_ref, image_meta)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/vmops.py\", line 588, in _boot_new_instance\n    path, contents)\n  File \"/usr/lib/python2.6/dist-packages/nova/virt/xenapi/agent.py\", line 178, in inject_file\n    b64_path = base64.b64encode(path)", 
            "date_created": "2012-07-12 03:28:28.662215+00:00", 
            "author": "https://api.launchpad.net/1.0/~westmaas"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/9698", 
            "date_created": "2012-07-12 03:39:29.903717+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/9698\nCommitted: http://github.com/openstack/nova/commit/972f566aae61c12651ed8e84e69b19b40d97ad7a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 972f566aae61c12651ed8e84e69b19b40d97ad7a\nAuthor: Gabe Westmaas <email address hidden>\nDate:   Wed Jul 11 23:32:30 2012 -0400\n\n    Imports base64 to fix xen file injection\n    \n    Adds base64 to agent.py as its required for file injection to work.\n    \n    Fixes bug 1023698\n    \n    Change-Id: I231b6f5e031106471aeff38769e8fc79dcd45b45\n", 
            "date_created": "2012-07-12 14:39:48.208662+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}