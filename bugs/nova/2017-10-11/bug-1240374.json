{
    "status": "Fix Released", 
    "last_updated": "2014-07-09 23:50:30.190205+00:00", 
    "description": "1. create a availability-zone: second_zone, add ns17 to the aggregate\n[root@ns11 nova]# nova availability-zone-list\n+----------------------------------+----------------------------------------+\n| Name                             | Status                                 |\n+----------------------------------+----------------------------------------+\n\n| first_zone                       | available                              |\n| |- ns11.sce.cn.ibm.com           |                                        |\n| | |- nova-compute                | enabled :-) 2013-09-25T09:51:54.352341 |\n\n| second_zone                      | available                              |\n| |- ns17-osee.cn.ibm.com          |                                        |\n| | |- nova-compute                | enabled :-) 2013-09-25T09:51:58.283034 |\n+----------------------------------+----------------------------------------+\n\n2. nova boot with the zone:\n[root@ns11 \u02dc]# nova boot --image d7c64f67-3de7-4aa0-88fb-1292ff520404 --flavor 1 --availability-zone second_zone:ns17-osee.cn.ibm.com test_zone17_2\n\n3.  [root@ns11 nova]# nova list\n+--------------------------------------+-----------------+---------+-------------+-------------+------------------------+\n| ID                                   | Name            | Status  | Task State  | Power State | Networks               |\n+--------------------------------------+-----------------+---------+-------------+-------------+------------------------+\n\n| 6f3ec942-6c8e-46fa-ad7e-d2c900921f65 | test_zone17     | ACTIVE  | None        | Running     | flat_net01=172.10.0.16 |\n| 7273973d-a9e1-4917-ad59-c54ece9b0765 | test_zone17_1   | ACTIVE  | None        | Running     | flat_net01=172.10.0.18 |\n| 27f71b26-b775-4516-ba2a-13d9e91e96dd | test_zone17_2   | ACTIVE  | None        | Running     | flat_net01=172.10.0.19 |\n| 6350a439-2dd3-4b14-b99e-219fad27111b | zhikun_testvm   | ACTIVE  | None        | Running     | flat_net01=172.10.0.13 |\n+--------------------------------------+-----------------+---------+-------------+-------------+------------------------+\n\n4.  but the zone of the vm is: nova\n[root@ns11 nova]# nova show 27f71b26-b775-4516-ba2a-13d9e91e96dd\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| status                               | ACTIVE                                                   |\n| flat_net01 network                   | 172.10.0.19                                              |\n| updated                              | 2013-09-25T09:50:23Z                                     |\n| OS-EXT-STS:task_state                | None                                                     |\n| OS-EXT-SRV-ATTR:host                 | ns17-osee.cn.ibm.com                                     |\n| key_name                             | None                                                     |\n| image                                | cirros_kvm (d7c64f67-3de7-4aa0-88fb-1292ff520404)        |\n\n| accessIPv6                           |                                                          |\n| progress                             | 0                                                        |\n| OS-EXT-STS:power_state               | 1                                                        |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| config_drive                         |                                                          |\n+--------------------------------------+----------------------------------------------------------+\n\n[root@ns11 nova]# date\nWed Sep 25 18:05:26 CST 2013\n\n5.  I did not configure default_zone in nova.conf\n\n6.  It is very strange that this problem could not always been recreated. usually it happens when we create a new AZ, and then use the AZ boot instance. Seems wait for some time, may be one night or sooner, the AZ will become to correct one. I'm confused.\n\n# Expected  results\nThe AZ should take effect any time if we did not set default AZ in nova.conf", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1240374", 
    "owner": "https://api.launchpad.net/1.0/~chenxiao", 
    "id": 1240374, 
    "index": 4191, 
    "created": "2013-10-16 06:58:56.303875+00:00", 
    "title": "some times availability-zone not take effect after it created", 
    "comments": [
        {
            "content": "1. create a availability-zone: second_zone, add ns17 to the aggregate\n[root@ns11 nova]# nova availability-zone-list\n+----------------------------------+----------------------------------------+\n| Name                             | Status                                 |\n+----------------------------------+----------------------------------------+\n\n| first_zone                       | available                              |\n| |- ns11.sce.cn.ibm.com           |                                        |\n| | |- nova-compute                | enabled :-) 2013-09-25T09:51:54.352341 |\n\n| second_zone                      | available                              |\n| |- ns17-osee.cn.ibm.com          |                                        |\n| | |- nova-compute                | enabled :-) 2013-09-25T09:51:58.283034 |\n+----------------------------------+----------------------------------------+\n\n2. nova boot with the zone:\n[root@ns11 \u02dc]# nova boot --image d7c64f67-3de7-4aa0-88fb-1292ff520404 --flavor 1 --availability-zone second_zone:ns17-osee.cn.ibm.com test_zone17_2\n\n3.  [root@ns11 nova]# nova list\n+--------------------------------------+-----------------+---------+-------------+-------------+------------------------+\n| ID                                   | Name            | Status  | Task State  | Power State | Networks               |\n+--------------------------------------+-----------------+---------+-------------+-------------+------------------------+\n\n| 6f3ec942-6c8e-46fa-ad7e-d2c900921f65 | test_zone17     | ACTIVE  | None        | Running     | flat_net01=172.10.0.16 |\n| 7273973d-a9e1-4917-ad59-c54ece9b0765 | test_zone17_1   | ACTIVE  | None        | Running     | flat_net01=172.10.0.18 |\n| 27f71b26-b775-4516-ba2a-13d9e91e96dd | test_zone17_2   | ACTIVE  | None        | Running     | flat_net01=172.10.0.19 |\n| 6350a439-2dd3-4b14-b99e-219fad27111b | zhikun_testvm   | ACTIVE  | None        | Running     | flat_net01=172.10.0.13 |\n+--------------------------------------+-----------------+---------+-------------+-------------+------------------------+\n\n4.  but the zone of the vm is: nova\n[root@ns11 nova]# nova show 27f71b26-b775-4516-ba2a-13d9e91e96dd\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| status                               | ACTIVE                                                   |\n| flat_net01 network                   | 172.10.0.19                                              |\n| updated                              | 2013-09-25T09:50:23Z                                     |\n| OS-EXT-STS:task_state                | None                                                     |\n| OS-EXT-SRV-ATTR:host                 | ns17-osee.cn.ibm.com                                     |\n| key_name                             | None                                                     |\n| image                                | cirros_kvm (d7c64f67-3de7-4aa0-88fb-1292ff520404)        |\n\n| accessIPv6                           |                                                          |\n| progress                             | 0                                                        |\n| OS-EXT-STS:power_state               | 1                                                        |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| config_drive                         |                                                          |\n+--------------------------------------+----------------------------------------------------------+\n\n[root@ns11 nova]# date\nWed Sep 25 18:05:26 CST 2013\n\n5.  I did not configure default_zone in nova.conf\n\n6.  It is very strange that this problem could not always been recreated. usually it happens when we create a new AZ, and then use the AZ boot instance. Seems wait for some time, may be one night or sooner, the AZ will become to correct one. I'm confused.\n\n# Expected  results\nThe AZ should take effect any time if we did not set default AZ in nova.conf", 
            "date_created": "2013-10-16 06:58:56.303875+00:00", 
            "author": "https://api.launchpad.net/1.0/~chenxiao"
        }, 
        {
            "content": "After checking current codes, I doubt the issue may only exit in single compute node env, have you tried to produce the issue in multi compute nodes env?", 
            "date_created": "2013-10-21 09:22:19.101286+00:00", 
            "author": "https://api.launchpad.net/1.0/~jiataotj"
        }, 
        {
            "content": "More over, even applying your code changes(https://review.openstack.org/#/c/52058/), it still depends on service list operation to call availability_zones.set_availability_zones to update cache, I think it's better to design and implement an availability zone cache updating mechanism, cache updating shouldn't couple with a specific API, it doesn't make sense.", 
            "date_created": "2013-10-21 09:35:16.392335+00:00", 
            "author": "https://api.launchpad.net/1.0/~jiataotj"
        }, 
        {
            "content": "I will submit a new code for resolve this problem. Thanks", 
            "date_created": "2013-12-03 03:13:33.497009+00:00", 
            "author": "https://api.launchpad.net/1.0/~chenxiao"
        }, 
        {
            "content": "https://review.openstack.org/#/c/57621/", 
            "date_created": "2013-12-04 04:54:33.801336+00:00", 
            "author": "https://api.launchpad.net/1.0/~chenxiao"
        }, 
        {
            "content": "sorry, https://review.openstack.org/#/c/57621/ is not for this bug, ", 
            "date_created": "2013-12-04 08:05:09.832725+00:00", 
            "author": "https://api.launchpad.net/1.0/~chenxiao"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/59922", 
            "date_created": "2013-12-04 08:45:51.723817+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}