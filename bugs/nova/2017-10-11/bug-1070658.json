{
    "status": "Invalid", 
    "last_updated": "2012-10-24 09:48:13.231940+00:00", 
    "description": "I have issues trying to deploy instance in OpenStack using Hyper-V driver.\nHere is my environment information:\nOpenstack controller node: installed on Compute Host A, using OpenStack Folsom RC1 code.\nOpenstack compute node: Windows server 2012 with Hyper-V Role enabled installed on Compute Host B, with Nova-Compute Service installed using the installer here http://www.cloudbase.it/openstack/openstack-compute-installer/ for Folsom release.\n\nWhen I tried to launch an instance to the compute node, it failed in spawning, here is the error log found in nova-compute.log(detailed log information is attached):\n\n2012-10-19 18:57:06 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Creating difference disk: JobID=\\\\WIN\n\n-KSKERE5KU31\\root\\virtualization:Msvm_StorageJob.InstanceID=\"A34DF87A-EF9D-4007-B04F-C932D4E76399\", Source=c:\\Hyper-V\\instances\\_base\\64d0ffeb-cc13-4c03-9c3b-56cbc132e482.vhd, Target=c:\\Hyper-\n\nV\\instances\\instance-00000001\\instance-00000001.vhd from (pid=7840) _cache_image C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:616\n2012-10-19 18:57:09 ERROR nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] cache image failed: This object does\n\nnot support enumeration\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops Traceback (most recent call last):\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py\", line 133, in spawn\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops cow=FLAGS.use_cow_images)\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py\", line 618, in _cache_image\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops success = self._vmutils.check_job_status(job)\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmutils.py\", line 69, in check_job_status\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops \"%(ErrorDescription)s - %(ErrorCode)s\") % job)\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops File \"C:\\Python27\\lib\\site-packages\\win32com\\client\\dynamic.py\", line 246, in __getitem__\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops raise TypeError(\"This object does not support enumeration\")\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops TypeError: This object does not support enumeration\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Got request to destroy vm instance-\n\n00000001 from (pid=7840) destroy C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:374\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Created VM instance-00000001... from\n\n(pid=7840) _create_vm C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:180\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Set memory for vm instance-00000001...\n\nfrom (pid=7840) _create_vm C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:197\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Set vcpus for vm instance-00000001...\n\nfrom (pid=7840) _create_vm C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:210\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Creating disk for instance-00000001 by\n\nattaching disk file c:\\Hyper-V\\instances\\instance-00000001\\instance-00000001.vhd from (pid=7840) _create_disk C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:237\n2012-10-19 18:57:10 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] New disk drive path is \\\\WIN-\n\nKSKERE5KU31\\root\\virtualization:Msvm_ResourceAllocationSettingData.InstanceID=\"Microsoft:CC6BAD8D-EC33-4F14-87FE-203C4547522C\\\\83F8638B-8DCA-4152-9EDA-2CA8B33039B4\\\\0\\\\0\\\\D\" from (pid=7840)\n\n_create_disk C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:266\n2012-10-19 18:57:11 ERROR nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] spawn vm failed: This object does not\n\nsupport enumeration\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops Traceback (most recent call last):\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py\", line 142, in spawn\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops self._create_disk(instance['name'], vhdfile)\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py\", line 282, in _create_disk\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops vhddisk, vm)\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmutils.py\", line 123, in add_virt_resource\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops success = self.check_job_status(job)\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmutils.py\", line 69, in check_job_status\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops \"%(ErrorDescription)s - %(ErrorCode)s\") % job)\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\Python27\\lib\\site-packages\\win32com\\client\\dynamic.py\", line 246, in __getitem__\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops raise TypeError(\"This object does not support enumeration\")\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops TypeError: This object does not support enumeration\n\nI debug the code and found that it failed at line 609-613 in virt\\hyper-v\\vmops.py.\n                 image_service = self._conn.query(\n                    \"Select * from Msvm_ImageManagementService\")[0]\n                (job, ret_val) = \\\n                    image_service.CreateDifferencingVirtualHardDisk(\n                        Path=target, ParentPath=base)\n\nThe WMI job state for this WMI operation is 10 (Exception). Then I tried to create Differencing VHD using WMI in Powershell on Windows Server 2012. Here is the script I used:\n$parentVhdFn = \"c:\\Hyper-V\\instances\\_base\\64d0ffeb-cc13-4c03-9c3b-56cbc132e482.vhd\"\n$newVhdFn = \"c:\\Hyper-V\\instances\\\\instance-test.vhd\"\n$ims = Get-WmiObject -computername \".\" -namespace \"root\\virtualization\" -class \"Msvm_ImageManagementService\"\n$result=[WMI]$ims.CreateDifferencingVirtualHardDisk($newVhdFn, $parentVhdFn).Job\n\nThe job also failed.\n\nHave anyone tried this? Could you help? Thank you very much.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1070658", 
    "owner": "None", 
    "id": 1070658, 
    "index": 3160, 
    "created": "2012-10-24 03:44:35.773924+00:00", 
    "title": "VM provisioning failure on Hyper-V driver", 
    "comments": [
        {
            "content": "I have issues trying to deploy instance in OpenStack using Hyper-V driver.\nHere is my environment information:\nOpenstack controller node: installed on Compute Host A, using OpenStack Folsom RC1 code.\nOpenstack compute node: Windows server 2012 with Hyper-V Role enabled installed on Compute Host B, with Nova-Compute Service installed using the installer here http://www.cloudbase.it/openstack/openstack-compute-installer/ for Folsom release.\n\nWhen I tried to launch an instance to the compute node, it failed in spawning, here is the error log found in nova-compute.log(detailed log information is attached):\n\n2012-10-19 18:57:06 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Creating difference disk: JobID=\\\\WIN\n\n-KSKERE5KU31\\root\\virtualization:Msvm_StorageJob.InstanceID=\"A34DF87A-EF9D-4007-B04F-C932D4E76399\", Source=c:\\Hyper-V\\instances\\_base\\64d0ffeb-cc13-4c03-9c3b-56cbc132e482.vhd, Target=c:\\Hyper-\n\nV\\instances\\instance-00000001\\instance-00000001.vhd from (pid=7840) _cache_image C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:616\n2012-10-19 18:57:09 ERROR nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] cache image failed: This object does\n\nnot support enumeration\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops Traceback (most recent call last):\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py\", line 133, in spawn\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops cow=FLAGS.use_cow_images)\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py\", line 618, in _cache_image\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops success = self._vmutils.check_job_status(job)\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmutils.py\", line 69, in check_job_status\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops \"%(ErrorDescription)s - %(ErrorCode)s\") % job)\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops File \"C:\\Python27\\lib\\site-packages\\win32com\\client\\dynamic.py\", line 246, in __getitem__\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops raise TypeError(\"This object does not support enumeration\")\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops TypeError: This object does not support enumeration\n2012-10-19 18:57:09 TRACE nova.virt.hyperv.vmops\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Got request to destroy vm instance-\n\n00000001 from (pid=7840) destroy C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:374\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Created VM instance-00000001... from\n\n(pid=7840) _create_vm C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:180\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Set memory for vm instance-00000001...\n\nfrom (pid=7840) _create_vm C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:197\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Set vcpus for vm instance-00000001...\n\nfrom (pid=7840) _create_vm C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:210\n2012-10-19 18:57:09 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] Creating disk for instance-00000001 by\n\nattaching disk file c:\\Hyper-V\\instances\\instance-00000001\\instance-00000001.vhd from (pid=7840) _create_disk C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:237\n2012-10-19 18:57:10 DEBUG nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] New disk drive path is \\\\WIN-\n\nKSKERE5KU31\\root\\virtualization:Msvm_ResourceAllocationSettingData.InstanceID=\"Microsoft:CC6BAD8D-EC33-4F14-87FE-203C4547522C\\\\83F8638B-8DCA-4152-9EDA-2CA8B33039B4\\\\0\\\\0\\\\D\" from (pid=7840)\n\n_create_disk C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py:266\n2012-10-19 18:57:11 ERROR nova.virt.hyperv.vmops [req-2da7f0d5-7ba5-47cc-85ea-02a00ed6aa66 990dae0e5620447ea684809063ee27a4 d3e88c95b9d54ba4b8ec6c3c358559bc] spawn vm failed: This object does not\n\nsupport enumeration\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops Traceback (most recent call last):\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py\", line 142, in spawn\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops self._create_disk(instance['name'], vhdfile)\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmops.py\", line 282, in _create_disk\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops vhddisk, vm)\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmutils.py\", line 123, in add_virt_resource\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops success = self.check_job_status(job)\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\openstack-nova\\nova\\virt\\hyperv\\vmutils.py\", line 69, in check_job_status\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops \"%(ErrorDescription)s - %(ErrorCode)s\") % job)\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops File \"C:\\Python27\\lib\\site-packages\\win32com\\client\\dynamic.py\", line 246, in __getitem__\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops raise TypeError(\"This object does not support enumeration\")\n2012-10-19 18:57:11 TRACE nova.virt.hyperv.vmops TypeError: This object does not support enumeration\n\nI debug the code and found that it failed at line 609-613 in virt\\hyper-v\\vmops.py.\n                 image_service = self._conn.query(\n                    \"Select * from Msvm_ImageManagementService\")[0]\n                (job, ret_val) = \\\n                    image_service.CreateDifferencingVirtualHardDisk(\n                        Path=target, ParentPath=base)\n\nThe WMI job state for this WMI operation is 10 (Exception). Then I tried to create Differencing VHD using WMI in Powershell on Windows Server 2012. Here is the script I used:\n$parentVhdFn = \"c:\\Hyper-V\\instances\\_base\\64d0ffeb-cc13-4c03-9c3b-56cbc132e482.vhd\"\n$newVhdFn = \"c:\\Hyper-V\\instances\\\\instance-test.vhd\"\n$ims = Get-WmiObject -computername \".\" -namespace \"root\\virtualization\" -class \"Msvm_ImageManagementService\"\n$result=[WMI]$ims.CreateDifferencingVirtualHardDisk($newVhdFn, $parentVhdFn).Job\n\nThe job also failed.\n\nHave anyone tried this? Could you help? Thank you very much.", 
            "date_created": "2012-10-24 03:44:35.773924+00:00", 
            "author": "https://api.launchpad.net/1.0/~isisliu"
        }, 
        {
            "content": "This issue does not exist anymore. So close this bug.", 
            "date_created": "2012-10-24 09:47:23.803099+00:00", 
            "author": "https://api.launchpad.net/1.0/~isisliu"
        }, 
        {
            "content": "Issue doesn't exist any more. It is not a code issue.", 
            "date_created": "2012-10-24 09:48:09.572880+00:00", 
            "author": "https://api.launchpad.net/1.0/~isisliu"
        }
    ]
}