{
    "status": "Invalid", 
    "last_updated": "2015-08-13 12:25:04.085431+00:00", 
    "description": "Since upgrading to icehouse we consistently get reply_xxxxx queues filling up with unacked messages. To fix this I have to restart the service. This seems to happen when something is wrong for a short period of time and it doesn't clean up after itself. \n\nSo far I've seen the issue with nova-api, nova-compute, nova-network, nova-api-metadata, cinder-api but I'm sure there are others.", 
    "tags": [
        "ops", 
        "sts", 
        "verification-failed"
    ], 
    "importance": "High", 
    "heat": 30, 
    "link": "https://bugs.launchpad.net/nova/+bug/1362863", 
    "owner": "None", 
    "id": 1362863, 
    "index": 1588, 
    "created": "2014-08-29 00:13:06.854618+00:00", 
    "title": "reply queues fill up with unacked messages", 
    "comments": [
        {
            "content": "Since upgrading to icehouse we consistently get reply_xxxxx queues filling up with unacked messages. To fix this I have to restart the service. This seems to happen when something is wrong for a short period of time and it doesn't clean up after itself. \n\nSo far I've seen the issue with nova-api, nova-compute, nova-network, nova-api-metadata, cinder-api but I'm sure there are others.", 
            "date_created": "2014-08-29 00:13:06.854618+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "I should also mention this is on Ubuntu 14.04", 
            "date_created": "2014-08-29 00:13:45.283845+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Hi Sam - what messaging broker are you using when you hit this issue? ", 
            "date_created": "2014-08-29 20:51:43.075051+00:00", 
            "author": "https://api.launchpad.net/1.0/~kgiusti"
        }, 
        {
            "content": "Sorry should've mentioned that, we're using RabbitMQ. Have seen it against the following versions tested. 3.3.5 (latest) 3.3.4, 3.1.5, 3.1.3\n\n", 
            "date_created": "2014-08-29 23:26:45.869104+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "This is quite a big issue for us, it's happening 3-4 times a day.", 
            "date_created": "2014-08-29 23:27:54.110868+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Ah, thanks - there was a qpid-specific issue (since fixed) that sounded similar to what you're hitting:\n\nhttps://bugs.launchpad.net/oslo.messaging/+bug/1318742\n\nThis doesn't apply to rabbitmq.  Just checking to be sure.", 
            "date_created": "2014-09-03 14:25:41.819666+00:00", 
            "author": "https://api.launchpad.net/1.0/~kgiusti"
        }, 
        {
            "content": "can you attach logs please?  ", 
            "date_created": "2014-09-03 16:40:51.988601+00:00", 
            "author": "https://api.launchpad.net/1.0/~tjones-i"
        }, 
        {
            "content": "What's your rpc configuration in nova.conf?", 
            "date_created": "2014-09-03 16:43:27.282778+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Configs in nova and cinder:\nrabbit_hosts=\"mq:5671,mq1:5671,mq2:5671,mq3:5671\"\nrabbit_ha_queues=True\nrabbit_userid=nova\nrabbit_password=XXXXXXX\nrabbit_durable_queues=True\nrabbit_use_ssl=True\n\nSome related package versions:\n\napt-cache policy librabbitmq1\nlibrabbitmq1:\n  Installed: 0.4.1-1\n  Candidate: 0.4.1-1\n \napt-cache policy python-amqp\npython-amqp:\n  Installed: 1.3.3-1ubuntu1\n  Candidate: 1.3.3-1ubuntu1\n\napt-cache policy python-amqplib\npython-amqplib:\n  Installed: 1.0.2-1\n  Candidate: 1.0.2-1\n\napt-cache policy python-kombu\npython-kombu:\n  Installed: 3.0.7-1ubuntu1\n  Candidate: 3.0.7-1ubuntu1\n\n\nThe reply_xxxx queue in RabbitMQ that has unacked messages does have a consumer. I trace that back to the offending API host using the port number and see that it's a nova-api process that has an established connection to rabbit. Then I've been using strace on the process to see what it's doing. All it has is:\n\ngettimeofday({1409785170, 966963}, NULL) = 0\ngettimeofday({1409785170, 967066}, NULL) = 0\nepoll_wait(6, {{EPOLLIN, {u32=7, u64=39432335262744583}}}, 1023, 482100) = 1\nepoll_ctl(6, EPOLL_CTL_DEL, 7, {EPOLLWRNORM|EPOLLERR|EPOLLONESHOT|0xe0a1800, {u32=32681, u64=22396489217114025}}) = 0\naccept(7, 0x7fffdf911350, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(6, EPOLL_CTL_ADD, 7, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=7, u64=39432335262744583}}) = 0\ngettimeofday({1409785188, 431971}, NULL) = 0\ngettimeofday({1409785188, 432035}, NULL) = 0\nepoll_wait(6, {{EPOLLIN, {u32=7, u64=39432335262744583}}}, 1023, 464636) = 1\nepoll_ctl(6, EPOLL_CTL_DEL, 7, {EPOLLWRNORM|EPOLLERR|EPOLLONESHOT|0xe0a1800, {u32=32681, u64=22396489217114025}}) = 0\naccept(7, 0x7fffdf911350, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(6, EPOLL_CTL_ADD, 7, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=7, u64=39432335262744583}}) = 0\n\n\nThe API host isn't under any load etc. either nor are the rabbit and DB hosts.\n\nThis is happening for us multiple times a day so it would be easy for me to get more information. I just don't know how to debug further.\n\n\n\n\n\n\n\n\n", 
            "date_created": "2014-09-03 23:03:41.100925+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "We are getting these in the nova-api logs for a few things so this could be related. We aren't getting anything in the cinder-api logs though and we are seeing the exact same issue there. (just less frequent as the api is used less)\n\n\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack Traceback (most recent call last):\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 125, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return req.get_response(self.application)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     application, catch_exc_info=False)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 582, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return self.app(env, start_response)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 917, in __call__\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     content_type, body, accept)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 983, in _process_stack\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1070, in dispatch\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return method(req=request, **action_args)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/console_output.py\", line 67, in get_console_output\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     length)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 218, in _wrapped\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return fn(self, context, instance, *args, **kwargs)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/cells_api.py\", line 430, in get_console_output\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     *args, **kwargs)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/cells_api.py\", line 201, in _call_to_cells\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     method, instance_uuid, *args, **kwargs)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/cells/rpcapi.py\", line 130, in call_compute_api_method\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     call=True)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 361, in call\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return self.prepare().call(ctxt, method, **kwargs)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 150, in call\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     wait_for_reply=True, timeout=timeout)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     timeout=timeout)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 412, in send\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     return self._send(target, ctxt, message, wait_for_reply, timeout)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 403, in _send\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     result = self._waiter.wait(msg_id, timeout)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 267, in wait\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     reply, ending = self._poll_connection(msg_id, timeout)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 217, in _poll_connection\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack     % msg_id)\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack MessagingTimeout: Timed out waiting for a reply to message ID e913d74ca8dc43a29f1d3143e235f853\n2014-09-05 08:36:09.025 17883 TRACE nova.api.openstack \n\n\n\nStrace of a cinder-api process that is stuck:\n\nProcess 1577 attached\ngettimeofday({1409871217, 128631}, NULL) = 0\nepoll_wait(7, {{EPOLLIN, {u32=8, u64=39432335262744584}}}, 1023, 60000) = 1\nepoll_ctl(7, EPOLL_CTL_DEL, 8, {EPOLLRDNORM|EPOLLWRNORM|EPOLLHUP|EPOLLRDHUP|EPOLLET|0xfa74800, {u32=32669, u64=22396489217114013}}) = 0\naccept(8, 0x7fffbfc161d0, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(7, EPOLL_CTL_ADD, 8, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=8, u64=39432335262744584}}) = 0\ngettimeofday({1409871218, 462312}, NULL) = 0\nepoll_wait(7, {{EPOLLIN, {u32=8, u64=39432335262744584}}}, 1023, 60000) = 1\nepoll_ctl(7, EPOLL_CTL_DEL, 8, {EPOLLRDNORM|EPOLLWRNORM|EPOLLHUP|EPOLLRDHUP|EPOLLET|0xfa74800, {u32=32669, u64=22396489217114013}}) = 0\naccept(8, 0x7fffbfc161d0, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(7, EPOLL_CTL_ADD, 8, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=8, u64=39432335262744584}}) = 0\ngettimeofday({1409871218, 820144}, NULL) = 0\nepoll_wait(7, {{EPOLLIN, {u32=8, u64=39432335262744584}}}, 1023, 60000) = 1\nepoll_ctl(7, EPOLL_CTL_DEL, 8, {EPOLLRDNORM|EPOLLWRNORM|EPOLLHUP|EPOLLRDHUP|EPOLLET|0xfa74800, {u32=32669, u64=22396489217114013}}) = 0\naccept(8, 0x7fffbfc161d0, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(7, EPOLL_CTL_ADD, 8, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=8, u64=39432335262744584}}) = 0\ngettimeofday({1409871219, 592145}, NULL) = 0\nepoll_wait(7, {{EPOLLIN, {u32=8, u64=39432335262744584}}}, 1023, 60000) = 1\nepoll_ctl(7, EPOLL_CTL_DEL, 8, {EPOLLRDNORM|EPOLLWRNORM|EPOLLHUP|EPOLLRDHUP|EPOLLET|0xfa74800, {u32=32669, u64=22396489217114013}}) = 0\naccept(8, 0x7fffbfc161d0, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(7, EPOLL_CTL_ADD, 8, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=8, u64=39432335262744584}}) = 0\ngettimeofday({1409871221, 750442}, NULL) = 0\nepoll_wait(7, {{EPOLLIN, {u32=8, u64=39432335262744584}}}, 1023, 60000) = 1\nepoll_ctl(7, EPOLL_CTL_DEL, 8, {EPOLLRDNORM|EPOLLWRNORM|EPOLLHUP|EPOLLRDHUP|EPOLLET|0xfa74800, {u32=32669, u64=22396489217114013}}) = 0\naccept(8, 0x7fffbfc161d0, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(7, EPOLL_CTL_ADD, 8, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=8, u64=39432335262744584}}) = 0\ngettimeofday({1409871223, 508851}, NULL) = 0\nepoll_wait(7, {{EPOLLIN, {u32=8, u64=39432335262744584}}}, 1023, 60000) = 1\nepoll_ctl(7, EPOLL_CTL_DEL, 8, {EPOLLRDNORM|EPOLLWRNORM|EPOLLHUP|EPOLLRDHUP|EPOLLET|0xfa74800, {u32=32669, u64=22396489217114013}}) = 0\naccept(8, 0x7fffbfc161d0, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(7, EPOLL_CTL_ADD, 8, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=8, u64=39432335262744584}}) = 0\ngettimeofday({1409871223, 940830}, NULL) = 0\nepoll_wait(7, {{EPOLLIN, {u32=8, u64=39432335262744584}}}, 1023, 60000) = 1\nepoll_ctl(7, EPOLL_CTL_DEL, 8, {EPOLLRDNORM|EPOLLWRNORM|EPOLLHUP|EPOLLRDHUP|EPOLLET|0xfa74800, {u32=32669, u64=22396489217114013}}) = 0\naccept(8, 0x7fffbfc161d0, [16])         = -1 EAGAIN (Resource temporarily unavailable)\nepoll_ctl(7, EPOLL_CTL_ADD, 8, {EPOLLIN|EPOLLPRI|EPOLLERR|EPOLLHUP, {u32=8, u64=39432335262744584}}) = 0\ngettimeofday({1409871226, 755337}, NULL) = 0\nepoll_wait(7, ^CProcess 1577 detached\n", 
            "date_created": "2014-09-04 22:54:58.664406+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Have provided more info so moving back to new", 
            "date_created": "2014-09-04 22:55:26.611899+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Actually we do see this in cinder-api logs too:\n\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault Traceback (most recent call last):\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/cinder/api/middleware/fault.py\", line 75, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return req.get_response(self.application)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     application, catch_exc_info=False)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     app_iter = application(self.environ, start_response)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 582, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return self.app(env, start_response)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     response = self.app(environ, start_response)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     resp = self.call_func(req, *args, **self.kwargs)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return self.func(req, *args, **kwargs)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 895, in __call__\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     content_type, body, accept)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 943, in _process_stack\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     action_result = self.dispatch(meth, request, action_args)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 1019, in dispatch\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return method(req=request, **action_args)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/cinder/api/contrib/volume_actions.py\", line 215, in _terminate_connection\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     self.volume_api.terminate_connection(context, volume, connector)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/cinder/volume/api.py\", line 75, in wrapped\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return func(self, context, target_obj, *args, **kwargs)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/cinder/volume/api.py\", line 435, in terminate_connection\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     force)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/cinder/volume/rpcapi.py\", line 125, in terminate_connection\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     connector=connector, force=force)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 150, in call\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     wait_for_reply=True, timeout=timeout)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     timeout=timeout)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 412, in send\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     return self._send(target, ctxt, message, wait_for_reply, timeout)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 403, in _send\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     result = self._waiter.wait(msg_id, timeout)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 267, in wait\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     reply, ending = self._poll_connection(msg_id, timeout)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 217, in _poll_connection\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault     % msg_id)\n2014-09-04 17:17:54.149 1542 TRACE cinder.api.middleware.fault MessagingTimeout: Timed out waiting for a reply to message ID 167a3bc9e6354c0f967eaa3a4b0ac071\n", 
            "date_created": "2014-09-04 23:01:48.404517+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Some more observations. In our test cloud we have an environment with 1 controller (icehouse/trusty) and 4 compute nodes.\n\n2 of the computes are Icehouse/trusty and 2 are havana/precise.\n\nIf I turn off the controller or reboot it etc. then the 2 icehouse computes get in a mess, messages start piling up unacked in reply queues and I need to restart nova-compute, nova-network and nova-api-metadata.\n\nThe havana/precise computes are fine and require no restarting of things.", 
            "date_created": "2014-09-05 05:10:51.880941+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "We see things like this in the logs:\n\n2014-10-22 11:18:18.358 30300 WARNING oslo.messaging._drivers.amqpdriver [-] _queues: {'40282b6608f245dc9903a6d31cbf09dd': <Queue at 0x7f5ebab97390 maxsize=None>}\n2014-10-22 11:18:18.359 30300 WARNING oslo.messaging._drivers.amqpdriver [-] No calling threads waiting for msg_id : 2fdbf0667a1a49d4af6a022549f6737d, message : {u'_unique_id': u'cea90764a9714fe8ade5a5ff2dbd2a17', u'failure': None, u'result': None, u'ending': True}\n2014-10-22 11:18:18.360 30300 WARNING oslo.messaging._drivers.amqpdriver [-] _queues: {'40282b6608f245dc9903a6d31cbf09dd': <Queue at 0x7f5ebab97390 maxsize=None>}\n", 
            "date_created": "2014-10-22 00:22:59.751500+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Hi,\n\nI guess, the issue was due that before oslo.messaging use eventlet.kill instead of eventlet.cancel to stop the server thread. So this issue should be fixed since this commit is merged:\n\nhttps://github.com/openstack/oslo.messaging/commit/7bce31a2d14de29f1fc306938c7085f5205c9110#diff-9e692a136baf4fc701a9868fa789b442R102\n\n\nPlease reopen the bug is this still occurs with oslo.messaging >= 1.5.0.", 
            "date_created": "2014-12-03 17:13:55.853659+00:00", 
            "author": "https://api.launchpad.net/1.0/~sileht"
        }, 
        {
            "content": "I'm still seeing exactly what comment #11 shows with cinder-api. Running oslo.messaging 1.6.0", 
            "date_created": "2015-04-09 16:31:13.212082+00:00", 
            "author": "https://api.launchpad.net/1.0/~jacobgodin"
        }, 
        {
            "content": "Steps to reproduce:\n\n- Create Volume\n- Attach to instance\n- Kill all rabbitmq connections (ie restart service)\n- Try to detach volume from instance\n\nLog:\n\n...\n2015-04-09 16:15:22.574 27 ERROR cinder.api.middleware.fault [req-f423763d-ec3d-4f22-b079-e6d395b90c75 886bb3d50acc4a0c8f9d91d6ca97c298 831491c8ae8042e9b1099c7e05cbbc80 - - -] Caught error: Timed out waiting for a reply to message ID f3170587210c4df0affee0b2f9534e80.\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault Traceback (most recent call last):\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/middleware/fault.py\", line 76, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return req.get_response(self.application)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     application, catch_exc_info=False)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     app_iter = application(self.environ, start_response)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 823, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return self._call_app(env, start_response)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 758, in _call_app\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return self._app(env, _fake_start_response)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 136, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     response = self.app(environ, start_response)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     resp = self.call_func(req, *args, **self.kwargs)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return self.func(req, *args, **kwargs)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 897, in __call__\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     content_type, body, accept)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 945, in _process_stack\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     action_result = self.dispatch(meth, request, action_args)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 1021, in dispatch\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return method(req=request, **action_args)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/contrib/volume_actions.py\", line 118, in _attach\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     instance_uuid, host_name, mountpoint, mode)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/volume/api.py\", line 87, in wrapped\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     return func(self, context, target_obj, *args, **kwargs)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/volume/api.py\", line 501, in attach\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     mode)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/volume/rpcapi.py\", line 146, in attach_volume\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     mode=mode)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     retry=self.retry)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     timeout=timeout, retry=retry)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 417, in send\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     retry=retry)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 406, in _send\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     result = self._waiter.wait(msg_id, timeout)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 296, in wait\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     reply, ending = self._poll_connection(msg_id, timer)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 243, in _poll_connection\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     self._raise_timeout_exception(msg_id)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 212, in _raise_timeout_exception\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault     _('Timed out waiting for a reply to message ID %s.') % msg_id)\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault MessagingTimeout: Timed out waiting for a reply to message ID f3170587210c4df0affee0b2f9534e80.\n2015-04-09 16:15:22.574 27 TRACE cinder.api.middleware.fault \n2015-04-09 16:15:26.710 25 ERROR oslo_messaging._drivers.impl_rabbit [req-43fc53f0-813b-4b8c-89e0-b9fe59a2d2a1 886bb3d50acc4a0c8f9d91d6ca97c298 831491c8ae8042e9b1099c7e05cbbc80 - - -] Failed to publish message to topic 'cinder-volume.cinder.staging@nimble': [Errno 32] Broken pipe\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit Traceback (most recent call last):\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/connection.py\", line 436, in _ensured\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     return fun(*args, **kwargs)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/connection.py\", line 508, in __call__\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     return fun(*args, channel=channels[0], **kwargs), channels[0]\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/impl_rabbit.py\", line 760, in _publish\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     publisher = cls(self.conf, channel, topic=topic, **kwargs)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/impl_rabbit.py\", line 397, in __init__\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     **options)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/impl_rabbit.py\", line 345, in __init__\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self.reconnect(channel)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/impl_rabbit.py\", line 353, in reconnect\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     routing_key=self.routing_key)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/messaging.py\", line 85, in __init__\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self.revive(self._channel)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/messaging.py\", line 218, in revive\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self.declare()\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/messaging.py\", line 105, in declare\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self.exchange.declare()\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/entity.py\", line 166, in declare\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     nowait=nowait, passive=passive,\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/channel.py\", line 620, in exchange_declare\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     (40, 11),  # Channel.exchange_declare_ok\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/abstract_channel.py\", line 67, in wait\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self.channel_id, allowed_methods)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/connection.py\", line 273, in _wait_method\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self.wait()\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/abstract_channel.py\", line 69, in wait\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     return self.dispatch_method(method_sig, args, content)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/abstract_channel.py\", line 87, in dispatch_method\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     return amqp_method(self, args)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/connection.py\", line 526, in _close\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self._x_close_ok()\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/connection.py\", line 554, in _x_close_ok\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self._send_method((10, 51))\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/abstract_channel.py\", line 56, in _send_method\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     self.channel_id, method_sig, args, content,\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/method_framing.py\", line 221, in write_method\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     write_frame(1, channel, payload)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/transport.py\", line 182, in write_frame\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     frame_type, channel, size, payload, 0xce,\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenio.py\", line 359, in sendall\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     tail = self.send(data, flags)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenio.py\", line 342, in send\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit     total_sent += fd.send(data[total_sent:], flags)\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit error: [Errno 32] Broken pipe\n2015-04-09 16:15:26.710 25 TRACE oslo_messaging._drivers.impl_rabbit \n2015-04-09 16:15:26.713 25 ERROR oslo_messaging._drivers.impl_rabbit [req-43fc53f0-813b-4b8c-89e0-b9fe59a2d2a1 886bb3d50acc4a0c8f9d91d6ca97c298 831491c8ae8042e9b1099c7e05cbbc80 - - -] AMQP server on 10.255.255.50:5672 is unreachable: [Errno 32] Broken pipe. Trying again in 1 seconds.\n2015-04-09 16:15:27.736 25 ERROR oslo_messaging._drivers.impl_rabbit [req-43fc53f0-813b-4b8c-89e0-b9fe59a2d2a1 886bb3d50acc4a0c8f9d91d6ca97c298 831491c8ae8042e9b1099c7e05cbbc80 - - -] Failed to consume message from queue: [Errno 32] Broken pipe\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit Traceback (most recent call last):\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/connection.py\", line 436, in _ensured\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     return fun(*args, **kwargs)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/connection.py\", line 507, in __call__\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     self.revive(create_channel())\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/connection.py\", line 242, in channel\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     chan = self.transport.create_channel(self.connection)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/kombu/transport/pyamqp.py\", line 88, in create_channel\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     return connection.channel()\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/connection.py\", line 281, in channel\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     return self.Channel(self, channel_id)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/channel.py\", line 99, in __init__\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     self._x_open()\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/channel.py\", line 427, in _x_open\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     (20, 11),  # Channel.open_ok\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/abstract_channel.py\", line 67, in wait\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     self.channel_id, allowed_methods)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/connection.py\", line 273, in _wait_method\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     self.wait()\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/abstract_channel.py\", line 69, in wait\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     return self.dispatch_method(method_sig, args, content)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/abstract_channel.py\", line 87, in dispatch_method\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     return amqp_method(self, args)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/connection.py\", line 526, in _close\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     self._x_close_ok()\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/connection.py\", line 554, in _x_close_ok\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     self._send_method((10, 51))\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/abstract_channel.py\", line 56, in _send_method\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     self.channel_id, method_sig, args, content,\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/method_framing.py\", line 221, in write_method\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     write_frame(1, channel, payload)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/amqp/transport.py\", line 182, in write_frame\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     frame_type, channel, size, payload, 0xce,\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenio.py\", line 359, in sendall\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     tail = self.send(data, flags)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenio.py\", line 342, in send\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit     total_sent += fd.send(data[total_sent:], flags)\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit error: [Errno 32] Broken pipe\n2015-04-09 16:15:27.736 25 TRACE oslo_messaging._drivers.impl_rabbit \n2015-04-09 16:15:27.740 25 ERROR oslo_messaging._drivers.impl_rabbit [req-43fc53f0-813b-4b8c-89e0-b9fe59a2d2a1 886bb3d50acc4a0c8f9d91d6ca97c298 831491c8ae8042e9b1099c7e05cbbc80 - - -] AMQP server on 10.255.255.50:5672 is unreachable: [Errno 32] Broken pipe. Trying again in 1 seconds.\n2015-04-09 16:16:27.739 25 ERROR cinder.api.middleware.fault [req-43fc53f0-813b-4b8c-89e0-b9fe59a2d2a1 886bb3d50acc4a0c8f9d91d6ca97c298 831491c8ae8042e9b1099c7e05cbbc80 - - -] Caught error: Timed out waiting for a reply to message ID bdbe2f92a6a244a2bc0476980c9bb691.\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault Traceback (most recent call last):\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/middleware/fault.py\", line 76, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return req.get_response(self.application)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     application, catch_exc_info=False)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     app_iter = application(self.environ, start_response)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 823, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return self._call_app(env, start_response)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 758, in _call_app\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return self._app(env, _fake_start_response)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 136, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     response = self.app(environ, start_response)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return resp(environ, start_response)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     resp = self.call_func(req, *args, **self.kwargs)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return self.func(req, *args, **kwargs)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 897, in __call__\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     content_type, body, accept)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 945, in _process_stack\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     action_result = self.dispatch(meth, request, action_args)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/openstack/wsgi.py\", line 1021, in dispatch\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return method(req=request, **action_args)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/api/contrib/volume_actions.py\", line 118, in _attach\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     instance_uuid, host_name, mountpoint, mode)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/volume/api.py\", line 87, in wrapped\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     return func(self, context, target_obj, *args, **kwargs)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/volume/api.py\", line 501, in attach\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     mode)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/cinder/volume/rpcapi.py\", line 146, in attach_volume\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     mode=mode)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     retry=self.retry)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     timeout=timeout, retry=retry)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 417, in send\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     retry=retry)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 406, in _send\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     result = self._waiter.wait(msg_id, timeout)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 296, in wait\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     reply, ending = self._poll_connection(msg_id, timer)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 243, in _poll_connection\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     self._raise_timeout_exception(msg_id)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 212, in _raise_timeout_exception\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault     _('Timed out waiting for a reply to message ID %s.') % msg_id)\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault MessagingTimeout: Timed out waiting for a reply to message ID bdbe2f92a6a244a2bc0476980c9bb691.\n2015-04-09 16:16:27.739 25 TRACE cinder.api.middleware.fault \n", 
            "date_created": "2015-04-09 16:33:57.474247+00:00", 
            "author": "https://api.launchpad.net/1.0/~jacobgodin"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/194296", 
            "date_created": "2015-06-22 18:42:54.727103+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Jorge Niedbalski R. (<email address hidden>) on branch: stable/icehouse\nReview: https://review.openstack.org/194296\nReason: Not suitable for security update", 
            "date_created": "2015-06-22 22:58:50.383091+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/194460", 
            "date_created": "2015-06-23 00:45:34.325351+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "", 
            "date_created": "2015-06-23 13:38:07.211524+00:00", 
            "author": "https://api.launchpad.net/1.0/~niedbalski"
        }, 
        {
            "content": "This patch is applied in wily's python-oslo.messaging source package. Jorge, please always check this for the current development series, as it's not at all obvious what the status of that is.", 
            "date_created": "2015-06-26 08:33:57.388088+00:00", 
            "author": "https://api.launchpad.net/1.0/~pitti"
        }, 
        {
            "content": "I uploaded Jorge's trusty patch to the trusty SRU review queue. Jorge, please add the necessary SRU information to this bug (https://wiki.ubuntu.com/StableReleaseUpdates#SRU_Bug_Template). Thanks!", 
            "date_created": "2015-06-26 08:35:52.265496+00:00", 
            "author": "https://api.launchpad.net/1.0/~pitti"
        }, 
        {
            "content": "Sorry, I had to reject the upload. There is already a different oslo.messaging SRU waiting in the queue for bug 1448650. Can you please prepare a new debdiff relative to that? Please also add an (LP: #xxx) bug ref to your changelog. Thanks!\n\nPlease re-subscribe sponsors when this is done.", 
            "date_created": "2015-06-26 08:56:25.684204+00:00", 
            "author": "https://api.launchpad.net/1.0/~pitti"
        }, 
        {
            "content": "", 
            "date_created": "2015-06-30 16:46:53.760397+00:00", 
            "author": "https://api.launchpad.net/1.0/~niedbalski"
        }, 
        {
            "content": "Martin @piti,\n\nI have attached the trusty patch on top of the current -proposed version.\n\nThanks for sponsoring this.", 
            "date_created": "2015-06-30 16:47:30.486230+00:00", 
            "author": "https://api.launchpad.net/1.0/~niedbalski"
        }, 
        {
            "content": "Sponsored for Trusty", 
            "date_created": "2015-06-30 20:08:42.289702+00:00", 
            "author": "https://api.launchpad.net/1.0/~arges"
        }, 
        {
            "content": "Change abandoned by Jeremy Stanley (<email address hidden>) on branch: stable/icehouse\nReview: https://review.openstack.org/194460\nReason: This branch has reached end of life and is being deleted.", 
            "date_created": "2015-07-01 18:24:58.164550+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "@Chris: Apparently you didn't? There is no new oslo.messaging in https://launchpad.net/ubuntu/trusty/+queue?queue_state=1&queue_text=oslo\n\nThis is blocked anyway until https://launchpad.net/ubuntu/+source/oslo.messaging/1.8.3-0ubuntu0.15.04.1 moves out of -proposed.", 
            "date_created": "2015-07-02 07:04:44.680651+00:00", 
            "author": "https://api.launchpad.net/1.0/~pitti"
        }, 
        {
            "content": "", 
            "date_created": "2015-07-13 20:51:50.306415+00:00", 
            "author": "https://api.launchpad.net/1.0/~niedbalski"
        }, 
        {
            "content": "", 
            "date_created": "2015-07-13 20:52:39.947052+00:00", 
            "author": "https://api.launchpad.net/1.0/~niedbalski"
        }, 
        {
            "content": "This time really sponsored for Trusty.", 
            "date_created": "2015-07-13 21:04:35.865422+00:00", 
            "author": "https://api.launchpad.net/1.0/~arges"
        }, 
        {
            "content": "Hello Sam, or anyone else affected,\n\nAccepted oslo.messaging into trusty-proposed. The package will build now and be available at https://launchpad.net/ubuntu/+source/oslo.messaging/1.3.0-0ubuntu1.3 in a few hours, and then in the -proposed repository.\n\nPlease help us by testing this new package.  See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed.  Your feedback will aid us getting this update out to other Ubuntu users.\n\nIf this package fixes the bug for you, please add a comment to this bug, mentioning the version of the package you tested, and change the tag from verification-needed to verification-done. If it does not fix the bug for you, please add a comment stating that, and change the tag to verification-failed.  In either case, details of your testing will help us make a better decision.\n\nFurther information regarding the verification process can be found at https://wiki.ubuntu.com/QATeam/PerformingSRUVerification .  Thank you in advance!", 
            "date_created": "2015-07-15 19:32:34.523592+00:00", 
            "author": "https://api.launchpad.net/1.0/~arges"
        }, 
        {
            "content": "This proposed packaged causes problems in the nova unit test suite; namely the tests get a few in and then lockup and the builds timeout.", 
            "date_created": "2015-07-23 09:00:40.275856+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "Marked 'verification-failed'.", 
            "date_created": "2015-07-23 09:00:59.479448+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "The version of oslo.messaging in the proposed pocket of Trusty that was purported to fix this bug report has been removed because the bugs that were to be fixed by the upload were not verified in a timely (105 days) fashion.", 
            "date_created": "2015-07-23 16:16:43.689828+00:00", 
            "author": "https://api.launchpad.net/1.0/~arges"
        }, 
        {
            "content": "The version of oslo.messaging in the proposed pocket of Trusty that was purported to fix this bug report has been removed because the bugs that were to be fixed by the upload were not verified in a timely (105 days) fashion.", 
            "date_created": "2015-07-23 16:16:50.269772+00:00", 
            "author": "https://api.launchpad.net/1.0/~arges"
        }, 
        {
            "content": "If you are hitting this issues and you are using rabbitmq SSL with the latest Trusty/Icehouse oslo.messaging then you will hitting the bug from:\n\nhttps://bugs.launchpad.net/ubuntu/+source/python-amqp/+bug/1472712\n\nFor which there is a fix in trusty-proposed and it will shortly land in trusty-updates. I suggest you upgrade to that version of python-amqp to fix your problem.", 
            "date_created": "2015-08-13 12:25:03.207436+00:00", 
            "author": "https://api.launchpad.net/1.0/~hopem"
        }
    ]
}