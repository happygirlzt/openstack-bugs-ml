{
    "status": "Confirmed", 
    "last_updated": "2016-07-08 17:29:00.925862+00:00", 
    "description": "* Precondition:\n- Nova: Add \"iscsi_use_multipath = True\" in [libvirt] section of nova.conf.\n- Cinder: use iSCSI storage backend that supports multi-path.\n  Nova-compute nodes and iSCSI ports of the storage array are connected to 2 LAN segments for mutli-pathing.\n- One of the iSCSI paths is not active (for example, the cable is bad).\n\n* How to reproduce:\nUsers create volume boot instance.\n  nova boot --flavor m1.heat --boot-volume 24abb70b-c0ef-46c8-b734-6bc230fff1a7 test\n\n* Actual results:\nThe instance fails to boot.\n  nova list\n  | 8df39f1b-d09d-42bf-8bf9-667c91a3ab34 | test  | ERROR  | -          | NOSTATE     | private=10.0.0.14 |\n\nError log in nova-compute is attached below.\nIt tries to issue \"iscsiadm -m discovery -t sendtargets\" command only on 1 path and gives up with ProcessExecutionError.\n\n* Expected results:\nThe instance successfully boots using another iSCSI path.\nIt is desirable that users can use the cloud system normally, even while the administrators is resolving the path failure.\n\n\n* Nova-compute Log:\n\n2015-02-12 15:43:57.439 DEBUG oslo_concurrency.processutils [-] CMD \"sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m discovery -t sendtargets -p 192.168.1.2:3260\" returned: 4 in 95 pid=9253) execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:216\n2015-02-12 15:43:57.439 DEBUG oslo_concurrency.processutils [-] u'sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m discovery -t sendtargets -p 192.168.1.2:3260' failed. Not Retrying) execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:249\n2015-02-12 15:43:57.439 DEBUG oslo_concurrency.lockutils [-] Lock \"connect_volume\" released by \"connect_volume\" :: held 95.187s from (pid=9253) inner /usr/lib/python2.7/site-packages/oslo_lockutils.py:442\n2015-02-12 15:43:57.439 ERROR nova.compute.manager [-] [instance: 98796b31-8750-469d-87b1-537489b6749e] Instance failed to spawn\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Traceback (most recent call last):\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2318, in _build_resources\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     yield resources\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2188, in _build_and_run_instance\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     flavor=flavor)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2353, in spawn\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     flavor=flavor)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4165, in _get_guest_xml\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     context, flavor=flavor)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4028, in _get_guest_config\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     flavor, guest.os_type)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3213, in _get_guest_storage_c\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     self._connect_volume(connection_info, info)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 977, in _connect_volume\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     driver.connect_volume(connection_info, disk_info)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 431, in in\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     return f(*args, **kwargs)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 362, in connect_volume\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     out = self._run_iscsiadm_discover(iscsi_properties)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 498, in _run_iscsiadm_discove\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     check_exit_code=[0, 255])[0] or \"\"\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 768, in _run_iscsiadm_bare\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     check_exit_code=check_exit_code)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/utils.py\", line 197, in execute\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     return processutils.execute(*cmd, **kwargs)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     cmd=sanitized_cmd)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] ProcessExecutionError: Unexpected error while running command.\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m discovery -t sendtargets -p 192.168.1.2:3260\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Exit code: 4\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Stdout: u''\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Stderr: u'iscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm login retries (reopen_max) 5 exceeded\\niscsiadm: Could not perform SendTargets discovery: encountered connection failure\\n'\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]", 
    "tags": [
        "libvirt", 
        "volumes"
    ], 
    "importance": "Low", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1423412", 
    "owner": "None", 
    "id": 1423412, 
    "index": 274, 
    "created": "2015-02-19 01:44:27.765511+00:00", 
    "title": "Cannot boot instances from volumes in iSCSI multiple paths case", 
    "comments": [
        {
            "content": "* Precondition:\n- Nova: Add \"iscsi_use_multipath = True\" in [libvirt] section of nova.conf.\n- Cinder: use iSCSI storage backend that supports multi-path.\n  Nova-compute nodes and iSCSI ports of the storage array are connected to 2 LAN segments for mutli-pathing.\n- One of the iSCSI paths is not active (for example, the cable is bad).\n\n* How to reproduce:\nUsers create volume boot instance.\n  nova boot --flavor m1.heat --boot-volume 24abb70b-c0ef-46c8-b734-6bc230fff1a7 test\n\n* Actual results:\nThe instance fails to boot.\n  nova list\n  | 8df39f1b-d09d-42bf-8bf9-667c91a3ab34 | test  | ERROR  | -          | NOSTATE     | private=10.0.0.14 |\n\nError log in nova-compute is attached below.\nIt tries to issue \"iscsiadm -m discovery -t sendtargets\" command only on 1 path and gives up with ProcessExecutionError.\n\n* Expected results:\nThe instance successfully boots using another iSCSI path.\nIt is desirable that users can use the cloud system normally, even while the administrators is resolving the path failure.\n\n\n* Nova-compute Log:\n\n2015-02-12 15:43:57.439 DEBUG oslo_concurrency.processutils [-] CMD \"sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m discovery -t sendtargets -p 192.168.1.2:3260\" returned: 4 in 95 pid=9253) execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:216\n2015-02-12 15:43:57.439 DEBUG oslo_concurrency.processutils [-] u'sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m discovery -t sendtargets -p 192.168.1.2:3260' failed. Not Retrying) execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:249\n2015-02-12 15:43:57.439 DEBUG oslo_concurrency.lockutils [-] Lock \"connect_volume\" released by \"connect_volume\" :: held 95.187s from (pid=9253) inner /usr/lib/python2.7/site-packages/oslo_lockutils.py:442\n2015-02-12 15:43:57.439 ERROR nova.compute.manager [-] [instance: 98796b31-8750-469d-87b1-537489b6749e] Instance failed to spawn\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Traceback (most recent call last):\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2318, in _build_resources\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     yield resources\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2188, in _build_and_run_instance\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     flavor=flavor)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2353, in spawn\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     flavor=flavor)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4165, in _get_guest_xml\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     context, flavor=flavor)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4028, in _get_guest_config\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     flavor, guest.os_type)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3213, in _get_guest_storage_c\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     self._connect_volume(connection_info, info)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 977, in _connect_volume\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     driver.connect_volume(connection_info, disk_info)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 431, in in\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     return f(*args, **kwargs)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 362, in connect_volume\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     out = self._run_iscsiadm_discover(iscsi_properties)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 498, in _run_iscsiadm_discove\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     check_exit_code=[0, 255])[0] or \"\"\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 768, in _run_iscsiadm_bare\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     check_exit_code=check_exit_code)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/opt/stack/nova/nova/utils.py\", line 197, in execute\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     return processutils.execute(*cmd, **kwargs)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]     cmd=sanitized_cmd)\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] ProcessExecutionError: Unexpected error while running command.\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m discovery -t sendtargets -p 192.168.1.2:3260\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Exit code: 4\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Stdout: u''\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e] Stderr: u'iscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm: connect to 192.168.1.2 timed out\\niscsiadm login retries (reopen_max) 5 exceeded\\niscsiadm: Could not perform SendTargets discovery: encountered connection failure\\n'\n2015-02-12 15:43:57.439 TRACE nova.compute.manager [instance: 98796b31-8750-469d-87b1-537489b6749e]", 
            "date_created": "2015-02-19 01:44:27.765511+00:00", 
            "author": "https://api.launchpad.net/1.0/~seiji-aguchi"
        }, 
        {
            "content": "Hi Seiji, cloud you tell me which version openstack you use?", 
            "date_created": "2015-04-03 02:56:10.610842+00:00", 
            "author": "https://api.launchpad.net/1.0/~271025598-9"
        }, 
        {
            "content": "There are no open reviews for this bug report since a long time.\nTo signal that to other contributors which might provide patches for\nthis bug, I'm removing the assignee.\n\nFeel free to add yourself as assignee and push a review for it.", 
            "date_created": "2016-07-08 17:28:50.310667+00:00", 
            "author": "https://api.launchpad.net/1.0/~sujitha-neti"
        }
    ]
}