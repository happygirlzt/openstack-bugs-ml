{
    "status": "Fix Released", 
    "last_updated": "2016-03-03 16:18:38.127445+00:00", 
    "description": "Zookeeper driver is based on zookeeper and evzookeeper modules. The latter\nis the source of nasty crash, which is well visible on nova conductor. To\nreproduce it is enough to enable zookeeper in nova.conf, provide\nconfiguration for the zookeeper service address and stack the thing. The\ntraceback:\n\n2015-04-14 13:23:22.622 TRACE nova Traceback (most recent call last):\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/bin/nova-conductor\", line 10, in <module>\n2015-04-14 13:23:22.622 TRACE nova     sys.exit(main())\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/cmd/conductor.py\", line 44, in main\n2015-04-14 13:23:22.622 TRACE nova     manager=CONF.conductor.manager)\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 277, in create\n2015-04-14 13:23:22.622 TRACE nova     db_allowed=db_allowed)\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 146, in __init__\n2015-04-14 13:23:22.622 TRACE nova     self.servicegroup_api = servicegroup.API(db_allowed=db_allowed)\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/servicegroup/api.py\", line 76, in __init__\n2015-04-14 13:23:22.622 TRACE nova     *args, **kwargs)\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 38, in import_object\n2015-04-14 13:23:22.622 TRACE nova     return import_class(import_str)(*args, **kwargs)\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 27, in import_class\n2015-04-14 13:23:22.622 TRACE nova     __import__(mod_str)\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/servicegroup/drivers/zk.py\", line 28, in <module>\n2015-04-14 13:23:22.622 TRACE nova     evzookeeper = importutils.try_import('evzookeeper')\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 71, in try_import\n2015-04-14 13:23:22.622 TRACE nova     return import_module(import_str)\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 57, in import_module\n2015-04-14 13:23:22.622 TRACE nova     __import__(import_str)\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/evzookeeper/__init__.py\", line 26, in <module>\n2015-04-14 13:23:22.622 TRACE nova     from evzookeeper import utils\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/evzookeeper/utils.py\", line 26, in <module>\n2015-04-14 13:23:22.622 TRACE nova     class _SocketDuckForFdTimeout(greenio._SocketDuckForFd):\n2015-04-14 13:23:22.622 TRACE nova AttributeError: 'module' object has no attribute '_SocketDuckForFd'\n\nThe root cause of the problem is the change, which have a place in module\neventlet 0.17, which evzookeeper module is depend on. Because of the change the way eventlet.greenio is exposed there is no way to reach the class\n_SocketDuckForFd other way than explicitly importing it via\neventlet.greenio.py2 module.\n\nDefinitely solution for this problem might go upstream to the evzookeeper\nauthor, however the development of evzookeeper module seems stalled (no\nactivity for last 2 years), maybe it's worth to consider changing the zk\ndriver implementation to use different zk module (kazoo seems quite active).\n\nDowngrading eventlet was no option for me, since keystone requires version\n>=0.17.", 
    "tags": [], 
    "importance": "Low", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1443910", 
    "owner": "https://api.launchpad.net/1.0/~sdague", 
    "id": 1443910, 
    "index": 418, 
    "created": "2015-04-14 11:57:47.643379+00:00", 
    "title": "Zookeeper servicegroup driver crashes", 
    "comments": [
        {
            "content": "Zookeeper driver is based on zookeeper and evzookeeper modules. The latter is\nthe source of nasty crash, which is well visible on nova conductor. To reproduce\nit is enough to enable zookeeper in nova.conf, provide configuration for the\nzookeeper service address and stack the thing. The traceback:\n\n2015-04-14 13:23:22.622 TRACE nova Traceback (most recent call last):\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/bin/nova-conductor\", line 10, in <module>\n2015-04-14 13:23:22.622 TRACE nova     sys.exit(main())\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/cmd/conductor.py\", line 44, in main\n2015-04-14 13:23:22.622 TRACE nova     manager=CONF.conductor.manager)\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 277, in create\n2015-04-14 13:23:22.622 TRACE nova     db_allowed=db_allowed)\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 146, in __init__\n2015-04-14 13:23:22.622 TRACE nova     self.servicegroup_api = servicegroup.API(db_allowed=db_allowed)\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/servicegroup/api.py\", line 76, in __init__\n2015-04-14 13:23:22.622 TRACE nova     *args, **kwargs)\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 38, in import_object\n2015-04-14 13:23:22.622 TRACE nova     return import_class(import_str)(*args, **kwargs)\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 27, in import_class\n2015-04-14 13:23:22.622 TRACE nova     __import__(mod_str)\n2015-04-14 13:23:22.622 TRACE nova   File \"/opt/stack/nova/nova/servicegroup/drivers/zk.py\", line 28, in <module>\n2015-04-14 13:23:22.622 TRACE nova     evzookeeper = importutils.try_import('evzookeeper')\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 71, in try_import\n2015-04-14 13:23:22.622 TRACE nova     return import_module(import_str)\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/importutils.py\", line 57, in import_module\n2015-04-14 13:23:22.622 TRACE nova     __import__(import_str)\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/evzookeeper/__init__.py\", line 26, in <module>\n2015-04-14 13:23:22.622 TRACE nova     from evzookeeper import utils\n2015-04-14 13:23:22.622 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/evzookeeper/utils.py\", line 26, in <module>\n2015-04-14 13:23:22.622 TRACE nova     class _SocketDuckForFdTimeout(greenio._SocketDuckForFd):\n2015-04-14 13:23:22.622 TRACE nova AttributeError: 'module' object has no attribute '_SocketDuckForFd'\n\nThe root cause of the problem is the change, which have a place in module\neventlet 0.17, which evzookeeper module is depend on. Because of the change the\nway eventlet.greenio is exposed there is no way to reach the class\n_SocketDuckForFd other way than explicitly importing it via\neventlet.greenio.py2 module.\n\nDefinitely solution for this problem might go upstream to the evzookeeper\nauthor, however the development of evzookeeper module seems stalled (no\nactivity for last 2 years), maybe it's worth to consider changing the zk driver\nimplementation to use different zk module (kazoo seems quite active).", 
            "date_created": "2015-04-14 11:57:47.643379+00:00", 
            "author": "https://api.launchpad.net/1.0/~roman-dobosz"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/246343", 
            "date_created": "2015-11-17 11:43:55.198431+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/246343\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=337a1b029a1f144f577a78712413a4182dd525f8\nSubmitter: Jenkins\nBranch:    master\n\ncommit 337a1b029a1f144f577a78712413a4182dd525f8\nAuthor: Mark McLoughlin <email address hidden>\nDate:   Tue Nov 17 10:17:44 2015 +0000\n\n    servicegroup: remove the zookeeper driver\n    \n    We have had a \"untested and risky to use in production\" log warning\n    message for this driver since Kilo, it is currently broken (see below),\n    there are no obviously active users or contributors, and we are planning\n    on enabling Zookeeper usage by adopting the tooz library.\n    \n    bug #1443910 shows that the driver fails to load because eventlet 0.17\n    broke evzookeeper by moving _SocketDuckForFd from eventlet.greenio to\n    eventlet.greenio.py2 in commit 449c90a. The 0.17 release was in Feb,\n    2015. The evzookeeper library hasn't been updated since Sep 2012 and the\n    sole maintainer is the original author of the zookeeper servicegroup\n    driver.\n    \n    The tooz driver spec - Ibf70c2dbe308fc8e4dd277d8c75c4445b3dfce90 -\n    proposes a formal deprecation period for the zk driver, during which\n    existing zk driver users are encouraged to move to tooz. However, given\n    the state of the zk driver, we must conclude that there are no existing\n    users who need a graceful migration path. Removing the driver will\n    avoid potential confusion for new users and simplify the path to\n    adopting tooz.\n    \n    Closes-Bug: #1443910\n    Closes-Bug: #1414517\n    Closes-Bug: #1414536\n    \n    Signed-off-by: Mark McLoughlin <email address hidden>\n    Change-Id: I2dba71e71b1ed7cf8476e8bfe9481e84be5df128\n", 
            "date_created": "2016-02-22 13:12:28.702472+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.0.0.0b3 development milestone.", 
            "date_created": "2016-03-03 16:18:37.541887+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }
    ]
}