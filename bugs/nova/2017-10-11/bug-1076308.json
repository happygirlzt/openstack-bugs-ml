{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 10:58:43.721575+00:00", 
    "description": "Running nova  --no-cache live-migration --block-migrate myvm myhost returns:\n\nERROR: Live migration of instance <uuid> to host myhost failed (HTTP 400) (Request-ID: req-<uuid>)\n\nThere's a stacktrace in the nova-compute.log on the target host:\n\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\n  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 117, in wrapped\n    temp_level, payload)\n  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 92, in wrapped\n    return f(*args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2076, in check_can_live_migrate_destination\n    instance, block_migration, disk_over_commit)\n  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2238, in check_can_live_migrate_destination\n    self._compare_cpu(source_cpu_info)\n  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2366, in _compare_cpu\n    LOG.error(reason=m % locals())\nTypeError: error() takes at least 2 arguments (1 given)\n\nLOG.error doesnt take reason, simply removing the reason= bubbles up the correct exception:\n\nInvalidCPUInfo: Unacceptable CPU info: CPU doesn't have compatibility.", 
    "tags": [
        "low-hanging-fruit", 
        "verification-needed"
    ], 
    "importance": "Medium", 
    "heat": 40, 
    "link": "https://bugs.launchpad.net/nova/+bug/1076308", 
    "owner": "https://api.launchpad.net/1.0/~dazworrall", 
    "id": 1076308, 
    "index": 3136, 
    "created": "2012-11-08 10:35:06.284487+00:00", 
    "title": "Logging CPU incompatibility when attempting live migration fails", 
    "comments": [
        {
            "content": "Running nova  --no-cache live-migration --block-migrate myvm myhost returns:\n\nERROR: Live migration of instance <uuid> to host myhost failed (HTTP 400) (Request-ID: req-<uuid>)\n\nThere's a stacktrace in the nova-compute.log on the target host:\n\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\n  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 117, in wrapped\n    temp_level, payload)\n  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 92, in wrapped\n    return f(*args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2076, in check_can_live_migrate_destination\n    instance, block_migration, disk_over_commit)\n  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2238, in check_can_live_migrate_destination\n    self._compare_cpu(source_cpu_info)\n  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2366, in _compare_cpu\n    LOG.error(reason=m % locals())\nTypeError: error() takes at least 2 arguments (1 given)\n\nLOG.error doesnt take reason, simply removing the reason= bubbles up the correct exception:\n\nInvalidCPUInfo: Unacceptable CPU info: CPU doesn't have compatibility.", 
            "date_created": "2012-11-08 10:35:06.284487+00:00", 
            "author": "https://api.launchpad.net/1.0/~dazworrall"
        }, 
        {
            "content": "nova-compute:\n  Installed: 2012.2-0ubuntu5~cloud0\n  Candidate: 2012.2-0ubuntu5~cloud0\n  Version table:\n *** 2012.2-0ubuntu5~cloud0 0\n        500 http://ubuntu-cloud.archive.canonical.com/ubuntu/ precise-updates/folsom/main amd64 Packages\n        100 /var/lib/dpkg/status\n     2012.1.3+stable-20120827-4d2a4afe-0ubuntu1 0\n        500 http://gb.archive.ubuntu.com/ubuntu/ precise-updates/main amd64 Packages\n     2012.1+stable~20120612-3ee026e-0ubuntu1.3 0\n        500 http://security.ubuntu.com/ubuntu/ precise-security/main amd64 Packages\n     2012.1-0ubuntu2 0\n        500 http://gb.archive.ubuntu.com/ubuntu/ precise/main amd64 Packages", 
            "date_created": "2012-11-08 10:38:14.320551+00:00", 
            "author": "https://api.launchpad.net/1.0/~dazworrall"
        }, 
        {
            "content": "Tiny pull request: https://github.com/openstack/nova/pull/17", 
            "date_created": "2012-11-08 10:39:17.619484+00:00", 
            "author": "https://api.launchpad.net/1.0/~dazworrall"
        }, 
        {
            "content": "Darren,\n\nPlease use the workflow here - http://wiki.openstack.org/GerritWorkflow to submit changes.\n\nthanks,\ndims", 
            "date_created": "2012-11-08 14:02:39.453148+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/15741", 
            "date_created": "2012-11-09 16:31:46.061944+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/15741\nCommitted: http://github.com/openstack/nova/commit/c63880cc78ab5e0d88457cf4cac20d3d55421ba0\nSubmitter: Jenkins\nBranch:    master\n\ncommit c63880cc78ab5e0d88457cf4cac20d3d55421ba0\nAuthor: Darren Worrall <email address hidden>\nDate:   Thu Nov 8 10:36:22 2012 +0000\n\n    Fix incorrect LOG.error usage in _compare_cpu\n    \n    bug 1076308\n    \n    Change-Id: I30a6447f005e708107dc01578664a4cb2bb14439\n", 
            "date_created": "2012-11-11 07:19:23.004190+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/folsom\nReview: https://review.openstack.org/16046", 
            "date_created": "2012-11-14 05:24:50.076005+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/16046\nCommitted: http://github.com/openstack/nova/commit/92eddd2d471269835ade19412a28539fa9246bfc\nSubmitter: Jenkins\nBranch:    stable/folsom\n\ncommit 92eddd2d471269835ade19412a28539fa9246bfc\nAuthor: Darren Worrall <email address hidden>\nDate:   Thu Nov 8 10:36:22 2012 +0000\n\n    Fix incorrect LOG.error usage in _compare_cpu\n    \n    bug 1076308\n    \n    Change-Id: I30a6447f005e708107dc01578664a4cb2bb14439\n", 
            "date_created": "2012-11-14 17:01:36.226158+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "So, what is the solution to \"InvalidCPUInfo: Unacceptable CPU info: CPU doesn't have compatibility.\", then? I am aware that I am migrating between Intel and AMD machines, but isn't there a way to make this work?", 
            "date_created": "2012-12-12 16:18:59.938224+00:00", 
            "author": "https://api.launchpad.net/1.0/~kermit666"
        }, 
        {
            "content": "I find when do the migration,nova detect that two host have different CPU\nflags(cat /proc/cpuinfo),and it will rise \"InvalidCPUInfo: Unacceptable CPU\ninfo: CPU doesn't have compatibility\"\nIf you want to solve this problem, better to choose hosts within same CPU\nor try to change the code in this section.\n\n2012/12/13 Dra\u017een Lu\u010danin <email address hidden>\n\n> So, what is the solution to \"InvalidCPUInfo: Unacceptable CPU info: CPU\n> doesn't have compatibility.\", then? I am aware that I am migrating\n> between Intel and AMD machines, but isn't there a way to make this work?\n>\n> --\n> You received this bug notification because you are subscribed to the bug\n> report.\n> https://bugs.launchpad.net/bugs/1076308\n>\n> Title:\n>   Logging CPU incompatibility when attempting live migration fails\n>\n> Status in OpenStack Compute (Nova):\n>   Fix Released\n> Status in OpenStack Compute (nova) folsom series:\n>   Fix Released\n> Status in \u201cnova\u201d package in Ubuntu:\n>   Fix Released\n> Status in \u201cnova\u201d source package in Quantal:\n>   Confirmed\n>\n> Bug description:\n>   Running nova  --no-cache live-migration --block-migrate myvm myhost\n>   returns:\n>\n>   ERROR: Live migration of instance <uuid> to host myhost failed (HTTP\n>   400) (Request-ID: req-<uuid>)\n>\n>   There's a stacktrace in the nova-compute.log on the target host:\n>\n>   Traceback (most recent call last):\n>     File\n> \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line\n> 275, in _process_data\n>       rval = self.proxy.dispatch(ctxt, version, method, **args)\n>     File\n> \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\",\n> line 145, in dispatch\n>       return getattr(proxyobj, method)(ctxt, **kwargs)\n>     File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 117,\n> in wrapped\n>       temp_level, payload)\n>     File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n>       self.gen.next()\n>     File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 92, in\n> wrapped\n>       return f(*args, **kw)\n>     File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line\n> 2076, in check_can_live_migrate_destination\n>       instance, block_migration, disk_over_commit)\n>     File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\",\n> line 2238, in check_can_live_migrate_destination\n>       self._compare_cpu(source_cpu_info)\n>     File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\",\n> line 2366, in _compare_cpu\n>       LOG.error(reason=m % locals())\n>   TypeError: error() takes at least 2 arguments (1 given)\n>\n>   LOG.error doesnt take reason, simply removing the reason= bubbles up\n>   the correct exception:\n>\n>   InvalidCPUInfo: Unacceptable CPU info: CPU doesn't have compatibility.\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/1076308/+subscriptions\n>\n", 
            "date_created": "2012-12-14 01:53:00+00:00", 
            "author": "https://api.launchpad.net/1.0/~breeze7086"
        }, 
        {
            "content": "Hello Darren, or anyone else affected,\n\nAccepted nova into quantal-proposed. The package will build now and be available at http://launchpad.net/ubuntu/+source/nova/2012.2.1+stable-20121212-a99a802e-0ubuntu1 in a few hours, and then in the -proposed repository.\n\nPlease help us by testing this new package.  See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed.  Your feedback will aid us getting this update out to other Ubuntu users.\n\nIf this package fixes the bug for you, please add a comment to this bug, mentioning the version of the package you tested, and change the tag from verification-needed to verification-done. If it does not fix the bug for you, please add a comment stating that, and change the tag to verification-failed.  In either case, details of your testing will help us make a better decision.\n\nFurther information regarding the verification process can be found at https://wiki.ubuntu.com/QATeam/PerformingSRUVerification .  Thank you in advance!", 
            "date_created": "2012-12-28 16:41:32.745360+00:00", 
            "author": "https://api.launchpad.net/1.0/~clint-fewbar"
        }, 
        {
            "content": "This bug was fixed in the package nova - 2012.2.1+stable-20121212-a99a802e-0ubuntu1\n\n---------------\nnova (2012.2.1+stable-20121212-a99a802e-0ubuntu1) quantal-proposed; urgency=low\n\n  * Ubuntu updates:\n    - debian/control: Ensure novaclient is upgraded with nova,\n      require python-keystoneclient >= 1:2.9.0. (LP: #1073289)\n    - d/p/avoid_setuptools_git_dependency.patch: Refresh.\n  * Dropped patches, applied upstream:\n    - debian/patches/CVE-2012-5625.patch: [a99a802]\n  * Resynchronize with stable/folsom (b55014ca) (LP: #1085255):\n    - [a99a802] create_lvm_image allocates dirty blocks (LP: #1070539)\n    - [670b388] RPC exchange name defaults to 'openstack' (LP: #1083944)\n    - [3ede373] disassociate_floating_ip with multi_host=True fails\n      (LP: #1074437)\n    - [22d7c3b] libvirt imagecache should handle shared image storage\n      (LP: #1075018)\n    - [e787786] Detached and deleted RBD volumes remain associated with insance\n      (LP: #1083818)\n    - [9265eb0] live_migration missing migrate_data parameter in Hyper-V driver\n      (LP: #1066513)\n    - [3d99848] use_single_default_gateway does not function correctly\n      (LP: #1075859)\n    - [65a2d0a] resize does not migrate DHCP host information (LP: #1065440)\n    - [102c76b] Nova backup image fails (LP: #1065053)\n    - [48a3521] Fix config-file overrides for nova-dhcpbridge\n    - [69663ee] Cloudpipe in Folsom: no such option: cnt_vpn_clients\n      (LP: #1069573)\n    - [6e47cc8] DisassociateAddress can cause Internal Server Error\n      (LP: #1080406)\n    - [22c3d7b] API calls to dis-associate an auto-assigned floating IP should\n      return proper warning (LP: #1061499)\n    - [bd11d15] libvirt: if exception raised during volume_detach, volume state\n      is inconsistent (LP: #1057756)\n    - [dcb59c3] admin can't describe all images in ec2 api (LP: #1070138)\n    - [78de622] Incorrect Exception raised during Create server when metadata\n      over 255 characters  (LP: #1004007)\n    - [c313de4] Fixed IP isn't released before updating DHCP host file\n      (LP: #1078718)\n    - [f4ab42d] Enabling Return Reservation ID with XML create server request\n      returns no body  (LP: #1061124)\n    - [3db2a38] 'BackupCreate' should accept rotation parameter greater than or\n      equal to zero (LP: #1071168)\n    - [f7e5dde] libvirt reboot sometimes fails to reattach volumes\n      (LP: #1073720)\n    - [ff776d4] libvirt: detaching volume may fail while terminating other\n      instances on the same host concurrently (LP: #1060836)\n    - [85a8bc2] Used instance uuid rather than id in remove-fixed-ip\n    - [42a85c0] Fix error on invalid delete_on_termination value\n    - [6a17579] xenapi migrations fail w/ swap (LP: #1064083)\n    - [97649b8] attach-time field for volumes is not updated for detach volume\n      (LP: #1056122)\n    - [8f6a718] libvirt: rebuild is not using kernel and ramdisk associated with\n      the new image (LP: #1060925)\n    - [fbe835f] live-migration and volume host assignement (LP: #1066887)\n    - [c2a9150] typo prevents volume_tmp_dir flag from working (LP: #1071536)\n    - [93efa21] Instances deleted during spawn leak network allocations\n      (LP: #1068716)\n    - [ebabd02] After restarting an instance volume is lost (LP: #1071069)\n    - [a369303] xen volume auto device selection always picks xvdb\n      (LP: #1061944)\n    - [8d1095c] Calls to to_xml() to generate XML for a soft deleted flavor fail\n      (LP: #1073736)\n    - [1857821] nova-manage doesn't validate the key value supplied to update\n      the quota (LP: #1064359)\n    - [6ae32f0] Compute manager doesn't update 'host' field when it tries to run\n      a VM (LP: #1073600)\n    - [284f6ea] Host field set too early during builds (LP: #1060255)\n    - [395511f] finish_resize failures result in NoneType exception\n      (LP: #1071595)\n    - [85ccf80] confirm_resize mgr call requires admin context (LP: #1071600)\n    - [2dceffa] Only return the last N lines of the console log (LP: #1081436)\n    - [9c7a711] console auth does not work with memcache, unicode error\n      (LP: #1057279)\n    - [b27f7ef] disk path not exists when using LXC with libvirt_images_type=lvm\n      (LP: #1079113)\n    - [1351c6b] nova-api now requires quantumclient (LP: #1070509)\n    - [612f404] nova-api now requires quantumclient (LP: #1070509)\n    - [7e8a166] nova-compute (folsom) fails to start, compute_driver is None\n      (LP: #1081836)\n    - [182ca80] Nova API does not work with QuantumV2 API subclasses\n      (LP: #1070045)\n    - [55d1412] 413 error code doesn't always provide Retry-After (LP: #1079387)\n    - [1581505] Snapshotting LXC instance fails (LP: #1058273)\n    - [197398f] Stop network.api import on network import\n    - [b874d21] Scheduler Race Condition at high volume (LP: #1073956)\n    - [3316e1f] Nic Ordering not guaranteed with Quantum API (LP: #1064524)\n    - [ab7e37e] Stable oslo (aka common) update\n    - [3f7788c] update nova to report quantum floating IPs (LP: #1023169)\n    - [d3fd05b] metadata service throws 500 - NoSuchOptError (LP: #1063851)\n    - [97542c9] libvirt imagecache still runs even if disabled (LP: #1075017)\n    - [b31f528] OS API: XML Namespace Handling Broken (LP: #887191)\n    - [76b44d9] nova-api crashes if it is run with nobody account.\n      (LP: #1073858)\n    - [d59f6ad] nova-compute will assign the same device name if volume-attach\n      continuously  (LP: #1062033)\n    - [8e11181] Nova does not delete the LV on LVM backed VMs (LP: #1078085)\n    - [9bf2c6a] Fixed instance deletion issue from Nova API.\n    - [c0e1247] forget to release resource when terminate an instance from a\n      failed compute node (LP: #1067214)\n    - [49397a4] ensure_default_security_group() does not call sgh (LP: #1050982)\n    - [47ff8a5] trigger_instance[add/remove]_security_group_refresh are never\n      called (LP: #1057069)\n    - [c9cade2] Resource reservation isn't rolled back properly for certain\n      failures during Instance Create (LP: #1065092)\n    - [34c3845] Resource tracker uses regex DB query too often (LP: #1060363)\n    - [92eddd2] Logging CPU incompatibility when attempting live migration fails\n      (LP: #1076308)\n    - [8b4896b] hostname in metadata ends with . if dhcp_domain flag is empty\n      (LP: #1064713)\n    - [ded0473] deletes fail when instance in RESIZED (LP: #1056601)\n    - [d015be5] libvirt: cannot detach volume from stopped domain (LP: #1057730)\n    - [d5888f1] Resizing a Xen instance with attached volumes fails\n      (LP: #1028092)\n    - [fb88827] resize leave leftover libvirt configs (LP: #1015731)\n    - [5ccd691] nova-network cannot re-generate MAC address if collision happen\n      (LP: #1059366)\n    - [e3d7f8c] After folsom upgrade, instances can no longer access existing\n      volumes. (LP: #1065702)\n    - [804f858] Jenkins jobs fail because of incompatibility between sqlalchemy-\n      migrate and the newest sqlalchemy-0.8.0b1 (LP: #1073569)\n    - [f67a5f9] block device mappings for deleted instances are leaked\n      (LP: #1069099)\n    - [32d8722] volume and snapshot IDs do not correctly map to UUIDs after\n      folsom upgrade (LP: #1065785)\n    - [9613643] Xenserver cannot boot vm_mode=xen type images (LP: #1055431)\n    - [863c767] Cloudpipe extension xml serialization doesn't return the\n      instance(s) data (LP: #1056242)\n    - [724adcf] deleting security group does not mark rules as deleted\n      (LP: #1056380)\n    - [84a996c] IP Protocol for security group should be returned in lower case\n      to be compliant with the ec2 api (LP: #1057196)\n    - [e1ed06a] db tests fail with sqlalchemy 0.7.4 (LP: #1057145)\n    - [bddb06d] Fail to boot raw image on XenServer (LP: #1055413)\n    - [d4d1665] Add SIGPIPE handler to subprocess execution in rootwrap and\n      utils.execute (LP: #1053364)\n    - [0af4dd0] libvirt: concurrent detach_volume and terminate fails\n      (LP: #1057719)\n    - [ebbfa9e] Instances in vm state DELETED are preventing compute restart\n      (LP: #1053441)\n    - [db516a2] ComputeManager does not provide block_device_info on destroy\n      call in revert_resize (LP: #1056285)\n    - [4223ebf] Set defaultbranch in .gitreview to stable/folsom\n    - [eee4dbb] do_refresh_security_group_rules in nova.virt.firewall is very\n      slow (LP: #1062314)\n    - [b7e509a] Set read_deleted='yes' for instance_id_mappings.\n    - [9e20735] Tests fail on 32bit machines (_get_hash_str is platform\n      dependent) (LP: #1050359)\n -- Adam Gandelman <email address hidden>   Wed, 12 Dec 2012 16:27:51 -0400", 
            "date_created": "2013-01-29 13:10:46.783756+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}