{
    "status": "Fix Released", 
    "last_updated": "2015-12-03 21:33:02.074081+00:00", 
    "description": "I was using the image trend-tinyvm1-flat.vmdk. When I boot an VM and attach a volume to it. The following error message was shown:\n\n================================n-cpu==================================\n\n2013-09-17 06:47:05.669 ERROR nova.openstack.common.rpc.amqp [req-fc4e0a9e-6bd5-45ac-b841-c89e17394603 admin demo] Exception during me\nssage handling\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in \n_process_data\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 17\n2, in dispatch\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 243, in decorated_\nfunction\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     pass\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 229, in decorated_function\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_function\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 258, in decorated_function\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3577, in attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     context, instance, mountpoint)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3572, in attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     mountpoint, instance)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3614, in _attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     connector)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3604, in _attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     mountpoint)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 290, in attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     mountpoint)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 272, in attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     self._attach_volume_vmdk(connection_info, instance, mountpoint)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 222, in _attach_volume_vmdk\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     unit_number=unit_number)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 71, in attach_disk_to_vm\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     self._session._wait_for_task(instance_uuid, reconfig_task)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 779, in _wait_for_task\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     ret_val = done.wait()\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return hubs.get_hub().switch()\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return self.greenlet.switch()\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp NovaException: The attempted operation cannot be performed in the current state (Powered on).\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [
        "drivers", 
        "vmware"
    ], 
    "importance": "High", 
    "heat": 36, 
    "link": "https://bugs.launchpad.net/nova/+bug/1226543", 
    "owner": "https://api.launchpad.net/1.0/~thang-pham", 
    "id": 1226543, 
    "index": 1233, 
    "created": "2013-09-17 10:56:27.004958+00:00", 
    "title": "VMware: attaching a volume to the VM failed", 
    "comments": [
        {
            "content": "I was using the image trend-tinyvm1-flat.vmdk. When I boot an VM and attach a volume to it. The following error message was shown:\n\n================================n-cpu==================================\n\n2013-09-17 06:47:05.669 ERROR nova.openstack.common.rpc.amqp [req-fc4e0a9e-6bd5-45ac-b841-c89e17394603 admin demo] Exception during me\nssage handling\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in \n_process_data\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 17\n2, in dispatch\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 243, in decorated_\nfunction\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     pass\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 229, in decorated_function\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_function\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 258, in decorated_function\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3577, in attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     context, instance, mountpoint)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3572, in attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     mountpoint, instance)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3614, in _attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     connector)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3604, in _attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     mountpoint)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 290, in attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     mountpoint)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 272, in attach_volume\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     self._attach_volume_vmdk(connection_info, instance, mountpoint)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 222, in _attach_volume_vmdk\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     unit_number=unit_number)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 71, in attach_disk_to_vm\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     self._session._wait_for_task(instance_uuid, reconfig_task)\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 779, in _wait_for_task\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     ret_val = done.wait()\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return hubs.get_hub().switch()\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp     return self.greenlet.switch()\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp NovaException: The attempted operation cannot be performed in the current state (Powered on).\n2013-09-17 06:47:05.669 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2013-09-17 10:56:27.004958+00:00", 
            "author": "https://api.launchpad.net/1.0/~houshengbo"
        }, 
        {
            "content": "Hi,\nCan you please try this again. The vmware cinder support was approved on Sept 5th.\nIn addition to this can you please indicate which cinder backend you used.\nThanks\nGary", 
            "date_created": "2013-09-19 15:59:55.242593+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "Hi Gary,\r\nI tried today. There is still errors when I attach the volume to the VM.\r\n\r\n============================n-cpu=========================\r\n\r\n2013-10-11 06:15:48.317 ERROR nova.openstack.common.rpc.amqp [req-1652a9a6-a236-49b0-8e83-063612b1f5a0 admin demo] Exception during me\r\nssage handling\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in \r\n_process_data\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     **args)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 17\r\n2, in dispatch\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     payload)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 243, in decorated_\r\nfunction\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     pass\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 229, in decorated_\r\nfunction\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_\r\nfunction\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 258, in decorated_\r\nfunction\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3640, in attach_vo\r\nlume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     context, instance, mountpoint)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3635, in attach_vo\r\nlume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     mountpoint, instance)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3681, in _attach_v\r\nolume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     connector)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3671, in _attach_v\r\nolume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     encryption=encryption)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 295, in atta\r\nch_volume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     mountpoint)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 277, in a\r\nttach_volume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     self._attach_volume_vmdk(connection_info, instance, mountpoint)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 227, in _attach_volume_vmdk\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     unit_number=unit_number)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 71, in attach_disk_to_vm\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     self._session._wait_for_task(instance_uuid, reconfig_task)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 900, in _wait_for_task\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     ret_val = done.wait()\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     return hubs.get_hub().switch()\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp     return self.greenlet.switch()\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp NovaException: The attempted operation cannot be performed in the current state (Powered on).\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp \r\n2013-10-11 06:15:50.683 WARNING nova.virt.vmwareapi.driver [-] \u4efb\u52a1 [ReconfigVM_Task] (returnval){\r\n   value = \"haTask-5-vim.VirtualMachine.reconfigure-364178225\"\r\n   _type = \"Task\"\r\n } \u72b6\u6001\uff1a\u9519\u8bef The attempted operation cannot be performed in the current state (Suspended).\r\n2013-10-11 06:15:50.686 WARNING nova.virt.vmwareapi.driver [-] \u5728vmwareapi\uff1a_poll_task\uff0c\u5f97\u5230\u8fd9\u4e2a\u9519\u8bef Trying to re-send() an already-triggered event.\r\n2013-10-11 06:15:50.686 ERROR nova.openstack.common.loopingcall [-] in fixed duration looping call\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall Traceback (most recent call last):\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/openstack/common/loopingcall.py\", line 78, in _inner\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall     self.f(*self.args, **self.kw)\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 929, in _poll_task\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall     done.send_exception(excep)\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 208, in send_exception\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall     return self.send(None, args)\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 150, in send\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall     assert self._result is NOT_USED, 'Trying to re-send() an already-triggered event.'\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall AssertionError: Trying to re-send() an already-triggered event.\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall", 
            "date_created": "2013-10-11 10:21:21.532206+00:00", 
            "author": "https://api.launchpad.net/1.0/~houshengbo"
        }, 
        {
            "content": "Hi Gary,\r\nI tried it today. There is still errors when I attach the volume to the VM. The image I use is trend-tinyvm1-flat.vmdk.\r\n============================n-cpu=========================\r\n2013-10-11 06:15:48.317 ERROR nova.openstack.common.rpc.amqp [req-1652a9a6-a236-49b0-8e83-063612b1f5a0 admin demo] Exception during me\r\nssage handling\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in\r\n_process_data\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp **args)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 17\r\n2, in dispatch\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp result = getattr(proxyobj, method)(ctxt, **kwargs)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp payload)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp return f(self, context, *args, **kw)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/compute/manager.py\", line 243, in decorated_\r\nfunction\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp pass\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/compute/manager.py\", line 229, in decorated_\r\nfunction\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp return function(self, context, *args, **kwargs)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_\r\nfunction\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp e, sys.exc_info())\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/compute/manager.py\", line 258, in decorated_\r\nfunction\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp return function(self, context, *args, **kwargs)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/compute/manager.py\", line 3640, in attach_vo\r\nlume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp context, instance, mountpoint)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/compute/manager.py\", line 3635, in attach_vo\r\nlume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp mountpoint, instance)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/compute/manager.py\", line 3681, in _attach_v\r\nolume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp connector)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/compute/manager.py\", line 3671, in _attach_v\r\nolume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp encryption=encryption)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 295, in atta\r\nch_volume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp mountpoint)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 277, in a\r\nttach_volume\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp self._attach_volume_vmdk(connection_info, instance, mountpoint)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 227, in _attach_volume_vmdk\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp unit_number=unit_number)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 71, in attach_disk_to_vm\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp self._session._wait_for_task(instance_uuid, reconfig_task)\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 900, in _wait_for_task\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp ret_val = done.wait()\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp return hubs.get_hub().switch()\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp return self.greenlet.switch()\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp NovaException: The attempted operation cannot be performed in the current state (Powered on).\r\n2013-10-11 06:15:48.317 TRACE nova.openstack.common.rpc.amqp\r\n2013-10-11 06:15:50.683 WARNING nova.virt.vmwareapi.driver [-] \u4efb\u52a1 [ReconfigVM_Task] (returnval){\r\n   value = \"haTask-5-vim.VirtualMachine.reconfigure-364178225\"\r\n   _type = \"Task\"\r\n } \u72b6\u6001\uff1a\u9519\u8bef The attempted operation cannot be performed in the current state (Powered on).\r\n2013-10-11 06:15:50.686 WARNING nova.virt.vmwareapi.driver [-] \u5728vmwareapi\uff1a_poll_task\uff0c\u5f97\u5230\u8fd9\u4e2a\u9519\u8bef Trying to re-send() an already-triggered event.\r\n2013-10-11 06:15:50.686 ERROR nova.openstack.common.loopingcall [-] in fixed duration looping call\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall Traceback (most recent call last):\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall File \"/opt/stack/nova/nova/openstack/common/loopingcall.py\", line 78, in _inner\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall self.f(*self.args, **self.kw)\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 929, in _poll_task\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall done.send_exception(excep)\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 208, in send_exception\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall return self.send(None, args)\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 150, in send\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall assert self._result is NOT_USED, 'Trying to re-send() an already-triggered event.'\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall AssertionError: Trying to re-send() an already-triggered event.\r\n2013-10-11 06:15:50.686 TRACE nova.openstack.common.loopingcall\r\n", 
            "date_created": "2013-10-11 10:24:10.873069+00:00", 
            "author": "https://api.launchpad.net/1.0/~houshengbo"
        }, 
        {
            "content": "Hi Vincent,\n\nCan you give some more details on you setup:\n1. Have you configured with ESX/VC?\n2. Which version of VMware server are you using.\n\nCan you try powering off the instance and then perform a volume attach.\n\nP.S: You could try searching for \"The attempted operation cannot be performed in the current state (Powered on)\" in http://kb.vmware.com/ if it helps.", 
            "date_created": "2013-10-11 15:22:48.425800+00:00", 
            "author": "https://api.launchpad.net/1.0/~kartikaditya"
        }, 
        {
            "content": "The problem seems to arise from the fact that a sparse disk type is used. We are investigating", 
            "date_created": "2013-10-24 12:35:32.552709+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "The issue is when the instance uses an IDE controller.\n\nIDE controller does not support hot adding of a virtual disk http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1025883\n\nHowever if an IDE controller is not being used for the primary disk of the virtual machine then the issue must not arise.\n\nOne possible fix would be to use a SCSI controller (one of http://pubs.vmware.com/vsphere-51/index.jsp?topic=%2Fcom.vmware.wssdk.apiref.doc%2Fvim.vm.device.VirtualSCSIController.html) for volume's disk irrespective of primary disk's controller.", 
            "date_created": "2013-10-24 13:15:57.320112+00:00", 
            "author": "https://api.launchpad.net/1.0/~kartikaditya"
        }, 
        {
            "content": "These are configuration options:\nvCenter: 5.5\nvSphere  web service SDK 5.5\nImage:\n# wget  http://partnerweb.vmware.com/programs/vmdkimage/trend-tinyvm1-flat.vmdk\n# glance image-create --name trend-thin --is-public=True --container-format=bare --disk-format=vmdk --property vmware_disktype=\"thin\" --property vmware_adaptertype=\"ide\" < trend-tinyvm1-flat.vmdk\n\n\nwe get the error \"2013-11-18 21:31:11.859 18737 TRACE nova.openstack.common.rpc.amqp NovaException: The attempted operation cannot be performed in the current state (Powered on).\"\n\nThe root cause  is that some disks are not hot-addable,  same we met in bug [1]\n\nThe possible fix is  stop instance before  attach/detach volume. Note this will  affect user's normal workload. like we did for bug [1], or mark this won't fix and suggest user to use SCSI controller in comment #6\n\n [1]  https://bugs.launchpad.net/nova/+bug/1247556\n", 
            "date_created": "2013-11-20 06:42:10.916205+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "This  depends   instance's image. Maybe we need  raise a exception to tell user  what 's happening.", 
            "date_created": "2013-11-20 09:16:39.116086+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "   glance add name=\"ubuntuLTS\" disk_format=vmdk container_format=ovf \\\nis_public=true vmware_adaptertype=\"lsiLogic\" vmware_disktype=\"preallocated\" \\\nvmware_ostype=\"ubuntu64Guest\" < ubuntuLTS-flat.vmdk  \n\n\n\n\nyou can use this command to import an image,\n\nyou can attach a volume in ACTIVE", 
            "date_created": "2013-11-21 07:41:30.746455+00:00", 
            "author": "https://api.launchpad.net/1.0/~kaitian521"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/65799", 
            "date_created": "2014-01-09 22:18:17.312897+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "all reviews are abandoned for this and it has not been updated in a long time. moving back to triaged. Please set to in progress if you plan on working on it", 
            "date_created": "2014-07-10 00:15:24.551048+00:00", 
            "author": "https://api.launchpad.net/1.0/~tjones-i"
        }, 
        {
            "content": "This is not a valid cinder bug. Nova vmware driver has to create or use an existing controller in the instance VM to attach the volume and it is unrelated to the controller in volume backing. Please re-open this if you disagree.", 
            "date_created": "2014-07-16 11:58:58.950027+00:00", 
            "author": "https://api.launchpad.net/1.0/~vbala"
        }, 
        {
            "content": "raising prio as it is blocking some of the cinder test cases.", 
            "date_created": "2014-09-05 15:10:15.207947+00:00", 
            "author": "https://api.launchpad.net/1.0/~tjones-i"
        }, 
        {
            "content": "The issue is pointed out above, i.e. ide controller does not support hotplugging.  To fix this, an exception should be thrown when attempting to attach a volume to an active instance (as pointed out in the review by danpb).", 
            "date_created": "2014-09-17 19:07:20.202683+00:00", 
            "author": "https://api.launchpad.net/1.0/~thang-pham"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/122251", 
            "date_created": "2014-09-17 21:20:37.162770+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/122251\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e3fd9b377c082791670ce94ed972e0103f88d399\nSubmitter: Jenkins\nBranch:    master\n\ncommit e3fd9b377c082791670ce94ed972e0103f88d399\nAuthor: Thang Pham <email address hidden>\nDate:   Wed Sep 17 17:14:15 2014 -0400\n\n    VMware: Support volume hotplug\n    \n    When a volume is attached to an instance, the disk_type and\n    adapter_type are found by making a get_dynamic_property vim\n    call to the instance. If the adapter_type returned is\n    \"ide\", the volume attach fails with \"operation cannot be\n    performed in the current state\". This is because VMware IDE\n    adapter does not support disk hotplug.\n    \n    Instead of making a get_dynamic_property vim call to the\n    instance, it should be made to the volume (shadow VM). This\n    properly indicates what adapter_type is needed by the volume.\n    If the instance does not have a controller to support the\n    volume adapter_type (e.g. lsiLogic), one will be added.\n    If the volume adapter_type is \"ide\", a exception.Invalid will\n    be thrown.\n    \n    Change-Id: Id826a33298885e9dbd4b52c9fe518ed2e6d50469\n    Closes-Bug: #1226543\n", 
            "date_created": "2014-12-11 21:44:52.154329+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}