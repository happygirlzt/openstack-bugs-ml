{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:28:06.057272+00:00", 
    "description": "The properties that we retrieve from VirtualMachineConfigSummary are optional and if they are missing get_info() throws an exception (tracebacks below). We should use default values  when the properties are not available.\n\n\nstack/common/vmware/vim.py:126\n\n2014-05-06 21:52:44.485 421 DEBUG nova.openstack.common.vmware.vim [-] No faults found in RetrievePropertiesEx API response. _retrieve_properties_ex_fault_checker /usr/lib/python2.7/dist-packages/nova/ope\n\nnstack/common/vmware/vim.py:153\n\n2014-05-06 21:52:44.486 421 DEBUG nova.openstack.common.vmware.vim [-] Invocation of RetrievePropertiesEx on (propertyCollector){\n\n   value = \"propertyCollector\"\n\n   _type = \"PropertyCollector\"\n\n } completed successfully. vim_request_handler /usr/lib/python2.7/dist-packages/nova/openstack/common/vmware/vim.py:187\n\n2014-05-06 21:52:44.487 421 DEBUG nova.openstack.common.vmware.api [-] Function _invoke_api returned successfully after 0 retries. _func /usr/lib/python2.7/dist-packages/nova/openstack/common/vmware/api.py:88\n\n2014-05-06 21:52:44.491 421 ERROR nova.openstack.common.threadgroup [-] int() argument must be a string or a number, not 'NoneType'\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     x.wait()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/service.py\", line 65, in run_service\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     service.start()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 154, in start\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 792, in init_host\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     self._init_instance(context, instance)\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 700, in _init_instance\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     drv_state = self._get_power_state(context, instance)\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 808, in _get_power_state\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return self.driver.get_info(instance)[\"state\"]\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/driver.py\", line 737, in get_info\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return _vmops.get_info(instance)\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/vmops.py\", line 1493, in get_info\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     max_mem = int(query['summary.config.memorySizeMB']) * 1024\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup TypeError: int() argument must be a string or a number, not 'NoneType'\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup \n\n2014-05-06 21:52:44.496 421 DEBUG amqp [-] Closed channel #1 _do_close /usr/lib/python2.7/dist-packages/amqp/channel.py:88\n\n2014-05-06 21:52:44.902 421 INFO nova.openstack.common.vmware.api [-] Logging out and terminating the current session with ID = 526ac461-2770-40fa-a53e-7fe742d2499a.\n\n2014-05-06 21:52:44.903 421 DEBUG nova.openstack.common.vmware.vim [-] Invoking Logout on (sessionManager){\n\n   value = \"SessionManager\"", 
    "tags": [
        "havana-backport-potential", 
        "in-stable-icehouse", 
        "vmware"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1317912", 
    "owner": "https://api.launchpad.net/1.0/~rgerganov", 
    "id": 1317912, 
    "index": 1490, 
    "created": "2014-05-09 13:23:40.403827+00:00", 
    "title": "VMware: get_info() fails if properties are missing", 
    "comments": [
        {
            "content": "The properties that we retrieve from VirtualMachineConfigSummary are optional and if they are missing get_info() throws an exception (tracebacks below). We should use default values  when the properties are not available.\n\n\nstack/common/vmware/vim.py:126\n\n2014-05-06 21:52:44.485 421 DEBUG nova.openstack.common.vmware.vim [-] No faults found in RetrievePropertiesEx API response. _retrieve_properties_ex_fault_checker /usr/lib/python2.7/dist-packages/nova/ope\n\nnstack/common/vmware/vim.py:153\n\n2014-05-06 21:52:44.486 421 DEBUG nova.openstack.common.vmware.vim [-] Invocation of RetrievePropertiesEx on (propertyCollector){\n\n   value = \"propertyCollector\"\n\n   _type = \"PropertyCollector\"\n\n } completed successfully. vim_request_handler /usr/lib/python2.7/dist-packages/nova/openstack/common/vmware/vim.py:187\n\n2014-05-06 21:52:44.487 421 DEBUG nova.openstack.common.vmware.api [-] Function _invoke_api returned successfully after 0 retries. _func /usr/lib/python2.7/dist-packages/nova/openstack/common/vmware/api.py:88\n\n2014-05-06 21:52:44.491 421 ERROR nova.openstack.common.threadgroup [-] int() argument must be a string or a number, not 'NoneType'\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     x.wait()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/service.py\", line 65, in run_service\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     service.start()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 154, in start\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 792, in init_host\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     self._init_instance(context, instance)\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 700, in _init_instance\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     drv_state = self._get_power_state(context, instance)\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 808, in _get_power_state\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return self.driver.get_info(instance)[\"state\"]\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/driver.py\", line 737, in get_info\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     return _vmops.get_info(instance)\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/vmwareapi/vmops.py\", line 1493, in get_info\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup     max_mem = int(query['summary.config.memorySizeMB']) * 1024\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup TypeError: int() argument must be a string or a number, not 'NoneType'\n\n2014-05-06 21:52:44.491 421 TRACE nova.openstack.common.threadgroup \n\n2014-05-06 21:52:44.496 421 DEBUG amqp [-] Closed channel #1 _do_close /usr/lib/python2.7/dist-packages/amqp/channel.py:88\n\n2014-05-06 21:52:44.902 421 INFO nova.openstack.common.vmware.api [-] Logging out and terminating the current session with ID = 526ac461-2770-40fa-a53e-7fe742d2499a.\n\n2014-05-06 21:52:44.903 421 DEBUG nova.openstack.common.vmware.vim [-] Invoking Logout on (sessionManager){\n\n   value = \"SessionManager\"", 
            "date_created": "2014-05-09 13:23:40.403827+00:00", 
            "author": "https://api.launchpad.net/1.0/~rgerganov"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/93040", 
            "date_created": "2014-05-09 13:52:56.583910+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/93040\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=2db7528ca258d7b0c1205ab2f9a76569d9f9a82d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 2db7528ca258d7b0c1205ab2f9a76569d9f9a82d\nAuthor: Radoslav Gerganov <email address hidden>\nDate:   Wed May 7 17:57:31 2014 +0300\n\n    VMware: use default values in get_info() when properties are missing\n    \n    The properties that we retrieve from VirtualMachineConfigSummary are\n    optional ('summary.config.numCpu', 'summary.config.memorySizeMB') and\n    if they are missing we should return default values from get_info()\n    \n    This patch also improves the unit test for get_info(). It removes the\n    test in test_driver_api.py (test_get_info() and test_spawn() are the\n    same) and adds a new test in test_vmops.py\n    \n    Closes-Bug: 1317912\n    Change-Id: Ibbb28985d13de371fdac8a119ad820d25acc21be\n", 
            "date_created": "2014-05-19 21:23:28.049002+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/94406", 
            "date_created": "2014-05-20 15:45:35.484343+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/94406\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=0617601de93ed2149ac16d6c10e46e508a0977b0\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit 0617601de93ed2149ac16d6c10e46e508a0977b0\nAuthor: Radoslav Gerganov <email address hidden>\nDate:   Wed May 7 17:57:31 2014 +0300\n\n    VMware: use default values in get_info() when properties are missing\n    \n    The properties that we retrieve from VirtualMachineConfigSummary are\n    optional ('summary.config.numCpu', 'summary.config.memorySizeMB') and\n    if they are missing we should return default values from get_info()\n    \n    This patch also improves the unit test for get_info(). It removes the\n    test in test_driver_api.py (test_get_info() and test_spawn() are the\n    same) and adds a new test in test_vmops.py\n    \n    Conflicts:\n    \n    \tnova/tests/virt/vmwareapi/test_driver_api.py\n    \tnova/tests/virt/vmwareapi/test_vmops.py\n    \n    Closes-Bug: 1317912\n    Change-Id: Ibbb28985d13de371fdac8a119ad820d25acc21be\n    (cherry picked from commit 2db7528ca258d7b0c1205ab2f9a76569d9f9a82d)\n", 
            "date_created": "2014-07-31 16:41:34.168598+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}