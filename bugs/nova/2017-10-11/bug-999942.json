{
    "status": "Fix Released", 
    "last_updated": "2012-08-25 05:03:41.593048+00:00", 
    "description": "This is on Ubuntu 12.04 using Ubuntu packages (Stable Essex). I attempted to perform a live migration of an instance with an ephemeral disk:\n\n# nova live-migration --block_migrate instancename hostname\n\nThe live migration fails and rolls back after a few seconds. It becomes active and is still useable, but not migrated. Logged error:\n\n/var/log/nova/nova-compute.log:\n2012-05-15 15:19:02 DEBUG nova.rpc.amqp [-] received {u'_context_roles': [u'admin'], u'_context_request_id': u'req-1ed385e2-1e51-4b3e-8f6c-36974c121970', u'_context_read_deleted': u'no', u'args': {u'instance_id': 75}, u'_context_auth_token': '<SANITIZED>', u'_context_is_admin': True, u'_context_project_id': u'XXXX', u'_context_timestamp': u'2012-05-15T20:17:46.580279', u'_context_user_id': u'XXXX', u'method': u'rollback_live_migration_at_destination', u'_context_remote_address': u'1.2.3.4'} from (pid=1649) _safe_log /usr/lib/python2.7/dist-packages/nova/rpc/common.py:160\n\nIn the event of evacuating hosts for maintenance this has the unintended consequence of making it very difficult for end-user customers to remain online easily. Live migration for instances without ephemeral disks work as expected.", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/999942", 
    "owner": "None", 
    "id": 999942, 
    "index": 683, 
    "created": "2012-05-15 21:22:03.317227+00:00", 
    "title": "Migration fails with ephemeral disk", 
    "comments": [
        {
            "content": "This is on Ubuntu 12.04 using Ubuntu packages (Stable Essex). I attempted to perform a live migration of an instance with an ephemeral disk:\n\n# nova live-migration --block_migrate instancename hostname\n\nThe live migration fails and rolls back after a few seconds. It becomes active and is still useable, but not migrated. Logged error:\n\n/var/log/nova/nova-compute.log:\n2012-05-15 15:19:02 DEBUG nova.rpc.amqp [-] received {u'_context_roles': [u'admin'], u'_context_request_id': u'req-1ed385e2-1e51-4b3e-8f6c-36974c121970', u'_context_read_deleted': u'no', u'args': {u'instance_id': 75}, u'_context_auth_token': '<SANITIZED>', u'_context_is_admin': True, u'_context_project_id': u'XXXX', u'_context_timestamp': u'2012-05-15T20:17:46.580279', u'_context_user_id': u'XXXX', u'method': u'rollback_live_migration_at_destination', u'_context_remote_address': u'1.2.3.4'} from (pid=1649) _safe_log /usr/lib/python2.7/dist-packages/nova/rpc/common.py:160\n\nIn the event of evacuating hosts for maintenance this has the unintended consequence of making it very difficult for end-user customers to remain online easily. Live migration for instances without ephemeral disks work as expected.", 
            "date_created": "2012-05-15 21:22:03.317227+00:00", 
            "author": "https://api.launchpad.net/1.0/~hart-hoover"
        }, 
        {
            "content": "This sounds important but unfortunately the log is not very helpful.  Is there any more logging on the target server?  I don't see an error message in the paste.\n\nAlso does ephemeral disk just mean a size > m1.tiny? or are talking about an attached volume?", 
            "date_created": "2012-05-15 21:56:17.753717+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Here are the logs from the target server. This is not using nova-volume. It is with m1.medium:\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Attempting to grab semaphore \"8471a327d70138d63db99b43249137dab0fc8da4\" for method \"call_if_not_exists\"... from (pid=1649) inner /usr/lib/python2.7/dist-packages/nova/utils.py:927\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Got semaphore \"8471a327d70138d63db99b43249137dab0fc8da4\" for method \"call_if_not_exists\"... from (pid=1649) inner /usr/lib/python2.7/dist-packages/nova/utils.py:931\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Attempting to grab semaphore \"/var/lib/nova/instances/_base/8471a327d70138d63db99b43249137dab0fc8da4\" for method \"copy_and_extend\"... from (pid=1649) inner /usr/lib/python2.7/dist-packages/nova/utils.py:927\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Got semaphore \"/var/lib/nova/instances/_base/8471a327d70138d63db99b43249137dab0fc8da4\" for method \"copy_and_extend\"... from (pid=1649) inner /usr/lib/python2.7/dist-packages/nova/utils.py:931\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Running cmd (subprocess): qemu-img create -f qcow2 -o cluster_size=2M,backing_file=/var/lib/nova/instances/_base/8471a327d70138d63db99b43249137dab0fc8da4_0 /var/lib/nova/instances/instance-0000004e/disk from (pid=1649) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Attempting to grab semaphore \"ephemeral\" for method \"call_if_not_exists\"... from (pid=1649) inner /usr/lib/python2.7/dist-packages/nova/utils.py:927\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Got semaphore \"ephemeral\" for method \"call_if_not_exists\"... from (pid=1649) inner /usr/lib/python2.7/dist-packages/nova/utils.py:931\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Attempting to grab semaphore \"/var/lib/nova/instances/_base/ephemeral\" for method \"copy_and_extend\"... from (pid=1649) inner /usr/lib/python2.7/dist-packages/nova/utils.py:927\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Got semaphore \"/var/lib/nova/instances/_base/ephemeral\" for method \"copy_and_extend\"... from (pid=1649) inner /usr/lib/python2.7/dist-packages/nova/utils.py:931\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Running cmd (subprocess): qemu-img create -f qcow2 -o cluster_size=2M,backing_file=/var/lib/nova/instances/_base/ephemeral_1 /var/lib/nova/instances/instance-0000004e/disk.local from (pid=1649) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Running cmd (subprocess): env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/instance-0000004e/kernel.part from (pid=1649) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n\n2012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Running cmd (subprocess): env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/instance-0000004e/ramdisk.part from (pid=1649) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n\n2012-05-15 17:23:07 DEBUG nova.rpc.amqp [-] received {u'_context_roles': [u'admin'], u'_context_request_id': u'req-1ed385e2-1e51-4b3e-8f6c-36974c121970', u'_context_read_deleted': u'no', u'args': {u'instance_id': 75}, u'_context_auth_token': '<SANITIZED>', u'_context_is_admin': True, u'_context_project_id': u'XXXX', u'_context_timestamp': u'2012-05-15T20:17:46.580279', u'_context_user_id': u'XXXX', u'method': u'rollback_live_migration_at_destination', u'_context_remote_address': u'1.2.3.4'} from (pid=1649) _safe_log /usr/lib/python2.7/dist-packages/nova/rpc/common.py:160\n\n", 
            "date_created": "2012-05-15 22:39:01.191133+00:00", 
            "author": "https://api.launchpad.net/1.0/~hart-hoover"
        }, 
        {
            "content": "it is may be duo to this bug https://bugs.launchpad.net/nova/+bug/977007 .from the  log we can see \n\n012-05-15 17:23:07 DEBUG nova.utils [req-8aa2de5f-3864-4051-a3ec-311af9fbb081 f01c50b7dbbd4888baebd12fcdad0b19 75318728bdec487bb09aebe7ef34585f] Running cmd (subprocess): qemu-img create -f qcow2 -o cluster_size=2M,backing_file=/var/lib/nova/instances/_base/ephemeral_1 /var/lib/nova/instances/instance-0000004e/disk.local from (pid=1649) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n\n\nthe  backing file of the ephemeral disk is /var/lib/nova/instances/_base/ephemeral_1 which has a wrong size.", 
            "date_created": "2012-05-16 02:01:56.027049+00:00", 
            "author": "https://api.launchpad.net/1.0/~heut2008"
        }, 
        {
            "content": "ubuntu precise openstack  2012.1+stable~20120612-3ee026e-0ubuntu1.3 has backported this bug . you can update and test again.", 
            "date_created": "2012-08-25 05:02:23.055724+00:00", 
            "author": "https://api.launchpad.net/1.0/~heut2008"
        }
    ]
}