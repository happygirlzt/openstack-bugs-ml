{
    "status": "Invalid", 
    "last_updated": "2011-12-02 14:14:26.291917+00:00", 
    "description": "Just went through the install process for RHEL6/CentOS6. \nran: nova-manage db sync and it failed:\n\n\n\n2011-10-10 19:48:58,111 migrate.versioning.repository: Config: {'db_settings': {'__name__': 'db_settings', 'required_dbs': '[]', 'version_table': 'migrate_version', 'repository_id': 'nova'}}\n2011-10-10 19:48:58,137 migrate.versioning.api: 11 -> 12... \n2011-10-10 19:48:58,147 migrate.versioning.util: Disposing SQLAlchemy engine Engine(mysql://nova:nova@172.17.160.104/nova)\n2011-10-10 19:48:58,147 nova: (OperationalError) (1054, \"Unknown column 'ra_server' in 'networks'\") '\\nALTER TABLE networks CHANGE COLUMN ra_server gateway_v6 VARCHAR(255)' ()\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1571, in <module>\n(nova): TRACE:     main()\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1559, in main\n(nova): TRACE:     fn(*fn_args, **fn_kwargs)\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1051, in sync\n(nova): TRACE:     return migration.db_sync(version)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/migration.py\", line 35, in db_sync\n(nova): TRACE:     return IMPL.db_sync(version=version)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/migration.py\", line 43, in db_sync\n(nova): TRACE:     return versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/api.py\", line 186, in upgrade\n(nova): TRACE:     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n(nova): TRACE:   File \"<string>\", line 2, in _migrate\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/util/__init__.py\", line 159, in with_engine\n(nova): TRACE:     return f(*a, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/api.py\", line 365, in _migrate\n(nova): TRACE:     schema.runchange(ver, change, changeset.step)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/schema.py\", line 84, in runchange\n(nova): TRACE:     change.run(self.engine, step)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/script/py.py\", line 145, in run\n(nova): TRACE:     script_func(engine)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/migrate_repo/versions/012_add_ipv6_flatmanager.py\", line 143, in upgrade\n(nova): TRACE:     networks.c.ra_server.alter(name='gateway_v6')\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/schema.py\", line 493, in alter\n(nova): TRACE:     return alter_column(self, *p, **k)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/schema.py\", line 136, in alter_column\n(nova): TRACE:     engine._run_visitor(visitorcallable, delta)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 2222, in _run_visitor\n(nova): TRACE:     conn._run_visitor(visitorcallable, element, **kwargs)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1898, in _run_visitor\n(nova): TRACE:     **kwargs).traverse_single(element)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/ansisql.py\", line 57, in traverse_single\n(nova): TRACE:     ret = super(AlterTableVisitor, self).traverse_single(elem)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/sql/visitors.py\", line 86, in traverse_single\n(nova): TRACE:     return meth(obj, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/databases/mysql.py\", line 46, in visit_column\n(nova): TRACE:     self.execute()\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/ansisql.py\", line 46, in execute\n(nova): TRACE:     return self.connection.execute(self.buffer.getvalue())\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1399, in execute\n(nova): TRACE:     params)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1576, in _execute_text\n(nova): TRACE:     statement, parameters\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_context\n(nova): TRACE:     context)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1633, in _execute_context\n(nova): TRACE:     context)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/default.py\", line 325, in do_execute\n(nova): TRACE:     cursor.execute(statement, parameters)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/MySQLdb/cursors.py\", line 173, in execute\n(nova): TRACE:     self.errorhandler(self, exc, value)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n(nova): TRACE:     raise errorclass, errorvalue\n(nova): TRACE: OperationalError: (OperationalError) (1054, \"Unknown column 'ra_server' in 'networks'\") '\\nALTER TABLE networks CHANGE COLUMN ra_server gateway_v6 VARCHAR(255)' ()\n(nova): TRACE: \n\nCommenting out the migration in 012 only proves to find more problems with other migrations in the file :\n/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/migrate_repo/versions/012_add_ipv6_flatmanager.py\n\nShouldnt these migrations not happen if \"--use_ipv6=false\" is set in nova.conf?\n\nHere are the versions I have installed:\n\n\n# rpm -qva|grep openstack\nopenstack-nova-network-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-noVNC-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-node-full-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-glance-doc-2011.3-0.20110825.996.1.el6.noarch\nopenstack-client-2.6.4-1.1ed1f5e.noarch\nopenstack-repo-2011.3-0.4.noarch\nopenstack-nova-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-objectstore-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-api-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-scheduler-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-doc-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-compute-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-glance-2011.3-0.20110825.996.1.el6.noarch\nopenstack-nova-cc-config-2011.3-4.noarch\nopenstack-nova-volume-2011.3-0.20110922.1520.5.el6.noarch", 
    "tags": [
        "migration"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/872062", 
    "owner": "None", 
    "id": 872062, 
    "index": 2308, 
    "created": "2011-10-10 23:58:47.579277+00:00", 
    "title": "nova-manage db sync fails", 
    "comments": [
        {
            "content": "Just went through the install process for RHEL6/CentOS6. \nran: nova-manage db sync and it failed:\n\n\n\n2011-10-10 19:48:58,111 migrate.versioning.repository: Config: {'db_settings': {'__name__': 'db_settings', 'required_dbs': '[]', 'version_table': 'migrate_version', 'repository_id': 'nova'}}\n2011-10-10 19:48:58,137 migrate.versioning.api: 11 -> 12... \n2011-10-10 19:48:58,147 migrate.versioning.util: Disposing SQLAlchemy engine Engine(mysql://nova:nova@172.17.160.104/nova)\n2011-10-10 19:48:58,147 nova: (OperationalError) (1054, \"Unknown column 'ra_server' in 'networks'\") '\\nALTER TABLE networks CHANGE COLUMN ra_server gateway_v6 VARCHAR(255)' ()\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1571, in <module>\n(nova): TRACE:     main()\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1559, in main\n(nova): TRACE:     fn(*fn_args, **fn_kwargs)\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1051, in sync\n(nova): TRACE:     return migration.db_sync(version)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/migration.py\", line 35, in db_sync\n(nova): TRACE:     return IMPL.db_sync(version=version)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/migration.py\", line 43, in db_sync\n(nova): TRACE:     return versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/api.py\", line 186, in upgrade\n(nova): TRACE:     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n(nova): TRACE:   File \"<string>\", line 2, in _migrate\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/util/__init__.py\", line 159, in with_engine\n(nova): TRACE:     return f(*a, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/api.py\", line 365, in _migrate\n(nova): TRACE:     schema.runchange(ver, change, changeset.step)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/schema.py\", line 84, in runchange\n(nova): TRACE:     change.run(self.engine, step)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/versioning/script/py.py\", line 145, in run\n(nova): TRACE:     script_func(engine)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/migrate_repo/versions/012_add_ipv6_flatmanager.py\", line 143, in upgrade\n(nova): TRACE:     networks.c.ra_server.alter(name='gateway_v6')\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/schema.py\", line 493, in alter\n(nova): TRACE:     return alter_column(self, *p, **k)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/schema.py\", line 136, in alter_column\n(nova): TRACE:     engine._run_visitor(visitorcallable, delta)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 2222, in _run_visitor\n(nova): TRACE:     conn._run_visitor(visitorcallable, element, **kwargs)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1898, in _run_visitor\n(nova): TRACE:     **kwargs).traverse_single(element)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/ansisql.py\", line 57, in traverse_single\n(nova): TRACE:     ret = super(AlterTableVisitor, self).traverse_single(elem)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/sql/visitors.py\", line 86, in traverse_single\n(nova): TRACE:     return meth(obj, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/databases/mysql.py\", line 46, in visit_column\n(nova): TRACE:     self.execute()\n(nova): TRACE:   File \"/usr/lib/python2.6/site-packages/migrate/changeset/ansisql.py\", line 46, in execute\n(nova): TRACE:     return self.connection.execute(self.buffer.getvalue())\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1399, in execute\n(nova): TRACE:     params)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1576, in _execute_text\n(nova): TRACE:     statement, parameters\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_context\n(nova): TRACE:     context)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 1633, in _execute_context\n(nova): TRACE:     context)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/default.py\", line 325, in do_execute\n(nova): TRACE:     cursor.execute(statement, parameters)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/MySQLdb/cursors.py\", line 173, in execute\n(nova): TRACE:     self.errorhandler(self, exc, value)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n(nova): TRACE:     raise errorclass, errorvalue\n(nova): TRACE: OperationalError: (OperationalError) (1054, \"Unknown column 'ra_server' in 'networks'\") '\\nALTER TABLE networks CHANGE COLUMN ra_server gateway_v6 VARCHAR(255)' ()\n(nova): TRACE: \n\nCommenting out the migration in 012 only proves to find more problems with other migrations in the file :\n/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/migrate_repo/versions/012_add_ipv6_flatmanager.py\n\nShouldnt these migrations not happen if \"--use_ipv6=false\" is set in nova.conf?\n\nHere are the versions I have installed:\n\n\n# rpm -qva|grep openstack\nopenstack-nova-network-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-noVNC-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-node-full-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-glance-doc-2011.3-0.20110825.996.1.el6.noarch\nopenstack-client-2.6.4-1.1ed1f5e.noarch\nopenstack-repo-2011.3-0.4.noarch\nopenstack-nova-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-objectstore-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-api-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-scheduler-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-doc-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-nova-compute-2011.3-0.20110922.1520.5.el6.noarch\nopenstack-glance-2011.3-0.20110825.996.1.el6.noarch\nopenstack-nova-cc-config-2011.3-4.noarch\nopenstack-nova-volume-2011.3-0.20110922.1520.5.el6.noarch", 
            "date_created": "2011-10-10 23:58:47.579277+00:00", 
            "author": "https://api.launchpad.net/1.0/~jason-rojas"
        }, 
        {
            "content": "That column is created by migration 002... This works on other platforms, so it might be an issue in the packages you're using. Could you push that bug to where you got those from ?\r\n\r\n(The schema should not depend on configuration, so this ipv6-related column has to exist whatever --use_ipv6 says)", 
            "date_created": "2011-10-21 10:19:48.629555+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ]
}