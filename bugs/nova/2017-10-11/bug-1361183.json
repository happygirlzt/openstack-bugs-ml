{
    "status": "Invalid", 
    "last_updated": "2014-09-17 02:09:11.245448+00:00", 
    "description": "This found by review code.\n\nWe already turn the _set_instance_error_state to use instance object. but there https://github.com/openstack/nova/blob/master/nova/compute/manager.py#L1942\nstill pass the uuid.\n\nWhen there is exception raised, will get error as below:\n2014-08-25 19:57:31.784 ERROR oslo.messaging.rpc.dispatcher [req-164071ff-f94e-4cb4-999b-2d595c6e77c6 admin admin] Exception during message handling: string in\ndices must be integers, not str\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dis\npatch_and_reply\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dis\npatch\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_\ndispatch\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 296, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 282, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 346, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 324, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 312, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 1984, in build_and_run_instance\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     node, limits)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 325, in inner\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 1942, in do_build_and_run_instance\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     self._set_instance_error_state(context, instance.uuid)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 644, in _set_instance_error_state\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     instance_uuid = instance['uuid']\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher TypeError: string indices must be integers, not str", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1361183", 
    "owner": "https://api.launchpad.net/1.0/~xuhj", 
    "id": 1361183, 
    "index": 5102, 
    "created": "2014-08-25 12:23:46.348321+00:00", 
    "title": "Shouldn't pass instance.uuid when call _set_instance_error_state", 
    "comments": [
        {
            "content": "This found by review code.\n\nWe already turn the _set_instance_error_state to use instance object. but there https://github.com/openstack/nova/blob/master/nova/compute/manager.py#L1942\nstill pass the uuid.\n\nWhen there is exception raised, will get error as below:\n2014-08-25 19:57:31.784 ERROR oslo.messaging.rpc.dispatcher [req-164071ff-f94e-4cb4-999b-2d595c6e77c6 admin admin] Exception during message handling: string in\ndices must be integers, not str\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dis\npatch_and_reply\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dis\npatch\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_\ndispatch\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 296, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 282, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 346, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 324, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 312, in decorated_function\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 1984, in build_and_run_instance\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     node, limits)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 325, in inner\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 1942, in do_build_and_run_instance\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     self._set_instance_error_state(context, instance.uuid)\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 644, in _set_instance_error_state\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher     instance_uuid = instance['uuid']\n2014-08-25 19:57:31.784 TRACE oslo.messaging.rpc.dispatcher TypeError: string indices must be integers, not str", 
            "date_created": "2014-08-25 12:23:46.348321+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/116597", 
            "date_created": "2014-08-25 12:33:51.245157+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Andrew Laski (<email address hidden>) on branch: master\nReview: https://review.openstack.org/116597\nReason: This has been fixed by https://review.openstack.org/#/c/120230/1 which has already merged.  But thank you for the patch.", 
            "date_created": "2014-09-15 21:28:16.526165+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}