{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:43:49.328618+00:00", 
    "description": "Hi,\n\nI'm deploying OpenStack Folsom-2, and evaluating Cinder.\nI will report a issue about \"Creating volume from snapshot is broken\"\n\nI try to launch an instance from snapshot. But error occur.\n$ nova boot --image d6cb5fc7-4c36-4d10-9731-cacfa726a957 --flavor 1 --block_device_mapping /dev/vda=18a127ac-335c-49ec-8283-356f81712080:snap:2:0 --key_name testkey precise-snap-002\n$ nova list\nPlease input your password for the keyring\n+--------------------------------------+------------------+--------+-----------------------+\n| ID                                   | Name             | Status | Networks              |\n+--------------------------------------+------------------+--------+-----------------------+\n| 1bad4a19-2162-416d-8307-9aa452bb45c5 | precise-snap-002 | ERROR  |                       |\n+--------------------------------------+------------------+--------+-----------------------+\n\nError log from cinder-api service:\n\n2012-07-26 10:08:46 AUDIT cinder.api.openstack.volume.volumes [req-8b64d853-bfa1-4667-a101-3726750223ce e5355fe674ca4700a419ecfed5faa9fb 825784e1eadb40b5a81398f60ad5ef3f] Create volume of 0 GB\n2012-07-26 10:08:46 ERROR cinder.api.openstack [req-8b64d853-bfa1-4667-a101-3726750223ce e5355fe674ca4700a419ecfed5faa9fb 825784e1eadb40b5a81398f60ad5ef3f] Caught error: (ProgrammingError) (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \\': \"\\'available\\'\", u\\'display_name\\': \"\\'test_snapshot-001\\'\", u\\'created_at\\': \"\\'2012-0\\' at line 3') 'SELECT snapshots.created_at AS snapshots_created_at, snapshots.updated_at AS snapshots_updated_at, snapshots.deleted_at AS snapshots_deleted_at, snapshots.deleted AS snapshots_deleted, snapshots.id AS snapshots_id, snapshots.user_id AS snapshots_user_id, snapshots.project_id AS snapshots_project_id, snapshots.volume_id AS snapshots_volume_id, snapshots.status AS snapshots_status, snapshots.progress AS snapshots_progress, snapshots.volume_size AS snapshots_volume_size, snapshots.display_name AS snapshots_display_name, snapshots.display_description AS snapshots_display_description \\nFROM snapshots \\nWHERE snapshots.deleted = %s AND snapshots.id = %s \\n LIMIT %s' (0, {u'status': u'available', u'display_name': u'test_snapshot-001', u'created_at': u'2012-07-24 07:34:20', u'display_description': None, u'volume_size': 2, u'volume_id': u'013c7d76-764e-4c8e-aaa3-7df05ff50a6a', u'progress': u'100%', u'project_id': u'825784e1eadb40b5a81398f60ad5ef3f', u'id': u'18a127ac-335c-49ec-8283-356f81712080', u'size': 2}, 1)\n2012-07-26 10:08:46 TRACE cinder.api.openstack Traceback (most recent call last):\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/__init__.py\", line 41, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return req.get_response(self.application)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/request.py\", line 1053, in get_response\n2012-07-26 10:08:46 TRACE cinder.api.openstack     application, catch_exc_info=False)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/request.py\", line 1022, in call_application\n2012-07-26 10:08:46 TRACE cinder.api.openstack     app_iter = application(self.environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 159, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return resp(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystone-2012.2-py2.7.egg/keystone/middleware/auth_token.py\", line 185, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return self.app(env, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 159, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return resp(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 159, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return resp(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     response = self.app(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 159, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return resp(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 147, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 208, in call_func\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return self.func(req, *args, **kwargs)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/wsgi.py\", line 802, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     content_type, body, accept)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/wsgi.py\", line 850, in _process_stack\n2012-07-26 10:08:46 TRACE cinder.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/wsgi.py\", line 925, in dispatch\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return method(req=request, **action_args)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/volume/volumes.py\", line 236, in create\n2012-07-26 10:08:46 TRACE cinder.api.openstack     snapshot_id)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/volume/api.py\", line 207, in get_snapshot\n2012-07-26 10:08:46 TRACE cinder.api.openstack     rv = self.db.snapshot_get(context, snapshot_id)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/db/api.py\", line 584, in snapshot_get\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return IMPL.snapshot_get(context, snapshot_id)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/db/sqlalchemy/api.py\", line 122, in wrapper\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return f(*args, **kwargs)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/db/sqlalchemy/api.py\", line 854, in snapshot_get\n2012-07-26 10:08:46 TRACE cinder.api.openstack     filter_by(id=snapshot_id).\\\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1988, in first\n2012-07-26 10:08:46 TRACE cinder.api.openstack     ret = list(self[0:1])\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1882, in __getitem__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return list(res)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2057, in __iter__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return self._execute_and_instances(context)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2072, in _execute_and_instances\n2012-07-26 10:08:46 TRACE cinder.api.openstack     result = conn.execute(querycontext.statement, self._params)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1405, in execute\n2012-07-26 10:08:46 TRACE cinder.api.openstack     params)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1538, in _execute_clauseelement\n2012-07-26 10:08:46 TRACE cinder.api.openstack     compiled_sql, distilled_params\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1646, in _execute_context\n2012-07-26 10:08:46 TRACE cinder.api.openstack     context)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_context\n2012-07-26 10:08:46 TRACE cinder.api.openstack     context)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 330, in do_execute\n2012-07-26 10:08:46 TRACE cinder.api.openstack     cursor.execute(statement, parameters)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\n2012-07-26 10:08:46 TRACE cinder.api.openstack     self.errorhandler(self, exc, value)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n2012-07-26 10:08:46 TRACE cinder.api.openstack     raise errorclass, errorvalue\n2012-07-26 10:08:46 TRACE cinder.api.openstack ProgrammingError: (ProgrammingError) (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \\': \"\\'available\\'\", u\\'display_name\\': \"\\'test_snapshot-001\\'\", u\\'created_at\\': \"\\'2012-0\\' at line 3') 'SELECT snapshots.created_at AS snapshots_created_at, snapshots.updated_at AS snapshots_updated_at, snapshots.deleted_at AS snapshots_deleted_at, snapshots.deleted AS snapshots_deleted, snapshots.id AS snapshots_id, snapshots.user_id AS snapshots_user_id, snapshots.project_id AS snapshots_project_id, snapshots.volume_id AS snapshots_volume_id, snapshots.status AS snapshots_status, snapshots.progress AS snapshots_progress, snapshots.volume_size AS snapshots_volume_size, snapshots.display_name AS snapshots_display_name, snapshots.display_description AS snapshots_display_description \\nFROM snapshots \\nWHERE snapshots.deleted = %s AND snapshots.id = %s \\n LIMIT %s' (0, {u'status': u'available', u'display_name': u'test_snapshot-001', u'created_at': u'2012-07-24 07:34:20', u'display_description': None, u'volume_size': 2, u'volume_id': u'013c7d76-764e-4c8e-aaa3-7df05ff50a6a', u'progress': u'100%', u'project_id': u'825784e1eadb40b5a81398f60ad5ef3f', u'id': u'18a127ac-335c-49ec-8283-356f81712080', u'size': 2}, 1)\n2012-07-26 10:08:46 TRACE cinder.api.openstack\n2012-07-26 10:08:46 INFO cinder.api.openstack [req-8b64d853-bfa1-4667-a101-3726750223ce e5355fe674ca4700a419ecfed5faa9fb 825784e1eadb40b5a81398f60ad5ef3f] http://192.168.1.1:8776/v1/825784e1eadb40b5a81398f60ad5ef3f/volumes returned with HTTP 500\n\n\nIt seems the superficial problem depends on snapshot_id not being an appropriate value.\nAs a result, a SQL syntax error  occurs.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1029211", 
    "owner": "https://api.launchpad.net/1.0/~unmesh-gurjar", 
    "id": 1029211, 
    "index": 2979, 
    "created": "2012-07-26 01:47:37.983058+00:00", 
    "title": "Boot from snapshot is broken", 
    "comments": [
        {
            "content": "Hi,\n\nI'm deploying OpenStack Folsom-2, and evaluating Cinder.\nI will report a issue about \"Creating volume from snapshot is broken\"\n\nI try to launch an instance from snapshot. But error occur.\n$ nova boot --image d6cb5fc7-4c36-4d10-9731-cacfa726a957 --flavor 1 --block_device_mapping /dev/vda=18a127ac-335c-49ec-8283-356f81712080:snap:2:0 --key_name testkey precise-snap-002\n$ nova list\nPlease input your password for the keyring\n+--------------------------------------+------------------+--------+-----------------------+\n| ID                                   | Name             | Status | Networks              |\n+--------------------------------------+------------------+--------+-----------------------+\n| 1bad4a19-2162-416d-8307-9aa452bb45c5 | precise-snap-002 | ERROR  |                       |\n+--------------------------------------+------------------+--------+-----------------------+\n\nError log from cinder-api service:\n\n2012-07-26 10:08:46 AUDIT cinder.api.openstack.volume.volumes [req-8b64d853-bfa1-4667-a101-3726750223ce e5355fe674ca4700a419ecfed5faa9fb 825784e1eadb40b5a81398f60ad5ef3f] Create volume of 0 GB\n2012-07-26 10:08:46 ERROR cinder.api.openstack [req-8b64d853-bfa1-4667-a101-3726750223ce e5355fe674ca4700a419ecfed5faa9fb 825784e1eadb40b5a81398f60ad5ef3f] Caught error: (ProgrammingError) (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \\': \"\\'available\\'\", u\\'display_name\\': \"\\'test_snapshot-001\\'\", u\\'created_at\\': \"\\'2012-0\\' at line 3') 'SELECT snapshots.created_at AS snapshots_created_at, snapshots.updated_at AS snapshots_updated_at, snapshots.deleted_at AS snapshots_deleted_at, snapshots.deleted AS snapshots_deleted, snapshots.id AS snapshots_id, snapshots.user_id AS snapshots_user_id, snapshots.project_id AS snapshots_project_id, snapshots.volume_id AS snapshots_volume_id, snapshots.status AS snapshots_status, snapshots.progress AS snapshots_progress, snapshots.volume_size AS snapshots_volume_size, snapshots.display_name AS snapshots_display_name, snapshots.display_description AS snapshots_display_description \\nFROM snapshots \\nWHERE snapshots.deleted = %s AND snapshots.id = %s \\n LIMIT %s' (0, {u'status': u'available', u'display_name': u'test_snapshot-001', u'created_at': u'2012-07-24 07:34:20', u'display_description': None, u'volume_size': 2, u'volume_id': u'013c7d76-764e-4c8e-aaa3-7df05ff50a6a', u'progress': u'100%', u'project_id': u'825784e1eadb40b5a81398f60ad5ef3f', u'id': u'18a127ac-335c-49ec-8283-356f81712080', u'size': 2}, 1)\n2012-07-26 10:08:46 TRACE cinder.api.openstack Traceback (most recent call last):\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/__init__.py\", line 41, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return req.get_response(self.application)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/request.py\", line 1053, in get_response\n2012-07-26 10:08:46 TRACE cinder.api.openstack     application, catch_exc_info=False)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/request.py\", line 1022, in call_application\n2012-07-26 10:08:46 TRACE cinder.api.openstack     app_iter = application(self.environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 159, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return resp(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystone-2012.2-py2.7.egg/keystone/middleware/auth_token.py\", line 185, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return self.app(env, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 159, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return resp(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 159, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return resp(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     response = self.app(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 159, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return resp(environ, start_response)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 147, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/WebOb-1.0.8-py2.7.egg/webob/dec.py\", line 208, in call_func\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return self.func(req, *args, **kwargs)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/wsgi.py\", line 802, in __call__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     content_type, body, accept)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/wsgi.py\", line 850, in _process_stack\n2012-07-26 10:08:46 TRACE cinder.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/wsgi.py\", line 925, in dispatch\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return method(req=request, **action_args)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/api/openstack/volume/volumes.py\", line 236, in create\n2012-07-26 10:08:46 TRACE cinder.api.openstack     snapshot_id)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/volume/api.py\", line 207, in get_snapshot\n2012-07-26 10:08:46 TRACE cinder.api.openstack     rv = self.db.snapshot_get(context, snapshot_id)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/db/api.py\", line 584, in snapshot_get\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return IMPL.snapshot_get(context, snapshot_id)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/db/sqlalchemy/api.py\", line 122, in wrapper\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return f(*args, **kwargs)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/opt/folsom/cinder/cinder/db/sqlalchemy/api.py\", line 854, in snapshot_get\n2012-07-26 10:08:46 TRACE cinder.api.openstack     filter_by(id=snapshot_id).\\\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1988, in first\n2012-07-26 10:08:46 TRACE cinder.api.openstack     ret = list(self[0:1])\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1882, in __getitem__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return list(res)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2057, in __iter__\n2012-07-26 10:08:46 TRACE cinder.api.openstack     return self._execute_and_instances(context)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2072, in _execute_and_instances\n2012-07-26 10:08:46 TRACE cinder.api.openstack     result = conn.execute(querycontext.statement, self._params)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1405, in execute\n2012-07-26 10:08:46 TRACE cinder.api.openstack     params)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1538, in _execute_clauseelement\n2012-07-26 10:08:46 TRACE cinder.api.openstack     compiled_sql, distilled_params\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1646, in _execute_context\n2012-07-26 10:08:46 TRACE cinder.api.openstack     context)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_context\n2012-07-26 10:08:46 TRACE cinder.api.openstack     context)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 330, in do_execute\n2012-07-26 10:08:46 TRACE cinder.api.openstack     cursor.execute(statement, parameters)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\n2012-07-26 10:08:46 TRACE cinder.api.openstack     self.errorhandler(self, exc, value)\n2012-07-26 10:08:46 TRACE cinder.api.openstack   File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n2012-07-26 10:08:46 TRACE cinder.api.openstack     raise errorclass, errorvalue\n2012-07-26 10:08:46 TRACE cinder.api.openstack ProgrammingError: (ProgrammingError) (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \\': \"\\'available\\'\", u\\'display_name\\': \"\\'test_snapshot-001\\'\", u\\'created_at\\': \"\\'2012-0\\' at line 3') 'SELECT snapshots.created_at AS snapshots_created_at, snapshots.updated_at AS snapshots_updated_at, snapshots.deleted_at AS snapshots_deleted_at, snapshots.deleted AS snapshots_deleted, snapshots.id AS snapshots_id, snapshots.user_id AS snapshots_user_id, snapshots.project_id AS snapshots_project_id, snapshots.volume_id AS snapshots_volume_id, snapshots.status AS snapshots_status, snapshots.progress AS snapshots_progress, snapshots.volume_size AS snapshots_volume_size, snapshots.display_name AS snapshots_display_name, snapshots.display_description AS snapshots_display_description \\nFROM snapshots \\nWHERE snapshots.deleted = %s AND snapshots.id = %s \\n LIMIT %s' (0, {u'status': u'available', u'display_name': u'test_snapshot-001', u'created_at': u'2012-07-24 07:34:20', u'display_description': None, u'volume_size': 2, u'volume_id': u'013c7d76-764e-4c8e-aaa3-7df05ff50a6a', u'progress': u'100%', u'project_id': u'825784e1eadb40b5a81398f60ad5ef3f', u'id': u'18a127ac-335c-49ec-8283-356f81712080', u'size': 2}, 1)\n2012-07-26 10:08:46 TRACE cinder.api.openstack\n2012-07-26 10:08:46 INFO cinder.api.openstack [req-8b64d853-bfa1-4667-a101-3726750223ce e5355fe674ca4700a419ecfed5faa9fb 825784e1eadb40b5a81398f60ad5ef3f] http://192.168.1.1:8776/v1/825784e1eadb40b5a81398f60ad5ef3f/volumes returned with HTTP 500\n\n\nIt seems the superficial problem depends on snapshot_id not being an appropriate value.\nAs a result, a SQL syntax error  occurs.", 
            "date_created": "2012-07-26 01:47:37.983058+00:00", 
            "author": "https://api.launchpad.net/1.0/~mnakamichi"
        }, 
        {
            "content": "It's not cinder's problem but nova's.\n\nnova-2012.2/nova/compute/manager.py:\n\n   378      def _setup_block_device_mapping(self, context, instance):\n   ....\n   404              if ((bdm['snapshot_id'] is not None) and\n   405                  (bdm['volume_id'] is None)):\n   406                  # TODO(yamahata): default name and description\n   407                  snapshot = self.volume_api.get_snapshot(context,\n   408                                                          bdm['snapshot_id'])\n   409                  vol = self.volume_api.create(context, bdm['volume_size'],\n   410                                               '', '', snapshot)\n\nself.volume_api.create() takes an argument 'snapshot' that is a dictionary.\n\nnova-2012.2/nova/volume/cinder.py:\n\n   172      def create(self, context, size, name, description, snapshot=None,\n   173                       volume_type=None, metadata=None, availability_zone=None):\n   174\n   175          item = cinderclient(context).volumes.create(size, snapshot,\n   176                                                      name, description,\n   177                                                      volume_type)\n   178\n   179          volume = _untranslate_volume_summary_view(context, item)\n   180          return _untranslate_volume_summary_view(context, item)\n \ncinderclient(context).volumes.create() takes that data as is. \nBut it must be snapshot id (uuid string), so the problem occured.\n\nThere are 2 solutions:\n\na)  a simple way:\ndiff -u nova-2012.2/nova/volume/cinder.py.orig  nova-2012.2/nova/volume/cinder.py\n--- nova-2012.2/nova/volume/cinder.py.orig      2012-08-21 06:16:55.625616989 +0900\n+++ nova-2012.2/nova/volume/cinder.py   2012-08-21 06:17:14.101617617 +0900\n@@ -172,7 +172,7 @@\n     def create(self, context, size, name, description, snapshot=None,\n                      volume_type=None, metadata=None, availability_zone=None):\n\n-        item = cinderclient(context).volumes.create(size, snapshot,\n+        item = cinderclient(context).volumes.create(size, snapshot['id'],\n                                                     name, description,\n                                                     volume_type)\n\nb) more complex way:\ndiff -u nova-2012.2/nova/compute/manager.py.orig nova-2012.2/nova/compute/manager.py\n--- nova-2012.2/nova/compute/manager.py.orig    2012-08-21 06:27:35.401636637 +0900\n+++ nova-2012.2/nova/compute/manager.py 2012-08-21 06:27:56.769637297 +0900\n@@ -404,10 +404,8 @@\n             if ((bdm['snapshot_id'] is not None) and\n                 (bdm['volume_id'] is None)):\n                 # TODO(yamahata): default name and description\n-                snapshot = self.volume_api.get_snapshot(context,\n-                                                        bdm['snapshot_id'])\n                 vol = self.volume_api.create(context, bdm['volume_size'],\n-                                             '', '', snapshot)\n+                                             '', '', bdm['snapshot_id'])\n                 # TODO(yamahata): creating volume simultaneously\n                 #                 reduces creation time?\n                 # TODO(yamahata): eliminate dumb polling\n\ndiff -u nova-2012.2/nova/volume/api.py.orig nova-2012.2/nova/volume/api.py\n--- nova-2012.2/nova/volume/api.py.orig 2012-08-21 06:28:59.225639227 +0900\n+++ nova-2012.2/nova/volume/api.py      2012-08-21 06:30:06.049641299 +0900\n@@ -66,10 +66,11 @@\n class API(base.Base):\n     \"\"\"API for interacting with the volume manager.\"\"\"\n\n-    def create(self, context, size, name, description, snapshot=None,\n+    def create(self, context, size, name, description, snapshot_id=None,\n                      volume_type=None, metadata=None, availability_zone=None):\n         check_policy(context, 'create')\n-        if snapshot is not None:\n+        if snapshot_id is not None:\n+            snapshot = self.volume_api.get_snapshot(context, snapshot_id)\n             if snapshot['status'] != \"available\":\n                 msg = _(\"status must be available\")\n                 raise exception.InvalidSnapshot(reason=msg)\n", 
            "date_created": "2012-08-20 12:28:51.110925+00:00", 
            "author": "https://api.launchpad.net/1.0/~yosshy"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/12253", 
            "date_created": "2012-08-31 13:09:05.367328+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/12253\nCommitted: http://github.com/openstack/nova/commit/1591c94bdd5f2b746be362dee5f0dd4068994ea4\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1591c94bdd5f2b746be362dee5f0dd4068994ea4\nAuthor: Unmesh Gurjar <email address hidden>\nDate:   Fri Aug 31 05:59:52 2012 -0700\n\n    Fixed boot from snapshot failure.\n    \n    Passed the snapshot_id to cinder client from create API. Previously it was\n    failing since snapshot was being passed instead of snapshot_id.\n    \n    Fixes LP: #1029211\n    \n    Change-Id: I4aa1aca9067b2a282b9b46d909ef8342bf933a46\n", 
            "date_created": "2012-08-31 17:10:50.231059+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}