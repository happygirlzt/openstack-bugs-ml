{
    "status": "Fix Released", 
    "last_updated": "2016-10-18 17:02:36.413935+00:00", 
    "description": "If you pass an invalid snapshot while creating the instance then it's returning 500 InternalServerError. \nIdeally it should return 400 HTTPBadRequest as snapshot doesn't exists.\n\nSteps to reproduce:\n\nCommand:\n\nnova boot --snapshot <invalid-snapshot-id> --flavor 1 new2\n\nOutput:\n\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.SnapshotNotFound'> (HTTP 500) (Request-ID: req-ead10ac5-5b57-4497-b772-66cd40b5e2eb)\n\n\nn-api logs:\n\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 576, in create\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     **create_kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1511, in create\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1101, in _create_instance\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     context, block_device_mapping, legacy_bdm)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1036, in _get_bdm_image_metadata\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     snapshot = self.volume_api.get_snapshot(context, snapshot_id)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 188, in wrapper\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     res = method(self, ctx, *args, **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 227, in wrapper\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     _reraise(exception.SnapshotNotFound(snapshot_id=snapshot_id))\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 246, in _reraise\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     six.reraise(type(desired_exc), desired_exc, sys.exc_info()[2])\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 225, in wrapper\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     res = method(self, ctx, snapshot_id, *args, **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 463, in get_snapshot\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     item = cinderclient(context).volume_snapshots.get(snapshot_id)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/v3/volume_snapshots.py\", line 107, in get\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     return self._get(\"/snapshots/%s\" % snapshot_id, \"snapshot\")\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/base.py\", line 303, in _get\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     resp, body = self.api.client.get(url)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 143, in get\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     return self._cs_request(url, 'GET', **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 134, in _cs_request\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     return self.request(url, method, **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 123, in request\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     raise exceptions.from_response(resp, body)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions SnapshotNotFound: Snapshot cfa5f789-6771-4fb0-abe3-b82301bbab86 could not be found.\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1614097", 
    "owner": "https://api.launchpad.net/1.0/~bhagyashri-shewale", 
    "id": 1614097, 
    "index": 6380, 
    "created": "2016-08-17 13:16:05.916613+00:00", 
    "title": "nova boot fails with 500 InternalServerError for invalid snapshot id", 
    "comments": [
        {
            "content": "If you pass an invalid snapshot while creating the instance then it's returning 500 InternalServerError. \nIdeally it should return 400 HTTPBadRequest as snapshot doesn't exists.\n\nSteps to reproduce:\n\nCommand:\n\nnova boot --snapshot <invalid-snapshot-id> --flavor 1 new2\n\nOutput:\n\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.SnapshotNotFound'> (HTTP 500) (Request-ID: req-ead10ac5-5b57-4497-b772-66cd40b5e2eb)\n\n\nn-api logs:\n\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 576, in create\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     **create_kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1511, in create\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1101, in _create_instance\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     context, block_device_mapping, legacy_bdm)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1036, in _get_bdm_image_metadata\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     snapshot = self.volume_api.get_snapshot(context, snapshot_id)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 188, in wrapper\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     res = method(self, ctx, *args, **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 227, in wrapper\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     _reraise(exception.SnapshotNotFound(snapshot_id=snapshot_id))\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 246, in _reraise\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     six.reraise(type(desired_exc), desired_exc, sys.exc_info()[2])\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 225, in wrapper\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     res = method(self, ctx, snapshot_id, *args, **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/volume/cinder.py\", line 463, in get_snapshot\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     item = cinderclient(context).volume_snapshots.get(snapshot_id)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/v3/volume_snapshots.py\", line 107, in get\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     return self._get(\"/snapshots/%s\" % snapshot_id, \"snapshot\")\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/base.py\", line 303, in _get\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     resp, body = self.api.client.get(url)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 143, in get\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     return self._cs_request(url, 'GET', **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 134, in _cs_request\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     return self.request(url, method, **kwargs)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 123, in request\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions     raise exceptions.from_response(resp, body)\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions SnapshotNotFound: Snapshot cfa5f789-6771-4fb0-abe3-b82301bbab86 could not be found.\n2016-08-17 17:05:48.033 TRACE nova.api.openstack.extensions", 
            "date_created": "2016-08-17 13:16:05.916613+00:00", 
            "author": "https://api.launchpad.net/1.0/~dinesh-bhor"
        }, 
        {
            "content": "Hi all,\n\nI am working on this, soon will submit the patch for review.", 
            "date_created": "2016-08-23 06:08:14.366514+00:00", 
            "author": "https://api.launchpad.net/1.0/~dinesh-bhor"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/360941\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=86bce560ec62d8813903bdd0b13ca9840dc0dcf7\nSubmitter: Jenkins\nBranch:    master\n\ncommit 86bce560ec62d8813903bdd0b13ca9840dc0dcf7\nAuthor: bhagyashris <email address hidden>\nDate:   Fri Aug 19 19:21:46 2016 +0530\n\n    Return 400 error for non-existing snapshot_id\n    \n    If you pass non-existing snapshot_id to the boot server api,\n    it returns HTTP 500 error.\n    This patch fixes this issue by catching SnapshotNotFound\n    exception and raising HTTPBadRequest in controller.\n    \n    Closes-Bug: #1614097\n    Change-Id: Ieea5b4815e9078f9c22069a6fb772cd67b8de3a2\n", 
            "date_created": "2016-09-03 08:26:00.725327+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0rc1 release candidate.", 
            "date_created": "2016-09-26 20:14:59.121452+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0rc1 release candidate.", 
            "date_created": "2016-10-18 17:02:35.280365+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}