{
    "status": "Confirmed", 
    "last_updated": "2017-06-23 16:57:04.321492+00:00", 
    "description": "During gate runs we're running \n\nnova-manage db sync\nnova-manage api_db sync\n\nThis leads to the following rather scary stack trace:\n\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters [req-962d0663-409b-4e1a-8552-52ecb451a165 - -] DBAPIError exception wrapped from (pymysql.err.InternalError) (1049, u\"Unknown database 'nova_api'\")\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters Traceback (most recent call last):\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return fn()\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 318, in unique_connection\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return _ConnectionFairy._checkout(self)\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     fairy = _ConnectionRecord.checkout(pool)\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     rec = pool._do_get()\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1060, in _do_get\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     self._dec_overflow()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     compat.reraise(exc_type, exc_value, exc_tb)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1057, in _do_get\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return self._create_connection()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 323, in _create_connection\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return _ConnectionRecord(self)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 449, in __init__\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     self.connection = self.__connect()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 607, in __connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     connection = self.__pool._invoke_creator(self)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/strategies.py\", line 97, in connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return dialect.connect(*cargs, **cparams)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 385, in connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return self.dbapi.connect(*cargs, **cparams)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/__init__.py\", line 90, in Connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return Connection(*args, **kwargs)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 688, in __init__\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     self.connect()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 906, in connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     self._request_authentication()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1114, in _request_authentication\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     auth_packet = self._read_packet()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 981, in _read_packet\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     packet.check_error()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 393, in check_error\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     err.raise_mysql_exception(self._data)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/err.py\", line 107, in raise_mysql_exception\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     raise errorclass(errno, errval)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters InternalError: (1049, u\"Unknown database 'nova_api'\")\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters \n2016-10-06 13:19:15.280 | ERROR: could not access cell mapping database - has api db been created?\n\n\nThis is pretty scary for admins, but it turns out it's pretty useless and non fatal. While we can fix the gate to do these operations in the other order, it would be nice if we weren't spewing this scary traceback to users.\n\nIdeally we could tell engine fascade about issues we don't care about, so that it wouldn't log behind the scenes for us. The alternative is Nova turning off logging selectively, which is less than ideal as the granularity is going to be different than we might expect.", 
    "tags": [
        "db", 
        "newton-backport-potential"
    ], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1631033", 
    "owner": "None", 
    "id": 1631033, 
    "index": 4639, 
    "created": "2016-10-06 15:04:26.206170+00:00", 
    "title": "scary traceback if nova-manage db sync is run before nova-manage api_db sync", 
    "comments": [
        {
            "content": "During gate runs we're running \n\nnova-manage db sync\nnova-manage api_db sync\n\nThis leads to the following rather scary stack trace:\n\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters [req-962d0663-409b-4e1a-8552-52ecb451a165 - -] DBAPIError exception wrapped from (pymysql.err.InternalError) (1049, u\"Unknown database 'nova_api'\")\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters Traceback (most recent call last):\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return fn()\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 318, in unique_connection\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return _ConnectionFairy._checkout(self)\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     fairy = _ConnectionRecord.checkout(pool)\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     rec = pool._do_get()\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1060, in _do_get\n2016-10-06 13:19:15.279 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     self._dec_overflow()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     compat.reraise(exc_type, exc_value, exc_tb)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1057, in _do_get\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return self._create_connection()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 323, in _create_connection\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return _ConnectionRecord(self)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 449, in __init__\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     self.connection = self.__connect()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 607, in __connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     connection = self.__pool._invoke_creator(self)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/strategies.py\", line 97, in connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return dialect.connect(*cargs, **cparams)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 385, in connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return self.dbapi.connect(*cargs, **cparams)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/__init__.py\", line 90, in Connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     return Connection(*args, **kwargs)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 688, in __init__\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     self.connect()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 906, in connect\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     self._request_authentication()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1114, in _request_authentication\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     auth_packet = self._read_packet()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 981, in _read_packet\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     packet.check_error()\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 393, in check_error\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     err.raise_mysql_exception(self._data)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/err.py\", line 107, in raise_mysql_exception\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters     raise errorclass(errno, errval)\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters InternalError: (1049, u\"Unknown database 'nova_api'\")\n2016-10-06 13:19:15.280 | 2016-10-06 13:19:15.277 21612 ERROR oslo_db.sqlalchemy.exc_filters \n2016-10-06 13:19:15.280 | ERROR: could not access cell mapping database - has api db been created?\n\n\nThis is pretty scary for admins, but it turns out it's pretty useless and non fatal. While we can fix the gate to do these operations in the other order, it would be nice if we weren't spewing this scary traceback to users.\n\nIdeally we could tell engine fascade about issues we don't care about, so that it wouldn't log behind the scenes for us. The alternative is Nova turning off logging selectively, which is less than ideal as the granularity is going to be different than we might expect.", 
            "date_created": "2016-10-06 15:04:26.206170+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Example gate run - http://logs.openstack.org/60/378560/4/check/gate-tempest-dsvm-neutron-full-ubuntu-xenial/b18e638/logs/devstacklog.txt.gz#_2016-10-06_13_19_15_279", 
            "date_created": "2016-10-06 15:04:48.527861+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "This is a result of adding https://review.openstack.org/#/c/274885/25/nova/cmd/manage.py to Nova. It's expected that this might happen, attempting to access the nova_api db before it's created, which is why we \"except Exception\" and print a simple message explaining what happened.", 
            "date_created": "2016-10-06 15:09:14.108107+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "I was just explaining why it happens. I agree with what Sean wrote that it be nice to be able to squelch the traceback in oslo.db for this case.", 
            "date_created": "2016-10-06 15:10:55.397094+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "https://review.openstack.org/384581", 
            "date_created": "2016-10-10 16:18:04.940951+00:00", 
            "author": "https://api.launchpad.net/1.0/~rpodolyaka"
        }, 
        {
            "content": "This issue was fixed in the openstack/oslo.db 4.14.0 release.", 
            "date_created": "2016-10-19 04:38:50.359732+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/oslo.db 4.14.0 release.", 
            "date_created": "2016-11-10 02:58:01.671623+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/oslo.db 4.14.0 release.", 
            "date_created": "2016-11-10 11:36:26.042724+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/oslo.db 4.14.0 release.", 
            "date_created": "2016-11-11 13:44:59.838204+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}