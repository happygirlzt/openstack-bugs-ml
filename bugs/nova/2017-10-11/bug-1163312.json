{
    "status": "Invalid", 
    "last_updated": "2014-09-04 18:56:42.110886+00:00", 
    "description": "Running nova-network on Fedora 17, Grizzly (openstack-nova-2013.1-0.10.g3.fc19.noarch) setting network_manager=nova.network.manager.FlatManager, nova-network starts and runs properly. However when changing to network_manager=nova.network.manager.FlatDHCPManager and restarting nova-network, it fails with the following in the file /var/log/nova/network.log:\n\n2013-04-02 07:29:12.139 1571 AUDIT nova.service [-] Starting network node (version 2013.1-0.10.g3.fc19)\n2013-04-02 07:29:12.140 1571 DEBUG nova.network.l3 [-] Initializing linux_net L3 driver initialize /usr/lib/python2.7/site-packages/nova/network/l3.py:81\n2013-04-02 07:29:12.140 1571 DEBUG nova.openstack.common.lockutils [-] Got semaphore \"iptables\" for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/co\nmmon/lockutils.py:185\n2013-04-02 07:29:12.140 1571 DEBUG nova.openstack.common.lockutils [-] Attempting to grab file lock \"iptables\" for method \"_apply\"... inner /usr/lib/python2.7/site-packages/no\nva/openstack/common/lockutils.py:196\n2013-04-02 07:29:12.214 1571 CRITICAL nova [-] [Errno 13] Permission denied: '/var/lock/nova'\n2013-04-02 07:29:12.214 1571 TRACE nova Traceback (most recent call last):\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/bin/nova-network\", line 54, in <module>\n2013-04-02 07:29:12.214 1571 TRACE nova     service.wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 689, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     _launcher.wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 209, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     super(ServiceLauncher, self).wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 179, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     service.wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 166, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     return self._exit_event.wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 116, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     return hubs.get_hub().switch()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2013-04-02 07:29:12.214 1571 TRACE nova     return self.greenlet.switch()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 192, in main\n2013-04-02 07:29:12.214 1571 TRACE nova     result = function(*args, **kwargs)\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 147, in run_server\n2013-04-02 07:29:12.214 1571 TRACE nova     server.start()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 429, in start\n2013-04-02 07:29:12.214 1571 TRACE nova     self.manager.init_host()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1562, in init_host\n2013-04-02 07:29:12.214 1571 TRACE nova     self.l3driver.initialize()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/l3.py\", line 82, in initialize\n2013-04-02 07:29:12.214 1571 TRACE nova     linux_net.init_host()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 633, in init_host\n2013-04-02 07:29:12.214 1571 TRACE nova     add_snat_rule(ip_range)\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 623, in add_snat_rule\n2013-04-02 07:29:12.214 1571 TRACE nova     iptables_manager.apply()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 383, in apply\n2013-04-02 07:29:12.214 1571 TRACE nova     self._apply()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 210, in inner\n2013-04-02 07:29:12.214 1571 TRACE nova     fileutils.ensure_tree(local_lock_path)\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/fileutils.py\", line 29, in ensure_tree\n2013-04-02 07:29:12.214 1571 TRACE nova     os.makedirs(path)\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib64/python2.7/os.py\", line 157, in makedirs\n2013-04-02 07:29:12.214 1571 TRACE nova     mkdir(name, mode)\n2013-04-02 07:29:12.214 1571 TRACE nova OSError: [Errno 13] Permission denied: '/var/lock/nova'\n\nAfter creating the directory /var/lock/nova with the ownership of: nova:root\n\nnova-network now fails with the error:\n\n2013-04-02 07:30:37.143 1838 DEBUG nova.service [-] conductor : <oslo.config.cfg.GroupAttr object at 0x25209d0> wait /usr/lib/python2.7/site-packages/nova/service.py:205\n2013-04-02 07:30:37.144 1838 AUDIT nova.service [-] Starting network node (version 2013.1-0.10.g3.fc19)\n2013-04-02 07:30:37.144 1838 DEBUG nova.network.l3 [-] Initializing linux_net L3 driver initialize /usr/lib/python2.7/site-packages/nova/network/l3.py:81\n2013-04-02 07:30:37.145 1838 DEBUG nova.openstack.common.lockutils [-] Got semaphore \"iptables\" for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py:185\n2013-04-02 07:30:37.145 1838 DEBUG nova.openstack.common.lockutils [-] Attempting to grab file lock \"iptables\" for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py:196\n2013-04-02 07:30:37.145 1838 DEBUG nova.openstack.common.lockutils [-] Got file lock \"iptables\" at /var/lock/nova/nova-iptables for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py:227\n2013-04-02 07:30:37.145 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-save -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:37.190 1838 DEBUG nova.utils [-] Result was 0 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:37.191 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:37.243 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:37.244 1838 DEBUG nova.utils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/site-packages/nova/utils.py:249\n2013-04-02 07:30:38.026 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:38.085 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:38.086 1838 DEBUG nova.utils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/site-packages/nova/utils.py:249\n2013-04-02 07:30:38.567 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:38.619 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:38.620 1838 DEBUG nova.utils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/site-packages/nova/utils.py:249\n2013-04-02 07:30:39.061 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:39.110 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:39.111 1838 DEBUG nova.utils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/site-packages/nova/utils.py:249\n2013-04-02 07:30:40.323 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:40.379 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:40.380 1838 DEBUG nova.openstack.common.lockutils [-] Released file lock \"iptables\" at /var/lock/nova/nova-iptables for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py:234\n2013-04-02 07:30:40.400 1838 CRITICAL nova [-] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\nExit code: 2\nStdout: ''\nStderr: \"Bad argument `SNAT'\\nError occurred at line: 36\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2013-04-02 07:30:40.400 1838 TRACE nova Traceback (most recent call last):\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/bin/nova-network\", line 54, in <module>\n2013-04-02 07:30:40.400 1838 TRACE nova     service.wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 689, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     _launcher.wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 209, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     super(ServiceLauncher, self).wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 179, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     service.wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 166, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     return self._exit_event.wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 116, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     return hubs.get_hub().switch()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2013-04-02 07:30:40.400 1838 TRACE nova     return self.greenlet.switch()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 192, in main\n2013-04-02 07:30:40.400 1838 TRACE nova     result = function(*args, **kwargs)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 147, in run_server\n2013-04-02 07:30:40.400 1838 TRACE nova     server.start()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 429, in start\n2013-04-02 07:30:40.400 1838 TRACE nova     self.manager.init_host()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1562, in init_host\n2013-04-02 07:30:40.400 1838 TRACE nova     self.l3driver.initialize()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/l3.py\", line 82, in initialize\n2013-04-02 07:30:40.400 1838 TRACE nova     linux_net.init_host()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 633, in init_host\n2013-04-02 07:30:40.400 1838 TRACE nova     add_snat_rule(ip_range)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 623, in add_snat_rule\n2013-04-02 07:30:40.400 1838 TRACE nova     iptables_manager.apply()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 383, in apply\n2013-04-02 07:30:40.400 1838 TRACE nova     self._apply()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 228, in inner\n2013-04-02 07:30:40.400 1838 TRACE nova     retval = f(*args, **kwargs)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 409, in _apply\n2013-04-02 07:30:40.400 1838 TRACE nova     attempts=5)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 1126, in _execute\n2013-04-02 07:30:40.400 1838 TRACE nova     return utils.execute(*cmd, **kwargs)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/utils.py\", line 243, in execute\n2013-04-02 07:30:40.400 1838 TRACE nova     cmd=' '.join(cmd))\n2013-04-02 07:30:40.400 1838 TRACE nova ProcessExecutionError: Unexpected error while running command.\n2013-04-02 07:30:40.400 1838 TRACE nova Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\n2013-04-02 07:30:40.400 1838 TRACE nova Exit code: 2\n2013-04-02 07:30:40.400 1838 TRACE nova Stdout: ''\n2013-04-02 07:30:40.400 1838 TRACE nova Stderr: \"Bad argument `SNAT'\\nError occurred at line: 36\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2013-04-02 07:30:40.400 1838 TRACE nova \n\nSELinux is disabled and /etc/nova/nova.conf:\n\n[DEFAULT]\n\n# LOGS/STATE\n#verbose=True\n#debug=True\nlogdir=/var/log/nova\nstate_path=/var/lib/nova\nlock_path=/var/lock/nova\nrootwrap_config=/etc/nova/rootwrap.conf\n\n# SCHEDULER\ncompute_scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler\n\n# VOLUMES\nvolume_driver=nova.volume.driver.ISCSIDriver\nvolume_group=nova-volumes\nvolume_name_template=volume-%s\niscsi_helper=tgtadm\n\n# DATABASE\nsql_connection=mysql://nova:nova@192.168.122.118/nova\n\n# COMPUTE\nlibvirt_type=kvm\ncompute_driver=libvirt.LibvirtDriver\ninstance_name_template=instance-%08x\napi_paste_config=/etc/nova/api-paste.ini\n\n# COMPUTE/APIS: if you have separate configs for separate services\n# this flag is required for both nova-api and nova-compute\nallow_resize_to_same_host=True\n\n# APIS\nosapi_compute_extension=nova.api.openstack.compute.contrib.standard_extensions\nec2_dmz_host=192.168.122.118\ns3_host=192.168.122.118\n\n\n[root@controller ~]# nova-manage service list\nBinary           Host                                 Zone             Status     State Updated_At\nnova-conductor   controller                           internal         enabled    :-)   2013-04-02 13:05:26\nnova-scheduler   controller                           internal         enabled    :-)   2013-04-02 13:05:26\nnova-cert        controller                           internal         enabled    :-)   2013-04-02 13:05:26\nnova-network     controller                           internal         enabled    XXX   2013-04-02 12:54:12\nnova-compute     controller                           nova             enabled    :-)   2013-04-02 13:05:24\n\n# RABBITMQ\nrabbit_host=192.168.122.118\nqpid_host=192.168.122.118\n#rpc_backend=nova.rpc.impl_qpid\nrpc_backend=nova.openstack.common.rpc.impl_qpid\n\n# GLANCE\nimage_service=nova.image.glance.GlanceImageService\nglance_api_servers=192.168.122.118:9292\n\n# NETWORK\ndhcpbridge_flagfile=/etc/nova/nova.conf\ndhcpbridge=/usr/bin/nova-dhcpbridge\n#network_manager=nova.network.manager.FlatDHCPManager\nnetwork_manager=nova.network.manager.FlatManager\n#force_dhcp_release=True\ndhcpbridge_flagfile=/etc/nova/nova.conf\nfirewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver\n# Change my_ip to match each host\nmy_ip=192.168.122.118\npublic_interface=eth0\nvlan_interface=eth0\nflat-injected=False\nflat_network_bridge=br100\nflat_interface=eth1\nfixed_range=''\n\n# NOVNC CONSOLE\nnovncproxy_base_url=http://192.168.122.178:6080/vnc_auto.html\n# Change vncserver_proxyclient_address and vncserver_listen to match each compute host\nvncserver_proxyclient_address=192.168.122.178\nvncserver_listen=192.168.122.178\n\n# AUTHENTICATION\nauth_strategy=keystone\n[keystone_authtoken]\nauth_host = 192.168.122.118\nauth_port = 35357\nauth_protocol = http\nadmin_tenant_name = service\nadmin_user = nova\nadmin_password = nova\nsigning_dirname = /tmp/keystone-signing-nova", 
    "tags": [
        "network"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1163312", 
    "owner": "None", 
    "id": 1163312, 
    "index": 3563, 
    "created": "2013-04-02 13:06:10.362706+00:00", 
    "title": "nova-network fails using FlatDHCPManager in Grizzly", 
    "comments": [
        {
            "content": "Running nova-network on Fedora 17, Grizzly (openstack-nova-2013.1-0.10.g3.fc19.noarch) setting network_manager=nova.network.manager.FlatManager, nova-network starts and runs properly. However when changing to network_manager=nova.network.manager.FlatDHCPManager and restarting nova-network, it fails with the following in the file /var/log/nova/network.log:\n\n2013-04-02 07:29:12.139 1571 AUDIT nova.service [-] Starting network node (version 2013.1-0.10.g3.fc19)\n2013-04-02 07:29:12.140 1571 DEBUG nova.network.l3 [-] Initializing linux_net L3 driver initialize /usr/lib/python2.7/site-packages/nova/network/l3.py:81\n2013-04-02 07:29:12.140 1571 DEBUG nova.openstack.common.lockutils [-] Got semaphore \"iptables\" for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/co\nmmon/lockutils.py:185\n2013-04-02 07:29:12.140 1571 DEBUG nova.openstack.common.lockutils [-] Attempting to grab file lock \"iptables\" for method \"_apply\"... inner /usr/lib/python2.7/site-packages/no\nva/openstack/common/lockutils.py:196\n2013-04-02 07:29:12.214 1571 CRITICAL nova [-] [Errno 13] Permission denied: '/var/lock/nova'\n2013-04-02 07:29:12.214 1571 TRACE nova Traceback (most recent call last):\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/bin/nova-network\", line 54, in <module>\n2013-04-02 07:29:12.214 1571 TRACE nova     service.wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 689, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     _launcher.wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 209, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     super(ServiceLauncher, self).wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 179, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     service.wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 166, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     return self._exit_event.wait()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 116, in wait\n2013-04-02 07:29:12.214 1571 TRACE nova     return hubs.get_hub().switch()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2013-04-02 07:29:12.214 1571 TRACE nova     return self.greenlet.switch()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 192, in main\n2013-04-02 07:29:12.214 1571 TRACE nova     result = function(*args, **kwargs)\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 147, in run_server\n2013-04-02 07:29:12.214 1571 TRACE nova     server.start()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 429, in start\n2013-04-02 07:29:12.214 1571 TRACE nova     self.manager.init_host()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1562, in init_host\n2013-04-02 07:29:12.214 1571 TRACE nova     self.l3driver.initialize()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/l3.py\", line 82, in initialize\n2013-04-02 07:29:12.214 1571 TRACE nova     linux_net.init_host()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 633, in init_host\n2013-04-02 07:29:12.214 1571 TRACE nova     add_snat_rule(ip_range)\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 623, in add_snat_rule\n2013-04-02 07:29:12.214 1571 TRACE nova     iptables_manager.apply()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 383, in apply\n2013-04-02 07:29:12.214 1571 TRACE nova     self._apply()\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 210, in inner\n2013-04-02 07:29:12.214 1571 TRACE nova     fileutils.ensure_tree(local_lock_path)\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/fileutils.py\", line 29, in ensure_tree\n2013-04-02 07:29:12.214 1571 TRACE nova     os.makedirs(path)\n2013-04-02 07:29:12.214 1571 TRACE nova   File \"/usr/lib64/python2.7/os.py\", line 157, in makedirs\n2013-04-02 07:29:12.214 1571 TRACE nova     mkdir(name, mode)\n2013-04-02 07:29:12.214 1571 TRACE nova OSError: [Errno 13] Permission denied: '/var/lock/nova'\n\nAfter creating the directory /var/lock/nova with the ownership of: nova:root\n\nnova-network now fails with the error:\n\n2013-04-02 07:30:37.143 1838 DEBUG nova.service [-] conductor : <oslo.config.cfg.GroupAttr object at 0x25209d0> wait /usr/lib/python2.7/site-packages/nova/service.py:205\n2013-04-02 07:30:37.144 1838 AUDIT nova.service [-] Starting network node (version 2013.1-0.10.g3.fc19)\n2013-04-02 07:30:37.144 1838 DEBUG nova.network.l3 [-] Initializing linux_net L3 driver initialize /usr/lib/python2.7/site-packages/nova/network/l3.py:81\n2013-04-02 07:30:37.145 1838 DEBUG nova.openstack.common.lockutils [-] Got semaphore \"iptables\" for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py:185\n2013-04-02 07:30:37.145 1838 DEBUG nova.openstack.common.lockutils [-] Attempting to grab file lock \"iptables\" for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py:196\n2013-04-02 07:30:37.145 1838 DEBUG nova.openstack.common.lockutils [-] Got file lock \"iptables\" at /var/lock/nova/nova-iptables for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py:227\n2013-04-02 07:30:37.145 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-save -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:37.190 1838 DEBUG nova.utils [-] Result was 0 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:37.191 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:37.243 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:37.244 1838 DEBUG nova.utils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/site-packages/nova/utils.py:249\n2013-04-02 07:30:38.026 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:38.085 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:38.086 1838 DEBUG nova.utils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/site-packages/nova/utils.py:249\n2013-04-02 07:30:38.567 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:38.619 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:38.620 1838 DEBUG nova.utils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/site-packages/nova/utils.py:249\n2013-04-02 07:30:39.061 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:39.110 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:39.111 1838 DEBUG nova.utils [-] ['sudo', 'nova-rootwrap', '/etc/nova/rootwrap.conf', 'iptables-restore', '-c'] failed. Retrying. execute /usr/lib/python2.7/site-packages/nova/utils.py:249\n2013-04-02 07:30:40.323 1838 DEBUG nova.utils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/site-packages/nova/utils.py:212\n2013-04-02 07:30:40.379 1838 DEBUG nova.utils [-] Result was 2 execute /usr/lib/python2.7/site-packages/nova/utils.py:236\n2013-04-02 07:30:40.380 1838 DEBUG nova.openstack.common.lockutils [-] Released file lock \"iptables\" at /var/lock/nova/nova-iptables for method \"_apply\"... inner /usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py:234\n2013-04-02 07:30:40.400 1838 CRITICAL nova [-] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\nExit code: 2\nStdout: ''\nStderr: \"Bad argument `SNAT'\\nError occurred at line: 36\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2013-04-02 07:30:40.400 1838 TRACE nova Traceback (most recent call last):\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/bin/nova-network\", line 54, in <module>\n2013-04-02 07:30:40.400 1838 TRACE nova     service.wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 689, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     _launcher.wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 209, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     super(ServiceLauncher, self).wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 179, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     service.wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 166, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     return self._exit_event.wait()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 116, in wait\n2013-04-02 07:30:40.400 1838 TRACE nova     return hubs.get_hub().switch()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2013-04-02 07:30:40.400 1838 TRACE nova     return self.greenlet.switch()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 192, in main\n2013-04-02 07:30:40.400 1838 TRACE nova     result = function(*args, **kwargs)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 147, in run_server\n2013-04-02 07:30:40.400 1838 TRACE nova     server.start()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 429, in start\n2013-04-02 07:30:40.400 1838 TRACE nova     self.manager.init_host()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1562, in init_host\n2013-04-02 07:30:40.400 1838 TRACE nova     self.l3driver.initialize()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/l3.py\", line 82, in initialize\n2013-04-02 07:30:40.400 1838 TRACE nova     linux_net.init_host()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 633, in init_host\n2013-04-02 07:30:40.400 1838 TRACE nova     add_snat_rule(ip_range)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 623, in add_snat_rule\n2013-04-02 07:30:40.400 1838 TRACE nova     iptables_manager.apply()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 383, in apply\n2013-04-02 07:30:40.400 1838 TRACE nova     self._apply()\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 228, in inner\n2013-04-02 07:30:40.400 1838 TRACE nova     retval = f(*args, **kwargs)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 409, in _apply\n2013-04-02 07:30:40.400 1838 TRACE nova     attempts=5)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 1126, in _execute\n2013-04-02 07:30:40.400 1838 TRACE nova     return utils.execute(*cmd, **kwargs)\n2013-04-02 07:30:40.400 1838 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/utils.py\", line 243, in execute\n2013-04-02 07:30:40.400 1838 TRACE nova     cmd=' '.join(cmd))\n2013-04-02 07:30:40.400 1838 TRACE nova ProcessExecutionError: Unexpected error while running command.\n2013-04-02 07:30:40.400 1838 TRACE nova Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c\n2013-04-02 07:30:40.400 1838 TRACE nova Exit code: 2\n2013-04-02 07:30:40.400 1838 TRACE nova Stdout: ''\n2013-04-02 07:30:40.400 1838 TRACE nova Stderr: \"Bad argument `SNAT'\\nError occurred at line: 36\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n2013-04-02 07:30:40.400 1838 TRACE nova \n\nSELinux is disabled and /etc/nova/nova.conf:\n\n[DEFAULT]\n\n# LOGS/STATE\n#verbose=True\n#debug=True\nlogdir=/var/log/nova\nstate_path=/var/lib/nova\nlock_path=/var/lock/nova\nrootwrap_config=/etc/nova/rootwrap.conf\n\n# SCHEDULER\ncompute_scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler\n\n# VOLUMES\nvolume_driver=nova.volume.driver.ISCSIDriver\nvolume_group=nova-volumes\nvolume_name_template=volume-%s\niscsi_helper=tgtadm\n\n# DATABASE\nsql_connection=mysql://nova:nova@192.168.122.118/nova\n\n# COMPUTE\nlibvirt_type=kvm\ncompute_driver=libvirt.LibvirtDriver\ninstance_name_template=instance-%08x\napi_paste_config=/etc/nova/api-paste.ini\n\n# COMPUTE/APIS: if you have separate configs for separate services\n# this flag is required for both nova-api and nova-compute\nallow_resize_to_same_host=True\n\n# APIS\nosapi_compute_extension=nova.api.openstack.compute.contrib.standard_extensions\nec2_dmz_host=192.168.122.118\ns3_host=192.168.122.118\n\n\n[root@controller ~]# nova-manage service list\nBinary           Host                                 Zone             Status     State Updated_At\nnova-conductor   controller                           internal         enabled    :-)   2013-04-02 13:05:26\nnova-scheduler   controller                           internal         enabled    :-)   2013-04-02 13:05:26\nnova-cert        controller                           internal         enabled    :-)   2013-04-02 13:05:26\nnova-network     controller                           internal         enabled    XXX   2013-04-02 12:54:12\nnova-compute     controller                           nova             enabled    :-)   2013-04-02 13:05:24\n\n# RABBITMQ\nrabbit_host=192.168.122.118\nqpid_host=192.168.122.118\n#rpc_backend=nova.rpc.impl_qpid\nrpc_backend=nova.openstack.common.rpc.impl_qpid\n\n# GLANCE\nimage_service=nova.image.glance.GlanceImageService\nglance_api_servers=192.168.122.118:9292\n\n# NETWORK\ndhcpbridge_flagfile=/etc/nova/nova.conf\ndhcpbridge=/usr/bin/nova-dhcpbridge\n#network_manager=nova.network.manager.FlatDHCPManager\nnetwork_manager=nova.network.manager.FlatManager\n#force_dhcp_release=True\ndhcpbridge_flagfile=/etc/nova/nova.conf\nfirewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver\n# Change my_ip to match each host\nmy_ip=192.168.122.118\npublic_interface=eth0\nvlan_interface=eth0\nflat-injected=False\nflat_network_bridge=br100\nflat_interface=eth1\nfixed_range=''\n\n# NOVNC CONSOLE\nnovncproxy_base_url=http://192.168.122.178:6080/vnc_auto.html\n# Change vncserver_proxyclient_address and vncserver_listen to match each compute host\nvncserver_proxyclient_address=192.168.122.178\nvncserver_listen=192.168.122.178\n\n# AUTHENTICATION\nauth_strategy=keystone\n[keystone_authtoken]\nauth_host = 192.168.122.118\nauth_port = 35357\nauth_protocol = http\nadmin_tenant_name = service\nadmin_user = nova\nadmin_password = nova\nsigning_dirname = /tmp/keystone-signing-nova", 
            "date_created": "2013-04-02 13:06:10.362706+00:00", 
            "author": "https://api.launchpad.net/1.0/~phil-hopkins-a"
        }, 
        {
            "content": "the non-existence of /var/lock/nova is a packaging problem. Not sure what is going on with the iptables command however. Can you post a dump of your existing iptables rules?", 
            "date_created": "2013-04-04 18:22:11.478223+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Here they are:\n\niptables -L\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \nACCEPT     tcp  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED\nACCEPT     icmp --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere            \nACCEPT     tcp  --  anywhere             anywhere             state NEW tcp dpt:ssh\nREJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination         \nREJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination \n\nIf I clear all of the iptables to:\n iptables -L\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\n\nThe same problem occurs.\n\nPhil", 
            "date_created": "2013-04-04 21:42:26.748282+00:00", 
            "author": "https://api.launchpad.net/1.0/~phil-hopkins-a"
        }, 
        {
            "content": "Can you post the results of iptables-save? Also, are there any networks actually defined?", 
            "date_created": "2013-05-08 20:51:56.321579+00:00", 
            "author": "https://api.launchpad.net/1.0/~beagles"
        }, 
        {
            "content": "Can u post the results of \r\n\r\niptables -t filter -S\r\nsudo iptables -t nat -S\r\n\r\nSeems some problem with in this piece of code.\r\n\r\n        for cmd, tables in s:\r\n            for table in tables:\r\n                current_table, _err = self.execute('%s-save' % (cmd,), '-c',\r\n                                                   '-t', '%s' % (table,),\r\n                                                   run_as_root=True,\r\n                                                   attempts=5)\r\n                current_lines = current_table.split('\\n')\r\n                new_filter = self._modify_rules(current_lines,\r\n                                                tables[table])\r\n                self.execute('%s-restore' % (cmd,), '-c', run_as_root=True,\r\n                             process_input='\\n'.join(new_filter),\r\n                             attempts=5)\r\n        LOG.debug(_(\"IPTablesManager.apply completed with success\"))\r\n\r\nI need output of the above commands to debug further.\r\n\r\njagan", 
            "date_created": "2013-05-23 05:57:09.865453+00:00", 
            "author": "https://api.launchpad.net/1.0/~jagankumar-k"
        }, 
        {
            "content": "really old incomplete bug", 
            "date_created": "2014-09-04 18:56:41.195278+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}