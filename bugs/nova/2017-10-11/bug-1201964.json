{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 15:10:00.797045+00:00", 
    "description": "When an invalid or not present MAC address is supplied to the virtual (ssh) power driver, any attempt to turn that node on just silently fails. This makes debugging much harder, because the only exception logged comes from the baremetal driver, namely, just that it failed to power on the target node. The issue is visible - with some eyestrain - only if one enables DEBUG mode. It would be better if there was a clear exception saying *why* it failed to power on -- eg, that there is no such MAC address.\n\nAn example of how the code misbehaves currently can be seen here. If the node's MAC can't be found, _check_for_node() returns '', so is_power_on() returns False indicating the power is off, rather than an indication that the node doesn't exist.\n\n142     def _check_for_node(self):\n143         LOG.debug(\"Looking up Name for Mac address %s.\" % self._mac_addresses)\n144         self._matched_name = ''\n145         full_node_list = self._get_full_node_list()\n146 \n147         for node in full_node_list:\n148             cmd = self._vp_cmd.get_node_macs.replace('{_NodeName_}', node)\n149             mac_address_list = self._run_command(cmd)\n150 \n151             for mac in mac_address_list:\n152                 if _normalize_mac(mac) in self._mac_addresses:\n153                     self._matched_name = ('\"%s\"' % node)\n154                     break\n155         return self._matched_name\n...\n193     def is_power_on(self):                                                                   \n194         LOG.debug(\"Checking if %s is running\" % self._node_name)                             \n195                                                                                              \n196         if not self._check_for_node():                                                       \n197             return False                                                                     \n198                                                                                              \n199         cmd = self._vp_cmd.list_running_cmd                                                  \n200         running_node_list = self._run_command(cmd)                                           \n201                                                                                              \n202         for node in running_node_list:                                                       \n203             if self._matched_name in node:                                                   \n204                 return True                                                                  \n205         return False", 
    "tags": [
        "baremetal"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1201964", 
    "owner": "https://api.launchpad.net/1.0/~nobodycam", 
    "id": 1201964, 
    "index": 1161, 
    "created": "2013-07-16 21:15:17.238836+00:00", 
    "title": "virtual power driver fails silently when MAC not found", 
    "comments": [
        {
            "content": "When an invalid or not present MAC address is supplied to the virtual (ssh) power driver, any attempt to turn that node on just silently fails. This makes debugging much harder, because the only exception logged comes from the baremetal driver, namely, just that it failed to power on the target node. The issue is visible - with some eyestrain - only if one enables DEBUG mode. It would be better if there was a clear exception saying *why* it failed to power on -- eg, that there is no such MAC address.\n\nAn example of how the code misbehaves currently can be seen here. If the node's MAC can't be found, _check_for_node() returns '', so is_power_on() returns False indicating the power is off, rather than an indication that the node doesn't exist.\n\n142     def _check_for_node(self):\n143         LOG.debug(\"Looking up Name for Mac address %s.\" % self._mac_addresses)\n144         self._matched_name = ''\n145         full_node_list = self._get_full_node_list()\n146 \n147         for node in full_node_list:\n148             cmd = self._vp_cmd.get_node_macs.replace('{_NodeName_}', node)\n149             mac_address_list = self._run_command(cmd)\n150 \n151             for mac in mac_address_list:\n152                 if _normalize_mac(mac) in self._mac_addresses:\n153                     self._matched_name = ('\"%s\"' % node)\n154                     break\n155         return self._matched_name\n...\n193     def is_power_on(self):                                                                   \n194         LOG.debug(\"Checking if %s is running\" % self._node_name)                             \n195                                                                                              \n196         if not self._check_for_node():                                                       \n197             return False                                                                     \n198                                                                                              \n199         cmd = self._vp_cmd.list_running_cmd                                                  \n200         running_node_list = self._run_command(cmd)                                           \n201                                                                                              \n202         for node in running_node_list:                                                       \n203             if self._matched_name in node:                                                   \n204                 return True                                                                  \n205         return False", 
            "date_created": "2013-07-16 21:15:17.238836+00:00", 
            "author": "https://api.launchpad.net/1.0/~devananda"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/37350", 
            "date_created": "2013-07-16 23:26:15.547326+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/37350\nCommitted: http://github.com/openstack/nova/commit/b64eca85b2276021bfe1031845cad34e2c291006\nSubmitter: Jenkins\nBranch:    master\n\ncommit b64eca85b2276021bfe1031845cad34e2c291006\nAuthor: Chris Krelle <email address hidden>\nDate:   Fri Aug 30 10:49:41 2013 -0700\n\n    Fix virtual power driver fails silently\n    \n    This patch changes the behavior of Virtual Power driver. VPD will\n    now raise an exception should the mac address for the node not\n    be found. It will also log the node name and mac address.\n    \n    fixes bug 1201964\n    Change-Id: I04a275cf8d2cc7665720329000fbe087aa636b21\n", 
            "date_created": "2013-09-04 17:34:31.580753+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/55719\nCommitted: http://github.com/openstack/ironic/commit/5da9ee2eed44d9799f3ecad84eca32a35444242a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5da9ee2eed44d9799f3ecad84eca32a35444242a\nAuthor: Ramakrishnan G <email address hidden>\nDate:   Mon Nov 11 23:07:07 2013 +0530\n\n    Fix error handling in ssh driver\n    \n    _get_power_status() of ironic.drivers.modules.ssh driver\n    should raise an exception NodeNotFound instead of returning\n    states.ERROR, when the node is actually not found.\n    \n    Closes-Bug: #1201964\n    Change-Id: I1193b0efef93dd7bf5e99cfa009da47882d53057\n", 
            "date_created": "2013-11-12 16:14:33.445389+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}