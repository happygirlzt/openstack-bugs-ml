{
    "status": "Invalid", 
    "last_updated": "2013-09-17 16:15:35.010396+00:00", 
    "description": "swap volume is success.\nBut block device mapping is not updated.\n\nTried Commit ID:b037993984229bb698050f20e8719b8c06ff2be3\n\n1. Try to swap volume from vol01 to vol02\n$ nova show aa2c1541-d298-478c-9a35-7759a07a77b0\n+--------------------------------------+------------------------------------------------------+\n| Property                             | Value                                                |\n+--------------------------------------+------------------------------------------------------+\n| status                               | ACTIVE                                               |\n| ...                                  | ...                                                  |\n| os-extended-volumes:volumes_attached | [{u'id': u'66230802-aed6-4a90-9dec-42fec910d13d'}]   |\n| ...                                  | ...                                                  |\n+--------------------------------------+------------------------------------------------------+\n\n$ mysql -e \"select is,device_name,volume_id from block_device_mapping where instance_uuid='aa2c1541-d298-478c-9a35-7759a07a77b0' and deleted=0\"\n+----+-------------+--------------------------------------+\n| id | device_name | volume_id                            |\n+----+-------------+--------------------------------------+\n| 17 | /dev/vda    | NULL                                 |\n| 19 | /dev/vdb    | 66230802-aed6-4a90-9dec-42fec910d13d |\n+----+-------------+--------------------------------------+\n\n$ cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable |             Attached to              |\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n| 66230802-aed6-4a90-9dec-42fec910d13d |   in-use  |    vol01     |  1   |     None    |  False   | aa2c1541-d298-478c-9a35-7759a07a77b0 |\n| c3d51a52-764a-4007-976a-136b544c561b | available |    vol02     |  1   |     None    |  False   |                                      |\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n\n$ virsh domblklist instance-0000000e\ntarget source\n------------------------------------------------\nvda    /opt/stack/data/nova/instances/aa2c1541-d298-478c-9a35-7759a07a77b0/disk\nvdb    /dev/disk/by-path/ip-192.168.122.180:3260-iscsi-iqn.2010-10.org.openstack:volume-66230802-aed6-4a90-9dec-42fec910d13d-lun-1\n\n2. Swap volume is successful, but block device mapping is not updated.\n$ cinder list => OK\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable |             Attached to              |\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n| 66230802-aed6-4a90-9dec-42fec910d13d | available |    vol01     |  1   |     None    |  False   |                                      |\n| c3d51a52-764a-4007-976a-136b544c561b |   in-use  |    vol02     |  1   |     None    |  False   | aa2c1541-d298-478c-9a35-7759a07a77b0 |\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n\n$ virsh domblklist instance-0000000e => OK\ntarget source\n------------------------------------------------\nvda    /opt/stack/data/nova/instances/aa2c1541-d298-478c-9a35-7759a07a77b0/disk\nvdb    /dev/disk/by-path/ip-192.168.122.218:3260-iscsi-iqn.2010-10.org.openstack:volume-c3d51a52-764a-4007-976a-136b544c561b-lun-1\n\n$ nova show aa2c1541-d298-478c-9a35-7759a07a77b0\u3000=> NG\n+--------------------------------------+------------------------------------------------------+\n| Property                             | Value                                                |\n+--------------------------------------+------------------------------------------------------+\n| status                               | ACTIVE                                               |\n| ...                                  | ...                                                  |\n| os-extended-volumes:volumes_attached | [{u'id': u'66230802-aed6-4a90-9dec-42fec910d13d'}]   |\n| ...                                  | ...                                                  |\n+--------------------------------------+------------------------------------------------------+\n\n$ mysql -e \"select is,device_name,volume_id from block_device_mapping where instance_uuid='aa2c1541-d298-478c-9a35-7759a07a77b0' and deleted=0\" => NG\n+----+-------------+--------------------------------------+\n| id | device_name | volume_id                            |\n+----+-------------+--------------------------------------+\n| 17 | /dev/vda    | NULL                                 |\n| 19 | /dev/vdb    | 66230802-aed6-4a90-9dec-42fec910d13d |\n+----+-------------+--------------------------------------+", 
    "tags": [
        "volumes"
    ], 
    "importance": "Undecided", 
    "heat": 22, 
    "link": "https://bugs.launchpad.net/nova/+bug/1223180", 
    "owner": "None", 
    "id": 1223180, 
    "index": 4061, 
    "created": "2013-09-10 05:28:28.565063+00:00", 
    "title": "Block device mapping is not updated in the swap volume", 
    "comments": [
        {
            "content": "swap volume is success.\nBut block device mapping is not updated.\n\nTried Commit ID:b037993984229bb698050f20e8719b8c06ff2be3\n\n1. Try to swap volume from vol01 to vol02\n$ nova show aa2c1541-d298-478c-9a35-7759a07a77b0\n+--------------------------------------+------------------------------------------------------+\n| Property                             | Value                                                |\n+--------------------------------------+------------------------------------------------------+\n| status                               | ACTIVE                                               |\n| ...                                  | ...                                                  |\n| os-extended-volumes:volumes_attached | [{u'id': u'66230802-aed6-4a90-9dec-42fec910d13d'}]   |\n| ...                                  | ...                                                  |\n+--------------------------------------+------------------------------------------------------+\n\n$ mysql -e \"select is,device_name,volume_id from block_device_mapping where instance_uuid='aa2c1541-d298-478c-9a35-7759a07a77b0' and deleted=0\"\n+----+-------------+--------------------------------------+\n| id | device_name | volume_id                            |\n+----+-------------+--------------------------------------+\n| 17 | /dev/vda    | NULL                                 |\n| 19 | /dev/vdb    | 66230802-aed6-4a90-9dec-42fec910d13d |\n+----+-------------+--------------------------------------+\n\n$ cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable |             Attached to              |\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n| 66230802-aed6-4a90-9dec-42fec910d13d |   in-use  |    vol01     |  1   |     None    |  False   | aa2c1541-d298-478c-9a35-7759a07a77b0 |\n| c3d51a52-764a-4007-976a-136b544c561b | available |    vol02     |  1   |     None    |  False   |                                      |\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n\n$ virsh domblklist instance-0000000e\ntarget source\n------------------------------------------------\nvda    /opt/stack/data/nova/instances/aa2c1541-d298-478c-9a35-7759a07a77b0/disk\nvdb    /dev/disk/by-path/ip-192.168.122.180:3260-iscsi-iqn.2010-10.org.openstack:volume-66230802-aed6-4a90-9dec-42fec910d13d-lun-1\n\n2. Swap volume is successful, but block device mapping is not updated.\n$ cinder list => OK\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable |             Attached to              |\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n| 66230802-aed6-4a90-9dec-42fec910d13d | available |    vol01     |  1   |     None    |  False   |                                      |\n| c3d51a52-764a-4007-976a-136b544c561b |   in-use  |    vol02     |  1   |     None    |  False   | aa2c1541-d298-478c-9a35-7759a07a77b0 |\n+--------------------------------------+-----------+--------------+------+-------------+----------+--------------------------------------+\n\n$ virsh domblklist instance-0000000e => OK\ntarget source\n------------------------------------------------\nvda    /opt/stack/data/nova/instances/aa2c1541-d298-478c-9a35-7759a07a77b0/disk\nvdb    /dev/disk/by-path/ip-192.168.122.218:3260-iscsi-iqn.2010-10.org.openstack:volume-c3d51a52-764a-4007-976a-136b544c561b-lun-1\n\n$ nova show aa2c1541-d298-478c-9a35-7759a07a77b0\u3000=> NG\n+--------------------------------------+------------------------------------------------------+\n| Property                             | Value                                                |\n+--------------------------------------+------------------------------------------------------+\n| status                               | ACTIVE                                               |\n| ...                                  | ...                                                  |\n| os-extended-volumes:volumes_attached | [{u'id': u'66230802-aed6-4a90-9dec-42fec910d13d'}]   |\n| ...                                  | ...                                                  |\n+--------------------------------------+------------------------------------------------------+\n\n$ mysql -e \"select is,device_name,volume_id from block_device_mapping where instance_uuid='aa2c1541-d298-478c-9a35-7759a07a77b0' and deleted=0\" => NG\n+----+-------------+--------------------------------------+\n| id | device_name | volume_id                            |\n+----+-------------+--------------------------------------+\n| 17 | /dev/vda    | NULL                                 |\n| 19 | /dev/vdb    | 66230802-aed6-4a90-9dec-42fec910d13d |\n+----+-------------+--------------------------------------+", 
            "date_created": "2013-09-10 05:28:28.565063+00:00", 
            "author": "https://api.launchpad.net/1.0/~y-jitsukawa"
        }, 
        {
            "content": "I haven't been able to reproduce this bug with the latest code.\n\n1. One server and two volumes previously created:\n\nfedora@openstack2:devstack(master)> nova list\n+--------------------------------------+-------+--------+------------+-------------+---------------------+\n| ID                                   | Name  | Status | Task State | Power State | Networks            |\n+--------------------------------------+-------+--------+------------+-------------+---------------------+\n| 2657dc02-f19e-4fda-b00f-2370e15fa58e | nuvol | ACTIVE | None       | Running     | private=172.30.42.2 |\n+--------------------------------------+-------+--------+------------+-------------+---------------------+\nfedora@openstack2:devstack(master)> nova volume-list\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\n| ID                                   | Status    | Display Name | Size | Volume Type | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\n| 77952deb-2019-4984-93c8-e7050024d1cd | available | vol02        | 1    | None        |             |\n| f932e730-f53e-4c1d-8715-50af9796332f | available | vol01        | 1    | None        |             |\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\n\n2. Attach vol01 to server nuvol:\n\nfedora@openstack2:devstack(master)> nova volume-attach nuvol f932e730-f53e-4c1d-8715-50af9796332f /dev/vdb\n+----------+--------------------------------------+\n| Property | Value                                |\n+----------+--------------------------------------+\n| device   | /dev/vdb                             |\n| serverId | 2657dc02-f19e-4fda-b00f-2370e15fa58e |\n| id       | f932e730-f53e-4c1d-8715-50af9796332f |\n| volumeId | f932e730-f53e-4c1d-8715-50af9796332f |\n+----------+--------------------------------------+\n\nMariaDB [nova]> select id,device_name,volume_id from block_device_mapping where deleted=0;\n+----+-------------+--------------------------------------+\n| id | device_name | volume_id                            |\n+----+-------------+--------------------------------------+\n|  1 | /dev/vda    | NULL                                 |\n|  3 | /dev/vdb    | f932e730-f53e-4c1d-8715-50af9796332f |\n+----+-------------+--------------------------------------+\n2 rows in set (0.00 sec)\n\n3. Swap vol01 for vol02 in nuvol attachments:\n\nfedora@openstack2:devstack(master)> nova volume-update nuvol f932e730-f53e-4c1d-8715-50af9796332f 77952deb-2019-4984-93c8-e7050024d1cd\n\nfedora@openstack2:devstack(master)> nova volume-list\n+--------------------------------------+-----------+--------------+------+-------------+--------------------------------------+\n| ID                                   | Status    | Display Name | Size | Volume Type | Attached to                          |\n+--------------------------------------+-----------+--------------+------+-------------+--------------------------------------+\n| 77952deb-2019-4984-93c8-e7050024d1cd | in-use    | vol02        | 1    | None        | 2657dc02-f19e-4fda-b00f-2370e15fa58e |\n| f932e730-f53e-4c1d-8715-50af9796332f | available | vol01        | 1    | None        |                                      |\n+--------------------------------------+-----------+--------------+------+-------------+--------------------------------------+\n\nMariaDB [nova]> select id,device_name,volume_id from block_device_mapping where deleted=0;\n+----+-------------+--------------------------------------+\n| id | device_name | volume_id                            |\n+----+-------------+--------------------------------------+\n|  1 | /dev/vda    | NULL                                 |\n|  3 | /dev/vdb    | 77952deb-2019-4984-93c8-e7050024d1cd |\n+----+-------------+--------------------------------------+\n2 rows in set (0.00 sec)", 
            "date_created": "2013-09-17 16:03:42.964384+00:00", 
            "author": "https://api.launchpad.net/1.0/~xqueralt-deactivatedaccount"
        }
    ]
}