{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 09:02:24.450897+00:00", 
    "description": "This is Kilo specific (and works in Liberty, thanks to the move to os-brick).\n\nWhen attaching a volume, I'm seeing a failure like this:\n\n  Traceback (most recent call last):\n    File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 255, in attach\n      device_type=self['device_type'], encryption=encryption)\n    File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1097, in attach_volume\n      self._disconnect_volume(connection_info, disk_dev)\n    File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n      six.reraise(self.type_, self.value, self.tb)\n    File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1086, in attach_volume\n      virt_dom.attachDeviceFlags(conf.to_xml(), flags)\n    File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n      result = proxy_call(self._autowrap, f, *args, **kwargs)\n    File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n      rv = execute(f, *args, **kwargs)\n    File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n      six.reraise(c, e, tb)\n    File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n      rv = meth(*args, **kwargs)\n    File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 521, in attachDeviceFlags\n      if ret == -1: raise libvirtError ('virDomainAttachDeviceFlags() failed', dom=self)\n  libvirtError: unable to resolve '/dev/mapper/Jul': No such file or directory\n\nIt turns out that the output of multipath -ll is this:\n\n\n2015-07-29 10:06:15.737 9409 DEBUG nova.virt.libvirt.volume [req-b7fd06a9-0b92-4d22-b0b5-fc90155523e4 c2cc2530388045fcb18af40982cd620b 0f06428e3867430cba110ca433bcdfec - - -] multipath ['-ll', '/dev/sda']: stdout=Jul 29 10:06:15 | vda: failed to get udev uid: Invalid arg\nument\nJul 29 10:06:15 | vda: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | vda: failed to get sgio uid: No such file or directory\nJul 29 10:06:15 | nbd0: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd0: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd0: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd1: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd1: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd1: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd10: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd10: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd10: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd11: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd11: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd11: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd12: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd12: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd12: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd13: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd13: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd13: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd14: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd14: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd14: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd15: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd15: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd15: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd2: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd2: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd2: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd3: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd3: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd3: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd4: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd4: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd4: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd5: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd5: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd5: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd6: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd6: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd6: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd7: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd7: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd7: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd8: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd8: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd8: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd9: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd9: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd9: failed to get sgio uid: Inappropriate ioctl for device\n33000000200000001 dm-4 IET,VIRTUAL-DISK\nsize=1.0G features='0' hwhandler='0' wp=rw\n`-+- policy='service-time 0' prio=1 status=enabled\n  `- 4:0:0:1 sda   8:0   active ready  running\n\nSo we don't filter out correctly all lines; os-brick does this correctly.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1479291", 
    "owner": "None", 
    "id": 1479291, 
    "index": 5670, 
    "created": "2015-07-29 10:30:07.536617+00:00", 
    "title": "Cannot attach to iscsi volume with multipath", 
    "comments": [
        {
            "content": "This is Kilo specific (and works in Liberty, thanks to the move to os-brick).\n\nWhen attaching a volume, I'm seeing a failure like this:\n\n  Traceback (most recent call last):\n    File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 255, in attach\n      device_type=self['device_type'], encryption=encryption)\n    File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1097, in attach_volume\n      self._disconnect_volume(connection_info, disk_dev)\n    File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n      six.reraise(self.type_, self.value, self.tb)\n    File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1086, in attach_volume\n      virt_dom.attachDeviceFlags(conf.to_xml(), flags)\n    File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n      result = proxy_call(self._autowrap, f, *args, **kwargs)\n    File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n      rv = execute(f, *args, **kwargs)\n    File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n      six.reraise(c, e, tb)\n    File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n      rv = meth(*args, **kwargs)\n    File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 521, in attachDeviceFlags\n      if ret == -1: raise libvirtError ('virDomainAttachDeviceFlags() failed', dom=self)\n  libvirtError: unable to resolve '/dev/mapper/Jul': No such file or directory\n\nIt turns out that the output of multipath -ll is this:\n\n\n2015-07-29 10:06:15.737 9409 DEBUG nova.virt.libvirt.volume [req-b7fd06a9-0b92-4d22-b0b5-fc90155523e4 c2cc2530388045fcb18af40982cd620b 0f06428e3867430cba110ca433bcdfec - - -] multipath ['-ll', '/dev/sda']: stdout=Jul 29 10:06:15 | vda: failed to get udev uid: Invalid arg\nument\nJul 29 10:06:15 | vda: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | vda: failed to get sgio uid: No such file or directory\nJul 29 10:06:15 | nbd0: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd0: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd0: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd1: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd1: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd1: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd10: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd10: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd10: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd11: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd11: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd11: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd12: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd12: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd12: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd13: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd13: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd13: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd14: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd14: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd14: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd15: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd15: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd15: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd2: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd2: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd2: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd3: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd3: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd3: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd4: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd4: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd4: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd5: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd5: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd5: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd6: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd6: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd6: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd7: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd7: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd7: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd8: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd8: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd8: failed to get sgio uid: Inappropriate ioctl for device\nJul 29 10:06:15 | nbd9: failed to get udev uid: Invalid argument\nJul 29 10:06:15 | nbd9: failed to get sysfs uid: Invalid argument\nJul 29 10:06:15 | nbd9: failed to get sgio uid: Inappropriate ioctl for device\n33000000200000001 dm-4 IET,VIRTUAL-DISK\nsize=1.0G features='0' hwhandler='0' wp=rw\n`-+- policy='service-time 0' prio=1 status=enabled\n  `- 4:0:0:1 sda   8:0   active ready  running\n\nSo we don't filter out correctly all lines; os-brick does this correctly.", 
            "date_created": "2015-07-29 10:30:07.536617+00:00", 
            "author": "https://api.launchpad.net/1.0/~vuntz"
        }, 
        {
            "content": "Fix proposed to branch: stable/kilo\nReview: https://review.openstack.org/206976", 
            "date_created": "2015-07-29 10:32:41.653159+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Nova master has already moved to osbrick - https://review.openstack.org/#/c/175569/", 
            "date_created": "2015-07-29 20:06:57.426976+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "> Nova master has already moved to osbrick\n\nRight, that's why I wrote:\n\n> This is Kilo specific (and works in Liberty, thanks to the move to os-brick).\n\nI still believe we should fix it in Kilo, hence my patch...", 
            "date_created": "2015-07-30 06:43:34.732790+00:00", 
            "author": "https://api.launchpad.net/1.0/~vuntz"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: stable/kilo\nReview: https://review.openstack.org/206976\nReason: This patch has been stalled for quite a while, so I am going to abandon it to keep the code review queue sane. Please restore the change when it is ready for review.", 
            "date_created": "2015-09-14 21:54:54.149304+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}