{
    "status": "Invalid", 
    "last_updated": "2013-08-04 13:50:38.909369+00:00", 
    "description": "When vm deploy failed, the nova still count the resources which allocated to that vm as occupied, is this work as design?\n\n1. check first\n\n> nova hypervisor-show 1\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property             | Value                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| hypervisor_hostname  | WIN-UJAK7KN9LRA                                                                                                                                                                                                               |\n| cpu_info             | {\"vendor\": \"GenuineIntel\", \"model\": \"Intel(R) Xeon(R) CPU           X5650  @ 2.67GHz\", \"arch\": \"x64\", \"features\": [\"mmx\", \"sse\", \"rdtsc\", \"pae\", \"sse2\", \"nx\", \"sse3\"], \"topology\": {\"cores\": 6, \"threads\": 2, \"sockets\": 2}} |\n| free_disk_gb         | 516                                                                                                                                                                                                                           |\n| hypervisor_version   | 629200                                                                                                                                                                                                                        |\n| disk_available_least | None                                                                                                                                                                                                                          |\n| local_gb             | 556                                                                                                                                                                                                                           |\n| free_ram_mb          | 130548                                                                                                                                                                                                                        |\n| id                   | 1                                                                                                                                                                                                                             |\n| vcpus_used           | 2                                                                                                                                                                                                                             |\n| hypervisor_type      | hyperv                                                                                                                                                                                                                        |\n| local_gb_used        | 40                                                                                                                                                                                                                            |\n| memory_mb_used       | 4608                                                                                                                                                                                                                          |\n| memory_mb            | 135156                                                                                                                                                                                                                        |\n| current_workload     | 0                                                                                                                                                                                                                             |\n| vcpus                | 24                                                                                                                                                                                                                            |\n| running_vms          | 2                                                                                                                                                                                                                             |\n| service_id           | 47                                                                                                                                                                                                                            |\n| service_host         | WIN-UJAK7KN9LRA                  \n\n\n\nIBM-SCE> nova list\n+--------------------------------------+--------------+--------+----------+\n| ID                                   | Name         | Status | Networks |\n+--------------------------------------+--------------+--------+----------+\n| 1cb055e4-a2db-434d-816a-c2b12c87d49f | test-vm-2    | ACTIVE |          |\n| 970ad589-a613-4189-860f-60b2610da0ab | testDeploy01 | ACTIVE |          |\n+--------------------------------------+--------------+--------+----------+\nIBM-SCE> \n\n\nHyperv-manager have 2 instances\n\n\n2.   Then I deploy one instance(with flavor small), deploy failed\n\n\n\nIBM-SCE> nova list\n+--------------------------------------+--------------+--------+----------+\n| ID                                   | Name         | Status | Networks |\n+--------------------------------------+--------------+--------+----------+\n| 1cb055e4-a2db-434d-816a-c2b12c87d49f | test-vm-2    | ACTIVE |          |\n| 2c1d0921-e2af-4e7e-a1c9-9c5b0080e336 | test-vm-os-1 | ERROR  |          |\n| 970ad589-a613-4189-860f-60b2610da0ab | testDeploy01 | ACTIVE |          |\n+--------------------------------------+--------------+--------+----------+\n\n\n> nova hypervisor-show 1\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property             | Value                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| hypervisor_hostname  | WIN-UJAK7KN9LRA                                                                                                                                                                                                               |\n| cpu_info             | {\"vendor\": \"GenuineIntel\", \"model\": \"Intel(R) Xeon(R) CPU           X5650  @ 2.67GHz\", \"arch\": \"x64\", \"features\": [\"mmx\", \"sse\", \"rdtsc\", \"pae\", \"sse2\", \"nx\", \"sse3\"], \"topology\": {\"cores\": 6, \"threads\": 2, \"sockets\": 2}} |\n| free_disk_gb         | 496                                                                                                                                                                                                                           |\n| hypervisor_version   | 629200                                                                                                                                                                                                                        |\n| disk_available_least | None                                                                                                                                                                                                                          |\n| local_gb             | 556                                                                                                                                                                                                                           |\n| free_ram_mb          | 128500                                                                                                                                                                                                                        |\n| id                   | 1                                                                                                                                                                                                                             |\n| vcpus_used           | 3                                                                                                                                                                                                                             |\n| hypervisor_type      | hyperv                                                                                                                                                                                                                        |\n| local_gb_used        | 60                                                                                                                                                                                                                            |\n| memory_mb_used       | 6656                                                                                                                                                                                                                          |\n| memory_mb            | 135156                                                                                                                                                                                                                        |\n| current_workload     | 0                                                                                                                                                                                                                             |\n| vcpus                | 24                                                                                                                                                                                                                            |\n| running_vms          | 3                                                                                                                                                                                                                             |\n| service_id           | 47                                                                                                                                                                                                                            |\n| service_host         | WIN-UJAK7KN9LRA                                                                                                                                                                                                               |", 
    "tags": [
        "resource", 
        "tracker"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1193226", 
    "owner": "https://api.launchpad.net/1.0/~xianghui", 
    "id": 1193226, 
    "index": 3777, 
    "created": "2013-06-21 06:06:03.911809+00:00", 
    "title": "Resources utilization in nova count those vm which failed.", 
    "comments": [
        {
            "content": "When vm deploy failed, the nova still count the resources which allocated to that vm as occupied, is this work as design?\n\n1. check first\n\n> nova hypervisor-show 1\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property             | Value                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| hypervisor_hostname  | WIN-UJAK7KN9LRA                                                                                                                                                                                                               |\n| cpu_info             | {\"vendor\": \"GenuineIntel\", \"model\": \"Intel(R) Xeon(R) CPU           X5650  @ 2.67GHz\", \"arch\": \"x64\", \"features\": [\"mmx\", \"sse\", \"rdtsc\", \"pae\", \"sse2\", \"nx\", \"sse3\"], \"topology\": {\"cores\": 6, \"threads\": 2, \"sockets\": 2}} |\n| free_disk_gb         | 516                                                                                                                                                                                                                           |\n| hypervisor_version   | 629200                                                                                                                                                                                                                        |\n| disk_available_least | None                                                                                                                                                                                                                          |\n| local_gb             | 556                                                                                                                                                                                                                           |\n| free_ram_mb          | 130548                                                                                                                                                                                                                        |\n| id                   | 1                                                                                                                                                                                                                             |\n| vcpus_used           | 2                                                                                                                                                                                                                             |\n| hypervisor_type      | hyperv                                                                                                                                                                                                                        |\n| local_gb_used        | 40                                                                                                                                                                                                                            |\n| memory_mb_used       | 4608                                                                                                                                                                                                                          |\n| memory_mb            | 135156                                                                                                                                                                                                                        |\n| current_workload     | 0                                                                                                                                                                                                                             |\n| vcpus                | 24                                                                                                                                                                                                                            |\n| running_vms          | 2                                                                                                                                                                                                                             |\n| service_id           | 47                                                                                                                                                                                                                            |\n| service_host         | WIN-UJAK7KN9LRA                  \n\n\n\nIBM-SCE> nova list\n+--------------------------------------+--------------+--------+----------+\n| ID                                   | Name         | Status | Networks |\n+--------------------------------------+--------------+--------+----------+\n| 1cb055e4-a2db-434d-816a-c2b12c87d49f | test-vm-2    | ACTIVE |          |\n| 970ad589-a613-4189-860f-60b2610da0ab | testDeploy01 | ACTIVE |          |\n+--------------------------------------+--------------+--------+----------+\nIBM-SCE> \n\n\nHyperv-manager have 2 instances\n\n\n2.   Then I deploy one instance(with flavor small), deploy failed\n\n\n\nIBM-SCE> nova list\n+--------------------------------------+--------------+--------+----------+\n| ID                                   | Name         | Status | Networks |\n+--------------------------------------+--------------+--------+----------+\n| 1cb055e4-a2db-434d-816a-c2b12c87d49f | test-vm-2    | ACTIVE |          |\n| 2c1d0921-e2af-4e7e-a1c9-9c5b0080e336 | test-vm-os-1 | ERROR  |          |\n| 970ad589-a613-4189-860f-60b2610da0ab | testDeploy01 | ACTIVE |          |\n+--------------------------------------+--------------+--------+----------+\n\n\n> nova hypervisor-show 1\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property             | Value                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| hypervisor_hostname  | WIN-UJAK7KN9LRA                                                                                                                                                                                                               |\n| cpu_info             | {\"vendor\": \"GenuineIntel\", \"model\": \"Intel(R) Xeon(R) CPU           X5650  @ 2.67GHz\", \"arch\": \"x64\", \"features\": [\"mmx\", \"sse\", \"rdtsc\", \"pae\", \"sse2\", \"nx\", \"sse3\"], \"topology\": {\"cores\": 6, \"threads\": 2, \"sockets\": 2}} |\n| free_disk_gb         | 496                                                                                                                                                                                                                           |\n| hypervisor_version   | 629200                                                                                                                                                                                                                        |\n| disk_available_least | None                                                                                                                                                                                                                          |\n| local_gb             | 556                                                                                                                                                                                                                           |\n| free_ram_mb          | 128500                                                                                                                                                                                                                        |\n| id                   | 1                                                                                                                                                                                                                             |\n| vcpus_used           | 3                                                                                                                                                                                                                             |\n| hypervisor_type      | hyperv                                                                                                                                                                                                                        |\n| local_gb_used        | 60                                                                                                                                                                                                                            |\n| memory_mb_used       | 6656                                                                                                                                                                                                                          |\n| memory_mb            | 135156                                                                                                                                                                                                                        |\n| current_workload     | 0                                                                                                                                                                                                                             |\n| vcpus                | 24                                                                                                                                                                                                                            |\n| running_vms          | 3                                                                                                                                                                                                                             |\n| service_id           | 47                                                                                                                                                                                                                            |\n| service_host         | WIN-UJAK7KN9LRA                                                                                                                                                                                                               |", 
            "date_created": "2013-06-21 06:06:03.911809+00:00", 
            "author": "https://api.launchpad.net/1.0/~guohliu"
        }, 
        {
            "content": "Does the native hypervisor list 2 or 3 instances?  If the hypervisor thinks that it's managing 3 instances, then I'd consider this working as designed and you need to clean up that failed instance.  Suppose you didn't show the hypervisor as managing failed instances and it actually has 20 failed instances which could be taking up some kind of resource, wouldn't it be a bug to not report that?  I'm not sure but if there is some kind of quota/limit around how many instances a hypervisor can manage, the scheduler might be using that information to determine which compute node should serve a request also (just a thought).", 
            "date_created": "2013-06-29 19:56:07.005359+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Marking this as invalid.  The failed instance is still tracked by the hypervisor (as your hypervisor-show output shows) and it's in the nova database, so either you can try to rescue it or delete it, but I don't think hiding it from the output is helpful.  If you don't want to see failed instances in the nova list output, filter by status.", 
            "date_created": "2013-07-06 21:17:08.366765+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "@Matt,  The hypervisor not tracked that,  since Hyperv manager side, that failed instance not occupy any resource.(since it not existed)\n\nIt is OS tracked the error, I am not sure why OS designed like it, as failed instance not exist in hyperv, How can it be rescued ?\n\n\nI can only think os designed that is for easy management for os itself, not deal with checking complicated instance status in hypervisor side", 
            "date_created": "2013-07-09 01:20:42.991663+00:00", 
            "author": "https://api.launchpad.net/1.0/~wkqwu"
        }, 
        {
            "content": "And also even as you said, if that resource count like that, it also not meaningful for scheduler, since that compute node not have such instance, only OS thought it, and that scheduler is not supplied with right metric info.\n\nI don't think it is meaningful", 
            "date_created": "2013-07-09 01:25:56.682951+00:00", 
            "author": "https://api.launchpad.net/1.0/~wkqwu"
        }, 
        {
            "content": "This issue can be reproduced on all hypervisors not only just hyper-v, the root cause is some resources have been occupied before vm is spawned, but if spawn failed resource won't be reclaimed back, a solution is to redraw the resource allocated to vm with error state.\n\n\n", 
            "date_created": "2013-07-11 08:24:28.496435+00:00", 
            "author": "https://api.launchpad.net/1.0/~xianghui"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/36776", 
            "date_created": "2013-07-12 04:12:29.915417+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "PLS help to review this one :     https://review.openstack.org/36776", 
            "date_created": "2013-07-16 08:50:57.184762+00:00", 
            "author": "https://api.launchpad.net/1.0/~xianghui"
        }, 
        {
            "content": "Currently, we can't guarantee that the vm spawns failed didn't consume any resource even it didn't exist on the hypervisor under.", 
            "date_created": "2013-08-04 13:50:38.296388+00:00", 
            "author": "https://api.launchpad.net/1.0/~xianghui"
        }
    ]
}