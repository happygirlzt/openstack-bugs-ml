{
    "status": "Fix Released", 
    "last_updated": "2015-07-08 22:52:38.842470+00:00", 
    "description": "Actually, it is nearly useless. It just returns an exception that it casts from a HTTP 500.\n\nMy quota limit is 1000GB, here I try to make a volume that is 2000GB\n\ng = cinderclient(request).volumes.create(size, display_name=name, display_description=description)\n\ncinderclient connection created using token \"e3fbb3c2d94949b0975db11de85bebc5\" and url \"http://10.145.1.51:8776/v1/9da18fcaedf74eb7b1cf73b67b5b870c\"\n\nREQ: curl -i http://10.145.1.51:8776/v1/9da18fcaedf74eb7b1cf73b67b5b870c/volumes -X POST -H \"X-Auth-Project-Id: 9da18fcaedf74eb7b1cf73b67b5b870c\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: e3fbb3c2d94949b0975db11de85bebc5\"\n\nREQ BODY: {\"volume\": {\"snapshot_id\": null, \"display_name\": \"My Vol\", \"volume_type\": null, \"display_description\": \"\", \"size\": 2000}}\n\nRESP:{'date': 'Thu, 14 Jun 2012 22:14:02 GMT', 'status': '500', 'content-length': '128', 'content-type': 'application/json; charset=UTF-8', 'x-compute-request-id': 'req-316c81e2-3407-4df0-8b0e-190bf63f549b'} {\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}\n\n*** ClientException: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-316c81e2-3407-4df0-8b0e-190bf63f549b)\n\nThis is basically useless from an end-user perspective and doesn't allow us to tell users of Horizon anything useful about why this error'd. :( It should probably be a 406, not a 500, and the error message should be \"Cannot create a volume of 2000GB because your quota is currently 1000GB.\" Or something along those lines...", 
    "tags": [
        "in-stable-icehouse", 
        "python-cinderclient", 
        "volume"
    ], 
    "importance": "Medium", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1013417", 
    "owner": "https://api.launchpad.net/1.0/~thingee", 
    "id": 1013417, 
    "index": 2937, 
    "created": "2012-06-14 22:23:44.735792+00:00", 
    "title": "Cinderclient Doesn't Return A Useful Error When Trying To Create A Volume Larger Than The Quota Allocation", 
    "comments": [
        {
            "content": "Actually, it is nearly useless. It just returns an exception that it casts from a HTTP 500. \n\nMy quote is 1000GB, here I try to make a volume that is 2000GB\n\ng = cinderclient(request).volumes.create(size, display_name=name, display_description=description)\n\ncinderclient connection created using token \"e3fbb3c2d94949b0975db11de85bebc5\" and url \"http://10.145.1.51:8776/v1/9da18fcaedf74eb7b1cf73b67b5b870c\"\n\nREQ: curl -i http://10.145.1.51:8776/v1/9da18fcaedf74eb7b1cf73b67b5b870c/volumes -X POST -H \"X-Auth-Project-Id: 9da18fcaedf74eb7b1cf73b67b5b870c\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: e3fbb3c2d94949b0975db11de85bebc5\"\n\nREQ BODY: {\"volume\": {\"snapshot_id\": null, \"display_name\": \"My Vol\", \"volume_type\": null, \"display_description\": \"\", \"size\": 2000}}\n\nRESP:{'date': 'Thu, 14 Jun 2012 22:14:02 GMT', 'status': '500', 'content-length': '128', 'content-type': 'application/json; charset=UTF-8', 'x-compute-request-id': 'req-316c81e2-3407-4df0-8b0e-190bf63f549b'} {\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}\n\n*** ClientException: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-316c81e2-3407-4df0-8b0e-190bf63f549b)\n\nThis is basically useless from an end-user perspective and doesn't allow us to tell users of Horizon anything useful about why this error'd. :( It should probably be a 406, not a 500, and the error message should be \"Cannot create a volume of 2000GB because your quote is 1000GB.\" Or something along those lines...", 
            "date_created": "2012-06-14 22:23:44.735792+00:00", 
            "author": "https://api.launchpad.net/1.0/~john-postlethwait"
        }, 
        {
            "content": "Talked with John about this. This is going to involve quite a bit of change. Need to communicate this more with people before I proceed.\n\nhttps://blueprints.launchpad.net/cinder/+spec/clearer-api-error-responses", 
            "date_created": "2012-07-10 03:49:49.964472+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "If the request gets any sort of exception, it appears we're forcing a 500 with no explanation. This was done because sensitive information was being passed to the client. Might be time to look into a way of passing back useful information while avoiding this issue:\n\nhttps://bugs.launchpad.net/nova/+bug/868360\nhttps://bugs.launchpad.net/nova/+bug/874472\n\nThe commit in question: http://github.com/openstack/nova/commit/2431b7848d633dc67ad684b4d1cc79468df24568", 
            "date_created": "2012-08-07 19:59:35.365115+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "On the nova side, this just says invalid block device, which is caught by a catch all exception.\n\n2014-02-04 20:45:32.689 43992 ERROR nova.compute.manager [req-10a4ded5-dbe5-4951-a787-0face80a95f5 90deab5f729c4176addf3f063d0d2a87 cb99317047bb4935b43f56fa7f48acdf] [instance: 0bd1614d-da1a-4e85-901a-08753ce\n97954] Instance failed block device setup\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954] Traceback (most recent call last):\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 1386, in _prep_block_devi\nce\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     self._await_block_device_map_created))\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/nova/virt/block_device.py\", line 283, in attach_block_de\nvices\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     block_device_mapping)\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/nova/virt/block_device.py\", line 236, in attach\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     '', '', image_id=self.image_id)\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/nova/volume/cinder.py\", line 306, in create\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     item = cinderclient(context).volumes.create(size, **kwargs)\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/cinderclient/v1/volumes.py\", line 187, in create\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     return self._create('/volumes', body, 'volume')\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/cinderclient/base.py\", line 153, in _create\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     resp, body = self.api.client.post(url, body=body)\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/cinderclient/client.py\", line 210, in post\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     return self._cs_request(url, 'POST', **kwargs)\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/cinderclient/client.py\", line 174, in _cs_request\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     **kwargs)\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]   File \"/opt/nova/lib/python2.7/site-packages/cinderclient/client.py\", line 157, in request\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954]     raise exceptions.from_response(resp, body)\n2014-02-04 20:45:32.689 43992 TRACE nova.compute.manager [instance: 0bd1614d-da1a-4e85-901a-08753ce97954] OverLimit: VolumeLimitExceeded: Maximum number of volumes allowed (10) exceeded (HTTP 413) (Request-ID\n: req-4401fe37-af04-4dbc-8670-b48ed6d05caf)", 
            "date_created": "2014-02-04 22:58:22.114479+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/71147\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=4711ff3adff2b4c9a54f5fb4448ace6558f82f6b\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4711ff3adff2b4c9a54f5fb4448ace6558f82f6b\nAuthor: Mike Perez <email address hidden>\nDate:   Tue Feb 4 15:00:10 2014 -0800\n\n    Raise descriptive error for over volume quota\n    \n    If you attempt to create a new instance booting from an image and you\n    were over your quota on cinder, the nova manager would see that as an\n    invalid block device. This raises a more descriptive error message in\n    the logs.\n    \n    Closes-bug: #1013417\n    Change-Id: Ie50b97c31580da7fc38c6891d1f3646b91f8aa10\n", 
            "date_created": "2014-05-05 21:23:40.203364+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/120172", 
            "date_created": "2014-09-09 18:20:28.024522+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/120172\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=5ec3cd30242350c1d0e759d8000e778c8cc1b48b\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit 5ec3cd30242350c1d0e759d8000e778c8cc1b48b\nAuthor: Mike Perez <email address hidden>\nDate:   Tue Feb 4 15:00:10 2014 -0800\n\n    Raise descriptive error for over volume quota\n    \n    If you attempt to create a new instance booting from an image and you\n    were over your quota on cinder, the nova manager would see that as an\n    invalid block device. This raises a more descriptive error message in\n    the logs.\n    \n    Closes-bug: #1013417\n    Change-Id: Ie50b97c31580da7fc38c6891d1f3646b91f8aa10\n    (cherry picked from commit 4711ff3adff2b4c9a54f5fb4448ace6558f82f6b)\n", 
            "date_created": "2014-10-06 23:39:46.594972+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}