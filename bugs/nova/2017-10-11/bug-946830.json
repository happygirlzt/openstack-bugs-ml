{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:53:40.790722+00:00", 
    "description": "I'm using Essex-4 with qemu.\n\nWhen volume is attached to instance, create server (snapshot) fails like followings.\n\ncommand:\n\nopenstack@usv095:~/devstack$ nova volume-list\n+----+--------+--------------+------+-------------+--------------------------------------+\n| ID | Status | Display Name | Size | Volume Type |             Attached to              |\n+----+--------+--------------+------+-------------+--------------------------------------+\n| 1  | in-use | vol1         | 1    | None        | 0a66f533-f7a3-47d9-942a-3367abfb7a9d |\n+----+--------+--------------+------+-------------+--------------------------------------+\nopenstack@usv095:~/devstack$ nova image-create 0a66f533-f7a3-47d9-942a-3367abfb7a9d snapshot1\n\n\nnova-compute says:\n\n2012-03-05 12:22:07 AUDIT nova.compute.manager [req-75e03716-39a3-4650-9127-8d343285efff af25f8740c4f40ad8a0f89b79858eba7 1916f24c97a34753b07da1e52b56dcb7] instance 0a66f533-f7a3-47d9-942a-3367abfb7a9d: snapshotting\nlibvir: QEMU error : Requested operation is not valid: Disk '/dev/disk/by-path/ip-192.168.6.95:3260-iscsi-iqn.2010-10.org.openstack:volume-00000001-lun-1' does not support snapshotting\n2012-03-05 12:22:08 ERROR nova.rpc.common [-] Exception during message handling\n(nova.rpc.common): TRACE: Traceback (most recent call last):\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/rpc/amqp.py\", line 250, in _process_data\n(nova.rpc.common): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/exception.py\", line 112, in wrapped\n(nova.rpc.common): TRACE:     return f(*args, **kw)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/compute/manager.py\", line 180, in decorated_function\n(nova.rpc.common): TRACE:     sys.exc_info())\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.common): TRACE:     self.gen.next()\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/compute/manager.py\", line 174, in decorated_function\n(nova.rpc.common): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/compute/manager.py\", line 936, in snapshot_instance\n(nova.rpc.common): TRACE:     self.driver.snapshot(context, instance_ref, image_id)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/exception.py\", line 112, in wrapped\n(nova.rpc.common): TRACE:     return f(*args, **kw)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/virt/libvirt/connection.py\", line 626, in snapshot\n(nova.rpc.common): TRACE:     snapshot_ptr = virt_dom.snapshotCreateXML(snapshot_xml, 0)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 938, in snapshotCreateXML\n(nova.rpc.common): TRACE:     if ret is None:raise libvirtError('virDomainSnapshotCreateXML() failed', dom=self)\n(nova.rpc.common): TRACE: libvirtError: Requested operation is not valid: Disk '/dev/disk/by-path/ip-192.168.6.95:3260-iscsi-iqn.2010-10.org.openstack:volume-00000001-lun-1' does not support snapshotting\n(nova.rpc.common): TRACE:", 
    "tags": [
        "qemu", 
        "snapshot"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/946830", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 946830, 
    "index": 607, 
    "created": "2012-03-05 03:30:53.433096+00:00", 
    "title": "on qemu, create image fails when volume is attached to vm instance", 
    "comments": [
        {
            "content": "I'm using Essex-4 with qemu.\n\nWhen volume is attached to instance, create server (snapshot) fails like followings.\n\ncommand:\n\nopenstack@usv095:~/devstack$ nova volume-list\n+----+--------+--------------+------+-------------+--------------------------------------+\n| ID | Status | Display Name | Size | Volume Type |             Attached to              |\n+----+--------+--------------+------+-------------+--------------------------------------+\n| 1  | in-use | vol1         | 1    | None        | 0a66f533-f7a3-47d9-942a-3367abfb7a9d |\n+----+--------+--------------+------+-------------+--------------------------------------+\nopenstack@usv095:~/devstack$ nova image-create 0a66f533-f7a3-47d9-942a-3367abfb7a9d snapshot1\n\n\nnova-compute says:\n\n2012-03-05 12:22:07 AUDIT nova.compute.manager [req-75e03716-39a3-4650-9127-8d343285efff af25f8740c4f40ad8a0f89b79858eba7 1916f24c97a34753b07da1e52b56dcb7] instance 0a66f533-f7a3-47d9-942a-3367abfb7a9d: snapshotting\nlibvir: QEMU error : Requested operation is not valid: Disk '/dev/disk/by-path/ip-192.168.6.95:3260-iscsi-iqn.2010-10.org.openstack:volume-00000001-lun-1' does not support snapshotting\n2012-03-05 12:22:08 ERROR nova.rpc.common [-] Exception during message handling\n(nova.rpc.common): TRACE: Traceback (most recent call last):\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/rpc/amqp.py\", line 250, in _process_data\n(nova.rpc.common): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/exception.py\", line 112, in wrapped\n(nova.rpc.common): TRACE:     return f(*args, **kw)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/compute/manager.py\", line 180, in decorated_function\n(nova.rpc.common): TRACE:     sys.exc_info())\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.common): TRACE:     self.gen.next()\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/compute/manager.py\", line 174, in decorated_function\n(nova.rpc.common): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/compute/manager.py\", line 936, in snapshot_instance\n(nova.rpc.common): TRACE:     self.driver.snapshot(context, instance_ref, image_id)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/exception.py\", line 112, in wrapped\n(nova.rpc.common): TRACE:     return f(*args, **kw)\n(nova.rpc.common): TRACE:   File \"/opt/openstack/nova/nova/virt/libvirt/connection.py\", line 626, in snapshot\n(nova.rpc.common): TRACE:     snapshot_ptr = virt_dom.snapshotCreateXML(snapshot_xml, 0)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 938, in snapshotCreateXML\n(nova.rpc.common): TRACE:     if ret is None:raise libvirtError('virDomainSnapshotCreateXML() failed', dom=self)\n(nova.rpc.common): TRACE: libvirtError: Requested operation is not valid: Disk '/dev/disk/by-path/ip-192.168.6.95:3260-iscsi-iqn.2010-10.org.openstack:volume-00000001-lun-1' does not support snapshotting\n(nova.rpc.common): TRACE:", 
            "date_created": "2012-03-05 03:30:53.433096+00:00", 
            "author": "https://api.launchpad.net/1.0/~iida-koji"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/5172", 
            "date_created": "2012-03-09 23:04:23.141673+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/5172\nCommitted: http://github.com/openstack/nova/commit/7dbf9c7de23623223ef60c0566d9330797c5f87e\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7dbf9c7de23623223ef60c0566d9330797c5f87e\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Thu Mar 8 16:26:13 2012 -0800\n\n    Make snapshots with qemu-img instead of libvirt\n    \n     * snapshot is only supposed to snapshot the root drive, whereas\n       libvirt snapshots snapshot the memory and all attached disks\n     * removes silly qemu_img flag\n     * fixes bug 946830\n    \n    Change-Id: I6afc9dbaa855f06864cd5a37f89ad63555e35d23\n", 
            "date_created": "2012-03-12 20:11:10.353784+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}