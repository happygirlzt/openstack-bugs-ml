{
    "status": "Fix Released", 
    "last_updated": "2014-03-30 22:26:50.008421+00:00", 
    "description": "I updated the cell info and the response is as follows:\n{\n    \"computeFault\": {\n        \"message\": \"The server has either erred or is incapable of performing the requested operation.\",\n        \"code\": 500\n    }\n}\n\nI found error in nova-cells.log:\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack Traceback (most recent call last):\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 81, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 450, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 890, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     content_type, body, accept)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 942, in _process_stack\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1022, in dispatch\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/cells.py\", line 257, in update\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return dict(cell=_scrub_cell(cell))\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/cells.py\", line 118, in _scrub_cell\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     cell_info = _filter_keys(cell, keys)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/cells.py\", line 110, in _filter_keys\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return dict((k, v) for k, v in item.iteritems() if k in keys)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack AttributeError: 'Query' object has no attribute 'iteritems'\n\n\nI viewed the code and found that:\n@require_admin_context\ndef cell_update(context, cell_name, values):\n    session = get_session()\n    with session.begin():\n        cell = _cell_get_by_name_query(context, cell_name, session=session)\n        cell.update(values)\n    return cell\n\nThe method nova.db.sqlalchemy.api.cell_update() returns a 'Query' object.\n\ndef _filter_keys(item, keys):\n    \"\"\"\n    Filters all model attributes except for keys\n    item is a dict\n\n    \"\"\"\n    return dict((k, v) for k, v in item.iteritems() if k in keys)\n\nThe method nova.api.openstack.compute.contrib.cells_filter_keys() uses the 'Query' object as a dict.\n\nThis bring on the error.", 
    "tags": [
        "cells"
    ], 
    "importance": "Medium", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1198796", 
    "owner": "https://api.launchpad.net/1.0/~russellb", 
    "id": 1198796, 
    "index": 3472, 
    "created": "2013-07-08 04:05:24.356884+00:00", 
    "title": "update cell error", 
    "comments": [
        {
            "content": "I updated the cell info and the response is as follows:\n{\n    \"computeFault\": {\n        \"message\": \"The server has either erred or is incapable of performing the requested operation.\",\n        \"code\": 500\n    }\n}\n\nI found error in nova-cells.log:\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack Traceback (most recent call last):\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 81, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 450, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 890, in __call__\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     content_type, body, accept)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 942, in _process_stack\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1022, in dispatch\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/cells.py\", line 257, in update\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return dict(cell=_scrub_cell(cell))\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/cells.py\", line 118, in _scrub_cell\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     cell_info = _filter_keys(cell, keys)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/cells.py\", line 110, in _filter_keys\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack     return dict((k, v) for k, v in item.iteritems() if k in keys)\n2013-07-07 23:55:20.777 31477 TRACE nova.api.openstack AttributeError: 'Query' object has no attribute 'iteritems'\n\n\nI viewed the code and found that:\n@require_admin_context\ndef cell_update(context, cell_name, values):\n    session = get_session()\n    with session.begin():\n        cell = _cell_get_by_name_query(context, cell_name, session=session)\n        cell.update(values)\n    return cell\n\nThe method nova.db.sqlalchemy.api.cell_update() returns a 'Query' object.\n\ndef _filter_keys(item, keys):\n    \"\"\"\n    Filters all model attributes except for keys\n    item is a dict\n\n    \"\"\"\n    return dict((k, v) for k, v in item.iteritems() if k in keys)\n\nThe method nova.api.openstack.compute.contrib.cells_filter_keys() uses the 'Query' object as a dict.\n\nThis bring on the error.", 
            "date_created": "2013-07-08 04:05:24.356884+00:00", 
            "author": "https://api.launchpad.net/1.0/~sunzuohua"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/45718", 
            "date_created": "2013-09-09 17:51:41.397618+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/45718\nCommitted: http://github.com/openstack/nova/commit/f10f67dcc82dc7fda5aaf546b145dad34db82f7b\nSubmitter: Jenkins\nBranch:    master\n\ncommit f10f67dcc82dc7fda5aaf546b145dad34db82f7b\nAuthor: Russell Bryant <email address hidden>\nDate:   Mon Sep 9 13:50:04 2013 -0400\n\n    Don't return query from db API\n    \n    The cell_update() method of the sqlalchemy db API returned a Query when\n    it really intended to return a Cell.  Fix this and tweak the db API test\n    so that it verifies that the result of this method is a Cell.\n    \n    Change-Id: I7ab7ea19f00ac2e8c2c73afe8a14f331940b4580\n    Closes-bug: #1198796\n", 
            "date_created": "2013-09-11 14:24:51.517229+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/48567", 
            "date_created": "2013-09-27 03:33:23.090286+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}