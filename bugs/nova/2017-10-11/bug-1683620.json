{
    "status": "In Progress", 
    "last_updated": "2017-04-26 05:11:47.849666+00:00", 
    "description": "When i rebuild an instance with a base image that has no property of base_image_ref, i find that the instance's system_metadada image_base_image_ref will be deleted not updated.\nHere is the system_metadata of an instance:\n$ MariaDB [nova]> select * from instance_system_metadata where instance_uuid = \"f885595b-7b3d-4b5d-a91d-5c894473c9ad\";\n+---------------------+------------+------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\n| created_at          | updated_at | deleted_at | id     | instance_uuid                        | key                       | value                                | deleted |\n+---------------------+------------+------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111215 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_disk_format         | qcow2                                |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111216 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_container_format    | bare                                 |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111217 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_min_ram             | 0                                    |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111218 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_min_disk            | 20                                   |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111219 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_base_image_ref      | ef9258de-4faa-41d4-809f-8f9a990cb3e2 |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111220 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_hw_qemu_guest_agent | yes                                  |       0 |\n+---------------------+------------+------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\nNow we rebuild this instance choosing a base image.\n$ nova rebuild f885595b-7b3d-4b5d-a91d-5c894473c9ad 7ceb073b-6d37-4e0d-91af-ee911e29fc81\n$ MariaDB [nova]> select * from instance_system_metadata where instance_uuid = \"f885595b-7b3d-4b5d-a91d-5c894473c9ad\";\n+---------------------+---------------------+---------------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\n| created_at          | updated_at          | deleted_at          | id     | instance_uuid                        | key                       | value                                | deleted |\n+---------------------+---------------------+---------------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\n| 2017-04-17 10:16:07 | NULL                | NULL                | 111215 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_disk_format         | qcow2                                |       0 |\n| 2017-04-17 10:16:07 | NULL                | NULL                | 111216 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_container_format    | bare                                 |       0 |\n| 2017-04-17 10:16:07 | 2017-04-18 06:47:38 | NULL                | 111217 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_min_ram             | 0                                    |       0 |\n| 2017-04-17 10:16:07 | 2017-04-18 06:47:38 | NULL                | 111218 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_min_disk            | 20                                   |       0 |\n| 2017-04-17 10:16:07 | 2017-04-18 06:47:38 | 2017-04-18 06:47:38 | 111219 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_base_image_ref      | ef9258de-4faa-41d4-809f-8f9a990cb3e2 |  111219 |\n| 2017-04-17 10:16:07 | NULL                | NULL                | 111220 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_hw_qemu_guest_agent | yes                                  |       0 |\n| 2017-04-18 06:47:42 | NULL                | NULL                | 111463 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | clean_attempts            | 1                                    |       0 |\n+---------------------+---------------------+---------------------+--------+--------------------------------------+---------------------------+--------------------------------------\nwe can see that the image_min_ram and image_min_disk are updated but the image_base_image_ref is deleted.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1683620", 
    "owner": "https://api.launchpad.net/1.0/~lichaolei", 
    "id": 1683620, 
    "index": 6805, 
    "created": "2017-04-18 06:55:04.701800+00:00", 
    "title": "rebuild instance will delete instance's image_base_image_ref", 
    "comments": [
        {
            "content": "When i rebuild an instance with a base image that has no property of base_image_ref, i find that the instance's system_metadada image_base_image_ref will be deleted not updated.\nHere is the system_metadata of an instance:\n$ MariaDB [nova]> select * from instance_system_metadata where instance_uuid = \"f885595b-7b3d-4b5d-a91d-5c894473c9ad\";\n+---------------------+------------+------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\n| created_at          | updated_at | deleted_at | id     | instance_uuid                        | key                       | value                                | deleted |\n+---------------------+------------+------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111215 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_disk_format         | qcow2                                |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111216 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_container_format    | bare                                 |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111217 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_min_ram             | 0                                    |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111218 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_min_disk            | 20                                   |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111219 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_base_image_ref      | ef9258de-4faa-41d4-809f-8f9a990cb3e2 |       0 |\n| 2017-04-17 10:16:07 | NULL       | NULL       | 111220 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_hw_qemu_guest_agent | yes                                  |       0 |\n+---------------------+------------+------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\nNow we rebuild this instance choosing a base image.\n$ nova rebuild f885595b-7b3d-4b5d-a91d-5c894473c9ad 7ceb073b-6d37-4e0d-91af-ee911e29fc81\n$ MariaDB [nova]> select * from instance_system_metadata where instance_uuid = \"f885595b-7b3d-4b5d-a91d-5c894473c9ad\";\n+---------------------+---------------------+---------------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\n| created_at          | updated_at          | deleted_at          | id     | instance_uuid                        | key                       | value                                | deleted |\n+---------------------+---------------------+---------------------+--------+--------------------------------------+---------------------------+--------------------------------------+---------+\n| 2017-04-17 10:16:07 | NULL                | NULL                | 111215 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_disk_format         | qcow2                                |       0 |\n| 2017-04-17 10:16:07 | NULL                | NULL                | 111216 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_container_format    | bare                                 |       0 |\n| 2017-04-17 10:16:07 | 2017-04-18 06:47:38 | NULL                | 111217 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_min_ram             | 0                                    |       0 |\n| 2017-04-17 10:16:07 | 2017-04-18 06:47:38 | NULL                | 111218 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_min_disk            | 20                                   |       0 |\n| 2017-04-17 10:16:07 | 2017-04-18 06:47:38 | 2017-04-18 06:47:38 | 111219 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_base_image_ref      | ef9258de-4faa-41d4-809f-8f9a990cb3e2 |  111219 |\n| 2017-04-17 10:16:07 | NULL                | NULL                | 111220 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | image_hw_qemu_guest_agent | yes                                  |       0 |\n| 2017-04-18 06:47:42 | NULL                | NULL                | 111463 | f885595b-7b3d-4b5d-a91d-5c894473c9ad | clean_attempts            | 1                                    |       0 |\n+---------------------+---------------------+---------------------+--------+--------------------------------------+---------------------------+--------------------------------------\nwe can see that the image_min_ram and image_min_disk are updated but the image_base_image_ref is deleted.", 
            "date_created": "2017-04-18 06:55:04.701800+00:00", 
            "author": "https://api.launchpad.net/1.0/~lichaolei"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/457514", 
            "date_created": "2017-04-18 08:28:06.181445+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "i'm curious why we need 'image_base_image_ref' in the system_metadata, i didn't found it is very useful.", 
            "date_created": "2017-04-26 05:11:47.308098+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }
    ]
}