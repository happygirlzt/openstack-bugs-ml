{
    "status": "Fix Released", 
    "last_updated": "2017-08-11 12:27:13.099042+00:00", 
    "description": "In an environment where http proxy is needed to create a python virtual env for the test run the functional tests fail with the similar stack traces:\n\n    Traceback (most recent call last):\n      File \"nova/tests/functional/notification_sample_tests/test_instance.py\", line 91, in setUp\n        super(TestInstanceNotificationSample, self).setUp()\n      File \"nova/tests/functional/notification_sample_tests/notification_sample_base.py\", line 86, in setUp\n        self.useFixture(nova_fixtures.PlacementFixture())\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/testtools/testcase.py\", line 756, in useFixture\n        reraise(*exc_info)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/testtools/testcase.py\", line 731, in useFixture\n        fixture.setUp()\n      File \"nova/tests/fixtures.py\", line 1403, in setUp\n        intercept.install_intercept()\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/wsgi_intercept/interceptor.py\", line 89, in install_intercept\n        self._module.install()\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/wsgi_intercept/_urllib3.py\", line 34, in install\n        'http_proxy or https_proxy set in environment, please unset')\n    RuntimeError: http_proxy or https_proxy set in environment, please unset\n\nThis is because passenv config of tox.ini contains the http_proxy and https_proxy env variables and therefore tox passing them into the test executor.", 
    "tags": [
        "testing"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1706545", 
    "owner": "https://api.launchpad.net/1.0/~sdague", 
    "id": 1706545, 
    "index": 949, 
    "created": "2017-07-26 08:15:27.837597+00:00", 
    "title": "functional test fails with  RuntimeError: http_proxy or https_proxy set in environment, please unset", 
    "comments": [
        {
            "content": "In an environment where http proxy is needed to create a python virtual env for the test run the functional tests fail with the similar stack traces:\n\n    Traceback (most recent call last):\n      File \"nova/tests/functional/notification_sample_tests/test_instance.py\", line 91, in setUp\n        super(TestInstanceNotificationSample, self).setUp()\n      File \"nova/tests/functional/notification_sample_tests/notification_sample_base.py\", line 86, in setUp\n        self.useFixture(nova_fixtures.PlacementFixture())\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/testtools/testcase.py\", line 756, in useFixture\n        reraise(*exc_info)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/testtools/testcase.py\", line 731, in useFixture\n        fixture.setUp()\n      File \"nova/tests/fixtures.py\", line 1403, in setUp\n        intercept.install_intercept()\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/wsgi_intercept/interceptor.py\", line 89, in install_intercept\n        self._module.install()\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/wsgi_intercept/_urllib3.py\", line 34, in install\n        'http_proxy or https_proxy set in environment, please unset')\n    RuntimeError: http_proxy or https_proxy set in environment, please unset\n\nThis is because passenv config of tox.ini contains the http_proxy and https_proxy env variables and therefore tox passing them into the test executor.", 
            "date_created": "2017-07-26 08:15:27.837597+00:00", 
            "author": "https://api.launchpad.net/1.0/~balazs-gibizer"
        }, 
        {
            "content": "As a side note. If build a virtualenv with the proxy set, then unset the proxy variables then star tox -e functional then I got a different failure:\n2017-07-26 10:38:02,702 ERROR [nova.compute.manager] Error updating resources for node fake-mini.\n    Traceback (most recent call last):\n      File \"nova/compute/manager.py\", line 6564, in update_available_resource_for_node\n        rt.update_available_resource(context, nodename)\n      File \"nova/compute/resource_tracker.py\", line 626, in update_available_resource\n        self._update_available_resource(context, resources)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n        return f(*args, **kwargs)\n      File \"nova/compute/resource_tracker.py\", line 650, in _update_available_resource\n        self._init_compute_node(context, resources)\n      File \"nova/compute/resource_tracker.py\", line 536, in _init_compute_node\n        self._update(context, cn)\n      File \"nova/compute/resource_tracker.py\", line 816, in _update\n        self.scheduler_client.update_compute_node(compute_node)\n      File \"nova/scheduler/client/__init__.py\", line 68, in update_compute_node\n        self.reportclient.update_compute_node(compute_node)\n      File \"nova/scheduler/client/__init__.py\", line 37, in __run_method\n        return getattr(self.instance, __name)(*args, **kwargs)\n      File \"nova/scheduler/client/report.py\", line 869, in update_compute_node\n        compute_node.hypervisor_hostname)\n      File \"nova/scheduler/client/report.py\", line 481, in _ensure_resource_provider\n        rp = self._get_resource_provider(uuid)\n      File \"nova/scheduler/client/report.py\", line 56, in wrapper\n        return f(self, *a, **k)\n      File \"nova/scheduler/client/report.py\", line 375, in _get_resource_provider\n        resp = self.get(\"/resource_providers/%s\" % uuid)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/fixtures/_fixtures/monkeypatch.py\", line 89, in avoid_get\n        return captured_method(*args, **kwargs)\n      File \"nova/tests/fixtures.py\", line 1450, in _fake_get\n        raise_exc=False)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/keystoneauth1/session.py\", line 845, in get\n        return self.request(url, 'GET', **kwargs)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/positional/__init__.py\", line 101, in inner\n        return wrapped(*args, **kwargs)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/keystoneauth1/session.py\", line 703, in request\n        resp = send(**kwargs)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/keystoneauth1/session.py\", line 761, in _send_request\n        resp = self.session.request(method, url, **kwargs)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/requests/sessions.py\", line 502, in request\n        resp = self.send(prep, **send_kwargs)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/requests/sessions.py\", line 612, in send\n        r = adapter.send(request, **kwargs)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/requests/adapters.py\", line 440, in send\n        timeout=timeout\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/urllib3/connectionpool.py\", line 588, in urlopen\n        conn = self._get_conn(timeout=pool_timeout)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/urllib3/connectionpool.py\", line 250, in _get_conn\n        return conn or self._new_conn()\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/urllib3/connectionpool.py\", line 211, in _new_conn\n        strict=self.strict, **self.conn_kw)\n      File \"/home/cloudci/ebalgib/nova.git/functional/.tox/functional/local/lib/python2.7/site-packages/wsgi_intercept/_urllib3.py\", line 19, in __init__\n        WSGI_HTTPConnection.__init__(self, *args, **kwargs)\n    TypeError: __init__() got an unexpected keyword argument 'socket_options'\n", 
            "date_created": "2017-07-26 09:00:07.361295+00:00", 
            "author": "https://api.launchpad.net/1.0/~balazs-gibizer"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/487327", 
            "date_created": "2017-07-26 09:08:03.219122+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/487327\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=dd26d3d14139dedc97397639117f56970940b500\nSubmitter: Jenkins\nBranch:    master\n\ncommit dd26d3d14139dedc97397639117f56970940b500\nAuthor: Balazs Gibizer <email address hidden>\nDate:   Wed Jul 26 11:03:13 2017 +0200\n\n    do not pass proxy env variables by tox\n    \n    In an environment where http_proxy env variable is needed to buil a\n    proper python virtualenv the functional test fails with:\n    RuntimeError: http_proxy or https_proxy set in environment, please unset\n    \n    This patch removes passing proxy env varibles in tox.ini to avoid this\n    error.\n    \n    Change-Id: Ia4d8fe952aecb5c3e688878ef0fdafd6fac4fc7a\n    Closes-Bug: #1706545\n", 
            "date_created": "2017-08-01 13:24:31.395091+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0rc1 release candidate.", 
            "date_created": "2017-08-11 12:27:12.742887+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}