{
    "status": "Invalid", 
    "last_updated": "2017-02-14 21:34:30.488708+00:00", 
    "description": "Hello. I'm sorry it this is the wrong place to post this; I'm pretty sure I've messed up myself, but since the error log said \"Please report this\", that's what I'm doing.\n\nI've tried to upgrade Openstack from Liberty to Mitaka. It seems the upgrade broke Nova, it can no longer start.\n\nThe upgrade, and nova startup, is handled by Ansible; investigating the nova log files on the control nodes, I found this: 2017-02-13 11:00:00.224 17847 ERROR nova.api.openstack.extensions OperationalError: (_mysql_exceptions.OperationalError) (1054, \"Unknown column 'pci_devices.parent_addr' in 'field list'\") ...\n2017-02-13 11:00:00.224 17847 ERROR nova.api.openstack.extensions\n2017-02-13 11:00:00.226 17847 INFO nova.api.openstack.wsgi [req-14c7b025-0e2c-45e0-b35e-f691eee8ef75 685fd4e2b2f0467c9cec6fca59425d13 3cfd68d01988458db3a8b915975693ff] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.OperationalError'>\n\n\nDEBUG oslo_db.sqlalchemy.engines [req-7e385581-96b3-40f7-a9b4-f2409790ad1d None None] MySQL server mode set to STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION _check_effective_sql_mode /opt/stack/venv/nova-20161014T013009Z/lib/python2.7/site-packages/oslo_db/sqlalchemy/engines.py:256\n2017-02-13 11:26:21.255 47245 CRITICAL nova [req-7e385581-96b3-40f7-a9b4-f2409790ad1d None None] OperationalError: (_mysql_exceptions.OperationalError) (1054, \"Unknown column 'aggregates.uuid' in 'field list'\") ...\n\nI assume that, somehow, the database is not the same version as the nova code. Feeling fearless, I tried to do a 'db sync', that said the db was been updated to 319. But after that, a ' select * from nova.migrate_version;' shows version=302, with an incorrect repository path (/opt/stack/venv/nova-20160503T082438Z/lib/python2.7/site-packages/nova/db/sqlalchemy/migrate_repo. expected: ...nova-20161014T013009Z.... \n\nIf anyone could provide me with some hints on how to fix the nova upgrade, I'd be as happy as my little pony.\nIt not, please accept this bug report for the \"Unexpected API Error\" error message.\n\nBest regards,\nAlexander\n\n####################### outputs ####################\nmysql> select * from nova.migrate_version;\n+---------------+---------------------------------------------------------------------------------------------------+---------+\n| repository_id | repository_path                                                                                   | version |\n+---------------+---------------------------------------------------------------------------------------------------+---------+\n| nova          | /opt/stack/venv/nova-20160503T082438Z/lib/python2.7/site-packages/nova/db/sqlalchemy/migrate_repo |     302 |\n+---------------+---------------------------------------------------------------------------------------------------+---------+\n#################\n/opt/stack/venv/nova-20161014T013009Z/bin/nova-manage version\n13.1.3\n/opt/stack/venv/nova-20161014T013009Z/bin/nova-scheduler --version\n13.1.3\nnova --version\n3.3.3\nsudo mysql --version\nmysql  Ver 14.14 Distrib 5.6.30-76.3, for debian-linux-gnu (x86_64) using  6.3", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1664207", 
    "owner": "None", 
    "id": 1664207, 
    "index": 6678, 
    "created": "2017-02-13 12:42:47.692463+00:00", 
    "title": "nova startup failure after openstack upgrade", 
    "comments": [
        {
            "content": "Hello. I'm sorry it this is the wrong place to post this; I'm pretty sure I've messed up myself, but since the error log said \"Please report this\", that's what I'm doing.\n\nI've tried to upgrade Openstack from Liberty to Mitaka. It seems the upgrade broke Nova, it can no longer start.\n\nThe upgrade, and nova startup, is handled by Ansible; investigating the nova log files on the control nodes, I found this: 2017-02-13 11:00:00.224 17847 ERROR nova.api.openstack.extensions OperationalError: (_mysql_exceptions.OperationalError) (1054, \"Unknown column 'pci_devices.parent_addr' in 'field list'\") ...\n2017-02-13 11:00:00.224 17847 ERROR nova.api.openstack.extensions\n2017-02-13 11:00:00.226 17847 INFO nova.api.openstack.wsgi [req-14c7b025-0e2c-45e0-b35e-f691eee8ef75 685fd4e2b2f0467c9cec6fca59425d13 3cfd68d01988458db3a8b915975693ff] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.OperationalError'>\n\n\nDEBUG oslo_db.sqlalchemy.engines [req-7e385581-96b3-40f7-a9b4-f2409790ad1d None None] MySQL server mode set to STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION _check_effective_sql_mode /opt/stack/venv/nova-20161014T013009Z/lib/python2.7/site-packages/oslo_db/sqlalchemy/engines.py:256\n2017-02-13 11:26:21.255 47245 CRITICAL nova [req-7e385581-96b3-40f7-a9b4-f2409790ad1d None None] OperationalError: (_mysql_exceptions.OperationalError) (1054, \"Unknown column 'aggregates.uuid' in 'field list'\") ...\n\nI assume that, somehow, the database is not the same version as the nova code. Feeling fearless, I tried to do a 'db sync', that said the db was been updated to 319. But after that, a ' select * from nova.migrate_version;' shows version=302, with an incorrect repository path (/opt/stack/venv/nova-20160503T082438Z/lib/python2.7/site-packages/nova/db/sqlalchemy/migrate_repo. expected: ...nova-20161014T013009Z.... \n\nIf anyone could provide me with some hints on how to fix the nova upgrade, I'd be as happy as my little pony.\nIt not, please accept this bug report for the \"Unexpected API Error\" error message.\n\nBest regards,\nAlexander\n\n####################### outputs ####################\nmysql> select * from nova.migrate_version;\n+---------------+---------------------------------------------------------------------------------------------------+---------+\n| repository_id | repository_path                                                                                   | version |\n+---------------+---------------------------------------------------------------------------------------------------+---------+\n| nova          | /opt/stack/venv/nova-20160503T082438Z/lib/python2.7/site-packages/nova/db/sqlalchemy/migrate_repo |     302 |\n+---------------+---------------------------------------------------------------------------------------------------+---------+\n#################\n/opt/stack/venv/nova-20161014T013009Z/bin/nova-manage version\n13.1.3\n/opt/stack/venv/nova-20161014T013009Z/bin/nova-scheduler --version\n13.1.3\nnova --version\n3.3.3\nsudo mysql --version\nmysql  Ver 14.14 Distrib 5.6.30-76.3, for debian-linux-gnu (x86_64) using  6.3", 
            "date_created": "2017-02-13 12:42:47.692463+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexandera"
        }, 
        {
            "content": "Added sosreport; excluded .gz-files because upload here times out (file is 135MiB). I've also replaced the real url with \"openstack.example.com\"", 
            "date_created": "2017-02-13 13:06:40.586543+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexandera"
        }, 
        {
            "content": "Did you run \"nova-manage db online_data_migrations\"?\n\nIn Mitaka that will run this online data migration for pci_devices:\n\nhttps://github.com/openstack/nova/blob/stable/mitaka/nova/db/sqlalchemy/api.py#L6481", 
            "date_created": "2017-02-14 21:33:12.473570+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ]
}