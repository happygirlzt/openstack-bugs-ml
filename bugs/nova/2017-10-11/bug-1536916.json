{
    "status": "Fix Released", 
    "last_updated": "2016-02-18 17:56:43.741178+00:00", 
    "description": "Environment:\ndistribution:\n$ cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=\"Ubuntu 14.04.2 LTS\"\n\n$ sudo virsh version\nCompiled against library: libvirt 1.2.2\nUsing library: libvirt 1.2.2\nUsing API: QEMU 1.2.2\nRunning hypervisor: QEMU 2.0.0\n\n$ git log --oneline\n806113e Merge \"Changed filter_by() to filter() during filtering instances in db API\"\n...\n\nThere are two hosts in my environment.\n\nHost A is controller with compute node.  Host B is only as  compute node.\n\nProduce:\n\n1. I upgrade the nova code in Host A.  and restart  n-sch, n-cond, n-cpu.\n\u00a0\u00a0\u00a0the nova code in Host B, and restart n-cpu.\n   keep n-sch as old version.\n\n\n2. do live migration\n$ nova live-migration tt\nit report error. \"Remote error: UnsupportedVersion Endpoint does not support RPC version 4.3. Attempted method: select_destinations\n$ sudo virsh list                                                                                                                      x~~~~~~~~\n\u00a0Id    Name                           State                                                                                                                        x~~~~~~~~\n----------------------------------------------------                                                                                                               x~~~~~~~~\n\u00a026    instance-00000002              running                                                                                                                      x~~~~~~~~\n\nerror details as follow:\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------\n----------------------------------------------------------------------------------+\n| Property                             | Value\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------\n----------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| OS-EXT-AZ:availability_zone          | nova\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| OS-EXT-SRV-ATTR:host                 | shaohe1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| OS-EXT-SRV-ATTR:hostname             | tt                                                                                                                                                                                                                   |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | shaohe1                                                                                                                                                                                                              |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                                                                                                                                                                                    |\n| OS-EXT-SRV-ATTR:kernel_id            | 89e91cc1-a40c-4c9f-bcfa-37b0e94d5f57                                                                                                                                                                                 |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                                                                                                                                                                                    |\n| OS-EXT-SRV-ATTR:ramdisk_id           | d4c09101-c0fa-40de-9c88-28b9428d03fb                                                                                                                                                                                 |\n| OS-EXT-SRV-ATTR:reservation_id       | r-p0884maw                                                                                                                                                                                                           |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                                                                                                                                                                             |\n| OS-EXT-SRV-ATTR:user_data            | -                                                                                                                                                                                                                    |\n| OS-EXT-STS:power_state               | 1                                                                                                                                                                                                                    |\n| OS-EXT-STS:task_state                | migrating                                                                                                                                                                                                            |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                                                                                |\n| OS-SRV-USG:launched_at               | 2015-12-18T07:41:00.000000                                                                                                                                                                                           |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                                                                                    |\n| accessIPv4                           |                                                                                                                                                                                                                      |\n| accessIPv6                           |                                                                                                                                                                                                                      |\n| config_drive                         | True                                                                                                                                                                                                                 |\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| created                              | 2015-12-18T07:40:44Z                                                                                                                                                                                                 |\n| fault                                | {\"message\": \"Remote error: UnsupportedVersion Endpoint does not support RPC version 4.3. Attempted method: select_destinations                                                                                       |\n|                                      | [u'Traceback (most recent call last):\\                                                                                                                                                                               |\n|                                      | ', u'  File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\\\", line 142, in _d\", \"code\": 500, \"details\": \"  File \\\"/opt/stack/nova/nova/conductor/manager.py\\\", line 295, in _live_migrate |\n|                                      |     task.execute()                                                                                                                                                                                                   |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/base.py\\\", line 27, in wrap                                                                                                                                            |\n|                                      |     self.rollback()                                                                                                                                                                                                  |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\\\", line 204, in __exit__                                                                                                                      |\n|                                      |     six.reraise(self.type_, self.value, self.tb)                                                                                                                                                                     |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/base.py\\\", line 24, in wrap                                                                                                                                            |\n|                                      |     return original(self)                                                                                                                                                                                            |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/base.py\\\", line 42, in execute                                                                                                                                         |\n|                                      |     return self._execute()                                                                                                                                                                                           |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/live_migrate.py\\\", line 58, in _execute                                                                                                                                |\n|                                      |     self.destination = self._find_destination()                                                                                                                                                                      |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/live_migrate.py\\\", line 181, in _find_destination                                                                                                                      |\n|                                      |     spec_obj)[0]['host']                                                                                                                                                                                             |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/utils.py\\\", line 358, in wrapped                                                                                                                                             |\n|                                      |     return func(*args, **kwargs)                                                                                                                                                                                     |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/__init__.py\\\", line 51, in select_destinations                                                                                                                        |\n|                                      |     return self.queryclient.select_destinations(context, spec_obj)                                                                                                                                                   |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/__init__.py\\\", line 37, in __run_method                                                                                                                               |\n|                                      |     return getattr(self.instance, __name)(*args, **kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/query.py\\\", line 32, in select_destinations                                                                                                                           |\n|                                      |     return self.scheduler_rpcapi.select_destinations(context, spec_obj)                                                                                                                                              |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/rpcapi.py\\\", line 121, in select_destinations                                                                                                                                |\n|                                      |     return cctxt.call(ctxt, 'select_destinations', **msg_args)                                                                                                                                                       |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\\\", line 158, in call                                                                                                                    |\n|                                      |     retry=self.retry)                                                                                                                                                                                                |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\\\", line 90, in _send                                                                                                                     |\n|                                      |     timeout=timeout, retry=retry)                                                                                                                                                                                    |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\\\", line 464, in send                                                                                                           |\n|                                      |     retry=retry)                                                                                                                                                                                                     |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\\\", line 455, in _send                                                                                                          |\n|                                      |     raise result                                                                                                                                                                                                     |\n|                                      | \", \"created\": \"2016-01-22T03:41:21Z\"}                                                                                                                                                                                |\n| flavor                               | m1.tiny (1)                                                                                                                                                                                                          |\n| hostId                               | 94170a2af829a4a136f9f9c9d3c3f8f10df72bc1238a5eeef5b4ffa5                                                                                                                                                             |\n| id                                   | 058fc419-a8a8-4e08-b62c-a9841ef9cd3f                                                                                                                                                                                 |\n| image                                | cirros-0.3.4-x86_64-uec (3476ee05-b80e-4a80-aac4-78350ce132a2)                                                                                                                                                       |\n| key_name                             | -                                                                                                                                                                                                                    |\n| metadata                             | {}                                                                                                                                                                                                                   |\n| name                                 | tt                                                                                                                                                                                                                   |\n| os-extended-volumes:volumes_attached | []                                                                                                                                                                                                                   |\n| private network                      | fdf1:3ce8:94a:0:f816:3eff:fee1:2a95, 10.0.0.4                                                                                                                                                                        |\n| security_groups                      | default\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| status                               | ERROR                                                                                                                                                                                                                |\n| tenant_id                            | f5a8829cc14c4825a2728b273aa91aa1                                                                                                                                                                                     |\n| updated                              | 2016-01-22T03:41:21Z                                                                                                                                                                                                 |\n| user_id                              | b5450f0c30154d2bb1506968a05c6f80                                                                                                                                                                                     |\n+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n3. when I do live migration again.\n$ nova live-migration tt\nERROR (Conflict): Cannot 'os-migrateLive' instance 058fc419-a8a8-4e08-b62c-a9841ef9cd3f while it is in vm_state error (HTTP 409) (Request-ID: req-2712a326-c3ab-4a6d-9afb-5001b3822047)\n\n4.  and stop the server.\n$ nova stop tt\nCannot 'stop' instance 058fc419-a8a8-4e08-b62c-a9841ef9cd3f while it is in task_state migrating (HTTP 409) (Request-ID: req-580ae847-1a5d-44c8-a285-7cc31dc9e0e2)\nERROR (CommandError): Unable to stop the specified server(s).", 
    "tags": [
        "live-migration"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1536916", 
    "owner": "https://api.launchpad.net/1.0/~shaohef", 
    "id": 1536916, 
    "index": 4433, 
    "created": "2016-01-22 06:27:00.392747+00:00", 
    "title": "nova's task_state still is migrating after live migration failed", 
    "comments": [
        {
            "content": "Environment: \ndistribution: \n$ cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=\"Ubuntu 14.04.2 LTS\"\n\n$ sudo virsh version\nCompiled against library: libvirt 1.2.2\nUsing library: libvirt 1.2.2\nUsing API: QEMU 1.2.2\nRunning hypervisor: QEMU 2.0.0\n\n$ git log --oneline\n806113e Merge \"Changed filter_by() to filter() during filtering instances in db API\"\n...\n\n\n\nThere are two hosts in my environment.\n\nHost A is controller with compute node.  Host B is only as  compute node.\n\nProduce: \n\n1. I upgrade the nova code in Host A.  and restart  n-sch, n-cond, n-cpu. \n\n   And keep the n-cpu  old version on Host B.\n\n2. do live migration \n$ nova live-migration tt\nit report error.\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------\n----------------------------------------------------------------------------------+\n| Property                             | Value\n                                                                                  |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------------------------------\n----------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL\n                                                                                  |\n| OS-EXT-AZ:availability_zone          | nova\n                                                                                  |\n| OS-EXT-SRV-ATTR:host                 | shaohe1\n                                                                                  |\n| OS-EXT-SRV-ATTR:hostname             | tt                                                                                                                                                                                                                   |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | shaohe1                                                                                                                                                                                                              |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                                                                                                                                                                                    |\n| OS-EXT-SRV-ATTR:kernel_id            | 89e91cc1-a40c-4c9f-bcfa-37b0e94d5f57                                                                                                                                                                                 |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                                                                                                                                                                                    |\n| OS-EXT-SRV-ATTR:ramdisk_id           | d4c09101-c0fa-40de-9c88-28b9428d03fb                                                                                                                                                                                 |\n| OS-EXT-SRV-ATTR:reservation_id       | r-p0884maw                                                                                                                                                                                                           |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                                                                                                                                                                             |\n| OS-EXT-SRV-ATTR:user_data            | -                                                                                                                                                                                                                    |\n| OS-EXT-STS:power_state               | 1                                                                                                                                                                                                                    |\n| OS-EXT-STS:task_state                | migrating                                                                                                                                                                                                            |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                                                                                |\n| OS-SRV-USG:launched_at               | 2015-12-18T07:41:00.000000                                                                                                                                                                                           |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                                                                                    |\n| accessIPv4                           |                                                                                                                                                                                                                      |\n| accessIPv6                           |                                                                                                                                                                                                                      |\n| config_drive                         | True                                                                                                                                                                                                                 |\n                                                                                  |\n| created                              | 2015-12-18T07:40:44Z                                                                                                                                                                                                 |\n| fault                                | {\"message\": \"Remote error: UnsupportedVersion Endpoint does not support RPC version 4.3. Attempted method: select_destinations                                                                                       |\n|                                      | [u'Traceback (most recent call last):\\                                                                                                                                                                               |\n|                                      | ', u'  File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\\\", line 142, in _d\", \"code\": 500, \"details\": \"  File \\\"/opt/stack/nova/nova/conductor/manager.py\\\", line 295, in _live_migrate |\n|                                      |     task.execute()                                                                                                                                                                                                   |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/base.py\\\", line 27, in wrap                                                                                                                                            |\n|                                      |     self.rollback()                                                                                                                                                                                                  |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\\\", line 204, in __exit__                                                                                                                      |\n|                                      |     six.reraise(self.type_, self.value, self.tb)                                                                                                                                                                     |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/base.py\\\", line 24, in wrap                                                                                                                                            |\n|                                      |     return original(self)                                                                                                                                                                                            |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/base.py\\\", line 42, in execute                                                                                                                                         |\n|                                      |     return self._execute()                                                                                                                                                                                           |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/live_migrate.py\\\", line 58, in _execute                                                                                                                                |\n|                                      |     self.destination = self._find_destination()                                                                                                                                                                      |\n|                                      |   File \\\"/opt/stack/nova/nova/conductor/tasks/live_migrate.py\\\", line 181, in _find_destination                                                                                                                      |\n|                                      |     spec_obj)[0]['host']                                                                                                                                                                                             |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/utils.py\\\", line 358, in wrapped                                                                                                                                             |\n|                                      |     return func(*args, **kwargs)                                                                                                                                                                                     |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/__init__.py\\\", line 51, in select_destinations                                                                                                                        |\n|                                      |     return self.queryclient.select_destinations(context, spec_obj)                                                                                                                                                   |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/__init__.py\\\", line 37, in __run_method                                                                                                                               |\n|                                      |     return getattr(self.instance, __name)(*args, **kwargs)                 \n                                                                                  |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/client/query.py\\\", line 32, in select_destinations                                                                                                                           |\n|                                      |     return self.scheduler_rpcapi.select_destinations(context, spec_obj)                                                                                                                                              |\n|                                      |   File \\\"/opt/stack/nova/nova/scheduler/rpcapi.py\\\", line 121, in select_destinations                                                                                                                                |\n|                                      |     return cctxt.call(ctxt, 'select_destinations', **msg_args)                                                                                                                                                       |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\\\", line 158, in call                                                                                                                    |\n|                                      |     retry=self.retry)                                                                                                                                                                                                |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\\\", line 90, in _send                                                                                                                     |\n|                                      |     timeout=timeout, retry=retry)                                                                                                                                                                                    |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\\\", line 464, in send                                                                                                           |\n|                                      |     retry=retry)                                                                                                                                                                                                     |\n|                                      |   File \\\"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\\\", line 455, in _send                                                                                                          |\n|                                      |     raise result                                                                                                                                                                                                     |\n|                                      | \", \"created\": \"2016-01-22T03:41:21Z\"}                                                                                                                                                                                |\n| flavor                               | m1.tiny (1)                                                                                                                                                                                                          |\n| hostId                               | 94170a2af829a4a136f9f9c9d3c3f8f10df72bc1238a5eeef5b4ffa5                                                                                                                                                             |\n| id                                   | 058fc419-a8a8-4e08-b62c-a9841ef9cd3f                                                                                                                                                                                 |\n| image                                | cirros-0.3.4-x86_64-uec (3476ee05-b80e-4a80-aac4-78350ce132a2)                                                                                                                                                       |\n| key_name                             | -                                                                                                                                                                                                                    |\n| metadata                             | {}                                                                                                                                                                                                                   |\n| name                                 | tt                                                                                                                                                                                                                   |\n| os-extended-volumes:volumes_attached | []                                                                                                                                                                                                                   |\n| private network                      | fdf1:3ce8:94a:0:f816:3eff:fee1:2a95, 10.0.0.4                                                                                                                                                                        |\n| security_groups                      | default                                                               \n                                                                                  |\n| status                               | ERROR                                                                                                                                                                                                                |\n| tenant_id                            | f5a8829cc14c4825a2728b273aa91aa1                                                                                                                                                                                     |\n| updated                              | 2016-01-22T03:41:21Z                                                                                                                                                                                                 |\n| user_id                              | b5450f0c30154d2bb1506968a05c6f80                                                                                                                                                                                     |\n+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n3. when I do live migration again.\n$ nova live-migration tt\nERROR (Conflict): Cannot 'os-migrateLive' instance 058fc419-a8a8-4e08-b62c-a9841ef9cd3f while it is in vm_state error (HTTP 409) (Request-ID: req-2712a326-c3ab-4a6d-9afb-5001b3822047)\n\n4.  and stop the server.\n$ nova stop tt\nCannot 'stop' instance 058fc419-a8a8-4e08-b62c-a9841ef9cd3f while it is in task_state migrating (HTTP 409) (Request-ID: req-580ae847-1a5d-44c8-a285-7cc31dc9e0e2)\nERROR (CommandError): Unable to stop the specified server(s).", 
            "date_created": "2016-01-22 06:27:00.392747+00:00", 
            "author": "https://api.launchpad.net/1.0/~shaohef"
        }, 
        {
            "content": "I think this is a rolling upgrade gap for live migration. ", 
            "date_created": "2016-01-22 06:27:59.817662+00:00", 
            "author": "https://api.launchpad.net/1.0/~shaohef"
        }, 
        {
            "content": "@lvmxh:\n\nBug skimming\n------------\nI don't yet understand how you did the upgrade. Especially the sentence\n\n    > keep n-sch as old version.\n\nIf you upgrade the nova code on \"host A\" as you said, the nova-scheduler\ncode is affected by this too, which leads to my confusion.\n\nCan provide more details here please?\n* which code level have \"Host A\" and \"Host B\"\n    * before the upgrade?\n    * after the upgrade?\n* which host is the source and which one is the target of the migration?\n* Did you do any kind of RPC version pinning?\n\nThe error\n\n    Remote error: UnsupportedVersion Endpoint does not support \n    RPC version 4.3. Attempted method: select_destinations\n\nyou got is related to commit 40781fba [1] which introduced \nRPC version 4.3 for the scheduler.\n\nLong story short, I *assume* your setup is not valid. The controller\nnode (which includes the scheduler) should always have a newer or equal\nversion compared to compute nodes.\n\nI switch this bug to \"Incomplete\" as I not fully understand the details\nyou provided. After provided the missing information, please switch\nthe status back to \"New\" (or to \"Invalid\" if you figure out this is\na not supported setup).\n\nReferences\n----------\n[1] \"Modify Scheduler RPC API to use RequestSpec obj \"\nhttps://github.com/openstack/nova/commit/40781fbae56c895aa7ff7a90eb527f51f3e19e1d", 
            "date_created": "2016-01-25 12:03:41.145447+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "@Markus Zoeller (markus_z) (mzoeller)\n\nI use devstack. \nAfter I upgrade the code. \nI do not restart the  n-sch, but start other nova components. \n\nDuring the migration, for the RPC version does not match, so it raise error, and stop the migration. \n\nThis is right. \n\nBut you can see the task_state is still keping migration. \ntask_state | migrating |\n\nThis is not right, for the migration abort.\n\nThe task_state keep migrating, it not right. For I can not take any action on it.\n\nFor example, I can not stop it, or I can not do migration again after I upgrade n-sch. \n\n\nNot sure my elaboration  is clear?  ", 
            "date_created": "2016-01-27 15:21:29.090077+00:00", 
            "author": "https://api.launchpad.net/1.0/~shaohef"
        }, 
        {
            "content": "here is the computer api log:\n\n./n-api.log.2015-12-18-071616-159957-2016-01-22 03:41:20.917 DEBUG nova.compute.api [req-8bfe7043-1255-4ca4-a0[1143/1886]\n4f2f admin demo] [instance: 058fc419-a8a8-4e08-b62c-a9841ef9cd3f] Fetching instance by UUID from (pid=25074) get /opt/sta\nck/nova/nova/compute/api.py:2011\n./n-api.log.2015-12-18-071616-159958-2016-01-22 03:41:20.975 DEBUG nova.compute.api [req-8bfe7043-1255-4ca4-a050-abf386e$\n4f2f admin demo] [instance: 058fc419-a8a8-4e08-b62c-a9841ef9cd3f] Going to try to live migrate instance to another host $\nrom (pid=25074) live_migrate /opt/stack/nova/nova/compute/api.py:3260\n./n-api.log.2015-12-18-071616-159959-2016-01-22 03:41:21.449 ERROR nova.api.openstack.extensions [req-8bfe7043-1255-4ca4$\na050-abf386ea4f2f admin demo] Unexpected exception in API method\n./n-api.log.2015-12-18-071616-159960-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions Traceback (most recent $\nall last):\n./n-api.log.2015-12-18-071616-159961-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/api/openstack/extensions.py\", line 478, in wrapped\n./n-api.log.2015-12-18-071616-159962-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     return f(*args, **k$\nargs)\n./n-api.log.2015-12-18-071616-159963-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/api/validation/__init__.py\", line 73, in wrapper\n./n-api.log.2015-12-18-071616-159964-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     return func(*args, $\n*kwargs)\n./n-api.log.2015-12-18-071616-159965-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/api/openstack/compute/migrate_server.py\", line 82, in _migrate_live\n./n-api.log.2015-12-18-071616-159966-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     disk_over_commit, h$\nst)\n./n-api.log.2015-12-18-071616-159967-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/compute/api.py\", line 224, in inner\n./n-api.log.2015-12-18-071616-159968-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     self.compute_rpcapi \n= compute_rpcapi.ComputeAPI()\n./n-api.log.2015-12-18-071616-159969-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/compute/api.py\", line 252, in _wrapped\n./n-api.log.2015-12-18-071616-159970-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     \n./n-api.log.2015-12-18-071616-159971-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/compute/api.py\", line 205, in inner\n./n-api.log.2015-12-18-071616-159972-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     if key not in orig $\nr value != orig[key]:\n./n-api.log.2015-12-18-071616-159973-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/compute/api.py\", line 3270, in live_migrate\n./n-api.log.2015-12-18-071616-159974-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     }\n./n-api.log.2015-12-18-071616-159975-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/conductor/api.py\", line 216, in live_migrate_instance\n./n-api.log.2015-12-18-071616-159976-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     block_migration, dis\nk_over_commit, None)\n./n-api.log.2015-12-18-071616-159977-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/\nnova/conductor/rpcapi.py\", line 303, in migrate_server\n./n-api.log.2015-12-18-071616-159978-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     return cctxt.call(co\nntext, 'migrate_server', **kw)\n./n-api.log.2015-12-18-071616-159979-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/p\nython2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n./n-api.log.2015-12-18-071616-159980-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     retry=self.retry)\n./n-api.log.2015-12-18-071616-159981-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/p\nython2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n./n-api.log.2015-12-18-071616-159982-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     timeout=timeout, ret\nry=retry)\n./n-api.log.2015-12-18-071616-159983-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/p\nython2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 464, in send\n./n-api.log.2015-12-18-071616-159984-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     retry=retry)\n./n-api.log.2015-12-18-071616-159985-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/p\nython2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 455, in _send\n./n-api.log.2015-12-18-071616-159986-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     raise result\n./n-api.log.2015-12-18-071616:159987:2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions MigrationError_Remote: M\nigration error: Remote error: UnsupportedVersion Endpoint does not support RPC version 4.3. Attempted method: select_dest\ninations\n./n-api.log.2015-12-18-071616-159988-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions [u'Traceback (most recen\nt call last):\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispa\ntch_and_reply\\n    executor_callback))\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher\n.py\", line 195, in _dispatch\\n    raise UnsupportedVersion(version, method=method)\\n', u'UnsupportedVersion: Endpoint doe\ns not support RPC version 4.3. Attempted method: select_destinations\\n'].\n./n-api.log.2015-12-18-071616-159989-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions Traceback (most recent c\nall last):\n./n-api.log.2015-12-18-071616-159990-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions \n./n-api.log.2015-12-18-071616-159991-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/p\nython2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n./n-api.log.2015-12-18-071616-159992-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     executor_callback))\n./n-api.log.2015-12-18-071616-159993-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions \n./n-api.log.2015-12-18-071616-159994-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/p\nython2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n./n-api.log.2015-12-18-071616-159995-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     executor_callback)\n./n-api.log.2015-12-18-071616-159996-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions \n./n-api.log.2015-12-18-071616-159997-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/p\nython2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n./n-api.log.2015-12-18-071616-159998-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     result = func(ctxt, \n**new_args)\n./n-api.log.2015-12-18-071616-159999-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions              [1063/1886]\n./n-api.log.2015-12-18-071616-160000-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/p\nython2.7/dist-packages/oslo_messaging/rpc/server.py\", line 150, in inner\n./n-api.log.2015-12-18-071616-160001-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     return func(*args, $\n*kwargs)\n./n-api.log.2015-12-18-071616-160002-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions \n./n-api.log.2015-12-18-071616-160003-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/conductor/manager.py\", line 194, in migrate_server\n./n-api.log.2015-12-18-071616-160004-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     block_migration, di$\nk_over_commit)\n./n-api.log.2015-12-18-071616-160005-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions \n./n-api.log.2015-12-18-071616-160006-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova$\nnova/conductor/manager.py\", line 322, in _live_migrate\n./n-api.log.2015-12-18-071616-160007-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions     raise exception.Mig$\nationError(reason=six.text_type(ex))\n./n-api.log.2015-12-18-071616-160008-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions \n./n-api.log.2015-12-18-071616:160009:2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions MigrationError: Migrati$\nn error: Remote error: UnsupportedVersion Endpoint does not support RPC version 4.3. Attempted method: select_destinatio$\ns\n./n-api.log.2015-12-18-071616-160010-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions [u'Traceback (most rece$\nt call last):\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _disp$\ntch_and_reply\\n    executor_callback))\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatche$\n.py\", line 195, in _dispatch\\n    raise UnsupportedVersion(version, method=method)\\n', u'UnsupportedVersion: Endpoint do$\ns not support RPC version 4.3. Attempted method: select_destinations\\n'].\n./n-api.log.2015-12-18-071616-160011-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions \n./n-api.log.2015-12-18-071616-160012-2016-01-22 03:41:21.449 TRACE nova.api.openstack.extensions \n./n-api.log.2015-12-18-071616-160013-2016-01-22 03:41:21.454 INFO nova.api.openstack.wsgi [req-8bfe7043-1255-4ca4-a050-ab\nf386ea4f2f admin demo] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/\n and attach the Nova API log if possible.\n./n-api.log.2015-12-18-071616-160014-<class 'MigrationError_Remote'>\n./n-api.log.2015-12-18-071616-160015-2016-01-22 03:41:21.455 DEBUG nova.api.openstack.wsgi [req-8bfe7043-1255-4ca4-a050-a\nbf386ea4f2f admin demo] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova\n/ and attach the Nova API log if possible.\n./n-api.log.2015-12-18-071616-160016-<class 'MigrationError_Remote'> from (pid=25074) __call__ /opt/stack/nova/nova/api/o\npenstack/wsgi.py:1180\n./n-api.log.2015-12-18-071616-160017-2016-01-22 03:41:21.457 INFO nova.osapi_compute.wsgi.server [req-8bfe7043-1255-4ca4-\na050-abf386ea4f2f admin demo] 192.168.2.103 \"POST /v2.1/f5a8829cc14c4825a2728b273aa91aa1/servers/058fc419-a8a8-4e08-b62c-\na9841ef9cd3f/action HTTP/1.1\" status: 500 len: 497 time: 0.5497701\n./n-api.log.2015-12-18-071616-160018-2016-01-22 04:07:00.996 DEBUG nova.osapi_compute.wsgi.server [req-0c1291d6-1c18-4511\n-afaa-456dde12c4e5 None None] (25074) accepted ('192.168.2.103', 50734) from (pid=25074) server /usr/local/lib/python2.7/\ndist-packages/eventlet/wsgi.py:826\n", 
            "date_created": "2016-02-01 15:07:23.183691+00:00", 
            "author": "https://api.launchpad.net/1.0/~shaohef"
        }, 
        {
            "content": "here is conductor log\n\n--                                                                                                            [1728/1885]\n./n-cond.log.2015-12-18-071616-7706-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/con\nductor/tasks/base.py\", line 27, in wrap\n./n-cond.log.2015-12-18-071616-7707-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     self.rollback()\n./n-cond.log.2015-12-18-071616-7708-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/usr/local/lib/python2.7\n/dist-packages/oslo_utils/excutils.py\", line 204, in __exit__\n./n-cond.log.2015-12-18-071616-7709-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     six.reraise(self.type_, self\n.value, self.tb)\n./n-cond.log.2015-12-18-071616-7710-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/con\nductor/tasks/base.py\", line 24, in wrap\n./n-cond.log.2015-12-18-071616-7711-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     return original(self)\n./n-cond.log.2015-12-18-071616-7712-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/con\nductor/tasks/base.py\", line 42, in execute\n./n-cond.log.2015-12-18-071616-7713-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     return self._execute()\n./n-cond.log.2015-12-18-071616-7714-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/con\nductor/tasks/live_migrate.py\", line 58, in _execute\n./n-cond.log.2015-12-18-071616-7715-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     self.destination = self._fin\nd_destination()\n./n-cond.log.2015-12-18-071616-7716-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/con\nductor/tasks/live_migrate.py\", line 181, in _find_destination\n./n-cond.log.2015-12-18-071616-7717-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     spec_obj)[0]['host']\n./n-cond.log.2015-12-18-071616-7718-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/sch\neduler/utils.py\", line 358, in wrapped\n./n-cond.log.2015-12-18-071616-7719-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     return func(*args, **kwargs)\n./n-cond.log.2015-12-18-071616-7720-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/sch\neduler/client/__init__.py\", line 51, in select_destinations\n./n-cond.log.2015-12-18-071616-7721-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     return self.queryclient.sele\nct_destinations(context, spec_obj)\n./n-cond.log.2015-12-18-071616-7722-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/sch\neduler/client/__init__.py\", line 37, in __run_method\n./n-cond.log.2015-12-18-071616-7723-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     return getattr(self.instance\n, __name)(*args, **kwargs)\n./n-cond.log.2015-12-18-071616-7724-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/sch\neduler/client/query.py\", line 32, in select_destinations\n./n-cond.log.2015-12-18-071616-7725-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     return self.scheduler_rpcapi\n.select_destinations(context, spec_obj)\n./n-cond.log.2015-12-18-071616-7726-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/opt/stack/nova/nova/sch\neduler/rpcapi.py\", line 121, in select_destinations\n./n-cond.log.2015-12-18-071616-7727-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     return cctxt.call(ctxt, 'sel\nect_destinations', **msg_args)\n./n-cond.log.2015-12-18-071616-7728-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/usr/local/lib/python2.7\n/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n/n-cond.log.2015-12-18-071616-7729-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     retry=self.retry)[1686/1885]\n./n-cond.log.2015-12-18-071616-7730-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/usr/local/lib/python2.7\n/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n./n-cond.log.2015-12-18-071616-7731-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     timeout=timeout, retry=retry\n)\n./n-cond.log.2015-12-18-071616-7732-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/usr/local/lib/python2.7\n/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 464, in send\n./n-cond.log.2015-12-18-071616-7733-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     retry=retry)\n./n-cond.log.2015-12-18-071616-7734-2016-01-22 03:41:21.341 TRACE nova.conductor.manager   File \"/usr/local/lib/python2.7\n/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 455, in _send\n./n-cond.log.2015-12-18-071616-7735-2016-01-22 03:41:21.341 TRACE nova.conductor.manager     raise result\n./n-cond.log.2015-12-18-071616:7736:2016-01-22 03:41:21.341 TRACE nova.conductor.manager RemoteError: Remote error: Unsup\nportedVersion Endpoint does not support RPC version 4.3. Attempted method: select_destinations\n./n-cond.log.2015-12-18-071616-7737-2016-01-22 03:41:21.341 TRACE nova.conductor.manager [u'Traceback (most recent call l\nast):\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_\nreply\\n    executor_callback))\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", li\nne 195, in _dispatch\\n    raise UnsupportedVersion(version, method=method)\\n', u'UnsupportedVersion: Endpoint does not su\npport RPC version 4.3. Attempted method: select_destinations\\n'].\n./n-cond.log.2015-12-18-071616-7738-2016-01-22 03:41:21.341 TRACE nova.conductor.manager \n./n-cond.log.2015-12-18-071616:7739:2016-01-22 03:41:21.345 WARNING nova.scheduler.utils [req-8bfe7043-1255-4ca4-a050-abf\n386ea4f2f admin demo] Failed to compute_task_migrate_server: Remote error: UnsupportedVersion Endpoint does not support R\nPC version 4.3. Attempted method: select_destinations\n./n-cond.log.2015-12-18-071616-7740-[u'Traceback (most recent call last):\\n', u'  File \"/usr/local/lib/python2.7/dist-pac\nkages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', u'  File \"/usr/loc\nal/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 195, in _dispatch\\n    raise UnsupportedVersion(ve\nrsion, method=method)\\n', u'UnsupportedVersion: Endpoint does not support RPC version 4.3. Attempted method: select_desti\nnations\\n'].\n./n-cond.log.2015-12-18-071616-7741-2016-01-22 03:41:21.345 WARNING nova.scheduler.utils [req-8bfe7043-1255-4ca4-a050-abf\n386ea4f2f admin demo] [instance: 058fc419-a8a8-4e08-b62c-a9841ef9cd3f] Setting instance to ERROR state.\n./n-cond.log.2015-12-18-071616:7742:2016-01-22 03:41:21.439 ERROR oslo_messaging.rpc.dispatcher [req-8bfe7043-1255-4ca4-a\n050-abf386ea4f2f admin demo] Exception during message handling: Migration error: Remote error: UnsupportedVersion Endpoin\nt does not support RPC version 4.3. Attempted method: select_destinations\n./n-cond.log.2015-12-18-071616-7743-[u'Traceback (most recent call last):\\n', u'  File \"/usr/local/lib/python2.7/dist-pac\nkages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', u'  File \"/usr/loc\nal/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 195, in _dispatch\\n    raise UnsupportedVersion(ve\nrsion, method=method)\\n', u'UnsupportedVersion: Endpoint does not support RPC version 4.3. Attempted method: select_desti\nnations\\n'].\n./n-cond.log.2015-12-18-071616-7744-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent ca\nll last):\n./n-cond.log.2015-12-18-071616-7745-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/l[1647/1885]\nthon2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n./n-cond.log.2015-12-18-071616-7746-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n./n-cond.log.2015-12-18-071616-7747-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/py\nthon2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n./n-cond.log.2015-12-18-071616-7748-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n./n-cond.log.2015-12-18-071616-7749-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/py\nthon2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n./n-cond.log.2015-12-18-071616-7750-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, *\n*new_args)\n./n-cond.log.2015-12-18-071616-7751-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/py\nthon2.7/dist-packages/oslo_messaging/rpc/server.py\", line 150, in inner\n./n-cond.log.2015-12-18-071616-7752-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher     return func(*args, **\nkwargs)\n./n-cond.log.2015-12-18-071616-7753-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/n\nova/conductor/manager.py\", line 194, in migrate_server\n./n-cond.log.2015-12-18-071616-7754-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher     block_migration, disk\n_over_commit)\n./n-cond.log.2015-12-18-071616-7755-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/n\nova/conductor/manager.py\", line 322, in _live_migrate\n./n-cond.log.2015-12-18-071616-7756-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher     raise exception.Migra\ntionError(reason=six.text_type(ex))\n./n-cond.log.2015-12-18-071616:7757:2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher MigrationError: Migration\n error: Remote error: UnsupportedVersion Endpoint does not support RPC version 4.3. Attempted method: select_destination$\n./n-cond.log.2015-12-18-071616-7758-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher [u'Traceback (most recen$\n call last):\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispa$\nch_and_reply\\n    executor_callback))\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher$\npy\", line 195, in _dispatch\\n    raise UnsupportedVersion(version, method=method)\\n', u'UnsupportedVersion: Endpoint doe$\n not support RPC version 4.3. Attempted method: select_destinations\\n'].\n./n-cond.log.2015-12-18-071616-7759-2016-01-22 03:41:21.439 TRACE oslo_messaging.rpc.dispatcher \n./n-cond.log.2015-12-18-071616:7760:2016-01-22 03:41:21.440 ERROR oslo_messaging._drivers.common [req-8bfe7043-1255-4ca4$\na050-abf386ea4f2f admin demo] Returning exception Migration error: Remote error: UnsupportedVersion Endpoint does not su$\nport RPC version 4.3. Attempted method: select_destinations\n./n-cond.log.2015-12-18-071616-7761-[u'Traceback (most recent call last):\\n', u'  File \"/usr/local/lib/python2.7/dist-pa$\nkages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', u'  File \"/usr/lo$\nal/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 195, in _dispatch\\n    raise UnsupportedVersion(v$\nrsion, method=method)\\n', u'UnsupportedVersion: Endpoint does not support RPC version 4.3. Attempted method: select_dest$\nnations\\n']. to caller\n./n-cond.log.2015-12-18-071616:7762:2016-01-22 03:41:21.440 ERROR oslo_messaging._drivers.common [req-8bfe7043-1255-4ca4-\na050-abf386ea4f2f admin demo] ['Traceback (most recent call last):\\n', '  File \"/usr/local/lib/python2.7/dist-packages/os\nlo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', '  File \"/usr/local/lib/py\nthon2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n', '  File \"/usr\n/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\\n    result = func(ctxt, \n**new_args)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 150, in inner\\n    re\nturn func(*args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/conductor/manager.py\", line 194, in migrate_server\\n    bloc\nk_migration, disk_over_commit)\\n', '  File \"/opt/stack/nova/nova/conductor/manager.py\", line 322, in _live_migrate\\n    r\naise exception.MigrationError(reason=six.text_type(ex))\\n', 'MigrationError: Migration error: Remote error: UnsupportedVe\nrsion Endpoint does not support RPC version 4.3. Attempted method: select_destinations\\n[u\\'Traceback (most recent call l\nast):\\\\n\\', u\\'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_a\nnd_reply\\\\n    executor_callback))\\\\n\\', u\\'  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.\npy\", line 195, in _dispatch\\\\n    raise UnsupportedVersion(version, method=method)\\\\n\\', u\\'UnsupportedVersion: Endpoint \ndoes not support RPC version 4.3. Attempted method: select_destinations\\\\n\\'].\\n']\n", 
            "date_created": "2016-02-01 15:13:27.067287+00:00", 
            "author": "https://api.launchpad.net/1.0/~shaohef"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/275650", 
            "date_created": "2016-02-03 11:59:41.012022+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "So this will only happen when nova-conductor is newer than nova-scheduler and nova-scheduler's RPC is not pinned to use older version. In case of such mismatch I think that we can revert instance to active state as live migration will not start anyway.", 
            "date_created": "2016-02-10 22:15:28.957400+00:00", 
            "author": "https://api.launchpad.net/1.0/~pawel-koniszewski"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/275650\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=30d5d805c10b0cc6e474fe1292b2c6549fc07d33\nSubmitter: Jenkins\nBranch:    master\n\ncommit 30d5d805c10b0cc6e474fe1292b2c6549fc07d33\nAuthor: ShaoHe Feng <email address hidden>\nDate:   Tue Feb 2 09:41:33 2016 +0000\n\n    reset task_state after select_destinations failed.\n    \n    During live migration, there maybe exception when let scheduler\n    select destination, and live migration will abort. But the task\n    state of the instance still keep migrating, then we can not take\n    any action on this instance.\n    \n    We need to recover the state of the task as None.\n    We should also recover the vm_state.\n    \n    Change-Id: If1cae8f4c9037f7821554a94d4440f66d9538794\n    Closes-bug: #1536916\n", 
            "date_created": "2016-02-18 17:56:42.978439+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}