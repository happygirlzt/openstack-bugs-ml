{
    "status": "Opinion", 
    "last_updated": "2014-11-20 15:24:51.344096+00:00", 
    "description": "When I tried devstack with Neutron Ryu plugin, VM launch failed with the following error:\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-2f3489c9-9fb5-4666-b5a3-dabf8068160b)\n\nChange Iaaee059a (https://review.openstack.org/#/c/49455/) added the validation of the port quota via Neutron API.\nHowever, Neutron Quota API  is an extended API. Therefore, this API isn't provided when using Neutron plugin which doesn't support Quota extension and it causes 404 if the API is called.\n\n\nThe following error message appeared in screen-n-api.log:\n\nREQ: curl -i http://192.168.0.10:9696/v2.0/quotas/d2b5645336864565a3b5110e31cbe096.json -X GET -H \"X-Auth-Token: <...>\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"User-Agent: pytho\nn-neutronclient\"\n from (pid=23388) http_log_req /opt/stack/python-neutronclient/neutronclient/common/utils.py:176\n2013-12-24 07:37:22.860 DEBUG neutronclient.client [-] RESP:{'date': 'Tue, 24 Dec 2013 07:37:22 GMT', 'status': '404', 'content-length': '52', 'content-type': 'text/p\nlain; charset=UTF-8'} 404 Not Found\n\nThe resource could not be found.\n\n   \n from (pid=23388) http_log_resp /opt/stack/python-neutronclient/neutronclient/common/utils.py:182\n2013-12-24 07:37:22.860 DEBUG neutronclient.v2_0.client [-] Error message: 404 Not Found\n\nThe resource could not be found.\n\n    from (pid=23388) _handle_fault_response /opt/stack/python-neutronclient/neutronclient/v2_0/client.py:1126\n2013-12-24 07:37:22.860 ERROR nova.api.openstack [req-2f3489c9-9fb5-4666-b5a3-dabf8068160b admin demo] Caught error: 404 Not Found\n\nThe resource could not be found.\n\n   \n2013-12-24 07:37:22.860 TRACE nova.api.openstack Traceback (most recent call last):\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 121, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 581, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 930, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     content_type, body, accept)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 992, in _process_stack\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1073, in dispatch\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 940, in create\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     legacy_bdm=legacy_bdm)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/hooks.py\", line 105, in inner\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     rv = f(*args, **kwargs)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/api.py\", line 1269, in create\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     legacy_bdm=legacy_bdm)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/api.py\", line 903, in _create_instance\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     max_count)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/api.py\", line 713, in _validate_and_build_base_options\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     requested_networks, max_count)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/api.py\", line 462, in _check_requested_networks\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     max_count)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 582, in validate_networks\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     quotas = neutron.show_quota(tenant_id=context.project_id)['quota']\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 112, in with_params\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     ret = self.function(instance, *args, **kwargs)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 280, in show_quota\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return self.get(self.quota_path % (tenant_id), params=_params)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 1237, in get\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     headers=headers, params=params)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 1222, in retry_request\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     headers=headers, params=params)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 1165, in do_request\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     self._handle_fault_response(status_code, replybody)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 1135, in _handle_fault_response\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     exception_handler_v20(status_code, des_error_body)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 92, in exception_handler_v20\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     message=message)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack NeutronClientException: 404 Not Found\n2013-12-24 07:37:22.860 TRACE nova.api.openstack \n2013-12-24 07:37:22.860 TRACE nova.api.openstack The resource could not be found.\n2013-12-24 07:37:22.860 TRACE nova.api.openstack \n2013-12-24 07:37:22.860 TRACE nova.api.openstack    \n2013-12-24 07:37:22.860 TRACE nova.api.openstack \n2013-12-24 07:37:22.863 INFO nova.api.openstack [req-2f3489c9-9fb5-4666-b5a3-dabf8068160b admin demo] http://192.168.0.10:8774/v2/d2b5645336864565a3b5110e31cbe096/servers returned with HTTP 500", 
    "tags": [
        "neutron"
    ], 
    "importance": "Wishlist", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1264436", 
    "owner": "None", 
    "id": 1264436, 
    "index": 1468, 
    "created": "2013-12-27 05:36:45.951572+00:00", 
    "title": "VM launch fails always when using particular Neutron plugin", 
    "comments": [
        {
            "content": "When I tried devstack with Neutron Ryu plugin, VM launch failed with the following error:\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-2f3489c9-9fb5-4666-b5a3-dabf8068160b)\n\nChange Iaaee059a (https://review.openstack.org/#/c/49455/) added the validation of the port quota via Neutron API.\nHowever, Neutron Quota API  is an extended API. Therefore, this API isn't provided when using Neutron plugin which doesn't support Quota extension and it causes 404 if the API is called.\n\n\nThe following error message appeared in screen-n-api.log:\n\nREQ: curl -i http://192.168.0.10:9696/v2.0/quotas/d2b5645336864565a3b5110e31cbe096.json -X GET -H \"X-Auth-Token: <...>\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"User-Agent: pytho\nn-neutronclient\"\n from (pid=23388) http_log_req /opt/stack/python-neutronclient/neutronclient/common/utils.py:176\n2013-12-24 07:37:22.860 DEBUG neutronclient.client [-] RESP:{'date': 'Tue, 24 Dec 2013 07:37:22 GMT', 'status': '404', 'content-length': '52', 'content-type': 'text/p\nlain; charset=UTF-8'} 404 Not Found\n\nThe resource could not be found.\n\n   \n from (pid=23388) http_log_resp /opt/stack/python-neutronclient/neutronclient/common/utils.py:182\n2013-12-24 07:37:22.860 DEBUG neutronclient.v2_0.client [-] Error message: 404 Not Found\n\nThe resource could not be found.\n\n    from (pid=23388) _handle_fault_response /opt/stack/python-neutronclient/neutronclient/v2_0/client.py:1126\n2013-12-24 07:37:22.860 ERROR nova.api.openstack [req-2f3489c9-9fb5-4666-b5a3-dabf8068160b admin demo] Caught error: 404 Not Found\n\nThe resource could not be found.\n\n   \n2013-12-24 07:37:22.860 TRACE nova.api.openstack Traceback (most recent call last):\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 121, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 581, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 930, in __call__\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     content_type, body, accept)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 992, in _process_stack\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1073, in dispatch\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 940, in create\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     legacy_bdm=legacy_bdm)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/hooks.py\", line 105, in inner\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     rv = f(*args, **kwargs)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/api.py\", line 1269, in create\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     legacy_bdm=legacy_bdm)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/api.py\", line 903, in _create_instance\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     max_count)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/api.py\", line 713, in _validate_and_build_base_options\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     requested_networks, max_count)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/api.py\", line 462, in _check_requested_networks\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     max_count)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 582, in validate_networks\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     quotas = neutron.show_quota(tenant_id=context.project_id)['quota']\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 112, in with_params\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     ret = self.function(instance, *args, **kwargs)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 280, in show_quota\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     return self.get(self.quota_path % (tenant_id), params=_params)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 1237, in get\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     headers=headers, params=params)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 1222, in retry_request\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     headers=headers, params=params)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 1165, in do_request\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     self._handle_fault_response(status_code, replybody)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 1135, in _handle_fault_response\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     exception_handler_v20(status_code, des_error_body)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack   File \"/opt/stack/python-neutronclient/neutronclient/v2_0/client.py\", line 92, in exception_handler_v20\n2013-12-24 07:37:22.860 TRACE nova.api.openstack     message=message)\n2013-12-24 07:37:22.860 TRACE nova.api.openstack NeutronClientException: 404 Not Found\n2013-12-24 07:37:22.860 TRACE nova.api.openstack \n2013-12-24 07:37:22.860 TRACE nova.api.openstack The resource could not be found.\n2013-12-24 07:37:22.860 TRACE nova.api.openstack \n2013-12-24 07:37:22.860 TRACE nova.api.openstack    \n2013-12-24 07:37:22.860 TRACE nova.api.openstack \n2013-12-24 07:37:22.863 INFO nova.api.openstack [req-2f3489c9-9fb5-4666-b5a3-dabf8068160b admin demo] http://192.168.0.10:8774/v2/d2b5645336864565a3b5110e31cbe096/servers returned with HTTP 500", 
            "date_created": "2013-12-27 05:36:45.951572+00:00", 
            "author": "https://api.launchpad.net/1.0/~ykaneko0929"
        }, 
        {
            "content": "I get the same error with Contrail.", 
            "date_created": "2014-03-08 08:18:13.262108+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "https://review.openstack.org/#/c/79279/", 
            "date_created": "2014-04-18 07:15:54.301059+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "Honestly, I don't think supporting neutron plugins without quota support is something we should do. That optionality adds to many permutations to the matrix.", 
            "date_created": "2014-09-17 18:29:32.452188+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "The Ryu plugin is deprecated in Juno anyways, and I believe the ofagent plugin works fine with ML2 and quotas, though I'll verify.", 
            "date_created": "2014-09-17 18:37:07.796960+00:00", 
            "author": "https://api.launchpad.net/1.0/~mestery"
        }, 
        {
            "content": "I don't think that's the good way to solve that problem.\nEven an API is not in the core Neutron API, we should check if the extension is supported and handle the case is not implemented.\nAnd the quota API is not in the core Neutron API.", 
            "date_created": "2014-09-29 08:03:40.931272+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "Change abandoned by Sean Dague (<email address hidden>) on branch: master\nReview: https://review.openstack.org/79279\nReason: This review is > 4 weeks without comment, and failed Jenkins the last time it was checked. We are abandoning this for now. Feel free to reactivate the review by pressing the restore button and leaving a 'recheck' comment to get fresh test results.", 
            "date_created": "2014-11-20 15:24:50.051669+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}