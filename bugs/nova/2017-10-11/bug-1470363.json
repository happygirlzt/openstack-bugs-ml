{
    "status": "Expired", 
    "last_updated": "2015-10-27 04:17:30.544752+00:00", 
    "description": "When having the following in /etc/nova/nova.conf \n\npci_passthrough_whitelist={'devname':'enp5s0f1', 'physical_network':'physnet2'}\n\nNova compute fails to start and I get the error:\n\n2015-07-01 09:48:03.610 4791 ERROR nova.openstack.common.threadgroup [req-b86e5da5-a24e-4eb6-bebd-0ec36fc08021 - - - - -] Invalid PCI devices Whitelist config Invalid entry: '{'devname':'enp5s0f1', 'physical_network':'physnet2'}'\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/threadgroup.py\", line 145, in wait\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     x.wait()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 175, in wait\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 121, in wait\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 214, in main\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/service.py\", line 497, in run_service\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     service.start()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 183, in start\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1291, in pre_start_hook\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6246, in update_available_resource\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     rt = self._get_resource_tracker(nodename)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 715, in _get_resource_tracker\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     nodename)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/compute/resource_tracker.py\", line 78, in __init__\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     self.pci_filter = pci_whitelist.get_pci_devices_filter()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/pci/whitelist.py\", line 109, in get_pci_devices_filter\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return PciHostDevicesWhiteList(CONF.pci_passthrough_whitelist)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/pci/whitelist.py\", line 89, in __init__\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     self.specs = self._parse_white_list_from_config(whitelist_spec)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/pci/whitelist.py\", line 56, in _parse_white_list_from_config\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     reason=_(\"Invalid entry: '%s'\") % jsonspec)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup PciConfigInvalidWhitelist: Invalid PCI devices Whitelist config Invalid entry: '{'devname':'enp5s0f1', 'physical_network':'physnet2'}'\n\n\nWhen using double quotes there is no problem:\npci_passthrough_whitelist={\"devname\":\"enp5s0f1\", \"physical_network\":\"physnet2\"}\n\nVersion\n======\npython-nova-2015.1.0-13.el7ost.noarch", 
    "tags": [
        "config"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1470363", 
    "owner": "None", 
    "id": 1470363, 
    "index": 5629, 
    "created": "2015-07-01 06:53:44.539140+00:00", 
    "title": "pci_passthrough_whitelist should support single quotes for keys and values", 
    "comments": [
        {
            "content": "When having the following in /etc/nova/nova.conf \n\npci_passthrough_whitelist={'devname':'enp5s0f1', 'physical_network':'physnet2'}\n\nNova compute fails to start and I get the error:\n\n2015-07-01 09:48:03.610 4791 ERROR nova.openstack.common.threadgroup [req-b86e5da5-a24e-4eb6-bebd-0ec36fc08021 - - - - -] Invalid PCI devices Whitelist config Invalid entry: '{'devname':'enp5s0f1', 'physical_network':'physnet2'}'\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/threadgroup.py\", line 145, in wait\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     x.wait()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 175, in wait\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 121, in wait\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 214, in main\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/service.py\", line 497, in run_service\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     service.start()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 183, in start\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1291, in pre_start_hook\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6246, in update_available_resource\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     rt = self._get_resource_tracker(nodename)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 715, in _get_resource_tracker\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     nodename)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/compute/resource_tracker.py\", line 78, in __init__\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     self.pci_filter = pci_whitelist.get_pci_devices_filter()\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/pci/whitelist.py\", line 109, in get_pci_devices_filter\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     return PciHostDevicesWhiteList(CONF.pci_passthrough_whitelist)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/pci/whitelist.py\", line 89, in __init__\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     self.specs = self._parse_white_list_from_config(whitelist_spec)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/pci/whitelist.py\", line 56, in _parse_white_list_from_config\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup     reason=_(\"Invalid entry: '%s'\") % jsonspec)\n2015-07-01 09:48:03.610 4791 TRACE nova.openstack.common.threadgroup PciConfigInvalidWhitelist: Invalid PCI devices Whitelist config Invalid entry: '{'devname':'enp5s0f1', 'physical_network':'physnet2'}'\n\n\nWhen using double quotes there is no problem:\npci_passthrough_whitelist={\"devname\":\"enp5s0f1\", \"physical_network\":\"physnet2\"}\n\nVersion\n======\npython-nova-2015.1.0-13.el7ost.noarch", 
            "date_created": "2015-07-01 06:53:44.539140+00:00", 
            "author": "https://api.launchpad.net/1.0/~itzikb1"
        }, 
        {
            "content": "The code tries [1] to parse this config option as a JSON string. Try \nthis:\n\n    invalid JSON: {'devname':'enp5s0f1', 'physical_network':'physnet2'}\n    valid JSON:   {\"devname\":\"enp5s0f1\", \"physical_network\":\"physnet2\"}\n\nwith [2]. The config option \"pc_alias\" behaves the same.\n\nI'm not sure if this is a configuration issue or if the code should\n(somehow) tolerate that. At least the documentation of these options [3]\nshould be clarified that the string option has to be a valid JSON.\n\n[1] https://github.com/openstack/nova/blob/master/nova/pci/whitelist.py\n[2] http://jsonlint.com/\n[3] http://docs.openstack.org/kilo/config-reference/content/list-of-compute-config-options.html", 
            "date_created": "2015-07-03 09:53:05.705136+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "My two cents is that we should validate this value on init and if it does not jsonload then we should not start the service", 
            "date_created": "2015-07-05 14:38:02.701481+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "I agree with Gary.", 
            "date_created": "2015-07-06 10:56:18.385657+00:00", 
            "author": "https://api.launchpad.net/1.0/~itzikb1"
        }, 
        {
            "content": "ok, but  that is the current implementation, no ? \nI can clarify the error message that to \n\"Invalid PCI devices Whitelist config Invalid JSON entry: '{'devname':'enp5s0f1', 'physical_network':'physnet2'}'\"\n", 
            "date_created": "2015-07-06 11:23:11.631450+00:00", 
            "author": "https://api.launchpad.net/1.0/~moshele"
        }, 
        {
            "content": "Change abandoned by Moshe Levi (<email address hidden>) on branch: master\nReview: https://review.openstack.org/198535\nReason: should be just documentation update", 
            "date_created": "2015-07-12 14:21:59.896104+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "from the abandon reason, seems this is incomplete state", 
            "date_created": "2015-08-27 13:12:08.338107+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2015-10-27 04:17:27.428516+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}