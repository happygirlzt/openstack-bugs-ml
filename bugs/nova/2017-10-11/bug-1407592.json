{
    "status": "Invalid", 
    "last_updated": "2017-01-09 06:48:29.932689+00:00", 
    "description": "I use Ubuntu 14.04.1 and OpenStack Juno latest release.\n\nIn case I do SNAPSHOT for small virtual machine - it works.  In case I do SNAPSHOT for a big size VM (more than 30G) it fails after starting of saving SNAPSHOT to a Glance storage.\n\nSo if to summarize:\n- could be created SNAPSHOTS for small VMs but not for a big\n- it is enough space on Glance storage and on root partitions on all involved physical machines\n\nThe following errors could be found in logs:\n/var/log/nova/nova-compute.log\n2015-01-05 11:14:56.745 1767 INFO nova.compute.resource_tracker [-] Compute_service record updated for node4:node4\n2015-01-05 11:15:32.157 1767 ERROR glanceclient.common.http [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] Request returned failure status 500.\n2015-01-05 11:15:32.158 1767 WARNING urllib3.connectionpool [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] HttpConnectionPool is full, discarding connection: cloud\n2015-01-05 11:15:34.479 1767 ERROR glanceclient.common.http [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] Request returned failure status 401.\n2015-01-05 11:15:34.480 1767 ERROR nova.compute.manager [req-692621ba-7a6b-471a-9e16-d74ee2eb875d None] [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d] Error while trying to clean up image 71cd0c84-fa54-4d35-9ad6-63e36969de1c\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d] Traceback (most recent call last):\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 375, in decorated_function\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     self.image_api.delete(context, image_id)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/nova/image/api.py\", line 137, in delete\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     return session.delete(context, image_id)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 418, in delete\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     self._client.call(context, 1, 'delete', image_id)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 232, in call\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     return getattr(client.images, method)(*args, **kwargs)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/glanceclient/v1/images.py\", line 255, in delete\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     resp, body = self.client.delete(url)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 265, in delete\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     return self._request('DELETE', url, **kwargs)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 221, in _request\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     raise exc.from_response(resp, resp.content)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d] HTTPUnauthorized: <html>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]  <head>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   <title>401 Unauthorized</title>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]  </head>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]  <body>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   <h1>401 Unauthorized</h1>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   This server could not verify that you are authorized to access the document you requested. Either you supplied the wrong credentials (e.g., bad password), or your browser does not understand how to supply the credentials required.<br /><br />\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]  </body>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d] </html> (HTTP 401)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]\n2015-01-05 11:15:34.876 1767 INFO nova.scheduler.client.report [req-692621ba-7a6b-471a-9e16-d74ee2eb875d None] Compute_service record updated for ('node4', 'node4')\n2015-01-05 11:15:34.879 1767 ERROR oslo.messaging.rpc.dispatcher [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] Exception during message handling: <html>\n <head>\n  <title>500 Internal Server Error</title>\n </head>\n <body>\n  <h1>500 Internal Server Error</h1>\n  Failed to upload image 71cd0c84-fa54-4d35-9ad6-63e36969de1c<br /><br />\n\n </body>\n</html> (HTTP 500)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     payload)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 303, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     pass\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 289, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 331, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 319, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 379, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     instance=instance)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 369, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     *args, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3027, in snapshot_instance\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     task_states.IMAGE_SNAPSHOT)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3058, in _snapshot_instance\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     update_task_state)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1752, in snapshot\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     image_file)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/api.py\", line 126, in update\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     purge_props=purge_props)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 405, in update\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     _reraise_translated_image_exception(image_id)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 403, in update\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     image_id, **image_meta)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 232, in call\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return getattr(client.images, method)(*args, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/v1/images.py\", line 329, in update\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     resp, body = self.client.put(url, headers=hdrs, data=image_data)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 259, in put\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return self._request('PUT', url, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 221, in _request\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     raise exc.from_response(resp, resp.content)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher HTTPInternalServerError: <html>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher  <head>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   <title>500 Internal Server Error</title>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher  </head>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher  <body>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   <h1>500 Internal Server Error</h1>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   Failed to upload image 71cd0c84-fa54-4d35-9ad6-63e36969de1c<br /><br />\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher  </body>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher </html> (HTTP 500)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher\n2015-01-05 11:15:55.562 1767 AUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\n\n/var/log/glance/api.log\n2015-01-05 11:15:20.569 19103 INFO glance.wsgi.server [-] 192.168.7.215 - - [05/Jan/2015 11:15:20] \"HEAD /v1/images/2403f983-c6e2-4de1-9e56-dec0cbc1c203 HTTP/1.1\" 200 837 0.014521\n2015-01-05 11:15:32.054 19103 INFO glance.registry.client.v1.client [-] Registry client request PUT /images/71cd0c84-fa54-4d35-9ad6-63e36969de1c raised NotAuthenticated\n2015-01-05 11:15:32.054 19103 ERROR glance.api.v1.upload_utils [-] Failed to upload image 71cd0c84-fa54-4d35-9ad6-63e36969de1c\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils Traceback (most recent call last):\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/api/v1/upload_utils.py\", line 159, in upload_data_to_store\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     from_state='saving')\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/api.py\", line 169, in update_image_metadata\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     from_state=from_state)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 198, in update_image\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     headers=headers)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 130, in do_request\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     'exc_name': exc_name})\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 115, in do_request\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     **kwargs)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 71, in wrapped\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     return func(self, *args, **kwargs)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 373, in do_request\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     headers=copy.deepcopy(headers))\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 85, in wrapped\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     return func(self, method, url, body, headers)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 516, in _do_request\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     raise exception.NotAuthenticated(res.read())\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils NotAuthenticated: Authentication required\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils\n2015-01-05 11:15:32.152 19103 INFO glance.registry.client.v1.client [-] Registry client request PUT /images/71cd0c84-fa54-4d35-9ad6-63e36969de1c raised NotAuthenticated\n2015-01-05 11:15:32.152 19103 ERROR glance.api.v1.upload_utils [-] Unable to kill image 71cd0c84-fa54-4d35-9ad6-63e36969de1c:\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils Traceback (most recent call last):\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/api/v1/upload_utils.py\", line 77, in safe_kill\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     _kill(req, image_id, from_state)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/api/v1/upload_utils.py\", line 62, in _kill\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     from_state=from_state)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/api.py\", line 169, in update_image_metadata\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     from_state=from_state)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 198, in update_image\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     headers=headers)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 130, in do_request\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     'exc_name': exc_name})\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 115, in do_request\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     **kwargs)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 71, in wrapped\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     return func(self, *args, **kwargs)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 373, in do_request\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     headers=copy.deepcopy(headers))\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 85, in wrapped\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     return func(self, method, url, body, headers)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 516, in _do_request\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     raise exception.NotAuthenticated(res.read())\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils NotAuthenticated: Authentication required\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils\n2015-01-05 11:15:32.154 19103 INFO glance.wsgi.server [-] 192.168.7.219 - - [05/Jan/2015 11:15:32] \"PUT /v1/images/71cd0c84-fa54-4d35-9ad6-63e36969de1c HTTP/1.1\" 500 407 700.615980\n2015-01-05 11:15:34.463 19103 INFO urllib3.connectionpool [-] Starting new HTTP connection (1): cloud\n2015-01-05 11:15:34.476 19103 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-01-05 11:15:34.476 19103 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-01-05 11:15:34.477 19103 INFO keystonemiddleware.auth_token [-] Invalid user token - deferring reject downstream\n2015-01-05 11:15:34.477 19103 INFO glance.wsgi.server [-] 192.168.7.219 - - [05/Jan/2015 11:15:34] \"DELETE /v1/images/71cd0c84-fa54-4d35-9ad6-63e36969de1c HTTP/1.1\" 401 485 0.015917", 
    "tags": [
        "propose-close"
    ], 
    "importance": "Undecided", 
    "heat": 24, 
    "link": "https://bugs.launchpad.net/nova/+bug/1407592", 
    "owner": "None", 
    "id": 1407592, 
    "index": 5356, 
    "created": "2015-01-05 08:29:34.898214+00:00", 
    "title": "Snapshots fail to upload larger (~30G+) images, with error '500 Internal Server Error Failed to upload image'", 
    "comments": [
        {
            "content": "I use Ubuntu 14.04.1 and OpenStack Juno latest release.\n\nIn case I do SNAPSHOT for small virtual machine - it works.  In case I do SNAPSHOT for a big size VM (more than 30G) it fails after starting of saving SNAPSHOT to a Glance storage.\n\nSo if to summarize:\n- could be created SNAPSHOTS for small VMs but not for a big\n- it is enough space on Glance storage and on root partitions on all involved physical machines\n\nThe following errors could be found in logs:\n/var/log/nova/nova-compute.log\n2015-01-05 11:14:56.745 1767 INFO nova.compute.resource_tracker [-] Compute_service record updated for node4:node4\n2015-01-05 11:15:32.157 1767 ERROR glanceclient.common.http [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] Request returned failure status 500.\n2015-01-05 11:15:32.158 1767 WARNING urllib3.connectionpool [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] HttpConnectionPool is full, discarding connection: cloud\n2015-01-05 11:15:34.479 1767 ERROR glanceclient.common.http [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] Request returned failure status 401.\n2015-01-05 11:15:34.480 1767 ERROR nova.compute.manager [req-692621ba-7a6b-471a-9e16-d74ee2eb875d None] [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d] Error while trying to clean up image 71cd0c84-fa54-4d35-9ad6-63e36969de1c\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d] Traceback (most recent call last):\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 375, in decorated_function\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     self.image_api.delete(context, image_id)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/nova/image/api.py\", line 137, in delete\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     return session.delete(context, image_id)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 418, in delete\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     self._client.call(context, 1, 'delete', image_id)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 232, in call\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     return getattr(client.images, method)(*args, **kwargs)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/glanceclient/v1/images.py\", line 255, in delete\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     resp, body = self.client.delete(url)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 265, in delete\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     return self._request('DELETE', url, **kwargs)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 221, in _request\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]     raise exc.from_response(resp, resp.content)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d] HTTPUnauthorized: <html>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]  <head>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   <title>401 Unauthorized</title>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]  </head>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]  <body>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   <h1>401 Unauthorized</h1>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]   This server could not verify that you are authorized to access the document you requested. Either you supplied the wrong credentials (e.g., bad password), or your browser does not understand how to supply the credentials required.<br /><br />\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]  </body>\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d] </html> (HTTP 401)\n2015-01-05 11:15:34.480 1767 TRACE nova.compute.manager [instance: f5a232a4-a7b2-4858-b793-38936b0f7a4d]\n2015-01-05 11:15:34.876 1767 INFO nova.scheduler.client.report [req-692621ba-7a6b-471a-9e16-d74ee2eb875d None] Compute_service record updated for ('node4', 'node4')\n2015-01-05 11:15:34.879 1767 ERROR oslo.messaging.rpc.dispatcher [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] Exception during message handling: <html>\n <head>\n  <title>500 Internal Server Error</title>\n </head>\n <body>\n  <h1>500 Internal Server Error</h1>\n  Failed to upload image 71cd0c84-fa54-4d35-9ad6-63e36969de1c<br /><br />\n\n </body>\n</html> (HTTP 500)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     payload)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 303, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     pass\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 289, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 331, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 319, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 379, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     instance=instance)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 369, in decorated_function\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     *args, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3027, in snapshot_instance\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     task_states.IMAGE_SNAPSHOT)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3058, in _snapshot_instance\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     update_task_state)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1752, in snapshot\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     image_file)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/api.py\", line 126, in update\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     purge_props=purge_props)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 405, in update\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     _reraise_translated_image_exception(image_id)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 403, in update\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     image_id, **image_meta)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 232, in call\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return getattr(client.images, method)(*args, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/v1/images.py\", line 329, in update\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     resp, body = self.client.put(url, headers=hdrs, data=image_data)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 259, in put\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     return self._request('PUT', url, **kwargs)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 221, in _request\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher     raise exc.from_response(resp, resp.content)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher HTTPInternalServerError: <html>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher  <head>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   <title>500 Internal Server Error</title>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher  </head>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher  <body>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   <h1>500 Internal Server Error</h1>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher   Failed to upload image 71cd0c84-fa54-4d35-9ad6-63e36969de1c<br /><br />\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher  </body>\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher </html> (HTTP 500)\n2015-01-05 11:15:34.879 1767 TRACE oslo.messaging.rpc.dispatcher\n2015-01-05 11:15:55.562 1767 AUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\n\n/var/log/glance/api.log\n2015-01-05 11:15:20.569 19103 INFO glance.wsgi.server [-] 192.168.7.215 - - [05/Jan/2015 11:15:20] \"HEAD /v1/images/2403f983-c6e2-4de1-9e56-dec0cbc1c203 HTTP/1.1\" 200 837 0.014521\n2015-01-05 11:15:32.054 19103 INFO glance.registry.client.v1.client [-] Registry client request PUT /images/71cd0c84-fa54-4d35-9ad6-63e36969de1c raised NotAuthenticated\n2015-01-05 11:15:32.054 19103 ERROR glance.api.v1.upload_utils [-] Failed to upload image 71cd0c84-fa54-4d35-9ad6-63e36969de1c\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils Traceback (most recent call last):\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/api/v1/upload_utils.py\", line 159, in upload_data_to_store\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     from_state='saving')\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/api.py\", line 169, in update_image_metadata\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     from_state=from_state)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 198, in update_image\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     headers=headers)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 130, in do_request\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     'exc_name': exc_name})\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 115, in do_request\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     **kwargs)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 71, in wrapped\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     return func(self, *args, **kwargs)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 373, in do_request\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     headers=copy.deepcopy(headers))\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 85, in wrapped\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     return func(self, method, url, body, headers)\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 516, in _do_request\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils     raise exception.NotAuthenticated(res.read())\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils NotAuthenticated: Authentication required\n2015-01-05 11:15:32.054 19103 TRACE glance.api.v1.upload_utils\n2015-01-05 11:15:32.152 19103 INFO glance.registry.client.v1.client [-] Registry client request PUT /images/71cd0c84-fa54-4d35-9ad6-63e36969de1c raised NotAuthenticated\n2015-01-05 11:15:32.152 19103 ERROR glance.api.v1.upload_utils [-] Unable to kill image 71cd0c84-fa54-4d35-9ad6-63e36969de1c:\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils Traceback (most recent call last):\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/api/v1/upload_utils.py\", line 77, in safe_kill\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     _kill(req, image_id, from_state)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/api/v1/upload_utils.py\", line 62, in _kill\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     from_state=from_state)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/api.py\", line 169, in update_image_metadata\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     from_state=from_state)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 198, in update_image\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     headers=headers)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 130, in do_request\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     'exc_name': exc_name})\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/registry/client/v1/client.py\", line 115, in do_request\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     **kwargs)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 71, in wrapped\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     return func(self, *args, **kwargs)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 373, in do_request\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     headers=copy.deepcopy(headers))\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 85, in wrapped\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     return func(self, method, url, body, headers)\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 516, in _do_request\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils     raise exception.NotAuthenticated(res.read())\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils NotAuthenticated: Authentication required\n2015-01-05 11:15:32.152 19103 TRACE glance.api.v1.upload_utils\n2015-01-05 11:15:32.154 19103 INFO glance.wsgi.server [-] 192.168.7.219 - - [05/Jan/2015 11:15:32] \"PUT /v1/images/71cd0c84-fa54-4d35-9ad6-63e36969de1c HTTP/1.1\" 500 407 700.615980\n2015-01-05 11:15:34.463 19103 INFO urllib3.connectionpool [-] Starting new HTTP connection (1): cloud\n2015-01-05 11:15:34.476 19103 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-01-05 11:15:34.476 19103 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-01-05 11:15:34.477 19103 INFO keystonemiddleware.auth_token [-] Invalid user token - deferring reject downstream\n2015-01-05 11:15:34.477 19103 INFO glance.wsgi.server [-] 192.168.7.219 - - [05/Jan/2015 11:15:34] \"DELETE /v1/images/71cd0c84-fa54-4d35-9ad6-63e36969de1c HTTP/1.1\" 401 485 0.015917", 
            "date_created": "2015-01-05 08:29:34.898214+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhdan"
        }, 
        {
            "content": "The glance logs are showing auth issues, have you checked into that?  Maybe it's timing out and invalidating your token?  What are your token expiration times set to?\n\nWhat version of python-glanceclient are you using?  And what's the backing glance store?  Just the default file system or some other backend?", 
            "date_created": "2015-01-13 15:25:28.626937+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Try tracing when the snapshot request starts in the nova-api and glance-api logs and then see how long it takes before it fails, then check if your token lifetime is expiring before that, there is a config setting in keystone.conf for that I think.", 
            "date_created": "2015-01-13 15:28:49.168813+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Also, this might be an indication of another bug:\n\n\"2015-01-05 11:15:32.158 1767 WARNING urllib3.connectionpool [req-692621ba-7a6b-471a-9e16-d74ee2eb875d ] HttpConnectionPool is full, discarding connection: cloud\"\n\nSee python-glanceclient bug 1341777.", 
            "date_created": "2015-01-13 15:29:45.177584+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "\"The glance logs are showing auth issues, have you checked into that? Maybe it's timing out and invalidating your token?  What are your token expiration times set to?\" - I have checked auth and it is correct as other images can be uploaded and saved.  Token expiration value was increased in two times in comparison with default value.\n\n\"What version of python-glanceclient are you using?\" - \nPackage: python-glanceclient\nStatus: install ok installed\nPriority: extra\nSection: python\nInstalled-Size: 332\nMaintainer: Chuck Short <email address hidden>\nArchitecture: all\nVersion: 1:0.14.0-0ubuntu1~cloud0\nReplaces: glance-client\nDepends: python-babel (>= 1.3), python-keystoneclient (>= 1:0.9.0), python-openssl (>= 0.11), python-prettytable (>= 0.7), python-requests, python-setuptools, python-warlock (>= 1.0.1), python-six (>= 1.7.0), python (>= 2.7), python (<< 2.8), python:any (>= 2.7.1-0ubuntu2), python-pbr\n\nPackage: nova-api\nStatus: install ok installed\nPriority: extra\nSection: net\nInstalled-Size: 421\nMaintainer: Ubuntu Developers <email address hidden>\nArchitecture: all\nSource: nova\nVersion: 1:2014.2.1-0ubuntu1~cloud0\nDepends: iptables, nova-common (= 1:2014.2.1-0ubuntu1~cloud0), sysv-rc (>= 2.88dsf-24) | file-rc (>= 0.8.16), python:any\n\nPackage: glance-api\nStatus: install ok installed\nPriority: extra\nSection: python\nInstalled-Size: 146\nMaintainer: Ubuntu OpenStack <email address hidden>\nArchitecture: all\nSource: glance\nVersion: 1:2014.2.1-0ubuntu1~cloud0\nReplaces: glance (<< 2012.1~e1~20110919.1021-0ubuntu2)\nDepends: glance-common (= 1:2014.2.1-0ubuntu1~cloud0), sysv-rc (>= 2.88dsf-24) | file-rc (>= 0.8.16), python:any\nRecommends: python-glanceclient\n\n\"And what's the backing glance store?\"   -  default file system\n\n", 
            "date_created": "2015-01-16 08:27:25.403497+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhdan"
        }, 
        {
            "content": "Also after this error I can see necessary SNAPSHOT in status Saving in my dashboard, but this doesn't exist on file system and could be remved from dashboard by pressing Delete image....", 
            "date_created": "2015-01-16 08:30:32.983226+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhdan"
        }, 
        {
            "content": "it is too big to update successfully before the token expiration.  make sure the host disk is enough.", 
            "date_created": "2015-01-21 10:13:36.691396+00:00", 
            "author": "https://api.launchpad.net/1.0/~82433422-a"
        }, 
        {
            "content": "All values in keystone related to expiration were increased in 2 times - no result. I mentioned that all disks on all machines has enough free space.", 
            "date_created": "2015-01-21 11:59:16.670593+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhdan"
        }, 
        {
            "content": "Although this sounds like a real bug, unclear if this is a nova bug, looks more like a glance bug", 
            "date_created": "2015-01-22 21:36:18.428520+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Hi Michael, \n\nWhen you tested this, what were the exact values you set for the token expiration? The default token expiration is 1 hour, which might need to be adjusted depending on how long the operation takes. \n\nhttps://github.com/openstack/keystone/blob/e54c32399b2e80ed729e906154c50cc11cd923c2/etc/keystone.conf.sample#L1474", 
            "date_created": "2015-01-29 15:30:44.451985+00:00", 
            "author": "https://api.launchpad.net/1.0/~lbragstad"
        }, 
        {
            "content": "Marking as incomplete in Glance because I suspect it's an issue with Keystone tokens expiring, and marking as incomplete in Keystone because it's not clear how long the snapshot takes or how what exactly the keystone token lifespan is (see comment #9).", 
            "date_created": "2015-01-29 17:37:27.655539+00:00", 
            "author": "https://api.launchpad.net/1.0/~dolph"
        }, 
        {
            "content": "Hi All\n\nAll values of token expiration in keystone.conf were increased in 2-3 times in comparison with default values. (services of OpenStack were restarted after it). For example: expiration=5000, expiration_time=3600 and so on...\n\nI do SNAPSHOT of VM (disk size: ~60Gb with 35Gb used space)  (SNAPSHOT compression enabled). Start time - 11.03... then (after ~ 45 minutes):\n\n/var/log/glance/api.log\n2015-01-31 11:48:12.388 1504 INFO glance.wsgi.server [-] 192.168.7.215 - - [31/Jan/2015 11:48:12] \"HEAD /v1/images/983b6452-d9aa-4224-a8a4-6f942e31ef76 HTTP/1.1\" 200 1619 0.016105\n2015-01-31 11:48:30.398 1504 INFO urllib3.connectionpool [-] Starting new HTTP connection (1): jcloud\n2015-01-31 11:48:30.412 1504 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-01-31 11:48:30.412 1504 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-01-31 11:48:30.413 1504 INFO keystonemiddleware.auth_token [-] Invalid user token - deferring reject downstream\n2015-01-31 11:48:32.163 1504 INFO glance.wsgi.server [-] 192.168.7.215 - - [31/Jan/2015 11:48:32] \"GET /v1/images/detail?sort_key=created_at&sort_dir=desc&limit=1000 HTTP/1.1\" 200 20964 0.077386\n\nand finally:\n\n2015-01-31 11:55:53.200 1504 INFO glance.wsgi.server [-] 192.168.7.218 - - [31/Jan/2015 11:55:53] \"PUT /v1/images/983b6452-d9aa-4224-a8a4-6f942e31ef76 HTTP/1.1\" 401 485 442.797256\n2015-01-31 11:55:55.363 1503 INFO urllib3.connectionpool [-] Starting new HTTP connection (1): jcloud\n2015-01-31 11:55:55.379 1503 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-01-31 11:55:55.379 1503 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-01-31 11:55:55.380 1503 INFO keystonemiddleware.auth_token [-] Invalid user token - deferring reject downstream\n2015-01-31 11:55:55.381 1503 INFO glance.wsgi.server [-] 192.168.7.218 - - [31/Jan/2015 11:55:55] \"DELETE /v1/images/983b6452-d9aa-4224-a8a4-6f942e31ef76 HTTP/1.1\" 401 485 0.019435\n\n\nPlus in /var/log/nova/nova-compute.log at this time (after ~ 45 minutes):\n2015-01-31 11:55:03.359 1789 INFO nova.compute.resource_tracker [-] Compute_service record updated for jcnode3:jcnode3\n2015-01-31 11:55:53.175 1789 ERROR glanceclient.common.http [req-923ed9a0-dda2-4c89-9ad2-b851f84a33d6 ] Request returned failure statu                          s 401.\n2015-01-31 11:55:53.176 1789 WARNING urllib3.connectionpool [req-923ed9a0-dda2-4c89-9ad2-b851f84a33d6 ] HttpConnectionPool is full, di                          scarding connection: jcloud\n2015-01-31 11:55:55.387 1789 ERROR glanceclient.common.http [req-923ed9a0-dda2-4c89-9ad2-b851f84a33d6 ] Request returned failure statu                          s 401.\n2015-01-31 11:55:55.387 1789 ERROR nova.compute.manager [req-923ed9a0-dda2-4c89-9ad2-b851f84a33d6 None] [instance: f5e7446e-5272-4be0-                          bfe0-2e2037f65b43] Error while trying to clean up image 983b6452-d9aa-4224-a8a4-6f942e31ef76\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43] Traceback (most recent call l                          ast):\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]   File \"/usr/lib/python2.7/di                          st-packages/nova/compute/manager.py\", line 375, in decorated_function\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]     self.image_api.delete(con                          text, image_id)\n\n.....\n\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]     return self._request('DEL                          ETE', url, **kwargs)\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]   File \"/usr/lib/python2.7/di                          st-packages/glanceclient/common/http.py\", line 221, in _request\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]     raise exc.from_response(r                          esp, resp.content)\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43] HTTPUnauthorized: <html>\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]  <head>\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]   <title>401 Unauthorized</ti                          tle>\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]  </head>\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]  <body>\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]   <h1>401 Unauthorized</h1>\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]   This server could not verif                          y that you are authorized to access the document you requested. Either you supplied the wrong credentials (e.g., bad password), or you                          r browser does not understand how to supply the credentials required.<br /><br />\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]  </body>\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43] </html> (HTTP 401)\n2015-01-31 11:55:55.387 1789 TRACE nova.compute.manager [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43]\n2015-01-31 11:55:55.756 1789 INFO nova.scheduler.client.report [req-923ed9a0-dda2-4c89-9ad2-b851f84a33d6 None] Compute_service record                           updated for ('jcnode3', 'jcnode3')\n2015-01-31 11:55:55.758 1789 ERROR oslo.messaging.rpc.dispatcher [req-923ed9a0-dda2-4c89-9ad2-b851f84a33d6 ] Exception during message                           handling: Not authorized for image 983b6452-d9aa-4224-a8a4-6f942e31ef76.\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatche                          r.py\", line 134, in _dispatch_and_reply\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatche                          r.py\", line 177, in _dispatch\n\n......\n\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher     return getattr(client.images, method)(*args, **kwargs)\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/v1/images.py\",                           line 329, in update\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher     resp, body = self.client.put(url, headers=hdrs, data=image_data)\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\"                          , line 259, in put\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher     return self._request('PUT', url, **kwargs)\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\"                          , line 221, in _request\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher     raise exc.from_response(resp, resp.content)\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher ImageNotAuthorized: Not authorized for image 983b6452-d9aa-4224-a8a4-                          6f942e31ef76.\n2015-01-31 11:55:55.758 1789 TRACE oslo.messaging.rpc.dispatcher\n2015-01-31 11:56:00.285 1789 AUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\n2015-01-31 11:56:00.787 1789 WARNING nova.compute.resource_tracker [-] [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43] Instance not r                          esizing, skipping migration.\n2015-01-31 11:56:00.787 1789 WARNING nova.compute.resource_tracker [-] [instance: f5e7446e-5272-4be0-bfe0-2e2037f65b43] Instance not r                          esizing, skipping migration.\n\nAdditionally Keystome log (/var/log/keystone/keystone-all.log)\n2015-01-31 10:37:16.269 1107 WARNING keystone.openstack.common.versionutils [-] Deprecated: keystone.middleware.core.XmlBodyMiddleware is deprecated as of Icehouse in favor of support for \"application/json\" only and may be removed in Kilo.\n2015-01-31 10:37:17.743 1107 WARNING keystone.openstack.common.versionutils [-] Deprecated: keystone.contrib.revoke.backends.kvs is deprecated as of Juno in favor of keystone.contrib.revoke.backends.sql and may be removed in Kilo.\n2015-01-31 10:43:02.510 1154 WARNING keystone.openstack.common.versionutils [-] Deprecated: keystone.middleware.core.XmlBodyMiddleware is deprecated as of Icehouse in favor of support for \"application/json\" only and may be removed in Kilo.\n2015-01-31 10:43:02.709 1154 WARNING keystone.openstack.common.versionutils [-] Deprecated: keystone.contrib.revoke.backends.kvs is deprecated as of Juno in favor of keystone.contrib.revoke.backends.sql and may be removed in Kilo.\n2015-01-31 11:48:30.409 1554 WARNING keystone.common.wsgi [-] Could not find token: cb60502d9ee14ec697980c92aedd2a6e\n2015-01-31 11:55:55.377 1554 WARNING keystone.common.wsgi [-] Could not find token: cb60502d9ee14ec697980c92aedd2a6e\n\nIMPORTANT: I can do SNAPSHOTS of smaller VMs! Right after previous errors I did 2 SNAPSHOTS of smaller VMs. \n2) VM size: ~30Gb with 4.5Gb used space:  resulted size of SNAPSHOT: 11.1 Gb (took ~20 minutes). This VM is located on the same node as failed.\n1) VM size: ~80Gb with 3.6Gb used space:  resulted size of SNAPSHOT: 2.1 Gb (took ~10 minutes). This VM is located on another node.", 
            "date_created": "2015-01-31 09:27:03.026659+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhdan"
        }, 
        {
            "content": "I can see the same error during the image upload into Glance. With Swift backend I got this error for files with size more than 15Gb, if I use simple file system, I got the same error for files with size more than 30Gb.\nMy token expiration time is 1000 hours, in console I can see the following:\n\n[root@controller]# glance image-create --name 34Gb-image --disk-format qcow2 --container-format bare --file ./MyImage.qcow2 --progress\n[=============================>] 100%\nRequest returned failure status.\n500 Internal Server Error\nFailed to upload image 66418414-0b29-4ffe-b8d0-aa42c71058ce\n(HTTP 500)\n[root@controller]# \n\nIn Glance logs I can see the following:\n\n________________\n<150>Feb 10 00:37:18 node-1 glance-glance.registry.api.v1.images INFO: Updating metadata for image 66418414-0b29-4ffe-b8d0-aa42c71058ce\n<150>Feb 10 00:37:18 node-1 glance-glance.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 00:37:18] \"PUT /images/66418414-0b29-4ffe-b8d0-aa42c71058ce HTTP/1.1\" 200 689 0.019713\n<150>Feb 10 01:12:50 node-1 glance-urllib3.connectionpool INFO: Starting new HTTP connection (1): 192.168.0.4\n<150>Feb 10 01:12:51 node-1 glance-urllib3.connectionpool INFO: Starting new HTTP connection (1): 192.168.0.4\n<150>Feb 10 01:12:51 node-1 glance-urllib3.connectionpool INFO: Starting new HTTP connection (1): 192.168.0.4\n<150>Feb 10 01:12:51 node-1 glance-glance.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 01:12:51] \"PUT /images/66418414-0b29-4ffe-b8d0-aa42c71058ce HTTP/1.1\" 401 194 0.554667\n<150>Feb 10 01:12:51 node-1 glance-glance.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 01:12:51] \"PUT /images/66418414-0b29-4ffe-b8d0-aa42c71058ce HTTP/1.1\" 401 194 0.000398\n<150>Feb 10 01:12:51 node-1 glance-glance.registry.client.v1.client INFO: Registry client request PUT /images/66418414-0b29-4ffe-b8d0-aa42c71058ce raised NotAuthenticated\n<147>Feb 10 01:12:51 node-1 glance-glance.api.v1.upload_utils ERROR: Failed to upload image 66418414-0b29-4ffe-b8d0-aa42c71058ce\nTraceback (most recent call last):\n  File \"/usr/lib/python2.6/site-packages/glance/api/v1/upload_utils.py\", line 145, in upload_data_to_store\n    update_data)\n  File \"/usr/lib/python2.6/site-packages/glance/registry/client/v1/api.py\", line 169, in update_image_metadata\n    from_state=from_state)\n  File \"/usr/lib/python2.6/site-packages/glance/registry/client/v1/client.py\", line 190, in update_image\n    headers=headers)\n  File \"/usr/lib/python2.6/site-packages/glance/registry/client/v1/client.py\", line 107, in do_request\n    **kwargs)\n  File \"/usr/lib/python2.6/site-packages/glance/common/client.py\", line 69, in wrapped\n    return func(self, *args, **kwargs)\n  File \"/usr/lib/python2.6/site-packages/glance/common/client.py\", line 386, in do_request\n    headers=copy.deepcopy(headers))\n  File \"/usr/lib/python2.6/site-packages/glance/common/client.py\", line 83, in wrapped\n    return func(self, method, url, body, headers)\n  File \"/usr/lib/python2.6/site-packages/glance/common/client.py\", line 527, in _do_request\n    raise exception.NotAuthenticated(res.read())\nNotAuthenticated: Authentication required\n<150>Feb 10 01:12:51 node-1 glance-glance.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 01:12:51] \"PUT /images/66418414-0b29-4ffe-b8d0-aa42c71058ce HTTP/1.1\" 401 194 0.000604\n<150>Feb 10 01:12:51 node-1 glance-glance.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 01:12:51] \"PUT /images/66418414-0b29-4ffe-b8d0-aa42c71058ce HTTP/1.1\" 401 194 0.000734\n<150>Feb 10 01:12:51 node-1 glance-glance.registry.client.v1.client INFO: Registry client request PUT /images/66418414-0b29-4ffe-b8d0-aa42c71058ce raised NotAuthenticated\n<147>Feb 10 01:12:51 node-1 glance-glance.api.v1.upload_utils ERROR: Unable to kill image 66418414-0b29-4ffe-b8d0-aa42c71058ce:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.6/site-packages/glance/api/v1/upload_utils.py\", line 70, in safe_kill\n    _kill(req, image_id)\n  File \"/usr/lib/python2.6/site-packages/glance/api/v1/upload_utils.py\", line 56, in _kill\n    {'status': 'killed'})\n  File \"/usr/lib/python2.6/site-packages/glance/registry/client/v1/api.py\", line 169, in update_image_metadata\n    from_state=from_state)\n  File \"/usr/lib/python2.6/site-packages/glance/registry/client/v1/client.py\", line 190, in update_image\n    headers=headers)\n  File \"/usr/lib/python2.6/site-packages/glance/registry/client/v1/client.py\", line 107, in do_request\n    **kwargs)\n  File \"/usr/lib/python2.6/site-packages/glance/common/client.py\", line 69, in wrapped\n    return func(self, *args, **kwargs)\n  File \"/usr/lib/python2.6/site-packages/glance/common/client.py\", line 386, in do_request\n    headers=copy.deepcopy(headers))\n  File \"/usr/lib/python2.6/site-packages/glance/common/client.py\", line 83, in wrapped\n    return func(self, method, url, body, headers)\n  File \"/usr/lib/python2.6/site-packages/glance/common/client.py\", line 527, in _do_request\n    raise exception.NotAuthenticated(res.read())\nNotAuthenticated: Authentication required\n<150>Feb 10 01:12:51 node-1 glance-glance.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 01:12:51] \"POST /v1/images HTTP/1.1\" 500 293 2132.618581\n\n________________", 
            "date_created": "2015-02-10 05:36:27.732720+00:00", 
            "author": "https://api.launchpad.net/1.0/~tnurlygayanov"
        }, 
        {
            "content": "In keystone logs I can see the following:\n\n<188>Feb 10 05:39:15 node-1 keystone-keystone.middleware.core WARNING: RBAC: Invalid token\n<188>Feb 10 05:39:15 node-1 keystone-keystone.common.wsgi WARNING: The request you have made requires authentication.\n<190>Feb 10 05:39:15 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:39:15] \"GET /v2.0/tokens/7d3a842e                                                         ef914967ba92a1e03210d08b HTTP/1.1\" 401 312 0.002939\n<190>Feb 10 05:39:15 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:39:15] \"POST /v2.0/tokens HTTP/1.                                                         1\" 200 3927 0.049472\n<190>Feb 10 05:39:15 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:39:15] \"GET /v2.0/tokens/7d3a842e                                                         ef914967ba92a1e03210d08b HTTP/1.1\" 200 3927 0.005070\n<188>Feb 10 05:39:15 node-1 keystone-keystone.middleware.core WARNING: RBAC: Invalid token\n<188>Feb 10 05:39:15 node-1 keystone-keystone.common.wsgi WARNING: The request you have made requires authentication.\n<190>Feb 10 05:39:15 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:39:15] \"GET /v2.0/tokens/7d3a842e                                                         ef914967ba92a1e03210d08b HTTP/1.1\" 401 312 0.002919\n<190>Feb 10 05:39:15 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:39:15] \"POST /v2.0/tokens HTTP/1.                                                         1\" 200 3927 0.050005\n<190>Feb 10 05:39:15 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:39:15] \"GET /v2.0/tokens/7d3a842e                                                         ef914967ba92a1e03210d08b HTTP/1.1\" 200 3927 0.004965\n<188>Feb 10 05:43:16 node-1 keystone-keystone.common.wsgi WARNING: Could not find token, 7d3a842eef914967ba92a1e03210d08b.\n<190>Feb 10 05:43:16 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:43:16] \"GET /v2.0/tokens/7d3a842e                                                         ef914967ba92a1e03210d08b HTTP/1.1\" 404 252 0.005836\n<190>Feb 10 05:43:16 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:43:16] \"POST /v2.0/tokens HTTP/1.                                                         1\" 200 3927 0.057720\n<190>Feb 10 05:43:16 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:43:16] \"GET /v2.0/tokens/be7eca85                                                         41df458cb2f014e2ae744353 HTTP/1.1\" 200 3927 0.005301\n<190>Feb 10 05:44:26 node-1 keystone-keystone.common.environment INFO: Environment configured as: eventlet\n<190>Feb 10 05:44:26 node-1 keystone-keystone.common.kvs.core INFO: Using default dogpile sha1_mangle_key as KVS region token-dri                                                         ver key_mangler\n<188>Feb 10 05:44:26 node-1 keystone-keystone.token.provider WARNING: keystone.conf [signing] token_format is deprecated in favor                                                          of keystone.conf [token] provider\n<188>Feb 10 05:44:26 node-1 keystone-keystone.token.provider WARNING: keystone.conf [signing] token_format is deprecated in favor                                                          of keystone.conf [token] provider\n<188>Feb 10 05:44:26 node-1 keystone-keystone.openstack.common.versionutils WARNING: Deprecated: keystone.middleware.core.XmlBody                                                         Middleware is deprecated as of Icehouse in favor of support for \"application/json\" only and may be removed in K.\n<190>Feb 10 05:44:26 node-1 keystone-keystone.common.environment.eventlet_server INFO: Starting /usr/bin/keystone-all on 192.168.                                                         0.5:35357\n<190>Feb 10 05:44:26 node-1 keystone-keystone.common.environment.eventlet_server INFO: Starting /usr/bin/keystone-all on 192.168.                                                         0.5:5000\n<190>Feb 10 05:44:26 node-1 keystone-eventlet.wsgi.server INFO: (30159) wsgi starting up on http://192.168.0.5:35357/\n<190>Feb 10 05:44:26 node-1 keystone-eventlet.wsgi.server INFO: (30159) wsgi starting up on http://192.168.0.5:5000/\n<190>Feb 10 05:44:28 node-1 keystone-keystone.common.environment INFO: Environment configured as: eventlet\n<190>Feb 10 05:44:28 node-1 keystone-keystone.common.kvs.core INFO: Using default dogpile sha1_mangle_key as KVS region token-dri                                                         ver key_mangler\n<188>Feb 10 05:44:28 node-1 keystone-keystone.token.provider WARNING: keystone.conf [signing] token_format is deprecated in favor                                                          of keystone.conf [token] provider\n<188>Feb 10 05:44:28 node-1 keystone-keystone.token.provider WARNING: keystone.conf [signing] token_format is deprecated in favor                                                          of keystone.conf [token] provider\n<188>Feb 10 05:44:29 node-1 keystone-keystone.openstack.common.versionutils WARNING: Deprecated: keystone.middleware.core.XmlBody                                                         Middleware is deprecated as of Icehouse in favor of support for \"application/json\" only and may be removed in K.\n<190>Feb 10 05:44:29 node-1 keystone-keystone.common.environment.eventlet_server INFO: Starting /usr/bin/keystone-all on 192.168.                                                         0.5:35357\n<190>Feb 10 05:44:29 node-1 keystone-keystone.common.environment.eventlet_server INFO: Starting /usr/bin/keystone-all on 192.168.                                                         0.5:5000\n<190>Feb 10 05:44:29 node-1 keystone-eventlet.wsgi.server INFO: (30212) wsgi starting up on http://192.168.0.5:35357/\n<190>Feb 10 05:44:29 node-1 keystone-eventlet.wsgi.server INFO: (30212) wsgi starting up on http://192.168.0.5:5000/\n<150>Feb 10 05:44:53 node-1 glance-keystoneclient.middleware.auth_token INFO: Starting keystone auth_token middleware\n<150>Feb 10 05:44:53 node-1 glance-keystoneclient.middleware.auth_token INFO: Using /tmp/keystone-signing-glance as cache directo                                                         ry for signing certificate\n<188>Feb 10 05:45:17 node-1 keystone-keystone.middleware.core WARNING: RBAC: Invalid token\n<188>Feb 10 05:45:17 node-1 keystone-keystone.common.wsgi WARNING: The request you have made requires authentication.\n<190>Feb 10 05:45:17 node-1 keystone-eventlet.wsgi.server INFO: 192.168.0.4 - - [10/Feb/2015 05:45:17] \"GET /v2.0/tokens/be7eca85                                                         41df458cb2f014e2ae744353 HTTP/1.1\" 401 312 0.005366", 
            "date_created": "2015-02-10 06:10:30.643614+00:00", 
            "author": "https://api.launchpad.net/1.0/~tnurlygayanov"
        }, 
        {
            "content": "Update: I have fixed the issue - need to edit default values for paramters in keystone configuration file:\n\n/etc/keystone/keystone.conf:\n[DEFAULT]\n...\ndebug = True\n...\n[cache]\nexpiration_time = 6000000 (default value was 600 seconds)\n...\n[signing]\n#token_format=UUID (because it is deprecated)\n...\n[token]\nexpiration=3600000 (default value was 3600 seconds)\nprovider=keystone.token.providers.uuid.Provider (default value was 'None')\nrevocation_cache_time=360000000 (default value was 3600 seconds)\n\n________________\n\n\nand then I have restarted keystone:\n/etc/init.d/openstack-keystone restart\n\n________________\n\n\nAnd now I can successfully upload image with 40Gb size.\n\nI hope that it will help :)\nProbably we can set largest values for these parametersby default?\nBut, it is clear now - it is not a bug in the code of keystone and glance, it is the configuration issue.\n\nCould please some one also try it and confirm that the root of this issue in the initial keystone configuration?", 
            "date_created": "2015-02-10 07:04:50.226040+00:00", 
            "author": "https://api.launchpad.net/1.0/~tnurlygayanov"
        }, 
        {
            "content": "Hi \n\nTimur, thank you for your update - it was partly solved my problem (it was possible to upload ~44Gb image but the next one failed again).\n\nThe errors:\n/var/log/glance/api.log\n2015-03-02 09:25:22.876 2138 INFO urllib3.connectionpool [-] Starting new HTTP connection (1): jcloud\n2015-03-02 09:25:22.913 2138 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-03-02 09:25:22.913 2138 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2015-03-02 09:25:22.914 2138 INFO keystonemiddleware.auth_token [-] Invalid user token - deferring reject downstream\n\n/var/log/nova/nova-compute.log\n2015-03-02 09:25:07.202 1715 INFO nova.compute.resource_tracker [-] Compute_service record updated for jcnode1:jcnode1\n2015-03-02 09:25:20.846 1715 ERROR glanceclient.common.http [req-57c46af1-50c8-40eb-ae70-8de3664144d1 ] Request returned failure status 401.\n2015-03-02 09:25:20.847 1715 WARNING urllib3.connectionpool [req-57c46af1-50c8-40eb-ae70-8de3664144d1 ] HttpConnectionPool is full, discarding connection: jcloud\n2015-03-02 09:25:22.912 1715 ERROR glanceclient.common.http [req-57c46af1-50c8-40eb-ae70-8de3664144d1 ] Request returned failure status 401.\n2015-03-02 09:25:22.913 1715 ERROR nova.compute.manager [req-57c46af1-50c8-40eb-ae70-8de3664144d1 None] [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f] Error while trying to clean up image 3ce08382-fe16-4261-8525-780164e4f8fc\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f] Traceback (most recent call last):\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 375, in decorated_function\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]     self.image_api.delete(context, image_id)\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   File \"/usr/lib/python2.7/dist-packages/nova/image/api.py\", line 137, in delete\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]     return session.delete(context, image_id)\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 418, in delete\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]     self._client.call(context, 1, 'delete', image_id)\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 232, in call\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]     return getattr(client.images, method)(*args, **kwargs)\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   File \"/usr/lib/python2.7/dist-packages/glanceclient/v1/images.py\", line 255, in delete\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]     resp, body = self.client.delete(url)\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 265, in delete\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]     return self._request('DELETE', url, **kwargs)\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 221, in _request\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]     raise exc.from_response(resp, resp.content)\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f] HTTPUnauthorized: <html>\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]  <head>\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   <title>401 Unauthorized</title>\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]  </head>\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]  <body>\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   <h1>401 Unauthorized</h1>\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]   This server could not verify that you are authorized to access the document you requested. Either you supplied the wrong credentials (e.g., bad password), or your browser does not understand how to supply the credentials required.<br /><br />\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]  </body>\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f] </html> (HTTP 401)\n2015-03-02 09:25:22.913 1715 TRACE nova.compute.manager [instance: fa993ee3-3d0c-4832-95d9-f23ad858208f]\n2015-03-02 09:25:23.314 1715 INFO nova.scheduler.client.report [req-57c46af1-50c8-40eb-ae70-8de3664144d1 None] Compute_service record updated for ('jcnode1', 'jcnode1')\n2015-03-02 09:25:23.316 1715 ERROR oslo.messaging.rpc.dispatcher [req-57c46af1-50c8-40eb-ae70-8de3664144d1 ] Exception during message handling: Not authorized for image 3ce08382-fe16-4261-8525-780164e4f8fc.\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     payload)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 303, in decorated_function\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     pass\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 289, in decorated_function\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 331, in decorated_function\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 319, in decorated_function\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 379, in decorated_function\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     instance=instance)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 369, in decorated_function\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     *args, **kwargs)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3027, in snapshot_instance\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     task_states.IMAGE_SNAPSHOT)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3058, in _snapshot_instance\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     update_task_state)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1752, in snapshot\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     image_file)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/api.py\", line 126, in update\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     purge_props=purge_props)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 405, in update\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     _reraise_translated_image_exception(image_id)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 403, in update\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     image_id, **image_meta)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 232, in call\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     return getattr(client.images, method)(*args, **kwargs)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/v1/images.py\", line 329, in update\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     resp, body = self.client.put(url, headers=hdrs, data=image_data)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 259, in put\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     return self._request('PUT', url, **kwargs)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/glanceclient/common/http.py\", line 221, in _request\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher     raise exc.from_response(resp, resp.content)\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher ImageNotAuthorized: Not authorized for image 3ce08382-fe16-4261-8525-780164e4f8fc.\n2015-03-02 09:25:23.316 1715 TRACE oslo.messaging.rpc.dispatcher", 
            "date_created": "2015-03-02 07:08:59.809416+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhdan"
        }, 
        {
            "content": "Additionally: I use Ubuntu 14.04.2 LTS and OpenStack Juno release (latest updates installed).\nRegarding previous comment: one successful Image was done from node3, and failed from node1. All configurations on these nodes are correct. Small Images could be done from node1 also.", 
            "date_created": "2015-03-02 07:46:51.740460+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhdan"
        }, 
        {
            "content": "From a Keystone perspective, this is strictly the token TTL (at best). This can be resolved by increasing the TTL. We can evaluate changing the defaults, but I am unsure how to calculate what the default *should* be for all use cases. We will continue to iterate on this in general, however, this is not a keystone bug per-say. So i am marking this as wont fix within Keystone.\r\n\r\nWe should provide better documentation on the token TTL and re-evaluate the defaults.", 
            "date_created": "2015-03-12 21:59:34.205621+00:00", 
            "author": "https://api.launchpad.net/1.0/~mdrnstm"
        }, 
        {
            "content": "This isn't really a nova bug. Keystone has no way to create operation tokens for long standing work. It's a design limitation and not something nova can really work around.", 
            "date_created": "2015-04-01 16:15:37.378308+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "any update on this issue? I am facing the same issue and my snapshot image size is 38.4 GB.\nAny one can help me please?\n\nI want to make a snapshot of my running instance. which has size 38.4 GB.", 
            "date_created": "2015-05-02 10:28:16.307587+00:00", 
            "author": "https://api.launchpad.net/1.0/~randhirsingh21"
        }, 
        {
            "content": "Thanks for this post... issue get resolved by updating the keystone configurations.", 
            "date_created": "2015-05-02 11:19:13.694560+00:00", 
            "author": "https://api.launchpad.net/1.0/~randhirsingh21"
        }, 
        {
            "content": "Hi All\n\nThank to all involved - keystone configuration was the problem (but for my case almost all default values were increased more than in 3 times).", 
            "date_created": "2015-05-15 06:57:53.615257+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhdan"
        }, 
        {
            "content": "I know this is an old bug and it's marked invalid but I just experienced it several times in the past few days (this is on Kilo).\n\nAt first I thought that upping the Keystone expiry time to 4 hours (ie: expiration = 14400) had taken care of the issue but then I just tried to snapshot an 80GB (Windows of course!) disk and it happened again some 26 minutes into the process (ie: glance-registry announced \"Successfully created image\").\n\n26 mins is clearly <4 hours (and <1 hour for that matter).  So it appears no matter what you set the Keystone TTL to, if you're \"unlucky\" and expiry happens in the middle of a lengthy Glance operation, it'll fail.  Couldn't Glance mitigate this by requesting a fresh token before undertaking a lengthy operation (say if the size of the image is greater than X)?  Just a thought...", 
            "date_created": "2016-06-27 18:55:04.599349+00:00", 
            "author": "https://api.launchpad.net/1.0/~sxc731"
        }, 
        {
            "content": "I am still getting this bug on Liberty (package version is 2:11.0.1-0ubuntu1~cloud0).\n\nKeystone configuration:\n\n[cache]\nexpiration_time=60000\n[token]\nexpiration=60000\n[revoke]\ncache_time=60000\n\nglance-registry log:\n\n2017-01-05 01:51:56.262 22321 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2017-01-05 01:51:56.262 22321 WARNING keystonemiddleware.auth_token [-] Identity response: {\"error\": {\"message\": \"Could not find token: 4f5755cc[snip]ee\", \"code\": 404, \"title\": \"Not Found\"}}\n2017-01-05 01:51:56.263 22321 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2017-01-05 01:51:56.264 22321 INFO eventlet.wsgi.server [-] 127.0.0.1 - - [05/Jan/2017 01:51:56] \"PUT /images/62cdc66d-8ba3-477f-bb66-6b7df6cddfce HTTP/1.1\" 401 204 0.028659\n2017-01-05 01:51:56.269 22350 INFO eventlet.wsgi.server [-] 127.0.0.1 - - [05/Jan/2017 01:51:56] \"PUT /images/62cdc66d-8ba3-477f-bb66-6b7df6cddfce HTTP/1.1\" 401 204 0.001075\n2017-01-05 01:51:58.420 22376 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2017-01-05 01:51:58.421 22376 WARNING keystonemiddleware.auth_token [-] Identity response: {\"error\": {\"message\": \"Could not find token: 4f5755cc[snip]ee\", \"code\": 404, \"title\": \"Not Found\"}}\n2017-01-05 01:51:58.421 22376 WARNING keystonemiddleware.auth_token [-] Authorization failed for token\n2017-01-05 01:51:58.424 22376 INFO eventlet.wsgi.server [-] 127.0.0.1 - - [05/Jan/2017 01:51:58] \"PUT /images/62cdc66d-8ba3-477f-bb66-6b7df6cddfce HTTP/1.1\" 401 204 0.027043\n2017-01-05 01:51:58.426 22374 INFO eventlet.wsgi.server [-] 127.0.0.1 - - [05/Jan/2017 01:51:58] \"PUT /images/62cdc66d-8ba3-477f-bb66-6b7df6cddfce HTTP/1.1\" 401 204 0.001307\n\nRelevant lines from nova-compute log attached.\n\nThe keystone.token table says this token (4f5755cc[snip]ee) was issued at 2017-01-04T14:11:50.137811Z and expires at 2017-01-05T06:51:50.137783Z. The logs are in EST (UTC-5), so it expired right before glance gave the authorization failed error, but before the snapshot process started.\n\nIs there any way to have glance renew the token well before the expiration time?", 
            "date_created": "2017-01-05 17:23:11.193225+00:00", 
            "author": "https://api.launchpad.net/1.0/~fbastani"
        }, 
        {
            "content": "", 
            "date_created": "2017-01-05 17:23:31.234420+00:00", 
            "author": "https://api.launchpad.net/1.0/~fbastani"
        }, 
        {
            "content": "You can add in local.conf to pass the bug\n\nSWIFT_LOOPBACK_DISK_SIZE=100G\n[[post-config|${SWIFT_CONF_DIR}/swift.conf]]\n[swift-constraints]\nmax_file_size = 21474836482\n\nFrom <https://ask.openstack.org/en/question/66825/error-during-chunked-upload-cant-create-large-glance-images/>", 
            "date_created": "2017-01-09 06:48:29.000628+00:00", 
            "author": "https://api.launchpad.net/1.0/~tuanla"
        }
    ]
}