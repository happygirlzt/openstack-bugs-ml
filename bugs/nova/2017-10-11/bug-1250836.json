{
    "status": "Expired", 
    "last_updated": "2016-07-05 09:45:00.571211+00:00", 
    "description": "During the tempest tests run I got the following error:\n\n2013-11-13 10:09:18.814 ERROR nova.api.openstack [req-a3172f97-0d7c-4f8b-a7a5-bec6aad2b549 ServerMetadataTestJSON-tempest-1285971638-user ServerMetadataTestJSON-tempest-1285971638-tenant] Caught error: (OperationalError) (1213, 'Deadlock found when trying to get lock; try restarting transaction') 'INSERT INTO instance_metadata (created_at, updated_at, deleted_at, deleted, `key`, value, instance_uuid) VALUES (%s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2013, 11, 13, 10, 9, 18, 811419), None, None, 0, 'key3', 'value3', 'ba645a19-78c5-439d-9408-68f413c200f4')\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack Traceback (most recent call last):\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 119, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 571, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 939, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     content_type, body, accept)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 998, in _process_stack\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 1079, in dispatch\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/server_metadata.py\", line 67, in create\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     delete=False)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/server_metadata.py\", line 120, in _update_instance_metadata\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     delete)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 197, in wrapped\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 187, in inner\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return function(self, context, instance, *args, **kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 168, in inner\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return f(self, context, instance, *args, **kw)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 2843, in update_instance_metadata\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     _metadata, True)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/db/api.py\", line 1577, in instance_metadata_update\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     metadata, delete)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return f(*args, **kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 4615, in instance_metadata_update\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return metadata\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 456, in __exit__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     self.commit()\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 368, in commit\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     self._prepare_impl()\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 347, in _prepare_impl\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     self.session.flush()\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/openstack/common/db/sqlalchemy/session.py\", line 529, in _wrap\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     _raise_if_deadlock_error(e, get_engine().name)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/openstack/common/db/sqlalchemy/session.py\", line 516, in _raise_if_deadlock_error\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     raise exception.DBDeadlock(operational_error)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack DBDeadlock: (OperationalError) (1213, 'Deadlock found when trying to get lock; try restarting transaction') 'INSERT INTO instance_metadata (created_at, updated_at, deleted_at, deleted, `key`, value, instance_uuid) VALUES (%s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2013, 11, 13, 10, 9, 18, 811419), None, None, 0, 'key3', 'value3', 'ba645a19-78c5-439d-9408-68f413c200f4')\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack", 
    "tags": [
        "db"
    ], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1250836", 
    "owner": "None", 
    "id": 1250836, 
    "index": 4281, 
    "created": "2013-11-13 12:21:34.458194+00:00", 
    "title": "Updating of instance metadata occasionally leads to a Database deadlock", 
    "comments": [
        {
            "content": "During the tempest tests run I got the following error:\n\n2013-11-13 10:09:18.814 ERROR nova.api.openstack [req-a3172f97-0d7c-4f8b-a7a5-bec6aad2b549 ServerMetadataTestJSON-tempest-1285971638-user ServerMetadataTestJSON-tempest-1285971638-tenant] Caught error: (OperationalError) (1213, 'Deadlock found when trying to get lock; try restarting transaction') 'INSERT INTO instance_metadata (created_at, updated_at, deleted_at, deleted, `key`, value, instance_uuid) VALUES (%s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2013, 11, 13, 10, 9, 18, 811419), None, None, 0, 'key3', 'value3', 'ba645a19-78c5-439d-9408-68f413c200f4')\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack Traceback (most recent call last):\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 119, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 571, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 939, in __call__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     content_type, body, accept)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 998, in _process_stack\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 1079, in dispatch\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/server_metadata.py\", line 67, in create\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     delete=False)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/server_metadata.py\", line 120, in _update_instance_metadata\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     delete)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 197, in wrapped\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 187, in inner\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return function(self, context, instance, *args, **kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 168, in inner\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return f(self, context, instance, *args, **kw)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 2843, in update_instance_metadata\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     _metadata, True)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/db/api.py\", line 1577, in instance_metadata_update\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     metadata, delete)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return f(*args, **kwargs)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 4615, in instance_metadata_update\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     return metadata\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 456, in __exit__\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     self.commit()\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 368, in commit\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     self._prepare_impl()\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 347, in _prepare_impl\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     self.session.flush()\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/openstack/common/db/sqlalchemy/session.py\", line 529, in _wrap\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     _raise_if_deadlock_error(e, get_engine().name)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/openstack/common/db/sqlalchemy/session.py\", line 516, in _raise_if_deadlock_error\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack     raise exception.DBDeadlock(operational_error)\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack DBDeadlock: (OperationalError) (1213, 'Deadlock found when trying to get lock; try restarting transaction') 'INSERT INTO instance_metadata (created_at, updated_at, deleted_at, deleted, `key`, value, instance_uuid) VALUES (%s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2013, 11, 13, 10, 9, 18, 811419), None, None, 0, 'key3', 'value3', 'ba645a19-78c5-439d-9408-68f413c200f4')\n2013-11-13 10:09:18.814 22804 TRACE nova.api.openstack", 
            "date_created": "2013-11-13 12:21:34.458194+00:00", 
            "author": "https://api.launchpad.net/1.0/~rpodolyaka"
        }, 
        {
            "content": "not a tempest bug", 
            "date_created": "2013-12-12 22:02:22.179856+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "I think the current db architecture means this has to be mitigated against, not sure there is an easy win here.", 
            "date_created": "2014-09-03 11:44:43.328700+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "\nThis is an automated cleanup. This bug report has been closed because it\nis older than 18 months and there is no open code change to fix this.\nAfter this time it is unlikely that the circumstances which lead to\nthe observed issue can be reproduced.\n\nIf you can reproduce the bug, please:\n* reopen the bug report (set to status \"New\")\n* AND add the detailed steps to reproduce the issue (if applicable)\n* AND leave a comment \"CONFIRMED FOR: <RELEASE_NAME>\"\n  Only still supported release names are valid (LIBERTY, MITAKA, OCATA, NEWTON).\n  Valid example: CONFIRMED FOR: LIBERTY\n", 
            "date_created": "2016-07-05 09:44:58.380957+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}