{
    "status": "Fix Released", 
    "last_updated": "2017-08-28 09:55:08.876434+00:00", 
    "description": "Description\n===========\nEphemeral storage encryption is broken because of interface mismatch. The default key manager (Castellan with Barbican)'s create_key() interface required at least 4 arguments. See\n\nhttps://github.com/openstack/castellan/blob/0.4.0/castellan/key_manager/barbican_key_manager.py#L200\n\nHowever, Nova is only passing in 3. Looks like the 'algorithm' argument is missing. See\n\nhttps://github.com/openstack/nova/blob/stable/newton/nova/compute/api.py#L1401\n\nThis will result in \"TypeError: create_key() takes exactly 4 arguments (3 given)\" on server create.\n\nSteps to reproduce\n==================\n\n1. Install devstack with Barbican plugin enabled. i.e. \n\ncat local.conf\n[[local|localrc]]\nenable_plugin barbican https://git.openstack.org/openstack/barbican stable/newton\n\n2. After devstack is installed, enable ephemeral storage encryption in nova.conf. i.e.\n\n[libvirt]\nimages_type = lvm\nimages_volume_group = vg-comp\n\n[ephemeral_storage_encryption]\nkey_size = 256\ncipher = aes-xts-plain64\nenabled = True\n\n3. restart nova-api\n\n4. using the nova user account, try to create a server. i.e.\n\ngyee@abacus:~$ env | grep OS_\nOS_PROJECT_DOMAIN_ID=default\nOS_USER_DOMAIN_ID=default\nOS_PROJECT_NAME=service\nOS_IDENTITY_API_VERSION=3\nOS_PASSWORD=secrete\nOS_AUTH_URL=http://localhost:5000\nOS_USERNAME=nova\ngyee@abacus:~$ openstack flavor list\n+----+-----------+-------+------+-----------+-------+-----------+\n| ID | Name      |   RAM | Disk | Ephemeral | VCPUs | Is Public |\n+----+-----------+-------+------+-----------+-------+-----------+\n| 1  | m1.tiny   |   512 |    1 |         0 |     1 | True      |\n| 2  | m1.small  |  2048 |   20 |         0 |     1 | True      |\n| 3  | m1.medium |  4096 |   40 |         0 |     2 | True      |\n| 4  | m1.large  |  8192 |   80 |         0 |     4 | True      |\n| 42 | m1.nano   |    64 |    0 |         0 |     1 | True      |\n| 5  | m1.xlarge | 16384 |  160 |         0 |     8 | True      |\n| 84 | m1.micro  |   128 |    0 |         0 |     1 | True      |\n| c1 | cirros256 |   256 |    0 |         0 |     1 | True      |\n| d1 | ds512M    |   512 |    5 |         0 |     1 | True      |\n| d2 | ds1G      |  1024 |   10 |         0 |     1 | True      |\n| d3 | ds2G      |  2048 |   10 |         0 |     2 | True      |\n| d4 | ds4G      |  4096 |   20 |         0 |     4 | True      |\n+----+-----------+-------+------+-----------+-------+-----------+\ngyee@abacus:~$ openstack image list\n+----------------------------------+---------------------------------+--------+\n| ID                               | Name                            | Status |\n+----------------------------------+---------------------------------+--------+\n| da447cd9-619a-                   | cirros-0.3.4-x86_64-uec         | active |\n| 41b3-9772-4a9a80fa55f9           |                                 |        |\n| 718fff25-9d61-4a37-a974-fdef2f1f | cirros-0.3.4-x86_64-uec-ramdisk | active |\n| 570a                             |                                 |        |\n| 91c06518-a752-48ec-a7fd-         | cirros-0.3.4-x86_64-uec-kernel  | active |\n| 3c0ad020d9a4                     |                                 |        |\n+----------------------------------+---------------------------------+--------+\ngyee@abacus:~$ openstack server create --image 91c06518-a752-48ec-a7fd-3c0ad020d9a4 --flavor 1 test_eph_enc\nUnexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'> (HTTP 500) (Request-ID: req-6d2eb531-b239-429d-8d25-f06b4fe6309c)\n\n\n5. And you'll see a traceback similiar to this.\n\n2016-12-21 14:04:40.903 ERROR nova.api.openstack.extensions [req-6d2eb531-b239-429d-8d25-f06b4fe6309c nova service] Unexpected exception in API method\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 631, in create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     **create_kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1528, in create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1159, in _create_instance\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     key_pair)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1022, in _provision_instances\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     quotas.rollback()\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     self.force_reraise()\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 944, in _provision_instances\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     shutdown_terminate, create_instance=False)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1451, in create_db_entry_for_new_instance\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     num_instances, shutdown_terminate)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1403, in _populate_instance_for_create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     length=CONF.ephemeral_storage_encryption.key_size)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions TypeError: create_key() takes exactly 4 arguments (3 given)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions \n2016-12-21 14:04:40.905 INFO nova.api.openstack.wsgi [req-6d2eb531-b239-429d-8d25-f06b4fe6309c nova service] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'>\n\n\nExpected result\n===============\nserver should be successfully created\n\nActual result\n=============\nHTTP 500, with the following traceback in the log.\n\n2016-12-21 14:04:40.903 ERROR nova.api.openstack.extensions [req-6d2eb531-b239-429d-8d25-f06b4fe6309c nova service] Unexpected exception in API method\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 631, in create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     **create_kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1528, in create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1159, in _create_instance\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     key_pair)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1022, in _provision_instances\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     quotas.rollback()\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     self.force_reraise()\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 944, in _provision_instances\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     shutdown_terminate, create_instance=False)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1451, in create_db_entry_for_new_instance\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     num_instances, shutdown_terminate)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1403, in _populate_instance_for_create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     length=CONF.ephemeral_storage_encryption.key_size)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions TypeError: create_key() takes exactly 4 arguments (3 given)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions \n2016-12-21 14:04:40.905 INFO nova.api.openstack.wsgi [req-6d2eb531-b239-429d-8d25-f06b4fe6309c nova service] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'>\n\n\nEnvironment\n===========\n1. Ubuntu 16.04\n\ncat /etc/lsb-release \nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=16.04\nDISTRIB_CODENAME=xenial\nDISTRIB_DESCRIPTION=\"Ubuntu 16.04.1 LTS\"\n\n2. Devstack + Barbican plugin, both on stable/newton", 
    "tags": [
        "newton-backport-potential", 
        "ocata-backport-potential"
    ], 
    "importance": "Medium", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1651887", 
    "owner": "https://api.launchpad.net/1.0/~kaitlin-farr", 
    "id": 1651887, 
    "index": 4713, 
    "created": "2016-12-21 22:09:19.076895+00:00", 
    "title": "Ephemeral storage encryption is broken with interface mismatch", 
    "comments": [
        {
            "content": "Description\n===========\nEphemeral storage encryption is broken because of interface mismatch. The default key manager (Castellan with Barbican)'s create_key() interface required at least 4 arguments. See\n\nhttps://github.com/openstack/castellan/blob/0.4.0/castellan/key_manager/barbican_key_manager.py#L200\n\nHowever, Nova is only passing in 3. Looks like the 'algorithm' argument is missing. See\n\nhttps://github.com/openstack/nova/blob/stable/newton/nova/compute/api.py#L1401\n\nThis will result in \"TypeError: create_key() takes exactly 4 arguments (3 given)\" on server create.\n\nSteps to reproduce\n==================\n\n1. Install devstack with Barbican plugin enabled. i.e. \n\ncat local.conf\n[[local|localrc]]\nenable_plugin barbican https://git.openstack.org/openstack/barbican stable/newton\n\n2. After devstack is installed, enable ephemeral storage encryption in nova.conf. i.e.\n\n[libvirt]\nimages_type = lvm\nimages_volume_group = vg-comp\n\n[ephemeral_storage_encryption]\nkey_size = 256\ncipher = aes-xts-plain64\nenabled = True\n\n3. restart nova-api\n\n4. using the nova user account, try to create a server. i.e.\n\ngyee@abacus:~$ env | grep OS_\nOS_PROJECT_DOMAIN_ID=default\nOS_USER_DOMAIN_ID=default\nOS_PROJECT_NAME=service\nOS_IDENTITY_API_VERSION=3\nOS_PASSWORD=secrete\nOS_AUTH_URL=http://localhost:5000\nOS_USERNAME=nova\ngyee@abacus:~$ openstack flavor list\n+----+-----------+-------+------+-----------+-------+-----------+\n| ID | Name      |   RAM | Disk | Ephemeral | VCPUs | Is Public |\n+----+-----------+-------+------+-----------+-------+-----------+\n| 1  | m1.tiny   |   512 |    1 |         0 |     1 | True      |\n| 2  | m1.small  |  2048 |   20 |         0 |     1 | True      |\n| 3  | m1.medium |  4096 |   40 |         0 |     2 | True      |\n| 4  | m1.large  |  8192 |   80 |         0 |     4 | True      |\n| 42 | m1.nano   |    64 |    0 |         0 |     1 | True      |\n| 5  | m1.xlarge | 16384 |  160 |         0 |     8 | True      |\n| 84 | m1.micro  |   128 |    0 |         0 |     1 | True      |\n| c1 | cirros256 |   256 |    0 |         0 |     1 | True      |\n| d1 | ds512M    |   512 |    5 |         0 |     1 | True      |\n| d2 | ds1G      |  1024 |   10 |         0 |     1 | True      |\n| d3 | ds2G      |  2048 |   10 |         0 |     2 | True      |\n| d4 | ds4G      |  4096 |   20 |         0 |     4 | True      |\n+----+-----------+-------+------+-----------+-------+-----------+\ngyee@abacus:~$ openstack image list\n+----------------------------------+---------------------------------+--------+\n| ID                               | Name                            | Status |\n+----------------------------------+---------------------------------+--------+\n| da447cd9-619a-                   | cirros-0.3.4-x86_64-uec         | active |\n| 41b3-9772-4a9a80fa55f9           |                                 |        |\n| 718fff25-9d61-4a37-a974-fdef2f1f | cirros-0.3.4-x86_64-uec-ramdisk | active |\n| 570a                             |                                 |        |\n| 91c06518-a752-48ec-a7fd-         | cirros-0.3.4-x86_64-uec-kernel  | active |\n| 3c0ad020d9a4                     |                                 |        |\n+----------------------------------+---------------------------------+--------+\ngyee@abacus:~$ openstack server create --image 91c06518-a752-48ec-a7fd-3c0ad020d9a4 --flavor 1 test_eph_enc\nUnexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'> (HTTP 500) (Request-ID: req-6d2eb531-b239-429d-8d25-f06b4fe6309c)\n\n\n5. And you'll see a traceback similiar to this.\n\n2016-12-21 14:04:40.903 ERROR nova.api.openstack.extensions [req-6d2eb531-b239-429d-8d25-f06b4fe6309c nova service] Unexpected exception in API method\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 631, in create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     **create_kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1528, in create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1159, in _create_instance\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     key_pair)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1022, in _provision_instances\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     quotas.rollback()\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     self.force_reraise()\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 944, in _provision_instances\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     shutdown_terminate, create_instance=False)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1451, in create_db_entry_for_new_instance\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     num_instances, shutdown_terminate)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1403, in _populate_instance_for_create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     length=CONF.ephemeral_storage_encryption.key_size)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions TypeError: create_key() takes exactly 4 arguments (3 given)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions \n2016-12-21 14:04:40.905 INFO nova.api.openstack.wsgi [req-6d2eb531-b239-429d-8d25-f06b4fe6309c nova service] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'>\n\n\nExpected result\n===============\nserver should be successfully created\n\nActual result\n=============\nHTTP 500, with the following traceback in the log.\n\n2016-12-21 14:04:40.903 ERROR nova.api.openstack.extensions [req-6d2eb531-b239-429d-8d25-f06b4fe6309c nova service] Unexpected exception in API method\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 631, in create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     **create_kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1528, in create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1159, in _create_instance\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     key_pair)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1022, in _provision_instances\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     quotas.rollback()\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     self.force_reraise()\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 944, in _provision_instances\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     shutdown_terminate, create_instance=False)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1451, in create_db_entry_for_new_instance\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     num_instances, shutdown_terminate)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1403, in _populate_instance_for_create\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions     length=CONF.ephemeral_storage_encryption.key_size)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions TypeError: create_key() takes exactly 4 arguments (3 given)\n2016-12-21 14:04:40.903 TRACE nova.api.openstack.extensions \n2016-12-21 14:04:40.905 INFO nova.api.openstack.wsgi [req-6d2eb531-b239-429d-8d25-f06b4fe6309c nova service] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'>\n\n\nEnvironment\n===========\n1. Ubuntu 16.04\n\ncat /etc/lsb-release \nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=16.04\nDISTRIB_CODENAME=xenial\nDISTRIB_DESCRIPTION=\"Ubuntu 16.04.1 LTS\"\n\n2. Devstack + Barbican plugin, both on stable/newton", 
            "date_created": "2016-12-21 22:09:19.076895+00:00", 
            "author": "https://api.launchpad.net/1.0/~guang-yee"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/414233", 
            "date_created": "2016-12-22 17:02:28.744077+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/446072", 
            "date_created": "2017-03-15 17:04:18.656310+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/446072\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=1d3acad111c5106592b0921628480fcf41e0fb4c\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1d3acad111c5106592b0921628480fcf41e0fb4c\nAuthor: Kaitlin Farr <email address hidden>\nDate:   Fri Mar 10 18:09:49 2017 -0500\n\n    Parse algorithm from cipher for ephemeral disk encryption\n    \n    Nova's keymgr implementation used to have default values\n    for the algorithm and bit length.  Castellan does not have\n    default values, and when Castellan replaced keymgr in\n    Ib563b0ea4b8b4bc1833bf52bf49a68546c384996, the parameters\n    to the create_key method were not updated. This change\n    parses the algorithm from the cipher value and passes it\n    to Castellan's key manager interface.\n    \n    Closes-Bug: #1651887\n    Change-Id: Ib90bc7571aef59325be0efe123fcf12e86252b85\n", 
            "date_created": "2017-05-18 21:32:03.608239+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/466196", 
            "date_created": "2017-05-19 06:13:36.328332+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/466307", 
            "date_created": "2017-05-19 14:44:56.977413+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by guang-yee (<email address hidden>) on branch: stable/newton\nReview: https://review.openstack.org/466196\nReason: let wait for the ocata one first", 
            "date_created": "2017-05-19 16:16:37.941558+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/466307\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=fcc931f4017ab4bb830ff645431edaa8a18bf880\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit fcc931f4017ab4bb830ff645431edaa8a18bf880\nAuthor: Kaitlin Farr <email address hidden>\nDate:   Fri Mar 10 18:09:49 2017 -0500\n\n    Parse algorithm from cipher for ephemeral disk encryption\n    \n    Nova's keymgr implementation used to have default values\n    for the algorithm and bit length.  Castellan does not have\n    default values, and when Castellan replaced keymgr in\n    Ib563b0ea4b8b4bc1833bf52bf49a68546c384996, the parameters\n    to the create_key method were not updated. This change\n    parses the algorithm from the cipher value and passes it\n    to Castellan's key manager interface.\n    \n    Conflicts:\n          nova/tests/unit/compute/test_compute.py\n    \n    NOTE(mriedem): The conflicts are due to import order changes\n    in pike for flake8 order checking.\n    \n    Closes-Bug: #1651887\n    Change-Id: Ib90bc7571aef59325be0efe123fcf12e86252b85\n    (cherry picked from commit 1d3acad111c5106592b0921628480fcf41e0fb4c)\n", 
            "date_created": "2017-05-22 12:14:36.607601+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by guang-yee (<email address hidden>) on branch: stable/newton\nReview: https://review.openstack.org/466196\nReason: need to re-do", 
            "date_created": "2017-05-25 23:13:21.714088+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.5 release.", 
            "date_created": "2017-05-30 15:54:32.749291+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b2 development milestone.", 
            "date_created": "2017-06-08 21:52:52.125204+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Sean Dague (<email address hidden>) on branch: master\nReview: https://review.openstack.org/414233\nReason: This review is > 4 weeks without comment, and is not mergable in it's current state. We are abandoning this for now. Feel free to reactivate the review by pressing the restore button and leaving a 'recheck' comment to get fresh test results.", 
            "date_created": "2017-08-01 09:56:24.269100+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/466196\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c589b76e13f54f8c0d753b1d2c4d4c2ef3399359\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit c589b76e13f54f8c0d753b1d2c4d4c2ef3399359\nAuthor: Kaitlin Farr <email address hidden>\nDate:   Fri Mar 10 18:09:49 2017 -0500\n\n    Parse algorithm from cipher for ephemeral disk encryption\n    \n    Nova's keymgr implementation used to have default values\n    for the algorithm and bit length.  Castellan does not have\n    default values, and when Castellan replaced keymgr in\n    Ib563b0ea4b8b4bc1833bf52bf49a68546c384996, the parameters\n    to the create_key method were not updated. This change\n    parses the algorithm from the cipher value and passes it\n    to Castellan's key manager interface.\n    \n    Conflicts:\n          nova/conf/ephemeral_storage.py\n    \n    NOTE(mriedem): The conflicts are due to not having\n    Ic8ea9b0852d5b6f5d8a468fe0a03d21e220a8913 in newton, which\n    was a refactor/cleanup change in ocata. It's just preserved\n    here for readability.\n    \n    Closes-Bug: #1651887\n    Change-Id: Ib90bc7571aef59325be0efe123fcf12e86252b85\n    (cherry picked from commit 1d3acad111c5106592b0921628480fcf41e0fb4c)\n    (cherry picked from commit fcc931f4017ab4bb830ff645431edaa8a18bf880)\n", 
            "date_created": "2017-08-21 07:35:00.673658+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.8 release.", 
            "date_created": "2017-08-28 09:55:08.342242+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}