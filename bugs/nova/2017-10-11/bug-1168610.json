{
    "status": "Won't Fix", 
    "last_updated": "2014-07-10 00:08:26.847329+00:00", 
    "description": "During startup of nova-compute, if virtual_power_driver is_power_on() raises an exception, it will prevent nova-compute from starting. This can happen when a compute instance exists in the database but the SSH credentials that vpd uses are wrong.\n\nI think a solution is for vpd to convert exception.PowerVMConnectionFailed into an error and log it.\n\nHere is a trace of this error:\n\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/service.py\", line 147, in run_server\n2013-04-13 06:52:02,213.213 4164 TRACE nova     server.start()\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/service.py\", line 429, in start\n2013-04-13 06:52:02,213.213 4164 TRACE nova     self.manager.init_host()\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 630, in init_host\n2013-04-13 06:52:02,213.213 4164 TRACE nova     self._init_instance(context, instance)\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 539, in _init_instance\n2013-04-13 06:52:02,213.213 4164 TRACE nova     drv_state = self._get_power_state(context, instance)\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 649, in _get_power_state\n2013-04-13 06:52:02,213.213 4164 TRACE nova     return self.driver.get_info(instance)[\"state\"]\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/driver.py\", line 363, in get_info\n2013-04-13 06:52:02,213.213 4164 TRACE nova     if pm.is_power_on():\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 198, in is_power_on\n2013-04-13 06:52:02,213.213 4164 TRACE nova     if not self._check_for_node():\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 147, in _check_for_node\n2013-04-13 06:52:02,213.213 4164 TRACE nova     full_node_list = self._get_full_node_list()\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 141, in _get_full_node_list\n2013-04-13 06:52:02,213.213 4164 TRACE nova     full_list = self._run_command(cmd)\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 225, in _run_command\n2013-04-13 06:52:02,213.213 4164 TRACE nova     self._set_connection()\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 136, in _set_connection\n2013-04-13 06:52:02,213.213 4164 TRACE nova     self._connection = connection.ssh_connect(self.connection_data)\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/powervm/common.py\", line 62, in ssh_connect\n2013-04-13 06:52:02,213.213 4164 TRACE nova     raise exception.PowerVMConnectionFailed()\n2013-04-13 06:52:02,213.213 4164 TRACE nova PowerVMConnectionFailed: Connection to PowerVM manager failed\n2013-04-13 06:52:02,213.213 4164 TRACE nova \n2013-04-13 06:52:02,648.648 4217 INFO nova.manager [-] Skipping periodic task _periodic_update_dns because its interval is negative\n2013-04-13 06:52:02,705.705 4217 INFO nova.virt.driver [-] Loading compute driver 'baremetal.driver.BareMetalDriver'\n2013-04-13 06:52:02,754.754 INFO nova.openstack.common.rpc.common [req-235af7f1-4c57-42b8-8cc7-cbdd1327f12a None None] Connected to AMQP server on 127.0.0.1:5672\n2013-04-13 06:52:02,839.839 4217 AUDIT nova.service [-] Starting compute node (version 2013.2)\n2013-04-13 06:52:03,176.176 ERROR nova.compute.manager [req-e06f7f34-a2df-44f2-b3f2-ac299d4087d6 None None] Instance bmtest found in the hypervisor, but not in the database", 
    "tags": [
        "baremetal"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1168610", 
    "owner": "None", 
    "id": 1168610, 
    "index": 5733, 
    "created": "2013-04-13 07:11:00.539149+00:00", 
    "title": "nova-compute fails to start if is_power_on raises exception", 
    "comments": [
        {
            "content": "During startup of nova-compute, if virtual_power_driver is_power_on() raises an exception, it will prevent nova-compute from starting. This can happen when a compute instance exists in the database but the SSH credentials that vpd uses are wrong.\n\nI think a solution is for vpd to convert exception.PowerVMConnectionFailed into an error and log it.\n\nHere is a trace of this error:\n\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/service.py\", line 147, in run_server\n2013-04-13 06:52:02,213.213 4164 TRACE nova     server.start()\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/service.py\", line 429, in start\n2013-04-13 06:52:02,213.213 4164 TRACE nova     self.manager.init_host()\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 630, in init_host\n2013-04-13 06:52:02,213.213 4164 TRACE nova     self._init_instance(context, instance)\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 539, in _init_instance\n2013-04-13 06:52:02,213.213 4164 TRACE nova     drv_state = self._get_power_state(context, instance)\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 649, in _get_power_state\n2013-04-13 06:52:02,213.213 4164 TRACE nova     return self.driver.get_info(instance)[\"state\"]\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/driver.py\", line 363, in get_info\n2013-04-13 06:52:02,213.213 4164 TRACE nova     if pm.is_power_on():\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 198, in is_power_on\n2013-04-13 06:52:02,213.213 4164 TRACE nova     if not self._check_for_node():\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 147, in _check_for_node\n2013-04-13 06:52:02,213.213 4164 TRACE nova     full_node_list = self._get_full_node_list()\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 141, in _get_full_node_list\n2013-04-13 06:52:02,213.213 4164 TRACE nova     full_list = self._run_command(cmd)\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 225, in _run_command\n2013-04-13 06:52:02,213.213 4164 TRACE nova     self._set_connection()\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/baremetal/virtual_power_driver.py\", line 136, in _set_connection\n2013-04-13 06:52:02,213.213 4164 TRACE nova     self._connection = connection.ssh_connect(self.connection_data)\n2013-04-13 06:52:02,213.213 4164 TRACE nova   File \"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/virt/powervm/common.py\", line 62, in ssh_connect\n2013-04-13 06:52:02,213.213 4164 TRACE nova     raise exception.PowerVMConnectionFailed()\n2013-04-13 06:52:02,213.213 4164 TRACE nova PowerVMConnectionFailed: Connection to PowerVM manager failed\n2013-04-13 06:52:02,213.213 4164 TRACE nova \n2013-04-13 06:52:02,648.648 4217 INFO nova.manager [-] Skipping periodic task _periodic_update_dns because its interval is negative\n2013-04-13 06:52:02,705.705 4217 INFO nova.virt.driver [-] Loading compute driver 'baremetal.driver.BareMetalDriver'\n2013-04-13 06:52:02,754.754 INFO nova.openstack.common.rpc.common [req-235af7f1-4c57-42b8-8cc7-cbdd1327f12a None None] Connected to AMQP server on 127.0.0.1:5672\n2013-04-13 06:52:02,839.839 4217 AUDIT nova.service [-] Starting compute node (version 2013.2)\n2013-04-13 06:52:03,176.176 ERROR nova.compute.manager [req-e06f7f34-a2df-44f2-b3f2-ac299d4087d6 None None] Instance bmtest found in the hypervisor, but not in the database", 
            "date_created": "2013-04-13 07:11:00.539149+00:00", 
            "author": "https://api.launchpad.net/1.0/~devananda"
        }, 
        {
            "content": "Similarly to the root disk size one, this isn't really a tripleo issue : we can deliver a great tripleo experience without it.", 
            "date_created": "2013-05-01 05:18:17.316552+00:00", 
            "author": "https://api.launchpad.net/1.0/~lifeless"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/27973", 
            "date_created": "2013-05-01 21:48:23.961569+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "since we are in the process of deprecating and removing nova baremetal and the patch is abandoned, closing this bug.", 
            "date_created": "2014-07-10 00:08:14.803408+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }
    ]
}