{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:59:09.972065+00:00", 
    "description": "Steps to reproduce:\n\na) Create nova instance vm-1 (assume that the datastore is a shared datastore 'ds-1' which is a member of datastore cluster dcls-1)\nb) Create volume vol-1 with a storage profile which maps to ds-1\nc) Attach vol-1 to vm-1\nd) Migrate vm-1's datastore to shared datastore ds-2 which is a member of the dcls-1\n(The vmdk of vol-1 *moves* to vm-1's new location after this step)\ne) Detach vol-1\n\n\n2015-02-25 18:05:00.014 ERROR oslo_messaging.rpc.dispatcher [req-124c1c0a-2a00-46b1-a790-0a2e5d6da871 admin demo] Exception during message handling: File /vmfs/volumes/54ae58ae-5db2e67f-38b1-0200066a0432/volume-dc966ab1-9d8b-4e3b-a3b4-7b610a9b0f19/volume-dc966ab1-9d8b-4e3b-a3b4-7b610a9b0f19.vmdk was not found\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 416, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 300, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     pass\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 285, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 328, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 316, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4721, in detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self._detach_volume(context, instance, bdm)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4690, in _detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self.volume_api.roll_detaching(context, volume_id)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4678, in _detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     encryption=encryption)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 487, in detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     instance)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 539, in detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self._detach_volume_vmdk(connection_info, instance)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 504, in _detach_volume_vmdk\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     disk_type=vmdk.disk_type)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 455, in _consolidate_vmdk_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self._relocate_vmdk_volume(volume_ref, res_pool, datastore, host)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 384, in _relocate_vmdk_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self._session._wait_for_task(task)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 673, in _wait_for_task\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return self.wait_for_task(task_ref)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/oslo.vmware/oslo_vmware/api.py\", line 380, in wait_for_task\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return evt.wait()\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return hubs.get_hub().switch()\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return self.greenlet.switch()\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/oslo.vmware/oslo_vmware/common/loopingcall.py\", line 76, in _inner\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self.f(*self.args, **self.kw)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/oslo.vmware/oslo_vmware/api.py\", line 417, in _poll_task\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     raise task_ex\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher FileNotFoundException: File /vmfs/volumes/54ae58ae-5db2e67f-38b1-0200066a0432/volume-dc966ab1-9d8b-4e3b-a3b4-7b610a9b0f19/volume-dc966ab1-9d8b-4e3b-a3b4-7b610a9b0f19.vmdk was not found\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1425502", 
    "owner": "https://api.launchpad.net/1.0/~garyk", 
    "id": 1425502, 
    "index": 288, 
    "created": "2015-02-25 12:39:54.151294+00:00", 
    "title": "VMware: Detaching volume fails with FileNotFoundException", 
    "comments": [
        {
            "content": "Steps to reproduce:\n\na) Create nova instance vm-1 (assume that the datastore is a shared datastore 'ds-1' which is a member of datastore cluster dcls-1)\nb) Create volume vol-1 with a storage profile which maps to ds-1\nc) Attach vol-1 to vm-1\nd) Migrate vm-1's datastore to shared datastore ds-2 which is a member of the dcls-1\n(The vmdk of vol-1 *moves* to vm-1's new location after this step)\ne) Detach vol-1\n\n\n2015-02-25 18:05:00.014 ERROR oslo_messaging.rpc.dispatcher [req-124c1c0a-2a00-46b1-a790-0a2e5d6da871 admin demo] Exception during message handling: File /vmfs/volumes/54ae58ae-5db2e67f-38b1-0200066a0432/volume-dc966ab1-9d8b-4e3b-a3b4-7b610a9b0f19/volume-dc966ab1-9d8b-4e3b-a3b4-7b610a9b0f19.vmdk was not found\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 416, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 300, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     pass\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 285, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 328, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 316, in decorated_function\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4721, in detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self._detach_volume(context, instance, bdm)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4690, in _detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self.volume_api.roll_detaching(context, volume_id)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4678, in _detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     encryption=encryption)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 487, in detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     instance)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 539, in detach_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self._detach_volume_vmdk(connection_info, instance)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 504, in _detach_volume_vmdk\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     disk_type=vmdk.disk_type)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 455, in _consolidate_vmdk_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self._relocate_vmdk_volume(volume_ref, res_pool, datastore, host)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 384, in _relocate_vmdk_volume\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self._session._wait_for_task(task)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 673, in _wait_for_task\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return self.wait_for_task(task_ref)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/oslo.vmware/oslo_vmware/api.py\", line 380, in wait_for_task\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return evt.wait()\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return hubs.get_hub().switch()\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     return self.greenlet.switch()\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/oslo.vmware/oslo_vmware/common/loopingcall.py\", line 76, in _inner\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     self.f(*self.args, **self.kw)\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/oslo.vmware/oslo_vmware/api.py\", line 417, in _poll_task\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher     raise task_ex\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher FileNotFoundException: File /vmfs/volumes/54ae58ae-5db2e67f-38b1-0200066a0432/volume-dc966ab1-9d8b-4e3b-a3b4-7b610a9b0f19/volume-dc966ab1-9d8b-4e3b-a3b4-7b610a9b0f19.vmdk was not found\n2015-02-25 18:05:00.014 TRACE oslo_messaging.rpc.dispatcher", 
            "date_created": "2015-02-25 12:39:54.151294+00:00", 
            "author": "https://api.launchpad.net/1.0/~vbala"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/159738", 
            "date_created": "2015-02-27 07:46:35.086150+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/159738\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=24488387a1e1817e82a1a7a3c1d9d9c7bdf5d165\nSubmitter: Jenkins\nBranch:    master\n\ncommit 24488387a1e1817e82a1a7a3c1d9d9c7bdf5d165\nAuthor: Vipin Balachandran <email address hidden>\nDate:   Thu Feb 5 16:37:38 2015 +0530\n\n    VMware: Handle missing vmdk during volume detach\n    \n    During volume detach, volume's shadow VM might need to\n    be relocated if storage DRS moved the Nova instance along\n    with volume's vmdk. The shadow VM relocate will fail with\n    FileNotFoundException if SDRS moved the volume vmdk instead\n    of copying it to the new location. This patch fixes the\n    problem by removing the virtual disk device of shadow VM if\n    relocate failed due to missing vmdk file. After removing the\n    device, relocate is attempted again.\n    \n    Closes-Bug: #1425502\n    Change-Id: I40a25abe1ce96f1dc7d78ec46c948c8db451632b\n", 
            "date_created": "2015-08-13 11:53:13.539020+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}