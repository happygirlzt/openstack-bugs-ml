{
    "status": "Fix Released", 
    "last_updated": "2017-04-07 18:28:17.578200+00:00", 
    "description": "A range of tempest volume tests fails when starting Quobyte volume based instances. This issue might be hit by other filesystem based volume drivers. The error shows the following trace in the nova-compute log:\n\n2016-06-30 07:01:42.770 1391 ERROR nova.virt.libvirt.guest [req-b128a930-5eaa-4c20-a26c-0bf5168f2232 tempest-AttachVolumeShelveTestJSON-88210136 tempest-AttachVolumeShelveTestJSON-88210136] Error launching a defined domain with XML: <domain type='kvm'>\n  <name>instance-00000001</name>\n  <uuid>5f1d3712-641e-4cbe-a801-b103d75f59e3</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"14.0.0\"/>\n      <nova:name>tempest.common.compute-instance-314522010</nova:name>\n      <nova:creationTime>2016-06-30 07:01:40</nova:creationTime>\n      <nova:flavor name=\"m1.nano\">\n        <nova:memory>64</nova:memory>\n        <nova:disk>0</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"1d590d924957414fa8703df521929a4b\">tempest-AttachVolumeShelveTestJSON-88210136</nova:user>\n        <nova:project uuid=\"584fd090d35842919068946631985f59\">tempest-AttachVolumeShelveTestJSON-88210136</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"7a52389e-22fc-4ec4-9572-1b3a5f3cfd79\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>65536</memory>\n  <currentMemory unit='KiB'>65536</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <cputune>\n    <shares>1024</shares>\n  </cputune>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>14.0.0</entry>\n      <entry name='serial'>32c3c45f-2605-40e5-8262-de1d16cd6181</entry>\n      <entry name='uuid'>5f1d3712-641e-4cbe-a801-b103d75f59e3</entry>\n      <entry name='family'>Virtual Machine</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-trusty'>hvm</type>\n    <kernel>/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/kernel</kernel>\n    <initrd>/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/ramdisk</initrd>\n    <cmdline>root=/dev/vda console=tty0 console=ttyS0</cmdline>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu mode='host-model'>\n    <model fallback='allow'/>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/disk'/>\n      <target dev='vda' bus='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <controller type='ide' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:c7:44:5e'/>\n      <source bridge='br100'/>\n      <model type='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/console.log'/>\n      <target port='0'/>\n    </serial>\n    <serial type='pty'>\n      <target port='1'/>\n    </serial>\n    <console type='file'>\n      <source path='/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/console.log'/>\n      <target type='serial' port='0'/>\n    </console>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n      <stats period='10'/>\n    </memballoon>\n  </devices>\n</domain>\n\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [req-b128a930-5eaa-4c20-a26c-0bf5168f2232 tempest-AttachVolumeShelveTestJSON-88210136 tempest-AttachVolumeShelveTestJSON-88210136] [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3] Instance failed to spawn\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3] Traceback (most recent call last):\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2063, in _build_resources\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     yield resources\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1907, in _build_and_run_instance\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     block_device_info=block_device_info)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2665, in spawn\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     post_xml_callback=gen_confdrive)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4860, in _create_domain_and_network\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     post_xml_callback=post_xml_callback)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4789, in _create_domain\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     guest.launch(pause=pause)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/guest.py\", line 142, in launch\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     self._encoded_xml, errors='ignore')\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     self.force_reraise()\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     six.reraise(self.type_, self.value, self.tb)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/guest.py\", line 137, in launch\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     return self._domain.createWithFlags(flags)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 186, in doit\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 144, in proxy_call\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     rv = execute(f, *args, **kwargs)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 125, in execute\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     six.reraise(c, e, tb)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 83, in tworker\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     rv = meth(*args, **kwargs)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/libvirt.py\", line 900, in createWithFlags\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3] libvirtError: internal error: process exited while connecting to monitor: qemu-system-x86_64: -chardev file,id=charserial0,path=/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/console.log: Could not open '/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/console.log': Permission denied\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3] \n\n\nAn example Quobyte CI run can be found at: http://osci4.ext/logs/refs-changes-30-260930-40/\nThis fail occurs continuously.\n\nCinder is using nas_secure_file_operations=true and nas_secure_file_permissions=true which means files are handled not with root but service ownership and permissions set to 660. Both Nova and Cinder run with common ownership to assure access to the instance files. However the console.log file has root ownership at this point causing the nova process to be unable to access the file. Libvirts qemu config is set to run with non-root ownership using the same owner as the nova service and dynamic_ownership off. So libvirt should not change the file ownership here.\nThe tempest tests are run in a clean devstack setup.\n\nExpectation is that the console.log file has the same ownership as all the other instances files (nova service owner).\nActual result is that console.log has root:root 640 ownership.", 
    "tags": [
        "filesystem", 
        "in-stable-newton", 
        "libvirt", 
        "quobyte"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1597644", 
    "owner": "https://api.launchpad.net/1.0/~2-silvan", 
    "id": 1597644, 
    "index": 1941, 
    "created": "2016-06-30 07:29:10.274951+00:00", 
    "title": "Quobyte: Permission denied on console.log during instance startup", 
    "comments": [
        {
            "content": "A range of tempest volume tests fails when starting Quobyte volume based instances. This issue might be hit by other filesystem based volume drivers. The error shows the following trace in the nova-compute log:\n\n2016-06-30 07:01:42.770 1391 ERROR nova.virt.libvirt.guest [req-b128a930-5eaa-4c20-a26c-0bf5168f2232 tempest-AttachVolumeShelveTestJSON-88210136 tempest-AttachVolumeShelveTestJSON-88210136] Error launching a defined domain with XML: <domain type='kvm'>\n  <name>instance-00000001</name>\n  <uuid>5f1d3712-641e-4cbe-a801-b103d75f59e3</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"14.0.0\"/>\n      <nova:name>tempest.common.compute-instance-314522010</nova:name>\n      <nova:creationTime>2016-06-30 07:01:40</nova:creationTime>\n      <nova:flavor name=\"m1.nano\">\n        <nova:memory>64</nova:memory>\n        <nova:disk>0</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"1d590d924957414fa8703df521929a4b\">tempest-AttachVolumeShelveTestJSON-88210136</nova:user>\n        <nova:project uuid=\"584fd090d35842919068946631985f59\">tempest-AttachVolumeShelveTestJSON-88210136</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"7a52389e-22fc-4ec4-9572-1b3a5f3cfd79\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>65536</memory>\n  <currentMemory unit='KiB'>65536</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <cputune>\n    <shares>1024</shares>\n  </cputune>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>14.0.0</entry>\n      <entry name='serial'>32c3c45f-2605-40e5-8262-de1d16cd6181</entry>\n      <entry name='uuid'>5f1d3712-641e-4cbe-a801-b103d75f59e3</entry>\n      <entry name='family'>Virtual Machine</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-trusty'>hvm</type>\n    <kernel>/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/kernel</kernel>\n    <initrd>/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/ramdisk</initrd>\n    <cmdline>root=/dev/vda console=tty0 console=ttyS0</cmdline>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu mode='host-model'>\n    <model fallback='allow'/>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/disk'/>\n      <target dev='vda' bus='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <controller type='ide' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:c7:44:5e'/>\n      <source bridge='br100'/>\n      <model type='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/console.log'/>\n      <target port='0'/>\n    </serial>\n    <serial type='pty'>\n      <target port='1'/>\n    </serial>\n    <console type='file'>\n      <source path='/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/console.log'/>\n      <target type='serial' port='0'/>\n    </console>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n      <stats period='10'/>\n    </memballoon>\n  </devices>\n</domain>\n\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [req-b128a930-5eaa-4c20-a26c-0bf5168f2232 tempest-AttachVolumeShelveTestJSON-88210136 tempest-AttachVolumeShelveTestJSON-88210136] [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3] Instance failed to spawn\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3] Traceback (most recent call last):\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2063, in _build_resources\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     yield resources\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1907, in _build_and_run_instance\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     block_device_info=block_device_info)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2665, in spawn\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     post_xml_callback=gen_confdrive)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4860, in _create_domain_and_network\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     post_xml_callback=post_xml_callback)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4789, in _create_domain\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     guest.launch(pause=pause)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/guest.py\", line 142, in launch\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     self._encoded_xml, errors='ignore')\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     self.force_reraise()\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     six.reraise(self.type_, self.value, self.tb)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/opt/stack/nova/nova/virt/libvirt/guest.py\", line 137, in launch\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     return self._domain.createWithFlags(flags)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 186, in doit\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 144, in proxy_call\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     rv = execute(f, *args, **kwargs)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 125, in execute\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     six.reraise(c, e, tb)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 83, in tworker\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     rv = meth(*args, **kwargs)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]   File \"/usr/local/lib/python2.7/dist-packages/libvirt.py\", line 900, in createWithFlags\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3] libvirtError: internal error: process exited while connecting to monitor: qemu-system-x86_64: -chardev file,id=charserial0,path=/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/console.log: Could not open '/opt/stack/data/nova/instances/5f1d3712-641e-4cbe-a801-b103d75f59e3/console.log': Permission denied\n2016-06-30 07:01:42.770 1391 ERROR nova.compute.manager [instance: 5f1d3712-641e-4cbe-a801-b103d75f59e3] \n\n\nAn example Quobyte CI run can be found at: http://osci4.ext/logs/refs-changes-30-260930-40/\nThis fail occurs continuously.\n\nCinder is using nas_secure_file_operations=true and nas_secure_file_permissions=true which means files are handled not with root but service ownership and permissions set to 660. Both Nova and Cinder run with common ownership to assure access to the instance files. However the console.log file has root ownership at this point causing the nova process to be unable to access the file. Libvirts qemu config is set to run with non-root ownership using the same owner as the nova service and dynamic_ownership off. So libvirt should not change the file ownership here.\nThe tempest tests are run in a clean devstack setup.\n\nExpectation is that the console.log file has the same ownership as all the other instances files (nova service owner).\nActual result is that console.log has root:root 640 ownership.", 
            "date_created": "2016-06-30 07:29:10.274951+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "You could locally try to add the lines below *before* the guest launches [1]\nto see if this solves the permission issue:\n\n    data = ''\n    console_log = self._get_console_log_path(instance)\n    self._append_to_file(data, console_log)\n    self._chown_console_log_for_instance(instance)\n\nThis creates the console log file and changes the ownership to the current\nprocess owner.\n\nAs a side question, you already checked that the instance's *directory* (the\none with the uuid name) has the correct permissions?\n\nReferences:\n[1] guest launch: https://github.com/openstack/nova/blob/4f33047d07f5a11b208c344fe206aba01cd8e6fe/nova/virt/libvirt/driver.py#L4789-L4789\n[2] append to file: https://github.com/openstack/nova/blob/4f33047d07f5a11b208c344fe206aba01cd8e6fe/nova/virt/libvirt/driver.py#L2688-L2688\n[3] chown console log: https://github.com/openstack/nova/blob/4f33047d07f5a11b208c344fe206aba01cd8e6fe/nova/virt/libvirt/driver.py#L2901-L2901", 
            "date_created": "2016-06-30 09:30:05.081523+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "I don't find any occurrences in logstash for the error you get: http://logstash.openstack.org/#/dashboard/file/logstash.json?from=604800s&query=message:%5C%22libvirtError:%20internal%20error:%20process%20exited%20while%20connecting%20to%20monitor%5C%22%20AND%20message:%5C%22Permission%20denied%5C%22", 
            "date_created": "2016-06-30 09:37:34.237225+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Thanks for the hints!\n\n1) I'll test the local change you proposed\n\n2) Instance directory & path are fine, it's really only the console.log file\n\n3) Issues occur on our 3rd party CI system not monitored in logstash\n", 
            "date_created": "2016-06-30 09:45:37.460754+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "@Silvain:\n\nregarding 3): \nTrue, I wanted to say that this is limited to that 3rd party CI and that the OpenStack CI is not affected. Which could mean the OpenStack CI has a testing gap or that the 3rd party CI has a different hypervisor setup. \n\n4) Can you determine when this error started to occur in your CI?\n\nFor the sake of completeness, this is the change of the 3rd party CI which was mentioned in the description above: http://78.46.57.153:8081/refs-changes-30-260930-40/", 
            "date_created": "2016-06-30 10:48:21.857309+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "@Markus:\n\nad 1) Tested that, no difference. I'm currently working on fetching directory listings at different points in order to see what's happening to the files.\n\nad 3) ah, ok. Different setup is my guess.\n\nad 4) Will check\n\n\nPS: Thanks for clarifying the Log URL\n", 
            "date_created": "2016-06-30 12:24:35.872311+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "ad 4) Can determine that only roughly, between 2016-06-03 and 2016-06-09 with tendency towards the end of that period.", 
            "date_created": "2016-06-30 12:46:07.141677+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "@Markus\n\nad 1) Some more testing output: The uid on the pregenerated console.log prior to launch is 1000 (which is the nova services id in that setup, it's a Devstack with all services running as user 'ubuntu'). Immediately after that output the guest is launched and crashes with permission denied.\n\n2016-06-30 13:04:57.831 14565 DEBUG nova.virt.libvirt.driver [req-b4b6cee5-971e-42c3-a23c-823bf456a755 tempest-ServerRescueNegativeTestJSON-1452818993 tempest-ServerRescueNegativeTestJSON-1452818993] Stat of CONSOLE.LOG is: posix.stat_result(st_mode=33188, st_ino=796043, st_dev=64769L, st_nlink=1, st_uid=1000, st_gid=112, st_size=0, st_atime=1467291897, st_mtime=1467291897, st_ctime=1467291897) _log_console_data /opt/stack/nova/nova/virt/libvirt/driver.py:4696\n2016-06-30 13:04:58.288 14565 ERROR nova.virt.libvirt.guest [req-bb7c4d54-8672-40a0-b4b4-d8800cbf93c9 tempest-DeleteServersTestJSON-636091130 tempest-DeleteServersTestJSON-636091130] Error launching a defined do\nmain with XML: <domain type='qemu'>\n  <name>instance-00000098</name>\n  <uuid>0c414238-53fc-47ba-9691-175935b53bf3</uuid>\n\n", 
            "date_created": "2016-06-30 13:12:58.638356+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "@Silvain:\n\nCould be caused by commit [1] which merged Jun 8, 2016. It removed the creation of the file:\n\n    libvirt_utils.write_to_file(\n        self._get_console_log_path(instance), '', 7)\n\nMaybe you can revert that in your setup and try again?\n\nReferences:\n[1] https://github.com/openstack/nova/commit/ea3904b168e4360b6c68464dbcd0585987b27e91", 
            "date_created": "2016-06-30 13:53:27.821721+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Is this a new test in tempest? Get with PaulMurray, paul-carlton or andrearosa since I think they've been working on volume shelve testing/changes in nova.", 
            "date_created": "2016-06-30 14:14:22.023657+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "@Matt I looked at it and it doesn't seem related to what we are doing with shelve testing/changes in nova, even because the new things we are working on are not merged yet.\n\n", 
            "date_created": "2016-07-01 14:46:36.455201+00:00", 
            "author": "https://api.launchpad.net/1.0/~andrea-rosa-m"
        }, 
        {
            "content": "@Markus Yes, reverting that patch solves the issue. It took me quite some time to test this, last weeks test setup got dilluted somehow and continuously showed the issue. But doing a fresh devstack setup, reverting the patch you referenced and running the tests worked!\n\nI haven't revert a patch via gerrit so far and cannot find related info at http://docs.openstack.org/infra/manual/developers.html , any hints on how to progress on such a revert?\n\nI'm writing in this ticket here because I'm quite unsure if this and #1549828 are really duplicates. I think both bugs have their roots in the libvirt behaviour but need different fixes. This issue clearly started at a different time than #1549828.\nHowever I'll review #1549828 in conjunction with the patch revert more closely, too.", 
            "date_created": "2016-07-04 09:24:25.662082+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "Hmm, from reading gerrit i just create a revert review via the gerrit revert button on change Ia84579b84105e8ad6146591188a96e847e762c77 at https://review.openstack.org/#/c/326335/ . I'll do that.", 
            "date_created": "2016-07-04 11:51:05.784298+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/337174", 
            "date_created": "2016-07-04 11:58:12.681845+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Unmarked this as a duplicate of https://bugs.launchpad.net/nova/+bug/1597644 . As stated earlier these two have a common background but are not the same issue and need differing fixes afaics.", 
            "date_created": "2016-07-05 13:11:21.523255+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "My last comments URL was wrong, please use: https://bugs.launchpad.net/nova/+bug/1549828 instead of #1597644 (self reference).", 
            "date_created": "2016-07-05 13:13:31.811603+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "There was some discussion this might be shelving related but i do not think that's the case. There are ~18 Tests failing with this issue only a few of them related to shelving. Here's a non shelving related log excerpt:\n\n\n2016-07-11 11:31:28.752 1177 ERROR nova.virt.libvirt.guest [req-7bfbe6d1-f4b9-411e-9f18-91e39f1b3ea8 tempest-DeleteServersTestJSON-115182603 tempest-DeleteServersTestJSON-115182603] Error launching a defined domain with XML: <domain type='kvm'>\n  <name>instance-00000001</name>\n  <uuid>2eb6607b-0586-48e2-adbe-f504ac5aad9d</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"14.0.0\"/>\n      <nova:name>tempest.common.compute-instance-1666089006</nova:name>\n      <nova:creationTime>2016-07-11 11:31:27</nova:creationTime>\n      <nova:flavor name=\"m1.nano\">\n        <nova:memory>64</nova:memory>\n        <nova:disk>0</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"f921877d5fc74b339a2438ae3aacfa76\">tempest-DeleteServersTestJSON-115182603</nova:user>\n        <nova:project uuid=\"06cabfc64c4c42e391cc865a2a969896\">tempest-DeleteServersTestJSON-115182603</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"9925a1d5-0feb-42bd-aff4-502a8a583dc6\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>65536</memory>\n  <currentMemory unit='KiB'>65536</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <cputune>\n    <shares>1024</shares>\n  </cputune>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>14.0.0</entry>\n      <entry name='serial'>f2550c2d-638a-48dd-9c7e-83e4d9ca6acd</entry>\n      <entry name='uuid'>2eb6607b-0586-48e2-adbe-f504ac5aad9d</entry>\n      <entry name='family'>Virtual Machine</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-trusty'>hvm</type>\n    <kernel>/opt/stack/data/nova/instances/2eb6607b-0586-48e2-adbe-f504ac5aad9d/kernel</kernel>\n    <initrd>/opt/stack/data/nova/instances/2eb6607b-0586-48e2-adbe-f504ac5aad9d/ramdisk</initrd>\n    <cmdline>root=/dev/vda console=tty0 console=ttyS0</cmdline>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu mode='host-model'>\n    <model fallback='allow'/>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none' io='native'/>\n      <source file='/opt/stack/data/nova/instances/2eb6607b-0586-48e2-adbe-f504ac5aad9d/disk'/>\n      <target dev='vda' bus='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source file='/opt/stack/data/nova/instances/2eb6607b-0586-48e2-adbe-f504ac5aad9d/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <controller type='ide' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:55:b1:c3'/>\n      <source bridge='br100'/>\n      <model type='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/opt/stack/data/nova/instances/2eb6607b-0586-48e2-adbe-f504ac5aad9d/console.log'/>\n      <target port='0'/>\n    </serial>\n    <serial type='pty'>\n      <target port='1'/>\n    </serial>\n    <console type='file'>\n      <source path='/opt/stack/data/nova/instances/2eb6607b-0586-48e2-adbe-f504ac5aad9d/console.log'/>\n      <target type='serial' port='0'/>\n    </console>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n      <stats period='10'/>\n    </memballoon>\n  </devices>\n</domain>\n\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [req-7bfbe6d1-f4b9-411e-9f18-91e39f1b3ea8 tempest-DeleteServersTestJSON-115182603 tempest-DeleteServersTestJSON-115182603] [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d] Instance failed to spawn\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d] Traceback (most recent call last):\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2066, in _build_resources\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     yield resources\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1910, in _build_and_run_instance\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     block_device_info=block_device_info)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2668, in spawn\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     post_xml_callback=gen_confdrive)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4871, in _create_domain_and_network\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     post_xml_callback=post_xml_callback)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4800, in _create_domain\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     guest.launch(pause=pause)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/opt/stack/nova/nova/virt/libvirt/guest.py\", line 142, in launch\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     self._encoded_xml, errors='ignore')\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     self.force_reraise()\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     six.reraise(self.type_, self.value, self.tb)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/opt/stack/nova/nova/virt/libvirt/guest.py\", line 137, in launch\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     return self._domain.createWithFlags(flags)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 186, in doit\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 144, in proxy_call\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     rv = execute(f, *args, **kwargs)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 125, in execute\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     six.reraise(c, e, tb)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 83, in tworker\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     rv = meth(*args, **kwargs)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]   File \"/usr/local/lib/python2.7/dist-packages/libvirt.py\", line 900, in createWithFlags\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d] libvirtError: internal error: process exited while connecting to monitor: qemu-system-x86_64: -chardev file,id=charserial0,path=/opt/stack/data/nova/instances/2eb6607b-0586-48e2-adbe-f504ac5aad9d/console.log: Could not open '/opt/stack/data/nova/instances/2eb6607b-0586-48e2-adbe-f504ac5aad9d/console.log': Permission denied\n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d] \n2016-07-11 11:31:28.753 1177 ERROR nova.compute.manager [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d] \n2016-07-11 11:31:28.754 1177 INFO nova.compute.manager [req-7bfbe6d1-f4b9-411e-9f18-91e39f1b3ea8 tempest-DeleteServersTestJSON-115182603 tempest-DeleteServersTestJSON-115182603] [instance: 2eb6607b-0586-48e2-adbe-f504ac5aad9d] Terminating instance", 
            "date_created": "2016-07-11 12:04:14.869185+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "FYI: The revert of the change identified by Marcus successfully removes this issue (see the change and it's Quobyte CI run / Comments.", 
            "date_created": "2016-07-13 05:53:17.141899+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "Observation:\nThe CI run at http://78.46.57.153:8081/refs-changes-91-318291-8/ showed no errors despite not having the fixing change in tree.\nSeems this is a timing related issue and this test run got lucky? It's the only one i've seen working on this so far.", 
            "date_created": "2016-07-19 09:10:35.401149+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "I took a look back at the last week of CI runs, there were three successful CI runs not including the fixing change referenced above. This strengthens my thinking this is a timing related issue.", 
            "date_created": "2016-07-25 07:44:19.743722+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/337174\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=d4e6bd8b2d0236b44baa9e20f301e88934e1450c\nSubmitter: Jenkins\nBranch:    master\n\ncommit d4e6bd8b2d0236b44baa9e20f301e88934e1450c\nAuthor: Silvan Kaiser <email address hidden>\nDate:   Mon Jul 4 11:58:00 2016 +0000\n\n    Revert \"Remove manual creation of console.log\"\n    \n    The change to be reverted in this change removed a manual\n    console.log creation that was thought unnecessary. However due\n    to libvirt behaviour permission issue arise if console.log is\n    created not by nova causing the Quobyte CI to fail.\n    Closes-Bug: #1597644\n    This reverts commit ea3904b168e4360b6c68464dbcd0585987b27e91.\n    \n    Change-Id: I36d1faf90f9b97ae756b8bcda3beb47e66f9e587\n", 
            "date_created": "2016-07-25 16:27:21.195112+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/348275", 
            "date_created": "2016-07-28 12:23:22.581658+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "FYI setting dynamic_ownership=0 is really a bad idea and liable to break nova in suprising ways. This console.log problem is one example, but I'm confident this will have broken other parts of Nova - quite possibly save/restore to file. I'm guessing the reason this is done to was to prevent libvirt trying to change ownership for the quobyte disk images, presumably because the server is configured to deny ownership changes.\n\nIf so, a much better approach is to enhance nova so that it can set a <seclabel> element against *just* the quobyte backed disks, that tells libvirt to skip ownership changes for those disks. That way operation of libvirt  / QEMU in general will not be affect, thus avoiding nasty side-effects such as this console.log problem.\n\nIMHO we should explicitly consider dynamic_ownership=0 to be an unsupported config for libvirt with Nova.", 
            "date_created": "2016-08-01 11:05:01.607272+00:00", 
            "author": "https://api.launchpad.net/1.0/~berrange"
        }, 
        {
            "content": "@Daniel: Thanks a lot for your comment (#22). I took your proposal and the general issue to a new ticket (#1609298). I'd be happy to get more input on this, especially the seclabel approach.", 
            "date_created": "2016-08-03 08:58:01.438708+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "Follow up ticket is at https://bugs.launchpad.net/nova/+bug/1609298", 
            "date_created": "2016-08-03 08:58:25.062750+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "Change abandoned by Silvan Kaiser (<email address hidden>) on branch: master\nReview: https://review.openstack.org/348275\nReason: No longer required as alternative merged.", 
            "date_created": "2016-08-04 07:53:57.700339+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0b3 development milestone.", 
            "date_created": "2016-09-02 01:16:38.010164+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/392643", 
            "date_created": "2016-11-02 13:09:57.233588+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/392643\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=1848860fd4fb6dfb2ead1f8271050d36df592205\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1848860fd4fb6dfb2ead1f8271050d36df592205\nAuthor: Stephen Finucane <email address hidden>\nDate:   Wed Nov 2 12:43:35 2016 +0000\n\n    Ignore IOError when creating 'console.log'\n    \n    In 'd4e6bd8', and later refined in 'ec6ed24c', an issue with the the\n    Quobyte CI was resolved by ensuring that the 'console.log' file is\n    always created, even when libvirt's 'dynamic_ownership' config option\n    is set to '0'. However, attempting to take ownership of this file can\n    cause issues when 'dynamic_ownership' is set to '1' and a user attempts\n    to reschedule an instance to a host where it was previously located. In\n    this case, the permissions on the file have already been co-opted by\n    libvirt, and attempting to change them results in an IOError.\n    \n    The easiest fix for this is to simply ignore the IOError, as the file\n    already exists and libvirt has set correct permissions already. This is\n    what do here. A longer term fix would be to avoid changing the\n    permissions only for the offending Quobytes block devices, but this is\n    likely not backportable and will be done in a follow-up fix.\n    \n    Change-Id: I353afd57be207330757580447a1b606c7b9b7c09\n    Partial-bug: #1634282\n    Related-bug: #1597644\n    Related-bug: #1609298\n", 
            "date_created": "2017-02-01 18:04:05.638817+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: stable/newton\nReview: https://review.openstack.org/454593", 
            "date_created": "2017-04-07 08:20:25.515216+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/454593\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a96092d0e48fef62d257acf0428ddb6daf07d3a4\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit a96092d0e48fef62d257acf0428ddb6daf07d3a4\nAuthor: Stephen Finucane <email address hidden>\nDate:   Wed Nov 2 12:43:35 2016 +0000\n\n    Ignore IOError when creating 'console.log'\n    \n    In 'd4e6bd8', and later refined in 'ec6ed24c', an issue with the the\n    Quobyte CI was resolved by ensuring that the 'console.log' file is\n    always created, even when libvirt's 'dynamic_ownership' config option\n    is set to '0'. However, attempting to take ownership of this file can\n    cause issues when 'dynamic_ownership' is set to '1' and a user attempts\n    to reschedule an instance to a host where it was previously located. In\n    this case, the permissions on the file have already been co-opted by\n    libvirt, and attempting to change them results in an IOError.\n    \n    The easiest fix for this is to simply ignore the IOError, as the file\n    already exists and libvirt has set correct permissions already. This is\n    what do here. A longer term fix would be to avoid changing the\n    permissions only for the offending Quobytes block devices, but this is\n    likely not backportable and will be done in a follow-up fix.\n    \n    Change-Id: I353afd57be207330757580447a1b606c7b9b7c09\n    Partial-bug: #1634282\n    Related-bug: #1597644\n    Related-bug: #1609298\n    (cherry picked from commit 1848860fd4fb6dfb2ead1f8271050d36df592205)\n", 
            "date_created": "2017-04-07 18:28:16.745419+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}