{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:49:58.268466+00:00", 
    "description": "After failing to create an instance due to no more fixed ips available, I try to delete the instance in error state. The instance cannot be deleted, and Traceback shows in the log:\n\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rval = self.proxy.dispatch(ctxt, version, method, **args)s2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return getattr(proxyobj, method)(ctxt, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    temp_level, payload)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    self.gen.next()\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return function(self, context, instance_uuid, *args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    do_terminate_instance()\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    retval = f(*args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    self._delete_instance(context, instance)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    self._shutdown_instance(context, instance)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    instance)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    res = f(self, context, *args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return self._get_instance_nw_info(context, instance)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return _get_impl().call(cfg.CONF, context, topic, msg, timeout)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rpc_amqp.get_connection_pool(conf, Connection))\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rv = list(rv)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00mTraceback (most recent call last):\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rval = self.proxy.dispatch(ctxt, version, method, **args)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return getattr(proxyobj, method)(ctxt, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return func(self, context, *args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1017, in get_instance_nw_info\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rxtx_factor, host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1038, in build_network_info_model\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    instance_host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1126, in _get_subnets_from_network\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    instance_host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 679, in inner\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    retval = f(*args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 808, in _get_dhcp_ip\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    host=host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 434, in fixed_ip_associate_pool\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    instance_id, host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 113, in wrapper\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return f(*args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 1032, in fixed_ip_associate_pool\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    raise exception.NoMoreFixedIps()\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00mNoMoreFixedIps: Zero fixed ips available.\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\n                                                                                                                           107,1         98", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1192893", 
    "owner": "https://api.launchpad.net/1.0/~yufang521247", 
    "id": 1192893, 
    "index": 3774, 
    "created": "2013-06-20 09:59:30.944970+00:00", 
    "title": "Cannot delete when there are no fixed ips available", 
    "comments": [
        {
            "content": "After failing to create an instance due to no more fixed ips available, I try to delete the instance in error state. The instance cannot be deleted, and Traceback shows in the log:\n\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rval = self.proxy.dispatch(ctxt, version, method, **args)s2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return getattr(proxyobj, method)(ctxt, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    temp_level, payload)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    self.gen.next()\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return function(self, context, instance_uuid, *args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    do_terminate_instance()\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    retval = f(*args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    self._delete_instance(context, instance)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    self._shutdown_instance(context, instance)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    instance)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    res = f(self, context, *args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return self._get_instance_nw_info(context, instance)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return _get_impl().call(cfg.CONF, context, topic, msg, timeout)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rpc_amqp.get_connection_pool(conf, Connection))\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rv = list(rv)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00mTraceback (most recent call last):\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rval = self.proxy.dispatch(ctxt, version, method, **args)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return getattr(proxyobj, method)(ctxt, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return func(self, context, *args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1017, in get_instance_nw_info\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    rxtx_factor, host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1038, in build_network_info_model\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    instance_host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1126, in _get_subnets_from_network\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    instance_host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 679, in inner\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    retval = f(*args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 808, in _get_dhcp_ip\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    host=host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 434, in fixed_ip_associate_pool\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    instance_id, host)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 113, in wrapper\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    return f(*args, **kwargs)\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m  File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 1032, in fixed_ip_associate_pool\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m    raise exception.NoMoreFixedIps()\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00mNoMoreFixedIps: Zero fixed ips available.\ns2013-06-20 17:53:30 TRACE nova.openstack.common.rpc.amqp ^[[01;35m^[[00m\n                                                                                                                           107,1         98", 
            "date_created": "2013-06-20 09:59:30.944970+00:00", 
            "author": "https://api.launchpad.net/1.0/~yufang521247"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/33796", 
            "date_created": "2013-06-20 10:26:20.866858+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Steps to reproduce:\n\n1. Create a network\n2. Reserve all fixed ips of the network\n3. Try to create an instance but failed\n4. Try to delete the instance\n\nResults:\nCannot delete the instance due to the 'NoMoreFixedIps' exception.\n", 
            "date_created": "2013-06-21 02:19:45.489841+00:00", 
            "author": "https://api.launchpad.net/1.0/~yufang521247"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/33796\nCommitted: http://github.com/openstack/nova/commit/3d27a0e74bde3878af76414dc4020ac6f9f24e4e\nSubmitter: Jenkins\nBranch:    master\n\ncommit 3d27a0e74bde3878af76414dc4020ac6f9f24e4e\nAuthor: Yufang Zhang <email address hidden>\nDate:   Thu Jun 20 18:17:49 2013 +0800\n\n    Handle NoMoreFixedIps in _shutdown_instance.\n    \n    Bug 1192893\n    \n    If no fixed ips is found, continue to perform the rest of the instance\n    shutdown, instead of propogating the exception.\n    \n    Steps to reproduce:\n    1. Create a network\n    2. Reserve all fixed ips of the network\n    3. Try to create an instance but failed\n    4. Try to delete the instance\n    \n    Results:\n    Cannot delete the instance due to the 'NoMoreFixedIps' exception.\n    \n    Change-Id: I42776c427773f1f81c16062a9aaa54850ec68bfd\n", 
            "date_created": "2013-06-24 20:29:46.356851+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}