{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:59:14.831432+00:00", 
    "description": "When non-admin user add new nic to the vm by:\n\nalex@hp-pc:/opt/stack/nova$ nova --debug add-fixed-ip vm1 12d4bedb-77fb-44da-b6d6-6c52e7606c02\n\n\nwill get error as below:\n\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 778, in add_fixed_ip_to_instance\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     self._allocate_fixed_ips(context, instance_id, host, [network])\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 194, in _allocate_fixed_ips\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     vpn=vpn, address=address)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 1938, in allocate_fixed_ip\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     address = fip.address\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/base.py\", line 161, in wrapper\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     args, kwargs)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 365, in object_class_action\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     objver=objver, args=args, kwargs=kwargs)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 349, in send\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     retry=retry)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 340, in _send\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     raise result\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher AdminRequired_Remote: User does not have admin privileges\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/manager.py\", line 420, in _object_dispatch\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     \"\"\"Perform a classmethod action on an object.\"\"\"\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/base.py\", line 163, in wrapper\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     result = fn(cls, context, *args, **kwargs)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/fixed_ip.py\", line 160, in associate_pool\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     host=host)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/db/api.py\", line 509, in fixed_ip_associate_pool\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     instance_uuid, host)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 127, in wrapper\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/context.py\", line 235, in require_admin_context\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher AdminRequired: User does not have admin privileges", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1432455", 
    "owner": "https://api.launchpad.net/1.0/~shaohef", 
    "id": 1432455, 
    "index": 347, 
    "created": "2015-03-16 01:20:19.249407+00:00", 
    "title": "non-admin user can't add new fixed ip to the VM by os-multinic api", 
    "comments": [
        {
            "content": "When non-admin user add new nic to the vm by:\n\nalex@hp-pc:/opt/stack/nova$ nova --debug add-fixed-ip vm1 12d4bedb-77fb-44da-b6d6-6c52e7606c02\n\n\nwill get error as below:\n\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 778, in add_fixed_ip_to_instance\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     self._allocate_fixed_ips(context, instance_id, host, [network])\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 194, in _allocate_fixed_ips\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     vpn=vpn, address=address)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 1938, in allocate_fixed_ip\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     address = fip.address\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/base.py\", line 161, in wrapper\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     args, kwargs)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 365, in object_class_action\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     objver=objver, args=args, kwargs=kwargs)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 349, in send\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     retry=retry)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 340, in _send\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     raise result\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher AdminRequired_Remote: User does not have admin privileges\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/manager.py\", line 420, in _object_dispatch\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     \"\"\"Perform a classmethod action on an object.\"\"\"\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/base.py\", line 163, in wrapper\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     result = fn(cls, context, *args, **kwargs)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/fixed_ip.py\", line 160, in associate_pool\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     host=host)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/db/api.py\", line 509, in fixed_ip_associate_pool\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher     instance_uuid, host)\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 127, in wrapper\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/context.py\", line 235, in require_admin_context\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher\n2015-03-16 09:23:18.306 TRACE oslo_messaging.rpc.dispatcher AdminRequired: User does not have admin privileges", 
            "date_created": "2015-03-16 01:20:19.249407+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/150687\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a57fae105452e26684406b59ff6b2128698479e9\nSubmitter: Jenkins\nBranch:    master\n\ncommit a57fae105452e26684406b59ff6b2128698479e9\nAuthor: ShaoHe Feng <email address hidden>\nDate:   Fri Feb 27 17:36:27 2015 +0800\n\n    Remove db layer hard-code permission checks for fixed_ip_associate_*\n    \n    This patches removes db layer hard-code permission checks for\n    fixed_ip_associate_*\n    \n    the follow functions call db fixed_ip_associate_* API\n    1. allocate_for_instance, contex has been elevated.\n    2. add_fixed_ip_to_instance, it does not need to require admin previlege.\n       and bug 1432455 was filed for it.\n    \n    the follow functions call db fixed_ip_associate_pool API.\n    1. NetworkManager._get_dhcp_ip, contex has been elevated.\n    \n    Closes-Bug: 1432455\n    Partially implements bp nova-api-policy-final-part\n    \n    Change-Id: Ia33080c1681b139dbca72bfd5c9810e8fbea6719\n", 
            "date_created": "2015-08-12 17:41:51.759601+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/150687\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a57fae105452e26684406b59ff6b2128698479e9\nSubmitter: Jenkins\nBranch:    master\n\ncommit a57fae105452e26684406b59ff6b2128698479e9\nAuthor: ShaoHe Feng <email address hidden>\nDate:   Fri Feb 27 17:36:27 2015 +0800\n\n    Remove db layer hard-code permission checks for fixed_ip_associate_*\n    \n    This patches removes db layer hard-code permission checks for\n    fixed_ip_associate_*\n    \n    the follow functions call db fixed_ip_associate_* API\n    1. allocate_for_instance, contex has been elevated.\n    2. add_fixed_ip_to_instance, it does not need to require admin previlege.\n       and bug 1432455 was filed for it.\n    \n    the follow functions call db fixed_ip_associate_pool API.\n    1. NetworkManager._get_dhcp_ip, contex has been elevated.\n    \n    Closes-Bug: 1432455\n    Partially implements bp nova-api-policy-final-part\n    \n    Change-Id: Ia33080c1681b139dbca72bfd5c9810e8fbea6719\n", 
            "date_created": "2015-08-12 17:41:57.173209+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}