{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:24:03.801533+00:00", 
    "description": "when i try to attach a existing port to an instance using command: nova interface-attach --port-id <port-id> <instance-id>, i get an error: Failed to attach interface\n\nStep to reproduce:\n\nstacker@stack:~$ neutron port-create 2cac259a-d9b5-47fe-9263-79ce6fd22dc6\nCreated a new port:\n+-----------------------+--------------------------------------------------------------------------------------+\n| Field                 | Value                                                                                |\n+-----------------------+--------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                                 |\n| allowed_address_pairs |                                                                                      |\n| binding:host_id       |                                                                                      |\n| binding:profile       | {}                                                                                   |\n| binding:vif_details   | {}                                                                                   |\n| binding:vif_type      | unbound                                                                              |\n| binding:vnic_type     | normal                                                                               |\n| device_id             |                                                                                      |\n| device_owner          |                                                                                      |\n| fixed_ips             | {\"subnet_id\": \"991d821c-aeea-44db-b419-4f82fc89353a\", \"ip_address\": \"121.12.120.21\"} |\n| id                    | 620c1351-fbac-4d68-aab3-943feb9acb14                                                 |\n| mac_address           | fa:16:3e:4f:83:59                                                                    |\n| name                  |                                                                                      |\n| network_id            | 2cac259a-d9b5-47fe-9263-79ce6fd22dc6                                                 |\n| security_groups       | 06aaa36c-a685-4493-a72d-f8457f00acb3                                                 |\n| status                | DOWN                                                                                 |\n| tenant_id             | 270850a2c3cd46d794b05e9f28e2c9e2                                                     |\n+-----------------------+--------------------------------------------------------------------------------------+\nstacker@stack:~$ nova list --all-tenants\n+--------------------------------------+------+---------+------------+-------------+--------------------------------------+\n| ID                                   | Name | Status  | Task State | Power State | Networks                             |\n+--------------------------------------+------+---------+------------+-------------+--------------------------------------+\n| af87c1b2-1fd4-4345-a9b6-025694b1cec7 | b    | SHUTOFF | -          | Shutdown    | test=121.12.120.17; private=10.0.0.7 |\n| d63f5376-03a6-49ad-b80e-c460c5039593 | c    | SHUTOFF | -          | Shutdown    | private=10.0.0.8                     |\n+--------------------------------------+------+---------+------------+-------------+--------------------------------------+\nstacker@stack:~$ nova interface-attach --port-id 620c1351-fbac-4d68-aab3-943feb9acb14 d63f5376-03a6-49ad-b80e-c460c5039593\nERROR (ClientException): Failed to attach interface (HTTP 500) (Request-ID: req-3d04c5c6-3700-4ebc-9912-6dbf3f13f728)\n\nHere is part of trace log from nova-api:\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces   File \"/opt/stack/nova/nova/compute/manager.py\", line 323, in decorated_function\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces     kwargs['instance'], e, sys.exc_info())\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces   File \"/usr/local/lib/python2.7/dist-packages/oslo/utils/excutils.py\", line 82, in __exit__\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces     six.reraise(self.type_, self.value, self.tb)\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces   File \"/opt/stack/nova/nova/compute/manager.py\", line 311, in decorated_function\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces     return function(self, context, *args, **kwargs)\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces   File \"/opt/stack/nova/nova/compute/manager.py\", line 4828, in attach_interface\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces     instance_uuid=instance.uuid)\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces InterfaceAttachFailed: Failed to attach network adapter device to d63f5376-03a6-49ad-b80e-c460c5039593", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1409617", 
    "owner": "https://api.launchpad.net/1.0/~liyingjun", 
    "id": 1409617, 
    "index": 218, 
    "created": "2015-01-12 07:51:21.679677+00:00", 
    "title": "Failed to attach interface ", 
    "comments": [
        {
            "content": "when i try to attach a existing port to an instance using command: nova interface-attach --port-id <port-id> <instance-id>, i get an error: Failed to attach interface\n\nStep to reproduce:\n\nstacker@stack:~$ neutron port-create 2cac259a-d9b5-47fe-9263-79ce6fd22dc6\nCreated a new port:\n+-----------------------+--------------------------------------------------------------------------------------+\n| Field                 | Value                                                                                |\n+-----------------------+--------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                                 |\n| allowed_address_pairs |                                                                                      |\n| binding:host_id       |                                                                                      |\n| binding:profile       | {}                                                                                   |\n| binding:vif_details   | {}                                                                                   |\n| binding:vif_type      | unbound                                                                              |\n| binding:vnic_type     | normal                                                                               |\n| device_id             |                                                                                      |\n| device_owner          |                                                                                      |\n| fixed_ips             | {\"subnet_id\": \"991d821c-aeea-44db-b419-4f82fc89353a\", \"ip_address\": \"121.12.120.21\"} |\n| id                    | 620c1351-fbac-4d68-aab3-943feb9acb14                                                 |\n| mac_address           | fa:16:3e:4f:83:59                                                                    |\n| name                  |                                                                                      |\n| network_id            | 2cac259a-d9b5-47fe-9263-79ce6fd22dc6                                                 |\n| security_groups       | 06aaa36c-a685-4493-a72d-f8457f00acb3                                                 |\n| status                | DOWN                                                                                 |\n| tenant_id             | 270850a2c3cd46d794b05e9f28e2c9e2                                                     |\n+-----------------------+--------------------------------------------------------------------------------------+\nstacker@stack:~$ nova list --all-tenants\n+--------------------------------------+------+---------+------------+-------------+--------------------------------------+\n| ID                                   | Name | Status  | Task State | Power State | Networks                             |\n+--------------------------------------+------+---------+------------+-------------+--------------------------------------+\n| af87c1b2-1fd4-4345-a9b6-025694b1cec7 | b    | SHUTOFF | -          | Shutdown    | test=121.12.120.17; private=10.0.0.7 |\n| d63f5376-03a6-49ad-b80e-c460c5039593 | c    | SHUTOFF | -          | Shutdown    | private=10.0.0.8                     |\n+--------------------------------------+------+---------+------------+-------------+--------------------------------------+\nstacker@stack:~$ nova interface-attach --port-id 620c1351-fbac-4d68-aab3-943feb9acb14 d63f5376-03a6-49ad-b80e-c460c5039593\nERROR (ClientException): Failed to attach interface (HTTP 500) (Request-ID: req-3d04c5c6-3700-4ebc-9912-6dbf3f13f728)\n\nHere is part of trace log from nova-api:\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces   File \"/opt/stack/nova/nova/compute/manager.py\", line 323, in decorated_function\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces     kwargs['instance'], e, sys.exc_info())\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces   File \"/usr/local/lib/python2.7/dist-packages/oslo/utils/excutils.py\", line 82, in __exit__\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces     six.reraise(self.type_, self.value, self.tb)\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces   File \"/opt/stack/nova/nova/compute/manager.py\", line 311, in decorated_function\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces     return function(self, context, *args, **kwargs)\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces   File \"/opt/stack/nova/nova/compute/manager.py\", line 4828, in attach_interface\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces     instance_uuid=instance.uuid)\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces\n2015-01-12 15:47:34.943 TRACE nova.api.openstack.compute.contrib.attach_interfaces InterfaceAttachFailed: Failed to attach network adapter device to d63f5376-03a6-49ad-b80e-c460c5039593", 
            "date_created": "2015-01-12 07:51:21.679677+00:00", 
            "author": "https://api.launchpad.net/1.0/~liyingjun"
        }, 
        {
            "content": "Found the problem!  I used admin to create the port, and tried to attach the port to an instance belong to another tenant. But i think we should deny the interface attaching when the port is not belong to the tenant instead of raising an InterfaceAttachFailed exception.", 
            "date_created": "2015-01-13 07:00:48.937120+00:00", 
            "author": "https://api.launchpad.net/1.0/~liyingjun"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/146788", 
            "date_created": "2015-01-13 07:47:10.817495+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/146788\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c4f353b112dd49b3d04e2b0e115a7db2f0f167d1\nSubmitter: Jenkins\nBranch:    master\n\ncommit c4f353b112dd49b3d04e2b0e115a7db2f0f167d1\nAuthor: liyingjun <email address hidden>\nDate:   Tue Feb 10 15:24:13 2015 +0800\n\n    Improve 'attach interface' exception handling\n    \n    Previously, if a user attempted to launch an instance and specified a\n    port that belonged to a different tenant, a HTTP 500 Server\n    Error was returned to the user. This patch changes that to a\n    more informative HTTPBadRequest exception.\n    \n    Change-Id: I4a4017407ac7358490974cbffc5b7dbb7a200f44\n    Closes-bug: #1409617\n", 
            "date_created": "2015-03-12 06:10:25.644934+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}