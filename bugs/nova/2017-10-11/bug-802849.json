{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:10:41.662113+00:00", 
    "description": "I tested rev1218.\n\nnova-manage network create cannot register gateway_v6 when using FlatManager and use_ipv6 flag is true.\n\n* Default value of gateway_v6 causes error\n\n# ./nova/bin/nova-manage --use_ipv6 --network_manager=nova.network.manager.FlatManager network create 10.1.7.0/24 1 16 1000 1000 fd00:1::/48\nCommand failed, please check log for more info\n2011-06-28 16:17:50,455 CRITICAL nova [-] range contains more than 9223372036854775807 (sys.maxint) IP addresses! Use the .size property instead.\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"./nova/bin/nova-manage\", line 1249, in <module>\n(nova): TRACE:     main()\n(nova): TRACE:   File \"./nova/bin/nova-manage\", line 1238, in main\n(nova): TRACE:     fn(*argv)\n(nova): TRACE:   File \"./nova/bin/nova-manage\", line 584, in create\n(nova): TRACE:     label=label)\n(nova): TRACE:   File \"/opt2/nova/nova/network/manager.py\", line 333, in create_networks\n(nova): TRACE:     net['gateway_v6'] = str(list(project_net_v6)[1])\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/netaddr/ip/__init__.py\", line 932, in __len__\n(nova): TRACE:     \"IP addresses! Use the .size property instead.\" % _sys.maxint)\n(nova): TRACE: IndexError: range contains more than 9223372036854775807 (sys.maxint) IP addresses! Use the .size property instead.\n(nova): TRACE:\n\n* Specifying  value of gateway_v6 registser incorrect gateway_v6 value.\n\n# ./nova/bin/nova-manage --use_ipv6 --network_manager=nova.network.manager.FlatManager network create 10.1.9.0/28 1 16 1000 1000 fd00:1::/48 fd00:1::1\n2011-06-28 16:25:27,321 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/opt2/nova/nova/db/sqlalchemy/api.pyc'> from (pid=699) __get_backend /opt2/nova/nova/utils.py:406\nroot@usv601:/opt2# mysql -u root --password=nova nova --execute \"select id,cidr,cidr_v6,gateway_v6 from networks where cidr like '10.1.9.0%';\"\n+----+-------------+-------------+------------+\n| id | cidr        | cidr_v6     | gateway_v6 |\n+----+-------------+-------------+------------+\n| 17 | 10.1.9.0/28 | fd00:1::/64 | d          |\n+----+-------------+-------------+------------+\n\ngateway_v6 value 'd' is incorrect.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/802849", 
    "owner": "None", 
    "id": 802849, 
    "index": 2438, 
    "created": "2011-06-28 07:34:13.025821+00:00", 
    "title": "nova-manage network create does not properly register gateway_v6", 
    "comments": [
        {
            "content": "I tested rev1218.\n\nnova-manage network create cannot register gateway_v6 when using FlatManager and use_ipv6 flag is true.\n\n* Default value of gateway_v6 causes error\n\n# ./nova/bin/nova-manage --use_ipv6 --network_manager=nova.network.manager.FlatManager network create 10.1.7.0/24 1 16 1000 1000 fd00:1::/48\nCommand failed, please check log for more info\n2011-06-28 16:17:50,455 CRITICAL nova [-] range contains more than 9223372036854775807 (sys.maxint) IP addresses! Use the .size property instead.\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"./nova/bin/nova-manage\", line 1249, in <module>\n(nova): TRACE:     main()\n(nova): TRACE:   File \"./nova/bin/nova-manage\", line 1238, in main\n(nova): TRACE:     fn(*argv)\n(nova): TRACE:   File \"./nova/bin/nova-manage\", line 584, in create\n(nova): TRACE:     label=label)\n(nova): TRACE:   File \"/opt2/nova/nova/network/manager.py\", line 333, in create_networks\n(nova): TRACE:     net['gateway_v6'] = str(list(project_net_v6)[1])\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/netaddr/ip/__init__.py\", line 932, in __len__\n(nova): TRACE:     \"IP addresses! Use the .size property instead.\" % _sys.maxint)\n(nova): TRACE: IndexError: range contains more than 9223372036854775807 (sys.maxint) IP addresses! Use the .size property instead.\n(nova): TRACE:\n\n* Specifying  value of gateway_v6 registser incorrect gateway_v6 value.\n\n# ./nova/bin/nova-manage --use_ipv6 --network_manager=nova.network.manager.FlatManager network create 10.1.9.0/28 1 16 1000 1000 fd00:1::/48 fd00:1::1\n2011-06-28 16:25:27,321 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/opt2/nova/nova/db/sqlalchemy/api.pyc'> from (pid=699) __get_backend /opt2/nova/nova/utils.py:406\nroot@usv601:/opt2# mysql -u root --password=nova nova --execute \"select id,cidr,cidr_v6,gateway_v6 from networks where cidr like '10.1.9.0%';\"\n+----+-------------+-------------+------------+\n| id | cidr        | cidr_v6     | gateway_v6 |\n+----+-------------+-------------+------------+\n| 17 | 10.1.9.0/28 | fd00:1::/64 | d          |\n+----+-------------+-------------+------------+\n\ngateway_v6 value 'd' is incorrect.", 
            "date_created": "2011-06-28 07:34:13.025821+00:00", 
            "author": "https://api.launchpad.net/1.0/~iida-koji"
        }, 
        {
            "content": "Following patch works for me.\n\n=== modified file 'nova/network/manager.py'\n--- nova/network/manager.py     2011-06-23 13:57:22 +0000\n+++ nova/network/manager.py     2011-06-28 07:35:00 +0000\n@@ -328,9 +328,9 @@\n\n                 if gateway_v6:\n                     # use a pre-defined gateway if one is provided\n-                    net['gateway_v6'] = str(list(gateway_v6)[1])\n+                    net['gateway_v6'] = str(gateway_v6)\n                 else:\n-                    net['gateway_v6'] = str(list(project_net_v6)[1])\n+                    net['gateway_v6'] = str(project_net_v6[1])\n\n                 net['netmask_v6'] = str(project_net_v6._prefixlen)\n\n\n", 
            "date_created": "2011-06-28 07:41:39.988674+00:00", 
            "author": "https://api.launchpad.net/1.0/~iida-koji"
        }, 
        {
            "content": "Was apparently fixed as of rev1323. Please reopen if you disagree.", 
            "date_created": "2011-08-01 13:21:42.835302+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ]
}