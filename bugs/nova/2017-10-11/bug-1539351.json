{
    "status": "Won't Fix", 
    "last_updated": "2016-06-10 08:57:01.438566+00:00", 
    "description": "In case that authorization for deleting a VM instance is done by user_id,\nit works fine in V2.0 API, but it does not work in V2.1 API.\n\n[How to reproduce]\nIn nova policy.json,\nAdd the following entries(or modify existing entries like the following).\n\n-----------------------------------------------\n\"user\":  \"user_id:%(user_id)s\",\n\"compute:delete\": \"rule:user\",\n\"os_compute_api:servers:delete\": \"rule:user\",\n-----------------------------------------------\n\nIn nova api-paste.ini,\nchange 'openstack_compute_api_v21_legacy_v2_compatible' to\n'openstack_compute_api_legacy_v2' for \"/v2\" endpoint.\n\n-----------------------------------------------\n[composite:osapi_compute]\nuse = call:nova.api.openstack.urlmap:urlmap_factory\n/: oscomputeversions\n/v2: openstack_compute_api_legacy_v2\n/v2.1: openstack_compute_api_v21\n-----------------------------------------------\n\nIn V2.0 API, the authorization by 'user_id' works fine.\nOnly the user who created a VM instance can delete the VM instance.\n\nIn V2.1 API, the authorization by 'user_id' does not work.\nAny users in the same project can delete the VM instance that another user created.\n\nstack@devstack-master:/opt/devstack$ openstack user list\n+----------------------------------+----------+\n| ID                               | Name     |\n+----------------------------------+----------+\n| 1cd4d65d4f534cd89299bbf31edb37a4 | admin    |\n| 218e7be255be4c90bf0c4d796a9d509c | nova     |\n| 357fc80d750646f7b3b56fc1e6792222 | demo     |\n| 37c5204df2d345fb8a76359966dc8d1b | heat     |\n| 4a6e928a20a743a6a3d80944c607a22a | neutron  |\n| 8c613c4691e2447e8082f6c425cd34af | glance   |\n| 9ab80146bc964e81bfcf3331f6b8bb2d | alt_demo |\n| ecd940201f5c45a8833bb739149a54f0 | cinder   |\n+----------------------------------+----------+\nstack@devstack-master:/opt/devstack$ openstack project list\n+----------------------------------+--------------------+\n| ID                               | Name               |\n+----------------------------------+--------------------+\n| 4b7c129ea5ee49d1a620c26272091ec7 | admin              |\n| 4c3e76d51a3c4df384c74b8cafb3a9cc | invisible_to_admin |\n| 533daaf421554a84aa3b023b4a9c341c | demo               |\n| b04c7788628849a48b831f5ad57e374a | service            |\n+----------------------------------+--------------------+\nstack@devstack-master:/opt/devstack$ openstack catalog show compute\n+-----------+----------------------------------------------------------------------------+\n| Field     | Value                                                                      |\n+-----------+----------------------------------------------------------------------------+\n| endpoints | RegionOne                                                                  |\n|           |   publicURL: http://10.0.2.15:8774/v2.1/533daaf421554a84aa3b023b4a9c341c   |\n|           |   internalURL: http://10.0.2.15:8774/v2.1/533daaf421554a84aa3b023b4a9c341c |\n|           |   adminURL: http://10.0.2.15:8774/v2.1/533daaf421554a84aa3b023b4a9c341c    |\n|           |                                                                            |\n| name      | nova                                                                       |\n| type      | compute                                                                    |\n+-----------+----------------------------------------------------------------------------+\nstack@devstack-master:/opt/devstack$ openstack catalog show compute_legacy\n+-----------+--------------------------------------------------------------------------+\n| Field     | Value                                                                    |\n+-----------+--------------------------------------------------------------------------+\n| endpoints | RegionOne                                                                |\n|           |   publicURL: http://10.0.2.15:8774/v2/533daaf421554a84aa3b023b4a9c341c   |\n|           |   internalURL: http://10.0.2.15:8774/v2/533daaf421554a84aa3b023b4a9c341c |\n|           |   adminURL: http://10.0.2.15:8774/v2/533daaf421554a84aa3b023b4a9c341c    |\n|           |                                                                          |\n| name      | nova_legacy                                                              |\n| type      | compute_legacy                                                           |\n+-----------+--------------------------------------------------------------------------+\nstack@devstack-master:/opt/devstack$ nova show server1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | devstack-master                                                |\n| OS-EXT-SRV-ATTR:hostname             | server1                                                        |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | devstack-master                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000004                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | b0d768cd-3483-4e25-8b9d-9d8863f16502                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | cacd6bf4-fd74-49b5-9b62-7094d576ea6a                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-workgpr8                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                       |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2016-01-28T06:02:59.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2016-01-28T06:02:47Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 5084983d07d356ef1de4eacd7a1ad854a39e6f39582715bc9aed7097       |\n| id                                   | cb921ee5-07b6-4f2e-b66a-efcc05a74368                           |\n| image                                | cirros-0.3.4-x86_64-uec (b44a1bbe-3968-4664-898b-40eb81ce6bd5) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {}                                                             |\n| name                                 | server1                                                        |\n| os-extended-volumes:volumes_attached | []                                                             |\n| private network                      | 10.0.10.6, fd7a:6b74:f7b9:0:f816:3eff:fe14:d99                 |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | 533daaf421554a84aa3b023b4a9c341c                               |\n| updated                              | 2016-01-28T06:02:59Z                                           |\n| user_id                              | 357fc80d750646f7b3b56fc1e6792222                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@devstack-master:/opt/devstack$ nova --service-type compute_legacy --os-user-name alt_demo --os-project-name demo delete server1\nPolicy doesn't allow compute:delete to be performed. (HTTP 403) (Request-ID: req-cb34aecd-260a-4d50-b481-cd9483ae8745)\nERROR (CommandError): Unable to delete the specified server(s).\nstack@devstack-master:/opt/devstack$ nova --service-type compute_legacy --os-user-name demo --os-project-name demo delete server1\nRequest to delete server server1 has been accepted.\n\nstack@devstack-master:/opt/devstack$ nova show server2\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | devstack-master                                                |\n| OS-EXT-SRV-ATTR:hostname             | server2                                                        |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | devstack-master                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000006                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | b0d768cd-3483-4e25-8b9d-9d8863f16502                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | cacd6bf4-fd74-49b5-9b62-7094d576ea6a                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-xo3y1bo9                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                       |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2016-01-28T06:06:29.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2016-01-28T06:06:18Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 5084983d07d356ef1de4eacd7a1ad854a39e6f39582715bc9aed7097       |\n| id                                   | c5efae23-b7d6-492c-8a57-578825f8d563                           |\n| image                                | cirros-0.3.4-x86_64-uec (b44a1bbe-3968-4664-898b-40eb81ce6bd5) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {}                                                             |\n| name                                 | server2                                                        |\n| os-extended-volumes:volumes_attached | []                                                             |\n| private network                      | 10.0.10.8, fd7a:6b74:f7b9:0:f816:3eff:fe81:2b07                |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | 533daaf421554a84aa3b023b4a9c341c                               |\n| updated                              | 2016-01-28T06:06:29Z                                           |\n| user_id                              | 357fc80d750646f7b3b56fc1e6792222                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@devstack-master:/opt/devstack$ nova --service-type compute --os-user-name alt_demo --os-project-name demo delete server2\nRequest to delete server server2 has been accepted.\n\n[Environment]\nUbuntu 14.04 LTS\nnova(master, commit 1dfec7186222054c7bc810c9c6894aeac3173321)\nnovaclient 3.2.0", 
    "tags": [
        "api"
    ], 
    "importance": "Undecided", 
    "heat": 64, 
    "link": "https://bugs.launchpad.net/nova/+bug/1539351", 
    "owner": "None", 
    "id": 1539351, 
    "index": 6005, 
    "created": "2016-01-29 02:42:29.304534+00:00", 
    "title": "Authorization by user_id does not work in V2.1 API", 
    "comments": [
        {
            "content": "In case that authorization for deleting a VM instance is done by user_id,\nit works fine in V2.0 API, but it does not work in V2.1 API.\n\n[How to reproduce]\nIn nova policy.json,\nAdd the following entries(or modify existing entries like the following).\n\n-----------------------------------------------\n\"user\":  \"user_id:%(user_id)s\",\n\"compute:delete\": \"rule:user\",\n\"os_compute_api:servers:delete\": \"rule:user\",\n-----------------------------------------------\n\nIn nova api-paste.ini,\nchange 'openstack_compute_api_v21_legacy_v2_compatible' to\n'openstack_compute_api_legacy_v2' for \"/v2\" endpoint.\n\n-----------------------------------------------\n[composite:osapi_compute]\nuse = call:nova.api.openstack.urlmap:urlmap_factory\n/: oscomputeversions\n/v2: openstack_compute_api_legacy_v2\n/v2.1: openstack_compute_api_v21\n-----------------------------------------------\n\nIn V2.0 API, the authorization by 'user_id' works fine.\nOnly the user who created a VM instance can delete the VM instance.\n\nIn V2.1 API, the authorization by 'user_id' does not work.\nAny users in the same project can delete the VM instance that another user created.\n\nstack@devstack-master:/opt/devstack$ openstack user list\n+----------------------------------+----------+\n| ID                               | Name     |\n+----------------------------------+----------+\n| 1cd4d65d4f534cd89299bbf31edb37a4 | admin    |\n| 218e7be255be4c90bf0c4d796a9d509c | nova     |\n| 357fc80d750646f7b3b56fc1e6792222 | demo     |\n| 37c5204df2d345fb8a76359966dc8d1b | heat     |\n| 4a6e928a20a743a6a3d80944c607a22a | neutron  |\n| 8c613c4691e2447e8082f6c425cd34af | glance   |\n| 9ab80146bc964e81bfcf3331f6b8bb2d | alt_demo |\n| ecd940201f5c45a8833bb739149a54f0 | cinder   |\n+----------------------------------+----------+\nstack@devstack-master:/opt/devstack$ openstack project list\n+----------------------------------+--------------------+\n| ID                               | Name               |\n+----------------------------------+--------------------+\n| 4b7c129ea5ee49d1a620c26272091ec7 | admin              |\n| 4c3e76d51a3c4df384c74b8cafb3a9cc | invisible_to_admin |\n| 533daaf421554a84aa3b023b4a9c341c | demo               |\n| b04c7788628849a48b831f5ad57e374a | service            |\n+----------------------------------+--------------------+\nstack@devstack-master:/opt/devstack$ openstack catalog show compute\n+-----------+----------------------------------------------------------------------------+\n| Field     | Value                                                                      |\n+-----------+----------------------------------------------------------------------------+\n| endpoints | RegionOne                                                                  |\n|           |   publicURL: http://10.0.2.15:8774/v2.1/533daaf421554a84aa3b023b4a9c341c   |\n|           |   internalURL: http://10.0.2.15:8774/v2.1/533daaf421554a84aa3b023b4a9c341c |\n|           |   adminURL: http://10.0.2.15:8774/v2.1/533daaf421554a84aa3b023b4a9c341c    |\n|           |                                                                            |\n| name      | nova                                                                       |\n| type      | compute                                                                    |\n+-----------+----------------------------------------------------------------------------+\nstack@devstack-master:/opt/devstack$ openstack catalog show compute_legacy\n+-----------+--------------------------------------------------------------------------+\n| Field     | Value                                                                    |\n+-----------+--------------------------------------------------------------------------+\n| endpoints | RegionOne                                                                |\n|           |   publicURL: http://10.0.2.15:8774/v2/533daaf421554a84aa3b023b4a9c341c   |\n|           |   internalURL: http://10.0.2.15:8774/v2/533daaf421554a84aa3b023b4a9c341c |\n|           |   adminURL: http://10.0.2.15:8774/v2/533daaf421554a84aa3b023b4a9c341c    |\n|           |                                                                          |\n| name      | nova_legacy                                                              |\n| type      | compute_legacy                                                           |\n+-----------+--------------------------------------------------------------------------+\nstack@devstack-master:/opt/devstack$ nova show server1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | devstack-master                                                |\n| OS-EXT-SRV-ATTR:hostname             | server1                                                        |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | devstack-master                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000004                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | b0d768cd-3483-4e25-8b9d-9d8863f16502                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | cacd6bf4-fd74-49b5-9b62-7094d576ea6a                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-workgpr8                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                       |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2016-01-28T06:02:59.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2016-01-28T06:02:47Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 5084983d07d356ef1de4eacd7a1ad854a39e6f39582715bc9aed7097       |\n| id                                   | cb921ee5-07b6-4f2e-b66a-efcc05a74368                           |\n| image                                | cirros-0.3.4-x86_64-uec (b44a1bbe-3968-4664-898b-40eb81ce6bd5) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {}                                                             |\n| name                                 | server1                                                        |\n| os-extended-volumes:volumes_attached | []                                                             |\n| private network                      | 10.0.10.6, fd7a:6b74:f7b9:0:f816:3eff:fe14:d99                 |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | 533daaf421554a84aa3b023b4a9c341c                               |\n| updated                              | 2016-01-28T06:02:59Z                                           |\n| user_id                              | 357fc80d750646f7b3b56fc1e6792222                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@devstack-master:/opt/devstack$ nova --service-type compute_legacy --os-user-name alt_demo --os-project-name demo delete server1\nPolicy doesn't allow compute:delete to be performed. (HTTP 403) (Request-ID: req-cb34aecd-260a-4d50-b481-cd9483ae8745)\nERROR (CommandError): Unable to delete the specified server(s).\nstack@devstack-master:/opt/devstack$ nova --service-type compute_legacy --os-user-name demo --os-project-name demo delete server1\nRequest to delete server server1 has been accepted.\n\nstack@devstack-master:/opt/devstack$ nova show server2\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | devstack-master                                                |\n| OS-EXT-SRV-ATTR:hostname             | server2                                                        |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | devstack-master                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000006                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | b0d768cd-3483-4e25-8b9d-9d8863f16502                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | cacd6bf4-fd74-49b5-9b62-7094d576ea6a                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-xo3y1bo9                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                       |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2016-01-28T06:06:29.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2016-01-28T06:06:18Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 5084983d07d356ef1de4eacd7a1ad854a39e6f39582715bc9aed7097       |\n| id                                   | c5efae23-b7d6-492c-8a57-578825f8d563                           |\n| image                                | cirros-0.3.4-x86_64-uec (b44a1bbe-3968-4664-898b-40eb81ce6bd5) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {}                                                             |\n| name                                 | server2                                                        |\n| os-extended-volumes:volumes_attached | []                                                             |\n| private network                      | 10.0.10.8, fd7a:6b74:f7b9:0:f816:3eff:fe81:2b07                |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | 533daaf421554a84aa3b023b4a9c341c                               |\n| updated                              | 2016-01-28T06:06:29Z                                           |\n| user_id                              | 357fc80d750646f7b3b56fc1e6792222                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@devstack-master:/opt/devstack$ nova --service-type compute --os-user-name alt_demo --os-project-name demo delete server2\nRequest to delete server server2 has been accepted.\n\n[Environment]\nUbuntu 14.04 LTS\nnova(master, commit 1dfec7186222054c7bc810c9c6894aeac3173321)\nnovaclient 3.2.0", 
            "date_created": "2016-01-29 02:42:29.304534+00:00", 
            "author": "https://api.launchpad.net/1.0/~natsume-takashi"
        }, 
        {
            "content": "I have similar issue and confirmed this can be reproduced", 
            "date_created": "2016-02-05 11:14:06.253659+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "when we use v2, following log shows out and prevent additional actions, but in v21 I don't see it \n\n2016-02-05 06:16:44.275 13961 DEBUG nova.policy [req-fb5fea1d-d7d9-497c-8d08-bbd21215ea3f fd45d7605c4a4e90b7ce236773c0ed75 d1c5aa58af6c426492c642eb649017be - - -] Policy check for compute:delete failed with \ncredentials {'domain': None, 'project_name': u'demo', 'project_domain': None, 'timestamp': '2016-02-05T11:16:44.196011', 'remote_address': '192.168.122.239', 'quota_class': None, 'resource_uuid': None, 'is_admin': False, 'user': u'fd45d7605c4a4e90b7ce236773c0ed75', 'service_catalog': [{u'endpoints': [{u'adminURL': u'http://192.168.122.239:8776/v2/d1c5aa58af6c426492c642eb649017be', u'region': u'RegionOne', u'internalURL': u'http://192.168.122.239:8776/v2/d1c5aa58af6c426492c642eb649017be', u'publicURL': u'http://192.168.122.239:8776/v2/d1c5aa58af6c426492c642eb649017be'}], u'type': u'volumev2', u'name': u'cinderv2'}, {u'endpoints': [{u'adminURL': u'http://192.168.122.239:8776/v1/d1c5aa58af6c426492c642eb649017be', u'region': u'RegionOne', u'internalURL': u'http://192.168.122.239:8776/v1/d1c5aa58af6c426492c642eb649017be', u'publicURL': u'http://192.168.122.239:8776/v1/d1c5aa58af6c426492c642eb649017be'}], u'type': u'volume', u'name': u'cinder'}], 'tenant': u'd1c5aa58af6c426492c642eb649017be', 'read_only': False, 'project_id': u'd1c5aa58af6c426492c642eb649017be', 'user_id': u'fd45d7605c4a4e90b7ce236773c0ed75', 'show_deleted': False, 'roles': [u'anotherrole'], 'user_identity': 'fd45d7605c4a4e90b7ce236773c0ed75 d1c5aa58af6c426492c642eb649017be - - -', 'read_deleted': 'no', 'request_id': 'req-fb5fea1d-d7d9-497c-8d08-bbd21215ea3f', 'instance_lock_checked': False, 'user_domain': None, 'user_name': u'alt_demo'} enforce /opt/stack/nova/nova/policy.py:104\n\n", 
            "date_created": "2016-02-05 11:19:11.228023+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "it's weird .... I changed to \n\"os_compute_api:servers:delete\": \"is_admin:True\",\n\nthen with demo user , I can't delete the instance, seems policy enforce code is correct on this side", 
            "date_created": "2016-02-05 12:14:22.283352+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "confirmed this is not novaclient issue\n\njichen@devstack1:~$ export OS_USERNAME=alt_demo\njichen@devstack1:~$ keystone token-get\n+-----------+----------------------------------+\n|  Property |              Value               |\n+-----------+----------------------------------+\n|  expires  |       2016-02-05T13:36:26Z       |\n|     id    | a1f32eff6ba0404186273510a848cf1b |\n| tenant_id | d1c5aa58af6c426492c642eb649017be |\n|  user_id  | fd45d7605c4a4e90b7ce236773c0ed75 |\n+-----------+----------------------------------+\n\n\njichen@devstack1:~$ curl -g -i -X DELETE http://192.168.122.239:8774/v2/d1c5aa58af6c426492c642eb649017be/servers/ac3b44ec-d576-4edf-8203-50eadd2ca385 -H \"User-Agent: python-novaclient\" -H \"Accept: application/json\" -H \"X-OpenStack-Nova-API-Version: 2.6\" -H \"X-Auth-Token: a1f32eff6ba0404186273510a848cf1b\"\nHTTP/1.1 403 Forbidden\nContent-Length: 95\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-44541e26-f3fb-480f-9f32-02cafd43ccf5\nDate: Fri, 05 Feb 2016 12:37:13 GMT\n\n{\"forbidden\": {\"message\": \"Policy doesn't allow compute:delete to be performed.\", \"code\": 403}}jichen@devstack1:~$\njichen@devstack1:~$ curl -g -i -X DELETE http://192.168.122.239:8774/v2.1/d1c5aa58af6c426492c642eb649017be/servers/ac3b44ec-d576-4edf-8203-50eadd2ca385 -H \"User-Agent: python-novaclient\" -H \"Accept: application/json\" -H \"X-OpenStack-Nova-API-Version: 2.6\" -H \"X-Auth-Token: a1f32eff6ba0404186273510a848cf1b\"\nHTTP/1.1 204 No Content\nContent-Length: 0\nContent-Type: application/json\nX-Openstack-Nova-Api-Version: 2.6\nVary: X-OpenStack-Nova-API-Version\nX-Compute-Request-Id: req-32583396-07f3-4492-95ef-842f55bc4d5d\nDate: Fri, 05 Feb 2016 12:37:22 GMT", 
            "date_created": "2016-02-05 12:38:21.984281+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/276738", 
            "date_created": "2016-02-05 13:47:29.951817+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "tried some commands with following changes in policy.json\n\n\"userallow\": \"user_id:%(user_id)s\",\n\n\"compute:get\": \"rule:userallow\",\n \"compute:pause\": \"rule:userallow\",\n \"compute:unpause\": \"rule:userallow\",\n\n    \"os_compute_api:servers:show\": \"rule:userallow\",\n    \"compute_extension:admin_actions:pause\": \"rule:admin_or_owner\",\n    \"compute_extension:admin_actions:unpause\": \"rule:admin_or_owner\",\n\n\npause /unpause can only be executed by owner or admin by default in v2.1\n\n\n\njichen@devstack1:~$ nova --service-type compute_legacy --os-user-name alt_demo --os-project-name demo show ji1\nERROR (Forbidden): Policy doesn't allow compute:get to be performed. (HTTP 403) (Request-ID: req-1c93cd00-1df8-4722-b10f-9fed29536fb6)\n\njichen@devstack1:~$ nova --service-type compute --os-user-name alt_demo --os-project-name demo show ji1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-STS:power_state               | 3                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n\n\n\njichen@devstack1:~$ nova --service-type compute --os-user-name alt_demo --os-project-name demo pause ji1\njichen@devstack1:~$\n\njichen@devstack1:~$ nova --service-type compute_legacy --os-user-name alt_demo --os-project-name demo pause ji1\nERROR (Forbidden): Policy doesn't allow compute:get to be performed. (HTTP 403) (Request-ID: req-63e39575-af0d-4fac-8e43-4ec7e40fc117)\njichen@devstack1:~$\n", 
            "date_created": "2016-02-08 11:18:53.462156+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "so a few actions related to in servers should be checked and fixed , will dig more with other objects", 
            "date_created": "2016-02-08 11:19:19.712747+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/277433", 
            "date_created": "2016-02-08 14:56:08.626011+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/277500", 
            "date_created": "2016-02-08 17:13:35.943735+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/277572", 
            "date_created": "2016-02-08 21:34:04.399284+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/277797", 
            "date_created": "2016-02-09 11:41:15.463839+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by jichenjc (<email address hidden>) on branch: master\nReview: https://review.openstack.org/276738", 
            "date_created": "2016-02-11 08:20:36.699876+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by jichenjc (<email address hidden>) on branch: master\nReview: https://review.openstack.org/277433", 
            "date_created": "2016-02-11 08:20:59.381215+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by jichenjc (<email address hidden>) on branch: master\nReview: https://review.openstack.org/277500", 
            "date_created": "2016-02-11 08:21:18.316080+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by jichenjc (<email address hidden>) on branch: master\nReview: https://review.openstack.org/277572", 
            "date_created": "2016-02-11 08:21:32.113808+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by jichenjc (<email address hidden>) on branch: master\nReview: https://review.openstack.org/277797", 
            "date_created": "2016-02-11 08:21:54.421633+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I think we have now decided the old behavior was never intended, and will not be supported in Nova moving forward. Permission restriction should be by project_id. ", 
            "date_created": "2016-02-12 11:57:53.370977+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Dears,\n\nThis type of permission restriction is really useful. Is there a way to continue to support it?\n\nCheers,\n\nJerome Pansanel", 
            "date_created": "2016-05-02 20:38:22.118575+00:00", 
            "author": "https://api.launchpad.net/1.0/~pansanel"
        }, 
        {
            "content": "Hi Sean,\n\nI do see several use cases where this is useful, what has motivated this decision?", 
            "date_created": "2016-05-03 07:50:10.768235+00:00", 
            "author": "https://api.launchpad.net/1.0/~aloga"
        }, 
        {
            "content": "Hello,\n\nI also think having 2 separate levels where permission restrictions can be enforced is not only helpful, but the only way to stay sane when you have a lot of users / groups.\n\nYou'd have to create one tenant per user if you want to emulate the old behaviour, completely negating the usefulness of the tenant concept.\n\nMy vote is that this new 'feature' is a regression. The fact that it was not intended does not invalidate the fact that you are now removing something that was useful & also actually used...", 
            "date_created": "2016-05-03 08:04:44.536490+00:00", 
            "author": "https://api.launchpad.net/1.0/~vincent-legoll"
        }, 
        {
            "content": "This also silently introduce security problems without even warning about the new behaviour.\n\nPlease at least add a fat warning when you parse a rule that will be ignored in policy.json", 
            "date_created": "2016-05-03 08:07:13.067910+00:00", 
            "author": "https://api.launchpad.net/1.0/~vincent-legoll"
        }, 
        {
            "content": "@sdague: re your #17 comment, could you give us a pointer to the discussion where this subject was discussed, thanks.", 
            "date_created": "2016-05-03 11:26:26.405034+00:00", 
            "author": "https://api.launchpad.net/1.0/~vincent-legoll"
        }, 
        {
            "content": "@vincent-legoll jichenjc added some pointers to the patch comments :\n\nhttp://lists.openstack.org/pipermail/openstack-dev/2016-February/085877.html\nhttp://lists.openstack.org/pipermail/openstack-dev/2016-February/086118.html\nhttp://eavesdrop.openstack.org/meetings/nova_api/2016/nova_api.2016-02-09-12.08.html", 
            "date_created": "2016-05-03 11:47:01.253080+00:00", 
            "author": "https://api.launchpad.net/1.0/~g4-u3uxtu-lr"
        }, 
        {
            "content": "yeah,  I talked to john in IRC again after that, (maybe I remember wrong due to a few month ago) , but at that time he mentioned it's something that is supposed to be done by keystone and there's an idea about policy discovery which means let keystone decide whther the user is eligible to perform the action ,so it's very unlikely nova will take this work \nhttp://lists.openstack.org/pipermail/openstack-dev/2016-February/086118.html is something that more helpful on the conclusion of this issue\n\nand FYI, there are some policy related spec \nhttps://review.openstack.org/#/c/289405/\nhttps://review.openstack.org/#/c/290155/\nare the spec related to policy in Newton cycle and well discussed in summit (I didn't attend but I guess so)\n", 
            "date_created": "2016-05-03 12:30:40.627916+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "I remove my self as it's a won't fix issue", 
            "date_created": "2016-05-03 12:31:16.040021+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "To be honest, I think this should be fixed. OpenStack has completely removed the possibility for an operator to implement authorization to do some operations based on the user_id of the target instance.\n\nFirst of all, this changes the behavior with the previous version of the API, and it the behavioral change was completely undocumented. Sites relying on it now find their policy complelety broken.\n\nSecondly, IMO operators should have a way to define how they want their clouds to be accessed and managed and OpenStack should not impose a concrete usage model, assuming that this model will fit everybody. Why have we assumed that in every single case  the resources are owned by the tenant? IMO this is a simplistic approach, and I do see several use cases where this is particular AuthZ granularity is needed and required.\n\nThe policy discoverability (https://review.openstack.org/#/c/289405/) and the embedded defaults (https://review.openstack.org/#/c/290155/) are useful, but if we have removed the user-based permission restriction they are useless in the context of this bug.", 
            "date_created": "2016-05-05 13:27:29.265475+00:00", 
            "author": "https://api.launchpad.net/1.0/~aloga"
        }, 
        {
            "content": "Not to mention that the documentation is not coherent with the functionality, for instance http://docs.openstack.org/mitaka/config-reference/policy-json-file.html#examples states the following:\n\n    Rules can compare API attributes to object attributes. For example:\n        \"compute:start\" : \"user_id:%(user_id)s\"\n\n", 
            "date_created": "2016-05-05 13:41:33.332873+00:00", 
            "author": "https://api.launchpad.net/1.0/~aloga"
        }, 
        {
            "content": "We use the user id policy feature in several large projects at CERN. The typical case is a set of developers (more than 150) who are working for a single team and need the abilities to reboot/restart their own machines. The project admins provide 2nd level support. I believe that the changes described above will break this functionality.\n\nI would propose that until the equivalent function is available in Keystone, this functionality in Nova be retained. Equally, changes such as this in the security area need to be handled very sensitively with the user communities who depend on these functions.\n\n", 
            "date_created": "2016-05-20 10:54:18.187595+00:00", 
            "author": "https://api.launchpad.net/1.0/~tim-bell"
        }, 
        {
            "content": "@sdague: or any other member of upstream openstack, care to enlighten us on the solution to this problem ? Or a pointer to the official decision about that matter.", 
            "date_created": "2016-05-20 11:25:55.457695+00:00", 
            "author": "https://api.launchpad.net/1.0/~vincent-legoll"
        }, 
        {
            "content": "At EMBL-EBI we are intending to federate our Openstack Liberty Cloud with EGI, and need to implement granular user-based permissions within projects to achieve this. We also have demand within teams internally for this functionality.", 
            "date_created": "2016-05-20 13:20:26.957771+00:00", 
            "author": "https://api.launchpad.net/1.0/~cems"
        }, 
        {
            "content": "So the problem here is our API semantics are such that it assumes all the filters in by project, the list instances, etc.\n\nA user could lock their server to stop other users in the project being able to do things like snapshot or delete it.\n\nFor billing you can group projects into nested projects, and extra data at a different level.\n\nI think it was previous assumed you would have a project of shared VMs, and dedicated projects for each user for their own VMs, with billing aggregation to group those as a single billing entity.\n\nIs there a use case we are missing here, or things that don't make the above practical?", 
            "date_created": "2016-05-25 15:07:29.222580+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "The comment #28 of Tim seems a good use case for me.\n\nIt is easy to handle the use case at a single config of policy.json without another user operation if supporting user-id auth.\n\nIn general(I feel), developers tend to name virtual machines temporary with some common names like \"dev\", \"test\", \"foo\" or something. and it is easy to duplicate names between users. Then it would be easy to mis-delete different user's machine in the situation Tim said(150 developers in a single tenant). And the other developer gets angry.. So I am not against having the user-id policy for the use case.", 
            "date_created": "2016-05-26 20:01:07.512723+00:00", 
            "author": "https://api.launchpad.net/1.0/~oomichi"
        }, 
        {
            "content": "For more details please see this spec:\nhttps://review.openstack.org/#/c/324068/", 
            "date_created": "2016-06-10 08:57:00.542037+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }
    ]
}