{
    "status": "Fix Released", 
    "last_updated": "2015-02-12 02:30:27.583314+00:00", 
    "description": "'nova resize-revert' does not handle the deleted flavor,\nand an exception happens in the case.\n\n* How to reproduce the problem on DevStack:\n\u00a0\u00a0$ nova flavor-create sample 10 512 0 2\n\u00a0\u00a0$ nova boot --image cirros-0.3.0-x86_64-uec --flavor sample test01\n\u00a0\u00a0$ nova resize test01 m1.tiny\n\u00a0\u00a0$ nova flavor-delete 10\n\u00a0\u00a0$ nova resize-revert test01\n\u00a0\u00a0ERROR: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400) (Request-ID: req-b0d3e016-9608-4a87-a0cc-44dfe00b25a1)\n\u00a0\u00a0$\n\nI feel it is better that 'nova resize-revert' prints a error reason like\n\"Previous flavor could not be found\".\n\n* The contents of nova.log\n---\n2012-12-15 01:10:07 22693 ERROR nova.manager [-] Error during ComputeManager.update_available_resource: Instance type 6 could not be found.\n2012-12-15 01:10:07 22693 TRACE nova.manager Traceback (most recent call last):\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/manager.py\", line 175, in periodic_tasks\n2012-12-15 01:10:07 22693 TRACE nova.manager     task(self, context)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/manager.py\", line 3257, in update_available_resource2012-12-15 01:10:07 22693 TRACE nova.manager     rt.update_available_resource(context)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 228, in inner\n2012-12-15 01:10:07 22693 TRACE nova.manager     retval = f(*args, **kwargs)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 269, in update_available_resource\n2012-12-15 01:10:07 22693 TRACE nova.manager     self._update_usage_from_migrations(resources, migrations)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 452, in _update_usage_from_migrations\n2012-12-15 01:10:07 22693 TRACE nova.manager     self._update_usage_from_migration(resources, migration)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 416, in _update_usage_from_migration\n2012-12-15 01:10:07 22693 TRACE nova.manager     instance_type = instance_types.get_instance_type(itype)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/instance_types.py\", line 157, in get_instance_type\n2012-12-15 01:10:07 22693 TRACE nova.manager     return db.instance_type_get(ctxt, instance_type_id)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/api.py\", line 1271, in instance_type_get\n2012-12-15 01:10:07 22693 TRACE nova.manager     return IMPL.instance_type_get(context, id)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 127, in wrapper\n2012-12-15 01:10:07 22693 TRACE nova.manager     return f(*args, **kwargs)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 3641, in instance_type_get\n2012-12-15 01:10:07 22693 TRACE nova.manager     raise exception.InstanceTypeNotFound(instance_type_id=id)\n2012-12-15 01:10:07 22693 TRACE nova.manager InstanceTypeNotFound: Instance type 6 could not be found.\n2012-12-15 01:10:07 22693 TRACE nova.manager\n[..]\n2012-12-15 01:11:31 22693 AUDIT nova.compute.resource_tracker [-] Updating from migration 58d2088e-a771-4cd0-9964-8d83ce260dc3\n2012-12-15 01:11:31 22693 ERROR nova.manager [-] Error during ComputeManager.update_available_resource: Instance type 6 could not be found.\n2012-12-15 01:11:31 22693 TRACE nova.manager Traceback (most recent call last):\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/manager.py\", line 175, in periodic_tasks\n2012-12-15 01:11:31 22693 TRACE nova.manager     task(self, context)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/manager.py\", line 3257, in update_available_resource\n2012-12-15 01:11:31 22693 TRACE nova.manager     rt.update_available_resource(context)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 228, in inner\n2012-12-15 01:11:31 22693 TRACE nova.manager     retval = f(*args, **kwargs)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 269, in update_available_resource\n2012-12-15 01:11:31 22693 TRACE nova.manager     self._update_usage_from_migrations(resources, migrations)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 452, in _update_usage_from_migrations\n2012-12-15 01:11:31 22693 TRACE nova.manager     self._update_usage_from_migration(resources, migration)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 416, in _update_usage_from_migration\n2012-12-15 01:11:31 22693 TRACE nova.manager     instance_type = instance_types.get_instance_type(itype)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/instance_types.py\", line 157, in get_instance_type\n2012-12-15 01:11:31 22693 TRACE nova.manager     return db.instance_type_get(ctxt, instance_type_id)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/api.py\", line 1271, in instance_type_get\n2012-12-15 01:11:31 22693 TRACE nova.manager     return IMPL.instance_type_get(context, id)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 127, in wrapper\n2012-12-15 01:11:31 22693 TRACE nova.manager     return f(*args, **kwargs)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 3641, in instance_type_get\n2012-12-15 01:11:31 22693 TRACE nova.manager     raise exception.InstanceTypeNotFound(instance_type_id=id)\n2012-12-15 01:11:31 22693 TRACE nova.manager InstanceTypeNotFound: Instance type 6 could not be found.\n2012-12-15 01:11:31 22693 TRACE nova.manager", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1091490", 
    "owner": "https://api.launchpad.net/1.0/~oomichi", 
    "id": 1091490, 
    "index": 3270, 
    "created": "2012-12-18 00:54:55.932545+00:00", 
    "title": "'nova resize-revert' does not handle the deleted flavor", 
    "comments": [
        {
            "content": "'nova resize-revert' does not handle the deleted flavor,\nand an exception happens in the case.\n\n* How to reproduce the problem on DevStack:\n  $ nova flavor-create sample 10 512 0 2\n  $ nova boot --image cirros-0.3.0-x86_64-uec --flavor sample test01\n  $ nova resize test01 m1.tiny\n  $ nova flavor-delete 10\n  $ nova resize-revert test01\n  ERROR: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400) (Request-ID: req-b0d3e016-9608-4a87-a0cc-44dfe00b25a1)\n  $\n\n* The contents of nova.log\n---\n2012-12-15 01:10:07 22693 ERROR nova.manager [-] Error during ComputeManager.update_available_resource: Instance type 6 could not be found.\n2012-12-15 01:10:07 22693 TRACE nova.manager Traceback (most recent call last):\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/manager.py\", line 175, in periodic_tasks\n2012-12-15 01:10:07 22693 TRACE nova.manager     task(self, context)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/manager.py\", line 3257, in update_available_resource2012-12-15 01:10:07 22693 TRACE nova.manager     rt.update_available_resource(context)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 228, in inner\n2012-12-15 01:10:07 22693 TRACE nova.manager     retval = f(*args, **kwargs)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 269, in update_available_resource\n2012-12-15 01:10:07 22693 TRACE nova.manager     self._update_usage_from_migrations(resources, migrations)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 452, in _update_usage_from_migrations\n2012-12-15 01:10:07 22693 TRACE nova.manager     self._update_usage_from_migration(resources, migration)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 416, in _update_usage_from_migration\n2012-12-15 01:10:07 22693 TRACE nova.manager     instance_type = instance_types.get_instance_type(itype)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/instance_types.py\", line 157, in get_instance_type\n2012-12-15 01:10:07 22693 TRACE nova.manager     return db.instance_type_get(ctxt, instance_type_id)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/api.py\", line 1271, in instance_type_get\n2012-12-15 01:10:07 22693 TRACE nova.manager     return IMPL.instance_type_get(context, id)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 127, in wrapper\n2012-12-15 01:10:07 22693 TRACE nova.manager     return f(*args, **kwargs)\n2012-12-15 01:10:07 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 3641, in instance_type_get\n2012-12-15 01:10:07 22693 TRACE nova.manager     raise exception.InstanceTypeNotFound(instance_type_id=id)\n2012-12-15 01:10:07 22693 TRACE nova.manager InstanceTypeNotFound: Instance type 6 could not be found.\n2012-12-15 01:10:07 22693 TRACE nova.manager \n[..]\n2012-12-15 01:11:31 22693 AUDIT nova.compute.resource_tracker [-] Updating from migration 58d2088e-a771-4cd0-9964-8d83ce260dc3\n2012-12-15 01:11:31 22693 ERROR nova.manager [-] Error during ComputeManager.update_available_resource: Instance type 6 could not be found.\n2012-12-15 01:11:31 22693 TRACE nova.manager Traceback (most recent call last):\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/manager.py\", line 175, in periodic_tasks\n2012-12-15 01:11:31 22693 TRACE nova.manager     task(self, context)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/manager.py\", line 3257, in update_available_resource\n2012-12-15 01:11:31 22693 TRACE nova.manager     rt.update_available_resource(context)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 228, in inner\n2012-12-15 01:11:31 22693 TRACE nova.manager     retval = f(*args, **kwargs)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 269, in update_available_resource\n2012-12-15 01:11:31 22693 TRACE nova.manager     self._update_usage_from_migrations(resources, migrations)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 452, in _update_usage_from_migrations\n2012-12-15 01:11:31 22693 TRACE nova.manager     self._update_usage_from_migration(resources, migration)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 416, in _update_usage_from_migration\n2012-12-15 01:11:31 22693 TRACE nova.manager     instance_type = instance_types.get_instance_type(itype)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/compute/instance_types.py\", line 157, in get_instance_type\n2012-12-15 01:11:31 22693 TRACE nova.manager     return db.instance_type_get(ctxt, instance_type_id)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/api.py\", line 1271, in instance_type_get\n2012-12-15 01:11:31 22693 TRACE nova.manager     return IMPL.instance_type_get(context, id)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 127, in wrapper\n2012-12-15 01:11:31 22693 TRACE nova.manager     return f(*args, **kwargs)\n2012-12-15 01:11:31 22693 TRACE nova.manager   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 3641, in instance_type_get\n2012-12-15 01:11:31 22693 TRACE nova.manager     raise exception.InstanceTypeNotFound(instance_type_id=id)\n2012-12-15 01:11:31 22693 TRACE nova.manager InstanceTypeNotFound: Instance type 6 could not be found.\n2012-12-15 01:11:31 22693 TRACE nova.manager", 
            "date_created": "2012-12-18 00:54:55.932545+00:00", 
            "author": "https://api.launchpad.net/1.0/~oomichi"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/18284", 
            "date_created": "2012-12-18 01:29:53.674603+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/18284\nCommitted: http://github.com/openstack/nova/commit/4e02fa1964f5de3a6ba345d858623f35b24beafd\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4e02fa1964f5de3a6ba345d858623f35b24beafd\nAuthor: Ken'ichi Ohmichi <email address hidden>\nDate:   Tue Jan 8 05:08:17 2013 +0900\n\n    Add exception handler for previous deleted flavor.\n    \n    An exception happens if a previous flavor is deleted and\n    'nova resize-revert' run, because 'nova resize-revert' does\n    not handle the deleted flavor.\n    And also we have the same problem in _update_usage_from_migration().\n    This patch fixes the problems.\n    \n    How to reproduce the problem on DevStack:\n      $ nova flavor-create sample 10 512 0 2\n      $ nova boot --image cirros-0.3.0-x86_64-uec --flavor sample test01\n      $ nova resize test01 m1.tiny\n      $ nova flavor-delete 10\n      $ nova resize-revert test01\n    \n    Before applying this patch:\n      $ nova resize-revert test01\n      ERROR: The server could not comply with the request since it is\n      either malformed or otherwise incorrect. (HTTP 400) (Request-ID:\n      req-b0d3e016-9608-4a87-a0cc-44dfe00b25a1)\n      $\n    \n    After applying this patch:\n      $ nova resize-revert test01\n      ERROR: Flavor used by the instance could not be found. (HTTP 400)\n      (Request-ID: req-ed4ce174-33f2-4258-b522-674a1023ea74)\n      $\n    \n    Fixes bug 1091490\n    \n    Change-Id: I39dd23a7565ae66544e8bc2aa7ad3299eb61bfcc\n", 
            "date_created": "2013-01-08 19:45:04.812390+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "https://review.openstack.org/18284\ncan fixed this bug ?\n\ncatch 'InstanceTypeNotFound' exception in  '_action_revert_resize' , but can't revert instance", 
            "date_created": "2015-02-12 02:30:26.349555+00:00", 
            "author": "https://api.launchpad.net/1.0/~mingb1989"
        }
    ]
}