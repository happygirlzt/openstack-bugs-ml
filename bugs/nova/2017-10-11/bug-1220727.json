{
    "status": "Fix Released", 
    "last_updated": "2014-03-30 22:51:42.672711+00:00", 
    "description": "If a normal user created a fixed_ip/floating_ip, a usage record with column `in_use=1` will be created in the quota_usages table, and if an admin user deleted the resource, a new record with column `in_use=-1` will be created..\n\nReproduce:\n# keystone tenant-list\n| 21f7a02dbfd94979b83b3b551c78e380 |        admin        |   True  |\n| 846576498dc24660943784e25e2b5b1a |         test        |   True  |\n# keystone user-list --tenant-id 846576498dc24660943784e25e2b5b1a\n| 6a120d1a6034481fa7e905d422dceb76 |  test  |   True  |  <email address hidden>  |\n\n1. create an instance with user 'test', the quota_usages table should be like this:\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n| created_at          | updated_at          | deleted_at | id | project_id                       | resource  | in_use | reserved | until_refresh | deleted | user_id                          |\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 30 | 846576498dc24660943784e25e2b5b1a | instances |      1 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 31 | 846576498dc24660943784e25e2b5b1a | ram       |    512 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 32 | 846576498dc24660943784e25e2b5b1a | cores     |      1 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:31:51 | 2013-09-04 13:31:51 | NULL       | 33 | 846576498dc24660943784e25e2b5b1a | fixed_ips |      1 |        0 |          NULL |       0 | NULL                             |\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n\n2. delete the instance by user 'admin', following is the new table, which is obviously a bug:\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n| created_at          | updated_at          | deleted_at | id | project_id                       | resource  | in_use | reserved | until_refresh | deleted | user_id                          |\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 30 | 846576498dc24660943784e25e2b5b1a | instances |      0 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 31 | 846576498dc24660943784e25e2b5b1a | ram       |    0 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 32 | 846576498dc24660943784e25e2b5b1a | cores     |      0 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:31:51 | 2013-09-04 13:31:51 | NULL       | 33 | 846576498dc24660943784e25e2b5b1a | fixed_ips |      1 |        0 |          NULL |       0 | NULL                             |\n| 2013-09-04 13:42:45 | 2013-09-04 13:42:45 | NULL       | 34 | 21f7a02dbfd94979b83b3b551c78e380 | fixed_ips |      -1 |        0 |          NULL |       0 | NULL                             |\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+", 
    "tags": [], 
    "importance": "High", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1220727", 
    "owner": "https://api.launchpad.net/1.0/~liyingjun", 
    "id": 1220727, 
    "index": 1207, 
    "created": "2013-09-04 13:46:55.720418+00:00", 
    "title": "Inconsistent usage data for fixed_ip and floating_ip", 
    "comments": [
        {
            "content": "If a normal user created a fixed_ip/floating_ip, a usage record with column `in_use=1` will be created in the quota_usages table, and if an admin user deleted the resource, a new record with column `in_use=-1` will be created..\n\nReproduce:\n# keystone tenant-list\n| 21f7a02dbfd94979b83b3b551c78e380 |        admin        |   True  |\n| 846576498dc24660943784e25e2b5b1a |         test        |   True  |\n# keystone user-list --tenant-id 846576498dc24660943784e25e2b5b1a\n| 6a120d1a6034481fa7e905d422dceb76 |  test  |   True  |  <email address hidden>  |\n\n1. create an instance with user 'test', the quota_usages table should be like this:\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n| created_at          | updated_at          | deleted_at | id | project_id                       | resource  | in_use | reserved | until_refresh | deleted | user_id                          |\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 30 | 846576498dc24660943784e25e2b5b1a | instances |      1 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 31 | 846576498dc24660943784e25e2b5b1a | ram       |    512 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 32 | 846576498dc24660943784e25e2b5b1a | cores     |      1 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:31:51 | 2013-09-04 13:31:51 | NULL       | 33 | 846576498dc24660943784e25e2b5b1a | fixed_ips |      1 |        0 |          NULL |       0 | NULL                             |\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n\n2. delete the instance by user 'admin', following is the new table, which is obviously a bug:\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n| created_at          | updated_at          | deleted_at | id | project_id                       | resource  | in_use | reserved | until_refresh | deleted | user_id                          |\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 30 | 846576498dc24660943784e25e2b5b1a | instances |      0 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 31 | 846576498dc24660943784e25e2b5b1a | ram       |    0 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:27:37 | 2013-09-04 13:31:49 | NULL       | 32 | 846576498dc24660943784e25e2b5b1a | cores     |      0 |        0 |          NULL |       0 | 6a120d1a6034481fa7e905d422dceb76 |\n| 2013-09-04 13:31:51 | 2013-09-04 13:31:51 | NULL       | 33 | 846576498dc24660943784e25e2b5b1a | fixed_ips |      1 |        0 |          NULL |       0 | NULL                             |\n| 2013-09-04 13:42:45 | 2013-09-04 13:42:45 | NULL       | 34 | 21f7a02dbfd94979b83b3b551c78e380 | fixed_ips |      -1 |        0 |          NULL |       0 | NULL                             |\n+---------------------+---------------------+------------+----+----------------------------------+-----------+--------+----------+---------------+---------+----------------------------------+", 
            "date_created": "2013-09-04 13:46:55.720418+00:00", 
            "author": "https://api.launchpad.net/1.0/~liyingjun"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/43583\nCommitted: http://github.com/openstack/nova/commit/f2dfdd4ab37965a6559f3c033cdf877e0fe172be\nSubmitter: Jenkins\nBranch:    master\n\ncommit f2dfdd4ab37965a6559f3c033cdf877e0fe172be\nAuthor: liyingjun <email address hidden>\nDate:   Sat Aug 24 22:02:29 2013 +0800\n\n    Fix inconsistent usages for network resources\n    \n    If a normal user created a fixed_ip/floating_ip, a usage record with\n    column `in_use=1` will be created in the quota_usages table, and if an\n    admin user deleted the resource, a new record with column `in_use=-1`\n    will be created..This will cause the quota for the resources not\n    released.\n    \n    Fixes bug 1220727\n    \n    Change-Id: I705f2f9ef327a3198da6a47df772c3a1a28e1b4e\n", 
            "date_created": "2013-09-09 15:03:10.000553+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/53061", 
            "date_created": "2013-10-22 06:49:14.652324+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}