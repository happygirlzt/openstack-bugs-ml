{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:11:59.783112+00:00", 
    "description": "+--------------------------------------+-------+-------------+\n| ID                                   | Label | CIDR        |\n+--------------------------------------+-------+-------------+\n| be95de64-a2aa-42de-a522-37802cdbe133 | vmnet | 10.0.0.0/24 |\n| 0fd904f5-1870-4066-8213-94038b49be2e | abc   | 10.1.0.0/24 |\n| 7cd88ead-fd42-4441-9182-72b3164c108d | abd   | 10.2.0.0/24 |\n+--------------------------------------+-------+-------------+\n\nnova  add-fixed-ip test15 0fd904f5-1870-4066-8213-94038b49be2e\n\nfailed with following logs\n\n\n2014-03-19 03:29:30.546 7822 ERROR nova.openstack.common.rpc.amqp [req-fd087223-3646-4fed-b0f6-5a5cf50828eb d6779a827003465db2d3c52fe135d926 45210fba73d24dd681dc5c292c6b1e7f] Exception during message handling\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     **args)\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 772, in add_fixed_ip_to_instance\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     self._allocate_fixed_ips(context, instance_id, host, [network])\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 214, in _allocate_fixed_ips\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     vpn=vpn, address=address)\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 881, in allocate_fixed_ip\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     self.quotas.rollback(context, reservations)\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 859, in allocate_fixed_ip\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     'virtual_interface_id': vif['id']}\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp TypeError: 'NoneType' object is unsubscriptable\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [
        "in-stable-juno", 
        "nova-network"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1294939", 
    "owner": "https://api.launchpad.net/1.0/~jichenjc", 
    "id": 1294939, 
    "index": 3842, 
    "created": "2014-03-20 02:33:34.956353+00:00", 
    "title": "Add a fixed IP to an instance failed", 
    "comments": [
        {
            "content": "+--------------------------------------+-------+-------------+\n| ID                                   | Label | CIDR        |\n+--------------------------------------+-------+-------------+\n| be95de64-a2aa-42de-a522-37802cdbe133 | vmnet | 10.0.0.0/24 |\n| 0fd904f5-1870-4066-8213-94038b49be2e | abc   | 10.1.0.0/24 |\n| 7cd88ead-fd42-4441-9182-72b3164c108d | abd   | 10.2.0.0/24 |\n+--------------------------------------+-------+-------------+\n\nnova  add-fixed-ip test15 0fd904f5-1870-4066-8213-94038b49be2e\n\nfailed with following logs\n\n\n2014-03-19 03:29:30.546 7822 ERROR nova.openstack.common.rpc.amqp [req-fd087223-3646-4fed-b0f6-5a5cf50828eb d6779a827003465db2d3c52fe135d926 45210fba73d24dd681dc5c292c6b1e7f] Exception during message handling\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     **args)\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 772, in add_fixed_ip_to_instance\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     self._allocate_fixed_ips(context, instance_id, host, [network])\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 214, in _allocate_fixed_ips\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     vpn=vpn, address=address)\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 881, in allocate_fixed_ip\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     self.quotas.rollback(context, reservations)\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 859, in allocate_fixed_ip\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp     'virtual_interface_id': vif['id']}\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp TypeError: 'NoneType' object is unsubscriptable\n2014-03-19 03:29:30.546 7822 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2014-03-20 02:33:34.956353+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "I am not using latest code (about 1-2 month) before \nbut I reviewed latest code and found same logic still exist\n\nroot cause is \n\ndef allocate_fixed_ip(self, context, instance_id, network, **kwargs):\n\ntry to get an vif but it's not created yet\n\nvif = vif_obj.VirtualInterface.get_by_instance_and_network(\n                        context, instance_id, network['id'])\n\nsince objects/virtual_interface.py may return a NULL point \n\n@base.remotable_classmethod\n    def get_by_instance_and_network(cls, context, instance_uuid, network_id):\n        db_vif = db.virtual_interface_get_by_instance_and_network(context,\n                instance_uuid, network_id)\n        if db_vif:\n            return cls._from_db_object(context, cls(), db_vif)", 
            "date_created": "2014-03-20 02:37:07.153582+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/82423", 
            "date_created": "2014-03-24 05:32:58.749534+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/82423\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e08ce4de920b68c84ac45be8a657a95113688780\nSubmitter: Jenkins\nBranch:    master\n\ncommit e08ce4de920b68c84ac45be8a657a95113688780\nAuthor: jichenjc <email address hidden>\nDate:   Sun Mar 23 01:49:56 2014 +0800\n\n    Add virtual interface before add fixed IP on nova-network\n    \n    nova allow user to add fixed IP to an instance when the instance\n    is running. This action will fail due to no virtual interface\n    will be created before create fixed ip.\n    TypeError: 'NoneType' object is unsubscriptable will be reported.\n    \n    Change-Id: I5885806d1965022816633d0105606e7aaf763b3a\n    Closes-Bug: #1294939\n", 
            "date_created": "2014-12-02 12:57:06.312948+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/142444", 
            "date_created": "2014-12-17 13:41:01.384801+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/142444\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=39097d36e447cdcf6fab2a28f356d381937f4a8b\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit 39097d36e447cdcf6fab2a28f356d381937f4a8b\nAuthor: jichenjc <email address hidden>\nDate:   Sun Mar 23 01:49:56 2014 +0800\n\n    Add virtual interface before add fixed IP on nova-network\n    \n    nova allow user to add fixed IP to an instance when the instance\n    is running. This action will fail due to no virtual interface\n    will be created before create fixed ip.\n    TypeError: 'NoneType' object is unsubscriptable will be reported.\n    \n    (cherry picked from commit e08ce4de920b68c84ac45be8a657a95113688780)\n    \n    Conflicts:\n    \tnova/tests/unit/network/test_manager.py (file was moved)\n    \n    Change-Id: I5885806d1965022816633d0105606e7aaf763b3a\n    Closes-Bug: #1294939\n", 
            "date_created": "2015-01-26 01:26:08.107584+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}