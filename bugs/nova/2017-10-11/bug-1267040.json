{
    "status": "Fix Released", 
    "last_updated": "2014-09-17 12:47:49.926585+00:00", 
    "description": "nova api support list deleted servers by using admin user. The api looks like below:\n\nv3: GET http://openstack.org:8774/v3/servers/detail?deleted=True\nv2: GET http://openstack.org:8774/v2/{tenant}/servers/detail?deleted=True\n\nv2 api works very well but v3 will return by 404.\n\nThe traceback from nova-api show below, I suspect there was something wrong with instance object:\n2014-01-08 09:42:15.145 ERROR nova.api.openstack [req-dd73dfe5-96ab-488a-8c31-98b5b063ed95 admin admin] Caught error: Instance 60ec98b5-7496-4e04-aebb-3f951e660295 could not be found.\n2014-01-08 09:42:15.145 TRACE nova.api.openstack Traceback (most recent call last):\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 121, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return req.get_response(self.application)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     application, catch_exc_info=False)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 581, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return self.app(env, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 930, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     content_type, body, accept)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1018, in _process_stack\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     request, action_args)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 900, in post_process_extensions\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     **action_args)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/plugins/v3/pci.py\", line 79, in detail\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     self._extend_server(server, instance)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/plugins/v3/pci.py\", line 58, in _extend_server\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     for dev in instance.pci_devices:\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 63, in getter\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     self.obj_load_attr(name)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/instance.py\", line 498, in obj_load_attr\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     expected_attrs=[attrname])\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 112, in wrapper\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     result = fn(cls, context, *args, **kwargs)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/instance.py\", line 300, in get_by_uuid\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     use_slave=use_slave)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/api.py\", line 634, in instance_get_by_uuid\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     columns_to_join, use_slave=use_slave)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return f(*args, **kwargs)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1693, in instance_get_by_uuid\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     columns_to_join=columns_to_join, use_slave=use_slave)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1705, in _instance_get_by_uuid\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     raise exception.InstanceNotFound(instance_id=uuid)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack InstanceNotFound: Instance 60ec98b5-7496-4e04-aebb-3f951e660295 could not be found.\n2014-01-08 09:42:15.145 TRACE nova.api.openstack \n2014-01-08 09:42:15.154 INFO nova.api.openstack [req-dd73dfe5-96ab-488a-8c31-98b5b063ed95 admin admin] http://10.160.163.21:8774/v3/servers/detail?deleted=True returned with HTTP 404", 
    "tags": [
        "api"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1267040", 
    "owner": "https://api.launchpad.net/1.0/~yevgen-runts", 
    "id": 1267040, 
    "index": 4448, 
    "created": "2014-01-08 09:47:09.617552+00:00", 
    "title": "v3 API list deleted servers raise 404", 
    "comments": [
        {
            "content": "nova api support list deleted servers by using admin user. The api looks like below:\n\nv3: GET http://openstack.org:8774/v3/servers/detail?deleted=True\nv2: GET http://openstack.org:8774/v2/{tenant}/servers/detail?deleted=True\n\nv2 api works very well but v3 will return by 404.\n\nThe traceback from nova-api show below, I suspect there was something wrong with instance object:\n2014-01-08 09:42:15.145 ERROR nova.api.openstack [req-dd73dfe5-96ab-488a-8c31-98b5b063ed95 admin admin] Caught error: Instance 60ec98b5-7496-4e04-aebb-3f951e660295 could not be found.\n2014-01-08 09:42:15.145 TRACE nova.api.openstack Traceback (most recent call last):\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 121, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return req.get_response(self.application)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     application, catch_exc_info=False)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 581, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return self.app(env, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 930, in __call__\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     content_type, body, accept)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1018, in _process_stack\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     request, action_args)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 900, in post_process_extensions\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     **action_args)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/plugins/v3/pci.py\", line 79, in detail\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     self._extend_server(server, instance)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/plugins/v3/pci.py\", line 58, in _extend_server\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     for dev in instance.pci_devices:\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 63, in getter\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     self.obj_load_attr(name)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/instance.py\", line 498, in obj_load_attr\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     expected_attrs=[attrname])\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 112, in wrapper\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     result = fn(cls, context, *args, **kwargs)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/instance.py\", line 300, in get_by_uuid\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     use_slave=use_slave)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/api.py\", line 634, in instance_get_by_uuid\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     columns_to_join, use_slave=use_slave)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     return f(*args, **kwargs)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1693, in instance_get_by_uuid\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     columns_to_join=columns_to_join, use_slave=use_slave)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1705, in _instance_get_by_uuid\n2014-01-08 09:42:15.145 TRACE nova.api.openstack     raise exception.InstanceNotFound(instance_id=uuid)\n2014-01-08 09:42:15.145 TRACE nova.api.openstack InstanceNotFound: Instance 60ec98b5-7496-4e04-aebb-3f951e660295 could not be found.\n2014-01-08 09:42:15.145 TRACE nova.api.openstack \n2014-01-08 09:42:15.154 INFO nova.api.openstack [req-dd73dfe5-96ab-488a-8c31-98b5b063ed95 admin admin] http://10.160.163.21:8774/v3/servers/detail?deleted=True returned with HTTP 404", 
            "date_created": "2014-01-08 09:47:09.617552+00:00", 
            "author": "https://api.launchpad.net/1.0/~gtt116"
        }, 
        {
            "content": "v2 and v3 are both using objects from what I can tell, the difference I see is in why pci is in the v3 traceback here, I'm not sure why that is showing up as part of this, I don't see the pci stuff in the v2 API, so maybe that's more where the bug is related.\n\nAre you able to show that instance using the novaclient?", 
            "date_created": "2014-01-10 21:44:10.173631+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "The novaclient result was pasted below. If I can provide more  information please let me know.\n\n$ nova list --deleted\n+--------------------------------------+------+---------+------------+-------------+------------------+\n| ID                                   | Name | Status  | Task State | Power State | Networks         |\n+--------------------------------------+------+---------+------------+-------------+------------------+\n| 60ec98b5-7496-4e04-aebb-3f951e660295 | vm1  | DELETED | None       | NOSTATE     | private=10.0.0.3 |\n| bd38f119-345d-47ca-9dc3-23a7c601be8b | vm1  | DELETED | deleting   | NOSTATE     |                  |\n+--------------------------------------+------+---------+------------+-------------+------------------+\n\n$ nova --os-compute-api-version 3 list --deleted\nERROR: The resource could not be found. (HTTP 404) (Request-ID: req-0830cb66-66e3-48ad-bd5a-2219210a1e2e)\nThe log of nova-api was reported above\n\n$ nova show 60ec98b5-7496-4e04-aebb-3f951e660295 \nERROR: No server with a name or ID of '60ec98b5-7496-4e04-aebb-3f951e660295' exists.\n\n$ nova show bd38f119-345d-47ca-9dc3-23a7c601be8b\nERROR: No server with a name or ID of 'bd38f119-345d-47ca-9dc3-23a7c601be8b' exists.", 
            "date_created": "2014-01-14 10:57:38.188204+00:00", 
            "author": "https://api.launchpad.net/1.0/~gtt116"
        }, 
        {
            "content": "Tiantian, I couldn't reproduce issue on my devstack environtment. \nNova client and http request for v2 and v3 works similar for me - returns expected result.\n\nCould you provide your steps to reproduce?\n\n\n", 
            "date_created": "2014-02-04 14:44:44.638595+00:00", 
            "author": "https://api.launchpad.net/1.0/~yevgen-runts"
        }, 
        {
            "content": "We fixed this in icehouse IIRC. It was an inner loop issue.", 
            "date_created": "2014-09-17 12:47:38.657035+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}