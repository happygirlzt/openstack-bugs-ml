{
    "status": "Expired", 
    "last_updated": "2016-07-05 09:55:50.816775+00:00", 
    "description": "With the reference implementation, there exists a problem when using 'nova-interface-attach' using 'net-id' parameter. The neutron port created for this operation does not inherit the instance's security-groups, but instead uses just the 'default' security-group. \n\nSteps to recreate:\n\n[root@osnode2 ~(keystone_admin)]# neutron net-list\n+--------------------------------------+---------+-----------------------------------------------------+\n| id                                   | name    | subnets                                             |\n+--------------------------------------+---------+-----------------------------------------------------+\n| e98cdc79-f385-498e-be99-5bf879f26741 | datanw  | 42d6b5a9-b415-41db-911e-89956df77852 192.168.0.0/24 |\n| 2b9cc6e2-e50d-494b-87cd-0520013f9cdb | public2 | 6987510e-495b-4d45-bba2-327f362a04a4 10.10.0.0/21   |\n+--------------------------------------+---------+-----------------------------------------------------+\n\n[root@osnode2 ~(keystone_admin)]# neutron  security-group-list\n+--------------------------------------+-----------+-------------+\n| id                                   | name      | description |\n+--------------------------------------+-----------+-------------+\n| 66a6bae9-2249-42f0-9c8e-fa058224adff | default   | default     |\n| 85ee063b-f688-45ad-b35c-a2f102943d32 | custom_sg | custom_sg   |\n+--------------------------------------+-----------+-------------+\n\n[root@osnode2 ~(keystone_admin)]# nova boot --flavor m1.tiny --image cirros --nic net-id=2b9cc6e2-e50d-494b-87cd-0520013f9cdb cirros_vm --security_groups custom_sg\n\n[root@osnode2 ~(keystone_admin)]# nova show cirros_vm\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                   |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| OS-EXT-SRV-ATTR:host                 | osnode2                                                  |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | osnode2                                                  |\n| OS-EXT-SRV-ATTR:instance_name        | instance-000000c5                                        |\n| OS-EXT-STS:power_state               | 1                                                        |\n| OS-EXT-STS:task_state                | -                                                        |\n| OS-EXT-STS:vm_state                  | active                                                   |\n| OS-SRV-USG:launched_at               | 2014-12-25T01:57:02.000000                               |\n| OS-SRV-USG:terminated_at             | -                                                        |\n| accessIPv4                           |                                                          |\n| accessIPv6                           |                                                          |\n| config_drive                         |                                                          |\n| created                              | 2014-12-25T01:56:51Z                                     |\n| flavor                               | m1.tiny (1)                                              |\n| hostId                               | 5b3db263e5f581e1e5141018ab5f81f1ab313bbd9514f9e64ee6d3d9 |\n| id                                   | d6221cd5-1e02-4759-9412-1f238b511667                     |\n| image                                | cirros (58dcb5ba-2882-4069-9f9a-be671f8f11c6)            |\n| key_name                             | -                                                        |\n| metadata                             | {}                                                       |\n| name                                 | cirros_vm                                                |\n| os-extended-volumes:volumes_attached | []                                                       |\n| progress                             | 0                                                        |\n| public2 network                      | 10.10.5.136                                              |\n| security_groups                      | custom_sg                                                |\n| status                               | ACTIVE                                                   |\n| tenant_id                            | f32c4fd3c6524d1da40762071934b583                         |\n| updated                              | 2014-12-25T01:57:02Z                                     |\n| user_id                              | 4ded56cb1d504a828a3bef0c74ea6d1d                         |\n+--------------------------------------+----------------------------------------------------------+\n\n[root@osnode2 ~(keystone_admin)]# neutron port-list\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                          |\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n| 39cd7f64-c7a7-45ad-9f98-c9da43672227 |      | fa:16:3e:72:04:dc | {\"subnet_id\": \"6987510e-495b-4d45-bba2-327f362a04a4\", \"ip_address\": \"10.10.5.136\"} |\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n\n\n[root@osnode2 ~(keystone_admin)]# nova interface-attach --net-id e98cdc79-f385-498e-be99-5bf879f26741 cirros_vm\n\n[root@osnode2 ~(keystone_admin)]# neutron port-list\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                          |\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n| 39cd7f64-c7a7-45ad-9f98-c9da43672227 |      | fa:16:3e:72:04:dc | {\"subnet_id\": \"6987510e-495b-4d45-bba2-327f362a04a4\", \"ip_address\": \"10.10.5.136\"} |\n| b9971da7-313f-4b0a-ba14-1f481fbdf723 |      | fa:16:3e:43:4b:28 | {\"subnet_id\": \"42d6b5a9-b415-41db-911e-89956df77852\", \"ip_address\": \"192.168.0.5\"} |\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n[root@osnode2 ~(keystone_admin)]# neutron port-show b9971da7-313f-4b0a-ba14-1f481fbdf723 \n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:host_id       | osnode2                                                                            |\n| binding:profile       | {}                                                                                 |\n| binding:vif_details   | {\"port_filter\": true, \"ovs_hybrid_plug\": true}                                     |\n| binding:vif_type      | ovs                                                                                |\n| binding:vnic_type     | normal                                                                             |\n| device_id             | d6221cd5-1e02-4759-9412-1f238b511667                                               |\n| device_owner          | compute:None                                                                       |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"42d6b5a9-b415-41db-911e-89956df77852\", \"ip_address\": \"192.168.0.5\"} |\n| id                    | b9971da7-313f-4b0a-ba14-1f481fbdf723                                               |\n| mac_address           | fa:16:3e:43:4b:28                                                                  |\n| name                  |                                                                                    |\n| network_id            | e98cdc79-f385-498e-be99-5bf879f26741                                               |\n| security_groups       | 66a6bae9-2249-42f0-9c8e-fa058224adff                                               |\n| status                | ACTIVE                                                                             |\n| tenant_id             | f32c4fd3c6524d1da40762071934b583                                                   |\n+-----------------------+------------------------------------------------------------------------------------+\n\nThe newly created port uses the 'default' security-group instead of the instance's security-group 'custom_sg'.", 
    "tags": [
        "network", 
        "neutron"
    ], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1406431", 
    "owner": "None", 
    "id": 1406431, 
    "index": 5350, 
    "created": "2014-12-30 01:12:41.783548+00:00", 
    "title": "neutron port security-group not properly updated on nova interface-attach", 
    "comments": [
        {
            "content": "With the reference implementation, there exists a problem when using 'nova-interface-attach' using 'net-id' parameter. The neutron port created for this operation does not inherit the instance's security-groups, but instead uses just the 'default' security-group. \n\nSteps to recreate:\n\n[root@osnode2 ~(keystone_admin)]# neutron net-list\n+--------------------------------------+---------+-----------------------------------------------------+\n| id                                   | name    | subnets                                             |\n+--------------------------------------+---------+-----------------------------------------------------+\n| e98cdc79-f385-498e-be99-5bf879f26741 | datanw  | 42d6b5a9-b415-41db-911e-89956df77852 192.168.0.0/24 |\n| 2b9cc6e2-e50d-494b-87cd-0520013f9cdb | public2 | 6987510e-495b-4d45-bba2-327f362a04a4 10.10.0.0/21   |\n+--------------------------------------+---------+-----------------------------------------------------+\n\n[root@osnode2 ~(keystone_admin)]# neutron  security-group-list\n+--------------------------------------+-----------+-------------+\n| id                                   | name      | description |\n+--------------------------------------+-----------+-------------+\n| 66a6bae9-2249-42f0-9c8e-fa058224adff | default   | default     |\n| 85ee063b-f688-45ad-b35c-a2f102943d32 | custom_sg | custom_sg   |\n+--------------------------------------+-----------+-------------+\n\n[root@osnode2 ~(keystone_admin)]# nova boot --flavor m1.tiny --image cirros --nic net-id=2b9cc6e2-e50d-494b-87cd-0520013f9cdb cirros_vm --security_groups custom_sg\n\n[root@osnode2 ~(keystone_admin)]# nova show cirros_vm\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                   |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| OS-EXT-SRV-ATTR:host                 | osnode2                                                  |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | osnode2                                                  |\n| OS-EXT-SRV-ATTR:instance_name        | instance-000000c5                                        |\n| OS-EXT-STS:power_state               | 1                                                        |\n| OS-EXT-STS:task_state                | -                                                        |\n| OS-EXT-STS:vm_state                  | active                                                   |\n| OS-SRV-USG:launched_at               | 2014-12-25T01:57:02.000000                               |\n| OS-SRV-USG:terminated_at             | -                                                        |\n| accessIPv4                           |                                                          |\n| accessIPv6                           |                                                          |\n| config_drive                         |                                                          |\n| created                              | 2014-12-25T01:56:51Z                                     |\n| flavor                               | m1.tiny (1)                                              |\n| hostId                               | 5b3db263e5f581e1e5141018ab5f81f1ab313bbd9514f9e64ee6d3d9 |\n| id                                   | d6221cd5-1e02-4759-9412-1f238b511667                     |\n| image                                | cirros (58dcb5ba-2882-4069-9f9a-be671f8f11c6)            |\n| key_name                             | -                                                        |\n| metadata                             | {}                                                       |\n| name                                 | cirros_vm                                                |\n| os-extended-volumes:volumes_attached | []                                                       |\n| progress                             | 0                                                        |\n| public2 network                      | 10.10.5.136                                              |\n| security_groups                      | custom_sg                                                |\n| status                               | ACTIVE                                                   |\n| tenant_id                            | f32c4fd3c6524d1da40762071934b583                         |\n| updated                              | 2014-12-25T01:57:02Z                                     |\n| user_id                              | 4ded56cb1d504a828a3bef0c74ea6d1d                         |\n+--------------------------------------+----------------------------------------------------------+\n\n[root@osnode2 ~(keystone_admin)]# neutron port-list\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                          |\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n| 39cd7f64-c7a7-45ad-9f98-c9da43672227 |      | fa:16:3e:72:04:dc | {\"subnet_id\": \"6987510e-495b-4d45-bba2-327f362a04a4\", \"ip_address\": \"10.10.5.136\"} |\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n\n\n[root@osnode2 ~(keystone_admin)]# nova interface-attach --net-id e98cdc79-f385-498e-be99-5bf879f26741 cirros_vm\n\n[root@osnode2 ~(keystone_admin)]# neutron port-list\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                          |\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n| 39cd7f64-c7a7-45ad-9f98-c9da43672227 |      | fa:16:3e:72:04:dc | {\"subnet_id\": \"6987510e-495b-4d45-bba2-327f362a04a4\", \"ip_address\": \"10.10.5.136\"} |\n| b9971da7-313f-4b0a-ba14-1f481fbdf723 |      | fa:16:3e:43:4b:28 | {\"subnet_id\": \"42d6b5a9-b415-41db-911e-89956df77852\", \"ip_address\": \"192.168.0.5\"} |\n+--------------------------------------+------+-------------------+------------------------------------------------------------------------------------+\n[root@osnode2 ~(keystone_admin)]# neutron port-show b9971da7-313f-4b0a-ba14-1f481fbdf723 \n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:host_id       | osnode2                                                                            |\n| binding:profile       | {}                                                                                 |\n| binding:vif_details   | {\"port_filter\": true, \"ovs_hybrid_plug\": true}                                     |\n| binding:vif_type      | ovs                                                                                |\n| binding:vnic_type     | normal                                                                             |\n| device_id             | d6221cd5-1e02-4759-9412-1f238b511667                                               |\n| device_owner          | compute:None                                                                       |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"42d6b5a9-b415-41db-911e-89956df77852\", \"ip_address\": \"192.168.0.5\"} |\n| id                    | b9971da7-313f-4b0a-ba14-1f481fbdf723                                               |\n| mac_address           | fa:16:3e:43:4b:28                                                                  |\n| name                  |                                                                                    |\n| network_id            | e98cdc79-f385-498e-be99-5bf879f26741                                               |\n| security_groups       | 66a6bae9-2249-42f0-9c8e-fa058224adff                                               |\n| status                | ACTIVE                                                                             |\n| tenant_id             | f32c4fd3c6524d1da40762071934b583                                                   |\n+-----------------------+------------------------------------------------------------------------------------+\n\nThe newly created port uses the 'default' security-group instead of the instance's security-group 'custom_sg'.", 
            "date_created": "2014-12-30 01:12:41.783548+00:00", 
            "author": "https://api.launchpad.net/1.0/~skollipa"
        }, 
        {
            "content": "Currently, the workaround is to perform a 'neutron-port-create' with the required security-groups and then associate the port with the instance via the 'nova-interface-attach' using the 'port-id' parameter. \n\n[root@osnode2 nova(keystone_admin)]# neutron port-create --security-group custom_sg datanw\nCreated a new port:\n+-----------------------+-------------------------------------------------------------------------------------+\n| Field                 | Value                                                                               |\n+-----------------------+-------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                                |\n| allowed_address_pairs |                                                                                     |\n| binding:host_id       |                                                                                     |\n| binding:profile       | {}                                                                                  |\n| binding:vif_details   | {}                                                                                  |\n| binding:vif_type      | unbound                                                                             |\n| binding:vnic_type     | normal                                                                              |\n| device_id             |                                                                                     |\n| device_owner          |                                                                                     |\n| fixed_ips             | {\"subnet_id\": \"42d6b5a9-b415-41db-911e-89956df77852\", \"ip_address\": \"192.168.0.17\"} |\n| id                    | 6ad96b2b-eca8-4efa-bebb-97d123a7bf87                                                |\n| mac_address           | fa:16:3e:da:cd:b6                                                                   |\n| name                  |                                                                                     |\n| network_id            | e98cdc79-f385-498e-be99-5bf879f26741                                                |\n| security_groups       | 85ee063b-f688-45ad-b35c-a2f102943d32                                                |\n| status                | DOWN                                                                                |\n| tenant_id             | f32c4fd3c6524d1da40762071934b583                                                    |\n+-----------------------+-------------------------------------------------------------------------------------+\n\n[root@osnode2 nova(keystone_admin)]# nova interface-attach --port-id 6ad96b2b-eca8-4efa-bebb-97d123a7bf87 cirros_vm\n\n[root@osnode2 nova(keystone_admin)]# neutron port-show 6ad96b2b-eca8-4efa-bebb-97d123a7bf87\n+-----------------------+-------------------------------------------------------------------------------------+\n| Field                 | Value                                                                               |\n+-----------------------+-------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                                |\n| allowed_address_pairs |                                                                                     |\n| binding:host_id       | osnode2                                                                             |\n| binding:profile       | {}                                                                                  |\n| binding:vif_details   | {\"port_filter\": true, \"ovs_hybrid_plug\": true}                                      |\n| binding:vif_type      | ovs                                                                                 |\n| binding:vnic_type     | normal                                                                              |\n| device_id             | d6221cd5-1e02-4759-9412-1f238b511667                                                |\n| device_owner          | compute:None                                                                        |\n| extra_dhcp_opts       |                                                                                     |\n| fixed_ips             | {\"subnet_id\": \"42d6b5a9-b415-41db-911e-89956df77852\", \"ip_address\": \"192.168.0.17\"} |\n| id                    | 6ad96b2b-eca8-4efa-bebb-97d123a7bf87                                                |\n| mac_address           | fa:16:3e:da:cd:b6                                                                   |\n| name                  |                                                                                     |\n| network_id            | e98cdc79-f385-498e-be99-5bf879f26741                                                |\n| security_groups       | 85ee063b-f688-45ad-b35c-a2f102943d32                                                |\n| status                | ACTIVE                                                                              |\n| tenant_id             | f32c4fd3c6524d1da40762071934b583                                                    |\n+-----------------------+-------------------------------------------------------------------------------------+", 
            "date_created": "2014-12-30 01:15:35.923708+00:00", 
            "author": "https://api.launchpad.net/1.0/~skollipa"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/144398", 
            "date_created": "2014-12-30 02:15:45.468659+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by John Garbutt (<email address hidden>) on branch: master\nReview: https://review.openstack.org/144398\nReason: This patch seems to have stalled, lets abandon it.\nPlease restore the patch if that is no longer true.\n\nAny questions, please catch me via email or on IRC johnthetubaguy", 
            "date_created": "2015-09-04 16:29:11.949987+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "\nThis is an automated cleanup. This bug report has been closed because it\nis older than 18 months and there is no open code change to fix this.\nAfter this time it is unlikely that the circumstances which lead to\nthe observed issue can be reproduced.\n\nIf you can reproduce the bug, please:\n* reopen the bug report (set to status \"New\")\n* AND add the detailed steps to reproduce the issue (if applicable)\n* AND leave a comment \"CONFIRMED FOR: <RELEASE_NAME>\"\n  Only still supported release names are valid (LIBERTY, MITAKA, OCATA, NEWTON).\n  Valid example: CONFIRMED FOR: LIBERTY\n", 
            "date_created": "2016-07-05 09:55:49.963767+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}