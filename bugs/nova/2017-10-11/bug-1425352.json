{
    "status": "Confirmed", 
    "last_updated": "2017-06-27 15:52:59.659778+00:00", 
    "description": "A volume has been attached in nova after attaching it fails.\nBut its status is 'available' in cinder.\nAnd then, the volume cannot be detached\nbecause an error(Invalid volume: Volume must be attached in order to detach) occurs.\n\nThe cause of the failure of attaching the volume is a rpc call timeout between nova-api and nova-compute\nin 'reserve_block_device_name' call.\n(a 'reserve_block_device_name' rpc call is in '_attach_volume' method in nova/compute/api.py)\n\nA rpc call timeout occurs because of waiting to get the semaphore in nova-compute.\nIt takes long time when many requests for same VM instance comes.\n\nThe cause of the failure of detaching the volume is that the record remains in a 'block_device_mapping' table.\n\n\nstack@devstack-juno:/opt/devstack$ nova list\n+--------------------------------------+---------+--------+------------+-------------+-------------------+\n| ID                                   | Name    | Status | Task State | Power State | Networks          |\n+--------------------------------------+---------+--------+------------+-------------+-------------------+\n| 16eb66e3-3cda-44c5-9134-cb759ffb211b | server1 | ACTIVE | -          | Running     | public=10.0.2.195 |\n+--------------------------------------+---------+--------+------------+-------------+-------------------+\nstack@devstack-juno:/opt/devstack$ cinder list\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\n| 474964ed-e334-44c0-a904-4612c52e6618 | available | TEST |  1   | lvmdriver-1 |  false   |             |\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\nstack@devstack-juno:/opt/devstack$ nova volume-attach server1 474964ed-e334-44c0-a904-4612c52e6618\nERROR (ClientException): The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-c371e287-5e28-410f-812c-43c193bdcffc)\n\n* RPC time out occurred between nova-api and nova-compute in 'reserve_block_device_name' call.\n\nstack@devstack-juno:/opt/devstack$ nova show server1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | devstack-juno                                                  |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | devstack-juno                                                  |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2015-02-24T07:54:06.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         |                                                                |\n| created                              | 2015-02-24T07:53:54Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 358f8c0b777e6a5218b4e297676604bbc730afe5bcc2760e64a32408       |\n| id                                   | 16eb66e3-3cda-44c5-9134-cb759ffb211b                           |\n| image                                | cirros-0.3.2-x86_64-uec (7f38517f-adb5-4fe6-86be-f60d9065f00d) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | server1                                                        |\n| os-extended-volumes:volumes_attached | [{\"id\": \"474964ed-e334-44c0-a904-4612c52e6618\"}]               |\n| progress                             | 0                                                              |\n| public network                       | 10.0.2.195                                                     |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | 47b5fac1e13c4e97b36cd76bcb4ca661                               |\n| updated                              | 2015-02-24T07:54:06Z                                           |\n| user_id                              | 94cf43ae770c4a32bf8ce817cd2608cb                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@devstack-juno:/opt/devstack$ cinder list\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\n| 474964ed-e334-44c0-a904-4612c52e6618 | available | TEST |  1   | lvmdriver-1 |  false   |             |\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\nstack@devstack-juno:/opt/devstack$ nova volume-detach server1 474964ed-e334-44c0-a904-4612c52e6618\nERROR (BadRequest): Invalid volume: Volume must be attached in order to detach. (HTTP 400) (Request-ID: req-cdc4b447-60b8-424c-b151-73d2f2874068)\nstack@devstack-juno:/opt/devstack$ nova show server1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | devstack-juno                                                  |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | devstack-juno                                                  |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2015-02-24T07:54:06.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         |                                                                |\n| created                              | 2015-02-24T07:53:54Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 358f8c0b777e6a5218b4e297676604bbc730afe5bcc2760e64a32408       |\n| id                                   | 16eb66e3-3cda-44c5-9134-cb759ffb211b                           |\n| image                                | cirros-0.3.2-x86_64-uec (7f38517f-adb5-4fe6-86be-f60d9065f00d) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | server1                                                        |\n| os-extended-volumes:volumes_attached | [{\"id\": \"474964ed-e334-44c0-a904-4612c52e6618\"}]               |\n| progress                             | 0                                                              |\n| public network                       | 10.0.2.195                                                     |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | 47b5fac1e13c4e97b36cd76bcb4ca661                               |\n| updated                              | 2015-02-24T07:54:06Z                                           |\n| user_id                              | 94cf43ae770c4a32bf8ce817cd2608cb                               |\n+--------------------------------------+----------------------------------------------------------------+\n\n[Environment]\nOS: Ubuntu 14.04 LTS\nnova: stable/juno(2014.2.1)\ncinder: stable/juno(2014.2.1)", 
    "tags": [
        "openstack-version.juno"
    ], 
    "importance": "Low", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1425352", 
    "owner": "None", 
    "id": 1425352, 
    "index": 284, 
    "created": "2015-02-25 02:28:49.267915+00:00", 
    "title": "A volume remains attached and cannot be detached after attaching it fails", 
    "comments": [
        {
            "content": "A volume has been attached in nova after attaching it fails.\nBut its status is 'available' in cinder.\nAnd then, the volume cannot be detached\nbecause an error(Invalid volume: Volume must be attached in order to detach) occurs.\n\nThe cause of the failure of attaching the volume is a rpc call timeout between nova-api and nova-compute\nin 'reserve_block_device_name' call.\n(a 'reserve_block_device_name' rpc call is in '_attach_volume' method in nova/compute/api.py)\n\nA rpc call timeout occurs because of waiting to get the semaphore in nova-compute.\nIt takes long time when many requests for same VM instance comes.\n\nThe cause of the failure of detaching the volume is that the record remains in a 'block_device_mapping' table.\n\n\nstack@devstack-juno:/opt/devstack$ nova list\n+--------------------------------------+---------+--------+------------+-------------+-------------------+\n| ID                                   | Name    | Status | Task State | Power State | Networks          |\n+--------------------------------------+---------+--------+------------+-------------+-------------------+\n| 16eb66e3-3cda-44c5-9134-cb759ffb211b | server1 | ACTIVE | -          | Running     | public=10.0.2.195 |\n+--------------------------------------+---------+--------+------------+-------------+-------------------+\nstack@devstack-juno:/opt/devstack$ cinder list\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\n| 474964ed-e334-44c0-a904-4612c52e6618 | available | TEST |  1   | lvmdriver-1 |  false   |             |\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\nstack@devstack-juno:/opt/devstack$ nova volume-attach server1 474964ed-e334-44c0-a904-4612c52e6618\nERROR (ClientException): The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-c371e287-5e28-410f-812c-43c193bdcffc)\n\n* RPC time out occurred between nova-api and nova-compute in 'reserve_block_device_name' call.\n\nstack@devstack-juno:/opt/devstack$ nova show server1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | devstack-juno                                                  |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | devstack-juno                                                  |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2015-02-24T07:54:06.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         |                                                                |\n| created                              | 2015-02-24T07:53:54Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 358f8c0b777e6a5218b4e297676604bbc730afe5bcc2760e64a32408       |\n| id                                   | 16eb66e3-3cda-44c5-9134-cb759ffb211b                           |\n| image                                | cirros-0.3.2-x86_64-uec (7f38517f-adb5-4fe6-86be-f60d9065f00d) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | server1                                                        |\n| os-extended-volumes:volumes_attached | [{\"id\": \"474964ed-e334-44c0-a904-4612c52e6618\"}]               |\n| progress                             | 0                                                              |\n| public network                       | 10.0.2.195                                                     |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | 47b5fac1e13c4e97b36cd76bcb4ca661                               |\n| updated                              | 2015-02-24T07:54:06Z                                           |\n| user_id                              | 94cf43ae770c4a32bf8ce817cd2608cb                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@devstack-juno:/opt/devstack$ cinder list\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\n| 474964ed-e334-44c0-a904-4612c52e6618 | available | TEST |  1   | lvmdriver-1 |  false   |             |\n+--------------------------------------+-----------+------+------+-------------+----------+-------------+\nstack@devstack-juno:/opt/devstack$ nova volume-detach server1 474964ed-e334-44c0-a904-4612c52e6618\nERROR (BadRequest): Invalid volume: Volume must be attached in order to detach. (HTTP 400) (Request-ID: req-cdc4b447-60b8-424c-b151-73d2f2874068)\nstack@devstack-juno:/opt/devstack$ nova show server1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | devstack-juno                                                  |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | devstack-juno                                                  |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2015-02-24T07:54:06.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         |                                                                |\n| created                              | 2015-02-24T07:53:54Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 358f8c0b777e6a5218b4e297676604bbc730afe5bcc2760e64a32408       |\n| id                                   | 16eb66e3-3cda-44c5-9134-cb759ffb211b                           |\n| image                                | cirros-0.3.2-x86_64-uec (7f38517f-adb5-4fe6-86be-f60d9065f00d) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | server1                                                        |\n| os-extended-volumes:volumes_attached | [{\"id\": \"474964ed-e334-44c0-a904-4612c52e6618\"}]               |\n| progress                             | 0                                                              |\n| public network                       | 10.0.2.195                                                     |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | 47b5fac1e13c4e97b36cd76bcb4ca661                               |\n| updated                              | 2015-02-24T07:54:06Z                                           |\n| user_id                              | 94cf43ae770c4a32bf8ce817cd2608cb                               |\n+--------------------------------------+----------------------------------------------------------------+\n\n[Environment]\nOS: Ubuntu 14.04 LTS\nnova: stable/juno(2014.2.1)\ncinder: stable/juno(2014.2.1)", 
            "date_created": "2015-02-25 02:28:49.267915+00:00", 
            "author": "https://api.launchpad.net/1.0/~natsume-takashi"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/167510", 
            "date_created": "2015-03-25 07:11:31.363422+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Joe Gordon (<email address hidden>) on branch: master\nReview: https://review.openstack.org/167510\nReason: This review is > 4 weeks without comment, and failed Jenkins the last time it was checked. We are abandoning this for now. Feel free to reactivate the review by pressing the restore button and leaving a 'recheck' comment to get fresh test results.", 
            "date_created": "2015-05-13 17:21:27.709698+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Automatically discovered version juno in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 15:52:58.816553+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}