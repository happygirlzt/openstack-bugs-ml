{
    "status": "Invalid", 
    "last_updated": "2014-02-17 11:03:20.932704+00:00", 
    "description": "My environment is \uff1a\nNova api --https--> haproxy(SSL proxy)----http----> Glance api1\n                                       |--http----> Glance api2\n\nI use centos + rdo rpm package(havana), my haproxy is 1.5_dev21.\n\nIt can work well if I config in nova.conf as following:\nglance_api_servers=glanceapi1_ip:9292,glanceapi2_ip:9292\n\nBut when I want nova api talk with glance api in https, it can't work. My config is as following:\nglance_api_servers=https://Glanceapi_VIP:443 in nova.conf,\n\nWhen I boot VM, I will get the error as below:\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/compute/api.py\", line 1220, in create\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     legacy_bdm=legacy_bdm)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/compute/api.py\", line 840, in _create_instance\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     image_id, boot_meta = self._get_image(context, image_href)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/compute/api.py\", line 620, in _get_image\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     image = image_service.show(context, image_id)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/image/glance.py\", line 292, in show\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     _reraise_translated_image_exception(image_id)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/image/glance.py\", line 290, in show\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     image = self._client.call(context, 1, 'get', image_id)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/image/glance.py\", line 214, in call\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     return getattr(client.images, method)(*args, **kwargs)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/v1/images.py\", line 114, in get\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     % urllib.quote(str(image_id)))\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/common/http.py\", line 293, in raw_request\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     return self._http_request(url, method, **kwargs)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/common/http.py\", line 244, in _http_request\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     body_str = ''.join([chunk for chunk in body_iter])\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/common/http.py\", line 499, in __iter__\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     chunk = self.next()\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/common/http.py\", line 515, in next\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     chunk = self._resp.read(CHUNKSIZE)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib64/python2.6/httplib.py\", line 518, in read\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     self.close()\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib64/python2.6/httplib.py\", line 499, in close\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     self.fp.close()\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib64/python2.6/socket.py\", line 278, in close\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     self._sock.close()\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/eventlet/greenio.py\", line 145, in __getattr__\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     attr = getattr(self.fd, name)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack AttributeError: 'GreenSocket' object has no attribute 'close'", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1266974", 
    "owner": "None", 
    "id": 1266974, 
    "index": 4446, 
    "created": "2014-01-08 04:50:58.051723+00:00", 
    "title": "nova work with glance SSL", 
    "comments": [
        {
            "content": "My environment is \uff1a\nNova api -----https----> haproxy(1.5_dev21 work as ssl proxy) ----http----> Glance api1\n                                                                                                           |--http----> Glance api2\n\nIt can work well if I config in nova.conf as following:\nglance_api_servers=glanceapi1_ip:9292,glanceapi2_ip:9292\n\n\nBut when I want nova api talk with glance api in https, it can't work. My config is as following:\nglance_api_servers=https://Glanceapi_VIP:443 in nova.conf, \n\n\nWhen I boot VM, I will get the error as below:\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/compute/api.py\", line 1220, in create\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     legacy_bdm=legacy_bdm)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/compute/api.py\", line 840, in _create_instance\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     image_id, boot_meta = self._get_image(context, image_href)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/compute/api.py\", line 620, in _get_image\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     image = image_service.show(context, image_id)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/image/glance.py\", line 292, in show\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     _reraise_translated_image_exception(image_id)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/image/glance.py\", line 290, in show\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     image = self._client.call(context, 1, 'get', image_id)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/image/glance.py\", line 214, in call\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     return getattr(client.images, method)(*args, **kwargs)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/v1/images.py\", line 114, in get\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     % urllib.quote(str(image_id)))\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/common/http.py\", line 293, in raw_request\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     return self._http_request(url, method, **kwargs)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/common/http.py\", line 244, in _http_request\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     body_str = ''.join([chunk for chunk in body_iter])\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/common/http.py\", line 499, in __iter__\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     chunk = self.next()\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/glanceclient/common/http.py\", line 515, in next\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     chunk = self._resp.read(CHUNKSIZE)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib64/python2.6/httplib.py\", line 518, in read\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     self.close()\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib64/python2.6/httplib.py\", line 499, in close\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     self.fp.close()\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib64/python2.6/socket.py\", line 278, in close\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     self._sock.close()\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/eventlet/greenio.py\", line 145, in __getattr__\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack     attr = getattr(self.fd, name)\n2014-01-08 04:39:01.480 6011 TRACE nova.api.openstack AttributeError: 'GreenSocket' object has no attribute 'close'", 
            "date_created": "2014-01-08 04:50:58.051723+00:00", 
            "author": "https://api.launchpad.net/1.0/~limao"
        }, 
        {
            "content": "You need a newer version of eventlet. This was reported in [1] and fixed with the patch in [2]. I'll try to update the packages in RDO but in the meanwhile, could you open a bug in [3] for tracking it? Thanks.\n\n[1] https://bitbucket.org/eventlet/eventlet/issue/136\n[2] https://bitbucket.org/eventlet/eventlet/commits/609f230\n[3] https://bugzilla.redhat.com/enter_bug.cgi?product=RDO&component=openstack-nova", 
            "date_created": "2014-02-17 11:03:01.331875+00:00", 
            "author": "https://api.launchpad.net/1.0/~xqueralt-deactivatedaccount"
        }
    ]
}