{
    "status": "Invalid", 
    "last_updated": "2012-10-23 00:01:21.482932+00:00", 
    "description": "When running nova-manage db sync I get the error:\n\nCommand failed, please check log for more info\n\nIn the logs I get\n\n2012-07-26 12:50:16 CRITICAL nova [-] `projects`\n\nWhich doesn't really give much away.\n\nCurrent migrate version is 82 and the latest version available is 82\n\nMy guess is this has something to do with the whole projects and dns_domains table utf8/latin issue.\n\nIs it because the fix_dns_domains code is only run when the migrate version is older?\n\nCode:\n\n\u00a0\u00a0\u00a0\u00a0if version is None or version > current_version:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return fix_dns_domains.run(get_engine())\n\u00a0\u00a0\u00a0\u00a0else:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return versioning_api.downgrade(FLAGS.sql_connection, repo_path,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0version)", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1029222", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 1029222, 
    "index": 735, 
    "created": "2012-07-26 02:56:13.180058+00:00", 
    "title": "DB migration fails with 'Command failed, please check log for more info'", 
    "comments": [
        {
            "content": "In the logs I get \n\n2012-07-26 12:50:16 CRITICAL nova [-] `projects`\n\nWhich doesn't really give much away.\n\nCurrent migrate version is 82 and the latest version available is 82\n\nMy guess is this has something to do with the whole projects and dns_domains table utf8/latin issue.\n\nIs it because the fix_dns_domains code is only run when the migrate version is older?\n\nCode:\n\n    if version is None or version > current_version:\n        versioning_api.upgrade(FLAGS.sql_connection, repo_path, version)\n        return fix_dns_domains.run(get_engine())\n    else:\n        return versioning_api.downgrade(FLAGS.sql_connection, repo_path,\n                                        version)", 
            "date_created": "2012-07-26 02:56:13.180058+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Sam:\n\nI wrote the fix_dns_domains fix for Essex and would be glad to help troubleshoot this on IRC if you need help. (I'm dprince on Freenode).\n\nNot sure what is going on here yet based on this ticket. When doing a 'db_sync' (with no explicit version set) the 'version' variable in the code above should be None... meaning the fix_dns_domains code should run.\n\nCould you enabled debug logging and try this again? Set both debug and verbose in your nova.conf to True.\n\nMore information about your environment might also be helpful.\n\n\n\n", 
            "date_created": "2012-08-17 15:02:46.436435+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "Hi Dan, sorry for the delay with this. Here is the stacktrace I'm getting. (I've only pasted the last bit, let me know if you need more)\n\nWe're running nova 2012.1 from the official ubuntu precise deb (with some custom patches but nothing that would affect this)\n\n\nLet me know if you need more info.\n\nCheers,\nSam\n\n\n\n2012-08-29 09:33:26 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/reflection.py\", line 178, in get_table_options\n2012-08-29 09:33:26 TRACE nova     Locals:{'kw': {},\n2012-08-29 09:33:26 TRACE nova            'schema': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.engine.reflection.Inspector object at 0x3d2b550>,\n2012-08-29 09:33:26 TRACE nova            'table_name': u'projects'}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova   File \"<string>\", line 1, in <lambda>\n2012-08-29 09:33:26 TRACE nova     Locals:{'connection': <sqlalchemy.engine.base.Connection object at 0x3d1e990>,\n2012-08-29 09:33:26 TRACE nova            'kw': {'info_cache': {}},\n2012-08-29 09:33:26 TRACE nova            'schema': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb object at 0x3bd8850>,\n2012-08-29 09:33:26 TRACE nova            'table_name': u'projects'}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/reflection.py\", line 47, in cache\n2012-08-29 09:33:26 TRACE nova     Locals:{'args': (u'projects',),\n2012-08-29 09:33:26 TRACE nova            'con': <sqlalchemy.engine.base.Connection object at 0x3d1e990>,\n2012-08-29 09:33:26 TRACE nova            'fn': <function get_table_options at 0x398d0c8>,\n2012-08-29 09:33:26 TRACE nova            'info_cache': {},\n2012-08-29 09:33:26 TRACE nova            'key': ('get_table_options', (u'projects',), ()),\n2012-08-29 09:33:26 TRACE nova            'kw': {'info_cache': {}, 'schema': None},\n2012-08-29 09:33:26 TRACE nova            'ret': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb object at 0x3bd8850>}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/dialects/mysql/base.py\", line 1948, in get_table_options\n2012-08-29 09:33:26 TRACE nova     Locals:{'connection': <sqlalchemy.engine.base.Connection object at 0x3d1e990>,\n2012-08-29 09:33:26 TRACE nova            'kw': {'info_cache': {}},\n2012-08-29 09:33:26 TRACE nova            'schema': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb object at 0x3bd8850>,\n2012-08-29 09:33:26 TRACE nova            'table_name': u'projects'}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/dialects/mysql/base.py\", line 2047, in _parsed_state_or_create\n2012-08-29 09:33:26 TRACE nova     Locals:{'connection': <sqlalchemy.engine.base.Connection object at 0x3d1e990>,\n2012-08-29 09:33:26 TRACE nova            'kw': {'info_cache': {}},\n2012-08-29 09:33:26 TRACE nova            'schema': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb object at 0x3bd8850>,\n2012-08-29 09:33:26 TRACE nova            'table_name': u'projects'}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova   File \"<string>\", line 1, in <lambda>\n2012-08-29 09:33:26 TRACE nova     Locals:{'connection': <sqlalchemy.engine.base.Connection object at 0x3d1e990>,\n2012-08-29 09:33:26 TRACE nova            'kw': {'info_cache': {}},\n2012-08-29 09:33:26 TRACE nova            'schema': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb object at 0x3bd8850>,\n2012-08-29 09:33:26 TRACE nova            'table_name': u'projects'}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/reflection.py\", line 47, in cache\n2012-08-29 09:33:26 TRACE nova     Locals:{'args': (u'projects',),\n2012-08-29 09:33:26 TRACE nova            'con': <sqlalchemy.engine.base.Connection object at 0x3d1e990>,\n2012-08-29 09:33:26 TRACE nova            'fn': <function _setup_parser at 0x398d758>,\n2012-08-29 09:33:26 TRACE nova            'info_cache': {},\n2012-08-29 09:33:26 TRACE nova            'key': ('_setup_parser', (u'projects',), ()),\n2012-08-29 09:33:26 TRACE nova            'kw': {'info_cache': {}, 'schema': None},\n2012-08-29 09:33:26 TRACE nova            'ret': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb object at 0x3bd8850>}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/dialects/mysql/base.py\", line 2072, in _setup_parser\n2012-08-29 09:33:26 TRACE nova     Locals:{'charset': 'latin1',\n2012-08-29 09:33:26 TRACE nova            'connection': <sqlalchemy.engine.base.Connection object at 0x3d1e990>,\n2012-08-29 09:33:26 TRACE nova            'full_name': u'`projects`',\n2012-08-29 09:33:26 TRACE nova            'kw': {'info_cache': {}},\n2012-08-29 09:33:26 TRACE nova            'parser': <sqlalchemy.dialects.mysql.base.MySQLTableDefinitionParser object at 0x3d1e950>,\n2012-08-29 09:33:26 TRACE nova            'schema': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb object at 0x3bd8850>,\n2012-08-29 09:33:26 TRACE nova            'table_name': u'projects'}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/dialects/mysql/base.py\", line 2159, in _show_create_table\n2012-08-29 09:33:26 TRACE nova     Locals:{'charset': 'latin1',\n2012-08-29 09:33:26 TRACE nova            'connection': <sqlalchemy.engine.base.Connection object at 0x3d1e990>,\n2012-08-29 09:33:26 TRACE nova            'e': ProgrammingError('(ProgrammingError) (1146, \"Table \\'nova.projects\\' doesn\\'t exist\")',),\n2012-08-29 09:33:26 TRACE nova            'full_name': u'`projects`',\n2012-08-29 09:33:26 TRACE nova            'rp': None,\n2012-08-29 09:33:26 TRACE nova            'self': <sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb object at 0x3bd8850>,\n2012-08-29 09:33:26 TRACE nova            'st': u'SHOW CREATE TABLE `projects`',\n2012-08-29 09:33:26 TRACE nova            'table': None}\n2012-08-29 09:33:26 TRACE nova            \n2012-08-29 09:33:26 TRACE nova \n2012-08-29 09:33:26 TRACE nova NoSuchTableError: `projects`\n2012-08-29 09:33:26 TRACE nova ", 
            "date_created": "2012-08-28 23:38:39.038971+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Just wondering what the status of this is?\nI think this should be in folsom as it is currently preventing me from upgrading from essex -> folsom", 
            "date_created": "2012-10-10 00:47:02.452847+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "This bug can be closed, there was no way to work around this one so unfortunately we had to have an outage to rebuild the database. There was no other way.\n\nAnyone else that has this issue here is what I did:\n\nmysqldump the nova db with an ignore table on projects and dns_domains (these are empty for us anyway)\nDrop the DB and create a new one\nImport the dump file and manually create the projects and dns_domains table", 
            "date_created": "2012-10-22 20:43:17.692969+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }
    ]
}