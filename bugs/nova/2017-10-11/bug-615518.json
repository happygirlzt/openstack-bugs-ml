{
    "status": "Fix Released", 
    "last_updated": "2010-10-07 02:39:29.605841+00:00", 
    "description": "While setting up to do cleanup work on Nova for the pylint/pep8 blueprint, I brought down and enabled everything I could find to make the tests all function on Nova. I wrote up the components and steps, publishing in the wiki at http://wiki.openstack.org/HackingNovaMacOSX.\n\nWith redis, out of the box everything works *except* nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n\nHere's the stack trace that I receive:\n\n[ERROR]: nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n \nTraceback (most recent call last):\n  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 222, in run\n    d = self._maybeInlineCallbacks(testMethod)\n  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 182, in _maybeInlineCallbacks\n    g = f()\n  File \"/Users/heckj/Documents/code/nova/nova/tests/auth_unittest.py\", line 162, in test_209_can_generate_x509\n    signed_cert = X509.load_cert_string(cert_str)\n  File \"/Users/heckj/Documents/code/nova/.nova-venv/lib/python2.6/site-packages/M2Crypto/X509.py\", line 655, in load_cert_string\n    return load_cert_bio(bio, format)\n  File \"/Users/heckj/Documents/code/nova/.nova-venv/lib/python2.6/site-packages/M2Crypto/X509.py\", line 639, in load_cert_bio\n    raise X509Error(Err.get_error())\nM2Crypto.X509.X509Error: 140735090166816:error:0906D06C:PEM routines:PEM_read_bio:no start line:/SourceCache/OpenSSL098/OpenSSL098-32/src/crypto/pem/pem_lib.c:650:Expecting: CERTIFICATE\n\nDigging into to the test and code a little bit, it appears that the cert_str getting returned is blank, and hence we're hitting an error when trying to use it. Under the covers, the code appears to be doing its work calling openssl directly and getting pieces back. I have 1.0.0a installed (through MacPorts) - just happened to have it. Didn't see it as an explicit dependency on anything earlier than finding it in the code.\n\nWould be happy to help debug, but I'm very unfamiliar with both this code base and the crypto space.\n\n-joe", 
    "tags": [], 
    "importance": "Low", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/615518", 
    "owner": "https://api.launchpad.net/1.0/~annegentle", 
    "id": 615518, 
    "index": 4925, 
    "created": "2010-08-09 19:32:14.362709+00:00", 
    "title": "unit test nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509  failing on Mac OS X", 
    "comments": [
        {
            "content": "While setting up to do cleanup work on Nova for the pylint/pep8 blueprint, I brought down and enabled everything I could find to make the tests all function on Nova. I wrote up the components and steps, publishing in the wiki at http://wiki.openstack.org/HackingNovaMacOSX.\n\nWith redis, out of the box everything works *except* nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n\nHere's the stack trace that I receive:\n\n[ERROR]: nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n \nTraceback (most recent call last):\n  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 222, in run\n    d = self._maybeInlineCallbacks(testMethod)\n  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 182, in _maybeInlineCallbacks\n    g = f()\n  File \"/Users/heckj/Documents/code/nova/nova/tests/auth_unittest.py\", line 162, in test_209_can_generate_x509\n    signed_cert = X509.load_cert_string(cert_str)\n  File \"/Users/heckj/Documents/code/nova/.nova-venv/lib/python2.6/site-packages/M2Crypto/X509.py\", line 655, in load_cert_string\n    return load_cert_bio(bio, format)\n  File \"/Users/heckj/Documents/code/nova/.nova-venv/lib/python2.6/site-packages/M2Crypto/X509.py\", line 639, in load_cert_bio\n    raise X509Error(Err.get_error())\nM2Crypto.X509.X509Error: 140735090166816:error:0906D06C:PEM routines:PEM_read_bio:no start line:/SourceCache/OpenSSL098/OpenSSL098-32/src/crypto/pem/pem_lib.c:650:Expecting: CERTIFICATE\n\nDigging into to the test and code a little bit, it appears that the cert_str getting returned is blank, and hence we're hitting an error when trying to use it. Under the covers, the code appears to be doing its work calling openssl directly and getting pieces back. I have 1.0.0a installed (through MacPorts) - just happened to have it. Didn't see it as an explicit dependency on anything earlier than finding it in the code.\n\nWould be happy to help debug, but I'm very unfamiliar with both this code base and the crypto space.\n\n-joe", 
            "date_created": "2010-08-09 19:32:14.362709+00:00", 
            "author": "https://api.launchpad.net/1.0/~heckj"
        }, 
        {
            "content": "I replied on IRC, but I think I missed you...\n\nOne possibility if the openssl program is not returning what you expect, is that there's little or no error checking of spawned processes.  I have a patch that will hopefully get merged soon that error checks spawned processes: \nhttps://code.launchpad.net/~justin-fathomdb/nova/check-subprocess-exit-code\n\nIt might be worth trying to run the openssl command manually, or merging check-subprocess-exit-code into a copy of your branch, to see if that sheds any light on the problem...", 
            "date_created": "2010-08-09 19:51:49.557749+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "Thanks Justin - I'll give it a shot!\n\n-joe\n\nOn Aug 9, 2010, at 12:51 PM, justinsb wrote:\n\n> I replied on IRC, but I think I missed you...\n> \n> One possibility if the openssl program is not returning what you expect, is that there's little or no error checking of spawned processes.  I have a patch that will hopefully get merged soon that error checks spawned processes: \n> https://code.launchpad.net/~justin-fathomdb/nova/check-subprocess-exit-code\n> \n> It might be worth trying to run the openssl command manually, or merging\n> check-subprocess-exit-code into a copy of your branch, to see if that\n> sheds any light on the problem...\n> \n> -- \n> unit test nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509  failing on Mac OS X\n> https://bugs.launchpad.net/bugs/615518\n> You received this bug notification because you are a direct subscriber\n> of the bug.\n> \n> Status in OpenStack Compute (Nova): New\n> \n> Bug description:\n> While setting up to do cleanup work on Nova for the pylint/pep8 blueprint, I brought down and enabled everything I could find to make the tests all function on Nova. I wrote up the components and steps, publishing in the wiki at http://wiki.openstack.org/HackingNovaMacOSX.\n> \n> With redis, out of the box everything works *except* nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n> \n> Here's the stack trace that I receive:\n> \n> [ERROR]: nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n> \n> Traceback (most recent call last):\n>  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 222, in run\n>    d = self._maybeInlineCallbacks(testMethod)\n>  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 182, in _maybeInlineCallbacks\n>    g = f()\n>  File \"/Users/heckj/Documents/code/nova/nova/tests/auth_unittest.py\", line 162, in test_209_can_generate_x509\n>    signed_cert = X509.load_cert_string(cert_str)\n>  File \"/Users/heckj/Documents/code/nova/.nova-venv/lib/python2.6/site-packages/M2Crypto/X509.py\", line 655, in load_cert_string\n>    return load_cert_bio(bio, format)\n>  File \"/Users/heckj/Documents/code/nova/.nova-venv/lib/python2.6/site-packages/M2Crypto/X509.py\", line 639, in load_cert_bio\n>    raise X509Error(Err.get_error())\n> M2Crypto.X509.X509Error: 140735090166816:error:0906D06C:PEM routines:PEM_read_bio:no start line:/SourceCache/OpenSSL098/OpenSSL098-32/src/crypto/pem/pem_lib.c:650:Expecting: CERTIFICATE\n> \n> Digging into to the test and code a little bit, it appears that the cert_str getting returned is blank, and hence we're hitting an error when trying to use it. Under the covers, the code appears to be doing its work calling openssl directly and getting pieces back. I have 1.0.0a installed (through MacPorts) - just happened to have it. Didn't see it as an explicit dependency on anything earlier than finding it in the code.\n> \n> Would be happy to help debug, but I'm very unfamiliar with both this code base and the crypto space.\n> \n> -joe\n> \n> To unsubscribe from this bug, go to:\n> https://bugs.launchpad.net/nova/+bug/615518/+subscribe\n", 
            "date_created": "2010-08-09 21:46:27+00:00", 
            "author": "https://api.launchpad.net/1.0/~heckj"
        }, 
        {
            "content": "Using Justinb's branch merged over, I get an updated error with an unexpected exit code narrowing this down to invoking the openssl commands:\n\n\n[ERROR]: nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n\nTraceback (most recent call last):\n  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 222, in run\n    d = self._maybeInlineCallbacks(testMethod)\n  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 182, in _maybeInlineCallbacks\n    g = f()\n  File \"/Users/heckj/Documents/code/nova/nova/tests/auth_unittest.py\", line 154, in test_209_can_generate_x509\n    _key, cert_str = self.manager._generate_x509_cert('test1', 'testproj')\n  File \"/Users/heckj/Documents/code/nova/nova/auth/manager.py\", line 730, in _generate_x509_cert\n    signed_cert = crypto.sign_csr(csr, pid)\n  File \"/Users/heckj/Documents/code/nova/nova/crypto.py\", line 116, in sign_csr\n    return _sign_csr(csr_text, FLAGS.ca_path)\n  File \"/Users/heckj/Documents/code/nova/nova/crypto.py\", line 134, in _sign_csr\n    utils.runthis(\"Signing cert: %s\", \"openssl ca -batch -out %s/outbound.crt -config ./openssl.cnf -infiles %s/inbound.csr\" % (tmpfolder, tmpfolder))\n  File \"/Users/heckj/Documents/code/nova/nova/utils.py\", line 106, in runthis\n    % (exit_code, cmd))\nexceptions.Exception: Unexpected exit code: 1 from cmd: openssl ca -batch -out /var/folders/eo/eodZkg3ZFqeUxobvY1jb+++++TI/-Tmp-/tmpx_CdiL/outbound.crt -config ./openssl.cnf -infiles /var/folders/eo/eodZkg3ZFqeUxobvY1jb+++++TI/-Tmp-/tmpx_CdiL/inbound.csr\n", 
            "date_created": "2010-08-10 01:06:52.103652+00:00", 
            "author": "https://api.launchpad.net/1.0/~heckj"
        }, 
        {
            "content": "It runs fine on my mac with version\nOpenSSL 0.9.8l 5 Nov 2009\nperhaps there is a compatibility issue with the newer version of openssl?\n\nVish\n\nOn Mon, Aug 9, 2010 at 6:06 PM, Joseph Heck <email address hidden>wrote:\n\n> Using Justinb's branch merged over, I get an updated error with an\n> unexpected exit code narrowing this down to invoking the openssl\n> commands:\n>\n>\n> [ERROR]: nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n>\n> Traceback (most recent call last):\n>  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 222, in run\n>    d = self._maybeInlineCallbacks(testMethod)\n>  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 182, in\n> _maybeInlineCallbacks\n>    g = f()\n>   File \"/Users/heckj/Documents/code/nova/nova/tests/auth_unittest.py\", line\n> 154, in test_209_can_generate_x509\n>    _key, cert_str = self.manager._generate_x509_cert('test1', 'testproj')\n>  File \"/Users/heckj/Documents/code/nova/nova/auth/manager.py\", line 730, in\n> _generate_x509_cert\n>    signed_cert = crypto.sign_csr(csr, pid)\n>  File \"/Users/heckj/Documents/code/nova/nova/crypto.py\", line 116, in\n> sign_csr\n>    return _sign_csr(csr_text, FLAGS.ca_path)\n>  File \"/Users/heckj/Documents/code/nova/nova/crypto.py\", line 134, in\n> _sign_csr\n>    utils.runthis(\"Signing cert: %s\", \"openssl ca -batch -out\n> %s/outbound.crt -config ./openssl.cnf -infiles %s/inbound.csr\" % (tmpfolder,\n> tmpfolder))\n>  File \"/Users/heckj/Documents/code/nova/nova/utils.py\", line 106, in\n> runthis\n>    % (exit_code, cmd))\n> exceptions.Exception: Unexpected exit code: 1 from cmd: openssl ca -batch\n> -out\n> /var/folders/eo/eodZkg3ZFqeUxobvY1jb+++++TI/-Tmp-/tmpx_CdiL/outbound.crt\n> -config ./openssl.cnf -infiles\n> /var/folders/eo/eodZkg3ZFqeUxobvY1jb+++++TI/-Tmp-/tmpx_CdiL/inbound.csr\n>\n> --\n> unit test nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n>  failing on Mac OS X\n> https://bugs.launchpad.net/bugs/615518\n> You received this bug notification because you are a member of Nova\n> Bugs, which is subscribed to OpenStack Compute (nova).\n>\n> Status in OpenStack Compute (Nova): New\n>\n> Bug description:\n> While setting up to do cleanup work on Nova for the pylint/pep8 blueprint,\n> I brought down and enabled everything I could find to make the tests all\n> function on Nova. I wrote up the components and steps, publishing in the\n> wiki at http://wiki.openstack.org/HackingNovaMacOSX.\n>\n> With redis, out of the box everything works *except*\n> nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n>\n> Here's the stack trace that I receive:\n>\n> [ERROR]: nova.tests.auth_unittest.AuthTestCase.test_209_can_generate_x509\n>\n> Traceback (most recent call last):\n>  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 222, in run\n>    d = self._maybeInlineCallbacks(testMethod)\n>  File \"/Users/heckj/Documents/code/nova/nova/test.py\", line 182, in\n> _maybeInlineCallbacks\n>    g = f()\n>  File \"/Users/heckj/Documents/code/nova/nova/tests/auth_unittest.py\", line\n> 162, in test_209_can_generate_x509\n>    signed_cert = X509.load_cert_string(cert_str)\n>  File\n> \"/Users/heckj/Documents/code/nova/.nova-venv/lib/python2.6/site-packages/M2Crypto/X509.py\",\n> line 655, in load_cert_string\n>    return load_cert_bio(bio, format)\n>  File\n> \"/Users/heckj/Documents/code/nova/.nova-venv/lib/python2.6/site-packages/M2Crypto/X509.py\",\n> line 639, in load_cert_bio\n>    raise X509Error(Err.get_error())\n> M2Crypto.X509.X509Error: 140735090166816:error:0906D06C:PEM\n> routines:PEM_read_bio:no start\n> line:/SourceCache/OpenSSL098/OpenSSL098-32/src/crypto/pem/pem_lib.c:650:Expecting:\n> CERTIFICATE\n>\n> Digging into to the test and code a little bit, it appears that the\n> cert_str getting returned is blank, and hence we're hitting an error when\n> trying to use it. Under the covers, the code appears to be doing its work\n> calling openssl directly and getting pieces back. I have 1.0.0a installed\n> (through MacPorts) - just happened to have it. Didn't see it as an explicit\n> dependency on anything earlier than finding it in the code.\n>\n> Would be happy to help debug, but I'm very unfamiliar with both this code\n> base and the crypto space.\n>\n> -joe\n>\n>\n>\n", 
            "date_created": "2010-08-10 01:36:39+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Vish is right on - the bug is related to the version of OpenSSL. 1.0.0a must have some different responses that the code isn't anticipating. This should likely be called out as an explicit dependency and the code updated to check/fail on version correctly. What that means in terms of the code I'm not sure though...", 
            "date_created": "2010-08-11 02:01:28.102896+00:00", 
            "author": "https://api.launchpad.net/1.0/~heckj"
        }, 
        {
            "content": "Do we have any update on this?  Do we have a specific version of OpenSSL specified in the install instructions for MacOSX?  Do we need to have this specified?  Marking Incomplete until we have a follow-up.", 
            "date_created": "2010-10-06 01:28:32.945884+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "The version that functions correctly is OpenSSL 0.9.8l 5 , installed with MacOS 10.6 as a base element. The version that doesn't function is OpenSSL 1.0.0a (installed via MacPorts while getting other MacPorts pieces).\n\n", 
            "date_created": "2010-10-06 03:16:34.826936+00:00", 
            "author": "https://api.launchpad.net/1.0/~heckj"
        }, 
        {
            "content": "OK, thx for the update Joseph.  Sounds like this is a documentation bug for now.  This limitation should be addressed in the installation docs.  Assigning to Anne.", 
            "date_created": "2010-10-06 13:26:57.782400+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Added notes to these wiki pages: \nhttp://wiki.openstack.org/HackingNovaMacOSX\nhttp://wiki.openstack.org/NovaInstall\n\n", 
            "date_created": "2010-10-07 02:39:09.258355+00:00", 
            "author": "https://api.launchpad.net/1.0/~annegentle"
        }
    ]
}