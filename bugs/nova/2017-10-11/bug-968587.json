{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 11:09:58.560871+00:00", 
    "description": "Using libvirt on Fedora 16 w/ latest Folsom source. I'm getting the following exception when trying to perform an OSAPI rescue:\n\n2012-03-29 18:24:30 ERROR nova.rpc.amqp [req-9b09f6ad-e472-4f06-a955-a81c7c132af2 fca94f8fc77f426092a785975a56bb82 aa3ef8032a4e4ad3b68a3d6bef51cf91] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 153, in decorated_function\n(nova.rpc.amqp): TRACE:     function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib64/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1127, in rescue_instance\n(nova.rpc.amqp): TRACE:     self._legacy_nw_info(network_info), image_meta)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/connection.py\", line 800, in rescue\n(nova.rpc.amqp): TRACE:     network_info=network_info)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/connection.py\", line 1125, in _create_image\n(nova.rpc.amqp): TRACE:     libvirt_utils.write_to_file(basepath('console.log', ''), '', 007)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/utils.py\", line 152, in write_to_file\n(nova.rpc.amqp): TRACE:     with open(path, 'w') as f:\n(nova.rpc.amqp): TRACE: IOError: [Errno 13] Permission denied: '/var/lib/nova/instances/instance-00000004/console.log'\n\nThe permission in the libvirt instances directory are as follows:\n\n\n-rw-rw---- 1 qemu qemu    20943 Mar 29 18:24 console.log\n-rw-r--r-- 1 qemu qemu 23068672 Mar 29 18:27 disk\n-rw-r--r-- 1 qemu qemu  4404752 Mar 29 18:23 kernel\n-rw-r--r-- 1 nova nova     1340 Mar 29 18:23 libvirt.xml\n-rw-r--r-- 1 nova nova     1510 Mar 29 18:24 libvirt.xml.rescue\n-rw-r--r-- 1 qemu qemu  5882349 Mar 29 18:23 ramdisk\n-rw-r--r-- 1 nova nova     2733 Mar 29 18:24 unrescue.xml\n\n----\n\nAllowing the nova user to read/write console.log should fix this issue....", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/968587", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 968587, 
    "index": 2841, 
    "created": "2012-03-29 20:24:47.825292+00:00", 
    "title": "libvirt rescue fails w/ Permission denied on console.log", 
    "comments": [
        {
            "content": "Using libvirt on Fedora 16 w/ latest Folsom source. I'm getting the following exception when trying to perform an OSAPI rescue:\n\n2012-03-29 18:24:30 ERROR nova.rpc.amqp [req-9b09f6ad-e472-4f06-a955-a81c7c132af2 fca94f8fc77f426092a785975a56bb82 aa3ef8032a4e4ad3b68a3d6bef51cf91] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 153, in decorated_function\n(nova.rpc.amqp): TRACE:     function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib64/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1127, in rescue_instance\n(nova.rpc.amqp): TRACE:     self._legacy_nw_info(network_info), image_meta)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/connection.py\", line 800, in rescue\n(nova.rpc.amqp): TRACE:     network_info=network_info)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/connection.py\", line 1125, in _create_image\n(nova.rpc.amqp): TRACE:     libvirt_utils.write_to_file(basepath('console.log', ''), '', 007)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/utils.py\", line 152, in write_to_file\n(nova.rpc.amqp): TRACE:     with open(path, 'w') as f:\n(nova.rpc.amqp): TRACE: IOError: [Errno 13] Permission denied: '/var/lib/nova/instances/instance-00000004/console.log'\n\nThe permission in the libvirt instances directory are as follows:\n\n\n-rw-rw---- 1 qemu qemu    20943 Mar 29 18:24 console.log\n-rw-r--r-- 1 qemu qemu 23068672 Mar 29 18:27 disk\n-rw-r--r-- 1 qemu qemu  4404752 Mar 29 18:23 kernel\n-rw-r--r-- 1 nova nova     1340 Mar 29 18:23 libvirt.xml\n-rw-r--r-- 1 nova nova     1510 Mar 29 18:24 libvirt.xml.rescue\n-rw-r--r-- 1 qemu qemu  5882349 Mar 29 18:23 ramdisk\n-rw-r--r-- 1 nova nova     2733 Mar 29 18:24 unrescue.xml\n\n----\n\nAllowing the nova user to read/write console.log should fix this issue....", 
            "date_created": "2012-03-29 20:24:47.825292+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/5969", 
            "date_created": "2012-03-29 20:27:17.150408+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/5969\nCommitted: http://github.com/openstack/nova/commit/a837f92e39c74f1a97e358f1a8ecfcdb0915bf6c\nSubmitter: Jenkins\nBranch:    master\n\ncommit a837f92e39c74f1a97e358f1a8ecfcdb0915bf6c\nAuthor: Dan Prince <email address hidden>\nDate:   Thu Mar 29 16:25:10 2012 -0400\n\n    Fix libvirt rescue.\n    \n    Updates libvirt connection.py so that it chowns console.log\n    correctly when performing a rescue.\n    \n    Fixes LP Bug #968587.\n    \n    Change-Id: I38a97df92330a9f20f43e9e4598da3375c6a22dc\n", 
            "date_created": "2012-03-30 16:25:31.417271+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: milestone-proposed\nReview: https://review.openstack.org/6013", 
            "date_created": "2012-03-30 23:40:42.126994+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/6013\nCommitted: http://github.com/openstack/nova/commit/f2fe34e8b0ab89d7b2605e9d4b4c7bb8ca94d5ea\nSubmitter: Jenkins\nBranch:    milestone-proposed\n\ncommit f2fe34e8b0ab89d7b2605e9d4b4c7bb8ca94d5ea\nAuthor: Dan Prince <email address hidden>\nDate:   Thu Mar 29 16:25:10 2012 -0400\n\n    Fix libvirt rescue.\n    \n    Updates libvirt connection.py so that it chowns console.log\n    correctly when performing a rescue.\n    \n    Fixes LP Bug #968587.\n    \n    Change-Id: I38a97df92330a9f20f43e9e4598da3375c6a22dc\n", 
            "date_created": "2012-03-31 22:43:37.405734+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}