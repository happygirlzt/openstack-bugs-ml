{
    "status": "Won't Fix", 
    "last_updated": "2016-05-24 16:02:04.076393+00:00", 
    "description": "Non-standard hardware settings of instance (e.g. NIC model) are set correctly for first boot after creation, but not kept after many nova operations, e.g. nova reboot  --hard or stop & start sequence. HW-specific options disappear from XML on host and virtio driver is used instead.\n\nExtra options like NIC model should be preserved after any instance modifications (reboot, stop&start, storage attach), but are missing. \n\nVersion: nova-*  1:2015.1.2-0ubuntu1~cloud0, qemu-* 1:2.2+dfsg-5expubuntu9.3~cloud0 on Ubuntu 14.04.3.\nneutron-* 1:2015.1.2-0ubuntu1~cloud0\n\nSteps to reproduce:\n1. $ glance image-create --name test-e1000 --disk-format qcow2 --container-format bare --file cirros-0.3.4-i386-disk.img --property hw_disk_bus=ide --property hw_vif_model=e1000\n2. $ nova image-show 8da8e18b-f48b-4dc0-81ed-890dc223d410\n+-----------------------+--------------------------------------+\n| Property              | Value                                |\n+-----------------------+--------------------------------------+\n| id                    | 8da8e18b-f48b-4dc0-81ed-890dc223d410 |\n| metadata hw_disk_bus  | ide                                  |\n| metadata hw_vif_model | e1000                                |\n3. $ nova boot --image 8da8e18b-f48b-4dc0-81ed-890dc223d410 --flavor 1 --nic net-id=6de2c2fb-a770-4ef3-9a56-c320b339a95b test-e1000\n4. compute:~# virsh dumpxml instance-00021519 > /tmp/before\n5. $ nova reboot --hard 62f9d3de-7e30-420e-b744-a7755ca6ee0f\n6. compute:~# virsh dumpxml instance-00021519 > /tmp/after\n    compute:~# diff -u /tmp/before /tmp/after\n\n--- /tmp/before 2016-01-22 15:43:01.530843360 +0100\n+++ /tmp/after  2016-01-22 15:43:20.151089791 +0100\n@@ -93,7 +93,7 @@\n       <mac address='fa:16:3e:2a:f4:73'/>\n       <source bridge='brq6de2c2fb-a7'/>\n       <target dev='tap99d4e746-ac'/>\n-      <model type='e1000'/>\n+      <model type='virtio'/>\n       <alias name='net0'/>\n       <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n     </interface>\n\nI have Neutron ML2 with LinuxBridge underneath. \n\nI've tried to use \"nova boot ... --image-with hw_vif_model=e1000\", with no effect.\n\n\nThere were no errors in logs, but content of XML in virt/libvirt/config.py is different:\nAfter first boot:\n2016-01-22 15:38:13.840 7788 DEBUG nova.virt.libvirt.config [req-5cc930fd-8d7f-4cd0-883c-9bd69672e3a0 4bb8f720d4c7494bb573b6033015cd0c cfb66212643842ad90d9fb5a83b84d52 - - -] Generated XML ('<domain type=\"kvm\">\\n  <uuid>62f9d3de-7e30-420\ne-b744-a7755ca6ee0f</uuid>\\n  <name>instance-00021519</name>\\n<<CUT>>    <interface type=\"bridge\">\\n      <mac address=\"fa:16:3e:2a:f4:73\"/>\\n      <model type=\"e1000\"/>\\n      <source bridge=\"brq6de2c2fb-a7\"/>\\n      <target dev=\"tap99d4e746-ac\"/>\\n    </interface>\\n<<CUT>>',)  to_xml /usr/lib/python2.7/dist-packages/\nnova/virt/libvirt/config.py:82\n\nAfter reboot:\n2016-01-22 15:43:14.070 7788 DEBUG nova.virt.libvirt.config [req-254da7a4-b370-4557-8cf6-e977a6b60bb1 4bb8f720d4c7494bb573b6033015cd0c cfb66212643842ad90d9fb5a83b84d52 - - -] Generated XML ('<domain type=\"kvm\">\\n  <uuid>62f9d3de-7e30-420\ne-b744-a7755ca6ee0f</uuid>\\n  <name>instance-00021519</name>\\n <<CUT>>    <interface type=\"bridge\">\\n      <mac address=\"fa:16:3e:2a:f4:73\"/>\\n      <model type=\"virtio\"/>\\n      <source bridge=\"brq6de2c2fb-a7\"/>\\n      <target dev=\"tap99d4e746-ac\"/>\\n    </interface>\\n<<CUT>>',)  to_xml /usr/lib/python2.7/dist-packages/nova/virt/libvirt/config.py:82", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1537122", 
    "owner": "None", 
    "id": 1537122, 
    "index": 5984, 
    "created": "2016-01-22 16:06:32.219241+00:00", 
    "title": "Instance HW metadata aren't preserved after reboot", 
    "comments": [
        {
            "content": "Non-standard hardware settings of instance (e.g. NIC model) are set correctly for first boot after creation, but not kept after many nova operations, e.g. nova reboot  --hard or stop & start sequence. HW-specific options disappear from XML on host and virtio driver is used instead.\n\nExtra options like NIC model should be preserved after any instance modifications (reboot, stop&start, storage attach), but are missing. \n\nVersion: nova-*  1:2015.1.2-0ubuntu1~cloud0, qemu-* 1:2.2+dfsg-5expubuntu9.3~cloud0 on Ubuntu 14.04.3.\nneutron-* 1:2015.1.2-0ubuntu1~cloud0\n\nSteps to reproduce:\n1. $ glance image-create --name test-e1000 --disk-format qcow2 --container-format bare --file cirros-0.3.4-i386-disk.img --property hw_disk_bus=ide --property hw_vif_model=e1000\n2. $ nova image-show 8da8e18b-f48b-4dc0-81ed-890dc223d410\n+-----------------------+--------------------------------------+\n| Property              | Value                                |\n+-----------------------+--------------------------------------+\n| id                    | 8da8e18b-f48b-4dc0-81ed-890dc223d410 |\n| metadata hw_disk_bus  | ide                                  |\n| metadata hw_vif_model | e1000                                |\n3. $ nova boot --image 8da8e18b-f48b-4dc0-81ed-890dc223d410 --flavor 1 --nic net-id=6de2c2fb-a770-4ef3-9a56-c320b339a95b test-e1000\n4. compute:~# virsh dumpxml instance-00021519 > /tmp/before\n5. $ nova reboot --hard 62f9d3de-7e30-420e-b744-a7755ca6ee0f\n6. compute:~# virsh dumpxml instance-00021519 > /tmp/after\n    compute:~# diff -u /tmp/before /tmp/after\n\n--- /tmp/before 2016-01-22 15:43:01.530843360 +0100\n+++ /tmp/after  2016-01-22 15:43:20.151089791 +0100\n@@ -93,7 +93,7 @@\n       <mac address='fa:16:3e:2a:f4:73'/>\n       <source bridge='brq6de2c2fb-a7'/>\n       <target dev='tap99d4e746-ac'/>\n-      <model type='e1000'/>\n+      <model type='virtio'/>\n       <alias name='net0'/>\n       <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n     </interface>\n\nI have Neutron ML2 with LinuxBridge underneath. \n\nI've tried to use \"nova boot ... --image-with hw_vif_model=e1000\", with no effect.\n\n\nThere were no errors in logs, but content of XML in virt/libvirt/config.py is different:\nAfter first boot:\n2016-01-22 15:38:13.840 7788 DEBUG nova.virt.libvirt.config [req-5cc930fd-8d7f-4cd0-883c-9bd69672e3a0 4bb8f720d4c7494bb573b6033015cd0c cfb66212643842ad90d9fb5a83b84d52 - - -] Generated XML ('<domain type=\"kvm\">\\n  <uuid>62f9d3de-7e30-420\ne-b744-a7755ca6ee0f</uuid>\\n  <name>instance-00021519</name>\\n<<CUT>>    <interface type=\"bridge\">\\n      <mac address=\"fa:16:3e:2a:f4:73\"/>\\n      <model type=\"e1000\"/>\\n      <source bridge=\"brq6de2c2fb-a7\"/>\\n      <target dev=\"tap99d4e746-ac\"/>\\n    </interface>\\n<<CUT>>',)  to_xml /usr/lib/python2.7/dist-packages/\nnova/virt/libvirt/config.py:82\n\nAfter reboot:\n2016-01-22 15:43:14.070 7788 DEBUG nova.virt.libvirt.config [req-254da7a4-b370-4557-8cf6-e977a6b60bb1 4bb8f720d4c7494bb573b6033015cd0c cfb66212643842ad90d9fb5a83b84d52 - - -] Generated XML ('<domain type=\"kvm\">\\n  <uuid>62f9d3de-7e30-420\ne-b744-a7755ca6ee0f</uuid>\\n  <name>instance-00021519</name>\\n <<CUT>>    <interface type=\"bridge\">\\n      <mac address=\"fa:16:3e:2a:f4:73\"/>\\n      <model type=\"virtio\"/>\\n      <source bridge=\"brq6de2c2fb-a7\"/>\\n      <target dev=\"tap99d4e746-ac\"/>\\n    </interface>\\n<<CUT>>',)  to_xml /usr/lib/python2.7/dist-packages/nova/virt/libvirt/config.py:82", 
            "date_created": "2016-01-22 16:06:32.219241+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomekg"
        }, 
        {
            "content": "hi Tomasz\nI tested from your reproduce steps from latest master branch , but I can not reproduce this issue.\n\ncommit e5b1162703718601fc4df6482c341327f7559da0\nMerge: 778d0a8 7bba58d\nAuthor: Jenkins <email address hidden>\nDate:   Wed Dec 30 01:05:47 2015 +0000\n\n====================\nAfter reboot/stop->start\n\nthe xml difference is :\n\ntaget@taget-ThinkStation-P300:~/devstack/files$ diff 1.xml 2.xml \n1c1\n< <domain type='kvm' id='8'>\n---\n> <domain type='kvm' id='11'>\n8c8\n<       <nova:creationTime>2016-01-26 03:00:41</nova:creationTime>\n---\n>       <nova:creationTime>2016-01-26 03:11:17</nova:creationTime>\n\n\ncan you do a try on master branch?", 
            "date_created": "2016-01-26 03:21:05.422933+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "Eli, when marking incomplete, please unset the owner.", 
            "date_created": "2016-04-18 15:00:50.526326+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Cleanup\n=======\n\nThis bug report has the status \"Incomplete\" since more than 30 days\nand it looks like that there are no open reviews for it. To keep\nthe bug list sane, I close this bug with \"won't fix\". This does not\nmean that it is not a valid bug report, it's more to acknowledge that\nno progress can be expected here anymore. You are still free to push a\nnew patch for this bug. If you could reproduce it on the current master\ncode or on a maintained stable branch, please switch it to \"Confirmed\".", 
            "date_created": "2016-05-24 16:01:53.583999+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}