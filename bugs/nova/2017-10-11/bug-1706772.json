{
    "status": "Fix Released", 
    "last_updated": "2017-08-28 10:43:42.560146+00:00", 
    "description": "The init_host stacktraces on startup, killing the thread:\n\nhttp://logs.openstack.org/49/484949/14/check/gate-tempest-dsvm-ironic-ipa-wholedisk-bios-agent_ipmitool-tinyipa-ubuntu-xenial-nv/69b18d7/logs/screen-n-cpu.txt.gz?level=TRACE\n\nJul 24 22:26:26.423871 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service [None req-414af81a-44e7-4a67-9cbd-74e549deb41b None None] Error starting thread.: InternalServerError: Internal Server Error (HTTP 500)\nJul 24 22:26:26.423993 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service Traceback (most recent call last):\nJul 24 22:26:26.424084 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/oslo_service/service.py\", line 721, in run_service\nJul 24 22:26:26.424167 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     service.start()\nJul 24 22:26:26.424250 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/service.py\", line 143, in start\nJul 24 22:26:26.424330 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     self.manager.init_host()\nJul 24 22:26:26.424417 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1100, in init_host\nJul 24 22:26:26.424498 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     self.driver.init_host(host=self.host)\nJul 24 22:26:26.424638 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/ironic/driver.py\", line 449, in init_host\nJul 24 22:26:26.424717 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     self._refresh_cache()\nJul 24 22:26:26.424798 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/ironic/driver.py\", line 608, in _refresh_cache\nJul 24 22:26:26.425096 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     for node in self._get_node_list(detail=True, limit=0):\nJul 24 22:26:26.425187 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/ironic/driver.py\", line 527, in _get_node_list\nJul 24 22:26:26.425278 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     node_list = self.ironicclient.call(\"node.list\", **kwargs)\nJul 24 22:26:26.425359 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/ironic/client_wrapper.py\", line 146, in call\nJul 24 22:26:26.425440 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     return self._multi_getattr(client, method)(*args, **kwargs)\nJul 24 22:26:26.425536 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/v1/node.py\", line 143, in list\nJul 24 22:26:26.425614 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     limit=limit)\nJul 24 22:26:26.425708 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/common/base.py\", line 149, in _list_pagination\nJul 24 22:26:26.425788 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     resp, body = self.api.json_request('GET', url)\nJul 24 22:26:26.425866 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/common/http.py\", line 558, in json_request\nJul 24 22:26:26.425945 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     resp = self._http_request(url, method, **kwargs)\nJul 24 22:26:26.426027 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/common/http.py\", line 188, in wrapper\nJul 24 22:26:26.426114 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     return func(self, url, method, **kwargs)\nJul 24 22:26:26.426198 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/common/http.py\", line 540, in _http_request\nJul 24 22:26:26.426277 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     error_json.get('debuginfo'), method, url)\nJul 24 22:26:26.426355 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service InternalServerError: Internal Server Error (HTTP 500)\nJul 24 22:26:26.426437 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service\n\nI guess the Ironic API service isn't yet up at that point?", 
    "tags": [
        "compute", 
        "ironic"
    ], 
    "importance": "High", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1706772", 
    "owner": "https://api.launchpad.net/1.0/~ed-leafe", 
    "id": 1706772, 
    "index": 2117, 
    "created": "2017-07-26 20:58:13.564978+00:00", 
    "title": "InternalServerError: Internal Server Error (HTTP 500) in n-cpu logs on startup with Ironic driver", 
    "comments": [
        {
            "content": "Since this change in Pike:\n\nhttps://review.openstack.org/#/c/484949/\n\nThe init_host stacktraces on startup, killing the thread:\n\nhttp://logs.openstack.org/49/484949/14/check/gate-tempest-dsvm-ironic-ipa-wholedisk-bios-agent_ipmitool-tinyipa-ubuntu-xenial-nv/69b18d7/logs/screen-n-cpu.txt.gz?level=TRACE\n\nJul 24 22:26:26.423871 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service [None req-414af81a-44e7-4a67-9cbd-74e549deb41b None None] Error starting thread.: InternalServerError: Internal Server Error (HTTP 500)\nJul 24 22:26:26.423993 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service Traceback (most recent call last):\nJul 24 22:26:26.424084 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/oslo_service/service.py\", line 721, in run_service\nJul 24 22:26:26.424167 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     service.start()\nJul 24 22:26:26.424250 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/service.py\", line 143, in start\nJul 24 22:26:26.424330 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     self.manager.init_host()\nJul 24 22:26:26.424417 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1100, in init_host\nJul 24 22:26:26.424498 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     self.driver.init_host(host=self.host)\nJul 24 22:26:26.424638 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/ironic/driver.py\", line 449, in init_host\nJul 24 22:26:26.424717 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     self._refresh_cache()\nJul 24 22:26:26.424798 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/ironic/driver.py\", line 608, in _refresh_cache\nJul 24 22:26:26.425096 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     for node in self._get_node_list(detail=True, limit=0):\nJul 24 22:26:26.425187 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/ironic/driver.py\", line 527, in _get_node_list\nJul 24 22:26:26.425278 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     node_list = self.ironicclient.call(\"node.list\", **kwargs)\nJul 24 22:26:26.425359 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/opt/stack/new/nova/nova/virt/ironic/client_wrapper.py\", line 146, in call\nJul 24 22:26:26.425440 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     return self._multi_getattr(client, method)(*args, **kwargs)\nJul 24 22:26:26.425536 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/v1/node.py\", line 143, in list\nJul 24 22:26:26.425614 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     limit=limit)\nJul 24 22:26:26.425708 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/common/base.py\", line 149, in _list_pagination\nJul 24 22:26:26.425788 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     resp, body = self.api.json_request('GET', url)\nJul 24 22:26:26.425866 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/common/http.py\", line 558, in json_request\nJul 24 22:26:26.425945 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     resp = self._http_request(url, method, **kwargs)\nJul 24 22:26:26.426027 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/common/http.py\", line 188, in wrapper\nJul 24 22:26:26.426114 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     return func(self, url, method, **kwargs)\nJul 24 22:26:26.426198 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service   File \"/usr/local/lib/python2.7/dist-packages/ironicclient/common/http.py\", line 540, in _http_request\nJul 24 22:26:26.426277 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service     error_json.get('debuginfo'), method, url)\nJul 24 22:26:26.426355 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service InternalServerError: Internal Server Error (HTTP 500)\nJul 24 22:26:26.426437 ubuntu-xenial-osic-cloud1-disk-10052658 nova-compute[13755]: ERROR oslo_service.service \n\nI guess the Ironic API service isn't yet up at that point?", 
            "date_created": "2017-07-26 20:58:13.564978+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Actually this wasn't caused by the migrate instance flavors change mentioned above, it was happening before that as well:\n\nhttp://logs.openstack.org/80/461480/5/check/gate-tempest-dsvm-ironic-ipa-wholedisk-bios-agent_ipmitool-tinyipa-ubuntu-xenial-nv/834477a/logs/screen-n-cpu.txt.gz?level=TRACE#_Jul_19_03_34_01_687299\n\nSo something has thrown off the timing of when nova-compute starts up and when the ironic-api is available.\n\nThis wasn't an issue in Ocata. From Ocata CI logs, the init_host in the driver happens around here:\n\nhttp://logs.openstack.org/63/485263/2/check/gate-tempest-dsvm-ironic-ipa-wholedisk-bios-agent_ipmitool-tinyipa-ubuntu-xenial-nv/de2c924/logs/screen-n-cpu.txt.gz#_2017-07-21_12_07_20_885\n\nAnd then get_available_nodes is here:\n\nhttp://logs.openstack.org/63/485263/2/check/gate-tempest-dsvm-ironic-ipa-wholedisk-bios-agent_ipmitool-tinyipa-ubuntu-xenial-nv/de2c924/logs/screen-n-cpu.txt.gz#_2017-07-21_12_07_21_167\n\nSo that's not blowing up like init_host is blowing up in Pike.", 
            "date_created": "2017-07-26 22:00:46.835492+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Looks like the failure is in ironic-api on startup:\n\nhttp://logs.openstack.org/80/461480/5/check/gate-tempest-dsvm-ironic-ipa-wholedisk-bios-agent_ipmitool-tinyipa-ubuntu-xenial-nv/834477a/logs/screen-ir-api.txt.gz#_Jul_19_03_34_01_680460\n\nJul 19 03:34:01.678194 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]: WARNING keystoneauth.identity.generic.base [-] Failed to discover available identity versions when contacting http://10.0.1.4/identity. Attempting to parse version from URL.: ConnectFailure: Unable to establish connection to http://10.0.1.4/identity: HTTPConnectionPool(host='10.0.1.4', port=80): Max retries exceeded with url: /identity (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f06c5d86050>: Failed to establish a new connection: [Errno 111] ECONNREFUSED',))\nJul 19 03:34:01.680460 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]: INFO eventlet.wsgi.server [-] Traceback (most recent call last):\nJul 19 03:34:01.680615 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/eventlet/wsgi.py\", line 490, in handle_one_response\nJul 19 03:34:01.680747 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     result = self.application(self.environ, start_response)\nJul 19 03:34:01.680907 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/opt/stack/new/ironic/ironic/api/app.py\", line 114, in __call__\nJul 19 03:34:01.681047 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     return self.v1(environ, start_response)\nJul 19 03:34:01.681215 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 131, in __call__\nJul 19 03:34:01.681359 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     resp = self.call_func(req, *args, **self.kwargs)\nJul 19 03:34:01.681488 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 196, in call_func\nJul 19 03:34:01.681622 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     return self.func(req, *args, **kwargs)\nJul 19 03:34:01.681747 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/oslo_middleware/base.py\", line 131, in __call__\nJul 19 03:34:01.681871 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     response = req.get_response(self.application)\nJul 19 03:34:01.682003 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1316, in send\nJul 19 03:34:01.682142 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     application, catch_exc_info=False)\nJul 19 03:34:01.682279 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1280, in call_application\nJul 19 03:34:01.682408 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     app_iter = application(self.environ, start_response)\nJul 19 03:34:01.682541 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/opt/stack/new/ironic/ironic/api/middleware/auth_token.py\", line 59, in __call__\nJul 19 03:34:01.682666 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     return super(AuthTokenMiddleware, self).__call__(env, start_response)\nJul 19 03:34:01.682790 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 131, in __call__\nJul 19 03:34:01.682913 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     resp = self.call_func(req, *args, **self.kwargs)\nJul 19 03:34:01.683038 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 196, in call_func\nJul 19 03:34:01.683176 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     return self.func(req, *args, **kwargs)\nJul 19 03:34:01.683302 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/__init__.py\", line 332, in __call__\nJul 19 03:34:01.683440 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     response = self.process_request(req)\nJul 19 03:34:01.683565 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/__init__.py\", line 623, in process_request\nJul 19 03:34:01.683692 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     resp = super(AuthProtocol, self).process_request(request)\nJul 19 03:34:01.683823 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/__init__.py\", line 405, in process_request\nJul 19 03:34:01.683952 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     allow_expired=allow_expired)\nJul 19 03:34:01.684104 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/__init__.py\", line 435, in _do_fetch_token\nJul 19 03:34:01.684232 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     data = self.fetch_token(token, **kwargs)\nJul 19 03:34:01.684357 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/__init__.py\", line 762, in fetch_token\nJul 19 03:34:01.684494 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     allow_expired=allow_expired)\nJul 19 03:34:01.684618 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/_identity.py\", line 217, in verify_token\nJul 19 03:34:01.684753 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     auth_ref = self._request_strategy.verify_token(\nJul 19 03:34:01.684900 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/_identity.py\", line 168, in _request_strategy\nJul 19 03:34:01.685029 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     strategy_class = self._get_strategy_class()\nJul 19 03:34:01.685167 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/_identity.py\", line 190, in _get_strategy_class\nJul 19 03:34:01.685294 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     if self._adapter.get_endpoint(version=klass.AUTH_VERSION):\nJul 19 03:34:01.685434 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystoneauth1/adapter.py\", line 193, in get_endpoint\nJul 19 03:34:01.685568 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     return self.session.get_endpoint(auth or self.auth, **kwargs)\nJul 19 03:34:01.685698 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystoneauth1/session.py\", line 856, in get_endpoint\nJul 19 03:34:01.685827 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     return auth.get_endpoint(self, **kwargs)\nJul 19 03:34:01.685956 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystoneauth1/identity/base.py\", line 215, in get_endpoint\nJul 19 03:34:01.686093 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     service_catalog = self.get_access(session).service_catalog\nJul 19 03:34:01.686230 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystoneauth1/identity/base.py\", line 136, in get_access\nJul 19 03:34:01.686361 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     self.auth_ref = self.get_auth_ref(session)\nJul 19 03:34:01.686486 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystoneauth1/identity/generic/base.py\", line 196, in get_auth_ref\nJul 19 03:34:01.686616 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     self._plugin = self._do_create_plugin(session)\nJul 19 03:34:01.686751 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:   File \"/usr/local/lib/python2.7/dist-packages/keystoneauth1/identity/generic/base.py\", line 191, in _do_create_plugin\nJul 19 03:34:01.686882 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]:     raise exceptions.DiscoveryFailure('Could not determine a suitable URL '\nJul 19 03:34:01.687011 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]: DiscoveryFailure: Could not determine a suitable URL for the plugin\nJul 19 03:34:01.687147 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]: \nJul 19 03:34:01.689718 ubuntu-xenial-citycloud-la1-9927584 ironic-api[16734]: INFO eventlet.wsgi.server [-] 10.0.1.4 \"GET /v1/nodes/detail HTTP/1.1\" status: 500  len: 139 time: 0.0134780", 
            "date_created": "2017-07-26 22:03:22.443738+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "http://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22DiscoveryFailure%3A%20Could%20not%20determine%20a%20suitable%20URL%20for%20the%20plugin%5C%22%20AND%20tags%3A%5C%22screen-ir-api.txt%5C%22&from=7d", 
            "date_created": "2017-07-26 22:40:31.096375+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "The reason is someone restarting apache at that moment -- http://logs.openstack.org/49/484949/14/check/gate-tempest-dsvm-ironic-ipa-wholedisk-bios-agent_ipmitool-tinyipa-ubuntu-xenial-nv/69b18d7/logs/apache/error.txt.gz. We need to come up with an idea how to work around this (again)", 
            "date_created": "2017-07-27 12:51:03.579032+00:00", 
            "author": "https://api.launchpad.net/1.0/~vdrok"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/487925", 
            "date_created": "2017-07-27 16:01:58.480955+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Note that this fix only smooths the behavior in the ironic driver so that it doesn't crash when this happens.", 
            "date_created": "2017-07-27 17:21:37.362757+00:00", 
            "author": "https://api.launchpad.net/1.0/~ed-leafe"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/491835", 
            "date_created": "2017-08-08 15:16:36.590606+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/487925\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c2d33c3271370358d48553233b41bf9119d834fb\nSubmitter: Jenkins\nBranch:    master\n\ncommit c2d33c3271370358d48553233b41bf9119d834fb\nAuthor: EdLeafe <email address hidden>\nDate:   Wed Jul 26 23:07:38 2017 +0000\n\n    Handle ironicclient failures in Ironic driver\n    \n    The ironic driver uses ironicclient to get the list of nodes from the\n    Ironic service. If that service is not running, or something otherwise\n    prevents the ironicclient's call from succeeding, and unhandled\n    exception will occur. This patch adds a generic exception handler for\n    this call, logging an error and continuing.\n    \n    Co-Authored-By: Lucas Alvares Gomes <email address hidden>\n    \n    Closes-Bug: #1706772\n    \n    Change-Id: I4ebebcf221dfe29e2aa125f5956aec10108f8fbe\n", 
            "date_created": "2017-08-08 17:47:51.229313+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "We're also hitting this issue on our grenade job on ocata http://logs.openstack.org/04/480904/10/check/gate-grenade-dsvm-ironic-ubuntu-xenial/a13a964/logs/new/screen-n-cpu.txt.gz. In this case, placement start causes apache restart, and compute is started at the same time. Will propose a patch to grenade and see if it'll break anything.", 
            "date_created": "2017-08-10 15:24:27.410925+00:00", 
            "author": "https://api.launchpad.net/1.0/~vdrok"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0rc1 release candidate.", 
            "date_created": "2017-08-11 12:26:55.928765+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/491835\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c46f037a0f57710553b5ff8f02bc08ebedf3c5fb\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit c46f037a0f57710553b5ff8f02bc08ebedf3c5fb\nAuthor: EdLeafe <email address hidden>\nDate:   Wed Jul 26 23:07:38 2017 +0000\n\n    Handle ironicclient failures in Ironic driver\n    \n    The ironic driver uses ironicclient to get the list of nodes from the\n    Ironic service. If that service is not running, or something otherwise\n    prevents the ironicclient's call from succeeding, and unhandled\n    exception will occur. This patch adds a generic exception handler for\n    this call, logging an error and continuing.\n    \n    Co-Authored-By: Lucas Alvares Gomes <email address hidden>\n    \n    Closes-Bug: #1706772\n    \n    Conflicts:\n          nova/tests/unit/virt/ironic/test_driver.py\n    \n    NOTE(mriedem): The conflicts in the tests can be ignored since they\n    were just around some boot from volume and flavor migration tests\n    in Pike which don't exist in Ocata. Also, the _LE translation marker\n    has to be added back in for LOG.error in Ocata due to hacking checks.\n    \n    Change-Id: I4ebebcf221dfe29e2aa125f5956aec10108f8fbe\n    (cherry picked from commit c2d33c3271370358d48553233b41bf9119d834fb)\n", 
            "date_created": "2017-08-12 06:18:22.320289+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.7 release.", 
            "date_created": "2017-08-22 11:39:10.319028+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}