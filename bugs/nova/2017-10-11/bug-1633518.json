{
    "status": "Fix Released", 
    "last_updated": "2017-05-04 16:58:12.302265+00:00", 
    "description": "Description\n===========\n\ntl;dr hex(x) previously stripped leading 0's from individual hex numbers while encoding the passphrase back to a hex string before use to encrypt/decrypt a luks volume.\n\nPrior to Newton the following method was used to encode passphrases when attempting to use or create a luks volume :\n\n    def _get_passphrase(self, key):\n        \"\"\"Convert raw key to string.\"\"\"\n        return ''.join(hex(x).replace('0x', '') for x in key)\n\nhttps://github.com/openstack/nova/blob/82190bdd283dda37f7517fd9a268b5e55183f06c/nova/volume/encryptors/cryptsetup.py#L92-L94\n\nThis was replaced in Newton with the move to Castellan in the following change that altered both the decoding and encoding steps :\n\nReplace key manager with Castellan\nhttps://review.openstack.org/#/c/309614/\n\nThe original method used the built-in hex() call to convert individual unsigned ints back to hex. This would strip the leading 0 from each hex digit pair, altering the eventual passphrase used to encrypt or decrypt the volume.\n\nFor example, the following one liner represents both the initial decode step preformed by ConfKeyManager and the step above to encode the passphrase in the LuksEncryptor class :\n\n>>> ''.join(hex(x).replace('0x', '') for x in array.array('B', '752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a'.decode('hex')).tolist())\n'752523eb50c3bf2ba3ff639c2545805fd4e779894ef536e15e081696a'\n\nOriginal string: 752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a\nNew string     : 752523eb50c3bf2ba3ff639c25 4 5805fd4e779894ef536 e15e081696a\n\nThe returned string is missing various 0's that have been stripped by the hex() call :\n\n>>> hex(14)\n'0xe'\n\n>>> int(0x0e)\n14\n\n>>> int(0xe)\n14\n\n>>> hex(4)\n'0x4'\n\n>>> int(0x04)\n4\n\n>>> int(0x4)\n4\n\nThe following one liner represents the current decode and encode steps, producing the same string as is entered :\n\n>>> import binascii\n>>> binascii.hexlify(bytes(binascii.unhexlify('752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a'))).decode('utf-8')\nu'752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a'\n\nOriginal string: 752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a\nNew string     : 752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a\n\nIMHO the way to handle this is to add a simple retry in master and stable/newton when we fail due to a bad passphrase using the mangled passphrase.\n\nWe should also improve the testing in this area as it appears all previous testing used zero based passphrases, missing this issue when it landed in Newton.\n\nMore notes available downstream in the following bug :\n\nNova encryption alters the key used\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1382415\n\nSteps to reproduce\n==================\n- Encrypt a volume in Mitaka or earlier.\n- Upgrade to Newton or later.\n- Attempt to use the volume.\n\nExpected result\n===============\nVolume is decrypted and usable.\n\nActual result\n=============\nUnable to decrypt the volume due to the use of an modified passphrase during initial formatting and use prior to Newton.\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running. See the following\n  list for all releases: http://docs.openstack.org/releases/\n   Newton and later.\n   \n2. Which hypervisor did you use?\n   Libvirt\n\n2. Which storage type did you use?\n   N/A\n\n3. Which networking type did you use?\n   (For example: nova-network, Neutron with OpenVSwitch, ...)\n   N/A\n\nLogs & Configs\n==============\nN/A", 
    "tags": [
        "in-stable-newton"
    ], 
    "importance": "High", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1633518", 
    "owner": "https://api.launchpad.net/1.0/~lyarwood", 
    "id": 1633518, 
    "index": 1998, 
    "created": "2016-10-14 15:15:39.080976+00:00", 
    "title": "The passphrase used to encrypt or decrypt volumes was mangled prior to Newton", 
    "comments": [
        {
            "content": "Description\n===========\n\ntl;dr hex(x) previously stripped leading 0's from individual hex numbers while encoding the passphrase back to a hex string before use to encrypt/decrypt a luks volume.\n\nPrior to Newton the following method was used to encode passphrases when attempting to use or create a luks volume :\n\n    def _get_passphrase(self, key):\n        \"\"\"Convert raw key to string.\"\"\"\n        return ''.join(hex(x).replace('0x', '') for x in key)\n\nhttps://github.com/openstack/nova/blob/82190bdd283dda37f7517fd9a268b5e55183f06c/nova/volume/encryptors/cryptsetup.py#L92-L94\n\nThis was replaced in Newton with the move to Castellan in the following change that altered both the decoding and encoding steps :\n\nReplace key manager with Castellan\nhttps://review.openstack.org/#/c/309614/\n\nThe original method used the built-in hex() call to convert individual unsigned ints back to hex. This would strip the leading 0 from each hex digit pair, altering the eventual passphrase used to encrypt or decrypt the volume.\n\nFor example, the following one liner represents both the initial decode step preformed by ConfKeyManager and the step above to encode the passphrase in the LuksEncryptor class :\n\n>>> ''.join(hex(x).replace('0x', '') for x in array.array('B', '752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a'.decode('hex')).tolist())\n'752523eb50c3bf2ba3ff639c2545805fd4e779894ef536e15e081696a'\n\nOriginal string: 752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a\nNew string     : 752523eb50c3bf2ba3ff639c25 4 5805fd4e779894ef536 e15e081696a\n\nThe returned string is missing various 0's that have been stripped by the hex() call :\n\n>>> hex(14)\n'0xe'\n\n>>> int(0x0e)\n14\n\n>>> int(0xe)\n14\n\n>>> hex(4)\n'0x4'\n\n>>> int(0x04)\n4\n\n>>> int(0x4)\n4\n\nThe following one liner represents the current decode and encode steps, producing the same string as is entered :\n\n>>> import binascii\n>>> binascii.hexlify(bytes(binascii.unhexlify('752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a'))).decode('utf-8')\nu'752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a'\n\nOriginal string: 752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a\nNew string     : 752523eb50c3bf2ba3ff639c250405805fd4e779894ef5360e15e081696a\n\nIMHO the way to handle this is to add a simple retry in master and stable/newton when we fail due to a bad passphrase using the mangled passphrase.\n\nWe should also improve the testing in this area as it appears all previous testing used zero based passphrases, missing this issue when it landed in Newton.\n\nMore notes available downstream in the following bug :\n\nNova encryption alters the key used\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1382415\n\nSteps to reproduce\n==================\n- Encrypt a volume in Mitaka or earlier.\n- Upgrade to Newton or later.\n- Attempt to use the volume.\n\nExpected result\n===============\nVolume is decrypted and usable.\n\nActual result\n=============\nUnable to decrypt the volume due to the use of an modified passphrase during initial formatting and use prior to Newton.\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running. See the following\n  list for all releases: http://docs.openstack.org/releases/\n   Newton and later.\n   \n2. Which hypervisor did you use?\n   Libvirt\n\n2. Which storage type did you use?\n   N/A\n\n3. Which networking type did you use?\n   (For example: nova-network, Neutron with OpenVSwitch, ...)\n   N/A\n\nLogs & Configs\n==============\nN/A", 
            "date_created": "2016-10-14 15:15:39.080976+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyarwood"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/386670", 
            "date_created": "2016-10-14 15:49:14.962972+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This also impacts os-brick that has recently copied the encryptor codebase with change :\n\nCopy encryptors from Nova to os-brick\nhttps://review.openstack.org/#/c/247372/\n\nWe should really try to remove the Nova encryptors this cycle I guess....", 
            "date_created": "2016-10-14 15:57:39.264276+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyarwood"
        }, 
        {
            "content": "I've been asked to document a manual attempt at verifying the current workaround for LuksEncryptor :\n\n- Using a fixed key of 010203040506 (123456 when mangled) :\n\n$ grep fixed_key ../logs/n-cpu.log\n2016-11-10 08:22:44.334 DEBUG oslo_service.service [req-09c9dd4c-ca17-48fb-99b7-21211241e84e None None] key_manager.fixed_key          = 010203040506 from (pid=15466) log_opt_values /usr/lib/python2.7/site-packages/oslo_config/cfg.py:2689\n\n- Create a LUKS volume-type and create a single bootable volume :\n\n$ cinder type-create LUKS\n$ cinder encryption-type-create --cipher aes-xts-plain64 --key_size 512 --control_location front-end LUKS nova.volume.encryptors.luks.LuksEncryptor\n$ cinder create --volume-type LUKS 1\n$ cinder set-bootable c93a9d66-08d7-4ad0-babb-87a2c6fe5cf6 true\n\n- Boot from the volume to ensure it is formatted by Nova :\n\n$ nova boot --boot-volume c93a9d66-08d7-4ad0-babb-87a2c6fe5cf6 --flavor 1 test\n$ nova delete test\n\n- Remove the correct passphrase and replace it with the mangled version used prior to Newton to trigger the workaround :\n\n$ sudo cryptsetup luksAddKey /dev/mapper/stack--volumes--lvmdriver--1-volume--c93a9d66--08d7--4ad0--babb--87a2c6fe5cf6 \nEnter any existing passphrase: 010203040506\nEnter new passphrase for key slot: 123456\nVerify passphrase: 123456\n$ sudo cryptsetup luksRemoveKey /dev/mapper/stack--volumes--lvmdriver--1-volume--c93a9d66--08d7--4ad0--babb--87a2c6fe5cf6 \nEnter passphrase to be deleted: 010203040506\n$ sudo cryptsetup luksDump /dev/mapper/stack--volumes--lvmdriver--1-volume--c93a9d66--08d7--4ad0--babb--87a2c6fe5cf6 \nLUKS header information for /dev/mapper/stack--volumes--lvmdriver--1-volume--c93a9d66--08d7--4ad0--babb--87a2c6fe5cf6\n\nVersion:        1\nCipher name:    aes\nCipher mode:    xts-plain64\nHash spec:      sha256\nPayload offset: 4096\nMK bits:        512\nMK digest:      04 09 bc a9 cb ab fc 3f 65 b2 dd e5 a8 2d 32 b4 37 ec b9 80 \nMK salt:        39 13 31 5a ab 1e ce 63 5e 96 bb d4 26 7d 19 a4 \n                8c 6a 39 79 1a c5 60 3c 2f 16 a2 a4 36 cb 23 64 \nMK iterations:  100500\nUUID:           a3b047cf-4a6a-46bb-bf2c-c38ea7c16fc3\n\nKey Slot 0: DISABLED\nKey Slot 1: ENABLED\n        Iterations:             872230\n        Salt:                   ea c6 19 21 ed 45 ce ce 96 51 08 90 a6 b0 e2 7e \n                                dc 5a 94 f9 c6 f8 d8 90 d2 38 79 fa 21 f0 b7 e0 \n        Key material offset:    512\n        AF stripes:             4000\nKey Slot 2: DISABLED\nKey Slot 3: DISABLED\nKey Slot 4: DISABLED\nKey Slot 5: DISABLED\nKey Slot 6: DISABLED\nKey Slot 7: DISABLED\n\n\n- Boot an instance again using the volume :\n\n$ nova boot --boot-volume c93a9d66-08d7-4ad0-babb-87a2c6fe5cf6 --flavor 1 test\n$ nova delete test\n\n- Reviewing n-cpu.log we can see the WARNING marker highlighting that we are going to attempt to use a mangled passphrase :\n\nn-cpu.log\n\n5123 2016-11-10 08:36:10.666 WARNING nova.volume.encryptors.luks [req-ae0c9bce-54fd-4691-939d-d68808bc81bb admin admin] /dev/sdb is not usable with the current passphrase, attempting to use a mangled passphrase to open the volume.\n[..]\n5143 2016-11-10 08:36:28.919 DEBUG nova.volume.encryptors.luks [req-ae0c9bce-54fd-4691-939d-d68808bc81bb admin admin] /dev/sdb mangled passphrase successfully replaced from (pid=15466) _unmangle_volume \n\n- Reviewing the volume there's still only one slot used and we are now able to open the device with the correct passphrase of 010203040506 :\n\n$ sudo cryptsetup luksDump /dev/mapper/stack--volumes--lvmdriver--1-volume--c93a9d66--08d7--4ad0--babb--87a2c6fe5cf6 \nLUKS header information for /dev/mapper/stack--volumes--lvmdriver--1-volume--c93a9d66--08d7--4ad0--babb--87a2c6fe5cf6\n\nVersion:        1\nCipher name:    aes\nCipher mode:    xts-plain64\nHash spec:      sha256\nPayload offset: 4096\nMK bits:        512\nMK digest:      04 09 bc a9 cb ab fc 3f 65 b2 dd e5 a8 2d 32 b4 37 ec b9 80 \nMK salt:        39 13 31 5a ab 1e ce 63 5e 96 bb d4 26 7d 19 a4 \n                8c 6a 39 79 1a c5 60 3c 2f 16 a2 a4 36 cb 23 64 \nMK iterations:  100500\nUUID:           a3b047cf-4a6a-46bb-bf2c-c38ea7c16fc3\n\nKey Slot 0: ENABLED\n        Iterations:             876710\n        Salt:                   e6 e5 9d 7f d3 71 6c 3a af cb 7e 4f 30 06 2a 5e \n                                fd d2 17 69 eb a9 2a fe 25 ee a5 0e 1c 56 1a 2e \n        Key material offset:    8\n        AF stripes:             4000\nKey Slot 1: DISABLED\nKey Slot 2: DISABLED\nKey Slot 3: DISABLED\nKey Slot 4: DISABLED\nKey Slot 5: DISABLED\nKey Slot 6: DISABLED\nKey Slot 7: DISABLED\n$ sudo cryptsetup luksOpen /dev/mapper/stack--volumes--lvmdriver--1-volume--c93a9d66--08d7--4ad0--babb--87a2c6fe5cf6 test\nEnter passphrase for /dev/mapper/stack--volumes--lvmdriver--1-volume--c93a9d66--08d7--4ad0--babb--87a2c6fe5cf6: 010203040506\n$ lsblk /dev/mapper/test \nNAME MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINT\ntest 253:6    0 1022M  0 crypt \n$ sudo cryptsetup luksClose /dev/mapper/test\n", 
            "date_created": "2016-11-10 13:50:32.324685+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyarwood"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/396217", 
            "date_created": "2016-11-10 14:09:38.432624+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/386670\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=2010c13c0a229531a1ec3c84fb9c05e7310cf824\nSubmitter: Jenkins\nBranch:    master\n\ncommit 2010c13c0a229531a1ec3c84fb9c05e7310cf824\nAuthor: Lee Yarwood <email address hidden>\nDate:   Fri Oct 14 16:41:53 2016 +0100\n\n    encryptors: Workaround mangled passphrases\n    \n    Prior to Ib563b0ea the passphrase used by CryptsetupEncryptor and\n    LuksEncryptor had any leading zeros per hexadecimal digit removed, for\n    example 0x04 or 04 would turn into 0x4 or 4. As a result any volume\n    encrypted prior to the release of Newton used a modified passphrase that\n    was different to that stored by the key manager being used in the\n    environment.\n    \n    To correct this for LuksEncryptor volumes permission denied errors are\n    now caught when attempting to open a volume. A second attempt to open\n    the volume is then made using a mangled passphrase. If successful the\n    correct passphrase is then added to the volume before the mangled\n    passphrase is finally removed. This workaround can be removed in a\n    future release once it is safe to assume that all LuksEncryptor volumes\n    have had any mangled passphrases replaced in this way.\n    \n    This isn't possible for CryptsetupEncryptor volumes as the plain mode\n    used by cryptsetup does not provide a way for adding and removing keys.\n    As such on a permission denied error a second attempt is made to open\n    the volume using a mangled passphrase. Unlike the above workaround this\n    cannot be removed in a future release.\n    \n    Change-Id: I7096463c5eba951dd6322ee6965435e877ca0371\n    Partial-bug: #1633518\n", 
            "date_created": "2016-11-10 15:21:47.007056+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/396288", 
            "date_created": "2016-11-10 15:31:15.141241+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "The following change has also been pushed for os-brick to correct this :\n\nencryptors: Workaround mangled passphrases\nhttps://review.openstack.org/#/c/397934/\n\nAs with the Nova change I've now manually verified this. To do so I also had to use the following change moving Nova to use the os-brick supplied encryptors :\n\nDNM - encryptors: Switch to os-brick encryptor classes\nhttps://review.openstack.org/#/c/391597/\n\n$ cinder type-create LUKS\n$ cinder encryption-type-create --cipher aes-xts-plain64 --key_size 512 --control_location front-end LUKS nova.volume.encryptors.luks.LuksEncryptor\n$ cinder create --volume-type LUKS 1\n$ cinder set-bootable b9567416-f463-44ec-be70-c25977124614 true\n$ nova boot --boot-volume b9567416-f463-44ec-be70-c25977124614 --flavor 1 test                            \n$ nova delete test\n$ sudo cryptsetup luksAddKey /dev/mapper/stack--volumes--lvmdriver--1-volume--b9567416--f463--44ec--be70--c25977124614 \nEnter any existing passphrase: 010203040506\nEnter new passphrase for key slot: 123456\nVerify passphrase: 123456\n$ sudo cryptsetup luksRemoveKey /dev/mapper/stack--volumes--lvmdriver--1-volume--b9567416--f463--44ec--be70--c25977124614 \nEnter passphrase to be deleted: 010203040506\n$ sudo cryptsetup luksDump /dev/mapper/stack--volumes--lvmdriver--1-volume--b9567416--f463--44ec--be70--c25977124614 \nLUKS header information for /dev/mapper/stack--volumes--lvmdriver--1-volume--b9567416--f463--44ec--be70--c25977124614\n\nVersion:        1\nCipher name:    aes\nCipher mode:    xts-plain64\nHash spec:      sha256\nPayload offset: 4096\nMK bits:        512\nMK digest:      e1 48 9b 16 0f 2c 12 b2 e3 0f 59 5b a0 69 cd 2b 77 a8 e5 06 \nMK salt:        ad b8 a8 ad ac c1 99 d8 55 59 7f 16 77 e1 1d 80 \n                0f 14 81 e7 59 ed 39 f0 ce 44 ae f8 11 9a 1f c2 \nMK iterations:  148250\nUUID:           2d841497-ce78-4a67-a778-efeb7d6e17ad\n\nKey Slot 0: DISABLED\nKey Slot 1: ENABLED\n        Iterations:             860503\n        Salt:                   1b a2 86 6a db 7a 99 7d d0 cc 73 bd fe c1 57 04 \n                                22 ec 25 79 18 22 12 68 6a 08 03 22 76 69 18 c2 \n        Key material offset:    512\n        AF stripes:             4000\nKey Slot 2: DISABLED\nKey Slot 3: DISABLED\nKey Slot 4: DISABLED\nKey Slot 5: DISABLED\nKey Slot 6: DISABLED\nKey Slot 7: DISABLED\n\n$ nova boot --boot-volume b9567416-f463-44ec-be70-c25977124614 --flavor 1 test\n$ nova delete test\n$ sudo cryptsetup luksOpen /dev/mapper/stack--volumes--lvmdriver--1-volume--b9567416--f463--44ec--be70--c25977124614 test\nEnter passphrase for /dev/mapper/stack--volumes--lvmdriver--1-volume--b9567416--f463--44ec--be70--c25977124614: 010203040506\n$ sudo cryptsetup luksClose test\n$ sudo cryptsetup luksDump /dev/mapper/stack--volumes--lvmdriver--1-volume--b9567416--f463--44ec--be70--c25977124614                                                                                                  \nLUKS header information for /dev/mapper/stack--volumes--lvmdriver--1-volume--b9567416--f463--44ec--be70--c25977124614\n\nVersion:        1\nCipher name:    aes\nCipher mode:    xts-plain64\nHash spec:      sha256\nPayload offset: 4096\nMK bits:        512\nMK digest:      e1 48 9b 16 0f 2c 12 b2 e3 0f 59 5b a0 69 cd 2b 77 a8 e5 06 \nMK salt:        ad b8 a8 ad ac c1 99 d8 55 59 7f 16 77 e1 1d 80 \n                0f 14 81 e7 59 ed 39 f0 ce 44 ae f8 11 9a 1f c2 \nMK iterations:  148250\nUUID:           2d841497-ce78-4a67-a778-efeb7d6e17ad\n\nKey Slot 0: ENABLED\n        Iterations:             715082\n        Salt:                   8e ee fd f3 d1 e2 ad b4 4d 79 d4 43 ea 93 0b b1 \n                                46 41 4c 75 77 bf dc fa 2a dd f6 03 af 26 fc 32 \n        Key material offset:    8\n        AF stripes:             4000\n\n", 
            "date_created": "2016-11-16 09:19:14.722563+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyarwood"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/396288\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=d0358255f943adc77eb4030f4632cd29f6d04803\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit d0358255f943adc77eb4030f4632cd29f6d04803\nAuthor: Lee Yarwood <email address hidden>\nDate:   Fri Oct 14 16:41:53 2016 +0100\n\n    encryptors: Workaround mangled passphrases\n    \n    Prior to Ib563b0ea the passphrase used by CryptsetupEncryptor and\n    LuksEncryptor had any leading zeros per hexadecimal digit removed, for\n    example 0x04 or 04 would turn into 0x4 or 4. As a result any volume\n    encrypted prior to the release of Newton used a modified passphrase that\n    was different to that stored by the key manager being used in the\n    environment.\n    \n    To correct this for LuksEncryptor volumes permission denied errors are\n    now caught when attempting to open a volume. A second attempt to open\n    the volume is then made using a mangled passphrase. If successful the\n    correct passphrase is then added to the volume before the mangled\n    passphrase is finally removed. This workaround can be removed in a\n    future release once it is safe to assume that all LuksEncryptor volumes\n    have had any mangled passphrases replaced in this way.\n    \n    This isn't possible for CryptsetupEncryptor volumes as the plain mode\n    used by cryptsetup does not provide a way for adding and removing keys.\n    As such on a permission denied error a second attempt is made to open\n    the volume using a mangled passphrase. Unlike the above workaround this\n    cannot be removed in a future release.\n    \n    Change-Id: I7096463c5eba951dd6322ee6965435e877ca0371\n    Partial-bug: #1633518\n    (cherry picked from commit 2010c13c0a229531a1ec3c84fb9c05e7310cf824)\n", 
            "date_created": "2016-11-18 15:51:12.574693+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/397934\nCommitted: https://git.openstack.org/cgit/openstack/os-brick/commit/?id=7e33521a39d5b7478008e5d6ba4c754857edbee9\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7e33521a39d5b7478008e5d6ba4c754857edbee9\nAuthor: Lee Yarwood <email address hidden>\nDate:   Mon Nov 14 14:29:17 2016 +0000\n\n    encryptors: Workaround mangled passphrases\n    \n    Prior to Ib563b0ea the passphrase used by CryptsetupEncryptor and\n    LuksEncryptor had any leading zeros per hexadecimal digit removed, for\n    example 0x04 or 04 would turn into 0x4 or 4. As a result any volume\n    encrypted prior to the release of Newton used a modified passphrase that\n    was different to that stored by the key manager being used in the\n    environment.\n    \n    To correct this for LuksEncryptor volumes permission denied errors are\n    now caught when attempting to open a volume. A second attempt to open\n    the volume is then made using a mangled passphrase. If successful the\n    correct passphrase is then added to the volume before the mangled\n    passphrase is finally removed. This workaround can be removed in a\n    future release once it is safe to assume that all LuksEncryptor volumes\n    have had any mangled passphrases replaced in this way.\n    \n    This isn't possible for CryptsetupEncryptor volumes as the plain mode\n    used by cryptsetup does not provide a way for adding and removing keys.\n    As such on a permission denied error a second attempt is made to open\n    the volume using a mangled passphrase. Unlike the above workaround this\n    cannot be removed in a future release.\n    \n    Change-Id: I7096463c5eba951dd6322ee6965435e877ca0371\n    Partial-bug: #1633518\n", 
            "date_created": "2016-11-30 11:49:47.232225+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/406068", 
            "date_created": "2016-12-02 11:20:53.812739+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/396217\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=7d77fe09e86ef286ab3419282dc7afbb77d5ffd2\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7d77fe09e86ef286ab3419282dc7afbb77d5ffd2\nAuthor: Lee Yarwood <email address hidden>\nDate:   Thu Nov 10 14:03:07 2016 +0000\n\n    Add a releasenote for bug#1633518\n    \n    The code relating to this patch can be seen in:\n    I7096463c5eba951dd6322ee6965435e877ca0371\n    \n    Partial-bug: #1633518\n    Change-Id: I297e138aca52ae10fbfaa50c79cf001fadaf557e\n", 
            "date_created": "2016-12-02 13:25:01.826759+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "lyarwood - AFAIK we do not use ``Fix COmmited`` status, just ``Fix Released``.", 
            "date_created": "2016-12-20 14:13:51.961630+00:00", 
            "author": "https://api.launchpad.net/1.0/~mszankin"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/406068\nCommitted: https://git.openstack.org/cgit/openstack/os-brick/commit/?id=8c401a68bbe52685cbe9122723ff6b7dc921706f\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit 8c401a68bbe52685cbe9122723ff6b7dc921706f\nAuthor: Lee Yarwood <email address hidden>\nDate:   Mon Nov 14 14:29:17 2016 +0000\n\n    encryptors: Workaround mangled passphrases\n    \n    Prior to Ib563b0ea the passphrase used by CryptsetupEncryptor and\n    LuksEncryptor had any leading zeros per hexadecimal digit removed, for\n    example 0x04 or 04 would turn into 0x4 or 4. As a result any volume\n    encrypted prior to the release of Newton used a modified passphrase that\n    was different to that stored by the key manager being used in the\n    environment.\n    \n    To correct this for LuksEncryptor volumes permission denied errors are\n    now caught when attempting to open a volume. A second attempt to open\n    the volume is then made using a mangled passphrase. If successful the\n    correct passphrase is then added to the volume before the mangled\n    passphrase is finally removed. This workaround can be removed in a\n    future release once it is safe to assume that all LuksEncryptor volumes\n    have had any mangled passphrases replaced in this way.\n    \n    This isn't possible for CryptsetupEncryptor volumes as the plain mode\n    used by cryptsetup does not provide a way for adding and removing keys.\n    As such on a permission denied error a second attempt is made to open\n    the volume using a mangled passphrase. Unlike the above workaround this\n    cannot be removed in a future release.\n    \n    Change-Id: I7096463c5eba951dd6322ee6965435e877ca0371\n    Partial-bug: #1633518\n    (cherry picked from commit 7e33521a39d5b7478008e5d6ba4c754857edbee9)\n", 
            "date_created": "2016-12-24 00:21:12.736394+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/462674", 
            "date_created": "2017-05-04 16:58:11.510985+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}