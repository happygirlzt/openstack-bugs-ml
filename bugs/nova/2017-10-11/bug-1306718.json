{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:27:46.023375+00:00", 
    "description": "If an instance's vifs cannot be deleted (because, for example, they were never plugged in the first place), then compute manager will fail trying to delete the instance:\n\n\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 2154, in _shutdown_instance\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     block_device_info)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 956, in destroy\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     destroy_disks)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 992, in cleanup\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     self.unplug_vifs(instance, network_info)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 864, in unplug_vifs\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     self.vif_driver.unplug(instance, vif)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 783, in unplug\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     self.unplug_ovs(instance, vif)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 667, in unplug_ovs\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     self.unplug_ovs_hybrid(instance, vif)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 661, in unplug_ovs_hybrid\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     v2_name)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/linux_net.py\", line 1317, in delete_ovs_vif_port\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     _ovs_vsctl(['del-port', bridge, dev])\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/linux_net.py\", line 1302, in _ovs_vsctl\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     raise exception.AgentError(method=full_args)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher AgentError: Error during following call to agent: ['ovs-vsctl', '--timeout=120', 'del-port', 'br-int', u'qvo81ce661d-1a']", 
    "tags": [
        "icehouse-backport-potential"
    ], 
    "importance": "High", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1306718", 
    "owner": "https://api.launchpad.net/1.0/~danms", 
    "id": 1306718, 
    "index": 1474, 
    "created": "2014-04-11 16:44:03.036452+00:00", 
    "title": "Instances become undelete-able if vif unplugging fails", 
    "comments": [
        {
            "content": "If an instance's vifs cannot be deleted (because, for example, they were never plugged in the first place), then compute manager will fail trying to delete the instance:\n\n\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 2154, in _shutdown_instance\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     block_device_info)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 956, in destroy\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     destroy_disks)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 992, in cleanup\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     self.unplug_vifs(instance, network_info)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 864, in unplug_vifs\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     self.vif_driver.unplug(instance, vif)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 783, in unplug\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     self.unplug_ovs(instance, vif)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 667, in unplug_ovs\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     self.unplug_ovs_hybrid(instance, vif)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 661, in unplug_ovs_hybrid\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     v2_name)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/linux_net.py\", line 1317, in delete_ovs_vif_port\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     _ovs_vsctl(['del-port', bridge, dev])\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/linux_net.py\", line 1302, in _ovs_vsctl\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher     raise exception.AgentError(method=full_args)\n2014-04-11 09:25:27.754 TRACE oslo.messaging.rpc.dispatcher AgentError: Error during following call to agent: ['ovs-vsctl', '--timeout=120', 'del-port', 'br-int', u'qvo81ce661d-1a']", 
            "date_created": "2014-04-11 16:44:03.036452+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/86957", 
            "date_created": "2014-04-11 17:05:24.664467+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/86957\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=b3225581befe14f21b909e176d0a4583b297e031\nSubmitter: Jenkins\nBranch:    master\n\ncommit b3225581befe14f21b909e176d0a4583b297e031\nAuthor: Dan Smith <email address hidden>\nDate:   Fri Apr 11 09:44:27 2014 -0700\n\n    Don't explode if we fail to unplug VIFs after a failed boot\n    \n    Libvirt currently attempts to unplug VIFs after destroying an\n    instance, which can fail if the instance was never built\n    properly in the first place. This patch makes it ignore errors\n    when trying to tear down VIFs during that cleanup. Failure\n    in this case would block the deletion of the instance (which\n    should never happen) and any real failures aren't something\n    we could do anything about.\n    \n    Closes-bug: #1306718\n    \n    Change-Id: I84a4433c3959b8f14e0259be0aa51da1654006c8\n", 
            "date_created": "2014-04-14 20:57:45.923651+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/89653\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e1e140b295ea9ea6fd6cc2b6dc10981020e48adb\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit e1e140b295ea9ea6fd6cc2b6dc10981020e48adb\nAuthor: Dan Smith <email address hidden>\nDate:   Fri Apr 11 09:44:27 2014 -0700\n\n    Don't explode if we fail to unplug VIFs after a failed boot\n    \n    Libvirt currently attempts to unplug VIFs after destroying an\n    instance, which can fail if the instance was never built\n    properly in the first place. This patch makes it ignore errors\n    when trying to tear down VIFs during that cleanup. Failure\n    in this case would block the deletion of the instance (which\n    should never happen) and any real failures aren't something\n    we could do anything about.\n    \n    Closes-bug: #1306718\n    \n    Change-Id: I84a4433c3959b8f14e0259be0aa51da1654006c8\n    (cherry picked from commit b3225581befe14f21b909e176d0a4583b297e031)\n", 
            "date_created": "2014-04-24 03:13:53.554412+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }
    ]
}