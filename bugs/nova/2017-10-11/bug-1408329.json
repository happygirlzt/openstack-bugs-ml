{
    "status": "Fix Released", 
    "last_updated": "2015-01-11 20:57:21.913297+00:00", 
    "description": "I am not able to attach Cinder Juno volumes to instances inside XenServer. My storage node is a PV guest running inside XenServer with 200 GB cinder-volumes VG, and with tgt service configured as follow:\n\n/etc/tgt/targets.conf\n\ninclude /etc/tgt/conf.d/cinder.conf\n# Set the driver. If not specified, defaults to \"iscsi\".\ndefault-driver iscsi\n\n/etc/tgt/conf.d/cinder.conf\n\ninclude /etc/cinder/volumes/*\n\nThe volume is created successfully as I can see it from Horizon dashboard, and also the LUN from tgtadm output:\n\ntgtadm --op show --mode target\n\nTarget 2: iqn.2010-10.org.openstack:volume-bdfb5407-bea9-42d8-8baa-a3dfd0547fe9\n\u00a0\u00a0\u00a0\u00a0System information:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Driver: iscsi\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0State: ready\n\u00a0\u00a0\u00a0\u00a0I_T nexus information:\n\u00a0\u00a0\u00a0\u00a0LUN information:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LUN: 0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Type: controller\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SCSI ID: IET     00020000\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SCSI SN: beaf20\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Size: 0 MB, Block size: 1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Online: Yes\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Removable media: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Prevent removal: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Readonly: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SWP: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thin-provisioning: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Backing store type: null\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Backing store path: None\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Backing store flags:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LUN: 1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Type: disk\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SCSI ID: IET     00020001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SCSI SN: beaf21\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Size: 1074 MB, Block size: 512\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Online: Yes\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Removable media: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Prevent removal: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Readonly: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SWP: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thin-provisioning: No\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Backing store type: rdwr\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Backing store path: /dev/cinder-volumes/volume-bdfb5407-bea9-42d8-8baa-a3dfd0547fe9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Backing store flags:\n\u00a0\u00a0\u00a0\u00a0Account information:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a4ym7KcCR7TZ6sLj8sgm\n\u00a0\u00a0\u00a0\u00a0ACL information:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ALL\n\nWhen I try to attach the volume to an instance, the following error is thrown on compute node:\n\nnova-manage.log\n\nWARNING nova.volume.cinder [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 None] Cinder V1 API is deprecated as of the Juno release, and Nova is still configured to use it. Enable the V2 API in Cinder and set cinder_catalog_info in nova.conf to use it.\n2015-01-07 15:42:56.464 2114 WARNING nova.virt.xenapi.volume_utils [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 None] Ignoring exception ['VDI_IN_USE', 'OpaqueRef:2225b8fb-0a06-f859-0648-09f71aee330e'] when unplugging PBD OpaqueRef:54856f0b-bcca-a114-c96c-a86a528d3761\n2015-01-07 15:42:56.507 2114 ERROR root [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 ] Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 67, in _attach_volume\\n    dev_number, hotplug)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 124, in _attach_volume_to_vm\\n    self._session.VBD.plug(vbd_ref, vm_ref)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/objects.py\", line 84, in plug\\n    synchronized_plug()\\n', '  File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 272, in inner\\n    return f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/objects.py\", line 79, in synchronized_plug\\n    self._call_method(\"plug\", vbd_ref)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/objects.py\", line 59, in _call_method\\n    return self.session.call_xenapi(call, *args)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 187, in call_xenapi\\n    return session.xenapi_request(method, args)\\n', '  File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\\n    result = _parse_result(getattr(self, methodname)(*full_params))\\n', '  File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\\n    raise Failure(result[\\'ErrorDescription\\'])\\n', \"Failure: ['SR_BACKEND_FAILURE_46', '', 'The VDI is not available', '']\\n\"]\n2015-01-07 15:42:56.508 2114 ERROR nova.virt.block_device [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 None] [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Driver failed to attach volume bdfb5407-bea9-42d8-8baa-a3dfd0547fe9 at /dev/xvdd\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Traceback (most recent call last):\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 252, in attach\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     device_type=self['device_type'], encryption=encryption)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/driver.py\", line 416, in attach_volume\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     mountpoint)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 45, in attach_volume\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     instance_name, dev_number, hotplug)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 75, in _attach_volume\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     volume_utils.forget_sr(self._session, sr_ref)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volume_utils.py\", line 240, in forget_sr\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     session.call_xenapi(\"SR.forget\", sr_ref)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 187, in call_xenapi\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     return session.xenapi_request(method, args)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     result = _parse_result(getattr(self, methodname)(*full_params))\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     raise Failure(result['ErrorDescription'])\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Failure: ['SR_HAS_PBD', 'OpaqueRef:ac31db07-fafd-e15e-fe70-3ae7bc64b26c']\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]\n2015-01-07 15:42:57.167 2114 ERROR nova.compute.manager [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 None] [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Failed to attach bdfb5407-bea9-42d8-8baa-a3dfd0547fe9 at /dev/xvdd\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Traceback (most recent call last):\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4559, in _attach_volume\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     do_check_attach=False, do_driver_attach=True)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 46, in wrapped\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     ret_val = method(obj, context, *args, **kwargs)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 261, in attach\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     connector)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 252, in attach\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     device_type=self['device_type'], encryption=encryption)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/driver.py\", line 416, in attach_volume\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     mountpoint)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 45, in attach_volume\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     instance_name, dev_number, hotplug)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 75, in _attach_volume\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     volume_utils.forget_sr(self._session, sr_ref)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volume_utils.py\", line 240, in forget_sr\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     session.call_xenapi(\"SR.forget\", sr_ref)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 187, in call_xenapi\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     return session.xenapi_request(method, args)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     result = _parse_result(getattr(self, methodname)(*full_params))\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     raise Failure(result['ErrorDescription'])\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Failure: ['SR_HAS_PBD', 'OpaqueRef:ac31db07-fafd-e15e-fe70-3ae7bc64b26c']\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]\n2015-01-07 15:42:59.292 2114 ERROR oslo.messaging.rpc.dispatcher [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 ] Exception during message handling: ['SR_HAS_PBD', 'OpaqueRef:ac31db07-fafd-e15e-fe70-3ae7bc64b26c']\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 414, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     payload)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 71, in wrapped\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 298, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     pass\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 284, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 326, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 314, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4549, in attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     do_attach_volume(context, instance, driver_bdm)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 272, in inner\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4547, in do_attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     bdm.destroy(context)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4544, in do_attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return self._attach_volume(context, instance, driver_bdm)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4567, in _attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     self.volume_api.unreserve_volume(context, bdm.volume_id)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4559, in _attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     do_check_attach=False, do_driver_attach=True)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 46, in wrapped\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     ret_val = method(obj, context, *args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 261, in attach\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     connector)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 252, in attach\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     device_type=self['device_type'], encryption=encryption)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/driver.py\", line 416, in attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     mountpoint)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 45, in attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     instance_name, dev_number, hotplug)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 75, in _attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     volume_utils.forget_sr(self._session, sr_ref)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volume_utils.py\", line 240, in forget_sr\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     session.call_xenapi(\"SR.forget\", sr_ref)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 187, in call_xenapi\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return session.xenapi_request(method, args)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     result = _parse_result(getattr(self, methodname)(*full_params))\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     raise Failure(result['ErrorDescription'])\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher Failure: ['SR_HAS_PBD', 'OpaqueRef:ac31db07-fafd-e15e-fe70-3ae7bc64b26c']\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher\n\nNova config file: /etc/nova/nova.conf\n\n[DEFAULT]\nrpc_backend = qpid\nauth_strategy = keystone\n\nnetwork_api_class = nova.network.api.API\nsecurity_group_api = nova\nnetwork_manager = nova.network.manager.FlatDHCPManager\nallow_same_net_traffic = True\nmulti_host = True\nsend_arp_for_ha = True\nshare_dhcp_address = True\nforce_dhcp_release = True\nflat_network_bridge = xenbr0\nflat_interface = eth1\npublic_interface = eth0\nvolume_api_class=nova.volume.cinder.API\n\nfirewall_driver = nova.virt.xenapi.firewall.Dom0IptablesFirewallDriver\nvolume_api_class=nova.volume.cinder.API\ndebug = True\nverbose = True\n\nqpid_hostname=192.168.1.7\nqpid_port=5672\n\nCinder config file: /etc/cinder/cinder.conf\n\n[DEFAULT]\nrpc_backend = qpid\nauth_strategy = keystone\nmy_ip = 192.168.1.107\nglance_host = 192.168.1.7\niscsi_helper = tgtadm\nverbose = True\n\nenabled_backends=lvm\n\nvolume.log\n\n2015-01-07 15:42:04.726 INFO cinder.brick.iscsi.iscsi [req-1b493d4d-18d7-4be9-9c23-0edf17a2c9ce 4389a9a7146844c0806ed9b756c69b0d e303a4d222b04e9f9217d1366eb8d945 - - -] Creating iscsi_target for: volume-bdfb5407-bea9-42d8-8baa-a3dfd0547fe9\n2015-01-07 15:42:04.794 2162 INFO cinder.volume.manager [-] Updating volume status\n2015-01-07 15:42:05.048 2162 INFO cinder.volume.manager [-] Updating volume replication status.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1408329", 
    "owner": "https://api.launchpad.net/1.0/~bhnedo", 
    "id": 1408329, 
    "index": 5366, 
    "created": "2015-01-07 15:02:47.957204+00:00", 
    "title": "Error attaching volumes to instances on XenServer ", 
    "comments": [
        {
            "content": "I am not able to attach Cinder volumes to instances inside XenServer. My storage node is a PV guest inside XenServer with 200 GB cinder-volumes VG, and with tgt service configured as follow:\n\n/etc/tgt/targets.conf\n\ninclude /etc/tgt/conf.d/cinder.conf\n# Set the driver. If not specified, defaults to \"iscsi\".\ndefault-driver iscsi\n\n/etc/tgt/conf.d/cinder.conf\n\ninclude /etc/cinder/volumes/*\n\nThe volume is created successfully as I can see it from Horizon dashboard, and also the LUN from tgtadm output:\n\n\ntgtadm --op show --mode target\n\nTarget 2: iqn.2010-10.org.openstack:volume-bdfb5407-bea9-42d8-8baa-a3dfd0547fe9\n    System information:\n        Driver: iscsi\n        State: ready\n    I_T nexus information:\n    LUN information:\n        LUN: 0\n            Type: controller\n            SCSI ID: IET     00020000\n            SCSI SN: beaf20\n            Size: 0 MB, Block size: 1\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            SWP: No\n            Thin-provisioning: No\n            Backing store type: null\n            Backing store path: None\n            Backing store flags:\n        LUN: 1\n            Type: disk\n            SCSI ID: IET     00020001\n            SCSI SN: beaf21\n            Size: 1074 MB, Block size: 512\n            Online: Yes\n            Removable media: No\n            Prevent removal: No\n            Readonly: No\n            SWP: No\n            Thin-provisioning: No\n            Backing store type: rdwr\n            Backing store path: /dev/cinder-volumes/volume-bdfb5407-bea9-42d8-8baa-a3dfd0547fe9\n            Backing store flags:\n    Account information:\n        a4ym7KcCR7TZ6sLj8sgm\n    ACL information:\n        ALL\n\nWhen I try to attach the volume to an instance, the following error is thrown on compute node:\n\nnova-manage.log\n\n\nWARNING nova.volume.cinder [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 None] Cinder V1 API is deprecated as of the Juno release, and Nova is still configured to use it. Enable the V2 API in Cinder and set cinder_catalog_info in nova.conf to use it.\n2015-01-07 15:42:56.464 2114 WARNING nova.virt.xenapi.volume_utils [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 None] Ignoring exception ['VDI_IN_USE', 'OpaqueRef:2225b8fb-0a06-f859-0648-09f71aee330e'] when unplugging PBD OpaqueRef:54856f0b-bcca-a114-c96c-a86a528d3761\n2015-01-07 15:42:56.507 2114 ERROR root [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 ] Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 67, in _attach_volume\\n    dev_number, hotplug)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 124, in _attach_volume_to_vm\\n    self._session.VBD.plug(vbd_ref, vm_ref)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/objects.py\", line 84, in plug\\n    synchronized_plug()\\n', '  File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 272, in inner\\n    return f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/objects.py\", line 79, in synchronized_plug\\n    self._call_method(\"plug\", vbd_ref)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/objects.py\", line 59, in _call_method\\n    return self.session.call_xenapi(call, *args)\\n', '  File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 187, in call_xenapi\\n    return session.xenapi_request(method, args)\\n', '  File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\\n    result = _parse_result(getattr(self, methodname)(*full_params))\\n', '  File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\\n    raise Failure(result[\\'ErrorDescription\\'])\\n', \"Failure: ['SR_BACKEND_FAILURE_46', '', 'The VDI is not available', '']\\n\"]\n2015-01-07 15:42:56.508 2114 ERROR nova.virt.block_device [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 None] [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Driver failed to attach volume bdfb5407-bea9-42d8-8baa-a3dfd0547fe9 at /dev/xvdd\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Traceback (most recent call last):\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 252, in attach\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     device_type=self['device_type'], encryption=encryption)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/driver.py\", line 416, in attach_volume\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     mountpoint)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 45, in attach_volume\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     instance_name, dev_number, hotplug)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 75, in _attach_volume\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     volume_utils.forget_sr(self._session, sr_ref)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volume_utils.py\", line 240, in forget_sr\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     session.call_xenapi(\"SR.forget\", sr_ref)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 187, in call_xenapi\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     return session.xenapi_request(method, args)\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     result = _parse_result(getattr(self, methodname)(*full_params))\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     raise Failure(result['ErrorDescription'])\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Failure: ['SR_HAS_PBD', 'OpaqueRef:ac31db07-fafd-e15e-fe70-3ae7bc64b26c']\n2015-01-07 15:42:56.508 2114 TRACE nova.virt.block_device [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]\n2015-01-07 15:42:57.167 2114 ERROR nova.compute.manager [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 None] [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Failed to attach bdfb5407-bea9-42d8-8baa-a3dfd0547fe9 at /dev/xvdd\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Traceback (most recent call last):\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4559, in _attach_volume\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     do_check_attach=False, do_driver_attach=True)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 46, in wrapped\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     ret_val = method(obj, context, *args, **kwargs)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 261, in attach\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     connector)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 252, in attach\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     device_type=self['device_type'], encryption=encryption)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/driver.py\", line 416, in attach_volume\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     mountpoint)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 45, in attach_volume\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     instance_name, dev_number, hotplug)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 75, in _attach_volume\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     volume_utils.forget_sr(self._session, sr_ref)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volume_utils.py\", line 240, in forget_sr\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     session.call_xenapi(\"SR.forget\", sr_ref)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 187, in call_xenapi\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     return session.xenapi_request(method, args)\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     result = _parse_result(getattr(self, methodname)(*full_params))\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]     raise Failure(result['ErrorDescription'])\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6] Failure: ['SR_HAS_PBD', 'OpaqueRef:ac31db07-fafd-e15e-fe70-3ae7bc64b26c']\n2015-01-07 15:42:57.167 2114 TRACE nova.compute.manager [instance: 1fe0b7f2-ddeb-4edc-9375-12097502ecd6]\n2015-01-07 15:42:59.292 2114 ERROR oslo.messaging.rpc.dispatcher [req-8cc840c2-1192-4d8a-a71f-d028e6552f29 ] Exception during message handling: ['SR_HAS_PBD', 'OpaqueRef:ac31db07-fafd-e15e-fe70-3ae7bc64b26c']\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 414, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     payload)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 71, in wrapped\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 298, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     pass\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 284, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 326, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 314, in decorated_function\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4549, in attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     do_attach_volume(context, instance, driver_bdm)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 272, in inner\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4547, in do_attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     bdm.destroy(context)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4544, in do_attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return self._attach_volume(context, instance, driver_bdm)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4567, in _attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     self.volume_api.unreserve_volume(context, bdm.volume_id)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4559, in _attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     do_check_attach=False, do_driver_attach=True)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 46, in wrapped\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     ret_val = method(obj, context, *args, **kwargs)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 261, in attach\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     connector)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/block_device.py\", line 252, in attach\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     device_type=self['device_type'], encryption=encryption)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/driver.py\", line 416, in attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     mountpoint)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 45, in attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     instance_name, dev_number, hotplug)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volumeops.py\", line 75, in _attach_volume\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     volume_utils.forget_sr(self._session, sr_ref)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/volume_utils.py\", line 240, in forget_sr\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     session.call_xenapi(\"SR.forget\", sr_ref)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 187, in call_xenapi\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     return session.xenapi_request(method, args)\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     result = _parse_result(getattr(self, methodname)(*full_params))\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher     raise Failure(result['ErrorDescription'])\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher Failure: ['SR_HAS_PBD', 'OpaqueRef:ac31db07-fafd-e15e-fe70-3ae7bc64b26c']\n2015-01-07 15:42:59.292 2114 TRACE oslo.messaging.rpc.dispatcher\n\nNova config file: /etc/nova/nova.conf\n\n[DEFAULT]\nrpc_backend = qpid\nauth_strategy = keystone\n\nnetwork_api_class = nova.network.api.API\nsecurity_group_api = nova\nnetwork_manager = nova.network.manager.FlatDHCPManager\nallow_same_net_traffic = True\nmulti_host = True\nsend_arp_for_ha = True\nshare_dhcp_address = True\nforce_dhcp_release = True\nflat_network_bridge = xenbr0\nflat_interface = eth1\npublic_interface = eth0\nvolume_api_class=nova.volume.cinder.API\n\nfirewall_driver = nova.virt.xenapi.firewall.Dom0IptablesFirewallDriver\nvolume_api_class=nova.volume.cinder.API\ndebug = True\nverbose = True\n\n\nqpid_hostname=192.168.1.7\nqpid_port=5672\n\nCinder config file: /etc/cinder/cinder.conf\n\n\n\n[DEFAULT]\nrpc_backend = qpid\nauth_strategy = keystone\nmy_ip = 192.168.1.107\nglance_host = 192.168.1.7\niscsi_helper = tgtadm\nverbose = True\n\nenabled_backends=lvm\n\n\nvolume.log\n\n2015-01-07 15:42:04.726 INFO cinder.brick.iscsi.iscsi [req-1b493d4d-18d7-4be9-9c23-0edf17a2c9ce 4389a9a7146844c0806ed9b756c69b0d e303a4d222b04e9f9217d1366eb8d945 - - -] Creating iscsi_target for: volume-bdfb5407-bea9-42d8-8baa-a3dfd0547fe9\n2015-01-07 15:42:04.794 2162 INFO cinder.volume.manager [-] Updating volume status\n2015-01-07 15:42:05.048 2162 INFO cinder.volume.manager [-] Updating volume replication status.", 
            "date_created": "2015-01-07 15:02:47.957204+00:00", 
            "author": "https://api.launchpad.net/1.0/~bhnedo"
        }, 
        {
            "content": "I decided to downgrade from XenServer Creedence RC to XenServer 6.2 with multipathing disabled, and then I was able to mount volumes successfully, but then I got stuck with another problem. Partitions failed to create and format, and I was getting a lot of \"net eth0: rx->offset 4294967295\" messages on the storage node. After hours of googling I finally found the solution.\n\nAll you need is to issue \"ethtool -K vifX.0 tx off\" command from Dom0, where X is the domain id of your cinder VM.\n\n(Execute \"xe vm-list params=dom-id,name-label\" to found out the domain id)", 
            "date_created": "2015-01-11 20:55:52.905504+00:00", 
            "author": "https://api.launchpad.net/1.0/~bhnedo"
        }
    ]
}