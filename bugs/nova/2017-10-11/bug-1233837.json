{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 08:50:00.298021+00:00", 
    "description": "If a exception is encountered in _login_storage_target or _get_mounted_disk_from_lun target_iqn will be referenced in the exception handler before it is defined resulting in the following traceback:\n\nc39117134492490cba81828d080895b5 1a26ee4f153e438c806203607a0d728e] Exception during message handling\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\amqp.py\", line 461, in _process_data\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\dispatcher.py\", line 172, in dispatch\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 90, in wrapped\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 73, in wrapped\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 249, in decorated_function\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     pass\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 235, in decorated_function\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 277, in decorated_function\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 264, in decorated_function\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 3676, in attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     context, instance, mountpoint)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 3671, in attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     mountpoint, instance)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 3717, in _attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     connector)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 3707, in _attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     encryption=encryption)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\driver.py\", line 72, in attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     instance['name'])\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\volumeops.py\", line 143, in attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     self._volutils.logout_storage_target(target_iqn)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp UnboundLocalError: local variable 'target_iqn' referenced before assignment", 
    "tags": [
        "hyper-v"
    ], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1233837", 
    "owner": "https://api.launchpad.net/1.0/~jsbryant", 
    "id": 1233837, 
    "index": 3629, 
    "created": "2013-10-01 20:28:15.664918+00:00", 
    "title": "target_iqn is referenced before assignment after exceptions in hyperv/volumeop.py attch_volume()", 
    "comments": [
        {
            "content": "If a exception is encountered in _login_storage_target or _get_mounted_disk_from_lun target_iqn will be referenced in the exception handler before it is defined resulting in the following traceback:\n\nc39117134492490cba81828d080895b5 1a26ee4f153e438c806203607a0d728e] Exception during message handling\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\amqp.py\", line 461, in _process_data\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\dispatcher.py\", line 172, in dispatch\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 90, in wrapped\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 73, in wrapped\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 249, in decorated_function\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     pass\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 235, in decorated_function\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 277, in decorated_function\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 264, in decorated_function\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 3676, in attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     context, instance, mountpoint)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 3671, in attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     mountpoint, instance)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 3717, in _attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     connector)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 3707, in _attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     encryption=encryption)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\driver.py\", line 72, in attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     instance['name'])\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\volumeops.py\", line 143, in attach_volume\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp     self._volutils.logout_storage_target(target_iqn)\n2013-10-01 16:06:19.993 5588 TRACE nova.openstack.common.rpc.amqp UnboundLocalError: local variable 'target_iqn' referenced before assignment", 
            "date_created": "2013-10-01 20:28:15.664918+00:00", 
            "author": "https://api.launchpad.net/1.0/~jsbryant"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/49259", 
            "date_created": "2013-10-01 21:04:29.885192+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/49259\nCommitted: http://github.com/openstack/nova/commit/9baa186ebb578205c513c94fc621e254f4c13a08\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9baa186ebb578205c513c94fc621e254f4c13a08\nAuthor: Jay S. Bryant <email address hidden>\nDate:   Tue Oct 1 15:59:34 2013 -0500\n\n    hyperv: Initialize target_iqn in attach_volume\n    \n    The target_iqn is referenced before it is declared in the\n    case that an exception is encountered in _login_storage_target\n    or _get_mounted_disk_from_lun.  This causes the exception path\n    to cause an additional, misleading, traceback to be printed\n    after an exception is encountered.\n    \n    This commit initializes target_iqn at the beginning of\n    attach_volume to avoid the traceback.\n    \n    Change-Id: I1cdfb9dfa054ee4f4f6918d7bc49081ccaebab9d\n    Close-Bug: 1233837\n", 
            "date_created": "2013-10-22 11:13:30.335949+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/havana\nReview: https://review.openstack.org/53885", 
            "date_created": "2013-10-25 15:24:56.859953+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/53885\nCommitted: http://github.com/openstack/nova/commit/3432e99268456ad77c9abb0ea0af1ef5a18d2929\nSubmitter: Jenkins\nBranch:    stable/havana\n\ncommit 3432e99268456ad77c9abb0ea0af1ef5a18d2929\nAuthor: Jay S. Bryant <email address hidden>\nDate:   Tue Oct 1 15:59:34 2013 -0500\n\n    hyperv: Initialize target_iqn in attach_volume\n    \n    The target_iqn is referenced before it is declared in the\n    case that an exception is encountered in _login_storage_target\n    or _get_mounted_disk_from_lun.  This causes the exception path\n    to cause an additional, misleading, traceback to be printed\n    after an exception is encountered.\n    \n    This commit initializes target_iqn at the beginning of\n    attach_volume to avoid the traceback.\n    \n    Closes-Bug: 1233837\n    Change-Id: I1cdfb9dfa054ee4f4f6918d7bc49081ccaebab9d\n    (cherry picked from commit 9baa186ebb578205c513c94fc621e254f4c13a08)\n", 
            "date_created": "2013-11-18 07:58:07.158738+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}