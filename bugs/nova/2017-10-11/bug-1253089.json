{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:02:26.592963+00:00", 
    "description": "when port the following test into v3: \n        meta = {'meta1': 'data1'}\n        self.assertRaises(exceptions.BadRequest,\n                          self.client.set_server_metadata,\n                          self.server_id, meta=meta, no_metadata_field=True)\nThe post body will be empty.\n\nwhen the following action in server_metadata, receive the request will raise a TypeError, but expected_errors will return response with code 500. I think it should be BadRequest (code 400) like v2 api.\n def update_all(self, req, server_id, body):\n\nthe following is the nova log:\n2013-11-20 21:44:44.893 DEBUG routes.middleware [-] Matched PUT /servers/92875aa6-fe0a-47ed-91ec-ff178b0f8de5/metadata from (pid=32588) __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:100\n2013-11-20 21:44:44.893 DEBUG routes.middleware [-] Route path: '/servers/{server_id}/metadata', defaults: {'action': u'update_all', 'controller': <nova.api.openstack.wsgi.Resource object at 0x4083e50>} from (pid=32588) __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:102\n2013-11-20 21:44:44.894 DEBUG routes.middleware [-] Match dict: {'action': u'update_all', 'server_id': u'92875aa6-fe0a-47ed-91ec-ff178b0f8de5', 'controller': <nova.api.openstack.wsgi.Resource object at 0x4083e50>} from (pid=32588) __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:103\n2013-11-20 21:44:44.896 DEBUG nova.api.openstack.wsgi [req-42c461b8-6104-4a00-89c2-0d7d2a313735 demo demo] Empty body provided in request from (pid=32588) get_body /opt/stack/nova/nova/api/openstack/wsgi.py:841\n2013-11-20 21:44:44.897 DEBUG nova.api.openstack.wsgi [req-42c461b8-6104-4a00-89c2-0d7d2a313735 demo demo] Calling method <bound method ServerMetadataController.update_all of <nova.api.openstack.compute.plugins.v3.server_metadata.ServerMetadataController object at 0x40832d0>> from (pid=32588) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:964\n2013-11-20 21:44:44.897 ERROR nova.api.openstack.extensions [req-42c461b8-6104-4a00-89c2-0d7d2a313735 demo demo] Unexpected exception in API method\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 470, in wrapped\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions TypeError: update_all() takes exactly 4 arguments (3 given)\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions \n2013-11-20 21:44:44.898 INFO nova.api.openstack.wsgi [req-42c461b8-6104-4a00-89c2-0d7d2a313735 demo demo] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'>", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1253089", 
    "owner": "https://api.launchpad.net/1.0/~ivan-zhu", 
    "id": 1253089, 
    "index": 4300, 
    "created": "2013-11-20 14:00:57.636406+00:00", 
    "title": "An Unexpected API Error return when call nova v3 api with not enough parameters", 
    "comments": [
        {
            "content": "when port the following test into v3: \n        meta = {'meta1': 'data1'}\n        self.assertRaises(exceptions.BadRequest,\n                          self.client.set_server_metadata,\n                          self.server_id, meta=meta, no_metadata_field=True)\nThe post body will be empty.\n\nwhen the following action in server_metadata, receive the request will raise a TypeError, but expected_errors will return response with code 500. I think it should be BadRequest (code 400) like v2 api.\n def update_all(self, req, server_id, body):\n\nthe following is the nova log:\n2013-11-20 21:44:44.893 DEBUG routes.middleware [-] Matched PUT /servers/92875aa6-fe0a-47ed-91ec-ff178b0f8de5/metadata from (pid=32588) __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:100\n2013-11-20 21:44:44.893 DEBUG routes.middleware [-] Route path: '/servers/{server_id}/metadata', defaults: {'action': u'update_all', 'controller': <nova.api.openstack.wsgi.Resource object at 0x4083e50>} from (pid=32588) __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:102\n2013-11-20 21:44:44.894 DEBUG routes.middleware [-] Match dict: {'action': u'update_all', 'server_id': u'92875aa6-fe0a-47ed-91ec-ff178b0f8de5', 'controller': <nova.api.openstack.wsgi.Resource object at 0x4083e50>} from (pid=32588) __call__ /usr/lib/python2.7/dist-packages/routes/middleware.py:103\n2013-11-20 21:44:44.896 DEBUG nova.api.openstack.wsgi [req-42c461b8-6104-4a00-89c2-0d7d2a313735 demo demo] Empty body provided in request from (pid=32588) get_body /opt/stack/nova/nova/api/openstack/wsgi.py:841\n2013-11-20 21:44:44.897 DEBUG nova.api.openstack.wsgi [req-42c461b8-6104-4a00-89c2-0d7d2a313735 demo demo] Calling method <bound method ServerMetadataController.update_all of <nova.api.openstack.compute.plugins.v3.server_metadata.ServerMetadataController object at 0x40832d0>> from (pid=32588) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:964\n2013-11-20 21:44:44.897 ERROR nova.api.openstack.extensions [req-42c461b8-6104-4a00-89c2-0d7d2a313735 demo demo] Unexpected exception in API method\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions Traceback (most recent call last):\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 470, in wrapped\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions     return f(*args, **kwargs)\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions TypeError: update_all() takes exactly 4 arguments (3 given)\n2013-11-20 21:44:44.897 TRACE nova.api.openstack.extensions \n2013-11-20 21:44:44.898 INFO nova.api.openstack.wsgi [req-42c461b8-6104-4a00-89c2-0d7d2a313735 demo demo] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.TypeError'>", 
            "date_created": "2013-11-20 14:00:57.636406+00:00", 
            "author": "https://api.launchpad.net/1.0/~ivan-zhu"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/57447", 
            "date_created": "2013-11-20 14:47:20.463330+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/57447\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8f3d312a98dfa3f8a077b539d7d1adc5f3377987\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8f3d312a98dfa3f8a077b539d7d1adc5f3377987\nAuthor: ivan-zhu <email address hidden>\nDate:   Wed Nov 20 22:34:49 2013 +0800\n\n    pass the empty body into the controller\n    \n    This allows POST and PUT reqeusts without content-body. The\n    default body: None will be passed into the controller, and\n    will be validated in the controller, so it fixes the bug 1253089.\n    \n    When the request method is GET or DELETE, the content-type\n    and body in the request will be ignored\n    .\n    When POST or PUT a request with body but without content-type,\n    it will return \"unsupported the content-type provided\" with\n    response code 400.\n    \n    side-effect: The method which handle the request method: POST\n    or PUT must have the parameter: body. Otherwise, it will raise:\n    \"got an unexpected keyword argument 'body'\"\n    \n    And some tests are updated due to this change.\n    The parameter: body are also added for some actions which are\n    mapped to the method: POST or PUT.\n    \n    Closes-bug: 1253089\n    \n    Change-Id: Icda59feed439625bbbe079444feeda57576ef131\n", 
            "date_created": "2013-12-23 16:02:47.964909+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}