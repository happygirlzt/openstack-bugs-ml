{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:25:04.394702+00:00", 
    "description": "Currently test_network_basic_ops in Tempest has been failing for quite a while using the OVS plugin.\n\nThe problem is nova.virt.firewall.instance_rules is passing the conductor api object as a network parameter to quantumv2.api.get_instance_nw_info().\n\nCalled in nova.virt.firewall.instance_rules:\n    nw_info = nw_api.get_instance_nw_info(ctxt, instance, capi)\n\nMethod definition in nova.network.quantumv2.api:\n    def get_instance_nw_info(self, context, instance, networks=None, conductor_api=None)\n\n--\n\nBelow is the error log when running \"nosetests tempest/tests/network/test_network_basic_ops.py\"\n\n2013-03-22 16:00:29.059 ERROR nova.compute.manager [req-2434167a-94b0-4fd2-8f94-fd1bb92e680f demo demo] [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63] Instance failed to spawn\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63] Traceback (most recent call last):\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1058, in _spawn\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     block_device_info)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1520, in spawn\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     block_device_info)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0\n-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2434, in _create_domain_and_network\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     self.firewall_driver.prepare_instance_filter(instance, network_info)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/virt/firewall.py\", line 193, in prepare_instance_filter\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     ipv4_rules, ipv6_rules = self.instance_rules(instance, network_info)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/virt/firewall.py\", line 422, in instance_rules\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     capi)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 358, in get_instance_nw_info\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     result = self._get_instance_nw_info(context, instance, networks)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 366, in _get_instance_nw_info\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     nw_info = self._build_network_info_model(context, instance, networks)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 788, in _build_network_info_model\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     [n['id'] for n in networks])\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63] TypeError: 'API' object is not iterable\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1158679", 
    "owner": "https://api.launchpad.net/1.0/~zyluo", 
    "id": 1158679, 
    "index": 3310, 
    "created": "2013-03-22 08:50:24.866685+00:00", 
    "title": "get_instance_nw_info() passing wrong parameter to quantum api", 
    "comments": [
        {
            "content": "Currently test_network_basic_ops in Tempest has been failing for quite a while using the OVS plugin.\n\nThe problem is nova.virt.firewall.instance_rules is passing the conductor api object as a network parameter to quantumv2.api.get_instance_nw_info().\n\nCalled in nova.virt.firewall.instance_rules\nnw_info = nw_api.get_instance_nw_info(ctxt, instance, capi)\n\nMethod definition in nova.network.quantumv2.api:\ndef get_instance_nw_info(self, context, instance, networks=None, conductor_api=None)\n\n--\n\nBelow is the error log when running \"nosetests tempest/tests/network/test_network_basic_ops.py\"\n\n2013-03-22 16:00:29.059 ERROR nova.compute.manager [req-2434167a-94b0-4fd2-8f94-fd1bb92e680f demo demo] [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63] Instance failed to spawn\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63] Traceback (most recent call last):\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1058, in _spawn\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     block_device_info)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1520, in spawn\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     block_device_info)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0\n-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2434, in _create_domain_and_network\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     self.firewall_driver.prepare_instance_filter(instance, network_info)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/virt/firewall.py\", line 193, in prepare_instance_filter\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     ipv4_rules, ipv6_rules = self.instance_rules(instance, network_info)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/virt/firewall.py\", line 422, in instance_rules\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     capi)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 358, in get_instance_nw_info\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     result = self._get_instance_nw_info(context, instance, networks)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 366, in _get_instance_nw_info\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     nw_info = self._build_network_info_model(context, instance, networks)\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 788, in _build_network_info_model\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]     [n['id'] for n in networks])\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63] TypeError: 'API' object is not iterable\n2013-03-22 16:00:29.059 TRACE nova.compute.manager [instance: 7c9fd9a9-72b4-48b0-8caa-4b03482a9b63]", 
            "date_created": "2013-03-22 08:50:24.866685+00:00", 
            "author": "https://api.launchpad.net/1.0/~zyluo"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/25115", 
            "date_created": "2013-03-22 08:57:45.747553+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/25115\nCommitted: http://github.com/openstack/nova/commit/67628c56caf9d84588a92448880ecdb33eea08b4\nSubmitter: Jenkins\nBranch:    master\n\ncommit 67628c56caf9d84588a92448880ecdb33eea08b4\nAuthor: Zhongyue Luo <email address hidden>\nDate:   Fri Mar 22 16:50:21 2013 +0800\n\n    Fixes passing arbitrary conductor_api argument\n    \n    Fixes bug #1158679\n    \n    Change-Id: Iabe1f58b6139f5619e328a986143e8591b3a02cc\n", 
            "date_created": "2013-03-22 16:00:15.195841+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: milestone-proposed\nReview: https://review.openstack.org/25398", 
            "date_created": "2013-03-26 14:56:13.625837+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/25398\nCommitted: http://github.com/openstack/nova/commit/2df099a66d62bd22e2cf2f8c1c85975b3f3dda0b\nSubmitter: Jenkins\nBranch:    milestone-proposed\n\ncommit 2df099a66d62bd22e2cf2f8c1c85975b3f3dda0b\nAuthor: Zhongyue Luo <email address hidden>\nDate:   Fri Mar 22 16:50:21 2013 +0800\n\n    Fixes passing arbitrary conductor_api argument\n    \n    Fixes bug #1158679\n    \n    Change-Id: Iabe1f58b6139f5619e328a986143e8591b3a02cc\n    (cherry picked from commit 67628c56caf9d84588a92448880ecdb33eea08b4)\n", 
            "date_created": "2013-03-26 17:30:42.894627+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}