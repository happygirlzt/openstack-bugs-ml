{
    "status": "Confirmed", 
    "last_updated": "2017-10-06 17:14:59.236233+00:00", 
    "description": "When rebuild an volume-backed instance using normal images from glance, \nnothing will be changed for the instance after rebuild except the image name\nwill be added to the instance, the instance is actually again built using the same\nvolume.\n\nroot@zheng-dev1:/var/log/nova# nova boot --flavor 1 --boot-volume daaddb77-4257-4ccd-86f2-220b31a0ce9b --nic net-id=8744ee96-7690-43bb-89b4-fcac805557bc test_rebuild\n+--------------------------------------+--------------------------------------------------+\n| Property                             | Value                                            |\n+--------------------------------------+--------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                           |\n| OS-EXT-AZ:availability_zone          | nova                                             |\n| OS-EXT-SRV-ATTR:host                 | -                                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000001a                                |\n| OS-EXT-STS:power_state               | 0                                                |\n| OS-EXT-STS:task_state                | scheduling                                       |\n| OS-EXT-STS:vm_state                  | building                                         |\n| OS-SRV-USG:launched_at               | -                                                |\n| OS-SRV-USG:terminated_at             | -                                                |\n| accessIPv4                           |                                                  |\n| accessIPv6                           |                                                  |\n| adminPass                            | KX5f2qfJBs9S                                     |\n| config_drive                         |                                                  |\n| created                              | 2015-08-06T04:09:06Z                             |\n| flavor                               | m1.tiny (1)                                      |\n| hostId                               |                                                  |\n| id                                   | 2f91193c-c462-4bcf-ad87-692c3d263cfd             |\n| image                                | Attempt to boot from volume - no image supplied  |\n| key_name                             | -                                                |\n| metadata                             | {}                                               |\n| name                                 | test_rebuild                                     |\n| os-extended-volumes:volumes_attached | [{\"id\": \"daaddb77-4257-4ccd-86f2-220b31a0ce9b\"}] |\n| progress                             | 0                                                |\n| security_groups                      | default                                          |\n| status                               | BUILD                                            |\n| tenant_id                            | b8112a8d8227490eba99419b8a8c2555                 |\n| updated                              | 2015-08-06T04:09:06Z                             |\n| user_id                              | ed64bccd0227444fa02dbd7695769a7d                 |\n+--------------------------------------+--------------------------------------------------+\n\n\nroot@zheng-dev1:/var/log/nova# nova rebuild  2f91193c-c462-4bcf-ad87-692c3d263cfd 7bdff9a3-d051-4e75-bcd3-de69dbffe063\n+-------------------+----------------------------------------------------------------+\n| Property          | Value                                                          |\n+-------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig | MANUAL                                                         |\n| accessIPv4        |                                                                |\n| accessIPv6        |                                                                |\n| adminPass         | GParrEjj3DEW                                                   |\n| created           | 2015-08-06T04:09:06Z                                           |\n| flavor            | m1.tiny (1)                                                    |\n| hostId            | e9701452373fee3a5897683c6b914f4ba33b38b0fcff3b3719615bbd       |\n| id                | 2f91193c-c462-4bcf-ad87-692c3d263cfd                           |\n| image             | cirros-0.3.4-x86_64-uec (7bdff9a3-d051-4e75-bcd3-de69dbffe063) |\n| metadata          | {}                                                             |\n| name              | test_rebuild                                                   |\n| progress          | 0                                                              |\n| public network    | 2001:db8::19, 172.24.4.24                                      |\n| status            | REBUILD                                                        |\n| tenant_id         | b8112a8d8227490eba99419b8a8c2555                               |\n| updated           | 2015-08-06T04:09:50Z                                           |\n| user_id           | ed64bccd0227444fa02dbd7695769a7d                               |\n+-------------------+----------------------------------------------------------------+\n\nroot@zheng-dev1:/var/log/nova# nova show 2f91193c-c462-4bcf-ad87-692c3d263cfd\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | zheng-dev1                                                     |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | zheng-dev1                                                     |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000001a                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2015-08-06T04:10:00.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2015-08-06T04:09:06Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | e9701452373fee3a5897683c6b914f4ba33b38b0fcff3b3719615bbd       |\n| id                                   | 2f91193c-c462-4bcf-ad87-692c3d263cfd                           |\n| image                                | cirros-0.3.4-x86_64-uec (7bdff9a3-d051-4e75-bcd3-de69dbffe063) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | test_rebuild                                                   |\n| os-extended-volumes:volumes_attached | [{\"id\": \"daaddb77-4257-4ccd-86f2-220b31a0ce9b\"}]               |\n| progress                             | 0                                                              |\n| public network                       | 2001:db8::19, 172.24.4.24                                      |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | b8112a8d8227490eba99419b8a8c2555                               |\n| updated                              | 2015-08-06T04:10:00Z                                           |\n| user_id                              | ed64bccd0227444fa02dbd7695769a7d                               |\n+--------------------------------------+----------------------------------------------------------------+\n\nadd using virsh to see the xml, we can see that the instance is still booted from the volume\n\n</disk>\n    <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source dev='/dev/disk/by-path/ip-10.250.10.17:3260-iscsi-iqn.2010-10.org.openstack:volume-daaddb77-4257-4ccd-86f2-220b31a0ce9b-lun-1'/>\n      <target dev='vda' bus='virtio'/>\n      <serial>daaddb77-4257-4ccd-86f2-220b31a0ce9b</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>", 
    "tags": [
        "libvirt", 
        "rebuild", 
        "volumes"
    ], 
    "importance": "Undecided", 
    "heat": 62, 
    "link": "https://bugs.launchpad.net/nova/+bug/1482040", 
    "owner": "None", 
    "id": 1482040, 
    "index": 5686, 
    "created": "2015-08-06 04:11:28.576284+00:00", 
    "title": "rebuild volume-backed instance with image does not replace image in root disk", 
    "comments": [
        {
            "content": "When rebuild an volume-backed instance using normal images from glance, \nnothing will be changed for the instance after rebuild except the image name\nwill be added to the instance, the instance is actually again built using the same\nvolume.\n\nroot@zheng-dev1:/var/log/nova# nova boot --flavor 1 --boot-volume daaddb77-4257-4ccd-86f2-220b31a0ce9b --nic net-id=8744ee96-7690-43bb-89b4-fcac805557bc test_rebuild\n+--------------------------------------+--------------------------------------------------+\n| Property                             | Value                                            |\n+--------------------------------------+--------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                           |\n| OS-EXT-AZ:availability_zone          | nova                                             |\n| OS-EXT-SRV-ATTR:host                 | -                                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000001a                                |\n| OS-EXT-STS:power_state               | 0                                                |\n| OS-EXT-STS:task_state                | scheduling                                       |\n| OS-EXT-STS:vm_state                  | building                                         |\n| OS-SRV-USG:launched_at               | -                                                |\n| OS-SRV-USG:terminated_at             | -                                                |\n| accessIPv4                           |                                                  |\n| accessIPv6                           |                                                  |\n| adminPass                            | KX5f2qfJBs9S                                     |\n| config_drive                         |                                                  |\n| created                              | 2015-08-06T04:09:06Z                             |\n| flavor                               | m1.tiny (1)                                      |\n| hostId                               |                                                  |\n| id                                   | 2f91193c-c462-4bcf-ad87-692c3d263cfd             |\n| image                                | Attempt to boot from volume - no image supplied  |\n| key_name                             | -                                                |\n| metadata                             | {}                                               |\n| name                                 | test_rebuild                                     |\n| os-extended-volumes:volumes_attached | [{\"id\": \"daaddb77-4257-4ccd-86f2-220b31a0ce9b\"}] |\n| progress                             | 0                                                |\n| security_groups                      | default                                          |\n| status                               | BUILD                                            |\n| tenant_id                            | b8112a8d8227490eba99419b8a8c2555                 |\n| updated                              | 2015-08-06T04:09:06Z                             |\n| user_id                              | ed64bccd0227444fa02dbd7695769a7d                 |\n+--------------------------------------+--------------------------------------------------+\n\n\nroot@zheng-dev1:/var/log/nova# nova rebuild  2f91193c-c462-4bcf-ad87-692c3d263cfd 7bdff9a3-d051-4e75-bcd3-de69dbffe063\n+-------------------+----------------------------------------------------------------+\n| Property          | Value                                                          |\n+-------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig | MANUAL                                                         |\n| accessIPv4        |                                                                |\n| accessIPv6        |                                                                |\n| adminPass         | GParrEjj3DEW                                                   |\n| created           | 2015-08-06T04:09:06Z                                           |\n| flavor            | m1.tiny (1)                                                    |\n| hostId            | e9701452373fee3a5897683c6b914f4ba33b38b0fcff3b3719615bbd       |\n| id                | 2f91193c-c462-4bcf-ad87-692c3d263cfd                           |\n| image             | cirros-0.3.4-x86_64-uec (7bdff9a3-d051-4e75-bcd3-de69dbffe063) |\n| metadata          | {}                                                             |\n| name              | test_rebuild                                                   |\n| progress          | 0                                                              |\n| public network    | 2001:db8::19, 172.24.4.24                                      |\n| status            | REBUILD                                                        |\n| tenant_id         | b8112a8d8227490eba99419b8a8c2555                               |\n| updated           | 2015-08-06T04:09:50Z                                           |\n| user_id           | ed64bccd0227444fa02dbd7695769a7d                               |\n+-------------------+----------------------------------------------------------------+\n\nroot@zheng-dev1:/var/log/nova# nova show 2f91193c-c462-4bcf-ad87-692c3d263cfd\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | zheng-dev1                                                     |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | zheng-dev1                                                     |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000001a                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2015-08-06T04:10:00.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2015-08-06T04:09:06Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | e9701452373fee3a5897683c6b914f4ba33b38b0fcff3b3719615bbd       |\n| id                                   | 2f91193c-c462-4bcf-ad87-692c3d263cfd                           |\n| image                                | cirros-0.3.4-x86_64-uec (7bdff9a3-d051-4e75-bcd3-de69dbffe063) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | test_rebuild                                                   |\n| os-extended-volumes:volumes_attached | [{\"id\": \"daaddb77-4257-4ccd-86f2-220b31a0ce9b\"}]               |\n| progress                             | 0                                                              |\n| public network                       | 2001:db8::19, 172.24.4.24                                      |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | b8112a8d8227490eba99419b8a8c2555                               |\n| updated                              | 2015-08-06T04:10:00Z                                           |\n| user_id                              | ed64bccd0227444fa02dbd7695769a7d                               |\n+--------------------------------------+----------------------------------------------------------------+\n\nadd using virsh to see the xml, we can see that the instance is still booted from the volume\n\n</disk>\n    <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source dev='/dev/disk/by-path/ip-10.250.10.17:3260-iscsi-iqn.2010-10.org.openstack:volume-daaddb77-4257-4ccd-86f2-220b31a0ce9b-lun-1'/>\n      <target dev='vda' bus='virtio'/>\n      <serial>daaddb77-4257-4ccd-86f2-220b31a0ce9b</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>", 
            "date_created": "2015-08-06 04:11:28.576284+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhengzhenyu"
        }, 
        {
            "content": "Hi Zhenyu,\n\nI'm afraid I could not parse your problem description correctly, so I don't know what exactly is the problem you're facing.\n\nWould be useful if you can write a list of sequential steps to reproduce the problem you're facing.\n\n\n[A friendly note: https://wiki.openstack.org/wiki/BugFilingRecommendations]", 
            "date_created": "2015-11-30 15:23:50.224584+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/305079", 
            "date_created": "2016-04-13 10:02:26.036600+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Laszlo Hegedus (<email address hidden>) on branch: master\nReview: https://review.openstack.org/305079\nReason: I abandon this, since a proper solution would require rethinking of rebuild. It is not defined yet how rebuild should work with volume-backed instances. Someone should write a bp about this.", 
            "date_created": "2016-08-11 08:10:52.914142+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hi \nI upgrade system to liberty but problem still remain\nSo for rebuild process with ceph backend i must do these step\n- Delete instance\n- Create neutron port with ip same as before\n- Create new volumes base from os image template with size same as before\n- Create new instance with same as flavor before, new volume and neutron port created before.\n", 
            "date_created": "2016-10-01 05:15:09.748600+00:00", 
            "author": "https://api.launchpad.net/1.0/~prescolt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/442295", 
            "date_created": "2017-03-07 06:58:36.864902+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Matt Riedemann (<email address hidden>) on branch: master\nReview: https://review.openstack.org/442295\nReason: Abandoning as a duplicate of https://review.openstack.org/#/c/305079/", 
            "date_created": "2017-10-03 19:28:52.256843+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/509282", 
            "date_created": "2017-10-03 20:37:14.489083+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/509282\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=ae9542eb7da22ad6bcd59145c56b2781aa7b507a\nSubmitter: Jenkins\nBranch:    master\n\ncommit ae9542eb7da22ad6bcd59145c56b2781aa7b507a\nAuthor: Matt Riedemann <email address hidden>\nDate:   Tue Oct 3 16:34:26 2017 -0400\n\n    api-ref: add note about rebuild not replacing volume-backed root disk\n    \n    We've had several bugs about this over the years, and until we\n    actually decide to fix it (or not), we should point out the known\n    limitation that volume-backed root disks are not replaced during\n    a rebuild.\n    \n    Like, if you have a volume-backed instance and rebuild with a new\n    image, the root disk is still the volume with the original image.\n    \n    Change-Id: I145cab88f782e4b1e630cc432322bc8436413e71\n    Related-Bug: #1482040\n", 
            "date_created": "2017-10-04 20:28:00.004415+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}