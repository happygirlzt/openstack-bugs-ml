{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:53:37.746956+00:00", 
    "description": "While running Tempest tests against my device, the encryption tests consistently fail to attach.  Turns out the problem is an attempt to create symbolic link for encryption process, however the rootwrap spec is restricted to targets with the default openstack.org iqn.\n\nError Message from n-cpu:\n\nStderr: '/usr/local/bin/nova-rootwrap: Unauthorized command: ln --symbolic --force /dev/mapper/ip-10.10.8.112:3260-iscsi-iqn.2010-01.com.solidfire:3gd2.uuid-6f210923-36bf-46a4-b04a-6b4269af9d4f.4710-lun-0 /dev/disk/by-path/ip-10.10.8.112:3260-iscsi-iqn.2010-01.com.sol\n\n\nRootwrap entry currently implemented:\n\nln: RegExpFilter, ln, root, ln, --symbolic, --force, /dev/mapper/ip-.*-iscsi-iqn.2010-10.org.openstack:volume-.*, /dev/disk/by-path/ip-.*-iscsi-iqn.2010-10.org.openstack:volume-.*", 
    "tags": [], 
    "importance": "Critical", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1362854", 
    "owner": "https://api.launchpad.net/1.0/~john-griffith", 
    "id": 1362854, 
    "index": 205, 
    "created": "2014-08-28 23:18:17.144030+00:00", 
    "title": "Incorrect regex on rootwrap for encrypted volumes ln creation", 
    "comments": [
        {
            "content": "\n\nStderr: '/usr/local/bin/nova-rootwrap: Unauthorized command: ln --symbolic --force /dev/mapper/ip-10.10.8.112:3260-iscsi-iqn.2010-01.com.solidfire:3gd2.uuid-6f210923-36bf-46a4-b04a-6b4269af9d4f.4710-lun-0 /dev/disk/by-path/ip-10.10.8.112:3260-iscsi-iqn.2010-01.com.sol\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 412, in decorated_function\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 296, in decorated_function\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 282, in decorated_function\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 324, in decorated_function\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 312, in decorated_function\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4358, in attach_volume\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     bdm.destroy(context)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-08-28 17:10:31.613 16021 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4355, in attach_volume", 
            "date_created": "2014-08-28 23:18:17.144030+00:00", 
            "author": "https://api.launchpad.net/1.0/~john-griffith"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/117652", 
            "date_created": "2014-08-28 23:32:33.267572+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/120233", 
            "date_created": "2014-09-09 21:17:08.484494+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/havana\nReview: https://review.openstack.org/120239", 
            "date_created": "2014-09-09 21:28:16.505152+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/117652\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=00808f2072c3ee8958ad16eabad7994730bb8b86\nSubmitter: Jenkins\nBranch:    master\n\ncommit 00808f2072c3ee8958ad16eabad7994730bb8b86\nAuthor: John Griffith <email address hidden>\nDate:   Thu Aug 28 17:27:35 2014 -0600\n\n    Fix rootwrap for non openstack.org iqn's\n    \n    The encryption methods implemented for attached volumes\n    require a symbolic link created to the /dev/disk-by* iqn.\n    \n    The current implementation works fine for LVM, however the rootwrap\n    is restricted to only allow iqns of the form openstack.org, for\n    vendors that use their own target and iqn this won't work and will\n    result in the attach failing for unauthorized command.\n    \n    This just makes the regex for the rootwrap filter a bit more\n    permissive, only looking for iscsi-iqn.*\n    \n    Change-Id: I023ad24867c045a88f72c5ac7ac4e4da097a3643\n    Closes-Bug: 1362854\n", 
            "date_created": "2014-09-12 05:34:55.062093+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/120233\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=df09c2a305c6a4cb41f649956197456b4a2d3e20\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit df09c2a305c6a4cb41f649956197456b4a2d3e20\nAuthor: John Griffith <email address hidden>\nDate:   Thu Aug 28 17:27:35 2014 -0600\n\n    Fix rootwrap for non openstack.org iqn's\n    \n    The encryption methods implemented for attached volumes\n    require a symbolic link created to the /dev/disk-by* iqn.\n    \n    The current implementation works fine for LVM, however the rootwrap\n    is restricted to only allow iqns of the form openstack.org, for\n    vendors that use their own target and iqn this won't work and will\n    result in the attach failing for unauthorized command.\n    \n    This just makes the regex for the rootwrap filter a bit more\n    permissive, only looking for iscsi-iqn.*\n    \n    Change-Id: I023ad24867c045a88f72c5ac7ac4e4da097a3643\n    Closes-Bug: 1362854\n    (cherry picked from commit 00808f2072c3ee8958ad16eabad7994730bb8b86)\n", 
            "date_created": "2014-09-19 00:29:37.615072+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/120239\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a7f5a9d23a3085d079d1abd3415e8e931895046f\nSubmitter: Jenkins\nBranch:    stable/havana\n\ncommit a7f5a9d23a3085d079d1abd3415e8e931895046f\nAuthor: John Griffith <email address hidden>\nDate:   Thu Aug 28 17:27:35 2014 -0600\n\n    Fix rootwrap for non openstack.org iqn's\n    \n    The encryption methods implemented for attached volumes\n    require a symbolic link created to the /dev/disk-by* iqn.\n    \n    The current implementation works fine for LVM, however the rootwrap\n    is restricted to only allow iqns of the form openstack.org, for\n    vendors that use their own target and iqn this won't work and will\n    result in the attach failing for unauthorized command.\n    \n    This just makes the regex for the rootwrap filter a bit more\n    permissive, only looking for iscsi-iqn.*\n    \n    Closes-Bug: 1362854\n    (cherry picked from commit 00808f2072c3ee8958ad16eabad7994730bb8b86)\n    \n    Change-Id: I023ad24867c045a88f72c5ac7ac4e4da097a3643\n    Conflicts:\n    \tetc/nova/rootwrap.d/compute.filters\n", 
            "date_created": "2014-09-19 14:21:42.877811+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}