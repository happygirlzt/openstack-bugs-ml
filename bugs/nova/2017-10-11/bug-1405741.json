{
    "status": "Fix Released", 
    "last_updated": "2015-03-12 14:51:50.054851+00:00", 
    "description": "Env:\n\nNode 1: controller, running controller services, Mysql, RabbitMQ\nNode 2: compute1, running nova_compute\nNode 3: network, running neutron_server\nNode 4: block1, running cinder-volume\n\nversion: Juno stable\nNova version: 2.19\n\nProcedure for reproduce:\n\nVolume creation works. when launching instance in dashboard or with Nova Cli, exception was thrown in instance.save() function in file \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\" on compute node, line 2273. Following is the trace in nova-compute log files with debug=true:\n\n**RemoteError: Remote error: OperationalError (OperationalError) (1048, \"Column 'instance_uuid' cannot be null\") 'UPDATE instance_extra SET updated_at=%s, instance_uuid=%s WHERE instance_extra.id = %s' (datetime.datetime(2014, 12, 25, 11, 11, 36, 186194), None, 13L)**\n\n19:11:36.105 20544 TRACE oslo.messaging.rpc.dispatcher [u'Traceback (most recent call last):\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 400, in _object_dispatch\\n    return getattr(target, method)(context, *args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/objects/base.py\", line 204, in wrapper\\n    return fn(self, ctxt, *args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 500, in save\\n    columns_to_join=_expected_cols(expected_attrs))\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 746, in instance_update_and_get_original\\n    columns_to_join=columns_to_join)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 143, in wrapper\\n    return f(*args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2289, in instance_update_and_get_original\\n    columns_to_join=columns_to_join)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2380, in _instance_update\\n    session.add(instance_ref)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 470, in __exit__\\n    self.rollback()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\\n    compat.reraise(exc_type, exc_value, exc_tb)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 467, in __exit__\\n    self.commit()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 377, in commit\\n    self._prepare_impl()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 357, in _prepare_impl\\n    self.session.flush()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1919, in flush\\n    self._flush(objects)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 2037, in _flush\\n    transaction.rollback(_capture_exception=True)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\\n    compat.reraise(exc_type, exc_value, exc_tb)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 2001, in _flush\\n    flush_context.execute()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 372, in execute\\n    rec.execute(self)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 526, in execute\\n    uow\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py\", line 60, in save_obj\\n    mapper, table, update)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py\", line 518, in _emit_update_statements\\n    execute(statement, params)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 729, in execute\\n    return meth(self, multiparams, params)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 321, in _execute_on_connection\\n    return connection._execute_clauseelement(self, multiparams, params)\\n', u'  File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 826, in _execute_clauseelement\\n    compiled_sql, distilled_params\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 958, in _execute_context\\n    context)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1156, in _handle_dbapi_exception\\n    util.raise_from_cause(newraise, exc_info)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/util/compat.py\", line 199, in raise_from_cause\\n    reraise(type(exception), exception, tb=exc_tb)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 951, in _execute_context\\n    context)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 436, in do_execute\\n    cursor.execute(statement, parameters)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\\n    self.errorhandler(self, exc, value)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\\n    raise errorclass, errorvalue\\n', u'OperationalError: (OperationalError) (1048, \"Column \\'instance_uuid\\' cannot be null\") \\'UPDATE instance_extra SET updated_at=%s, instance_uuid=%s WHERE instance_extra.id = %s\\' (datetime.datetime(2014, 12, 25, 11, 11, 36, 186194), None, 13L)\\n'].\nAfter commenting this code line, the operation can move forward, but the similar problem occurred in other instance.save() invoking positions.\n\nthank you.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 32, 
    "link": "https://bugs.launchpad.net/nova/+bug/1405741", 
    "owner": "None", 
    "id": 1405741, 
    "index": 5347, 
    "created": "2014-12-26 08:30:49.967685+00:00", 
    "title": "OpenStack Juno release Nova error: RemoteError: Remote error: OperationalError (OperationalError) (1048, \u201cColumn 'instance_uuid' cannot be null\u201d)", 
    "comments": [
        {
            "content": "Env:\n\nNode 1: controller, running controller services, Mysql, RabbitMQ\nNode 2: compute1, running nova_compute\nNode 3: network, running neutron_server\nNode 4: block1, running cinder-volume\n\nversion: Juno stable\nNova version: 2.19\n\nProcedure for reproduce:\n\nVolume creation works. when launching instance in dashboard or with Nova Cli, exception was thrown in instance.save() function in file \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\" on compute node, line 2273. Following is the trace in nova-compute log files with debug=true:\n\n**RemoteError: Remote error: OperationalError (OperationalError) (1048, \"Column 'instance_uuid' cannot be null\") 'UPDATE instance_extra SET updated_at=%s, instance_uuid=%s WHERE instance_extra.id = %s' (datetime.datetime(2014, 12, 25, 11, 11, 36, 186194), None, 13L)**\n\n19:11:36.105 20544 TRACE oslo.messaging.rpc.dispatcher [u'Traceback (most recent call last):\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 400, in _object_dispatch\\n    return getattr(target, method)(context, *args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/objects/base.py\", line 204, in wrapper\\n    return fn(self, ctxt, *args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 500, in save\\n    columns_to_join=_expected_cols(expected_attrs))\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 746, in instance_update_and_get_original\\n    columns_to_join=columns_to_join)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 143, in wrapper\\n    return f(*args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2289, in instance_update_and_get_original\\n    columns_to_join=columns_to_join)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2380, in _instance_update\\n    session.add(instance_ref)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 470, in __exit__\\n    self.rollback()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\\n    compat.reraise(exc_type, exc_value, exc_tb)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 467, in __exit__\\n    self.commit()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 377, in commit\\n    self._prepare_impl()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 357, in _prepare_impl\\n    self.session.flush()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1919, in flush\\n    self._flush(objects)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 2037, in _flush\\n    transaction.rollback(_capture_exception=True)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\\n    compat.reraise(exc_type, exc_value, exc_tb)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 2001, in _flush\\n    flush_context.execute()\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 372, in execute\\n    rec.execute(self)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 526, in execute\\n    uow\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py\", line 60, in save_obj\\n    mapper, table, update)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py\", line 518, in _emit_update_statements\\n    execute(statement, params)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 729, in execute\\n    return meth(self, multiparams, params)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 321, in _execute_on_connection\\n    return connection._execute_clauseelement(self, multiparams, params)\\n', u'  File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 826, in _execute_clauseelement\\n    compiled_sql, distilled_params\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 958, in _execute_context\\n    context)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1156, in _handle_dbapi_exception\\n    util.raise_from_cause(newraise, exc_info)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/util/compat.py\", line 199, in raise_from_cause\\n    reraise(type(exception), exception, tb=exc_tb)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 951, in _execute_context\\n    context)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 436, in do_execute\\n    cursor.execute(statement, parameters)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\\n    self.errorhandler(self, exc, value)\\n', u'  \nFile \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\\n    raise errorclass, errorvalue\\n', u'OperationalError: (OperationalError) (1048, \"Column \\'instance_uuid\\' cannot be null\") \\'UPDATE instance_extra SET updated_at=%s, instance_uuid=%s WHERE instance_extra.id = %s\\' (datetime.datetime(2014, 12, 25, 11, 11, 36, 186194), None, 13L)\\n'].\nAfter commenting this code line, the operation can move forward, but the similar problem occurred in other instance.save() invoking positions.\n\nthank you.", 
            "date_created": "2014-12-26 08:30:49.967685+00:00", 
            "author": "https://api.launchpad.net/1.0/~esunsnote"
        }, 
        {
            "content": "", 
            "date_created": "2014-12-26 08:30:49.967685+00:00", 
            "author": "https://api.launchpad.net/1.0/~esunsnote"
        }, 
        {
            "content": "Further update:\n\nI have comments out the instance.save code in manager.py where the problem occurred, and now the instance was created successfully.\n\nI have checked the database, instance_uuid should be linked to instances.uuid as foreign key, so it should not be able to set to Null, so I don't think the sql sentence is correct:\n\nUPDATE instance_extra SET updated_at=%s, instance_uuid=%s WHERE instance_extra.id = %s' (datetime.datetime(2014, 12, 25, 11, 11, 36, 186194), None, 13L)*\n\ncan somebody help?", 
            "date_created": "2014-12-27 15:20:24.550413+00:00", 
            "author": "https://api.launchpad.net/1.0/~esunsnote"
        }, 
        {
            "content": "One more comment: now the instance was created and was running, but the status is kept \"Build\".", 
            "date_created": "2014-12-27 15:21:37.852253+00:00", 
            "author": "https://api.launchpad.net/1.0/~esunsnote"
        }, 
        {
            "content": "I've had the exact same issue after upgrading to the lastest nova-* package from the cloud-archive on the compute nodes only. It was resolved as soon as the controller node was upgraded as well.\n\nIf the same solution works for you, I would propose to close this bug as invalid.", 
            "date_created": "2014-12-29 18:41:29.759824+00:00", 
            "author": "https://api.launchpad.net/1.0/~francois-ctrlaltdel"
        }, 
        {
            "content": "Francois: Version of Nova on my compute node is 2.19, which is same to Nova on the controller node. So I am not using the latest nova package, but anyway, thank you for your suggestion and I will try. i will update status later.", 
            "date_created": "2014-12-30 03:07:07.571633+00:00", 
            "author": "https://api.launchpad.net/1.0/~esunsnote"
        }, 
        {
            "content": "Francois: could you please advice how to upgrade to the latest nova code? i cannot find it in Ubuntu repository. did you upgrade the code directly?", 
            "date_created": "2015-01-02 14:30:35.046395+00:00", 
            "author": "https://api.launchpad.net/1.0/~esunsnote"
        }, 
        {
            "content": "Hi Sammyliu,\n\nNope, i'm using the default packages from the ubuntu cloud archive. I guess that the problem comes from using a more recent nova-compute with older nova-conductor.\n\ncontroller:# dpkg -l nova-conductor\nii  nova-conductor 1:2014.2.1-0 all          OpenStack Compute - conductor ser\n\ncompute:# dpkg -l nova-compute\nii  nova-compute   1:2014.2.1-0 all          OpenStack Compute - compute node \n", 
            "date_created": "2015-01-02 22:27:55.216115+00:00", 
            "author": "https://api.launchpad.net/1.0/~francois-ctrlaltdel"
        }, 
        {
            "content": "Francios,\n\nI have got rid of this problem after installing the latest package http://ubuntu-cloud.archive.canonical.com/ubuntu/dists/trusty-proposed/kilo/, so cannot compare the versions of nova-conductor and nova-compute per your suggestion, but did check both nova versions by running \"nova --version\" and both were 2.19. I have checked the tickets fixed in the new release and a few bugs related with instance.save have been fixed. I will close this bug and highly appreciate your help.", 
            "date_created": "2015-01-04 01:50:09.550574+00:00", 
            "author": "https://api.launchpad.net/1.0/~esunsnote"
        }, 
        {
            "content": "@sammyliu, I also encountered this issue with Juno code recently. Do you know which code commit in Kilo resolved this issue? Is that code change cherry-picked to stable/juno already?", 
            "date_created": "2015-01-26 05:59:46.745661+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhaoqin"
        }, 
        {
            "content": "I have encountered this issue as well. The compute nodes i have on 1:2014.2-0  will work while the 1:2014.2.1-0ubuntu1~cloud0 ones do not work. \n\nNow since most of the things in  my cluster are on 1:2014.2-0  i actually do not want to upgrade my controller .. instead would want to degrade my new compute node. ...any pointers to that ? \n\nroot@njain-compute-2690-16:~# dpkg -l nova-compute  \n\n||/ Name                                                Version                        Architecture                   Description\n+++-===================================================-==============================-==============================-============================================================================================================\nii  nova-compute                                        1:2014.2.1-0ubuntu1~cloud0     all                            OpenStack Compute - compute node base\n\nroot@control-mel01-1:~#  dpkg -l nova-conductor\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                                Version                        Architecture                   Description\n+++-===================================================-==============================-==============================-============================================================================================================\nii  nova-conductor                                      1:2014.2-0ubuntu1~cloud0       all                            OpenStack Compute - conductor service\n\n||/ Name                                                Version                        Architecture                   Description\n+++-===================================================-==============================-==============================-============================================================================================================\nii  nova-compute                                        1:2014.2-0ubuntu1~cloud0       all                            OpenStack Compute - compute node base\n", 
            "date_created": "2015-02-09 16:24:46.520374+00:00", 
            "author": "https://api.launchpad.net/1.0/~nutshi"
        }, 
        {
            "content": "hi , please i need a help\n\ni cannot create instance after installing trove.there is not a nova compute when i do nova-manage service list et get this\n\nBinary Host Zone Status State Updated_At nova-conductor ubuntu-VirtualBox internal enabled :-) 2015-03-10 14:16:57 nova-cert ubuntu-VirtualBox internal enabled :-) 2015-03-10 14:16:56 nova-scheduler ubuntu-VirtualBox internal enabled :-) 2015-03-10 14:17:00 nova-consoleauth ubuntu-VirtualBox internal enabled :-) 2015-03-10 14:17:01\n\ni tried to install the nova compute packages but was not be able to do it.\n\nhow can i fix it?\n", 
            "date_created": "2015-03-12 10:05:08.025755+00:00", 
            "author": "https://api.launchpad.net/1.0/~bintou-16"
        }, 
        {
            "content": "  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 546, in init_host\n    self._version_to_string(MIN_LIBVIRT_VERSION))\nNovaException: Nova requires libvirt version 0.9.11 or greater.\n2015-03-10 13:19:42.379 ERROR nova.openstack.common.threadgroup [req-9433abde-136a-482c-bd93-1d7220150edf None None] Nova requires libvirt version 0.9.11 or greater.\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 145, in wait\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     x.wait()\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 47, in wait\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 175, in wait\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 214, in main\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/service.py\", line 491, in run_service\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     service.start()\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 164, in start\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 1189, in init_host\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     self.driver.init_host(host=self.host)\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 546, in init_host\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup     self._version_to_string(MIN_LIBVIRT_VERSION))\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup NovaException: Nova requires libvirt version 0.9.11 or greater.\n2015-03-10 13:19:42.379 TRACE nova.openstack.common.threadgroup \n", 
            "date_created": "2015-03-12 14:51:49.493443+00:00", 
            "author": "https://api.launchpad.net/1.0/~bintou-16"
        }
    ]
}