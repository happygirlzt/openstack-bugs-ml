{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:53:25.064306+00:00", 
    "description": "http://logs.openstack.org/21/183321/1/gate/gate-tempest-dsvm-full/a263953/logs/screen-n-cond.txt.gz?level=TRACE#_2015-05-15_15_06_44_176\n\n2015-05-15 15:06:44.176 ERROR nova.notifications [req-47aa9044-90c9-4bdd-b32c-b0b52f8c18eb ServersTestJSON-285875926 ServersTestJSON-1664086552] [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad] Failed to send state update notification\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad] Traceback (most recent call last):\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/notifications.py\", line 151, in send_update\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     old_display_name=old_display_name)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/notifications.py\", line 231, in _send_instance_update_notification\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     payload = info_from_instance(context, instance, None, None)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/notifications.py\", line 374, in info_from_instance\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     instance_type = instance.get_flavor()\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 1025, in get_flavor\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     return getattr(self, attr)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/base.py\", line 72, in getter\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     self.obj_load_attr(name)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 1015, in obj_load_attr\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     self._load_flavor()\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 941, in _load_flavor\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     expected_attrs=['flavor', 'system_metadata'])\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/base.py\", line 163, in wrapper\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     result = fn(cls, context, *args, **kwargs)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 577, in get_by_uuid\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     use_slave=use_slave)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/db/api.py\", line 651, in instance_get_by_uuid\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     columns_to_join, use_slave=use_slave)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 233, in wrapper\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     return f(*args, **kwargs)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 1744, in instance_get_by_uuid\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     columns_to_join=columns_to_join, use_slave=use_slave)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 1756, in _instance_get_by_uuid\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     raise exception.InstanceNotFound(instance_id=uuid)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad] InstanceNotFound: Instance 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad could not be found.\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad] \n\nThis is a case where the instance goes to ERROR state because of a NoValidHost and then tempest deletes the instance as soon as it hits that state (it's polling every second).\n\nWe shouldn't trace in the conductor logs (those should be relatively clean unless there are major issues) on expected exceptions, like InstanceNotFound b/c some tooling deleted the instance once it failed.", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1455640", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1455640, 
    "index": 467, 
    "created": "2015-05-15 20:14:25.188997+00:00", 
    "title": "notifications._send_instance_update_notification should handle InstanceNotFound", 
    "comments": [
        {
            "content": "http://logs.openstack.org/21/183321/1/gate/gate-tempest-dsvm-full/a263953/logs/screen-n-cond.txt.gz?level=TRACE#_2015-05-15_15_06_44_176\n\n2015-05-15 15:06:44.176 ERROR nova.notifications [req-47aa9044-90c9-4bdd-b32c-b0b52f8c18eb ServersTestJSON-285875926 ServersTestJSON-1664086552] [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad] Failed to send state update notification\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad] Traceback (most recent call last):\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/notifications.py\", line 151, in send_update\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     old_display_name=old_display_name)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/notifications.py\", line 231, in _send_instance_update_notification\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     payload = info_from_instance(context, instance, None, None)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/notifications.py\", line 374, in info_from_instance\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     instance_type = instance.get_flavor()\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 1025, in get_flavor\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     return getattr(self, attr)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/base.py\", line 72, in getter\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     self.obj_load_attr(name)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 1015, in obj_load_attr\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     self._load_flavor()\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 941, in _load_flavor\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     expected_attrs=['flavor', 'system_metadata'])\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/base.py\", line 163, in wrapper\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     result = fn(cls, context, *args, **kwargs)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/objects/instance.py\", line 577, in get_by_uuid\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     use_slave=use_slave)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/db/api.py\", line 651, in instance_get_by_uuid\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     columns_to_join, use_slave=use_slave)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 233, in wrapper\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     return f(*args, **kwargs)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 1744, in instance_get_by_uuid\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     columns_to_join=columns_to_join, use_slave=use_slave)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 1756, in _instance_get_by_uuid\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad]     raise exception.InstanceNotFound(instance_id=uuid)\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad] InstanceNotFound: Instance 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad could not be found.\n2015-05-15 15:06:44.176 899 TRACE nova.notifications [instance: 1ea21d0c-5b5a-4417-bca0-4aaeabfb19ad] \n\nThis is a case where the instance goes to ERROR state because of a NoValidHost and then tempest deletes the instance as soon as it hits that state (it's polling every second).\n\nWe shouldn't trace in the conductor logs (those should be relatively clean unless there are major issues) on expected exceptions, like InstanceNotFound b/c some tooling deleted the instance once it failed.", 
            "date_created": "2015-05-15 20:14:25.188997+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/183727", 
            "date_created": "2015-05-15 23:04:52.491399+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/183727\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=7de1235966c8107318a267e487c7ec5744ba6b57\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7de1235966c8107318a267e487c7ec5744ba6b57\nAuthor: Matt Riedemann <email address hidden>\nDate:   Fri May 15 16:01:48 2015 -0700\n\n    Handle InstanceNotFound when sending instance update notification\n    \n    When Tempest (or any automated client) is waiting for an instance to be\n    ACTIVE but goes to ERROR state, it immediately fails a test and deletes\n    the instance.  The instance could be deleted by the time the instance\n    update notification processing happens so there is a race where that\n    could fail with InstanceNotFound.  That will get traced to the conductor\n    logs and we should try to keep the conductor logs as clean as possible\n    from expected exceptions.\n    \n    This handles InstanceNotFound and just logs it at debug rather than\n    trace out the exception.\n    \n    Closes-Bug: #1455640\n    \n    Change-Id: Iaee147051afb59f7991f8dfef3bd3072c28f829d\n", 
            "date_created": "2015-06-16 20:23:38.714831+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}