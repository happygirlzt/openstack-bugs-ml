{
    "status": "Invalid", 
    "last_updated": "2011-09-20 23:16:02.550971+00:00", 
    "description": "I was not able to consistently terminate lxc instances using the following command:\n\neuca-terminate-instance i-XXXXX\n\nI was able to quite rapidly get to a point where I was unable to start any new instances because I had to many in the 'running' state - non of which where actually running.\n\nError from nova-compute log file:\n\n2011-09-06 15:17:01,765 DEBUG nova.utils [-] Running cmd (subprocess): sudo umount /var/lib/nova/instances/instance-00000002/rootfs from (pid=1229) execute /usr/lib/pymodules/python2.7/nova/utils.py:165\n2011-09-06 15:17:01,774 INFO nova.virt.libvirt_conn [-] Instance instance-00000002 destroyed successfully.\n2011-09-06 15:17:01,929 DEBUG nova.utils [-] Result was 1 from (pid=1229) execute /usr/lib/pymodules/python2.7/nova/utils.py:180\n2011-09-06 15:17:01,930 DEBUG nova.utils [-] Running cmd (subprocess): sudo losetup -a from (pid=1229) execute /usr/lib/pymodules/python2.7/nova/utils.py:165\n2011-09-06 15:17:02,033 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 98, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 117, in decorated_function\n(nova.exception): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 492, in terminate_instance\n(nova.exception): TRACE:     self._shutdown_instance(context, instance_id, 'Terminating')\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 483, in _shutdown_instance\n(nova.exception): TRACE:     self.driver.destroy(instance, network_info)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 326, in destroy\n(nova.exception): TRACE:     self._cleanup(instance)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 336, in _cleanup\n(nova.exception): TRACE:     disk.destroy_container(target, instance, nbd=FLAGS.use_cow_images)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/disk.py\", line 153, in destroy_container\n(nova.exception): TRACE:     utils.execute('umount', container_dir, run_as_root=True)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/utils.py\", line 188, in execute\n(nova.exception): TRACE:     cmd=' '.join(cmd))\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: sudo umount /var/lib/nova/instances/instance-00000002/rootfs\n(nova.exception): TRACE: Exit code: 1\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: 'umount: /var/lib/nova/instances/instance-00000002/rootfs: not mounted\\n'\n(nova.exception): TRACE:\n2011-09-06 15:17:02,049 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 129, in wrapped\n(nova.rpc): TRACE:     raise Error(str(e))\n(nova.rpc): TRACE: Error: Unexpected error while running command.\n(nova.rpc): TRACE: Command: sudo umount /var/lib/nova/instances/instance-00000002/rootfs\n(nova.rpc): TRACE: Exit code: 1\n(nova.rpc): TRACE: Stdout: ''\n\nProblemType: Bug\nDistroRelease: Ubuntu 11.10\nPackage: nova-compute-lxc 2011.3~rc~20110901.1523-0ubuntu1\nProcVersionSignature: Ubuntu 3.0.0-10.16-server 3.0.4\nUname: Linux 3.0.0-10-server x86_64\nArchitecture: amd64\nDate: Tue Sep  6 16:35:53 2011\nNovaConf: Error: [Errno 13] Permission denied: '/etc/nova/nova.conf'\nPackageArchitecture: all\nProcEnviron:\n LANGUAGE=en_GB:\n LANG=en_GB.UTF-8\n SHELL=/bin/bash\nSourcePackage: nova\nUpgradeStatus: No upgrade log present (probably fresh install)", 
    "tags": [
        "amd64", 
        "apport-bug", 
        "oneiric"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/842856", 
    "owner": "None", 
    "id": 842856, 
    "index": 2261, 
    "created": "2011-09-06 15:39:53.357514+00:00", 
    "title": "problems terminating lxc instances", 
    "comments": [
        {
            "content": "I was not able to consistently terminate lxc instances using the following command:\n\neuca-terminate-instance i-XXXXX\n\nI was able to quite rapidly get to a point where I was unable to start any new instances because I had to many in the 'running' state - non of which where actually running.\n\nError from nova-compute log file:\n\n2011-09-06 15:17:01,765 DEBUG nova.utils [-] Running cmd (subprocess): sudo umount /var/lib/nova/instances/instance-00000002/rootfs from (pid=1229) execute /usr/lib/pymodules/python2.7/nova/utils.py:165\n2011-09-06 15:17:01,774 INFO nova.virt.libvirt_conn [-] Instance instance-00000002 destroyed successfully.\n2011-09-06 15:17:01,929 DEBUG nova.utils [-] Result was 1 from (pid=1229) execute /usr/lib/pymodules/python2.7/nova/utils.py:180\n2011-09-06 15:17:01,930 DEBUG nova.utils [-] Running cmd (subprocess): sudo losetup -a from (pid=1229) execute /usr/lib/pymodules/python2.7/nova/utils.py:165\n2011-09-06 15:17:02,033 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 98, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 117, in decorated_function\n(nova.exception): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 492, in terminate_instance\n(nova.exception): TRACE:     self._shutdown_instance(context, instance_id, 'Terminating')\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 483, in _shutdown_instance\n(nova.exception): TRACE:     self.driver.destroy(instance, network_info)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 326, in destroy\n(nova.exception): TRACE:     self._cleanup(instance)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 336, in _cleanup\n(nova.exception): TRACE:     disk.destroy_container(target, instance, nbd=FLAGS.use_cow_images)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/disk.py\", line 153, in destroy_container\n(nova.exception): TRACE:     utils.execute('umount', container_dir, run_as_root=True)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/utils.py\", line 188, in execute\n(nova.exception): TRACE:     cmd=' '.join(cmd))\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: sudo umount /var/lib/nova/instances/instance-00000002/rootfs\n(nova.exception): TRACE: Exit code: 1\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: 'umount: /var/lib/nova/instances/instance-00000002/rootfs: not mounted\\n'\n(nova.exception): TRACE:\n2011-09-06 15:17:02,049 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 129, in wrapped\n(nova.rpc): TRACE:     raise Error(str(e))\n(nova.rpc): TRACE: Error: Unexpected error while running command.\n(nova.rpc): TRACE: Command: sudo umount /var/lib/nova/instances/instance-00000002/rootfs\n(nova.rpc): TRACE: Exit code: 1\n(nova.rpc): TRACE: Stdout: ''\n\nProblemType: Bug\nDistroRelease: Ubuntu 11.10\nPackage: nova-compute-lxc 2011.3~rc~20110901.1523-0ubuntu1\nProcVersionSignature: Ubuntu 3.0.0-10.16-server 3.0.4\nUname: Linux 3.0.0-10-server x86_64\nArchitecture: amd64\nDate: Tue Sep  6 16:35:53 2011\nNovaConf: Error: [Errno 13] Permission denied: '/etc/nova/nova.conf'\nPackageArchitecture: all\nProcEnviron:\n LANGUAGE=en_GB:\n LANG=en_GB.UTF-8\n SHELL=/bin/bash\nSourcePackage: nova\nUpgradeStatus: No upgrade log present (probably fresh install)", 
            "date_created": "2011-09-06 15:39:53.357514+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "", 
            "date_created": "2011-09-06 15:39:53.357514+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "Picked this out of a clean install:\n\n\n2011-09-06 17:29:26,520 DEBUG nova.virt.libvirt.firewall [-] The nwfilter(nova-instance-instance-00000001-secgroup) for instance-00000001 is not found. from (pid=1164) unfilter_instance /usr/lib/pymodules/python2.7/nova/virt/libvirt/firewall.py:320\n2011-09-06 17:29:26,521 INFO nova.virt.libvirt_conn [-] instance instance-00000001: deleting instance files /var/lib/nova/instances/instance-00000001\n2011-09-06 17:29:26,521 DEBUG nova.utils [-] Running cmd (subprocess): sudo umount /var/lib/nova/instances/instance-00000001/rootfs from (pid=1164) execute /usr/lib/pymodules/python2.7/nova/utils.py:165\n2011-09-06 17:29:26,544 DEBUG nova.utils [-] Running cmd (subprocess): sudo losetup -a from (pid=1164) execute /usr/lib/pymodules/python2.7/nova/utils.py:165\n2011-09-06 17:29:26,622 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 98, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 117, in decorated_function\n(nova.exception): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 492, in terminate_instance\n(nova.exception): TRACE:     self._shutdown_instance(context, instance_id, 'Terminating')\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/compute/manager.py\", line 483, in _shutdown_instance\n(nova.exception): TRACE:     self.driver.destroy(instance, network_info)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 326, in destroy\n(nova.exception): TRACE:     self._cleanup(instance)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/virt/libvirt/connection.py\", line 338, in _cleanup\n(nova.exception): TRACE:     shutil.rmtree(target)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/shutil.py\", line 244, in rmtree\n(nova.exception): TRACE:     rmtree(fullname, ignore_errors, onerror)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/shutil.py\", line 253, in rmtree\n(nova.exception): TRACE:     onerror(os.rmdir, path, sys.exc_info())\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/shutil.py\", line 251, in rmtree\n(nova.exception): TRACE:     os.rmdir(path)\n(nova.exception): TRACE: OSError: [Errno 16] Device or resource busy: '/var/lib/nova/instances/instance-00000001/rootfs'\n(nova.exception): TRACE:\n2011-09-06 17:29:26,661 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.7/nova/exception.py\", line 129, in wrapped\n(nova.rpc): TRACE:     raise Error(str(e))\n(nova.rpc): TRACE: Error: [Errno 16] Device or resource busy: '/var/lib/nova/instances/instance-00000001/rootfs'\n(nova.rpc): TRACE:\n", 
            "date_created": "2011-09-06 16:31:22.389492+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "Instance remained 'running' - further attempts to terminate it resulted in the error in the original bug report\n\nI'm using these test instructions with modifications for LXC to setup a single node install:\n\n https://wiki.ubuntu.com/ServerTeam/Oneiric/OpenStackTestPlan", 
            "date_created": "2011-09-06 16:32:35.172213+00:00", 
            "author": "https://api.launchpad.net/1.0/~james-page"
        }, 
        {
            "content": "Marking High importance in Ubuntu, as this basically renders LXC unusable on nova. Probably an upstream bug, so adding an also-affects.", 
            "date_created": "2011-09-09 23:26:49.676087+00:00", 
            "author": "https://api.launchpad.net/1.0/~clint-fewbar"
        }, 
        {
            "content": "This should be in the new snapshot for Ubuntu.", 
            "date_created": "2011-09-16 01:22:57.508353+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "No fix committed in nova ?", 
            "date_created": "2011-09-20 14:39:00.472704+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Marking fix released for Ubuntu task, as zul believes this to be resolved.  Please re-open if this is not the case, thanks.", 
            "date_created": "2011-09-20 23:15:54.780352+00:00", 
            "author": "https://api.launchpad.net/1.0/~davewalker"
        }
    ]
}