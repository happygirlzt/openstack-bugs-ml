{
    "status": "Expired", 
    "last_updated": "2016-02-02 04:17:24.295784+00:00", 
    "description": "Nova is not allowing any block-migrate transactions to occur due to false positives when testing for shared storage. This is occurring with even a simple two node setup.\n\n\n------Original Entry------\n\nIf using an environment where there are both nodes that share the nova instances directory and nodes that do NOT share the directory, any attempt to block-migrate to non-shared nodes from the controller node will fail.\n\nExample:\n1. Create an environment with one controller node and two cpu nodes.\n2. Have the controller node act as an NFS server by adding the instances directory to /etc/exports/\n3. Add this new share to the fstab of just one of the CPU nodes.\n4. Mount the new share after stacking the appropriate CPU node.\n5. Stack the unshared CPU node.\n\nThe next step applied to my scenario, but may not be necessary.\n6. Create a bootable volume in Cinder.\n7. Launch an instance from that volume, using a flavor that does NOT create a local disk. (This landed on the controller node in my scenario)\n8. Once the instance is running, attempt to block-migrate to the unshared node. (nova live-migration --block-migrate <instance> <host>)\n\nIn the past it was possible to block-migrate to and from the unshared node, then migrate without block between the shared nodes. Now in Liberty (master) the following errors appears:\n\n2015-09-08 12:09:17.052 ERROR oslo_messaging.rpc.dispatcher [req-2f320d08-ce60-4f5c-bfa3-c044246a3a18 admin admin] Exception during message handling: cld5b12 is not on local storage: Block migration can not be used with shared storage.\nTraceback (most recent call last):\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n\u00a0\u00a0\u00a0\u00a0executor_callback))\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n\u00a0\u00a0\u00a0\u00a0executor_callback)\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n\u00a0\u00a0\u00a0\u00a0result = func(ctxt, **new_args)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n\u00a0\u00a0\u00a0\u00a0payload)\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n\u00a0\u00a0\u00a0\u00a0return f(self, context, *args, **kw)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n\u00a0\u00a0\u00a0\u00a0kwargs['instance'], e, sys.exc_info())\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 4929, in check_can_live_migrate_source\n\u00a0\u00a0\u00a0\u00a0block_device_info)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5169, in check_can_live_migrate_source\n\u00a0\u00a0\u00a0\u00a0raise exception.InvalidLocalStorage(reason=reason, path=source)\n\nInvalidLocalStorage: cld5b12 is not on local storage: Block migration can not be used with shared storage.\n\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4899, in check_can_live_migrate_destination\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     dest_check_data)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/rpcapi.py\", line 392, in check_can_live_migrate_source\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     dest_check_data=dest_check_data)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     retry=retry)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 422, in _send\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     raise result\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher InvalidLocalStorage_Remote: cld5b12 is not on local storage: Block migration can not be used with shared storage.\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4929, in check_can_live_migrate_source\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     block_device_info)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5169, in check_can_live_migrate_source\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     raise exception.InvalidLocalStorage(reason=reason, path=source)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher InvalidLocalStorage: cld5b12 is not on local storage: Block migration can not be used with shared storage.\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.055 ERROR oslo_messaging._drivers.common [req-2f320d08-ce60-4f5c-bfa3-c044246a3a18 admin admin] Returning exception cld5b12 is not on local storage: Block migration can not be used with shared storage.\nTraceback (most recent call last):\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n\u00a0\u00a0\u00a0\u00a0executor_callback))\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n\u00a0\u00a0\u00a0\u00a0executor_callback)\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n\u00a0\u00a0\u00a0\u00a0result = func(ctxt, **new_args)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n\u00a0\u00a0\u00a0\u00a0payload)\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n\u00a0\u00a0\u00a0\u00a0return f(self, context, *args, **kw)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n\u00a0\u00a0\u00a0\u00a0kwargs['instance'], e, sys.exc_info())\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 4929, in check_can_live_migrate_source\n\u00a0\u00a0\u00a0\u00a0block_device_info)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5169, in check_can_live_migrate_source\n\u00a0\u00a0\u00a0\u00a0raise exception.InvalidLocalStorage(reason=reason, path=source)\n\nInvalidLocalStorage: cld5b12 is not on local storage: Block migration can not be used with shared storage.\n\u00a0to caller\n2015-09-08 12:09:17.056 ERROR oslo_messaging._drivers.common [req-2f320d08-ce60-4f5c-bfa3-c044246a3a18 admin admin] ['Traceback (most recent call last):\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\\n    result = func(ctxt, **new_args)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\\n    payload)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 4899, in check_can_live_migrate_destination\\n    dest_check_data)\\n', '  File \"/opt/stack/nova/nova/compute/rpcapi.py\", line 392, in check_can_live_migrate_source\\n    dest_check_data=dest_check_data)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\\n    retry=self.retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\\n    timeout=timeout, retry=retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\\n    retry=retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 422, in _send\\n    raise result\\n', 'InvalidLocalStorage_Remote: cld5b12 is not on local storage: Block migration can not be used with shared storage.\\nTraceback (most recent call last):\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\\n    result = func(ctxt, **new_args)\\n\\n  File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\\n    payload)\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n\\n  File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n\\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n\\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 4929, in check_can_live_migrate_source\\n    block_device_info)\\n\\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5169, in check_can_live_migrate_source\\n    raise exception.InvalidLocalStorage(reason=reason, path=source)\\n\\nInvalidLocalStorage: cld5b12 is not on local storage: Block migration can not be used with shared storage.\\n\\n']\n\nThis check appears to only check the source, and is not actually testing to see if the storage is shared between the two nodes.", 
    "tags": [
        "liberty-backport-potential", 
        "live-migration", 
        "volumes"
    ], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1493512", 
    "owner": "None", 
    "id": 1493512, 
    "index": 5752, 
    "created": "2015-09-08 19:05:56.845955+00:00", 
    "title": "n-cpu misreports shared storage when attempting to block migrate", 
    "comments": [
        {
            "content": "If using an environment where there are both nodes that share the nova instances directory and nodes that do NOT share the directory, any attempt to block-migrate to non-shared nodes from the controller node will fail.\n\nExample:\n1. Create an environment with one controller node and two cpu nodes.\n2. Have the controller node act as an NFS server by adding the instances directory to /etc/exports/\n3. Add this new share to the fstab of just one of the CPU nodes.\n4. Mount the new share after stacking the appropriate CPU node.\n5. Stack the unshared CPU node.\n\nThe next step applied to my scenario, but may not be necessary.\n6. Create a bootable volume in Cinder.\n7. Launch an instance from that volume, using a flavor that does NOT create a local disk. (This landed on the controller node in my scenario)\n8. Once the instance is running, attempt to block-migrate to the unshared node. (nova live-migration --block-migrate <instance> <host>)\n\nIn the past it was possible to block-migrate to and from the unshared node, then migrate without block between the shared nodes. Now in Liberty (master) the following errors appears:\n\n\n\n2015-09-08 12:09:17.052 ERROR oslo_messaging.rpc.dispatcher [req-2f320d08-ce60-4f5c-bfa3-c044246a3a18 admin admin] Exception during message handling: cld5b12 is not on local storage: Block migration can not be used with shared storage.\nTraceback (most recent call last):\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n    executor_callback))\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n    executor_callback)\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n    result = func(ctxt, **new_args)\n\n  File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n    payload)\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n    return f(self, context, *args, **kw)\n\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 4929, in check_can_live_migrate_source\n    block_device_info)\n\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5169, in check_can_live_migrate_source\n    raise exception.InvalidLocalStorage(reason=reason, path=source)\n\nInvalidLocalStorage: cld5b12 is not on local storage: Block migration can not be used with shared storage.\n\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4899, in check_can_live_migrate_destination\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     dest_check_data)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/rpcapi.py\", line 392, in check_can_live_migrate_source\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     dest_check_data=dest_check_data)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     retry=retry)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 422, in _send\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     raise result\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher InvalidLocalStorage_Remote: cld5b12 is not on local storage: Block migration can not be used with shared storage.\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4929, in check_can_live_migrate_source\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     block_device_info)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5169, in check_can_live_migrate_source\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher     raise exception.InvalidLocalStorage(reason=reason, path=source)\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher InvalidLocalStorage: cld5b12 is not on local storage: Block migration can not be used with shared storage.\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.052 TRACE oslo_messaging.rpc.dispatcher\n2015-09-08 12:09:17.055 ERROR oslo_messaging._drivers.common [req-2f320d08-ce60-4f5c-bfa3-c044246a3a18 admin admin] Returning exception cld5b12 is not on local storage: Block migration can not be used with shared storage.\nTraceback (most recent call last):\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n    executor_callback))\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n    executor_callback)\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n    result = func(ctxt, **new_args)\n\n  File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n    payload)\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n    return f(self, context, *args, **kw)\n\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 4929, in check_can_live_migrate_source\n    block_device_info)\n\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5169, in check_can_live_migrate_source\n    raise exception.InvalidLocalStorage(reason=reason, path=source)\n\nInvalidLocalStorage: cld5b12 is not on local storage: Block migration can not be used with shared storage.\n to caller\n2015-09-08 12:09:17.056 ERROR oslo_messaging._drivers.common [req-2f320d08-ce60-4f5c-bfa3-c044246a3a18 admin admin] ['Traceback (most recent call last):\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\\n    result = func(ctxt, **new_args)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\\n    payload)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 4899, in check_can_live_migrate_destination\\n    dest_check_data)\\n', '  File \"/opt/stack/nova/nova/compute/rpcapi.py\", line 392, in check_can_live_migrate_source\\n    dest_check_data=dest_check_data)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\\n    retry=self.retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\\n    timeout=timeout, retry=retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\\n    retry=retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 422, in _send\\n    raise result\\n', 'InvalidLocalStorage_Remote: cld5b12 is not on local storage: Block migration can not be used with shared storage.\\nTraceback (most recent call last):\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\\n    result = func(ctxt, **new_args)\\n\\n  File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\\n    payload)\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n\\n  File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n\\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n\\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 4929, in check_can_live_migrate_source\\n    block_device_info)\\n\\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5169, in check_can_live_migrate_source\\n    raise exception.InvalidLocalStorage(reason=reason, path=source)\\n\\nInvalidLocalStorage: cld5b12 is not on local storage: Block migration can not be used with shared storage.\\n\\n']\n\n\n\nThis check appears to only check the source, and is not actually testing to see if the storage is shared between the two nodes.", 
            "date_created": "2015-09-08 19:05:56.845955+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "On further review, block-migrate doesn't appear to be working at all. I restacked just the controller node and the unshared node and tried this test again with the same result. There is no shared storage between these two nodes at all, but n-cpu continues to report that it's detecting it.", 
            "date_created": "2015-09-08 22:39:40.705938+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "Retested this afternoon from scratch. Two nodes with absolutely no shared storage between them will trigger the exact same exception. I also tried migrating instances in either direction, just to make sure it wasn't just an issue with the controller node.\n\nIn every case Nova claims that the source node is on shared storage and throws the exception.\n\nHere's another log snippet from the most recent attempt:\n\n\n2015-09-09 15:31:23.632 DEBUG keystoneclient.session [req-855df685-1203-4481-9a65-558408337709 admin admin] RESP: [200] content-length: 262 x-compute-request-id: req-9c71a22d-6d21-46e5-bf29-fe000910645d connection: keep-alive date: Wed, 09 Sep 2015 22:27:27 GMT content-type: application/json x-openstack-request-id: req-9c71a22d-6d21-46e5-bf29-fe000910645d\nRESP BODY: {\"connection_info\": {\"driver_volume_type\": \"iscsi\", \"data\": {\"target_discovered\": true, \"encrypted\": false, \"qos_specs\": null, \"target_iqn\": \"iqn.2000-05.com.3pardata:20210002ac002db6\", \"target_portal\": \"172.16.1.24:3260\", \"target_lun\": 0, \"access_mode\": \"rw\"}}}\n from (pid=14936) _http_log_response /usr/local/lib/python2.7/dist-packages/keystoneclient/session.py:215\n2015-09-09 15:31:23.675 DEBUG nova.virt.libvirt.driver [req-855df685-1203-4481-9a65-558408337709 admin admin] skipping disk /dev/disk/by-path/ip-172.16.1.24:3260-iscsi-iqn.2000-05.com.3pardata:20210002ac002db6-lun-0 (vda) as it is a volume from (pid=14936) _get_instance_disk_info /opt/stack/nova/nova/virt/libvirt/driver.py:6476\n2015-09-09 15:31:23.684 DEBUG nova.virt.libvirt.driver [req-855df685-1203-4481-9a65-558408337709 admin admin] skipping disk /dev/disk/by-path/ip-172.16.1.24:3260-iscsi-iqn.2000-05.com.3pardata:20210002ac002db6-lun-0 (vda) as it is a volume from (pid=14936) _get_instance_disk_info /opt/stack/nova/nova/virt/libvirt/driver.py:6476\n2015-09-09 15:31:23.756 ERROR oslo_messaging.rpc.dispatcher [req-855df685-1203-4481-9a65-558408337709 admin admin] Exception during message handling: cld5b15 is not on local storage: Block migration can not be used with shared storage.\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 4928, in check_can_live_migrate_source\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     block_device_info)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5168, in check_can_live_migrate_source\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher     raise exception.InvalidLocalStorage(reason=reason, path=source)\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher InvalidLocalStorage: cld5b15 is not on local storage: Block migration can not be used with shared storage.\n2015-09-09 15:31:23.756 TRACE oslo_messaging.rpc.dispatcher\n2015-09-09 15:31:23.758 ERROR oslo_messaging._drivers.common [req-855df685-1203-4481-9a65-558408337709 admin admin] Returning exception cld5b15 is not on local storage: Block migration can not be used with shared storage. to caller\n2015-09-09 15:31:23.758 ERROR oslo_messaging._drivers.common [req-855df685-1203-4481-9a65-558408337709 admin admin] ['Traceback (most recent call last):\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\\n    result = func(ctxt, **new_args)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\\n    payload)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 399, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 377, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 365, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 4928, in check_can_live_migrate_source\\n    block_device_info)\\n', '  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 5168, in check_can_live_migrate_source\\n    raise exception.InvalidLocalStorage(reason=reason, path=source)\\n', 'InvalidLocalStorage: cld5b15 is not on local storage: Block migration can not be used with shared storage.\\n']\n", 
            "date_created": "2015-09-09 22:25:47.374723+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "In comment 2 you say that block migration doesn't work at all, but we have a multi-node gate job with block migration that uses lvm and it doesn't have this issue, so is this is only an issue with NFS as the backend?", 
            "date_created": "2015-09-10 16:39:32.001928+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Try this again with an LVM setup and see what happens.  Also attach your nova and cinder config files.  I'm wondering if stacking with NFS sets some config flags that makes nova assume shared storage.", 
            "date_created": "2015-09-10 16:42:45.609210+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Attaching config files for nova and cinder.", 
            "date_created": "2015-09-10 17:34:50.382317+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "", 
            "date_created": "2015-09-10 17:35:18.420003+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "Newest tests: Tried again with a LeftHand volume on the same Nova flavor with the same failure. Unstacked and reconfigured to add LVM and tested using an LVM volume on the same Nova flavor and again ended up with the same failure.", 
            "date_created": "2015-09-10 18:36:25.514107+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "A clarification here.\n\nThe case here is when a nova instance is booted from a cinder volume and the nova flavor chosen has no local storage defined.\n\nIt looks like there is a specific check for that case here:\nhttps://github.com/openstack/nova/blob/master/nova/virt/libvirt/driver.py#L5222-L5226\n\nWhich results in the exception being raised.   \n\nSo, if this isn't supported, we should probably have the log message updated for this particular case and say it's not supported.", 
            "date_created": "2015-09-10 18:43:43.548291+00:00", 
            "author": "https://api.launchpad.net/1.0/~walter-boring"
        }, 
        {
            "content": "As an FYI, this appears to be the change that caused this scenario to no longer work as I'd expected:\n\nhttps://review.openstack.org/#/c/91722/37", 
            "date_created": "2015-09-11 17:41:14.314456+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "Another test scenario attempted:\n\nInstance booted from a 3par volume. The instance uses a flavour with a local disk (Small, in this case) of 20 GB.\n\nAttempted to migrate using the same environment as the last test (no shared storage for the instances directory) and the migration once again failed.", 
            "date_created": "2015-09-11 20:11:11.073819+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "I remember that https://review.openstack.org/#/c/91722/ introduced some upgrade issue in Kilo such that you couldn't upgrade from juno to kilo in some cases, I can't remember what exactly now, dansmith would remember since I think he fixed it.\n\nhttps://review.openstack.org/#/c/108468/ was a related change after https://review.openstack.org/#/c/91722/ because it broke live migration with NFS.", 
            "date_created": "2015-09-17 18:03:03.293644+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Looks like this is the change in the libvirt driver in liberty which is blowing up:\n\nhttps://review.openstack.org/#/c/195885/\n\nBut it looks like that was specifically added for volume-backed live migration (boot from volume) but apparently doesn't work in this case?", 
            "date_created": "2015-09-17 18:25:53.782102+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "There is a tempest change here which is testing volume-backed live migration:\n\nhttps://review.openstack.org/#/c/165233/\n\nThat was passing tests, so what's different about that test and the scenario here?  The flavor?", 
            "date_created": "2015-09-17 18:30:57.678948+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "The commit message for that Tempest test specifically states that it's not to be used with block-migrate, which is what my test case is trying to use.", 
            "date_created": "2015-09-17 18:48:07.574862+00:00", 
            "author": "https://api.launchpad.net/1.0/~sseverson"
        }, 
        {
            "content": "I noticed the tempest config block_migrate_cinder_iscsi:\n\nhttps://github.com/openstack/tempest/blob/master/tempest/config.py#L363\n\n    cfg.BoolOpt('block_migrate_cinder_iscsi',\n                default=False,\n                help=\"Does the test environment block migration support \"\n                \"cinder iSCSI volumes. Note, libvirt doesn't support this, \"\n                \"see https://bugs.launchpad.net/nova/+bug/1398999\"),\n\nwhich calls out bug 1398999.  Given https://review.openstack.org/#/c/139085/ - it seems that what you're trying to do here is maybe invalid given that bug?", 
            "date_created": "2015-09-17 18:58:17.867633+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "This also looks related, landed in Kilo: https://review.openstack.org/#/c/135074/", 
            "date_created": "2015-09-17 19:30:32.097458+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Marking as liberty-backport-potential.  It sounds like there might be a regression here but not really sure, would need someone to confirm and explain why.  For now, we aren't going to hold up liberty rc1 for this.", 
            "date_created": "2015-09-23 15:49:50.165982+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "It looks like your volume is attached to a VM through iSCSI:\n\nRESP BODY: {\"connection_info\": {\"driver_volume_type\": \"iscsi\", \"data\": {\"target_discovered\": true, \"encrypted\": false, \"qos_specs\": null, \"target_iqn\": \"iqn.2000-05.com.3pardata:20210002ac002db6\", \"target_portal\": \"172.16.1.24:3260\", \"target_lun\": 0, \"access_mode\": \"rw\"}}}\n\nSo it means that you can't block live migrate it - basically this happens because volume is \"shared\" through iSCSI (it also might be fiber channel in case of 3par backend).", 
            "date_created": "2015-09-30 11:26:41.899749+00:00", 
            "author": "https://api.launchpad.net/1.0/~pawel-koniszewski"
        }, 
        {
            "content": "Could you please clarify what do you use to attach your LVM/LeftHand/3par volumes? iSCSI, FC or something else?  Marking as incomplete - we need clear steps for reproduction.", 
            "date_created": "2015-09-30 11:29:28.814336+00:00", 
            "author": "https://api.launchpad.net/1.0/~pawel-koniszewski"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2016-02-02 04:17:21.222246+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}