{
    "status": "Invalid", 
    "last_updated": "2015-09-23 19:03:48.495267+00:00", 
    "description": "Instances migrate with iSER drived volume fails. Probably due different path of attached iSER volume because of different pci-id of infiniband controllers:\n\ntrace:\n\nMar 10 14:23:37 compute2 nova-compute: Traceback (most recent call last):\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/hubs/poll.py\", line 115, in wait\nMar 10 14:23:37 compute2 nova-compute: listener.cb(fileno)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 212, in main\nMar 10 14:23:37 compute2 nova-compute: result = function(*args, **kwargs)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5415, in _live_migration\nMar 10 14:23:37 compute2 nova-compute: recover_method(context, instance, dest, block_migration)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\nMar 10 14:23:37 compute2 nova-compute: six.reraise(self.type_, self.value, self.tb)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5382, in _live_migration\nMar 10 14:23:37 compute2 nova-compute: CONF.libvirt.live_migration_bandwidth)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\nMar 10 14:23:37 compute2 nova-compute: result = proxy_call(self._autowrap, f, *args, **kwargs)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\nMar 10 14:23:37 compute2 nova-compute: rv = execute(f, *args, **kwargs)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\nMar 10 14:23:37 compute2 nova-compute: six.reraise(c, e, tb)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\nMar 10 14:23:37 compute2 nova-compute: rv = meth(*args, **kwargs)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 1264, in migrateToURI2\nMar 10 14:23:37 compute2 nova-compute: if ret == -1: raise libvirtError ('virDomainMigrateToURI2() failed', dom=self)\nMar 10 14:23:37 compute2 nova-compute: libvirtError: Failed to open file '/dev/disk/by-path/pci-0000:08:00.0-ip-10.2.11.12:3260-iscsi-iqn.2010-10.org.iser.openstack:volume-cf40905c-0418-4a36-8f41-7bfe5a3767b7-lun-1': No such file or directory\n\nVolume is correctly connected to destination compute node, but it has different path:\n\nmigration source node:\n\npci-0000:08:00.0-ip-10.2.11.12:3260-iscsi-iqn.2010-10.org.iser.openstack:volume-cf40905c-0418-4a36-8f41-7bfe5a3767b7-lun-1 -> ../../sde\n\nmigration destination node:\n\npci-0000:05:00.0-ip-10.2.11.12:3260-iscsi-iqn.2010-10.org.iser.openstack:volume-cf40905c-0418-4a36-8f41-7bfe5a3767b7-lun-1 -> ../../sdf\n\n\nBoth nodes are not the same and have different pci tree which affect /dev/disk/by-path naming scheme\n\nsource node:\n[root@compute2 by-path]# lspci | grep Mellanox\n08:00.0 InfiniBand: Mellanox Technologies MT26428 [ConnectX VPI PCIe 2.0 5GT/s - IB QDR / 10GigE] (rev b0)\n\ndest node:\n[root@compute1 by-path]# lspci  | grep Mellanox\n05:00.0 InfiniBand: Mellanox Technologies MT26428 [ConnectX VPI PCIe 2.0 5GT/s - IB QDR / 10GigE] (rev a0)\n\nPCI number of infiniband controller correspond to disk/by-path scheme.\n\n\nThe same situation occur with iSER volume backed instance.\n\n\nrunning Centos 7 with stable Juno", 
    "tags": [
        "volumes"
    ], 
    "importance": "Low", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1430364", 
    "owner": "None", 
    "id": 1430364, 
    "index": 326, 
    "created": "2015-03-10 14:49:25.669292+00:00", 
    "title": "instance live migrate with iSER connected volume fails", 
    "comments": [
        {
            "content": "Instances migrate with iSER drived volume fails. Probably due different path of attached iSER volume because of different pci-id of infiniband controllers:\n\ntrace:\n\nMar 10 14:23:37 compute2 nova-compute: Traceback (most recent call last):\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/hubs/poll.py\", line 115, in wait\nMar 10 14:23:37 compute2 nova-compute: listener.cb(fileno)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 212, in main\nMar 10 14:23:37 compute2 nova-compute: result = function(*args, **kwargs)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5415, in _live_migration\nMar 10 14:23:37 compute2 nova-compute: recover_method(context, instance, dest, block_migration)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\nMar 10 14:23:37 compute2 nova-compute: six.reraise(self.type_, self.value, self.tb)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5382, in _live_migration\nMar 10 14:23:37 compute2 nova-compute: CONF.libvirt.live_migration_bandwidth)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\nMar 10 14:23:37 compute2 nova-compute: result = proxy_call(self._autowrap, f, *args, **kwargs)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\nMar 10 14:23:37 compute2 nova-compute: rv = execute(f, *args, **kwargs)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\nMar 10 14:23:37 compute2 nova-compute: six.reraise(c, e, tb)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\nMar 10 14:23:37 compute2 nova-compute: rv = meth(*args, **kwargs)\nMar 10 14:23:37 compute2 nova-compute: File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 1264, in migrateToURI2\nMar 10 14:23:37 compute2 nova-compute: if ret == -1: raise libvirtError ('virDomainMigrateToURI2() failed', dom=self)\nMar 10 14:23:37 compute2 nova-compute: libvirtError: Failed to open file '/dev/disk/by-path/pci-0000:08:00.0-ip-10.2.11.12:3260-iscsi-iqn.2010-10.org.iser.openstack:volume-cf40905c-0418-4a36-8f41-7bfe5a3767b7-lun-1': No such file or directory\n\nVolume is correctly connected to destination compute node, but it has different path:\n\nmigration source node:\n\npci-0000:08:00.0-ip-10.2.11.12:3260-iscsi-iqn.2010-10.org.iser.openstack:volume-cf40905c-0418-4a36-8f41-7bfe5a3767b7-lun-1 -> ../../sde\n\nmigration destination node:\n\npci-0000:05:00.0-ip-10.2.11.12:3260-iscsi-iqn.2010-10.org.iser.openstack:volume-cf40905c-0418-4a36-8f41-7bfe5a3767b7-lun-1 -> ../../sdf\n\n\nBoth nodes are not the same and have different pci tree which affect /dev/disk/by-path naming scheme\n\nsource node:\n[root@compute2 by-path]# lspci | grep Mellanox\n08:00.0 InfiniBand: Mellanox Technologies MT26428 [ConnectX VPI PCIe 2.0 5GT/s - IB QDR / 10GigE] (rev b0)\n\ndest node:\n[root@compute1 by-path]# lspci  | grep Mellanox\n05:00.0 InfiniBand: Mellanox Technologies MT26428 [ConnectX VPI PCIe 2.0 5GT/s - IB QDR / 10GigE] (rev a0)\n\nPCI number of infiniband controller correspond to disk/by-path scheme.\n\n\nThe same situation occur with iSER volume backed instance.\n\n\nrunning Centos 7 with stable Juno", 
            "date_created": "2015-03-10 14:49:25.669292+00:00", 
            "author": "https://api.launchpad.net/1.0/~m-dan-3"
        }, 
        {
            "content": "Hi Dan, \n\nLooking at the trace I can see that  you did live migration.\nLive migration is currently not support with Mellanox Driver, but Cold Migration should work.\nIf you have problem with iser  Cold Migration please open different bug ( I am changing the description to  \n\"instance live migrate with iSER connected volume fails \"\n\n", 
            "date_created": "2015-04-02 10:16:40.308230+00:00", 
            "author": "https://api.launchpad.net/1.0/~moshele"
        }, 
        {
            "content": "Per comment 1 live migration with mellanox wasn't supported in the level of code tested here.  If this is still an issue with cold migration then please open a new bug - but make sure it's tested against the latest liberty code.", 
            "date_created": "2015-09-23 19:03:48.018605+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ]
}