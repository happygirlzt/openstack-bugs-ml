{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:15:54.508177+00:00", 
    "description": "Trying cold migrate\n\nstack@o11n200:/root$ nova list\n+--------------------------------------+-------------------+--------+------------+-------------+--------------------+\n| ID                                   | Name              | Status | Task State | Power State | Networks           |\n+--------------------------------------+-------------------+--------+------------+-------------+--------------------+\n| 476324ba-644c-472b-9de7-e4434d8211bc | fedora_instance_1 | ACTIVE | -          | Running     | private=10.140.0.2 |\n| 3dae14aa-9168-4b5c-bb7f-3f38315dc791 | fedora_instance_2 | ACTIVE | -          | Running     | private=10.140.0.6 |\n| e80b5863-f228-49ac-b35f-8d10a0d6e4eb | fedora_instance_3 | ACTIVE | -          | Running     | private=10.140.0.8 |\n| 05b2ea29-ebcd-4a25-9582-6fbd223fba73 | fedora_instance_4 | ACTIVE | -          | Running     | private=10.140.0.7 |\n+--------------------------------------+-------------------+--------+------------+-------------+--------------------+\nstack@o11n200:/root$ nova migrate fedora_instance_3\nERROR (BadRequest): The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400) (Request-ID: req-86801856-94cf-43c1-b21e-cb084abf8aac)\n\nScreen (n-api)\n\n2014-11-20 14:01:48.426 ERROR nova.api.openstack.compute.contrib.admin_actions [req-86801856-94cf-43c1-b21e-cb084abf8aac admin admin] Error in migrate u'\\'extra_specs\\'\\nTraceb\nack (most recent call last):\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\\n    incoming.message))\\n\\n  \nFile \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\\n    return self._do_dispatch(endpoint, method, ctxt, args)\\n\\n  File \"/u\nsr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\\n    result = getattr(endpoint, method)(ctxt, **new_args)\\n\\n  File \"/usr/loca\nl/lib/python2.7/dist-packages/oslo/messaging/rpc/server.py\", line 139, in inner\\n    return func(*args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 49\n0, in migrate_server\\n    reservations)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 550, in _cold_migrate\\n    quotas.rollback()\\n\\n  File \"/usr/local/lib/pytho\nn2.7/dist-packages/oslo/utils/excutils.py\", line 82, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 5\n36, in _cold_migrate\\n    request_spec[\\'instance_type\\'].pop(\\'extra_specs\\')\\n\\nKeyError: \\'extra_specs\\'\\n'\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions Traceback (most recent call last):\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/admin_actions.py\", line 151, in _migrate\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     self.compute_api.resize(req.environ['nova.context'], instance)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 221, in wrapped\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     return func(self, context, target, *args, **kwargs)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 211, in inner\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     return function(self, context, instance, *args, **kwargs)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 238, in _wrapped\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     return fn(self, context, instance, *args, **kwargs)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 192, in inner\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     return f(self, context, instance, *args, **kw)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 2598, in resize\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     reservations=quotas.reservations or [])\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/conductor/api.py\", line 345, in resize_instance\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     None, None, reservations)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 414, in migrate_server\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     reservations=reservations)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     retry=self.retry)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     timeout=timeout, retry=retry)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 408, in send\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     retry=retry)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 399, in _send\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     raise result\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions KeyError: u'\\'extra_specs\\'\\nTraceback (most recent call last):\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\\n    incoming.message))\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\\n    return self._do_dispatch(endpoint, method, ctxt, args)\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\\n    result = getattr(endpoint, method)(ctxt, **new_args)\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/server.py\", line 139, in inner\\n    return func(*args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 490, in migrate_server\\n    reservations)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 550, in _cold_migrate\\n    quotas.rollback()\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/utils/excutils.py\", line 82, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 536, in _cold_migrate\\n    request_spec[\\'instance_type\\'].pop(\\'extra_specs\\')\\n\\nKeyError: \\'extra_specs\\'\\n'\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions \n\n\nstack@o11n200:/root$ nova-manage --version\n2015.1", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1394569", 
    "owner": "https://api.launchpad.net/1.0/~dims-v", 
    "id": 1394569, 
    "index": 176, 
    "created": "2014-11-20 13:05:40.040799+00:00", 
    "title": "KeyError 'extra_specs' in _cold_migrate", 
    "comments": [
        {
            "content": "Trying cold migrate\n\nstack@o11n200:/root$ nova list\n+--------------------------------------+-------------------+--------+------------+-------------+--------------------+\n| ID                                   | Name              | Status | Task State | Power State | Networks           |\n+--------------------------------------+-------------------+--------+------------+-------------+--------------------+\n| 476324ba-644c-472b-9de7-e4434d8211bc | fedora_instance_1 | ACTIVE | -          | Running     | private=10.140.0.2 |\n| 3dae14aa-9168-4b5c-bb7f-3f38315dc791 | fedora_instance_2 | ACTIVE | -          | Running     | private=10.140.0.6 |\n| e80b5863-f228-49ac-b35f-8d10a0d6e4eb | fedora_instance_3 | ACTIVE | -          | Running     | private=10.140.0.8 |\n| 05b2ea29-ebcd-4a25-9582-6fbd223fba73 | fedora_instance_4 | ACTIVE | -          | Running     | private=10.140.0.7 |\n+--------------------------------------+-------------------+--------+------------+-------------+--------------------+\nstack@o11n200:/root$ nova migrate fedora_instance_3\nERROR (BadRequest): The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400) (Request-ID: req-86801856-94cf-43c1-b21e-cb084abf8aac)\n\nScreen (n-api)\n\n2014-11-20 14:01:48.426 ERROR nova.api.openstack.compute.contrib.admin_actions [req-86801856-94cf-43c1-b21e-cb084abf8aac admin admin] Error in migrate u'\\'extra_specs\\'\\nTraceb\nack (most recent call last):\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\\n    incoming.message))\\n\\n  \nFile \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\\n    return self._do_dispatch(endpoint, method, ctxt, args)\\n\\n  File \"/u\nsr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\\n    result = getattr(endpoint, method)(ctxt, **new_args)\\n\\n  File \"/usr/loca\nl/lib/python2.7/dist-packages/oslo/messaging/rpc/server.py\", line 139, in inner\\n    return func(*args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 49\n0, in migrate_server\\n    reservations)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 550, in _cold_migrate\\n    quotas.rollback()\\n\\n  File \"/usr/local/lib/pytho\nn2.7/dist-packages/oslo/utils/excutils.py\", line 82, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 5\n36, in _cold_migrate\\n    request_spec[\\'instance_type\\'].pop(\\'extra_specs\\')\\n\\nKeyError: \\'extra_specs\\'\\n'\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions Traceback (most recent call last):\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/admin_actions.py\", line 151, in _migrate\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     self.compute_api.resize(req.environ['nova.context'], instance)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 221, in wrapped\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     return func(self, context, target, *args, **kwargs)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 211, in inner\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     return function(self, context, instance, *args, **kwargs)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 238, in _wrapped\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     return fn(self, context, instance, *args, **kwargs)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 192, in inner\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     return f(self, context, instance, *args, **kw)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/compute/api.py\", line 2598, in resize\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     reservations=quotas.reservations or [])\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/conductor/api.py\", line 345, in resize_instance\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     None, None, reservations)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 414, in migrate_server\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     reservations=reservations)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     retry=self.retry)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     timeout=timeout, retry=retry)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 408, in send\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     retry=retry)\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 399, in _send\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions     raise result\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions KeyError: u'\\'extra_specs\\'\\nTraceback (most recent call last):\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\\n    incoming.message))\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\\n    return self._do_dispatch(endpoint, method, ctxt, args)\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\\n    result = getattr(endpoint, method)(ctxt, **new_args)\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/server.py\", line 139, in inner\\n    return func(*args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 490, in migrate_server\\n    reservations)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 550, in _cold_migrate\\n    quotas.rollback()\\n\\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/utils/excutils.py\", line 82, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 536, in _cold_migrate\\n    request_spec[\\'instance_type\\'].pop(\\'extra_specs\\')\\n\\nKeyError: \\'extra_specs\\'\\n'\n2014-11-20 14:01:48.426 TRACE nova.api.openstack.compute.contrib.admin_actions \n\n\nstack@o11n200:/root$ nova-manage --version\n2015.1", 
            "date_created": "2014-11-20 13:05:40.040799+00:00", 
            "author": "https://api.launchpad.net/1.0/~cubusbacau"
        }, 
        {
            "content": "Vladik, i'd like to work on this one, if it's ok", 
            "date_created": "2014-11-24 12:40:22.199306+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/136747", 
            "date_created": "2014-11-24 12:40:59.862788+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/136747\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=709aee3370be6719db92b8860e8b9f73aec866fc\nSubmitter: Jenkins\nBranch:    master\n\ncommit 709aee3370be6719db92b8860e8b9f73aec866fc\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Mon Nov 24 07:37:11 2014 -0500\n\n    Fix for extra_specs KeyError\n    \n    During _cold_migrate, there is a code path when\n    extra_specs is not present in the request_spec['instance_type']\n    bag. Identified one test case where removing extra_specs\n    causes the same error as reported in the bug below. We\n    just need to tolerate this by using a default value for pop()\n    \n    Closes-Bug: #1394569\n    \n    Change-Id: I9d4d02069322af1a1f0b84c1e86d2e586c6712d8\n", 
            "date_created": "2014-11-24 16:16:13.759517+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/137036", 
            "date_created": "2014-11-25 12:17:39.325886+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/137036\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=04d6471f48f72657950198c8e566a2978f0583b2\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit 04d6471f48f72657950198c8e566a2978f0583b2\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Mon Nov 24 07:37:11 2014 -0500\n\n    Fix for extra_specs KeyError\n    \n    During _cold_migrate, there is a code path when\n    extra_specs is not present in the request_spec['instance_type']\n    bag. Identified one test case where removing extra_specs\n    causes the same error as reported in the bug below. We\n    just need to tolerate this by using a default value for pop()\n    \n    Closes-Bug: #1394569\n    \n    Conflicts:\n            nova/tests/unit/conductor/test_conductor.py\n    \n    Change-Id: I9d4d02069322af1a1f0b84c1e86d2e586c6712d8\n    (cherry picked from commit 709aee3370be6719db92b8860e8b9f73aec866fc)\n", 
            "date_created": "2014-11-27 03:51:14.429874+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}