{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:14:24.288416+00:00", 
    "description": "1. Change OpenStack server to Russian locale, LANG=ru_RU.utf8\n\n2. Set firefox client browser locale to russian(ru)\n\n3. Trigger an operational failure that has a message that tries to get written to a Nova instance fault\n\n\nStacktrace\n\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 302, in decorated_function\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 288, in decorated_function\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 330, in decorated_function\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/utils.py\", line 94, in add_instance_fault_from_exc\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     fault_obj.create()\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 204, in wrapper\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     return fn(self, ctxt, *args, **kwargs)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/objects/instance_fault.py\", line 75, in create\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     db_fault = db.instance_fault_create(context, values)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 1816, in instance_fault_create\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     return IMPL.instance_fault_create(context, values)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 5423, in instance_fault_create\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     fault_ref.save()\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/models.py\", line 62, in save\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     super(NovaBase, self).save(session=session)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/models.py\", line 48, in save\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     session.flush()\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1818, in flush\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     self._flush(objects)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1936, in _flush\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     transaction.rollback(_capture_exception=True)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/util/langhelpers.py\", line 58, in __exit__\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     compat.reraise(exc_type, exc_value, exc_tb)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1900, in _flush\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     flush_context.execute()\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 372, in execute\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     rec.execute(self)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 525, in execute\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     uow\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/persistence.py\", line 64, in save_obj\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     table, insert)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/persistence.py\", line 569, in _emit_insert_statements\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     execute(statement, params)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 662, in execute\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     params)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 761, in _execute_clauseelement\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     compiled_sql, distilled_params\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 874, in _execute_context\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     context)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/compat/handle_error.py\", line 125, in _handle_dbapi_exception\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     six.reraise(type(newraise), newraise, sys.exc_info()[2])\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/compat/handle_error.py\", line 102, in _handle_dbapi_exception\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     per_fn = fn(ctx)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/exc_filters.py\", line 323, in handler\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     context.is_disconnect)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/exc_filters.py\", line 278, in _raise_for_remaining_DBAPIError\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     raise exception.DBError(error)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher DBError: (DataError) ibm_db_dbi::DataError: Sending data failed: [IBM][CLI Driver] CLI0109E  String data right truncation. SQLSTATE=22001 SQLCODE=-99999 'INSERT INTO instance_faults (deleted_at, deleted, created_at, updated_at, instance_uuid, code, message, details, host) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)' (None, 0, datetime.datetime(2014, 10, 30, 9, 55, 34, 42767), None, '1b73ce51-e2b2-4704-ab4a-1c2178e6b0b1', 500, 'NV-918894F \\xd0\\x92\\xd0\\xb8\\xd1\\x80\\xd1\\x82\\xd1\\x83\\xd0\\xb0\\xd0\\xbb\\xd1\\x8c\\xd0\\xbd\\xd0\\xb0\\xd1\\x8f \\xd0\\xbc\\xd0\\xb0\\xd1\\x88\\xd0\\xb8\\xd0\\xbd\\xd0\\xb0 Image_rhel65_-1b73ce51-00000001 \\xd1\\x80\\xd0\\xb0\\xd0\\xb1\\xd0\\xbe\\xd1\\x82\\xd0\\xb0\\xd0\\xbb\\xd0\\xb0 \\xd0\\xb2 \\xd0\\xbc\\xd0\\xbe\\xd0\\xbc\\xd0\\xb5\\xd0\\xbd\\xd1\\x82 \\xd1\\x81\\xd0\\xbe\\xd0\\xb7\\xd0\\xb4\\xd0\\xb0\\xd0\\xbd\\xd0\\xb8\\xd1\\x8f \\xd0\\xbc\\xd0\\xbe\\xd0\\xbc\\xd0\\xb5\\xd0\\xbd\\xd1\\x82\\xd0\\xb0\\xd0\\xbb\\xd1\\x8c\\xd0\\xbd\\xd0\\xbe\\xd0\\xb9 \\xd0\\xba\\xd0\\xbe\\xd0\\xbf\\xd0\\xb8\\xd0\\xb8. \\xd0\\x92\\xd0\\xb8\\xd1\\x80\\xd1\\x82\\xd1\\x83\\xd0\\xb0\\xd0\\xbb\\xd1\\x8c\\xd0\\xbd\\xd1\\x8b\\xd0\\xb5 \\xd0\\xbc\\xd0\\xb0\\xd1\\x88\\xd0\\xb8\\xd0\\xbd\\xd1\\x8b \\xd0\\xb4\\xd0\\xbe\\xd0\\xbb\\xd0\\xb6\\xd0\\xbd\\xd1\\x8b \\xd0\\xb1\\xd1\\x8b\\xd1\\x82\\xd1\\x8c \\xd0\\xbe\\xd1\\x81\\xd1\\x82\\xd0\\xb0\\xd0\\xbd\\xd0\\xbe\\xd0\\xb2\\xd0\\xbb\\xd0\\xb5\\xd0\\xbd\\xd1\\x8b \\xd0\\xbf\\xd0\\xb5\\xd1\\x80\\xd0\\xb5\\xd0\\xb4 \\xd1\\x81\\xd0\\xbe\\xd0\\xb7\\xd0\\xb4\\xd0\\xb0\\xd0\\xbd\\xd0\\xb8\\xd0\\xb5\\xd0\\xbc \\xd0\\xbc\\xd0\\xbe\\xd0\\xbc\\xd0\\xb5\\xd0\\xbd\\xd1\\x82\\xd0\\xb0\\xd0\\xbb\\xd1\\x8c\\xd0\\xbd\\xd0\\xbe\\xd0\\xb9 \\xd0\\xba\\xd0\\xbe\\xd0\\xbf\\xd0\\xb8\\xd0\\xb8.', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 318, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 378, in decorated_function\\n    instance=instance)\\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 368, in decorated_function\\n    *args, **kwargs)\\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 3071, in snapshot_instance\\n    task_states.IMAGE_SNAPSHOT)\\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 3106, in _snapshot_instance\\n    update_task_state)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/__init__.py\", line 96, in wrapper\\n    r = f(*args, **kwds)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/virt/ibmpowervm/hmc/driver.py\", line 683, in snapshot\\n    image.capture(context, host, instance, image_entry, update_task_state)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/__init__.py\", line 96, in wrapper\\n    r = f(*args, **kwds)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/virt/ibmpowervm/hmc/image.py\", line 280, in capture\\n    e)\\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/virt/ibmpowervm/hmc/image.py\", line 260, in capture\\n    self._wait_for_instance_to_stop(instance, host)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/__init__.py\", line 96, in wrapper\\n    r = f(*args, **kwds)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/virt/ibmpowervm/hmc/image.py\", line 339, in _wait_for_instance_to_stop\\n    instance_name=instance[\\'name\\'])\\n', '828421A_TU00156')\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher", 
    "tags": [
        "compute", 
        "i18n", 
        "in-stable-juno", 
        "juno-backport-potential"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1389102", 
    "owner": "https://api.launchpad.net/1.0/~zhaoqin", 
    "id": 1389102, 
    "index": 4098, 
    "created": "2014-11-04 07:07:42.376357+00:00", 
    "title": "Instance error message truncation error in non-English locale", 
    "comments": [
        {
            "content": "1. Change OpenStack server to Russian locale, LANG=ru_RU.utf8\n\n2. Set firefox client browser locale to russian(ru)\n\n3. Trigger an operational failure that has a message that tries to get written to a Nova instance fault\n\n\nStacktrace\n\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 302, in decorated_function\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 288, in decorated_function\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 330, in decorated_function\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/utils.py\", line 94, in add_instance_fault_from_exc\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     fault_obj.create()\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 204, in wrapper\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     return fn(self, ctxt, *args, **kwargs)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/objects/instance_fault.py\", line 75, in create\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     db_fault = db.instance_fault_create(context, values)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 1816, in instance_fault_create\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     return IMPL.instance_fault_create(context, values)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 5423, in instance_fault_create\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     fault_ref.save()\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/models.py\", line 62, in save\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     super(NovaBase, self).save(session=session)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/models.py\", line 48, in save\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     session.flush()\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1818, in flush\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     self._flush(objects)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1936, in _flush\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     transaction.rollback(_capture_exception=True)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/util/langhelpers.py\", line 58, in __exit__\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     compat.reraise(exc_type, exc_value, exc_tb)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/session.py\", line 1900, in _flush\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     flush_context.execute()\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 372, in execute\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     rec.execute(self)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/unitofwork.py\", line 525, in execute\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     uow\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/persistence.py\", line 64, in save_obj\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     table, insert)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/orm/persistence.py\", line 569, in _emit_insert_statements\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     execute(statement, params)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 662, in execute\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     params)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 761, in _execute_clauseelement\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     compiled_sql, distilled_params\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib64/python2.6/site-packages/sqlalchemy/engine/base.py\", line 874, in _execute_context\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     context)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/compat/handle_error.py\", line 125, in _handle_dbapi_exception\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     six.reraise(type(newraise), newraise, sys.exc_info()[2])\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/compat/handle_error.py\", line 102, in _handle_dbapi_exception\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     per_fn = fn(ctx)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/exc_filters.py\", line 323, in handler\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     context.is_disconnect)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/db/sqlalchemy/exc_filters.py\", line 278, in _raise_for_remaining_DBAPIError\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher     raise exception.DBError(error)\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher DBError: (DataError) ibm_db_dbi::DataError: Sending data failed: [IBM][CLI Driver] CLI0109E  String data right truncation. SQLSTATE=22001 SQLCODE=-99999 'INSERT INTO instance_faults (deleted_at, deleted, created_at, updated_at, instance_uuid, code, message, details, host) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)' (None, 0, datetime.datetime(2014, 10, 30, 9, 55, 34, 42767), None, '1b73ce51-e2b2-4704-ab4a-1c2178e6b0b1', 500, 'NV-918894F \\xd0\\x92\\xd0\\xb8\\xd1\\x80\\xd1\\x82\\xd1\\x83\\xd0\\xb0\\xd0\\xbb\\xd1\\x8c\\xd0\\xbd\\xd0\\xb0\\xd1\\x8f \\xd0\\xbc\\xd0\\xb0\\xd1\\x88\\xd0\\xb8\\xd0\\xbd\\xd0\\xb0 Image_rhel65_-1b73ce51-00000001 \\xd1\\x80\\xd0\\xb0\\xd0\\xb1\\xd0\\xbe\\xd1\\x82\\xd0\\xb0\\xd0\\xbb\\xd0\\xb0 \\xd0\\xb2 \\xd0\\xbc\\xd0\\xbe\\xd0\\xbc\\xd0\\xb5\\xd0\\xbd\\xd1\\x82 \\xd1\\x81\\xd0\\xbe\\xd0\\xb7\\xd0\\xb4\\xd0\\xb0\\xd0\\xbd\\xd0\\xb8\\xd1\\x8f \\xd0\\xbc\\xd0\\xbe\\xd0\\xbc\\xd0\\xb5\\xd0\\xbd\\xd1\\x82\\xd0\\xb0\\xd0\\xbb\\xd1\\x8c\\xd0\\xbd\\xd0\\xbe\\xd0\\xb9 \\xd0\\xba\\xd0\\xbe\\xd0\\xbf\\xd0\\xb8\\xd0\\xb8. \\xd0\\x92\\xd0\\xb8\\xd1\\x80\\xd1\\x82\\xd1\\x83\\xd0\\xb0\\xd0\\xbb\\xd1\\x8c\\xd0\\xbd\\xd1\\x8b\\xd0\\xb5 \\xd0\\xbc\\xd0\\xb0\\xd1\\x88\\xd0\\xb8\\xd0\\xbd\\xd1\\x8b \\xd0\\xb4\\xd0\\xbe\\xd0\\xbb\\xd0\\xb6\\xd0\\xbd\\xd1\\x8b \\xd0\\xb1\\xd1\\x8b\\xd1\\x82\\xd1\\x8c \\xd0\\xbe\\xd1\\x81\\xd1\\x82\\xd0\\xb0\\xd0\\xbd\\xd0\\xbe\\xd0\\xb2\\xd0\\xbb\\xd0\\xb5\\xd0\\xbd\\xd1\\x8b \\xd0\\xbf\\xd0\\xb5\\xd1\\x80\\xd0\\xb5\\xd0\\xb4 \\xd1\\x81\\xd0\\xbe\\xd0\\xb7\\xd0\\xb4\\xd0\\xb0\\xd0\\xbd\\xd0\\xb8\\xd0\\xb5\\xd0\\xbc \\xd0\\xbc\\xd0\\xbe\\xd0\\xbc\\xd0\\xb5\\xd0\\xbd\\xd1\\x82\\xd0\\xb0\\xd0\\xbb\\xd1\\x8c\\xd0\\xbd\\xd0\\xbe\\xd0\\xb9 \\xd0\\xba\\xd0\\xbe\\xd0\\xbf\\xd0\\xb8\\xd0\\xb8.', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 318, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 378, in decorated_function\\n    instance=instance)\\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 368, in decorated_function\\n    *args, **kwargs)\\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 3071, in snapshot_instance\\n    task_states.IMAGE_SNAPSHOT)\\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 3106, in _snapshot_instance\\n    update_task_state)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/__init__.py\", line 96, in wrapper\\n    r = f(*args, **kwds)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/virt/ibmpowervm/hmc/driver.py\", line 683, in snapshot\\n    image.capture(context, host, instance, image_entry, update_task_state)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/__init__.py\", line 96, in wrapper\\n    r = f(*args, **kwds)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/virt/ibmpowervm/hmc/image.py\", line 280, in capture\\n    e)\\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 82, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/virt/ibmpowervm/hmc/image.py\", line 260, in capture\\n    self._wait_for_instance_to_stop(instance, host)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/__init__.py\", line 96, in wrapper\\n    r = f(*args, **kwds)\\n  File \"/usr/lib/python2.6/site-packages/powervc_nova/virt/ibmpowervm/hmc/image.py\", line 339, in _wait_for_instance_to_stop\\n    instance_name=instance[\\'name\\'])\\n', '828421A_TU00156')\n2014-10-30 05:55:34.933 18371 TRACE oslo.messaging.rpc.dispatcher", 
            "date_created": "2014-11-04 07:07:42.376357+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhaoqin"
        }, 
        {
            "content": "The code in nova/compute/utils.py function exception_to_dict, is already trimming the message to 255 characters but it is doing this on the unicode string.  The string must be trimmed to 255 characters in an encoded manner to avoid this issue for non-English locales.", 
            "date_created": "2014-11-04 07:09:00.723528+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhaoqin"
        }, 
        {
            "content": "The code in nova/compute/utils.py function exception_to_dict, is already trimming the message to 255 characters but it is doing this on the unicode string.  The string must be trimmed to 255 characters in an encoded manner to avoid this issue for non-English locales.", 
            "date_created": "2014-11-04 07:09:15.655310+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhaoqin"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/132642", 
            "date_created": "2014-11-04 09:10:47.322864+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/132642\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=bd9c32289ff8cf1bc67c1395ad921c703aa4c489\nSubmitter: Jenkins\nBranch:    master\n\ncommit bd9c32289ff8cf1bc67c1395ad921c703aa4c489\nAuthor: Qin Zhao <email address hidden>\nDate:   Tue Nov 4 16:57:45 2014 +0800\n\n    Truncate encoded instance message to 255\n    \n    In nova/compute/utils.py function exception_to_dict truncates unicode\n    message to 255. However, in non-English locales, instance message may\n    be longer than 255 after encoding the unicode message to byte message.\n    Need to truncate the encoded byte message to 255, in order to ensure\n    db insert operation succeed.\n    \n    Change-Id: I70cd2d6e4590ea95510c1ea3d51287f0dea14956\n    Closes-Bug: 1389102\n", 
            "date_created": "2014-11-14 03:17:54.710840+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/134448", 
            "date_created": "2014-11-14 06:14:02.835598+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Qin Zhao (<email address hidden>) on branch: stable/juno\nReview: https://review.openstack.org/134448", 
            "date_created": "2014-11-14 06:14:57.004159+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Qin Zhao (<email address hidden>) on branch: stable/juno\nReview: https://review.openstack.org/134448", 
            "date_created": "2014-11-14 15:13:15.015425+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/134597", 
            "date_created": "2014-11-14 16:43:11.149054+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Need to take care of utf-8 byte character size when truncating the byte string. For example, '\\xd0\\x92' is a 2 bytes character. UnicodeDecodeError will occur, if we truncate it in the middle:\n\n>>> a = '\\xd0\\x92' * 150\n>>> encodeutils.safe_decode(a[:255])\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/lib/python2.6/site-packages/oslo/utils/encodeutils.py\", line 57, in safe_decode\n    return text.decode('utf-8', errors)\n  File \"/usr/lib64/python2.6/encodings/utf_8.py\", line 16, in decode\n    return codecs.utf_8_decode(input, errors, True)\nUnicodeDecodeError: 'utf8' codec can't decode byte 0xd0 in position 254: unexpected end of data\n", 
            "date_created": "2014-11-14 16:54:07.260387+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhaoqin"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/134565\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=1a826012387838cbf741242047c8c622f635cb73\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1a826012387838cbf741242047c8c622f635cb73\nAuthor: Qin Zhao <email address hidden>\nDate:   Fri Nov 14 23:17:22 2014 +0800\n\n    Revert \"Truncate encoded instance message to 255\"\n    \n    This reverts commit bd9c32289ff8cf1bc67c1395ad921c703aa4c489.\n    \n    UTF-8 character bytes size varies from 1 to 6. If truncating a long\n    bytes string to 255, the last character may be cut in the middle,\n    so that UnicodeDecodeError will occur when converting it back to\n    unicode. Need to revert this code change and make a new patch.\n    \n    Related-Bug: 1389102\n    \n    Change-Id: Ie439cffe11d657e77397c9070a3923a61f68a678\n", 
            "date_created": "2014-11-21 18:12:02.620144+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/134597\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=4e95505843d05f20ab01716ceee74f6757b16dd9\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4e95505843d05f20ab01716ceee74f6757b16dd9\nAuthor: Qin Zhao <email address hidden>\nDate:   Sat Nov 15 00:38:14 2014 +0800\n\n    Truncate encoded instance message to 255 or fewer\n    \n    In nova/compute/utils.py function exception_to_dict truncates unicode\n    message to 255. However, in non-English locales, instance message may\n    be longer than 255 after encoding the unicode message to byte message.\n    Need to truncate the encoded byte message to 255 or fewer, in order to\n    ensure db insert operation succeed.\n    \n    Change-Id: I62fa2830b22e367eb9486d09d3c8818a18ebd20d\n    Closes-Bug: 1389102\n", 
            "date_created": "2014-11-21 18:12:31.440296+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/136544", 
            "date_created": "2014-11-22 01:27:03.119290+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/136544\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=1e4088f46a54662449d9594f0c0942f1e8edab8e\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit 1e4088f46a54662449d9594f0c0942f1e8edab8e\nAuthor: Qin Zhao <email address hidden>\nDate:   Sat Nov 15 00:38:14 2014 +0800\n\n    Truncate encoded instance message to 255 or fewer\n    \n    In nova/compute/utils.py function exception_to_dict truncates unicode\n    message to 255. However, in non-English locales, instance message may\n    be longer than 255 after encoding the unicode message to byte message.\n    Need to truncate the encoded byte message to 255 or fewer, in order to\n    ensure db insert operation succeed.\n    \n    Closes-Bug: 1389102\n    (cherry picked from commit 4e95505843d05f20ab01716ceee74f6757b16dd9)\n    \n    Conflicts:\n    \tnova/tests/unit/compute/test_compute_utils.py\n    \n    Change-Id: I62fa2830b22e367eb9486d09d3c8818a18ebd20d\n", 
            "date_created": "2015-01-22 12:39:30.949072+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/161549", 
            "date_created": "2015-03-05 02:36:47.930252+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/161549\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8ec6a73fef7d26301481935dcd5999c7cd419cba\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8ec6a73fef7d26301481935dcd5999c7cd419cba\nAuthor: Samuel Matzek <email address hidden>\nDate:   Wed Mar 4 20:17:08 2015 -0600\n\n    Truncate encoded instance sys meta to 255 or less\n    \n    In nova/utils.py function get_system_metadata_from_image converts\n    image metadata into instance system metadata.  Since Nova's DB\n    column is limited to 255 characters for system metadata, the image\n    properties are truncated to 255 characters.  However, the Glance\n    image may have non-English unicode property values that are longer\n    than 255 after being encoded to bytes.  We need to truncate the\n    encoded byte property value to 255 or fewer bytes in order to ensure\n    the DB insert operation succeeds.  The same encoding and truncation\n    issue was fixed for the instance fault table under change id\n    I62fa2830b22e367eb9486d09d3c8818a18ebd20d.  This fix refactors\n    that code fix into a utility method and uses it to fix both problems.\n    \n    Change-Id: Ie1051777dd09a2fb91afbadad3728956f83452cf\n    Closes-Bug: #1425657\n    Related-Bug: #1389102\n", 
            "date_created": "2015-03-12 02:15:14.776142+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}