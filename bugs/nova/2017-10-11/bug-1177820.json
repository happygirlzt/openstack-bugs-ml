{
    "status": "Invalid", 
    "last_updated": "2013-08-07 22:54:29.334998+00:00", 
    "description": "A customer reported this issue on stable/grizzly but it also exists in havana.  They tried to boot an instance into a flavor that was too small for the image and got this exception:\n\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\amqp.py\", line 430, in _process_data\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\dispatcher.py\", line 133, in dispatch\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 120, in wrapped\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\contextlib.py\", line 24, in __exit__\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 97, in wrapped\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 215, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     pass\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\contextlib.py\", line 24, in __exit__\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 201, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 266, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 243, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\contextlib.py\", line 24, in __exit__\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 230, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 1230, in run_instance\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     do_run_instance()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\lockutils.py\", line 242, in inner\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     retval = f(*args, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 1229, in do_run_instance\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     admin_password, is_first_time, node, instance)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 877, in _run_instance\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self._set_instance_error_state(context, instance['uuid'])\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\contextlib.py\", line 24, in __exit__\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 798, in _run_instance\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     image_meta = self._check_image_size(context, instance)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 1040, in _check_image_size\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     raise exception.ImageTooLarge()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp ImageTooLarge: Image is larger than instance type allows\n\nThe problem is in serviceability.  There is debug and info level messages in ComputeManager._check_image_size but if the customer does not have verbose or debug logging enabled (off by default in their nova.conf), then the size values don't show up in the logs and we have to get the customer to recreate.\n\nChanging this log level from info to error is a simple way to get the error details into the logs:\n\nhttps://github.com/openstack/nova/blob/stable/grizzly/nova/compute/manager.py#L1038", 
    "tags": [
        "low-hanging-fruit"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1177820", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1177820, 
    "index": 3640, 
    "created": "2013-05-08 14:26:41.367120+00:00", 
    "title": "ComputeManager._check_image_size should log error when ImageTooLarge", 
    "comments": [
        {
            "content": "A customer reported this issue on stable/grizzly but it also exists in havana.  They tried to boot an instance into a flavor that was too small for the image and got this exception:\n\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\amqp.py\", line 430, in _process_data\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\dispatcher.py\", line 133, in dispatch\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 120, in wrapped\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\contextlib.py\", line 24, in __exit__\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 97, in wrapped\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 215, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     pass\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\contextlib.py\", line 24, in __exit__\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 201, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 266, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 243, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\contextlib.py\", line 24, in __exit__\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 230, in decorated_function\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 1230, in run_instance\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     do_run_instance()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\lockutils.py\", line 242, in inner\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     retval = f(*args, **kwargs)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 1229, in do_run_instance\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     admin_password, is_first_time, node, instance)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 877, in _run_instance\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self._set_instance_error_state(context, instance['uuid'])\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\contextlib.py\", line 24, in __exit__\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 798, in _run_instance\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     image_meta = self._check_image_size(context, instance)\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 1040, in _check_image_size\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp     raise exception.ImageTooLarge()\n2013-05-08 01:30:44.210 9188 TRACE nova.openstack.common.rpc.amqp ImageTooLarge: Image is larger than instance type allows\n\nThe problem is in serviceability.  There is debug and info level messages in ComputeManager._check_image_size but if the customer does not have verbose or debug logging enabled (off by default in their nova.conf), then the size values don't show up in the logs and we have to get the customer to recreate.\n\nChanging this log level from info to error is a simple way to get the error details into the logs:\n\nhttps://github.com/openstack/nova/blob/stable/grizzly/nova/compute/manager.py#L1038", 
            "date_created": "2013-05-08 14:26:41.367120+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "We really need to document some guidelines on various log levels.\n\nMy gut feeling says that info() is fine here.  This is an \"expected\" type of failure.  It's something that the user can try to do that's not allowed, but is handled gracefully.  I think the more important question is whether or not it is easy to determine why the request was denied from the API.", 
            "date_created": "2013-05-08 15:22:52.833792+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "Russell,\n\nWould it at least be reasonable to change the ImageTooLarge exception to take variables so the exception message is more useful (detailed)?\n\nclass ImageTooLarge(NovaException):\n    message = _(\"Image size %(size_bytes)d exceeded instance_type \"\n                \"allowed size %(allowed_size_bytes)d\")\n\nThere are only two places in nova that use this exception and their usage of it is basically the same, so it seems reasonable to provide more details to that exception when it's raised given we have the info.", 
            "date_created": "2013-05-08 16:12:44.049118+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I don't think it adds anything, so I think it's fine as it is. Talking with Matt further, I think there's probably a byte count bug in the Hyper-V driver or something, causing this to happen when it shouldn't. However, when it happens \"for real\" I think the current exception is perfectly adequate.", 
            "date_created": "2013-05-08 16:33:07.092041+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "OK, thanks for the insight.  I'll work with the team that reported this and get a different bug opened for the backup/restore issue where the image size changes (goes from 20 GB to 20.000000477 GB).", 
            "date_created": "2013-05-08 16:37:56.427367+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ]
}