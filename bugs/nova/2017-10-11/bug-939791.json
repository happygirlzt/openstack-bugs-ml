{
    "status": "Invalid", 
    "last_updated": "2012-12-15 14:49:56.155474+00:00", 
    "description": "If you take a snapshot of an existing server, and it fails for some reason, the image will be put into a 'killed'  (error) state in glance, as it should be. However, when the nova api lists images, it does *not* list killed images.  \n\nThe result is the end user being very confused when their 'SAVING' image suddenly just goes away (from their point of view), instead of telling them there was an error.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/939791", 
    "owner": "None", 
    "id": 939791, 
    "index": 2768, 
    "created": "2012-02-23 20:26:43.485392+00:00", 
    "title": "Nova image list does not list killed images. ", 
    "comments": [
        {
            "content": "If you take a snapshot of an existing server, and it fails for some reason, the image will be put into a 'killed'  (error) state in glance, as it should be. However, when the nova api lists images, it does *not* list killed images.  \n\nThe result is the end user being very confused when their 'SAVING' image suddenly just goes away (from their point of view), instead of telling them there was an error.", 
            "date_created": "2012-02-23 20:26:43.485392+00:00", 
            "author": "https://api.launchpad.net/1.0/~mdragon"
        }, 
        {
            "content": "Description :\n\n Upload image of size 25MB to Glance.While adding image to Glance,error message indicates data provided is not complete as Ram and kernel details are not provided.\n              But in the list of images ,status of the above image will be 'SAVING' which should be 'ERROR' as the image is not uploaded properly.\n\nCommand to reproduce this bug :\n\nroot@OpenstackEssex10:~# glance -A 93aa6ecbcaaa4e178a927035160281bf add name=\"amitest-image\" is_public=true <    /root/openstackessex/ubuntuimg/ami-tty/image\n==================================================================================================================================================[100%] 13.6M/s, ETA  0h  0m  0s\nFailed to add image. Got error:\nData supplied was not valid.\nDetails: 400 Bad Request\n\nThe server could not comply with the request since it is either malformed or otherwise incorrect.\n\n Failed to activate image. Got error: Data supplied was not valid. Details: 400 Bad Request  The server could not comply with the request since it is either malformed or otherwise incorrect.   Failed to update image metadata. Got error: Data supplied was not valid. Details: Invalid disk format 'None' for image.\nNote: Your image metadata may still be in the registry, but the image's status will likely be 'killed'.\n\nStatus is retrieved as below :\n\nroot@OpenstackEssex10:~# nova image-list\n\n+-----------------------------------------------------------+--------------------------------------+-----------------------------+-------------------------+\n|       ID                                                  |   NAME                            | STATUS                  |SERVER               |\n+-----------------------------------------------------------+---------------------------------------+-----------------------------+-------------------------+\n| 63afbb9c-9625-425b-82c7-dcd90ba2fd46  | amitest-image                   | SAVING                  |                          |\n+-----------------------------------------------------------+---------------------------------------+-----------------------------+-------------------------+", 
            "date_created": "2012-04-11 14:04:32.624025+00:00", 
            "author": "https://api.launchpad.net/1.0/~sailaja-pashumarthy"
        }, 
        {
            "content": "To reproduce the above bug , I considered the following scenario :\n\n1. Upload an image of size 25 MB.\n\nroot@OpenstackEssex10:~# glance -A 93aa6ecbcaaa4e178a927035160281bf add name=\"amitest-image\" is_public=true < /root/openstackessex/ubuntuimg/ami-tty/image\n==================================================================================================================================================[100%] 13.6M/s, ETA 0h 0m 0s\n\n2.  The above command results in an error,\n\n  Failed to add image. Got error:\nData supplied was not valid.\nDetails: 400 Bad Request\n\nThe server could not comply with the request since it is either malformed or otherwise incorrect.\n\n Failed to activate image. Got error: Data supplied was not valid. Details: 400 Bad Request The server could not comply with the request since it is either malformed or otherwise incorrect. Failed to update image metadata. Got error: Data supplied was not valid. Details: Invalid disk format 'None' for image.\nNote: Your image metadata may still be in the registry, but the image's status will likely be 'killed'.\n\n\n3. The image is Killed in Glance but when I retrieve the list of images using 'nova image-list' the status of the image is SAVING.\n\n4. When glance fails to update the image metadata from SAVING to ACTIVE ,a Rollback is performed on the db transaction.\n     As a result the status of the image is SAVING.\n\n5.  Along with the Rollback or instead of Rollback ,is there any way to update the image metadata to KILLED using the \n     existing method _kill() in glance.", 
            "date_created": "2012-04-13 07:31:18.249017+00:00", 
            "author": "https://api.launchpad.net/1.0/~sailaja-pashumarthy"
        }, 
        {
            "content": "Only images in an active, queued, or saving state are supposed to show up in nova image-list. If you need to administer images, you should use glance directly.", 
            "date_created": "2012-04-13 16:04:06.964790+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "Sailaja:\n\nYou need to provide a disk and container format before or during image data upload. There aren't any database transactions happening that are rolled back, as the API is deciding to reject your request early. I also agree it is confusing, but the state map we use within nova to represent glance images is as follows:\n\n           'active': 'ACTIVE',\n            'queued': 'SAVING',\n            'saving': 'SAVING',\n            'deleted': 'DELETED',\n            'pending_delete': 'DELETED',\n            'killed': 'ERROR'\n\nI'm willing to bet your image is actually 'queued' in glance, but showing as 'SAVING' in nova. The image shouldn't be killed, you just need to perform a valid action on it. It didn't change the state of the image, so you should just be able to try again.", 
            "date_created": "2012-04-13 16:07:37.901425+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "\nBrian ,\n\n The following is the glance-registry's log ,which indicates a rollback on a sqlalchemy db call. \n\n   2012-04-12 17:01:39 2470    DEBUG [glance.registry.api.v1.images] Updating image 209dfbfc-c965-4a8f-bb9c-a9a9e02cd3c2 with metadata: {u'status': u'active', u'location': u'file:///opt/stack/glance/images/209dfbfc-c965-4a8f-bb9c-a9a9e02cd3c2'}\n2012-04-12 17:01:39 2470     INFO [sqlalchemy.engine.base.Engine.0x...cf10] BEGIN (implicit)\n2012-04-12 17:01:39 2470     INFO [sqlalchemy.engine.base.Engine.0x...cf10] SELECT images.created_at AS images_created_at, images.updated_at AS images_updated_at, images.deleted_at AS images_deleted_at, images.deleted AS images_deleted, images.id AS images_id, images.name AS images_name, images.disk_format AS images_disk_format, images.container_format AS images_container_format, images.size AS images_size, images.status AS images_status, images.is_public AS images_is_public, images.location AS images_location, images.checksum AS images_checksum, images.min_disk AS images_min_disk, images.min_ram AS images_min_ram, images.owner AS images_owner, images.protected AS images_protected, image_properties_1.created_at AS image_properties_1_created_at, image_properties_1.updated_at AS image_properties_1_updated_at, image_properties_1.deleted_at AS image_properties_1_deleted_at, image_properties_1.deleted AS image_properties_1_deleted, image_properties_1.id AS image_properties_1_id, image_properties_1.image_id AS image_properties_1_image_id, image_properties_1.name AS image_properties_1_name, image_properties_1.value AS image_properties_1_value, image_members_1.created_at AS image_members_1_created_at, image_members_1.updated_at AS image_members_1_updated_at, image_members_1.deleted_at AS image_members_1_deleted_at, image_members_1.deleted AS image_members_1_deleted, image_members_1.id AS image_members_1_id, image_members_1.image_id AS image_members_1_image_id, image_members_1.member AS image_members_1_member, image_members_1.can_share AS image_members_1_can_share\nFROM images LEFT OUTER JOIN image_properties AS image_properties_1 ON images.id = image_properties_1.image_id LEFT OUTER JOIN image_members AS image_members_1 ON images.id = image_members_1.image_id\nWHERE images.id = %s AND images.deleted = %s\n2012-04-12 17:01:39 2470     INFO [sqlalchemy.engine.base.Engine.0x...cf10] (u'209dfbfc-c965-4a8f-bb9c-a9a9e02cd3c2', 0)\n2012-04-12 17:01:39 2470    DEBUG [sqlalchemy.engine.base.Engine.0x...cf10] Col ('images_created_at', 'images_updated_at', 'images_deleted_at', 'images_deleted', 'images_id', 'images_name', 'images_disk_format', 'images_container_format', 'images_size', 'images_status', 'images_is_public', 'images_location', 'images_checksum', 'images_min_disk', 'images_min_ram', 'images_owner', 'images_protected', 'image_properties_1_created_at', 'image_properties_1_updated_at', 'image_properties_1_deleted_at', 'image_properties_1_deleted', 'image_properties_1_id', 'image_properties_1_image_id', 'image_properties_1_name', 'image_properties_1_value', 'image_members_1_created_at', 'image_members_1_updated_at', 'image_members_1_deleted_at', 'image_members_1_deleted', 'image_members_1_id', 'image_members_1_image_id', 'image_members_1_member', 'image_members_1_can_share')\n2012-04-12 17:01:39 2470    DEBUG [sqlalchemy.engine.base.Engine.0x...cf10] Row (datetime.datetime(2012, 4, 12, 11, 31, 39), datetime.datetime(2012, 4, 12, 11, 31, 39), None, 0, '209dfbfc-c965-4a8f-bb9c-a9a9e02cd3c2', 'amitest', None, None, 25165824L, 'saving', 1, None, '10047a119149e08fb206eea89832eee0', 0L, 0L, 'admin', 0, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None)\n2012-04-12 17:01:39 2470     INFO [sqlalchemy.engine.base.Engine.0x...cf10] ROLLBACK\n\n   This is performed when glance is trying to update the image metadata to ACTIVE but it fails , as a result the image metadata is set to SAVING state.\n\n    But when I execute the command ,as mentioned above to reproduce the bug,there is an error message which indicates the image status will likely be killed.If it is true,then the image status should be killed in glance db also which is not done as  of now.\n\n    If an image's status is never updated to killed , then when can we have the status of an image as killed.The above bug is to show the killed images in glance with nova image-list.If there should not be any killed images ,then is the above bug an invalid bug. ", 
            "date_created": "2012-04-16 06:10:09.435741+00:00", 
            "author": "https://api.launchpad.net/1.0/~sailaja-pashumarthy"
        }, 
        {
            "content": "Looks like you're not working on that anymore. Please set back to InProgress and reassign to you if you're working on proposing a change for merging.", 
            "date_created": "2012-12-13 14:36:53.072348+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Based on the comments it sounds like Brian indicated that the original report was not considered a bug.  If that is not the case, please feel free to reopen.", 
            "date_created": "2012-12-15 14:49:40.832024+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }
    ]
}