{
    "status": "Confirmed", 
    "last_updated": "2017-10-01 15:05:14.211790+00:00", 
    "description": "Hi, I foud an issue.\n  my deployment: Ocata release (depolyed by kolla-ansbile) + vmware vcenter 6.0\n  I have configured nova.conf to use vmware VCDirver. and the session is set up correctly.\n  I use \"openstack image create ...\" to import official ubuntu-16.04 image. (qemu-img convet it form qcow2 to spare vmdk format.\n  Everything is ok for now.\n  But when I luanch instance, error happend, the log is below:\n\n2017-04-01 04:15:45.496 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Attempting claim: memory 2048 MB, disk 20 GB, vcpus 1 CPU\n2017-04-01 04:15:45.497 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Total memory: 28640 MB, used: 512.00 MB\n2017-04-01 04:15:45.498 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] memory limit: 42960.00 MB, free: 42448.00 MB\n2017-04-01 04:15:45.499 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Total disk: 1921 GB, used: 0.00 GB\n2017-04-01 04:15:45.499 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] disk limit: 1921.00 GB, free: 1921.00 GB\n2017-04-01 04:15:45.500 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Total vcpu: 12 VCPU, used: 0.00 VCPU\n2017-04-01 04:15:45.501 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] vcpu limit not specified, defaulting to unlimited\n2017-04-01 04:15:45.501 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Claim successful\n2017-04-01 04:15:45.707 7 INFO nova.scheduler.client.report [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Submitted allocation for instance\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall [-] in fixed duration looping call\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall Traceback (most recent call last):\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/oslo_vmware/common/loopingcall.py\", line 76, in _inner\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall self.f(*self.args, **self.kw)\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/oslo_vmware/api.py\", line 440, in _poll_task\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall raise task_ex\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall VimFaultException: Invalid configuration for device '0'.\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall Faults: ['InvalidDeviceSpec']\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall\n2017-04-01 04:15:49.721 7 ERROR nova.compute.manager [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Instance failed to spawn", 
    "tags": [
        "oslo", 
        "vmware"
    ], 
    "importance": "High", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1678458", 
    "owner": "None", 
    "id": 1678458, 
    "index": 2059, 
    "created": "2017-04-01 10:33:51.528433+00:00", 
    "title": "VMware: Invalid configuration for device '0' on instance lauch", 
    "comments": [
        {
            "content": "Hi, I foud an issue.\n  my deployment: Ocata release (depolyed by kolla-ansbile) + vmware vcenter 6.0\n  I have configured nova.conf to use vmware VCDirver. and the session is set up correctly.\n  I use \"openstack image create ...\" to import official ubuntu-16.04 image. (qemu-img convet it form qcow2 to spare vmdk format.\n  Everything is ok for now.\n  But when I luanch instance, error happend, the log is below:\n\n2017-04-01 04:15:45.496 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Attempting claim: memory 2048 MB, disk 20 GB, vcpus 1 CPU\n2017-04-01 04:15:45.497 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Total memory: 28640 MB, used: 512.00 MB\n2017-04-01 04:15:45.498 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] memory limit: 42960.00 MB, free: 42448.00 MB\n2017-04-01 04:15:45.499 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Total disk: 1921 GB, used: 0.00 GB\n2017-04-01 04:15:45.499 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] disk limit: 1921.00 GB, free: 1921.00 GB\n2017-04-01 04:15:45.500 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Total vcpu: 12 VCPU, used: 0.00 VCPU\n2017-04-01 04:15:45.501 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] vcpu limit not specified, defaulting to unlimited\n2017-04-01 04:15:45.501 7 INFO nova.compute.claims [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Claim successful\n2017-04-01 04:15:45.707 7 INFO nova.scheduler.client.report [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Submitted allocation for instance\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall [-] in fixed duration looping call\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall Traceback (most recent call last):\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/oslo_vmware/common/loopingcall.py\", line 76, in _inner\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall self.f(*self.args, **self.kw)\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/oslo_vmware/api.py\", line 440, in _poll_task\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall raise task_ex\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall VimFaultException: Invalid configuration for device '0'.\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall Faults: ['InvalidDeviceSpec']\n2017-04-01 04:15:49.719 7 ERROR oslo_vmware.common.loopingcall\n2017-04-01 04:15:49.721 7 ERROR nova.compute.manager [req-0d04189c-f822-4ac3-be8b-44b88f255acd bef1f8c56ef547339595ce46bbe0ec0e cf73ccda5d894a60b8bcc93c2cc4f20a - - -] [instance: d4d11aa3-9eb7-496b-9ad6-17703d58dd88] Instance failed to spawn", 
            "date_created": "2017-04-01 10:33:51.528433+00:00", 
            "author": "https://api.launchpad.net/1.0/~weener"
        }, 
        {
            "content": "Hi, I have some updates. \nFrom my understanding,  VCDriver will download vmdk image from glance, then upload the image to vmware datastore via vcenter.  But I did not see the vmdk image in local nova cache, and remote datastore! \nWhy??  \n", 
            "date_created": "2017-04-05 07:11:07.620274+00:00", 
            "author": "https://api.launchpad.net/1.0/~weener"
        }, 
        {
            "content": "updates: \n   I use neutron networking, but I don't have vmware NSX.  Dose Neutron networking work without NSX?\n ", 
            "date_created": "2017-04-05 12:02:56.617572+00:00", 
            "author": "https://api.launchpad.net/1.0/~weener"
        }, 
        {
            "content": "And I found: vmops.build_virtual_machine() --> vm_util.create_vm() failed\nThe error is:  oslo_vmware.exceptions [-] Fault InvalidDeviceSpec not matched. \nSo I dump the config_spec:\n\n(VirtualMachineConfigSpec){\n   changeVersion = None\n   name = \"cffbe917-0fd9-4161-90eb-89bed0f12d90\"\n   version = None\n   uuid = None\n   instanceUuid = \"cffbe917-0fd9-4161-90eb-89bed0f12d90\"\n   npivNodeWorldWideName[] = <empty>\n   npivPortWorldWideName[] = <empty>\n   npivWorldWideNameType = None\n   npivDesiredNodeWwns = None\n   npivDesiredPortWwns = None\n   npivTemporaryDisabled = None\n   npivOnNonRdmDisks = None\n   npivWorldWideNameOp = None\n   locationId = None\n   guestId = \"ubuntu64Guest\"\n   alternateGuestName = None\n   annotation = \"name:v1\nuserid:bef1f8c56ef547339595ce46bbe0ec0e\nusername:admin\nprojectid:cf73ccda5d894a60b8bcc93c2cc4f20a\nprojectname:admin\nflavor:name:m1.small\nflavor:memory_mb:2048\nflavor:vcpus:1\nflavor:ephemeral_gb:0\nflavor:root_gb:20\nflavor:swap:0\nimageid:b503bba4-7028-4402-a1cd-a406be13464f\npackage:15.0.1\n\"\n   files =\n      (VirtualMachineFileInfo){\n         vmPathName = \"[datastore1]\"\n         snapshotDirectory = None\n         suspendDirectory = None\n         logDirectory = None\n         ftMetadataDirectory = None\n      }\n   tools =\n      (ToolsConfigInfo){\n         toolsVersion = None\n         afterPowerOn = True\n         afterResume = True\n         beforeGuestStandby = True\n         beforeGuestShutdown = True\n         beforeGuestReboot = True\n         toolsUpgradePolicy = None\n         pendingCustomization = None\n         syncTimeWithHost = None\n         lastInstallInfo =\n            (ToolsConfigInfoToolsLastInstallInfo){\n               counter = None\n               fault =\n                  (LocalizedMethodFault){\n                     fault =\n                        (MethodFault){\n                           faultCause =\n                              (LocalizedMethodFault){\n                                 localizedMessage = None\n                              }\n                           faultMessage[] = <empty>\n                        }\n                     localizedMessage = None\n                  }\n            }\n      }\n   flags =\n      (VirtualMachineFlagInfo){\n         disableAcceleration = None\n         enableLogging = None\n         useToe = None\n         runWithDebugInfo = None\n         monitorType = None\n         htSharing = None\n         snapshotDisabled = None\n         snapshotLocked = None\n         diskUuidEnabled = None\n         virtualMmuUsage = None\n         virtualExecUsage = None\n         snapshotPowerOffBehavior = None\n         recordReplayEnabled = None\n         faultToleranceType = None\n      }\n   consolePreferences =\n      (VirtualMachineConsolePreferences){\n         powerOnWhenOpened = None\n         enterFullScreenOnPowerOn = None\n         closeOnPowerOffOrSuspend = None\n      }\n   powerOpInfo =\n      (VirtualMachineDefaultPowerOpInfo){\n         powerOffType = None\n         suspendType = None\n         resetType = None\n         defaultPowerOffType = None\n         defaultSuspendType = None\n         defaultResetType = None\n         standbyAction = None\n      }\n   numCPUs = 1\n   numCoresPerSocket = 1\n   memoryMB = 2048\n   memoryHotAddEnabled = None\n   cpuHotAddEnabled = None\n   cpuHotRemoveEnabled = None\n   virtualICH7MPresent = None\n   virtualSMCPresent = None\n   deviceChange[] =\n      (VirtualDeviceConfigSpec){\n         operation = \"add\"\n         fileOperation =\n            (VirtualDeviceConfigSpecFileOperation){\n               value = None\n            }\n         device =\n            (VirtualE1000){\n               key = -47\n               deviceInfo =\n                  (Description){\n                     label = None\n                     summary = None\n                  }\n               backing =\n                  (VirtualEthernetCardOpaqueNetworkBackingInfo){\n                     opaqueNetworkId = \"br-int\"\n                     opaqueNetworkType = \"opaque\"\n                  }\n               connectable =\n                  (VirtualDeviceConnectInfo){\n                     startConnected = True\n                     allowGuestControl = True\n                     connected = True\n                     status = None\n                  }\n               slotInfo = None\n               controllerKey = None\n               unitNumber = None\n               addressType = \"manual\"\n               macAddress = \"fa:16:3e:67:7a:5e\"\n               wakeOnLanEnabled = True\n               resourceAllocation =\n                  (VirtualEthernetCardResourceAllocation){\n                     reservation = None\n                     share =\n                        (SharesInfo){\n                           shares = None\n                           level =\n                              (SharesLevel){\n                                 value = None\n                              }\n                        }\n                     limit = None\n                  }\n               externalId = None\n               uptCompatibilityEnabled = None\n            }\n         profile[] = <empty>\n      },\n   cpuAllocation =\n      (ResourceAllocationInfo){\n         reservation = None\n         expandableReservation = None\n         limit = None\n         shares =\n            (SharesInfo){\n               shares = None\n               level =\n                  (SharesLevel){\n                     value = None\n                  }\n            }\n         overheadLimit = None\n      }\n   memoryAllocation =\n      (ResourceAllocationInfo){\n         reservation = None\n         expandableReservation = None\n         limit = None\n         shares =\n            (SharesInfo){\n               shares = None\n               level =\n                  (SharesLevel){\n                     value = None\n                  }\n            }\n         overheadLimit = None\n      }\n   latencySensitivity =\n      (LatencySensitivity){\n         level =\n            (LatencySensitivitySensitivityLevel){\n               value = None\n            }\n         sensitivity = None\n      }\n   cpuAffinity =\n      (VirtualMachineAffinityInfo){\n         affinitySet[] = <empty>\n      }\n   memoryAffinity =\n      (VirtualMachineAffinityInfo){\n         enabled = None\n         peakBps = None\n         averageBps = None\n         burstSize = None\n      }\n   cpuFeatureMask[] = <empty>\n   extraConfig[] =\n      (OptionValue){\n         key = \"nvp.vm-uuid\"\n         value = \"cffbe917-0fd9-4161-90eb-89bed0f12d90\"\n      },\n      (OptionValue){\n         key = \"disk.EnableUUID\"\n         value = True\n      },\n      (OptionValue){\n         key = \"nvp.iface-id.0\"\n         value = \"36a2744c-449a-42b3-a77b-da8cb8c81bfb\"\n      },\n   swapPlacement = None\n   bootOptions =\n      (VirtualMachineBootOptions){\n         bootDelay = None\n         enterBIOSSetup = None\n         bootRetryEnabled = None\n         bootRetryDelay = None\n         bootOrder[] = <empty>\n         networkBootProtocol = None\n      }\n   vAppConfig =\n      (VmConfigSpec){\n         product[] = <empty>\n         property[] = <empty>\n         ipAssignment =\n            (VAppIPAssignmentInfo){\n               supportedAllocationScheme[] = <empty>\n               ipAllocationPolicy = None\n               supportedIpProtocol[] = <empty>\n               ipProtocol = None\n            }\n         eula[] = <empty>\n         ovfSection[] = <empty>\n         ovfEnvironmentTransport[] = <empty>\n         installBootRequired = None\n         installBootStopDelay = None\n      }\n   ftInfo =\n      (FaultToleranceConfigInfo){\n         role = None\n         instanceUuids[] = <empty>\n         configPaths[] = <empty>\n         orphaned = None\n      }\n   repConfig =\n      (ReplicationConfigSpec){\n         generation = None\n         vmReplicationId = None\n         destination = None\n         port = None\n         rpo = None\n         quiesceGuestEnabled = None\n         paused = None\n         oppUpdatesEnabled = None\n         netCompressionEnabled = None\n         disk[] = <empty>\n      }\n   vAppConfigRemoved = None\n   vAssertsEnabled = None\n   changeTrackingEnabled = None\n   firmware = None\n   maxMksConnections = None\n   guestAutoLockEnabled = None\n   managedBy =\n      (ManagedByInfo){\n         extensionKey = \"org.openstack.compute\"\n         type = \"instance\"\n      }\n   memoryReservationLockedToMax = None\n   nestedHVEnabled = None\n   vPMCEnabled = None\n   scheduledHardwareUpgradeInfo =\n      (ScheduledHardwareUpgradeInfo){\n         upgradePolicy = None\n         versionKey = None\n         scheduledHardwareUpgradeStatus = None\n         fault =\n            (LocalizedMethodFault){\n               fault =\n                  (MethodFault){\n                     faultCause =\n                        (LocalizedMethodFault){\n                           localizedMessage = None\n                        }\n                     faultMessage[] = <empty>\n                  }\n               localizedMessage = None\n            }\n      }\n   vmProfile[] = <empty>\n   messageBusTunnelEnabled = None\n }", 
            "date_created": "2017-04-05 12:11:06.945402+00:00", 
            "author": "https://api.launchpad.net/1.0/~weener"
        }, 
        {
            "content": "So anybody can tell me what's wrong with the config spec?  Thanks a lot. \n", 
            "date_created": "2017-04-05 12:12:31.523821+00:00", 
            "author": "https://api.launchpad.net/1.0/~weener"
        }, 
        {
            "content": "Hi,I meet the same error,did you solve it?\nThanks.", 
            "date_created": "2017-09-30 16:12:03.924850+00:00", 
            "author": "https://api.launchpad.net/1.0/~fsliangjm"
        }
    ]
}