{
    "status": "Fix Released", 
    "last_updated": "2011-02-07 13:57:29.565833+00:00", 
    "description": "Though describe_instances should work for all members of a project, it is now requiring the user be an admin:\n\n(nova.api 2011.1-workspace:tarmac-20110119093922-2u95mvtsbg5mr3dr): ERROR [O872KZVZRHCKDT63JYN3 laner tesla] Unexpected error raised: None\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py\", line 311, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/apirequest.py\", line 125, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 785, in run_instances\n(nova.api): TRACE:     instances[0]['reservation_id'])\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 648, in _format_run_instances\n(nova.api): TRACE:     i = self._format_instances(context, reservation_id=reservation_id)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 704, in _format_instances\n(nova.api): TRACE:     zone = self._get_availability_zone_by_host(context, host)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 136, in _get_availability_zone_by_host\n(nova.api): TRACE:     services = db.service_get_all_by_host(context, host)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 100, in service_get_all_by_host\n(nova.api): TRACE:     return IMPL.service_get_all_by_host(context, host)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 95, in wrapper\n(nova.api): TRACE:     raise exception.NotAuthorized()\n(nova.api): TRACE: NotAuthorized: None\n(nova.api): TRACE:\n\nThe following call requires the admin context: db.service_get_all_by_host(context, host)\n\n@require_admin_context\ndef service_get_all_by_host(context, host):\n    session = get_session()\n    return session.query(models.Service).\\\n                   filter_by(deleted=False).\\\n                   filter_by(host=host).\\\n                   all()", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/705195", 
    "owner": "https://api.launchpad.net/1.0/~rlane", 
    "id": 705195, 
    "index": 2246, 
    "created": "2011-01-20 00:35:19.516580+00:00", 
    "title": "describe instances requires admin context", 
    "comments": [
        {
            "content": "Though describe_instances should work for all members of a project, it is now requiring the user be an admin:\n\n(nova.api 2011.1-workspace:tarmac-20110119093922-2u95mvtsbg5mr3dr): ERROR [O872KZVZRHCKDT63JYN3 laner tesla] Unexpected error raised: None\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py\", line 311, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/apirequest.py\", line 125, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 785, in run_instances\n(nova.api): TRACE:     instances[0]['reservation_id'])\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 648, in _format_run_instances\n(nova.api): TRACE:     i = self._format_instances(context, reservation_id=reservation_id)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 704, in _format_instances\n(nova.api): TRACE:     zone = self._get_availability_zone_by_host(context, host)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 136, in _get_availability_zone_by_host\n(nova.api): TRACE:     services = db.service_get_all_by_host(context, host)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 100, in service_get_all_by_host\n(nova.api): TRACE:     return IMPL.service_get_all_by_host(context, host)\n(nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 95, in wrapper\n(nova.api): TRACE:     raise exception.NotAuthorized()\n(nova.api): TRACE: NotAuthorized: None\n(nova.api): TRACE:\n\nThe following call requires the admin context: db.service_get_all_by_host(context, host)\n\n@require_admin_context\ndef service_get_all_by_host(context, host):\n    session = get_session()\n    return session.query(models.Service).\\\n                   filter_by(deleted=False).\\\n                   filter_by(host=host).\\\n                   all()", 
            "date_created": "2011-01-20 00:35:19.516580+00:00", 
            "author": "https://api.launchpad.net/1.0/~rlane"
        }, 
        {
            "content": "good catch, We should probably pass in context.elevated() to that call.\n\nOn Jan 19, 2011, at 4:35 PM, Ryan Lane wrote:\n\n> Public bug reported:\n> \n> Though describe_instances should work for all members of a project, it\n> is now requiring the user be an admin:\n> \n> (nova.api 2011.1-workspace:tarmac-20110119093922-2u95mvtsbg5mr3dr): ERROR [O872KZVZRHCKDT63JYN3 laner tesla] Unexpected error raised: None\n> (nova.api): TRACE: Traceback (most recent call last):\n> (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py\", line 311, in __call__\n> (nova.api): TRACE:     result = api_request.invoke(context)\n> (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/apirequest.py\", line 125, in invoke\n> (nova.api): TRACE:     result = method(context, **args)\n> (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 785, in run_instances\n> (nova.api): TRACE:     instances[0]['reservation_id'])\n> (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 648, in _format_run_instances\n> (nova.api): TRACE:     i = self._format_instances(context, reservation_id=reservation_id)\n> (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 704, in _format_instances\n> (nova.api): TRACE:     zone = self._get_availability_zone_by_host(context, host)\n> (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 136, in _get_availability_zone_by_host\n> (nova.api): TRACE:     services = db.service_get_all_by_host(context, host)\n> (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 100, in service_get_all_by_host\n> (nova.api): TRACE:     return IMPL.service_get_all_by_host(context, host)\n> (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 95, in wrapper\n> (nova.api): TRACE:     raise exception.NotAuthorized()\n> (nova.api): TRACE: NotAuthorized: None\n> (nova.api): TRACE:\n> \n> The following call requires the admin context:\n> db.service_get_all_by_host(context, host)\n> \n> @require_admin_context\n> def service_get_all_by_host(context, host):\n>    session = get_session()\n>    return session.query(models.Service).\\\n>                   filter_by(deleted=False).\\\n>                   filter_by(host=host).\\\n>                   all()\n> \n> ** Affects: nova\n>     Importance: Undecided\n>         Status: New\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/705195\n> \n> Title:\n>  describe instances requires admin context\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  Though describe_instances should work for all members of a project, it\n>  is now requiring the user be an admin:\n> \n>  (nova.api 2011.1-workspace:tarmac-20110119093922-2u95mvtsbg5mr3dr): ERROR [O872KZVZRHCKDT63JYN3 laner tesla] Unexpected error raised: None\n>  (nova.api): TRACE: Traceback (most recent call last):\n>  (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py\", line 311, in __call__\n>  (nova.api): TRACE:     result = api_request.invoke(context)\n>  (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/apirequest.py\", line 125, in invoke\n>  (nova.api): TRACE:     result = method(context, **args)\n>  (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 785, in run_instances\n>  (nova.api): TRACE:     instances[0]['reservation_id'])\n>  (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 648, in _format_run_instances\n>  (nova.api): TRACE:     i = self._format_instances(context, reservation_id=reservation_id)\n>  (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 704, in _format_instances\n>  (nova.api): TRACE:     zone = self._get_availability_zone_by_host(context, host)\n>  (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/ec2/cloud.py\", line 136, in _get_availability_zone_by_host\n>  (nova.api): TRACE:     services = db.service_get_all_by_host(context, host)\n>  (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 100, in service_get_all_by_host\n>  (nova.api): TRACE:     return IMPL.service_get_all_by_host(context, host)\n>  (nova.api): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 95, in wrapper\n>  (nova.api): TRACE:     raise exception.NotAuthorized()\n>  (nova.api): TRACE: NotAuthorized: None\n>  (nova.api): TRACE:\n> \n>  The following call requires the admin context:\n>  db.service_get_all_by_host(context, host)\n> \n>  @require_admin_context\n>  def service_get_all_by_host(context, host):\n>      session = get_session()\n>      return session.query(models.Service).\\\n>                     filter_by(deleted=False).\\\n>                     filter_by(host=host).\\\n>                     all()\n> \n> \n\n", 
            "date_created": "2011-01-20 00:51:19+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ]
}