{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:23:35.323366+00:00", 
    "description": "If you try to rescue an image that has no kernel and ramdisk the following error shows up in compute log:\n\n2012-06-01 05:57:17 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 273, in _process_data\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/rpc/dispatcher.py\", line 103, in dispatch\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     temp_level, payload)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 176, in decorated_function\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     function(self, context, instance_uuid, *args, **kwargs)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 200, in decorated_function\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     sys.exc_info())\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 194, in decorated_function\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1189, in rescue_instance\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self._legacy_nw_info(network_info), image_meta)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     temp_level, payload)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 840, in rescue\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self._hard_reboot(instance, network_info, xml=xml)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 770, in _hard_reboot\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self._create_new_domain(xml)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1721, in _create_new_domain\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     domain.createWithFlags(launch_flags)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 581, in createWithFlags\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp libvirtError: unable to set user and group to '106:111' on '/home/vagrant/instance-0000000c/kernel.rescue': No such file or directory\n\nIt still adds a kernel and ramdisk to the xml even if they don't exist.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 22, 
    "link": "https://bugs.launchpad.net/nova/+bug/1007266", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 1007266, 
    "index": 2925, 
    "created": "2012-06-01 05:58:35.598837+00:00", 
    "title": "rescue broken in libvirt for images without kernel and ramdisk", 
    "comments": [
        {
            "content": "If you try to rescue an image that has no kernel and ramdisk the following error shows up in compute log:\n\n2012-06-01 05:57:17 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 273, in _process_data\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/rpc/dispatcher.py\", line 103, in dispatch\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     temp_level, payload)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 176, in decorated_function\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     function(self, context, instance_uuid, *args, **kwargs)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 200, in decorated_function\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     sys.exc_info())\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 194, in decorated_function\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1189, in rescue_instance\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self._legacy_nw_info(network_info), image_meta)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     temp_level, payload)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 840, in rescue\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self._hard_reboot(instance, network_info, xml=xml)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 770, in _hard_reboot\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     self._create_new_domain(xml)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1721, in _create_new_domain\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     domain.createWithFlags(launch_flags)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 581, in createWithFlags\n2012-06-01 05:57:17 TRACE nova.rpc.amqp     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2012-06-01 05:57:17 TRACE nova.rpc.amqp libvirtError: unable to set user and group to '106:111' on '/home/vagrant/instance-0000000c/kernel.rescue': No such file or directory\n\nIt still adds a kernel and ramdisk to the xml even if they don't exist.", 
            "date_created": "2012-06-01 05:58:35.598837+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/8022", 
            "date_created": "2012-06-01 06:27:31.489827+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/8022\nCommitted: http://github.com/openstack/nova/commit/783264be546088a5f37a9e9afdb00c07af6a1e20\nSubmitter: Jenkins\nBranch:    master\n\ncommit 783264be546088a5f37a9e9afdb00c07af6a1e20\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Fri Jun 1 06:24:49 2012 +0000\n\n    Fix libvirt rescue to work with whole disk images\n    \n     * fixes bug 1007266\n     * passes rescue image data to get_config so it only adds\n       the kernel and ramdisk if necessary\n     * adds tests to make sure that the kernel and ramdisk\n       only appear if they are needed\n    \n    Change-Id: I32e0369a066ce2b6189b4a015b30ffd8b6d3ec66\n", 
            "date_created": "2012-06-06 23:01:16.784702+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}