{
    "status": "Fix Released", 
    "last_updated": "2013-01-22 16:06:48.403912+00:00", 
    "description": "When launching an instance in a security group with a source group set (using euca-authorize -o) I am seeing the following error:\n\n2011-09-25 17:52:00,337 DEBUG nova.virt.libvirt.firewall [-] Adding security group rule: <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x3ec0990> from (pid=25335) instance_rules /usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py:650\n2011-09-25 17:52:00,344 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 98, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 216, in refresh_security_group_rules\n(nova.exception): TRACE:     return self.driver.refresh_security_group_rules(security_group_id)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 1504, in refresh_security_group_rules\n(nova.exception): TRACE:     self.firewall_driver.refresh_security_group_rules(security_group_id)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py\", line 726, in refresh_security_group_rules\n(nova.exception): TRACE:     self.do_refresh_security_group_rules(security_group)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 685, in inner\n(nova.exception): TRACE:     retval = f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py\", line 733, in do_refresh_security_group_rules\n(nova.exception): TRACE:     self.add_filters_for_instance(instance)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py\", line 582, in add_filters_for_instance\n(nova.exception): TRACE:     ipv4_rules, ipv6_rules = self.instance_rules(instance, network_info)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py\", line 702, in instance_rules\n(nova.exception): TRACE:     for instance in rule['grantee_group']['instances']:\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/models.py\", line 76, in __getitem__\n(nova.exception): TRACE:     return getattr(self, key)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 163, in __get__\n(nova.exception): TRACE:     instance_dict(instance))\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 383, in get\n(nova.exception): TRACE:     value = callable_(passive=passive)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 595, in __call__\n(nova.exception): TRACE:     (mapperutil.state_str(state), self.key)\n(nova.exception): TRACE: DetachedInstanceError: Parent instance <SecurityGroup at 0x3ec0810> is not bound to a Session; lazy load operation of attribute 'instances' cannot proceed\n(nova.exception): TRACE:\n2011-09-25 17:52:00,344 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 129, in wrapped\n(nova.rpc): TRACE:     raise Error(str(e))\n(nova.rpc): TRACE: Error: Parent instance <SecurityGroup at 0x3ec0810> is not bound to a Session; lazy load operation of attribute 'instances' cannot proceed\n(nova.rpc): TRACE:\n\nThis causes the rules to stop applying at this point, causing problems with security groups.", 
    "tags": [
        "verification-needed"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/859679", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 859679, 
    "index": 498, 
    "created": "2011-09-26 14:21:24.445776+00:00", 
    "title": "using source groups (-o) with security groups causes a lazy load exception", 
    "comments": [
        {
            "content": "When launching an instance in a security group with a source group set (using euca-authorize -o) I am seeing the following error:\n\n2011-09-25 17:52:00,337 DEBUG nova.virt.libvirt.firewall [-] Adding security group rule: <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x3ec0990> from (pid=25335) instance_rules /usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py:650\n2011-09-25 17:52:00,344 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 98, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 216, in refresh_security_group_rules\n(nova.exception): TRACE:     return self.driver.refresh_security_group_rules(security_group_id)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 1504, in refresh_security_group_rules\n(nova.exception): TRACE:     self.firewall_driver.refresh_security_group_rules(security_group_id)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py\", line 726, in refresh_security_group_rules\n(nova.exception): TRACE:     self.do_refresh_security_group_rules(security_group)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 685, in inner\n(nova.exception): TRACE:     retval = f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py\", line 733, in do_refresh_security_group_rules\n(nova.exception): TRACE:     self.add_filters_for_instance(instance)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py\", line 582, in add_filters_for_instance\n(nova.exception): TRACE:     ipv4_rules, ipv6_rules = self.instance_rules(instance, network_info)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/firewall.py\", line 702, in instance_rules\n(nova.exception): TRACE:     for instance in rule['grantee_group']['instances']:\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/models.py\", line 76, in __getitem__\n(nova.exception): TRACE:     return getattr(self, key)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 163, in __get__\n(nova.exception): TRACE:     instance_dict(instance))\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 383, in get\n(nova.exception): TRACE:     value = callable_(passive=passive)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 595, in __call__\n(nova.exception): TRACE:     (mapperutil.state_str(state), self.key)\n(nova.exception): TRACE: DetachedInstanceError: Parent instance <SecurityGroup at 0x3ec0810> is not bound to a Session; lazy load operation of attribute 'instances' cannot proceed\n(nova.exception): TRACE:\n2011-09-25 17:52:00,344 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 129, in wrapped\n(nova.rpc): TRACE:     raise Error(str(e))\n(nova.rpc): TRACE: Error: Parent instance <SecurityGroup at 0x3ec0810> is not bound to a Session; lazy load operation of attribute 'instances' cannot proceed\n(nova.rpc): TRACE:\n\nThis causes the rules to stop applying at this point, causing problems with security groups.", 
            "date_created": "2011-09-26 14:21:24.445776+00:00", 
            "author": "https://api.launchpad.net/1.0/~kbringard"
        }, 
        {
            "content": "Fix for this is waiting for review in gerrit:\n\n  https://review.openstack.org/#change,651", 
            "date_created": "2011-10-10 13:32:08.222235+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/651\nCommitted: http://github.com/openstack/nova/commit/114ca0b2dc090270d8d20bd10b6e1e7a0b451db2\nSubmitter: Jenkins\nBranch:    master\n\n status fixcommitted\n done\n\ncommit 114ca0b2dc090270d8d20bd10b6e1e7a0b451db2\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Mon Sep 26 08:34:14 2011 -0700\n\n    Fix the grantee group loading for source groups\n    \n    Fixes bug 859679.\n    \n    Change-Id: Ia0b90b8373a02955f23b6dda0495f01511762822\n", 
            "date_created": "2011-10-12 00:21:43+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/935\nCommitted: http://github.com/openstack/nova/commit/1f6b213d92e71de1eb669e9fb869d564066dadf5\nSubmitter: Jenkins\nBranch:    stable/diablo\n\n status fixcommitted\n done\n\ncommit 1f6b213d92e71de1eb669e9fb869d564066dadf5\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Mon Sep 26 08:34:14 2011 -0700\n\n    Fix the grantee group loading for source groups\n    \n    Fixes bug 859679.\n    \n    (cherry picked from commit 114ca0b2dc090270d8d20bd10b6e1e7a0b451db2)\n    \n    Change-Id: I92569ecc50fe3e9f17f633df03ee428587749a48\n", 
            "date_created": "2011-10-19 08:27:00+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "This bug was fixed in the package nova - 2012.1~e2-0ubuntu1\n\n---------------\nnova (2012.1~e2-0ubuntu1) precise; urgency=low\n\n  * New usptream release. Fixes the following bugs:\n    (LP: #871278, #848643, #859679, #83199)\n  * debian/nova-console.install: Fix empty package.\n  * debian/patches, debian/pydist-overrides: Cleaner way\n    of disabling unwanted python-dependencies.\n  * debian/control:\n    - Suggest python-keystone. (LP: #901881)\n    - Update build dependencies.\n  * debian/nova.conf: Use virtio networking by default.\n    (LP: #904480)\n  * debian/fix-traversal-via-image-register.patch: Dropped\n    fixed upstream.\n -- Chuck Short <email address hidden>   Fri, 16 Dec 2011 13:03:55 -0500", 
            "date_created": "2011-12-16 18:40:14.121714+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "Hello Kevin, or anyone else affected,\n\nAccepted nova into oneiric-proposed, the package will build now and be available in a few hours. Please test and give feedback here. See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed. Thank you in advance!", 
            "date_created": "2011-12-19 14:56:19.477918+00:00", 
            "author": "https://api.launchpad.net/1.0/~pitti"
        }
    ]
}