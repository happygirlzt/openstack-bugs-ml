{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:20:31.300939+00:00", 
    "description": "When metadata server (nova-api:8775 by default) gets a request without X-Instance-ID-Signature header, the server errors out with the following stacktrace:\n\n\n2015-01-08 18:10:51.955 INFO nova.metadata.wsgi.server [-] 127.0.0.1 \"GET / HTTP/1.1\" status: 200 len: 215 time: 0.0011151\n2015-01-08 18:10:55.354 ERROR nova.api.ec2 [-] FaultWrapper: object of type 'NoneType' has no len()\n2015-01-08 18:10:55.354 TRACE nova.api.ec2 Traceback (most recent call last):\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 90, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     return req.get_response(self.application)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/request.py\", line 1320, in send\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     application, catch_exc_info=False)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/request.py\", line 1284, in call_application\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     app_iter = application(self.environ, start_response)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/dec.py\", line 130, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     resp = self.call_func(req, *args, **self.kwargs)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/dec.py\", line 195, in call_func\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     return self.func(req, *args, **kwargs)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 102, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     rv = req.get_response(self.application)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/request.py\", line 1320, in send\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     application, catch_exc_info=False)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/request.py\", line 1284, in call_application\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     app_iter = application(self.environ, start_response)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/dec.py\", line 130, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     resp = self.call_func(req, *args, **self.kwargs)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/dec.py\", line 195, in call_func\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     return self.func(req, *args, **kwargs)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 110, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     meta_data = self._handle_instance_id_request(req)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 187, in _handle_instance_id_request\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     if not utils.constant_time_compare(expected_signature, signature):\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/utils.py\", line 1140, in constant_time_compare\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     if len(first) != len(second):\n2015-01-08 18:10:55.354 TRACE nova.api.ec2 TypeError: object of type 'NoneType' has no len()\n2015-01-08 18:10:55.354 TRACE nova.api.ec2 \n\n\nIt'd be safer to validate against non-existence.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1408625", 
    "owner": "https://api.launchpad.net/1.0/~tomoe", 
    "id": 1408625, 
    "index": 5370, 
    "created": "2015-01-08 11:48:56.455285+00:00", 
    "title": "metadata server errors out with a request missing X-Instance-ID-Signature header", 
    "comments": [
        {
            "content": "When metadata server (nova-api:8775 by default) gets a request without X-Instance-ID-Signature header, the server errors out with the following stacktrace:\n\n\n2015-01-08 18:10:51.955 INFO nova.metadata.wsgi.server [-] 127.0.0.1 \"GET / HTTP/1.1\" status: 200 len: 215 time: 0.0011151\n2015-01-08 18:10:55.354 ERROR nova.api.ec2 [-] FaultWrapper: object of type 'NoneType' has no len()\n2015-01-08 18:10:55.354 TRACE nova.api.ec2 Traceback (most recent call last):\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 90, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     return req.get_response(self.application)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/request.py\", line 1320, in send\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     application, catch_exc_info=False)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/request.py\", line 1284, in call_application\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     app_iter = application(self.environ, start_response)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/dec.py\", line 130, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     resp = self.call_func(req, *args, **self.kwargs)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/dec.py\", line 195, in call_func\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     return self.func(req, *args, **kwargs)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 102, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     rv = req.get_response(self.application)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/request.py\", line 1320, in send\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     application, catch_exc_info=False)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/request.py\", line 1284, in call_application\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     app_iter = application(self.environ, start_response)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/dec.py\", line 130, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     resp = self.call_func(req, *args, **self.kwargs)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"build/bdist.linux-x86_64/egg/webob/dec.py\", line 195, in call_func\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     return self.func(req, *args, **kwargs)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 110, in __call__\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     meta_data = self._handle_instance_id_request(req)\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 187, in _handle_instance_id_request\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     if not utils.constant_time_compare(expected_signature, signature):\n2015-01-08 18:10:55.354 TRACE nova.api.ec2   File \"/opt/stack/nova/nova/utils.py\", line 1140, in constant_time_compare\n2015-01-08 18:10:55.354 TRACE nova.api.ec2     if len(first) != len(second):\n2015-01-08 18:10:55.354 TRACE nova.api.ec2 TypeError: object of type 'NoneType' has no len()\n2015-01-08 18:10:55.354 TRACE nova.api.ec2 \n\n\nIt'd be safer to validate against non-existence.", 
            "date_created": "2015-01-08 11:48:56.455285+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomoe"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/145755", 
            "date_created": "2015-01-08 11:52:57.301066+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/145755\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=77d09813344651114ac5acd0c126b42f888b61fa\nSubmitter: Jenkins\nBranch:    master\n\ncommit 77d09813344651114ac5acd0c126b42f888b61fa\nAuthor: Tomoe Sugihara <email address hidden>\nDate:   Thu Jan 8 18:23:42 2015 +0900\n\n    Guard against missing X-Instance-ID-Signature header\n    \n    Metadata server errors out if the X-Instance-ID-Signature\n    header is missing in the request. This patch\n    validates the existance to return 400 error if missing.\n    \n    Closes-bug: #1408625\n    \n    Change-Id: Id6d32cc2d141a6248f6021831fd431ee143e3473\n", 
            "date_created": "2015-01-29 13:26:58.094909+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}