{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:34:14.084279+00:00", 
    "description": "Tested using nova revision No 925.\n\nSteps to reproduce:-\n1) Run one VM instance\n2) Confirm if state of the VM instance is Active\n{{{\nroot@ubuntu-openstack-network-api-server:/home/tpatil/nova# nova list\n+----+-----------+--------+-----------+---------------------------------------+\n| ID |    Name   | Status | Public IP |               Private IP              |\n+----+-----------+--------+-----------+---------------------------------------+\n| 58 | Server 58 | active |           | {u'version': 4, u'addr': u'10.0.0.5'} |\n+----+-----------+--------+-----------+---------------------------------------+\n}}}\n\n3) snapshot vm instance\n$nova image-create 58 \"Snapshot Testing\"\n{{{\nUnknown error occurred! {\"image\": {\"status\": \"queued\", \"name\": \"Snapshot Testing\", \"deleted\": false, \"container_format\": null, \"created_at\": \"2011-04-02T00:20:16.285868\", \"disk_format\": null, \"updated_at\": null, \"id\": 6, \"location\": null, \"checksum\": null, \"is_public\": false, \"deleted_at\": null, \"properties\": {\"instance_id\": \"58\", \"user_id\": \"admin\"}, \"size\": 0}} (HTTP 500)\n}}}\n\n4) nova-api.log\n{{{\n2011-04-01 17:19:21,665 DEBUG eventlet.wsgi.server [-] 10.2.3.150 - - [01/Apr/2011 17:19:21] \"GET /v1.1/ HTTP/1.1\" 204 276 0.007600\n from (pid=19241) write /home/tpatil/nova/nova/wsgi.py:56\n2011-04-01 17:19:21,723 DEBUG routes.middleware [-] No route matched for GET /servers/58 from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:97\n2011-04-01 17:19:21,724 DEBUG routes.middleware [-] Matched GET /servers/58 from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:100\n2011-04-01 17:19:21,724 DEBUG routes.middleware [-] Route path: '/servers/:(id)', defaults: {'action': u'show', 'controller': <nova.api.openstack.servers.ControllerV11 object at 0x21fffd0>} from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:102\n2011-04-01 17:19:21,724 DEBUG routes.middleware [-] Match dict: {'action': u'show', 'controller': <nova.api.openstack.servers.ControllerV11 object at 0x21fffd0>, 'id': u'58'} from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:103\n2011-04-01 17:19:21,854 DEBUG eventlet.wsgi.server [-] 10.2.3.150 - - [01/Apr/2011 17:19:21] \"GET /v1.1//servers/58?fresh=1301703561.67 HTTP/1.1\" 200 723 0.186549\n from (pid=19241) write /home/tpatil/nova/nova/wsgi.py:56\n2011-04-01 17:19:21,911 DEBUG routes.middleware [-] No route matched for POST /images from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:97\n2011-04-01 17:19:21,912 DEBUG routes.middleware [-] Matched POST /images from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:100\n2011-04-01 17:19:21,913 DEBUG routes.middleware [-] Route path: '/images', defaults: {'action': u'create', 'controller': <nova.api.openstack.images.ControllerV11 object at 0x220f910>} from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:102\n2011-04-01 17:19:21,913 DEBUG routes.middleware [-] Match dict: {'action': u'create', 'controller': <nova.api.openstack.images.ControllerV11 object at 0x220f910>} from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:103\n2011-04-01 17:19:21,914 DEBUG nova.image.glance [-] Creating image in Glance. Metadata passed in {'is_public': False, 'name': u'Snapshot Testing', 'properties': {'instance_id': '58', 'user_id': 'admin'}} from (pid=19241) create /home/tpatil/nova/nova/image/glance.py:135\n2011-04-01 17:19:21,914 DEBUG nova.image.glance [-] Metadata after formatting for Glance {'is_public': False, 'name': u'Snapshot Testing', 'properties': {'instance_id': '58', 'user_id': 'admin'}} from (pid=19241) create /home/tpatil/nova/nova/image/glance.py:138\n2011-04-01 17:19:22,016 ERROR nova.api.openstack [-] Caught error: Unknown error occurred! {\"image\": {\"status\": \"queued\", \"name\": \"Snapshot Testing\", \"deleted\": false, \"container_format\": null, \"created_at\": \"2011-04-02T00:20:16.285868\", \"disk_format\": null, \"updated_at\": null, \"id\": 6, \"location\": null, \"checksum\": null, \"is_public\": false, \"deleted_at\": null, \"properties\": {\"instance_id\": \"58\", \"user_id\": \"admin\"}, \"size\": 0}}\n(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/api/openstack/__init__.py\", line 58, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/wsgi.py\", line 354, in __call__\n(nova.api.openstack): TRACE:     result = method(**arg_dict)\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/api/openstack/images.py\", line 132, in create\n(nova.api.openstack): TRACE:     image = self._compute_service.snapshot(context, server_id, image_name)\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/compute/api.py\", line 473, in snapshot\n(nova.api.openstack): TRACE:     recv_meta = self.image_service.create(context, sent_meta)\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/image/glance.py\", line 141, in create\n(nova.api.openstack): TRACE:     sent_service_image_meta, data)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/glance/client.py\", line 259, in add_image\n(nova.api.openstack): TRACE:     res = self.do_request(\"POST\", \"/images\", body, headers)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/glance/client.py\", line 160, in do_request\n(nova.api.openstack): TRACE:     raise Exception(\"Unknown error occurred! %s\" % res.read())\n(nova.api.openstack): TRACE: Exception: Unknown error occurred! {\"image\": {\"status\": \"queued\", \"name\": \"Snapshot Testing\", \"deleted\": false, \"container_format\": null, \"created_at\": \"2011-04-02T00:20:16.285868\", \"disk_format\": null, \"updated_at\": null, \"id\": 6, \"location\": null, \"checksum\": null, \"is_public\": false, \"deleted_at\": null, \"properties\": {\"instance_id\": \"58\", \"user_id\": \"admin\"}, \"size\": 0}}\n(nova.api.openstack): TRACE:\n}}}", 
    "tags": [], 
    "importance": "High", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/750544", 
    "owner": "https://api.launchpad.net/1.0/~mihgen", 
    "id": 750544, 
    "index": 391, 
    "created": "2011-04-04 17:52:50.572222+00:00", 
    "title": "Snapshotting VM instance failing for KVM", 
    "comments": [
        {
            "content": "Tested using nova revision No 925.\n\nSteps to reproduce:-\n1) Run one VM instance\n2) Confirm if state of the VM instance is Active\n{{{\nroot@ubuntu-openstack-network-api-server:/home/tpatil/nova# nova list\n+----+-----------+--------+-----------+---------------------------------------+\n| ID |    Name   | Status | Public IP |               Private IP              |\n+----+-----------+--------+-----------+---------------------------------------+\n| 58 | Server 58 | active |           | {u'version': 4, u'addr': u'10.0.0.5'} |\n+----+-----------+--------+-----------+---------------------------------------+\n}}}\n\n3) snapshot vm instance\n$nova image-create 58 \"Snapshot Testing\"\n{{{\nUnknown error occurred! {\"image\": {\"status\": \"queued\", \"name\": \"Snapshot Testing\", \"deleted\": false, \"container_format\": null, \"created_at\": \"2011-04-02T00:20:16.285868\", \"disk_format\": null, \"updated_at\": null, \"id\": 6, \"location\": null, \"checksum\": null, \"is_public\": false, \"deleted_at\": null, \"properties\": {\"instance_id\": \"58\", \"user_id\": \"admin\"}, \"size\": 0}} (HTTP 500)\n}}}\n\n4) nova-api.log\n{{{\n2011-04-01 17:19:21,665 DEBUG eventlet.wsgi.server [-] 10.2.3.150 - - [01/Apr/2011 17:19:21] \"GET /v1.1/ HTTP/1.1\" 204 276 0.007600\n from (pid=19241) write /home/tpatil/nova/nova/wsgi.py:56\n2011-04-01 17:19:21,723 DEBUG routes.middleware [-] No route matched for GET /servers/58 from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:97\n2011-04-01 17:19:21,724 DEBUG routes.middleware [-] Matched GET /servers/58 from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:100\n2011-04-01 17:19:21,724 DEBUG routes.middleware [-] Route path: '/servers/:(id)', defaults: {'action': u'show', 'controller': <nova.api.openstack.servers.ControllerV11 object at 0x21fffd0>} from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:102\n2011-04-01 17:19:21,724 DEBUG routes.middleware [-] Match dict: {'action': u'show', 'controller': <nova.api.openstack.servers.ControllerV11 object at 0x21fffd0>, 'id': u'58'} from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:103\n2011-04-01 17:19:21,854 DEBUG eventlet.wsgi.server [-] 10.2.3.150 - - [01/Apr/2011 17:19:21] \"GET /v1.1//servers/58?fresh=1301703561.67 HTTP/1.1\" 200 723 0.186549\n from (pid=19241) write /home/tpatil/nova/nova/wsgi.py:56\n2011-04-01 17:19:21,911 DEBUG routes.middleware [-] No route matched for POST /images from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:97\n2011-04-01 17:19:21,912 DEBUG routes.middleware [-] Matched POST /images from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:100\n2011-04-01 17:19:21,913 DEBUG routes.middleware [-] Route path: '/images', defaults: {'action': u'create', 'controller': <nova.api.openstack.images.ControllerV11 object at 0x220f910>} from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:102\n2011-04-01 17:19:21,913 DEBUG routes.middleware [-] Match dict: {'action': u'create', 'controller': <nova.api.openstack.images.ControllerV11 object at 0x220f910>} from (pid=19241) __call__ /usr/lib/pymodules/python2.6/routes/middleware.py:103\n2011-04-01 17:19:21,914 DEBUG nova.image.glance [-] Creating image in Glance. Metadata passed in {'is_public': False, 'name': u'Snapshot Testing', 'properties': {'instance_id': '58', 'user_id': 'admin'}} from (pid=19241) create /home/tpatil/nova/nova/image/glance.py:135\n2011-04-01 17:19:21,914 DEBUG nova.image.glance [-] Metadata after formatting for Glance {'is_public': False, 'name': u'Snapshot Testing', 'properties': {'instance_id': '58', 'user_id': 'admin'}} from (pid=19241) create /home/tpatil/nova/nova/image/glance.py:138\n2011-04-01 17:19:22,016 ERROR nova.api.openstack [-] Caught error: Unknown error occurred! {\"image\": {\"status\": \"queued\", \"name\": \"Snapshot Testing\", \"deleted\": false, \"container_format\": null, \"created_at\": \"2011-04-02T00:20:16.285868\", \"disk_format\": null, \"updated_at\": null, \"id\": 6, \"location\": null, \"checksum\": null, \"is_public\": false, \"deleted_at\": null, \"properties\": {\"instance_id\": \"58\", \"user_id\": \"admin\"}, \"size\": 0}}\n(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/api/openstack/__init__.py\", line 58, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/wsgi.py\", line 354, in __call__\n(nova.api.openstack): TRACE:     result = method(**arg_dict)\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/api/openstack/images.py\", line 132, in create\n(nova.api.openstack): TRACE:     image = self._compute_service.snapshot(context, server_id, image_name)\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/compute/api.py\", line 473, in snapshot\n(nova.api.openstack): TRACE:     recv_meta = self.image_service.create(context, sent_meta)\n(nova.api.openstack): TRACE:   File \"/home/tpatil/nova/nova/image/glance.py\", line 141, in create\n(nova.api.openstack): TRACE:     sent_service_image_meta, data)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/glance/client.py\", line 259, in add_image\n(nova.api.openstack): TRACE:     res = self.do_request(\"POST\", \"/images\", body, headers)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/glance/client.py\", line 160, in do_request\n(nova.api.openstack): TRACE:     raise Exception(\"Unknown error occurred! %s\" % res.read())\n(nova.api.openstack): TRACE: Exception: Unknown error occurred! {\"image\": {\"status\": \"queued\", \"name\": \"Snapshot Testing\", \"deleted\": false, \"container_format\": null, \"created_at\": \"2011-04-02T00:20:16.285868\", \"disk_format\": null, \"updated_at\": null, \"id\": 6, \"location\": null, \"checksum\": null, \"is_public\": false, \"deleted_at\": null, \"properties\": {\"instance_id\": \"58\", \"user_id\": \"admin\"}, \"size\": 0}}\n(nova.api.openstack): TRACE:\n}}}", 
            "date_created": "2011-04-04 17:52:50.572222+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "What version of glance are you running? Although snapshotting doesn't work for me in nova trunk, this looks to be a glance issue?", 
            "date_created": "2011-04-04 19:59:06.080811+00:00", 
            "author": "https://api.launchpad.net/1.0/~blamar"
        }, 
        {
            "content": "I am using glance revision no 100.", 
            "date_created": "2011-04-04 20:08:37.842506+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "The original stack trace you posted seems to be from a revision before rev97 (looking at the line numbers in the trace), is this trace the same with rev 100 running? Not doubting you're running rev100, just trying to reproduce on my end :)", 
            "date_created": "2011-04-04 20:25:06.486487+00:00", 
            "author": "https://api.launchpad.net/1.0/~blamar"
        }, 
        {
            "content": "Yes, you are correct when I tested this for the first time, I was on glance revision no 96.\n\nNow using glance revision 100, while taking snapshot of vm instance still it is failing. But this time, I am getting errors in nova-compute.log\n\nnova-compute.log\n-------------------------\n2011-04-04 13:38:34,319 DEBUG nova.rpc [-] received {'_context_request_id': '71SDHCE6PD4MR32SESX3', '_context_read_deleted': False, 'args': {'instance_id': 65, 'image_id': 19}, '_context_is_admin': True, '_context_timestamp': '2011-04-04T20:38:05Z', '_context_user': 'admin', 'method': 'snapshot_instance', '_context_project': 'admin', '_context_remote_address': None} from (pid=22359) _receive /home/tpatil/nova/nova/rpc.py:167\n2011-04-04 13:38:34,320 DEBUG nova.rpc [-] unpacked context: {'timestamp': '2011-04-04T20:38:05Z', 'remote_address': None, 'project': 'admin', 'is_admin': True, 'user': 'admin', 'request_id': '71SDHCE6PD4MR32SESX3', 'read_deleted': False} from (pid=22359) _unpack_context /home/tpatil/nova/nova/rpc.py:331\n2011-04-04 13:38:34,568 AUDIT nova.compute.manager [71SDHCE6PD4MR32SESX3 admin admin] instance 65: snapshotting\n2011-04-04 13:38:34,582 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/home/tpatil/nova/nova/exception.py\", line 120, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/home/tpatil/nova/nova/virt/libvirt_conn.py\", line 423, in snapshot\n(nova.exception): TRACE:     metadata = {'disk_format': base['disk_format'],\n(nova.exception): TRACE: KeyError: 'disk_format'\n(nova.exception): TRACE:\n2011-04-04 13:38:34,583 ERROR nova [-] Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/home/tpatil/nova/nova/rpc.py\", line 188, in _receive\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/home/tpatil/nova/nova/exception.py\", line 120, in _wrap\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/home/tpatil/nova/nova/compute/manager.py\", line 342, in snapshot_instance\n(nova): TRACE:     self.driver.snapshot(instance_ref, image_id)\n(nova): TRACE:   File \"/home/tpatil/nova/nova/exception.py\", line 126, in _wrap\n(nova): TRACE:     raise Error(str(e))\n(nova): TRACE: Error: 'disk_format'\n(nova): TRACE:\n\nIn my case while registering the disk-image using glance-upload I didn't specified disk_format so it is None. will this cause this problem?\n\nI will register new images using nova-manage and try to reproduce this problem.", 
            "date_created": "2011-04-04 20:41:29.646762+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "I am using qemu-img version 0.13.91 and after looking at the comments in the code qemu-img should be 0.14+.\nI will install qemu-img 0.14+ and will try again.", 
            "date_created": "2011-04-04 21:10:29.363322+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "I think qemu-img is a further step, because the error message is complaining that key disk_format is not present in the image dictionary returned by Glance. So may be this issue lies in Glance.", 
            "date_created": "2011-04-05 00:03:47.890919+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "Could you potentially try out this branch and see if it works for you? https://code.launchpad.net/~rackspace-titan/nova/osapi-image-snapshot-response", 
            "date_created": "2011-04-05 13:43:11.754310+00:00", 
            "author": "https://api.launchpad.net/1.0/~blamar"
        }, 
        {
            "content": "Brian: I tried your branch and it seems like the error I was getting before is fixed. But still snapshot of VM instance is not working. I am getting another error in the nova-compute.log.\n\nnova-compute.log\n----------------------------\n2011-04-05 10:34:46,570 DEBUG nova.rpc [-] received {'_context_request_id': 'BJ8RO486PQEGIV8MF8PF', '_context_read_deleted': False, 'a                                  rgs': {'instance_id': 77, 'image_id': 32}, '_context_is_admin': True, '_context_timestamp': '2011-04-05T17:31:50Z', '_context_user': '                                  admin', 'method': 'snapshot_instance', '_context_project': 'admin', '_context_remote_address': None} from (pid=2189) _receive /home/tp                                  atil/nova/nova/rpc.py:167\n2011-04-05 10:34:46,571 DEBUG nova.rpc [-] unpacked context: {'timestamp': '2011-04-05T17:31:50Z', 'remote_address': None, 'project':                                   'admin', 'is_admin': True, 'user': 'admin', 'request_id': 'BJ8RO486PQEGIV8MF8PF', 'read_deleted': False} from (pid=2189) _unpack_conte                                  xt /home/tpatil/nova/nova/rpc.py:331\n2011-04-05 10:34:46,822 AUDIT nova.compute.manager [BJ8RO486PQEGIV8MF8PF admin admin] instance 77: snapshotting\n2011-04-05 10:37:01,130 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img convert -f qcow2 -O raw -s 67dfea6bc7314cad99a451dfb3b01981 /nova/instances/instance    -0000004d/disk /tmp/tmpVgnKrE/67dfea6bc7314cad99a451dfb3b01981 from (pid=2189) execute /home/tpatil/nova/nova/utils.py:150\n2011-04-05 10:37:01,278 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/home/tpatil/nova/nova/exception.py\", line 120, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/home/tpatil/nova/nova/virt/libvirt_conn.py\", line 463, in snapshot\n(nova.exception): TRACE:     utils.execute(qemu_img_cmd)\n(nova.exception): TRACE:   File \"/home/tpatil/nova/nova/utils.py\", line 158, in execute\n(nova.exception): TRACE:     env=env)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/green/subprocess.py\", line 25, in __init__\n(nova.exception): TRACE:     subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n(nova.exception): TRACE:   File \"/usr/lib/python2.6/subprocess.py\", line 623, in __init__\n(nova.exception): TRACE:     errread, errwrite)\n(nova.exception): TRACE:   File \"/usr/lib/python2.6/subprocess.py\", line 1141, in _execute_child\n(nova.exception): TRACE:     raise child_exception\n(nova.exception): TRACE: OSError: [Errno 2] No such file or directory\n(nova.exception): TRACE:\n2011-04-05 10:37:01,288 ERROR nova [-] Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/home/tpatil/nova/nova/rpc.py\", line 188, in _receive\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/home/tpatil/nova/nova/exception.py\", line 120, in _wrap\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/home/tpatil/nova/nova/compute/manager.py\", line 342, in snapshot_instance\n(nova): TRACE:     self.driver.snapshot(instance_ref, image_id)\n(nova): TRACE:   File \"/home/tpatil/nova/nova/exception.py\", line 126, in _wrap\n(nova): TRACE:     raise Error(str(e))\n(nova): TRACE: Error: [Errno 2] No such file or directory\n(nova): TRACE:\n\nI have also tried installing qemu-img 0.14.0 version on the compute servers, but still I am getting same error as shown above.\n\nAre you able to take snapshot of the vm instance successfully?", 
            "date_created": "2011-04-05 17:44:13.617393+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "Might be linked to bug 757613", 
            "date_created": "2011-04-11 14:55:44.405577+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "From dup bug:\n\nThe qemu_img call in the libvirt driver's snapshot method tries to call utils.execute(\"qemu-img convert blahblah...\") The argv needs to be split before passing it to utils.execute()\n\nFixing that particluar problem is easy, but I don't know if it does what it's supposed to. Clearly, noone has used/tested this for months.", 
            "date_created": "2011-04-11 14:57:49.811932+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "Fix is in lp:~mihgen/nova/split-args-qemu-img-call", 
            "date_created": "2011-04-12 20:40:30.549144+00:00", 
            "author": "https://api.launchpad.net/1.0/~mihgen"
        }, 
        {
            "content": "Just to clarify: \"Fix committed\" means a fix has been applied to trunk. Until the patch has been approved, we leave the bug as \"in progress\"", 
            "date_created": "2011-04-12 21:25:42.193627+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "image-create still doesn't work.\nThere is exception in nova-compute:\n2011-04-27 16:33:02,411 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 115, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt_conn.py\", line 459, in snapshot\n(nova.exception): TRACE:     'properties': {'architecture': base['architecture'],\n(nova.exception): TRACE: KeyError: 'architecture'(nova.exception): TRACE: 2011-04-27 16:33:02,411 ERROR nova [-] Exception during message handling(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/rpc.py\", line 198, in _receive(nova): TRACE:     rval = node_func(context=ctxt, **node_args)(nova): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 115, in _wrap\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 372, in snapshot_instance(nova): TRACE:     self.driver.snapshot(instance_ref, image_id)\n(nova): TRACE:   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 121, in _wrap\n(nova): TRACE:     raise Error(str(e))(nova): TRACE: Error: 'architecture'\n(nova): TRACE: \n\nTrivial fix will do the job - in libvirt_conn.py:\n\n=== modified file 'nova/virt/libvirt_conn.py'\n--- nova/virt/libvirt_conn.py\t2011-04-26 22:48:28 +0000\n+++ nova/virt/libvirt_conn.py\t2011-04-28 16:52:50 +0000\n@@ -456,7 +456,8 @@\n                     'container_format': base['container_format'],\n                     'is_public': False,\n                     'name': '%s.%s' % (base['name'], image_id),\n-                    'properties': {'architecture': base['architecture'],\n+                    'properties': {'architecture':\n+                                           base['properties']['architecture'],\n                                    'kernel_id': instance['kernel_id'],\n                                    'image_location': 'snapshot',\n                                    'image_state': 'available',\n", 
            "date_created": "2011-04-28 16:53:23.066304+00:00", 
            "author": "https://api.launchpad.net/1.0/~mihgen"
        }, 
        {
            "content": "@Mike:\r\nCould you open a separate bug ? This one was snapshot-specific and got fixed, yours is actually a new issue... Please also specify which version of nova you're reproducing the error on. Thanks !", 
            "date_created": "2011-05-02 12:54:07.222868+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Thierry,\nI opened separate bug as you proposed a while ago: https://bugs.launchpad.net/nova/+bug/780784,\nit's in review state.\nI guess I needed to mark it here somehow.", 
            "date_created": "2011-06-02 08:27:34.985094+00:00", 
            "author": "https://api.launchpad.net/1.0/~mihgen"
        }
    ]
}