{
    "status": "Expired", 
    "last_updated": "2015-11-02 04:17:21.767535+00:00", 
    "description": "[req-7a72cf1e-b163-4863-9330-f2b60bd15a6e None] [instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] Setting instance vm_state to ERROR\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] Traceback (most recent call last):\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6705, in _error_out_instance_on_exception\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     yield\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 3841, in resize_instance\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     instance.save(expected_task_state=task_states.RESIZE_MIGRATING)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/objects/base.py\", line 189, in wrapper\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     ctxt, self, fn.__name__, args, kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/conductor/rpcapi.py\", line 351, in object_action\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     objmethod=objmethod, args=args, kwargs=kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/oslo/messaging/rpc/client.py\", line 152, in call\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     retry=self.retry)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/oslo/messaging/transport.py\", line 90, in _send\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     timeout=timeout, retry=retry)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/amqpdriver.py\", line 408, in send\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     retry=retry)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/amqpdriver.py\", line 399, in _send\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     raise result\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] UnexpectedTaskStateError_Remote: Unexpected task state: expecting (u'resize_migrating',) but the actual state is None\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] Traceback (most recent call last):\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 400, in _object_dispatch\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     return getattr(target, method)(context, *args, **kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/objects/base.py\", line 204, in wrapper\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     return fn(self, ctxt, *args, **kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/objects/instance.py\", line 500, in save\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     columns_to_join=_expected_cols(expected_attrs))\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 766, in instance_update_and_get_original\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     columns_to_join=columns_to_join)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 143, in wrapper\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     return f(*args, **kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2318, in instance_update_and_get_original\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     columns_to_join=columns_to_join)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2369, in _instance_update\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     actual=actual_state, expected=expected)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] UnexpectedTaskStateError: Unexpected task state: expecting (u'resize_migrating',) but the actual state is None\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1490842", 
    "owner": "None", 
    "id": 1490842, 
    "index": 5736, 
    "created": "2015-09-01 06:27:44.418588+00:00", 
    "title": "UnexpectedTaskStateError_Remote: Unexpected task state: expecting (u'resize_migrating',) but the actual state is None", 
    "comments": [
        {
            "content": "[req-7a72cf1e-b163-4863-9330-f2b60bd15a6e None] [instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] Setting instance vm_state to ERROR\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] Traceback (most recent call last):\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6705, in _error_out_instance_on_exception\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     yield\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 3841, in resize_instance\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     instance.save(expected_task_state=task_states.RESIZE_MIGRATING)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/objects/base.py\", line 189, in wrapper\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     ctxt, self, fn.__name__, args, kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/conductor/rpcapi.py\", line 351, in object_action\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     objmethod=objmethod, args=args, kwargs=kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/oslo/messaging/rpc/client.py\", line 152, in call\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     retry=self.retry)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/oslo/messaging/transport.py\", line 90, in _send\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     timeout=timeout, retry=retry)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/amqpdriver.py\", line 408, in send\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     retry=retry)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/amqpdriver.py\", line 399, in _send\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     raise result\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] UnexpectedTaskStateError_Remote: Unexpected task state: expecting (u'resize_migrating',) but the actual state is None\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] Traceback (most recent call last):\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 400, in _object_dispatch\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     return getattr(target, method)(context, *args, **kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/objects/base.py\", line 204, in wrapper\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     return fn(self, ctxt, *args, **kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/objects/instance.py\", line 500, in save\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     columns_to_join=_expected_cols(expected_attrs))\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 766, in instance_update_and_get_original\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     columns_to_join=columns_to_join)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 143, in wrapper\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     return f(*args, **kwargs)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2318, in instance_update_and_get_original\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     columns_to_join=columns_to_join)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2369, in _instance_update\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]     actual=actual_state, expected=expected)\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] UnexpectedTaskStateError: Unexpected task state: expecting (u'resize_migrating',) but the actual state is None\n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb] \n[instance: 5dbb0778-e7d2-42bd-8427-b727301972cb]", 
            "date_created": "2015-09-01 06:27:44.418588+00:00", 
            "author": "https://api.launchpad.net/1.0/~280220427-t"
        }, 
        {
            "content": "Now this bug Can't find the reason. \n\nwhat is this UnexpectedTaskStateError?", 
            "date_created": "2015-09-01 06:34:12.823199+00:00", 
            "author": "https://api.launchpad.net/1.0/~280220427-t"
        }, 
        {
            "content": "hi wangjianhe\ncan you tell in what version you get this issue?", 
            "date_created": "2015-09-01 07:36:58.356910+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "now openstack version is juno.\n\nif it has UnexpectedTaskStateError ,vm can not be used, vm task is error.\ni try to add UnexpectedTaskStateError when it reverted and _error_out_instance_on_exception.", 
            "date_created": "2015-09-01 07:54:45.014677+00:00", 
            "author": "https://api.launchpad.net/1.0/~280220427-t"
        }, 
        {
            "content": "hi wangjianhe,\ncan you please provide full reproduce steps?\ncurrently nova is in L release develop cycle( code changed much from juno), it is not easy to debug issue only by exception trace.\n\nthanks in advance.\n", 
            "date_created": "2015-09-02 03:14:26.918759+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "step: vm resize add vcpus.\n\nthis Problems can not be reproduced When I test again, now i have only this log file.\n\ni think this problem is hit.", 
            "date_created": "2015-09-02 06:40:13.854124+00:00", 
            "author": "https://api.launchpad.net/1.0/~280220427-t"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2015-11-02 04:17:18.140507+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}