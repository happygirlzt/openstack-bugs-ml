{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:57:19.579895+00:00", 
    "description": "As a user I expect something that would produce a 404 to return a 404. Such as:\n\n$ nova net-delete some_garbage\n\nREQ: curl -i 'http://127.0.0.1:8774/v2/4eb9fda29831446cbfd22ab82a901284/os-tenant-networks/asdfasdfasdf' -X DELETE -H \"Accept: application/json\" -H \"User-Agent: python-novaclient\" -H \"X-Auth-Project-Id: demo\" -H \"X-Auth-Token: {SHA1}c7b9ac5b9d6c88abd70694db6cbb175c223f988a\"\nRESP: [500] CaseInsensitiveDict({'date': 'Thu, 17 Jul 2014 18:00:59 GMT', 'content-length': '128', 'content-type': 'application/json; charset=UTF-8', 'x-compute-request-id': 'req-9f02f305-c01d-462c-abd4-0f9a283d992f'})\nRESP BODY: {\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}\n\nDEBUG (shell:802) The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-9f02f305-c01d-462c-abd4-0f9a283d992f)\nTraceback (most recent call last):\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 799, in main\n    OpenStackComputeShell().main(argv)\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 729, in main\n    args.func(self.cs, args)\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/contrib/tenant_networks.py\", line 78, in do_net_delete\n    cs.tenant_networks.delete(args.network_id)\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/contrib/tenant_networks.py\", line 36, in delete\n    self._delete('/os-tenant-networks/%s' % base.getid(network))\n  File \"/opt/stack/python-novaclient/novaclient/base.py\", line 109, in _delete\n    _resp, _body = self.api.client.delete(url)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 491, in delete\n    return self._cs_request(url, 'DELETE', **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 459, in _cs_request\n    **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 441, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 435, in request\n    raise exceptions.from_response(resp, body, url, method)\nInternalServerError: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-9f02f305-c01d-462c-abd4-0f9a283d992f)\nERROR (InternalServerError): The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-9f02f305-c01d-462c-abd4-0f9a283d992f)\n\n\nWhen it is not implemented that makes sense. On my cloud installation I also receive this from neutron:\n\n2014-07-14 16:39:08.200 29740 INFO neutron.wsgi [-] 10.23.245.95,10.13.143.233 - - [14/Jul/2014 16:39:08] \"DELETE /v2.0/networks/jlh_delete_me.json HTTP/1.1\" \n404 176 0.010104\n\n\nI believe nova.api.openstack.FaultWrapper is messing up the return from Neutron and showing the user a 500 (the default response to exceptions) instead of the expected 404.", 
    "tags": [
        "api", 
        "network", 
        "neutron"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1343458", 
    "owner": "None", 
    "id": 1343458, 
    "index": 5008, 
    "created": "2014-07-17 18:07:23.892602+00:00", 
    "title": "Nova's fault wrap hiding real error status code from Neutron (and maybe others)", 
    "comments": [
        {
            "content": "As a user I expect something that would produce a 404 to return a 404. Such as:\n\n$ nova net-delete some_garbage\n\nREQ: curl -i 'http://127.0.0.1:8774/v2/4eb9fda29831446cbfd22ab82a901284/os-tenant-networks/asdfasdfasdf' -X DELETE -H \"Accept: application/json\" -H \"User-Agent: python-novaclient\" -H \"X-Auth-Project-Id: demo\" -H \"X-Auth-Token: {SHA1}c7b9ac5b9d6c88abd70694db6cbb175c223f988a\"\nRESP: [500] CaseInsensitiveDict({'date': 'Thu, 17 Jul 2014 18:00:59 GMT', 'content-length': '128', 'content-type': 'application/json; charset=UTF-8', 'x-compute-request-id': 'req-9f02f305-c01d-462c-abd4-0f9a283d992f'})\nRESP BODY: {\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}\n\nDEBUG (shell:802) The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-9f02f305-c01d-462c-abd4-0f9a283d992f)\nTraceback (most recent call last):\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 799, in main\n    OpenStackComputeShell().main(argv)\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 729, in main\n    args.func(self.cs, args)\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/contrib/tenant_networks.py\", line 78, in do_net_delete\n    cs.tenant_networks.delete(args.network_id)\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/contrib/tenant_networks.py\", line 36, in delete\n    self._delete('/os-tenant-networks/%s' % base.getid(network))\n  File \"/opt/stack/python-novaclient/novaclient/base.py\", line 109, in _delete\n    _resp, _body = self.api.client.delete(url)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 491, in delete\n    return self._cs_request(url, 'DELETE', **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 459, in _cs_request\n    **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 441, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 435, in request\n    raise exceptions.from_response(resp, body, url, method)\nInternalServerError: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-9f02f305-c01d-462c-abd4-0f9a283d992f)\nERROR (InternalServerError): The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-9f02f305-c01d-462c-abd4-0f9a283d992f)\n\n\nWhen it is not implemented that makes sense. On my cloud installation I also receive this from neutron:\n\n2014-07-14 16:39:08.200 29740 INFO neutron.wsgi [-] 10.23.245.95,10.13.143.233 - - [14/Jul/2014 16:39:08] \"DELETE /v2.0/networks/jlh_delete_me.json HTTP/1.1\" \n404 176 0.010104\n\n\nI believe nova.api.openstack.FaultWrapper is messing up the return from Neutron and showing the user a 500 (the default response to exceptions) instead of the expected 404.", 
            "date_created": "2014-07-17 18:07:23.892602+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-hammond"
        }, 
        {
            "content": "I tried this on my devstack environment, with neutron as my networking service, and got:\n\n$ nova net-delete <uuid>\nERROR (ClientException): The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-a7c2f648-9d1e-41cb-b55f-bb9fdea303a0)\n\nTrace:\n2014-08-12 10:43:27.597 21183 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/os_tenant_networks.py\", line 135, in delete\n2014-08-12 10:43:27.597 21183 TRACE nova.api.openstack     self.network_api.delete(context, id)\n2014-08-12 10:43:27.597 21183 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 872, in delete\n2014-08-12 10:43:27.597 21183 TRACE nova.api.openstack     raise NotImplementedError()\n2014-08-12 10:43:27.597 21183 TRACE nova.api.openstack NotImplementedError\n\nThe error (HTTP500) appears correct.  Looking at the code, nova/network/neutronv2/api.py, delete() is raising a NotImplementedError exception.  I am not sure why that part of the code is left unimplemented, but using the neutron CLI works fine.", 
            "date_created": "2014-08-12 14:47:35.895440+00:00", 
            "author": "https://api.launchpad.net/1.0/~thang-pham"
        }, 
        {
            "content": "While I'm not sure when it changed:\n\nnova net-delete some_garbage now seems to do the right thing on Juno.\n\nos1:~> nova net-delete some_garbage\nERROR (NotFound): Network not found (HTTP 404) (Request-ID: req-5b97d675-7d9c-48c7-9462-d6c06e28ab61)\n\n", 
            "date_created": "2014-09-12 13:30:07.833540+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}