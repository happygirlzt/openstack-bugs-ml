{
    "status": "Confirmed", 
    "last_updated": "2017-06-27 15:52:25.377652+00:00", 
    "description": "1.version: kilo&&liberty\n\n 2.Relevant log files:\n\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3895, in _finish_resize\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     block_device_info, power_on)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 6848, in finish_migration\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     fallback_from_host=migration.source_compute)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2861, in _create_image\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     instance, size, fallback_from_host)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 6282, in _try_fetch_image_cache\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     size=size)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 240, in cache\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     *args, **kwargs)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 783, in create_image\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     self.verify_base_size(base, size)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 290, in verify_base_size\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     flavor_size=base_size, image_size=size)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher FlavorDiskSmallerThanImage: Flavor's disk is too small for requested image. Flavor disk is 21474836480 bytes, image is 1073741824 bytes\n\n3.Reproduce steps:\n  3.1 resize a instance,Let us assume that it is testVM\n  3.2 rever the resize\n  3.3 cold migrate testVM\n\n\nExpected result: cold migrate sucess\nActual result: cold migrate failed", 
    "tags": [
        "ceph", 
        "openstack-version.kilo"
    ], 
    "importance": "Medium", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1549194", 
    "owner": "None", 
    "id": 1549194, 
    "index": 4451, 
    "created": "2016-02-24 09:31:35.770776+00:00", 
    "title": "resize a instance,then revert the resize,excute cold migrate,error using ceph", 
    "comments": [
        {
            "content": "1.version: kilo&&liberty\n\n 2.Relevant log files:\n\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3895, in _finish_resize\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     block_device_info, power_on)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 6848, in finish_migration\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     fallback_from_host=migration.source_compute)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2861, in _create_image\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     instance, size, fallback_from_host)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 6282, in _try_fetch_image_cache\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     size=size)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 240, in cache\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     *args, **kwargs)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 783, in create_image\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     self.verify_base_size(base, size)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 290, in verify_base_size\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher     flavor_size=base_size, image_size=size)\n2016-02-24 16:45:20.549 1660 ERROR oslo_messaging.rpc.dispatcher FlavorDiskSmallerThanImage: Flavor's disk is too small for requested image. Flavor disk is 21474836480 bytes, image is 1073741824 bytes\n\n3.Reproduce steps:\n  3.1 resize a instance,Let us assume that it is testVM\n  3.2 rever the resize\n  3.3 cold migrate testVM\n\n\nExpected result: cold migrate sucess\nActual result: cold migrate failed", 
            "date_created": "2016-02-24 09:31:35.770776+00:00", 
            "author": "https://api.launchpad.net/1.0/~2005hanbaoying"
        }, 
        {
            "content": "hi\n\n I don't get your issue, please see below steps, can you detail your environment and your steps?\n\nubuntu@lm-1:~/devstack$ nova list\n+--------------------------------------+-------+---------------+------------+-------------+---------------------------------------------------------+\n| ID                                   | Name  | Status        | Task State | Power State | Networks                                                |\n+--------------------------------------+-------+---------------+------------+-------------+---------------------------------------------------------+\n| 0cb800cb-6803-4403-976a-32c00f736cdc | test2 | VERIFY_RESIZE | -          | Running     | private=fd3f:22c2:65e6:0:f816:3eff:fef5:544a, 10.0.0.13 |\n+--------------------------------------+-------+---------------+------------+-------------+---------------------------------------------------------+\nubuntu@lm-1:~/devstack$ nova resize-revert test2\n\nubuntu@lm-1:~/devstack$ nova list\nvirsh li+--------------------------------------+-------+---------------+------------------+-------------+---------------------------------------------------------+\n| ID                                   | Name  | Status        | Task State       | Power State | Networks                                                |\n+--------------------------------------+-------+---------------+------------------+-------------+---------------------------------------------------------+\n| 0cb800cb-6803-4403-976a-32c00f736cdc | test2 | REVERT_RESIZE | resize_reverting | Running     | private=fd3f:22c2:65e6:0:f816:3eff:fef5:544a, 10.0.0.13 |\n+--------------------------------------+-------+---------------+------------------+-------------+---------------------------------------------------------+\n----------------------------------------------------\n\nubuntu@lm-1:~/devstack$ nova show test2\n+--------------------------------------+----------------------------------------------------------------------------------+\n| Property                             | Value                                                                            |\n+--------------------------------------+----------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                           |\n| OS-EXT-AZ:availability_zone          | az2                                                                              |\n| OS-EXT-SRV-ATTR:host                 | lm-2                                                                             |\n| OS-EXT-SRV-ATTR:hostname             | test2                                                                            |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | lm-2                                                                             |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000011                                                                |\n| OS-EXT-SRV-ATTR:kernel_id            | a80c2821-0ffc-42f6-941d-aae8b7011044                                             |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                                                |\n| OS-EXT-SRV-ATTR:ramdisk_id           | 43b713a9-26f5-4923-afce-92628dfd84da                                             |\n| OS-EXT-SRV-ATTR:reservation_id       | r-784fiwub                                                                       |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                                         |\n| OS-EXT-SRV-ATTR:user_data            | -                                                                                |\n| OS-EXT-STS:power_state               | 1                                                                                |\n| OS-EXT-STS:task_state                | resize_reverting                                                                 |\n| OS-EXT-STS:vm_state                  | resized                                                                          |\n| OS-SRV-USG:launched_at               | 2016-02-27T11:54:32.000000                                                       |\n| OS-SRV-USG:terminated_at             | -                                                                                |\n| accessIPv4                           |                                                                                  |\n| accessIPv6                           |                                                                                  |\n| config_drive                         | True                                                                             |\n| created                              | 2016-01-15T03:51:57Z                                                             |\n| flavor                               | m1.tiny (1)                                                                      |\n| hostId                               | e458622efc9604bb3e0e0f11b5f6f352a6ddedd115818982a5b546fd                         |\n| id                                   | 0cb800cb-6803-4403-976a-32c00f736cdc                                             |\n| image                                | cirros-0.3.4-x86_64-uec (2f53d11c-755e-49dc-92d0-6cd9b1957a39)                   |\n| key_name                             | -                                                                                |\n| locked                               | False                                                                            |\n| metadata                             | {}                                                                               |\n| name                                 | test2                                                                            |\n| os-extended-volumes:volumes_attached | [{\"id\": \"fd96953f-0f94-4b3e-98af-2bf062c6a6ad\", \"delete_on_termination\": false}] |\n| private network                      | fd3f:22c2:65e6:0:f816:3eff:fef5:544a, 10.0.0.13                                  |\n| security_groups                      | default                                                                          |\n| status                               | REVERT_RESIZE                                                                    |\n| tenant_id                            | 2deede298b744de2b88e6877e01857c8                                                 |\n| updated                              | 2016-02-27T11:54:32Z                                                             |\n| user_id                              | 26a3eea4810a4d8890c6d49e38bb6feb                                                 |\n+--------------------------------------+----------------------------------------------------------------------------------+\nubuntu@lm-1:~/devstack$ nova list\n+--------------------------------------+-------+--------+------------+-------------+---------------------------------------------------------+\n| ID                                   | Name  | Status | Task State | Power State | Networks                                                |\n+--------------------------------------+-------+--------+------------+-------------+---------------------------------------------------------+\n| 0cb800cb-6803-4403-976a-32c00f736cdc | test2 | ACTIVE | -          | Running     | private=fd3f:22c2:65e6:0:f816:3eff:fef5:544a, 10.0.0.13 |\n+--------------------------------------+-------+--------+------------+-------------+---------------------------------------------------------+\n\nubuntu@lm-1:~/devstack$ nova migrate test2 --poll\n\nServer migrating... 0% complete\n\nServer migrating... 100% complete\nFinished\nubuntu@lm-1:~/devstack$ nova show test2\n+--------------------------------------+----------------------------------------------------------------------------------+\n| Property                             | Value                                                                            |\n+--------------------------------------+----------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                           |\n| OS-EXT-AZ:availability_zone          | az1                                                                              |\n| OS-EXT-SRV-ATTR:host                 | lm-1                                                                             |\n| OS-EXT-SRV-ATTR:hostname             | test2                                                                            |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | lm-1                                                                             |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000011                                                                |\n| OS-EXT-SRV-ATTR:kernel_id            | a80c2821-0ffc-42f6-941d-aae8b7011044                                             |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                                                |\n| OS-EXT-SRV-ATTR:ramdisk_id           | 43b713a9-26f5-4923-afce-92628dfd84da                                             |\n| OS-EXT-SRV-ATTR:reservation_id       | r-784fiwub                                                                       |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                                         |\n| OS-EXT-SRV-ATTR:user_data            | -                                                                                |\n| OS-EXT-STS:power_state               | 1                                                                                |\n| OS-EXT-STS:task_state                | -                                                                                |\n| OS-EXT-STS:vm_state                  | resized                                                                          |\n| OS-SRV-USG:launched_at               | 2016-02-27T11:58:54.000000                                                       |\n| OS-SRV-USG:terminated_at             | -                                                                                |\n| accessIPv4                           |                                                                                  |\n| accessIPv6                           |                                                                                  |\n| config_drive                         | True                                                                             |\n| created                              | 2016-01-15T03:51:57Z                                                             |\n| flavor                               | m1.tiny (1)                                                                      |\n| hostId                               | f1ef2aed1879dc14d3b1b62eafffbb1c98b584aeed967abd1ae17f1f                         |\n| id                                   | 0cb800cb-6803-4403-976a-32c00f736cdc                                             |\n| image                                | cirros-0.3.4-x86_64-uec (2f53d11c-755e-49dc-92d0-6cd9b1957a39)                   |\n| key_name                             | -                                                                                |\n| locked                               | False                                                                            |\n| metadata                             | {}                                                                               |\n| name                                 | test2                                                                            |\n| os-extended-volumes:volumes_attached | [{\"id\": \"fd96953f-0f94-4b3e-98af-2bf062c6a6ad\", \"delete_on_termination\": false}] |\n| private network                      | fd3f:22c2:65e6:0:f816:3eff:fef5:544a, 10.0.0.13                                  |\n| progress                             | 0                                                                                |\n| security_groups                      | default                                                                          |\n| status                               | VERIFY_RESIZE                                                                    |\n| tenant_id                            | 2deede298b744de2b88e6877e01857c8                                                 |\n| updated                              | 2016-02-27T11:59:03Z                                                             |\n| user_id                              | 26a3eea4810a4d8890c6d49e38bb6feb                                                 |\n+--------------------------------------+----------------------------------------------------------------------------------+", 
            "date_created": "2016-02-27 12:03:33.497499+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "before cold migrate,you should resize the instance and then revert the resize\n\nbesides,the instance must be launched by image.  using ceph\n\n\nI have read the source ,find bug in here:\nafter resize, we will enlarge the size of image_cache\ncode path:D:\\nova\\nova\\virt\\libvirt\\imagebackend.py\n\n\ndef create_image(self, prepare_template, base, size, *args, **kwargs):\n\n        if not self.check_image_exists():\n            prepare_template(target=base, max_size=size, *args, **kwargs)\n\n        # prepare_template() may have cloned the image into a new rbd\n        # image already instead of downloading it locally\n        if not self.check_image_exists():\n            self.driver.import_image(base, self.rbd_name)\n        self.verify_base_size(base, size)\n\n        if size and size > self.get_disk_size(self.rbd_name):\n            self.driver.resize(self.rbd_name, size)\n\n\n\n\n\nrevert the resize ,the size of this image_cache did not become small\nbut the flavor become the smaller one\n\n means that:\n when cold migrate the instance, as we know running the same code as resize in openstack.\nwe will  found flavor size is smaller than image_cache\n\nverify_base_size throw exception\n\n", 
            "date_created": "2016-03-01 04:03:02.067680+00:00", 
            "author": "https://api.launchpad.net/1.0/~2005hanbaoying"
        }, 
        {
            "content": "It looks like you've reported this issue against kilo and liberty, which are both at end of life. Can this issue be reproduced in Mitaka or in the current master?", 
            "date_created": "2016-06-15 02:57:03.189174+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "Comment #2 gives the asked information. Liberty hasn't reached EOL yet. The report should be re-evaluated. \n", 
            "date_created": "2016-07-12 08:48:29.384870+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "I am calling this confirmed due to: 1599067", 
            "date_created": "2016-07-15 14:54:25.769023+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Automatically discovered version kilo in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 15:52:24.867864+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}