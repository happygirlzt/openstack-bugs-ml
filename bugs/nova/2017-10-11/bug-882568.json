{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 09:37:41.608492+00:00", 
    "description": "I'm using Diablo release and QuantumManager with quantum ovs plugin on Scientific Linux 6.1.\n\nIt seems that LibvirtOpenVswitchDriver can't create tuntap device correctly.\nIt may that ip command can't create tuntap.\n\n\nFollowing is log output of nova-compute.\n\n2011-10-27 21:15:28,359 DEBUG nova.utils [-] Running cmd (subprocess):\nsudo ip tuntap add tapaba5418e-3e mode tap from (pid=18385) execute\n/opt/stack/nova/nova/utils.py:165\n2011-10-27 21:15:28,381 DEBUG nova.utils [-] Result was 255 from\n(pid=18385) execute /opt/stack/nova/nova/utils.py:180\n2011-10-27 21:15:28,382 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/opt/stack/nova/nova/exception.py\",\nline 98, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File\n\"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 597, in spawn\n(nova.exception): TRACE:     block_device_info=block_device_info)\n(nova.exception): TRACE:   File\n\"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1164, in to_xml\n(nova.exception): TRACE:     block_device_info)\n(nova.exception): TRACE:   File\n\"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1062, in _prepare_xml_info\n(nova.exception): TRACE:     nics.append(self.vif_driver.plug(instance,\nnetwork, mapping))\n(nova.exception): TRACE:   File\n\"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 111, in plug\n(nova.exception): TRACE:     run_as_root=True)\n(nova.exception): TRACE:   File \"/opt/stack/nova/nova/utils.py\", line\n188, in execute\n(nova.exception): TRACE:     cmd=' '.join(cmd))\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while\nrunning command.\n(nova.exception): TRACE: Command: sudo ip tuntap add tapaba5418e-3e mode tap\n(nova.exception): TRACE: Exit code: 255\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: 'Object \"tuntap\" is unknown, try \"ip help\".\\n'\n(nova.exception): TRACE:\n2011-10-27 21:15:28,383 ERROR nova.compute.manager [-] Instance '18'\nfailed to spawn. Is virtualization enabled in the BIOS? Details: Unexp\nected error while running command.\nCommand: sudo ip tuntap add tapaba5418e-3e mode tap\nExit code: 255\nStdout: ''\nStderr: 'Object \"tuntap\" is unknown, try \"ip help\".\\n'\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File\n\"/opt/stack/nova/nova/compute/manager.py\", line 424, in _run_instance\n(nova.compute.manager): TRACE:     network_info, block_device_info)\n(nova.compute.manager): TRACE:   File\n\"/opt/stack/nova/nova/exception.py\", line 129, in wrapped\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: Unexpected error while running\ncommand.\n(nova.compute.manager): TRACE: Command: sudo ip tuntap add\ntapaba5418e-3e mode tap\n(nova.compute.manager): TRACE: Exit code: 255\n(nova.compute.manager): TRACE: Stdout: ''\n(nova.compute.manager): TRACE: Stderr: 'Object \"tuntap\" is unknown, try\n\"ip help\".\\n'\n(nova.compute.manager): TRACE:", 
    "tags": [
        "in-stable-diablo", 
        "libvirtopenvswitchdriver", 
        "rhel"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/882568", 
    "owner": "https://api.launchpad.net/1.0/~bgh", 
    "id": 882568, 
    "index": 2336, 
    "created": "2011-10-27 13:24:46.922542+00:00", 
    "title": "LibvirtOpenVswitchDriver failed to create tap device on Scientific linux 6.1", 
    "comments": [
        {
            "content": "I'm using Diablo release and QuantumManager with quantum ovs plugin on Scientific Linux 6.1.\n\nIt seems that LibvirtOpenVswitchDriver can't create tuntap device correctly.\nIt may that ip command can't create tuntap.\n\n\nFollowing is log output of nova-compute.\n\n2011-10-27 21:15:28,359 DEBUG nova.utils [-] Running cmd (subprocess):\nsudo ip tuntap add tapaba5418e-3e mode tap from (pid=18385) execute\n/opt/stack/nova/nova/utils.py:165\n2011-10-27 21:15:28,381 DEBUG nova.utils [-] Result was 255 from\n(pid=18385) execute /opt/stack/nova/nova/utils.py:180\n2011-10-27 21:15:28,382 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/opt/stack/nova/nova/exception.py\",\nline 98, in wrapped\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File\n\"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 597, in spawn\n(nova.exception): TRACE:     block_device_info=block_device_info)\n(nova.exception): TRACE:   File\n\"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1164, in to_xml\n(nova.exception): TRACE:     block_device_info)\n(nova.exception): TRACE:   File\n\"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1062, in _prepare_xml_info\n(nova.exception): TRACE:     nics.append(self.vif_driver.plug(instance,\nnetwork, mapping))\n(nova.exception): TRACE:   File\n\"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 111, in plug\n(nova.exception): TRACE:     run_as_root=True)\n(nova.exception): TRACE:   File \"/opt/stack/nova/nova/utils.py\", line\n188, in execute\n(nova.exception): TRACE:     cmd=' '.join(cmd))\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while\nrunning command.\n(nova.exception): TRACE: Command: sudo ip tuntap add tapaba5418e-3e mode tap\n(nova.exception): TRACE: Exit code: 255\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: 'Object \"tuntap\" is unknown, try \"ip help\".\\n'\n(nova.exception): TRACE:\n2011-10-27 21:15:28,383 ERROR nova.compute.manager [-] Instance '18'\nfailed to spawn. Is virtualization enabled in the BIOS? Details: Unexp\nected error while running command.\nCommand: sudo ip tuntap add tapaba5418e-3e mode tap\nExit code: 255\nStdout: ''\nStderr: 'Object \"tuntap\" is unknown, try \"ip help\".\\n'\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File\n\"/opt/stack/nova/nova/compute/manager.py\", line 424, in _run_instance\n(nova.compute.manager): TRACE:     network_info, block_device_info)\n(nova.compute.manager): TRACE:   File\n\"/opt/stack/nova/nova/exception.py\", line 129, in wrapped\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: Unexpected error while running\ncommand.\n(nova.compute.manager): TRACE: Command: sudo ip tuntap add\ntapaba5418e-3e mode tap\n(nova.compute.manager): TRACE: Exit code: 255\n(nova.compute.manager): TRACE: Stdout: ''\n(nova.compute.manager): TRACE: Stderr: 'Object \"tuntap\" is unknown, try\n\"ip help\".\\n'\n(nova.compute.manager): TRACE:", 
            "date_created": "2011-10-27 13:24:46.922542+00:00", 
            "author": "https://api.launchpad.net/1.0/~iida-koji"
        }, 
        {
            "content": "The issue is that scientific linux has an older \"ip\" command which doesn't support tuntap.  As a workaround it is possible to use tunctl to create the tap device.", 
            "date_created": "2011-10-28 18:16:50.376423+00:00", 
            "author": "https://api.launchpad.net/1.0/~bgh"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/1247\nCommitted: http://github.com/openstack/nova/commit/e4c74596bfaf1cee1a6f8cbb0d97aa067d9a4317\nSubmitter: Jenkins\nBranch:    master\n\n status fixcommitted\n done\n\ncommit e4c74596bfaf1cee1a6f8cbb0d97aa067d9a4317\nAuthor: Brad Hall <email address hidden>\nDate:   Thu Oct 27 17:45:23 2011 -0700\n\n    Fix for launchpad bug #882568\n    \n    Use tunctl to create the tap device if we are on a system where the ip command\n    is too old (and doesn't have support for tuntap).\n    \n    Change-Id: I9e22010e4c7dd2671267de6d0e7a7bc9ae76a854\n", 
            "date_created": "2011-11-08 14:25:38+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/1675\nCommitted: http://github.com/openstack/nova/commit/95b56105b2fc66de2c1cbaad773955a65ed30fa0\nSubmitter: Jenkins\nBranch:    stable/diablo\n\n tag in-stable-diablo\n done\n\ncommit 95b56105b2fc66de2c1cbaad773955a65ed30fa0\nAuthor: Brad Hall <email address hidden>\nDate:   Thu Oct 27 17:45:23 2011 -0700\n\n    Fix for launchpad bug #882568\n    \n    Use tunctl to create the tap device if we are on a system where the ip command\n    is too old (and doesn't have support for tuntap).\n    \n    (cherry picked from commit e4c74596bfaf1cee1a6f8cbb0d97aa067d9a4317)\n    \n    Change-Id: I9e22010e4c7dd2671267de6d0e7a7bc9ae76a854\n", 
            "date_created": "2011-11-17 16:38:56+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "modify /nova/virt/libvirt/vif.py\r\n\r\n    try:\r\n       utils.execute('ip', 'tuntap', 'add', dev, 'mode', 'tap',\r\n                      run_as_root=True)\r\n    except exception.ProcessExecutionError:               \r\n       utils.execute('tunctl', '-b', '-t', dev, run_as_root=True)\r\n    utils.execute('ip', 'link', 'set', dev, 'up', run_as_root=True)\r\n utils.execute('ovs-vsctl', '--', '--may-exist', 'add-port',\r\n                FLAGS.libvirt_ovs_bridge, dev,\r\n", 
            "date_created": "2011-11-26 06:21:22.150986+00:00", 
            "author": "https://api.launchpad.net/1.0/~amy-qi"
        }
    ]
}