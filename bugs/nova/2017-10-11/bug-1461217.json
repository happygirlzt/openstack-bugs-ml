{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:55:59.412739+00:00", 
    "description": "On a multinode setup, based on Ubuntu14.04, with nova version, below\n # dpkg -l | grep nova\nii  nova-common                         1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute - common files\nii  nova-compute                        1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute - compute node base\nii  nova-compute-kvm                    1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute - compute node libvirt support\nii  python-nova                         1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute Python libraries\nii  python-novaclient                   1:2.22.0-0ubuntu1~cloud0              all          client library for OpenStack Compute API\n,  did the following:\n1- Followed https://wiki.openstack.org/wiki/Docker procedure\n2- Added nova to libvirtd group, to avoid /var/run/libvirt/libvirt-sock access problem\n3- Updated nova-compute.conf to include compute_driver=novadocker.virt.docker.DockerDriver and virt_type=docker\n\nUpon starting a new docker instance, got the following error:\n2015-06-01 17:02:59.784 42703 ERROR nova.openstack.common.threadgroup [req-9f37298d-828c-4ac5-9834-320cc082f92b - - - - -] 'module' object has no attribute 'DOCKER'\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 145, in wait\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     x.wait()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 175, in wait\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 214, in main\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/service.py\", line 497, in run_service\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     service.start()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 183, in start\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1291, in pre_start_hook\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6240, in update_available_resource\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/resource_tracker.py\", line 376, in update_available_resource\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     resources = self.driver.get_available_resource(self.nodename)\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/home/ubuntu/dockerdrv/src/novadocker/novadocker/virt/docker/driver.py\", line 312, in get_available_resource\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     (arch.I686, hv_type.DOCKER, vm_mode.EXE),\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup AttributeError: 'module' object has no attribute 'DOCKER'\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup \n\nLooking at /usr/lib/python2.7/dist-packages/nova/compute/hv_type.py, noted that DOCKER definition is missing. Updated the file to include the following:\n...\nZVM = \"zvm\"\nDOCKER = \"docker\"\nALL = (\n    BAREMETAL,\n    BHYVE,\n....\n ZVM,\n    DOCKER\n)\n\nWith this update, I am able to instantiate rastasheep/ubuntu-sshd:14.04 image:\n# nova show f8bc5240-2f89-47b3-a266-b761a9624904\n+--------------------------------------+---------------------------------------------------------------------+\n| Property                             | Value                                                               |\n+--------------------------------------+---------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                              |\n| OS-EXT-AZ:availability_zone          | nova                                                                |\n| OS-EXT-SRV-ATTR:host                 | lab-cn01                                                            |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | lab-cn01                                                            |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000014                                                   |\n| OS-EXT-STS:power_state               | 1                                                                   |\n| OS-EXT-STS:task_state                | -                                                                   |\n| OS-EXT-STS:vm_state                  | active                                                              |\n| OS-SRV-USG:launched_at               | 2015-06-02T16:55:46.000000                                          |\n| OS-SRV-USG:terminated_at             | -                                                                   |\n| accessIPv4                           |                                                                     |\n| accessIPv6                           |                                                                     |\n| config_drive                         |                                                                     |\n| created                              | 2015-06-02T16:55:35Z                                                |\n| flavor                               | m1.small (2)                                                        |\n| hostId                               | bb610d5029734cde1e05f74b931b3cd78536efa0e9edbcbf5d88e0fe            |\n| id                                   | f8bc5240-2f89-47b3-a266-b761a9624904                                |\n| image                                | rastasheep/ubuntu-sshd:14.04 (fe827d9b-d921-42c4-a80b-d9d88ea2ac2a) |\n| key_name                             | lab-admin                                                           |\n| metadata                             | {}                                                                  |\n| name                                 | test                                                                |\n| os-extended-volumes:volumes_attached | []                                                                  |\n| priv1 network                        | 10.40.100.15, 10.4.100.3                                            |\n| progress                             | 0                                                                   |\n| security_groups                      | default                                                             |\n| status                               | ACTIVE                                                              |\n| tenant_id                            | 8f3633c4ba1640abbab3be608b6bcc88                                    |\n| updated                              | 2015-06-02T16:55:41Z                                                |\n| user_id                              | fcbce29fa1eb4b42921a20055afdc024                                    |\n+--------------------------------------+---------------------------------------------------------------------+\n\n# docker ps\nCONTAINER ID        IMAGE                          COMMAND               CREATED             STATUS              PORTS               NAMES\nb99cd8e72bd7        rastasheep/ubuntu-sshd:14.04   \"/usr/sbin/sshd -D\"   About an hour ago   Up About an hour                        nova-f8bc5240-2f89-47b3-a266-b761a9624904   \n\nCheers,", 
    "tags": [
        "docker", 
        "kilo"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1461217", 
    "owner": "https://api.launchpad.net/1.0/~dims-v", 
    "id": 1461217, 
    "index": 482, 
    "created": "2015-06-02 18:57:20.254738+00:00", 
    "title": "Kilo Docker:  Hypervisor Type Not Defined", 
    "comments": [
        {
            "content": "On a multinode setup, based on Ubuntu14.04, with nova version, below\n # dpkg -l | grep nova\nii  nova-common                         1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute - common files\nii  nova-compute                        1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute - compute node base\nii  nova-compute-kvm                    1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute - compute node libvirt support\nii  python-nova                         1:2015.1.0-0ubuntu1~cloud0            all          OpenStack Compute Python libraries\nii  python-novaclient                   1:2.22.0-0ubuntu1~cloud0              all          client library for OpenStack Compute API\n,  did the following:\n1- Followed https://wiki.openstack.org/wiki/Docker procedure\n2- Added nova to libvirtd group, to avoid /var/run/libvirt/libvirt-sock access problem\n3- Updated nova-compute.conf to include compute_driver=novadocker.virt.docker.DockerDriver and virt_type=docker\n\nUpon starting a new docker instance, got the following error:\n2015-06-01 17:02:59.784 42703 ERROR nova.openstack.common.threadgroup [req-9f37298d-828c-4ac5-9834-320cc082f92b - - - - -] 'module' object has no attribute 'DOCKER'\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 145, in wait\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     x.wait()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 175, in wait\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 294, in switch\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 214, in main\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/service.py\", line 497, in run_service\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     service.start()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 183, in start\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1291, in pre_start_hook\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6240, in update_available_resource\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/resource_tracker.py\", line 376, in update_available_resource\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     resources = self.driver.get_available_resource(self.nodename)\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup   File \"/home/ubuntu/dockerdrv/src/novadocker/novadocker/virt/docker/driver.py\", line 312, in get_available_resource\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup     (arch.I686, hv_type.DOCKER, vm_mode.EXE),\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup AttributeError: 'module' object has no attribute 'DOCKER'\n2015-06-01 17:02:59.784 42703 TRACE nova.openstack.common.threadgroup \n\nLooking at /usr/lib/python2.7/dist-packages/nova/compute/hv_type.py, noted that DOCKER definition is missing. Updated the file to include the following:\n...\nZVM = \"zvm\"\nDOCKER = \"docker\"\nALL = (\n    BAREMETAL,\n    BHYVE,\n....\n ZVM,\n    DOCKER\n)\n\nWith this update, I am able to instantiate rastasheep/ubuntu-sshd:14.04 image:\n# nova show f8bc5240-2f89-47b3-a266-b761a9624904\n+--------------------------------------+---------------------------------------------------------------------+\n| Property                             | Value                                                               |\n+--------------------------------------+---------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                              |\n| OS-EXT-AZ:availability_zone          | nova                                                                |\n| OS-EXT-SRV-ATTR:host                 | lab-cn01                                                            |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | lab-cn01                                                            |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000014                                                   |\n| OS-EXT-STS:power_state               | 1                                                                   |\n| OS-EXT-STS:task_state                | -                                                                   |\n| OS-EXT-STS:vm_state                  | active                                                              |\n| OS-SRV-USG:launched_at               | 2015-06-02T16:55:46.000000                                          |\n| OS-SRV-USG:terminated_at             | -                                                                   |\n| accessIPv4                           |                                                                     |\n| accessIPv6                           |                                                                     |\n| config_drive                         |                                                                     |\n| created                              | 2015-06-02T16:55:35Z                                                |\n| flavor                               | m1.small (2)                                                        |\n| hostId                               | bb610d5029734cde1e05f74b931b3cd78536efa0e9edbcbf5d88e0fe            |\n| id                                   | f8bc5240-2f89-47b3-a266-b761a9624904                                |\n| image                                | rastasheep/ubuntu-sshd:14.04 (fe827d9b-d921-42c4-a80b-d9d88ea2ac2a) |\n| key_name                             | lab-admin                                                           |\n| metadata                             | {}                                                                  |\n| name                                 | test                                                                |\n| os-extended-volumes:volumes_attached | []                                                                  |\n| priv1 network                        | 10.40.100.15, 10.4.100.3                                            |\n| progress                             | 0                                                                   |\n| security_groups                      | default                                                             |\n| status                               | ACTIVE                                                              |\n| tenant_id                            | 8f3633c4ba1640abbab3be608b6bcc88                                    |\n| updated                              | 2015-06-02T16:55:41Z                                                |\n| user_id                              | fcbce29fa1eb4b42921a20055afdc024                                    |\n+--------------------------------------+---------------------------------------------------------------------+\n\n# docker ps\nCONTAINER ID        IMAGE                          COMMAND               CREATED             STATUS              PORTS               NAMES\nb99cd8e72bd7        rastasheep/ubuntu-sshd:14.04   \"/usr/sbin/sshd -D\"   About an hour ago   Up About an hour                        nova-f8bc5240-2f89-47b3-a266-b761a9624904   \n\nCheers,", 
            "date_created": "2015-06-02 18:57:20.254738+00:00", 
            "author": "https://api.launchpad.net/1.0/~navesta"
        }, 
        {
            "content": "Fixing it in https://review.openstack.org/#/c/188339/", 
            "date_created": "2015-06-04 10:59:53.854635+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "https://review.openstack.org/#/c/188339/ has merged", 
            "date_created": "2015-07-05 00:29:50.610504+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }
    ]
}