{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:48:36.262614+00:00", 
    "description": "If starting nova-compute and quantum is down nova-compute fails with: \n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 155, in start\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 632, in init_host\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     self._init_instance(context, instance)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 519, in _init_instance\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     net_info = self._get_instance_nw_info(context, instance)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 725, in _get_instance_nw_info\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     instance, conductor_api=self.conductor_api)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 369, in get_instance_nw_info\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     result = self._get_instance_nw_info(context, instance, networks)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 377, in _get_instance_nw_info\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     nw_info = self._build_network_info_model(context, instance, networks)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 839, in _build_network_info_model\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     data = client.list_ports(**search_opts)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 108, in with_params\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     ret = self.function(instance, *args, **kwargs)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 262, in list_ports\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     **_params)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 1021, in list\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     for r in self._pagination(collection, path, **params):\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 1034, in _pagination\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     res = self.get(path, params=params)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 1007, in get\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     headers=headers, params=params)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 992, in retry_request\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     headers=headers, params=params)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 934, in do_request\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     self._handle_fault_response(status_code, replybody)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 908, in _handle_fault_response\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     exception_handler_v20(status_code, des_error_body)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 88, in exception_handler_v20\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     message=message)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup QuantumClientException: [Errno 111] ECONNREFUSED", 
    "tags": [
        "network"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1186357", 
    "owner": "https://api.launchpad.net/1.0/~arosen", 
    "id": 1186357, 
    "index": 3416, 
    "created": "2013-05-31 17:43:39.350721+00:00", 
    "title": "nova-compute fails to start if quantum is down", 
    "comments": [
        {
            "content": "If starting nova-compute and quantum is down nova-compute fails with: \n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 155, in start\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 632, in init_host\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     self._init_instance(context, instance)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 519, in _init_instance\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     net_info = self._get_instance_nw_info(context, instance)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 725, in _get_instance_nw_info\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     instance, conductor_api=self.conductor_api)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 369, in get_instance_nw_info\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     result = self._get_instance_nw_info(context, instance, networks)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 377, in _get_instance_nw_info\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     nw_info = self._build_network_info_model(context, instance, networks)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 839, in _build_network_info_model\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     data = client.list_ports(**search_opts)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 108, in with_params\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     ret = self.function(instance, *args, **kwargs)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 262, in list_ports\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     **_params)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 1021, in list\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     for r in self._pagination(collection, path, **params):\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 1034, in _pagination\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     res = self.get(path, params=params)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 1007, in get\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     headers=headers, params=params)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 992, in retry_request\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     headers=headers, params=params)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 934, in do_request\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     self._handle_fault_response(status_code, replybody)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 908, in _handle_fault_response\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     exception_handler_v20(status_code, des_error_body)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/python-quantumclient/quantumclient/v2_0/client.py\", line 88, in exception_handler_v20\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup     message=message)\n2013-05-31 10:37:21.015 TRACE nova.openstack.common.threadgroup QuantumClientException: [Errno 111] ECONNREFUSED", 
            "date_created": "2013-05-31 17:43:39.350721+00:00", 
            "author": "https://api.launchpad.net/1.0/~arosen"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/31250", 
            "date_created": "2013-05-31 18:09:49.849383+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/32777", 
            "date_created": "2013-06-12 19:55:02.566422+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/31250\nCommitted: http://github.com/openstack/nova/commit/6fda12bb14ab91592910f9ebbde9ef9f8d588b08\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6fda12bb14ab91592910f9ebbde9ef9f8d588b08\nAuthor: Aaron Rosen <email address hidden>\nDate:   Fri May 31 16:17:58 2013 -0700\n\n    Fix nova-compute fails to start if quantum is down\n    \n    When nova-compute starts it needs to check the state of instances that\n    were previously running and needs to query quantum. Previously, if\n    it queried quantum and quantum raised an error or was unreachable\n    nova-compute would terminate. This patch adds a retry loop to prevent\n    this from happening.\n    \n    Fixes bug 1186357\n    \n    Change-Id: I0d865e464f7bf60a0b6dc4ca8a42436d16e29790\n", 
            "date_created": "2013-06-12 21:09:59.172354+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/32777\nCommitted: http://github.com/openstack/nova/commit/60774bd58b7ab9e95e0ca71acb2f473dea9e1a67\nSubmitter: Jenkins\nBranch:    stable/grizzly\n\ncommit 60774bd58b7ab9e95e0ca71acb2f473dea9e1a67\nAuthor: Aaron Rosen <email address hidden>\nDate:   Fri May 31 16:17:58 2013 -0700\n\n    Fix nova-compute fails to start if quantum is down\n    \n    When nova-compute starts it needs to check the state of instances that\n    were previously running and needs to query quantum. Previously, if\n    it queried quantum and quantum raised an error or was unreachable\n    nova-compute would terminate. This patch adds a retry loop to prevent\n    this from happening.\n    \n    Fixes bug 1186357\n    \n    Change-Id: I0d865e464f7bf60a0b6dc4ca8a42436d16e29790\n    (cherry picked from commit 6fda12bb14ab91592910f9ebbde9ef9f8d588b08)\n", 
            "date_created": "2013-06-17 19:05:18.432891+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}