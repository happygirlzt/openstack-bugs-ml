{
    "status": "Fix Released", 
    "last_updated": "2013-05-16 17:39:41.085525+00:00", 
    "description": "nova usage-list  (os-simple-tenant-usage) does not return correct results.  the os-simple-tenant-usage extension only  gives correct results as called by horizon.\n\n\nThis bug exists in both Essex and Folsom\n\n\n\nFrom devstack:\n\n$ nova usage-list\nUsage from 2012-08-02 to 2012-08-31:\n+----------------------------------+-----------+--------------+-----------+---------------+\n| Tenant ID                        | Instances | RAM MB-Hours | CPU Hours | Disk GB-Hours |\n+----------------------------------+-----------+--------------+-----------+---------------+\n| 089a61fd160c474d979849905613428f | 1         | 12699.23     | 24.80     | 0.00          |\n+----------------------------------+-----------+--------------+-----------+---------------+\n\n$ nova show 328cb611-28c2-4993-b08b-da505e826700\n+-------------------------------------+----------------------------------------------------------------+\n| Property                            | Value                                                          |\n+-------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                   | MANUAL                                                         |\n| OS-EXT-SRV-ATTR:host                | precise                                                        |\n| OS-EXT-SRV-ATTR:hypervisor_hostname | precise.                                                       |\n| OS-EXT-SRV-ATTR:instance_name       | instance-00000001                                              |\n| OS-EXT-STS:power_state              | 1                                                              |\n| OS-EXT-STS:task_state               | None                                                           |\n| OS-EXT-STS:vm_state                 | active                                                         |\n| accessIPv4                          |                                                                |\n| accessIPv6                          |                                                                |\n| config_drive                        |                                                                |\n| created                             | 2012-08-30T17:48:28Z                                           |\n| flavor                              | m1.tiny (1)                                                    |\n| hostId                              | 34d14cb95a830630d9e83b7362ef2505e81f6cb9c4a128f8eaf69f98       |\n| id                                  | 328cb611-28c2-4993-b08b-da505e826700                           |\n| image                               | cirros-0.3.0-x86_64-uec (c3f27bf5-1201-4431-be06-e4006c2ba2eb) |\n| key_name                            | None                                                           |\n| metadata                            | {}                                                             |\n| name                                | Server 328cb611-28c2-4993-b08b-da505e826700                    |\n| private network                     | 10.0.0.2                                                       |\n| progress                            | 0                                                              |\n| security_groups                     | [{u'name': u'default'}]                                        |\n| status                              | ACTIVE                                                         |\n| tenant_id                           | 089a61fd160c474d979849905613428f                               |\n| updated                             | 2012-08-30T17:48:38Z                                           |\n| user_id                             | a2cd4f25d69d4910a910d80faf541d4a                               |\n+-------------------------------------+----------------------------------------------------------------+\n\n$ nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1  | m1.tiny   | 512       | 0    | 0         |      | 1     | 1.0         | True      |\n| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+", 
    "tags": [
        "verification-done"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1043999", 
    "owner": "https://api.launchpad.net/1.0/~zrzhit", 
    "id": 1043999, 
    "index": 782, 
    "created": "2012-08-30 18:40:04.292496+00:00", 
    "title": "nova usage-list returns  wrong usage", 
    "comments": [
        {
            "content": "nova usage-list  (os-simple-tenant-usage) does not return correct results.  the os-simple-tenant-usage extension only  gives correct results as called by horizon.\n\n\n\n\n$ nova usage-list\nUsage from 2012-08-02 to 2012-08-31:\n+----------------------------------+-----------+--------------+-----------+---------------+\n| Tenant ID                        | Instances | RAM MB-Hours | CPU Hours | Disk GB-Hours |\n+----------------------------------+-----------+--------------+-----------+---------------+\n| 089a61fd160c474d979849905613428f | 1         | 12699.23     | 24.80     | 0.00          |\n+----------------------------------+-----------+--------------+-----------+---------------+\n\n\n$ nova show 328cb611-28c2-4993-b08b-da505e826700\n+-------------------------------------+----------------------------------------------------------------+\n| Property                            | Value                                                          |\n+-------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                   | MANUAL                                                         |\n| OS-EXT-SRV-ATTR:host                | precise                                                        |\n| OS-EXT-SRV-ATTR:hypervisor_hostname | precise.                                                       |\n| OS-EXT-SRV-ATTR:instance_name       | instance-00000001                                              |\n| OS-EXT-STS:power_state              | 1                                                              |\n| OS-EXT-STS:task_state               | None                                                           |\n| OS-EXT-STS:vm_state                 | active                                                         |\n| accessIPv4                          |                                                                |\n| accessIPv6                          |                                                                |\n| config_drive                        |                                                                |\n| created                             | 2012-08-30T17:48:28Z                                           |\n| flavor                              | m1.tiny (1)                                                    |\n| hostId                              | 34d14cb95a830630d9e83b7362ef2505e81f6cb9c4a128f8eaf69f98       |\n| id                                  | 328cb611-28c2-4993-b08b-da505e826700                           |\n| image                               | cirros-0.3.0-x86_64-uec (c3f27bf5-1201-4431-be06-e4006c2ba2eb) |\n| key_name                            | None                                                           |\n| metadata                            | {}                                                             |\n| name                                | Server 328cb611-28c2-4993-b08b-da505e826700                    |\n| private network                     | 10.0.0.2                                                       |\n| progress                            | 0                                                              |\n| security_groups                     | [{u'name': u'default'}]                                        |\n| status                              | ACTIVE                                                         |\n| tenant_id                           | 089a61fd160c474d979849905613428f                               |\n| updated                             | 2012-08-30T17:48:38Z                                           |\n| user_id                             | a2cd4f25d69d4910a910d80faf541d4a                               |\n+-------------------------------------+----------------------------------------------------------------+\n\n\n$ nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1  | m1.tiny   | 512       | 0    | 0         |      | 1     | 1.0         | True      |\n| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+", 
            "date_created": "2012-08-30 18:40:04.292496+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Confirmed.  I started a tiny instance on devstack and the values don't seem to make sense.  This instance had been up for less than 5 minutes.\n\n[rbryant@f17-devstack devstack]$ nova usage-list\nUsage from 2012-08-02 to 2012-08-31:\n+----------------------------------+-----------+--------------+-----------+---------------+\n| Tenant ID                        | Instances | RAM MB-Hours | CPU Hours | Disk GB-Hours |\n+----------------------------------+-----------+--------------+-----------+---------------+\n| 2d1ddbdc656b4106aa52d9916671f472 | 1         | 10254.78     | 20.03     | 0.00          |\n+----------------------------------+-----------+--------------+-----------+---------------+\n", 
            "date_created": "2012-08-30 20:41:58.674371+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "Russell,  Do you think this should be targeted for folsom-rc1?   Without a fix we ship a unusable command", 
            "date_created": "2012-08-30 21:23:14.434691+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/12304", 
            "date_created": "2012-09-03 06:08:52.474683+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Russell's result of 20 hours for  a new instance shows another bug ...\n\nIt should actually be 24 hours because of the problem fixed in https://review.openstack.org/12304 but because novaclient is sending the start/end in localtime and Russell is utc-4, we get 20 hours\n\nI've filed bug #1045445 about that problem", 
            "date_created": "2012-09-03 18:54:53.304044+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/12304\nCommitted: http://github.com/openstack/nova/commit/869443f41c8826c9a4de1dcc65c5a5354b623a04\nSubmitter: Jenkins\nBranch:    master\n\ncommit 869443f41c8826c9a4de1dcc65c5a5354b623a04\nAuthor: RongzeZhu <email address hidden>\nDate:   Sun Sep 2 18:43:56 2012 +0800\n\n    Fix simple_tenant_usage's handing of future end times\n    \n    Fixes bug #1043999\n    \n    simple_tenant_usage returns the usage in the range between the supplied\n    start and end query parameters. The _hours_for() method calculates the\n    number of hours the instance was running in this range, even if the end time\n    is in the future.\n    \n    By default, python-novaclient requests usage between 4 weeks ago and tomorrow.\n    This means we a report which accounts for 24 hours of extra running time for\n    each currently running instance. Fix this by clamping the period of the\n    returned report at the current time.\n    \n    Change-Id: I61c211fd85b729aaeaac6ef24644ee19eb5bb6b0\n", 
            "date_created": "2012-09-05 22:09:28.304873+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Mark,  I cannot find  bug #1045445.", 
            "date_created": "2012-09-05 23:55:12.884520+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Fix proposed to branch: stable/essex\nReview: https://review.openstack.org/12479", 
            "date_created": "2012-09-06 00:11:30.369919+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Sorry, I meant bug #1045456", 
            "date_created": "2012-09-06 12:41:59.866513+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/12479\nCommitted: http://github.com/openstack/nova/commit/4ac2dcc36bb4e737e486ef86930c023b403a3f3a\nSubmitter: Jenkins\nBranch:    stable/essex\n\ncommit 4ac2dcc36bb4e737e486ef86930c023b403a3f3a\nAuthor: RongzeZhu <email address hidden>\nDate:   Sun Sep 2 18:43:56 2012 +0800\n\n    Fix simple_tenant_usage's handing of future end times\n    \n    Fixes bug #1043999\n    \n    simple_tenant_usage returns the usage in the range between the supplied\n    start and end query parameters. The _hours_for() method calculates the\n    number of hours the instance was running in this range, even if the end time\n    is in the future.\n    \n    By default, python-novaclient requests usage between 4 weeks ago and tomorrow.\n    This means we a report which accounts for 24 hours of extra running time for\n    each currently running instance. Fix this by clamping the period of the\n    returned report at the current time.\n    \n    Change-Id: I61c211fd85b729aaeaac6ef24644ee19eb5bb6b0\n    (cherry picked from commit 869443f41c8826c9a4de1dcc65c5a5354b623a04)\n", 
            "date_created": "2012-09-10 21:00:25.947378+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hello Joe, or anyone else affected,\n\nAccepted nova into precise-proposed. The package will build now and be available at http://launchpad.net/ubuntu/+source/nova/2012.1.3+stable-20130423-e52e6912-0ubuntu1 in a few hours, and then in the -proposed repository.\n\nPlease help us by testing this new package.  See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed.  Your feedback will aid us getting this update out to other Ubuntu users.\n\nIf this package fixes the bug for you, please add a comment to this bug, mentioning the version of the package you tested, and change the tag from verification-needed to verification-done. If it does not fix the bug for you, please add a comment stating that, and change the tag to verification-failed.  In either case, details of your testing will help us make a better decision.\n\nFurther information regarding the verification process can be found at https://wiki.ubuntu.com/QATeam/PerformingSRUVerification .  Thank you in advance!", 
            "date_created": "2013-05-09 23:13:12.169333+00:00", 
            "author": "https://api.launchpad.net/1.0/~brian-murray"
        }, 
        {
            "content": "Please find the attached test log from the Ubuntu Server Team's CI infrastructure.  As part of the verification process for this bug, Nova has been deployed and configured across multiple nodes using precise-proposed as an installation source.  After successful bring-up and configuration of the cluster, a number of exercises and smoke tests have be invoked to ensure the updated package did not introduce any regressions. A number of test iterations were carried out to catch any possible transient errors.\n\nPlease Note the list of installed packages at the top and bottom of the report.\n\nFor records of upstream test coverage of this update, please see the Jenkins links in the comments of the relevant  upstream code-review(s):\n\nTrunk review: https://review.openstack.org/12304\nStable review: https://review.openstack.org/12479\n\nAs per the provisional Micro Release Exception granted to this package by the Technical Board, we hope this contributes toward verification of this update.", 
            "date_created": "2013-05-16 07:31:39.251706+00:00", 
            "author": "https://api.launchpad.net/1.0/~yolanda.robla"
        }, 
        {
            "content": "Test coverage log.", 
            "date_created": "2013-05-16 07:31:42.512824+00:00", 
            "author": "https://api.launchpad.net/1.0/~yolanda.robla"
        }, 
        {
            "content": "Please find the attached test log from the Ubuntu Server Team's CI infrastructure.  As part of the verification process for this bug, Nova has been deployed and configured across multiple nodes using precise-proposed as an installation source.  After successful bring-up and configuration of the cluster, a number of exercises and smoke tests have be invoked to ensure the updated package did not introduce any regressions. A number of test iterations were carried out to catch any possible transient errors.\n\nPlease Note the list of installed packages at the top and bottom of the report.\n\nFor records of upstream test coverage of this update, please see the Jenkins links in the comments of the relevant  upstream code-review(s):\n\nTrunk review: https://review.openstack.org/12304\nStable review: https://review.openstack.org/12479\n\nAs per the provisional Micro Release Exception granted to this package by the Technical Board, we hope this contributes toward verification of this update.", 
            "date_created": "2013-05-16 07:33:53.294246+00:00", 
            "author": "https://api.launchpad.net/1.0/~yolanda.robla"
        }, 
        {
            "content": "Test coverage log.", 
            "date_created": "2013-05-16 07:33:57.894608+00:00", 
            "author": "https://api.launchpad.net/1.0/~yolanda.robla"
        }, 
        {
            "content": "This bug was fixed in the package nova - 2012.1.3+stable-20130423-e52e6912-0ubuntu1\n\n---------------\nnova (2012.1.3+stable-20130423-e52e6912-0ubuntu1) precise-proposed; urgency=low\n\n  * Resynchronize with stable/essex (e52e6912) (LP: #1089488):\n    - [48e81f1] VNC proxy can be made to connect to wrong VM LP: 1125378\n    - [3bf5a58] snat rule too broad for some network configurations LP: 1048765\n    - [efaacda] DOS by allocating all fixed ips LP: 1125468\n    - [b683ced] Add nosehtmloutput as a test dependency.\n    - [45274c8] Nova unit tests not running, but still passing for stable/essex\n      LP: 1132835\n    - [e02b459] vnc unit-test fixes\n    - [87361d3] Jenkins jobs fail because of incompatibility between sqlalchemy-\n      migrate and the newest sqlalchemy-0.8.0b1 (LP: #1073569)\n    - [e98928c] VNC proxy can be made to connect to wrong VM LP: 1125378\n    - [c0a10db] DoS through XML entity expansion (CVE-2013-1664) LP: 1100282\n    - [243d516] No authentication on block device used for os-volume_boot\n      LP: 1069904\n    - [80fefe5] use_single_default_gateway does not function correctly\n      (LP: #1075859)\n    - [bd10241] Essex 2012.1.3 : Error deleting instance with 2 Nova Volumes\n      attached (LP: #1079745)\n    - [86a5937] do_refresh_security_group_rules in nova.virt.firewall is very\n      slow (LP: #1062314)\n    - [ae9c5f4] deallocate_fixed_ip attempts to update an already deleted\n      fixed_ip (LP: #1017633)\n    - [20f98c5] failed to allocate fixed ip because old deleted one exists\n      (LP: #996482)\n    - [75f6922] snapshot stays in saving state if the vm base image is deleted\n      (LP: #921774)\n    - [1076699] lock files may be removed in error dues to permissions issues\n      (LP: #1051924)\n    - [40c5e94] ensure_default_security_group() does not call sgh (LP: #1050982)\n    - [4eebe76] At termination, LXC rootfs is not always unmounted before\n      rmtree() is called (LP: #1046313)\n    - [47dabb3] Heavily loaded nova-compute instances don't sent reports\n      frequently enough (LP: #1045152)\n    - [b375b4f] When attach volume lost attach when node restart (LP: #1004791)\n    - [4ac2dcc] nova usage-list returns  wrong usage (LP: #1043999)\n    - [014fcbc] Bridge port's hairpin mode not set after resuming a machine\n      (LP: #1040537)\n    - [2f35f8e] Nova flavor ephemeral space size reported incorrectly\n      (LP: #1026210)\n  * Dropped, superseeded by new snapshot:\n    - debian/patches/CVE-2013-0335.patch: [48e81f1]\n    - debian/patches/CVE-2013-1838.patch: [efaacda]\n    - debian/patches/CVE-2013-1664.patch: [c0a10db]\n    - debian/patches/CVE-2013-0208.patch: [243d516]\n -- Yolanda <email address hidden>   Mon, 22 Apr 2013 12:37:08 +0200", 
            "date_created": "2013-05-16 17:27:32.658916+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "The verification of this Stable Release Update has completed successfully and the package has now been released to -updates.  Subsequently, the Ubuntu Stable Release Updates Team is being unsubscribed and will not receive messages about this bug report.  In the event that you encounter a regression using the package from -updates please report a new bug using ubuntu-bug and tag the bug report regression-update so we can easily find any regresssions.", 
            "date_created": "2013-05-16 17:29:08.511113+00:00", 
            "author": "https://api.launchpad.net/1.0/~kitterman"
        }
    ]
}