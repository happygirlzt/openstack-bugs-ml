{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 10:51:41.109234+00:00", 
    "description": "On a devstack installation, after launching a cirros VM, it fails to get metadata. See the console log:\n\n############ debug end   ##############\ncloud-setup: failed to read iid from metadata. tried 30\nWARN: /etc/rc3.d/S45-cloud-setup failed\nStarting dropbear sshd: generating rsa key... generating dsa key... OK\n===== cloud-final: system completely up in 44.86 seconds ====\nwget: server returned error: HTTP/1.1 500 Internal Server Error\nwget: server returned error: HTTP/1.1 500 Internal Server Error\nwget: server returned error: HTTP/1.1 500 Internal Server Error\n  instance-id: \n  public-ipv4: \n  local-ipv4 : \nwget: server returned error: HTTP/1.1 500 Internal Server Error\ncloud-userdata: failed to read instance id\nWARN: /etc/rc3.d/S99-cloud-userdata failed\n\nIn the nova-api log, you see:\n\n[req-8130fb17-1ac1-4004-be6a-c2d7ae41425c None None] Failed to get metadata for ip: 10.0.0.2\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 75, in __call__\n    meta_data = self.get_metadata(remote_address)\n  File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 57, in get_metadata\n    data = base.get_metadata_by_address(address)\n  File \"/opt/stack/nova/nova/api/metadata/base.py\", line 383, in get_metadata_by_address\n    return InstanceMetadata(instance, address)\n  File \"/opt/stack/nova/nova/api/metadata/base.py\", line 102, in __init__\n    self.mappings = _format_instance_mapping(ctxt, instance)\n  File \"/opt/stack/nova/nova/api/metadata/base.py\", line 388, in _format_instance_mapping\n    return block_device.instance_block_mapping(instance, bdms)\n  File \"/opt/stack/nova/nova/block_device.py\", line 97, in instance_block_mapping\n    if FLAGS.compute_driver.endswith('xenapi.XenAPIDriver'):\n  File \"/opt/stack/nova/nova/openstack/common/cfg.py\", line 1039, in __getattr__\n    return self._get(name)\n  File \"/opt/stack/nova/nova/openstack/common/cfg.py\", line 1361, in _get\n    value = self._substitute(self._do_get(name, group))\n  File \"/opt/stack/nova/nova/openstack/common/cfg.py\", line 1377, in _do_get\n    info = self._get_opt_info(name, group)\n  File \"/opt/stack/nova/nova/openstack/common/cfg.py\", line 1470, in _get_opt_info\n    raise NoSuchOptError(opt_name, group)\nNoSuchOptError: no such option: compute_driver", 
    "tags": [
        "verification-needed"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1063851", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 1063851, 
    "index": 843, 
    "created": "2012-10-08 15:19:28.408538+00:00", 
    "title": "metadata service throws 500 - NoSuchOptError", 
    "comments": [
        {
            "content": "On a devstack installation, after launching a cirros VM, it fails to get metadata. See the console log:\n\n############ debug end   ##############\ncloud-setup: failed to read iid from metadata. tried 30\nWARN: /etc/rc3.d/S45-cloud-setup failed\nStarting dropbear sshd: generating rsa key... generating dsa key... OK\n===== cloud-final: system completely up in 44.86 seconds ====\nwget: server returned error: HTTP/1.1 500 Internal Server Error\nwget: server returned error: HTTP/1.1 500 Internal Server Error\nwget: server returned error: HTTP/1.1 500 Internal Server Error\n  instance-id: \n  public-ipv4: \n  local-ipv4 : \nwget: server returned error: HTTP/1.1 500 Internal Server Error\ncloud-userdata: failed to read instance id\nWARN: /etc/rc3.d/S99-cloud-userdata failed\n\nIn the nova-api log, you see:\n\n[req-8130fb17-1ac1-4004-be6a-c2d7ae41425c None None] Failed to get metadata for ip: 10.0.0.2\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 75, in __call__\n    meta_data = self.get_metadata(remote_address)\n  File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 57, in get_metadata\n    data = base.get_metadata_by_address(address)\n  File \"/opt/stack/nova/nova/api/metadata/base.py\", line 383, in get_metadata_by_address\n    return InstanceMetadata(instance, address)\n  File \"/opt/stack/nova/nova/api/metadata/base.py\", line 102, in __init__\n    self.mappings = _format_instance_mapping(ctxt, instance)\n  File \"/opt/stack/nova/nova/api/metadata/base.py\", line 388, in _format_instance_mapping\n    return block_device.instance_block_mapping(instance, bdms)\n  File \"/opt/stack/nova/nova/block_device.py\", line 97, in instance_block_mapping\n    if FLAGS.compute_driver.endswith('xenapi.XenAPIDriver'):\n  File \"/opt/stack/nova/nova/openstack/common/cfg.py\", line 1039, in __getattr__\n    return self._get(name)\n  File \"/opt/stack/nova/nova/openstack/common/cfg.py\", line 1361, in _get\n    value = self._substitute(self._do_get(name, group))\n  File \"/opt/stack/nova/nova/openstack/common/cfg.py\", line 1377, in _do_get\n    info = self._get_opt_info(name, group)\n  File \"/opt/stack/nova/nova/openstack/common/cfg.py\", line 1470, in _get_opt_info\n    raise NoSuchOptError(opt_name, group)\nNoSuchOptError: no such option: compute_driver", 
            "date_created": "2012-10-08 15:19:28.408538+00:00", 
            "author": "https://api.launchpad.net/1.0/~mate-lakat"
        }, 
        {
            "content": "Seems to be because of this change:\nhttps://github.com/openstack/nova/commit/625996722f08b57b2926cf4d6aff5fe03abc196c\n", 
            "date_created": "2012-10-08 15:38:31.402715+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/14170", 
            "date_created": "2012-10-08 15:48:45.616476+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This also seems to break the XenSM volume driver:\nhttps://github.com/openstack/nova/commit/625996722f08b57b2926cf4d6aff5fe03abc196c#L11R101\n", 
            "date_created": "2012-10-08 16:05:04.162327+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "It looks more like it was this change to me:\n\nhttps://review.openstack.org/#/c/14068/", 
            "date_created": "2012-10-12 18:32:40.255203+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "@Vish, John - I confirm that backing out https://review.openstack.org/#/c/14068/ fixes the issue for me. Should we revert that patch as broken?", 
            "date_created": "2012-10-29 01:30:23.485348+00:00", 
            "author": "https://api.launchpad.net/1.0/~lifeless"
        }, 
        {
            "content": "no I would prefer if we just fix it.\n", 
            "date_created": "2012-10-29 19:55:08.123835+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/14991", 
            "date_created": "2012-10-29 19:59:19.545590+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/14991\nCommitted: http://github.com/openstack/nova/commit/9102f807e09508419d4c1cd356b22c7f3ca50b18\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9102f807e09508419d4c1cd356b22c7f3ca50b18\nAuthor: John Garbutt <email address hidden>\nDate:   Mon Oct 8 16:46:39 2012 +0100\n\n    Ensures compute_driver flag can be used by bdm\n    \n    Fixes bug 1063851 by moving compute_driver flag from\n    compute/manager.py to the global flags.py\n    \n    Change-Id: I06891fd65550b63ffe83da18b6af41cf46938667\n", 
            "date_created": "2012-10-30 18:03:21.538883+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/folsom\nReview: https://review.openstack.org/16432", 
            "date_created": "2012-11-19 14:42:52.518861+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/16432\nCommitted: http://github.com/openstack/nova/commit/d3fd05b1f8889d9f39b8eb5be3f7e7798d648206\nSubmitter: Jenkins\nBranch:    stable/folsom\n\ncommit d3fd05b1f8889d9f39b8eb5be3f7e7798d648206\nAuthor: John Garbutt <email address hidden>\nDate:   Mon Oct 8 16:46:39 2012 +0100\n\n    Ensures compute_driver flag can be used by bdm\n    \n    Fixes bug 1063851 by moving compute_driver flag from\n    compute/manager.py to the global flags.py\n    \n    Change-Id: I337795f6956050b398c39a8476e3c1e2b689c470\n    Signed-off-by: Chuck Short <email address hidden>\n", 
            "date_created": "2012-11-20 15:01:39.074373+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hello Mate, or anyone else affected,\n\nAccepted nova into quantal-proposed. The package will build now and be available at http://launchpad.net/ubuntu/+source/nova/2012.2.1+stable-20121212-a99a802e-0ubuntu1 in a few hours, and then in the -proposed repository.\n\nPlease help us by testing this new package.  See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed.  Your feedback will aid us getting this update out to other Ubuntu users.\n\nIf this package fixes the bug for you, please add a comment to this bug, mentioning the version of the package you tested, and change the tag from verification-needed to verification-done. If it does not fix the bug for you, please add a comment stating that, and change the tag to verification-failed.  In either case, details of your testing will help us make a better decision.\n\nFurther information regarding the verification process can be found at https://wiki.ubuntu.com/QATeam/PerformingSRUVerification .  Thank you in advance!", 
            "date_created": "2012-12-28 16:28:05.397676+00:00", 
            "author": "https://api.launchpad.net/1.0/~clint-fewbar"
        }, 
        {
            "content": "This bug was fixed in the package nova - 2012.2.1+stable-20121212-a99a802e-0ubuntu1\n\n---------------\nnova (2012.2.1+stable-20121212-a99a802e-0ubuntu1) quantal-proposed; urgency=low\n\n  * Ubuntu updates:\n    - debian/control: Ensure novaclient is upgraded with nova,\n      require python-keystoneclient >= 1:2.9.0. (LP: #1073289)\n    - d/p/avoid_setuptools_git_dependency.patch: Refresh.\n  * Dropped patches, applied upstream:\n    - debian/patches/CVE-2012-5625.patch: [a99a802]\n  * Resynchronize with stable/folsom (b55014ca) (LP: #1085255):\n    - [a99a802] create_lvm_image allocates dirty blocks (LP: #1070539)\n    - [670b388] RPC exchange name defaults to 'openstack' (LP: #1083944)\n    - [3ede373] disassociate_floating_ip with multi_host=True fails\n      (LP: #1074437)\n    - [22d7c3b] libvirt imagecache should handle shared image storage\n      (LP: #1075018)\n    - [e787786] Detached and deleted RBD volumes remain associated with insance\n      (LP: #1083818)\n    - [9265eb0] live_migration missing migrate_data parameter in Hyper-V driver\n      (LP: #1066513)\n    - [3d99848] use_single_default_gateway does not function correctly\n      (LP: #1075859)\n    - [65a2d0a] resize does not migrate DHCP host information (LP: #1065440)\n    - [102c76b] Nova backup image fails (LP: #1065053)\n    - [48a3521] Fix config-file overrides for nova-dhcpbridge\n    - [69663ee] Cloudpipe in Folsom: no such option: cnt_vpn_clients\n      (LP: #1069573)\n    - [6e47cc8] DisassociateAddress can cause Internal Server Error\n      (LP: #1080406)\n    - [22c3d7b] API calls to dis-associate an auto-assigned floating IP should\n      return proper warning (LP: #1061499)\n    - [bd11d15] libvirt: if exception raised during volume_detach, volume state\n      is inconsistent (LP: #1057756)\n    - [dcb59c3] admin can't describe all images in ec2 api (LP: #1070138)\n    - [78de622] Incorrect Exception raised during Create server when metadata\n      over 255 characters  (LP: #1004007)\n    - [c313de4] Fixed IP isn't released before updating DHCP host file\n      (LP: #1078718)\n    - [f4ab42d] Enabling Return Reservation ID with XML create server request\n      returns no body  (LP: #1061124)\n    - [3db2a38] 'BackupCreate' should accept rotation parameter greater than or\n      equal to zero (LP: #1071168)\n    - [f7e5dde] libvirt reboot sometimes fails to reattach volumes\n      (LP: #1073720)\n    - [ff776d4] libvirt: detaching volume may fail while terminating other\n      instances on the same host concurrently (LP: #1060836)\n    - [85a8bc2] Used instance uuid rather than id in remove-fixed-ip\n    - [42a85c0] Fix error on invalid delete_on_termination value\n    - [6a17579] xenapi migrations fail w/ swap (LP: #1064083)\n    - [97649b8] attach-time field for volumes is not updated for detach volume\n      (LP: #1056122)\n    - [8f6a718] libvirt: rebuild is not using kernel and ramdisk associated with\n      the new image (LP: #1060925)\n    - [fbe835f] live-migration and volume host assignement (LP: #1066887)\n    - [c2a9150] typo prevents volume_tmp_dir flag from working (LP: #1071536)\n    - [93efa21] Instances deleted during spawn leak network allocations\n      (LP: #1068716)\n    - [ebabd02] After restarting an instance volume is lost (LP: #1071069)\n    - [a369303] xen volume auto device selection always picks xvdb\n      (LP: #1061944)\n    - [8d1095c] Calls to to_xml() to generate XML for a soft deleted flavor fail\n      (LP: #1073736)\n    - [1857821] nova-manage doesn't validate the key value supplied to update\n      the quota (LP: #1064359)\n    - [6ae32f0] Compute manager doesn't update 'host' field when it tries to run\n      a VM (LP: #1073600)\n    - [284f6ea] Host field set too early during builds (LP: #1060255)\n    - [395511f] finish_resize failures result in NoneType exception\n      (LP: #1071595)\n    - [85ccf80] confirm_resize mgr call requires admin context (LP: #1071600)\n    - [2dceffa] Only return the last N lines of the console log (LP: #1081436)\n    - [9c7a711] console auth does not work with memcache, unicode error\n      (LP: #1057279)\n    - [b27f7ef] disk path not exists when using LXC with libvirt_images_type=lvm\n      (LP: #1079113)\n    - [1351c6b] nova-api now requires quantumclient (LP: #1070509)\n    - [612f404] nova-api now requires quantumclient (LP: #1070509)\n    - [7e8a166] nova-compute (folsom) fails to start, compute_driver is None\n      (LP: #1081836)\n    - [182ca80] Nova API does not work with QuantumV2 API subclasses\n      (LP: #1070045)\n    - [55d1412] 413 error code doesn't always provide Retry-After (LP: #1079387)\n    - [1581505] Snapshotting LXC instance fails (LP: #1058273)\n    - [197398f] Stop network.api import on network import\n    - [b874d21] Scheduler Race Condition at high volume (LP: #1073956)\n    - [3316e1f] Nic Ordering not guaranteed with Quantum API (LP: #1064524)\n    - [ab7e37e] Stable oslo (aka common) update\n    - [3f7788c] update nova to report quantum floating IPs (LP: #1023169)\n    - [d3fd05b] metadata service throws 500 - NoSuchOptError (LP: #1063851)\n    - [97542c9] libvirt imagecache still runs even if disabled (LP: #1075017)\n    - [b31f528] OS API: XML Namespace Handling Broken (LP: #887191)\n    - [76b44d9] nova-api crashes if it is run with nobody account.\n      (LP: #1073858)\n    - [d59f6ad] nova-compute will assign the same device name if volume-attach\n      continuously  (LP: #1062033)\n    - [8e11181] Nova does not delete the LV on LVM backed VMs (LP: #1078085)\n    - [9bf2c6a] Fixed instance deletion issue from Nova API.\n    - [c0e1247] forget to release resource when terminate an instance from a\n      failed compute node (LP: #1067214)\n    - [49397a4] ensure_default_security_group() does not call sgh (LP: #1050982)\n    - [47ff8a5] trigger_instance[add/remove]_security_group_refresh are never\n      called (LP: #1057069)\n    - [c9cade2] Resource reservation isn't rolled back properly for certain\n      failures during Instance Create (LP: #1065092)\n    - [34c3845] Resource tracker uses regex DB query too often (LP: #1060363)\n    - [92eddd2] Logging CPU incompatibility when attempting live migration fails\n      (LP: #1076308)\n    - [8b4896b] hostname in metadata ends with . if dhcp_domain flag is empty\n      (LP: #1064713)\n    - [ded0473] deletes fail when instance in RESIZED (LP: #1056601)\n    - [d015be5] libvirt: cannot detach volume from stopped domain (LP: #1057730)\n    - [d5888f1] Resizing a Xen instance with attached volumes fails\n      (LP: #1028092)\n    - [fb88827] resize leave leftover libvirt configs (LP: #1015731)\n    - [5ccd691] nova-network cannot re-generate MAC address if collision happen\n      (LP: #1059366)\n    - [e3d7f8c] After folsom upgrade, instances can no longer access existing\n      volumes. (LP: #1065702)\n    - [804f858] Jenkins jobs fail because of incompatibility between sqlalchemy-\n      migrate and the newest sqlalchemy-0.8.0b1 (LP: #1073569)\n    - [f67a5f9] block device mappings for deleted instances are leaked\n      (LP: #1069099)\n    - [32d8722] volume and snapshot IDs do not correctly map to UUIDs after\n      folsom upgrade (LP: #1065785)\n    - [9613643] Xenserver cannot boot vm_mode=xen type images (LP: #1055431)\n    - [863c767] Cloudpipe extension xml serialization doesn't return the\n      instance(s) data (LP: #1056242)\n    - [724adcf] deleting security group does not mark rules as deleted\n      (LP: #1056380)\n    - [84a996c] IP Protocol for security group should be returned in lower case\n      to be compliant with the ec2 api (LP: #1057196)\n    - [e1ed06a] db tests fail with sqlalchemy 0.7.4 (LP: #1057145)\n    - [bddb06d] Fail to boot raw image on XenServer (LP: #1055413)\n    - [d4d1665] Add SIGPIPE handler to subprocess execution in rootwrap and\n      utils.execute (LP: #1053364)\n    - [0af4dd0] libvirt: concurrent detach_volume and terminate fails\n      (LP: #1057719)\n    - [ebbfa9e] Instances in vm state DELETED are preventing compute restart\n      (LP: #1053441)\n    - [db516a2] ComputeManager does not provide block_device_info on destroy\n      call in revert_resize (LP: #1056285)\n    - [4223ebf] Set defaultbranch in .gitreview to stable/folsom\n    - [eee4dbb] do_refresh_security_group_rules in nova.virt.firewall is very\n      slow (LP: #1062314)\n    - [b7e509a] Set read_deleted='yes' for instance_id_mappings.\n    - [9e20735] Tests fail on 32bit machines (_get_hash_str is platform\n      dependent) (LP: #1050359)\n -- Adam Gandelman <email address hidden>   Wed, 12 Dec 2012 16:27:51 -0400", 
            "date_created": "2013-01-29 13:10:46.783756+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}