{
    "status": "Invalid", 
    "last_updated": "2015-01-22 23:18:50.870712+00:00", 
    "description": "A instance's vm_state is error.  I did delete it, but the task_state is \"deleting\" all the time. The log show that the error is \"Instance disappeared during terminate\" because of InstanceNotFound exception.\n\n1. Relative code is as follows:\n@utils.synchronized(instance['uuid'])\n        def do_terminate_instance(instance, bdms):\n            try:\n                self._delete_instance(context, instance, bdms, quotas)\n            except exception.InstanceNotFound:\n                LOG.info(_(\"Instance disappeared during terminate\"),\n                         instance=instance)\n            except Exception as error:\n                # As we're trying to delete always go to Error if something\n                # goes wrong that _delete_instance can't handle.\n                with excutils.save_and_reraise_exception():\n                    LOG.exception(_('Setting instance vm_state to ERROR'),\n                                  instance=instance)\n                    self._set_instance_error_state(context, instance['uuid'])\n\n\n2. [root@lxlconductor1 instances(keystone_admin)]# nova list\n+--------------------------------------+----------+--------+------------+-------------+-------------------+\n| ID                                   | Name     | Status | Task State | Power State | Networks          |\n+--------------------------------------+----------+--------+------------+-------------+-------------------+\n| e72d62c9-5d54-4bd0-8afc-d45116467ba5 | hanrong2 | ACTIVE | deleting   | NOSTATE     |                   |\n+--------------------------------------+----------+--------+------------+-------------+-------------------+\n\n3. The error log is as follows:\n2015-02-21 17:20:41.049 429 AUDIT nova.compute.manager [req-621830f5-8d73-4897-90f9-505e4bf9a6e4 7aba40236a4c4494aba4eb0b9365ffee be568b8239d147e58f1ef16b6011c93d] [instance: e72d62c9-5d54-4bd0-8afc-d45116467ba5] Terminating instance\n2015-02-21 17:21:06.031 429 ERROR nova.virt.libvirt.driver [-] [instance: e72d62c9-5d54-4bd0-8afc-d45116467ba5] During wait destroy, instance disappeared.\n2015-02-21 17:21:06.066 429 INFO urllib3.connectionpool [-] Starting new HTTP connection (1): 10.43.114.108\n2015-02-21 17:21:06.550 429 INFO nova.virt.libvirt.driver [req-621830f5-8d73-4897-90f9-505e4bf9a6e4 7aba40236a4c4494aba4eb0b9365ffee be568b8239d147e58f1ef16b6011c93d] [instance: e72d62c9-5d54-4bd0-8afc-d45116467ba5] Deletion of /var/lib/nova/instances/e72d62c9-5d54-4bd0-8afc-d45116467ba5 complete\n2015-02-21 17:21:38.469 429 AUDIT nova.compute.resource_tracker [req-5aae7032-2766-4adf-be17-ab059b4d5cae None None] Auditing locally available compute resources\n2015-02-21 17:21:38.612 429 INFO oslo.messaging._drivers.impl_qpid [-] Connected to AMQP server on 10.43.114.108:5671\n2015-02-21 17:22:44.876 429 INFO oslo.messaging._drivers.impl_qpid [-] Connected to AMQP server on 10.43.114.108:5671\n2015-02-21 17:23:05.684 429 INFO nova.compute.manager [req-621830f5-8d73-4897-90f9-505e4bf9a6e4 7aba40236a4c4494aba4eb0b9365ffee be568b8239d147e58f1ef16b6011c93d] [instance: e72d62c9-5d54-4bd0-8afc-d45116467ba5] Instance disappeared during terminate\n\n4. I think if instance is disappeared, delete would be successful.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1405107", 
    "owner": "None", 
    "id": 1405107, 
    "index": 5343, 
    "created": "2014-12-23 09:48:20.535450+00:00", 
    "title": "The instance's task_state is 'deleting' all the time, because the error of 'Instance disappeared during terminate'. ", 
    "comments": [
        {
            "content": "A instance's vm_state is error.  I did delete it, but the task_state is \"deleting\" all the time. The log show that the error is \"Instance disappeared during terminate\" because of InstanceNotFound exception.\n\n1. Relative code is as follows:\n@utils.synchronized(instance['uuid'])\n        def do_terminate_instance(instance, bdms):\n            try:\n                self._delete_instance(context, instance, bdms, quotas)\n            except exception.InstanceNotFound:\n                LOG.info(_(\"Instance disappeared during terminate\"),\n                         instance=instance)\n            except Exception as error:\n                # As we're trying to delete always go to Error if something\n                # goes wrong that _delete_instance can't handle.\n                with excutils.save_and_reraise_exception():\n                    LOG.exception(_('Setting instance vm_state to ERROR'),\n                                  instance=instance)\n                    self._set_instance_error_state(context, instance['uuid'])\n\n\n2. [root@lxlconductor1 instances(keystone_admin)]# nova list\n+--------------------------------------+----------+--------+------------+-------------+-------------------+\n| ID                                   | Name     | Status | Task State | Power State | Networks          |\n+--------------------------------------+----------+--------+------------+-------------+-------------------+\n| e72d62c9-5d54-4bd0-8afc-d45116467ba5 | hanrong2 | ACTIVE | deleting   | NOSTATE     |                   |\n+--------------------------------------+----------+--------+------------+-------------+-------------------+\n\n3. The error log is as follows:\n2015-02-21 17:20:41.049 429 AUDIT nova.compute.manager [req-621830f5-8d73-4897-90f9-505e4bf9a6e4 7aba40236a4c4494aba4eb0b9365ffee be568b8239d147e58f1ef16b6011c93d] [instance: e72d62c9-5d54-4bd0-8afc-d45116467ba5] Terminating instance\n2015-02-21 17:21:06.031 429 ERROR nova.virt.libvirt.driver [-] [instance: e72d62c9-5d54-4bd0-8afc-d45116467ba5] During wait destroy, instance disappeared.\n2015-02-21 17:21:06.066 429 INFO urllib3.connectionpool [-] Starting new HTTP connection (1): 10.43.114.108\n2015-02-21 17:21:06.550 429 INFO nova.virt.libvirt.driver [req-621830f5-8d73-4897-90f9-505e4bf9a6e4 7aba40236a4c4494aba4eb0b9365ffee be568b8239d147e58f1ef16b6011c93d] [instance: e72d62c9-5d54-4bd0-8afc-d45116467ba5] Deletion of /var/lib/nova/instances/e72d62c9-5d54-4bd0-8afc-d45116467ba5 complete\n2015-02-21 17:21:38.469 429 AUDIT nova.compute.resource_tracker [req-5aae7032-2766-4adf-be17-ab059b4d5cae None None] Auditing locally available compute resources\n2015-02-21 17:21:38.612 429 INFO oslo.messaging._drivers.impl_qpid [-] Connected to AMQP server on 10.43.114.108:5671\n2015-02-21 17:22:44.876 429 INFO oslo.messaging._drivers.impl_qpid [-] Connected to AMQP server on 10.43.114.108:5671\n2015-02-21 17:23:05.684 429 INFO nova.compute.manager [req-621830f5-8d73-4897-90f9-505e4bf9a6e4 7aba40236a4c4494aba4eb0b9365ffee be568b8239d147e58f1ef16b6011c93d] [instance: e72d62c9-5d54-4bd0-8afc-d45116467ba5] Instance disappeared during terminate\n\n4. I think if instance is disappeared, delete would be successful.", 
            "date_created": "2014-12-23 09:48:20.535450+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "Having an instance disappear isn't enough to know the things were cleaned up successfully. Instead we should sort out why the instance disappeared, that shouldn't happen.", 
            "date_created": "2015-01-22 23:18:40.124318+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }
    ]
}