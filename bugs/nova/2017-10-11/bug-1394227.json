{
    "status": "Won't Fix", 
    "last_updated": "2014-11-21 07:21:25.795296+00:00", 
    "description": "A devstack installation with cells enabled fails the tempest 'tempest.scenario.test_minimum_basic.TestMinimumBasicScenario'.\n\nThe error log is as follows, \n\ntraceback-1: {{{\nTraceback (most recent call last):\n  File \"/opt/stack/tempest/tempest/services/compute/json/servers_client.py\", line 196, in wait_for_server_termination\n    raise exceptions.BuildErrorException(server_id=server_id)\nBuildErrorException: Server 89933458-9c96-41ee-8082-a0567f573458 failed to build and is in ERROR status\n}}}\n\ntraceback-2: {{{\nTraceback (most recent call last):\n  File \"/opt/stack/tempest/tempest/scenario/manager.py\", line 160, in _wait_for_cleanups\n    waiter_callable(**wait)\n  File \"/opt/stack/tempest/tempest/services/compute/json/servers_client.py\", line 196, in wait_for_server_termination\n    raise exceptions.BuildErrorException(server_id=server_id)\nBuildErrorException: Server 89933458-9c96-41ee-8082-a0567f573458 failed to build and is in ERROR status\n}}}\n\nTraceback (most recent call last):\n  File \"/opt/stack/tempest/tempest/test.py\", line 113, in wrapper\n    return f(self, *func_args, **func_kwargs)\n  File \"/opt/stack/tempest/tempest/scenario/test_minimum_basic.py\", line 137, in test_minimum_basic_scenario\n    self.nova_boot()\n  File \"/opt/stack/tempest/tempest/scenario/test_minimum_basic.py\", line 53, in nova_boot\n    create_kwargs=create_kwargs)\n  File \"/opt/stack/tempest/tempest/scenario/manager.py\", line 210, in create_server\n    status='ACTIVE')\n  File \"/opt/stack/tempest/tempest/services/compute/json/servers_client.py\", line 183, in wait_for_server_status\n    ready_wait=ready_wait)\n  File \"/opt/stack/tempest/tempest/common/waiters.py\", line 77, in wait_for_server_status\n    server_id=server_id)\nBuildErrorException: Server 89933458-9c96-41ee-8082-a0567f573458 failed to build and is in ERROR status\nDetails: {u'message': u'No valid host was found. ', u'code': 500, u'created': u'2014-11-19T13:01:41Z'}", 
    "tags": [
        "cells", 
        "nova", 
        "test-needed"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1394227", 
    "owner": "None", 
    "id": 1394227, 
    "index": 5283, 
    "created": "2014-11-19 14:29:51.187325+00:00", 
    "title": "tempest.scenario.test_minimum_basic.TestMinimumBasicScenario fails with cellular devstack", 
    "comments": [
        {
            "content": "A devstack installation with cells enabled fails the tempest 'tempest.scenario.test_minimum_basic.TestMinimumBasicScenario'.\n\nThe error log is as follows, \n\ntraceback-1: {{{\nTraceback (most recent call last):\n  File \"/opt/stack/tempest/tempest/services/compute/json/servers_client.py\", line 196, in wait_for_server_termination\n    raise exceptions.BuildErrorException(server_id=server_id)\nBuildErrorException: Server 89933458-9c96-41ee-8082-a0567f573458 failed to build and is in ERROR status\n}}}\n\ntraceback-2: {{{\nTraceback (most recent call last):\n  File \"/opt/stack/tempest/tempest/scenario/manager.py\", line 160, in _wait_for_cleanups\n    waiter_callable(**wait)\n  File \"/opt/stack/tempest/tempest/services/compute/json/servers_client.py\", line 196, in wait_for_server_termination\n    raise exceptions.BuildErrorException(server_id=server_id)\nBuildErrorException: Server 89933458-9c96-41ee-8082-a0567f573458 failed to build and is in ERROR status\n}}}\n\nTraceback (most recent call last):\n  File \"/opt/stack/tempest/tempest/test.py\", line 113, in wrapper\n    return f(self, *func_args, **func_kwargs)\n  File \"/opt/stack/tempest/tempest/scenario/test_minimum_basic.py\", line 137, in test_minimum_basic_scenario\n    self.nova_boot()\n  File \"/opt/stack/tempest/tempest/scenario/test_minimum_basic.py\", line 53, in nova_boot\n    create_kwargs=create_kwargs)\n  File \"/opt/stack/tempest/tempest/scenario/manager.py\", line 210, in create_server\n    status='ACTIVE')\n  File \"/opt/stack/tempest/tempest/services/compute/json/servers_client.py\", line 183, in wait_for_server_status\n    ready_wait=ready_wait)\n  File \"/opt/stack/tempest/tempest/common/waiters.py\", line 77, in wait_for_server_status\n    server_id=server_id)\nBuildErrorException: Server 89933458-9c96-41ee-8082-a0567f573458 failed to build and is in ERROR status\nDetails: {u'message': u'No valid host was found. ', u'code': 500, u'created': u'2014-11-19T13:01:41Z'}", 
            "date_created": "2014-11-19 14:29:51.187325+00:00", 
            "author": "https://api.launchpad.net/1.0/~mvineetmenon"
        }, 
        {
            "content": "", 
            "date_created": "2014-11-19 14:29:51.187325+00:00", 
            "author": "https://api.launchpad.net/1.0/~mvineetmenon"
        }, 
        {
            "content": "Let's check the cells job on the experimental queue to see if this fails there.  I think this test does something with security groups to ssh into the instance and I don't think security groups work with existing cells.", 
            "date_created": "2014-11-19 17:42:08.372622+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "this may be a security group issue, cells doesn't support them at all.  Instead of fixing the existing cells implementation we are working on a cells replacement (cells v2) along with a migration strategy.", 
            "date_created": "2014-11-19 17:42:38.121723+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "FYI, some tests are skipped today:\n\nhttps://review.openstack.org/#/c/135064/3/jenkins/jobs/devstack-gate.yaml", 
            "date_created": "2014-11-19 17:43:09.137862+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Without the nova logs its hard to say why this failed", 
            "date_created": "2014-11-19 17:43:53.559310+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "It also fails in tree:\n\nhttp://logs.openstack.org/30/133530/2/experimental/check-tempest-dsvm-cells/dde0c62/console.html#_2014-11-18_20_59_51_300\n\nThe instance uuid in this case is 009ba63a-f4e6-41b1-9f02-2830c284e9e7.\n\nIt fails here:\n\nhttp://logs.openstack.org/30/133530/2/experimental/check-tempest-dsvm-cells/dde0c62/logs/screen-n-cpu.txt.gz?level=TRACE#_2014-11-18_20_52_50_764\n\nIt's the flavors issue that alaski is trying to fix:\n\n2014-11-18 20:52:50.764 30949 ERROR nova.compute.manager [-] [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] Instance failed to spawn\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] Traceback (most recent call last):\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2244, in _build_resources\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     yield resources\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2114, in _build_and_run_instance\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     instance_type=instance_type)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2639, in spawn\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     write_to_disk=True)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4222, in _get_guest_xml\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     context)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 3968, in _get_guest_config\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     instance['instance_type_id'])\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/objects/base.py\", line 154, in wrapper\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     args, kwargs)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/conductor/rpcapi.py\", line 359, in object_class_action\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     objver=objver, args=args, kwargs=kwargs)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     retry=self.retry)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     timeout=timeout, retry=retry)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 408, in send\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     retry=retry)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 399, in _send\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     raise result\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] FlavorNotFound_Remote: Flavor 6 could not be found.\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] Traceback (most recent call last):\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 400, in _object_dispatch\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     return getattr(target, method)(context, *args, **kwargs)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/objects/base.py\", line 156, in wrapper\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     result = fn(cls, context, *args, **kwargs)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/objects/flavor.py\", line 129, in get_by_id\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     db_flavor = db.flavor_get(context, id)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/db/api.py\", line 1492, in flavor_get\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     return IMPL.flavor_get(context, id)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 144, in wrapper\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     return f(*args, **kwargs)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]   File \"/opt/stack/new/nova/nova/db/sqlalchemy/api.py\", line 4608, in flavor_get\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7]     raise exception.FlavorNotFound(flavor_id=id)\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] FlavorNotFound: Flavor 6 could not be found.\n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n2014-11-18 20:52:50.764 30949 TRACE nova.compute.manager [instance: 009ba63a-f4e6-41b1-9f02-2830c284e9e7] \n\nSee: https://review.openstack.org/#/c/135621/\n\nIt would eventually fail here in the scenario test anyway because I don't think security groups work with current cells:\n\nhttp://git.openstack.org/cgit/openstack/tempest/tree/tempest/scenario/test_minimum_basic.py#n126\n\nAs noted here with the skip patch:\n\nhttps://review.openstack.org/#/c/135064/3/jenkins/jobs/devstack-gate.yaml", 
            "date_created": "2014-11-19 18:40:25.319093+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Marked as won't fix since this is a limitation in the current cells design.  This is something we could track against the cells v2 effort in Kilo though so we can validate that this works with cells v2.", 
            "date_created": "2014-11-19 18:41:09.089625+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "If you want to track this for cells v2, I'm adding it to the etherpad here:\n\nhttps://etherpad.openstack.org/p/nova-cells-testing", 
            "date_created": "2014-11-19 18:46:50.730005+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Need to test once Nova provide stable cell functionality in cells v2", 
            "date_created": "2014-11-21 07:21:10.105369+00:00", 
            "author": "https://api.launchpad.net/1.0/~ghanshyammann"
        }
    ]
}