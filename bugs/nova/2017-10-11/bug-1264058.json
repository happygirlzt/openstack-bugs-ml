{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:03:26.340881+00:00", 
    "description": "Steps To Reproduce\n----------------------------\n./run_tests.sh  nova.tests.integrated.test_api_samples\n\nVersions Affected\n-------------------------\nTrunk version after Dec. 21 2013, with following commit\n\ncommit 78d62186e5b0388f740d42cb8da5798cd67d7880\nRefs: 2014.1.b1-281-g78d6218\nAuthor:     Roman Podoliaka <email address hidden>\nAuthorDate: Tue Dec 17 13:52:45 2013 +0200\nCommit:     Roman Podoliaka <email address hidden>\nCommitDate: Thu Dec 19 18:08:29 2013 +0200\n\n    Fix interprocess locks when running unit-tests\n\nSymptom\n--\nUnit cases fail with following exception message.\n\nstderr: {{{\n/home/stack/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/sql/expression.py:1927: SAWarning: The IN-predicate on \"instances.uuid\" was invoked with an empty sequence. This results in a contradiction, which nonetheless can be expensive to evaluate.  Consider alternative strategies for improved performance.\n  return self._in_impl(operators.in_op, operators.notin_op, other)\n}}}\n\nTraceback (most recent call last):\n  File \"/home/stack/nova/nova/tests/integrated/test_api_samples.py\", line 97, in setUp\n    super(ApiSampleTestBaseV2, self).setUp()\n  File \"/home/stack/nova/nova/tests/integrated/integrated_helpers.py\", line 81, in setUp\n    self._setup_services()\n  File \"/home/stack/nova/nova/tests/integrated/integrated_helpers.py\", line 94, in _setup_services\n    self.network = self.start_service('network')\n  File \"/home/stack/nova/nova/test.py\", line 284, in start_service\n    svc = self.useFixture(ServiceFixture(name, host, **kwargs))\n  File \"/home/stack/nova/.venv/local/lib/python2.7/site-packages/testtools/testcase.py\", line 609, in useFixture\n    fixture.setUp()\n  File \"/home/stack/nova/nova/test.py\", line 175, in setUp\n    self.service.start()\n  File \"/home/stack/nova/nova/service.py\", line 172, in start\n    self.manager.init_host()\n  File \"/home/stack/nova/nova/network/manager.py\", line 1718, in init_host\n    self.l3driver.initialize(fixed_range=False, networks=networks)\n  File \"/home/stack/nova/nova/network/l3.py\", line 94, in initialize\n    linux_net.metadata_forward()\n  File \"/home/stack/nova/nova/network/linux_net.py\", line 647, in metadata_forward\n    iptables_manager.apply()\n  File \"/home/stack/nova/nova/network/linux_net.py\", line 426, in apply\n    self._apply()\n  File \"/home/stack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n    with lock(name, lock_file_prefix, external, lock_path):\n  File \"/usr/lib/python2.7/contextlib.py\", line 17, in __enter__\n    return self.gen.next()\n  File \"/home/stack/nova/nova/openstack/common/lockutils.py\", line 183, in lock\n    raise cfg.RequiredOptError('lock_path')\nRequiredOptError: value required for option: lock_path", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1264058", 
    "owner": "https://api.launchpad.net/1.0/~unicell", 
    "id": 1264058, 
    "index": 4409, 
    "created": "2013-12-25 09:12:30.437380+00:00", 
    "title": "run_test.sh broken for RequiredOptError: value required for option: lock_path", 
    "comments": [
        {
            "content": "Steps To Reproduce\n----------------------------\n./run_tests.sh  nova.tests.integrated.test_api_samples\n\nVersions Affected\n-------------------------\nTrunk version after Dec. 21 2013, with following commit\n\ncommit 78d62186e5b0388f740d42cb8da5798cd67d7880\nRefs: 2014.1.b1-281-g78d6218\nAuthor:     Roman Podoliaka <email address hidden>\nAuthorDate: Tue Dec 17 13:52:45 2013 +0200\nCommit:     Roman Podoliaka <email address hidden>\nCommitDate: Thu Dec 19 18:08:29 2013 +0200\n\n    Fix interprocess locks when running unit-tests\n\nSymptom\n--\nUnit cases fail with following exception message.\n\nstderr: {{{\n/home/stack/nova/.venv/local/lib/python2.7/site-packages/sqlalchemy/sql/expression.py:1927: SAWarning: The IN-predicate on \"instances.uuid\" was invoked with an empty sequence. This results in a contradiction, which nonetheless can be expensive to evaluate.  Consider alternative strategies for improved performance.\n  return self._in_impl(operators.in_op, operators.notin_op, other)\n}}}\n\nTraceback (most recent call last):\n  File \"/home/stack/nova/nova/tests/integrated/test_api_samples.py\", line 97, in setUp\n    super(ApiSampleTestBaseV2, self).setUp()\n  File \"/home/stack/nova/nova/tests/integrated/integrated_helpers.py\", line 81, in setUp\n    self._setup_services()\n  File \"/home/stack/nova/nova/tests/integrated/integrated_helpers.py\", line 94, in _setup_services\n    self.network = self.start_service('network')\n  File \"/home/stack/nova/nova/test.py\", line 284, in start_service\n    svc = self.useFixture(ServiceFixture(name, host, **kwargs))\n  File \"/home/stack/nova/.venv/local/lib/python2.7/site-packages/testtools/testcase.py\", line 609, in useFixture\n    fixture.setUp()\n  File \"/home/stack/nova/nova/test.py\", line 175, in setUp\n    self.service.start()\n  File \"/home/stack/nova/nova/service.py\", line 172, in start\n    self.manager.init_host()\n  File \"/home/stack/nova/nova/network/manager.py\", line 1718, in init_host\n    self.l3driver.initialize(fixed_range=False, networks=networks)\n  File \"/home/stack/nova/nova/network/l3.py\", line 94, in initialize\n    linux_net.metadata_forward()\n  File \"/home/stack/nova/nova/network/linux_net.py\", line 647, in metadata_forward\n    iptables_manager.apply()\n  File \"/home/stack/nova/nova/network/linux_net.py\", line 426, in apply\n    self._apply()\n  File \"/home/stack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n    with lock(name, lock_file_prefix, external, lock_path):\n  File \"/usr/lib/python2.7/contextlib.py\", line 17, in __enter__\n    return self.gen.next()\n  File \"/home/stack/nova/nova/openstack/common/lockutils.py\", line 183, in lock\n    raise cfg.RequiredOptError('lock_path')\nRequiredOptError: value required for option: lock_path", 
            "date_created": "2013-12-25 09:12:30.437380+00:00", 
            "author": "https://api.launchpad.net/1.0/~unicell"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/64006", 
            "date_created": "2013-12-25 09:26:35.086387+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hi tempest developers\n\nAs described in Qiu's commit message, should this kind of mistake caused by adding new module be prevented by some tests?", 
            "date_created": "2013-12-27 11:51:57.582679+00:00", 
            "author": "https://api.launchpad.net/1.0/~academicgareth"
        }, 
        {
            "content": "Kung, no this doesn't belong in tempest. This was an issue with the unit tests, and tempest doesn't does integration testing.", 
            "date_created": "2013-12-30 16:36:35.109251+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/64006\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=d1eaf822682245318a9499c53c4f5d02fa3a52bd\nSubmitter: Jenkins\nBranch:    master\n\ncommit d1eaf822682245318a9499c53c4f5d02fa3a52bd\nAuthor: Qiu Yu <email address hidden>\nDate:   Wed Dec 25 17:14:33 2013 +0800\n\n    Fix interprocess locks for run_tests.sh\n    \n    In recent change of commit 78d62186e5b0388f740d42cb8da5798cd67d7880 tox\n    test has been switched to use openstack.common.lockutils module for\n    interprocess locks. However, run_tests.sh is left unchanged, which hit a\n    regression when running tests with run_tests.sh\n    \n    This change applies the same change in commit 78d621 for tox.ini to\n    run_tests.sh, i.e. using openstack.common.lockutils to create temporary\n    directory for locks and pass it as env variables to all tests.\n    \n    Closes-Bug: #1264058\n    Change-Id: I007bd39e4d9aad7539b4b7389eb5189b5d1f10e2\n", 
            "date_created": "2014-01-03 12:59:19.642010+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}