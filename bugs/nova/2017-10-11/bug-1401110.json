{
    "status": "Invalid", 
    "last_updated": "2015-02-05 23:35:02.413789+00:00", 
    "description": "In Short:\nBlock Device Mapping cannot be found for Tempest online snapshot test on devstack with remote file system driver.\n\nMore Detailed:\nTesting Environment is plain kilo head devstack with the included Tempest testsuite and a new remotefs based cinder driver.\nThe test:\n     tempest.api.volume.test_volumes_snapshots.VolumesV2SnapshotTestJSON.test_snapshot_create_with_volume_in_use\nproduces an error in Nova, stacktrace:\n\n2014-12-10 11:14:42.329 ^[[00;32mDEBUG nova.api.openstack.wsgi [^[[01;36mreq-5a0e0e46-2455-41ee-a36a-6c14de0d1627 ^[[00;36mVolumesV1SnapshotTestJSON-2078362258 VolumesV1SnapshotTestJSON-1658640019^[[00;32m] ^[[01;35m^[[00;32mCalling method '<bound method Controller.show of <nova.api.openstack.compute.servers.Controller object at 0x7fbd794a0690>>'^[[00m ^[[00;33mfrom (pid=12485) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:963^[[00m^M\n2014-12-10 11:14:42.374 ^[[00;36mINFO nova.osapi_compute.wsgi.server [^[[01;36mreq-5a0e0e46-2455-41ee-a36a-6c14de0d1627 ^[[00;36mVolumesV1SnapshotTestJSON-2078362258 VolumesV1SnapshotTestJSON-1658640019^[[00;36m] ^[[01;35m^[[00;36m192.168.122.67 \"GET /v2/e152b27ee9d641e6a57bec75ab29c924/servers/4fb9afd5-18a9-416e-b955-d161ebbc436f HTTP/1.1\" status: 200 len: 1609 time: 0.0979590^[[00m^M\n2014-12-10 11:14:43.381 ^[[00;32mDEBUG nova.api.openstack.wsgi [^[[01;36mreq-02efe9e9-c7cb-46bf-8ab4-0b70a9b84f6d ^[[00;36mVolumesV1SnapshotTestJSON-2078362258 VolumesV1SnapshotTestJSON-1658640019^[[00;32m] ^[[01;35m^[[00;32mCalling method '<bound method Controller.show of <nova.api.openstack.compute.servers.Controller object at 0x7fbd794a0690>>'^[[00m ^[[00;33mfrom (pid=12487) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:963^[[00m^M\n2014-12-10 11:14:43.423 ^[[00;36mINFO nova.osapi_compute.wsgi.server [^[[01;36mreq-02efe9e9-c7cb-46bf-8ab4-0b70a9b84f6d ^[[00;36mVolumesV1SnapshotTestJSON-2078362258 VolumesV1SnapshotTestJSON-1658640019^[[00;36m] ^[[01;35m^[[00;36m192.168.122.67 \"GET /v2/e152b27ee9d641e6a57bec75ab29c924/servers/4fb9afd5-18a9-416e-b955-d161ebbc436f HTTP/1.1\" status: 200 len: 1749 time: 0.0428371^[[00m^M\n2014-12-10 11:14:43.995 ^[[00;32mDEBUG nova.api.openstack.wsgi [^[[01;36mreq-023897db-cfd9-4259-b7c4-3621722a5eec ^[[00;36mVolumesV2SnapshotTestJSON-1786381329 VolumesV2SnapshotTestJSON-2048796393^[[00;32m] ^[[01;35m^[[00;32mAction: 'create', calling method: <bound method AssistedVolumeSnapshotsController.create of <nova.api.openstack.compute.contrib.assisted_volume_snapshots.AssistedVolumeSnapshotsController object at 0x7fbd792ef490>>, body: {\"snapshot\": {\"create_info\": {\"snapshot_id\": \"cf916b1a-e797-41e3-bde8-39c9615aa622\", \"type\": \"qcow2\", \"new_file\": \"volume-9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65.cf916b1a-e797-41e3-bde8-39c9615aa622\"}, \"volume_id\": \"9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65\"}}^[[00m ^[[00;33mfrom (pid=12487) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:960^[[00m^M\n2014-12-10 11:14:43.995 ^[[01;36mAUDIT nova.api.openstack.compute.contrib.assisted_volume_snapshots [^[[01;36mreq-023897db-cfd9-4259-b7c4-3621722a5eec ^[[00;36mVolumesV2SnapshotTestJSON-1786381329 VolumesV2SnapshotTestJSON-2048796393^[[01;36m] ^[[01;35m^[[01;36mCreate assisted snapshot from volume 9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65^[[00m^M\n2014-12-10 11:14:44.007 ^[[01;31mERROR nova.api.openstack [^[[01;36mreq-023897db-cfd9-4259-b7c4-3621722a5eec ^[[00;36mVolumesV2SnapshotTestJSON-1786381329 VolumesV2SnapshotTestJSON-2048796393^[[01;31m] ^[[01;35m^[[01;31mCaught error: No volume Block Device Mapping with id 9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65.^[[00m^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00mTraceback (most recent call last):^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 125, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return req.get_response(self.application)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    application, catch_exc_info=False)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    app_iter = application(self.environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return resp(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 793, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return self._call_app(env, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 726, in _call_app^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return self._app(env, _fake_start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return resp(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return resp(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    response = self.app(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return resp(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    resp = self.call_func(req, *args, **self.kwargs)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return self.func(req, *args, **kwargs)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 936, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    content_type, body, accept)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1001, in _process_stack^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    action_result = self.dispatch(meth, request, action_args)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1086, in dispatch^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return method(req=request, **action_args)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/compute/contrib/assisted_volume_snapshots.py\", line 71, in create^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    create_info)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 226, in wrapped^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return func(self, context, target, *args, **kwargs)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 3263, in volume_snapshot_create^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    context, volume_id, expected_attrs=['instance'])^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/objects/base.py\", line 156, in wrapper^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    result = fn(cls, context, *args, **kwargs)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/objects/block_device.py\", line 164, in get_by_volume_id^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    raise exception.VolumeBDMNotFound(volume_id=volume_id)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00mVolumeBDMNotFound: No volume Block Device Mapping with id 9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65.^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m^M\n\nTesting the tests individual steps via manual cli commands (create instance, attach volume, create online snapshot) works without errors in any of the involved components.\nThe error occurs with our Quobyte Driver (in development, see https://blueprints.launchpad.net/cinder/+spec/quobyte-usp-driver) and apparently with the existing GlusterFS driver. Both are closely related (Quobyte build on top of GlusterFS impl) and derived from the remotefs driver. I don't know if other setups are affected.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1401110", 
    "owner": "None", 
    "id": 1401110, 
    "index": 4111, 
    "created": "2014-12-10 13:35:00.799661+00:00", 
    "title": " Volume Block Device Mapping cannot be found", 
    "comments": [
        {
            "content": "In Short:\nBlock Device Mapping cannot be found for Tempest online snapshot test on devstack with remote file system driver.\n\nMore Detailed:\nTesting Environment is plain kilo head devstack with the included Tempest testsuite and a new remotefs based cinder driver.\nThe test:\n     tempest.api.volume.test_volumes_snapshots.VolumesV2SnapshotTestJSON.test_snapshot_create_with_volume_in_use\nproduces an error in Nova, stacktrace:\n\n2014-12-10 11:14:42.329 ^[[00;32mDEBUG nova.api.openstack.wsgi [^[[01;36mreq-5a0e0e46-2455-41ee-a36a-6c14de0d1627 ^[[00;36mVolumesV1SnapshotTestJSON-2078362258 VolumesV1SnapshotTestJSON-1658640019^[[00;32m] ^[[01;35m^[[00;32mCalling method '<bound method Controller.show of <nova.api.openstack.compute.servers.Controller object at 0x7fbd794a0690>>'^[[00m ^[[00;33mfrom (pid=12485) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:963^[[00m^M\n2014-12-10 11:14:42.374 ^[[00;36mINFO nova.osapi_compute.wsgi.server [^[[01;36mreq-5a0e0e46-2455-41ee-a36a-6c14de0d1627 ^[[00;36mVolumesV1SnapshotTestJSON-2078362258 VolumesV1SnapshotTestJSON-1658640019^[[00;36m] ^[[01;35m^[[00;36m192.168.122.67 \"GET /v2/e152b27ee9d641e6a57bec75ab29c924/servers/4fb9afd5-18a9-416e-b955-d161ebbc436f HTTP/1.1\" status: 200 len: 1609 time: 0.0979590^[[00m^M\n2014-12-10 11:14:43.381 ^[[00;32mDEBUG nova.api.openstack.wsgi [^[[01;36mreq-02efe9e9-c7cb-46bf-8ab4-0b70a9b84f6d ^[[00;36mVolumesV1SnapshotTestJSON-2078362258 VolumesV1SnapshotTestJSON-1658640019^[[00;32m] ^[[01;35m^[[00;32mCalling method '<bound method Controller.show of <nova.api.openstack.compute.servers.Controller object at 0x7fbd794a0690>>'^[[00m ^[[00;33mfrom (pid=12487) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:963^[[00m^M\n2014-12-10 11:14:43.423 ^[[00;36mINFO nova.osapi_compute.wsgi.server [^[[01;36mreq-02efe9e9-c7cb-46bf-8ab4-0b70a9b84f6d ^[[00;36mVolumesV1SnapshotTestJSON-2078362258 VolumesV1SnapshotTestJSON-1658640019^[[00;36m] ^[[01;35m^[[00;36m192.168.122.67 \"GET /v2/e152b27ee9d641e6a57bec75ab29c924/servers/4fb9afd5-18a9-416e-b955-d161ebbc436f HTTP/1.1\" status: 200 len: 1749 time: 0.0428371^[[00m^M\n2014-12-10 11:14:43.995 ^[[00;32mDEBUG nova.api.openstack.wsgi [^[[01;36mreq-023897db-cfd9-4259-b7c4-3621722a5eec ^[[00;36mVolumesV2SnapshotTestJSON-1786381329 VolumesV2SnapshotTestJSON-2048796393^[[00;32m] ^[[01;35m^[[00;32mAction: 'create', calling method: <bound method AssistedVolumeSnapshotsController.create of <nova.api.openstack.compute.contrib.assisted_volume_snapshots.AssistedVolumeSnapshotsController object at 0x7fbd792ef490>>, body: {\"snapshot\": {\"create_info\": {\"snapshot_id\": \"cf916b1a-e797-41e3-bde8-39c9615aa622\", \"type\": \"qcow2\", \"new_file\": \"volume-9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65.cf916b1a-e797-41e3-bde8-39c9615aa622\"}, \"volume_id\": \"9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65\"}}^[[00m ^[[00;33mfrom (pid=12487) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:960^[[00m^M\n2014-12-10 11:14:43.995 ^[[01;36mAUDIT nova.api.openstack.compute.contrib.assisted_volume_snapshots [^[[01;36mreq-023897db-cfd9-4259-b7c4-3621722a5eec ^[[00;36mVolumesV2SnapshotTestJSON-1786381329 VolumesV2SnapshotTestJSON-2048796393^[[01;36m] ^[[01;35m^[[01;36mCreate assisted snapshot from volume 9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65^[[00m^M\n2014-12-10 11:14:44.007 ^[[01;31mERROR nova.api.openstack [^[[01;36mreq-023897db-cfd9-4259-b7c4-3621722a5eec ^[[00;36mVolumesV2SnapshotTestJSON-1786381329 VolumesV2SnapshotTestJSON-2048796393^[[01;31m] ^[[01;35m^[[01;31mCaught error: No volume Block Device Mapping with id 9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65.^[[00m^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00mTraceback (most recent call last):^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 125, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return req.get_response(self.application)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    application, catch_exc_info=False)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    app_iter = application(self.environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return resp(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 793, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return self._call_app(env, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 726, in _call_app^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return self._app(env, _fake_start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return resp(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return resp(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    response = self.app(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return resp(environ, start_response)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    resp = self.call_func(req, *args, **self.kwargs)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return self.func(req, *args, **kwargs)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 936, in __call__^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    content_type, body, accept)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1001, in _process_stack^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    action_result = self.dispatch(meth, request, action_args)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1086, in dispatch^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return method(req=request, **action_args)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/api/openstack/compute/contrib/assisted_volume_snapshots.py\", line 71, in create^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    create_info)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 226, in wrapped^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    return func(self, context, target, *args, **kwargs)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/compute/api.py\", line 3263, in volume_snapshot_create^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    context, volume_id, expected_attrs=['instance'])^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/objects/base.py\", line 156, in wrapper^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    result = fn(cls, context, *args, **kwargs)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m  File \"/opt/stack/nova/nova/objects/block_device.py\", line 164, in get_by_volume_id^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m    raise exception.VolumeBDMNotFound(volume_id=volume_id)^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00mVolumeBDMNotFound: No volume Block Device Mapping with id 9f7ec09d-4ff2-4ef9-96dc-2bdc07471a65.^M\n^[[01;31m2014-12-10 11:14:44.007 TRACE nova.api.openstack ^[[01;35m^[[00m^M\n\nTesting the tests individual steps via manual cli commands (create instance, attach volume, create online snapshot) works without errors in any of the involved components.\nThe error occurs with our Quobyte Driver (in development, see https://blueprints.launchpad.net/cinder/+spec/quobyte-usp-driver) and apparently with the existing GlusterFS driver. Both are closely related (Quobyte build on top of GlusterFS impl) and derived from the remotefs driver. I don't know if other setups are affected.", 
            "date_created": "2014-12-10 13:35:00.799661+00:00", 
            "author": "https://api.launchpad.net/1.0/~2-silvan"
        }, 
        {
            "content": "I just talked to mtanino about this, I think we have a basic understanding of why this happens.\n\nIt looks like the test calls os_attach to tell Cinder the volume is attached, but it doesn't actually attach it.  (Need to tell Nova to attach the volume, not just send attach info to Cinder.)  Then it calls create_snapshot which will try to perform an assisted snapshot for GlusterFS, Quobyte, etc.\n\nThis assisted snapshot fails in Nova because, since the volume wasn't _actually_ attached, Nova can't find it.  The test needs to actually attach the volume for this to work as intended.", 
            "date_created": "2014-12-10 21:46:28.043991+00:00", 
            "author": "https://api.launchpad.net/1.0/~eharney"
        }, 
        {
            "content": "I also have same problem now.\n\nI think the root cause of this problem is in tempest test steps.\nIn the test of test_snapshot_create_with_volume_in_use, these test steps are executed.\n\n(1) Create a server\n(2) Create a volume\n(3) Attach volume using Cinder \"os-attach\" API ( instead of using Nova \"os-volume_attachments\")\n(4) Create snapshot for the volume\n(5) Error...\n\nIn my understanding, \"os-attach\" only updates some cinder DB entry related to volume attachment and this does not attach a volume to an instance. \n#This API is generally called from Nova side after volume attachment is finished.\n\nTherefore, nova does not know the volume after this API is called and there is no block_device_mapping in nova DB.\nI confirmed Nova's block_device_mapping DB entry, after \"os-attach\" API, and there is no volume entry which is created step (2).\n\nIn test step (3), \"self.volumes_client.attach_volume\" is called now. This calls cinder client API.\nBut I think right test is calling \"self.servers_client.attach_volume\". This call Nova's volume attachment API.\n\nI succeeded this test using \"self.servers_client.attach_volume\".\nI will post a patch to tempest shortly.", 
            "date_created": "2014-12-10 22:11:19.491880+00:00", 
            "author": "https://api.launchpad.net/1.0/~mitsuhiro-tanino"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/140873", 
            "date_created": "2014-12-11 00:15:05.735129+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/140873\nCommitted: https://git.openstack.org/cgit/openstack/tempest/commit/?id=ab667960ef337538cf777bb0f325cb5d0e865d76\nSubmitter: Jenkins\nBranch:    master\n\ncommit ab667960ef337538cf777bb0f325cb5d0e865d76\nAuthor: Mitsuhiro Tanino <email address hidden>\nDate:   Wed Dec 10 15:52:08 2014 -0500\n\n    Actually attach a volume to an instance before taking snapshot\n    \n    In the test test_snapshot_create_with_volume_in_use, the test calls Cinder\n    \"os-attach\" for attaching a volume. The \"os-attach\" to tell Cinder the\n    volume is attached, but the API doesn't actually attach the volume to an\n    instance.(Only update volume status in DB)\n    \n    This is not right test case for taking a snapshot with in-use volume.\n    In this test, Nova \"os-volume_attachment\" should be called for volume\n    attachment.\n    \n    Also, some Cinder drivers fails assisted snapshot due to this problem.\n    In order to perform the snapshot properly, this fix is needed.\n    \n    Closes-Bug #1401110\n    Change-Id: Ib31e351fe7c3d27824241cf142c213eae287483f\n", 
            "date_created": "2014-12-22 15:16:36.052964+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Looks like this was fixed in tempest", 
            "date_created": "2015-02-05 23:34:44.891842+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }
    ]
}