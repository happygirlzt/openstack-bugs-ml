{
    "status": "Fix Released", 
    "last_updated": "2015-11-19 21:48:50.694802+00:00", 
    "description": "This bug is very similar to https://bugs.launchpad.net/nova/+bug/1388386.\n\nResuming a server that has a unicode name after suspending it results in:\n\n2015-05-08 15:22:30.148 4370 INFO nova.compute.manager [req-ac919325-aa2d-422c-b679-5f05ecca5d42 0688b01e6439ca32d698d20789d52169126fb41fb1a4ddafcebb97d854e836c9 6dfced8dd0df4d4d98e4a0db60526c8d - - -] [instance: 12371aa8-889d-4333-8fab-61a13f87a547] Resuming\n2015-05-08 15:22:31.651 4370 ERROR nova.compute.manager [req-ac919325-aa2d-422c-b679-5f05ecca5d42 0688b01e6439ca32d698d20789d52169126fb41fb1a4ddafcebb97d854e836c9 6dfced8dd0df4d4d98e4a0db60526c8d - - -] [instance: 12371aa8-889d-4333-8fab-61a13f87a547] Setting instance vm_state to ERROR\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547] Traceback (most recent call last):\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6427, in _error_out_instance_on_exception\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     yield\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4371, in resume_instance\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     block_device_info)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2234, in resume\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     vifs_already_plugged=True)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/powervc_nova/virt/powerkvm/driver.py\", line 2061, in _create_domain_and_network\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     disk_info=disk_info)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4391, in _create_domain_and_network\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     power_on=power_on)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4322, in _create_domain\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     LOG.error(err)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     six.reraise(self.type_, self.value, self.tb)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4305, in _create_domain\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     err = _LE('Error defining a domain with XML: %s') % xml\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547] UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 297: ordinal not in range(128)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]\n\nThe _create_domain() method has the following line:\n\nerr = _LE('Error defining a domain with XML: %s') % xml\n\nwhich fails with the UnicodeDecodeError because the xml object has utf-8 encoding.  The fix is to wrap the xml object in oslo.utils.encodeutils.safe_decode for the error message.\n\nI'm seeing the issue on Kilo, but it is also likely an issue on Juno as well.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1453274", 
    "owner": "https://api.launchpad.net/1.0/~tpeoples", 
    "id": 1453274, 
    "index": 4247, 
    "created": "2015-05-08 20:52:16.247748+00:00", 
    "title": "libvirt: resume instance with utf-8 name results in UnicodeDecodeError", 
    "comments": [
        {
            "content": "This bug is very similar to https://bugs.launchpad.net/nova/+bug/1388386.\n\nResuming a server that has a unicode name after suspending it results in:\n\n2015-05-08 15:22:30.148 4370 INFO nova.compute.manager [req-ac919325-aa2d-422c-b679-5f05ecca5d42 0688b01e6439ca32d698d20789d52169126fb41fb1a4ddafcebb97d854e836c9 6dfced8dd0df4d4d98e4a0db60526c8d - - -] [instance: 12371aa8-889d-4333-8fab-61a13f87a547] Resuming\n2015-05-08 15:22:31.651 4370 ERROR nova.compute.manager [req-ac919325-aa2d-422c-b679-5f05ecca5d42 0688b01e6439ca32d698d20789d52169126fb41fb1a4ddafcebb97d854e836c9 6dfced8dd0df4d4d98e4a0db60526c8d - - -] [instance: 12371aa8-889d-4333-8fab-61a13f87a547] Setting instance vm_state to ERROR\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547] Traceback (most recent call last):\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6427, in _error_out_instance_on_exception\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     yield\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 4371, in resume_instance\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     block_device_info)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2234, in resume\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     vifs_already_plugged=True)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/powervc_nova/virt/powerkvm/driver.py\", line 2061, in _create_domain_and_network\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     disk_info=disk_info)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4391, in _create_domain_and_network\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     power_on=power_on)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4322, in _create_domain\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     LOG.error(err)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     six.reraise(self.type_, self.value, self.tb)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4305, in _create_domain\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]     err = _LE('Error defining a domain with XML: %s') % xml\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547] UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 297: ordinal not in range(128)\n2015-05-08 15:22:31.651 4370 TRACE nova.compute.manager [instance: 12371aa8-889d-4333-8fab-61a13f87a547]\n\nThe _create_domain() method has the following line:\n\nerr = _LE('Error defining a domain with XML: %s') % xml\n\nwhich fails with the UnicodeDecodeError because the xml object has utf-8 encoding.  The fix is to wrap the xml object in oslo.utils.encodeutils.safe_decode for the error message.\n\nI'm seeing the issue on Kilo, but it is also likely an issue on Juno as well.", 
            "date_created": "2015-05-08 20:52:16.247748+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpeoples"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/181708", 
            "date_created": "2015-05-10 04:36:09.204809+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/181708\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=96a2283c1a07f0298c57f57d8c4112c1c33b6128\nSubmitter: Jenkins\nBranch:    master\n\ncommit 96a2283c1a07f0298c57f57d8c4112c1c33b6128\nAuthor: Taylor Peoples <email address hidden>\nDate:   Sun May 10 06:23:26 2015 +0200\n\n    libvirt: safe_decode xml for i18n logging\n    \n    The xml argument passed to _create_domain can be a utf-8 encoded string\n    which causes a UnicodeDecodeError when it is substituted into the _LE\n    unicode translated message. Safely decoding the xml argument before\n    attempting to substitute it into the error message avoids the\n    UnicodeDecodeError.\n    \n    Closes-Bug: #1453274\n    Change-Id: I4cf1836f4ca9097f7c6d98c5212a14d24111fe67\n", 
            "date_created": "2015-05-12 19:42:54.559909+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/182536", 
            "date_created": "2015-05-13 05:43:15.613094+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/kilo\nReview: https://review.openstack.org/182539", 
            "date_created": "2015-05-13 05:58:29.769934+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/182539\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c66c8e172ed00d67c3172572aa60c3ece83beeea\nSubmitter: Jenkins\nBranch:    stable/kilo\n\ncommit c66c8e172ed00d67c3172572aa60c3ece83beeea\nAuthor: Taylor Peoples <email address hidden>\nDate:   Sun May 10 06:23:26 2015 +0200\n\n    libvirt: safe_decode xml for i18n logging\n    \n    The xml argument passed to _create_domain can be a utf-8 encoded string\n    which causes a UnicodeDecodeError when it is substituted into the _LE\n    unicode translated message. Safely decoding the xml argument before\n    attempting to substitute it into the error message avoids the\n    UnicodeDecodeError.\n    \n    (cherry picked from commit 96a2283c1a07f0298c57f57d8c4112c1c33b6128)\n    \n    Conflicts:\n    \n    \tnova/virt/libvirt/driver.py\n    \n    Closes-Bug: #1453274\n    Change-Id: I4cf1836f4ca9097f7c6d98c5212a14d24111fe67\n", 
            "date_created": "2015-06-17 16:37:47.466194+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/182536\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8f13587ba50622126d6f8b6622273206e33f9f5b\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit 8f13587ba50622126d6f8b6622273206e33f9f5b\nAuthor: Taylor Peoples <email address hidden>\nDate:   Sun May 10 06:23:26 2015 +0200\n\n    libvirt: safe_decode xml for i18n logging\n    \n    The xml argument passed to _create_domain can be a utf-8 encoded string\n    which causes a UnicodeDecodeError when it is substituted into the _LE\n    unicode translated message. Safely decoding the xml argument before\n    attempting to substitute it into the error message avoids the\n    UnicodeDecodeError.\n    \n    (cherry picked from commit 96a2283c1a07f0298c57f57d8c4112c1c33b6128)\n    \n    Conflicts:\n    \n    \tnova/tests/unit/virt/libvirt/test_driver.py\n    \tnova/virt/libvirt/driver.py\n    \n    Change to strutils (instead of encodeutils) and test is located in\n    \"tests/\" instead of \"tests/unit/\".\n    \n    Closes-Bug: #1453274\n    Change-Id: I4cf1836f4ca9097f7c6d98c5212a14d24111fe67\n", 
            "date_created": "2015-06-21 12:12:25.477044+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}