{
    "status": "Invalid", 
    "last_updated": "2013-11-20 14:35:41.169110+00:00", 
    "description": "I'm not sure if this is really a bug or some missconfiguration from my side.\n\nMy configuration:\n\nflat networking with neutron created with:\n\nneutron net-create default_net --shared --provider:network_type flat --provider:physical_network default_physnet \n\nneutron subnet-create default_net 10.210.0.0/16 --name default_subnet --no-gateway --host-route destination=0.0.0.0/0,nexthop=10.210.0.1 --allocation-pool start=10.210.25.150,end=10.210.25.244 --dns_nameservers list=true 10.210.10.1 10.210.10.2 --disable-dhcp\n\nIn nova.conf I have config drive enabled.\n\nAfter machine boot, the config drive is attached, but the metadata from ec2/latest/ contains local-ipv4: None, so there is no ip for cloud-init.\n\nI had to change this in order to fix it in my case:\n/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\n\n## replace\n   inst_md = instance_metadata.InstanceMetadata(instance,\n                content=files, extra_md=extra_md, network_info=network_info)\n## with\n   inst_md = instance_metadata.InstanceMetadata(instance, address=network_info[0]['network']['subnets'][0]['ips'][0]['address'],\n                content=files, extra_md=extra_md, network_info=network_info)\n\nI didn't see in  /usr/lib/python2.6/site-packages/nova/api/metadata/base.py how is the address from network_info extracted.\n\nFull info from network_info variable:\n\nVIF({\n  'ovs_interfaceid': u'70e5f94b-3ec0-4aa7-bca9-ef1b38bf6bac',\n  'network': Network({\n    'bridge': 'br-int',\n    'subnets': [\n      Subnet({\n        'ips': [\n          FixedIP({\n            'meta': {\n              \n            },\n            'version': 4,\n            'type': 'fixed',\n            'floating_ips': [\n              \n            ],\n            'address': u'10.210.25.157'\n          })\n        ],\n        'version': 4,\n        'meta': {\n          \n        },\n        'dns': [\n          IP({\n            'meta': {\n              \n            },\n            'version': 4,\n            'type': 'dns',\n            'address': u'10.210.10.1'\n          }),\n          IP({\n            'meta': {\n              \n            },\n            'version': 4,\n            'type': 'dns',\n            'address': u'10.210.10.2'\n          })\n        ],\n        'routes': [\n          \n        ],\n        'cidr': u'10.210.0.0/16',\n        'gateway': IP({\n          'meta': {\n            \n          },\n          'version': None,\n          'type': 'gateway',\n          'address': None\n        })\n      })\n    ],\n    'meta': {\n      'injected': False,\n      'tenant_id': u'cf36834c5ed243ada60a1348f83ccf81'\n    },\n    'id': u'658978a0-0bdf-465e-869c-2236c3e5b2a6',\n    'label': u'default_net'\n  }),\n  'devname': u'tap70e5f94b-3e',\n  'qbh_params': None,\n  'meta': {\n    \n  },\n  'address': u'fa:16:3e:0f:78:33',\n  'type': u'ovs',\n  'id': u'70e5f94b-3ec0-4aa7-bca9-ef1b38bf6bac',\n  'qbg_params': None\n})", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1252749", 
    "owner": "None", 
    "id": 1252749, 
    "index": 4296, 
    "created": "2013-11-19 14:26:45.242800+00:00", 
    "title": "flat network and config drive = no ip", 
    "comments": [
        {
            "content": "I'm not sure if this is really a bug or some missconfiguration from my side.\n\nMy configuration:\n\nflat networking with neutron created with:\n\nneutron net-create default_net --shared --provider:network_type flat --provider:physical_network default_physnet \n\nneutron subnet-create default_net 10.210.0.0/16 --name default_subnet --no-gateway --host-route destination=0.0.0.0/0,nexthop=10.210.0.1 --allocation-pool start=10.210.25.150,end=10.210.25.244 --dns_nameservers list=true 10.210.10.1 10.210.10.2 --disable-dhcp\n\nIn nova.conf I have config drive enabled.\n\nAfter machine boot, the config drive is attached, but the metadata from ec2/latest/ contains local-ipv4: None, so there is no ip for cloud-init.\n\nI had to change this in order to fix it in my case:\n/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\n\n## replace\n   inst_md = instance_metadata.InstanceMetadata(instance,\n                content=files, extra_md=extra_md, network_info=network_info)\n## with\n   inst_md = instance_metadata.InstanceMetadata(instance, address=network_info[0]['network']['subnets'][0]['ips'][0]['address'],\n                content=files, extra_md=extra_md, network_info=network_info)\n\nI didn't see in  /usr/lib/python2.6/site-packages/nova/api/metadata/base.py how is the address from network_info extracted.\n\nFull info from network_info variable:\n\nVIF({\n  'ovs_interfaceid': u'70e5f94b-3ec0-4aa7-bca9-ef1b38bf6bac',\n  'network': Network({\n    'bridge': 'br-int',\n    'subnets': [\n      Subnet({\n        'ips': [\n          FixedIP({\n            'meta': {\n              \n            },\n            'version': 4,\n            'type': 'fixed',\n            'floating_ips': [\n              \n            ],\n            'address': u'10.210.25.157'\n          })\n        ],\n        'version': 4,\n        'meta': {\n          \n        },\n        'dns': [\n          IP({\n            'meta': {\n              \n            },\n            'version': 4,\n            'type': 'dns',\n            'address': u'10.210.10.1'\n          }),\n          IP({\n            'meta': {\n              \n            },\n            'version': 4,\n            'type': 'dns',\n            'address': u'10.210.10.2'\n          })\n        ],\n        'routes': [\n          \n        ],\n        'cidr': u'10.210.0.0/16',\n        'gateway': IP({\n          'meta': {\n            \n          },\n          'version': None,\n          'type': 'gateway',\n          'address': None\n        })\n      })\n    ],\n    'meta': {\n      'injected': False,\n      'tenant_id': u'cf36834c5ed243ada60a1348f83ccf81'\n    },\n    'id': u'658978a0-0bdf-465e-869c-2236c3e5b2a6',\n    'label': u'default_net'\n  }),\n  'devname': u'tap70e5f94b-3e',\n  'qbh_params': None,\n  'meta': {\n    \n  },\n  'address': u'fa:16:3e:0f:78:33',\n  'type': u'ovs',\n  'id': u'70e5f94b-3ec0-4aa7-bca9-ef1b38bf6bac',\n  'qbg_params': None\n})", 
            "date_created": "2013-11-19 14:26:45.242800+00:00", 
            "author": "https://api.launchpad.net/1.0/~cristi-falcas"
        }, 
        {
            "content": "After all i noticed that even with that ip, i can't build any network.\n\nInstead I will use config drive with flat_injected and injected_network_template.\n\nCan someone please close this bug?\n\n\n", 
            "date_created": "2013-11-20 14:35:27.346377+00:00", 
            "author": "https://api.launchpad.net/1.0/~cristi-falcas"
        }
    ]
}