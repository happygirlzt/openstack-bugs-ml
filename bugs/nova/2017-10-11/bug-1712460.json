{
    "status": "Fix Released", 
    "last_updated": "2017-09-25 14:28:25.988523+00:00", 
    "description": "\nDescription\n===========\nIf trying to create a new VM instance(let's call vm1) with the same instance name\non the same compute host, old existing VM instance(vm1) is destroyed. And openstack\ndoes not intend such situation so the status of old instance(vm1) is 'ACTIVE'\n\n\nSteps to reproduce\n==================\nA chronological list of steps which will bring off the\nissue you noticed:\n1. create one VM.\n2. check the VM is created.\n3. create another VM on the same host with the same name of the created VM in step 1\n  * In order to make same named instance, we can change nova config like below\n     instance_name_template = %(hostname)s \n4. check the VM exist. openstack has active instance but real VM is not.\n:\n[controller]# nova list\n+--------------------------------------+--------+--------+------------+-------------+----------------------+\n| ID                                   | Name   | Status | Task State | Power State | Networks             |\n+--------------------------------------+--------+--------+------------+-------------+----------------------+\n| 8595078e-1635-47c3-a027-78436a17f6d4 | testvm | ERROR  | -          | NOSTATE     | demo-net=192.168.0.3 |\n| a2239b07-9811-444f-b77e-96756046e8de | testvm | ACTIVE | -          | Running     | demo-net=192.168.0.7 |\n+--------------------------------------+--------+--------+------------+-------------+----------------------+\n[compute1]# virsh list\n Id    Name                           State\n----------------------------------------------------\n\nExpected result\n===============\nold VM instance should be running.\n\nActual result\n=============\nThere is no running VM.\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running. \nTested on Ocata\n\n2. Which hypervisor did you use?\nLibvirt + KVM\n\n\nLogs & Configs\n==============\n# grep instance_name_template /etc/nova/nova.conf \n#instance_name_template=instance-%08x\ninstance_name_template = %(hostname)s\n\n<nova log>\n2017-08-21 04:13:11.692 27134 ERROR nova.virt.libvirt.driver [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Failed to start libvirt guest\n2017-08-21 04:13:11.693 27134 INFO os_vif [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] Successfully unplugged vif VIFBridge(active=False,address=fa:16:3e:ad:3d:09,bridge_name='brq0f056785-2d',has_traffic_filtering=True,id=a74d54bd-04ab-42e1-bbea-2417f487825c,network=Network(0f056785-2d0a-4742-9517-570dbc427e16),plugin='linux_bridge',port_profile=<?>,preserve_on_delete=False,vif_name='tapa74d54bd-04')\n2017-08-21 04:13:11.704 27134 INFO nova.virt.libvirt.driver [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Deleting instance files /var/lib/nova/instances/8595078e-1635-47c3-a027-78436a17f6d4_del\n2017-08-21 04:13:11.705 27134 INFO nova.virt.libvirt.driver [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Deletion of /var/lib/nova/instances/8595078e-1635-47c3-a027-78436a17f6d4_del complete\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Instance failed to spawn\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Traceback (most recent call last):\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2125, in _build_resources\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     yield resources\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1931, in _build_and_run_instance\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     block_device_info=block_device_info)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2717, in spawn\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     destroy_disks_on_failure=True)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5179, in _create_domain_and_network\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     destroy_disks_on_failure)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     self.force_reraise()\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     six.reraise(self.type_, self.value, self.tb)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5151, in _create_domain_and_network\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     post_xml_callback=post_xml_callback)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5062, in _create_domain\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     guest = libvirt_guest.Guest.create(xml, self._host)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 130, in create\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     encodeutils.safe_decode(xml))\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     self.force_reraise()\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     six.reraise(self.type_, self.value, self.tb)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 126, in create\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     guest = host.write_instance_config(xml)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/host.py\", line 835, in write_instance_config\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     domain = self.get_connection().defineXML(xml)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 186, in doit\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 144, in proxy_call\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     rv = execute(f, *args, **kwargs)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 125, in execute\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     six.reraise(c, e, tb)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 83, in tworker\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     rv = meth(*args, **kwargs)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 3585, in defineXML\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4] libvirtError: operation failed: domain 'testvm' already exists with uuid a2239b07-9811-444f-b77e-96756046e8de\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4] \n2017-08-21 04:13:14.108 27134 INFO nova.compute.manager [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Terminating instance\n2017-08-21 04:13:14.109 27134 WARNING nova.image.glance [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] No protocol specified in for api_server 'http://128.80.0.6:9292', please update [glance] api_servers with fully qualified url including scheme (http / https)\n2017-08-21 04:13:14.329 27134 INFO nova.virt.libvirt.driver [-] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Instance destroyed successfully.\n2017-08-21 04:13:14.332 27134 INFO os_vif [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] Successfully unplugged vif VIFBridge(active=False,address=fa:16:3e:ad:3d:09,bridge_name='brq0f056785-2d',has_traffic_filtering=True,id=a74d54bd-04ab-42e1-bbea-2417f487825c,network=Network(0f056785-2d0a-4742-9517-570dbc427e16),plugin='linux_bridge',port_profile=<?>,preserve_on_delete=False,vif_name='tapa74d54bd-04')\n2017-08-21 04:13:14.359 27134 INFO nova.virt.libvirt.driver [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Deletion of /var/lib/nova/instances/8595078e-1635-47c3-a027-78436a17f6d4_del complete\n2017-08-21 04:13:18.867 27134 WARNING nova.compute.manager [req-eef35b0d-a9a9-44c3-a21e-2cb1fff74224 2d6b9a3227854bfda6ffaca4e1d231b2 843b7144916f44c4adf4cd6290febb51 - - -] [instance: a2239b07-9811-444f-b77e-96756046e8de] Received unexpected event network-vif-unplugged-96e65960-54da-4d41-90b8-23243864d5ba for instance\n2017-08-21 04:13:19.503 27134 INFO nova.compute.manager [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Took 5.39 seconds to destroy the instance on the hypervisor.", 
    "tags": [], 
    "importance": "High", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1712460", 
    "owner": "https://api.launchpad.net/1.0/~wonil22", 
    "id": 1712460, 
    "index": 2131, 
    "created": "2017-08-23 02:32:00.468887+00:00", 
    "title": "nova destroys wrong instance if trying to create a new instance with the same name ", 
    "comments": [
        {
            "content": "\nDescription\n===========\nIf trying to create a new VM instance(let's call vm1) with the same instance name\non the same compute host, old existing VM instance(vm1) is destroyed. And openstack\ndoes not intend such situation so the status of old instance(vm1) is 'ACTIVE'\n\n\nSteps to reproduce\n==================\nA chronological list of steps which will bring off the\nissue you noticed:\n1. create one VM.\n2. check the VM is created.\n3. create another VM on the same host with the same name of the created VM in step 1\n  * In order to make same named instance, we can change nova config like below\n     instance_name_template = %(hostname)s \n4. check the VM exist. openstack has active instance but real VM is not.\n:\n[controller]# nova list\n+--------------------------------------+--------+--------+------------+-------------+----------------------+\n| ID                                   | Name   | Status | Task State | Power State | Networks             |\n+--------------------------------------+--------+--------+------------+-------------+----------------------+\n| 8595078e-1635-47c3-a027-78436a17f6d4 | testvm | ERROR  | -          | NOSTATE     | demo-net=192.168.0.3 |\n| a2239b07-9811-444f-b77e-96756046e8de | testvm | ACTIVE | -          | Running     | demo-net=192.168.0.7 |\n+--------------------------------------+--------+--------+------------+-------------+----------------------+\n[compute1]# virsh list\n Id    Name                           State\n----------------------------------------------------\n\nExpected result\n===============\nold VM instance should be running.\n\nActual result\n=============\nThere is no running VM.\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running. \nTested on Ocata\n\n2. Which hypervisor did you use?\nLibvirt + KVM\n\n\nLogs & Configs\n==============\n# grep instance_name_template /etc/nova/nova.conf \n#instance_name_template=instance-%08x\ninstance_name_template = %(hostname)s\n\n<nova log>\n2017-08-21 04:13:11.692 27134 ERROR nova.virt.libvirt.driver [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Failed to start libvirt guest\n2017-08-21 04:13:11.693 27134 INFO os_vif [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] Successfully unplugged vif VIFBridge(active=False,address=fa:16:3e:ad:3d:09,bridge_name='brq0f056785-2d',has_traffic_filtering=True,id=a74d54bd-04ab-42e1-bbea-2417f487825c,network=Network(0f056785-2d0a-4742-9517-570dbc427e16),plugin='linux_bridge',port_profile=<?>,preserve_on_delete=False,vif_name='tapa74d54bd-04')\n2017-08-21 04:13:11.704 27134 INFO nova.virt.libvirt.driver [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Deleting instance files /var/lib/nova/instances/8595078e-1635-47c3-a027-78436a17f6d4_del\n2017-08-21 04:13:11.705 27134 INFO nova.virt.libvirt.driver [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Deletion of /var/lib/nova/instances/8595078e-1635-47c3-a027-78436a17f6d4_del complete\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Instance failed to spawn\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Traceback (most recent call last):\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2125, in _build_resources\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     yield resources\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1931, in _build_and_run_instance\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     block_device_info=block_device_info)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2717, in spawn\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     destroy_disks_on_failure=True)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5179, in _create_domain_and_network\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     destroy_disks_on_failure)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     self.force_reraise()\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     six.reraise(self.type_, self.value, self.tb)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5151, in _create_domain_and_network\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     post_xml_callback=post_xml_callback)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5062, in _create_domain\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     guest = libvirt_guest.Guest.create(xml, self._host)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 130, in create\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     encodeutils.safe_decode(xml))\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     self.force_reraise()\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     six.reraise(self.type_, self.value, self.tb)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 126, in create\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     guest = host.write_instance_config(xml)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/host.py\", line 835, in write_instance_config\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     domain = self.get_connection().defineXML(xml)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 186, in doit\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 144, in proxy_call\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     rv = execute(f, *args, **kwargs)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 125, in execute\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     six.reraise(c, e, tb)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 83, in tworker\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     rv = meth(*args, **kwargs)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 3585, in defineXML\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4]     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4] libvirtError: operation failed: domain 'testvm' already exists with uuid a2239b07-9811-444f-b77e-96756046e8de\n2017-08-21 04:13:14.105 27134 ERROR nova.compute.manager [instance: 8595078e-1635-47c3-a027-78436a17f6d4] \n2017-08-21 04:13:14.108 27134 INFO nova.compute.manager [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Terminating instance\n2017-08-21 04:13:14.109 27134 WARNING nova.image.glance [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] No protocol specified in for api_server 'http://128.80.0.6:9292', please update [glance] api_servers with fully qualified url including scheme (http / https)\n2017-08-21 04:13:14.329 27134 INFO nova.virt.libvirt.driver [-] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Instance destroyed successfully.\n2017-08-21 04:13:14.332 27134 INFO os_vif [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] Successfully unplugged vif VIFBridge(active=False,address=fa:16:3e:ad:3d:09,bridge_name='brq0f056785-2d',has_traffic_filtering=True,id=a74d54bd-04ab-42e1-bbea-2417f487825c,network=Network(0f056785-2d0a-4742-9517-570dbc427e16),plugin='linux_bridge',port_profile=<?>,preserve_on_delete=False,vif_name='tapa74d54bd-04')\n2017-08-21 04:13:14.359 27134 INFO nova.virt.libvirt.driver [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Deletion of /var/lib/nova/instances/8595078e-1635-47c3-a027-78436a17f6d4_del complete\n2017-08-21 04:13:18.867 27134 WARNING nova.compute.manager [req-eef35b0d-a9a9-44c3-a21e-2cb1fff74224 2d6b9a3227854bfda6ffaca4e1d231b2 843b7144916f44c4adf4cd6290febb51 - - -] [instance: a2239b07-9811-444f-b77e-96756046e8de] Received unexpected event network-vif-unplugged-96e65960-54da-4d41-90b8-23243864d5ba for instance\n2017-08-21 04:13:19.503 27134 INFO nova.compute.manager [req-6cf232cd-f038-4d7f-a04e-b9ade01aac8b b0233bb45334440e9bfdd4f67c77e016 abd313825f44461fbfe3cf493d9b2ea4 - - -] [instance: 8595078e-1635-47c3-a027-78436a17f6d4] Took 5.39 seconds to destroy the instance on the hypervisor.", 
            "date_created": "2017-08-23 02:32:00.468887+00:00", 
            "author": "https://api.launchpad.net/1.0/~wonil22"
        }, 
        {
            "content": "get_domain() calls conn.lookupByName() in nova/virt/libvirt/driver.py\n\nis there any reason to use lookupByUUIDString() instead of lookupByName() ?\n", 
            "date_created": "2017-08-23 03:43:23.776029+00:00", 
            "author": "https://api.launchpad.net/1.0/~wonil22"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/496515", 
            "date_created": "2017-08-23 06:50:47.715907+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I can reproduce the bug with nova(master) with virt_type = qemu.", 
            "date_created": "2017-08-23 08:40:37.186265+00:00", 
            "author": "https://api.launchpad.net/1.0/~tetsuro0907"
        }, 
        {
            "content": "Fix proposed to branch: stable/pike\nReview: https://review.openstack.org/498477", 
            "date_created": "2017-08-28 14:22:23.939404+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/498478", 
            "date_created": "2017-08-28 14:22:56.559309+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/496515\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=ac4705516ada36794c7cc6626875c74c4ef8e547\nSubmitter: Jenkins\nBranch:    master\n\ncommit ac4705516ada36794c7cc6626875c74c4ef8e547\nAuthor: Wonil Choi <email address hidden>\nDate:   Wed Aug 23 15:33:02 2017 +0900\n\n    libvirt: Fix getting a wrong guest object\n    \n    If trying to create a new VM with the same instance name on the same\n    compute host, old existing VM become destroyed. guest object is get by\n    instance name so returned object is existing active instance and it is\n    destroyed. However this destroying is not intended situation. This\n    commit makes get the correct guest object by using UUID.\n    \n    Co-Authored-By: Maciej Kucia <email address hidden>\n    Change-Id: Ic6f81dc1f8b3610e181914f6d977652cb6d3f6d0\n    Closes-Bug: #1712460\n    Signed-off-by: Wonil Choi <email address hidden>\n    Signed-off-by: Maciej Kucia <email address hidden>\n", 
            "date_created": "2017-08-28 19:18:02.407725+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/498477\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=98f0d8162167d1ff6e680adbc622ff7dbadc5a9a\nSubmitter: Jenkins\nBranch:    stable/pike\n\ncommit 98f0d8162167d1ff6e680adbc622ff7dbadc5a9a\nAuthor: Wonil Choi <email address hidden>\nDate:   Wed Aug 23 15:33:02 2017 +0900\n\n    libvirt: Fix getting a wrong guest object\n    \n    If trying to create a new VM with the same instance name on the same\n    compute host, old existing VM become destroyed. guest object is get by\n    instance name so returned object is existing active instance and it is\n    destroyed. However this destroying is not intended situation. This\n    commit makes get the correct guest object by using UUID.\n    \n    Co-Authored-By: Maciej Kucia <email address hidden>\n    Change-Id: Ic6f81dc1f8b3610e181914f6d977652cb6d3f6d0\n    Closes-Bug: #1712460\n    Signed-off-by: Wonil Choi <email address hidden>\n    Signed-off-by: Maciej Kucia <email address hidden>\n    (cherry picked from commit ac4705516ada36794c7cc6626875c74c4ef8e547)\n", 
            "date_created": "2017-09-15 18:05:40.240949+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/498478\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=5fa3f2ce5c7745c592bfefbd591f31db83a85175\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit 5fa3f2ce5c7745c592bfefbd591f31db83a85175\nAuthor: Wonil Choi <email address hidden>\nDate:   Wed Aug 23 15:33:02 2017 +0900\n\n    libvirt: Fix getting a wrong guest object\n    \n    If trying to create a new VM with the same instance name on the same\n    compute host, old existing VM become destroyed. guest object is get by\n    instance name so returned object is existing active instance and it is\n    destroyed. However this destroying is not intended situation. This\n    commit makes get the correct guest object by using UUID.\n    \n    Co-Authored-By: Maciej Kucia <email address hidden>\n    Change-Id: Ic6f81dc1f8b3610e181914f6d977652cb6d3f6d0\n    Closes-Bug: #1712460\n    Signed-off-by: Wonil Choi <email address hidden>\n    Signed-off-by: Maciej Kucia <email address hidden>\n    (cherry picked from commit ac4705516ada36794c7cc6626875c74c4ef8e547)\n    (cherry picked from commit 98f0d8162167d1ff6e680adbc622ff7dbadc5a9a)\n", 
            "date_created": "2017-09-20 01:12:50.418905+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.1 release.", 
            "date_created": "2017-09-25 14:28:25.002989+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}