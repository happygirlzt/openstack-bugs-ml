{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:53:10.038022+00:00", 
    "description": "During spawn  with powervm driver , transfer  image file from  glance server to IVM host may fail in some conditions , like IVM host doesn't have enough disk space . It leaves the garbage file in IVM host , will disturb next spawn  after resovle envrioment  issue ,need clean it .\n\nIn my test case I started an ISO deploy, then while the file was being copied to the IVM I filled up the destination directory to create an out-of-space condition. \nThe ftp transfer failed and the ISO was not deleted:\n-------------------------------------------------------------------------------------------------------\nc25ff88-bcae-4850-bb77-70929f67c0b0.bc0_b01.iso to /home/padmin failed\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator Traceback (most recent call last):\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 618, in _create_image\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     context, instance, image_id)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/decorator.py\", line 25, in wrapper\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     r = f(*args, **kwds)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 152, in create_volume_from_image\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     image_meta)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/decorator.py\", line 25, in wrapper\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     r = f(*args, **kwds)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 242, in inner\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     retval = f(*args, **kwargs)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 252, in _prepare_iso_image_on_host\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     host_dir)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 178, in copy_image_file\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     remote_path)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/common.py\", line 125, in ftp_put_command\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     source_path=local_path, dest_path=remote_dir)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator PowerVMFTPTransferFailed: FTP PUT from /var/lib/nova/images/ac25ff88-bcae-4850-bb77-70929f67c0b0.bc0_b01.iso to /home/padmin failed\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator\n-------------------------------------------------------------------------------------------------------", 
    "tags": [
        "powervm"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1188884", 
    "owner": "https://api.launchpad.net/1.0/~glongwave", 
    "id": 1188884, 
    "index": 5780, 
    "created": "2013-06-08 01:55:04.313795+00:00", 
    "title": "Need clean up  ftp transfer faiure  in powervm driver", 
    "comments": [
        {
            "content": "During spawn  with powervm driver , transfer  image file from  glance server to IVM host may fail in some conditions , like IVM host doesn't have enough disk space . It leaves the garbage file in IVM host , will disturb next spawn  after resovle envrioment  issue ,need clean it .\n\nIn my test case I started an ISO deploy, then while the file was being copied to the IVM I filled up the destination directory to create an out-of-space condition. \nThe ftp transfer failed and the ISO was not deleted:\n-------------------------------------------------------------------------------------------------------\nc25ff88-bcae-4850-bb77-70929f67c0b0.bc0_b01.iso to /home/padmin failed\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator Traceback (most recent call last):\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 618, in _create_image\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     context, instance, image_id)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/decorator.py\", line 25, in wrapper\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     r = f(*args, **kwds)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 152, in create_volume_from_image\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     image_meta)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/decorator.py\", line 25, in wrapper\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     r = f(*args, **kwds)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 242, in inner\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     retval = f(*args, **kwargs)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 252, in _prepare_iso_image_on_host\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     host_dir)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 178, in copy_image_file\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     remote_path)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/common.py\", line 125, in ftp_put_command\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator     source_path=local_path, dest_path=remote_dir)\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator PowerVMFTPTransferFailed: FTP PUT from /var/lib/nova/images/ac25ff88-bcae-4850-bb77-70929f67c0b0.bc0_b01.iso to /home/padmin failed\n2013-06-06 16:43:32.572 18655 TRACE nova.virt.powervm.operator\n-------------------------------------------------------------------------------------------------------", 
            "date_created": "2013-06-08 01:55:04.313795+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/32238", 
            "date_created": "2013-06-08 06:08:11.210022+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "log into IVM host , the image file  transferred with failure has zero size .\n$ ls -l\nrksh: There is not enough space in the file system.\ntotal 2005984\n-rw-r-----    1 padmin   staff             0 Apr 24 08:58 403b460c-0d5a-47ac-bf4f-96753e7b4e9b.ip9_114_23_22.iso\n-rw-r-----    1 padmin   staff             0 Apr 25 03:21 8853af84-f190-4d6e-a6cb-a8511ee32167.ip9_114_23_22.iso", 
            "date_created": "2013-06-09 01:35:18.007864+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/32238\nCommitted: http://github.com/openstack/nova/commit/84b41d944a841bd21cd72d57dd94ccf4810b6433\nSubmitter: Jenkins\nBranch:    master\n\ncommit 84b41d944a841bd21cd72d57dd94ccf4810b6433\nAuthor: Chang Bo Guo <email address hidden>\nDate:   Fri Jun 7 22:23:39 2013 -0700\n\n    Remove junk file when ftp transfer failure\n    \n    During spawn with powervm driver, the image transfer to the IVM host\n    may fail in some conditions, eg. IVM host doesn't have enough disk\n    space. It leaves the junk file in IVM host, and this will disturb\n    next spawn after resolving environment issue, need clean it.\n    \n    Fixes bug #1188884\n    \n    Change-Id: I7b8d719995c2702c89cf55cef5f34bde9d01c1b9\n", 
            "date_created": "2013-07-02 20:48:08.279753+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/35429", 
            "date_created": "2013-07-03 02:54:19.324421+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/35429\nCommitted: http://github.com/openstack/nova/commit/fbde109390f32204f6355d937449f0f54f07ffd7\nSubmitter: Jenkins\nBranch:    stable/grizzly\n\ncommit fbde109390f32204f6355d937449f0f54f07ffd7\nAuthor: Chang Bo Guo <email address hidden>\nDate:   Tue Jul 2 19:47:56 2013 -0700\n\n    Remove junk file when ftp transfer failure\n    \n    During spawn with powervm driver, the image transfer to the IVM host\n    may fail in some conditions, eg. IVM host doesn't have enough disk\n    space. It leaves the junk file in IVM host, and this will disturb\n    next spawn after resolving environment issue, need clean it.\n    \n    Fixes bug #1188884\n    \n    Change-Id: I6347dec4cfda61bed0960159e8a3402fcffa296b\n", 
            "date_created": "2013-07-28 06:50:31.499507+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}