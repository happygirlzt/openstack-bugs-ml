{
    "status": "Fix Released", 
    "last_updated": "2010-10-19 21:51:33.114204+00:00", 
    "description": "I'm trying to follow the steps described in http://github.com/vishvananda/novascript , but I get this error after executing:\n\nroot@openstack:~# euca-run-instances -k test -t m1.tiny ami-tiny\nRESERVATION     r-f0zon4z0      admin\nINSTANCE        i-sl4vx1        ami-tiny        10.0.0.4        10.0.0.4        scheduling      test (admin, None)      0               m1.tiny 2010-10-06 21:23:54\n\nthen I get this message executing euca-describe-instances:\nroot@openstack:~# euca-describe-instances\nRESERVATION     r-f0zon4z0      admin\nINSTANCE        i-sl4vx1        ami-tiny        10.0.0.4        10.0.0.4        shutdown        test (admin, openstack) 0               m1.tiny 2010-10-06 21:23:54\n\nIf I check the nova-compute node then I have this trace in the logs:\n2010-10-06 23:26:21+0200 [-] (root): DEBUG instance 5: starting...\nDEBUG:root:Running cmd: ifconfig vlan100\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: ifconfig vlan100\nDEBUG:root:Running cmd: ifconfig br100\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: ifconfig br100\nDEBUG:root:Running cmd: sudo ifconfig br100 up\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo ifconfig br100 up\nDEBUG:root:Running cmd: sudo iptables --delete FORWARD --in-interface br100 -j ACCEPT\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables --delete FORWARD --in-interface br100 -j ACCEPT\nDEBUG:root:Running cmd: sudo iptables -I FORWARD --in-interface br100 -j ACCEPT\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables -I FORWARD --in-interface br100 -j ACCEPT\nDEBUG:root:Running cmd: sudo iptables --delete FORWARD --out-interface br100 -j ACCEPT\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables --delete FORWARD --out-interface br100 -j ACCEPT\nDEBUG:root:Running cmd: sudo iptables -I FORWARD --out-interface br100 -j ACCEPT\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables -I FORWARD --out-interface br100 -j ACCEPT\nDEBUG:root:instance 435059996: starting toXML method\n2010-10-06 23:26:21+0200 [-] (root): DEBUG instance 435059996: starting toXML method\nERROR:root:instance 435059996: Failed to spawn\nTraceback (most recent call last):\n  File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 86, in run_instance\n    yield self.driver.spawn(instance_ref)\nAttributeError: 'long' object has no attribute 'startswith'\n2010-10-06 23:26:21+0200 [-] (root): ERROR instance 435059996: Failed to spawn\n2010-10-06 23:26:21+0200 [-] Traceback (most recent call last):\n2010-10-06 23:26:21+0200 [-]   File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 86, in run_instance\n2010-10-06 23:26:21+0200 [-]     yield self.driver.spawn(instance_ref)\n2010-10-06 23:26:21+0200 [-] AttributeError: 'long' object has no attribute 'startswith'\n2010-10-06 23:26:21+0200 [-] Unhandled error in Deferred:\n2010-10-06 23:26:21+0200 [-] Unhandled Error\n        Traceback (most recent call last):\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/exception.py\", line 76, in _wrap\n            return f(*args, **kw)\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/rpc.py\", line 171, in receive\n            d = defer.maybeDeferred(node_func, **node_args)\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 117, in maybeDeferred\n            result = f(*args, **kw)\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 944, in unwindGenerator\n            return _inlineCallbacks(None, f(*args, **kwargs), Deferred())\n        --- <exception caught here> ---\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 821, in _inlineCallbacks\n            result = result.throwExceptionIntoGenerator(g)\n          File \"/usr/lib/python2.6/dist-packages/twisted/python/failure.py\", line 338, in throwExceptionIntoGenerator\n            return g.throw(self.type, self.value, self.tb)\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 98, in run_instance\n            self._update_state(context, instance_id)\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 62, in _update_state\n            state = self.driver.get_info(instance_ref.name)['state']\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/virt/libvirt_conn.py\", line 334, in get_info\n            virt_dom = self._conn.lookupByName(instance_name)\n          File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1441, in lookupByName\n            ret = libvirtmod.virDomainLookupByName(self._o, name)\n        exceptions.TypeError: virDomainLookupByName() argument 2 must be string or None, not long\n\nMy environment is a Ubuntu 10.4 Desktop 64 bits with latest updates running inside a VirtualBox 3.2.8. I have configured nova to run with slapd and mysql. Libvirt is configured for qemu.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/656012", 
    "owner": "https://api.launchpad.net/1.0/~alekibango", 
    "id": 656012, 
    "index": 1941, 
    "created": "2010-10-06 21:56:21.898472+00:00", 
    "title": "euca-run-instances fails", 
    "comments": [
        {
            "content": "I'm trying to follow the steps described in http://github.com/vishvananda/novascript , but I get this error after executing:\n\nroot@openstack:~# euca-run-instances -k test -t m1.tiny ami-tiny\nRESERVATION     r-f0zon4z0      admin\nINSTANCE        i-sl4vx1        ami-tiny        10.0.0.4        10.0.0.4        scheduling      test (admin, None)      0               m1.tiny 2010-10-06 21:23:54\n\nthen I get this message executing euca-describe-instances:\nroot@openstack:~# euca-describe-instances\nRESERVATION     r-f0zon4z0      admin\nINSTANCE        i-sl4vx1        ami-tiny        10.0.0.4        10.0.0.4        shutdown        test (admin, openstack) 0               m1.tiny 2010-10-06 21:23:54\n\nIf I check the nova-compute node then I have this trace in the logs:\n2010-10-06 23:26:21+0200 [-] (root): DEBUG instance 5: starting...\nDEBUG:root:Running cmd: ifconfig vlan100\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: ifconfig vlan100\nDEBUG:root:Running cmd: ifconfig br100\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: ifconfig br100\nDEBUG:root:Running cmd: sudo ifconfig br100 up\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo ifconfig br100 up\nDEBUG:root:Running cmd: sudo iptables --delete FORWARD --in-interface br100 -j ACCEPT\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables --delete FORWARD --in-interface br100 -j ACCEPT\nDEBUG:root:Running cmd: sudo iptables -I FORWARD --in-interface br100 -j ACCEPT\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables -I FORWARD --in-interface br100 -j ACCEPT\nDEBUG:root:Running cmd: sudo iptables --delete FORWARD --out-interface br100 -j ACCEPT\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables --delete FORWARD --out-interface br100 -j ACCEPT\nDEBUG:root:Running cmd: sudo iptables -I FORWARD --out-interface br100 -j ACCEPT\n2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables -I FORWARD --out-interface br100 -j ACCEPT\nDEBUG:root:instance 435059996: starting toXML method\n2010-10-06 23:26:21+0200 [-] (root): DEBUG instance 435059996: starting toXML method\nERROR:root:instance 435059996: Failed to spawn\nTraceback (most recent call last):\n  File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 86, in run_instance\n    yield self.driver.spawn(instance_ref)\nAttributeError: 'long' object has no attribute 'startswith'\n2010-10-06 23:26:21+0200 [-] (root): ERROR instance 435059996: Failed to spawn\n2010-10-06 23:26:21+0200 [-] Traceback (most recent call last):\n2010-10-06 23:26:21+0200 [-]   File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 86, in run_instance\n2010-10-06 23:26:21+0200 [-]     yield self.driver.spawn(instance_ref)\n2010-10-06 23:26:21+0200 [-] AttributeError: 'long' object has no attribute 'startswith'\n2010-10-06 23:26:21+0200 [-] Unhandled error in Deferred:\n2010-10-06 23:26:21+0200 [-] Unhandled Error\n        Traceback (most recent call last):\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/exception.py\", line 76, in _wrap\n            return f(*args, **kw)\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/rpc.py\", line 171, in receive\n            d = defer.maybeDeferred(node_func, **node_args)\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 117, in maybeDeferred\n            result = f(*args, **kw)\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 944, in unwindGenerator\n            return _inlineCallbacks(None, f(*args, **kwargs), Deferred())\n        --- <exception caught here> ---\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 821, in _inlineCallbacks\n            result = result.throwExceptionIntoGenerator(g)\n          File \"/usr/lib/python2.6/dist-packages/twisted/python/failure.py\", line 338, in throwExceptionIntoGenerator\n            return g.throw(self.type, self.value, self.tb)\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 98, in run_instance\n            self._update_state(context, instance_id)\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 62, in _update_state\n            state = self.driver.get_info(instance_ref.name)['state']\n          File \"/root/vishvananda-novascript-3ac378c/nova/nova/virt/libvirt_conn.py\", line 334, in get_info\n            virt_dom = self._conn.lookupByName(instance_name)\n          File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1441, in lookupByName\n            ret = libvirtmod.virDomainLookupByName(self._o, name)\n        exceptions.TypeError: virDomainLookupByName() argument 2 must be string or None, not long\n\nMy environment is a Ubuntu 10.4 Desktop 64 bits with latest updates running inside a VirtualBox 3.2.8. I have configured nova to run with slapd and mysql. Libvirt is configured for qemu.", 
            "date_created": "2010-10-06 21:56:21.898472+00:00", 
            "author": "https://api.launchpad.net/1.0/~mika-kohonen-1986"
        }, 
        {
            "content": "qemu/virtualbox is not important -- the bug is there even on real hw\n", 
            "date_created": "2010-10-06 23:24:14.310160+00:00", 
            "author": "https://api.launchpad.net/1.0/~alekibango"
        }, 
        {
            "content": "I cannot reproduce this.  What is the status, and how can it be reproduced?", 
            "date_created": "2010-10-19 17:50:28.144343+00:00", 
            "author": "https://api.launchpad.net/1.0/~dendrobates"
        }, 
        {
            "content": "It does not fail anymore in the trunk.", 
            "date_created": "2010-10-19 21:24:05.331114+00:00", 
            "author": "https://api.launchpad.net/1.0/~mika-kohonen-1986"
        }, 
        {
            "content": "I saw this last week when I was pulling over the instance_id changes ... vishy had a fix in his branch that changed the return type of the name method from long to a string ... following from the logs:\n\n2010-10-07T17:58:51  <kevnfx> vishy: regarding \"startswith\", I'm having the same exception.  Appears that virDomainLookupByName is being passed in a long rather than a string.  Wasn't instance_id recently changed?\n2010-10-07T18:00:07  <vishy> kevnfx: there is a fix posted, it involves changing nova/db/sqlalchemy/models.py\n2010-10-07T18:00:32  <vishy> the name method on instance should return str(self.internal_id)\n2010-10-07T18:00:45  <kevnfx> vishy: cool .. thanks!\n\nThere was  duplicate bug that was being fixed simultaneously, in any case, what I experienced has been fixed.\n\nKev\n\nOn Oct 19, 2010, at 10:50 AM, Rick Clark wrote:\n\n> I cannot reproduce this.  What is the status, and how can it be\n> reproduced?\n> \n> -- \n> euca-run-instances fails\n> https://bugs.launchpad.net/bugs/656012\n> You received this bug notification because you are subscribed to\n> OpenStack.\n> \n> Status in OpenStack Compute (Nova): In Progress\n> \n> Bug description:\n> I'm trying to follow the steps described in http://github.com/vishvananda/novascript , but I get this error after executing:\n> \n> root@openstack:~# euca-run-instances -k test -t m1.tiny ami-tiny\n> RESERVATION     r-f0zon4z0      admin\n> INSTANCE        i-sl4vx1        ami-tiny        10.0.0.4        10.0.0.4        scheduling      test (admin, None)      0               m1.tiny 2010-10-06 21:23:54\n> \n> then I get this message executing euca-describe-instances:\n> root@openstack:~# euca-describe-instances\n> RESERVATION     r-f0zon4z0      admin\n> INSTANCE        i-sl4vx1        ami-tiny        10.0.0.4        10.0.0.4        shutdown        test (admin, openstack) 0               m1.tiny 2010-10-06 21:23:54\n> \n> If I check the nova-compute node then I have this trace in the logs:\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG instance 5: starting...\n> DEBUG:root:Running cmd: ifconfig vlan100\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: ifconfig vlan100\n> DEBUG:root:Running cmd: ifconfig br100\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: ifconfig br100\n> DEBUG:root:Running cmd: sudo ifconfig br100 up\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo ifconfig br100 up\n> DEBUG:root:Running cmd: sudo iptables --delete FORWARD --in-interface br100 -j ACCEPT\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables --delete FORWARD --in-interface br100 -j ACCEPT\n> DEBUG:root:Running cmd: sudo iptables -I FORWARD --in-interface br100 -j ACCEPT\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables -I FORWARD --in-interface br100 -j ACCEPT\n> DEBUG:root:Running cmd: sudo iptables --delete FORWARD --out-interface br100 -j ACCEPT\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables --delete FORWARD --out-interface br100 -j ACCEPT\n> DEBUG:root:Running cmd: sudo iptables -I FORWARD --out-interface br100 -j ACCEPT\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG Running cmd: sudo iptables -I FORWARD --out-interface br100 -j ACCEPT\n> DEBUG:root:instance 435059996: starting toXML method\n> 2010-10-06 23:26:21+0200 [-] (root): DEBUG instance 435059996: starting toXML method\n> ERROR:root:instance 435059996: Failed to spawn\n> Traceback (most recent call last):\n>  File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 86, in run_instance\n>    yield self.driver.spawn(instance_ref)\n> AttributeError: 'long' object has no attribute 'startswith'\n> 2010-10-06 23:26:21+0200 [-] (root): ERROR instance 435059996: Failed to spawn\n> 2010-10-06 23:26:21+0200 [-] Traceback (most recent call last):\n> 2010-10-06 23:26:21+0200 [-]   File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 86, in run_instance\n> 2010-10-06 23:26:21+0200 [-]     yield self.driver.spawn(instance_ref)\n> 2010-10-06 23:26:21+0200 [-] AttributeError: 'long' object has no attribute 'startswith'\n> 2010-10-06 23:26:21+0200 [-] Unhandled error in Deferred:\n> 2010-10-06 23:26:21+0200 [-] Unhandled Error\n>        Traceback (most recent call last):\n>          File \"/root/vishvananda-novascript-3ac378c/nova/nova/exception.py\", line 76, in _wrap\n>            return f(*args, **kw)\n>          File \"/root/vishvananda-novascript-3ac378c/nova/nova/rpc.py\", line 171, in receive\n>            d = defer.maybeDeferred(node_func, **node_args)\n>          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 117, in maybeDeferred\n>            result = f(*args, **kw)\n>          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 944, in unwindGenerator\n>            return _inlineCallbacks(None, f(*args, **kwargs), Deferred())\n>        --- <exception caught here> ---\n>          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 821, in _inlineCallbacks\n>            result = result.throwExceptionIntoGenerator(g)\n>          File \"/usr/lib/python2.6/dist-packages/twisted/python/failure.py\", line 338, in throwExceptionIntoGenerator\n>            return g.throw(self.type, self.value, self.tb)\n>          File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 98, in run_instance\n>            self._update_state(context, instance_id)\n>          File \"/root/vishvananda-novascript-3ac378c/nova/nova/compute/manager.py\", line 62, in _update_state\n>            state = self.driver.get_info(instance_ref.name)['state']\n>          File \"/root/vishvananda-novascript-3ac378c/nova/nova/virt/libvirt_conn.py\", line 334, in get_info\n>            virt_dom = self._conn.lookupByName(instance_name)\n>          File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1441, in lookupByName\n>            ret = libvirtmod.virDomainLookupByName(self._o, name)\n>        exceptions.TypeError: virDomainLookupByName() argument 2 must be string or None, not long\n> \n> My environment is a Ubuntu 10.4 Desktop 64 bits with latest updates running inside a VirtualBox 3.2.8. I have configured nova to run with slapd and mysql. Libvirt is configured for qemu.\n> \n> \n\nKevin Fox \n<email address hidden>\n", 
            "date_created": "2010-10-19 21:48:27+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevnfx"
        }
    ]
}