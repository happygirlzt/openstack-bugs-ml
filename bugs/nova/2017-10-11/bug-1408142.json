{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:23:59.080237+00:00", 
    "description": "If the network interface address has dynamic flag, nova-network fails to start.\nThis is because ip addr command only accept 'dynamic' flag for IPv6 address, but not for IPv4 address.\n\nFor example:\n\n$ ip addr show dev eth0 scope global\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n\u00a0\u00a0\u00a0\u00a0link/ether 52:54:00:00:00:01 brd ff:ff:ff:ff:ff:ff\n\u00a0\u00a0\u00a0\u00a0inet 192.168.0.96/23 brd 192.168.1.255 scope global dynamic eth0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0valid_lft 2225sec preferred_lft 2225sec\n\n$ ip addr del 192.168.0.96/23 brd 192.168.1.255 scope global dynamic eth0 dev eth0\nError: either \"local\" is duplicate, or \"dynamic\" is a garbage.\n\nTo fix this problem, 'dynamic' should be omitted.\nNote that, this issue is triaged in LinuxBridgeInterfaceDriver.ensure_bridge(), but not in initialize_gateway_device().\n\nException thrown in startup (or first instance's boot):\n\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 455, in fire_timers\n\u00a0\u00a0\u00a0\u00a0timer()\n\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 58, in __call__\n\u00a0\u00a0\u00a0\u00a0cb(*args, **kw)\n\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 212, in main\n\u00a0\u00a0\u00a0\u00a0result = function(*args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/service.py\", line 492, in run_service\n\u00a0\u00a0\u00a0\u00a0service.start()\n\u00a0\u00a0File \"/opt/stack/nova/nova/service.py\", line 164, in start\n\u00a0\u00a0\u00a0\u00a0self.manager.init_host()\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/manager.py\", line 1815, in init_host\n\u00a0\u00a0\u00a0\u00a0super(FlatDHCPManager, self).init_host()\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/manager.py\", line 330, in init_host\n\u00a0\u00a0\u00a0\u00a0self._setup_network_on_host(ctxt, network)\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/manager.py\", line 1824, in _setup_network_on_host\n\u00a0\u00a0\u00a0\u00a0self._initialize_network(network)\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/manager.py\", line 1488, in _initialize_network\n\u00a0\u00a0\u00a0\u00a0self.l3driver.initialize_gateway(network)\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/l3.py\", line 106, in initialize_gateway\n\u00a0\u00a0\u00a0\u00a0linux_net.initialize_gateway_device(dev, network_ref)\n\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 431, in inner\n\u00a0\u00a0\u00a0\u00a0return f(*args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/linux_net.py\", line 885, in initialize_gateway_device\n\u00a0\u00a0\u00a0\u00a0run_as_root=True, check_exit_code=[0, 2, 254])\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/linux_net.py\", line 1247, in _execute\n\u00a0\u00a0\u00a0\u00a0return utils.execute(*cmd, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/utils.py\", line 164, in execute\n\u00a0\u00a0\u00a0\u00a0return processutils.execute(*cmd, **kwargs)\n\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n\u00a0\u00a0\u00a0\u00a0cmd=sanitized_cmd)\nProcessExecutionError: Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf ip addr del 192.168.123.1/23 brd 192.168.124.255 scope global dynamic dev br100\nExit code: 255\nStdout: u''\nStderr: u'Error: either \"local\" is duplicate, or \"dynamic\" is a garbage.\\n'", 
    "tags": [
        "network"
    ], 
    "importance": "Low", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1408142", 
    "owner": "https://api.launchpad.net/1.0/~tsekiyama", 
    "id": 1408142, 
    "index": 211, 
    "created": "2015-01-06 22:52:32.805511+00:00", 
    "title": "nova-network fails to initialize gateway device if the interface address has 'dynamic' flag", 
    "comments": [
        {
            "content": "If the network interface address has dynamic flag, nova-network fails to start.\nThis is because ip addr command only accept 'dynamic' flag for IPv6 address, but not for IPv4 address.\n\nFor example:\n\n$ ip addr show dev eth0 scope global\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:00:00:01 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.96/23 brd 192.168.1.255 scope global dynamic eth0\n       valid_lft 2225sec preferred_lft 2225sec\n\n$ ip addr del 192.168.0.96/23 brd 192.168.1.255 scope global dynamic eth0 dev eth0\nError: either \"local\" is duplicate, or \"dynamic\" is a garbage.\n\nTo fix this problem, 'dynamic' should be omitted.\nNote that, this issue is triaged in LinuxBridgeInterfaceDriver.ensure_bridge(), but not in initialize_gateway_device().\n\n\nException thrown in startup (or first instance's boot):\n\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 455, in fire_timers\n    timer()\n  File \"/usr/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 58, in __call__\n    cb(*args, **kw)\n  File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 212, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/openstack/common/service.py\", line 492, in run_service\n    service.start()\n  File \"/opt/stack/nova/nova/service.py\", line 164, in start\n    self.manager.init_host() \n  File \"/opt/stack/nova/nova/network/manager.py\", line 1815, in init_host\n    super(FlatDHCPManager, self).init_host()\n  File \"/opt/stack/nova/nova/network/manager.py\", line 330, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/opt/stack/nova/nova/network/manager.py\", line 1824, in _setup_network_on_host\n    self._initialize_network(network)\n  File \"/opt/stack/nova/nova/network/manager.py\", line 1488, in _initialize_network\n    self.l3driver.initialize_gateway(network)\n  File \"/opt/stack/nova/nova/network/l3.py\", line 106, in initialize_gateway\n    linux_net.initialize_gateway_device(dev, network_ref)\n  File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 431, in inner\n    return f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/network/linux_net.py\", line 885, in initialize_gateway_device\n    run_as_root=True, check_exit_code=[0, 2, 254])\n  File \"/opt/stack/nova/nova/network/linux_net.py\", line 1247, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/opt/stack/nova/nova/utils.py\", line 164, in execute\n    return processutils.execute(*cmd, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n    cmd=sanitized_cmd)\nProcessExecutionError: Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf ip addr del 10.18.17.90/23 brd 10.18.17.255 scope global dy\nnamic dev br100\nExit code: 255\nStdout: u''\nStderr: u'Error: either \"local\" is duplicate, or \"dynamic\" is a garbage.\\n'", 
            "date_created": "2015-01-06 22:52:32.805511+00:00", 
            "author": "https://api.launchpad.net/1.0/~tsekiyama"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/145378", 
            "date_created": "2015-01-06 23:34:46.959650+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/145378\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=40661b11a8e1cbb843b996ec48925b24bb53001c\nSubmitter: Jenkins\nBranch:    master\n\ncommit 40661b11a8e1cbb843b996ec48925b24bb53001c\nAuthor: Tomoki Sekiyama <email address hidden>\nDate:   Tue Jan 6 17:57:29 2015 -0500\n\n    Ignore 'dynamic' addr flag on gateway initialization\n    \n    When initializing the gateway device, if 'dynamic' flag is present\n    but not ignored, the 'ip addr del' command will fail and nova-network\n    will fail to startup.\n    In LinuxBridgeInterfaceDriver, it is correctly ignored.\n    This adds the same handling of flags in initialize_gateway_device.\n    \n    Change-Id: Id03e9659a5bec549d6b119cd0ced595875baf0c9\n    Closes-Bug: #1408142\n    Related-Bug: #1274611\n", 
            "date_created": "2015-02-25 02:41:24.242912+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}