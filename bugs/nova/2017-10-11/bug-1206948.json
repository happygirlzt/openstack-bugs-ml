{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:59:03.783954+00:00", 
    "description": "After running install_os_domU.sh (described on https://github.com/openstack-dev/devstack/blob/master/tools/xen/README.md) I receive the following error(s) when starting nova-compute. Since I am absolutely new to python I cannot fix it by myself. The only thing I can report is: when I edit /opt/stack/nova/nova/utils.py and replace the last line (1164) with \"return 1\" nova-compute works and connects to my controller node. But then I can't successfully create virtual machines on this xenserver node.\n\n2013-07-31 14:51:38.658 DEBUG nova.virt.xenapi.host [-] Updating host stats from (pid=1061) update_status /opt/stack/nova/nova/virt/xenapi/host.py:149\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/poll.py\", line 97, in wait\n    readers.get(fileno, noop).cb(fileno)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/openstack/common/service.py\", line 65, in run_service\n    service.start()\n  File \"/opt/stack/nova/nova/service.py\", line 174, in start\n    self.manager.pre_start_hook(rpc_connection=self.conn)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 786, in pre_start_hook\n    self.update_available_resource(nova.context.get_admin_context())\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 4608, in update_available_resource\n    rt.update_available_resource(context)\n  File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n    return f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 259, in update_available_resource\n    resources = self.driver.get_available_resource(self.nodename)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 402, in get_available_resource\n    hyper_ver = utils.convert_version_to_int(self._session.product_version)\n  File \"/opt/stack/nova/nova/utils.py\", line 1164, in convert_version_to_int\n    return version[0] * 1000000 + version[1] * 1000 + version[2]\nTypeError: 'NoneType' object has no attribute '__getitem__'\nRemoving descriptor: 5\n2013-07-31 14:51:38.995 ERROR nova.openstack.common.threadgroup [-] 'NoneType' object has no attribute '__getitem__'\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 117, in wait\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     x.wait()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 49, in wait\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/service.py\", line 65, in run_service\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     service.start()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 174, in start\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook(rpc_connection=self.conn)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 786, in pre_start_hook\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 4608, in update_available_resource\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 259, in update_available_resource\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     resources = self.driver.get_available_resource(self.nodename)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 402, in get_available_resource\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     hyper_ver = utils.convert_version_to_int(self._session.product_version)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/utils.py\", line 1164, in convert_version_to_int\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return version[0] * 1000000 + version[1] * 1000 + version[2]\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup TypeError: 'NoneType' object has no attribute '__getitem__'\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup \n2013-07-31 14:51:38.997 DEBUG amqp [-] Closed channel #1 from (pid=1061) _do_close /usr/local/lib/python2.7/dist-packages/amqp/channel.py:88\n2013-07-31 14:51:39.032 DEBUG amqp [-] Closed channel #1 from (pid=1061) _do_close /usr/local/lib/python2.7/dist-packages/amqp/channel.py:88", 
    "tags": [
        "xenserver"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1206948", 
    "owner": "https://api.launchpad.net/1.0/~bob-ball", 
    "id": 1206948, 
    "index": 3508, 
    "created": "2013-07-31 15:01:42.698299+00:00", 
    "title": "TypeError: 'NoneType' object has no attribute '__getitem__'", 
    "comments": [
        {
            "content": "After running install_os_domU.sh (described on https://github.com/openstack-dev/devstack/blob/master/tools/xen/README.md) I receive the following error(s) when starting nova-compute. Since I am absolutely new to python I cannot fix it by myself. The only thing I can report is: when I edit /opt/stack/nova/nova/utils.py and replace the last line (1164) with \"return 1\" nova-compute works and connects to my controller node. But then I can't successfully create virtual machines on this xenserver node.\n\n2013-07-31 14:51:38.658 DEBUG nova.virt.xenapi.host [-] Updating host stats from (pid=1061) update_status /opt/stack/nova/nova/virt/xenapi/host.py:149\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/poll.py\", line 97, in wait\n    readers.get(fileno, noop).cb(fileno)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/openstack/common/service.py\", line 65, in run_service\n    service.start()\n  File \"/opt/stack/nova/nova/service.py\", line 174, in start\n    self.manager.pre_start_hook(rpc_connection=self.conn)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 786, in pre_start_hook\n    self.update_available_resource(nova.context.get_admin_context())\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 4608, in update_available_resource\n    rt.update_available_resource(context)\n  File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n    return f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 259, in update_available_resource\n    resources = self.driver.get_available_resource(self.nodename)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 402, in get_available_resource\n    hyper_ver = utils.convert_version_to_int(self._session.product_version)\n  File \"/opt/stack/nova/nova/utils.py\", line 1164, in convert_version_to_int\n    return version[0] * 1000000 + version[1] * 1000 + version[2]\nTypeError: 'NoneType' object has no attribute '__getitem__'\nRemoving descriptor: 5\n2013-07-31 14:51:38.995 ERROR nova.openstack.common.threadgroup [-] 'NoneType' object has no attribute '__getitem__'\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 117, in wait\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     x.wait()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 49, in wait\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/service.py\", line 65, in run_service\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     service.start()\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 174, in start\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook(rpc_connection=self.conn)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 786, in pre_start_hook\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 4608, in update_available_resource\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 259, in update_available_resource\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     resources = self.driver.get_available_resource(self.nodename)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 402, in get_available_resource\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     hyper_ver = utils.convert_version_to_int(self._session.product_version)\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/utils.py\", line 1164, in convert_version_to_int\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup     return version[0] * 1000000 + version[1] * 1000 + version[2]\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup TypeError: 'NoneType' object has no attribute '__getitem__'\n2013-07-31 14:51:38.995 TRACE nova.openstack.common.threadgroup \n2013-07-31 14:51:38.997 DEBUG amqp [-] Closed channel #1 from (pid=1061) _do_close /usr/local/lib/python2.7/dist-packages/amqp/channel.py:88\n2013-07-31 14:51:39.032 DEBUG amqp [-] Closed channel #1 from (pid=1061) _do_close /usr/local/lib/python2.7/dist-packages/amqp/channel.py:88", 
            "date_created": "2013-07-31 15:01:42.698299+00:00", 
            "author": "https://api.launchpad.net/1.0/~philipp-noack-b"
        }, 
        {
            "content": "Looks like the xenapi driver is unable to get the product version from the host and when that happens there is no warning logged or anything, None is just returned:\n\nhttps://github.com/openstack/nova/blob/master/nova/virt/xenapi/driver.py#L688\n\nThat sets the var that is passed to utils.convert_version_to_int.\n\nI'm not sure why the driver can't get the product version from the host since I don't know much about the xenapi driver.", 
            "date_created": "2013-08-03 18:17:27.545781+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "What version of xenserver was this? Or was this with xenserver-core?  We have seen this with the 0.3.0 version of xenserver-core but this has been fixed internally to report a version.\n\nIf this was on a stock xenserver and not xenserver-core, then check \"xe host-list params=all\" and paste the \"software-version\" key from that output (or the whole output) - this is where the version is derived from.", 
            "date_created": "2013-08-03 18:36:43.988628+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }, 
        {
            "content": "I think in a longer term, we would need to review where this version information is used. We had issues with the version string in the past, it's time to review if the functionality is really needed:\n\n  fool me once, shame on you, fool me twice, shame on me\n\n", 
            "date_created": "2013-08-05 08:52:45.308290+00:00", 
            "author": "https://api.launchpad.net/1.0/~mate-lakat"
        }, 
        {
            "content": "it just been added, because its needed for checking which tools version are installed an instance, and filtering hosts to a list of compatible ones.", 
            "date_created": "2013-08-07 15:36:46.432808+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Maybe its a version of XenAPI that doesn't report a good version, what are you using this with?", 
            "date_created": "2013-08-07 15:37:41.740399+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "The error occured under ubuntu server 12.04.2 LTS, xen-hypervisor-4.1-amd64 and xcp-xapi 1.3.2-5ubuntu0.1. \n\nsoftware-version (MRO): platform_name: XCP_Kronos; platform_version: 1.6.0; build_number: 0; hostname: komainu; date: 2012-08-03; xapi: 1.3; xen: 4.1.2; linux: 3.2.0-51-generic; xencenter_min: 1.10; xencenter_max: 1.10; network_backend: bridge\n\n", 
            "date_created": "2013-08-07 15:52:32.759797+00:00", 
            "author": "https://api.launchpad.net/1.0/~philipp-noack-b"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/42144\nCommitted: http://github.com/openstack/nova/commit/41fe1978abf01154b676b1979f3858972027faa4\nSubmitter: Jenkins\nBranch:    master\n\ncommit 41fe1978abf01154b676b1979f3858972027faa4\nAuthor: Bob Ball <email address hidden>\nDate:   Tue Aug 13 15:09:33 2013 +0100\n\n    XenAPI: Return platform_version if no product_version\n    \n    Nova now requires a version to be set.  In the case of xapi-XCP/xenserver-core\n    no product_version exists, so use the platform_version instead.\n    \n    Fixes bug 1206948\n    \n    Change-Id: I4d6008216075716c8b969493b7a2ccb7713f755d\n", 
            "date_created": "2013-08-23 21:47:44.690251+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}