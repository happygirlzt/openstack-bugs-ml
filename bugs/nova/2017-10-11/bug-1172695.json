{
    "status": "Won't Fix", 
    "last_updated": "2014-08-21 10:34:25.203465+00:00", 
    "description": "When deleting an Instance with attached volume, it stuck in ACTIVE/deleting status if detach volume failure.\n\nTo reproduce:\n1. boot an instance and attach a volume.\n2. stop cinder-api\n3. delete the instance\n4. instance stuck in ACTIVE/deleting\n\nTraceback:\n2013-04-25 20:13:58.348 ERROR nova.openstack.common.rpc.amqp [req-14043ff3-79d0-4c6c-9394-9ac8f53c84d5 1458120d63784bb49858437c275dc59e 7dd8607e7d294efc845ccf68f8d282b7] Exception during message handling\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 117, in wrapped\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 94, in wrapped\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 260, in decorated_function\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 237, in decorated_function\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 224, in decorated_function\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1383, in terminate_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     do_terminate_instance(instance, bdms)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 242, in inner\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     retval = f(*args, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1375, in do_terminate_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     reservations=reservations)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/hooks.py\", line 85, in inner\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     rv = f(*args, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1338, in _delete_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     project_id=project_id)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1311, in _delete_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self._shutdown_instance(context, instance, bdms)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1259, in _shutdown_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     volume = self.volume_api.get(context, bdm['volume_id'])\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 193, in get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self._reraise_translated_volume_exception(volume_id)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 190, in get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     item = cinderclient(context).volumes.get(volume_id)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/v1/volumes.py\", line 164, in get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return self._get(\"/volumes/%s\" % volume_id, \"volume\")\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/base.py\", line 141, in _get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     resp, body = self.api.client.get(url)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/client.py\", line 189, in get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return self._cs_request(url, 'GET', **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/client.py\", line 157, in _cs_request\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/client.py\", line 127, in request\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/requests/api.py\", line 40, in request\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return s.request(method=method, url=url, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/requests/sessions.py\", line 229, in request\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     r.send(prefetch=prefetch)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/requests/models.py\", line 605, in send\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     raise ConnectionError(e)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp ConnectionError: HTTPConnectionPool(host='127.0.0.1', port=8776): Max retries exceeded with url: /v1/7dd8607e7d294efc845ccf68f8d282b7/volumes/71e67805-8380-4971-952f-9091997b3a6b\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp\n\n\nWhen exception is raised during detaching volume then the instance stuck in ACTIVE(deleting). The instance should probably go to ERROR.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1172695", 
    "owner": "None", 
    "id": 1172695, 
    "index": 3603, 
    "created": "2013-04-25 12:36:41.268826+00:00", 
    "title": "Instance stuck in ACTIVE/deleting if detach volume failure", 
    "comments": [
        {
            "content": "When deleting an Instance with attached volume, it stuck in ACTIVE/deleting status if detach volume failure.\n\nTo reproduce:\n1. boot an instance and attach a volume.\n2. stop cinder-api\n3. delete the instance\n4. instance stuck in ACTIVE/deleting\n\nTraceback:\n2013-04-25 20:13:58.348 ERROR nova.openstack.common.rpc.amqp [req-14043ff3-79d0-4c6c-9394-9ac8f53c84d5 1458120d63784bb49858437c275dc59e 7dd8607e7d294efc845ccf68f8d282b7] Exception during message handling\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 117, in wrapped\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 94, in wrapped\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 260, in decorated_function\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 237, in decorated_function\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 224, in decorated_function\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1383, in terminate_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     do_terminate_instance(instance, bdms)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 242, in inner\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     retval = f(*args, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1375, in do_terminate_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     reservations=reservations)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/hooks.py\", line 85, in inner\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     rv = f(*args, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1338, in _delete_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     project_id=project_id)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1311, in _delete_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self._shutdown_instance(context, instance, bdms)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1259, in _shutdown_instance\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     volume = self.volume_api.get(context, bdm['volume_id'])\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 193, in get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     self._reraise_translated_volume_exception(volume_id)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\", line 190, in get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     item = cinderclient(context).volumes.get(volume_id)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/v1/volumes.py\", line 164, in get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return self._get(\"/volumes/%s\" % volume_id, \"volume\")\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/base.py\", line 141, in _get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     resp, body = self.api.client.get(url)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/client.py\", line 189, in get\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return self._cs_request(url, 'GET', **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/client.py\", line 157, in _cs_request\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/cinderclient/client.py\", line 127, in request\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/requests/api.py\", line 40, in request\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     return s.request(method=method, url=url, **kwargs)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/requests/sessions.py\", line 229, in request\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     r.send(prefetch=prefetch)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/requests/models.py\", line 605, in send\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp     raise ConnectionError(e)\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp ConnectionError: HTTPConnectionPool(host='127.0.0.1', port=8776): Max retries exceeded with url: /v1/7dd8607e7d294efc845ccf68f8d282b7/volumes/71e67805-8380-4971-952f-9091997b3a6b\n2013-04-25 20:13:58.348 18464 TRACE nova.openstack.common.rpc.amqp\n\n\nWhen exception is raised during detaching volume then the instance stuck in ACTIVE(deleting). The instance should probably go to ERROR.", 
            "date_created": "2013-04-25 12:36:41.268826+00:00", 
            "author": "https://api.launchpad.net/1.0/~motokentsai"
        }, 
        {
            "content": "This stuck can be reproduced in master.\nIn my case, it is ERROR/deleting.\nIn either case, stuck and can't be deleted with delete\ncommand is big problem.", 
            "date_created": "2014-05-09 05:39:10.714156+00:00", 
            "author": "https://api.launchpad.net/1.0/~h-tanizawa"
        }, 
        {
            "content": "Hi MotoKen,\n\nI'm curious about this error.\nI couldn't reproduce on my environment.\nDo you know there is any specific situation to face it ?\n\nThanks.", 
            "date_created": "2014-07-14 06:08:56.888129+00:00", 
            "author": "https://api.launchpad.net/1.0/~yoshiaki-kousaka"
        }, 
        {
            "content": "I could not reproduce this problem anymore.\nI guess this is fixed by this bug report https://bugs.launchpad.net/nova/+bug/1332198 .\nMotoken(or any other ATC), if you see same as me, it would be nice to be closed :)", 
            "date_created": "2014-07-16 01:51:59.048971+00:00", 
            "author": "https://api.launchpad.net/1.0/~h-tanizawa"
        }, 
        {
            "content": "The instance will become ERROR now in my Icehouse environment.", 
            "date_created": "2014-07-17 12:46:44.571407+00:00", 
            "author": "https://api.launchpad.net/1.0/~motokentsai"
        }, 
        {
            "content": "I'm going to mark this as Won't Fix as the submitter has confirmed this is no longer an issue in icehouse (thanks MotoKen!).", 
            "date_created": "2014-08-08 18:40:20.699069+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }, 
        {
            "content": "This bug has been fixed by the following bug report.\n\nFailure to power off a VM during delete leads to it going back to Active(None)\nhttps://bugs.launchpad.net/nova/+bug/1254122\n\nCannot delete an instance that failed a previous delete\nhttps://bugs.launchpad.net/nova/+bug/1329559\n", 
            "date_created": "2014-08-21 10:34:23.537291+00:00", 
            "author": "https://api.launchpad.net/1.0/~natsume-takashi"
        }
    ]
}