{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:46:57.032980+00:00", 
    "description": "I tried the following on VMware using the VMwareVCDriver with nova-network:\n\n1. Create an instance\n\n2. Create a floating IP: $ nova floating-ip-create\n\n3. Associate a floating IP with the instance: $ nova floating-ip-associate test1 10.131.254.249\n\n4. Attempt a list of the floating IPs:\n$ nova floating-ip-list\nERROR (ClientException): The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-dcb17077-c670-4e2a-8a34-715a8afc5f33)\n\n\nIt failed and printed out the following messages in n-api logs:\n\n2014-08-12 13:54:29.578 ERROR nova.api.openstack [req-86d8f466-cfae-42ac-8340-9eac36d6fc71 demo demo] Caught error: Cannot load 'instance' in the base class\n2014-08-12 13:54:29.578 TRACE nova.api.openstack Traceback (most recent call last):\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 124, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return req.get_response(self.application)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     application, catch_exc_info=False)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 565, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return self._app(env, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 908, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     content_type, body, accept)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 974, in _process_stack\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1058, in dispatch\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return method(req=request, **action_args)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/floating_ips.py\", line 146, in index\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     self._normalize_ip(floating_ip)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/floating_ips.py\", line 117, in _normalize_ip\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     floating_ip['instance'] = fixed_ip['instance']\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 447, in __getitem__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return getattr(self, name)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 67, in getter\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     self.obj_load_attr(name)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 375, in obj_load_attr\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     _(\"Cannot load '%s' in the base class\") % attrname)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack NotImplementedError: Cannot load 'instance' in the base class\n2014-08-12 13:54:29.579 INFO nova.api.openstack [req-86d8f466-cfae-42ac-8340-9eac36d6fc71 demo demo] http://10.131.179.211:8774/v2/875c3f62ef75400487e4a68679f8e239/os-floating-ips returned with HTTP 500\n2014-08-12 13:54:29.580 DEBUG nova.api.openstack.wsgi [req-86d8f466-cfae-42ac-8340-9eac36d6fc71 demo demo] Returning 500 to user: The server has either erred or is incapable of performing the requested operation. from (pid=12246) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1200", 
    "tags": [
        "api", 
        "network", 
        "vmware"
    ], 
    "importance": "High", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1356051", 
    "owner": "https://api.launchpad.net/1.0/~thang-pham", 
    "id": 1356051, 
    "index": 1562, 
    "created": "2014-08-12 20:50:42.293514+00:00", 
    "title": "Cannot load 'instance' in the base class - problem in floating-ip-list", 
    "comments": [
        {
            "content": "I tried the following on VMware using the VMwareVCDriver with nova-network:\n\n1. Create an instance\n2. Create and associate a floating IP with the instance\n\nIt failed and printed out the following messages in n-api logs:\n\n2014-08-12 13:54:29.578 ERROR nova.api.openstack [req-86d8f466-cfae-42ac-8340-9eac36d6fc71 demo demo] Caught error: Cannot load 'instance' in the base class\n2014-08-12 13:54:29.578 TRACE nova.api.openstack Traceback (most recent call last):\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 124, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return req.get_response(self.application)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     application, catch_exc_info=False)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 565, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return self._app(env, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return resp(environ, start_response)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 908, in __call__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     content_type, body, accept)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 974, in _process_stack\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1058, in dispatch\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return method(req=request, **action_args)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/floating_ips.py\", line 146, in index\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     self._normalize_ip(floating_ip)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/floating_ips.py\", line 117, in _normalize_ip\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     floating_ip['instance'] = fixed_ip['instance']\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 447, in __getitem__\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     return getattr(self, name)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 67, in getter\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     self.obj_load_attr(name)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 375, in obj_load_attr\n2014-08-12 13:54:29.578 TRACE nova.api.openstack     _(\"Cannot load '%s' in the base class\") % attrname)\n2014-08-12 13:54:29.578 TRACE nova.api.openstack NotImplementedError: Cannot load 'instance' in the base class\n2014-08-12 13:54:29.579 INFO nova.api.openstack [req-86d8f466-cfae-42ac-8340-9eac36d6fc71 demo demo] http://10.131.179.211:8774/v2/875c3f62ef75400487e4a68679f8e239/os-floating-ips returned with HTTP 500\n2014-08-12 13:54:29.580 DEBUG nova.api.openstack.wsgi [req-86d8f466-cfae-42ac-8340-9eac36d6fc71 demo demo] Returning 500 to user: The server has either erred or is incapable of performing the requested operation. from (pid=12246) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1200\n\n\nWith the switch to using FloatingIP objects, it is not longer necessary to call _normalize_ip in nova/api/openstack/compute/contrib/floating_ips.py.  The updated code in nova/network/floating_ips.py and nova/api/openstack/compute/contrib/floating_ips.py has logic to get the instance associated with the floating IP, i.e. get_instance_by_floating_ip_addr.", 
            "date_created": "2014-08-12 20:50:42.293514+00:00", 
            "author": "https://api.launchpad.net/1.0/~thang-pham"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/113981", 
            "date_created": "2014-08-13 17:48:20.717330+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I've been able to recreate the problem with KVM + Nova network as well", 
            "date_created": "2014-08-13 23:16:31.493941+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "FYI I'm also running into this as well using devstack master as my nodepool provider (https://github.com/openstack-infra/nodepool).\n\nNodepool stack trace is:\n\n2014-08-21 00:46:19,529 ERROR nodepool.ProviderManager: Unable to get IP details for server f8eb992f-7db9-4566-b993-fceb59a73525, will retry\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/nodepool/provider_manager.py\", line 476, in addPublicIP\n    newip = self.getFloatingIP(ip['id'])\n  File \"/usr/local/lib/python2.7/dist-packages/nodepool/provider_manager.py\", line 405, in getFloatingIP\n    return self.submitTask(GetFloatingIPTask(ip_id=ip_id))\n  File \"/usr/local/lib/python2.7/dist-packages/nodepool/task_manager.py\", line 98, in submitTask\n    return task.wait()\n  File \"/usr/local/lib/python2.7/dist-packages/nodepool/task_manager.py\", line 51, in run\n    self.done(self.main(client))\n  File \"/usr/local/lib/python2.7/dist-packages/nodepool/provider_manager.py\", line 153, in main\n    ip = client.floating_ips.get(self.args['ip_id'])\n  File \"/usr/local/lib/python2.7/dist-packages/novaclient/v1_1/floating_ips.py\", line 59, in get\n    \"floating_ip\")\n  File \"/usr/local/lib/python2.7/dist-packages/novaclient/base.py\", line 93, in _get\n    _resp, body = self.api.client.get(url)\n  File \"/usr/local/lib/python2.7/dist-packages/novaclient/client.py\", line 482, in get\n    return self._cs_request(url, 'GET', **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/novaclient/client.py\", line 459, in _cs_request\n    **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/novaclient/client.py\", line 441, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/novaclient/client.py\", line 435, in request\n    raise exceptions.from_response(resp, body, url, method)\nClientException: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-7618e5e0-4469-4474-a83f-e22905f56d60)\n\n\n", 
            "date_created": "2014-08-21 00:51:45.088030+00:00", 
            "author": "https://api.launchpad.net/1.0/~ramy-asselin"
        }, 
        {
            "content": "Thang Pham, if there's a workaround, any (e.g. go back to nova revision XYZ), or a patch set submitted, please let me know.  Thanks.", 
            "date_created": "2014-08-21 00:58:44.115818+00:00", 
            "author": "https://api.launchpad.net/1.0/~ramy-asselin"
        }, 
        {
            "content": "Ramy Asselin: Patch set can be found here - https://review.openstack.org/#/c/113981/", 
            "date_created": "2014-08-21 01:04:53.480394+00:00", 
            "author": "https://api.launchpad.net/1.0/~thang-pham"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/113981\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=6c085e1d6652df013ec176d46ffb234065373193\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6c085e1d6652df013ec176d46ffb234065373193\nAuthor: Thang Pham <email address hidden>\nDate:   Wed Aug 13 11:33:34 2014 -0400\n\n    Fix NotImplementedError in floating-ip-list\n    \n    A list of existing floating IP (nova floating-ip-list) fails\n    when using VMwareVCDriver/LibvirtDriver and nova-network.\n    The following error is thrown: \"NotImplementedError: Cannot load\n    'instance' in the base class\". The problem is caused by\n    _normalize_ip, which tries to set an 'instance' field in\n    FloatingIP that is needed by _translate_floating_ip_view. The\n    instance is derived from the FixedIP that is assigned to the\n    'fixed_ip' field in FloatingIP. However, FixedIP may not have\n    an 'instance' field set, which can cause the NotImplementedError.\n    \n    The following patch removes _normalize_ip and assigns the\n    'instance_id' required by _translate_floating_ip_view to\n    the 'instance_uuid' in FixedIP, since only the instance ID\n    is required and not the entire instance object.\n    \n    Change-Id: I2d7937e969bd87e53557842a22f3861f0d307b5e\n    Closes-Bug: #1356051\n", 
            "date_created": "2014-08-27 08:59:44.660180+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "we have bug in horizon https://bugs.launchpad.net/horizon/+bug/1361708", 
            "date_created": "2014-08-30 00:48:42.729721+00:00", 
            "author": "https://api.launchpad.net/1.0/~gloria-gu"
        }
    ]
}