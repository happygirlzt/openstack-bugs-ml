{
    "status": "Invalid", 
    "last_updated": "2012-12-13 10:55:56.800105+00:00", 
    "description": "This issue was discovered during Tempest test runs. When creating a flavor, an arbitrary flavor id can be provided. I've noticed that if I create a flavor with some flavorid, delete it, and then try to create a new flavor with the same flavorid, I get a response like the following. This was allowed until just recently:\n\n{u'conflictingRequest': {u'message': u'Instance Type flavor17374920137 already exists.', u'code': 409}}\n\n\nHere's an example test run with this failure:\nhttps://jenkins.openstack.org/job/gate-tempest-devstack-vm/9429/console", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1042539", 
    "owner": "https://api.launchpad.net/1.0/~russellb", 
    "id": 1042539, 
    "index": 3024, 
    "created": "2012-08-28 05:20:58.195121+00:00", 
    "title": "Unique constraint for Flavorid field of instance_types is triggered when creating flavor with same flavorid as a deleted flavor", 
    "comments": [
        {
            "content": "This issue was discovered during Tempest test runs. When creating a flavor, an arbitrary flavor id can be provided. I've noticed that if I create a flavor with some flavorid, delete it, and then try to create a new flavor with the same flavorid, I get a response like the following. This was allowed until just recently:\n\n{u'conflictingRequest': {u'message': u'Instance Type flavor17374920137 already exists.', u'code': 409}}\n\n\nHere's an example test run with this failure:\nhttps://jenkins.openstack.org/job/gate-tempest-devstack-vm/9429/console", 
            "date_created": "2012-08-28 05:20:58.195121+00:00", 
            "author": "https://api.launchpad.net/1.0/~dwalleck"
        }, 
        {
            "content": "I've tried reproducing this according to the steps you described but it worked for me (devstack, recent master):\n\n$ nova-manage flavor create --name=test1 --memory=512 --cpu=1 --root_gb=0 --ephemeral_gb=0 --flavor=1337\n2012-08-29 18:05:56 DEBUG nova.utils [req-27b8cb83-9c2e-4d4d-a9f0-c88a3048df9f None None] backend <module 'nova.db.sqlalchemy.api' from '/opt/stack/nova/nova/db/sqlalchemy/api.pyc'> from (pid=14803) __get_backend /opt/stack/nova/nova/utils.py:494\nbackend <module 'nova.db.sqlalchemy.api' from '/opt/stack/nova/nova/db/sqlalchemy/api.pyc'>\ntest1 created\n$ nova-manage flavor delete --name test1\n2012-08-29 18:06:08 DEBUG nova.utils [req-40d84ec6-846f-45f9-a9a4-87e37bd49078 None None] backend <module 'nova.db.sqlalchemy.api' from '/opt/stack/nova/nova/db/sqlalchemy/api.pyc'> from (pid=14810) __get_backend /opt/stack/nova/nova/utils.py:494\nbackend <module 'nova.db.sqlalchemy.api' from '/opt/stack/nova/nova/db/sqlalchemy/api.pyc'>\ntest1 deleted\n$ nova-manage flavor create --name=test1 --memory=512 --cpu=1 --root_gb=0 --ephemeral_gb=0 --flavor=1337\n2012-08-29 18:06:10 DEBUG nova.utils [req-4096f793-22f6-453d-8a8d-ec63c056f80f None None] backend <module 'nova.db.sqlalchemy.api' from '/opt/stack/nova/nova/db/sqlalchemy/api.pyc'> from (pid=14816) __get_backend /opt/stack/nova/nova/utils.py:494\nbackend <module 'nova.db.sqlalchemy.api' from '/opt/stack/nova/nova/db/sqlalchemy/api.pyc'>\ntest1 created", 
            "date_created": "2012-08-29 16:07:39.054248+00:00", 
            "author": "https://api.launchpad.net/1.0/~adri2000"
        }, 
        {
            "content": "so looks like it is something in the extension causing it", 
            "date_created": "2012-09-06 21:11:54.995571+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Just tried via the API using devstack and can't reproduce this:\n\n\n[rbryant@f17-devstack devstack]$ nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1  | m1.tiny   | 512       | 0    | 0         |      | 1     | 1.0         | True      |\n| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n[rbryant@f17-devstack devstack]$ nova flavor-create test 6 512 0 1\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n| 6  | test | 512       | 0    | 0         |      | 1     | 1           | True      |\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n[rbryant@f17-devstack devstack]$ nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1  | m1.tiny   | 512       | 0    | 0         |      | 1     | 1.0         | True      |\n| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n| 6  | test      | 512       | 0    | 0         |      | 1     | 1.0         | True      |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n[rbryant@f17-devstack devstack]$ nova flavor-delete 6\n[rbryant@f17-devstack devstack]$ nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1  | m1.tiny   | 512       | 0    | 0         |      | 1     | 1.0         | True      |\n| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n[rbryant@f17-devstack devstack]$ nova flavor-create test 6 512 0 1\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n| 6  | test | 512       | 0    | 0         |      | 1     | 1           | True      |\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n[rbryant@f17-devstack devstack]$ nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1  | m1.tiny   | 512       | 0    | 0         |      | 1     | 1.0         | True      |\n| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n| 6  | test      | 512       | 0    | 0         |      | 1     | 1.0         | True      |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n", 
            "date_created": "2012-09-07 15:37:45.464670+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "We could not reproduce this. If you can reproduce it, please let us know more details on your configuration and set back the bug to New.", 
            "date_created": "2012-12-13 10:55:53.818697+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ]
}