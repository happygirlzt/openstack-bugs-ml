{
    "status": "Invalid", 
    "last_updated": "2012-03-01 22:23:17.477994+00:00", 
    "description": "Hello,\n\nVersion: Nova Essex-3.\n\nI've created three networks (in VLAN mode) with the \"nova-manage network create\" command. Each network is associated to a different project by using the --project_id option and after the creation I've associated a host to each network with the \"nova-manage network modify\" command because it's not possible to specify a host on the \"nova-manage network create\" command.\n\n# nova-manage network create private 192.168.0.0/24 1 255 --vlan=100 --bridge_interface=eth2 --project_id=projet1 --multi_host=T\n# nova-manage network modify 192.168.0.0/24 --host=opstack89\n\n# nova-manage network create private 192.168.10.0/24 1 255 --vlan=101 --bridge_interface=eth1 --project_id=projet2 --multi_host=T\n# nova-manage network modify 192.168.10.0/24 --host=opstack88\n\n# nova-manage network create private 192.168.20.0/24 1 255 --vlan=102 --bridge_interface=eth2 --project_id=projet3 --multi_host=T\n# nova-manage network modify 192.168.20.0/24 --host=opstack87\n\nopstack89 is the controller; opstack88 and opstack87 are compute nodes.\n\nWhen I starts the nova-network service on the compute nodes, Nova ignores the host associated to the network and then tries to creates the three VLANs on each compute node instead of the only one for which the host is specified.\n\nTo correct this bug, I've modify the nova/network/manager.py source file in the _setup_network method of the class VlanManager by adding a control on the host name :\n\nif network_ref['host'] and network_ref['host'] != socket.gethostname():\n    return\n\nWith this correction, Nova creates only the VLAN (and its bridge) associated to the specified host. So on opstack88, Nova creates only the vlan101, on opstack87, Nova creates only the vlan102 and so on..", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/943390", 
    "owner": "None", 
    "id": 943390, 
    "index": 2631, 
    "created": "2012-02-29 16:37:13.534724+00:00", 
    "title": "Nova ignores the host associated to a network (correction proposed)", 
    "comments": [
        {
            "content": "Hello,\n\nVersion: Nova Essex-3.\n\nI've created three networks (in VLAN mode) with the \"nova-manage network create\" command. Each network is associated to a different project by using the --project_id option and after the creation I've associated a host to each network with the \"nova-manage network modify\" command because it's not possible to specify a host on the \"nova-manage network create\" command.\n\n# nova-manage network create private 192.168.0.0/24 1 255 --vlan=100 --bridge_interface=eth2 --project_id=projet1 --multi_host=T\n# nova-manage network modify 192.168.0.0/24 --host=opstack89\n\n# nova-manage network create private 192.168.10.0/24 1 255 --vlan=101 --bridge_interface=eth1 --project_id=projet2 --multi_host=T\n# nova-manage network modify 192.168.10.0/24 --host=opstack88\n\n# nova-manage network create private 192.168.20.0/24 1 255 --vlan=102 --bridge_interface=eth2 --project_id=projet3 --multi_host=T\n# nova-manage network modify 192.168.20.0/24 --host=opstack87\n\nopstack89 is the controller; opstack88 and opstack87 are compute nodes.\n\nWhen I starts the nova-network service on the compute nodes, Nova ignores the host associated to the network and then tries to creates the three VLANs on each compute node instead of the only one for which the host is specified.\n\nTo correct this bug, I've modify the nova/network/manager.py source file in the _setup_network method of the class VlanManager by adding a control on the host name :\n\nif network_ref['host'] and network_ref['host'] != socket.gethostname():\n    return\n\nWith this correction, Nova creates only the VLAN (and its bridge) associated to the specified host. So on opstack88, Nova creates only the vlan101, on opstack87, Nova creates only the vlan102 and so on..", 
            "date_created": "2012-02-29 16:37:13.534724+00:00", 
            "author": "https://api.launchpad.net/1.0/~philippe-berthault-deactivatedaccount"
        }, 
        {
            "content": "Interesting.  That wasn't really the purpose of the host field for network.  I'm not really sure how this will work.  What if an instance is launched in project2 on the host for project1 ?\n\nVish\n\nOn Feb 29, 2012, at 8:37 AM, Philippe Berthault wrote:\n\n> Public bug reported:\n> \n> Hello,\n> \n> Version: Nova Essex-3.\n> \n> I've created three networks (in VLAN mode) with the \"nova-manage network\n> create\" command. Each network is associated to a different project by\n> using the --project_id option and after the creation I've associated a\n> host to each network with the \"nova-manage network modify\" command\n> because it's not possible to specify a host on the \"nova-manage network\n> create\" command.\n> \n> # nova-manage network create private 192.168.0.0/24 1 255 --vlan=100 --bridge_interface=eth2 --project_id=projet1 --multi_host=T\n> # nova-manage network modify 192.168.0.0/24 --host=opstack89\n> \n> # nova-manage network create private 192.168.10.0/24 1 255 --vlan=101 --bridge_interface=eth1 --project_id=projet2 --multi_host=T\n> # nova-manage network modify 192.168.10.0/24 --host=opstack88\n> \n> # nova-manage network create private 192.168.20.0/24 1 255 --vlan=102 --bridge_interface=eth2 --project_id=projet3 --multi_host=T\n> # nova-manage network modify 192.168.20.0/24 --host=opstack87\n> \n> opstack89 is the controller; opstack88 and opstack87 are compute nodes.\n> \n> When I starts the nova-network service on the compute nodes, Nova\n> ignores the host associated to the network and then tries to creates the\n> three VLANs on each compute node instead of the only one for which the\n> host is specified.\n> \n> To correct this bug, I've modify the nova/network/manager.py source file\n> in the _setup_network method of the class VlanManager by adding a\n> control on the host name :\n> \n> if network_ref['host'] and network_ref['host'] != socket.gethostname():\n>    return\n> \n> With this correction, Nova creates only the VLAN (and its bridge)\n> associated to the specified host. So on opstack88, Nova creates only the\n> vlan101, on opstack87, Nova creates only the vlan102 and so on..\n> \n> ** Affects: nova\n>     Importance: Undecided\n>         Status: New\n> \n> -- \n> You received this bug notification because you are subscribed to\n> OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/943390\n> \n> Title:\n>  Nova ignores the host associated to a network (correction proposed)\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  Hello,\n> \n>  Version: Nova Essex-3.\n> \n>  I've created three networks (in VLAN mode) with the \"nova-manage\n>  network create\" command. Each network is associated to a different\n>  project by using the --project_id option and after the creation I've\n>  associated a host to each network with the \"nova-manage network\n>  modify\" command because it's not possible to specify a host on the\n>  \"nova-manage network create\" command.\n> \n>  # nova-manage network create private 192.168.0.0/24 1 255 --vlan=100 --bridge_interface=eth2 --project_id=projet1 --multi_host=T\n>  # nova-manage network modify 192.168.0.0/24 --host=opstack89\n> \n>  # nova-manage network create private 192.168.10.0/24 1 255 --vlan=101 --bridge_interface=eth1 --project_id=projet2 --multi_host=T\n>  # nova-manage network modify 192.168.10.0/24 --host=opstack88\n> \n>  # nova-manage network create private 192.168.20.0/24 1 255 --vlan=102 --bridge_interface=eth2 --project_id=projet3 --multi_host=T\n>  # nova-manage network modify 192.168.20.0/24 --host=opstack87\n> \n>  opstack89 is the controller; opstack88 and opstack87 are compute\n>  nodes.\n> \n>  When I starts the nova-network service on the compute nodes, Nova\n>  ignores the host associated to the network and then tries to creates\n>  the three VLANs on each compute node instead of the only one for which\n>  the host is specified.\n> \n>  To correct this bug, I've modify the nova/network/manager.py source\n>  file in the _setup_network method of the class VlanManager by adding a\n>  control on the host name :\n> \n>  if network_ref['host'] and network_ref['host'] != socket.gethostname():\n>      return\n> \n>  With this correction, Nova creates only the VLAN (and its bridge)\n>  associated to the specified host. So on opstack88, Nova creates only\n>  the vlan101, on opstack87, Nova creates only the vlan102 and so on..\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/943390/+subscriptions\n\n", 
            "date_created": "2012-02-29 19:51:13+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Because of the other bug (see #934185) for which there is no reply at this moment, we have to run nova-network service on each compute node and restrict the vlan and bridge creation on these compute nodes by using the host field of the network.\n\nWithout this correction, Nova tries to create vlan(s) on compute nodes by using the bad eth interface (eth2 instead of eth1).\n\nI think it may be potentially a security problem, because if on the Nova controller, the private network is on eth1, and if on compute nodes, the public network is in eth1 and private network on another eth, then on compute nodes, Nova will create vlan(s) on the public network instead of the private network.\n", 
            "date_created": "2012-03-01 09:32:55.353038+00:00", 
            "author": "https://api.launchpad.net/1.0/~philippe-berthault-deactivatedaccount"
        }, 
        {
            "content": "The other bug was actually fixed in e-4 so --vlan_interface is working now. I think this workaround is not the right approach, Vlan networks are supposed to be able to run on all compute hosts so adding all vlans to each compute is actually expected.\n\nNow that we've fixed the other bug, I'm going to mark this invalid.  The VlanManager is not supposed to have a control on host name.  Something like this would really need to be a new network manager and seems unnecessary.", 
            "date_created": "2012-03-01 22:22:26.299357+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "bug referencing the vlan_interface issue: https://bugs.launchpad.net/nova/+bug/833426", 
            "date_created": "2012-03-01 22:23:16.642182+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ]
}