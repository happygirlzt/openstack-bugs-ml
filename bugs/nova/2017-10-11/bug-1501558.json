{
    "status": "Fix Released", 
    "last_updated": "2016-05-13 15:13:34.345950+00:00", 
    "description": "Just started seeing this show up in juno jobs:\n\nhttp://logs.openstack.org/39/229639/2/check/gate-tempest-dsvm-full-juno/a0bb0c0/logs/screen-n-net.txt.gz?level=TRACE#_2015-09-30_22_21_27_400\n\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/floating_ips.py\", line 393, in _associate_floating_ip\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     do_associate()\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/openstack/common/lockutils.py\", line 272, in inner\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/floating_ips.py\", line 386, in do_associate\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     interface=interface)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/floating_ips.py\", line 370, in do_associate\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     interface, fixed['network'])\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/l3.py\", line 114, in add_floating_ip\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     l3_interface_id, network)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/linux_net.py\", line 784, in ensure_floating_forward\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     ensure_ebtables_rules(*floating_ebtables_rules(fixed_ip, network))\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/openstack/common/lockutils.py\", line 272, in inner\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/linux_net.py\", line 1649, in ensure_ebtables_rules\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     _execute(*cmd, run_as_root=True)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/linux_net.py\", line 1229, in _execute\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return utils.execute(*cmd, **kwargs)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/utils.py\", line 187, in execute\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return processutils.execute(*cmd, **kwargs)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/openstack/common/processutils.py\", line 222, in execute\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     cmd=sanitized_cmd)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher ProcessExecutionError: Unexpected error while running command.\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Command: sudo nova-rootwrap /etc/nova/rootwrap.conf ebtables -t nat -I PREROUTING --logical-in br100 -p ipv4 --ip-src 10.1.0.7 ! --ip-dst 10.1.0.0/20 -j redirect --redirect-target ACCEPT\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Exit code: 255\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Stdout: u''\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Stderr: u\"Unable to update the kernel. Two possible causes:\\n1. Multiple ebtables programs were executing simultaneously. The ebtables\\n   userspace tool doesn't by default support multiple ebtables programs running\\n   concurrently. The ebtables option --concurrent or a tool like flock can be\\n   used to support concurrent scripts that update the ebtables kernel tables.\\n2. The kernel doesn't support a certain ebtables extension, consider\\n   recompiling your kernel or insmod the extension.\\n.\\n\"\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher", 
    "tags": [
        "network"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1501558", 
    "owner": "https://api.launchpad.net/1.0/~cfb-n", 
    "id": 1501558, 
    "index": 1818, 
    "created": "2015-10-01 01:12:26.459918+00:00", 
    "title": "nova-net: libvirtError: Error while building firewall: Some rules could not be created for interface: Unable to update the kernel", 
    "comments": [
        {
            "content": "Just started seeing this show up in juno jobs:\n\nhttp://logs.openstack.org/39/229639/2/check/gate-tempest-dsvm-full-juno/a0bb0c0/logs/screen-n-net.txt.gz?level=TRACE#_2015-09-30_22_21_27_400\n\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/floating_ips.py\", line 393, in _associate_floating_ip\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     do_associate()\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/openstack/common/lockutils.py\", line 272, in inner\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/floating_ips.py\", line 386, in do_associate\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     interface=interface)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/floating_ips.py\", line 370, in do_associate\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     interface, fixed['network'])\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/l3.py\", line 114, in add_floating_ip\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     l3_interface_id, network)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/linux_net.py\", line 784, in ensure_floating_forward\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     ensure_ebtables_rules(*floating_ebtables_rules(fixed_ip, network))\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/openstack/common/lockutils.py\", line 272, in inner\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/linux_net.py\", line 1649, in ensure_ebtables_rules\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     _execute(*cmd, run_as_root=True)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/linux_net.py\", line 1229, in _execute\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return utils.execute(*cmd, **kwargs)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/utils.py\", line 187, in execute\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     return processutils.execute(*cmd, **kwargs)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/openstack/common/processutils.py\", line 222, in execute\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher     cmd=sanitized_cmd)\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher ProcessExecutionError: Unexpected error while running command.\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Command: sudo nova-rootwrap /etc/nova/rootwrap.conf ebtables -t nat -I PREROUTING --logical-in br100 -p ipv4 --ip-src 10.1.0.7 ! --ip-dst 10.1.0.0/20 -j redirect --redirect-target ACCEPT\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Exit code: 255\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Stdout: u''\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher Stderr: u\"Unable to update the kernel. Two possible causes:\\n1. Multiple ebtables programs were executing simultaneously. The ebtables\\n   userspace tool doesn't by default support multiple ebtables programs running\\n   concurrently. The ebtables option --concurrent or a tool like flock can be\\n   used to support concurrent scripts that update the ebtables kernel tables.\\n2. The kernel doesn't support a certain ebtables extension, consider\\n   recompiling your kernel or insmod the extension.\\n.\\n\"\n2015-09-30 22:21:27.400 24730 TRACE oslo.messaging.rpc.dispatcher", 
            "date_created": "2015-10-01 01:12:26.459918+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "http://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiZW5zdXJlX2VidGFibGVzX3J1bGVzXCIgQU5EIG1lc3NhZ2U6XCJVbmFibGUgdG8gdXBkYXRlIHRoZSBrZXJuZWwuIFR3byBwb3NzaWJsZSBjYXVzZXNcIiBBTkQgdGFnczpcInNjcmVlbi1uLW5ldC50eHRcIiIsImZpZWxkcyI6W10sIm9mZnNldCI6MCwidGltZWZyYW1lIjoiNjA0ODAwIiwiZ3JhcGhtb2RlIjoiY291bnQiLCJ0aW1lIjp7InVzZXJfaW50ZXJ2YWwiOjB9LCJzdGFtcCI6MTQ0MzY2MTc1ODQxOH0=\n\n8 hits in 7 days, just started really in the last 24 hours, check queue only so far, and only juno jobs (tempest runs juno compat jobs on the master branch).", 
            "date_created": "2015-10-01 01:13:22.954654+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "https://github.com/openstack/nova/commit/9d2abbd9ab60ca873650759feaba98b4d8d35566 is the most recent thing merged to nova on stable/juno (9/28) but it's related to volume-backed live migration which is not even close to something we test in the gate in juno.", 
            "date_created": "2015-10-01 01:17:50.396133+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Also failing in master:\n\nhttp://logs.openstack.org/62/229962/1/check/gate-tempest-dsvm-full/28bb6b6/logs/screen-n-cpu.txt.gz?level=TRACE#_2015-10-01_17_39_59_187", 
            "date_created": "2015-10-01 20:36:34.932127+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "http://logstash.openstack.org/#eyJmaWVsZHMiOltdLCJzZWFyY2giOiJtZXNzYWdlOlwia2VybmVsIG1zZzogZWJ0YWJsZXMgYnVnOiBwbGVhc2UgcmVwb3J0IHRvIGF1dGhvcjogV3JvbmcgbnIuIG9mIGNvdW50ZXJzIHJlcXVlc3RlZFwiIEFORCAoYnVpbGRfcXVldWU6XCJjaGVja1wiIE9SIGJ1aWxkX3F1ZXVlOlwiZ2F0ZVwiKSBBTkQgdGFnczpcInN5c2xvZ1wiIiwidGltZWZyYW1lIjoiNjA0ODAwIiwiZ3JhcGhtb2RlIjoiY291bnQiLCJvZmZzZXQiOjAsInRpbWUiOnsidXNlcl9pbnRlcnZhbCI6MH0sInN0YW1wIjoxNDQzNzMzMjEzNTI2LCJtb2RlIjoidHJlbmQiLCJhbmFseXplX2ZpZWxkIjoiYnVpbGRfbmFtZSJ9", 
            "date_created": "2015-10-01 21:02:08.777776+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "So this really just started showing up around 9/29 but I don't see anything related to nova or devstack (specifically nova-network since it only shows up in nova-network configured jobs) that looks related to this.  I'm guessing there is some upstream package change but I don't know what.\n\nNone of this looks suspect either:\n\nmriedem@ubuntu:~/git/requirements$ python ./tools/what-broke.py \nLooking for requirements releases since 2015-09-17 13:57:06.036691\n<Released python-ironicclient 0.9.0 2015-10-01 20:24:15>\n<Released ironic-lib 0.2.0 2015-10-01 19:49:48>\n<Released ryu 3.26 2015-10-01 19:45:00>\n<Released os-testr 0.4.2 2015-10-01 19:28:32>\n<Released python-openstackclient 1.7.1 2015-10-01 19:24:42>\n<Released python-novaclient 2.31.0 2015-10-01 16:55:54>\n<Released python-novaclient 2.30.1 2015-10-01 15:41:06>\n<Released gabbi 1.8.0 2015-10-01 14:32:12>\n<Released pymongo 2.9 2015-09-30 23:34:46>\n<Released tosca-parser 0.2.0 2015-09-30 22:49:17>\n<Released PyMySQL 0.6.7 2015-09-30 15:21:30>\n<Released os-testr 0.4.1 2015-09-30 14:05:01>\n<Released botocore 1.2.6 2015-09-30 00:29:37>\n<Released pymemcache 1.3.4 2015-09-29 19:21:13>\n<Released os-testr 0.4.0 2015-09-29 16:50:21>\n<Released ovs 2.4.0 2015-09-29 04:25:34>\n<Released beautifulsoup4 4.4.1 2015-09-29 00:19:49>\n<Released python-saharaclient 0.11.1 2015-09-28 23:40:23>\n<Released httplib2 0.9.2 2015-09-28 13:55:48>\n<Released pyasn1-modules 0.0.8 2015-09-28 12:34:06>\n<Released pyasn1 0.1.9 2015-09-28 12:07:48>\n<Released pysnmp 4.3.0 2015-09-28 10:54:29>\n<Released cryptography 1.0.2 2015-09-27 13:52:30>\n", 
            "date_created": "2015-10-01 21:08:41.451457+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Looks like ubuntu had a kernel update in the last 3 days:\n\nhttp://packages.ubuntu.com/trusty/main/newpkg\n\nlinux-headers-3.13.0-65 -- Header files related to Linux kernel version 3.13.0 (3 days old)\nlinux-headers-3.13.0-65-generic -- Linux kernel headers for version 3.13.0 on 64 bit x86 SMP (3 days old)\nlinux-headers-3.13.0-65-lowlatency -- Linux kernel headers for version 3.13.0 on 64 bit x86 SMP (3 days old)\nlinux-headers-3.16.0-50 -- Header files related to Linux kernel version 3.16.0 (3 days old)\nlinux-headers-3.16.0-50-generic -- Linux kernel headers for version 3.16.0 on 64 bit x86 SMP (3 days old)\nlinux-headers-3.16.0-50-lowlatency -- Linux kernel headers for version 3.16.0 on 64 bit x86 SMP (3 days old)\nlinux-headers-3.19.0-30 -- Header files related to Linux kernel version 3.19.0 (3 days old)\nlinux-headers-3.19.0-30-generic -- Linux kernel headers for version 3.19.0 on 64 bit x86 SMP (3 days old)\nlinux-headers-3.19.0-30-lowlatency -- Linux kernel headers for version 3.19.0 on 64 bit x86 SMP (3 days old)", 
            "date_created": "2015-10-01 21:19:47.154188+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Here is the bug tracker for that release:\n\nhttps://bugs.launchpad.net/ubuntu/+source/linux/+bug/1498108", 
            "date_created": "2015-10-01 21:21:00.185629+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Note that when we're failing in the gate it's with kernel 3.13.0-63.103", 
            "date_created": "2015-10-01 21:23:04.764130+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Or maybe are using that new one:\n\nhttp://logs.openstack.org/94/229494/1/check/gate-tempest-dsvm-postgres-full/52298a1/logs/dpkg-l.txt.gz\n\nii  linux-generic                        3.13.0.65.71                          amd64        Complete Generic Linux kernel and headers\nii  linux-headers-3.13.0-58              3.13.0-58.97                          all          Header files related to Linux kernel version 3.13.0\nii  linux-headers-3.13.0-58-generic      3.13.0-58.97                          amd64        Linux kernel headers for version 3.13.0 on 64 bit x86 SMP\nii  linux-headers-3.13.0-65              3.13.0-65.105                         all          Header files related to Linux kernel version 3.13.0\nii  linux-headers-3.13.0-65-generic      3.13.0-65.105                         amd64        Linux kernel headers for version 3.13.0 on 64 bit x86 SMP\nii  linux-headers-generic                3.13.0.65.71                          amd64        Generic Linux kernel headers\nii  linux-headers-virtual                3.13.0.65.71                          amd64        Transitional package.\nii  linux-image-3.13.0-58-generic        3.13.0-58.97                          amd64        Linux kernel image for version 3.13.0 on 64 bit x86 SMP\nii  linux-image-3.13.0-65-generic        3.13.0-65.105                         amd64        Linux kernel image for version 3.13.0 on 64 bit x86 SMP\nii  linux-image-extra-3.13.0-58-generic  3.13.0-58.97                          amd64        Linux kernel extra modules for version 3.13.0 on 64 bit x86 SMP\nii  linux-image-extra-3.13.0-65-generic  3.13.0-65.105                         amd64        Linux kernel extra modules for version 3.13.0 on 64 bit x86 SMP\nii  linux-image-generic                  3.13.0.65.71                          amd64        Generic Linux kernel image\nii  linux-libc-dev:amd64                 3.13.0-65.105                         amd64        Linux Kernel Headers for development", 
            "date_created": "2015-10-01 21:26:17.618516+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "@mriedem:  Is this a duplicate of https://bugs.launchpad.net/nova/+bug/1316621, because the exec ebtables retry logic was not added in juno?   I don't see the \"Retrying\" warning messages in the logs.", 
            "date_created": "2015-10-05 16:55:06.011031+00:00", 
            "author": "https://api.launchpad.net/1.0/~chuckcarmack75"
        }, 
        {
            "content": "@mriedem: for this failure on master, I think libvirt needs to be update to v1.2.11.\n\nThe error in nova-compute:\nhttp://logs.openstack.org/62/229962/1/check/gate-tempest-dsvm-full/28bb6b6/logs/screen-n-cpu.txt.gz#_2015-10-01_17_39_59_187\n\nis not coming from within libvirt:\nhttp://logs.openstack.org/62/229962/1/check/gate-tempest-dsvm-full/28bb6b6/logs/libvirt/libvirtd.txt.gz#_2015-10-01_17_39_58_415\n\nI see in http://logs.openstack.org/62/229962/1/check/gate-tempest-dsvm-full/28bb6b6/logs/dpkg-l.txt.gz\nthat libvirt seems to be at the 1.2.2 version:\nii  libvirt-bin                          1.2.2-0ubuntu13.1.14                  amd64        programs for the libvirt library\n\nYou mention bug 1316621 that the libvirt ebtables concurrency fix is in libvirt 1.2.11.\n\nhttps://bugs.launchpad.net/nova/+bug/1316621/comments/15", 
            "date_created": "2015-10-05 18:22:27.577113+00:00", 
            "author": "https://api.launchpad.net/1.0/~chuckcarmack75"
        }, 
        {
            "content": "Correction to comment 11, the error IS coming from libvirt", 
            "date_created": "2015-10-05 18:24:21.720322+00:00", 
            "author": "https://api.launchpad.net/1.0/~chuckcarmack75"
        }, 
        {
            "content": "Another variant:\n\nhttp://logs.openstack.org/53/232653/1/check/gate-tempest-dsvm-postgres-full/d623420/logs/screen-n-cpu.txt.gz?level=TRACE#_2015-10-14_17_25_36_401\n\n2015-10-14 17:25:36.401 ERROR nova.compute.manager [req-b0002c08-9f30-4131-917a-c0894e8786b2 tempest-ServersAdminTestJSON-968921671 tempest-ServersAdminTestJSON-167547372] [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f] Instance failed to spawn\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f] Traceback (most recent call last):\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2172, in _build_resources\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     yield resources\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2019, in _build_and_run_instance\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     block_device_info=block_device_info)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2444, in spawn\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     block_device_info=block_device_info)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4519, in _create_domain_and_network\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     xml, pause=pause, power_on=power_on)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4449, in _create_domain\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     guest.launch(pause=pause)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/opt/stack/new/nova/nova/virt/libvirt/guest.py\", line 141, in launch\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     self._encoded_xml, errors='ignore')\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     six.reraise(self.type_, self.value, self.tb)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/opt/stack/new/nova/nova/virt/libvirt/guest.py\", line 136, in launch\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     return self._domain.createWithFlags(flags)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     rv = execute(f, *args, **kwargs)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     six.reraise(c, e, tb)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     rv = meth(*args, **kwargs)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]   File \"/usr/local/lib/python2.7/dist-packages/libvirt.py\", line 900, in createWithFlags\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f] libvirtError: Error while building firewall: Some rules could not be created for interface vnet8: Failure to execute command '$EBT -t nat -N libvirt-J-vnet8' : 'ebtables v2.0.10-4:communication.c:397:--BUG--: \n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f] Couldn't update kernel counters'.\n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f] \n2015-10-14 17:25:36.401 5434 ERROR nova.compute.manager [instance: 9a4923d9-264b-4c0b-b69d-2ee89c7d0f6f] ", 
            "date_created": "2015-10-14 19:54:35.201499+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "So the original error posted in comment #1 is an exact match to the condition we hit in https://bugs.launchpad.net/nova/+bug/1316621. The fix we committed in https://review.openstack.org/#/c/140514/ is sufficient to fix this.\n\nlibvirt 1.2.11 doesn't help or factor into thing with the current state of of things. Specifically the fix in libvirt 1.2.11 is to call ebtables with --concurrent. The --concurrent flag causes the ebtables binary to use a lock file to ensure that only one copy of ebtables is running. At this time nova doesn't use --concurrent, as such the fact that 1.2.11 uses --concurrent is irrelevant. \n\nIf we want to benefit from --concurrent we have to get the gate to the point where it has libvirt 1.2.11 (a new enough ebtables) and we would have to patch nova to detect the version of libvirt and ebtables and use --concurrent if everything was at the correct version.", 
            "date_created": "2015-11-12 21:00:51.391933+00:00", 
            "author": "https://api.launchpad.net/1.0/~cfb-n"
        }, 
        {
            "content": "We worked around this in devstack:\n\nhttps://github.com/openstack-dev/devstack/commit/7860f2ba3189b0361693c8ee9c65d8d03fb115d6\n\nUsing:\n\nhttps://review.openstack.org/#/c/246581/", 
            "date_created": "2016-05-13 15:13:07.461945+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ]
}