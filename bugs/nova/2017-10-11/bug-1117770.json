{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:11:50.521942+00:00", 
    "description": "I'm running grizzly trunk on ubuntu (grizzly-trunk-testing) after doing an apt-get upgrade, the bridges are not created automatically by the linuxbridge agent.\n\n1. the linuxbridge is not create automatically\n2. libvirt XML description relies on this bridge (brqxxxxxx)\n3. the VM cannot spawn because of the XML description refenrencing an inexisting bridge\n\nHere is the error in the nova-compute:\n\n2013-02-06 17:34:18.436 DEBUG nova.openstack.common.lockutils [req-19ba2bda-7106-475b-94ea-c421ae0791e7 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Got semaphore \"441bc017-c5e8-4511-abe9-ac8cae3ff9a0\" for method \"do_run_instance\"... inner /usr/lib\n2013-02-06 17:34:19.243 ERROR nova.compute.manager [req-19ba2bda-7106-475b-94ea-c421ae0791e7 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9] Instance failed to spawn\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9] Traceback (most recent call last):\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 984, in _spawn\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     block_device_info)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1186, in spawn\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     block_device_info)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2064, in _create_domain_and_network\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     domain = self._create_domain(xml, instance=instance)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2029, in _create_domain\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     domain.createWithFlags(launch_flags)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 187, in doit\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 147, in proxy_call\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     rv = execute(f,*args,**kwargs)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 76, in tworker\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     rv = meth(*args,**kwargs)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 650, in createWithFlags\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9] libvirtError: Cannot get interface MTU on 'brqe9ac8133-fd': No such device\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9] \n\n\n\nIf I manually create a bridge for all quantum networks, I can spawn VM, AFAICT this was done automatically by the quantum plugin as needed when spawning VMs.\n\nBoris", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1117770", 
    "owner": "https://api.launchpad.net/1.0/~garyk", 
    "id": 1117770, 
    "index": 3385, 
    "created": "2013-02-06 22:43:41.807615+00:00", 
    "title": "linuxbridge-agent not creating bridge anymore", 
    "comments": [
        {
            "content": "I'm running grizzly trunk on ubuntu (grizzly-trunk-testing) after doing an apt-get upgrade, the bridges are not created automatically by the linuxbridge agent.\n\n1. the linuxbridge is not create automatically\n2. libvirt XML description relies on this bridge (brqxxxxxx)\n3. the VM cannot spawn because of the XML description refenrencing an inexisting bridge\n\nHere is the error in the nova-compute:\n\n2013-02-06 17:34:18.436 DEBUG nova.openstack.common.lockutils [req-19ba2bda-7106-475b-94ea-c421ae0791e7 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Got semaphore \"441bc017-c5e8-4511-abe9-ac8cae3ff9a0\" for method \"do_run_instance\"... inner /usr/lib\n2013-02-06 17:34:19.243 ERROR nova.compute.manager [req-19ba2bda-7106-475b-94ea-c421ae0791e7 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9] Instance failed to spawn\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9] Traceback (most recent call last):\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 984, in _spawn\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     block_device_info)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1186, in spawn\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     block_device_info)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2064, in _create_domain_and_network\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     domain = self._create_domain(xml, instance=instance)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2029, in _create_domain\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     domain.createWithFlags(launch_flags)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 187, in doit\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 147, in proxy_call\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     rv = execute(f,*args,**kwargs)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 76, in tworker\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     rv = meth(*args,**kwargs)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 650, in createWithFlags\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9] libvirtError: Cannot get interface MTU on 'brqe9ac8133-fd': No such device\n2013-02-06 17:34:19.243 4957 TRACE nova.compute.manager [instance: 6cd8560e-ff35-4742-bcf7-94b9ed6a0ce9] \n\n\n\nIf I manually create a bridge for all quantum networks, I can spawn VM, AFAICT this was done automatically by the quantum plugin as needed when spawning VMs.\n\nBoris", 
            "date_created": "2013-02-06 22:43:41.807615+00:00", 
            "author": "https://api.launchpad.net/1.0/~boris-michel-deschenes"
        }, 
        {
            "content": "I will look into this. The problem looks like it is related to https://github.com/openstack/nova/commit/11aec7eccbbd786afb919c914404d33fbd690f36\nThanks\nGary", 
            "date_created": "2013-02-07 07:43:34.619010+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/21414", 
            "date_created": "2013-02-07 08:21:34.879357+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/21414\nCommitted: http://github.com/openstack/nova/commit/90f79a0485076bf79d63ed65b55605adec408f32\nSubmitter: Jenkins\nBranch:    master\n\ncommit 90f79a0485076bf79d63ed65b55605adec408f32\nAuthor: Gary Kotton <email address hidden>\nDate:   Thu Feb 7 08:08:00 2013 +0000\n\n    Ensure that LB VIF drivers creates the bridge if necessary\n    \n    Fixes bug 1117770\n    \n    In order for libvirt to use the bridge name the bridge must exist.\n    \n    Change-Id: Ie24cfce8454e0c1bbfd9058787a1fd704790f03c\n", 
            "date_created": "2013-02-12 20:01:33.235573+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}