{
    "status": "Fix Released", 
    "last_updated": "2016-10-18 17:01:54.304819+00:00", 
    "description": "Booting a Nova instance successfully with hw:numa_nodes=0, with a Nova guest XML like that[*].  This bug came out of  this RDO bug --  https://bugzilla.redhat.com/show_bug.cgi?id=1154152.\n\n\nBut, talking with Daniel Berrnage and Nikola Dipanov on IRC, they suggest we should default to 1 node if nothing is specified:\n\n  . . .\n  <danpb> hmm, i'm not convinced we should allow nodes=0 at all\n  <danpb> we should default  1 node if nothing is specified\n  <danpb> We should refuse a vlaue of 0, in case we wish to make use \n   of that as a special value at a later date\n  <danpb> we don't want people relying on  numa_nodes=0  accidentally\n   working for them now\n  <nikola> danpb, correct\n  . . .\n\n\nSimple test\n-------------\n\nNUMA setup instructions here:\n\n   https://review.openstack.org/#/c/131818/1/doc/source/devref/testing/libvirt-numa.rst\n\n\n$ nova flavor-key m1.tiny set hw:numa_nodes=0\n$ nova flavor-show m1.tiny\n+----------------------------+------------------------+\n| Property                   | Value                  |\n+----------------------------+------------------------+\n| OS-FLV-DISABLED:disabled   | False                  |\n| OS-FLV-EXT-DATA:ephemeral  | 0                      |\n| disk                       | 1                      |\n| extra_specs                | {\"hw:numa_nodes\": \"0\"} |\n| id                         | 1                      |\n| name                       | m1.tiny                |\n| os-flavor-access:is_public | True                   |\n| ram                        | 512                    |\n| rxtx_factor                | 1.0                    |\n| swap                       |                        |\n| vcpus                      | 1                      |\n+----------------------------+------------------------+\n$ nova boot --image cirros-0.3.1-x86_64-disk --flavor m1.tiny cirrvm4\n\n\n\n\n[*] Nova guest XML with an instance booted with hw:numa_nodes=0\n-----------------------------------------------------------------------------\n<domain type='kvm' id='3'>\n  <name>instance-00000004</name>\n  <uuid>593f8388-ac9c-4673-b1c7-aa49b1ce83f0</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"2015.1\"/>\n      <nova:name>cirrvm4</nova:name>\n      <nova:creationTime>2014-12-15 14:41:43</nova:creationTime>\n      <nova:flavor name=\"m1.tiny\">\n        <nova:memory>512</nova:memory>\n        <nova:disk>1</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"0d5623bdae83445ba3a6209ea849fffe\">admin</nova:user>\n        <nova:project uuid=\"f9ecf22769cf4ab98543f5ade1454664\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"5bc9a92b-6cda-4916-9bb0-dd9751880cde\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>524288</memory>\n  <currentMemory unit='KiB'>524288</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <cputune>\n    <vcpupin vcpu='0' cpuset='0-3'/>\n    <emulatorpin cpuset='0-3'/>\n  </cputune>\n  <numatune>\n    <memory mode='strict' nodeset='0'/>\n    <memnode cellid='0' mode='strict' nodeset='0'/>\n  </numatune>\n  <resource>\n    <partition>/machine</partition>\n  </resource>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2015.1</entry>\n      <entry name='serial'>bf6b5391-2390-df4f-b3dc-aa80d05468bb</entry>\n      <entry name='uuid'>593f8388-ac9c-4673-b1c7-aa49b1ce83f0</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-2.2'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu>\n    <topology sockets='1' cores='1' threads='1'/>\n    <numa>\n      <cell id='0' cpus='0' memory='524288' unit='KiB'/>\n    </numa>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-kvm</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/home/kashyapc/src/cloud/data/nova/instances/593f8388-ac9c-4673-b1c7-aa49b1ce83f0/disk'/>\n      <backingStore type='file' index='1'>\n        <format type='raw'/>\n        <source file='/home/kashyapc/src/cloud/data/nova/instances/_base/03a663c2a1c649fe0854f01c82c0ddb3871cf691'/>\n        <backingStore/>\n      </backingStore>\n      <target dev='vda' bus='virtio'/>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/home/kashyapc/src/cloud/data/nova/instances/593f8388-ac9c-4673-b1c7-aa49b1ce83f0/disk.config'/>\n      <backingStore/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <alias name='ide0-1-1'/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <alias name='usb0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'>\n      <alias name='pci.0'/>\n    </controller>\n    <controller type='ide' index='0'>\n      <alias name='ide0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:79:6c:b8'/>\n      <source bridge='qbr7584d9fb-e1'/>\n      <target dev='tap7584d9fb-e1'/>\n      <model type='virtio'/>\n      <alias name='net0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/home/kashyapc/src/cloud/data/nova/instances/593f8388-ac9c-4673-b1c7-aa49b1ce83f0/console.log'/>\n      <target port='0'/>\n      <alias name='serial0'/>\n    </serial>\n    <serial type='pty'>\n      <source path='/dev/pts/19'/>\n      <target port='1'/>\n      <alias name='serial1'/>\n    </serial>\n    <console type='file'>\n      <source path='/home/kashyapc/src/cloud/data/nova/instances/593f8388-ac9c-4673-b1c7-aa49b1ce83f0/console.log'/>\n      <target type='serial' port='0'/>\n      <alias name='serial0'/>\n    </console>\n    <memballoon model='virtio'>\n      <alias name='balloon0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n      <stats period='10'/>\n    </memballoon>\n  </devices>\n  <seclabel type='dynamic' model='selinux' relabel='yes'>\n    <label>system_u:system_r:svirt_t:s0:c79,c658</label>\n    <imagelabel>system_u:object_r:svirt_image_t:s0:c79,c658</imagelabel>\n  </seclabel>\n</domain>\n-----------------------------------------------------------------------------", 
    "tags": [
        "libvirt", 
        "low-hanging-fruit"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1402709", 
    "owner": "https://api.launchpad.net/1.0/~gabor.antal", 
    "id": 1402709, 
    "index": 194, 
    "created": "2014-12-15 15:10:18.101397+00:00", 
    "title": "Report an error when booting an instance with a flavor which has NUMA nodes is set to 0 (hw:numa_nodes=0)", 
    "comments": [
        {
            "content": "Booting a Nova instance successfully with hw:numa_nodes=0, with a Nova guest XML like that[*].  This bug came out of  this RDO bug --  https://bugzilla.redhat.com/show_bug.cgi?id=1154152.\n\n\nBut, talking with Daniel Berrnage and Nikola Dipanov on IRC, they suggest we should default to 1 node if nothing is specified:\n\n  . . .\n  <danpb> hmm, i'm not convinced we should allow nodes=0 at all\n  <danpb> we should default  1 node if nothing is specified\n  <danpb> We should refuse a vlaue of 0, in case we wish to make use \n   of that as a special value at a later date\n  <danpb> we don't want people relying on  numa_nodes=0  accidentally\n   working for them now\n  <nikola> danpb, correct\n  . . .\n\n\nSimple test\n-------------\n\nNUMA setup instructions here:\n\n   https://review.openstack.org/#/c/131818/1/doc/source/devref/testing/libvirt-numa.rst\n\n\n$ nova flavor-key m1.tiny set hw:numa_nodes=0\n$ nova flavor-show m1.tiny\n+----------------------------+------------------------+\n| Property                   | Value                  |\n+----------------------------+------------------------+\n| OS-FLV-DISABLED:disabled   | False                  |\n| OS-FLV-EXT-DATA:ephemeral  | 0                      |\n| disk                       | 1                      |\n| extra_specs                | {\"hw:numa_nodes\": \"0\"} |\n| id                         | 1                      |\n| name                       | m1.tiny                |\n| os-flavor-access:is_public | True                   |\n| ram                        | 512                    |\n| rxtx_factor                | 1.0                    |\n| swap                       |                        |\n| vcpus                      | 1                      |\n+----------------------------+------------------------+\n$ nova boot --image cirros-0.3.1-x86_64-disk --flavor m1.tiny cirrvm4\n\n\n\n\n[*] Nova guest XML with an instance booted with hw:numa_nodes=0\n-----------------------------------------------------------------------------\n<domain type='kvm' id='3'>\n  <name>instance-00000004</name>\n  <uuid>593f8388-ac9c-4673-b1c7-aa49b1ce83f0</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"2015.1\"/>\n      <nova:name>cirrvm4</nova:name>\n      <nova:creationTime>2014-12-15 14:41:43</nova:creationTime>\n      <nova:flavor name=\"m1.tiny\">\n        <nova:memory>512</nova:memory>\n        <nova:disk>1</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"0d5623bdae83445ba3a6209ea849fffe\">admin</nova:user>\n        <nova:project uuid=\"f9ecf22769cf4ab98543f5ade1454664\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"5bc9a92b-6cda-4916-9bb0-dd9751880cde\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>524288</memory>\n  <currentMemory unit='KiB'>524288</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <cputune>\n    <vcpupin vcpu='0' cpuset='0-3'/>\n    <emulatorpin cpuset='0-3'/>\n  </cputune>\n  <numatune>\n    <memory mode='strict' nodeset='0'/>\n    <memnode cellid='0' mode='strict' nodeset='0'/>\n  </numatune>\n  <resource>\n    <partition>/machine</partition>\n  </resource>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2015.1</entry>\n      <entry name='serial'>bf6b5391-2390-df4f-b3dc-aa80d05468bb</entry>\n      <entry name='uuid'>593f8388-ac9c-4673-b1c7-aa49b1ce83f0</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-2.2'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu>\n    <topology sockets='1' cores='1' threads='1'/>\n    <numa>\n      <cell id='0' cpus='0' memory='524288' unit='KiB'/>\n    </numa>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-kvm</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/home/kashyapc/src/cloud/data/nova/instances/593f8388-ac9c-4673-b1c7-aa49b1ce83f0/disk'/>\n      <backingStore type='file' index='1'>\n        <format type='raw'/>\n        <source file='/home/kashyapc/src/cloud/data/nova/instances/_base/03a663c2a1c649fe0854f01c82c0ddb3871cf691'/>\n        <backingStore/>\n      </backingStore>\n      <target dev='vda' bus='virtio'/>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/home/kashyapc/src/cloud/data/nova/instances/593f8388-ac9c-4673-b1c7-aa49b1ce83f0/disk.config'/>\n      <backingStore/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <alias name='ide0-1-1'/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <alias name='usb0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'>\n      <alias name='pci.0'/>\n    </controller>\n    <controller type='ide' index='0'>\n      <alias name='ide0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:79:6c:b8'/>\n      <source bridge='qbr7584d9fb-e1'/>\n      <target dev='tap7584d9fb-e1'/>\n      <model type='virtio'/>\n      <alias name='net0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/home/kashyapc/src/cloud/data/nova/instances/593f8388-ac9c-4673-b1c7-aa49b1ce83f0/console.log'/>\n      <target port='0'/>\n      <alias name='serial0'/>\n    </serial>\n    <serial type='pty'>\n      <source path='/dev/pts/19'/>\n      <target port='1'/>\n      <alias name='serial1'/>\n    </serial>\n    <console type='file'>\n      <source path='/home/kashyapc/src/cloud/data/nova/instances/593f8388-ac9c-4673-b1c7-aa49b1ce83f0/console.log'/>\n      <target type='serial' port='0'/>\n      <alias name='serial0'/>\n    </console>\n    <memballoon model='virtio'>\n      <alias name='balloon0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n      <stats period='10'/>\n    </memballoon>\n  </devices>\n  <seclabel type='dynamic' model='selinux' relabel='yes'>\n    <label>system_u:system_r:svirt_t:s0:c79,c658</label>\n    <imagelabel>system_u:object_r:svirt_image_t:s0:c79,c658</imagelabel>\n  </seclabel>\n</domain>\n-----------------------------------------------------------------------------", 
            "date_created": "2014-12-15 15:10:18.101397+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "Please do not assign a bug to yourself unless you have a patch up in gerrit.", 
            "date_created": "2015-01-29 05:44:20.871548+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Looks like we currently don't refuse numa_nodes value of 0", 
            "date_created": "2015-02-13 23:29:34.320332+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/190267", 
            "date_created": "2015-06-10 17:13:15.645819+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "We also want to verify for no-numeric value.", 
            "date_created": "2015-06-11 09:14:39.295146+00:00", 
            "author": "https://api.launchpad.net/1.0/~sahid-ferdjaoui"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/190267\nReason: This patch has been idle for a long time, so I am abandoning it to keep the review clean sane. If you're interested in still working on this patch, then please unabandon it and upload a new patchset.", 
            "date_created": "2016-05-26 00:18:34.408749+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Cleanup\n=======\n\nThere are no open reviews for this bug report since more than 2 weeks.\nTo signal that to other contributors which might provide patches for\nthis bug, I switch the status from \"In Progress\" to \"Confirmed\" and\nremove the assignee.\nFeel free to add yourself as assignee and to push a review for it.", 
            "date_created": "2016-05-27 11:18:21.445117+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/337380", 
            "date_created": "2016-07-04 22:24:34.115286+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/337380\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=47d8aa5e7fe0c82ed00017aa2185de1ed5e51a86\nSubmitter: Jenkins\nBranch:    master\n\ncommit 47d8aa5e7fe0c82ed00017aa2185de1ed5e51a86\nAuthor: G\u00e1bor Antal <email address hidden>\nDate:   Tue Jul 5 00:13:25 2016 +0200\n\n    Throw exception if numa_nodes is not set to integer greater than 0\n    \n    As [1] is abandoned, I used that patchset to create a new one.\n    This patchset is freshened to the current master branch.\n    \n    This patch introduces InvalidNUMANodesNumber exception, which is\n    thrown when trying to boot an instance with a flavor that has\n    hw:numa_nodes=0 extra spec set. That means that NUMA nodes is set to 0,\n    which is incorrect.\n    \n    [1]: https://review.openstack.org/#/c/190267\n    \n    Change-Id: I6bd8f69e582c537a5fec40064638a8887a08cac4\n    Co-Authored-By: Karim Boumedhel <email address hidden>\n    Closes-Bug: #1402709\n", 
            "date_created": "2016-09-12 22:00:35.633920+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0rc1 release candidate.", 
            "date_created": "2016-09-26 20:14:14.181534+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0rc1 release candidate.", 
            "date_created": "2016-10-18 17:01:53.693956+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}