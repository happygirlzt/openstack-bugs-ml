{
    "status": "Won't Fix", 
    "last_updated": "2014-09-04 18:24:22.179343+00:00", 
    "description": "1. nova-comp open too many files about 1112. (but the output of \"ulimit -n\" just is 1024)\n\n2. nova-comp open too many files inode 3641 /lib/modules/2.6.32-279.el6.x86_64/kernel/net/sunrpc/auth_gss/rpcsec_gss_krb5.ko\n\nnova-comp 20916    28u   REG     0,9         0   3641 anon_inode\nnova-comp 20916    29u   REG     0,9         0   3641 anon_inode\n...\n\nnova-comp 20975    22u   REG     0,9         0   3641 anon_inode\nnova-comp 20975    23u   REG     0,9         0   3641 anon_inode\n...\n\n---------------------------\n[test@Openstack_Grizzly_ControlNode ~]$ ps -ef | grep nova\ntest 10374 10357  0 04:54 pts/1    00:00:00 grep nova\ntest 11292 11272  0 Dec04 pts/7    00:00:01 python /home/.../nova/bin/nova-api\ntest 11300 11292  0 Dec04 pts/7    00:00:01 python /home/.../nova/bin/nova-api\ntest 11303 11292  0 Dec04 pts/7    00:00:50 python /home/.../nova/bin/nova-api\ntest 11304 11292  0 Dec04 pts/7    00:00:01 python /home/.../nova/bin/nova-api\ntest 11479 11373  0 Dec04 pts/9    01:21:03 python /home/.../nova/bin/nova-network\ntest 11650 11485  0 Dec04 pts/10   00:39:28 python /home/.../nova/bin/nova-scheduler\nnobody   13152     1  0 Dec04 ?        00:02:29 /usr/sbin/dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/home/.../data/nova/networks/nova-br100.pid --listen-address=10.0.1.1 --except-interface=lo --dhcp-range=set:'private',10.0.1.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/home/.../data/nova/networks/nova-br100.conf --dhcp-script=/home/.../nova/bin/nova-dhcpbridge --leasefile-ro\nroot     13153 13152  0 Dec04 ?        00:00:00 /usr/sbin/dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/home/.../data/nova/networks/nova-br100.pid --listen-address=10.0.1.1 --except-interface=lo --dhcp-range=set:'private',10.0.1.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/home/.../data/nova/networks/nova-br100.conf --dhcp-script=/home/.../nova/bin/nova-dhcpbridge --leasefile-ro\ntest 20916     1  0 Dec05 ?        01:25:35 /usr/bin/python /usr/bin/nova-compute\ntest 20975     1  0 Dec05 ?        01:24:55 /usr/bin/python /usr/bin/nova-compute --config-file=/etc/nova/nova2.conf\n[test@Openstack_Grizzly_ControlNode ~]$\n[test@Openstack_Grizzly_ControlNode ~]$ ulimit -n\n1024\n[test@Openstack_Grizzly_ControlNode ~]$ lsof -p 20916 | wc -l\n1112\n[test@Openstack_Grizzly_ControlNode ~]$ lsof -p 20975 | wc -l\n1112\n[test@Openstack_Grizzly_ControlNode ~]$ lsof -p 20975 | grep 3641 | wc -l\n1009\n[test@Openstack_Grizzly_ControlNode ~]$ lsof -p 20916 | grep 3641 | wc -l\n1009\n[test@Openstack_Grizzly_ControlNode ~]$\n[test@Openstack_Grizzly_ControlNode ~]$ ulimit -a\ncore file size          (blocks, -c) 0\ndata seg size           (kbytes, -d) unlimited\nscheduling priority             (-e) 0\nfile size               (blocks, -f) unlimited\npending signals                 (-i) 14874\nmax locked memory       (kbytes, -l) 64\nmax memory size         (kbytes, -m) unlimited\nopen files                      (-n) 1024\npipe size            (512 bytes, -p) 8\nPOSIX message queues     (bytes, -q) 819200\nreal-time priority              (-r) 0\nstack size              (kbytes, -s) 10240\ncpu time               (seconds, -t) unlimited\nmax user processes              (-u) 1024\nvirtual memory          (kbytes, -v) unlimited\nfile locks                      (-x) unlimited\n[test@Openstack_Grizzly_ControlNode ~]$\n[test@Openstack_Grizzly_ControlNode ~]$ ls -li /lib/modules/2.6.32-279.el6.x86_64/kernel/net/sunrpc/auth_gss/rpcsec_gss_krb5.ko\n3641 -rwxr--r--. 1 root root 49576 Jun 14  2012 /lib/modules/2.6.32-279.el6.x86_64/kernel/net/sunrpc/auth_gss/rpcsec_gss_krb5.ko\n[test@Openstack_Grizzly_ControlNode ~]$\n\nnova-compute.log:\n2012-12-13 22:31:21 20916 ERROR nova.virt.powervm.common [-] Error while trying to connect: Error reading SSH protocol banner[Errno 24] Too many open files\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm.common Traceback (most recent call last):\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervmt.common   File \"/home/.../nova/nova/virt/powervm/common.py\", line 60, in ssh_connect\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm.common     port=port)\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm.common   File \"/usr/lib/python2.6/site-packages/paramiko/client.py\", line 295, in connect\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm.common     t.start_client()\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm.common   File \"/usr/lib/python2.6/site-packages/paramiko/transport.py\", line 451, in start_client\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm.common     raise e\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm.common SSHException: Error reading SSH protocol banner[Errno 24] Too many open files\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm.common", 
    "tags": [
        "powervm"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1090268", 
    "owner": "https://api.launchpad.net/1.0/~lbragstad", 
    "id": 1090268, 
    "index": 3176, 
    "created": "2012-12-14 08:55:19.602271+00:00", 
    "title": "'Too many open files' are opened by nova-compute", 
    "comments": [
        {
            "content": "1. nova-comp open too many files about 1112. (but the output of \"ulimit -n\" just is 1024)\n\n2. nova-comp open too many files inode 3641 /lib/modules/2.6.32-279.el6.x86_64/kernel/net/sunrpc/auth_gss/rpcsec_gss_krb5.ko\n\nnova-comp 20916 olympics   28u   REG     0,9         0   3641 anon_inode\nnova-comp 20916 olympics   29u   REG     0,9         0   3641 anon_inode\n...\n\nnova-comp 20975 olympics   22u   REG     0,9         0   3641 anon_inode\nnova-comp 20975 olympics   23u   REG     0,9         0   3641 anon_inode\n...\n\n---------------------------\n[olympics@Openstack_Grizzly_ControlNode ~]$ ps -ef | grep nova\nolympics 10374 10357  0 04:54 pts/1    00:00:00 grep nova\nolympics 11292 11272  0 Dec04 pts/7    00:00:01 python /home/olympics/source/nova/bin/nova-api\nolympics 11300 11292  0 Dec04 pts/7    00:00:01 python /home/olympics/source/nova/bin/nova-api\nolympics 11303 11292  0 Dec04 pts/7    00:00:50 python /home/olympics/source/nova/bin/nova-api\nolympics 11304 11292  0 Dec04 pts/7    00:00:01 python /home/olympics/source/nova/bin/nova-api\nolympics 11479 11373  0 Dec04 pts/9    01:21:03 python /home/olympics/source/nova/bin/nova-network\nolympics 11650 11485  0 Dec04 pts/10   00:39:28 python /home/olympics/source/nova/bin/nova-scheduler\nnobody   13152     1  0 Dec04 ?        00:02:29 /usr/sbin/dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/home/olympics/source/data/nova/networks/nova-br100.pid --listen-address=10.0.1.1 --except-interface=lo --dhcp-range=set:'private',10.0.1.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/home/olympics/source/data/nova/networks/nova-br100.conf --dhcp-script=/home/olympics/source/nova/bin/nova-dhcpbridge --leasefile-ro\nroot     13153 13152  0 Dec04 ?        00:00:00 /usr/sbin/dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/home/olympics/source/data/nova/networks/nova-br100.pid --listen-address=10.0.1.1 --except-interface=lo --dhcp-range=set:'private',10.0.1.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/home/olympics/source/data/nova/networks/nova-br100.conf --dhcp-script=/home/olympics/source/nova/bin/nova-dhcpbridge --leasefile-ro\nolympics 20916     1  0 Dec05 ?        01:25:35 /usr/bin/python /usr/bin/nova-compute\nolympics 20975     1  0 Dec05 ?        01:24:55 /usr/bin/python /usr/bin/nova-compute --config-file=/etc/nova/nova2.conf\n[olympics@Openstack_Grizzly_ControlNode ~]$\n[olympics@Openstack_Grizzly_ControlNode ~]$ ulimit -n\n1024\n[olympics@Openstack_Grizzly_ControlNode ~]$ lsof -p 20916 | wc -l\n1112\n[olympics@Openstack_Grizzly_ControlNode ~]$ lsof -p 20975 | wc -l\n1112\n[olympics@Openstack_Grizzly_ControlNode ~]$ lsof -p 20975 | grep 3641 | wc -l\n1009\n[olympics@Openstack_Grizzly_ControlNode ~]$ lsof -p 20916 | grep 3641 | wc -l\n1009\n[olympics@Openstack_Grizzly_ControlNode ~]$\n[olympics@Openstack_Grizzly_ControlNode ~]$ ulimit -a\ncore file size          (blocks, -c) 0\ndata seg size           (kbytes, -d) unlimited\nscheduling priority             (-e) 0\nfile size               (blocks, -f) unlimited\npending signals                 (-i) 14874\nmax locked memory       (kbytes, -l) 64\nmax memory size         (kbytes, -m) unlimited\nopen files                      (-n) 1024\npipe size            (512 bytes, -p) 8\nPOSIX message queues     (bytes, -q) 819200\nreal-time priority              (-r) 0\nstack size              (kbytes, -s) 10240\ncpu time               (seconds, -t) unlimited\nmax user processes              (-u) 1024\nvirtual memory          (kbytes, -v) unlimited\nfile locks                      (-x) unlimited\n[olympics@Openstack_Grizzly_ControlNode ~]$\n[olympics@Openstack_Grizzly_ControlNode ~]$ ls -li /lib/modules/2.6.32-279.el6.x86_64/kernel/net/sunrpc/auth_gss/rpcsec_gss_krb5.ko\n3641 -rwxr--r--. 1 root root 49576 Jun 14  2012 /lib/modules/2.6.32-279.el6.x86_64/kernel/net/sunrpc/auth_gss/rpcsec_gss_krb5.ko\n[olympics@Openstack_Grizzly_ControlNode ~]$\n\n\nnova-compute.log:\n2012-12-13 22:31:21 20916 ERROR nova.virt.powervm-next.common [-] Error while trying to connect: Error reading SSH protocol banner[Errno 24] Too many open files\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common Traceback (most recent call last):\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common   File \"/home/olympics/source/nova/nova/virt/powervm-next/common.py\", line 60, in ssh_connect\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common     port=port)\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common   File \"/usr/lib/python2.6/site-packages/paramiko/client.py\", line 295, in connect\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common     t.start_client()\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common   File \"/usr/lib/python2.6/site-packages/paramiko/transport.py\", line 451, in start_client\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common     raise e\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common SSHException: Error reading SSH protocol banner[Errno 24] Too many open files\n2012-12-13 22:31:21 20916 TRACE nova.virt.powervm-next.common", 
            "date_created": "2012-12-14 08:55:19.602271+00:00", 
            "author": "https://api.launchpad.net/1.0/~yanglyy"
        }, 
        {
            "content": "Why is this bug \"comfirmed\" ?", 
            "date_created": "2013-02-09 21:44:27.228975+00:00", 
            "author": "https://api.launchpad.net/1.0/~academicgareth"
        }, 
        {
            "content": "Trying to get in contact with the opener of the bug, he says he can't reproduce and doesn't have any steps. I also can't reproduce. I have spoke with a few others and they haven't seen it either. Still reaching out to the opener to find a way to recreate.", 
            "date_created": "2013-03-14 18:19:17.461445+00:00", 
            "author": "https://api.launchpad.net/1.0/~lbragstad"
        }, 
        {
            "content": "It may be because of  some bugs of python2.6 in subprocess.py. When nova-compute update_available_resource every 10 seconds. The fowlling process will be called:\nFile \"/usr/lib/python2.6/site-packages/eventlet/green/subprocess.py\", line 25, in __init__\n subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\nIn python2.6, it is:\n        self._execute_child(args, executable, preexec_fn, close_fds,\n                            cwd, env, universal_newlines,\n                            startupinfo, creationflags, shell,\n                            p2cread, p2cwrite,\n                            c2pread, c2pwrite,\n                            errread, errwrite)\nbut in python2.7, it is:\ntry:\n            self._execute_child(args, executable, preexec_fn, close_fds,\n                                cwd, env, universal_newlines,\n                                startupinfo, creationflags, shell,\n                                p2cread, p2cwrite,\n                                c2pread, c2pwrite,\n                                errread, errwrite)\n        except Exception:\n            # Preserve original exception in case os.close raises.\n            exc_type, exc_value, exc_trace = sys.exc_info()\n\n            to_close = []\n            # Only close the pipes we created.\n            if stdin == PIPE:\n                to_close.extend((p2cread, p2cwrite))\n            if stdout == PIPE:\n                to_close.extend((c2pread, c2pwrite))\n            if stderr == PIPE:\n                to_close.extend((errread, errwrite))\n\n            for fd in to_close:\n                try:\n                    os.close(fd)\n                except EnvironmentError:\n                    pass\n\n            raise exc_type, exc_value, exc_trace\nIn python2.6, don't close the pipe file when there is some Exceptions.\nAnd I found a large number of pipe files in nova-compute process fd list(/proc/XXXX/fd), when the system with error: \"Too many open files\".\n\nThe total traceback is:\n   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 4863, in update_available_resource\n     rt.update_available_resource(context)\n   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 246, in inner\n     return f(*args, **kwargs)\n   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 274, in update_available_resource\n     resources = self.driver.get_available_resource(self.nodename)\n   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 3727, in get_available_resource\n     stats = self.host_state.get_host_stats(refresh=True)\n   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 4781, in get_host_stats\n     self.update_status()\n   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 4824, in update_status\n     data['disk_available_least'] = _get_disk_available_least()\n   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 4797, in _get_disk_available_least\n     disk_over_committed = (self.driver.\n   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 4346, in get_disk_over_committed_size_total\n     self.get_instance_disk_info(i_name))\n   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 4322, in get_instance_disk_info\n     backing_file = libvirt_utils.get_disk_backing_file(path)\n   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/utils.py\", line 442, in get_disk_backing_file\n     backing_file = images.qemu_img_info(path).backing_file\n   File \"/usr/lib/python2.6/site-packages/nova/virt/images.py\", line 172, in qemu_img_info\n     'qemu-img', 'info', path)\n   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 177, in execute\n     return processutils.execute(*cmd, **kwargs)\n   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/processutils.py\", line 163, in execute\n     shell=shell)\n   File \"/usr/lib/python2.6/site-packages/eventlet/green/subprocess.py\", line 25, in __init__\n     subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n   File \"/usr/lib64/python2.6/subprocess.py\", line 632, in __init__\n     errread, errwrite) = self._get_handles(stdin, stdout, stderr)\n   File \"/usr/lib64/python2.6/subprocess.py\", line 1055, in _get_handles\n     p2cread, p2cwrite = os.pipe()", 
            "date_created": "2014-08-25 08:42:08.228903+00:00", 
            "author": "https://api.launchpad.net/1.0/~adesin-yin"
        }, 
        {
            "content": "powervm has been removed from tree, marking won't fix.", 
            "date_created": "2014-09-04 18:24:20.746749+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}