{
    "status": "Invalid", 
    "last_updated": "2014-09-18 12:37:38.493168+00:00", 
    "description": "TEST STEPS:\n1)  Try to use Automation tool to deploy 600 VMs. (Including resize and delete)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(Using flavors of m1.small)\n2)  When we had deployed 427 VMs, the memory of compute node was shortage.\n3)  Time out occur.\n\nExpected result: Once the memory shortage was happened, the deploying should be stopped and openstack will show the ERROR status to user.\nActual result: The status of the deploying is still BUILD and we can find the error message from the compute.log of compute node.\n\nwe can find below message compute.log about the shortage of memory.\n\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops HyperVException: WMI job failed with status 10. Error details: 'instance-000002aa' could not initialize.\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops Not enough memory in the system to start the virtual machine instance-000002aa. - 'instance-000002aa' could not initialize. (Virtual machine ID BAEB8C16-DBE5-488D-B55C-59543A8F0885)\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops Not enough memory in the system to start the virtual machine instance-000002aa with ram size 2048 megabytes. (Virtual machine ID BAEB8C16-DBE5-488D-B55C-59543A8F0885) - Error code: 32778\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops\n2013-05-29 01:07:20.289 ERROR nova.virt.hyperv.vmops [req-e2855532-03eb-484a-9b53-4c7a8cb37795 a6ab9c2b52554567b2c0281636398bfc aef9ae3aeace49a080d22e46295834b4] Failed to change vm state of instance-000002aa to 2\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops Traceback (most recent call last):\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops   File \"C:\\Program Files (x86)\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmops.py\", line 184, in spawn\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops     self.power_on(instance)\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops   File \"C:\\Program Files (x86)\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmops.py\", line 369, in power_on\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops     constants.HYPERV_VM_STATE_ENABLED)\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops   File \"C:\\Program Files (x86)\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmops.py\", line 380, in _set_vm_state\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops     raise vmutils.HyperVException(msg)\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops HyperVException: Failed to change vm state of instance-000002aa to 2\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops\n2013-05-29 01:07:20.289 INFO nova.virt.hyperv.vmops [req-e2855532-03eb-484a-9b53-4c7a8cb37795 a6ab9c2b52554567b2c0281636398bfc aef9ae3aeace49a080d22e46295834b4] Got request to destroy instance: instance-000002aa\n2013-05-29 01:07:20.352 DEBUG nova.virt.hyperv.vmops [req-e2855532-03eb-484a-9b53-4c7a8cb37795 a6ab9c2b52554567b2c0281636398bfc aef9ae3aeace49a080d22e46295834b4] [instance: f82a4a9d-48a7-4361-8dbd-c906ca94b008] Power off instance power_off C:\\Program Files (x86)\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmops.py:361", 
    "tags": [
        "hyper-v"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1186065", 
    "owner": "None", 
    "id": 1186065, 
    "index": 3700, 
    "created": "2013-05-31 00:42:59.166261+00:00", 
    "title": "HyperV: Instance status always being building after memory shortage error happen", 
    "comments": [
        {
            "content": "TEST STEPS:\n1)  Try to use Automation tool to deploy 600 VMs. (Including resize and delete)\n      (Using flavors of m1.small)\n2)  When we had deployed 427 VMs, the memory of compute node was shortage. \n3)  Time out occur.\n\nExpected result: Once the memory shortage was happened, the deploying should be stopped and openstack will show the ERROR status to user.\nActual result: The status of the deploying is still BUILD and we can find the error message from the compute.log of compute node.\n\nwe can find below message compute.log about the shortage of memory.\n\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops HyperVException: WMI job failed with status 10. Error details: 'instance-000002aa' could not initialize.\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops \n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops Not enough memory in the system to start the virtual machine instance-000002aa. - 'instance-000002aa' could not initialize. (Virtual machine ID BAEB8C16-DBE5-488D-B55C-59543A8F0885)\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops \n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops Not enough memory in the system to start the virtual machine instance-000002aa with ram size 2048 megabytes. (Virtual machine ID BAEB8C16-DBE5-488D-B55C-59543A8F0885) - Error code: 32778\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops \n2013-05-29 01:07:20.289 ERROR nova.virt.hyperv.vmops [req-e2855532-03eb-484a-9b53-4c7a8cb37795 a6ab9c2b52554567b2c0281636398bfc aef9ae3aeace49a080d22e46295834b4] Failed to change vm state of instance-000002aa to 2\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops Traceback (most recent call last):\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmops.py\", line 184, in spawn\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops     self.power_on(instance)\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmops.py\", line 369, in power_on\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops     constants.HYPERV_VM_STATE_ENABLED)\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmops.py\", line 380, in _set_vm_state\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops     raise vmutils.HyperVException(msg)\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops HyperVException: Failed to change vm state of instance-000002aa to 2\n2013-05-29 01:07:20.289 5600 TRACE nova.virt.hyperv.vmops \n2013-05-29 01:07:20.289 INFO nova.virt.hyperv.vmops [req-e2855532-03eb-484a-9b53-4c7a8cb37795 a6ab9c2b52554567b2c0281636398bfc aef9ae3aeace49a080d22e46295834b4] Got request to destroy instance: instance-000002aa\n2013-05-29 01:07:20.352 DEBUG nova.virt.hyperv.vmops [req-e2855532-03eb-484a-9b53-4c7a8cb37795 a6ab9c2b52554567b2c0281636398bfc aef9ae3aeace49a080d22e46295834b4] [instance: f82a4a9d-48a7-4361-8dbd-c906ca94b008] Power off instance power_off C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmops.py:361", 
            "date_created": "2013-05-31 00:42:59.166261+00:00", 
            "author": "https://api.launchpad.net/1.0/~guohliu"
        }, 
        {
            "content": "I think the problem here is simply that the hyperv driver doesn't raise the exception when the spawn fails.  Looking at some of the other virt driver code, if they catch any exceptions during spawn, they only do that to cleanup and then re-raise the original exception and then let the compute manager code wrap the instance fault and create an InstanceFault record in the database.  I don't see if that implicitly sets the vm_state to ERROR or not, but I think it must somewhere.\n\nThe hyperv driver catches the exception and then tries to destroy the instance it was spawning, but with an out of memory error, that's not going to work either.", 
            "date_created": "2013-07-06 20:44:58.560745+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Hi guys, I'd like to investigate more this error and see if we should create a tempest test to verify this condition.\nGuoHui: can you please share some details about the scripts you are using?\n", 
            "date_created": "2014-03-05 17:54:32.753092+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexpilotti"
        }, 
        {
            "content": "long incomplete bug", 
            "date_created": "2014-09-18 12:37:37.686147+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}