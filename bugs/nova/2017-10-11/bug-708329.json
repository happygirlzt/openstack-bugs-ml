{
    "status": "Fix Released", 
    "last_updated": "2011-02-15 11:55:49.743876+00:00", 
    "description": "I have created 2 projects and each project is having 1-2 groups.\n\nIf I run DescribeSecurityGroups with Admin rights it should return groups information in sorted order based on projects and group.\n\nActual Result:-\nroot@ubuntu-network-api-server:/home/openstack# euca-describe-groups\nGROUP project-1 default default\nPERMISSION project-1 default ALLOWS tcp 22 22 FROM CIDR 0.0.0.0/0\nGROUP project-2 default default\nPERMISSION project-2 default ALLOWS icmp -1 -1 FROM CIDR 0.0.0.0/24\nGROUP project-1 test test\nGROUP project-2 test test\nGROUP project-1 test1 test\n\nExpected Result:-\nroot@ubuntu-network-api-server:/home/openstack# euca-describe-groups\nGROUP project-1 default default\nPERMISSION project-1 default ALLOWS tcp 22 22 FROM CIDR 0.0.0.0/0\nGROUP project-1 test test\nGROUP project-1 test1 test\nGROUP project-2 default default\nPERMISSION project-2 default ALLOWS icmp -1 -1 FROM CIDR 0.0.0.0/24\nGROUP project-2 test test", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/708329", 
    "owner": "https://api.launchpad.net/1.0/~rcarrillocruz", 
    "id": 708329, 
    "index": 4977, 
    "created": "2011-01-26 21:48:11.768052+00:00", 
    "title": "DescribeGroups: Groups are not sorted properly", 
    "comments": [
        {
            "content": "I have created 2 projects and each project is having 1-2 groups.\n\nIf I run DescribeSecurityGroups with Admin rights it should return groups information in sorted order based on projects and group.\n\nActual Result:-\nroot@ubuntu-network-api-server:/home/openstack# euca-describe-groups\nGROUP project-1 default default\nPERMISSION project-1 default ALLOWS tcp 22 22 FROM CIDR 0.0.0.0/0\nGROUP project-2 default default\nPERMISSION project-2 default ALLOWS icmp -1 -1 FROM CIDR 0.0.0.0/24\nGROUP project-1 test test\nGROUP project-2 test test\nGROUP project-1 test1 test\n\nExpected Result:-\nroot@ubuntu-network-api-server:/home/openstack# euca-describe-groups\nGROUP project-1 default default\nPERMISSION project-1 default ALLOWS tcp 22 22 FROM CIDR 0.0.0.0/0\nGROUP project-1 test test\nGROUP project-1 test1 test\nGROUP project-2 default default\nPERMISSION project-2 default ALLOWS icmp -1 -1 FROM CIDR 0.0.0.0/24\nGROUP project-2 test test", 
            "date_created": "2011-01-26 21:48:11.768052+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "Added a LOG line to nova/api/ec2/cloud.py:\n\n    def describe_security_groups(self, context, group_name=None, **kwargs):\n        self.compute_api.ensure_default_security_group(context)\n        if context.user.is_admin():\n            groups = db.security_group_get_all(context)\n        else:\n            groups = db.security_group_get_by_project(context,\n                                                      context.project_id)\n        groups = [self._format_security_group(context, g) for g in groups]\n        LOG.debug(_(\"Groups after format_security_group: %s\"), groups, context=context)\n\nThis way I can see what's going on.\n\nRan these commands to reproduce:\n\nroot@dormammu-VirtualBox:/home/dormammu/src/nova/lp708329/bin# euca-add-group -a admin:project-1 -d test test\nGROUP   test    test\nroot@dormammu-VirtualBox:/home/dormammu/src/nova/lp708329/bin# euca-add-group -a admin:project-2 -d test test\nGROUP   test    test\nroot@dormammu-VirtualBox:/home/dormammu/src/nova/lp708329/bin# euca-add-group -a admin:project-1 -d test test1\nGROUP   test1   test\nroot@dormammu-VirtualBox:/home/dormammu/src/nova/lp708329/bin# euca-describe-groups\nGROUP   admin   default default\nGROUP   project-1       default default\nGROUP   project-1       test    test\nGROUP   project-2       default default\nGROUP   project-2       test    test\nGROUP   project-1       test1   test\nroot@dormammu-VirtualBox:/home/dormammu/src/nova/lp708329/bin# euca-describe-groups\nGROUP   admin   default default\nGROUP   project-1       default default\nGROUP   project-1       test    test\nGROUP   project-2       default default\nGROUP   project-2       test    test\nGROUP   project-1       test1   test\n\nSo, I can reproduce the same thing as the reporter.\nInterestingly enough, I see this on the nova api log worker after adding the aforementioned log line:\n\n2011-02-11 21:36:34,659 DEBUG nova.api [-] action: DescribeSecurityGroups from MainProcess (pid=4984) __call__ /home/dormammu/src/nova/lp708329/nova/api/ec2/__init__.py:212\n2011-02-11 21:36:34,695 DEBUG nova.api.cloud [94DRVMBGWG40TLI9Z2TS admin admin] Groups after format_security_group: [{'ipPermissions': [], 'groupName': u'default', 'groupDescription': u'default', 'ownerId': u'admin'}, {'ipPermissions': [], 'groupName': u'default', 'groupDescription': u'default', 'ownerId': u'project-1'}, {'ipPermissions': [], 'groupName': u'test', 'groupDescription': u'test', 'ownerId': u'project-1'}, {'ipPermissions': [], 'groupName': u'default', 'groupDescription': u'default', 'ownerId': u'project-2'}, {'ipPermissions': [], 'groupName': u'test', 'groupDescription': u'test', 'ownerId': u'project-2'}, {'ipPermissions': [], 'groupName': u'test1', 'groupDescription': u'test', 'ownerId': u'project-1'}] from MainProcess (pid=4984) describe_security_groups /home/dormammu/src/nova/lp708329/nova/api/ec2/cloud.py:327\n\nThe ownerId field shows something I didn't expect, a project name as the value of the field (u'project-1') . I would expect something like 'admin:project-1' or another key in the group dictionary to hold the project.\n\nI need to investigate what we store for groups in the DB.", 
            "date_created": "2011-02-11 20:53:26.267382+00:00", 
            "author": "https://api.launchpad.net/1.0/~rcarrillocruz"
        }
    ]
}