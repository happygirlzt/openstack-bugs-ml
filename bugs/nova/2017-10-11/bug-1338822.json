{
    "status": "Invalid", 
    "last_updated": "2014-07-25 01:18:16.411869+00:00", 
    "description": "If I resize an instance to a flavor with more cpus than should be possible, even more cpus than cpu_allocation_ratio would allow, then nova proceeds with the resize and the instance state goes to error and it does exist anymore in the hypervisor. \n\nMy environment:\nNova 2014.1 (Icehouse)\nLibvirt / KVM hypervisor\nCeph RBD for volume storage\n1 nova-manage node, 2 nova-compute nodes (all virtualized on my laptop)\nUbuntu 14.04 for all OSes except for the instance\nCirros 0.3.2 for the instance \n/etc/nova/nova.conf on all nodes contain:\nallow_resize_to_same_host=true (although this didn't make a difference!)\nram_allocation_ratio=0.95\ncpu_allocation_ratio=5\n\nCPU and RAM allocation_ratio limits are set but only the memory limit took effect. This is from the log below:\nmemory limit: 1900.95 MB, free: 1388.95 MB\nCPUs limit not specified, defaulting to unlimited\n\nThis is the log from nova-compute.log when I resize an instance to a flavor with 500 vcpus:\n\nAUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\nAUDIT nova.compute.resource_tracker [-] Free ram (MB): 1489\nAUDIT nova.compute.resource_tracker [-] Free disk (GB): 34\nAUDIT nova.compute.resource_tracker [-] Free VCPUS: 2\nINFO nova.compute.resource_tracker [-] Compute_service record updated for r-ABCDEF1234:r-ABCDEF1234.vagrant.local\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Attempting claim: memory 500 MB, disk 1 GB, VCPUs 500\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Total memory: 2001 MB, used: 512.00 MB\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] memory limit: 1900.95 MB, free: 1388.95 MB\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Total disk: 34 GB, used: 0.00 GB\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] disk limit not specified, defaulting to unlimited\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Total CPUs: 2 VCPUs, used: 0.00 VCPUs\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] CPUs limit not specified, defaulting to unlimited\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Claim successful\nAUDIT nova.compute.resource_tracker [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] Updating from migration 75204b82-70e9-4e13-b56f-d7b78613cac7\nAUDIT nova.compute.manager [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Migrating\nWARNING nova.virt.libvirt.utils [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] systool is not installed\nWARNING nova.virt.libvirt.utils [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] systool is not installed\nINFO urllib3.connectionpool [-] Starting new HTTP connection (1): 192.168.55.253\nINFO oslo.messaging._drivers.impl_rabbit [-] Connected to AMQP server on 192.168.55.11:5672\nINFO nova.virt.libvirt.driver [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Creating image\nERROR glanceclient.common.http [-] Request returned failure status.\nWARNING nova.compute.utils [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Can't access image : Image  could not be found.\nINFO nova.virt.libvirt.firewall [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Called setup_basic_filtering in nwfilter\nINFO nova.virt.libvirt.firewall [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Ensuring static filters\nERROR nova.virt.libvirt.driver [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] An error occurred while trying to launch a defined domain with xml: <domain type='qemu'>\n  <name>instance-00000006</name>\n  <uuid>75204b82-70e9-4e13-b56f-d7b78613cac7</uuid>\n  <memory unit='KiB'>512000</memory>\n  <currentMemory unit='KiB'>512000</currentMemory>\n  <vcpu placement='static'>500</vcpu>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2014.1</entry>\n      <entry name='serial'>cffca416-65a2-48b5-ba0c-40ad122dc9d2</entry>\n      <entry name='uuid'>75204b82-70e9-4e13-b56f-d7b78613cac7</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-trusty'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu mode='host-model'>\n    <model fallback='allow'/>\n  </cpu>\n  <clock offset='utc'/>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-system-x86_64</emulator>\n    <disk type='network' device='disk'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <auth username='volumes'>\n        <secret type='ceph' uuid='d9002041-37e4-b53c-1d9e-a5e5ee7e3466'/>\n      </auth>\n      <source protocol='rbd' name='volumes/volume-22a7ae26-e55b-4aad-a3a1-bbee6ecd6abb'>\n        <host name='192.168.55.11' port='6789'/>\n      </source>\n      <target dev='vda' bus='virtio'/>\n      <serial>22a7ae26-e55b-4aad-a3a1-bbee6ecd6abb</serial>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:e3:8f:5d'/>\n      <source bridge='br101'/>\n      <model type='virtio'/>\n      <driver name='qemu'/>\n      <filterref filter='nova-instance-instance-00000006-fa163ee38f5d'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/var/lib/nova/instances/75204b82-70e9-4e13-b56f-d7b78613cac7/console.log'/>\n      <target port='0'/>\n    </serial>\n    <serial type='pty'>\n      <target port='1'/>\n    </serial>\n    <console type='file'>\n      <source path='/var/lib/nova/instances/75204b82-70e9-4e13-b56f-d7b78613cac7/console.log'/>\n      <target type='serial' port='0'/>\n    </console>\n    <input type='tablet' bus='usb'/>\n    <input type='mouse' bus='ps2'/>\n    <input type='keyboard' bus='ps2'/>\n    <graphics type='vnc' port='-1' autoport='yes' listen='192.168.55.101' keymap='en-us'>\n      <listen type='address' address='192.168.55.101'/>\n    </graphics>\n    <video>\n      <model type='cirrus' vram='9216' heads='1'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </video>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n    </memballoon>\n  </devices>\n</domain>\nERROR nova.compute.manager [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Setting instance vm_state to ERROR\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Traceback (most recent call last):\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3559, in finish_resize\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     disk_info, image)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3530, in _finish_resize\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     block_device_info, power_on)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5004, in finish_migration\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     block_device_info, power_on)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3644, in _create_domain_and_network\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     power_on=power_on)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3547, in _create_domain\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     domain.XMLDesc(0))\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     six.reraise(self.type_, self.value, self.tb)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3542, in _create_domain\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     domain.createWithFlags(launch_flags)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 179, in doit\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     result = proxy_call(self._autowrap, f, *args, **kwargs)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 139, in proxy_call\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     rv = execute(f,*args,**kwargs)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 77, in tworker\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     rv = meth(*args,**kwargs)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] libvirtError: unsupported configuration: Maximum CPUs greater than specified machine type limit\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] \nERROR oslo.messaging.rpc.dispatcher [-] Exception during message handling: unsupported configuration: Maximum CPUs greater than specified machine type limit\nTRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 133, in _dispatch_and_reply\nTRACE oslo.messaging.rpc.dispatcher     incoming.message))\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 176, in _dispatch\nTRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 122, in _do_dispatch\nTRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\nTRACE oslo.messaging.rpc.dispatcher     payload)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\nTRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 280, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     pass\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 266, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 333, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     function(self, context, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 254, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     break\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 235, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 309, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     e, sys.exc_info())\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 296, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3571, in finish_resize\nTRACE oslo.messaging.rpc.dispatcher     self._set_instance_error_state(context, instance['uuid'])\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3559, in finish_resize\nTRACE oslo.messaging.rpc.dispatcher     disk_info, image)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3530, in _finish_resize\nTRACE oslo.messaging.rpc.dispatcher     block_device_info, power_on)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5004, in finish_migration\nTRACE oslo.messaging.rpc.dispatcher     block_device_info, power_on)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3644, in _create_domain_and_network\nTRACE oslo.messaging.rpc.dispatcher     power_on=power_on)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3547, in _create_domain\nTRACE oslo.messaging.rpc.dispatcher     domain.XMLDesc(0))\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3542, in _create_domain\nTRACE oslo.messaging.rpc.dispatcher     domain.createWithFlags(launch_flags)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 179, in doit\nTRACE oslo.messaging.rpc.dispatcher     result = proxy_call(self._autowrap, f, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 139, in proxy_call\nTRACE oslo.messaging.rpc.dispatcher     rv = execute(f,*args,**kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 77, in tworker\nTRACE oslo.messaging.rpc.dispatcher     rv = meth(*args,**kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\nTRACE oslo.messaging.rpc.dispatcher     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\nTRACE oslo.messaging.rpc.dispatcher libvirtError: unsupported configuration: Maximum CPUs greater than specified machine type limit\nAUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\nWARNING nova.compute.resource_tracker [-] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Instance not resizing, skipping migration.\nAUDIT nova.compute.resource_tracker [-] Free ram (MB): 989\nAUDIT nova.compute.resource_tracker [-] Free disk (GB): 33\nAUDIT nova.compute.resource_tracker [-] Free VCPUS: -498\nWARNING nova.compute.manager [-] Found 1 in the database and 0 on the hypervisor.", 
    "tags": [
        "compute"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1338822", 
    "owner": "None", 
    "id": 1338822, 
    "index": 4982, 
    "created": "2014-07-07 23:02:12.936237+00:00", 
    "title": "CPU limit not used in instance resize", 
    "comments": [
        {
            "content": "If I resize an instance to a flavor with more cpus than should be possible, even more cpus than cpu_allocation_ratio would allow, then nova proceeds with the resize and the instance state goes to error and it does exist anymore in the hypervisor. \n\nMy environment:\nNova 2014.1 (Icehouse)\nLibvirt / KVM hypervisor\nCeph RBD for volume storage\n1 nova-manage node, 2 nova-compute nodes (all virtualized on my laptop)\nUbuntu 14.04 for all OSes except for the instance\nCirros 0.3.2 for the instance \n/etc/nova/nova.conf on all nodes contain:\nallow_resize_to_same_host=true (although this didn't make a difference!)\nram_allocation_ratio=0.95\ncpu_allocation_ratio=5\n\nCPU and RAM allocation_ratio limits are set but only the memory limit took effect. This is from the log below:\nmemory limit: 1900.95 MB, free: 1388.95 MB\nCPUs limit not specified, defaulting to unlimited\n\nThis is the log from nova-compute.log when I resize an instance to a flavor with 500 vcpus:\n\nAUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\nAUDIT nova.compute.resource_tracker [-] Free ram (MB): 1489\nAUDIT nova.compute.resource_tracker [-] Free disk (GB): 34\nAUDIT nova.compute.resource_tracker [-] Free VCPUS: 2\nINFO nova.compute.resource_tracker [-] Compute_service record updated for r-ABCDEF1234:r-ABCDEF1234.vagrant.local\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Attempting claim: memory 500 MB, disk 1 GB, VCPUs 500\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Total memory: 2001 MB, used: 512.00 MB\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] memory limit: 1900.95 MB, free: 1388.95 MB\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Total disk: 34 GB, used: 0.00 GB\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] disk limit not specified, defaulting to unlimited\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Total CPUs: 2 VCPUs, used: 0.00 VCPUs\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] CPUs limit not specified, defaulting to unlimited\nAUDIT nova.compute.claims [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Claim successful\nAUDIT nova.compute.resource_tracker [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] Updating from migration 75204b82-70e9-4e13-b56f-d7b78613cac7\nAUDIT nova.compute.manager [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Migrating\nWARNING nova.virt.libvirt.utils [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] systool is not installed\nWARNING nova.virt.libvirt.utils [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] systool is not installed\nINFO urllib3.connectionpool [-] Starting new HTTP connection (1): 192.168.55.253\nINFO oslo.messaging._drivers.impl_rabbit [-] Connected to AMQP server on 192.168.55.11:5672\nINFO nova.virt.libvirt.driver [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Creating image\nERROR glanceclient.common.http [-] Request returned failure status.\nWARNING nova.compute.utils [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Can't access image : Image  could not be found.\nINFO nova.virt.libvirt.firewall [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Called setup_basic_filtering in nwfilter\nINFO nova.virt.libvirt.firewall [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Ensuring static filters\nERROR nova.virt.libvirt.driver [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] An error occurred while trying to launch a defined domain with xml: <domain type='qemu'>\n  <name>instance-00000006</name>\n  <uuid>75204b82-70e9-4e13-b56f-d7b78613cac7</uuid>\n  <memory unit='KiB'>512000</memory>\n  <currentMemory unit='KiB'>512000</currentMemory>\n  <vcpu placement='static'>500</vcpu>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2014.1</entry>\n      <entry name='serial'>cffca416-65a2-48b5-ba0c-40ad122dc9d2</entry>\n      <entry name='uuid'>75204b82-70e9-4e13-b56f-d7b78613cac7</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-trusty'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu mode='host-model'>\n    <model fallback='allow'/>\n  </cpu>\n  <clock offset='utc'/>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-system-x86_64</emulator>\n    <disk type='network' device='disk'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <auth username='volumes'>\n        <secret type='ceph' uuid='d9002041-37e4-b53c-1d9e-a5e5ee7e3466'/>\n      </auth>\n      <source protocol='rbd' name='volumes/volume-22a7ae26-e55b-4aad-a3a1-bbee6ecd6abb'>\n        <host name='192.168.55.11' port='6789'/>\n      </source>\n      <target dev='vda' bus='virtio'/>\n      <serial>22a7ae26-e55b-4aad-a3a1-bbee6ecd6abb</serial>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:e3:8f:5d'/>\n      <source bridge='br101'/>\n      <model type='virtio'/>\n      <driver name='qemu'/>\n      <filterref filter='nova-instance-instance-00000006-fa163ee38f5d'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/var/lib/nova/instances/75204b82-70e9-4e13-b56f-d7b78613cac7/console.log'/>\n      <target port='0'/>\n    </serial>\n    <serial type='pty'>\n      <target port='1'/>\n    </serial>\n    <console type='file'>\n      <source path='/var/lib/nova/instances/75204b82-70e9-4e13-b56f-d7b78613cac7/console.log'/>\n      <target type='serial' port='0'/>\n    </console>\n    <input type='tablet' bus='usb'/>\n    <input type='mouse' bus='ps2'/>\n    <input type='keyboard' bus='ps2'/>\n    <graphics type='vnc' port='-1' autoport='yes' listen='192.168.55.101' keymap='en-us'>\n      <listen type='address' address='192.168.55.101'/>\n    </graphics>\n    <video>\n      <model type='cirrus' vram='9216' heads='1'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </video>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n    </memballoon>\n  </devices>\n</domain>\nERROR nova.compute.manager [req-960d005b-0ca5-434b-96dc-e1e7575aef0f 49e16f440dcc4dffa485132bf4c1fceb a5a08d831062498995090b1fb6e7fdf2] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Setting instance vm_state to ERROR\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Traceback (most recent call last):\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3559, in finish_resize\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     disk_info, image)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3530, in _finish_resize\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     block_device_info, power_on)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5004, in finish_migration\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     block_device_info, power_on)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3644, in _create_domain_and_network\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     power_on=power_on)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3547, in _create_domain\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     domain.XMLDesc(0))\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     six.reraise(self.type_, self.value, self.tb)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3542, in _create_domain\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     domain.createWithFlags(launch_flags)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 179, in doit\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     result = proxy_call(self._autowrap, f, *args, **kwargs)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 139, in proxy_call\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     rv = execute(f,*args,**kwargs)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 77, in tworker\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     rv = meth(*args,**kwargs)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] libvirtError: unsupported configuration: Maximum CPUs greater than specified machine type limit\nTRACE nova.compute.manager [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] \nERROR oslo.messaging.rpc.dispatcher [-] Exception during message handling: unsupported configuration: Maximum CPUs greater than specified machine type limit\nTRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 133, in _dispatch_and_reply\nTRACE oslo.messaging.rpc.dispatcher     incoming.message))\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 176, in _dispatch\nTRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 122, in _do_dispatch\nTRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\nTRACE oslo.messaging.rpc.dispatcher     payload)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\nTRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 280, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     pass\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 266, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 333, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     function(self, context, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 254, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     break\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 235, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 309, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     e, sys.exc_info())\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 296, in decorated_function\nTRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3571, in finish_resize\nTRACE oslo.messaging.rpc.dispatcher     self._set_instance_error_state(context, instance['uuid'])\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3559, in finish_resize\nTRACE oslo.messaging.rpc.dispatcher     disk_info, image)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3530, in _finish_resize\nTRACE oslo.messaging.rpc.dispatcher     block_device_info, power_on)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 5004, in finish_migration\nTRACE oslo.messaging.rpc.dispatcher     block_device_info, power_on)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3644, in _create_domain_and_network\nTRACE oslo.messaging.rpc.dispatcher     power_on=power_on)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3547, in _create_domain\nTRACE oslo.messaging.rpc.dispatcher     domain.XMLDesc(0))\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\nTRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 3542, in _create_domain\nTRACE oslo.messaging.rpc.dispatcher     domain.createWithFlags(launch_flags)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 179, in doit\nTRACE oslo.messaging.rpc.dispatcher     result = proxy_call(self._autowrap, f, *args, **kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 139, in proxy_call\nTRACE oslo.messaging.rpc.dispatcher     rv = execute(f,*args,**kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 77, in tworker\nTRACE oslo.messaging.rpc.dispatcher     rv = meth(*args,**kwargs)\nTRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\nTRACE oslo.messaging.rpc.dispatcher     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\nTRACE oslo.messaging.rpc.dispatcher libvirtError: unsupported configuration: Maximum CPUs greater than specified machine type limit\nAUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\nWARNING nova.compute.resource_tracker [-] [instance: 75204b82-70e9-4e13-b56f-d7b78613cac7] Instance not resizing, skipping migration.\nAUDIT nova.compute.resource_tracker [-] Free ram (MB): 989\nAUDIT nova.compute.resource_tracker [-] Free disk (GB): 33\nAUDIT nova.compute.resource_tracker [-] Free VCPUS: -498\nWARNING nova.compute.manager [-] Found 1 in the database and 0 on the hypervisor.", 
            "date_created": "2014-07-07 23:02:12.936237+00:00", 
            "author": "https://api.launchpad.net/1.0/~daniel-snider"
        }, 
        {
            "content": "It turns out that my nova.conf needed the following line to make the scheduler enforce CPU limits.\n\nscheduler_default_filters=CoreFilter\n\nNot having this was the cause of what I thought was a bug.", 
            "date_created": "2014-07-18 14:10:19.241415+00:00", 
            "author": "https://api.launchpad.net/1.0/~daniel-snider"
        }, 
        {
            "content": "Daniel, good to hear. However, it should probably still fail gracefully when this happens. I'm going to continue looking into this.", 
            "date_created": "2014-07-21 14:39:14.672802+00:00", 
            "author": "https://api.launchpad.net/1.0/~mjturek"
        }, 
        {
            "content": "More people would avoid this problem if CoreFilter was enabled by default. Why isn't it?", 
            "date_created": "2014-07-24 15:55:06.711422+00:00", 
            "author": "https://api.launchpad.net/1.0/~daniel-snider"
        }, 
        {
            "content": "I'm going to mark this as not a bug, since you were able to get the desired behavior by configuration.\r\n\r\nAs for why CoreFilter isn't in the default filters, these types of items are part of an ongoing effort in the community to make OpenStack better for operators. The program facilitates communication between operators and developers so any issues with running OpenStack can be addressed. Please see the following links on how you can join this effort, get answers, and bring about changes that are important to you.\r\n\r\nThis blog post [1] should give you the information you need to get started, by signing up for the openstack-operators mailing list and checking out prior discussions captured in the etherpad (one of them is \"Reasonable Defaults\").\r\n\r\nI hope this helps.\r\n\r\n[1] http://www.openstack.org/blog/2014/04/openstack-summit-now-with-more-ops/", 
            "date_created": "2014-07-25 00:57:29.745743+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }, 
        {
            "content": "As a follow up, I just looked at the docs on the scheduler filters and the CoreFilter [1]. Not including CoreFilter allows unlimited over-provisioning of CPUs (cpu_allocation_ratio is only considered if CoreFilter is included in your filters). I think overcommit of CPU is the most common use case, so to include CoreFilter as a default, we'd have to agree on a reasonable ratio.\n\n[1] http://docs.openstack.org/icehouse/config-reference/content/section_compute-scheduler.html#corefilter", 
            "date_created": "2014-07-25 01:18:15.317564+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }
    ]
}