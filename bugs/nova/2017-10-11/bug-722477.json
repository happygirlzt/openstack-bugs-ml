{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:33:56.205498+00:00", 
    "description": "I tried to spawn 10 instances (using two nova-compute nodes) and got the following error for 1 instance. In front of the error I saw a lot of calls to iptables-save. I guess iptables-restore is called to fast after the last iptables-save (appr. 15ms later).\n\n[...]\n2011-02-21 07:58:11,340 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 07:58:11 2011\n[...]\n2011-02-21 08:10:17,011 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:16 2011\n[...]\n2011-02-21 08:10:17,623 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:17 2011\n[...]\n2011-02-21 08:10:19,403 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:18 2011\n[...]\n2011-02-21 08:10:19,868 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:18 2011\n[...]\n2011-02-21 08:10:20,339 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:18 2011\n\n2011-02-21 08:10:20,354 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 116, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 408, in spawn\n(nova.exception): TRACE:     self.firewall_driver.prepare_instance_filter(instance)\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 1237, in prepare_instance_filter\n(nova.exception): TRACE:     self.apply_ruleset()\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 1244, in apply_ruleset\n(nova.exception): TRACE:     process_input='\\n'.join(new_filter))\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/utils.py\", line 149, in execute\n(nova.exception): TRACE:     cmd=cmd)\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: sudo iptables-restore\n(nova.exception): TRACE: Exit code: 1\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: 'iptables-restore: line 63 failed\\n'\n(nova.exception): TRACE:\n2011-02-21 08:10:20,403 ERROR nova.compute.manager [BPEOLIU1NEACKYYV2QW2 berendt testing] instance 42: Failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 213, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 122, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: Unexpected error while running command.\n(nova.compute.manager): TRACE: Command: sudo iptables-restore\n(nova.compute.manager): TRACE: Exit code: 1\n(nova.compute.manager): TRACE: Stdout: ''\n(nova.compute.manager): TRACE: Stderr: 'iptables-restore: line 63 failed\\n'\n(nova.compute.manager): TRACE:\n\n\nINSTANCE        i-0000002a      ami-2a1izx00    192.168.3.10    192.168.3.10    failed to spawn         testing (testing, ares)         6       m1.tiny         2011-02-21 07:10:16     nova", 
    "tags": [], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/722477", 
    "owner": "https://api.launchpad.net/1.0/~soren", 
    "id": 722477, 
    "index": 359, 
    "created": "2011-02-21 07:17:25.081193+00:00", 
    "title": "iptables-restore failed", 
    "comments": [
        {
            "content": "I tried to spawn 10 instances (using two nova-compute nodes) and got the following error for 1 instance. In front of the error I saw a lot of calls to iptables-save. I guess iptables-restore is called to fast after the last iptables-save (appr. 15ms later).\n\n[...]\n2011-02-21 07:58:11,340 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 07:58:11 2011\n[...]\n2011-02-21 08:10:17,011 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:16 2011\n[...]\n2011-02-21 08:10:17,623 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:17 2011\n[...]\n2011-02-21 08:10:19,403 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:18 2011\n[...]\n2011-02-21 08:10:19,868 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:18 2011\n[...]\n2011-02-21 08:10:20,339 INFO nova.root [-] new_filter: # Generated by iptables-save v1.4.6 on Mon Feb 21 08:10:18 2011\n\n2011-02-21 08:10:20,354 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 116, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 408, in spawn\n(nova.exception): TRACE:     self.firewall_driver.prepare_instance_filter(instance)\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 1237, in prepare_instance_filter\n(nova.exception): TRACE:     self.apply_ruleset()\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 1244, in apply_ruleset\n(nova.exception): TRACE:     process_input='\\n'.join(new_filter))\n(nova.exception): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/utils.py\", line 149, in execute\n(nova.exception): TRACE:     cmd=cmd)\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: sudo iptables-restore\n(nova.exception): TRACE: Exit code: 1\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: 'iptables-restore: line 63 failed\\n'\n(nova.exception): TRACE:\n2011-02-21 08:10:20,403 ERROR nova.compute.manager [BPEOLIU1NEACKYYV2QW2 berendt testing] instance 42: Failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 213, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 122, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: Unexpected error while running command.\n(nova.compute.manager): TRACE: Command: sudo iptables-restore\n(nova.compute.manager): TRACE: Exit code: 1\n(nova.compute.manager): TRACE: Stdout: ''\n(nova.compute.manager): TRACE: Stderr: 'iptables-restore: line 63 failed\\n'\n(nova.compute.manager): TRACE:\n\n\nINSTANCE        i-0000002a      ami-2a1izx00    192.168.3.10    192.168.3.10    failed to spawn         testing (testing, ares)         6       m1.tiny         2011-02-21 07:10:16     nova", 
            "date_created": "2011-02-21 07:17:25.081193+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "Thanks for the bug report. I'm reworking our iptables handing to address this exact issue. I expect to finish this today.", 
            "date_created": "2011-02-21 07:30:43.445976+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }
    ]
}