{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:15:55.545530+00:00", 
    "description": "When a delete is issued for an instance that doesn't have a cell_name in the db, a delete is broadcast to all cells. As that message passes through the cells rpc layer the instance is converted from an object to a dict. This causes a problem when it gets to the cell since the delete methods expect to receive an object.\n\n2014-03-13 15:21:49.717 31063 ERROR nova.cells.messaging [req-d2d5f4ea-4010-405a-b52a-8f19d3991498 10110789 5877036] Error processing message locally: 'dict' object has no attribute 'disable_terminate'\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging Traceback (most recent call last):\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/cells/messaging.py\", line 211, in _process_locally\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging resp_value = self.msg_runner._process_message_locally(self)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/cells/messaging.py\", line 1291, in _process_message_locally\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return fn(message, **message.method_kwargs)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/cells/messaging.py\", line 1101, in instance_delete_everywhere\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging self.compute_api.delete(message.ctxt, instance)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 199, in wrapped\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return func(self, context, target, *args, **kwargs)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 189, in inner\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return function(self, context, instance, *args, **kwargs)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 216, in _wrapped\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return fn(self, context, instance, *args, **kwargs)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 170, in inner\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return f(self, context, instance, *args, **kw)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 1710, in delete\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging self._delete_instance(context, instance)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 1700, in _delete_instance\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging task_state=task_states.DELETING)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 1395, in _delete\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging if instance.disable_terminate:\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging AttributeError: 'dict' object has no attribute 'disable_terminate'\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging", 
    "tags": [
        "cells", 
        "icehouse-rc-potential"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1293750", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1293750, 
    "index": 3837, 
    "created": "2014-03-17 18:56:36.528828+00:00", 
    "title": "Cells: AttributeError: 'dict' object has no attribute 'disable_terminate'", 
    "comments": [
        {
            "content": "When a delete is issued for an instance that doesn't have a cell_name in the db, a delete is broadcast to all cells. As that message passes through the cells rpc layer the instance is converted from an object to a dict. This causes a problem when it gets to the cell since the delete methods expect to receive an object.\n\n2014-03-13 15:21:49.717 31063 ERROR nova.cells.messaging [req-d2d5f4ea-4010-405a-b52a-8f19d3991498 10110789 5877036] Error processing message locally: 'dict' object has no attribute 'disable_terminate'\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging Traceback (most recent call last):\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/cells/messaging.py\", line 211, in _process_locally\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging resp_value = self.msg_runner._process_message_locally(self)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/cells/messaging.py\", line 1291, in _process_message_locally\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return fn(message, **message.method_kwargs)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/cells/messaging.py\", line 1101, in instance_delete_everywhere\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging self.compute_api.delete(message.ctxt, instance)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 199, in wrapped\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return func(self, context, target, *args, **kwargs)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 189, in inner\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return function(self, context, instance, *args, **kwargs)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 216, in _wrapped\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return fn(self, context, instance, *args, **kwargs)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 170, in inner\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging return f(self, context, instance, *args, **kw)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 1710, in delete\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging self._delete_instance(context, instance)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 1700, in _delete_instance\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging task_state=task_states.DELETING)\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging File \"/opt/rackstack/615.4/nova/lib/python2.6/site-packages/nova/compute/api.py\", line 1395, in _delete\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging if instance.disable_terminate:\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging AttributeError: 'dict' object has no attribute 'disable_terminate'\n2014-03-13 15:21:49.717 31063 TRACE nova.cells.messaging", 
            "date_created": "2014-03-17 18:56:36.528828+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/81049", 
            "date_created": "2014-03-17 19:08:39.892155+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/81049\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8e3dc81837ddb76dff5267ff5fbbd750b20fc31f\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8e3dc81837ddb76dff5267ff5fbbd750b20fc31f\nAuthor: Andrew Laski <email address hidden>\nDate:   Mon Mar 17 15:06:48 2014 -0400\n\n    Cells: Send instance object for instance_delete_everywhere\n    \n    The delete method in the compute api expects an instance object to be\n    passed in. So the instance object needs to not be to_primitived in the\n    instance_delete_everywhere rpc method.\n    \n    Change-Id: I620ec57bc28ba11335758455c7cac0bfa63f5b37\n    Closes-bug: #1293750\n", 
            "date_created": "2014-03-20 02:51:03.988161+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}