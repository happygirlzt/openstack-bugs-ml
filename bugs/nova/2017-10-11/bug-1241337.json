{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 08:54:19.280672+00:00", 
    "description": "\n1) nova suspend vm2\n2) nova attach vm2 6ac2e985-9586-438f-a027-bc9591fa5b43 /dev/sdb\n3) nova volume-attach vm2 6ac2e985-9586-438f-a027-bc9591fa5b43 /dev/sdb\n4) nova resume vm2\n\nVM failed to resume and nova compute report the following errors.\n\n2013-10-18 12:16:33.175 ERROR nova.openstack.common.rpc.amqp [req-a8b196e3-dbd5-45f4-814e-56a715b07fdf admin admin] Exception during message handling\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 354, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 244, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     pass\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 230, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 295, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 272, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 259, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3314, in resume_instance\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1969, in resume\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3206, in _create_domain_and_network\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     {'connection_info': jsonutils.dumps(connection_info)})\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 420, in block_device_mapping_update\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     context, bdm_id, values)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/conductor/api.py\", line 170, in block_device_mapping_update\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     context, values, create=False)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 244, in block_device_mapping_update_or_create\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     values=values, create=create)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/rpcclient.py\", line 85, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/rpcclient.py\", line 63, in _invoke\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return cast_or_call(ctxt, msg, **self.kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/proxy.py\", line 126, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     result = rpc.call(context, real_topic, msg, timeout)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/__init__.py\", line 139, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/impl_kombu.py\", line 816, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     rpc_amqp.get_connection_pool(conf, Connection))\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 572, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     rv = multicall(conf, context, topic, msg, timeout, connection_pool)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 558, in multicall\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     pack_context(msg, context)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 308, in pack_context\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     for (key, value) in context.to_dict().iteritems()])\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp AttributeError: 'NoneType' object has no attribute 'to_dict'\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [
        "havana-backport-potential", 
        "in-stable-havana"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1241337", 
    "owner": "https://api.launchpad.net/1.0/~jay-lau-513", 
    "id": 1241337, 
    "index": 3661, 
    "created": "2013-10-18 04:19:19.340037+00:00", 
    "title": "VM do not resume if attach an volume when suspended", 
    "comments": [
        {
            "content": "\n1) nova suspend vm2\n2) nova attach vm2 6ac2e985-9586-438f-a027-bc9591fa5b43 /dev/sdb\n3) nova volume-attach vm2 6ac2e985-9586-438f-a027-bc9591fa5b43 /dev/sdb\n4) nova resume vm2\n\nVM failed to resume and nova compute report the following errors.\n\n2013-10-18 12:16:33.175 ERROR nova.openstack.common.rpc.amqp [req-a8b196e3-dbd5-45f4-814e-56a715b07fdf admin admin] Exception during message handling\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 354, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 244, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     pass\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 230, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 295, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 272, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 259, in decorated_function\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3314, in resume_instance\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1969, in resume\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3206, in _create_domain_and_network\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     {'connection_info': jsonutils.dumps(connection_info)})\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 420, in block_device_mapping_update\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     context, bdm_id, values)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/conductor/api.py\", line 170, in block_device_mapping_update\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     context, values, create=False)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 244, in block_device_mapping_update_or_create\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     values=values, create=create)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/rpcclient.py\", line 85, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/rpcclient.py\", line 63, in _invoke\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return cast_or_call(ctxt, msg, **self.kwargs)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/proxy.py\", line 126, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     result = rpc.call(context, real_topic, msg, timeout)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/__init__.py\", line 139, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/impl_kombu.py\", line 816, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     rpc_amqp.get_connection_pool(conf, Connection))\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 572, in call\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     rv = multicall(conf, context, topic, msg, timeout, connection_pool)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 558, in multicall\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     pack_context(msg, context)\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 308, in pack_context\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp     for (key, value) in context.to_dict().iteritems()])\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp AttributeError: 'NoneType' object has no attribute 'to_dict'\n2013-10-18 12:16:33.175 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2013-10-18 04:19:19.340037+00:00", 
            "author": "https://api.launchpad.net/1.0/~jay-lau-513"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/52581", 
            "date_created": "2013-10-18 07:32:07.836090+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/52581\nCommitted: http://github.com/openstack/nova/commit/de4158861000dedc204314c545cc5682aa38f5f1\nSubmitter: Jenkins\nBranch:    master\n\ncommit de4158861000dedc204314c545cc5682aa38f5f1\nAuthor: Jay Lau <email address hidden>\nDate:   Thu Nov 14 22:12:27 2013 +0800\n\n    Add context as parameter for resume\n    \n    Now for KVM when resume an instance with block storage, nova\n    compute will throw exception and failed to resume the VM.\n    \n    The root cause is that when resume a VM with block storage,\n    libvirt driver needs to call conductor via rpcapi to update\n    block device, but the function of resume() do not have context,\n    this will cause RPC api failed.\n    \n    Change-Id: I712777ed1d893a2b6463d30c407b0a677e37b602\n    Closes-Bug: #1241337\n", 
            "date_created": "2013-11-26 14:42:16.343242+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/havana\nReview: https://review.openstack.org/59872", 
            "date_created": "2013-12-03 23:33:27.619238+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/59872\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=b56453526f52b6f962e8a3a324050349e87a3f65\nSubmitter: Jenkins\nBranch:    stable/havana\n\ncommit b56453526f52b6f962e8a3a324050349e87a3f65\nAuthor: Jay Lau <email address hidden>\nDate:   Thu Nov 14 22:12:27 2013 +0800\n\n    Add context as parameter for resume\n    \n    Now for KVM when resume an instance with block storage, nova\n    compute will throw exception and failed to resume the VM.\n    \n    The root cause is that when resume a VM with block storage,\n    libvirt driver needs to call conductor via rpcapi to update\n    block device, but the function of resume() do not have context,\n    this will cause RPC api failed.\n    \n    Change-Id: I712777ed1d893a2b6463d30c407b0a677e37b602\n    Closes-Bug: #1241337\n    (cherry picked from commit de4158861000dedc204314c545cc5682aa38f5f1)\n", 
            "date_created": "2013-12-26 09:55:14.924518+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}