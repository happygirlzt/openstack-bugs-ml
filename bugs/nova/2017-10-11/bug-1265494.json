{
    "status": "Fix Released", 
    "last_updated": "2015-01-11 09:55:30.373931+00:00", 
    "description": "Description of problem:\nUnpauseing an instance fails if host has rebooted. \n\nVersion-Release number of selected component (if applicable):\nRHEL: release 6.5 (Santiago)\nopenstack-nova-api-2013.2.1-1.el6ost.noarch\nopenstack-nova-compute-2013.2.1-1.el6ost.noarch\nopenstack-nova-scheduler-2013.2.1-1.el6ost.noarch\nopenstack-nova-common-2013.2.1-1.el6ost.noarch\nopenstack-nova-console-2013.2.1-1.el6ost.noarch\nopenstack-nova-conductor-2013.2.1-1.el6ost.noarch\nopenstack-nova-novncproxy-2013.2.1-1.el6ost.noarch\nopenstack-nova-cert-2013.2.1-1.el6ost.noarch\n\nHow reproducible:\nEvery time \n\nSteps to Reproduce:\n1. Boot an instance \n2. Pause that instance\n3. Reboot host\n4. Unpause instance  \n\nActual results:\ncan't unpause instance stuck in status paused, power state - shutdown\n\nExpected results:\nInstance should unpause, return to running state\n\nAdditional info:\n\nvirsh list -all --managed-save \nID is missing from paused instance \"-\" (pausecirros), state -> shut off.\n\n[root@orange-vdse ~(keystone_admin)]# virsh list --all --managed-save\n Id    Name                           State\n----------------------------------------------------\n 1     instance-00000003              running\n 2     instance-00000002              running\n -     instance-00000001              shut off\n\n[root@orange-vdse ~(keystone_admin)]# nova list  (notice nova status paused)\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n| ID                                   | Name          | Status | Task State | Power State | Networks        |\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n| ebe310c2-d715-45e5-83b6-32717af1ac90 | cirros        | ACTIVE | None       | Running     | net=192.168.1.4 |\n| 3ef89feb-414f-4524-b806-f14044efdb14 | pausecirros   | PAUSED | None       | Shutdown    | net=192.168.1.5 |\n| 8bcae041-2f92-4ae2-a2c2-ee59b067ac76 | suspendcirros | ACTIVE | None       | Running     | net=192.168.1.2 |\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n\n\nTesting without rebooting host, ID/state (\"1\"/paused) instance (cirros) are ok and it unpauses ok.\n\n[root@orange-vdse ~(keystone_admin)]# virsh list --all --managed-save\n Id    Name                           State\n----------------------------------------------------\n 1     instance-00000003              paused\n 2     instance-00000002              running\n -     instance-00000001              shut off\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n| ID                                   | Name          | Status | Task State | Power State | Networks        |\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n| ebe310c2-d715-45e5-83b6-32717af1ac90 | cirros        | PAUSED | None       | Paused      | net=192.168.1.4 |\n| 3ef89feb-414f-4524-b806-f14044efdb14 | pausecirros   | PAUSED | None       | Shutdown    | net=192.168.1.5 |\n| 8bcae041-2f92-4ae2-a2c2-ee59b067ac76 | suspendcirros | ACTIVE | None       | Running     | net=192.168.1.2 |\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+", 
    "tags": [
        "icehouse-rc-potential", 
        "libvirt"
    ], 
    "importance": "High", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1265494", 
    "owner": "None", 
    "id": 1265494, 
    "index": 1358, 
    "created": "2014-01-02 12:08:19.767977+00:00", 
    "title": "Openstack Nova: Unpause after host reboot fails", 
    "comments": [
        {
            "content": "Description of problem:\nUnpauseing an instance fails if host has rebooted. \n\nVersion-Release number of selected component (if applicable):\nRHEL: release 6.5 (Santiago)\nopenstack-nova-api-2013.2.1-1.el6ost.noarch\nopenstack-nova-compute-2013.2.1-1.el6ost.noarch\nopenstack-nova-scheduler-2013.2.1-1.el6ost.noarch\nopenstack-nova-common-2013.2.1-1.el6ost.noarch\nopenstack-nova-console-2013.2.1-1.el6ost.noarch\nopenstack-nova-conductor-2013.2.1-1.el6ost.noarch\nopenstack-nova-novncproxy-2013.2.1-1.el6ost.noarch\nopenstack-nova-cert-2013.2.1-1.el6ost.noarch\n\nHow reproducible:\nEvery time \n\nSteps to Reproduce:\n1. Boot an instance \n2. Pause that instance\n3. Reboot host\n4. Unpause instance  \n\nActual results:\ncan't unpause instance stuck in status paused, power state - shutdown\n\nExpected results:\nInstance should unpause, return to running state\n\nAdditional info:\n\nvirsh list -all --managed-save \nID is missing from paused instance \"-\" (pausecirros), state -> shut off.\n\n[root@orange-vdse ~(keystone_admin)]# virsh list --all --managed-save\n Id    Name                           State\n----------------------------------------------------\n 1     instance-00000003              running\n 2     instance-00000002              running\n -     instance-00000001              shut off\n\n[root@orange-vdse ~(keystone_admin)]# nova list  (notice nova status paused)\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n| ID                                   | Name          | Status | Task State | Power State | Networks        |\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n| ebe310c2-d715-45e5-83b6-32717af1ac90 | cirros        | ACTIVE | None       | Running     | net=192.168.1.4 |\n| 3ef89feb-414f-4524-b806-f14044efdb14 | pausecirros   | PAUSED | None       | Shutdown    | net=192.168.1.5 |\n| 8bcae041-2f92-4ae2-a2c2-ee59b067ac76 | suspendcirros | ACTIVE | None       | Running     | net=192.168.1.2 |\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n\n\nTesting without rebooting host, ID/state (\"1\"/paused) instance (cirros) are ok and it unpauses ok.\n\n[root@orange-vdse ~(keystone_admin)]# virsh list --all --managed-save\n Id    Name                           State\n----------------------------------------------------\n 1     instance-00000003              paused\n 2     instance-00000002              running\n -     instance-00000001              shut off\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n| ID                                   | Name          | Status | Task State | Power State | Networks        |\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+\n| ebe310c2-d715-45e5-83b6-32717af1ac90 | cirros        | PAUSED | None       | Paused      | net=192.168.1.4 |\n| 3ef89feb-414f-4524-b806-f14044efdb14 | pausecirros   | PAUSED | None       | Shutdown    | net=192.168.1.5 |\n| 8bcae041-2f92-4ae2-a2c2-ee59b067ac76 | suspendcirros | ACTIVE | None       | Running     | net=192.168.1.2 |\n+--------------------------------------+---------------+--------+------------+-------------+-----------------+", 
            "date_created": "2014-01-02 12:08:19.767977+00:00", 
            "author": "https://api.launchpad.net/1.0/~tshefi"
        }, 
        {
            "content": "The instance cannot be unpaused after reboot because it is in the shutdown power state and libvirt expects it to be in the managedsave state.\n\nThere is the resume_guests_state_on_host_boot flag in nova that instructs nova to restore the instance's state after booting. This is only done for instances that where running before shutting down, other states are ignored.", 
            "date_created": "2014-01-15 11:37:43.342904+00:00", 
            "author": "https://api.launchpad.net/1.0/~xqueralt-deactivatedaccount"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/68690", 
            "date_created": "2014-01-23 16:41:52.798428+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/68690\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=6abda5b738c5d801ede3328cf0ec1dc9dddc022f\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6abda5b738c5d801ede3328cf0ec1dc9dddc022f\nAuthor: Xavier Queralt <email address hidden>\nDate:   Thu Jan 23 13:53:37 2014 +0100\n\n    Correct the state for PAUSED instances on reboot\n    \n    If an instance is in the PAUSED state before the compute node is\n    restarted, it will be left in an inconsistent state (impossible to\n    delete and/or restart it) after the node boots again.\n    \n    This patch adds a check in the periodic task sync_power_state so when\n    this situation is detected the instance is stopped and left in a state\n    from where it can be started again or deleted.\n    \n    Closes-Bug: #1265494\n    Change-Id: I7266ace596598522c28a3839091ef50faf4463c2\n", 
            "date_created": "2014-03-15 20:56:37.629506+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/70940\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=590519a036ec7247a273231750ab6d2030aed360\nSubmitter: Jenkins\nBranch:    stable/havana\n\ncommit 590519a036ec7247a273231750ab6d2030aed360\nAuthor: Xavier Queralt <email address hidden>\nDate:   Thu Jan 23 13:53:37 2014 +0100\n\n    Correct the state for PAUSED instances on reboot\n    \n    If an instance is in the PAUSED state before the compute node is\n    restarted, it will be left in an inconsistent state (impossible to\n    delete and/or restart it) after the node boots again.\n    \n    This patch adds a check in the periodic task sync_power_state so when\n    this situation is detected the instance is stopped and left in a state\n    from where it can be started again or deleted.\n    \n    Closes-Bug: #1265494\n    Change-Id: I7266ace596598522c28a3839091ef50faf4463c2\n    (cherry picked from commit 6abda5b738c5d801ede3328cf0ec1dc9dddc022f)\n", 
            "date_created": "2014-03-18 00:40:08.691355+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I have an instance in this state that I need to recover. Is there any way to get it started again manually?", 
            "date_created": "2015-01-09 06:54:18.167416+00:00", 
            "author": "https://api.launchpad.net/1.0/~stevej"
        }, 
        {
            "content": "Hi Steve \n\nI've just tested this on my Juno setup, booted an instance then paused it, reboot host (All in one node). \nInstance status after reboot is shutdown, softreboot command didn't work, but hardreboot worked - instance is now running. \n\nWhich version of Openstack are you running? \nWhat's the instance's OS? \n\n", 
            "date_created": "2015-01-11 09:55:28.857490+00:00", 
            "author": "https://api.launchpad.net/1.0/~tshefi"
        }
    ]
}