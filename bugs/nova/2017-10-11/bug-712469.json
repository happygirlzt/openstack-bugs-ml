{
    "status": "Invalid", 
    "last_updated": "2011-02-07 13:15:48.591254+00:00", 
    "description": "I'm trying to euca-attach-volume. \nSetup consists of one controller (IP 172.16.120.229) and one compute node (IP 172.16.120.228).\nnova-volumes is running on compute node (ubuntu03c).\nI can attach volume to guest running on compute node.\nI cann't attach volume to guest running on controller node (euca-attach-volume is executed on controller (ubuntu04a) too).\n\nubuntu04a, nova-compute.log:\n2011-02-03 12:53:05,244 ERROR nova.root [-] Exception during message handling\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 192, in receive\n(nova.root): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 92, in decorated_function\n(nova.root): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 527, in attach_volume\n(nova.root): TRACE:     volume_id)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/manager.py\", line 159, in setup_compute_volume\n(nova.root): TRACE:     path = self.driver.discover_volume(volume_ref)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 311, in discover_volume\n(nova.root): TRACE:     volume['host'])\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 300, in _get_name_and_portal\n(nova.root): TRACE:     \"sendtargets -p %s\" % host)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 147, in execute\n(nova.root): TRACE:     cmd=cmd)\n(nova.root): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.root): TRACE: Command: sudo iscsiadm -m discovery -t sendtargets -p ubuntu03c\n(nova.root): TRACE: Exit code: 255\n(nova.root): TRACE: Stdout: ''\n(nova.root): TRACE: Stderr: 'iscsiadm: Cannot resolve host ubuntu03c. getaddrinfo error: [Name or service not known]\\n\\niscsiadm: cannot resolve host name ubuntu03c\\niscsiadm: Could not perform SendTargets discovery.\\n'\n(nova.root): TRACE: \n\nI just edited /etc/hosts. Next attempt:\n\n011-02-03 13:11:48,818 AUDIT nova.compute.manager [YLNJR-8B-ZM3QE2JC-PR jc xproj] instance 83: attaching volume 6 to \\/dev\\/hdb\n2011-02-03 13:11:48,915 ERROR nova.root [-] Exception during message handling\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 192, in receive\n(nova.root): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 92, in decorated_function\n(nova.root): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 527, in attach_volume\n(nova.root): TRACE:     volume_id)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/manager.py\", line 159, in setup_compute_volume\n(nova.root): TRACE:     path = self.driver.discover_volume(volume_ref)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 311, in discover_volume\n(nova.root): TRACE:     volume['host'])\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 305, in _get_name_and_portal\n(nova.root): TRACE:     iscsi_portal = location.split(\",\")[0]\n(nova.root): TRACE: UnboundLocalError: local variable 'location' referenced before assignment\n(nova.root): TRACE: \n\nI guees restart of some iscsi services should help. \nIt didn't, so I restarted both hosts, and trace still occurs.\n\nSome commands:\n\nroot@ubuntu04a:~# dpkg --list | grep nova-\nii  nova-api                        2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - API frontend\nii  nova-common                     2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - common files\nii  nova-compute                    2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - compute node\nii  nova-doc                        2011.1~bzr635-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - documetation\nii  nova-network                    2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - Network thingamajig\nii  nova-objectstore                2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - object store\nii  nova-scheduler                  2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - Scheduler\nii  nova-volume                     2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - storage\n\nroot@ubuntu04a:~# euca-describe-instances \nRESERVATION\tr-2k6s17yl\txproj\tdefault\nINSTANCE\ti-00000059\tami-iv78p74r\t10.0.0.27\t10.0.0.27\trunning\tmykey (xproj, ubuntu03c)\t0\t\tm1.small\t2011-02-03 13:05:25\tnova\t\t\nRESERVATION\tr-nd9pt10v\txproj\tdefault\nINSTANCE\ti-00000058\tami-iv78p74r\t10.0.0.26\t10.0.0.26\trunning\tmykey (xproj, ubuntu04a)\t0\t\tm1.small\t2011-02-03 13:05:13\tnova\t\t\n\nroot@ubuntu04a:~# euca-describe-volumes \n...\nVOLUME\tvol-00000006\t 2\t\tnova\tavailable (jc, ubuntu03c, None, None)\t2011-02-01 10:06:45\nVOLUME\tvol-00000007\t 1\t\tnova\tin-use (jc, ubuntu03c, i-0000004f[ubuntu03c], \\/dev\\/hdb)\t2011-02-01 14:50:32\n\nroot@ubuntu04a:~# euca-attach-volume -i i-00000058 -d /dev/hdb vol-00000006\n\nroot@ubuntu04a:~# iscsiadm -m discovery -t sendtargets -p ubuntu03c\n172.16.120.228:3260,1 iqn.2010-10.org.openstack:volume-00000006\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000006\n172.16.120.228:3260,1 iqn.2010-10.org.openstack:volume-00000007\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000007", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/712469", 
    "owner": "None", 
    "id": 712469, 
    "index": 2019, 
    "created": "2011-02-03 13:56:09.686316+00:00", 
    "title": "unable to atach-volume on different host (iscsiadm has volume-00000006, nova has vol-00000006)", 
    "comments": [
        {
            "content": "I'm trying to euca-attach-volume. \nSetup consists of one controller (IP 172.16.120.229) and one compute node (IP 172.16.120.228).\nnova-volumes is running on compute node (ubuntu03c).\nI can attach volume to guest running on compute node.\nI cann't attach volume to guest running on controller node (euca-attach-volume is executed on controller (ubuntu04a) too).\n\nubuntu04a, nova-compute.log:\n2011-02-03 12:53:05,244 ERROR nova.root [-] Exception during message handling\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 192, in receive\n(nova.root): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 92, in decorated_function\n(nova.root): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 527, in attach_volume\n(nova.root): TRACE:     volume_id)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/manager.py\", line 159, in setup_compute_volume\n(nova.root): TRACE:     path = self.driver.discover_volume(volume_ref)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 311, in discover_volume\n(nova.root): TRACE:     volume['host'])\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 300, in _get_name_and_portal\n(nova.root): TRACE:     \"sendtargets -p %s\" % host)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 147, in execute\n(nova.root): TRACE:     cmd=cmd)\n(nova.root): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.root): TRACE: Command: sudo iscsiadm -m discovery -t sendtargets -p ubuntu03c\n(nova.root): TRACE: Exit code: 255\n(nova.root): TRACE: Stdout: ''\n(nova.root): TRACE: Stderr: 'iscsiadm: Cannot resolve host ubuntu03c. getaddrinfo error: [Name or service not known]\\n\\niscsiadm: cannot resolve host name ubuntu03c\\niscsiadm: Could not perform SendTargets discovery.\\n'\n(nova.root): TRACE: \n\nI just edited /etc/hosts. Next attempt:\n\n011-02-03 13:11:48,818 AUDIT nova.compute.manager [YLNJR-8B-ZM3QE2JC-PR jc xproj] instance 83: attaching volume 6 to \\/dev\\/hdb\n2011-02-03 13:11:48,915 ERROR nova.root [-] Exception during message handling\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 192, in receive\n(nova.root): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 92, in decorated_function\n(nova.root): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 527, in attach_volume\n(nova.root): TRACE:     volume_id)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/manager.py\", line 159, in setup_compute_volume\n(nova.root): TRACE:     path = self.driver.discover_volume(volume_ref)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 311, in discover_volume\n(nova.root): TRACE:     volume['host'])\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 305, in _get_name_and_portal\n(nova.root): TRACE:     iscsi_portal = location.split(\",\")[0]\n(nova.root): TRACE: UnboundLocalError: local variable 'location' referenced before assignment\n(nova.root): TRACE: \n\nI guees restart of some iscsi services should help. \nIt didn't, so I restarted both hosts, and trace still occurs.\n\nSome commands:\n\nroot@ubuntu04a:~# dpkg --list | grep nova-\nii  nova-api                        2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - API frontend\nii  nova-common                     2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - common files\nii  nova-compute                    2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - compute node\nii  nova-doc                        2011.1~bzr635-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - documetation\nii  nova-network                    2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - Network thingamajig\nii  nova-objectstore                2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - object store\nii  nova-scheduler                  2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - Scheduler\nii  nova-volume                     2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - storage\n\nroot@ubuntu04a:~# euca-describe-instances \nRESERVATION\tr-2k6s17yl\txproj\tdefault\nINSTANCE\ti-00000059\tami-iv78p74r\t10.0.0.27\t10.0.0.27\trunning\tmykey (xproj, ubuntu03c)\t0\t\tm1.small\t2011-02-03 13:05:25\tnova\t\t\nRESERVATION\tr-nd9pt10v\txproj\tdefault\nINSTANCE\ti-00000058\tami-iv78p74r\t10.0.0.26\t10.0.0.26\trunning\tmykey (xproj, ubuntu04a)\t0\t\tm1.small\t2011-02-03 13:05:13\tnova\t\t\n\nroot@ubuntu04a:~# euca-describe-volumes \n...\nVOLUME\tvol-00000006\t 2\t\tnova\tavailable (jc, ubuntu03c, None, None)\t2011-02-01 10:06:45\nVOLUME\tvol-00000007\t 1\t\tnova\tin-use (jc, ubuntu03c, i-0000004f[ubuntu03c], \\/dev\\/hdb)\t2011-02-01 14:50:32\n\nroot@ubuntu04a:~# euca-attach-volume -i i-00000058 -d /dev/hdb vol-00000006\n\nroot@ubuntu04a:~# iscsiadm -m discovery -t sendtargets -p ubuntu03c\n172.16.120.228:3260,1 iqn.2010-10.org.openstack:volume-00000006\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000006\n172.16.120.228:3260,1 iqn.2010-10.org.openstack:volume-00000007\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000007", 
            "date_created": "2011-02-03 13:56:09.686316+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-cinkelj"
        }, 
        {
            "content": "you need to set --iscsi_ip_prefix=192.168.122 for it to know which ip to use to connect to the target.", 
            "date_created": "2011-02-03 14:24:59.715630+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Tried to add --iscsi_ip_prefix=192.168.122 to /etc/nova/nova.conf.\nIn nova-compute.log, after 2 minutes:\n(nova.root): TRACE: Stderr: 'iscsiadm: Could not login to [iface: default, target: iqn.2010-10.org.openstack:volume-00000006, portal: 192.168.122.1,3260]: \\niscsiadm: initiator reported error (8 - connection timed out)\\n'\n\nChanged prefix to --iscsi_ip_prefix=172.16.120, restart services and\neuca-attach-volume -i i-00000058 -d /dev/hdb vol-00000006\nroot@ubuntu04a:/etc/nova# euca-describe-volumes \nVOLUME\tvol-00000006\t 2\t\tnova\tin-use (jc, ubuntu03c, i-00000058[ubuntu04a], \\/dev\\/hdb)\t2011-02-01 10:06:45\nSo volume is attached now.\n\nAfter ssh-ing to VM, there is no /dev/hdb, but I have /sys/block/vdb\n# cat /sys/block/vdb/dev\n252:16\n# mknod -m 0660 252 16 /dev/vdb\n# fdisk -l /dev/vdb \nDisk /dev/vdb: 21.4 GB, 21474836480 bytes\n16 heads, 63 sectors/track, 41610 cylinders\nUnits = cylinders of 1008 * 512 = 516096 bytes\nDisk /dev/vdb doesn't contain a valid partition table\n\nI guess fdisk should report size of 2 G. I will try to create and use new volume, on new /dev/loop.\n\nThank you for your help.\n\n\n----- Original Message -----\nFrom: \"Vish Ishaya\" <email address hidden>\nTo: \"justin cinkelj\" <email address hidden>\nSent: Thursday, February 3, 2011 3:24:59 PM\nSubject: [Bug 712469] Re: unable to atach-volume on different host (iscsiadm\thas volume-00000006, nova has vol-00000006)\n\nyou need to set --iscsi_ip_prefix=192.168.122 for it to know which ip to\nuse to connect to the target.\n\n-- \nYou received this bug notification because you are a direct subscriber\nof the bug.\nhttps://bugs.launchpad.net/bugs/712469\n\nTitle:\n  unable to atach-volume on different host (iscsiadm has\n  volume-00000006, nova has vol-00000006)\n\nStatus in OpenStack Compute (Nova):\n  New\n\nBug description:\n  I'm trying to euca-attach-volume. \n  Setup consists of one controller (IP 172.16.120.229) and one compute node (IP 172.16.120.228).\n  nova-volumes is running on compute node (ubuntu03c).\n  I can attach volume to guest running on compute node.\n  I cann't attach volume to guest running on controller node (euca-attach-volume is executed on controller (ubuntu04a) too).\n\n  ubuntu04a, nova-compute.log:\n  2011-02-03 12:53:05,244 ERROR nova.root [-] Exception during message handling\n  (nova.root): TRACE: Traceback (most recent call last):\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 192, in receive\n  (nova.root): TRACE:     rval = node_func(context=ctxt, **node_args)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 92, in decorated_function\n  (nova.root): TRACE:     function(self, context, instance_id, *args, **kwargs)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 527, in attach_volume\n  (nova.root): TRACE:     volume_id)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/manager.py\", line 159, in setup_compute_volume\n  (nova.root): TRACE:     path = self.driver.discover_volume(volume_ref)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 311, in discover_volume\n  (nova.root): TRACE:     volume['host'])\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 300, in _get_name_and_portal\n  (nova.root): TRACE:     \"sendtargets -p %s\" % host)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 147, in execute\n  (nova.root): TRACE:     cmd=cmd)\n  (nova.root): TRACE: ProcessExecutionError: Unexpected error while running command.\n  (nova.root): TRACE: Command: sudo iscsiadm -m discovery -t sendtargets -p ubuntu03c\n  (nova.root): TRACE: Exit code: 255\n  (nova.root): TRACE: Stdout: ''\n  (nova.root): TRACE: Stderr: 'iscsiadm: Cannot resolve host ubuntu03c. getaddrinfo error: [Name or service not known]\\n\\niscsiadm: cannot resolve host name ubuntu03c\\niscsiadm: Could not perform SendTargets discovery.\\n'\n  (nova.root): TRACE: \n\n  I just edited /etc/hosts. Next attempt:\n\n  011-02-03 13:11:48,818 AUDIT nova.compute.manager [YLNJR-8B-ZM3QE2JC-PR jc xproj] instance 83: attaching volume 6 to \\/dev\\/hdb\n  2011-02-03 13:11:48,915 ERROR nova.root [-] Exception during message handling\n  (nova.root): TRACE: Traceback (most recent call last):\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 192, in receive\n  (nova.root): TRACE:     rval = node_func(context=ctxt, **node_args)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 92, in decorated_function\n  (nova.root): TRACE:     function(self, context, instance_id, *args, **kwargs)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 527, in attach_volume\n  (nova.root): TRACE:     volume_id)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/manager.py\", line 159, in setup_compute_volume\n  (nova.root): TRACE:     path = self.driver.discover_volume(volume_ref)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 311, in discover_volume\n  (nova.root): TRACE:     volume['host'])\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 305, in _get_name_and_portal\n  (nova.root): TRACE:     iscsi_portal = location.split(\",\")[0]\n  (nova.root): TRACE: UnboundLocalError: local variable 'location' referenced before assignment\n  (nova.root): TRACE: \n\n  I guees restart of some iscsi services should help. \n  It didn't, so I restarted both hosts, and trace still occurs.\n\n  Some commands:\n\n  root@ubuntu04a:~# dpkg --list | grep nova-\n  ii  nova-api                        2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - API frontend\n  ii  nova-common                     2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - common files\n  ii  nova-compute                    2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - compute node\n  ii  nova-doc                        2011.1~bzr635-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - documetation\n  ii  nova-network                    2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - Network thingamajig\n  ii  nova-objectstore                2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - object store\n  ii  nova-scheduler                  2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - Scheduler\n  ii  nova-volume                     2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - storage\n\n  root@ubuntu04a:~# euca-describe-instances \n  RESERVATION\tr-2k6s17yl\txproj\tdefault\n  INSTANCE\ti-00000059\tami-iv78p74r\t10.0.0.27\t10.0.0.27\trunning\tmykey (xproj, ubuntu03c)\t0\t\tm1.small\t2011-02-03 13:05:25\tnova\t\t\n  RESERVATION\tr-nd9pt10v\txproj\tdefault\n  INSTANCE\ti-00000058\tami-iv78p74r\t10.0.0.26\t10.0.0.26\trunning\tmykey (xproj, ubuntu04a)\t0\t\tm1.small\t2011-02-03 13:05:13\tnova\t\t\n\n  root@ubuntu04a:~# euca-describe-volumes \n  ...\n  VOLUME\tvol-00000006\t 2\t\tnova\tavailable (jc, ubuntu03c, None, None)\t2011-02-01 10:06:45\n  VOLUME\tvol-00000007\t 1\t\tnova\tin-use (jc, ubuntu03c, i-0000004f[ubuntu03c], \\/dev\\/hdb)\t2011-02-01 14:50:32\n\n  root@ubuntu04a:~# euca-attach-volume -i i-00000058 -d /dev/hdb\n  vol-00000006\n\n  root@ubuntu04a:~# iscsiadm -m discovery -t sendtargets -p ubuntu03c\n  172.16.120.228:3260,1 iqn.2010-10.org.openstack:volume-00000006\n  192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000006\n  172.16.120.228:3260,1 iqn.2010-10.org.openstack:volume-00000007\n  192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000007\n\nTo unsubscribe from this bug, go to:\nhttps://bugs.launchpad.net/nova/+bug/712469/+subscribe\n", 
            "date_created": "2011-02-03 15:18:17+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-cinkelj"
        }, 
        {
            "content": "Update:\nVolume was detached and re-attached to same instance.\nInside VM, there are additional messages in dmesg (there were none during first attach), mentioning\nvdc: unknown partition table\nMajor/minor numbers are now 252:32, so I created second node /dev/vdc\nfdisk reports size of 2 G.\n\n----- Original Message -----\nFrom: \"Vish Ishaya\" <email address hidden>\nTo: \"justin cinkelj\" <email address hidden>\nSent: Thursday, February 3, 2011 3:24:59 PM\nSubject: [Bug 712469] Re: unable to atach-volume on different host (iscsiadm\thas volume-00000006, nova has vol-00000006)\n\nyou need to set --iscsi_ip_prefix=192.168.122 for it to know which ip to\nuse to connect to the target.\n\n-- \nYou received this bug notification because you are a direct subscriber\nof the bug.\nhttps://bugs.launchpad.net/bugs/712469\n\nTitle:\n  unable to atach-volume on different host (iscsiadm has\n  volume-00000006, nova has vol-00000006)\n\nStatus in OpenStack Compute (Nova):\n  New\n\nBug description:\n  I'm trying to euca-attach-volume. \n  Setup consists of one controller (IP 172.16.120.229) and one compute node (IP 172.16.120.228).\n  nova-volumes is running on compute node (ubuntu03c).\n  I can attach volume to guest running on compute node.\n  I cann't attach volume to guest running on controller node (euca-attach-volume is executed on controller (ubuntu04a) too).\n\n  ubuntu04a, nova-compute.log:\n  2011-02-03 12:53:05,244 ERROR nova.root [-] Exception during message handling\n  (nova.root): TRACE: Traceback (most recent call last):\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 192, in receive\n  (nova.root): TRACE:     rval = node_func(context=ctxt, **node_args)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 92, in decorated_function\n  (nova.root): TRACE:     function(self, context, instance_id, *args, **kwargs)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 527, in attach_volume\n  (nova.root): TRACE:     volume_id)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/manager.py\", line 159, in setup_compute_volume\n  (nova.root): TRACE:     path = self.driver.discover_volume(volume_ref)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 311, in discover_volume\n  (nova.root): TRACE:     volume['host'])\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 300, in _get_name_and_portal\n  (nova.root): TRACE:     \"sendtargets -p %s\" % host)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 147, in execute\n  (nova.root): TRACE:     cmd=cmd)\n  (nova.root): TRACE: ProcessExecutionError: Unexpected error while running command.\n  (nova.root): TRACE: Command: sudo iscsiadm -m discovery -t sendtargets -p ubuntu03c\n  (nova.root): TRACE: Exit code: 255\n  (nova.root): TRACE: Stdout: ''\n  (nova.root): TRACE: Stderr: 'iscsiadm: Cannot resolve host ubuntu03c. getaddrinfo error: [Name or service not known]\\n\\niscsiadm: cannot resolve host name ubuntu03c\\niscsiadm: Could not perform SendTargets discovery.\\n'\n  (nova.root): TRACE: \n\n  I just edited /etc/hosts. Next attempt:\n\n  011-02-03 13:11:48,818 AUDIT nova.compute.manager [YLNJR-8B-ZM3QE2JC-PR jc xproj] instance 83: attaching volume 6 to \\/dev\\/hdb\n  2011-02-03 13:11:48,915 ERROR nova.root [-] Exception during message handling\n  (nova.root): TRACE: Traceback (most recent call last):\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc.py\", line 192, in receive\n  (nova.root): TRACE:     rval = node_func(context=ctxt, **node_args)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 92, in decorated_function\n  (nova.root): TRACE:     function(self, context, instance_id, *args, **kwargs)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 527, in attach_volume\n  (nova.root): TRACE:     volume_id)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/manager.py\", line 159, in setup_compute_volume\n  (nova.root): TRACE:     path = self.driver.discover_volume(volume_ref)\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 311, in discover_volume\n  (nova.root): TRACE:     volume['host'])\n  (nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/volume/driver.py\", line 305, in _get_name_and_portal\n  (nova.root): TRACE:     iscsi_portal = location.split(\",\")[0]\n  (nova.root): TRACE: UnboundLocalError: local variable 'location' referenced before assignment\n  (nova.root): TRACE: \n\n  I guees restart of some iscsi services should help. \n  It didn't, so I restarted both hosts, and trace still occurs.\n\n  Some commands:\n\n  root@ubuntu04a:~# dpkg --list | grep nova-\n  ii  nova-api                        2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - API frontend\n  ii  nova-common                     2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - common files\n  ii  nova-compute                    2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - compute node\n  ii  nova-doc                        2011.1~bzr635-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - documetation\n  ii  nova-network                    2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - Network thingamajig\n  ii  nova-objectstore                2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - object store\n  ii  nova-scheduler                  2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - Scheduler\n  ii  nova-volume                     2011.1~bzr642-0ubuntu0ppa1~maverick1              OpenStack Compute - Nova - storage\n\n  root@ubuntu04a:~# euca-describe-instances \n  RESERVATION\tr-2k6s17yl\txproj\tdefault\n  INSTANCE\ti-00000059\tami-iv78p74r\t10.0.0.27\t10.0.0.27\trunning\tmykey (xproj, ubuntu03c)\t0\t\tm1.small\t2011-02-03 13:05:25\tnova\t\t\n  RESERVATION\tr-nd9pt10v\txproj\tdefault\n  INSTANCE\ti-00000058\tami-iv78p74r\t10.0.0.26\t10.0.0.26\trunning\tmykey (xproj, ubuntu04a)\t0\t\tm1.small\t2011-02-03 13:05:13\tnova\t\t\n\n  root@ubuntu04a:~# euca-describe-volumes \n  ...\n  VOLUME\tvol-00000006\t 2\t\tnova\tavailable (jc, ubuntu03c, None, None)\t2011-02-01 10:06:45\n  VOLUME\tvol-00000007\t 1\t\tnova\tin-use (jc, ubuntu03c, i-0000004f[ubuntu03c], \\/dev\\/hdb)\t2011-02-01 14:50:32\n\n  root@ubuntu04a:~# euca-attach-volume -i i-00000058 -d /dev/hdb\n  vol-00000006\n\n  root@ubuntu04a:~# iscsiadm -m discovery -t sendtargets -p ubuntu03c\n  172.16.120.228:3260,1 iqn.2010-10.org.openstack:volume-00000006\n  192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000006\n  172.16.120.228:3260,1 iqn.2010-10.org.openstack:volume-00000007\n  192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000007\n\nTo unsubscribe from this bug, go to:\nhttps://bugs.launchpad.net/nova/+bug/712469/+subscribe\n", 
            "date_created": "2011-02-03 15:27:57+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-cinkelj"
        }, 
        {
            "content": "If I read this correctly, the issue is now solved (by usage of a correct --iscsi_ip_prefix flag). Closing as Invalid, please reopen if I read this story wrong.", 
            "date_created": "2011-02-07 09:47:25.564336+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Yes, the issue is solved.\n", 
            "date_created": "2011-02-07 13:13:43+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-cinkelj"
        }
    ]
}