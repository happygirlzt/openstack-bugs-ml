{
    "status": "Invalid", 
    "last_updated": "2017-06-27 07:43:58.234383+00:00", 
    "description": "Hi,\n\nApparently, when cinder tells nova to swap the volume a of VM after a retyping it, this exception appears in the logs and the volume is not swapped. It seems the instance UUID is passed as parameter instead of a dict.\n\n\nI'm using last kilo packaged version for ubuntu 14.014 :\n\nroot@cmp-00004-nivol:~# dpkg -l | grep nova\nii  nova-common                         1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - common files\nii  nova-compute                        1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - compute node base\nii  nova-compute-kvm                    1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - compute node libvirt support\nii  python-nova                         1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute Python libraries\nii  python-novaclient                   1:2.22.0-0ubuntu1~cloud0              all          client library for OpenStack Compute API\n\nHere are some logs :\n\n2015-08-18 14:53:11.599 577 ERROR root [req-fa61a8e5-e8a7-46ef-b7ec-5d15129cada0 e5ea8d8e42e443f0963b2cd8288a6880 de0701822aa446f6b1fd9a2c8757b1b6 - - -] Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 346, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 4946, in swap_volume\\n    context, old_volume_id, instance_uuid=instance.uuid)\\n', \"AttributeError: 'unicode' object has no attribute 'uuid'\\n\"]\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager Traceback (most recent call last):\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 298, in decorated_function\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager     return function(self, context, *args, **kwargs)\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 358, in decorated_function\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager     kwargs['instance'], e, sys.exc_info())\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/utils.py\", line 87, in add_instance_fault_from_exc\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager     fault_obj.instance_uuid = instance.uuid\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager AttributeError: 'unicode' object has no attribute 'uuid'\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager \n2015-08-18 14:53:11.605 577 ERROR root [req-fa61a8e5-e8a7-46ef-b7ec-5d15129cada0 e5ea8d8e42e443f0963b2cd8288a6880 de0701822aa446f6b1fd9a2c8757b1b6 - - -] Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 298, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 358, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/utils.py\", line 87, in add_instance_fault_from_exc\\n    fault_obj.instance_uuid = instance.uuid\\n', \"AttributeError: 'unicode' object has no attribute 'uuid'\\n\"]\n2015-08-18 14:53:11.606 577 ERROR oslo_messaging.rpc.dispatcher [req-fa61a8e5-e8a7-46ef-b7ec-5d15129cada0 e5ea8d8e42e443f0963b2cd8288a6880 de0701822aa446f6b1fd9a2c8757b1b6 - - -] Exception during message handling: string indices must be integers\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6775, in swap_volume\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     new_volume_id)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 317, in decorated_function\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     instance_uuid = keyed_args['instance']['uuid']\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher TypeError: string indices must be integers\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher \n\nTo reproduce this, just create a volume, retype it while the VM is running and wait for the exception.\n\nThx,\n\\fab", 
    "tags": [
        "volumes"
    ], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1486032", 
    "owner": "None", 
    "id": 1486032, 
    "index": 5716, 
    "created": "2015-08-18 13:08:03.482890+00:00", 
    "title": "Swapping a volume cause an exception", 
    "comments": [
        {
            "content": "Hi,\n\nApparently, when cinder tells nova to swap the volume a of VM after a retyping it, this exception appears in the logs and the volume is not swapped. It seems the instance UUID is passed as parameter instead of a dict.\n\n\nI'm using last kilo packaged version for ubuntu 14.014 :\n\nroot@cmp-00004-nivol:~# dpkg -l | grep nova\nii  nova-common                         1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - common files\nii  nova-compute                        1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - compute node base\nii  nova-compute-kvm                    1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - compute node (KVM)\nii  nova-compute-libvirt                1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute - compute node libvirt support\nii  python-nova                         1:2015.1.0-0ubuntu1.1~cloud0          all          OpenStack Compute Python libraries\nii  python-novaclient                   1:2.22.0-0ubuntu1~cloud0              all          client library for OpenStack Compute API\n\nHere are some logs :\n\n2015-08-18 14:53:11.599 577 ERROR root [req-fa61a8e5-e8a7-46ef-b7ec-5d15129cada0 e5ea8d8e42e443f0963b2cd8288a6880 de0701822aa446f6b1fd9a2c8757b1b6 - - -] Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 346, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 4946, in swap_volume\\n    context, old_volume_id, instance_uuid=instance.uuid)\\n', \"AttributeError: 'unicode' object has no attribute 'uuid'\\n\"]\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager Traceback (most recent call last):\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 298, in decorated_function\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager     return function(self, context, *args, **kwargs)\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 358, in decorated_function\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager     kwargs['instance'], e, sys.exc_info())\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/utils.py\", line 87, in add_instance_fault_from_exc\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager     fault_obj.instance_uuid = instance.uuid\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager AttributeError: 'unicode' object has no attribute 'uuid'\n2015-08-18 14:53:11.601 577 TRACE nova.compute.manager \n2015-08-18 14:53:11.605 577 ERROR root [req-fa61a8e5-e8a7-46ef-b7ec-5d15129cada0 e5ea8d8e42e443f0963b2cd8288a6880 de0701822aa446f6b1fd9a2c8757b1b6 - - -] Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 298, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 358, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/utils.py\", line 87, in add_instance_fault_from_exc\\n    fault_obj.instance_uuid = instance.uuid\\n', \"AttributeError: 'unicode' object has no attribute 'uuid'\\n\"]\n2015-08-18 14:53:11.606 577 ERROR oslo_messaging.rpc.dispatcher [req-fa61a8e5-e8a7-46ef-b7ec-5d15129cada0 e5ea8d8e42e443f0963b2cd8288a6880 de0701822aa446f6b1fd9a2c8757b1b6 - - -] Exception during message handling: string indices must be integers\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 6775, in swap_volume\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     new_volume_id)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 88, in wrapped\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 71, in wrapped\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 317, in decorated_function\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher     instance_uuid = keyed_args['instance']['uuid']\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher TypeError: string indices must be integers\n2015-08-18 14:53:11.606 577 TRACE oslo_messaging.rpc.dispatcher \n\nTo reproduce this, just create a volume, retype it while the VM is running and wait for the exception.\n\nThx,\n\\fab", 
            "date_created": "2015-08-18 13:08:03.482890+00:00", 
            "author": "https://api.launchpad.net/1.0/~fabien-dupont-z"
        }, 
        {
            "content": "I can confirm this issue also affects our Kilo environment.", 
            "date_created": "2015-11-19 23:43:02.281959+00:00", 
            "author": "https://api.launchpad.net/1.0/~oisin-omalley"
        }, 
        {
            "content": "It's been a while since this bug was assigned and no patch was submitted. Moving it to unassigned.\n\nVladik Romanovsky, please reassign yourself if you are working on this.", 
            "date_created": "2016-04-18 17:43:14.061602+00:00", 
            "author": "https://api.launchpad.net/1.0/~sujitha-neti"
        }, 
        {
            "content": "Pranali Deore, I noticed you've assigned this bug to yourself. If you are currently working on a patch, can you please change the status of this bug to In Progress? If you are not working, please remove yourself as the assignee.", 
            "date_created": "2016-06-17 22:34:55.788082+00:00", 
            "author": "https://api.launchpad.net/1.0/~sujitha-neti"
        }, 
        {
            "content": "I noticed this bug was originally reported against Kilo, which is at end of life. Has anyone reproduced this issue with Mitaka or master?", 
            "date_created": "2016-06-21 22:37:12.239757+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "This bug lacks the necessary information to effectively reproduce and fix it, therefore it has been closed.\nFeel free to reopen the bug by providing the requested information and set the bug status back to ''New''.", 
            "date_created": "2017-06-27 07:43:44.416624+00:00", 
            "author": "https://api.launchpad.net/1.0/~natsume-takashi"
        }
    ]
}