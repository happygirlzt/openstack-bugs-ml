{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:00:05.561181+00:00", 
    "description": "The command to start dnsmasq has some bash environment prefixes (FLAGFILE=, NETWORK_ID=) but the call to execute isn't marked with shell=True.  So when \"Make nova-rootwrap optional\" got merged (Change-Id: I2cf5c743c6f4d6f235a54ca70c11d8191deeed6a) instead of always prefixing the commandline with \"sudo\" - if you're running as root (as I do on some automated dev/test/build vms) - the commandline now started with \"FLAGFILE\" and subprocess throws a OSError/ENOENT because there's no executable with that name ;)\n\n2012-10-30 12:17:57 DEBUG nova.utils [req-7dc40cb3-8410-4868-927c-1b5d50ede910 None None] Running cmd (subprocess): FLAGFILE=/etc/nova/nova.conf NETWORK_ID=1\n dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/etc/nova/state/networks/nova-virbr0.pid --listen-address=10.0.0.1 --exc\nept-interface=lo --dhcp-range=set:'private',10.0.0.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/etc/nova/state/networks/nova-virbr0.conf --dhcp-scrip\nt=/opt/nova/bin/nova-dhcpbridge --leasefile-ro execute /opt/nova/nova/utils.py:171\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()  \n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/opt/nova/nova/service.py\", line 123, in run_server\n    server.start()\n  File \"/opt/nova/nova/service.py\", line 389, in start\n    self.manager.init_host()\n  File \"/opt/nova/nova/network/manager.py\", line 1943, in init_host\n    super(FlatDHCPManager, self).init_host()\n  File \"/opt/nova/nova/network/manager.py\", line 889, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/opt/nova/nova/network/manager.py\", line 1954, in _setup_network_on_host\n    self.driver.update_dhcp(context, dev, network)\n  File \"/opt/nova/nova/network/linux_net.py\", line 772, in update_dhcp\n    restart_dhcp(context, dev, network_ref)\n  File \"/opt/nova/nova/openstack/common/lockutils.py\", line 229, in inner\n    retval = f(*args, **kwargs)\n  File \"/opt/nova/nova/network/linux_net.py\", line 858, in restart_dhcp\n    _execute(*cmd, run_as_root=True)\n  File \"/opt/nova/nova/network/linux_net.py\", line 950, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/opt/nova/nova/utils.py\", line 179, in execute\n    shell=shell)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/green/subprocess.py\", line 25, in __init__\n    subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n  File \"/usr/lib/python2.7/subprocess.py\", line 679, in __init__\n    errread, errwrite)\n  File \"/usr/lib/python2.7/subprocess.py\", line 1249, in _execute_child\n    raise child_exception\nOSError: [Errno 2] No such file or directory\n\nIt was a little hard to track down, because obviously running on the commandline works.  It only happens on the boxes where I'm running services as root.  And subprocess wasn't being really specific about what exactly it couldn't find :P\n\nI looked for precedent adding shell=True to the call, but it seems the nova codebase prefers to explicitly set the environ with the env command.", 
    "tags": [
        "dnsmasq", 
        "linux", 
        "net"
    ], 
    "importance": "Low", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1073253", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1073253, 
    "index": 5597, 
    "created": "2012-10-30 17:21:56.609036+00:00", 
    "title": "linux_net fails to start dnsmasq as root", 
    "comments": [
        {
            "content": "The command to start dnsmasq has some bash environment prefixes (FLAGFILE=, NETWORK_ID=) but the call to execute isn't marked with shell=True.  So when \"Make nova-rootwrap optional\" got merged (Change-Id: I2cf5c743c6f4d6f235a54ca70c11d8191deeed6a) instead of always prefixing the commandline with \"sudo\" - if you're running as root (as I do on some automated dev/test/build vms) - the commandline now started with \"FLAGFILE\" and subprocess throws a OSError/ENOENT because there's no executable with that name ;)\n\n2012-10-30 12:17:57 DEBUG nova.utils [req-7dc40cb3-8410-4868-927c-1b5d50ede910 None None] Running cmd (subprocess): FLAGFILE=/etc/nova/nova.conf NETWORK_ID=1\n dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/etc/nova/state/networks/nova-virbr0.pid --listen-address=10.0.0.1 --exc\nept-interface=lo --dhcp-range=set:'private',10.0.0.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/etc/nova/state/networks/nova-virbr0.conf --dhcp-scrip\nt=/opt/nova/bin/nova-dhcpbridge --leasefile-ro execute /opt/nova/nova/utils.py:171\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()  \n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/opt/nova/nova/service.py\", line 123, in run_server\n    server.start()\n  File \"/opt/nova/nova/service.py\", line 389, in start\n    self.manager.init_host()\n  File \"/opt/nova/nova/network/manager.py\", line 1943, in init_host\n    super(FlatDHCPManager, self).init_host()\n  File \"/opt/nova/nova/network/manager.py\", line 889, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/opt/nova/nova/network/manager.py\", line 1954, in _setup_network_on_host\n    self.driver.update_dhcp(context, dev, network)\n  File \"/opt/nova/nova/network/linux_net.py\", line 772, in update_dhcp\n    restart_dhcp(context, dev, network_ref)\n  File \"/opt/nova/nova/openstack/common/lockutils.py\", line 229, in inner\n    retval = f(*args, **kwargs)\n  File \"/opt/nova/nova/network/linux_net.py\", line 858, in restart_dhcp\n    _execute(*cmd, run_as_root=True)\n  File \"/opt/nova/nova/network/linux_net.py\", line 950, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/opt/nova/nova/utils.py\", line 179, in execute\n    shell=shell)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/green/subprocess.py\", line 25, in __init__\n    subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n  File \"/usr/lib/python2.7/subprocess.py\", line 679, in __init__\n    errread, errwrite)\n  File \"/usr/lib/python2.7/subprocess.py\", line 1249, in _execute_child\n    raise child_exception\nOSError: [Errno 2] No such file or directory\n\nIt was a little hard to track down, because obviously running on the commandline works.  It only happens on the boxes where I'm running services as root.  And subprocess wasn't being really specific about what exactly it couldn't find :P\n\nI looked for precedent adding shell=True to the call, but it seems the nova codebase prefers to explicitly set the environ with the env command.", 
            "date_created": "2012-10-30 17:21:56.609036+00:00", 
            "author": "https://api.launchpad.net/1.0/~clay-gerrard"
        }, 
        {
            "content": "", 
            "date_created": "2012-10-30 17:21:56.609036+00:00", 
            "author": "https://api.launchpad.net/1.0/~clay-gerrard"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/15048", 
            "date_created": "2012-10-30 17:26:02.554146+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "FWIW running without rootwrap (direct sudo or as root) is deprecated in Folsom. It should become unsupported in Grizzly the moment we start allowing rootwrap to directly run python code snippets (instead of only allowing it to shell out).", 
            "date_created": "2012-10-31 10:23:54.530096+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/15048\nCommitted: http://github.com/openstack/nova/commit/1d7d733d017c0a8fe2f171d9822d752ff72d9fc6\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1d7d733d017c0a8fe2f171d9822d752ff72d9fc6\nAuthor: Andrew Laski <email address hidden>\nDate:   Tue Oct 30 16:54:41 2012 -0400\n\n    Use env to set environ when starting dnsmasq\n    \n    Explictly use env to setup needed environment variables for dnsmasq when\n    starting to avoid problems with subprocess mis-interpreting the first\n    command line argument as the executable name.\n    \n    Also update DnsmasqFilter to accept any command that starts with env\n    followed by a set of args that include an equals sign, as long as the\n    next arg is the dnsmasq command.\n    \n    fixes bug #1073253\n    \n    Change-Id: I8ac08ba2d2309934a67ed2cb28049ed5d3277d63\n", 
            "date_created": "2012-10-31 18:27:24.625344+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}