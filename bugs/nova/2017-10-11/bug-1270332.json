{
    "status": "Opinion", 
    "last_updated": "2016-07-08 15:37:39.214510+00:00", 
    "description": "With two compute nodes (on different hosts) configured to two different clusters in the same vCenter Server i.e :-\n\n\nnova migrate <server> fails to migrate a server with the following error :-\n\n2014-01-17 16:00:21.336 ERROR nova.openstack.common.rpc.amqp [req-0c587eb7-3a23-4790-b23d-f4ad005b5fe7 admin admin] Exception during message handling\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     **args)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     payload)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     six.reraise(self.type_, self.value, self.tb)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 244, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     pass\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     six.reraise(self.type_, self.value, self.tb)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 230, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 295, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 272, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     six.reraise(self.type_, self.value, self.tb)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 259, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3163, in resize_instance\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 406, in migrate_disk_and_power_off\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     dest, flavor)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/vmops.py\", line 1182, in migrate_disk_and_power_off\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     self._session._wait_for_task(instance['uuid'], vm_clone_task)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 857, in _wait_for_task\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     ret_val = done.wait()\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return hubs.get_hub().switch()\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return self.greenlet.switch()\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp NovaException: Unable to access the virtual machine configuration: Unable to access file [datastore1]\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp \n2014-01-17 16:00:21.497 DEBUG nova.openstack.common.rpc.amqp [-] Making synchronous call on conductor ... from (pid=28144) multicall /opt/stack/nova/nova/openstack/common/rpc/amqp.py:553\n2014-01-17 16:00:21.498 DEBUG nova.openstack.common.rpc.amqp [-] MSG_ID is b52829e908144155970ef23754eb46e3 from (pid=28144) multicall /opt/stack/nova/nova/openstack/common/rpc/amqp.py:556\n2014-01-17 16:00:21.498 DEBUG nova.openstack.common.rpc.amqp [-] UNIQUE_ID is 393d7230809b4892a4d7834c5ab56c2f. from (pid=28144) _add_unique_id /opt/stack/nova/nova/openstack/common/rpc/amqp.py:341\n2014-01-17 16:00:25.640 WARNING nova.virt.vmwareapi.driver [-] Task [CloneVM_Task] (returnval){\n   value = \"task-110\"\n   _type = \"Task\"\n } status: error Unable to access the virtual machine configuration: Unable to access file [datastore1]", 
    "tags": [
        "vmware"
    ], 
    "importance": "Wishlist", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1270332", 
    "owner": "https://api.launchpad.net/1.0/~rgerganov", 
    "id": 1270332, 
    "index": 1478, 
    "created": "2014-01-18 00:29:01.506827+00:00", 
    "title": "cold migration fails in VMware driver", 
    "comments": [
        {
            "content": "With two compute nodes (on different hosts) configured to two different clusters in the same vCenter Server i.e :-\n\n\nnova migrate <server> fails to migrate a server with the following error :-\n\n2014-01-17 16:00:21.336 ERROR nova.openstack.common.rpc.amqp [req-0c587eb7-3a23-4790-b23d-f4ad005b5fe7 admin admin] Exception during message handling\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     **args)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     payload)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     six.reraise(self.type_, self.value, self.tb)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 244, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     pass\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     six.reraise(self.type_, self.value, self.tb)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 230, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 295, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 272, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     six.reraise(self.type_, self.value, self.tb)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 259, in decorated_function\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 3163, in resize_instance\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 406, in migrate_disk_and_power_off\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     dest, flavor)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/vmops.py\", line 1182, in migrate_disk_and_power_off\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     self._session._wait_for_task(instance['uuid'], vm_clone_task)\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 857, in _wait_for_task\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     ret_val = done.wait()\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return hubs.get_hub().switch()\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp     return self.greenlet.switch()\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp NovaException: Unable to access the virtual machine configuration: Unable to access file [datastore1]\n2014-01-17 16:00:21.336 TRACE nova.openstack.common.rpc.amqp \n2014-01-17 16:00:21.497 DEBUG nova.openstack.common.rpc.amqp [-] Making synchronous call on conductor ... from (pid=28144) multicall /opt/stack/nova/nova/openstack/common/rpc/amqp.py:553\n2014-01-17 16:00:21.498 DEBUG nova.openstack.common.rpc.amqp [-] MSG_ID is b52829e908144155970ef23754eb46e3 from (pid=28144) multicall /opt/stack/nova/nova/openstack/common/rpc/amqp.py:556\n2014-01-17 16:00:21.498 DEBUG nova.openstack.common.rpc.amqp [-] UNIQUE_ID is 393d7230809b4892a4d7834c5ab56c2f. from (pid=28144) _add_unique_id /opt/stack/nova/nova/openstack/common/rpc/amqp.py:341\n2014-01-17 16:00:25.640 WARNING nova.virt.vmwareapi.driver [-] Task [CloneVM_Task] (returnval){\n   value = \"task-110\"\n   _type = \"Task\"\n } status: error Unable to access the virtual machine configuration: Unable to access file [datastore1]", 
            "date_created": "2014-01-18 00:29:01.506827+00:00", 
            "author": "https://api.launchpad.net/1.0/~smurugesan"
        }, 
        {
            "content": "This is because vCenter server is trying to do the following :-\n\nin relocate config spec :-\n\n1. datastore is chosen from the target cluster.\n2. host is set to null\n\nThe error is because vCenter tries to migrate the VM within the source host, but with a datastore available with the target cluster.\n\nIdeally, the following should have happened in relocate config spec :-\n\n1. datastore is chosen from the target cluster.\n2. host is set to null.\n3. resource pool is set to the target cluster.\n\n", 
            "date_created": "2014-01-18 00:37:09.957786+00:00", 
            "author": "https://api.launchpad.net/1.0/~smurugesan"
        }, 
        {
            "content": "I missed adding the reviews to the bug https://review.openstack.org/#/q/status:open+project:openstack/nova+branch:master+topic:bug/1270332,n,z\n\n", 
            "date_created": "2014-03-21 17:19:47.198637+00:00", 
            "author": "https://api.launchpad.net/1.0/~smurugesan"
        }, 
        {
            "content": "posting just the review https://review.openstack.org/#/c/76456/", 
            "date_created": "2014-03-21 17:23:51.555046+00:00", 
            "author": "https://api.launchpad.net/1.0/~smurugesan"
        }, 
        {
            "content": "Is this still a problem?", 
            "date_created": "2015-08-03 00:42:08.702127+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "rado is working on this", 
            "date_created": "2016-02-19 21:32:54.364789+00:00", 
            "author": "https://api.launchpad.net/1.0/~tjones-i"
        }, 
        {
            "content": "@Radoslav:\nCould you already make progress here?", 
            "date_created": "2016-03-11 15:46:09.925784+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "@Radoslav: Can you please let us know if you are still working on this bug ?", 
            "date_created": "2016-05-06 20:12:05.548668+00:00", 
            "author": "https://api.launchpad.net/1.0/~siva-radhakrishnan"
        }, 
        {
            "content": "Yes, I am working on this.  The cold migration shares common code with the live migration which is under review:\n\nhttps://review.openstack.org/#/c/270116/\n\nI was hoping to get some feedback there before pushing all the patches.", 
            "date_created": "2016-05-13 07:46:15.767288+00:00", 
            "author": "https://api.launchpad.net/1.0/~rgerganov"
        }, 
        {
            "content": "If this issue is addressed in that change, could you consider adding a \"closes-bug\" tag to the commit message?", 
            "date_created": "2016-06-16 16:07:16.930135+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "Looks like this will be driven by the blueprint [1].\n\n[1] https://blueprints.launchpad.net/nova/+spec/vmware-live-migration", 
            "date_created": "2016-07-08 15:37:18.960709+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}