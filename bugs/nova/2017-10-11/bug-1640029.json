{
    "status": "Won't Fix", 
    "last_updated": "2016-12-09 13:28:17.443038+00:00", 
    "description": "In my stable/newton setup running on a VMware NSX platform, I brought up 5 heat stacks each having 100 nova instances in the same /16 network.\nDeleting those heat stacks failed due to the below error.\n\n\"\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions TimeoutError: QueuePool limit of size 50 overflow 50 reached, connection timed out, timeout 30\n\"\n\nBecause of this error, out of 500 instances, deletion of about 67 instances got failed.\nWith default parameters in neutron.conf, I'm getting the below neutron error.\n\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource [req-a0022887-cc01-4f2e-980d-490136524363 admin -] delete failed: No details.\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource Traceback (most recent call last):\n.\n.\n.\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2039, in contextual_connect\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     self._wrap_pool_connect(self.pool.connect, None),\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return fn()\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 376, in connect\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return _ConnectionFairy._checkout(self)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     fairy = _ConnectionRecord.checkout(pool)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     rec = pool._do_get()\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1053, in _do_get\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     (self.size(), self.overflow(), self._timeout))\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource TimeoutError: QueuePool limit of size 10 overflow 20 reached, connection timed out, timeout 10\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource\n\nAfter changing the below parameters in /etc/neutron/neutron.conf and\n\nmax_pool_size = 50\nretry_interval = 10\nmax_overflow = 50\npool_max_size = 50\npool_max_overflow = 50\npool_timeout = 30\n\nbelow parameters in nova.conf and restarted the services and re-executed the testcase.Still deleting heat stack is failing with the below error\n\nmax_pool_size = 50\nmax_overflow = 50\n\nn-api.log:\n\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] Unexpected exception in API method\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n.\n.\n.\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     rec = pool._do_get()\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1053, in _do_get\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     (self.size(), self.overflow(), self._timeout))\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions TimeoutError: QueuePool limit of size 50 overflow 50 reached, connection timed out, timeout 30\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions\n2016-11-03 17:27:34.148 2399 INFO nova.api.openstack.wsgi [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.TimeoutError'>\n2016-11-03 17:27:34.148 2399 DEBUG nova.api.openstack.wsgi [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.TimeoutError'> __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1044\n\nPlease look into this.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1640029", 
    "owner": "None", 
    "id": 1640029, 
    "index": 6516, 
    "created": "2016-11-08 06:13:43.853989+00:00", 
    "title": "[stable/newton] Deleting heat stack failed due to error 'QueuePool limit of size 50 overflow 50 reached, connection timed out, timeout 30'", 
    "comments": [
        {
            "content": "In my CH + stable/newton setup, I brought up 5 heat stacks each having 100 nova instances in the same /16 network.\nDeleting those heat stacks failed due to the below error.\n\n\"\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions TimeoutError: QueuePool limit of size 50 overflow 50 reached, connection timed out, timeout 30\n\"\n\nBecause of this error, out of 500 instances, deletion of about 67 instances got failed.\nWith default parameters in neutron.conf, I'm getting the below neutron error.\n\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource [req-a0022887-cc01-4f2e-980d-490136524363 admin -] delete failed: No details.\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource Traceback (most recent call last):\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/api/v2/resource.py\", line 79, in resource\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     result = method(request=request, **args)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/api/v2/base.py\", line 555, in delete\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return self._delete(request, id, **kwargs)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 88, in wrapped\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     setattr(e, '_RETRY_EXCEEDED', True)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     self.force_reraise()\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     six.reraise(self.type_, self.value, self.tb)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 84, in wrapped\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return f(*args, **kwargs)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/api.py\", line 151, in wrapper\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     ectxt.value = e.inner_exc\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     self.force_reraise()\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     six.reraise(self.type_, self.value, self.tb)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/api.py\", line 139, in wrapper\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return f(*args, **kwargs)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 124, in wrapped\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     traceback.format_exc())\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     self.force_reraise()\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     six.reraise(self.type_, self.value, self.tb)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 119, in wrapped\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return f(*dup_args, **dup_kwargs)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/api/v2/base.py\", line 577, in _delete\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     obj_deleter(request.context, id, **kwargs)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/vmware-nsx/vmware_nsx/plugins/nsx_v3/plugin.py\", line 1814, in delete_port\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     self.disassociate_floatingips(context, port_id)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/vmware-nsx/vmware_nsx/plugins/nsx_v3/plugin.py\", line 2804, in disassociate_floatingips\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     for fip_db in fip_dbs:\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2761, in __iter__\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return self._execute_and_instances(context)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2774, in _execute_and_instances\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     close_with_result=True)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2765, in _connection_from_session\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     **kw)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 893, in connection\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     execution_options=execution_options)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 900, in _connection_for_bind\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     conn = engine.contextual_connect(**kw)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2039, in contextual_connect\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     self._wrap_pool_connect(self.pool.connect, None),\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return fn()\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 376, in connect\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     return _ConnectionFairy._checkout(self)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     fairy = _ConnectionRecord.checkout(pool)\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     rec = pool._do_get()\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1053, in _do_get\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource     (self.size(), self.overflow(), self._timeout))\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource TimeoutError: QueuePool limit of size 10 overflow 20 reached, connection timed out, timeout 10\n2016-11-02 20:42:06.557 18058 ERROR neutron.api.v2.resource\n\n\n\nAfter changing the below parameters in /etc/neutron/neutron.conf and \n \nmax_pool_size = 50\nretry_interval = 10\nmax_overflow = 50\npool_max_size = 50\npool_max_overflow = 50\npool_timeout = 30\n\nbelow parameters in nova.conf and restarted the services and re-executed the testcase.Still deleting heat stack is failing with the below error\n\nmax_pool_size = 50\nmax_overflow = 50\n\nn-api.log:\n\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] Unexpected exception in API method\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 914, in delete\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     self._delete(req.environ['nova.context'], req, id)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 755, in _delete\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     instance = self._get_server(context, req, instance_uuid)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 382, in _get_server\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     expected_attrs=expected_attrs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/common.py\", line 496, in get_instance\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     expected_attrs=expected_attrs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2215, in get\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     expected_attrs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2198, in _get_instance\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     context, instance_uuid, expected_attrs=expected_attrs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 184, in wrapper\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     result = fn(cls, context, *args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 444, in get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     use_slave=use_slave)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 225, in wrapper\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 436, in _db_instance_get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     columns_to_join=columns_to_join)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/api.py\", line 725, in instance_get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return IMPL.instance_get_by_uuid(context, uuid, columns_to_join)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 169, in wrapper\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 270, in wrapped\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(context, *args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1867, in instance_get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     columns_to_join=columns_to_join)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1872, in _instance_get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     filter_by(uuid=uuid).\\\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2659, in first\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     ret = list(self[0:1])\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2457, in __getitem__\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return list(res)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2761, in __iter__\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return self._execute_and_instances(context)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2774, in _execute_and_instances\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     close_with_result=True)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2765, in _connection_from_session\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     **kw)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 893, in connection\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     execution_options=execution_options)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 898, in _connection_for_bind\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     engine, execution_options)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 334, in _connection_for_bind\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     conn = bind.contextual_connect()\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2039, in contextual_connect\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     self._wrap_pool_connect(self.pool.connect, None),\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return fn()\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 376, in connect\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return _ConnectionFairy._checkout(self)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     fairy = _ConnectionRecord.checkout(pool)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     rec = pool._do_get()\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1053, in _do_get\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     (self.size(), self.overflow(), self._timeout))\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions TimeoutError: QueuePool limit of size 50 overflow 50 reached, connection timed out, timeout 30\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions\n2016-11-03 17:27:34.148 2399 INFO nova.api.openstack.wsgi [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.TimeoutError'>\n2016-11-03 17:27:34.148 2399 DEBUG nova.api.openstack.wsgi [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.TimeoutError'> __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1044\n\nPlease look into this.", 
            "date_created": "2016-11-08 06:13:43.853989+00:00", 
            "author": "https://api.launchpad.net/1.0/~sujai"
        }, 
        {
            "content": "Hi Sujai, thanks for reporting this. The issue is not yet clear to me. \nCan you please provide: \n- max_pool_size, retry_interval, max_overflow settings of your first run\n- the nova error message of the first and the second run\n- the neutron error message of the first and second run\nAt the moment you provided a neutron message for the first run and a nova message for the second. So I can't see what changed after updating the settings. In general it looks like that for deleting 500 instances in parallel a lot of sql queries are required. It seems like for such a use case you need to tune your parameters..\n\nBut let's compare your error message of the first and second run first. If they are equal, I tend to set this to invalid", 
            "date_created": "2016-11-09 10:52:26.346509+00:00", 
            "author": "https://api.launchpad.net/1.0/~andreas-scheuring"
        }, 
        {
            "content": "Hi,\n\nPlease find the information below.\n\nFor the first run:\n------------------\n\nIn /etc/neutron/neutron.conf:\n\nThe parameters are commented as below.\n#max_pool_size = 5\n#retry_interval = 10\n#max_overflow = 50\n#pool_max_size = 30\n#pool_max_overflow = 0\n#pool_timeout = 30\n\nAnd in nova.conf, I didn't set max_pool_size and max_overflow.\n\nNeutron Logs:\n\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource [req-65a024cc-dad4-4484-98f4-349be67cb7aa admin -] index failed: No details.\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource Traceback (most recent call last):\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/api/v2/resource.py\", line 79, in resource\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     result = method(request=request, **args)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 88, in wrapped\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     setattr(e, '_RETRY_EXCEEDED', True)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     self.force_reraise()\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     six.reraise(self.type_, self.value, self.tb)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 84, in wrapped\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     return f(*args, **kwargs)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/api.py\", line 151, in wrapper\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     ectxt.value = e.inner_exc\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     self.force_reraise()\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     six.reraise(self.type_, self.value, self.tb)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/api.py\", line 139, in wrapper\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     return f(*args, **kwargs)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 124, in wrapped\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     traceback.format_exc())\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     self.force_reraise()\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     six.reraise(self.type_, self.value, self.tb)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 119, in wrapped\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     return f(*dup_args, **dup_kwargs)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/api/v2/base.py\", line 361, in index\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     return self._items(request, True, parent_id)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/api/v2/base.py\", line 300, in _items\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     obj_list = obj_getter(request.context, **kwargs)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/vmware-nsx/vmware_nsx/plugins/nsx_v3/plugin.py\", line 2150, in get_ports\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     limit, marker, page_reverse))\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/api.py\", line 159, in wrapped\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     return method(*args, **kwargs)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/opt/stack/neutron/neutron/db/db_base_plugin_v2.py\", line 1301, in get_ports\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     items = [self._make_port_dict(c, fields) for c in query]\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2761, in __iter__\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     return self._execute_and_instances(context)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2774, in _execute_and_instances\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     close_with_result=True)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2765, in _connection_from_session\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     **kw)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 893, in connection\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     execution_options=execution_options)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 898, in _connection_for_bind\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     engine, execution_options)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 334, in _connection_for_bind\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     conn = bind.contextual_connect()\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2039, in contextual_connect\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     self._wrap_pool_connect(self.pool.connect, None),\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     return fn()\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 376, in connect\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     return _ConnectionFairy._checkout(self)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     fairy = _ConnectionRecord.checkout(pool)\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     rec = pool._do_get()\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1053, in _do_get\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource     (self.size(), self.overflow(), self._timeout))\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource TimeoutError: QueuePool limit of size 10 overflow 20 reached, connection timed out, timeout 10\n2016-11-02 20:42:00.247 18058 ERROR neutron.api.v2.resource\n\n\nNova Logs:\n\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack [req-fe286739-1aed-4a6d-b738-78e406fe1faf admin admin] Caught error: Request Failed: internal server error while processing your request.\nNeutron server returns request_ids: ['req-65a024cc-dad4-4484-98f4-349be67cb7aa']\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack Traceback (most recent call last):\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 89, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     return req.get_response(self.application)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1299, in send\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     application, catch_exc_info=False)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1263, in call_application\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/__init__.py\", line 323, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     response = req.get_response(self._app)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1299, in send\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     application, catch_exc_info=False)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1263, in call_application\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 141, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     response = self.app(environ, start_response)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     return resp(environ, start_response)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 609, in __call__\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     content_type, body, accept)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 689, in _process_stack\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     request, action_args)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 555, in process_extensions\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     **action_args)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/security_groups.py\", line 489, in show\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     return self._show(req, resp_obj)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/security_groups.py\", line 485, in _show\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     self._extend_servers(req, [resp_obj.obj['server']])\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/security_groups.py\", line 467, in _extend_servers\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     servers))\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/network/security_group/neutron_driver.py\", line 380, in get_instances_security_groups_bindings\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     ports = self._get_ports_from_server_list(servers, neutron)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/network/security_group/neutron_driver.py\", line 339, in _get_ports_from_server_list\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     ports.extend(neutron.list_ports(**search_opts).get('ports'))\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 97, in wrapper\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     ret = obj(*args, **kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 742, in list_ports\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     **_params)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 97, in wrapper\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     ret = obj(*args, **kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 375, in list\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     for r in self._pagination(collection, path, **params):\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 390, in _pagination\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     res = self.get(path, params=params)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 97, in wrapper\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     ret = obj(*args, **kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 360, in get\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     headers=headers, params=params)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 97, in wrapper\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     ret = obj(*args, **kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 337, in retry_request\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     headers=headers, params=params)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 97, in wrapper\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     ret = obj(*args, **kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 300, in do_request\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     self._handle_fault_response(status_code, replybody, resp)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 97, in wrapper\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     ret = obj(*args, **kwargs)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 275, in _handle_fault_response\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     exception_handler_v20(status_code, error_body)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 91, in exception_handler_v20\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack     request_ids=request_ids)\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack InternalServerError: Request Failed: internal server error while processing your request.\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack Neutron server returns request_ids: ['req-65a024cc-dad4-4484-98f4-349be67cb7aa']\n2016-11-02 20:42:00.268 17626 ERROR nova.api.openstack", 
            "date_created": "2016-11-15 13:33:42.016428+00:00", 
            "author": "https://api.launchpad.net/1.0/~sujai"
        }, 
        {
            "content": "For the second run:\n-------------------\n\nI have set the below parameters in /etc/neutron/neutron.conf.\n \nmax_pool_size = 50\nretry_interval = 10\nmax_overflow = 50\npool_max_size = 50\npool_max_overflow = 50\npool_timeout = 30\n\nAnd also I have set the below parameters in nova.conf.\n\nmax_pool_size = 50\nmax_overflow = 50\n\nFor the second run, I didn't get any ERROR messages in the neutron log. Only traces are found in nova log.\n\nNova Logs:\n\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] Unexpected exception in API method\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 914, in delete\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     self._delete(req.environ['nova.context'], req, id)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 755, in _delete\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     instance = self._get_server(context, req, instance_uuid)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 382, in _get_server\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     expected_attrs=expected_attrs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/common.py\", line 496, in get_instance\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     expected_attrs=expected_attrs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2215, in get\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     expected_attrs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2198, in _get_instance\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     context, instance_uuid, expected_attrs=expected_attrs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 184, in wrapper\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     result = fn(cls, context, *args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 444, in get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     use_slave=use_slave)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 225, in wrapper\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 436, in _db_instance_get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     columns_to_join=columns_to_join)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/api.py\", line 725, in instance_get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return IMPL.instance_get_by_uuid(context, uuid, columns_to_join)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 169, in wrapper\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 270, in wrapped\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return f(context, *args, **kwargs)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1867, in instance_get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     columns_to_join=columns_to_join)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 1872, in _instance_get_by_uuid\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     filter_by(uuid=uuid).\\\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2659, in first\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     ret = list(self[0:1])\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2457, in __getitem__\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return list(res)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2761, in __iter__\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return self._execute_and_instances(context)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2774, in _execute_and_instances\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     close_with_result=True)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2765, in _connection_from_session\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     **kw)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 893, in connection\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     execution_options=execution_options)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 898, in _connection_for_bind\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     engine, execution_options)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 334, in _connection_for_bind\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     conn = bind.contextual_connect()\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2039, in contextual_connect\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     self._wrap_pool_connect(self.pool.connect, None),\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return fn()\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 376, in connect\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     return _ConnectionFairy._checkout(self)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     fairy = _ConnectionRecord.checkout(pool)\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     rec = pool._do_get()\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1053, in _do_get\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions     (self.size(), self.overflow(), self._timeout))\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions TimeoutError: QueuePool limit of size 50 overflow 50 reached, connection timed out, timeout 30\n2016-11-03 17:27:34.146 2399 ERROR nova.api.openstack.extensions\n2016-11-03 17:27:34.148 2399 INFO nova.api.openstack.wsgi [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.TimeoutError'>\n2016-11-03 17:27:34.148 2399 DEBUG nova.api.openstack.wsgi [req-db3d6d66-9508-4eb8-be65-964f05ff50f8 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.TimeoutError'> __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1044\n\n ", 
            "date_created": "2016-11-15 13:36:13.803762+00:00", 
            "author": "https://api.launchpad.net/1.0/~sujai"
        }, 
        {
            "content": "not an expert in sqlalchema, but seems it's related to sqlalchema, instead of nova/neutron\nhave you tried to increase the value to even bigger? the error reported in sqlalchema and\nnova side really can't handle this 500 error, as it IS internal error because of connection timeout", 
            "date_created": "2016-11-24 14:02:43.172360+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "I kind of feel this is in the class of bugs of \"I hit everything with a sledge hammer really hard without tuning, and it fell over\". \n\nFalling over is what things do with out of the box defaults that are pushed way beyond their limits. ", 
            "date_created": "2016-12-09 13:28:16.733950+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}