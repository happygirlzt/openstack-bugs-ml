{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:55:37.380998+00:00", 
    "description": "When Nova associates of disassociates a floating IP address the network info cache is always refreshed (In both Nova net and Quantum) due to the @refresh_cache decorator\n\nHowever if you (re)associate a floating IP which is already associated with another instance on a Quantum based system then the address is correcly disassociated first, but the refresh is not trigged for that instance.  As a result Nova will show the same address for two instances until the periodic clean-up kicks in some minutes later.\n\nWatch what happens with 15.184.41.5 in the following:\n\n\n$nova list\n+--------------------------------------+------------+--------+----------------------------------+\n| ID                                   | Name       | Status | Networks                         |\n+--------------------------------------+------------+--------+----------------------------------+\n| 52e0533a-0399-4828-b9d7-f223c7e44aca | phil-natty | ACTIVE | philnet1=12.0.0.4, 15.184.41.5   |\n| 8184e9a7-3f56-46bc-8a3a-4fba68f7ce78 | phil2      | ACTIVE | philnet1=12.0.0.3, 15.184.40.176 |\n| 7ab2dff2-6a71-497a-b097-627833ebe680 | phil44     | ACTIVE | philnet1=12.0.0.5                |\n+--------------------------------------+------------+--------+----------------------------------+\n\n$quantum floatingip-list\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| id                                   | fixed_ip_address | floating_ip_address | port_id                              |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| 29d844c4-78f8-45fd-ae28-d518ea6d41ef | 12.0.0.4         | 15.184.41.5         | 4770c516-6b07-44c2-a07b-eb13a873f80e |\n| 9f0f7dfe-4e2f-4a60-8cfd-c7b8c7a10ea9 | 12.0.0.3         | 15.184.40.176       | 58cc4d39-7c20-4a36-bf5f-267a193f6f44 |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n\n$nova add-floating-ip 7ab2dff2-6a71-497a-b097-627833ebe680 15.184.41.5\n\n$quantum floatingip-list\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| id                                   | fixed_ip_address | floating_ip_address | port_id                              |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| 29d844c4-78f8-45fd-ae28-d518ea6d41ef | 12.0.0.5         | 15.184.41.5         | 3470b721-def6-48a9-8b19-16bd564dd795 |\n| 9f0f7dfe-4e2f-4a60-8cfd-c7b8c7a10ea9 | 12.0.0.3         | 15.184.40.176       | 58cc4d39-7c20-4a36-bf5f-267a193f6f44 |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n\n$nova list\n+--------------------------------------+------------+--------+----------------------------------+\n| ID                                   | Name       | Status | Networks                         |\n+--------------------------------------+------------+--------+----------------------------------+\n| 52e0533a-0399-4828-b9d7-f223c7e44aca | phil-natty | ACTIVE | philnet1=12.0.0.4, 15.184.41.5   |\n| 8184e9a7-3f56-46bc-8a3a-4fba68f7ce78 | phil2      | ACTIVE | philnet1=12.0.0.3, 15.184.40.176 |\n| 7ab2dff2-6a71-497a-b097-627833ebe680 | phil44     | ACTIVE | philnet1=12.0.0.5, 15.184.41.5   |\n+--------------------------------------+------------+--------+----------------------------------+\n\n\nNova Networking has specific handling for this case in its associate_floating_ip() method, which relies on the floating_manager returning the instance uuid of the original instance.  It doesn't look like the quantum client does this, so the quantumv2/api code will probably need to work this out for itself.", 
    "tags": [], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1173227", 
    "owner": "https://api.launchpad.net/1.0/~philip-day", 
    "id": 1173227, 
    "index": 1063, 
    "created": "2013-04-26 15:05:06.518002+00:00", 
    "title": "Nova doesn't refresh network cache when transferring a floating IP address", 
    "comments": [
        {
            "content": "When Nova associates of disassociates a floating IP address the network info cache is always refreshed (In both Nova net and Quantum) due to the @refresh_cache decorator\n\nHowever if you (re)associate a floating IP which is already associated with another instance on a Quantum based system then the address is correcly disassociated first, but the refresh is not trigged for that instance.  As a result Nova will show the same address for two instances until the periodic clean-up kicks in some minutes later.\n\nWatch what happens with 15.184.41.5 in the following:\n\n\n$nova list\n+--------------------------------------+------------+--------+----------------------------------+\n| ID                                   | Name       | Status | Networks                         |\n+--------------------------------------+------------+--------+----------------------------------+\n| 52e0533a-0399-4828-b9d7-f223c7e44aca | phil-natty | ACTIVE | philnet1=12.0.0.4, 15.184.41.5   |\n| 8184e9a7-3f56-46bc-8a3a-4fba68f7ce78 | phil2      | ACTIVE | philnet1=12.0.0.3, 15.184.40.176 |\n| 7ab2dff2-6a71-497a-b097-627833ebe680 | phil44     | ACTIVE | philnet1=12.0.0.5                |\n+--------------------------------------+------------+--------+----------------------------------+\n\n$quantum floatingip-list\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| id                                   | fixed_ip_address | floating_ip_address | port_id                              |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| 29d844c4-78f8-45fd-ae28-d518ea6d41ef | 12.0.0.4         | 15.184.41.5         | 4770c516-6b07-44c2-a07b-eb13a873f80e |\n| 9f0f7dfe-4e2f-4a60-8cfd-c7b8c7a10ea9 | 12.0.0.3         | 15.184.40.176       | 58cc4d39-7c20-4a36-bf5f-267a193f6f44 |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n\n$nova add-floating-ip 7ab2dff2-6a71-497a-b097-627833ebe680 15.184.41.5\n\n$quantum floatingip-list\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| id                                   | fixed_ip_address | floating_ip_address | port_id                              |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| 29d844c4-78f8-45fd-ae28-d518ea6d41ef | 12.0.0.5         | 15.184.41.5         | 3470b721-def6-48a9-8b19-16bd564dd795 |\n| 9f0f7dfe-4e2f-4a60-8cfd-c7b8c7a10ea9 | 12.0.0.3         | 15.184.40.176       | 58cc4d39-7c20-4a36-bf5f-267a193f6f44 |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n\n$nova list\n+--------------------------------------+------------+--------+----------------------------------+\n| ID                                   | Name       | Status | Networks                         |\n+--------------------------------------+------------+--------+----------------------------------+\n| 52e0533a-0399-4828-b9d7-f223c7e44aca | phil-natty | ACTIVE | philnet1=12.0.0.4, 15.184.41.5   |\n| 8184e9a7-3f56-46bc-8a3a-4fba68f7ce78 | phil2      | ACTIVE | philnet1=12.0.0.3, 15.184.40.176 |\n| 7ab2dff2-6a71-497a-b097-627833ebe680 | phil44     | ACTIVE | philnet1=12.0.0.5, 15.184.41.5   |\n+--------------------------------------+------------+--------+----------------------------------+\n\n\nNova Networking has specific handling for this case in its associate_floating_ip() method, which relies on the floating_manager returning the instance uuid of the original instance.  It doesn't look like the quantum client does this, so the quantumv2/api code will probably need to work this out for itself.", 
            "date_created": "2013-04-26 15:05:06.518002+00:00", 
            "author": "https://api.launchpad.net/1.0/~philip-day"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/33054", 
            "date_created": "2013-06-14 13:34:06.013927+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/33054\nCommitted: http://github.com/openstack/nova/commit/49fdad5b6d1e0878438571c2e9c0421bc522cb2e\nSubmitter: Jenkins\nBranch:    master\n\ncommit 49fdad5b6d1e0878438571c2e9c0421bc522cb2e\nAuthor: Phil Day <email address hidden>\nDate:   Fri Jun 14 14:26:51 2013 +0100\n\n    Refresh network cache when reassigning a floating IP in Neutron\n    \n    When Nova associates or disassociates a floating IP address\n    the network info cache is always refreshed due to the\n    @refresh_cache decorator\n    \n    However if you (re)associate a floating IP which is already\n    associated with another instance on a Neutron based system then\n    the address is correcly disassociated first, but the cache refresh\n    is not trigged for the original  instance. As a result Nova will\n    show the same address for two instances until the periodic\n    clean-up kicks in some minutes later.\n    \n    Fixed bug: 1173227\n    \n    Change-Id: Iea81532911478026b9b2c0578a1eda7a97b09d80\n", 
            "date_created": "2013-07-18 22:21:11.853793+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}