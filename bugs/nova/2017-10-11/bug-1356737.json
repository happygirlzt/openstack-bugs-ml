{
    "status": "Fix Released", 
    "last_updated": "2015-06-02 03:12:01.566645+00:00", 
    "description": "When doing backup on a vm which boot from cinder volume, it firstly shutdown vm and then do backup work.\nBut it fails and the detail exception log could be seen in the last part.\nWhen we need nova to backup a vm booted from cinder volume, we could do this by using cinder's function----copy volume to image.\nI think we could raise an exception when nova backup a vm from cinder volume.\n\n======Nova-compute exception log===================\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n    incoming.message))\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n    return self._do_dispatch(endpoint, method, ctxt, args)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n    result = getattr(endpoint, method)(ctxt, **new_args)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    payload)\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 285, in decorated_function\n    pass\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 313, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 301, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2741, in backup_instance\n    self._do_snapshot_instance(context, image_id, instance, rotation)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 360, in decorated_function\n    % image_id, instance=instance)\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 351, in decorated_function\n    *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2729, in _do_snapshot_instance\n    task_states.IMAGE_BACKUP)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2807, in _snapshot_instance\n    update_task_state)\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1501, in snapshot\n    image_type=source_format)\n  File \"/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 716, in snapshot\n    return backend(path=disk_path)\n  File \"/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 421, in __init__\n    info = libvirt_utils.logical_volume_info(path)\n  File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 336, in logical_volume_info\n    '--separator', '|', path, run_as_root=True)\n  File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 54, in execute\n    return utils.execute(*args, **kwargs)\n  File \"/opt/stack/nova/nova/utils.py\", line 164, in execute\n    return processutils.execute(*cmd, **kwargs)\n  File \"/opt/stack/nova/nova/openstack/common/processutils.py\", line 194, in execute\n    cmd=' '.join(cmd))\nProcessExecutionError: Unexpected error while running command.\nCommand: lvs -o vg_all,lv_all --separator | /dev/disk/by-path/ip-10.250.10.193:3260-iscsi-iqn.2010-10.org.openstack:volume-9ba91e05-050b-4dda-ac3c-9f3630c704c0-lun-1\nExit code: 5\nStdout: ''\nStderr: '  \"disk/by-path/ip-10.250.10.193:3260-iscsi-iqn.2010-10.org.openstack:volume-9ba91e05-050b-4dda-ac3c-9f3630c704c0-lun-1\": Invalid path for Logical Volume\\n'", 
    "tags": [
        "volumes"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1356737", 
    "owner": "https://api.launchpad.net/1.0/~wangxiyuan", 
    "id": 1356737, 
    "index": 69, 
    "created": "2014-08-14 06:56:56.140098+00:00", 
    "title": "nova backup vm should not backup those vm boot from cinder volume", 
    "comments": [
        {
            "content": "When doing backup on a vm which boot from cinder volume, it firstly shutdown vm and then do backup work.\nBut it fails and the detail exception log could be seen in the last part.\nWhen we need nova to backup a vm booted from cinder volume, we could do this by using cinder's function----copy volume to image.\nI think we could raise an exception when nova backup a vm from cinder volume.\n\n======Nova-compute exception log===================\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n    incoming.message))\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n    return self._do_dispatch(endpoint, method, ctxt, args)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n    result = getattr(endpoint, method)(ctxt, **new_args)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    payload)\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 285, in decorated_function\n    pass\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 313, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 301, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2741, in backup_instance\n    self._do_snapshot_instance(context, image_id, instance, rotation)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 360, in decorated_function\n    % image_id, instance=instance)\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 351, in decorated_function\n    *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2729, in _do_snapshot_instance\n    task_states.IMAGE_BACKUP)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2807, in _snapshot_instance\n    update_task_state)\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1501, in snapshot\n    image_type=source_format)\n  File \"/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 716, in snapshot\n    return backend(path=disk_path)\n  File \"/opt/stack/nova/nova/virt/libvirt/imagebackend.py\", line 421, in __init__\n    info = libvirt_utils.logical_volume_info(path)\n  File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 336, in logical_volume_info\n    '--separator', '|', path, run_as_root=True)\n  File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 54, in execute\n    return utils.execute(*args, **kwargs)\n  File \"/opt/stack/nova/nova/utils.py\", line 164, in execute\n    return processutils.execute(*cmd, **kwargs)\n  File \"/opt/stack/nova/nova/openstack/common/processutils.py\", line 194, in execute\n    cmd=' '.join(cmd))\nProcessExecutionError: Unexpected error while running command.\nCommand: lvs -o vg_all,lv_all --separator | /dev/disk/by-path/ip-10.250.10.193:3260-iscsi-iqn.2010-10.org.openstack:volume-9ba91e05-050b-4dda-ac3c-9f3630c704c0-lun-1\nExit code: 5\nStdout: ''\nStderr: '  \"disk/by-path/ip-10.250.10.193:3260-iscsi-iqn.2010-10.org.openstack:volume-9ba91e05-050b-4dda-ac3c-9f3630c704c0-lun-1\": Invalid path for Logical Volume\\n'", 
            "date_created": "2014-08-14 06:56:56.140098+00:00", 
            "author": "https://api.launchpad.net/1.0/~zengyunling"
        }, 
        {
            "content": "I'm not quite sure what you believe the solution is here, can you explain further?", 
            "date_created": "2014-09-12 14:56:24.608775+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Please don't assign incomplete bugs unless you have a patch. Otherwise they don't expire correctly if there is no response", 
            "date_created": "2014-09-18 12:33:37.289949+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "To Sean Dauge: \nThanks. I will submit the patch in next few days.", 
            "date_created": "2014-09-19 00:08:10.110177+00:00", 
            "author": "https://api.launchpad.net/1.0/~zengyunling"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/122900", 
            "date_created": "2014-09-20 00:29:05.031189+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Joe Gordon (<email address hidden>) on branch: master\nReview: https://review.openstack.org/122900\nReason: This review is > 4 weeks without comment, and failed Jenkins the last time it was checked. We are abandoning this for now. Feel free to reactivate the review by pressing the restore button and leaving a 'recheck' comment to get fresh test results.", 
            "date_created": "2015-05-13 17:26:18.919525+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}