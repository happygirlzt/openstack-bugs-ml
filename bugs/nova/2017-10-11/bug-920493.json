{
    "status": "Invalid", 
    "last_updated": "2012-02-01 18:31:06.721112+00:00", 
    "description": "It is my understanding, and observation, that vms allocated from the same --fixed_range network can ping the fixed addresses of other such vms. Also, vms can be pinged by fixed address from the compute node on which they are running. A user reported that when a floating ip was assigned to a vm, she could not access that vm by fixed address, but could by the floating address. I was able to reproduce this problem but not in a consistent way. It seemed more likely to happen when the floating ip address was assigned before the vm finished booting but I could not create a reliable pattern to show this. When the vm's fixed address was not accessible to other vms, it was still OK from the compute node hosting the vm. This system is based on diablo-stable and this nova.conf:\n\n--use_deprecated_auth\n--dhcpbridge_flagfile=/etc/nova/nova.conf\n--dhcpbridge=/usr/bin/nova-dhcpbridge\n--sql_connection=mysql://nova:notnova@172.18.0.131/nova\n--s3_host=172.18.0.131\n--rabbit_host=172.18.0.131\n--glance_api_servers=172.18.0.131:9292\n--logdir=/var/log/nova\n--state_path=/var/lib/nova\n--lock_path=/var/lock/nova\n--verbose\n--ec2_url=http://172.18.0.131:8773/services/Cloud\n--dmz_cidr=172.18.0.131/32\n--fixed_range=10.0.0.0/24\n--network_size=256\n--image_service=nova.image.glance.GlanceImageService\n--bridge_interface=eth1\n--flat_network_bridge=br100\n--flat_interface=eth1\n--network_manager=nova.network.manager.FlatDHCPManager\n--force_dhcp_release\n--public_interface=eth0\n--multi_host=1\n--osapi_host=172.18.0.131", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/920493", 
    "owner": "None", 
    "id": 920493, 
    "index": 2500, 
    "created": "2012-01-23 15:10:24.031027+00:00", 
    "title": "Sometimes vms on same fixed network cannot ping others if floating address present", 
    "comments": [
        {
            "content": "It is my understanding, and observation, that vms allocated from the same --fixed_range network can ping the fixed addresses of other such vms. Also, vms can be pinged by fixed address from the compute node on which they are running. A user reported that when a floating ip was assigned to a vm, she could not access that vm by fixed address, but could by the floating address. I was able to reproduce this problem but not in a consistent way. It seemed more likely to happen when the floating ip address was assigned before the vm finished booting but I could not create a reliable pattern to show this. When the vm's fixed address was not accessible to other vms, it was still OK from the compute node hosting the vm. This system is based on diablo-stable and this nova.conf:\n\n--use_deprecated_auth\n--dhcpbridge_flagfile=/etc/nova/nova.conf\n--dhcpbridge=/usr/bin/nova-dhcpbridge\n--sql_connection=mysql://nova:notnova@172.18.0.131/nova\n--s3_host=172.18.0.131\n--rabbit_host=172.18.0.131\n--glance_api_servers=172.18.0.131:9292\n--logdir=/var/log/nova\n--state_path=/var/lib/nova\n--lock_path=/var/lock/nova\n--verbose\n--ec2_url=http://172.18.0.131:8773/services/Cloud\n--dmz_cidr=172.18.0.131/32\n--fixed_range=10.0.0.0/24\n--network_size=256\n--image_service=nova.image.glance.GlanceImageService\n--bridge_interface=eth1\n--flat_network_bridge=br100\n--flat_interface=eth1\n--network_manager=nova.network.manager.FlatDHCPManager\n--force_dhcp_release\n--public_interface=eth0\n--multi_host=1\n--osapi_host=172.18.0.131", 
            "date_created": "2012-01-23 15:10:24.031027+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "This system has one controller node and two compute nodes.", 
            "date_created": "2012-01-23 15:11:11.353244+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "I think I misunderstood the problem. I recently saw that vms cannot access the other vms 10.0... addresses in the same cluster if the source and target are on different compute nodes. I think that was the real source of \"randomness\" I was seeing. The floating address was probably a red herring. This was using multi-host and running nova-network on each compute node. Is this a bug? If not, how are a set of vms in the cluster supposed to communicate?", 
            "date_created": "2012-01-27 15:25:18.088107+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "I have not seen this before, but it is possible your traffic is getting snatted between nodes.  you could try setting --dmz_cidr to 10.0.0.0/8\nand see if that makes a difference\nOn Jan 27, 2012, at 7:25 AM, David Kranz wrote:\n\n> I think I misunderstood the problem. I recently saw that vms cannot\n> access the other vms 10.0... addresses in the same cluster if the source\n> and target are on different compute nodes. I think that was the real\n> source of \"randomness\" I was seeing. The floating address was probably a\n> red herring. This was using multi-host and running nova-network on each\n> compute node. Is this a bug? If not, how are a set of vms in the cluster\n> supposed to communicate?\n> \n> -- \n> You received this bug notification because you are subscribed to\n> OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/920493\n> \n> Title:\n>  Sometimes vms on same fixed network cannot ping others if floating\n>  address present\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  It is my understanding, and observation, that vms allocated from the\n>  same --fixed_range network can ping the fixed addresses of other such\n>  vms. Also, vms can be pinged by fixed address from the compute node on\n>  which they are running. A user reported that when a floating ip was\n>  assigned to a vm, she could not access that vm by fixed address, but\n>  could by the floating address. I was able to reproduce this problem\n>  but not in a consistent way. It seemed more likely to happen when the\n>  floating ip address was assigned before the vm finished booting but I\n>  could not create a reliable pattern to show this. When the vm's fixed\n>  address was not accessible to other vms, it was still OK from the\n>  compute node hosting the vm. This system is based on diablo-stable and\n>  this nova.conf:\n> \n>  --use_deprecated_auth\n>  --dhcpbridge_flagfile=/etc/nova/nova.conf\n>  --dhcpbridge=/usr/bin/nova-dhcpbridge\n>  --sql_connection=mysql://nova:notnova@172.18.0.131/nova\n>  --s3_host=172.18.0.131\n>  --rabbit_host=172.18.0.131\n>  --glance_api_servers=172.18.0.131:9292\n>  --logdir=/var/log/nova\n>  --state_path=/var/lib/nova\n>  --lock_path=/var/lock/nova\n>  --verbose\n>  --ec2_url=http://172.18.0.131:8773/services/Cloud\n>  --dmz_cidr=172.18.0.131/32\n>  --fixed_range=10.0.0.0/24\n>  --network_size=256\n>  --image_service=nova.image.glance.GlanceImageService\n>  --bridge_interface=eth1\n>  --flat_network_bridge=br100\n>  --flat_interface=eth1\n>  --network_manager=nova.network.manager.FlatDHCPManager\n>  --force_dhcp_release\n>  --public_interface=eth0\n>  --multi_host=1\n>  --osapi_host=172.18.0.131\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/920493/+subscriptions\n\n", 
            "date_created": "2012-01-27 18:19:09+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "You are probably right. I recently removed a dmz_cidr because it prevented a vm from accessing the address of the controller node. I will try this again. ", 
            "date_created": "2012-01-27 18:29:49.157869+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "Actually that did not seem to have any effect. How many people are using multi_host? I would change the title of this ticket but don't know how.", 
            "date_created": "2012-01-27 18:59:13.171110+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "A lot of people.  Let me check in our environment and see if I have the same issue.\n\nOn Jan 27, 2012, at 10:59 AM, David Kranz wrote:\n\n> Actually that did not seem to have any effect. How many people are using\n> multi_host? I would change the title of this ticket but don't know how.\n> \n> -- \n> You received this bug notification because you are subscribed to\n> OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/920493\n> \n> Title:\n>  Sometimes vms on same fixed network cannot ping others if floating\n>  address present\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  It is my understanding, and observation, that vms allocated from the\n>  same --fixed_range network can ping the fixed addresses of other such\n>  vms. Also, vms can be pinged by fixed address from the compute node on\n>  which they are running. A user reported that when a floating ip was\n>  assigned to a vm, she could not access that vm by fixed address, but\n>  could by the floating address. I was able to reproduce this problem\n>  but not in a consistent way. It seemed more likely to happen when the\n>  floating ip address was assigned before the vm finished booting but I\n>  could not create a reliable pattern to show this. When the vm's fixed\n>  address was not accessible to other vms, it was still OK from the\n>  compute node hosting the vm. This system is based on diablo-stable and\n>  this nova.conf:\n> \n>  --use_deprecated_auth\n>  --dhcpbridge_flagfile=/etc/nova/nova.conf\n>  --dhcpbridge=/usr/bin/nova-dhcpbridge\n>  --sql_connection=mysql://nova:notnova@172.18.0.131/nova\n>  --s3_host=172.18.0.131\n>  --rabbit_host=172.18.0.131\n>  --glance_api_servers=172.18.0.131:9292\n>  --logdir=/var/log/nova\n>  --state_path=/var/lib/nova\n>  --lock_path=/var/lock/nova\n>  --verbose\n>  --ec2_url=http://172.18.0.131:8773/services/Cloud\n>  --dmz_cidr=172.18.0.131/32\n>  --fixed_range=10.0.0.0/24\n>  --network_size=256\n>  --image_service=nova.image.glance.GlanceImageService\n>  --bridge_interface=eth1\n>  --flat_network_bridge=br100\n>  --flat_interface=eth1\n>  --network_manager=nova.network.manager.FlatDHCPManager\n>  --force_dhcp_release\n>  --public_interface=eth0\n>  --multi_host=1\n>  --osapi_host=172.18.0.131\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/920493/+subscriptions\n\n", 
            "date_created": "2012-01-27 19:20:26+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "I just tested this in our lab and it works fine.  My guess is that your router isn't set up to allow the 10.x range traffic.  Perhaps you have port security on? It has to allow traffic across the ports that br100 is bridging into.\n\nVish\n\nOn Jan 27, 2012, at 10:59 AM, David Kranz wrote:\n\n> Actually that did not seem to have any effect. How many people are using\n> multi_host? I would change the title of this ticket but don't know how.\n> \n> -- \n> You received this bug notification because you are subscribed to\n> OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/920493\n> \n> Title:\n>  Sometimes vms on same fixed network cannot ping others if floating\n>  address present\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  It is my understanding, and observation, that vms allocated from the\n>  same --fixed_range network can ping the fixed addresses of other such\n>  vms. Also, vms can be pinged by fixed address from the compute node on\n>  which they are running. A user reported that when a floating ip was\n>  assigned to a vm, she could not access that vm by fixed address, but\n>  could by the floating address. I was able to reproduce this problem\n>  but not in a consistent way. It seemed more likely to happen when the\n>  floating ip address was assigned before the vm finished booting but I\n>  could not create a reliable pattern to show this. When the vm's fixed\n>  address was not accessible to other vms, it was still OK from the\n>  compute node hosting the vm. This system is based on diablo-stable and\n>  this nova.conf:\n> \n>  --use_deprecated_auth\n>  --dhcpbridge_flagfile=/etc/nova/nova.conf\n>  --dhcpbridge=/usr/bin/nova-dhcpbridge\n>  --sql_connection=mysql://nova:notnova@172.18.0.131/nova\n>  --s3_host=172.18.0.131\n>  --rabbit_host=172.18.0.131\n>  --glance_api_servers=172.18.0.131:9292\n>  --logdir=/var/log/nova\n>  --state_path=/var/lib/nova\n>  --lock_path=/var/lock/nova\n>  --verbose\n>  --ec2_url=http://172.18.0.131:8773/services/Cloud\n>  --dmz_cidr=172.18.0.131/32\n>  --fixed_range=10.0.0.0/24\n>  --network_size=256\n>  --image_service=nova.image.glance.GlanceImageService\n>  --bridge_interface=eth1\n>  --flat_network_bridge=br100\n>  --flat_interface=eth1\n>  --network_manager=nova.network.manager.FlatDHCPManager\n>  --force_dhcp_release\n>  --public_interface=eth0\n>  --multi_host=1\n>  --osapi_host=172.18.0.131\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/920493/+subscriptions\n\n", 
            "date_created": "2012-01-27 20:27:34+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Thanks, Vish. I will check it out.", 
            "date_created": "2012-01-28 17:41:57.119112+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "The machines were not configured to bring up eth1. Sorry for the trouble.", 
            "date_created": "2012-02-01 18:30:55.128431+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }
    ]
}