{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:11:16.172478+00:00", 
    "description": "(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/__init__.py\", line 60, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/wsgi.py\", line 452, in __call__\n(nova.api.openstack): TRACE:     action_result = self.dispatch(request, action, args)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/wsgi.py\", line 481, in dispatch\n(nova.api.openstack): TRACE:     return controller_method(req=request, **action_args)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 61, in detail\n(nova.api.openstack): TRACE:     servers = self._items(req, is_detail=True)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 93, in _items\n(nova.api.openstack): TRACE:     for inst in limited_list]\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 500, in _build_view\n(nova.api.openstack): TRACE:     return builder.build(instance, is_detail=is_detail)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/views/servers.py\", line 49, in build\n(nova.api.openstack): TRACE:     server = self._build_detail(inst)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/views/servers.py\", line 100, in _build_detail\n(nova.api.openstack): TRACE:     self._build_addresses(inst_dict, inst)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/views/servers.py\", line 163, in _build_addresses\n(nova.api.openstack): TRACE:     response['addresses'] = self.addresses_builder.build(interfaces)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/views/addresses.py\", line 51, in build\n(nova.api.openstack): TRACE:     network_label = interface['network']['label']\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/models.py\", line 75, in __getitem__\n(nova.api.openstack): TRACE:     return getattr(self, key)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/attributes.py\", line 163, in __get__\n(nova.api.openstack): TRACE:     instance_dict(instance))\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/attributes.py\", line 382, in get\n(nova.api.openstack): TRACE:     value = callable_(passive=passive)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/strategies.py\", line 578, in __call__\n(nova.api.openstack): TRACE:     (mapperutil.state_str(state), self.key)\n(nova.api.openstack): TRACE: DetachedInstanceError: Parent instance <VirtualInterface at 0x5859990> is not bound to a Session; lazy load operation of attribute 'network' cannot proceed\n(nova.api.openstack): TRACE:\n\nRunning rev 1304.  I get this exception in the nova-api when doing a 'nova list'.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/815957", 
    "owner": "https://api.launchpad.net/1.0/~cbehrens", 
    "id": 815957, 
    "index": 2469, 
    "created": "2011-07-25 15:22:04.819060+00:00", 
    "title": "lazy load operation of attribute 'network' cannot proceed", 
    "comments": [
        {
            "content": "(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/__init__.py\", line 60, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/wsgi.py\", line 452, in __call__\n(nova.api.openstack): TRACE:     action_result = self.dispatch(request, action, args)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/wsgi.py\", line 481, in dispatch\n(nova.api.openstack): TRACE:     return controller_method(req=request, **action_args)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 61, in detail\n(nova.api.openstack): TRACE:     servers = self._items(req, is_detail=True)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 93, in _items\n(nova.api.openstack): TRACE:     for inst in limited_list]\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/servers.py\", line 500, in _build_view\n(nova.api.openstack): TRACE:     return builder.build(instance, is_detail=is_detail)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/views/servers.py\", line 49, in build\n(nova.api.openstack): TRACE:     server = self._build_detail(inst)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/views/servers.py\", line 100, in _build_detail\n(nova.api.openstack): TRACE:     self._build_addresses(inst_dict, inst)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/views/servers.py\", line 163, in _build_addresses\n(nova.api.openstack): TRACE:     response['addresses'] = self.addresses_builder.build(interfaces)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/views/addresses.py\", line 51, in build\n(nova.api.openstack): TRACE:     network_label = interface['network']['label']\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/models.py\", line 75, in __getitem__\n(nova.api.openstack): TRACE:     return getattr(self, key)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/attributes.py\", line 163, in __get__\n(nova.api.openstack): TRACE:     instance_dict(instance))\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/attributes.py\", line 382, in get\n(nova.api.openstack): TRACE:     value = callable_(passive=passive)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/strategies.py\", line 578, in __call__\n(nova.api.openstack): TRACE:     (mapperutil.state_str(state), self.key)\n(nova.api.openstack): TRACE: DetachedInstanceError: Parent instance <VirtualInterface at 0x5859990> is not bound to a Session; lazy load operation of attribute 'network' cannot proceed\n(nova.api.openstack): TRACE:\n\nRunning rev 1304.  I get this exception in the nova-api when doing a 'nova list'.", 
            "date_created": "2011-07-25 15:22:04.819060+00:00", 
            "author": "https://api.launchpad.net/1.0/~antonym"
        }, 
        {
            "content": "Can't reproduce that... Would you have a bit more information on your setup ? Do all calls to nova list fail that way ?", 
            "date_created": "2011-07-28 10:26:01.780746+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "We had a similar issue with lazy loading metadata a while back.  It seemingly would happen randomly.  To fix it, the instance_get* queries were modified to joinedload('metadata') at the time of the DB query, instead of having it try to be fetched later (lazy load).\n\nSo, my guess is that in nova/db/sqlalchemy/api.py, in all of the instance_get* calls, we should change joinedload('virtual_interfaces') to  joinedload_all('virtual_interfaces.network').\n", 
            "date_created": "2011-07-29 11:49:20.344028+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "This happens to be fixed in my branch for adding search options to the API.  Linked it to the bug...", 
            "date_created": "2011-08-05 20:55:57.210950+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "for future reference: the issue is that certain related objects are not being loaded by sqlalchemy api calls, for example using a joinedload() or a joinedload_all()", 
            "date_created": "2011-08-08 20:04:01.235531+00:00", 
            "author": "https://api.launchpad.net/1.0/~tr3buchet"
        }
    ]
}