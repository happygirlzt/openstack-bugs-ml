{
    "status": "Invalid", 
    "last_updated": "2011-12-02 14:10:51.918767+00:00", 
    "description": "Hi everyone, I think maybe I found a bug because I updated all the nova packages and I still have the issue, here are the packages I have:\n\nnova-api_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root    24528 2011-07-01 17:12 nova-common_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root     9768 2011-07-01 17:12 nova-compute_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root  1794284 2011-07-01 17:12 nova-doc_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root    11094 2011-07-01 17:12 nova-network_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root     9868 2011-07-01 17:12 nova-objectstore_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root     9542 2011-07-01 17:12 nova-scheduler_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n\n\nThe problem is that I can't launch instances, when I try to launch a new instance I get the following error in nova-compute.log:\n\n\n2011-07-01 18:43:08,309 DEBUG nova.rpc [-] unpacked context: {'timestamp': u'2011-07-01T17:43:07Z', 'msg_id': None, 'remote_address': u'10.0.20.30', 'project': u'proj1', 'is_admin': True, 'user': u'diegote', 'request_id': u'W0CKDSKB0W1-1DSL3HOP', 'read_deleted': False} from (pid=1811) _unpack_context /usr/lib/pymodules/python2.6/nova/rpc.py:451\n2011-07-01 18:43:08,360 AUDIT nova.compute.manager [W0CKDSKB0W1-1DSL3HOP diegote proj1] instance 2: starting...\n2011-07-01 18:43:08,460 DEBUG nova.rpc [-] Making asynchronous call on network ... from (pid=1811) multicall /usr/lib/pymodules/python2.6/nova/rpc.py:481\n2011-07-01 18:43:08,460 DEBUG nova.rpc [-] MSG_ID is 69e816d625cb4c0a94934bd309166836 from (pid=1811) multicall /usr/lib/pymodules/python2.6/nova/rpc.py:484\n2011-07-01 18:43:08,951 DEBUG nova.compute.manager [-] instance network_info: |[[{u'injected': False, u'bridge': u'br100', u'cidr_v6': None, u'cidr': u'192.168.3.0/25', u'id': 1}, {u'label': u'public', u'broadcast': u'192.168.3.127', u'ips': [{u'ip': u'192.168.3.3', u'netmask': u'255.255.255.128', u'enabled': u'1'}], u'mac': u'02:16:3e:1f:d2:ac', u'rxtx_cap': 0, u'dns': [u'8.8.4.4'], u'gateway': u'192.168.3.1'}]]| from (pid=1811) _run_instance /usr/lib/pymodules/python2.6/nova/compute/manager.py:295\n2011-07-01 18:43:08,967 DEBUG nova.utils [-] Attempting to grab semaphore \"ensure_bridge\" for method \"ensure_bridge\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:08,967 DEBUG nova.utils [-] Attempting to grab file lock \"ensure_bridge\" for method \"ensure_bridge\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:605\n2011-07-01 18:43:08,968 DEBUG nova.utils [-] Running cmd (subprocess): ip link show dev br100 from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,195 DEBUG nova.virt.libvirt_conn [-] instance instance-00000002: starting toXML method from (pid=1811) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt/connection.py:1035\n2011-07-01 18:43:09,273 DEBUG nova.virt.libvirt_conn [-] instance instance-00000002: finished toXML method from (pid=1811) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt/connection.py:1039\n2011-07-01 18:43:09,274 INFO nova [-] called setup_basic_filtering in nwfilter\n2011-07-01 18:43:09,276 INFO nova [-] ensuring static filters\n2011-07-01 18:43:09,299 DEBUG nova.virt.libvirt.firewall [-] iptables firewall: Setup Basic Filtering from (pid=1811) setup_basic_filtering /usr/lib/pymodules/python2.6/nova/virt/libvirt/firewall.py:537\n2011-07-01 18:43:09,299 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"_do_refresh_provider_fw_rules\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,300 DEBUG nova.utils [-] Attempting to grab file lock \"iptables\" for method \"_do_refresh_provider_fw_rules\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:605\n2011-07-01 18:43:09,303 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"apply\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,303 DEBUG nova.utils [-] Attempting to grab file lock \"iptables\" for method \"apply\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:605\n2011-07-01 18:43:09,304 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,332 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,361 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,395 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,465 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"apply\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,466 DEBUG nova.utils [-] Attempting to grab file lock \"iptables\" for method \"apply\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:605\n2011-07-01 18:43:09,466 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,496 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,532 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,573 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,614 DEBUG nova.utils [-] Running cmd (subprocess): mkdir -p /var/lib/nova/instances/instance-00000002/ from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,631 INFO nova.virt.libvirt_conn [-] instance instance-00000002: Creating image\n2011-07-01 18:43:09,650 DEBUG nova.utils [-] Attempting to grab semaphore \"00000002\" for method \"call_if_not_exists\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,651 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/00000002 /var/lib/nova/instances/instance-00000002/kernel from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,764 DEBUG nova.utils [-] Attempting to grab semaphore \"00000003\" for method \"call_if_not_exists\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,767 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/00000003 /var/lib/nova/instances/instance-00000002/ramdisk from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,857 DEBUG nova.utils [-] Attempting to grab semaphore \"356a192b7913b04c54574d18c28d46e6395428ab_sm\" for method \"call_if_not_exists\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,858 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img create -f qcow2 -o cluster_size=2M,backing_file=/var/lib/nova/instances/_base/356a192b7913b04c54574d18c28d46e6395428ab_sm /var/lib/nova/instances/instance-00000002/disk from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,997 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 87, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt/connection.py\", line 591, in spawn\n(nova.exception): TRACE:     domain = self._create_new_domain(xml)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt/connection.py\", line 1085, in _create_new_domain\n(nova.exception): TRACE:     domain = self._conn.defineXML(xml)\n(nova.exception): TRACE:   File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1368, in defineXML\n(nova.exception): TRACE:     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)\n(nova.exception): TRACE: libvirtError: internal error no supported architecture for os type 'hvm'\n(nova.exception): TRACE: \n2011-07-01 18:43:10,027 ERROR nova.compute.manager [-] Instance '2' failed to spawn. Is virtualization enabled in the BIOS? Details: internal error no supported architecture for os type 'hvm'\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 311, in _run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance, network_info, bd_mapping)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 93, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: internal error no supported architecture for os type 'hvm'\n(nova.compute.manager): TRACE: \n2011-07-01 18:43:10,621 INFO nova.compute.manager [-] Updating host status\n2011-07-01 18:43:10,658 INFO nova.compute.manager [-] Found instance 'instance-00000002' in DB but no VM. State=8, so setting state to shutoff.\n2011-07-01 18:43:10,658 INFO nova.compute.manager [-] DB/VM state mismatch. Changing state from '8' to '5'\n\n\nI went to /var/lib/nova/instances/instance-00000002/ and watched libvirt.xml file, here is it's contents:\n\n\n<domain type='kvm'>\n    <name>instance-00000002</name>\n    <memory>524288</memory>\n    <os>\n            <type>hvm</type>\n            <kernel>/var/lib/nova/instances/instance-00000002/kernel</kernel>\n                <cmdline>root=/dev/vda console=ttyS0</cmdline>\n                <initrd>/var/lib/nova/instances/instance-00000002/ramdisk</initrd>\n    </os>\n    <features>\n        <acpi/>\n    </features>\n    <vcpu>1</vcpu>\n    <devices>\n        <disk type='file'>\n            <driver type='qcow2'/>\n            <source file='/var/lib/nova/instances/instance-00000002/disk'/>\n            <target dev='vda' bus='virtio'/>\n        </disk>\n\n        <interface type='bridge'>\n            <source bridge='br100'/>\n            <mac address='02:16:3e:1f:d2:ac'/>\n            <!--   <model type='virtio'/>  CANT RUN virtio network right now -->\n            <filterref filter=\"nova-instance-instance-00000002-02163e1fd2ac\">\n                <parameter name=\"IP\" value=\"192.168.3.3\" />\n                <parameter name=\"DHCPSERVER\" value=\"192.168.3.1\" />\n            </filterref>\n        </interface>\n        <!-- The order is significant here.  File must be defined first -->\n        <serial type=\"file\">\n            <source path='/var/lib/nova/instances/instance-00000002/console.log'/>\n            <target port='1'/>\n        </serial>\n\n        <console type='pty' tty='/dev/pts/2'>\n            <source path='/dev/pts/2'/>\n            <target port='0'/>\n        </console>\n\n        <serial type='pty'>\n            <source path='/dev/pts/2'/>\n            <target port='0'/>\n        </serial>\n\n        <graphics type='vnc' port='-1' autoport='yes' keymap='en-us' listen='0.0.0.0'/>\n    </devices>\n</domain>\n\nAfter googling a little I tried this modification:\n\n\n<type arch=\"i686\">hvm</type> \n\nwith this modification I executed: \"virsh create libvirt.xml\" and the domain was successfully created. I'm not sure if this is a bug or not but I post it anyway :)\n\n\nCheers\nDiego", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/804450", 
    "owner": "None", 
    "id": 804450, 
    "index": 2187, 
    "created": "2011-07-01 17:57:44.244124+00:00", 
    "title": "Error: internal error no supported architecture for os type 'hvm'", 
    "comments": [
        {
            "content": "Hi everyone, I think maybe I found a bug because I updated all the nova packages and I still have the issue, here are the packages I have:\n\nnova-api_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root    24528 2011-07-01 17:12 nova-common_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root     9768 2011-07-01 17:12 nova-compute_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root  1794284 2011-07-01 17:12 nova-doc_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root    11094 2011-07-01 17:12 nova-network_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root     9868 2011-07-01 17:12 nova-objectstore_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n-rw-r--r-- 1 root root     9542 2011-07-01 17:12 nova-scheduler_2011.3~d3~20110701.1244-0ubuntu0ppa1~maverick1_all.deb\n\n\nThe problem is that I can't launch instances, when I try to launch a new instance I get the following error in nova-compute.log:\n\n\n2011-07-01 18:43:08,309 DEBUG nova.rpc [-] unpacked context: {'timestamp': u'2011-07-01T17:43:07Z', 'msg_id': None, 'remote_address': u'10.0.20.30', 'project': u'proj1', 'is_admin': True, 'user': u'diegote', 'request_id': u'W0CKDSKB0W1-1DSL3HOP', 'read_deleted': False} from (pid=1811) _unpack_context /usr/lib/pymodules/python2.6/nova/rpc.py:451\n2011-07-01 18:43:08,360 AUDIT nova.compute.manager [W0CKDSKB0W1-1DSL3HOP diegote proj1] instance 2: starting...\n2011-07-01 18:43:08,460 DEBUG nova.rpc [-] Making asynchronous call on network ... from (pid=1811) multicall /usr/lib/pymodules/python2.6/nova/rpc.py:481\n2011-07-01 18:43:08,460 DEBUG nova.rpc [-] MSG_ID is 69e816d625cb4c0a94934bd309166836 from (pid=1811) multicall /usr/lib/pymodules/python2.6/nova/rpc.py:484\n2011-07-01 18:43:08,951 DEBUG nova.compute.manager [-] instance network_info: |[[{u'injected': False, u'bridge': u'br100', u'cidr_v6': None, u'cidr': u'192.168.3.0/25', u'id': 1}, {u'label': u'public', u'broadcast': u'192.168.3.127', u'ips': [{u'ip': u'192.168.3.3', u'netmask': u'255.255.255.128', u'enabled': u'1'}], u'mac': u'02:16:3e:1f:d2:ac', u'rxtx_cap': 0, u'dns': [u'8.8.4.4'], u'gateway': u'192.168.3.1'}]]| from (pid=1811) _run_instance /usr/lib/pymodules/python2.6/nova/compute/manager.py:295\n2011-07-01 18:43:08,967 DEBUG nova.utils [-] Attempting to grab semaphore \"ensure_bridge\" for method \"ensure_bridge\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:08,967 DEBUG nova.utils [-] Attempting to grab file lock \"ensure_bridge\" for method \"ensure_bridge\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:605\n2011-07-01 18:43:08,968 DEBUG nova.utils [-] Running cmd (subprocess): ip link show dev br100 from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,195 DEBUG nova.virt.libvirt_conn [-] instance instance-00000002: starting toXML method from (pid=1811) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt/connection.py:1035\n2011-07-01 18:43:09,273 DEBUG nova.virt.libvirt_conn [-] instance instance-00000002: finished toXML method from (pid=1811) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt/connection.py:1039\n2011-07-01 18:43:09,274 INFO nova [-] called setup_basic_filtering in nwfilter\n2011-07-01 18:43:09,276 INFO nova [-] ensuring static filters\n2011-07-01 18:43:09,299 DEBUG nova.virt.libvirt.firewall [-] iptables firewall: Setup Basic Filtering from (pid=1811) setup_basic_filtering /usr/lib/pymodules/python2.6/nova/virt/libvirt/firewall.py:537\n2011-07-01 18:43:09,299 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"_do_refresh_provider_fw_rules\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,300 DEBUG nova.utils [-] Attempting to grab file lock \"iptables\" for method \"_do_refresh_provider_fw_rules\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:605\n2011-07-01 18:43:09,303 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"apply\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,303 DEBUG nova.utils [-] Attempting to grab file lock \"iptables\" for method \"apply\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:605\n2011-07-01 18:43:09,304 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,332 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,361 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,395 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,465 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"apply\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,466 DEBUG nova.utils [-] Attempting to grab file lock \"iptables\" for method \"apply\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:605\n2011-07-01 18:43:09,466 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,496 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,532 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,573 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,614 DEBUG nova.utils [-] Running cmd (subprocess): mkdir -p /var/lib/nova/instances/instance-00000002/ from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,631 INFO nova.virt.libvirt_conn [-] instance instance-00000002: Creating image\n2011-07-01 18:43:09,650 DEBUG nova.utils [-] Attempting to grab semaphore \"00000002\" for method \"call_if_not_exists\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,651 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/00000002 /var/lib/nova/instances/instance-00000002/kernel from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,764 DEBUG nova.utils [-] Attempting to grab semaphore \"00000003\" for method \"call_if_not_exists\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,767 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/00000003 /var/lib/nova/instances/instance-00000002/ramdisk from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,857 DEBUG nova.utils [-] Attempting to grab semaphore \"356a192b7913b04c54574d18c28d46e6395428ab_sm\" for method \"call_if_not_exists\"... from (pid=1811) inner /usr/lib/pymodules/python2.6/nova/utils.py:600\n2011-07-01 18:43:09,858 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img create -f qcow2 -o cluster_size=2M,backing_file=/var/lib/nova/instances/_base/356a192b7913b04c54574d18c28d46e6395428ab_sm /var/lib/nova/instances/instance-00000002/disk from (pid=1811) execute /usr/lib/pymodules/python2.6/nova/utils.py:143\n2011-07-01 18:43:09,997 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 87, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt/connection.py\", line 591, in spawn\n(nova.exception): TRACE:     domain = self._create_new_domain(xml)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt/connection.py\", line 1085, in _create_new_domain\n(nova.exception): TRACE:     domain = self._conn.defineXML(xml)\n(nova.exception): TRACE:   File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1368, in defineXML\n(nova.exception): TRACE:     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)\n(nova.exception): TRACE: libvirtError: internal error no supported architecture for os type 'hvm'\n(nova.exception): TRACE: \n2011-07-01 18:43:10,027 ERROR nova.compute.manager [-] Instance '2' failed to spawn. Is virtualization enabled in the BIOS? Details: internal error no supported architecture for os type 'hvm'\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 311, in _run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance, network_info, bd_mapping)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 93, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: internal error no supported architecture for os type 'hvm'\n(nova.compute.manager): TRACE: \n2011-07-01 18:43:10,621 INFO nova.compute.manager [-] Updating host status\n2011-07-01 18:43:10,658 INFO nova.compute.manager [-] Found instance 'instance-00000002' in DB but no VM. State=8, so setting state to shutoff.\n2011-07-01 18:43:10,658 INFO nova.compute.manager [-] DB/VM state mismatch. Changing state from '8' to '5'\n\n\nI went to /var/lib/nova/instances/instance-00000002/ and watched libvirt.xml file, here is it's contents:\n\n\n<domain type='kvm'>\n    <name>instance-00000002</name>\n    <memory>524288</memory>\n    <os>\n            <type>hvm</type>\n            <kernel>/var/lib/nova/instances/instance-00000002/kernel</kernel>\n                <cmdline>root=/dev/vda console=ttyS0</cmdline>\n                <initrd>/var/lib/nova/instances/instance-00000002/ramdisk</initrd>\n    </os>\n    <features>\n        <acpi/>\n    </features>\n    <vcpu>1</vcpu>\n    <devices>\n        <disk type='file'>\n            <driver type='qcow2'/>\n            <source file='/var/lib/nova/instances/instance-00000002/disk'/>\n            <target dev='vda' bus='virtio'/>\n        </disk>\n\n        <interface type='bridge'>\n            <source bridge='br100'/>\n            <mac address='02:16:3e:1f:d2:ac'/>\n            <!--   <model type='virtio'/>  CANT RUN virtio network right now -->\n            <filterref filter=\"nova-instance-instance-00000002-02163e1fd2ac\">\n                <parameter name=\"IP\" value=\"192.168.3.3\" />\n                <parameter name=\"DHCPSERVER\" value=\"192.168.3.1\" />\n            </filterref>\n        </interface>\n        <!-- The order is significant here.  File must be defined first -->\n        <serial type=\"file\">\n            <source path='/var/lib/nova/instances/instance-00000002/console.log'/>\n            <target port='1'/>\n        </serial>\n\n        <console type='pty' tty='/dev/pts/2'>\n            <source path='/dev/pts/2'/>\n            <target port='0'/>\n        </console>\n\n        <serial type='pty'>\n            <source path='/dev/pts/2'/>\n            <target port='0'/>\n        </serial>\n\n        <graphics type='vnc' port='-1' autoport='yes' keymap='en-us' listen='0.0.0.0'/>\n    </devices>\n</domain>\n\nAfter googling a little I tried this modification:\n\n\n<type arch=\"i686\">hvm</type> \n\nwith this modification I executed: \"virsh create libvirt.xml\" and the domain was successfully created. I'm not sure if this is a bug or not but I post it anyway :)\n\n\nCheers\nDiego", 
            "date_created": "2011-07-01 17:57:44.244124+00:00", 
            "author": "https://api.launchpad.net/1.0/~diego-lalo"
        }, 
        {
            "content": "This is the error you get with KVM when running on unsupported hardware. You need a VT-enabled processor to use KVM, and make sure that virtualization is enabled in the BIOS. The \"kvm-ok\" command on Ubuntu can help you in troubleshooting that.", 
            "date_created": "2011-07-04 08:54:05.233931+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "     Hi Thierry, this is the output of kvm-ok on the machine I had the problem:\n\nkvm-ok \nINFO: Your CPU supports KVM extensions\nINFO: /dev/kvm exists\nKVM acceleration can be used\n\nWith this version of the nova packages I don't have the error I posted:\n\nii  nova-api                         2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - API frontend\nii  nova-common                      2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - common files\nii  nova-compute                     2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - compute node\nii  nova-doc                         2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - documetation\nii  nova-network                     2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - Network manager\nii  nova-objectstore                 2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - object store\nii  nova-scheduler                   2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - virtual machine scheduler\nii  python-nova                      2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute Python libraries\nii  python-novaclient                2.4-0ubuntu1~ppa1\n\n\nCheers\nDiego", 
            "date_created": "2011-07-04 12:29:20.605097+00:00", 
            "author": "https://api.launchpad.net/1.0/~diego-lalo"
        }, 
        {
            "content": "Interesting. So you have the issue with rev1244 but not with rev1058... Is it the only difference ? For example, is libvirt version the same in both cases ?\r\n\r\nI'm asking because the error you get is actually not from Nova, but from libvirt (nova calls virDomainDefineXML() and libvirt answers \"internal error no supported architecture for os type 'hvm'\", which is the cryptic error that libvirt returns when CPU does not support KVM extensions).", 
            "date_created": "2011-07-05 09:09:47.290058+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Yes Thierry, is the same version:\n\n\nroot@eucalyptus:~# libvirtd --version\nlibvirtd (libvirt) 0.8.8\nroot@eucalyptus:~#\n\nroot@openstack-in-a-box-1rev87:~# libvirtd --version\nlibvirtd (libvirt) 0.8.8\nroot@openstack-in-a-box-1rev87:~#\n\n\nNow I'm also having another problem when I try to create a network for the project I think it is a bug because I don't have this issue with rev1058 but I have it with rev1244, the machine that has rev1244 is eucalyptus and the machine which has the revision1058 is openstack-in-a-box-rev87\n\n", 
            "date_created": "2011-07-05 19:51:59.084844+00:00", 
            "author": "https://api.launchpad.net/1.0/~diego-lalo"
        }, 
        {
            "content": "Hmm, I don't get it... <type>hvm</type> has been there forever and the libvirt version looks the same...\n\nCould you try \"virsh create libvirt.xml\" with both versions of the XML file (<type arch=\"i686\">hvm</type> and <type>hvm</type>) on both machines ?\n\nAlso provide the exact version of the libvirt package (dpkg -l python-libvirt) for each.", 
            "date_created": "2011-07-07 12:44:07.343833+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": " Hi Thierry sorry for the delay, I was working on other stuffs, here is the info:\n\nMACHINE 1 => eucalyptus\nroot@eucalyptus:/var/lib/nova/instances/instance-00000001# dpkg -l | grep nova\nii  nova-api                         2011.3~d3~20110630.1236-0ubuntu0ppa1~maverick1              OpenStack Compute - API frontend\nii  nova-common                      2011.3~d3~20110630.1236-0ubuntu0ppa1~maverick1              OpenStack Compute - common files\nii  nova-compute                     2011.3~d3~20110630.1236-0ubuntu0ppa1~maverick1              OpenStack Compute - compute node\nii  nova-network                     2011.3~d3~20110630.1236-0ubuntu0ppa1~maverick1              OpenStack Compute - Network manager\nii  nova-objectstore                 2011.3~d3~20110630.1236-0ubuntu0ppa1~maverick1              OpenStack Compute - object store\nii  nova-scheduler                   2011.3~d3~20110630.1236-0ubuntu0ppa1~maverick1              OpenStack Compute - virtual machine scheduler\nii  python-nova                      2011.3~d3~20110630.1236-0ubuntu0ppa1~maverick1              OpenStack Compute Python libraries\nii  python-novaclient                2.4.2~bzr25-0ubuntu0ppa1~maverick3                          client library for OpenStack Compute API\n\nMACHINE 2 =>openstack-in-a-box-1rev87\nroot@openstack-in-a-box-1rev87:/var/lib/nova/instances/instance-00000001# dpkg -l | grep nova\nii  nova-api                         2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - API frontend\nii  nova-common                      2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - common files\nii  nova-compute                     2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - compute node\nii  nova-doc                         2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - documetation\nii  nova-network                     2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - Network manager\nii  nova-objectstore                 2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - object store\nii  nova-scheduler                   2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute - virtual machine scheduler\nii  python-nova                      2011.3~bzr1058-0ubuntu0ppa1~maverick1                       OpenStack Compute Python libraries\nii  python-novaclient                2.4-0ubuntu1~ppa1                                           client library for OpenStack Compute API\n\nPYHTON-LIBVIRT ON BOTH MACHINES\n\nMACHINE1)\nroot@eucalyptus:~# dpkg -l python-libvirt\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                         Version                                      Description\n+++-============================================-============================================-========================================================================================================\nii  python-libvirt                               0.8.8-1ubuntu3~ppamaverick1                  libvirt Python bindings\n\n\nMACHINE2)\nroot@openstack-in-a-box-1rev87:~# dpkg -l python-libvirt\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                         Version                                      Description\n+++-============================================-============================================-========================================================================================================\nii  python-libvirt                               0.8.8-1ubuntu3~ppamaverick1                  libvirt Python bindings\n\n\n\nKVM PACKAGES ON BOTH MACHINES\n\nMACHINE 1)\nroot@eucalyptus:/var/lib/nova/instances/instance-00000001# dpkg -l | grep kvm\nii  kvm                              1:84+dfsg-0ubuntu16+0.14.0~rc1+noroms+0ubuntu4~ppamaverick1 dummy transitional pacakge from kvm to qemu-kvm\nii  qemu-kvm                         0.14.0~rc1+noroms-0ubuntu4~ppamaverick1                     Full virtualization on i386 and amd64 hardware\n\nMACHINE 2)\nroot@openstack-in-a-box-1rev87:~# dpkg -l | grep kvm\nii  kvm                              1:84+dfsg-0ubuntu16+0.14.0~rc1+noroms+0ubuntu4~ppamaverick1 dummy transitional pacakge from kvm to qemu-kvm\nii  qemu-kvm                         0.14.0~rc1+noroms-0ubuntu4~ppamaverick1                     Full virtualization on i386 and amd64 hardware\n\n\nHere is the output of virsh create with the XML file which doesn't contain arch='i686' on MACHINE 1:\n\nroot@eucalyptus:/var/lib/nova/instances/instance-00000001# virsh create libvirt.xml \nerror: Failed to create domain from libvirt.xml\nerror: internal error no supported architecture for os type 'hvm'\n\nHere is the output of virsh create libvirt.xml but in this case I added arch='i686' (MACHINE 1):\n\nroot@eucalyptus:/var/lib/nova/instances/instance-00000001# virsh create libvirt.xml \nDomain instance-00000001 created from libvirt.xml\n\n\nHere is the output of virsh create with the XML file which doesn't contain arch='i686' on MACHINE 2:\nroot@openstack-in-a-box-1rev87:/var/lib/nova/instances/instance-00000001# virsh create libvirt.xml \nDomain instance-00000011 created from libvirt.xml\n\nHere is the output of virsh create libvirt.xml but in this case I added arch='i686' (MACHINE 2):\nroot@openstack-in-a-box-1rev87:/var/lib/nova/instances/instance-00000001# virsh create libvirt.xml \nDomain instance-00000012 created from libvirt.xml\n\nNOTE: I changed the domain ID on machine 2 when I modified libvirt.xml file because the first instance was created using euca2ools, the second instance was created manually with virsh (without i686) and the third one was also created with virsh but with i686 attribute.\n\n\n\nADDITIONAL INFO ABOUT THE KERNEL:\n\nMACHINE 1\nroot@eucalyptus:/var/lib/nova/instances/instance-00000001# uname -ra\nLinux eucalyptus 2.6.35-30-generic #54-Ubuntu SMP Tue Jun 7 18:41:54 UTC 2011 x86_64 GNU/Linux\n\nMACHINE 2\nroot@openstack-in-a-box-1rev87:~# uname -ra\nLinux openstack-in-a-box-1rev87 2.6.35-25-generic #44-Ubuntu SMP Fri Jan 21 17:40:44 UTC 2011 x86_64 GNU/Linux\n\n\nI also posted another bug two days ago (#806176) that appears on machine 2 if I update the nova packages to the latest trunk version (2011.3~d3~20110707.1247). If you need more information send an email to me :)\n\n\nCheers\nDiego\n", 
            "date_created": "2011-07-07 18:43:24.018679+00:00", 
            "author": "https://api.launchpad.net/1.0/~diego-lalo"
        }, 
        {
            "content": "Might be that \"openstack-in-a-box-1rev87\" is a 32-bit machine, and for some reason \"hvm\" assumes 64-bit. Could you run \"virsh capabilities\" on both ?", 
            "date_created": "2011-07-08 09:27:10.268978+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "root@eucalyptus:~# virsh capabilities\n<capabilities>\n\n  <host>\n    <uuid>c0c3001e-8c00-01db-14ac-00248c88a29d</uuid>\n    <cpu>\n      <arch>x86_64</arch>\n      <model>Opteron_G2</model>\n      <vendor>AMD</vendor>\n      <topology sockets='1' cores='2' threads='1'/>\n      <feature name='3dnowprefetch'/>\n      <feature name='cr8legacy'/>\n      <feature name='extapic'/>\n      <feature name='cmp_legacy'/>\n      <feature name='3dnow'/>\n      <feature name='3dnowext'/>\n      <feature name='fxsr_opt'/>\n      <feature name='mmxext'/>\n      <feature name='ht'/>\n      <feature name='vme'/>\n    </cpu>\n    <migration_features>\n      <live/>\n      <uri_transports>\n        <uri_transport>tcp</uri_transport>\n      </uri_transports>\n    </migration_features>\n    <secmodel>\n      <model>apparmor</model>\n      <doi>0</doi>\n    </secmodel>\n  </host>\n\n  <guest>\n    <os_type>hvm</os_type>\n    <arch name='i686'>\n      <wordsize>32</wordsize>\n      <emulator>/usr/bin/qemu</emulator>\n      <machine>pc-0.14</machine>\n      <machine canonical='pc-0.14'>pc</machine>\n      <machine>pc-0.13</machine>\n      <machine>pc-0.12</machine>\n      <machine>pc-0.11</machine>\n      <machine>pc-0.10</machine>\n      <machine>isapc</machine>\n      <domain type='qemu'>\n      </domain>\n    </arch>\n    <features>\n      <cpuselection/>\n      <deviceboot/>\n      <pae/>\n      <nonpae/>\n      <acpi default='on' toggle='yes'/>\n      <apic default='on' toggle='no'/>\n    </features>\n  </guest>\n\n  <guest>\n    <os_type>hvm</os_type>\n    <arch name='x86_64'>\n      <wordsize>64</wordsize>\n      <emulator>/usr/bin/qemu-system-x86_64</emulator>\n      <machine>pc-0.14</machine>\n      <machine canonical='pc-0.14'>pc</machine>\n      <machine>pc-0.13</machine>\n      <machine>pc-0.12</machine>\n      <machine>pc-0.11</machine>\n      <machine>pc-0.10</machine>\n      <machine>isapc</machine>\n      <domain type='qemu'>\n      </domain>\n    </arch>\n    <features>\n      <cpuselection/>\n      <deviceboot/>\n      <acpi default='on' toggle='yes'/>\n      <apic default='on' toggle='no'/>\n    </features>\n  </guest>\n\n</capabilities>\n\nroot@openstack-in-a-box-1rev87:~# virsh capabilities\n<capabilities>\n\n  <host>\n    <uuid>8080001e-8c00-01c3-0f4c-00248c2e5088</uuid>\n    <cpu>\n      <arch>x86_64</arch>\n      <model>Opteron_G3</model>\n      <vendor>AMD</vendor>\n      <topology sockets='1' cores='3' threads='1'/>\n      <feature name='osvw'/>\n      <feature name='3dnowprefetch'/>\n      <feature name='cr8legacy'/>\n      <feature name='extapic'/>\n      <feature name='cmp_legacy'/>\n      <feature name='3dnow'/>\n      <feature name='3dnowext'/>\n      <feature name='pdpe1gb'/>\n      <feature name='fxsr_opt'/>\n      <feature name='mmxext'/>\n      <feature name='ht'/>\n      <feature name='vme'/>\n    </cpu>\n    <migration_features>\n      <live/>\n      <uri_transports>\n        <uri_transport>tcp</uri_transport>\n      </uri_transports>\n    </migration_features>\n    <secmodel>\n      <model>apparmor</model>\n      <doi>0</doi>\n    </secmodel>\n  </host>\n\n  <guest>\n    <os_type>hvm</os_type>\n    <arch name='i686'>\n      <wordsize>32</wordsize>\n      <emulator>/usr/bin/qemu</emulator>\n      <machine>pc-0.14</machine>\n      <machine canonical='pc-0.14'>pc</machine>\n      <machine>pc-0.13</machine>\n      <machine>pc-0.12</machine>\n      <machine>pc-0.11</machine>\n      <machine>pc-0.10</machine>\n      <machine>isapc</machine>\n      <domain type='qemu'>\n      </domain>\n      <domain type='kvm'>\n        <emulator>/usr/bin/kvm</emulator>\n        <machine>pc-0.14</machine>\n        <machine canonical='pc-0.14'>pc</machine>\n        <machine>pc-0.13</machine>\n        <machine>pc-0.12</machine>\n        <machine>pc-0.11</machine>\n        <machine>pc-0.10</machine>\n        <machine>isapc</machine>\n      </domain>\n    </arch>\n    <features>\n      <cpuselection/>\n      <deviceboot/>\n      <pae/>\n      <nonpae/>\n      <acpi default='on' toggle='yes'/>\n      <apic default='on' toggle='no'/>\n    </features>\n  </guest>\n\n  <guest>\n    <os_type>hvm</os_type>\n    <arch name='x86_64'>\n      <wordsize>64</wordsize>\n      <emulator>/usr/bin/qemu-system-x86_64</emulator>\n      <machine>pc-0.14</machine>\n      <machine canonical='pc-0.14'>pc</machine>\n      <machine>pc-0.13</machine>\n      <machine>pc-0.12</machine>\n      <machine>pc-0.11</machine>\n      <machine>pc-0.10</machine>\n      <machine>isapc</machine>\n      <domain type='qemu'>\n      </domain>\n      <domain type='kvm'>\n        <emulator>/usr/bin/kvm</emulator>\n        <machine>pc-0.14</machine>\n        <machine canonical='pc-0.14'>pc</machine>\n        <machine>pc-0.13</machine>\n        <machine>pc-0.12</machine>\n        <machine>pc-0.11</machine>\n        <machine>pc-0.10</machine>\n        <machine>isapc</machine>\n      </domain>\n    </arch>\n    <features>\n      <cpuselection/>\n      <deviceboot/>\n      <acpi default='on' toggle='yes'/>\n      <apic default='on' toggle='no'/>\n    </features>\n  </guest>\n\n</capabilities>\n\n", 
            "date_created": "2011-07-08 12:52:17.673627+00:00", 
            "author": "https://api.launchpad.net/1.0/~diego-lalo"
        }, 
        {
            "content": "Now I'm very confused :)", 
            "date_created": "2011-07-08 15:37:15.201772+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "...and I can't reproduce that -- do you reproduce on a pristine install ?", 
            "date_created": "2011-08-19 10:00:14.423709+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "We cannot solve the issue you reported without more information. Could you please provide the requested information ?", 
            "date_created": "2011-10-21 13:09:58.570875+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "This bug lacks the necessary information to effectively reproduce and fix it, therefore it has been closed. Feel free to reopen the bug by providing the requested information and set the bug status back to ''New''.", 
            "date_created": "2011-12-02 14:10:50.053991+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ]
}