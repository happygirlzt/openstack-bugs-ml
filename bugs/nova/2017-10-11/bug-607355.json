{
    "status": "Invalid", 
    "last_updated": "2011-01-19 07:33:48.234552+00:00", 
    "description": "I'm struggling to launch an image (on physical hardware, using KVM)\n\nI've tried building my own image, using ubuntu's vmbuilder, and got that to build an image.  However, I can't launch this through nova.\n\nThe compute service logs this error:\n\nDEBUG:root:Starting instance i-lrpnh3ta...\nDEBUG:root:Result was 1\nDEBUG:root:Starting VLAN inteface for 100 network\nDEBUG:root:Result was 1\nDEBUG:root:Result was 1\nDEBUG:root:Result was 255\nDEBUG:root:Finished init of Instance with id of i-lrpnh3ta\nINFO:root:Instances current state is 0\nDEBUG:root:Instance state is: 0\nDEBUG:root:Starting spawn in Instance\nDEBUG:root:Starting the toXML method\nDEBUG:root:Finished the toXML method\nINFO:root:self <nova.compute.node.Instance object at 0x2e56e50>\nINFO:root:Creating image for: i-lrpnh3ta\nWARNING:root:Input partition size not evenly divisible by sector size: 169 / 512\nlibvir: QEMU error : monitor socket did not show up.: Connection refused\nDEBUG:root:monitor socket did not show up.: Connection refused\n\n\nPeeking behind the libvirt obfuscation:\n\nsudo more /var/log/libvirt/qemu/i-lrpnh3ta.log \nLC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/sbin:/sbin:/bin /usr/bin/qemu-system-x86_64 -S -M pc-0.12 -no-kvm -m 1024 -smp 1 -name i-lrpnh3ta -uuid b43ba850-2170-6a96-18ec-0f4f67a472dc -nographic -chardev socket,id=monitor,path=/var/lib/libvirt/qemu/i-lrpnh3ta.monitor,server,nowait -monitor chardev:monitor -boot c -kernel /home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/kernel -initrd /home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/ramdisk -append root=/dev/vda1 console=ttyS0 -drive file=/home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/disk,if=virtio,index=0,boot=on -net nic,macaddr=00:16:3e:76:88:f5,vlan=0,name=nic.0 -net tap,fd=44,vlan=0,name=tap.0 -chardev file,id=serial0,path=/home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/console.log -serial chardev:serial0 -parallel none -usb \nqemu: linux kernel too old to load a ram disk\n\n\n\nI'm using the kernel from /boot/vmlinuz-$(uname -r) on the host (Lucid Lynx); this might not be right.\n\nHowever, taking that KVM command, I can change it so that I can boot the original VM:\n\n* I remove the -S (stop) and monitor stuff so that it won't wait for libvirt, and the -nographic arg so that I can see what's going on.\n\n* If I remove the -kernel, -initrd, and -append arguments I can get KVM to stop complaining about \"kernel too old to load a ram disk\"\n\n* If I leave the disk image as-is, it won't boot - it just hangs at the BIOS \"Booting from Hard Disk\" message  (maybe nova is creating a corrupted disk image, c.f. \"Input partition size not evenly divisible by sector size: 169 / 512\" message?)\n\n* If I swap the disk image to the original disk image created by vmbuilder, it hangs at \"GRUB loading stage2\"\n\n* If I remove -no-kvm, I can use the grub menu, but it then hangs when starting the actual image (at \"Starting up\").  I now get these error messages from KVM:\nTUNGETIFF ioctl() failed: Bad file descriptor\nTUNSETOFFLOAD ioctl() failed: Bad file descriptor\n\n* If I remove the tap device (-net tap,fd=44,vlan=0,name=tap.0), then the machine boots and I can log in.\n\n* (If I put the disk image back to the disk image nova created, it hangs as before on \"Booting from Hard Disk\")\n\n\n\nThere's a whole bunch of questions here:\n\nWhy are we using a kernel and ramdisk anyway - why not just rely on hardware virtualization?  We presumably also wouldn't need to mess with the disk image...\nHow is that -no-kvm argument sneaking in there?  I'm guessing it's something I've misconfigured in the libvirt template?\nWhat is the correct way to build disk images, and where should the ramdisk & kernel come from?  Is there a way to boot a raw image without ramdisk/kernel?", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 22, 
    "link": "https://bugs.launchpad.net/nova/+bug/607355", 
    "owner": "None", 
    "id": 607355, 
    "index": 1895, 
    "created": "2010-07-19 17:35:37.487093+00:00", 
    "title": "Problems launching instances", 
    "comments": [
        {
            "content": "I'm struggling to launch an image (on physical hardware, using KVM)\n\nI've tried building my own image, using ubuntu's vmbuilder, and got that to build an image.  However, I can't launch this through nova.\n\nThe compute service logs this error:\n\nDEBUG:root:Starting instance i-lrpnh3ta...\nDEBUG:root:Result was 1\nDEBUG:root:Starting VLAN inteface for 100 network\nDEBUG:root:Result was 1\nDEBUG:root:Result was 1\nDEBUG:root:Result was 255\nDEBUG:root:Finished init of Instance with id of i-lrpnh3ta\nINFO:root:Instances current state is 0\nDEBUG:root:Instance state is: 0\nDEBUG:root:Starting spawn in Instance\nDEBUG:root:Starting the toXML method\nDEBUG:root:Finished the toXML method\nINFO:root:self <nova.compute.node.Instance object at 0x2e56e50>\nINFO:root:Creating image for: i-lrpnh3ta\nWARNING:root:Input partition size not evenly divisible by sector size: 169 / 512\nlibvir: QEMU error : monitor socket did not show up.: Connection refused\nDEBUG:root:monitor socket did not show up.: Connection refused\n\n\nPeeking behind the libvirt obfuscation:\n\nsudo more /var/log/libvirt/qemu/i-lrpnh3ta.log \nLC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/sbin:/sbin:/bin /usr/bin/qemu-system-x86_64 -S -M pc-0.12 -no-kvm -m 1024 -smp 1 -name i-lrpnh3ta -uuid b43ba850-2170-6a96-18ec-0f4f67a472dc -nographic -chardev socket,id=monitor,path=/var/lib/libvirt/qemu/i-lrpnh3ta.monitor,server,nowait -monitor chardev:monitor -boot c -kernel /home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/kernel -initrd /home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/ramdisk -append root=/dev/vda1 console=ttyS0 -drive file=/home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/disk,if=virtio,index=0,boot=on -net nic,macaddr=00:16:3e:76:88:f5,vlan=0,name=nic.0 -net tap,fd=44,vlan=0,name=tap.0 -chardev file,id=serial0,path=/home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/console.log -serial chardev:serial0 -parallel none -usb \nqemu: linux kernel too old to load a ram disk\n\n\n\nI'm using the kernel from /boot/vmlinuz-$(uname -r) on the host (Lucid Lynx); this might not be right.\n\nHowever, taking that KVM command, I can change it so that I can boot the original VM:\n\n* I remove the -S (stop) and monitor stuff so that it won't wait for libvirt, and the -nographic arg so that I can see what's going on.\n\n* If I remove the -kernel, -initrd, and -append arguments I can get KVM to stop complaining about \"kernel too old to load a ram disk\"\n\n* If I leave the disk image as-is, it won't boot - it just hangs at the BIOS \"Booting from Hard Disk\" message  (maybe nova is creating a corrupted disk image, c.f. \"Input partition size not evenly divisible by sector size: 169 / 512\" message?)\n\n* If I swap the disk image to the original disk image created by vmbuilder, it hangs at \"GRUB loading stage2\"\n\n* If I remove -no-kvm, I can use the grub menu, but it then hangs when starting the actual image (at \"Starting up\").  I now get these error messages from KVM:\nTUNGETIFF ioctl() failed: Bad file descriptor\nTUNSETOFFLOAD ioctl() failed: Bad file descriptor\n\n* If I remove the tap device (-net tap,fd=44,vlan=0,name=tap.0), then the machine boots and I can log in.\n\n* (If I put the disk image back to the disk image nova created, it hangs as before on \"Booting from Hard Disk\")\n\n\n\nThere's a whole bunch of questions here:\n\nWhy are we using a kernel and ramdisk anyway - why not just rely on hardware virtualization?  We presumably also wouldn't need to mess with the disk image...\nHow is that -no-kvm argument sneaking in there?  I'm guessing it's something I've misconfigured in the libvirt template?\nWhat is the correct way to build disk images, and where should the ramdisk & kernel come from?  Is there a way to boot a raw image without ramdisk/kernel?", 
            "date_created": "2010-07-19 17:35:37.487093+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "Just to clarify, those steps to get the machine to boot the original image are cumulative... so the final working command was this:\n\nLC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/sbin:/sbin:/bin /usr/bin/qemu-system-x86_64 -M pc-0.12 -m 1024 -smp 1 -name i-lrpnh3ta -uuid b43ba850-2170-6a96-18ec-0f4f67a472dc -boot c -drive file=/home/justinsb/openstack/images/kvm/ubuntu-kvm/tmpK440Qi.qcow2,if=virtio,index=0,boot=on -net nic,macaddr=00:16:3e:76:88:f5,vlan=0,name=nic.0 -chardev file,id=serial0,path=/home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/console.log -serial chardev:serial0 -parallel none -usb \n\nAnd then if I swap that image back to the nova one it still fails to boot as it did before the other modifications.\n", 
            "date_created": "2010-07-19 17:46:37.966677+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "On Mon, Jul 19, 2010 at 05:35:37PM -0000, justinsb wrote:\n> qemu: linux kernel too old to load a ram disk\n\nThis usually means that one or both of kernel and ramdisk has been\ntransferred incorrectly. You can go and see in\n/var/lib/instances/<instance-id>/ and inspect the kernel and ramdisk\n\n> * If I remove the -kernel, -initrd, and -append arguments I can get\n> KVM to stop complaining about \"kernel too old to load a ram disk\"\n> \n> * If I leave the disk image as-is, it won't boot - it just hangs at the\n> BIOS \"Booting from Hard Disk\" message  (maybe nova is creating a\n> corrupted disk image, c.f. \"Input partition size not evenly divisible by\n> sector size: 169 / 512\" message?)\n\nMake sure you've got parted installed. Nova does not currently check\nproperly if parted is installed, and does not handle the error if it\nisn't.\n\n> * If I swap the disk image to the original disk image created by\n> vmbuilder, it hangs at \"GRUB loading stage2\"\n\n> There's a whole bunch of questions here:\n> \n> Why are we using a kernel and ramdisk anyway - why not just rely on hardware virtualization?\n\nHeritage from EC2/Eucalyptus. You provide a filesystem image, a kernel\nand a ramdisk, and it gets stitched together to make up a virtual\nmachine.\n\n> We presumably also wouldn't need to mess with the disk image...\n\nAgain, heritage from EC2/Eucalyptus. The idea was to look as much like\nEC2 as possible. On EC2, the filesystem you provide is reachable on\n/dev/sda2, and to make that happen with KVM, you need to fiddle with\ndisk images.\n\nThis definitely needs to be revisisted. \n\n> How is that -no-kvm argument sneaking in there?\n\nCan you attach the libvirt.xml from /var/lib/instances/<instance id>/ ?\n\n> I'm guessing it's something I've misconfigured in the libvirt\n> template?\n\nThat's my hypothesis, too. Did you run the sed command from the\nNovaInstallFestInstructions page per chance?\n\n> What is the correct way to build disk images, and where should the\n> ramdisk & kernel come from?\n\nThat's a good question. I\u0344'll post info on how I built the one I used\ntomorrow.\n\n> Is there a way to boot a raw image without ramdisk/kernel?\n\nNot at the moment. Patches to fix this are very welcome. You seem to\nhave identified that things that need to change. If not, don't hesitate\nto ask.\n\n-- \nSoren Hansen\nUbuntu Developer\nhttp://www.ubuntu.com/\n", 
            "date_created": "2010-07-20 02:47:25+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "I'm also working on what's been loosely called \"bootable volume\" support,\nwhich involves treating all disk images the same way - as network-attached\nstorage, exported from one of the volume nodes. This solves several things\nat once: VM migration, Xen support, snapshotting, etc.\n\nWe'll need to finalize the 'best' way to manage kernel, ramdisk, etc. NASA\nhas a requirement to keep these separate from the disk images, so it's not\nJUST legacy. But it doesn't mean it should be the only way nova works.\n\nJoshua\n\nOn Mon, Jul 19, 2010 at 7:47 PM, Soren Hansen <email address hidden> wrote:\n\n> On Mon, Jul 19, 2010 at 05:35:37PM -0000, justinsb wrote:\n> > qemu: linux kernel too old to load a ram disk\n>\n> This usually means that one or both of kernel and ramdisk has been\n> transferred incorrectly. You can go and see in\n> /var/lib/instances/<instance-id>/ and inspect the kernel and ramdisk\n>\n> > * If I remove the -kernel, -initrd, and -append arguments I can get\n> > KVM to stop complaining about \"kernel too old to load a ram disk\"\n> >\n> > * If I leave the disk image as-is, it won't boot - it just hangs at the\n> > BIOS \"Booting from Hard Disk\" message  (maybe nova is creating a\n> > corrupted disk image, c.f. \"Input partition size not evenly divisible by\n> > sector size: 169 / 512\" message?)\n>\n> Make sure you've got parted installed. Nova does not currently check\n> properly if parted is installed, and does not handle the error if it\n> isn't.\n>\n> > * If I swap the disk image to the original disk image created by\n> > vmbuilder, it hangs at \"GRUB loading stage2\"\n>\n> > There's a whole bunch of questions here:\n> >\n> > Why are we using a kernel and ramdisk anyway - why not just rely on\n> hardware virtualization?\n>\n> Heritage from EC2/Eucalyptus. You provide a filesystem image, a kernel\n> and a ramdisk, and it gets stitched together to make up a virtual\n> machine.\n>\n> > We presumably also wouldn't need to mess with the disk image...\n>\n> Again, heritage from EC2/Eucalyptus. The idea was to look as much like\n> EC2 as possible. On EC2, the filesystem you provide is reachable on\n> /dev/sda2, and to make that happen with KVM, you need to fiddle with\n> disk images.\n>\n> This definitely needs to be revisisted.\n>\n> > How is that -no-kvm argument sneaking in there?\n>\n> Can you attach the libvirt.xml from /var/lib/instances/<instance id>/ ?\n>\n> > I'm guessing it's something I've misconfigured in the libvirt\n> > template?\n>\n> That's my hypothesis, too. Did you run the sed command from the\n> NovaInstallFestInstructions page per chance?\n>\n> > What is the correct way to build disk images, and where should the\n> > ramdisk & kernel come from?\n>\n> That's a good question. \u1e2e'll post info on how I built the one I used\n> tomorrow.\n>\n> > Is there a way to boot a raw image without ramdisk/kernel?\n>\n> Not at the moment. Patches to fix this are very welcome. You seem to\n> have identified that things that need to change. If not, don't hesitate\n> to ask.\n>\n> --\n> Soren Hansen\n> Ubuntu Developer\n> http://www.ubuntu.com/\n>\n> --\n> Problems launching instances\n> https://bugs.launchpad.net/bugs/607355\n> You received this bug notification because you are a member of Nova\n> Bugs, which is subscribed to OpenStack Compute (nova).\n>\n> Status in OpenStack Compute (Nova): New\n>\n> Bug description:\n> I'm struggling to launch an image (on physical hardware, using KVM)\n>\n> I've tried building my own image, using ubuntu's vmbuilder, and got that to\n> build an image.  However, I can't launch this through nova.\n>\n> The compute service logs this error:\n>\n> DEBUG:root:Starting instance i-lrpnh3ta...\n> DEBUG:root:Result was 1\n> DEBUG:root:Starting VLAN inteface for 100 network\n> DEBUG:root:Result was 1\n> DEBUG:root:Result was 1\n> DEBUG:root:Result was 255\n> DEBUG:root:Finished init of Instance with id of i-lrpnh3ta\n> INFO:root:Instances current state is 0\n> DEBUG:root:Instance state is: 0\n> DEBUG:root:Starting spawn in Instance\n> DEBUG:root:Starting the toXML method\n> DEBUG:root:Finished the toXML method\n> INFO:root:self <nova.compute.node.Instance object at 0x2e56e50>\n> INFO:root:Creating image for: i-lrpnh3ta\n> WARNING:root:Input partition size not evenly divisible by sector size: 169\n> / 512\n> libvir: QEMU error : monitor socket did not show up.: Connection refused\n> DEBUG:root:monitor socket did not show up.: Connection refused\n>\n>\n> Peeking behind the libvirt obfuscation:\n>\n> sudo more /var/log/libvirt/qemu/i-lrpnh3ta.log\n> LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/sbin:/sbin:/bin\n> /usr/bin/qemu-system-x86_64 -S -M pc-0.12 -no-kvm -m 1024 -smp 1 -name\n> i-lrpnh3ta -uuid b43ba850-2170-6a96-18ec-0f4f67a472dc -nographic -chardev\n> socket,id=monitor,path=/var/lib/libvirt/qemu/i-lrpnh3ta.monitor,server,nowait\n> -monitor chardev:monitor -boot c -kernel\n> /home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/kernel\n> -initrd\n> /home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/ramdisk\n> -append root=/dev/vda1 console=ttyS0 -drive\n> file=/home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/disk,if=virtio,index=0,boot=on\n> -net nic,macaddr=00:16:3e:76:88:f5,vlan=0,name=nic.0 -net\n> tap,fd=44,vlan=0,name=tap.0 -chardev\n> file,id=serial0,path=/home/justinsb/openstack/iscsi-volumes/data/instances/i-lrpnh3ta/console.log\n> -serial chardev:serial0 -parallel none -usb\n> qemu: linux kernel too old to load a ram disk\n>\n>\n>\n> I'm using the kernel from /boot/vmlinuz-$(uname -r) on the host (Lucid\n> Lynx); this might not be right.\n>\n> However, taking that KVM command, I can change it so that I can boot the\n> original VM:\n>\n> * I remove the -S (stop) and monitor stuff so that it won't wait for\n> libvirt, and the -nographic arg so that I can see what's going on.\n>\n> * If I remove the -kernel, -initrd, and -append arguments I can get KVM to\n> stop complaining about \"kernel too old to load a ram disk\"\n>\n> * If I leave the disk image as-is, it won't boot - it just hangs at the\n> BIOS \"Booting from Hard Disk\" message  (maybe nova is creating a corrupted\n> disk image, c.f. \"Input partition size not evenly divisible by sector size:\n> 169 / 512\" message?)\n>\n> * If I swap the disk image to the original disk image created by vmbuilder,\n> it hangs at \"GRUB loading stage2\"\n>\n> * If I remove -no-kvm, I can use the grub menu, but it then hangs when\n> starting the actual image (at \"Starting up\").  I now get these error\n> messages from KVM:\n> TUNGETIFF ioctl() failed: Bad file descriptor\n> TUNSETOFFLOAD ioctl() failed: Bad file descriptor\n>\n> * If I remove the tap device (-net tap,fd=44,vlan=0,name=tap.0), then the\n> machine boots and I can log in.\n>\n> * (If I put the disk image back to the disk image nova created, it hangs as\n> before on \"Booting from Hard Disk\")\n>\n>\n>\n> There's a whole bunch of questions here:\n>\n> Why are we using a kernel and ramdisk anyway - why not just rely on\n> hardware virtualization?  We presumably also wouldn't need to mess with the\n> disk image...\n> How is that -no-kvm argument sneaking in there?  I'm guessing it's\n> something I've misconfigured in the libvirt template?\n> What is the correct way to build disk images, and where should the ramdisk\n> & kernel come from?  Is there a way to boot a raw image without\n> ramdisk/kernel?\n>\n>\n>\n", 
            "date_created": "2010-07-20 03:31:55+00:00", 
            "author": "https://api.launchpad.net/1.0/~joshua-mckenty"
        }, 
        {
            "content": "Justin, I'm having trouble triaging this bug. Do you think you could go through the issues you highlight here, file bugs for the ones that still apply and close this bug once you're done? That way we can track the individual issues separately which makes working on them easier and it makes it more clear when the bug is fixed.", 
            "date_created": "2010-09-08 06:34:33.758469+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "Works for me, closing as Invalid, please reopen if you still experience issues and can provide the requested info.", 
            "date_created": "2011-01-18 16:30:07.933968+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ]
}