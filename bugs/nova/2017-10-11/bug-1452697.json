{
    "status": "Invalid", 
    "last_updated": "2015-06-12 15:22:53.511550+00:00", 
    "description": "     When I created an instance,it failed and VM-state is ERROR.I query the table which named nova.instances ,host is NULL,it results to that I can't be able to delete this instance .\nthe log is :\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack Traceback (most recent call last):\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 119, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return req.get_response(self.application)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     application, catch_exc_info=False)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 690, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return self.app(env, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     content_type, body, accept)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 997, in _process_stack\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1078, in dispatch\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return method(req=request, **action_args)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/servers.py\", line 989, in _delete\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     self.compute_api.delete(context, instance)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 202, in wrapped\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 192, in inner\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return function(self, context, instance, *args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 219, in _wrapped\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return fn(self, context, instance, *args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 173, in inner\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return f(self, context, instance, *args, **kw)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1586, in delete\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     self._delete_instance(context, instance)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1576, in _delete_instance\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     task_state=task_states.DELETING)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1410, in _delete\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     user_id=user_id)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1357, in _delete\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     instance.destroy()\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/objects/base.py\", line 147, in wrapper\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return fn(self, ctxt, *args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 351, in destroy\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     db.instance_destroy(context, self.uuid, constraint=constraint)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 593, in instance_destroy\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     rv = IMPL.instance_destroy(context, instance_uuid, constraint)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 126, in wrapper\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return f(*args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1661, in instance_destroy\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     query = constraint.apply(models.Instance, query)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 338, in apply\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     for clause in condition.clauses(getattr(model, key)):\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 349, in clauses\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return or_([field == value for value in self.values])\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"<string>\", line 2, in or_\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 1870, in or_\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return cls._construct(operators.or_, False_, True_, *clauses)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 1774, in _construct\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     clause = _literal_as_text(clause)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 3462, in _literal_as_text\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     \"SQL expression object or string expected.\"\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack ArgumentError: SQL expression object or string expected.\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack\n\nmy version is havana and icehouse,I test both,all ERROR.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1452697", 
    "owner": "None", 
    "id": 1452697, 
    "index": 5527, 
    "created": "2015-05-07 11:47:16.193539+00:00", 
    "title": "Error Instance can't be deleted when its host is NULL", 
    "comments": [
        {
            "content": "     When I created an instance,it failed and VM-state is ERROR.I query the table which named nova.instances ,host is NULL,it results to that I can't be able to delete this instance .\nthe log is :\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack Traceback (most recent call last):\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 119, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return req.get_response(self.application)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     application, catch_exc_info=False)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 690, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return self.app(env, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     content_type, body, accept)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 997, in _process_stack\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1078, in dispatch\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return method(req=request, **action_args)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/servers.py\", line 989, in _delete\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     self.compute_api.delete(context, instance)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 202, in wrapped\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 192, in inner\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return function(self, context, instance, *args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 219, in _wrapped\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return fn(self, context, instance, *args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 173, in inner\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return f(self, context, instance, *args, **kw)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1586, in delete\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     self._delete_instance(context, instance)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1576, in _delete_instance\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     task_state=task_states.DELETING)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1410, in _delete\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     user_id=user_id)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1357, in _delete\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     instance.destroy()\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/objects/base.py\", line 147, in wrapper\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return fn(self, ctxt, *args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 351, in destroy\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     db.instance_destroy(context, self.uuid, constraint=constraint)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 593, in instance_destroy\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     rv = IMPL.instance_destroy(context, instance_uuid, constraint)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 126, in wrapper\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return f(*args, **kwargs)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1661, in instance_destroy\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     query = constraint.apply(models.Instance, query)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 338, in apply\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     for clause in condition.clauses(getattr(model, key)):\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 349, in clauses\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return or_([field == value for value in self.values])\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"<string>\", line 2, in or_\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 1870, in or_\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return cls._construct(operators.or_, False_, True_, *clauses)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 1774, in _construct\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     clause = _literal_as_text(clause)\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 3462, in _literal_as_text\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     \"SQL expression object or string expected.\"\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack ArgumentError: SQL expression object or string expected.\n2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack\n\nmy version is havana and icehouse,I test both,all ERROR.", 
            "date_created": "2015-05-07 11:47:16.193539+00:00", 
            "author": "https://api.launchpad.net/1.0/~yjx1991"
        }, 
        {
            "content": "Try to use \"nova reset-state <uuid>\" for your VM and try again. I don't see what kind of bug is related to Nova.", 
            "date_created": "2015-05-07 19:33:15.343172+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "Thanks for your attention\uff0cyou can follow these steps to recur\uff1a\r\n1.create a new instance\r\n2.to make nova.instances.host NULL (this step to simulate it has no host after the failure of scheduling)\r\n3.to delete this instance \r\nthe result is that you can't delete successfully.\r\nin version 2013.2.b1 (https://github.com/openstack/nova/blob/2013.2.b1/nova/compute/api.py)\r\n\r\nfrom line 1110\r\n-----------------------------------------------------------\r\nif not host:\r\n                # Just update database, nothing else we can do\r\n                constraint = self.db.constraint(host=self.db.equal_any(host))\r\n                try:\r\n                    self.db.instance_destroy(context, instance['uuid'],\r\n                                             constraint)\r\n                    if reservations:\r\n                        QUOTAS.commit(context,\r\n                                      reservations,\r\n                                      project_id=project_id)\r\n                    return\r\n                except exception.ConstraintNotMet:\r\n                    # Refresh to get new host information\r\n                    instance = self.get(context, instance['uuid'])\r\n-----------------------------------------------------------\r\n\r\nI think it trys to solve this issue,but the before versions or the future versions, change it back again.I don't know why?\r\n\r\nother versions like this:\r\n-----------------------------------------------------------\r\nif not host:\r\n                try:\r\n                    compute_utils.notify_about_instance_usage(\r\n                            self.notifier, context, instance,\r\n                            \"%s.start\" % delete_type)\r\n                    instance.destroy()\r\n                    compute_utils.notify_about_instance_usage(\r\n                            self.notifier, context, instance,\r\n                            \"%s.end\" % delete_type,\r\n                            system_metadata=instance.system_metadata)\r\n                    if reservations:\r\n                        QUOTAS.commit(context,\r\n                                      reservations,\r\n                                      project_id=project_id,\r\n                                      user_id=user_id)\r\n                    return\r\n                except exception.ObjectActionError:\r\n                    instance.refresh()\r\n\r\n-----------------------------------------------------------\r\n\r\n> -----\u539f\u59cb\u90ae\u4ef6-----\r\n> \u53d1\u4ef6\u4eba: \"Sylvain Bauza\" <email address hidden>\r\n> \u53d1\u9001\u65f6\u95f4: 2015-05-08 03:33:15 (\u661f\u671f\u4e94)\r\n> \u6536\u4ef6\u4eba: <email address hidden>\r\n> \u6284\u9001: \r\n> \u4e3b\u9898: [Bug 1452697] Re: Error Instance can't be deleted when its host is NULL\r\n> \r\n> Try to use \"nova reset-state <uuid>\" for your VM and try again. I don't\r\n> see what kind of bug is related to Nova.\r\n> \r\n> ** Changed in: nova\r\n>        Status: New => Incomplete\r\n> \r\n> -- \r\n> You received this bug notification because you are subscribed to the bug\r\n> report.\r\n> https://bugs.launchpad.net/bugs/1452697\r\n> \r\n> Title:\r\n>   Error Instance can't be deleted when its host is NULL\r\n> \r\n> Status in OpenStack Compute (Nova):\r\n>   Incomplete\r\n> \r\n> Bug description:\r\n>        When I created an instance,it failed and VM-state is ERROR.I query the table which named nova.instances ,host is NULL,it results to that I can't be able to delete this instance .\r\n>   the log is :\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack Traceback (most recent call last):\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 119, in __call__\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return req.get_response(self.application)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     application, catch_exc_info=False)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystoneclient/middleware/auth_token.py\", line 690, in __call__\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return self.app(env, start_response)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     response = self.app(environ, start_response)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return resp(environ, start_response)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     content_type, body, accept)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 997, in _process_stack\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1078, in dispatch\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return method(req=request, **action_args)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/servers.py\", line 989, in _delete\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     self.compute_api.delete(context, instance)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 202, in wrapped\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 192, in inner\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return function(self, context, instance, *args, **kwargs)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 219, in _wrapped\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return fn(self, context, instance, *args, **kwargs)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 173, in inner\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return f(self, context, instance, *args, **kw)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1586, in delete\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     self._delete_instance(context, instance)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1576, in _delete_instance\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     task_state=task_states.DELETING)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1410, in _delete\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     user_id=user_id)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1357, in _delete\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     instance.destroy()\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/objects/base.py\", line 147, in wrapper\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return fn(self, ctxt, *args, **kwargs)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/objects/instance.py\", line 351, in destroy\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     db.instance_destroy(context, self.uuid, constraint=constraint)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 593, in instance_destroy\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     rv = IMPL.instance_destroy(context, instance_uuid, constraint)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 126, in wrapper\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return f(*args, **kwargs)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1661, in instance_destroy\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     query = constraint.apply(models.Instance, query)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 338, in apply\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     for clause in condition.clauses(getattr(model, key)):\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 349, in clauses\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return or_([field == value for value in self.values])\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"<string>\", line 2, in or_\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 1870, in or_\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     return cls._construct(operators.or_, False_, True_, *clauses)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 1774, in _construct\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     clause = _literal_as_text(clause)\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 3462, in _literal_as_text\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack     \"SQL expression object or string expected.\"\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack ArgumentError: SQL expression object or string expected.\r\n>   2015-05-07 16:55:38.240 23178 TRACE nova.api.openstack\r\n> \r\n>   my version is havana and icehouse,I test both,all ERROR.\r\n> \r\n> To manage notifications about this bug go to:\r\n> https://bugs.launchpad.net/nova/+bug/1452697/+subscriptions\r\n", 
            "date_created": "2015-05-08 05:41:51+00:00", 
            "author": "https://api.launchpad.net/1.0/~yjx1991"
        }, 
        {
            "content": "@yjx (yjx1991):\n\nThe version \"2013.2.b1\" you've referenced to has reached \n\"End-Of-Life\" [1]. I tried to reproduce the issue as you described with\nthe current master branch [2]:\n* launch an instance (in Horizon)\n* log in to mysql database\n* in the table \"instances\" set the field \"host\" to NULL\n* delete instance (in Horizon)\n\nThe instance was successfully deleted. The db entry of the instance has\nthe \"deleted\" flag:\n\n    mysql> select display_name, hostname, host, deleted from instances;\n    +--------------+----------+------+---------+\n    | display_name | hostname | host | deleted |\n    +--------------+----------+------+---------+\n    | test         | test     | NULL |       1 |\n    +--------------+----------+------+---------+\n\nThe code you referenced to was replaced since stable/icehouse [3].\n\nI set the bug to \"invalid\". If I understood in a wrong way and you \ncould provide more information, please feel free to set the bug to \"new\"\nagain.\n\nReferences:\n[1] https://wiki.openstack.org/wiki/Releases\n[2] nova: c9ad9549 2015-06-12 libvirt: convert imagebackend to suppo...\n[3] https://github.com/openstack/nova/blob/stable/icehouse/nova/compute/api.py#L1484\n    https://github.com/openstack/nova/blob/stable/icehouse/nova/objects/instance.py#L354", 
            "date_created": "2015-06-12 15:22:52.980522+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ]
}