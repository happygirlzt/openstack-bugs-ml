{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:20:17.506034+00:00", 
    "description": "When I attached a gpfs volume to an instance, the volume has been successfully attached to the instance, but  there were some error logs in nova-compute log file as below:\n\n2014-12-22 21:52:10.863 13396 ERROR nova.openstack.common.threadgroup [-] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf blockdev --getsize64 /gpfs/volume-98520c4e-935d-43d8-9c8d-00fcb54bb335\nExit code: 1\nStdout: u''\nStderr: u'BLKGETSIZE64: Inappropriate ioctl for device\\n'\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 125, in wait\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 173, in wait\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 121, in wait\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 293, in switch\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 212, in main\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\", line 490, in run_service\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     service.start()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 181, in start\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1159, in pre_start_hook\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 6037, in update_available_resource\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     nodenames = set(self.driver.get_available_nodes())\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/driver.py\", line 1237, in get_available_nodes\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     stats = self.get_host_stats(refresh=refresh)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 5794, in get_host_stats\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return self.host_state.get_host_stats(refresh=refresh)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 473, in host_state\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self._host_state = HostState(self)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 6360, in __init__\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self.update_status()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 6411, in update_status\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     data['disk_available_least'] = _get_disk_available_least()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 6384, in _get_disk_available_least\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     disk_over_committed = (self.driver.\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 5744, in _get_disk_over_committed_size_total\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self._get_instance_disk_info(dom.name(), xml))\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 5697, in _get_instance_disk_info\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     dk_size = lvm.get_volume_size(path)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/lvm.py\", line 55, in decorated_function\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return function(path)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/lvm.py\", line 186, in get_volume_size\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     run_as_root=True)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/utils.py\", line 53, in execute\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return utils.execute(*args, **kwargs)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 163, in execute\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return processutils.execute(*cmd, **kwargs)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/processutils.py\", line 203, in execute\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     cmd=sanitized_cmd)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup ProcessExecutionError: Unexpected error while running command.\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Command: sudo nova-rootwrap /etc/nova/rootwrap.conf blockdev --getsize64 /gpfs/volume-98520c4e-935d-43d8-9c8d-00fcb54bb335\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Exit code: 1\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Stdout: u''\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Stderr: u'BLKGETSIZE64: Inappropriate ioctl for device\\n'\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup\n\n\nThis error occurred when nova tried to get the gpfs volume size using \"blockdev --getsize64\" command.  \nCinder  configuration \"gpfs_mount_point_base\"  was set to \"/gpfs\"\nThe blockdev filter in /usr/share/nova/rootwrap/compute.filters was set to\n\"blockdev: RegExpFilter, blockdev, root, blockdev, (--getsize64|--flushbufs), (/dev/.*|/gpfs/.*)\"\n\nIt seems we couldn't use \"blockdev --getsize64\" command to calculate the gpfs volume size.  This error wouldn't affect the volume attachment, but it affect the nova-compute service,  nova-compute service couldn't restart successfully with this error.", 
    "tags": [
        "in-stable-juno"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1405044", 
    "owner": "https://api.launchpad.net/1.0/~lqslan", 
    "id": 1405044, 
    "index": 5342, 
    "created": "2014-12-23 02:56:39.174065+00:00", 
    "title": "[GPFS] nova volume-attach a gpfs volume with an error log in nova-compute", 
    "comments": [
        {
            "content": "When I attached a gpfs volume to an instance, the volume has been successfully attached to the instance, but  there were some error logs in nova-compute log file as below:\n\n2014-12-22 21:52:10.863 13396 ERROR nova.openstack.common.threadgroup [-] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf blockdev --getsize64 /gpfs/volume-98520c4e-935d-43d8-9c8d-00fcb54bb335\nExit code: 1\nStdout: u''\nStderr: u'BLKGETSIZE64: Inappropriate ioctl for device\\n'\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 125, in wait\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 173, in wait\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 121, in wait\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 293, in switch\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 212, in main\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\", line 490, in run_service\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     service.start()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 181, in start\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1159, in pre_start_hook\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 6037, in update_available_resource\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     nodenames = set(self.driver.get_available_nodes())\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/driver.py\", line 1237, in get_available_nodes\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     stats = self.get_host_stats(refresh=refresh)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 5794, in get_host_stats\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return self.host_state.get_host_stats(refresh=refresh)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 473, in host_state\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self._host_state = HostState(self)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 6360, in __init__\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self.update_status()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 6411, in update_status\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     data['disk_available_least'] = _get_disk_available_least()\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 6384, in _get_disk_available_least\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     disk_over_committed = (self.driver.\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 5744, in _get_disk_over_committed_size_total\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     self._get_instance_disk_info(dom.name(), xml))\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 5697, in _get_instance_disk_info\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     dk_size = lvm.get_volume_size(path)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/lvm.py\", line 55, in decorated_function\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return function(path)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/lvm.py\", line 186, in get_volume_size\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     run_as_root=True)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/utils.py\", line 53, in execute\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return utils.execute(*args, **kwargs)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 163, in execute\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     return processutils.execute(*cmd, **kwargs)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/processutils.py\", line 203, in execute\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup     cmd=sanitized_cmd)\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup ProcessExecutionError: Unexpected error while running command.\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Command: sudo nova-rootwrap /etc/nova/rootwrap.conf blockdev --getsize64 /gpfs/volume-98520c4e-935d-43d8-9c8d-00fcb54bb335\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Exit code: 1\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Stdout: u''\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup Stderr: u'BLKGETSIZE64: Inappropriate ioctl for device\\n'\n2014-12-22 21:52:10.863 13396 TRACE nova.openstack.common.threadgroup\n\n\nThis error occurred when nova tried to get the gpfs volume size using \"blockdev --getsize64\" command.  \nCinder  configuration \"gpfs_mount_point_base\"  was set to \"/gpfs\"\nThe blockdev filter in /usr/share/nova/rootwrap/compute.filters was set to\n\"blockdev: RegExpFilter, blockdev, root, blockdev, (--getsize64|--flushbufs), (/dev/.*|/gpfs/.*)\"\n\nIt seems we couldn't use \"blockdev --getsize64\" command to calculate the gpfs volume size.  This error wouldn't affect the volume attachment, but it affect the nova-compute service,  nova-compute service couldn't restart successfully with this error.", 
            "date_created": "2014-12-23 02:56:39.174065+00:00", 
            "author": "https://api.launchpad.net/1.0/~lqslan"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/143614", 
            "date_created": "2014-12-23 07:58:59.060984+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/143614\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8c62b79610cb5680a052c7a0c779a3faf4568781\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8c62b79610cb5680a052c7a0c779a3faf4568781\nAuthor: lqslan <email address hidden>\nDate:   Tue Dec 23 15:35:11 2014 +0800\n\n    Add LibvirtGPFSVolumeDriver class\n    \n    Currently, GPFS use LibvirtVolumeDriver to generate the libvirt\n    xml configuration when attaching a gpfs volume. But the driver\n    always set the disk_type to 'block' which should be 'file' for\n    GPFS volume.\n    \n    This patch create a new volume driver class for GPFS, the class\n    can generate the right xml configuration for GPFS volume.\n    \n    Change-Id: Ica1cf3558baeea12b519bda50c61cea446429364\n    Closes-Bug:#1405044\n", 
            "date_created": "2015-01-11 08:37:40.458249+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/147411", 
            "date_created": "2015-01-15 07:49:58.309385+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/147411\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8c07d429a00ee35166820c61a67618430dbb83b8\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit 8c07d429a00ee35166820c61a67618430dbb83b8\nAuthor: lqslan <email address hidden>\nDate:   Tue Dec 23 15:35:11 2014 +0800\n\n    Add LibvirtGPFSVolumeDriver class\n    \n    Currently, GPFS use LibvirtVolumeDriver to generate the libvirt\n    xml configuration when attaching a gpfs volume. But the driver\n    always set the disk_type to 'block' which should be 'file' for\n    GPFS volume.\n    \n    This patch create a new volume driver class for GPFS, the class\n    can generate the right xml configuration for GPFS volume.\n    \n    Change-Id: Ica1cf3558baeea12b519bda50c61cea446429364\n    Closes-Bug:#1405044\n    (cherry picked from commit 8c62b79610cb5680a052c7a0c779a3faf4568781)\n", 
            "date_created": "2015-01-23 11:47:00.830902+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}