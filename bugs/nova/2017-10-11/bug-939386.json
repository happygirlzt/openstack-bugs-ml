{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:55:28.024735+00:00", 
    "description": "The console output does not escape characters in the output correctly, when XML output is selected.\n\nHere's an example error stack trace from Java, the important bit is \"An invalid XML character (Unicode: 0x1b) was found in the element content of the document.]\":\n\n\nError running command: get-consoleoutput adb2a214-8728-45d8-ad4d-4ee28a9124f6\njavax.ws.rs.WebApplicationException: javax.xml.bind.UnmarshalException\n - with linked exception:\n[org.xml.sax.SAXParseException; lineNumber: 335; columnNumber: 36; An invalid XML character (Unicode: 0x1b) was found in the element content of the document.]\n\tat com.sun.jersey.core.provider.jaxb.AbstractRootElementProvider.readFrom(AbstractRootElementProvider.java:113)\n\tat com.sun.jersey.api.client.ClientResponse.getEntity(ClientResponse.java:554)\n\tat com.sun.jersey.api.client.ClientResponse.getEntity(ClientResponse.java:506)\n\tat com.sun.jersey.api.client.WebResource.handle(WebResource.java:674)\n\tat com.sun.jersey.api.client.WebResource.access$200(WebResource.java:74)\n\tat com.sun.jersey.api.client.WebResource$Builder.post(WebResource.java:563)\n\tat org.openstack.client.compute.ServerResource.executeAction(ServerResource.java:361)\n\tat org.openstack.client.compute.ServerResource.getConsoleOutput(ServerResource.java:355)\n\tat org.openstack.client.cli.commands.GetConsoleOutput.runCommand(GetConsoleOutput.java:21)\n\tat com.fathomdb.cli.CliSimpleRepl.executeCommand(CliSimpleRepl.java:152)\n\tat com.fathomdb.cli.CliSimpleRepl.runCommand(CliSimpleRepl.java:90)\n\tat com.fathomdb.cli.CliBase.mainWithReturnCode(CliBase.java:138)\n\tat com.fathomdb.cli.CliBase.nailMain(CliBase.java:61)\n\tat org.openstack.client.cli.OpenstackCli.nailMain(OpenstackCli.java:43)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat com.martiansoftware.nailgun.NGSession.run(NGSession.java:298)\nCaused by: javax.xml.bind.UnmarshalException\n - with linked exception:\n[org.xml.sax.SAXParseException; lineNumber: 335; columnNumber: 36; An invalid XML character (Unicode: 0x1b) was found in the element content of the document.]\n\tat javax.xml.bind.helpers.AbstractUnmarshallerImpl.createUnmarshalException(AbstractUnmarshallerImpl.java:335)\n\tat com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.createUnmarshalException(UnmarshallerImpl.java:523)\n\tat com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal0(UnmarshallerImpl.java:220)\n\tat com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal(UnmarshallerImpl.java:189)\n\tat javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:140)\n\tat javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:123)\n\tat com.sun.jersey.core.impl.provider.entity.XMLRootElementProvider.readFrom(XMLRootElementProvider.java:115)\n\tat com.sun.jersey.core.provider.jaxb.AbstractRootElementProvider.readFrom(AbstractRootElementProvider.java:111)\n\t... 18 more\nCaused by: org.xml.sax.SAXParseException; lineNumber: 335; columnNumber: 36; An invalid XML character (Unicode: 0x1b) was found in the element content of the document.\n\tat com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:198)\n\tat com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)\n\tat com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:441)\n\tat com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:368)\n\tat com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1375)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2854)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:607)\n\tat com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:116)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:488)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:835)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:764)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:123)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1210)\n\tat com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:568)\n\tat com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal0(UnmarshallerImpl.java:216)\n\t... 23 more", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/939386", 
    "owner": "https://api.launchpad.net/1.0/~justin-fathomdb", 
    "id": 939386, 
    "index": 2767, 
    "created": "2012-02-23 10:28:22.631031+00:00", 
    "title": "Console-Output does not escape XML correctly", 
    "comments": [
        {
            "content": "The console output does not escape characters in the output correctly, when XML output is selected.\n\nHere's an example error stack trace from Java, the important bit is \"An invalid XML character (Unicode: 0x1b) was found in the element content of the document.]\":\n\n\nError running command: get-consoleoutput adb2a214-8728-45d8-ad4d-4ee28a9124f6\njavax.ws.rs.WebApplicationException: javax.xml.bind.UnmarshalException\n - with linked exception:\n[org.xml.sax.SAXParseException; lineNumber: 335; columnNumber: 36; An invalid XML character (Unicode: 0x1b) was found in the element content of the document.]\n\tat com.sun.jersey.core.provider.jaxb.AbstractRootElementProvider.readFrom(AbstractRootElementProvider.java:113)\n\tat com.sun.jersey.api.client.ClientResponse.getEntity(ClientResponse.java:554)\n\tat com.sun.jersey.api.client.ClientResponse.getEntity(ClientResponse.java:506)\n\tat com.sun.jersey.api.client.WebResource.handle(WebResource.java:674)\n\tat com.sun.jersey.api.client.WebResource.access$200(WebResource.java:74)\n\tat com.sun.jersey.api.client.WebResource$Builder.post(WebResource.java:563)\n\tat org.openstack.client.compute.ServerResource.executeAction(ServerResource.java:361)\n\tat org.openstack.client.compute.ServerResource.getConsoleOutput(ServerResource.java:355)\n\tat org.openstack.client.cli.commands.GetConsoleOutput.runCommand(GetConsoleOutput.java:21)\n\tat com.fathomdb.cli.CliSimpleRepl.executeCommand(CliSimpleRepl.java:152)\n\tat com.fathomdb.cli.CliSimpleRepl.runCommand(CliSimpleRepl.java:90)\n\tat com.fathomdb.cli.CliBase.mainWithReturnCode(CliBase.java:138)\n\tat com.fathomdb.cli.CliBase.nailMain(CliBase.java:61)\n\tat org.openstack.client.cli.OpenstackCli.nailMain(OpenstackCli.java:43)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat com.martiansoftware.nailgun.NGSession.run(NGSession.java:298)\nCaused by: javax.xml.bind.UnmarshalException\n - with linked exception:\n[org.xml.sax.SAXParseException; lineNumber: 335; columnNumber: 36; An invalid XML character (Unicode: 0x1b) was found in the element content of the document.]\n\tat javax.xml.bind.helpers.AbstractUnmarshallerImpl.createUnmarshalException(AbstractUnmarshallerImpl.java:335)\n\tat com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.createUnmarshalException(UnmarshallerImpl.java:523)\n\tat com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal0(UnmarshallerImpl.java:220)\n\tat com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal(UnmarshallerImpl.java:189)\n\tat javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:140)\n\tat javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:123)\n\tat com.sun.jersey.core.impl.provider.entity.XMLRootElementProvider.readFrom(XMLRootElementProvider.java:115)\n\tat com.sun.jersey.core.provider.jaxb.AbstractRootElementProvider.readFrom(AbstractRootElementProvider.java:111)\n\t... 18 more\nCaused by: org.xml.sax.SAXParseException; lineNumber: 335; columnNumber: 36; An invalid XML character (Unicode: 0x1b) was found in the element content of the document.\n\tat com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:198)\n\tat com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)\n\tat com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:441)\n\tat com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:368)\n\tat com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1375)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2854)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:607)\n\tat com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:116)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:488)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:835)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:764)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:123)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1210)\n\tat com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:568)\n\tat com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal0(UnmarshallerImpl.java:216)\n\t... 23 more", 
            "date_created": "2012-02-23 10:28:22.631031+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/5545", 
            "date_created": "2012-03-19 23:33:31.114713+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Vishy and I discussed this on IRC.\n\nIt's down to a bug in MiniDom, and affects all XML output.\nAny string that outputs characters < 32 should really be escaped.  Minidom doesn't do this: http://bugs.python.org/issue5752\nI don't believe this has any e.g. security consequences other than the fact that we produce invalid XML.  i.e. this isn't as bad as escape in HTML.\nWe probably want to move to lxml anyway.  This may fix the problem for free.\nIt doesn't seem like a good idea to mess with all XML output at this stage.\nConsole output is particularly problematic because ANSI sequences start with 0x1B.\nThe patch therefore masks the problem for console-output (only)\nPersonally, I don't mind if the patch goes in or not; I can easily switch between using JSON and using XML in my binding.\nIn Folsom, we should fix this properly (with lxml or otherwise)\n\n", 
            "date_created": "2012-03-19 23:58:41.970333+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/5545\nCommitted: http://github.com/openstack/nova/commit/13ca1b923e479905f9d1debdea6125be92f44808\nSubmitter: Jenkins\nBranch:    master\n\ncommit 13ca1b923e479905f9d1debdea6125be92f44808\nAuthor: Justin Santa Barbara <email address hidden>\nDate:   Mon Mar 19 16:33:16 2012 -0700\n\n    Strip out characters that should be escaped from console output\n    \n    Minidom has a bug where it doesn't escape characters < 32 correctly.\n    That is http://bugs.python.org/issue5752\n    \n    We probably want to move to lxml anyway.\n    \n    Console-output is particularly likely to have invalid characters,\n    because ANSI output include the ESC character (0x1B).  Strip out\n    invalid characters for this case (although the problem is still\n    present anywhere we write a string in the XML)\n    \n    Bug #939386\n    \n    Change-Id: I4689c0f26fb4887867a8d5b6f5e5fb5e2590be91\n", 
            "date_created": "2012-03-20 03:27:05.814457+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}