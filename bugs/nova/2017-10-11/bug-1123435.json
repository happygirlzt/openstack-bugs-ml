{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:09:23.146748+00:00", 
    "description": "I saw this in the log when booting an instance with --config-drive 1\n\n2013-02-12 14:19:09.590 DEBUG nova.openstack.common.rpc.amqp [req-0ca6842b-6caa-495f-ae3a-b043578f4600 admin demo] MSG_ID is cdf0d97a7a9e4515b70dba9a6ba7685c from (pid=9692) multicall /opt/stack/nova/nova/openstack/common/rpc/amqp.py:365\n2013-02-12 14:19:09.826 ERROR nova.compute [req-0ca6842b-6caa-495f-ae3a-b043578f4600 admin demo] No db access allowed in nova-compute:   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenpool.py\", line 80, in _spawn_n_impl\n    func(*args, **kwargs)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 191, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 256, in decorated_function\n    function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 220, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1093, in run_instance\n    do_run_instance()\n  File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 243, in inner\n    retval = f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1092, in do_run_instance\n    admin_password, is_first_time, node, instance)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 722, in _run_instance\n    injected_files, admin_password)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 996, in _spawn\n    block_device_info)\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1199, in spawn\n    admin_pass=admin_password)\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1527, in _create_image\n    content=files, extra_md=extra_md)\n  File \"/opt/stack/nova/nova/api/metadata/base.py\", line 142, in __init__\n    network_info = network.API().get_instance_nw_info(ctxt, instance)\n  File \"/opt/stack/nova/nova/network/api.py\", line 88, in wrapped\n    return func(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/network/api.py\", line 340, in get_instance_nw_info\n    result, conductor_api)\n  File \"/opt/stack/nova/nova/network/api.py\", line 76, in update_instance_cache_with_nw_info\n    api.db.instance_info_cache_update(context, instance['uuid'], cache)\n  File \"/opt/stack/nova/nova/db/api.py\", line 735, in instance_info_cache_update\n    rv = IMPL.instance_info_cache_update(context, instance_uuid, values)\n  File \"/opt/stack/nova/bin/nova-compute\", line 65, in __call__\n    stacktrace = \"\".join(traceback.format_stack())\n\n2013-02-12 14:19:09.826 ERROR nova.network.api [req-0ca6842b-6caa-495f-ae3a-b043578f4600 admin demo] [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c] Failed storing info cache\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c] Traceback (most recent call last):\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]   File \"/opt/stack/nova/nova/network/api.py\", line 76, in update_instance_cache_with_nw_info\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]     api.db.instance_info_cache_update(context, instance['uuid'], cache)\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]   File \"/opt/stack/nova/nova/db/api.py\", line 735, in instance_info_cache_update\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]     rv = IMPL.instance_info_cache_update(context, instance_uuid, values)\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]   File \"/opt/stack/nova/bin/nova-compute\", line 67, in __call__\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]     raise exception.DBNotAllowed('nova-compute')\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c] DBNotAllowed: nova-compute\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]\n2013-02-12 14:19:09.829 DEBUG nova.virt.configdrive [req-0ca6842b-6caa-495f-ae3a-b043578f4600 admin demo] Added ec2/2009-04-04/meta-data.json to config drive from (pid=9692) add_instance_metadata /opt/stack/nova/nova/virt/configdrive.py:97\n\nThe boot still completed successfully.\n\nI'm running with a couple extra patches:\n237d78d Make the metadata paths use conductor -- https://review.openstack.org/#/c/21573/\nbe7a1c4 Fix nova-compute use of missing DBError -- https://review.openstack.org/#/c/21569/", 
    "tags": [], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1123435", 
    "owner": "https://api.launchpad.net/1.0/~danms", 
    "id": 1123435, 
    "index": 964, 
    "created": "2013-02-12 20:29:54.642291+00:00", 
    "title": "no-db-compute exception with --config-drive 1 add_instance_metadata", 
    "comments": [
        {
            "content": "I saw this in the log when booting an instance with --config-drive 1\n\n2013-02-12 14:19:09.590 DEBUG nova.openstack.common.rpc.amqp [req-0ca6842b-6caa-495f-ae3a-b043578f4600 admin demo] MSG_ID is cdf0d97a7a9e4515b70dba9a6ba7685c from (pid=9692) multicall /opt/stack/nova/nova/openstack/common/rpc/amqp.py:365\n2013-02-12 14:19:09.826 ERROR nova.compute [req-0ca6842b-6caa-495f-ae3a-b043578f4600 admin demo] No db access allowed in nova-compute:   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenpool.py\", line 80, in _spawn_n_impl\n    func(*args, **kwargs)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 191, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 256, in decorated_function\n    function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 220, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1093, in run_instance\n    do_run_instance()\n  File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 243, in inner\n    retval = f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1092, in do_run_instance\n    admin_password, is_first_time, node, instance)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 722, in _run_instance\n    injected_files, admin_password)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 996, in _spawn\n    block_device_info)\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1199, in spawn\n    admin_pass=admin_password)\n  File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1527, in _create_image\n    content=files, extra_md=extra_md)\n  File \"/opt/stack/nova/nova/api/metadata/base.py\", line 142, in __init__\n    network_info = network.API().get_instance_nw_info(ctxt, instance)\n  File \"/opt/stack/nova/nova/network/api.py\", line 88, in wrapped\n    return func(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/network/api.py\", line 340, in get_instance_nw_info\n    result, conductor_api)\n  File \"/opt/stack/nova/nova/network/api.py\", line 76, in update_instance_cache_with_nw_info\n    api.db.instance_info_cache_update(context, instance['uuid'], cache)\n  File \"/opt/stack/nova/nova/db/api.py\", line 735, in instance_info_cache_update\n    rv = IMPL.instance_info_cache_update(context, instance_uuid, values)\n  File \"/opt/stack/nova/bin/nova-compute\", line 65, in __call__\n    stacktrace = \"\".join(traceback.format_stack())\n\n2013-02-12 14:19:09.826 ERROR nova.network.api [req-0ca6842b-6caa-495f-ae3a-b043578f4600 admin demo] [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c] Failed storing info cache\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c] Traceback (most recent call last):\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]   File \"/opt/stack/nova/nova/network/api.py\", line 76, in update_instance_cache_with_nw_info\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]     api.db.instance_info_cache_update(context, instance['uuid'], cache)\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]   File \"/opt/stack/nova/nova/db/api.py\", line 735, in instance_info_cache_update\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]     rv = IMPL.instance_info_cache_update(context, instance_uuid, values)\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]   File \"/opt/stack/nova/bin/nova-compute\", line 67, in __call__\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]     raise exception.DBNotAllowed('nova-compute')\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c] DBNotAllowed: nova-compute\n2013-02-12 14:19:09.826 TRACE nova.network.api [instance: 6e272a44-f1ec-4611-9471-59ea96857d1c]\n2013-02-12 14:19:09.829 DEBUG nova.virt.configdrive [req-0ca6842b-6caa-495f-ae3a-b043578f4600 admin demo] Added ec2/2009-04-04/meta-data.json to config drive from (pid=9692) add_instance_metadata /opt/stack/nova/nova/virt/configdrive.py:97\n\nThe boot still completed successfully.\n\nI'm running with a couple extra patches:\n237d78d Make the metadata paths use conductor -- https://review.openstack.org/#/c/21573/\nbe7a1c4 Fix nova-compute use of missing DBError -- https://review.openstack.org/#/c/21569/", 
            "date_created": "2013-02-12 20:29:54.642291+00:00", 
            "author": "https://api.launchpad.net/1.0/~blk-u"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/21820", 
            "date_created": "2013-02-12 21:02:34.847543+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/21820\nCommitted: http://github.com/openstack/nova/commit/a2e4c2c0a4758e1ecf26ca0e6e37e18c65ad2d61\nSubmitter: Jenkins\nBranch:    master\n\ncommit a2e4c2c0a4758e1ecf26ca0e6e37e18c65ad2d61\nAuthor: Dan Smith <email address hidden>\nDate:   Tue Feb 12 16:00:55 2013 -0500\n\n    Fix passing conductor to get_instance_nw_info()\n    \n    The recent metadata patch missed this one spot, which wasn't caught\n    because the network stubs weren't updated for the signature change.\n    \n    Fixes bug 1123435\n    \n    Change-Id: Iebeb98bba62189476af2c0b85615ea407a8b2ecd\n", 
            "date_created": "2013-02-14 04:15:13.591236+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}