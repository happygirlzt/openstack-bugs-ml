{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:54:18.633908+00:00", 
    "description": "when starting an instance  to a compute node which does not has  the system image file, \nnova first download the file through glance api,and then  try to use qemu-img resize to create a  backing file which used by instances;when creating  this backing file,a create instance request comes ,nova  does not check whether the backing file is ready.\nso  the new instane root image file is not complete, and can not be booted .\nthe following log shows  the situation.\n\n     \n2012-03-13 14:47:28 DEBUG nova.utils [-] Running cmd (subprocess): mkdir -p /var/lib/nova/instances/instance-00000009/ from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:28 INFO nova.virt.libvirt.connection [-] [instance: 4de2f829-c846-4f87-b06a-ed3515f1ef21] Creating image\n2012-03-13 14:47:28 DEBUG nova.utils [-] Attempting to grab semaphore \"e10ff21f-f330-444f-8175-01246feed704\" for method \"call_if_not_exists\"... from (pid=31646) inner /usr/lib/python2.7/dist-packages/nova/utils.py:834\n2012-03-13 14:47:28 DEBUG nova.utils [-] Got semaphore \"e10ff21f-f330-444f-8175-01246feed704\" for method \"call_if_not_exists\"... from (pid=31646) inner /usr/lib/python2.7/dist-packages/nova/utils.py:838\n2012-03-13 14:47:28 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/e10ff21f-f330-444f-8175-01246feed704 /var/lib/nova/instances/instance-00000009/kernel from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:28 DEBUG nova.virt.libvirt.connection [-] block_device_list [] from (pid=31646) _volume_in_mapping /usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py:1235\n2012-03-13 14:47:28 DEBUG nova.utils [-] Attempting to grab semaphore \"2bd6e387adad362fedd4a477fe9d7c6590cddf57\" for method \"call_if_not_exists\"... from (pid=31646) inner /usr/lib/python2.7/dist-packages/nova/utils.py:834\n2012-03-13 14:47:40 DEBUG nova.utils [-] Running cmd (subprocess): env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57.part from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:40 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57 /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57_10 from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:40 DEBUG nova.utils [-] Got semaphore \"2bd6e387adad362fedd4a477fe9d7c6590cddf57\" for method \"call_if_not_exists\"... from (pid=31646) inner /usr/lib/python2.7/dist-packages/nova/utils.py:838\n2012-03-13 14:47:40 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img create -f qcow2 -o cluster_size=2M,backing_file=/var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57_10 /var/lib/nova/instances/instance-00000009/disk from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:42 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img resize /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57_10 10737418240 from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:42 DEBUG nova.utils [-] Running cmd (subprocess): e2fsck -fp /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57_10 from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213", 
    "tags": [], 
    "importance": "High", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/953831", 
    "owner": "https://api.launchpad.net/1.0/~sleepsonthefloor", 
    "id": 953831, 
    "index": 624, 
    "created": "2012-03-13 08:54:51.932270+00:00", 
    "title": "when creating instance root image file,nova does not check backing file is ready.file is ", 
    "comments": [
        {
            "content": "when starting an instance  to a compute node which does not has  the system image file, \nnova first download the file through glance api,and then  try to use qemu-img resize to create a  backing file which used by instances;when creating  this backing file,a create instance request comes ,nova  does not check whether the backing file is ready.\nso  the new instane root image file is not complete, and can not be booted .\nthe following log shows  the situation.\n\n     \n2012-03-13 14:47:28 DEBUG nova.utils [-] Running cmd (subprocess): mkdir -p /var/lib/nova/instances/instance-00000009/ from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:28 INFO nova.virt.libvirt.connection [-] [instance: 4de2f829-c846-4f87-b06a-ed3515f1ef21] Creating image\n2012-03-13 14:47:28 DEBUG nova.utils [-] Attempting to grab semaphore \"e10ff21f-f330-444f-8175-01246feed704\" for method \"call_if_not_exists\"... from (pid=31646) inner /usr/lib/python2.7/dist-packages/nova/utils.py:834\n2012-03-13 14:47:28 DEBUG nova.utils [-] Got semaphore \"e10ff21f-f330-444f-8175-01246feed704\" for method \"call_if_not_exists\"... from (pid=31646) inner /usr/lib/python2.7/dist-packages/nova/utils.py:838\n2012-03-13 14:47:28 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/e10ff21f-f330-444f-8175-01246feed704 /var/lib/nova/instances/instance-00000009/kernel from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:28 DEBUG nova.virt.libvirt.connection [-] block_device_list [] from (pid=31646) _volume_in_mapping /usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py:1235\n2012-03-13 14:47:28 DEBUG nova.utils [-] Attempting to grab semaphore \"2bd6e387adad362fedd4a477fe9d7c6590cddf57\" for method \"call_if_not_exists\"... from (pid=31646) inner /usr/lib/python2.7/dist-packages/nova/utils.py:834\n2012-03-13 14:47:40 DEBUG nova.utils [-] Running cmd (subprocess): env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57.part from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:40 DEBUG nova.utils [-] Running cmd (subprocess): cp /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57 /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57_10 from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:40 DEBUG nova.utils [-] Got semaphore \"2bd6e387adad362fedd4a477fe9d7c6590cddf57\" for method \"call_if_not_exists\"... from (pid=31646) inner /usr/lib/python2.7/dist-packages/nova/utils.py:838\n2012-03-13 14:47:40 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img create -f qcow2 -o cluster_size=2M,backing_file=/var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57_10 /var/lib/nova/instances/instance-00000009/disk from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:42 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img resize /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57_10 10737418240 from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213\n2012-03-13 14:47:42 DEBUG nova.utils [-] Running cmd (subprocess): e2fsck -fp /var/lib/nova/instances/_base/2bd6e387adad362fedd4a477fe9d7c6590cddf57_10 from (pid=31646) execute /usr/lib/python2.7/dist-packages/nova/utils.py:213", 
            "date_created": "2012-03-13 08:54:51.932270+00:00", 
            "author": "https://api.launchpad.net/1.0/~heut2008"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/5296", 
            "date_created": "2012-03-13 21:53:31.431190+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/5296\nCommitted: http://github.com/openstack/nova/commit/aa204ea41b88e6896f5505df2d35cdb275cf6187\nSubmitter: Jenkins\nBranch:    master\n\ncommit aa204ea41b88e6896f5505df2d35cdb275cf6187\nAuthor: Anthony Young <email address hidden>\nDate:   Tue Mar 13 14:44:31 2012 -0700\n\n    Fix backing file cp/resize race condition.\n    \n     * Fixes bug 953831\n    \n    Change-Id: I39950b16c9b76159b16203f7b8b504cae5475516\n", 
            "date_created": "2012-03-13 22:26:31.879770+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}