{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:21:27.038249+00:00", 
    "description": "because method _device_exists in linux_net.py hasn't been wrapped by /usr/bin/nova-rootwrap\nso when we boot nova-all, it throws following exceptions:\n\n2012-05-02 14:41:55 DEBUG nova.utils [req-319dd514-f05b-4b1f-a335-5f2c51e5ccb6 None None] Running cmd (subprocess): ip link show dev gw-7e32a6c6-c9 from (pid=10959) execute /bak/openstack/nova/nova/utils.py:200\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()\n  File \"/usr/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/bak/openstack/nova/nova/service.py\", line 109, in run_server\n    server.start()\n  File \"/bak/openstack/nova/nova/service.py\", line 182, in start\n    self.manager.init_host()\n  File \"/bak/openstack/nova/nova/network/quantum/manager.py\", line 91, in init_host\n    super(QuantumManager, self).init_host()\n  File \"/bak/openstack/nova/nova/network/manager.py\", line 764, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/bak/openstack/nova/nova/network/quantum/manager.py\", line 116, in _setup_network_on_host\n    self.l3driver.initialize_gateway(network)\n  File \"/bak/openstack/nova/nova/network/l3.py\", line 98, in initialize_gateway\n    gateway=(network_ref['gateway'] is not None))\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 899, in plug\n    return _get_interface_driver().plug(network, mac_address, gateway)\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 1143, in plug\n    QuantumLinuxBridgeInterfaceDriver.create_tap_dev(dev, mac_address)\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 1178, in create_tap_dev\n    if not _device_exists(dev):\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 821, in _device_exists\n    check_exit_code=False)\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 815, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/bak/openstack/nova/nova/utils.py\", line 207, in execute\n    shell=shell)\n  File \"/usr/lib/python2.7/site-packages/eventlet/green/subprocess.py\", line 25, in __init__\n    subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n  File \"/usr/lib64/python2.7/subprocess.py\", line 679, in __init__\n    errread, errwrite)\n  File \"/usr/lib64/python2.7/subprocess.py\", line 1228, in _execute_child\n    raise child_exception\nOSError: [Errno 2] No such file or directory", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/993097", 
    "owner": "https://api.launchpad.net/1.0/~zhhuabj", 
    "id": 993097, 
    "index": 2891, 
    "created": "2012-05-02 07:58:52.654783+00:00", 
    "title": "method _device_exists in linux_net.py should also be wrapped by nova-rootwrap", 
    "comments": [
        {
            "content": "because method _device_exists in linux_net.py hasn't been wrapped by /usr/bin/nova-rootwrap\nso when we boot nova-all, it throws following exceptions:\n\n2012-05-02 14:41:55 DEBUG nova.utils [req-319dd514-f05b-4b1f-a335-5f2c51e5ccb6 None None] Running cmd (subprocess): ip link show dev gw-7e32a6c6-c9 from (pid=10959) execute /bak/openstack/nova/nova/utils.py:200\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()\n  File \"/usr/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/bak/openstack/nova/nova/service.py\", line 109, in run_server\n    server.start()\n  File \"/bak/openstack/nova/nova/service.py\", line 182, in start\n    self.manager.init_host()\n  File \"/bak/openstack/nova/nova/network/quantum/manager.py\", line 91, in init_host\n    super(QuantumManager, self).init_host()\n  File \"/bak/openstack/nova/nova/network/manager.py\", line 764, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/bak/openstack/nova/nova/network/quantum/manager.py\", line 116, in _setup_network_on_host\n    self.l3driver.initialize_gateway(network)\n  File \"/bak/openstack/nova/nova/network/l3.py\", line 98, in initialize_gateway\n    gateway=(network_ref['gateway'] is not None))\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 899, in plug\n    return _get_interface_driver().plug(network, mac_address, gateway)\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 1143, in plug\n    QuantumLinuxBridgeInterfaceDriver.create_tap_dev(dev, mac_address)\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 1178, in create_tap_dev\n    if not _device_exists(dev):\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 821, in _device_exists\n    check_exit_code=False)\n  File \"/bak/openstack/nova/nova/network/linux_net.py\", line 815, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/bak/openstack/nova/nova/utils.py\", line 207, in execute\n    shell=shell)\n  File \"/usr/lib/python2.7/site-packages/eventlet/green/subprocess.py\", line 25, in __init__\n    subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n  File \"/usr/lib64/python2.7/subprocess.py\", line 679, in __init__\n    errread, errwrite)\n  File \"/usr/lib64/python2.7/subprocess.py\", line 1228, in _execute_child\n    raise child_exception\nOSError: [Errno 2] No such file or directory", 
            "date_created": "2012-05-02 07:58:52.654783+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhhuabj"
        }, 
        {
            "content": "fixing it should very easy, I think only change following method from \n\ndef _device_exists(device):\n    \"\"\"Check if ethernet device exists.\"\"\"\n    (_out, err) = _execute('ip', 'link', 'show', 'dev', device,\n                           check_exit_code=False)\n    return not err\n\n\nto:\n\ndef _device_exists(device):\n    \"\"\"Check if ethernet device exists.\"\"\"\n    (_out, err) = _execute('ip', 'link', 'show', 'dev', device,\n                           check_exit_code=False, run_as_root=True)\n    return not err", 
            "date_created": "2012-05-02 08:00:08.138997+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhhuabj"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/7016", 
            "date_created": "2012-05-02 10:35:14.140974+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/7016\nCommitted: http://github.com/openstack/nova/commit/c0bbc4be369d0b20cd3c5985eb48b8ec66876804\nSubmitter: Jenkins\nBranch:    master\n\ncommit c0bbc4be369d0b20cd3c5985eb48b8ec66876804\nAuthor: hua zhang <email address hidden>\nDate:   Wed May 2 18:34:01 2012 +0800\n\n    Run ip link show in linux_net._device_exists as root\n    \n    Bug 993097\n    \n    Change-Id: Iaad55f2e878df65e9398f0c28786f0c13fb82a95\n", 
            "date_created": "2012-05-09 16:23:01.710836+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}