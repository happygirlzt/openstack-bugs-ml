{
    "status": "Won't Fix", 
    "last_updated": "2016-08-17 08:29:26.719125+00:00", 
    "description": "nova.conf as generated by oslo.config (for nova f05bbb1279598fa82ff5694e35d9de96315b1916) contains duplicate neutron and xenserver sections\n# PYTHONPATH=. oslo-config-generator --config-file=etc/nova/nova-config-generator.conf ; grep \"^\\[\" etc/nova/nova.conf.sample | sort | uniq -c | grep \" 2 \"\n      2 [neutron]\n      2 [xenserver]\n\nThis appears to be because there groups are being registered with both oslo_config.cfg.OptGroup and str in places\n\ne.g. \nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/api/metadata/handler.py\n    CONF.register_opts(metadata_proxy_opts, 'neutron')\n\nand\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/conf/neutron.py\n    neutron_group = cfg.OptGroup('neutron', title='Neutron Options')\n    conf.register_group(neutron_group)", 
    "tags": [
        "config", 
        "low-hanging-fruit"
    ], 
    "importance": "Medium", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1568820", 
    "owner": "None", 
    "id": 1568820, 
    "index": 4511, 
    "created": "2016-04-11 11:59:29.804142+00:00", 
    "title": "Duplicate sections in generated config", 
    "comments": [
        {
            "content": "nova.conf as generated by oslo.config (for nova f05bbb1279598fa82ff5694e35d9de96315b1916) contains duplicate neutron and xenserver sections\n# PYTHONPATH=. oslo-config-generator --config-file=etc/nova/nova-config-generator.conf ; grep \"^\\[\" etc/nova/nova.conf.sample | sort | uniq -c | grep \" 2 \"\n      2 [neutron]\n      2 [xenserver]\n\nThis appears to be because there groups are being registered with both oslo_config.cfg.OptGroup and str in places\n\ne.g. \nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/api/metadata/handler.py\n    CONF.register_opts(metadata_proxy_opts, 'neutron')\n\nand\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/conf/neutron.py\n    neutron_group = cfg.OptGroup('neutron', title='Neutron Options')\n    conf.register_group(neutron_group)", 
            "date_created": "2016-04-11 11:59:29.804142+00:00", 
            "author": "https://api.launchpad.net/1.0/~derekh"
        }, 
        {
            "content": "A Nova action could be to at least finish the move to the new nova/conf files and make sure the metadata related opts are correctly provided in the right file.", 
            "date_created": "2016-04-12 08:23:17.564852+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "Confirmed with the last commit, and also found that we didn't had this problem previously. Moving it to High.", 
            "date_created": "2016-04-12 08:50:14.285016+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "So, just checking that for the 13.0.0 tag, things are even more terrible with a lot of duplicate sections :\n\n[sbauza@sbauza nova]$ grep \"^\\[\" etc/nova/nova.conf.sample | sort | uniq -c | grep \" 2 \"\n      2 [glance]\n      2 [hyperv]\n      2 [image_file_url]\n      2 [neutron]\n      2 [upgrade_levels]\n      2 [vmware]\n      2 [workarounds]\n      2 [xenserver]\n\n", 
            "date_created": "2016-04-12 09:21:13.090127+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "For Nova Newton master (commit 95ede914f8) it could be solved with:\n\n    diff --git a/nova/conf/neutron.py b/nova/conf/neutron.py\n    index b6d4dd6..ae1e85c 100644\n    --- a/nova/conf/neutron.py\n    +++ b/nova/conf/neutron.py\n    @@ -41,4 +41,7 @@\n     \n     \n     def list_opts():\n    -    return {neutron_group: neutron_opts}\n    +    # TODO(markus_z): After all neutron options are in this module, we can\n    +    #                 switch back to use the OptGroup object again.\n    +    #                 See bug 1568820\n    +    return {neutron_group.name: neutron_opts}\n    diff --git a/nova/conf/xenserver.py b/nova/conf/xenserver.py\n    index 49902d0..3e2c2fc 100644\n    --- a/nova/conf/xenserver.py\n    +++ b/nova/conf/xenserver.py\n    @@ -365,4 +365,7 @@\n     \n     \n     def list_opts():\n    +    # TODO(markus_z): After all xen options are in this module, we can\n    +    #                 switch back to use the OptGroup object again.\n    +    #                 See bug 1568820\n         return {xenserver_group: ALL_XENSERVER_OPTS}", 
            "date_created": "2016-04-12 09:52:26.825007+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "should be \"xenserver_group.name\"", 
            "date_created": "2016-04-12 09:53:18.702055+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Trying out a potential fix with this patch, it appears to fix the problem but has a down side\nhttps://review.openstack.org/#/c/304077/", 
            "date_created": "2016-04-12 10:08:54.408356+00:00", 
            "author": "https://api.launchpad.net/1.0/~derekh"
        }, 
        {
            "content": "comment #3:\n> So, just checking that for the 13.0.0 tag, things are even more \n> terrible with a lot of duplicate sections :\n\nI cannot reproduce this behavior locally. I tried:\n    $ git checkout 13.0.0\n    $ tox -e genconfig\n\nSame for \"stable/mitaka\".\n", 
            "date_created": "2016-04-12 14:34:17.259591+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/304802", 
            "date_created": "2016-04-12 18:05:08.015094+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I checked again for Nova 13.0.0 with a fresh checkout. The Mitaka\nrelease is not affected. Lowering the importance.", 
            "date_created": "2016-04-14 09:56:30.412746+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/306682", 
            "date_created": "2016-04-16 04:09:00.143548+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Tin Lam (<email address hidden>) on branch: master\nReview: https://review.openstack.org/306682\nReason: Duplicate.", 
            "date_created": "2016-04-21 05:53:56.170228+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This gets solved for Nova when changes [1] (with a patch set # > 2) and [2] merge.\n\n[1] https://review.openstack.org/#/c/302446/\n[2] https://review.openstack.org/#/c/304001/", 
            "date_created": "2016-05-03 13:53:31.943092+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/304802\nCommitted: https://git.openstack.org/cgit/openstack/oslo.config/commit/?id=01ed4fccf27ef32449bfe3d36af754c8659d0720\nSubmitter: Jenkins\nBranch:    master\n\ncommit 01ed4fccf27ef32449bfe3d36af754c8659d0720\nAuthor: Ben Nemec <email address hidden>\nDate:   Tue Apr 12 17:54:45 2016 +0000\n\n    Avoid duplicate sections in generator output\n    \n    Because option groups can be specified as either bare strings or\n    OptGroup objects, it is possible to end up with duplicate sections\n    in the resulting output file.  This is confusing, and can cause\n    problems for config management systems so we should avoid doing it.\n    \n    This change avoids the dupes by always keying the group list on\n    the group name, but including the OptGroup object in the data\n    when available so the output code can make use of the extra\n    information in an OptGroup.\n    \n    Co-Authored-By: Alexis Lee <email address hidden>\n    Change-Id: I2cd8ae87a1f573b5837d292abcf7babf5d88bee5\n    Closes-Bug: 1568820\n", 
            "date_created": "2016-05-04 13:33:36.256190+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "As said in comment #12, the \"wrong\" usage of oslo.config gets fixed in Nova with the mentioned changes. As oslo.config released a fix for this, I don't see the need to provide a temporary fix in Nova, that's why I change the status to \"won't fix\".", 
            "date_created": "2016-05-04 13:57:46.515670+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "This issue was fixed in the openstack/oslo.config 3.10.0 release.", 
            "date_created": "2016-05-24 22:04:32.846750+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }, 
        {
            "content": "Fix proposed to branch: stable/mitaka\nReview: https://review.openstack.org/355865", 
            "date_created": "2016-08-16 11:36:25.231931+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Thomas Bechtold (<email address hidden>) on branch: stable/mitaka\nReview: https://review.openstack.org/355865\nReason: Hm. Looks like this is more complicated than I thought. Sorry for wasting your review time.", 
            "date_created": "2016-08-17 08:29:26.069022+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}