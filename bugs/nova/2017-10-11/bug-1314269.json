{
    "status": "Fix Released", 
    "last_updated": "2015-04-01 13:42:01.901171+00:00", 
    "description": "nova-compute.log on kvm:\n\n2014-04-28 14:51:57.294 14659 ERROR nova.compute.manager [req-e9768eff-116d-4681-9ff6-3ab51dbbdee0 c460eaefef634e4bab938915224a6201 e159f0e56ea545bd84529fc38063\nceee] [instance: 61a3e08f-b22f-47a8-a815-f586422860ef] Instance failed to spawn\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef] Traceback (most recent call last):\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/compute/\nmanager.py\", line 1423, in _spawn\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     block_device_info)\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 2088, in spawn\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     write_to_disk=True)\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 3084, in to_xml\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     disk_info, rescue, block_device_info)\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 2960, in get_guest_config\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     inst_type):\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 2737, in get_guest_storage_config\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     inst_type)\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 2700, in get_guest_disk_config\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     self.get_hypervisor_version())\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef] TypeError: libvirt_info() takes exactly 6 arguments (7\n\u00a0given)\n\nI found this bug https://bugs.launchpad.net/nova/+bug/1233188 and a patch that should fix this issue (https://review.openstack.org/#/c/72575/1//COMMIT_MSG).\n\nBut on Ubuntu 12.04.4 LTS with Openstack Havana installed from Ubuntu Cloud Archive this issue is still available because one of the two patched files from this commit isn't present. The changes from https://review.openstack.org/#/c/72575/1/nova/tests/virt/libvirt/test_imagebackend.py are missing. I manually added those lines in test_imagebackend.py and Openstack is working fine.\n\nMy nova version:\n\nii  nova-common                      1:2013.2.2-0ubuntu1~cloud0                 OpenStack Compute - common files\nii  nova-compute                     1:2013.2.2-0ubuntu1~cloud0                 OpenStack Compute - compute node\nii  nova-compute-kvm                 1:2013.2.2-0ubuntu1~cloud0                 OpenStack Compute - compute node (KVM)\nii  python-nova                      1:2013.2.2-0ubuntu1~cloud0                 OpenStack Compute Python libraries\nii  python-novaclient                1:2.15.0-0ubuntu1~cloud0                   client library for OpenStack Compute API\n\nLet me know if you need further information, poorly I am not a developer so my this report might seem a bit plain.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1314269", 
    "owner": "None", 
    "id": 1314269, 
    "index": 4807, 
    "created": "2014-04-29 16:30:16.779960+00:00", 
    "title": "missing code after patch in nova/tests/virt/libvirt/test_imagebackend.py ", 
    "comments": [
        {
            "content": "nova-compute.log on kvm:\n\n2014-04-28 14:51:57.294 14659 ERROR nova.compute.manager [req-e9768eff-116d-4681-9ff6-3ab51dbbdee0 c460eaefef634e4bab938915224a6201 e159f0e56ea545bd84529fc38063\nceee] [instance: 61a3e08f-b22f-47a8-a815-f586422860ef] Instance failed to spawn\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef] Traceback (most recent call last):\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/compute/\nmanager.py\", line 1423, in _spawn\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     block_device_info)\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 2088, in spawn\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     write_to_disk=True)\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 3084, in to_xml\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     disk_info, rescue, block_device_info)\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 2960, in get_guest_config\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     inst_type):\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 2737, in get_guest_storage_config\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     inst_type)\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]   File \"/usr/lib/python2.7/dist-packages/nova/virt/lib\nvirt/driver.py\", line 2700, in get_guest_disk_config\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef]     self.get_hypervisor_version())\n2014-04-28 14:51:57.294 14659 TRACE nova.compute.manager [instance: 61a3e08f-b22f-47a8-a815-f586422860ef] TypeError: libvirt_info() takes exactly 6 arguments (7\n given)\n\n\nI found this bug https://bugs.launchpad.net/nova/+bug/1233188 and a patch that should fix this issue (https://review.openstack.org/#/c/72575/1//COMMIT_MSG).\n\nBut on Ubuntu 12.04.4 LTS with Openstack Havana installed from Ubuntu Cloud Archive this issue is still available because on of the two patched files from this commit isn't present. The changes from https://review.openstack.org/#/c/72575/1/nova/tests/virt/libvirt/test_imagebackend.py are missing. I manually added those lines in test_imagebackend.py and Openstack is working fine.\n\nMy nova version:\n\nii  nova-common                      1:2013.2.2-0ubuntu1~cloud0                 OpenStack Compute - common files\nii  nova-compute                     1:2013.2.2-0ubuntu1~cloud0                 OpenStack Compute - compute node\nii  nova-compute-kvm                 1:2013.2.2-0ubuntu1~cloud0                 OpenStack Compute - compute node (KVM)\nii  python-nova                      1:2013.2.2-0ubuntu1~cloud0                 OpenStack Compute Python libraries\nii  python-novaclient                1:2.15.0-0ubuntu1~cloud0                   client library for OpenStack Compute API\n\nLet me know if you need further information, poorly I am not a developer so my this report might seem a bit plain.", 
            "date_created": "2014-04-29 16:30:16.779960+00:00", 
            "author": "https://api.launchpad.net/1.0/~haukebruno"
        }, 
        {
            "content": "Hi,\n\nThe changes in unit tests shouldn't take effect in the services themselves... So I didn't get how your manual change fixed the problem... Could you provide more information... which changes have you added and where?\n\nThanks,\n\nTiago", 
            "date_created": "2014-04-29 20:05:02.523943+00:00", 
            "author": "https://api.launchpad.net/1.0/~timello"
        }, 
        {
            "content": "Hi Tiago,\n\nhonestly I just added the missing 4 lines from this patch ( https://review.openstack.org/#/c/72575/1/nova/tests/virt/libvirt/test_imagebackend.py ) and restarted nova-compute. This solves the \"TypeError: libvirt_info() takes exactly 6 arguments (7\n given)\" error and I were able to deploy VMs.\n\nIf it is relevant: we use the default stack explained in the official Openstack (Havana) docs + Ceph for Cinder and Glance. ", 
            "date_created": "2014-04-30 06:46:13.065168+00:00", 
            "author": "https://api.launchpad.net/1.0/~haukebruno"
        }, 
        {
            "content": "@haukebruno: The code in tests/virt/libvirt/test_imagebackend.py would only affect the unit tests. It should not affect an actual running system.\n\nAre you saying, that on your system (with the patch applied to nova/virt/libvirt/imagebackend.py, you are still seeing errors on the running system, and that adding the patch to the tests causes the error to go away?", 
            "date_created": "2014-06-05 19:43:51.742676+00:00", 
            "author": "https://api.launchpad.net/1.0/~jshepher"
        }, 
        {
            "content": "@jshepher: I just see the errors while creating a virtual maschine. The creation could not be finished because of this error. After _patching_ the above I was able to create maschines.", 
            "date_created": "2014-06-11 14:44:20.248457+00:00", 
            "author": "https://api.launchpad.net/1.0/~haukebruno"
        }, 
        {
            "content": "this _problem_ exists for LVM as the image storage too. I just switched from RBD to LVM for some testing stuff and got the same error like above.\n\nI needed to change the LVM counterpart config in nova/virt/libvirt/imagebackend.py as described above to getting things work:\n\n    def libvirt_info(self, disk_bus, disk_dev, device_type, cache_mode,\n            extra_specs, hypervisor_version):\n", 
            "date_created": "2014-07-28 12:01:21.865982+00:00", 
            "author": "https://api.launchpad.net/1.0/~haukebruno"
        }
    ]
}