{
    "status": "Invalid", 
    "last_updated": "2015-09-23 14:12:52.702802+00:00", 
    "description": "Here is  the steps to reproduce. I use the devstack to setup ironic with pxe deployment.\n\nubuntu@devstack:~/devstack$ ironic node-list\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n| UUID                                 | Name   | Instance UUID                        | Power State | Provisioning State | Maintenance |\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n| e5f9a29e-c50c-4c13-9b8c-c6b8a0767b0a | node-0 | e8e2b89c-530f-43d6-b4e7-965a7864417e | power on    | active             | False       |\n| e4aab274-077c-4238-a509-d17f6c5b767a | node-1 | None                                 | power on    | available          | False       |\n| 5d0db590-e9c3-46af-8b5b-7540d0a3faa7 | node-2 | 8da05834-2c43-430c-bba5-f136b6db872b | power on    | active             | False       |\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\nubuntu@devstack:~/devstack$ ironic node-set-power-state node-0 off\nubuntu@devstack:~/devstack$ ironic node-list\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n| UUID                                 | Name   | Instance UUID                        | Power State | Provisioning State | Maintenance |\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n| e5f9a29e-c50c-4c13-9b8c-c6b8a0767b0a | node-0 | e8e2b89c-530f-43d6-b4e7-965a7864417e | power off   | active             | False       |\n| e4aab274-077c-4238-a509-d17f6c5b767a | node-1 | None                                 | power on    | available          | False       |\n| 5d0db590-e9c3-46af-8b5b-7540d0a3faa7 | node-2 | 8da05834-2c43-430c-bba5-f136b6db872b | power on    | active             | False       |\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n\nThe expected result is that I can see shutdown from 'nova list'. However, the result is as following.\nubuntu@devstack:~/devstack$ nova list\n+--------------------------------------+------------+--------+------------+-------------+------------------------------------------------------+\n| ID                                   | Name       | Status | Task State | Power State | Networks                                             |\n+--------------------------------------+------------+--------+------------+-------------+------------------------------------------------------+\n| 8da05834-2c43-430c-bba5-f136b6db872b | testing-01 | ACTIVE | -          | Running     | private=10.1.0.5, fdc6:d93f:45dd:0:5054:ff:fe70:ffe4 |\n| e8e2b89c-530f-43d6-b4e7-965a7864417e | testing-02 | ACTIVE | -          | Running     | private=10.1.0.6, fdc6:d93f:45dd:0:5054:ff:fec5:254c |\n+--------------------------------------+------------+--------+------------+-------------+------------------------------------------------------+\n\nIt doesn't not change the state immediately. After a while, it changes to shutdown in nova list.\n\nWhat confuse me is that when I change the power state from nova, it does change the state from ironic side.", 
    "tags": [
        "ironic"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1498756", 
    "owner": "None", 
    "id": 1498756, 
    "index": 5784, 
    "created": "2015-09-23 06:02:45.116283+00:00", 
    "title": "Power state inconsistence after using Ironic node-set-power-state", 
    "comments": [
        {
            "content": "Here is  the steps to reproduce. I use the devstack to setup ironic with pxe deployment.\n\nubuntu@devstack:~/devstack$ ironic node-list\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n| UUID                                 | Name   | Instance UUID                        | Power State | Provisioning State | Maintenance |\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n| e5f9a29e-c50c-4c13-9b8c-c6b8a0767b0a | node-0 | e8e2b89c-530f-43d6-b4e7-965a7864417e | power on    | active             | False       |\n| e4aab274-077c-4238-a509-d17f6c5b767a | node-1 | None                                 | power on    | available          | False       |\n| 5d0db590-e9c3-46af-8b5b-7540d0a3faa7 | node-2 | 8da05834-2c43-430c-bba5-f136b6db872b | power on    | active             | False       |\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\nubuntu@devstack:~/devstack$ ironic node-set-power-state node-0 off\nubuntu@devstack:~/devstack$ ironic node-list\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n| UUID                                 | Name   | Instance UUID                        | Power State | Provisioning State | Maintenance |\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n| e5f9a29e-c50c-4c13-9b8c-c6b8a0767b0a | node-0 | e8e2b89c-530f-43d6-b4e7-965a7864417e | power off   | active             | False       |\n| e4aab274-077c-4238-a509-d17f6c5b767a | node-1 | None                                 | power on    | available          | False       |\n| 5d0db590-e9c3-46af-8b5b-7540d0a3faa7 | node-2 | 8da05834-2c43-430c-bba5-f136b6db872b | power on    | active             | False       |\n+--------------------------------------+--------+--------------------------------------+-------------+--------------------+-------------+\n\nThe expected result is that I can see shutdown from 'nova list'. However, the result is as following.\nubuntu@devstack:~/devstack$ nova list\n+--------------------------------------+------------+--------+------------+-------------+------------------------------------------------------+\n| ID                                   | Name       | Status | Task State | Power State | Networks                                             |\n+--------------------------------------+------------+--------+------------+-------------+------------------------------------------------------+\n| 8da05834-2c43-430c-bba5-f136b6db872b | testing-01 | ACTIVE | -          | Running     | private=10.1.0.5, fdc6:d93f:45dd:0:5054:ff:fe70:ffe4 |\n| e8e2b89c-530f-43d6-b4e7-965a7864417e | testing-02 | ACTIVE | -          | Running     | private=10.1.0.6, fdc6:d93f:45dd:0:5054:ff:fec5:254c |\n+--------------------------------------+------------+--------+------------+-------------+------------------------------------------------------+", 
            "date_created": "2015-09-23 06:02:45.116283+00:00", 
            "author": "https://api.launchpad.net/1.0/~shuquan"
        }, 
        {
            "content": "If it is an issue, that's an issue on Nova side of things (i.e. in ironic driver). I'm not sure, however, it's a valid thing to do, but I'll leave it up to Nova folks.", 
            "date_created": "2015-09-23 08:50:19.185491+00:00", 
            "author": "https://api.launchpad.net/1.0/~divius"
        }, 
        {
            "content": "This is working as designed.  The reason the change from the ironic side to the nova side isn't immediate is because (1) the ironic driver in nova doesn't implement the lifecycle event handling part of the virt driver API (libvirt and hyper-v implement instance lifecycle event handling) and (2) the _sync_power_states periodic task runs on a cron which is by default 10 minutes:\n\nhttps://github.com/openstack/nova/blob/master/nova/compute/manager.py#L152\n\nThe config option is \"sync_power_state_interval\".\n\nSo you have to wait by default at most 10 minutes before the power state change on the ironic side is processed on the nova side via that task.\n\nThis could be made more automatic if the ironic driver in nova implemented the lifecycle event handling code in the virt driver, but that would require a blueprint and spec, so it's not a bug.", 
            "date_created": "2015-09-23 14:12:52.136553+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ]
}