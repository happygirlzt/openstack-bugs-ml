{
    "status": "In Progress", 
    "last_updated": "2017-08-24 14:56:33.016497+00:00", 
    "description": "Scenario is attach Ploop volume located on Vzstorage to Virtuozzo container, operated via a libvirt driver. Problem is that containers don't have anything like 'bus', and 'scsi' bus type is just a convenience value.\n\nnova.conf:\n[libvirt]\nvzstorage_mount_group = root\nimages_type = ploop\nconnection_uri = parallels+unix:///system\nlive_migration_uri = vz+tcp://%s/system\ncpu_mode = none\nvirt_type = parallels\n\nAttach attempt:\nAug 18 10:35:24.604287 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [None req-dc714064-d843-4bbd-86bd-30bda4c5aba9 tempest-AttachVolumeShelveTestJSON-773580589 tempest-AttachVolumeShelveTestJSON-773580589] [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9] Driver failed to attach volume 2a595cc0-164a-4680-ba4d-5e8a352ccb72 at /dev/sdb: ValueError: max() arg is an empty sequence\nAug 18 10:35:24.604448 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9] Traceback (most recent call last):\nAug 18 10:35:24.604623 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]   File \"/opt/stack/new/nova/nova/virt/block_device.py\", line 389, in attach\nAug 18 10:35:24.604811 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]     device_type=self['device_type'], encryption=encryption)\nAug 18 10:35:24.604966 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1235, in attach_volume\nAug 18 10:35:24.605119 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]     disk_info['unit'] = self._get_scsi_controller_max_unit(guest) + 1\nAug 18 10:35:24.605269 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1060, in _get_scsi_controller_max_unit\nAug 18 10:35:24.605417 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]     return max(ret)\nAug 18 10:35:24.605586 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9] ValueError: max() arg is an empty sequence\nAug 18 10:35:24.605737 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9] \n\nlibvirt instance XML:\n<domain type='vz' id='0'>\n  <name>instance-00000007</name>\n  <uuid>0e2917b7-37a7-443d-87b6-439d6ec1906d</uuid>\n  <memory unit='KiB'>524288</memory>\n  <currentMemory unit='KiB'>524288</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <os>\n    <type arch='x86_64'>exe</type>\n    <init>/sbin/init</init>\n  </os>\n  <clock offset='utc'/>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <filesystem type='file' accessmode='passthrough'>\n      <driver type='ploop' format='ploop'/>\n      <source file='/opt/stack/data/nova/instances/0e2917b7-37a7-443d-87b6-439d6ec1906d/disk'/>\n      <target dir='/'/>\n    </filesystem>\n    <interface type='network'>\n      <mac address='00:00:00:00:00:00'/>\n      <source network='host-routed'/>\n      <target dev='venet0'/>\n      <link state='up'/>\n    </interface>\n    <interface type='bridge' trustGuestRxFilters='no'>\n      <mac address='fa:16:3e:44:08:ca'/>\n      <source bridge='qbr25d67bec-74'/>\n      <target dev='tap25d67bec-74'/>\n      <link state='up'/>\n    </interface>\n    <input type='mouse' bus='parallels'/>\n    <input type='keyboard' bus='parallels'/>\n    <graphics type='vnc' port='5700' autoport='yes' listen='0.0.0.0'>\n      <listen type='address' address='0.0.0.0'/>\n    </graphics>\n    <video>\n      <model type='parallels' heads='1'/>\n    </video>\n  </devices>\n</domain>", 
    "tags": [
        "libvirt", 
        "virtuozzo"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1712801", 
    "owner": "https://api.launchpad.net/1.0/~eantyshev", 
    "id": 1712801, 
    "index": 7002, 
    "created": "2017-08-24 11:39:27.079792+00:00", 
    "title": "Virtuozzo conainers lack SCSI info in libvirt XML", 
    "comments": [
        {
            "content": "Scenario is attach Ploop volume located on Vzstorage to Virtuozzo container, operated via a libvirt driver. Problem is that containers don't have anything like 'bus', and 'scsi' bus type is just a convenience value.\n\nnova.conf:\n[libvirt]\nvzstorage_mount_group = root\nimages_type = ploop\nconnection_uri = parallels+unix:///system\nlive_migration_uri = vz+tcp://%s/system\ncpu_mode = none\nvirt_type = parallels\n\nAttach attempt:\nAug 18 10:35:24.604287 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [None req-dc714064-d843-4bbd-86bd-30bda4c5aba9 tempest-AttachVolumeShelveTestJSON-773580589 tempest-AttachVolumeShelveTestJSON-773580589] [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9] Driver failed to attach volume 2a595cc0-164a-4680-ba4d-5e8a352ccb72 at /dev/sdb: ValueError: max() arg is an empty sequence\nAug 18 10:35:24.604448 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9] Traceback (most recent call last):\nAug 18 10:35:24.604623 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]   File \"/opt/stack/new/nova/nova/virt/block_device.py\", line 389, in attach\nAug 18 10:35:24.604811 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]     device_type=self['device_type'], encryption=encryption)\nAug 18 10:35:24.604966 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1235, in attach_volume\nAug 18 10:35:24.605119 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]     disk_info['unit'] = self._get_scsi_controller_max_unit(guest) + 1\nAug 18 10:35:24.605269 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1060, in _get_scsi_controller_max_unit\nAug 18 10:35:24.605417 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9]     return max(ret)\nAug 18 10:35:24.605586 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9] ValueError: max() arg is an empty sequence\nAug 18 10:35:24.605737 host-10-94-179-76 nova-compute[68438]: ERROR nova.virt.block_device [instance: 7f4a9527-8ff0-4966-aad5-fe4bc55c9ef9] \n\nlibvirt instance XML:\n<domain type='vz' id='0'>\n  <name>instance-00000007</name>\n  <uuid>0e2917b7-37a7-443d-87b6-439d6ec1906d</uuid>\n  <memory unit='KiB'>524288</memory>\n  <currentMemory unit='KiB'>524288</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <os>\n    <type arch='x86_64'>exe</type>\n    <init>/sbin/init</init>\n  </os>\n  <clock offset='utc'/>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <filesystem type='file' accessmode='passthrough'>\n      <driver type='ploop' format='ploop'/>\n      <source file='/opt/stack/data/nova/instances/0e2917b7-37a7-443d-87b6-439d6ec1906d/disk'/>\n      <target dir='/'/>\n    </filesystem>\n    <interface type='network'>\n      <mac address='00:00:00:00:00:00'/>\n      <source network='host-routed'/>\n      <target dev='venet0'/>\n      <link state='up'/>\n    </interface>\n    <interface type='bridge' trustGuestRxFilters='no'>\n      <mac address='fa:16:3e:44:08:ca'/>\n      <source bridge='qbr25d67bec-74'/>\n      <target dev='tap25d67bec-74'/>\n      <link state='up'/>\n    </interface>\n    <input type='mouse' bus='parallels'/>\n    <input type='keyboard' bus='parallels'/>\n    <graphics type='vnc' port='5700' autoport='yes' listen='0.0.0.0'>\n      <listen type='address' address='0.0.0.0'/>\n    </graphics>\n    <video>\n      <model type='parallels' heads='1'/>\n    </video>\n  </devices>\n</domain>", 
            "date_created": "2017-08-24 11:39:27.079792+00:00", 
            "author": "https://api.launchpad.net/1.0/~eantyshev"
        }, 
        {
            "content": "Which release of Nova are you using?", 
            "date_created": "2017-08-24 14:46:21.825183+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I think it's upsream master", 
            "date_created": "2017-08-24 14:55:07.605330+00:00", 
            "author": "https://api.launchpad.net/1.0/~mnestratov"
        }, 
        {
            "content": "This was opened in response to this patch for the fix:\n\nhttps://review.openstack.org/#/c/495756/", 
            "date_created": "2017-08-24 14:56:15.926303+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ]
}