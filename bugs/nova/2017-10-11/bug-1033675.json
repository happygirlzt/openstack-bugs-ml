{
    "status": "Invalid", 
    "last_updated": "2012-08-23 13:24:27.026180+00:00", 
    "description": "Hi,\n\nI'm trying to manage my DNS with a combination of dnsmasq trickery. I would like to be able to have specific domain per subnet. This is already done by the adding a specific configuration file to dnsmasq via the nova flag --dnsmasq_config_file=/etc/dnsmasq.conf. I fulfilled this file like so:\n\ndomain=tenant1.domain.net,10.0.20.0/24\ndomain=tenant2.domain.net,10.0.21.0/24\ndomain=tenant3.domain.net,10.0.22.0/24\n...\n\nWithin the VMs, the /etc/resolv.conf is ok. No problem.\n\nBut the problem is on the lease file generated by nova. The default --domain, setup or not in nova.conf overwrites the lease file. If I don't set anything in nova.conf, my lease file gets:\n\nfa:16:3e:7d:d3:9f,un.novalocal,10.0.20.3\nfa:16:3e:69:4e:53,deux.novalocal,10.0.20.8\nfa:16:3e:76:d2:43,troi.novalocal,10.0.20.11\n\nAnd if I put something on this flag, the behavior is the same. It tried to put an empty flag but nova complains about an empty parameter which makes sense.\n\nI would like to be able to get lease file like so:\n\nfa:16:3e:7d:d3:9f,vm1.tenant1.domain.net,10.0.20.3\nfa:16:3e:69:4e:53,vm2.tenant1.domain.net,10.0.20.8\nfa:16:3e:76:d2:43,vm3.tenant1.domain.net,10.0.20.11\n...\n\nAnd so on according to each tenant lease file. I think I will be able to get what I want by removing the dhcp_domain flag from the nova code.\n\nAt the moment nova seems overwrite the dnsmasq config file, I don't understand why since --domain is not a mandatory parameter. I dived into the code, removed everything related to --domain : flag etc... In those files:\n\n-/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\n-/usr/lib/python2.7/dist-packages/nova/network/manager.py\n-/usr/lib/python2.7/dist-packages/nova/api/metadata/handler.py\n\nBut I discovered that nova builds his own lease file so the lease file is written but without any domain now. It's not a problem to rollback my files but I wish I could achieve my goal.\n\n\nAny idea?\nThank you in advance.\n\nCheers!", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1033675", 
    "owner": "None", 
    "id": 1033675, 
    "index": 3012, 
    "created": "2012-08-06 21:27:10.259726+00:00", 
    "title": "Nova dhcp_domain flag overwrites the dnsmasq config file", 
    "comments": [
        {
            "content": "Hi,\n\nI'm trying to manage my DNS with a combination of dnsmasq trickery. I would like to be able to have specific domain per subnet. This is already done by the adding a specific configuration file to dnsmasq via the nova flag --dnsmasq_config_file=/etc/dnsmasq.conf. I fulfilled this file like so:\n\ndomain=tenant1.domain.net,10.0.20.0/24\ndomain=tenant2.domain.net,10.0.21.0/24\ndomain=tenant3.domain.net,10.0.22.0/24\n...\n\nWithin the VMs, the /etc/resolv.conf is ok. No problem.\n\nBut the problem is on the lease file generated by nova. The default --domain, setup or not in nova.conf overwrites the lease file. If I don't set anything in nova.conf, my lease file gets:\n\nfa:16:3e:7d:d3:9f,un.novalocal,10.0.20.3\nfa:16:3e:69:4e:53,deux.novalocal,10.0.20.8\nfa:16:3e:76:d2:43,troi.novalocal,10.0.20.11\n\nAnd if I put something on this flag, the behavior is the same. It tried to put an empty flag but nova complains about an empty parameter which makes sense.\n\nI would like to be able to get lease file like so:\n\nfa:16:3e:7d:d3:9f,vm1.tenant1.domain.net,10.0.20.3\nfa:16:3e:69:4e:53,vm2.tenant1.domain.net,10.0.20.8\nfa:16:3e:76:d2:43,vm3.tenant1.domain.net,10.0.20.11\n...\n\nAnd so on according to each tenant lease file. I think I will be able to get what I want by removing the dhcp_domain flag from the nova code.\n\nAt the moment nova seems overwrite the dnsmasq config file, I don't understand why since --domain is not a mandatory parameter. I dived into the code, removed everything related to --domain : flag etc... In those files:\n\n-/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\n-/usr/lib/python2.7/dist-packages/nova/network/manager.py\n-/usr/lib/python2.7/dist-packages/nova/api/metadata/handler.py\n\nBut I discovered that nova builds his own lease file so the lease file is written but without any domain now. It's not a problem to rollback my files but I wish I could achieve my goal.\n\n\nAny idea?\nThank you in advance.\n\nCheers!", 
            "date_created": "2012-08-06 21:27:10.259726+00:00", 
            "author": "https://api.launchpad.net/1.0/~han-sebastien"
        }, 
        {
            "content": "you could do something tricky like set config option to:\n--dhcp_domain=domain.net\n\nand modify the server create code nova/compute/api.py that sets the hostname to append the tenant name.\nso the instance hostname would be xxx.tenant1, then you would get a different domain name per tenant.\n", 
            "date_created": "2012-08-09 02:00:24.937616+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Hi,\n\nThanks, I will give a try :)\n\nBtw why the dhcp_domain somehow overwrite the dnsmasq file? This should be all the way around right?\n\nCheers!", 
            "date_created": "2012-08-10 08:18:54.994240+00:00", 
            "author": "https://api.launchpad.net/1.0/~han-sebastien"
        }
    ]
}