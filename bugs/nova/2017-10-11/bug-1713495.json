{
    "status": "Incomplete", 
    "last_updated": "2017-09-01 08:58:39.076349+00:00", 
    "description": "Hello\nI experienced that Openstack provides two different hypervisor usage statistics (Ocata).\nI checked that some nova processes reports different cpu and ram usage to database.\nThese are queries from mysql.log which are providing different statistics:\n\n2017-08-28T11:29:19.037802Z       134 Query     UPDATE compute_nodes SET updated_at='2017-08-28 11:29:19.036118', vcpus_used=126, memory_mb_used=134660, local_gb_used=215601, disk_available_least=275518, stats='{}', numa_topology='{\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cells\\\"], \\\"nova_object.name\\\": \\\"NUMATopology\\\", \\\"nova_object.data\\\": {\\\"cells\\\": [{\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cpu_usage\\\", \\\"memory_usage\\\", \\\"cpuset\\\", \\\"mempages\\\", \\\"pinned_cpus\\\", \\\"memory\\\", \\\"siblings\\\", \\\"id\\\"], \\\"nova_object.name\\\": \\\"NUMACell\\\", \\\"nova_object.data\\\": {\\\"cpu_usage\\\": 0, \\\"memory_usage\\\": 0, \\\"cpuset\\\": [0, 1, 2, 3, 4, 5, 6, 7, 16, 17, 18, 19, 20, 21, 22, 23], \\\"pinned_cpus\\\": [], \\\"siblings\\\": [[2, 18], [1, 17], [0, 16], [19, 3], [22, 6], [20, 4], [23, 7], [5, 21]], \\\"memory\\\": 128908, \\\"mempages\\\": [{\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 33000563, \\\"reserved\\\": 0, \\\"size_kb\\\": 4}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 2048}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 1048576}, \\\"nova_object.namespace\\\": \\\"nova\\\"}], \\\"id\\\": 0}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cpu_usage\\\", \\\"memory_usage\\\", \\\"cpuset\\\", \\\"mempages\\\", \\\"pinned_cpus\\\", \\\"memory\\\", \\\"siblings\\\", \\\"id\\\"], \\\"nova_object.name\\\": \\\"NUMACell\\\", \\\"nova_object.data\\\": {\\\"cpu_usage\\\": 0, \\\"memory_usage\\\": 0, \\\"cpuset\\\": [8, 9, 10, 11, 12, 13, 14, 15, 24, 25, 26, 27, 28, 29, 30, 31], \\\"pinned_cpus\\\": [], \\\"siblings\\\": [[8, 24], [30, 14], [31, 15], [27, 11], [10, 26], [28, 12], [9, 25], [13, 29]], \\\"memory\\\": 129021, \\\"mempages\\\": [{\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 33029464, \\\"reserved\\\": 0, \\\"size_kb\\\": 4}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 2048}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 1048576}, \\\"nova_object.namespace\\\": \\\"nova\\\"}], \\\"id\\\": 1}, \\\"nova_object.namespace\\\": \\\"nova\\\"}]}, \\\"nova_object.namespace\\\": \\\"nova\\\"}' WHERE compute_nodes.id = 63\n\n\n2017-08-28T11:29:20.547435Z        89 Query     UPDATE compute_nodes SET updated_at='2017-08-28 11:29:20.544879', vcpus_used=132, memory_mb_used=257536, local_gb_used=2590, stats='{\\\"num_proj_d1de178820ea48c3a1b098df3d4a4b7c\\\": \\\"2\\\", \\\"num_instances\\\": \\\"29\\\", \\\"num_proj_ada9ef29bef5486bb7f386ecd7a7cb2f\\\": \\\"1\\\", \\\"num_proj_dfd2237d06114848b77eb5cd4d5cb02a\\\": \\\"1\\\", \\\"num_proj_e8f91dabfe664223899bfeabdee8735f\\\": \\\"1\\\", \\\"num_proj_28c4118284f545a389eb20d745e3c5d9\\\": \\\"2\\\", \\\"io_workload\\\": \\\"0\\\", \\\"num_vm_active\\\": \\\"26\\\", \\\"num_proj_c673146ecf0349bbbe06a284c9fd2fc0\\\": \\\"1\\\", \\\"num_vm_stopped\\\": \\\"2\\\", \\\"num_proj_505ccb54aaa049199a402e3d8369bcca\\\": \\\"1\\\", \\\"num_proj_3f410526915f446c904d4aeadd97021e\\\": \\\"1\\\", \\\"num_proj_e37a451d77524a00b977538d3a58f53d\\\": \\\"1\\\", \\\"num_proj_110d63d719464a9384336ac6c9730330\\\": \\\"1\\\", \\\"num_proj_eb0d7cf7e0394dd082322d0dfe1753b4\\\": \\\"1\\\", \\\"num_proj_eeaf551320d647c18762f80a565d77e4\\\": \\\"1\\\", \\\"num_proj_3cdc8848793f428a8884809daa499af6\\\": \\\"1\\\", \\\"num_task_None\\\": \\\"29\\\", \\\"num_proj_b01521bb84fa45ce980f56a9bb5565c7\\\": \\\"1\\\", \\\"num_proj_7e689fc19cc448cf9b78ba594e9eb27e\\\": \\\"1\\\", \\\"num_proj_11bfa9122bf04381a1dd0c33ef1d0181\\\": \\\"1\\\", \\\"num_vm_suspended\\\": \\\"1\\\", \\\"num_proj_c225559f26e34070be29b8d1460b3eb7\\\": \\\"1\\\", \\\"num_proj_1977d8ae1cde41bc83e2b466c49a73ad\\\": \\\"1\\\", \\\"num_proj_2e5b2b05d443449789cd00368bd25545\\\": \\\"1\\\", \\\"num_proj_2cfcd2e3bf8f45cc89b4155061dd373e\\\": \\\"1\\\", \\\"num_proj_2f4fd3ca13d6441f9d7c8bd097377f1b\\\": \\\"2\\\", \\\"num_proj_be58cda2f3ca4c07b0162c9b13a41e88\\\": \\\"1\\\", \\\"num_proj_efb79b155383443d88dcc25c6008e170\\\": \\\"2\\\", \\\"num_os_type_None\\\": \\\"29\\\", \\\"num_proj_7fd4b8ef480d4e85b545b7c28996c473\\\": \\\"1\\\", \\\"num_proj_9f79e068e7d14d219c2b513cd9c6e83b\\\": \\\"1\\\"}', numa_topology='{\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cells\\\"], \\\"nova_object.name\\\": \\\"NUMATopology\\\", \\\"nova_object.data\\\": {\\\"cells\\\": [{\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cpu_usage\\\", \\\"memory_usage\\\", \\\"cpuset\\\", \\\"pinned_cpus\\\", \\\"siblings\\\", \\\"memory\\\", \\\"mempages\\\", \\\"id\\\"], \\\"nova_object.name\\\": \\\"NUMACell\\\", \\\"nova_object.data\\\": {\\\"cpu_usage\\\": 0, \\\"memory_usage\\\": 0, \\\"cpuset\\\": [0, 1, 2, 3, 4, 5, 6, 7, 16, 17, 18, 19, 20, 21, 22, 23], \\\"pinned_cpus\\\": [], \\\"siblings\\\": [[2, 18], [1, 17], [0, 16], [3, 19], [6, 22], [4, 20], [7, 23], [5, 21]], \\\"memory\\\": 128908, \\\"mempages\\\": [{\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 33000563, \\\"reserved\\\": 0, \\\"size_kb\\\": 4}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 2048}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 1048576}, \\\"nova_object.namespace\\\": \\\"nova\\\"}], \\\"id\\\": 0}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cpu_usage\\\", \\\"memory_usage\\\", \\\"cpuset\\\", \\\"pinned_cpus\\\", \\\"siblings\\\", \\\"memory\\\", \\\"mempages\\\", \\\"id\\\"], \\\"nova_object.name\\\": \\\"NUMACell\\\", \\\"nova_object.data\\\": {\\\"cpu_usage\\\": 0, \\\"memory_usage\\\": 0, \\\"cpuset\\\": [8, 9, 10, 11, 12, 13, 14, 15, 24, 25, 26, 27, 28, 29, 30, 31], \\\"pinned_cpus\\\": [], \\\"siblings\\\": [[8, 24], [14, 30], [15, 31], [11, 27], [10, 26], [12, 28], [9, 25], [13, 29]], \\\"memory\\\": 129021, \\\"mempages\\\": [{\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 33029464, \\\"reserved\\\": 0, \\\"size_kb\\\": 4}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 2048}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 1048576}, \\\"nova_object.namespace\\\": \\\"nova\\\"}], \\\"id\\\": 1}, \\\"nova_object.namespace\\\": \\\"nova\\\"}]}, \\\"nova_object.namespace\\\": \\\"nova\\\"}' WHERE compute_nodes.id = 63\n\nFirst one has memory_mb_used=134660, the second has  memory_mb_used=257536.\nFirst one is actual used memory by hypervisor host:\nopenstack-wn10:~# free -m\n              total        used        free      shared  buff/cache   available\nMem:         257929      134238      120187        1897        3503      120788\nSwap:             0           0           0\n\nThe second one is memory summary of running instances.\n\nSo memory_mb_used value changes over time from one value to another.", 
    "tags": [
        "nova"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1713495", 
    "owner": "None", 
    "id": 1713495, 
    "index": 7006, 
    "created": "2017-08-28 13:12:51.049125+00:00", 
    "title": "Nova reports various hypervisor resources", 
    "comments": [
        {
            "content": "Hello\nI experienced that Openstack provides two different hypervisor usage statistics (Ocata).\nI checked that some nova processes reports different cpu and ram usage to database.\nThese are queries from mysql.log which are providing different statistics:\n\n2017-08-28T11:29:19.037802Z       134 Query     UPDATE compute_nodes SET updated_at='2017-08-28 11:29:19.036118', vcpus_used=126, memory_mb_used=134660, local_gb_used=215601, disk_available_least=275518, stats='{}', numa_topology='{\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cells\\\"], \\\"nova_object.name\\\": \\\"NUMATopology\\\", \\\"nova_object.data\\\": {\\\"cells\\\": [{\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cpu_usage\\\", \\\"memory_usage\\\", \\\"cpuset\\\", \\\"mempages\\\", \\\"pinned_cpus\\\", \\\"memory\\\", \\\"siblings\\\", \\\"id\\\"], \\\"nova_object.name\\\": \\\"NUMACell\\\", \\\"nova_object.data\\\": {\\\"cpu_usage\\\": 0, \\\"memory_usage\\\": 0, \\\"cpuset\\\": [0, 1, 2, 3, 4, 5, 6, 7, 16, 17, 18, 19, 20, 21, 22, 23], \\\"pinned_cpus\\\": [], \\\"siblings\\\": [[2, 18], [1, 17], [0, 16], [19, 3], [22, 6], [20, 4], [23, 7], [5, 21]], \\\"memory\\\": 128908, \\\"mempages\\\": [{\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 33000563, \\\"reserved\\\": 0, \\\"size_kb\\\": 4}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 2048}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 1048576}, \\\"nova_object.namespace\\\": \\\"nova\\\"}], \\\"id\\\": 0}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cpu_usage\\\", \\\"memory_usage\\\", \\\"cpuset\\\", \\\"mempages\\\", \\\"pinned_cpus\\\", \\\"memory\\\", \\\"siblings\\\", \\\"id\\\"], \\\"nova_object.name\\\": \\\"NUMACell\\\", \\\"nova_object.data\\\": {\\\"cpu_usage\\\": 0, \\\"memory_usage\\\": 0, \\\"cpuset\\\": [8, 9, 10, 11, 12, 13, 14, 15, 24, 25, 26, 27, 28, 29, 30, 31], \\\"pinned_cpus\\\": [], \\\"siblings\\\": [[8, 24], [30, 14], [31, 15], [27, 11], [10, 26], [28, 12], [9, 25], [13, 29]], \\\"memory\\\": 129021, \\\"mempages\\\": [{\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 33029464, \\\"reserved\\\": 0, \\\"size_kb\\\": 4}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 2048}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"used\\\", \\\"reserved\\\", \\\"size_kb\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 1048576}, \\\"nova_object.namespace\\\": \\\"nova\\\"}], \\\"id\\\": 1}, \\\"nova_object.namespace\\\": \\\"nova\\\"}]}, \\\"nova_object.namespace\\\": \\\"nova\\\"}' WHERE compute_nodes.id = 63\n\n\n2017-08-28T11:29:20.547435Z        89 Query     UPDATE compute_nodes SET updated_at='2017-08-28 11:29:20.544879', vcpus_used=132, memory_mb_used=257536, local_gb_used=2590, stats='{\\\"num_proj_d1de178820ea48c3a1b098df3d4a4b7c\\\": \\\"2\\\", \\\"num_instances\\\": \\\"29\\\", \\\"num_proj_ada9ef29bef5486bb7f386ecd7a7cb2f\\\": \\\"1\\\", \\\"num_proj_dfd2237d06114848b77eb5cd4d5cb02a\\\": \\\"1\\\", \\\"num_proj_e8f91dabfe664223899bfeabdee8735f\\\": \\\"1\\\", \\\"num_proj_28c4118284f545a389eb20d745e3c5d9\\\": \\\"2\\\", \\\"io_workload\\\": \\\"0\\\", \\\"num_vm_active\\\": \\\"26\\\", \\\"num_proj_c673146ecf0349bbbe06a284c9fd2fc0\\\": \\\"1\\\", \\\"num_vm_stopped\\\": \\\"2\\\", \\\"num_proj_505ccb54aaa049199a402e3d8369bcca\\\": \\\"1\\\", \\\"num_proj_3f410526915f446c904d4aeadd97021e\\\": \\\"1\\\", \\\"num_proj_e37a451d77524a00b977538d3a58f53d\\\": \\\"1\\\", \\\"num_proj_110d63d719464a9384336ac6c9730330\\\": \\\"1\\\", \\\"num_proj_eb0d7cf7e0394dd082322d0dfe1753b4\\\": \\\"1\\\", \\\"num_proj_eeaf551320d647c18762f80a565d77e4\\\": \\\"1\\\", \\\"num_proj_3cdc8848793f428a8884809daa499af6\\\": \\\"1\\\", \\\"num_task_None\\\": \\\"29\\\", \\\"num_proj_b01521bb84fa45ce980f56a9bb5565c7\\\": \\\"1\\\", \\\"num_proj_7e689fc19cc448cf9b78ba594e9eb27e\\\": \\\"1\\\", \\\"num_proj_11bfa9122bf04381a1dd0c33ef1d0181\\\": \\\"1\\\", \\\"num_vm_suspended\\\": \\\"1\\\", \\\"num_proj_c225559f26e34070be29b8d1460b3eb7\\\": \\\"1\\\", \\\"num_proj_1977d8ae1cde41bc83e2b466c49a73ad\\\": \\\"1\\\", \\\"num_proj_2e5b2b05d443449789cd00368bd25545\\\": \\\"1\\\", \\\"num_proj_2cfcd2e3bf8f45cc89b4155061dd373e\\\": \\\"1\\\", \\\"num_proj_2f4fd3ca13d6441f9d7c8bd097377f1b\\\": \\\"2\\\", \\\"num_proj_be58cda2f3ca4c07b0162c9b13a41e88\\\": \\\"1\\\", \\\"num_proj_efb79b155383443d88dcc25c6008e170\\\": \\\"2\\\", \\\"num_os_type_None\\\": \\\"29\\\", \\\"num_proj_7fd4b8ef480d4e85b545b7c28996c473\\\": \\\"1\\\", \\\"num_proj_9f79e068e7d14d219c2b513cd9c6e83b\\\": \\\"1\\\"}', numa_topology='{\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cells\\\"], \\\"nova_object.name\\\": \\\"NUMATopology\\\", \\\"nova_object.data\\\": {\\\"cells\\\": [{\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cpu_usage\\\", \\\"memory_usage\\\", \\\"cpuset\\\", \\\"pinned_cpus\\\", \\\"siblings\\\", \\\"memory\\\", \\\"mempages\\\", \\\"id\\\"], \\\"nova_object.name\\\": \\\"NUMACell\\\", \\\"nova_object.data\\\": {\\\"cpu_usage\\\": 0, \\\"memory_usage\\\": 0, \\\"cpuset\\\": [0, 1, 2, 3, 4, 5, 6, 7, 16, 17, 18, 19, 20, 21, 22, 23], \\\"pinned_cpus\\\": [], \\\"siblings\\\": [[2, 18], [1, 17], [0, 16], [3, 19], [6, 22], [4, 20], [7, 23], [5, 21]], \\\"memory\\\": 128908, \\\"mempages\\\": [{\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 33000563, \\\"reserved\\\": 0, \\\"size_kb\\\": 4}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 2048}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 1048576}, \\\"nova_object.namespace\\\": \\\"nova\\\"}], \\\"id\\\": 0}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.2\\\", \\\"nova_object.changes\\\": [\\\"cpu_usage\\\", \\\"memory_usage\\\", \\\"cpuset\\\", \\\"pinned_cpus\\\", \\\"siblings\\\", \\\"memory\\\", \\\"mempages\\\", \\\"id\\\"], \\\"nova_object.name\\\": \\\"NUMACell\\\", \\\"nova_object.data\\\": {\\\"cpu_usage\\\": 0, \\\"memory_usage\\\": 0, \\\"cpuset\\\": [8, 9, 10, 11, 12, 13, 14, 15, 24, 25, 26, 27, 28, 29, 30, 31], \\\"pinned_cpus\\\": [], \\\"siblings\\\": [[8, 24], [14, 30], [15, 31], [11, 27], [10, 26], [12, 28], [9, 25], [13, 29]], \\\"memory\\\": 129021, \\\"mempages\\\": [{\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 33029464, \\\"reserved\\\": 0, \\\"size_kb\\\": 4}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 2048}, \\\"nova_object.namespace\\\": \\\"nova\\\"}, {\\\"nova_object.version\\\": \\\"1.1\\\", \\\"nova_object.changes\\\": [\\\"total\\\", \\\"reserved\\\", \\\"size_kb\\\", \\\"used\\\"], \\\"nova_object.name\\\": \\\"NUMAPagesTopology\\\", \\\"nova_object.data\\\": {\\\"used\\\": 0, \\\"total\\\": 0, \\\"reserved\\\": 0, \\\"size_kb\\\": 1048576}, \\\"nova_object.namespace\\\": \\\"nova\\\"}], \\\"id\\\": 1}, \\\"nova_object.namespace\\\": \\\"nova\\\"}]}, \\\"nova_object.namespace\\\": \\\"nova\\\"}' WHERE compute_nodes.id = 63\n\nFirst one has memory_mb_used=134660, the second has  memory_mb_used=257536.\nFirst one is actual used memory by hypervisor host:\nopenstack-wn10:~# free -m\n              total        used        free      shared  buff/cache   available\nMem:         257929      134238      120187        1897        3503      120788\nSwap:             0           0           0\n\nThe second one is memory summary of running instances.\n\nSo memory_mb_used value changes over time from one value to another.", 
            "date_created": "2017-08-28 13:12:51.049125+00:00", 
            "author": "https://api.launchpad.net/1.0/~jacolex"
        }, 
        {
            "content": "Which compute driver are you using? libvirt, hyperv, vmware, other?", 
            "date_created": "2017-08-28 14:12:40.398726+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Libvirt, but I think that update makes nova controller (nova or/and nova_api), because there are lots of updates various compute nodes by one mysql connection. In example above there are two connections (two processes) which are updating all compute nodes.", 
            "date_created": "2017-08-28 14:32:47.243465+00:00", 
            "author": "https://api.launchpad.net/1.0/~jacolex"
        }, 
        {
            "content": "Can you get the debug logs off the nova-computes to see if it is one ping ponging or if there is some conflict between 2?", 
            "date_created": "2017-08-31 14:10:00.218876+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "I enabled debug logging and there is something like this:\n\n2017-09-01 10:24:59.232 31465 DEBUG nova.compute.resource_tracker [req-28030f29-e9d5-4835-b9f3-338ae08c7694 - - - - -] Hypervisor: free VCPUs: -94 _report_hypervisor_resource_view /usr/lib/python2.7/dist-packages/nova/compute/resource_tracker.py:655\n2017-09-01 10:24:59.233 31465 DEBUG nova.compute.resource_tracker [req-28030f29-e9d5-4835-b9f3-338ae08c7694 - - - - -] Hypervisor/Node resource view: name=openstack-wn10 free_ram=122747MB free_disk=279564GB free_vcpus=-94 pci_devices=[{\"dev_id\": \"pci_0000_00_00_0\", \"product_id\": \"0e00\", \"dev_type\": \"type-PCI\", \"numa_node\": 0, \"vendor_id\": \"8086\", \"label\": \"label_8086_0e00\", \"address\": \n...\n...\n: \"0000:ff:13.5\"}, {\"dev_id\": \"pci_0000_ff_16_0\", \"product_id\": \"0ec8\", \"dev_type\": \"type-PCI\", \"numa_node\": 1, \"vendor_id\": \"8086\", \"label\": \"label_8086_0ec8\", \"address\": \"0000:ff:16.0\"}, {\"dev_id\": \"pci_0000_ff_16_1\", \"product_id\": \"0ec9\", \"dev_type\": \"type-PCI\", \"num\na_node\": 1, \"vendor_id\": \"8086\", \"label\": \"label_8086_0ec9\", \"address\": \"0000:ff:16.1\"}, {\"dev_id\": \"pci_0000_ff_16_2\", \"product_id\": \"0eca\", \"dev_type\": \"type-PCI\", \"numa_node\": 1, \"vendor_id\": \"8086\", \"label\": \"label_8086_0eca\", \"address\": \"0000:ff:16.2\"}] _report_hyp\nervisor_resource_view /usr/lib/python2.7/dist-packages/nova/compute/resource_tracker.py:672\n\nIn above log free ram is counted wrong: 122747MB\n\nThen:\n2017-09-01 10:32:08.728 31465 INFO nova.compute.resource_tracker [req-28030f29-e9d5-4835-b9f3-338ae08c7694 - - - - -] Final resource view: name=openstack-wn10 phys_ram=257929MB used_ram=257536MB phys_disk=498650GB used_disk=2590GB total_vcpus=32 used_vcpus=132 pci_stats=[]\n\nIn the same time:\n[LAB] root@openstack-ctrl:~# openstack hypervisor show openstack-wn10 | grep memory\n| memory_mb            | 257929|\n| memory_mb_used       | 135181\n\n5 minutes later:\n[LAB] root@openstack-ctrl:~# openstack hypervisor show openstack-wn10 | grep memory\n| memory_mb            | 257929                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            || memory_mb_used       | 257536\n\nActualy used ram should be 257536MB as reported by nova.compute.resource_tracker.\n# cat /var/log/nova/nova-compute.log | grep \"Final resource view\"\nalway is the same:\n2017-09-01 06:25:17.857 18058 INFO nova.compute.resource_tracker [req-63e9f2e9-6120-43f2-9b4b-80040b91483c - - - - -] Final resource view: name=openstack-wn10 phys_ram=257929MB used_ram=257536MB phys_disk=498650GB used_disk=2590GB total_vcpus=32 used_vcpus=132 pci_stats=[]\n2017-09-01 06:26:17.585 18058 INFO nova.compute.resource_tracker [req-63e9f2e9-6120-43f2-9b4b-80040b91483c - - - - -] Final resource view: name=openstack-wn10 phys_ram=257929MB used_ram=257536MB phys_disk=498650GB used_disk=2590GB total_vcpus=32 used_vcpus=132 pci_stats=[]\n2017-09-01 06:27:19.901 18058 INFO nova.compute.resource_tracker [req-63e9f2e9-6120-43f2-9b4b-80040b91483c - - - - -] Final resource view: name=openstack-wn10 phys_ram=257929MB used_ram=257536MB phys_disk=498650GB used_disk=2590GB total_vcpus=32 used_vcpus=132 pci_stats=[]\n...\n\nI checked all of compute nodes and there is no node which is reporting 135181 MB RAM.", 
            "date_created": "2017-09-01 08:58:38.626440+00:00", 
            "author": "https://api.launchpad.net/1.0/~jacolex"
        }
    ]
}