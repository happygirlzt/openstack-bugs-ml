{
    "status": "Invalid", 
    "last_updated": "2015-05-18 04:51:09.986137+00:00", 
    "description": "1. My environment:\nnova: 2014.1, icehouse-stable\nhypervisor: libvirt 1.2.1,  + kvm\n\n2. Relevant log files:\nno\n\n3. Reproduce steps:\n* Launch one instance with default flavor m1.tiny which swap size is 0MB\n* Resize instance from m1.tiny to flv_5_root_2_eph_1_swap which swap's size is 1MB,\nand get swap info with 'virsh' commands\nvirsh # domblklist 30\nvdc        /var/lib/nova/instances/fa13d27f-3ddd-48a5-86a8-aeaf04c2046d/disk.swap\nvirsh # domblkinfo 30 vdc\nCapacity:       1048576\n* Resize instance from flv_5_root_2_eph_1_swap to flv_40_root_5_eph_4_swap,\nand get swap info with 'virsh' commands\n\nExpected results:\n*virsh # domblkinfo 5 vdc\n  Capacity:       4194304\n\nActual result:\n* virsh # domblkinfo 5 vdc\nCapacity:       1048576\n\n4. Reason maybe:\nnova.virt.libvirt.driver.py\ndef _create_image(self, context, instance,\n                      disk_mapping, suffix='',\n                      disk_images=None, network_info=None,\n                      block_device_info=None, files=None,\n                      admin_pass=None, inject_files=True,\n                      fallback_from_host=None):\n...\n        if 'disk.swap' in disk_mapping:\n            mapping = disk_mapping['disk.swap']\n            swap_mb = 0\n\n            swap = driver.block_device_info_get_swap(block_device_info)\n            if driver.swap_is_usable(swap):\n                swap_mb = swap['swap_size']   # use inst_type['swap']?\n            elif (inst_type['swap'] > 0 and\n                  not block_device.volume_in_mapping(\n                    mapping['dev'], block_device_info)):\n                swap_mb = inst_type['swap']", 
    "tags": [
        "libvirt"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1447977", 
    "owner": "https://api.launchpad.net/1.0/~noelnelson", 
    "id": 1447977, 
    "index": 436, 
    "created": "2015-04-24 09:02:34.868314+00:00", 
    "title": "swap size not change after instance resized", 
    "comments": [
        {
            "content": "1. My environment:\nnova: 2014.1, icehouse-stable\nhypervisor: libvirt 1.2.1,  + kvm\n\n2. Relevant log files:\nno\n\n3. Reproduce steps:\n* Launch one instance with default flavor m1.tiny which swap size is 0MB\n* Resize instance from m1.tiny to flv_5_root_2_eph_1_swap which swap's size is 1MB,\nand get swap info with 'virsh' commands\nvirsh # domblklist 30\nvdc        /var/lib/nova/instances/fa13d27f-3ddd-48a5-86a8-aeaf04c2046d/disk.swap\nvirsh # domblkinfo 30 vdc\nCapacity:       1048576\n* Resize instance from flv_5_root_2_eph_1_swap to flv_40_root_5_eph_4_swap,\nand get swap info with 'virsh' commands\n\nExpected results:\n*virsh # domblkinfo 5 vdc\n  Capacity:       4194304\n\nActual result:\n* virsh # domblkinfo 5 vdc\nCapacity:       1048576\n\n4. Reason maybe:\nnova.virt.libvirt.driver.py\ndef _create_image(self, context, instance,\n                      disk_mapping, suffix='',\n                      disk_images=None, network_info=None,\n                      block_device_info=None, files=None,\n                      admin_pass=None, inject_files=True,\n                      fallback_from_host=None):\n...\n        if 'disk.swap' in disk_mapping:\n            mapping = disk_mapping['disk.swap']\n            swap_mb = 0\n\n            swap = driver.block_device_info_get_swap(block_device_info)\n            if driver.swap_is_usable(swap):\n                swap_mb = swap['swap_size']   # use inst_type['swap']?\n            elif (inst_type['swap'] > 0 and\n                  not block_device.volume_in_mapping(\n                    mapping['dev'], block_device_info)):\n                swap_mb = inst_type['swap']", 
            "date_created": "2015-04-24 09:02:34.868314+00:00", 
            "author": "https://api.launchpad.net/1.0/~mark-xiett"
        }, 
        {
            "content": "Eric Xie_TECS,\n\nI am not able to reproduce your bug. ( As i know you are using Ice-house version)\n\nMy Environment\nI am using Juno version of devstack. \n\nSteps I used to reproduce the bug.\n\na) Creating instance with flavor :  m1.tiny\nnova boot --image cirros-0.3.4-x86_64-uec --flavor 1 vm1\n\nb) Creating new flavor with id 8 and swap size is 1MB\nnova flavor-create --ephemeral 1 --swap 1 --rxtx-factor 1.0 --is-public True flv_5_root_2_eph_1_swap 8 1024 4 2\n\nc) Resizing instance vm1 with flavor 8 \nnova resize --poll vm1 8\n\nOutput of Virsh command for the instance vm1.\n\nvirsh # domblklist 3\nTarget     Source\n------------------------------------------------\nvda        /opt/stack/data/nova/instances/fc40d5ca-3a23-417c-9dfc-f25860822534/disk\nvdb        /opt/stack/data/nova/instances/fc40d5ca-3a23-417c-9dfc-f25860822534/disk.local\nvdc        /opt/stack/data/nova/instances/fc40d5ca-3a23-417c-9dfc-f25860822534/disk.swap\nhdd        /opt/stack/data/nova/instances/fc40d5ca-3a23-417c-9dfc-f25860822534/disk.config\n\nvirsh # domblkinfo 3 vdc\nCapacity:       1048576\nAllocation:     200704\nPhysical:       200704\n\n-----------------------------------------------------------------------------------------------------------------------------------------------------\n\nFollow the above same steps with instance vm2.\n\na) Creating instance with flavor :  m1.tiny\n nova boot --image cirros-0.3.4-x86_64-uec --flavor 1 vm2\n\nb) Creating new flavor with id 40 and swap size is 4MB\n nova flavor-create --ephemeral 1 --swap 4 --rxtx-factor 1.0 --is-public True flv_40_root_2_eph_4_swap 40 512 4 2\n\nc) Resizing instance vm1 with flavor 8 \n nova resize --poll vm2 40\n\nOutput of Virsh command for the instance vm2.\n\nvirsh # domblklist 5\nTarget     Source\n------------------------------------------------\nvda        /opt/stack/data/nova/instances/5d515c7a-cc80-46ed-b883-31919a0aceff/disk\nvdb        /opt/stack/data/nova/instances/5d515c7a-cc80-46ed-b883-31919a0aceff/disk.local\nvdc        /opt/stack/data/nova/instances/5d515c7a-cc80-46ed-b883-31919a0aceff/disk.swap\nhdd        /opt/stack/data/nova/instances/5d515c7a-cc80-46ed-b883-31919a0aceff/disk.config\n\nvirsh # domblkinfo 5 vdc\nCapacity:       4194304\nAllocation:     200704\nPhysical:       200704\n\nNova list output:\n\nstack@onecloud-Standard-PC-i440FX-PIIX-1996:~/devstack$ nova list\n+--------------------------------------+------+---------------+------------+-------------+------------------+\n| ID                                   | Name | Status        | Task State | Power State | Networks         |\n+--------------------------------------+------+---------------+------------+-------------+------------------+\n| fc40d5ca-3a23-417c-9dfc-f25860822534 | vm1  | VERIFY_RESIZE | -          | Running     | private=10.0.0.2 |\n| 5d515c7a-cc80-46ed-b883-31919a0aceff | vm2  | VERIFY_RESIZE | -          | Running     | private=10.0.0.3 |\n+--------------------------------------+------+---------------+------------+-------------+------------------+\n\nTried on resized instance twice time to resize. ( vm1 resized already)\nAfter that i used below statement again\n\nResize instance from flv_8_root_2_eph_1_swap to flv_40_root_5_eph_4_swap\n\nstack@onecloud-Standard-PC-i440FX-PIIX-1996:~/devstack$ nova resize --poll vm1 40\nERROR (Conflict): Cannot 'resize' instance fc40d5ca-3a23-417c-9dfc-f25860822534 while it is in vm_state resized (HTTP 409) (Request-ID: req-cffc15a6-c5db-474c-b3ab-305f719129e3)\n \nIt was failed for me above.\n\n\nBased on your reproducible steps i have given my try. And please correct me if i miss any step to reproduce your bug.\nBased on your feedback I can procede further.\n\nRegards\nNoel ", 
            "date_created": "2015-05-14 07:58:41.534993+00:00", 
            "author": "https://api.launchpad.net/1.0/~noelnelson"
        }, 
        {
            "content": "Hi Neol, thanks for your reproduce try. You can try it as below.\n1) create one instance with flavorA that the size of swap is 2;\n2) resize the instance above with flavorB that the size of swap is 5.\n\nThe reason of error for your resizing is that you should confirm the resize before you resize it again:)", 
            "date_created": "2015-05-15 08:30:23.313866+00:00", 
            "author": "https://api.launchpad.net/1.0/~mark-xiett"
        }, 
        {
            "content": "Eric Xie_TECS,\n\nThank you for your quick feedback. I have gone with 3 scenario's to reproduce your bug.\nLooks like in Juno it has fixed. i failed in all the scenario to reproduce.\n\nScenario 1 : Check my previous reply in bug Thread.\n\nScenario 2 : As you suggested,\n             1) create one instance with flavorA that the size of swap is 2;\n             2) resize the instance above with flavorB that the size of swap is 5.\n\nInstance created with swap size 1 ( you suggested swap size 2, i think it doesn't matter)\nvirsh # domblkinfo 5 vdc\nCapacity:       1048576\nAllocation:     200704\nPhysical:       200704\n\nAfter resizing instance with swap size 4 ( you suggested swap size 5, i think doesn't matter)\nvirsh # domblklist 6\nTarget     Source\n------------------------------------------------\nvda        /opt/stack/data/nova/instances/cff61e0e-8182-4ab6-83d2-31be58ec29fc/disk\nvdb        /opt/stack/data/nova/instances/cff61e0e-8182-4ab6-83d2-31be58ec29fc/disk.local\nvdc        /opt/stack/data/nova/instances/cff61e0e-8182-4ab6-83d2-31be58ec29fc/disk.swap\nhdd        /opt/stack/data/nova/instances/cff61e0e-8182-4ab6-83d2-31be58ec29fc/disk.config\n\nvirsh # domblkinfo 6 vdc\nCapacity:       4194304\nAllocation:     200704\nPhysical:       200704\n\n\nScenario 3:\n\nFollowed the scenario 1 only. But only one difference is \n   1) Created instance with flavor tiny and swap size 0\n   2) Resized the above instance with swap size 1\n   3) Confirmed the resize\n   4) Again resized the confirmed resized instance.\n\nIn all 3 scenario i got same output which i mentioned in scenario 2. Please do check it.\n\nBased on your feedback i will move further or make it as invalid.\n\nRegards\nNoel ", 
            "date_created": "2015-05-15 13:52:15.478816+00:00", 
            "author": "https://api.launchpad.net/1.0/~noelnelson"
        }, 
        {
            "content": "Hi Noel,\nThanks for reply.\nI checked the juno release and fount this issue has already been fixed.\nYou can  make it as invalid.", 
            "date_created": "2015-05-18 02:53:50.993526+00:00", 
            "author": "https://api.launchpad.net/1.0/~mark-xiett"
        }
    ]
}