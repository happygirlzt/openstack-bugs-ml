{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 10:54:58.267160+00:00", 
    "description": "I use Folsom releale.\nI set OpenStack with Glance.\n\nWhen I try to do a backup image of an instance, I get an error in nova-compute logs and in Glance log.\n\nI use this API request to do a backup :\ncurl -i http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda/servers/8cc97452-f176-4c8a-b670-8dd40b8f944f/action -X POST -H \"X-Auth-Project-Id: admin\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: 2cb3661781174a97864f8abe5612da2a\" -d '{\"createBackup\": {\"name\": \"Backup 1\", \"backup_type\": \"daily\", \"rotation\": 2}}'\nThe snapshot is created but the older backup are not deleted.\n\nI opened two bug, this one for Nova and another one for Glance:\nhttps://bugs.launchpad.net/glance/+bug/1065060\n\nNova-compute logs :\n\n2012-10-10 16:04:28 DEBUG nova.manager [-] Running periodic task ComputeManager._poll_unconfirmed_resizes from (pid=18795) periodic_tasks /opt/stack/nova/nova/manager.py:172\nDEBUG:nova.manager:Running periodic task ComputeManager._poll_unconfirmed_resizes\n2012-10-10 16:04:30 DEBUG nova.openstack.common.rpc.amqp [-] received {u'_context_roles': [u'admin', u'KeystoneAdmin', u'KeystoneServiceAdmin'], u'_context_request_id': u'req-e930\n892e-6788-49dc-a482-b1073adb9c1a', u'_context_quota_class': None, u'_context_project_name': u'admin', u'_context_service_catalog': [{u'endpoints': [{u'adminURL': u'http://192.168.\n146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'id': u'4fc5eca8b3044d\nb4b8e0934e995a02e3', u'publicURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda'}], u'endpoints_links': [], u'type': u'volume', u'name': u'cinder'}, {u'endpoint\ns': [{u'adminURL': u'http://192.168.146.6:9292', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:9292', u'id': u'5e9d743af281468cae10b320640f1473', u'publicURL': u\n'http://192.168.146.6:9292'}], u'endpoints_links': [], u'type': u'image', u'name': u'glance'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6\na4fcf0eda', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'id': u'bf7028de9c1448ad9d6f2991a8512d03', u'publicURL': u'\nhttp://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda'}], u'endpoints_links': [], u'type': u'compute', u'name': u'nova'}, {u'endpoints': [{u'adminURL': u'http://192.168.14\n6.6:8773/services/Admin', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8773/services/Cloud', u'id': u'5a2ca0bde45e44b787d2ecd59b8d0bd3', u'publicURL': u'http://\n192.168.146.6:8773/services/Cloud'}], u'endpoints_links': [], u'type': u'ec2', u'name': u'ec2'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:35357/v2.0', u'region': u'Reg\nionOne', u'internalURL': u'http://192.168.146.6:5000/v2.0', u'id': u'cbcd12b6a016456585d93bbd88643780', u'publicURL': u'http://192.168.146.6:5000/v2.0'}], u'endpoints_links': [],\nu'type': u'identity', u'name': u'keystone'}], u'_context_user_name': u'admin', u'_context_auth_token': '<SANITIZED>', u'args': {u'image_type': u'backup', u'instance': {u'vm_state'\n: u'active', u'availability_zone': None, u'terminated_at': None, u'ephemeral_gb': 0, u'instance_type_id': 2, u'user_data': None, u'vm_mode': None, u'deleted_at': None, u'reservati\non_id': u'r-9sxd7oy1', u'id': 4, u'security_groups': [{u'deleted_at': None, u'user_id': u'0729338e3e4e473496778822e78c8fd3', u'name': u'default', u'deleted': False, u'created_at':\n\u00a0u'2012-10-08T15:26:00.000000', u'updated_at': None, u'rules': [{u'from_port': 22, u'protocol': u'tcp', u'group_id': None, u'deleted': False, u'created_at': u'2012-10-08T15:27:29.\n000000', u'updated_at': None, u'to_port': 22, u'parent_group_id': 1, u'cidr': u'0.0.0.0/0', u'deleted_at': None, u'id': 1}], u'project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'\nid': 1, u'description': u'default'}], u'disable_terminate': False, u'user_id': u'0729338e3e4e473496778822e78c8fd3', u'uuid': u'8cc97452-f176-4c8a-b670-8dd40b8f944f', u'server_name\n': None, u'default_swap_device': None, u'info_cache': {u'instance_uuid': u'8cc97452-f176-4c8a-b670-8dd40b8f944f', u'deleted': False, u'created_at': u'2012-10-10T13:28:56.000000',\nu'updated_at': u'2012-10-10T13:30:01.000000', u'network_info': u'[{\"network\": {\"bridge\": \"br1000\", \"subnets\": [{\"ips\": [{\"meta\": {}, \"version\": 4, \"type\": \"fixed\", \"floating_ips\":\n\u00a0[{\"meta\": {}, \"version\": 4, \"type\": \"floating\", \"address\": \"192.168.146.48\"}], \"address\": \"172.16.0.3\"}], \"version\": 4, \"meta\": {\"dhcp_server\": \"172.16.0.4\"}, \"dns\": [], \"routes\"\n: [], \"cidr\": \"172.16.0.0/24\", \"gateway\": {\"meta\": {}, \"version\": 4, \"type\": \"gateway\", \"address\": \"172.16.0.1\"}}, {\"ips\": [], \"version\": null, \"meta\": {\"dhcp_server\": \"172.16.0.4\n\"}, \"dns\": [], \"routes\": [], \"cidr\": null, \"gateway\": {\"meta\": {}, \"version\": null, \"type\": \"gateway\", \"address\": null}}], \"meta\": {\"multi_host\": true, \"should_create_bridge\": tru\ne, \"bridge_interface\": \"eth1\", \"tenant_id\": \"83a649b306f64942a3068f6a4fcf0eda\", \"vlan\": 1000, \"should_create_vlan\": true}, \"id\": \"a581fcfb-5248-447d-8205-b7ecd86ac0de\", \"label\": \"\nprivate_0\"}, \"meta\": {}, \"id\": \"77fc30cf-4034-4c83-ad75-01ae226cdd85\", \"address\": \"fa:16:3e:79:5d:40\"}]', u'deleted_at': None, u'id': 4}, u'hostname': u'test', u'launched_on': u'g\nargamel', u'display_description': u'test', u'key_data': u'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgQDM3n/MyErlJ6rK6EulDx3/2/WzzN8184uz73tSmVZieoLCjSknSglbPJs1PmN8UFjPCArJ72so687OSAvRN\ngq40qLzthisDzVFR42Se6RVwpJzM5Xmc5iGRrDg1kdVQCkcmFtKXrLFTTUBIUvN8GoajE79QOSaM17vFHbwN2o6Dw== Generated by Nova\\n', u'kernel_id': u'2fbe9821-366e-4cd6-bb64-c917238bcc9f', u'power_st\nate': 1, u'default_ephemeral_device': None, u'progress': 0, u'project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'launched_at': u'2012-10-10T13:29:16.000000', u'scheduled_at': u'2\n012-10-10T13:28:56.000000', u'ramdisk_id': u'18312c9e-d1ea-4927-be5f-9d4e65bf0f29', u'access_ip_v6': None, u'access_ip_v4': None, u'deleted': False, u'key_name': u'test', u'update\nd_at': u'2012-10-10T13:57:28.000000', u'host': u'gargamel', u'display_name': u'test', u'task_state': None, u'shutdown_terminate': False, u'architecture': None, u'root_gb': 0, u'lo\ncked': False, u'name': u'instance-00000004', u'created_at': u'2012-10-10T13:28:56.000000', u'launch_index': 0, u'metadata': [], u'memory_mb': 512, u'instance_type': {u'disabled':\nFalse, u'root_gb': 0, u'deleted_at': None, u'name': u'm1.tiny', u'deleted': False, u'created_at': None, u'ephemeral_gb': 0, u'updated_at': None, u'memory_mb': 512, u'vcpus': 1, u'\nswap': 0, u'rxtx_factor': 1.0, u'is_public': True, u'flavorid': u'1', u'vcpu_weight': None, u'id': 2}, u'vcpus': 1, u'image_ref': u'd62a18f6-5279-4087-a689-dccedfa15fca', u'root_d\nevice_name': u'/dev/vda', u'auto_disk_config': None, u'os_type': None, u'config_drive': u''}, u'backup_type': u'daily', u'rotation': 2, u'image_id': u'3d4c6bb8-ff93-4cbb-8828-7cd5\n9c6bc8c1'}, u'_context_instance_lock_checked': False, u'_context_is_admin': True, u'version': u'2.0', u'_context_project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'_context_times\ntamp': u'2012-10-10T14:04:29.893069', u'_context_read_deleted': u'no', u'_context_user_id': u'0729338e3e4e473496778822e78c8fd3', u'method': u'snapshot_instance', u'_context_remote\n_address': u'192.168.146.6'} from (pid=18795) _safe_log /opt/stack/nova/nova/openstack/common/rpc/common.py:195\nDEBUG:nova.openstack.common.rpc.amqp:received {u'_context_roles': [u'admin', u'KeystoneAdmin', u'KeystoneServiceAdmin'], u'_context_request_id': u'req-e930892e-6788-49dc-a482-b107\n3adb9c1a', u'_context_quota_class': None, u'_context_project_name': u'admin', u'_context_service_catalog': [{u'endpoints': [{u'adminURL': u'http://192.168.146.6:8776/v1/83a649b306\nf64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'id': u'4fc5eca8b3044db4b8e0934e995a02e3', u'p\nublicURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda'}], u'endpoints_links': [], u'type': u'volume', u'name': u'cinder'}, {u'endpoints': [{u'adminURL': u'htt\np://192.168.146.6:9292', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:9292', u'id': u'5e9d743af281468cae10b320640f1473', u'publicURL': u'http://192.168.146.6:92\n92'}], u'endpoints_links': [], u'type': u'image', u'name': u'glance'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'region': u\n'RegionOne', u'internalURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'id': u'bf7028de9c1448ad9d6f2991a8512d03', u'publicURL': u'http://192.168.146.6:877\n4/v2/83a649b306f64942a3068f6a4fcf0eda'}], u'endpoints_links': [], u'type': u'compute', u'name': u'nova'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:8773/services/Admin'\n, u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8773/services/Cloud', u'id': u'5a2ca0bde45e44b787d2ecd59b8d0bd3', u'publicURL': u'http://192.168.146.6:8773/servi\nces/Cloud'}], u'endpoints_links': [], u'type': u'ec2', u'name': u'ec2'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:35357/v2.0', u'region': u'RegionOne', u'internalURL':\n\u00a0u'http://192.168.146.6:5000/v2.0', u'id': u'cbcd12b6a016456585d93bbd88643780', u'publicURL': u'http://192.168.146.6:5000/v2.0'}], u'endpoints_links': [], u'type': u'identity', u'\nname': u'keystone'}], u'_context_user_name': u'admin', u'_context_auth_token': '<SANITIZED>', u'args': {u'image_type': u'backup', u'instance': {u'vm_state': u'active', u'availabil\nity_zone': None, u'terminated_at': None, u'ephemeral_gb': 0, u'instance_type_id': 2, u'user_data': None, u'vm_mode': None, u'deleted_at': None, u'reservation_id': u'r-9sxd7oy1', u\n'id': 4, u'security_groups': [{u'deleted_at': None, u'user_id': u'0729338e3e4e473496778822e78c8fd3', u'name': u'default', u'deleted': False, u'created_at': u'2012-10-08T15:26:00.0\n00000', u'updated_at': None, u'rules': [{u'from_port': 22, u'protocol': u'tcp', u'group_id': None, u'deleted': False, u'created_at': u'2012-10-08T15:27:29.000000', u'updated_at': None, u'to_port': 22, u'parent_group_id': 1, u'cidr': u'0.0.0.0/0', u'deleted_at': None, u'id': 1}], u'project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'id': 1, u'description': u'default'}], u'disable_terminate': False, u'user_id': u'0729338e3e4e473496778822e78c8fd3', u'uuid': u'8cc97452-f176-4c8a-b670-8dd40b8f944f', u'server_name': None, u'default_swap_device': None, u'info_cache': {u'instance_uuid': u'8cc97452-f176-4c8a-b670-8dd40b8f944f', u'deleted': False, u'created_at': u'2012-10-10T13:28:56.000000', u'updated_at': u'2012-10-10T13:30:01.000000', u'network_info': u'[{\"network\": {\"bridge\": \"br1000\", \"subnets\": [{\"ips\": [{\"meta\": {}, \"version\": 4, \"type\": \"fixed\", \"floating_ips\": [{\"meta\": {}, \"version\": 4, \"type\": \"floating\", \"address\": \"192.168.146.48\"}], \"address\": \"172.16.0.3\"}], \"version\": 4, \"meta\": {\"dhcp_server\": \"172.16.0.4\"}, \"dns\": [], \"routes\": [], \"cidr\": \"172.16.0.0/24\", \"gateway\": {\"meta\": {}, \"version\": 4, \"type\": \"gateway\", \"address\": \"172.16.0.1\"}}, {\"ips\": [], \"version\": null, \"meta\": {\"dhcp_server\": \"172.16.0.4\"}, \"dns\": [], \"routes\": [], \"cidr\": null, \"gateway\": {\"meta\": {}, \"version\": null, \"type\": \"gateway\", \"address\": null}}], \"meta\": {\"multi_host\": true, \"should_create_bridge\": true, \"bridge_interface\": \"eth1\", \"tenant_id\": \"83a649b306f64942a3068f6a4fcf0eda\", \"vlan\": 1000, \"should_create_vlan\": true}, \"id\": \"a581fcfb-5248-447d-8205-b7ecd86ac0de\", \"label\": \"private_0\"}, \"meta\": {}, \"id\": \"77fc30cf-4034-4c83-ad75-01ae226cdd85\", \"address\": \"fa:16:3e:79:5d:40\"}]', u'deleted_at': None, u'id': 4}, u'hostname': u'test', u'launched_on': u'gargamel', u'display_description': u'test', u'key_data': u'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgQDM3n/MyErlJ6rK6EulDx3/2/WzzN8184uz73tSmVZieoLCjSknSglbPJs1PmN8UFjPCArJ72so687OSAvRNgq40qLzthisDzVFR42Se6RVwpJzM5Xmc5iGRrDg1kdVQCkcmFtKXrLFTTUBIUvN8GoajE79QOSaM17vFHbwN2o6Dw== Generated by Nova\\n', u'kernel_id': u'2fbe9821-366e-4cd6-bb64-c917238bcc9f', u'power_state': 1, u'default_ephemeral_device': None, u'progress': 0, u'project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'launched_at': u'2012-10-10T13:29:16.000000', u'scheduled_at': u'2012-10-10T13:28:56.000000', u'ramdisk_id': u'18312c9e-d1ea-4927-be5f-9d4e65bf0f29', u'access_ip_v6': None, u'access_ip_v4': None, u'deleted': False, u'key_name': u'test', u'updated_at': u'2012-10-10T13:57:28.000000', u'host': u'gargamel', u'display_name': u'test', u'task_state': None, u'shutdown_terminate': False, u'architecture': None, u'root_gb': 0, u'locked': False, u'name': u'instance-00000004', u'created_at': u'2012-10-10T13:28:56.000000', u'launch_index': 0, u'metadata': [], u'memory_mb': 512, u'instance_type': {u'disabled': False, u'root_gb': 0, u'deleted_at': None, u'name': u'm1.tiny', u'deleted': False, u'created_at': None, u'ephemeral_gb': 0, u'updated_at': None, u'memory_mb': 512, u'vcpus': 1, u'swap': 0, u'rxtx_factor': 1.0, u'is_public': True, u'flavorid': u'1', u'vcpu_weight': None, u'id': 2}, u'vcpus': 1, u'image_ref': u'd62a18f6-5279-4087-a689-dccedfa15fca', u'root_device_name': u'/dev/vda', u'auto_disk_config': None, u'os_type': None, u'config_drive': u''}, u'backup_type': u'daily', u'rotation': 2, u'image_id': u'3d4c6bb8-ff93-4cbb-8828-7cd59c6bc8c1'}, u'_context_instance_lock_checked': False, u'_context_is_admin': True, u'version': u'2.0', u'_context_project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'_context_timestamp': u'2012-10-10T14:04:29.893069', u'_context_read_deleted': u'no', u'_context_user_id': u'0729338e3e4e473496778822e78c8fd3', u'method': u'snapshot_instance', u'_context_remote_address': u'192.168.146.6'}\n2012-10-10 16:04:30 DEBUG nova.openstack.common.rpc.amqp [-] unpacked context: {'project_name': u'admin', 'user_id': u'0729338e3e4e473496778822e78c8fd3', 'roles': [u'admin', u'KeystoneAdmin', u'KeystoneServiceAdmin'], 'timestamp': u'2012-10-10T14:04:29.893069', 'auth_token': '<SANITIZED>', 'remote_address': u'192.168.146.6', 'quota_class': None, 'is_admin': True, 'service_catalog': [{u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'internalURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'id': u'4fc5eca8b3044db4b8e0934e995a02e3'}], u'type': u'volume', u'name': u'cinder'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:9292', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:9292', u'internalURL': u'http://192.168.146.6:9292', u'id': u'5e9d743af281468cae10b320640f1473'}], u'type': u'image', u'name': u'glance'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'internalURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'id': u'bf7028de9c1448ad9d6f2991a8512d03'}], u'type': u'compute', u'name': u'nova'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8773/services/Admin', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8773/services/Cloud', u'internalURL': u'http://192.168.146.6:8773/services/Cloud', u'id': u'5a2ca0bde45e44b787d2ecd59b8d0bd3'}], u'type': u'ec2', u'name': u'ec2'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:35357/v2.0', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:5000/v2.0', u'internalURL': u'http://192.168.146.6:5000/v2.0', u'id': u'cbcd12b6a016456585d93bbd88643780'}], u'type': u'identity', u'name': u'keystone'}], 'request_id': u'req-e930892e-6788-49dc-a482-b1073adb9c1a', 'instance_lock_checked': False, 'project_id': u'83a649b306f64942a3068f6a4fcf0eda', 'user_name': u'admin', 'read_deleted': u'no'} from (pid=18795) _safe_log /opt/stack/nova/nova/openstack/common/rpc/common.py:195\nDEBUG:nova.openstack.common.rpc.amqp:unpacked context: {'project_name': u'admin', 'user_id': u'0729338e3e4e473496778822e78c8fd3', 'roles': [u'admin', u'KeystoneAdmin', u'KeystoneS\nerviceAdmin'], 'timestamp': u'2012-10-10T14:04:29.893069', 'auth_token': '<SANITIZED>', 'remote_address': u'192.168.146.6', 'quota_class': None, 'is_admin': True, 'service_catalog\n': [{u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'publicURL': u'http://192.168\n.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'internalURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'id': u'4fc5eca8b3044db4b8e0934e995a02e3'}], u\n'type': u'volume', u'name': u'cinder'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:9292', u'region': u'RegionOne', u'publicURL': u'http://192.168\n.146.6:9292', u'internalURL': u'http://192.168.146.6:9292', u'id': u'5e9d743af281468cae10b320640f1473'}], u'type': u'image', u'name': u'glance'}, {u'endpoints_links': [], u'endpoi\nnts': [{u'adminURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f\n6a4fcf0eda', u'internalURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'id': u'bf7028de9c1448ad9d6f2991a8512d03'}], u'type': u'compute', u'name': u'nova'}\n, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8773/services/Admin', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8773/services/Cl\noud', u'internalURL': u'http://192.168.146.6:8773/services/Cloud', u'id': u'5a2ca0bde45e44b787d2ecd59b8d0bd3'}], u'type': u'ec2', u'name': u'ec2'}, {u'endpoints_links': [], u'endp\noints': [{u'adminURL': u'http://192.168.146.6:35357/v2.0', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:5000/v2.0', u'internalURL': u'http://192.168.146.6:5000/v2\n.0', u'id': u'cbcd12b6a016456585d93bbd88643780'}], u'type': u'identity', u'name': u'keystone'}], 'request_id': u'req-e930892e-6788-49dc-a482-b1073adb9c1a', 'instance_lock_checked'\n: False, 'project_id': u'83a649b306f64942a3068f6a4fcf0eda', 'user_name': u'admin', 'read_deleted': u'no'}\n2012-10-10 16:04:30 DEBUG nova.compute.manager [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] [instance: 8cc97452-f176-4c8a-b670-8dd40b8f944f] Checking state from (pid=187\n95) _get_power_state /opt/stack/nova/nova/compute/manager.py:334\nDEBUG:nova.compute.manager:Checking state\n2012-10-10 16:04:31 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Got semaphore \"compute_resources\" for method \"update_usage\"... from (pid=18795) inner /\nopt/stack/nova/nova/utils.py:713\nDEBUG:nova.utils:Got semaphore \"compute_resources\" for method \"update_usage\"...\n2012-10-10 16:04:31 AUDIT nova.compute.manager [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] [instance: 8cc97452-f176-4c8a-b670-8dd40b8f944f] instance snapshotting\nAUDIT:nova.compute.manager:instance snapshotting\n2012-10-10 16:04:38 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf qemu-img snapshot\n-c ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance-00000004/disk from (pid=18795) execute /opt/stack/nova/nova/utils.py:176\nDEBUG:nova.utils:Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf qemu-img snapshot -c ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance\n-00000004/disk\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Result was 0 from (pid=18795) execute /opt/stack/nova/nova/utils.py:191\nDEBUG:nova.utils:Result was 0\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Running cmd (subprocess): qemu-img convert -f qcow2 -O raw -s ce34e05276dc4634aca95f9b9\na029f1b /opt/stack/data/nova/instances/instance-00000004/disk /opt/stack/data/nova/instances/snapshots/tmpY7BbQt/ce34e05276dc4634aca95f9b9a029f1b from (pid=18795) execute /opt/sta\nck/nova/nova/utils.py:176\nDEBUG:nova.utils:Running cmd (subprocess): qemu-img convert -f qcow2 -O raw -s ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance-00000004/disk /opt/stack/da\nta/nova/instances/snapshots/tmpY7BbQt/ce34e05276dc4634aca95f9b9a029f1b\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Result was 0 from (pid=18795) execute /opt/stack/nova/nova/utils.py:191\nDEBUG:nova.utils:Result was 0\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf qemu-img snapshot\n-d ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance-00000004/disk from (pid=18795) execute /opt/stack/nova/nova/utils.py:176\nDEBUG:nova.utils:Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf qemu-img snapshot -d ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance\n-00000004/disk\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Result was 0 from (pid=18795) execute /opt/stack/nova/nova/utils.py:191\nDEBUG:nova.utils:Result was 0\n2012-10-10 16:04:45 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf tee /sys/class/net\n/vnet0/brport/hairpin_mode from (pid=18795) execute /opt/stack/nova/nova/utils.py:176\nDEBUG:nova.utils:Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf tee /sys/class/net/vnet0/brport/hairpin_mode\n2012-10-10 16:04:45 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Result was 0 from (pid=18795) execute /opt/stack/nova/nova/utils.py:191\nDEBUG:nova.utils:Result was 0\n2012-10-10 16:04:46 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Got semaphore \"compute_resources\" for method \"update_usage\"... from (pid=18795) inner /\nopt/stack/nova/nova/utils.py:713\nDEBUG:nova.utils:Got semaphore \"compute_resources\" for method \"update_usage\"...\nERROR:glanceclient.common.http:Request returned failure status.\nERROR:root:Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 196, in decorated_function\\n    retur\nn function(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 1218, in _rotate_backups\\n    images = fetch_images()\\n', '  File \"/opt/stac\nk/nova/nova/compute/manager.py\", line 1206, in fetch_images\\n    marker=marker, sort_key=\\'created_at\\', sort_dir=\\'desc\\')\\n', '  File \"/opt/stack/nova/nova/image/glance.py\", lin\ne 169, in detail\\n    for image in images:\\n', '  File \"/opt/stack/python-glanceclient/glanceclient/v1/images.py\", line 130, in paginate\\n    images = self._list(url, \"images\")\\n', '  File \"/opt/stack/python-glanceclient/glanceclient/common/base.py\", line 53, in _list\\n    resp, body = self.api.json_request(\\'GET\\', url)\\n', '  File \"/opt/stack/python-glanceclient/glanceclient/common/http.py\", line 187, in json_request\\n    resp, body_iter = self._http_request(url, method, **kwargs)\\n', '  File \"/opt/stack/python-glanceclient/glanceclient/common/http.py\", line 171, in _http_request\\n    raise exc.from_response(resp)\\n', 'HTTPBadRequest: HTTPBadRequest (HTTP 400)\\n']\n2012-10-10 16:04:47 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Got semaphore \"compute_resources\" for method \"update_usage\"... from (pid=18795) inner /opt/stack/nova/nova/utils.py:713\nDEBUG:nova.utils:Got semaphore \"compute_resources\" for method \"update_usage\"...\n2012-10-10 16:04:47 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 181, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     pass\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 167, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 196, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1178, in snapshot_instance\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self._rotate_backups(context, instance, backup_type, rotation)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp KeyError: 'instance'\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp\nERROR:nova.openstack.common.rpc.amqp:Exception during message handling\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 181, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     pass\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 167, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 196, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1178, in snapshot_instance\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self._rotate_backups(context, instance, backup_type, rotation)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp KeyError: 'instance'\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [
        "verification-needed"
    ], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1065053", 
    "owner": "https://api.launchpad.net/1.0/~ethuleau", 
    "id": 1065053, 
    "index": 3095, 
    "created": "2012-10-10 14:07:52.588097+00:00", 
    "title": "Nova backup image fails", 
    "comments": [
        {
            "content": "I use Folsom releale.\nI set OpenStack with Glance.\n\nWhen I try to do a backup image of an instance, I get an error in nova-compute logs and in Glance log.\nI opened two bug, this one for Nova and another one for Glance\n\nNova-compute logs :\n\n2012-10-10 16:04:28 DEBUG nova.manager [-] Running periodic task ComputeManager._poll_unconfirmed_resizes from (pid=18795) periodic_tasks /opt/stack/nova/nova/manager.py:172\nDEBUG:nova.manager:Running periodic task ComputeManager._poll_unconfirmed_resizes\n2012-10-10 16:04:30 DEBUG nova.openstack.common.rpc.amqp [-] received {u'_context_roles': [u'admin', u'KeystoneAdmin', u'KeystoneServiceAdmin'], u'_context_request_id': u'req-e930\n892e-6788-49dc-a482-b1073adb9c1a', u'_context_quota_class': None, u'_context_project_name': u'admin', u'_context_service_catalog': [{u'endpoints': [{u'adminURL': u'http://192.168.\n146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'id': u'4fc5eca8b3044d\nb4b8e0934e995a02e3', u'publicURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda'}], u'endpoints_links': [], u'type': u'volume', u'name': u'cinder'}, {u'endpoint\ns': [{u'adminURL': u'http://192.168.146.6:9292', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:9292', u'id': u'5e9d743af281468cae10b320640f1473', u'publicURL': u\n'http://192.168.146.6:9292'}], u'endpoints_links': [], u'type': u'image', u'name': u'glance'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6\na4fcf0eda', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'id': u'bf7028de9c1448ad9d6f2991a8512d03', u'publicURL': u'\nhttp://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda'}], u'endpoints_links': [], u'type': u'compute', u'name': u'nova'}, {u'endpoints': [{u'adminURL': u'http://192.168.14\n6.6:8773/services/Admin', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8773/services/Cloud', u'id': u'5a2ca0bde45e44b787d2ecd59b8d0bd3', u'publicURL': u'http://\n192.168.146.6:8773/services/Cloud'}], u'endpoints_links': [], u'type': u'ec2', u'name': u'ec2'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:35357/v2.0', u'region': u'Reg\nionOne', u'internalURL': u'http://192.168.146.6:5000/v2.0', u'id': u'cbcd12b6a016456585d93bbd88643780', u'publicURL': u'http://192.168.146.6:5000/v2.0'}], u'endpoints_links': [], \nu'type': u'identity', u'name': u'keystone'}], u'_context_user_name': u'admin', u'_context_auth_token': '<SANITIZED>', u'args': {u'image_type': u'backup', u'instance': {u'vm_state'\n: u'active', u'availability_zone': None, u'terminated_at': None, u'ephemeral_gb': 0, u'instance_type_id': 2, u'user_data': None, u'vm_mode': None, u'deleted_at': None, u'reservati\non_id': u'r-9sxd7oy1', u'id': 4, u'security_groups': [{u'deleted_at': None, u'user_id': u'0729338e3e4e473496778822e78c8fd3', u'name': u'default', u'deleted': False, u'created_at':\n u'2012-10-08T15:26:00.000000', u'updated_at': None, u'rules': [{u'from_port': 22, u'protocol': u'tcp', u'group_id': None, u'deleted': False, u'created_at': u'2012-10-08T15:27:29.\n000000', u'updated_at': None, u'to_port': 22, u'parent_group_id': 1, u'cidr': u'0.0.0.0/0', u'deleted_at': None, u'id': 1}], u'project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'\nid': 1, u'description': u'default'}], u'disable_terminate': False, u'user_id': u'0729338e3e4e473496778822e78c8fd3', u'uuid': u'8cc97452-f176-4c8a-b670-8dd40b8f944f', u'server_name\n': None, u'default_swap_device': None, u'info_cache': {u'instance_uuid': u'8cc97452-f176-4c8a-b670-8dd40b8f944f', u'deleted': False, u'created_at': u'2012-10-10T13:28:56.000000', \nu'updated_at': u'2012-10-10T13:30:01.000000', u'network_info': u'[{\"network\": {\"bridge\": \"br1000\", \"subnets\": [{\"ips\": [{\"meta\": {}, \"version\": 4, \"type\": \"fixed\", \"floating_ips\":\n [{\"meta\": {}, \"version\": 4, \"type\": \"floating\", \"address\": \"192.168.146.48\"}], \"address\": \"172.16.0.3\"}], \"version\": 4, \"meta\": {\"dhcp_server\": \"172.16.0.4\"}, \"dns\": [], \"routes\"\n: [], \"cidr\": \"172.16.0.0/24\", \"gateway\": {\"meta\": {}, \"version\": 4, \"type\": \"gateway\", \"address\": \"172.16.0.1\"}}, {\"ips\": [], \"version\": null, \"meta\": {\"dhcp_server\": \"172.16.0.4\n\"}, \"dns\": [], \"routes\": [], \"cidr\": null, \"gateway\": {\"meta\": {}, \"version\": null, \"type\": \"gateway\", \"address\": null}}], \"meta\": {\"multi_host\": true, \"should_create_bridge\": tru\ne, \"bridge_interface\": \"eth1\", \"tenant_id\": \"83a649b306f64942a3068f6a4fcf0eda\", \"vlan\": 1000, \"should_create_vlan\": true}, \"id\": \"a581fcfb-5248-447d-8205-b7ecd86ac0de\", \"label\": \"\nprivate_0\"}, \"meta\": {}, \"id\": \"77fc30cf-4034-4c83-ad75-01ae226cdd85\", \"address\": \"fa:16:3e:79:5d:40\"}]', u'deleted_at': None, u'id': 4}, u'hostname': u'test', u'launched_on': u'g\nargamel', u'display_description': u'test', u'key_data': u'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgQDM3n/MyErlJ6rK6EulDx3/2/WzzN8184uz73tSmVZieoLCjSknSglbPJs1PmN8UFjPCArJ72so687OSAvRN\ngq40qLzthisDzVFR42Se6RVwpJzM5Xmc5iGRrDg1kdVQCkcmFtKXrLFTTUBIUvN8GoajE79QOSaM17vFHbwN2o6Dw== Generated by Nova\\n', u'kernel_id': u'2fbe9821-366e-4cd6-bb64-c917238bcc9f', u'power_st\nate': 1, u'default_ephemeral_device': None, u'progress': 0, u'project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'launched_at': u'2012-10-10T13:29:16.000000', u'scheduled_at': u'2\n012-10-10T13:28:56.000000', u'ramdisk_id': u'18312c9e-d1ea-4927-be5f-9d4e65bf0f29', u'access_ip_v6': None, u'access_ip_v4': None, u'deleted': False, u'key_name': u'test', u'update\nd_at': u'2012-10-10T13:57:28.000000', u'host': u'gargamel', u'display_name': u'test', u'task_state': None, u'shutdown_terminate': False, u'architecture': None, u'root_gb': 0, u'lo\ncked': False, u'name': u'instance-00000004', u'created_at': u'2012-10-10T13:28:56.000000', u'launch_index': 0, u'metadata': [], u'memory_mb': 512, u'instance_type': {u'disabled': \nFalse, u'root_gb': 0, u'deleted_at': None, u'name': u'm1.tiny', u'deleted': False, u'created_at': None, u'ephemeral_gb': 0, u'updated_at': None, u'memory_mb': 512, u'vcpus': 1, u'\nswap': 0, u'rxtx_factor': 1.0, u'is_public': True, u'flavorid': u'1', u'vcpu_weight': None, u'id': 2}, u'vcpus': 1, u'image_ref': u'd62a18f6-5279-4087-a689-dccedfa15fca', u'root_d\nevice_name': u'/dev/vda', u'auto_disk_config': None, u'os_type': None, u'config_drive': u''}, u'backup_type': u'daily', u'rotation': 2, u'image_id': u'3d4c6bb8-ff93-4cbb-8828-7cd5\n9c6bc8c1'}, u'_context_instance_lock_checked': False, u'_context_is_admin': True, u'version': u'2.0', u'_context_project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'_context_times\ntamp': u'2012-10-10T14:04:29.893069', u'_context_read_deleted': u'no', u'_context_user_id': u'0729338e3e4e473496778822e78c8fd3', u'method': u'snapshot_instance', u'_context_remote\n_address': u'192.168.146.6'} from (pid=18795) _safe_log /opt/stack/nova/nova/openstack/common/rpc/common.py:195\nDEBUG:nova.openstack.common.rpc.amqp:received {u'_context_roles': [u'admin', u'KeystoneAdmin', u'KeystoneServiceAdmin'], u'_context_request_id': u'req-e930892e-6788-49dc-a482-b107\n3adb9c1a', u'_context_quota_class': None, u'_context_project_name': u'admin', u'_context_service_catalog': [{u'endpoints': [{u'adminURL': u'http://192.168.146.6:8776/v1/83a649b306\nf64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'id': u'4fc5eca8b3044db4b8e0934e995a02e3', u'p\nublicURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda'}], u'endpoints_links': [], u'type': u'volume', u'name': u'cinder'}, {u'endpoints': [{u'adminURL': u'htt\np://192.168.146.6:9292', u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:9292', u'id': u'5e9d743af281468cae10b320640f1473', u'publicURL': u'http://192.168.146.6:92\n92'}], u'endpoints_links': [], u'type': u'image', u'name': u'glance'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'region': u\n'RegionOne', u'internalURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'id': u'bf7028de9c1448ad9d6f2991a8512d03', u'publicURL': u'http://192.168.146.6:877\n4/v2/83a649b306f64942a3068f6a4fcf0eda'}], u'endpoints_links': [], u'type': u'compute', u'name': u'nova'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:8773/services/Admin'\n, u'region': u'RegionOne', u'internalURL': u'http://192.168.146.6:8773/services/Cloud', u'id': u'5a2ca0bde45e44b787d2ecd59b8d0bd3', u'publicURL': u'http://192.168.146.6:8773/servi\nces/Cloud'}], u'endpoints_links': [], u'type': u'ec2', u'name': u'ec2'}, {u'endpoints': [{u'adminURL': u'http://192.168.146.6:35357/v2.0', u'region': u'RegionOne', u'internalURL':\n u'http://192.168.146.6:5000/v2.0', u'id': u'cbcd12b6a016456585d93bbd88643780', u'publicURL': u'http://192.168.146.6:5000/v2.0'}], u'endpoints_links': [], u'type': u'identity', u'\nname': u'keystone'}], u'_context_user_name': u'admin', u'_context_auth_token': '<SANITIZED>', u'args': {u'image_type': u'backup', u'instance': {u'vm_state': u'active', u'availabil\nity_zone': None, u'terminated_at': None, u'ephemeral_gb': 0, u'instance_type_id': 2, u'user_data': None, u'vm_mode': None, u'deleted_at': None, u'reservation_id': u'r-9sxd7oy1', u\n'id': 4, u'security_groups': [{u'deleted_at': None, u'user_id': u'0729338e3e4e473496778822e78c8fd3', u'name': u'default', u'deleted': False, u'created_at': u'2012-10-08T15:26:00.0\n00000', u'updated_at': None, u'rules': [{u'from_port': 22, u'protocol': u'tcp', u'group_id': None, u'deleted': False, u'created_at': u'2012-10-08T15:27:29.000000', u'updated_at': None, u'to_port': 22, u'parent_group_id': 1, u'cidr': u'0.0.0.0/0', u'deleted_at': None, u'id': 1}], u'project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'id': 1, u'description': u'default'}], u'disable_terminate': False, u'user_id': u'0729338e3e4e473496778822e78c8fd3', u'uuid': u'8cc97452-f176-4c8a-b670-8dd40b8f944f', u'server_name': None, u'default_swap_device': None, u'info_cache': {u'instance_uuid': u'8cc97452-f176-4c8a-b670-8dd40b8f944f', u'deleted': False, u'created_at': u'2012-10-10T13:28:56.000000', u'updated_at': u'2012-10-10T13:30:01.000000', u'network_info': u'[{\"network\": {\"bridge\": \"br1000\", \"subnets\": [{\"ips\": [{\"meta\": {}, \"version\": 4, \"type\": \"fixed\", \"floating_ips\": [{\"meta\": {}, \"version\": 4, \"type\": \"floating\", \"address\": \"192.168.146.48\"}], \"address\": \"172.16.0.3\"}], \"version\": 4, \"meta\": {\"dhcp_server\": \"172.16.0.4\"}, \"dns\": [], \"routes\": [], \"cidr\": \"172.16.0.0/24\", \"gateway\": {\"meta\": {}, \"version\": 4, \"type\": \"gateway\", \"address\": \"172.16.0.1\"}}, {\"ips\": [], \"version\": null, \"meta\": {\"dhcp_server\": \"172.16.0.4\"}, \"dns\": [], \"routes\": [], \"cidr\": null, \"gateway\": {\"meta\": {}, \"version\": null, \"type\": \"gateway\", \"address\": null}}], \"meta\": {\"multi_host\": true, \"should_create_bridge\": true, \"bridge_interface\": \"eth1\", \"tenant_id\": \"83a649b306f64942a3068f6a4fcf0eda\", \"vlan\": 1000, \"should_create_vlan\": true}, \"id\": \"a581fcfb-5248-447d-8205-b7ecd86ac0de\", \"label\": \"private_0\"}, \"meta\": {}, \"id\": \"77fc30cf-4034-4c83-ad75-01ae226cdd85\", \"address\": \"fa:16:3e:79:5d:40\"}]', u'deleted_at': None, u'id': 4}, u'hostname': u'test', u'launched_on': u'gargamel', u'display_description': u'test', u'key_data': u'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgQDM3n/MyErlJ6rK6EulDx3/2/WzzN8184uz73tSmVZieoLCjSknSglbPJs1PmN8UFjPCArJ72so687OSAvRNgq40qLzthisDzVFR42Se6RVwpJzM5Xmc5iGRrDg1kdVQCkcmFtKXrLFTTUBIUvN8GoajE79QOSaM17vFHbwN2o6Dw== Generated by Nova\\n', u'kernel_id': u'2fbe9821-366e-4cd6-bb64-c917238bcc9f', u'power_state': 1, u'default_ephemeral_device': None, u'progress': 0, u'project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'launched_at': u'2012-10-10T13:29:16.000000', u'scheduled_at': u'2012-10-10T13:28:56.000000', u'ramdisk_id': u'18312c9e-d1ea-4927-be5f-9d4e65bf0f29', u'access_ip_v6': None, u'access_ip_v4': None, u'deleted': False, u'key_name': u'test', u'updated_at': u'2012-10-10T13:57:28.000000', u'host': u'gargamel', u'display_name': u'test', u'task_state': None, u'shutdown_terminate': False, u'architecture': None, u'root_gb': 0, u'locked': False, u'name': u'instance-00000004', u'created_at': u'2012-10-10T13:28:56.000000', u'launch_index': 0, u'metadata': [], u'memory_mb': 512, u'instance_type': {u'disabled': False, u'root_gb': 0, u'deleted_at': None, u'name': u'm1.tiny', u'deleted': False, u'created_at': None, u'ephemeral_gb': 0, u'updated_at': None, u'memory_mb': 512, u'vcpus': 1, u'swap': 0, u'rxtx_factor': 1.0, u'is_public': True, u'flavorid': u'1', u'vcpu_weight': None, u'id': 2}, u'vcpus': 1, u'image_ref': u'd62a18f6-5279-4087-a689-dccedfa15fca', u'root_device_name': u'/dev/vda', u'auto_disk_config': None, u'os_type': None, u'config_drive': u''}, u'backup_type': u'daily', u'rotation': 2, u'image_id': u'3d4c6bb8-ff93-4cbb-8828-7cd59c6bc8c1'}, u'_context_instance_lock_checked': False, u'_context_is_admin': True, u'version': u'2.0', u'_context_project_id': u'83a649b306f64942a3068f6a4fcf0eda', u'_context_timestamp': u'2012-10-10T14:04:29.893069', u'_context_read_deleted': u'no', u'_context_user_id': u'0729338e3e4e473496778822e78c8fd3', u'method': u'snapshot_instance', u'_context_remote_address': u'192.168.146.6'}\n2012-10-10 16:04:30 DEBUG nova.openstack.common.rpc.amqp [-] unpacked context: {'project_name': u'admin', 'user_id': u'0729338e3e4e473496778822e78c8fd3', 'roles': [u'admin', u'KeystoneAdmin', u'KeystoneServiceAdmin'], 'timestamp': u'2012-10-10T14:04:29.893069', 'auth_token': '<SANITIZED>', 'remote_address': u'192.168.146.6', 'quota_class': None, 'is_admin': True, 'service_catalog': [{u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'internalURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'id': u'4fc5eca8b3044db4b8e0934e995a02e3'}], u'type': u'volume', u'name': u'cinder'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:9292', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:9292', u'internalURL': u'http://192.168.146.6:9292', u'id': u'5e9d743af281468cae10b320640f1473'}], u'type': u'image', u'name': u'glance'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'internalURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'id': u'bf7028de9c1448ad9d6f2991a8512d03'}], u'type': u'compute', u'name': u'nova'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8773/services/Admin', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8773/services/Cloud', u'internalURL': u'http://192.168.146.6:8773/services/Cloud', u'id': u'5a2ca0bde45e44b787d2ecd59b8d0bd3'}], u'type': u'ec2', u'name': u'ec2'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:35357/v2.0', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:5000/v2.0', u'internalURL': u'http://192.168.146.6:5000/v2.0', u'id': u'cbcd12b6a016456585d93bbd88643780'}], u'type': u'identity', u'name': u'keystone'}], 'request_id': u'req-e930892e-6788-49dc-a482-b1073adb9c1a', 'instance_lock_checked': False, 'project_id': u'83a649b306f64942a3068f6a4fcf0eda', 'user_name': u'admin', 'read_deleted': u'no'} from (pid=18795) _safe_log /opt/stack/nova/nova/openstack/common/rpc/common.py:195\nDEBUG:nova.openstack.common.rpc.amqp:unpacked context: {'project_name': u'admin', 'user_id': u'0729338e3e4e473496778822e78c8fd3', 'roles': [u'admin', u'KeystoneAdmin', u'KeystoneS\nerviceAdmin'], 'timestamp': u'2012-10-10T14:04:29.893069', 'auth_token': '<SANITIZED>', 'remote_address': u'192.168.146.6', 'quota_class': None, 'is_admin': True, 'service_catalog\n': [{u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'publicURL': u'http://192.168\n.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'internalURL': u'http://192.168.146.6:8776/v1/83a649b306f64942a3068f6a4fcf0eda', u'id': u'4fc5eca8b3044db4b8e0934e995a02e3'}], u\n'type': u'volume', u'name': u'cinder'}, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:9292', u'region': u'RegionOne', u'publicURL': u'http://192.168\n.146.6:9292', u'internalURL': u'http://192.168.146.6:9292', u'id': u'5e9d743af281468cae10b320640f1473'}], u'type': u'image', u'name': u'glance'}, {u'endpoints_links': [], u'endpoi\nnts': [{u'adminURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f\n6a4fcf0eda', u'internalURL': u'http://192.168.146.6:8774/v2/83a649b306f64942a3068f6a4fcf0eda', u'id': u'bf7028de9c1448ad9d6f2991a8512d03'}], u'type': u'compute', u'name': u'nova'}\n, {u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://192.168.146.6:8773/services/Admin', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:8773/services/Cl\noud', u'internalURL': u'http://192.168.146.6:8773/services/Cloud', u'id': u'5a2ca0bde45e44b787d2ecd59b8d0bd3'}], u'type': u'ec2', u'name': u'ec2'}, {u'endpoints_links': [], u'endp\noints': [{u'adminURL': u'http://192.168.146.6:35357/v2.0', u'region': u'RegionOne', u'publicURL': u'http://192.168.146.6:5000/v2.0', u'internalURL': u'http://192.168.146.6:5000/v2\n.0', u'id': u'cbcd12b6a016456585d93bbd88643780'}], u'type': u'identity', u'name': u'keystone'}], 'request_id': u'req-e930892e-6788-49dc-a482-b1073adb9c1a', 'instance_lock_checked'\n: False, 'project_id': u'83a649b306f64942a3068f6a4fcf0eda', 'user_name': u'admin', 'read_deleted': u'no'}\n2012-10-10 16:04:30 DEBUG nova.compute.manager [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] [instance: 8cc97452-f176-4c8a-b670-8dd40b8f944f] Checking state from (pid=187\n95) _get_power_state /opt/stack/nova/nova/compute/manager.py:334\nDEBUG:nova.compute.manager:Checking state\n2012-10-10 16:04:31 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Got semaphore \"compute_resources\" for method \"update_usage\"... from (pid=18795) inner /\nopt/stack/nova/nova/utils.py:713\nDEBUG:nova.utils:Got semaphore \"compute_resources\" for method \"update_usage\"...\n2012-10-10 16:04:31 AUDIT nova.compute.manager [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] [instance: 8cc97452-f176-4c8a-b670-8dd40b8f944f] instance snapshotting\nAUDIT:nova.compute.manager:instance snapshotting\n2012-10-10 16:04:38 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf qemu-img snapshot \n-c ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance-00000004/disk from (pid=18795) execute /opt/stack/nova/nova/utils.py:176\nDEBUG:nova.utils:Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf qemu-img snapshot -c ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance\n-00000004/disk\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Result was 0 from (pid=18795) execute /opt/stack/nova/nova/utils.py:191\nDEBUG:nova.utils:Result was 0\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Running cmd (subprocess): qemu-img convert -f qcow2 -O raw -s ce34e05276dc4634aca95f9b9\na029f1b /opt/stack/data/nova/instances/instance-00000004/disk /opt/stack/data/nova/instances/snapshots/tmpY7BbQt/ce34e05276dc4634aca95f9b9a029f1b from (pid=18795) execute /opt/sta\nck/nova/nova/utils.py:176\nDEBUG:nova.utils:Running cmd (subprocess): qemu-img convert -f qcow2 -O raw -s ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance-00000004/disk /opt/stack/da\nta/nova/instances/snapshots/tmpY7BbQt/ce34e05276dc4634aca95f9b9a029f1b\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Result was 0 from (pid=18795) execute /opt/stack/nova/nova/utils.py:191\nDEBUG:nova.utils:Result was 0\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf qemu-img snapshot \n-d ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance-00000004/disk from (pid=18795) execute /opt/stack/nova/nova/utils.py:176\nDEBUG:nova.utils:Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf qemu-img snapshot -d ce34e05276dc4634aca95f9b9a029f1b /opt/stack/data/nova/instances/instance\n-00000004/disk\n2012-10-10 16:04:39 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Result was 0 from (pid=18795) execute /opt/stack/nova/nova/utils.py:191\nDEBUG:nova.utils:Result was 0\n2012-10-10 16:04:45 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf tee /sys/class/net\n/vnet0/brport/hairpin_mode from (pid=18795) execute /opt/stack/nova/nova/utils.py:176\nDEBUG:nova.utils:Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf tee /sys/class/net/vnet0/brport/hairpin_mode\n2012-10-10 16:04:45 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Result was 0 from (pid=18795) execute /opt/stack/nova/nova/utils.py:191\nDEBUG:nova.utils:Result was 0\n2012-10-10 16:04:46 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Got semaphore \"compute_resources\" for method \"update_usage\"... from (pid=18795) inner /\nopt/stack/nova/nova/utils.py:713\nDEBUG:nova.utils:Got semaphore \"compute_resources\" for method \"update_usage\"...\nERROR:glanceclient.common.http:Request returned failure status.\nERROR:root:Original exception being dropped: ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 196, in decorated_function\\n    retur\nn function(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 1218, in _rotate_backups\\n    images = fetch_images()\\n', '  File \"/opt/stac\nk/nova/nova/compute/manager.py\", line 1206, in fetch_images\\n    marker=marker, sort_key=\\'created_at\\', sort_dir=\\'desc\\')\\n', '  File \"/opt/stack/nova/nova/image/glance.py\", lin\ne 169, in detail\\n    for image in images:\\n', '  File \"/opt/stack/python-glanceclient/glanceclient/v1/images.py\", line 130, in paginate\\n    images = self._list(url, \"images\")\\n', '  File \"/opt/stack/python-glanceclient/glanceclient/common/base.py\", line 53, in _list\\n    resp, body = self.api.json_request(\\'GET\\', url)\\n', '  File \"/opt/stack/python-glanceclient/glanceclient/common/http.py\", line 187, in json_request\\n    resp, body_iter = self._http_request(url, method, **kwargs)\\n', '  File \"/opt/stack/python-glanceclient/glanceclient/common/http.py\", line 171, in _http_request\\n    raise exc.from_response(resp)\\n', 'HTTPBadRequest: HTTPBadRequest (HTTP 400)\\n']\n2012-10-10 16:04:47 DEBUG nova.utils [req-e930892e-6788-49dc-a482-b1073adb9c1a admin admin] Got semaphore \"compute_resources\" for method \"update_usage\"... from (pid=18795) inner /opt/stack/nova/nova/utils.py:713\nDEBUG:nova.utils:Got semaphore \"compute_resources\" for method \"update_usage\"...\n2012-10-10 16:04:47 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 181, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     pass\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 167, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 196, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1178, in snapshot_instance\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self._rotate_backups(context, instance, backup_type, rotation)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp KeyError: 'instance'\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp \nERROR:nova.openstack.common.rpc.amqp:Exception during message handling\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 117, in wrapped\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 92, in wrapped\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 181, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     pass\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 167, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 196, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1178, in snapshot_instance\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     self._rotate_backups(context, instance, backup_type, rotation)\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp KeyError: 'instance'\n2012-10-10 16:04:47 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2012-10-10 14:07:52.588097+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "I investigated the problem and I think it's not only a Glance bug.\n\nWhen we make a backup on VM through the compute API, Nova requests Glance to get the list of images precedently backuped for this instance. And with this list, Nova must clean backuped images according to rotation parameter.\n\nThe problem occurs when Nova request this backup images list from Glance.\n\nNova use the 'marker' and 'limit' parameters to get the metadata list page by page. And the first request to get the first page of the list, Nova sets the 'marker' parameter to 'None' and limit to '20' (see function https://github.com/openstack/nova/blob/master/nova/compute/manager.py#L1203).\nBut Glance doesn't accept requests with the parameter 'marker' seted to 'None' and reponds with 400 'Invalid: 400 Bad Request'.\nAnd Nova doesn't catch this error. So the function '/opt/stack/nova/nova/compute/manager.py\", line 1189, in _rotate_backups' fails.\n\nI don't know if it's only a Nova Bug or if Glance should accept requests with 'marker' parameter seted to 'None' or 'none' like it accepts it for the 'is_public' parameter. But in any case, Nova should catch and raise correctly errors sended by Glance.", 
            "date_created": "2012-10-12 10:03:05.727527+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "We shouldn't be sending a marker of None from Nova - Glance is doing the right thing.", 
            "date_created": "2012-10-12 16:30:36.900455+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "Unless glance in essex gracefully copes with this, the same problem will happen with nova in essex ( https://github.com/openstack/nova/blob/stable/essex/nova/compute/manager.py#L1007 )", 
            "date_created": "2012-10-12 17:03:35.800518+00:00", 
            "author": "https://api.launchpad.net/1.0/~dachary"
        }, 
        {
            "content": "Work in progress at https://review.openstack.org/#/c/14471/", 
            "date_created": "2012-10-16 12:50:28.410736+00:00", 
            "author": "https://api.launchpad.net/1.0/~dachary"
        }, 
        {
            "content": "I can propose another patch to correct this bug.\n\nThe Nova Glance wrapper returns all images metadata\nif the parameter 'limit' is not define. It doesn't\nsplit the image metadata list.\n\nSo the sub method fetch_image is no more needed.\nWe can delete it.\n\nI added a check in Nova Glance wrapper to be sure\nthe parameter 'marker' or another one aren't set\nto 'None'.", 
            "date_created": "2012-10-22 16:07:37.965084+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/14471\nCommitted: http://github.com/openstack/nova/commit/d23cf2096fe62c1e575e79c4ff0af3f1fb7830ad\nSubmitter: Jenkins\nBranch:    master\n\ncommit d23cf2096fe62c1e575e79c4ff0af3f1fb7830ad\nAuthor: TianTian Gao <gtt116@126.com>\nDate:   Tue Oct 16 15:17:31 2012 +0800\n\n    Check parameter 'marker' before make request to glance\n    \n    fix bug: 1065053\n    \n    Since glance need parameter 'marker' to be a image-id, can not\n    be None. check 'marker' before make request to glance.\n    \n    Change-Id: I7fc063ea74ae3be71e2effdc0b62432ebdd52c27\n", 
            "date_created": "2012-10-23 05:00:46.266017+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/14770", 
            "date_created": "2012-10-24 16:10:27.768129+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/14770\nCommitted: http://github.com/openstack/nova/commit/17149f688d22e4f4938674f7179a03caeafbfc93\nSubmitter: Jenkins\nBranch:    master\n\ncommit 17149f688d22e4f4938674f7179a03caeafbfc93\nAuthor: \u00c9douard Thuleau <email address hidden>\nDate:   Wed Oct 24 18:08:49 2012 +0200\n\n    fetch_images() method no more needed\n    \n    The Nova Glance wrapper returns all images metadata\n    if the parameter 'limit' is not define. It doesn't\n    split the image metadata list.\n    \n    So the sub method fetch_image is no more needed.\n    We can delete it.\n    \n    I added a check in Nova Glance wrapper to be sure\n    the parameter 'marker' or another one aren't set\n    to 'None' (like in bug #1065053).\n    \n    Fixes LP bug #1070904\n    \n    Change-Id: I24ecc4adf158401f60b508aa3a20bd4c91bfa92b\n", 
            "date_created": "2012-10-31 15:44:24.942822+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/folsom\nReview: https://review.openstack.org/16688", 
            "date_created": "2012-11-21 20:24:35.155124+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/folsom\nReview: https://review.openstack.org/16978", 
            "date_created": "2012-11-27 15:59:37.724392+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/16978\nCommitted: http://github.com/openstack/nova/commit/102c76b83d2d8bbb751f7febc279382ddc76f4eb\nSubmitter: Jenkins\nBranch:    stable/folsom\n\ncommit 102c76b83d2d8bbb751f7febc279382ddc76f4eb\nAuthor: TianTian Gao <gtt116@126.com>\nDate:   Tue Oct 16 15:17:31 2012 +0800\n\n    Check parameter 'marker' before make request to glance\n    \n    fix bug: 1065053\n    \n    Since glance need parameter 'marker' to be a image-id, can not\n    be None. check 'marker' before make request to glance.\n    \n    Change-Id: I7fc063ea74ae3be71e2effdc0b62432ebdd52c27\n    (cherry picked from commit d23cf2096fe62c1e575e79c4ff0af3f1fb7830ad)\n", 
            "date_created": "2012-11-27 20:22:13.792022+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hello \u00c9douard, or anyone else affected,\n\nAccepted nova into quantal-proposed. The package will build now and be available at http://launchpad.net/ubuntu/+source/nova/2012.2.1+stable-20121212-a99a802e-0ubuntu1 in a few hours, and then in the -proposed repository.\n\nPlease help us by testing this new package.  See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed.  Your feedback will aid us getting this update out to other Ubuntu users.\n\nIf this package fixes the bug for you, please add a comment to this bug, mentioning the version of the package you tested, and change the tag from verification-needed to verification-done. If it does not fix the bug for you, please add a comment stating that, and change the tag to verification-failed.  In either case, details of your testing will help us make a better decision.\n\nFurther information regarding the verification process can be found at https://wiki.ubuntu.com/QATeam/PerformingSRUVerification .  Thank you in advance!", 
            "date_created": "2012-12-28 16:29:33.848995+00:00", 
            "author": "https://api.launchpad.net/1.0/~clint-fewbar"
        }, 
        {
            "content": "This bug was fixed in the package nova - 2012.2.1+stable-20121212-a99a802e-0ubuntu1\n\n---------------\nnova (2012.2.1+stable-20121212-a99a802e-0ubuntu1) quantal-proposed; urgency=low\n\n  * Ubuntu updates:\n    - debian/control: Ensure novaclient is upgraded with nova,\n      require python-keystoneclient >= 1:2.9.0. (LP: #1073289)\n    - d/p/avoid_setuptools_git_dependency.patch: Refresh.\n  * Dropped patches, applied upstream:\n    - debian/patches/CVE-2012-5625.patch: [a99a802]\n  * Resynchronize with stable/folsom (b55014ca) (LP: #1085255):\n    - [a99a802] create_lvm_image allocates dirty blocks (LP: #1070539)\n    - [670b388] RPC exchange name defaults to 'openstack' (LP: #1083944)\n    - [3ede373] disassociate_floating_ip with multi_host=True fails\n      (LP: #1074437)\n    - [22d7c3b] libvirt imagecache should handle shared image storage\n      (LP: #1075018)\n    - [e787786] Detached and deleted RBD volumes remain associated with insance\n      (LP: #1083818)\n    - [9265eb0] live_migration missing migrate_data parameter in Hyper-V driver\n      (LP: #1066513)\n    - [3d99848] use_single_default_gateway does not function correctly\n      (LP: #1075859)\n    - [65a2d0a] resize does not migrate DHCP host information (LP: #1065440)\n    - [102c76b] Nova backup image fails (LP: #1065053)\n    - [48a3521] Fix config-file overrides for nova-dhcpbridge\n    - [69663ee] Cloudpipe in Folsom: no such option: cnt_vpn_clients\n      (LP: #1069573)\n    - [6e47cc8] DisassociateAddress can cause Internal Server Error\n      (LP: #1080406)\n    - [22c3d7b] API calls to dis-associate an auto-assigned floating IP should\n      return proper warning (LP: #1061499)\n    - [bd11d15] libvirt: if exception raised during volume_detach, volume state\n      is inconsistent (LP: #1057756)\n    - [dcb59c3] admin can't describe all images in ec2 api (LP: #1070138)\n    - [78de622] Incorrect Exception raised during Create server when metadata\n      over 255 characters  (LP: #1004007)\n    - [c313de4] Fixed IP isn't released before updating DHCP host file\n      (LP: #1078718)\n    - [f4ab42d] Enabling Return Reservation ID with XML create server request\n      returns no body  (LP: #1061124)\n    - [3db2a38] 'BackupCreate' should accept rotation parameter greater than or\n      equal to zero (LP: #1071168)\n    - [f7e5dde] libvirt reboot sometimes fails to reattach volumes\n      (LP: #1073720)\n    - [ff776d4] libvirt: detaching volume may fail while terminating other\n      instances on the same host concurrently (LP: #1060836)\n    - [85a8bc2] Used instance uuid rather than id in remove-fixed-ip\n    - [42a85c0] Fix error on invalid delete_on_termination value\n    - [6a17579] xenapi migrations fail w/ swap (LP: #1064083)\n    - [97649b8] attach-time field for volumes is not updated for detach volume\n      (LP: #1056122)\n    - [8f6a718] libvirt: rebuild is not using kernel and ramdisk associated with\n      the new image (LP: #1060925)\n    - [fbe835f] live-migration and volume host assignement (LP: #1066887)\n    - [c2a9150] typo prevents volume_tmp_dir flag from working (LP: #1071536)\n    - [93efa21] Instances deleted during spawn leak network allocations\n      (LP: #1068716)\n    - [ebabd02] After restarting an instance volume is lost (LP: #1071069)\n    - [a369303] xen volume auto device selection always picks xvdb\n      (LP: #1061944)\n    - [8d1095c] Calls to to_xml() to generate XML for a soft deleted flavor fail\n      (LP: #1073736)\n    - [1857821] nova-manage doesn't validate the key value supplied to update\n      the quota (LP: #1064359)\n    - [6ae32f0] Compute manager doesn't update 'host' field when it tries to run\n      a VM (LP: #1073600)\n    - [284f6ea] Host field set too early during builds (LP: #1060255)\n    - [395511f] finish_resize failures result in NoneType exception\n      (LP: #1071595)\n    - [85ccf80] confirm_resize mgr call requires admin context (LP: #1071600)\n    - [2dceffa] Only return the last N lines of the console log (LP: #1081436)\n    - [9c7a711] console auth does not work with memcache, unicode error\n      (LP: #1057279)\n    - [b27f7ef] disk path not exists when using LXC with libvirt_images_type=lvm\n      (LP: #1079113)\n    - [1351c6b] nova-api now requires quantumclient (LP: #1070509)\n    - [612f404] nova-api now requires quantumclient (LP: #1070509)\n    - [7e8a166] nova-compute (folsom) fails to start, compute_driver is None\n      (LP: #1081836)\n    - [182ca80] Nova API does not work with QuantumV2 API subclasses\n      (LP: #1070045)\n    - [55d1412] 413 error code doesn't always provide Retry-After (LP: #1079387)\n    - [1581505] Snapshotting LXC instance fails (LP: #1058273)\n    - [197398f] Stop network.api import on network import\n    - [b874d21] Scheduler Race Condition at high volume (LP: #1073956)\n    - [3316e1f] Nic Ordering not guaranteed with Quantum API (LP: #1064524)\n    - [ab7e37e] Stable oslo (aka common) update\n    - [3f7788c] update nova to report quantum floating IPs (LP: #1023169)\n    - [d3fd05b] metadata service throws 500 - NoSuchOptError (LP: #1063851)\n    - [97542c9] libvirt imagecache still runs even if disabled (LP: #1075017)\n    - [b31f528] OS API: XML Namespace Handling Broken (LP: #887191)\n    - [76b44d9] nova-api crashes if it is run with nobody account.\n      (LP: #1073858)\n    - [d59f6ad] nova-compute will assign the same device name if volume-attach\n      continuously  (LP: #1062033)\n    - [8e11181] Nova does not delete the LV on LVM backed VMs (LP: #1078085)\n    - [9bf2c6a] Fixed instance deletion issue from Nova API.\n    - [c0e1247] forget to release resource when terminate an instance from a\n      failed compute node (LP: #1067214)\n    - [49397a4] ensure_default_security_group() does not call sgh (LP: #1050982)\n    - [47ff8a5] trigger_instance[add/remove]_security_group_refresh are never\n      called (LP: #1057069)\n    - [c9cade2] Resource reservation isn't rolled back properly for certain\n      failures during Instance Create (LP: #1065092)\n    - [34c3845] Resource tracker uses regex DB query too often (LP: #1060363)\n    - [92eddd2] Logging CPU incompatibility when attempting live migration fails\n      (LP: #1076308)\n    - [8b4896b] hostname in metadata ends with . if dhcp_domain flag is empty\n      (LP: #1064713)\n    - [ded0473] deletes fail when instance in RESIZED (LP: #1056601)\n    - [d015be5] libvirt: cannot detach volume from stopped domain (LP: #1057730)\n    - [d5888f1] Resizing a Xen instance with attached volumes fails\n      (LP: #1028092)\n    - [fb88827] resize leave leftover libvirt configs (LP: #1015731)\n    - [5ccd691] nova-network cannot re-generate MAC address if collision happen\n      (LP: #1059366)\n    - [e3d7f8c] After folsom upgrade, instances can no longer access existing\n      volumes. (LP: #1065702)\n    - [804f858] Jenkins jobs fail because of incompatibility between sqlalchemy-\n      migrate and the newest sqlalchemy-0.8.0b1 (LP: #1073569)\n    - [f67a5f9] block device mappings for deleted instances are leaked\n      (LP: #1069099)\n    - [32d8722] volume and snapshot IDs do not correctly map to UUIDs after\n      folsom upgrade (LP: #1065785)\n    - [9613643] Xenserver cannot boot vm_mode=xen type images (LP: #1055431)\n    - [863c767] Cloudpipe extension xml serialization doesn't return the\n      instance(s) data (LP: #1056242)\n    - [724adcf] deleting security group does not mark rules as deleted\n      (LP: #1056380)\n    - [84a996c] IP Protocol for security group should be returned in lower case\n      to be compliant with the ec2 api (LP: #1057196)\n    - [e1ed06a] db tests fail with sqlalchemy 0.7.4 (LP: #1057145)\n    - [bddb06d] Fail to boot raw image on XenServer (LP: #1055413)\n    - [d4d1665] Add SIGPIPE handler to subprocess execution in rootwrap and\n      utils.execute (LP: #1053364)\n    - [0af4dd0] libvirt: concurrent detach_volume and terminate fails\n      (LP: #1057719)\n    - [ebbfa9e] Instances in vm state DELETED are preventing compute restart\n      (LP: #1053441)\n    - [db516a2] ComputeManager does not provide block_device_info on destroy\n      call in revert_resize (LP: #1056285)\n    - [4223ebf] Set defaultbranch in .gitreview to stable/folsom\n    - [eee4dbb] do_refresh_security_group_rules in nova.virt.firewall is very\n      slow (LP: #1062314)\n    - [b7e509a] Set read_deleted='yes' for instance_id_mappings.\n    - [9e20735] Tests fail on 32bit machines (_get_hash_str is platform\n      dependent) (LP: #1050359)\n -- Adam Gandelman <email address hidden>   Wed, 12 Dec 2012 16:27:51 -0400", 
            "date_created": "2013-01-29 13:10:46.783756+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ]
}