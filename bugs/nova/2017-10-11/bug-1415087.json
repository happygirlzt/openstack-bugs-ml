{
    "status": "Invalid", 
    "last_updated": "2016-02-20 00:40:50.369978+00:00", 
    "description": "Cinder does not provide input format to several calls of \"qemu-img convert\". This allows the attacker to play the format guessing by providing a volume with a qcow2 signature. If this signature contains a base file, this file will be read by a process running as root and embedded in the output. This bug is similar to CVE-2013-1922.\n\nTested with: lvm backed volume storage, it may apply to others as well\nSteps to reproduce:\n- create volume and attach to vm,\n- create a qcow2 signature with base-file[1] from within the vm and\n- trigger upload to glance with \"cinder upload-to-image --disk-type qcow2\"[2].\nThe image uploaded to glance will have /etc/passwd from the cinder-volume host embedded.\nAffected versions: tested on 2014.1.3, found while reading 2014.2.1\n\nFix: Always specify both input \"-f\" and output format \"-O\" to \"qemu-img convert\". The code is in module cinder.image.image_utils.\n\nBastian Blank\n\n[1]: qemu-img create -f qcow2 -b /etc/passwd /dev/vdb\n[2]: The disk-type != raw triggers the use of \"qemu-img convert\"", 
    "tags": [
        "in-stable-icehouse", 
        "in-stable-juno", 
        "in-stable-kilo"
    ], 
    "importance": "High", 
    "heat": 284, 
    "link": "https://bugs.launchpad.net/nova/+bug/1415087", 
    "owner": "https://api.launchpad.net/1.0/~o-tony", 
    "id": 1415087, 
    "index": 1675, 
    "created": "2015-01-27 15:59:37.827978+00:00", 
    "title": "[OSSA 2015-011] Format-guessing and file disclosure in image convert (CVE-2015-1850, CVE-2015-1851)", 
    "comments": [
        {
            "content": "Cinder does not provide input format to several calls of \"qemu-img convert\". This allows the attacker to play the format guessing by providing a volume with a qcow2 signature. If this signature contains a base file, this file will be read by a process running as root and embedded in the output. This bug is similar to CVE-2013-1922.\n\nTested with: lvm backed volume storage, it may apply to others as well\nSteps to reproduce:\n- create volume and attach to vm,\n- create a qcow2 signature with base-file[1] from within the vm and\n- trigger upload to glance with \"cinder upload-to-image --disk-type qcow2\"[2].\nThe image uploaded to glance will have /etc/passwd from the cinder-volume host embedded.\nAffected versions: tested on 2014.1.3, found while reading 2014.2.1\n\nFix: Always specify both input \"-f\" and output format \"-O\" to \"qemu-img convert\". The code is in module cinder.image.image_utils.\n\nBastian Blank\n\n[1]: qemu-img create -f qcow2 -b /etc/passwd /dev/vdb\n[2]: The disk-type != raw triggers the use of \"qemu-img convert\"", 
            "date_created": "2015-01-27 15:59:37.827978+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.", 
            "date_created": "2015-01-27 16:36:37.380872+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Feels legit to me, could a cinder-coresec person confirm ?", 
            "date_created": "2015-01-29 10:35:13.825037+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "yep, that's nasty... Mike has verified as well ", 
            "date_created": "2015-02-02 18:22:49.467563+00:00", 
            "author": "https://api.launchpad.net/1.0/~john-griffith"
        }, 
        {
            "content": "Sorry for the late response on this (midcycle meetup last week and catching up with emails). I was definitely able to verify this with the reproduce steps. Thanks for reporting this Bastian.", 
            "date_created": "2015-02-02 18:23:00.067455+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "On Mon, Feb 02, 2015 at 06:23:00PM -0000, Mike Perez wrote:\n> Sorry for the late response on this (midcycle meetup last week and\n> catching up with emails). I was definitely able to verify this with the\n> reproduce steps. Thanks for reporting this Bastian.\n\nWhile you are at it, there may be more surprises.\n- cinder/nova calls \"qemu-img info\" without format.  While this only\n  leads to missidentification, I don't know if this could be used\n  further.\n- nova/cinder calls \"qemu-img resize\" without format.  Unlikely to be\n  exploitable.\n- nova calls \"qemu-img convert\" without input format.  This should be\n  exploitable if instance storage uses raw images (raw, rbd, lvm).\n\nBastian\n\n-- \nThe face of war has never changed.  Surely it is more logical to heal\nthan to kill.\n\t\t-- Surak of Vulcan, \"The Savage Curtain\", stardate 5906.5\n", 
            "date_created": "2015-02-02 19:04:08+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Adding nova-coresec to investigate the last case mentioned in comment 5", 
            "date_created": "2015-02-05 13:23:39.351226+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "I've set the priority to medium to show that it's \"next on the list\".", 
            "date_created": "2015-02-18 22:52:17.153359+00:00", 
            "author": "https://api.launchpad.net/1.0/~o-tony"
        }, 
        {
            "content": "Hi\n\nIt's been almost four weeks. I've seen no proposed patches or pointers to any activity. I think it is time to publish this vulnerability.\n\nBastian", 
            "date_created": "2015-02-23 10:24:47.065564+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Tony has agreed to look into this from the Nova side after he finishes up some other work he's doing.\n\nLooking through the Nova code it seems that all of our uses of qemu-img create pass -f and an input format.  Is this exploitable with just -O being left off?", 
            "date_created": "2015-02-23 15:24:09.418568+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "A quick grep on nova 2014.2.2 shows:\n\n| nova/virt/images.py:    cmd = ('qemu-img', 'convert', '-O', out_format, source, dest)\n", 
            "date_created": "2015-02-24 10:20:36.135122+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Ahh, good catch.  I glossed over that one somehow.  And that is used in the code path for creating a snapshot to upload.", 
            "date_created": "2015-02-24 14:17:13.729730+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "FYI If cinder (or any part of Nova/Glance/etc) ever creates qcow2 files with backing files, it must also make sure to use the  '-obacking_fmt=FORMATNAME'  option when creating them, to stop QEMU probiing formats when opening backing files.", 
            "date_created": "2015-02-24 15:03:32.018974+00:00", 
            "author": "https://api.launchpad.net/1.0/~berrange"
        }, 
        {
            "content": "@waldi: I couldn't find your affiliation, any company you want to be mentioned with this advisory ?\n\n@nova-coresec: Can you check if other vulnerable image conversions exist (beside the snapshot upload) ?\n\nAssuming this affects all cinder backend, here is impact description draft #1:\n\nTitle: Host file disclosure through qcow2 backing file\nReporter: Bastian Blank\nProducts: Cinder and Nova\nAffects: up to 2014.1.3 and 2014.2 versions through 2014.2.2\n\nDescription:\nBastian Blank reported a vulnerability in Cinder and Nova. By creating a qcow2 image with an arbitrary backing file, an authenticated user may mislead Cinder upload-to-image action, resulting in disclosure of any file from the Cinder server. A similar vulnerability in Nova can also be used by an authenticated user to trick Nova during a snapshot upload, resulting in disclosure of any file for which the Nova process user has access to. All Cinder setups and all Nova setups with force_raw_image (which is set by default) are affected.", 
            "date_created": "2015-02-26 16:29:50.194955+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "impact desc lgtm", 
            "date_created": "2015-02-26 16:35:08.829178+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Thanks!\n\n@nova-coresec please confirm that description before we request a CVE with it.", 
            "date_created": "2015-02-26 16:49:47.011400+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "@ttx nova is certainly vulnerable in the snapshot case.  From what I see nova may *also* be vulnerable (at least in theory) when creating instances.", 
            "date_created": "2015-02-27 04:52:32.351222+00:00", 
            "author": "https://api.launchpad.net/1.0/~o-tony"
        }, 
        {
            "content": "As Tony said, Nova is vulnerable in the snapshot case.  I'm not an expert in the libvirt driver and the complexity of the image handling code makes it hard to say with certainty that the vulnerability exists during instance creation, but it does appear to me that it uses the unprotected 'qemu-img create' with an LVM image type.  I can't say at this point whether or not there are safeguards in place that means that is ok.", 
            "date_created": "2015-02-27 18:44:40.761385+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "On Thu, Feb 26, 2015 at 04:29:50PM -0000, Tristan Cacqueray wrote:\n> @waldi: I couldn't find your affiliation, any company you want to be\n> mentioned with this advisory ?\n\nThis would be \"credativ\".\n\n> Description:\n> Bastian Blank reported a vulnerability in Cinder and Nova. By creating a qcow2 image with an arbitrary backing file, an authenticated user may mislead Cinder upload-to-image action, resulting in disclosure of any file from the Cinder server. A similar vulnerability in Nova can also be used by an authenticated user to trick Nova during a snapshot upload, resulting in disclosure of any file for which the Nova process user has access to. All Cinder setups and all Nova setups with force_raw_image (which is set by default) are affected.\n\nI find that description not well formulated.  For me \"creating an image\"\nimplies that I have a new file after that.  But in this case there\nalready exists the volume or instance disk and I have to use them for\nthe attack.\n\nAlso what is \"force_raw_image\"?\n\nBastian\n\n-- \nIt would be illogical to kill without reason.\n\t\t-- Spock, \"Journey to Babel\", stardate 3842.4\n", 
            "date_created": "2015-02-27 21:58:51+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "On Fri, Feb 27, 2015 at 04:52:32AM -0000, Tony Breeds wrote:\n> @ttx nova is certainly vulnerable in the snapshot case.  From what I see\n> nova may *also* be vulnerable (at least in theory) when creating\n> instances.\n\nI tried that and was unable to get past the initial check.  However this\ncode does a blacklist test instead of a whitelist tests of features the\nimage may have.\n\nOkay, it parses the output of \"qemu-img info\", which looks more like it\nis created for human, not machine consumption.\n\nBastian\n\n-- \nThe heart is not a logical organ.\n\t\t-- Dr. Janet Wallace, \"The Deadly Years\", stardate 3479.4\n", 
            "date_created": "2015-02-27 22:01:59+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Hum, upon a secondary review it seems that force_raw_image only prevents the convertion from fetch_image, but not from the image backend. Nevermind that note, I guess every nova setups are affected.\n\nThanks Bastian, is it more clear like that ?\n\nTitle: Host file disclosure through qcow2 backing file\nReporter: Bastian Blank (credativ)\nProducts: Cinder and Nova\nAffects: up to 2014.1.3 and 2014.2 versions through 2014.2.2\n\nDescription:\nBastian Blank from credativ reported a vulnerability in Cinder and Nova. By overwriting an image with a malicious qcow2 header, an authenticated user may mislead Cinder upload-to-image action, resulting in disclosure of any file from the Cinder server. A similar vulnerability in Nova can also be used by an authenticated user to trick Nova during a snapshot upload, resulting in disclosure of any file for which the Nova process user has access to. All Cinder and Nova setups are affected.", 
            "date_created": "2015-02-27 23:09:56.192094+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "On Fri, Feb 27, 2015 at 11:09:56PM -0000, Tristan Cacqueray wrote:\n> Hum, upon a secondary review it seems that force_raw_image only prevents\n> the convertion from fetch_image, but not from the image backend.\n> Nevermind that note, I guess every nova setups are affected.\n\nAh, I missed that this is a Nova-only setting.  Every call to\n\"convert_image\" with something that may be a raw-image is affected.\n\n> Thanks Bastian, is it more clear like that ?\n\nThis looks better, thanks.\n\nBastian\n\n-- \nIf some day we are defeated, well, war has its fortunes, good and bad.\n\t\t-- Commander Kor, \"Errand of Mercy\", stardate 3201.7\n", 
            "date_created": "2015-02-28 10:53:33+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Impact desc +1", 
            "date_created": "2015-03-02 15:08:11.130257+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Grant will have a try at patching this.", 
            "date_created": "2015-03-02 15:10:51.269618+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Thought I'd get the patch conversation started with this.\n\nThis change explicitly requires all calls to convert_image to supply an image format. It touches a lot of drivers so may not be desirable. The alternative will need to use qemu-img info for each call to derive the image type.  \n\n*Note this only covers the qemu-img convert cases in cinder. I will take a look at required changes in Nova next.", 
            "date_created": "2015-03-02 23:24:02.602353+00:00", 
            "author": "https://api.launchpad.net/1.0/~gmurphy"
        }, 
        {
            "content": "On Mon, Mar 02, 2015 at 11:24:02PM -0000, Grant Murphy wrote:\n> This change explicitly requires all calls to convert_image to supply an\n> image format. It touches a lot of drivers so may not be desirable.\n\nWell, you mix in correct but independent cleanup changes (renaming of\nvariables).\n\n>                                                                    The\n> alternative will need to use qemu-img info for each call to derive the\n> image type.\n\nAnd this would fix the problem how?  The format guessing qemu-img does\nis the reason for problem.\n\nBastian\n\n-- \n", 
            "date_created": "2015-03-03 10:04:54+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Thanks for the review Bastain. I'll try to cleanup some of my clean ups.. but I'm not convinced I have the driver code changes right anyway. \n\nCan we get @cinder-coresec and @nova-coresec to come up something decent for this please? I'd like to get this moving along !", 
            "date_created": "2015-03-03 16:09:33.422386+00:00", 
            "author": "https://api.launchpad.net/1.0/~gmurphy"
        }, 
        {
            "content": "From the @nova-coresec POV this bug is important but behind others so while you have some momentum please keep it going Grant!", 
            "date_created": "2015-03-03 22:48:45.033906+00:00", 
            "author": "https://api.launchpad.net/1.0/~o-tony"
        }, 
        {
            "content": "Since there hasn't been much other movement on this I've updated a new patch that hopefully addresses the variable renaming complaints.  As we can't rely on calls to qemu-img info to determine the source format explicit decisions need to be made in the driver code in cases that call image_utils.convert_image().  I couldn't really find a case where I could reliably discover this information from the database.. so I've added a configuration setting for the affected drivers. I can't be certain if the default values I've supplied here are correct or even sensible. So I would again ask cinder devs to please take a look at this and suggest a viable alternative. \n\nThanks.\n\n", 
            "date_created": "2015-03-10 21:28:29.943430+00:00", 
            "author": "https://api.launchpad.net/1.0/~gmurphy"
        }, 
        {
            "content": "Hi Grant, thanks for the patch. I'll test this out today and let you know.", 
            "date_created": "2015-03-18 11:59:00.403130+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "I don't think this patch will work reliably.  Coding the expected format in the configuration for images coming from Glance doesn't work because because the images could be a number of different formats -- we need to query Glance for that information.\n\nI've taken a look at a different instance of this same issue in this spec [1], which revolves around similar problems guessing formats of volume/snapshot files.  It's a different scenario, but the gist of it is, at any point that you are handling an image or file from the \"outside\", you have to have a separate identifier indicating what format it is in, which isn't the file itself.\n\nFor this bug, Glance should be able to tell us that.  But coding expected formats in the configuration isn't viable since it restricts us to only one format, and opens up holes such as someone supplying a raw image with a malicious qcow2 header written into it, which is accepted because the configuration by default says that it is qcow2.\n\n[1] https://review.openstack.org/#/c/103750/", 
            "date_created": "2015-03-18 12:31:20.439212+00:00", 
            "author": "https://api.launchpad.net/1.0/~eharney"
        }, 
        {
            "content": "Thanks Grant. I agree with Eric that this patch does solve this particular case, but not all.", 
            "date_created": "2015-03-19 06:12:17.467733+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "Thanks for the review. I was hoping my crummy patch would inspire one of you guys to write something that actually worked. @thingee @eharney Do you think you could take a look at this? ", 
            "date_created": "2015-03-23 15:12:47.833666+00:00", 
            "author": "https://api.launchpad.net/1.0/~gmurphy"
        }, 
        {
            "content": "Can we user the same trick Eric used fixing the related CVE, and analyse the apparent structure of any qcow2 file provided to see if it is backed by something it shouldn't be?\n", 
            "date_created": "2015-03-31 14:45:58.908679+00:00", 
            "author": "https://api.launchpad.net/1.0/~duncan-thomas"
        }, 
        {
            "content": "On Tue, Mar 31, 2015 at 02:45:58PM -0000, Duncan Thomas wrote:\n> Can we user the same trick Eric used fixing the related CVE, and analyse\n> the apparent structure of any qcow2 file provided to see if it is backed\n> by something it shouldn't be?\n\nNot sure which trick you mean.  But the only way to properly fix this is\nto actually supply the input format, as only the storage layer knows.\nIf you resort to guessing, this will get you a nice way to hide\ninformation, including unusable backups.\n\nBastian\n\n-- \nThe sight of death frightens them [Earthers].\n\t\t-- Kras the Klingon, \"Friday's Child\", stardate 3497.2\n", 
            "date_created": "2015-03-31 17:41:29+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Spoke to Eric about the approach. He'll be working on a patch tonight.", 
            "date_created": "2015-03-31 18:33:14.886973+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "This patch handles this scenario by stopping the upload process if the volume data contains a header referencing a backing file.\n\nThis is an intermediate solution until we can implement full format tracking of volume data, but it prevents this bug from causing a data leak by failing safe.", 
            "date_created": "2015-03-31 23:53:43.597295+00:00", 
            "author": "https://api.launchpad.net/1.0/~eharney"
        }, 
        {
            "content": "Bastian: The problem is, in a few cases, we don't know the storage format for sure. For filesystem based starge, nova can and does change the format during certain operations, without telling cinder. This is something we're working on fixing, and I agree it is a better fix, but it isn't going to be quick or simple.", 
            "date_created": "2015-04-01 10:00:13.428318+00:00", 
            "author": "https://api.launchpad.net/1.0/~duncan-thomas"
        }, 
        {
            "content": "On Wed, Apr 01, 2015 at 10:00:13AM -0000, Duncan Thomas wrote:\n> Bastian: The problem is, in a few cases, we don't know the storage\n> format for sure. For filesystem based starge, nova can and does change\n> the format during certain operations, without telling cinder.\n\nThis are \"few cases\".  So you can fix the known cases, properly document\nthe cases where you may not know.  But I want to have some informations:\n- the code location of this stabbing cinder in the back and\n- the db location nova itself stores this information (or does it always\n  fall back to sniffing, which means all qemu calls needs to be audited\n  as well).\n\n>                                                               This is\n> something we're working on fixing, and I agree it is a better fix, but\n> it isn't going to be quick or simple.\n\nSo fix the locations that are easy and properly set the type to\nundefined if you don't know.  I don't really think lvm/iscsi backed\nvolumes will be changed in this way.\n\nIt's been over two months now without any real progress.  Now you claim\nit can't be fixed, only worked around.  So I don't consider waiting any\nlonger will help and think about publishing this issue after easter.\nSo, if there have been CVE assigned please document them, otherwise I\nwill take care of that.\n\nRegards,\nBastian\n\n-- \nMost legends have their basis in facts.\n\t\t-- Kirk, \"And The Children Shall Lead\", stardate 5029.5\n", 
            "date_created": "2015-04-02 05:57:40+00:00", 
            "author": "https://api.launchpad.net/1.0/~waldi"
        }, 
        {
            "content": "Bastian: the security fix will likely be a workaround -- that doesn't prevent the issue from being fully fixed in a future version (by tracking format appropriately). Agree that this is taking way too long.\n\n@Cinder-coresec: please review proposed patch\n@Nova-coresec: please propose patch to cover for the case @ comment #10\n\nWe'll get a CVE based on the impact description at comment #20 for you to include in your public disclosure.", 
            "date_created": "2015-04-02 13:22:44.277415+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "CVE have been requested with this description (same as comment #20, including 2014.1.4 in affected versions):\n\nTitle: Host file disclosure through qcow2 backing file\nReporter: Bastian Blank (credativ)\nProducts: Cinder and Nova\nAffects: up to 2014.1.4 and 2014.2 versions through 2014.2.2\n\nDescription:\nBastian Blank from credativ reported a vulnerability in Cinder and Nova. By overwriting an image with a malicious qcow2 header, an authenticated user may mislead Cinder upload-to-image action, resulting in disclosure of any file from the Cinder server. A similar vulnerability in Nova can also be used by an authenticated user to trick Nova during a snapshot upload, resulting in disclosure of any file for which the Nova process user has access to. All Cinder and Nova setups are affected.", 
            "date_created": "2015-04-02 13:35:56.674924+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Apologies on the time it took to verify Eric's patch. I have verified this workaround works. It stops all uploads that have a backing file as mentioned in the commit message.", 
            "date_created": "2015-04-08 05:39:13.962667+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "@Nova-coresec: please propose patch to cover for the case @ comment #10", 
            "date_created": "2015-05-04 14:11:26.110192+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Updating affected version to include recent stable release.\n\nTitle: Host file disclosure through qcow2 backing file\nReporter: Bastian Blank (credativ)\nProducts: Cinder and Nova\nAffects: versions through 2014.1.4, and 2014.2 versions through 2014.2.3, and version 2015.1.0\n\nDescription:\nBastian Blank from credativ reported a vulnerability in Cinder and Nova. By overwriting an image with a malicious qcow2 header, an authenticated user may mislead Cinder upload-to-image action, resulting in disclosure of any file from the Cinder server. A similar vulnerability in Nova can also be used by an authenticated user to trick Nova during a snapshot upload, resulting in disclosure of any file for which the Nova process user has access to. All Cinder and Nova setups are affected.", 
            "date_created": "2015-05-04 15:57:42.493466+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Eric's patch in comment #36 looks good to me. Tested that it blocks upload of constructed QCOWs. ", 
            "date_created": "2015-05-05 16:21:54.150577+00:00", 
            "author": "https://api.launchpad.net/1.0/~duncan-thomas"
        }, 
        {
            "content": "I tested patch from comment #36 and it worked fine for me as well.", 
            "date_created": "2015-05-05 16:23:03.956569+00:00", 
            "author": "https://api.launchpad.net/1.0/~thingee"
        }, 
        {
            "content": "@Tony, any progress on the Nova patch ?", 
            "date_created": "2015-05-26 19:33:22.875779+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "I didn't make as much progress as I'd hoped today.\n\nI have a work in process patch and I'm working on refining my repro case to make iterating on the patch quicker.", 
            "date_created": "2015-06-02 07:29:56.469389+00:00", 
            "author": "https://api.launchpad.net/1.0/~o-tony"
        }, 
        {
            "content": "Embargo lifted now that this is reported in public: http://www.openwall.com/lists/oss-security/2015/06/13/1", 
            "date_created": "2015-06-13 14:30:51.985389+00:00", 
            "author": "https://api.launchpad.net/1.0/~fungi"
        }, 
        {
            "content": "My understanding from the history is that Cinder's patch is ready and reviewed but the Nova issue is still a problem, is this correct?  \n\nNow this issue is disclosed and public, I think we need to raise the urgency of some code mitigation/workaround?\n\nEric, as the issue is now public - worth pushing your patch to gerrit?", 
            "date_created": "2015-06-13 17:55:55.357467+00:00", 
            "author": "https://api.launchpad.net/1.0/~davewalker"
        }, 
        {
            "content": "On the nova side, the recent slowness (to my understanding) is that we've had a lot of trouble actually finding an exploit for this. We agree there is a theoretical problem, but we haven't been able to actually replicate a working attack.\n\nSo... Nova needs to do some defensive work here, but that effort is not yet complete.", 
            "date_created": "2015-06-13 21:52:04.539018+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "I tried to recreate this myself.. TL;DR I didn't succeed.\n\nI created a cinder (LVM backend) volume, attached it as vdb to a guest and within the guest ran \"qemu-img create -f qcow2 -b /etc/passwd /dev/vdb\"\n\nIntrospecting on the underlying host, it looks like things are progressing:\n# qemu-img info /dev/mapper/stack--volumes--lvmdriver--1-volume--6c76f71d--6ccb--4a95--845c--40fd9af1a12d | grep backing\nbacking file: /etc/passwd\n\nI then created a second guest, and made the root boot from volume the cinder volume from above.  Then following running \"nova image-create\" a reference does appear in Glance with the correct name set, but a null file size.\n\nAttempting to retrieve the image through glance a 0 byte file is returned.\n\n", 
            "date_created": "2015-06-13 22:26:10.469977+00:00", 
            "author": "https://api.launchpad.net/1.0/~davewalker"
        }, 
        {
            "content": "Mikal is correct nova has a theoretical issue but I've been unable to actually exploit it..\n\nI've certainly been able to create a guest with an image that shows the problem BUT as yet I haven't been able to get nova to run convert on it.\n\nA related issue is that nova blindly trusts qemu-img info which is itself susceptible to a similar issue.", 
            "date_created": "2015-06-13 23:50:00.249757+00:00", 
            "author": "https://api.launchpad.net/1.0/~o-tony"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/191785", 
            "date_created": "2015-06-15 13:01:14.306205+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/kilo\nReview: https://review.openstack.org/191786", 
            "date_created": "2015-06-15 13:03:32.103751+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "@cinder-coresec, I submited the proposed patch for review in master and kilo, but the cherry-pick failed for Juno and Icehouse, can you please fix this ?\n\n@nova-coresec, are we confident this does not affect any stable release starting from Icehouse ?", 
            "date_created": "2015-06-15 13:10:12.560284+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Until Nova is confirmed, here is the impact description of Cinder:\n\nTitle: Cinder host file disclosure through qcow2 backing file\nReporter: Bastian Blank (credativ)\nProducts: Cinder\nAffects: versions through 2014.1.4, and 2014.2 versions through 2014.2.3, and version 2015.1.0\n\nDescription:\nBastian Blank from credativ reported a vulnerability in Cinder. By overwriting an image with a malicious qcow2 header, an authenticated user may mislead Cinder upload-to-image action, resulting in disclosure of any file from the Cinder server. All Cinder and Nova setups are affected.", 
            "date_created": "2015-06-15 14:47:21.228349+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Oups, last sentence is \"All Cinder setups are affected\"", 
            "date_created": "2015-06-15 15:00:31.949719+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Yep, with that correction from comment #57, Tristan's updated impact Cinder-specific description in comment #56 looks good to me.", 
            "date_created": "2015-06-15 15:09:28.347943+00:00", 
            "author": "https://api.launchpad.net/1.0/~fungi"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/191865", 
            "date_created": "2015-06-15 16:00:52.175043+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/191871", 
            "date_created": "2015-06-15 16:15:06.385140+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Can we get series tasks for kilo/juno/icehouse ?", 
            "date_created": "2015-06-15 16:45:34.471575+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/191785\nCommitted: https://git.openstack.org/cgit/openstack/cinder/commit/?id=b1143ee45323e63b965a3710f9063e65b252c978\nSubmitter: Jenkins\nBranch:    master\n\ncommit b1143ee45323e63b965a3710f9063e65b252c978\nAuthor: Eric Harney <email address hidden>\nDate:   Tue Mar 31 19:48:17 2015 -0400\n\n    Disallow backing files when uploading volumes to image\n    \n    Volumes with a header referencing a backing file can leak\n    file data into the destination image when uploading a\n    volume to an image.\n    \n    Halt the upload process if the volume data references a\n    backing file to prevent this.\n    \n    Closes-Bug: #1415087\n    Change-Id: Iab9718794e7f7e8444015712cfa08c46848ebf78\n", 
            "date_created": "2015-06-15 19:47:52.518043+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/191786\nCommitted: https://git.openstack.org/cgit/openstack/cinder/commit/?id=9634b76ba5886d6c2f2128d550cb005dabf48213\nSubmitter: Jenkins\nBranch:    stable/kilo\n\ncommit 9634b76ba5886d6c2f2128d550cb005dabf48213\nAuthor: Eric Harney <email address hidden>\nDate:   Tue Mar 31 19:48:17 2015 -0400\n\n    Disallow backing files when uploading volumes to image\n    \n    Volumes with a header referencing a backing file can leak\n    file data into the destination image when uploading a\n    volume to an image.\n    \n    Halt the upload process if the volume data references a\n    backing file to prevent this.\n    \n    Closes-Bug: #1415087\n    Change-Id: Iab9718794e7f7e8444015712cfa08c46848ebf78\n    (cherry picked from commit b1143ee45323e63b965a3710f9063e65b252c978)\n", 
            "date_created": "2015-06-15 22:38:04.044879+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/191865\nCommitted: https://git.openstack.org/cgit/openstack/cinder/commit/?id=d31c937c566005dedf41a60c6b5bd5e7b26f221b\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit d31c937c566005dedf41a60c6b5bd5e7b26f221b\nAuthor: Eric Harney <email address hidden>\nDate:   Tue Mar 31 19:48:17 2015 -0400\n\n    Disallow backing files when uploading volumes to image\n    \n    Volumes with a header referencing a backing file can leak\n    file data into the destination image when uploading a\n    volume to an image.\n    \n    Halt the upload process if the volume data references a\n    backing file to prevent this.\n    \n    Closes-Bug: #1415087\n    Change-Id: Iab9718794e7f7e8444015712cfa08c46848ebf78\n    (cherry picked from commit 9634b76ba5886d6c2f2128d550cb005dabf48213)\n    Conflicts:\n        cinder/tests/test_image_utils.py (backport to old tests)\n", 
            "date_created": "2015-06-15 22:42:27.622378+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/191871\nCommitted: https://git.openstack.org/cgit/openstack/cinder/commit/?id=bc0549e08b010edb863d409d80114aa78d317a61\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit bc0549e08b010edb863d409d80114aa78d317a61\nAuthor: Eric Harney <email address hidden>\nDate:   Tue Mar 31 19:48:17 2015 -0400\n\n    Disallow backing files when uploading volumes to image\n    \n    Volumes with a header referencing a backing file can leak\n    file data into the destination image when uploading a\n    volume to an image.\n    \n    Halt the upload process if the volume data references a\n    backing file to prevent this.\n    \n    Closes-Bug: #1415087\n    Change-Id: Iab9718794e7f7e8444015712cfa08c46848ebf78\n    (cherry picked from commit 9634b76ba5886d6c2f2128d550cb005dabf48213)\n    Conflicts:\n        cinder/tests/test_image_utils.py (backport to old tests)\n    (cherry picked from commit d31c937c566005dedf41a60c6b5bd5e7b26f221b)\n    Conflicts:\n        cinder/tests/test_image_utils.py\n", 
            "date_created": "2015-06-15 22:45:01.253600+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "The OSSA task is now completed for Cinder. Does someone still trying to reproduce the bug on Nova or should we close the OSSA task ?", 
            "date_created": "2015-06-16 17:49:07.085854+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "There was an error in CVE assignment. The Cinder issue is CVE-2015-1851. Nova has been assigned CVE-2015-1850.", 
            "date_created": "2015-06-17 12:55:17.757166+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Tony, in the end, were you able to reproduce this in Nova ?", 
            "date_created": "2015-07-06 14:07:00.002740+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "@Tony & nova-coresec please respond to Tristan's last question.", 
            "date_created": "2015-07-27 16:46:39.671773+00:00", 
            "author": "https://api.launchpad.net/1.0/~gmurphy"
        }, 
        {
            "content": "The OSSA tasks is now closed. If Nova turns out to be affected, a new OSSA will be required anyway.", 
            "date_created": "2015-08-10 14:20:21.723373+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "What are the plans for nova fix? Is nova affected or not affected? \nThe CVE record is still opened in MITRE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1850", 
            "date_created": "2015-09-23 14:53:22.362139+00:00", 
            "author": "https://api.launchpad.net/1.0/~annasort"
        }, 
        {
            "content": "A CVE was requested for a suspected vulnerability in Nova, but was never confirmed exploitable. Unless someone comes forward soon with a reproducible case there, I recommend we request a reject of CVE 2015-1850 for completeness.", 
            "date_created": "2015-09-23 15:08:32.411328+00:00", 
            "author": "https://api.launchpad.net/1.0/~fungi"
        }, 
        {
            "content": "Anna, since nobody have been able to reproduce this bug in Nova, it seems like there will be no fix for it.\n\nSomeone from Nova team needs to mark this bug as Invalid.", 
            "date_created": "2015-09-23 15:11:18.651008+00:00", 
            "author": "https://api.launchpad.net/1.0/~tristan-cacqueray"
        }, 
        {
            "content": "Given nova.virt.libvirt.utils.create_cow_image which is calling qemu-img create with a backing file but not specifying the backing file format, I'd consider nova affected by this issue:\n\nhttps://github.com/openstack/nova/blob/master/nova/virt/libvirt/utils.py#L75", 
            "date_created": "2015-09-24 14:25:17.309933+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Thanks, Matt. Even if we couldn't find a way to exploit this, that doesn't mean there isn't one or that a fix isn't needed. Nova should not be doing what is described in comment 74.", 
            "date_created": "2015-09-24 16:39:22.734271+00:00", 
            "author": "https://api.launchpad.net/1.0/~edmondsw"
        }, 
        {
            "content": "I agree this is at least a security hardening opportunity in Nova, and would be great to patch if someone is interested in writing that patch. However the decision to issue a security hinges on having a clearer explanation of _how_ this makes users of Nova vulnerable, and would still need the aforementioned patch (and would need to be the sort we could safely provide to users of supported stable release branches without introducing new configuration or backward-incompatible behavior changes).", 
            "date_created": "2015-09-24 17:25:02.095617+00:00", 
            "author": "https://api.launchpad.net/1.0/~fungi"
        }, 
        {
            "content": "Sorry, I meant \"the decision to issue a security *advisory*\" above.", 
            "date_created": "2015-09-24 17:26:46.453932+00:00", 
            "author": "https://api.launchpad.net/1.0/~fungi"
        }, 
        {
            "content": "If we're just adding the hardening and tests then we should be able to do that in a backport compatible way.", 
            "date_created": "2015-09-24 23:48:11.755692+00:00", 
            "author": "https://api.launchpad.net/1.0/~o-tony"
        }, 
        {
            "content": "Are there any updates on nova fix?", 
            "date_created": "2015-10-08 14:15:42.734737+00:00", 
            "author": "https://api.launchpad.net/1.0/~annasort"
        }, 
        {
            "content": "I'm going to mark the nova part of this as incomplete since no one has said they know how to demonstrate a vulnerability in nova for this.  The CVE for nova is marked as reserved:\r\n\r\nhttps://bugs.launchpad.net/bugs/cve/2015-1850\r\n\r\nAnd the OSSA was released for the cinder CVE:\r\n\r\nhttps://security.openstack.org/ossa/OSSA-2015-011.html\r\n\r\nFurthermore, distros like Red Hat have already been posting that this is something to be aware of but does not have a fix and is considered low severity:\r\n\r\nhttps://access.redhat.com/security/cve/CVE-2015-1850\r\n\r\nSame with Canonical:\r\n\r\nhttp://people.canonical.com/~ubuntu-security/cve/2015/CVE-2015-1850.html", 
            "date_created": "2015-10-28 17:23:13.269143+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "OSSA-2015-011 let the cat out of the bag on CVE-2015-1850, and then so have RedHat and Canonical with their statements as well, so while it's technically still reserved in the mitre system, that's really an inaccuracy at this point. The information is out there.", 
            "date_created": "2015-10-28 22:35:56.143302+00:00", 
            "author": "https://api.launchpad.net/1.0/~edmondsw"
        }, 
        {
            "content": "Since CVE-2015-1850 is marked as incomplete, will the nova bug be  fixed(or hardened) with a new advisory?", 
            "date_created": "2015-12-17 01:38:46.498684+00:00", 
            "author": "https://api.launchpad.net/1.0/~shhjwang"
        }, 
        {
            "content": "To reiterate Matt's comment #80, \"no one has said they know how to demonstrate a vulnerability in nova for this.\" If someone steps up to fix the underlying bug, I doubt there will be any objection, but the OpenStack Vulnerability Management Team won't issue any official advisory statement without documented impact.", 
            "date_created": "2015-12-17 02:08:01.509896+00:00", 
            "author": "https://api.launchpad.net/1.0/~fungi"
        }, 
        {
            "content": "Tony, we talked at the summit. I believe you said you were working on nova changes to address this, and would throw up a WIP patch set folks could track. I haven't seen that patch set linked here. Can you give a status update?", 
            "date_created": "2016-01-05 15:27:07.160387+00:00", 
            "author": "https://api.launchpad.net/1.0/~edmondsw"
        }, 
        {
            "content": "As there has been no demonstration of an actual Nova exposure, this is closed out for Nova. If someone finds a real exposure there, please reopen.", 
            "date_created": "2016-02-20 00:40:48.754788+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}