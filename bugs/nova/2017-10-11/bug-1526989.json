{
    "status": "Confirmed", 
    "last_updated": "2016-03-10 21:46:25.862652+00:00", 
    "description": "http://logs.openstack.org/18/258118/2/check/gate-tempest-dsvm-postgres-full/872af9a/logs/screen-n-cpu.txt.gz?level=TRACE#_2015-12-16_22_36_33_037\n\nThis looks to be very random:\n\n2015-12-16 22:36:33.037 ERROR nova.compute.manager [req-706bbae7-e8b6-4c91-9d12-56d61bd2df98 tempest-ServerAddressesNegativeTestJSON-431116692 tempest-ServerAddressesNegativeTestJSON-995800820] [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] Instance failed to spawn\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] Traceback (most recent call last):\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2173, in _build_resources\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     yield resources\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2020, in _build_and_run_instance\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     block_device_info=block_device_info)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2522, in spawn\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     block_device_info=block_device_info)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4600, in _create_domain_and_network\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     xml, pause=pause, power_on=power_on)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4530, in _create_domain\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     guest.launch(pause=pause)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/guest.py\", line 141, in launch\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     self._encoded_xml, errors='ignore')\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 204, in __exit__\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     six.reraise(self.type_, self.value, self.tb)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/guest.py\", line 136, in launch\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     return self._domain.createWithFlags(flags)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     rv = execute(f, *args, **kwargs)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     six.reraise(c, e, tb)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     rv = meth(*args, **kwargs)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/libvirt.py\", line 900, in createWithFlags\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] libvirtError: internal error: early end of file from monitor: possible problem:\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] qemu: terminating on signal 15 from pid 15765\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] \n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] \n\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message:%5C%22_create_domain%5C%22%20AND%20message:%5C%22libvirtError:%20internal%20error:%20early%20end%20of%20file%20from%20monitor:%20possible%20problem%5C%22%20AND%20message:%5C%22qemu:%20terminating%20on%20signal%2015%20from%20pid%5C%22%20AND%20tags:%5C%22screen-n-cpu.txt%5C%22\n\n4 hits in the last 7 days, check and gate, all failures.\n\nThis is most likely some latent libvirt/qemu bug.", 
    "tags": [
        "libvirt", 
        "multinode"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1526989", 
    "owner": "None", 
    "id": 1526989, 
    "index": 4410, 
    "created": "2015-12-16 23:03:10.927719+00:00", 
    "title": "nova snapshot fails with 'libvirtError: internal error: early end of file from monitor: possible problem: qemu: terminating on signal 15 from pid 15765'", 
    "comments": [
        {
            "content": "http://logs.openstack.org/18/258118/2/check/gate-tempest-dsvm-postgres-full/872af9a/logs/screen-n-cpu.txt.gz?level=TRACE#_2015-12-16_22_36_33_037\n\nThis looks to be very random:\n\n2015-12-16 22:36:33.037 ERROR nova.compute.manager [req-706bbae7-e8b6-4c91-9d12-56d61bd2df98 tempest-ServerAddressesNegativeTestJSON-431116692 tempest-ServerAddressesNegativeTestJSON-995800820] [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] Instance failed to spawn\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] Traceback (most recent call last):\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2173, in _build_resources\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     yield resources\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2020, in _build_and_run_instance\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     block_device_info=block_device_info)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2522, in spawn\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     block_device_info=block_device_info)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4600, in _create_domain_and_network\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     xml, pause=pause, power_on=power_on)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 4530, in _create_domain\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     guest.launch(pause=pause)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/guest.py\", line 141, in launch\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     self._encoded_xml, errors='ignore')\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 204, in __exit__\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     six.reraise(self.type_, self.value, self.tb)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/opt/stack/new/nova/nova/virt/libvirt/guest.py\", line 136, in launch\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     return self._domain.createWithFlags(flags)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     rv = execute(f, *args, **kwargs)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     six.reraise(c, e, tb)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     rv = meth(*args, **kwargs)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]   File \"/usr/local/lib/python2.7/dist-packages/libvirt.py\", line 900, in createWithFlags\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] libvirtError: internal error: early end of file from monitor: possible problem:\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] qemu: terminating on signal 15 from pid 15765\n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] \n2015-12-16 22:36:33.037 22332 ERROR nova.compute.manager [instance: 86493959-22a5-4e5a-8226-92eb95c3c630] \n\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message:%5C%22_create_domain%5C%22%20AND%20message:%5C%22libvirtError:%20internal%20error:%20early%20end%20of%20file%20from%20monitor:%20possible%20problem%5C%22%20AND%20message:%5C%22qemu:%20terminating%20on%20signal%2015%20from%20pid%5C%22%20AND%20tags:%5C%22screen-n-cpu.txt%5C%22\n\n4 hits in the last 7 days, check and gate, all failures.\n\nThis is most likely some latent libvirt/qemu bug.", 
            "date_created": "2015-12-16 23:03:10.927719+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Wondering if there is any progress on investigating this one, it does affects me ", 
            "date_created": "2016-03-04 18:15:51.233008+00:00", 
            "author": "https://api.launchpad.net/1.0/~ivo-vasev"
        }, 
        {
            "content": "Ivo, which version of libvirt/qemu are you running?", 
            "date_created": "2016-03-05 18:03:05.387476+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "From logstash over the last 7 days:\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22_create_domain%5C%22%20AND%20message%3A%5C%22libvirtError%3A%20internal%20error%3A%20early%20end%20of%20file%20from%20monitor%3A%20possible%20problem%5C%22%20AND%20message%3A%5C%22qemu%3A%20terminating%20on%20signal%2015%20from%20pid%5C%22%20AND%20tags%3A%5C%22screen-n-cpu.txt%5C%22&from=7d\n\nThis only fails in multinode jobs where we set an exact cpu model match between the guest and host.  I'm not sure why those tests aren't failing and the jobs are reporting success though.\n\nBut I noticed this from one of the failing snapshots:\n\nhttp://logs.openstack.org/34/283134/6/check/gate-tempest-dsvm-neutron-dvr-multinode-full/a1ab6f2/logs/subnode-2/screen-n-cpu.txt.gz?level=TRACE#_2016-03-05_11_39_37_887\n\n<cpu mode='custom' match='exact'>\n    <model fallback='allow'>gate64</model>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n\nI think the multinode jobs are the only ones where we require a specific cpu model and that's for live migration to work, i.e.:\n\nhttp://logs.openstack.org/34/283134/6/check/gate-tempest-dsvm-neutron-dvr-multinode-full/a1ab6f2/logs/subnode-2/etc/nova/nova.conf.txt.gz\n\n[libvirt]\ncpu_model = gate64\ninject_partition = -2\nlive_migration_uri = qemu+ssh://stack@%s/system\nuse_usb_tablet = False\ncpu_mode = custom\nvirt_type = kvm\n\nI was wondering about cpu modes between the host and guest because I saw this related forum:\n\nhttps://bbs.archlinux.org/viewtopic.php?id=159279\n\nWe should get Daniel Berrange (danpb in #openstack-nova in freenode IRC) to take a look at this.", 
            "date_created": "2016-03-05 18:17:16.528988+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "So the error is basically stating that the qemu process received a SIGTERM. Any way for us to find out what pid 15765 is? Well I mean the PID is constantly changing obviously, but some process is probably sending SIGTERM to qemu in the middle of the run. The error might lie elsewhere.", 
            "date_created": "2016-03-10 21:34:18.261694+00:00", 
            "author": "https://api.launchpad.net/1.0/~mjdoffma"
        }, 
        {
            "content": "OK, Matt Riedemann is right. Its almost certainly the libvirt process that is sending SIGTERM. Need to get Daniel Berrange to take a look at this. Its going to be difficult to debug as the issue is probably elsewhere in the libvirt code. (Not at the spot in the monitor code where the error is reported)", 
            "date_created": "2016-03-10 21:46:25.284303+00:00", 
            "author": "https://api.launchpad.net/1.0/~mjdoffma"
        }
    ]
}