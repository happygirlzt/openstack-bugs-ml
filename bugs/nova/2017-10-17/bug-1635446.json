{
    "status": "Fix Released", 
    "last_updated": "2016-12-07 10:45:32.027105+00:00", 
    "description": "The cluster goes to CREATE_FAILED\n\n# magnum $AUTH cluster-show k8s-cluster-fedora\n+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property            | Value                                                                                                                                                                                                                                                                                                                      |\n+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| status              | CREATE_FAILED                                                                                                                                                                                                                                                                                                              |\n| cluster_template_id | cd70e24d-717c-40b4-8bcf-fd56d0cf23bb                                                                                                                                                                                                                                                                                       |\n| uuid                | 5df0d9f3-de35-4557-881c-efac6bc7e489                                                                                                                                                                                                                                                                                       |\n| stack_id            | 497e8905-f425-454b-8f77-d87ff41cc7dd                                                                                                                                                                                                                                                                                       |\n| status_reason       | Resource CREATE failed: ClientException: resources.kube_minions.resources[0].resources.kube-minion: Unexpected API Error. Please report this at http: //bugs.launchpad.net/nova/ and attach the Nova API log if possible.                                                                                                  |\n|                     | <class 'oslo_db.exception.DBError'> (HTTP 500) (Request-ID: req-c064df25-a47c-439e-bdc5-99e1cfbd44c5)                                                                                                                                                                                                                      |\n| created_at          | 2016-10-20T22:26:28+00:00                                                                                                                                                                                                                                                                                                  |\n| name                | k8s-cluster-fedora                                                                                                                                                                                                                                                                                                         |\n| updated_at          | 2016-10-20T22:28:00+00:00                                                                                                                                                                                                                                                                                                  |\n| discovery_url       | https://discovery.etcd.io/703919614eb4688507382ff891fa86a9                                                                                                                                                                                                                                                                 |\n| faults              | {'0': \"ClientException: resources[0].resources.kube-minion: Unexpected API Error. Please report this at http: //bugs.launchpad.net/nova/ and attach the Nova API log if possible.                                                                                                                                          |\n|                     | <class 'oslo_db.exception.DBError'> (HTTP 500) (Request-ID: req-c064df25-a47c-439e-bdc5-99e1cfbd44c5)\", 'kube_minions': \"ClientException: resources.kube_minions.resources[0].resources.kube-minion: Unexpected API Error. Please report this at http: //bugs.launchpad.net/nova/ and attach the Nova API log if possible. |\n|                     | <class 'oslo_db.exception.DBError'> (HTTP 500) (Request-ID: req-c064df25-a47c-439e-bdc5-99e1cfbd44c5)\", 'kube-minion': \"ClientException: resources.kube-minion: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.                                       |\n|                     | <class 'oslo_db.exception.DBError'> (HTTP 500) (Request-ID: req-c064df25-a47c-439e-bdc5-99e1cfbd44c5)\"}                                                                                                                                                                                                                    |\n| api_address         | https://10.240.127.136:6443                                                                                                                                                                                                                                                                                                |\n| coe_version         | v1.2.0                                                                                                                                                                                                                                                                                                                     |\n| master_addresses    | ['10.240.127.136']                                                                                                                                                                                                                                                                                                         |\n| create_timeout      | 18000                                                                                                                                                                                                                                                                                                                      |\n| node_addresses      | ['10.240.127.141']                                                                                                                                                                                                                                                                                                         |\n| master_count        | 1                                                                                                                                                                                                                                                                                                                          |\n| container_version   | 1.9.1                                                                                                                                                                                                                                                                                                                      |\n| node_count          | 1                                                                                                                                                                                                                                                                                                                          |\n+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\nnova-api logs attached", 
    "tags": [
        "in-stable-newton"
    ], 
    "importance": "Critical", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1635446", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1635446, 
    "index": 283, 
    "openned": "2016-10-21 17:11:21.223888+00:00", 
    "created": "2016-10-20 22:44:21.361237+00:00", 
    "title": "DBError storing build_requests.instance with user_data too long", 
    "comments": [
        {
            "content": "The cluster goes to CREATE_FAILED\n\n# magnum $AUTH cluster-show k8s-cluster-fedora\n+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property            | Value                                                                                                                                                                                                                                                                                                                      |\n+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| status              | CREATE_FAILED                                                                                                                                                                                                                                                                                                              |\n| cluster_template_id | cd70e24d-717c-40b4-8bcf-fd56d0cf23bb                                                                                                                                                                                                                                                                                       |\n| uuid                | 5df0d9f3-de35-4557-881c-efac6bc7e489                                                                                                                                                                                                                                                                                       |\n| stack_id            | 497e8905-f425-454b-8f77-d87ff41cc7dd                                                                                                                                                                                                                                                                                       |\n| status_reason       | Resource CREATE failed: ClientException: resources.kube_minions.resources[0].resources.kube-minion: Unexpected API Error. Please report this at http: //bugs.launchpad.net/nova/ and attach the Nova API log if possible.                                                                                                  |\n|                     | <class 'oslo_db.exception.DBError'> (HTTP 500) (Request-ID: req-c064df25-a47c-439e-bdc5-99e1cfbd44c5)                                                                                                                                                                                                                      |\n| created_at          | 2016-10-20T22:26:28+00:00                                                                                                                                                                                                                                                                                                  |\n| name                | k8s-cluster-fedora                                                                                                                                                                                                                                                                                                         |\n| updated_at          | 2016-10-20T22:28:00+00:00                                                                                                                                                                                                                                                                                                  |\n| discovery_url       | https://discovery.etcd.io/703919614eb4688507382ff891fa86a9                                                                                                                                                                                                                                                                 |\n| faults              | {'0': \"ClientException: resources[0].resources.kube-minion: Unexpected API Error. Please report this at http: //bugs.launchpad.net/nova/ and attach the Nova API log if possible.                                                                                                                                          |\n|                     | <class 'oslo_db.exception.DBError'> (HTTP 500) (Request-ID: req-c064df25-a47c-439e-bdc5-99e1cfbd44c5)\", 'kube_minions': \"ClientException: resources.kube_minions.resources[0].resources.kube-minion: Unexpected API Error. Please report this at http: //bugs.launchpad.net/nova/ and attach the Nova API log if possible. |\n|                     | <class 'oslo_db.exception.DBError'> (HTTP 500) (Request-ID: req-c064df25-a47c-439e-bdc5-99e1cfbd44c5)\", 'kube-minion': \"ClientException: resources.kube-minion: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.                                       |\n|                     | <class 'oslo_db.exception.DBError'> (HTTP 500) (Request-ID: req-c064df25-a47c-439e-bdc5-99e1cfbd44c5)\"}                                                                                                                                                                                                                    |\n| api_address         | https://10.240.127.136:6443                                                                                                                                                                                                                                                                                                |\n| coe_version         | v1.2.0                                                                                                                                                                                                                                                                                                                     |\n| master_addresses    | ['10.240.127.136']                                                                                                                                                                                                                                                                                                         |\n| create_timeout      | 18000                                                                                                                                                                                                                                                                                                                      |\n| node_addresses      | ['10.240.127.141']                                                                                                                                                                                                                                                                                                         |\n| master_count        | 1                                                                                                                                                                                                                                                                                                                          |\n| container_version   | 1.9.1                                                                                                                                                                                                                                                                                                                      |\n| node_count          | 1                                                                                                                                                                                                                                                                                                                          |\n+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\nnova-api logs attached", 
            "date_created": "2016-10-20 22:44:21.361237+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhishek-i"
        }, 
        {
            "content": "", 
            "date_created": "2016-10-20 22:45:37.383361+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhishek-i"
        }, 
        {
            "content": "We did modify some of the scripts in fragments here and there. The image used is http://tarballs.openstack.org/magnum/images/fedora-atomic-f23-dib.qcow2", 
            "date_created": "2016-10-20 22:52:08.282526+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhishek-i"
        }, 
        {
            "content": "The instance column in the build_requests table in the nova_api db has the type TEXT, which is 65535 chars in Mariadb. The length of the blob that is in the nova api logs is around 67000 chars. This makes the db insert fail. This looks like more of a nova issue than magnum. In the case of Magnum, the workaround is to not include some of the SoftwareConfig files.", 
            "date_created": "2016-10-21 17:09:55.695576+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhishek-i"
        }, 
        {
            "content": "The instance is serialized into the build_requests table:\n\nhttps://github.com/openstack/nova/blob/14.0.1/nova/db/sqlalchemy/api_models.py#L243\n\nFrom the nova-api log attached to this bug, it looks like the user_data is blowing it up:\n\nhttps://github.com/openstack/nova/blob/14.0.1/nova/db/sqlalchemy/models.py#L281\n\nLooking at the models, the build_requests.instance column is Text and the instances.user_data is MediumText, so that needs to change.\n\nhttp://dev.mysql.com/doc/refman/5.7/en/string-type-overview.html", 
            "date_created": "2016-10-26 09:59:59.424651+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Patch: https://review.openstack.org/#/c/390812/", 
            "date_created": "2016-10-26 10:27:28.082456+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/391086", 
            "date_created": "2016-10-27 09:55:03.740384+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/390812\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=fd7b3d64c70eeae34dcf38a847180c60fddfed5c\nSubmitter: Jenkins\nBranch:    master\n\ncommit fd7b3d64c70eeae34dcf38a847180c60fddfed5c\nAuthor: Matt Riedemann <email address hidden>\nDate:   Wed Oct 26 06:23:42 2016 -0400\n\n    Make build_requests.instance MediumText\n    \n    The build_requests.instance column is a serialized\n    instance object, and the instances.user_data column\n    is MediumText, so the build_requests.instance column\n    itself needs to be at least MediumText in size for MySQL.\n    \n    Change-Id: I7d65df37c02750593037744543ad15e5bc64e913\n    Closes-Bug: #1635446\n", 
            "date_created": "2016-10-27 12:04:13.669765+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: stable/newton\nReview: https://review.openstack.org/391897", 
            "date_created": "2016-10-31 16:00:37.642904+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/391086\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=ee086460db947ea0dcd2cb27fd2aecf738b47c20\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit ee086460db947ea0dcd2cb27fd2aecf738b47c20\nAuthor: Matt Riedemann <email address hidden>\nDate:   Wed Oct 26 06:23:42 2016 -0400\n\n    Make build_requests.instance MediumText\n    \n    The build_requests.instance column is a serialized\n    instance object, and the instances.user_data column\n    is MediumText, so the build_requests.instance column\n    itself needs to be at least MediumText in size for MySQL.\n    \n    Conflicts:\n            nova/tests/functional/db/api/test_migrations.py\n    \n    NOTE(mriedem): The conflict is due to not having the 026\n    API DB migration test in newton.\n    \n    Change-Id: I7d65df37c02750593037744543ad15e5bc64e913\n    Closes-Bug: #1635446\n    (cherry picked from commit fd7b3d64c70eeae34dcf38a847180c60fddfed5c)\n", 
            "date_created": "2016-11-03 17:21:01.359240+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/391897\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=867661d51bdb0cf2a6f326cb18f26bbc1f04eb15\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit 867661d51bdb0cf2a6f326cb18f26bbc1f04eb15\nAuthor: Matt Riedemann <email address hidden>\nDate:   Mon Oct 31 11:54:30 2016 -0400\n\n    Add release note for bug 1635446\n    \n    Since we're adding a database schema migration in\n    a stable release, we should have a release note to\n    document it.\n    \n    Change-Id: Ic3f507efb3a5b39283f49ae36fc8fbd727b9d445\n    Related-Bug: #1635446\n", 
            "date_created": "2016-11-03 17:21:37.292025+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.2 release.", 
            "date_created": "2016-11-07 04:59:33.665382+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.2 release.", 
            "date_created": "2016-11-10 02:33:58.156939+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b1 development milestone.", 
            "date_created": "2016-11-17 13:12:01.976511+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.2 release.", 
            "date_created": "2016-12-07 10:45:31.453162+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-10-27 12:04:11.427586+00:00"
}