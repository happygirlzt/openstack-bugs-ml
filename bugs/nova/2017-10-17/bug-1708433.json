{
    "status": "Expired", 
    "last_updated": "2017-10-04 04:17:29.294829+00:00", 
    "description": "Trace back:\n\n2017-08-03 12:03:50.064 DEBUG nova.network.os_vif_util [req-f1414ec4-6df7-46d8-9c97-f678c0f94d77 demo admin] No conversion for VIF type hw_veb yet from (pid=134902) nova_to_osvif_vif /opt/stack/nova/nova/network/os_vif_util.py:435\n2017-08-03 12:03:50.119 ERROR oslo_messaging.rpc.server [req-f1414ec4-6df7-46d8-9c97-f678c0f94d77 demo admin] Exception during message handling: KeyError: 'pci_slot'\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 160, in _process_incoming\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 76, in wrapped\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     function_name, call_dict, binary)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 67, in wrapped\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 211, in decorated_function\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 199, in decorated_function\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 5166, in attach_interface\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     network_info[0])\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1443, in attach_interface\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     self.vif_driver.plug(instance, vif)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 794, in plug\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     func(instance, vif)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 650, in plug_hw_veb\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     vif['profile']['pci_slot'],\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server KeyError: 'pci_slot'\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server\n\nSteps to recreate:\n- Create a VM on the compute node of a multi-node deployment.\n- Attach an direct/macvtap bound SRIOV port:\n   openstack server add port VM1 port1\n\nResults:\n- The above traceback is found in the n-cpu service on the compute node.", 
    "tags": [
        "pci", 
        "sriov"
    ], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1708433", 
    "owner": "None", 
    "id": 1708433, 
    "index": 8237, 
    "openned": "2017-08-03 11:10:51.371930+00:00", 
    "created": "2017-08-03 11:10:51.371930+00:00", 
    "title": "Attaching sriov nic VM fail with keyError pci_slot", 
    "comments": [
        {
            "content": "Trace back:\n\n2017-08-03 12:03:50.064 DEBUG nova.network.os_vif_util [req-f1414ec4-6df7-46d8-9c97-f678c0f94d77 demo admin] No conversion for VIF type hw_veb yet from (pid=134902) nova_to_osvif_vif /opt/stack/nova/nova/network/os_vif_util.py:435\n2017-08-03 12:03:50.119 ERROR oslo_messaging.rpc.server [req-f1414ec4-6df7-46d8-9c97-f678c0f94d77 demo admin] Exception during message handling: KeyError: 'pci_slot'\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 160, in _process_incoming\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 76, in wrapped\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     function_name, call_dict, binary)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 67, in wrapped\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 211, in decorated_function\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 199, in decorated_function\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 5166, in attach_interface\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     network_info[0])\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1443, in attach_interface\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     self.vif_driver.plug(instance, vif)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 794, in plug\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     func(instance, vif)\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/vif.py\", line 650, in plug_hw_veb\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server     vif['profile']['pci_slot'],\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server KeyError: 'pci_slot'\n2017-08-03 12:03:50.119 TRACE oslo_messaging.rpc.server\n\nSteps to recreate:\n- Create a VM on the compute node of a multi-node deployment.\n- Attach an direct/macvtap bound SRIOV port:\n   openstack server add port VM1 port1\n\nResults:\n- The above traceback is found in the n-cpu service on the compute node.", 
            "date_created": "2017-08-03 11:10:51.371930+00:00", 
            "author": "https://api.launchpad.net/1.0/~helena-mcgough"
        }, 
        {
            "content": "is there a specific requirement on the kind of hardware used?\n\n\"No conversion for VIF type hw_veb yet\" starts the stack trace, so I wonder if it's an unknown type.", 
            "date_created": "2017-08-03 14:27:17.559693+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "this was done on a fortvile (intel XL710)\nthis should be a supported nic.\n\na slight update on the above is that we were able to boot vms with the sriov port if they were passed\non the nova boot commandline but this error occours if we try to attach an sriov port to a running vm.\n\nmy guess is that we are not populating the pci_slot in the port binding_profile when we call attache but we are when we boot with an sriov port.", 
            "date_created": "2017-08-04 10:23:38.360848+00:00", 
            "author": "https://api.launchpad.net/1.0/~sean-k-mooney"
        }, 
        {
            "content": "Is this related to https://blueprints.launchpad.net/nova/+spec/sriov-interface-attach-detach maybe?", 
            "date_created": "2017-08-04 10:49:48.343246+00:00", 
            "author": "https://api.launchpad.net/1.0/~jangutter"
        }, 
        {
            "content": "yes it is... i taught that was fixed litrally years ago.", 
            "date_created": "2017-08-04 11:49:07.769490+00:00", 
            "author": "https://api.launchpad.net/1.0/~sean-k-mooney"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2017-10-04 04:17:26.534665+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2017-10-04 04:17:27.143989+00:00"
}