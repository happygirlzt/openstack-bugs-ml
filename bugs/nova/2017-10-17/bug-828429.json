{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:10:13.491115+00:00", 
    "description": "Seems like a bug in nova-dhcpgridge.\n\nLogs show KeyError:\n2011-08-17 16:58:43,642 CRITICAL nova [-] u'interface'\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\", line 126, in <module>\n(nova): TRACE:     main()\n(nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\", line 119, in main\n(nova): TRACE:     \" on interface %(interface)s\") % locals()\n(nova): TRACE: KeyError: u'interface'\n\nThe code seems to access interface variable prior to any assignment:\n\n\u00a0\u00a0\u00a0\u00a0action = argv[1]\n\u00a0\u00a0\u00a0\u00a0if action in ['add', 'del', 'old']:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mac = argv[2]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ip = argv[3]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0msg = _(\"Called %(action)s for mac %(mac)s with ip %(ip)s\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\" on interface %(interface)s\") % locals()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LOG.debug(msg)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0globals()[action + '_lease'](mac, ip, interface)\n\u00a0\u00a0\u00a0\u00a0else:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0print init_leases(network_id)\n\n\nPrior to rev.1449 there was a definition for interface:\n\n    interface = os.environ.get('DNSMASQ_INTERFACE', FLAGS.dnsmasq_interface)", 
    "tags": [], 
    "importance": "High", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/828429", 
    "owner": "https://api.launchpad.net/1.0/~danwent", 
    "id": 828429, 
    "index": 453, 
    "openned": "2011-08-18 00:08:55.989338+00:00", 
    "created": "2011-08-18 00:08:55.989338+00:00", 
    "title": "nova-dhcpbridge: interface causes KeyError - bug added in v.1449", 
    "comments": [
        {
            "content": "Seems like a bug in nova-dhcpgridge.\n\nLogs show KeyError:\n2011-08-17 16:58:43,642 CRITICAL nova [-] u'interface'\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\", line 126, in <module>\n(nova): TRACE:     main()\n(nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\", line 119, in main\n(nova): TRACE:     \" on interface %(interface)s\") % locals()\n(nova): TRACE: KeyError: u'interface'\n\nThe code seems to access instance variable prior to any assignment:\n\n    action = argv[1]\n    if action in ['add', 'del', 'old']:\n        mac = argv[2]\n        ip = argv[3]\n        msg = _(\"Called %(action)s for mac %(mac)s with ip %(ip)s\"\n                \" on interface %(interface)s\") % locals()\n        LOG.debug(msg)\n        globals()[action + '_lease'](mac, ip, interface)\n    else:\n        print init_leases(network_id)", 
            "date_created": "2011-08-18 00:08:55.989338+00:00", 
            "author": "https://api.launchpad.net/1.0/~vladimir.p"
        }, 
        {
            "content": "Hi Vladimir, thanks for reporting this, it was definitely an oversight on my part.\n\nI'm actually curious to learn more about what deployment configuration you used such that branch of the code is invoked, as I want to make sure there is not other code i need to update.  The only part of nova code that I saw that invoked this script was in nova/network/linux_net.py, so I must be missing something.  ", 
            "date_created": "2011-08-18 05:20:50.809583+00:00", 
            "author": "https://api.launchpad.net/1.0/~danwent"
        }, 
        {
            "content": "Also, I associated a branch that should fix this issue if you want to give it a try.\n\nI since none of the add/del/old calls used network_id, I changed the code to only require that variable to be in the environment in the can of init.  ", 
            "date_created": "2011-08-18 05:32:42.114805+00:00", 
            "author": "https://api.launchpad.net/1.0/~danwent"
        }, 
        {
            "content": "Hi Dan,\n\nWe are not actually using this code (we don't call it). But it is one of services running. If I'm not mistaken dnsmasq is calling it and it is also setting different env variables.\n\n-Vladimir\n\n\nOn Aug 17, 2011, at 10:20 PM, dan wendlandt <email address hidden> wrote:\n\n> Hi Vladimir, thanks for reporting this, it was definitely an oversight\n> on my part.\n> \n> I'm actually curious to learn more about what deployment configuration\n> you used such that branch of the code is invoked, as I want to make sure\n> there is not other code i need to update.  The only part of nova code\n> that I saw that invoked this script was in nova/network/linux_net.py, so\n> I must be missing something.\n> \n> -- \n> You received this bug notification because you are subscribed to the bug\n> report.\n> https://bugs.launchpad.net/bugs/828429\n> \n> Title:\n>  nova-dhcpbridge: interface causes KeyError - bug added in v.1449\n> \n> Status in OpenStack Compute (Nova):\n>  In Progress\n> \n> Bug description:\n>  Seems like a bug in nova-dhcpgridge.\n> \n>  Logs show KeyError:\n>  2011-08-17 16:58:43,642 CRITICAL nova [-] u'interface'\n>  (nova): TRACE: Traceback (most recent call last):\n>  (nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\", line 126, in <module>\n>  (nova): TRACE:     main()\n>  (nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\", line 119, in main\n>  (nova): TRACE:     \" on interface %(interface)s\") % locals()\n>  (nova): TRACE: KeyError: u'interface'\n> \n>  The code seems to access interface variable prior to any assignment:\n> \n>      action = argv[1]\n>      if action in ['add', 'del', 'old']:\n>          mac = argv[2]\n>          ip = argv[3]\n>          msg = _(\"Called %(action)s for mac %(mac)s with ip %(ip)s\"\n>                  \" on interface %(interface)s\") % locals()\n>          LOG.debug(msg)\n>          globals()[action + '_lease'](mac, ip, interface)\n>      else:\n>          print init_leases(network_id)\n> \n> \n>  Prior to rev.1449 there was a definition for interface:\n> \n>      interface = os.environ.get('DNSMASQ_INTERFACE',\n>  FLAGS.dnsmasq_interface)\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/828429/+subscriptions\n", 
            "date_created": "2011-08-18 05:49:13+00:00", 
            "author": "https://api.launchpad.net/1.0/~vladimir.p"
        }, 
        {
            "content": "Yeah, dnsmasq calls this script, but in all of my testing it never called it\nin a way that triggered this bug, so I was trying to figure what use of nova\nactually triggered the bug for you (or did you just notice it via\ninspection?).  I will propose the merge as is, but I think we should really\ntry to add a realistic test that exercises that that code path, or remove\nthe code if it is truly vestigial.\n\nDan\n\n\nOn Wed, Aug 17, 2011 at 10:49 PM, Vladimir Popovski <\n<email address hidden>> wrote:\n\n> Hi Dan,\n>\n> We are not actually using this code (we don't call it). But it is one of\n> services running. If I'm not mistaken dnsmasq is calling it and it is\n> also setting different env variables.\n>\n> -Vladimir\n>\n>\n> On Aug 17, 2011, at 10:20 PM, dan wendlandt <email address hidden>\n> wrote:\n>\n> > Hi Vladimir, thanks for reporting this, it was definitely an oversight\n> > on my part.\n> >\n> > I'm actually curious to learn more about what deployment configuration\n> > you used such that branch of the code is invoked, as I want to make sure\n> > there is not other code i need to update.  The only part of nova code\n> > that I saw that invoked this script was in nova/network/linux_net.py, so\n> > I must be missing something.\n> >\n> > --\n> > You received this bug notification because you are subscribed to the bug\n> > report.\n> > https://bugs.launchpad.net/bugs/828429\n> >\n> > Title:\n> >  nova-dhcpbridge: interface causes KeyError - bug added in v.1449\n> >\n> > Status in OpenStack Compute (Nova):\n> >  In Progress\n> >\n> > Bug description:\n> >  Seems like a bug in nova-dhcpgridge.\n> >\n> >  Logs show KeyError:\n> >  2011-08-17 16:58:43,642 CRITICAL nova [-] u'interface'\n> >  (nova): TRACE: Traceback (most recent call last):\n> >  (nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\",\n> line 126, in <module>\n> >  (nova): TRACE:     main()\n> >  (nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\",\n> line 119, in main\n> >  (nova): TRACE:     \" on interface %(interface)s\") % locals()\n> >  (nova): TRACE: KeyError: u'interface'\n> >\n> >  The code seems to access interface variable prior to any assignment:\n> >\n> >      action = argv[1]\n> >      if action in ['add', 'del', 'old']:\n> >          mac = argv[2]\n> >          ip = argv[3]\n> >          msg = _(\"Called %(action)s for mac %(mac)s with ip %(ip)s\"\n> >                  \" on interface %(interface)s\") % locals()\n> >          LOG.debug(msg)\n> >          globals()[action + '_lease'](mac, ip, interface)\n> >      else:\n> >          print init_leases(network_id)\n> >\n> >\n> >  Prior to rev.1449 there was a definition for interface:\n> >\n> >      interface = os.environ.get('DNSMASQ_INTERFACE',\n> >  FLAGS.dnsmasq_interface)\n> >\n> > To manage notifications about this bug go to:\n> > https://bugs.launchpad.net/nova/+bug/828429/+subscriptions\n>\n> --\n> You received this bug notification because you are subscribed to the bug\n> report.\n> https://bugs.launchpad.net/bugs/828429\n>\n> Title:\n>  nova-dhcpbridge: interface causes KeyError - bug added in v.1449\n>\n> Status in OpenStack Compute (Nova):\n>  In Progress\n>\n> Bug description:\n>  Seems like a bug in nova-dhcpgridge.\n>\n>  Logs show KeyError:\n>  2011-08-17 16:58:43,642 CRITICAL nova [-] u'interface'\n>  (nova): TRACE: Traceback (most recent call last):\n>  (nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\",\n> line 126, in <module>\n>  (nova): TRACE:     main()\n>  (nova): TRACE:   File \"/home/vlad/cactus/vsa/nova/bin/nova-dhcpbridge\",\n> line 119, in main\n>  (nova): TRACE:     \" on interface %(interface)s\") % locals()\n>  (nova): TRACE: KeyError: u'interface'\n>\n>  The code seems to access interface variable prior to any assignment:\n>\n>      action = argv[1]\n>      if action in ['add', 'del', 'old']:\n>          mac = argv[2]\n>          ip = argv[3]\n>          msg = _(\"Called %(action)s for mac %(mac)s with ip %(ip)s\"\n>                  \" on interface %(interface)s\") % locals()\n>          LOG.debug(msg)\n>          globals()[action + '_lease'](mac, ip, interface)\n>      else:\n>          print init_leases(network_id)\n>\n>\n>  Prior to rev.1449 there was a definition for interface:\n>\n>      interface = os.environ.get('DNSMASQ_INTERFACE',\n>  FLAGS.dnsmasq_interface)\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/828429/+subscriptions\n>\n\n\n\n-- \n~~~~~~~~~~~~~~~~~~~~~~~~~~~\nDan Wendlandt\nNicira Networks, Inc.\nwww.nicira.com | www.openvswitch.org\nSr. Product Manager\ncell: 650-906-2650\n~~~~~~~~~~~~~~~~~~~~~~~~~~~\n", 
            "date_created": "2011-08-18 14:52:57+00:00", 
            "author": "https://api.launchpad.net/1.0/~danwent"
        }
    ], 
    "closed": "2011-09-22 13:10:12.144424+00:00"
}