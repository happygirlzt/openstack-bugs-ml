{
    "status": "Fix Released", 
    "last_updated": "2012-02-02 17:38:04.492087+00:00", 
    "description": "The argument parsing in nova-manage is (at least) not what the help-strings says it is...\n\nbin/nova-manage image image_register \nPossible wrong number of arguments supplied\nimage image_register: Uploads an image into the image_service\n        arguments: path owner [name] [is_public='T'] [architecture='x86_64']\n                   [kernel_id=None] [ramdisk_id=None]\n                   [disk_format='ami'] [container_format='ami']\n2011-03-23 11:35:55,641 CRITICAL nova [-] image_register() takes at least 3 arguments (1 given)\n\n(So that's the command line format we're claiming to support) \n\n\n bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 disk_format='raw' container_format='raw'\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'container_format=raw', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n\n(disk_format is lost, container_format is in architecture and messed up)\n\nbin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 disk_format='raw' container_format='raw' architecture='x86_64'\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'container_format=raw', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n2011-03-23 11:31:37,649 CRITICAL nova [-] invalid literal for int() with base 10: 'architecture=x86_64'\n\n(I think it's passing arguments based on position, not key, so architecture is being passed as kernel_id which is the third argument.  Also, the key=... prefix is not being stripped)\n\nbin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 T x86_64 None None raw raw\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': True, 'type': 'machine'}, 'disk_format': 'raw', 'name': 'ubuntu_x64_8g_2', 'container_format': 'raw'}\n2011-03-23 11:33:36,243 CRITICAL nova [-] invalid literal for int() with base 10: 'None'\n\n(Trying position based passing... can't pass None)\n\n\nbin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 T\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': True, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n^C2011-03-23 11:34:18,552 CRITICAL nova [-] \n bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 True\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n^C2011-03-23 11:34:23,170 CRITICAL nova [-] \n\n(Using position based passing; only 'T' is recognized for 'true'.  We should probably use a better boolean parsing function 0, F, False vs 1, T, True, all others are errors.)", 
    "tags": [], 
    "importance": "Low", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/741169", 
    "owner": "None", 
    "id": 741169, 
    "index": 138, 
    "openned": "2011-03-23 18:34:55.133565+00:00", 
    "created": "2011-03-23 18:34:55.133565+00:00", 
    "title": "nova-manage help text should be clearer about argument parsing", 
    "comments": [
        {
            "content": "The argument parsing in nova-manage is (at least) not what the help-strings says it is...\n\nbin/nova-manage image image_register \nPossible wrong number of arguments supplied\nimage image_register: Uploads an image into the image_service\n        arguments: path owner [name] [is_public='T'] [architecture='x86_64']\n                   [kernel_id=None] [ramdisk_id=None]\n                   [disk_format='ami'] [container_format='ami']\n2011-03-23 11:35:55,641 CRITICAL nova [-] image_register() takes at least 3 arguments (1 given)\n\n(So that's the command line format we're claiming to support) \n\n\n bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 disk_format='raw' container_format='raw'\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'container_format=raw', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n\n(disk_format is lost, container_format is in architecture and messed up)\n\nbin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 disk_format='raw' container_format='raw' architecture='x86_64'\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'container_format=raw', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n2011-03-23 11:31:37,649 CRITICAL nova [-] invalid literal for int() with base 10: 'architecture=x86_64'\n\n(I think it's passing arguments based on position, not key, so architecture is being passed as kernel_id which is the third argument.  Also, the key=... prefix is not being stripped)\n\nbin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 T x86_64 None None raw raw\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': True, 'type': 'machine'}, 'disk_format': 'raw', 'name': 'ubuntu_x64_8g_2', 'container_format': 'raw'}\n2011-03-23 11:33:36,243 CRITICAL nova [-] invalid literal for int() with base 10: 'None'\n\n(Trying position based passing... can't pass None)\n\n\nbin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 T\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': True, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n^C2011-03-23 11:34:18,552 CRITICAL nova [-] \n bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 True\nmachine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n^C2011-03-23 11:34:23,170 CRITICAL nova [-] \n\n(Using position based passing; only 'T' is recognized for 'true'.  We should probably use a better boolean parsing function 0, F, False vs 1, T, True, all others are errors.)", 
            "date_created": "2011-03-23 18:34:55.133565+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "I guess this isn't totally clear, but args are supposed to be passed positionally, There is no way to pass None, although you can pass an empty string ''.  One possible fix is to put the disk_format and container_format before kernel and ramdisk, since those are the only ones that need a None.  Omitting them will leave them as None.\n\nVish\n\nOn Mar 23, 2011, at 11:34 AM, justinsb wrote:\n\n> Public bug reported:\n> \n> The argument parsing in nova-manage is (at least) not what the help-\n> strings says it is...\n> \n> bin/nova-manage image image_register \n> Possible wrong number of arguments supplied\n> image image_register: Uploads an image into the image_service\n>        arguments: path owner [name] [is_public='T'] [architecture='x86_64']\n>                   [kernel_id=None] [ramdisk_id=None]\n>                   [disk_format='ami'] [container_format='ami']\n> 2011-03-23 11:35:55,641 CRITICAL nova [-] image_register() takes at least 3 arguments (1 given)\n> \n> (So that's the command line format we're claiming to support)\n> \n> \n> bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 disk_format='raw' container_format='raw'\n> machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'container_format=raw', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n> \n> (disk_format is lost, container_format is in architecture and messed up)\n> \n> bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 disk_format='raw' container_format='raw' architecture='x86_64'\n> machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'container_format=raw', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n> 2011-03-23 11:31:37,649 CRITICAL nova [-] invalid literal for int() with base 10: 'architecture=x86_64'\n> \n> (I think it's passing arguments based on position, not key, so\n> architecture is being passed as kernel_id which is the third argument.\n> Also, the key=... prefix is not being stripped)\n> \n> bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 T x86_64 None None raw raw\n> machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': True, 'type': 'machine'}, 'disk_format': 'raw', 'name': 'ubuntu_x64_8g_2', 'container_format': 'raw'}\n> 2011-03-23 11:33:36,243 CRITICAL nova [-] invalid literal for int() with base 10: 'None'\n> \n> (Trying position based passing... can't pass None)\n> \n> \n> bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 T\n> machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': True, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n> ^C2011-03-23 11:34:18,552 CRITICAL nova [-] \n> bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 True\n> machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n> ^C2011-03-23 11:34:23,170 CRITICAL nova [-] \n> \n> (Using position based passing; only 'T' is recognized for 'true'.  We\n> should probably use a better boolean parsing function 0, F, False vs 1,\n> T, True, all others are errors.)\n> \n> ** Affects: nova\n>     Importance: Undecided\n>         Status: New\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/741169\n> \n> Title:\n>  nova-manage argument parsing problems\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  The argument parsing in nova-manage is (at least) not what the help-\n>  strings says it is...\n> \n>  bin/nova-manage image image_register \n>  Possible wrong number of arguments supplied\n>  image image_register: Uploads an image into the image_service\n>          arguments: path owner [name] [is_public='T'] [architecture='x86_64']\n>                     [kernel_id=None] [ramdisk_id=None]\n>                     [disk_format='ami'] [container_format='ami']\n>  2011-03-23 11:35:55,641 CRITICAL nova [-] image_register() takes at least 3 arguments (1 given)\n> \n>  (So that's the command line format we're claiming to support)\n> \n> \n>   bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 disk_format='raw' container_format='raw'\n>  machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'container_format=raw', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n> \n>  (disk_format is lost, container_format is in architecture and messed\n>  up)\n> \n>  bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 disk_format='raw' container_format='raw' architecture='x86_64'\n>  machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'container_format=raw', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n>  2011-03-23 11:31:37,649 CRITICAL nova [-] invalid literal for int() with base 10: 'architecture=x86_64'\n> \n>  (I think it's passing arguments based on position, not key, so\n>  architecture is being passed as kernel_id which is the third argument.\n>  Also, the key=... prefix is not being stripped)\n> \n>  bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 T x86_64 None None raw raw\n>  machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': True, 'type': 'machine'}, 'disk_format': 'raw', 'name': 'ubuntu_x64_8g_2', 'container_format': 'raw'}\n>  2011-03-23 11:33:36,243 CRITICAL nova [-] invalid literal for int() with base 10: 'None'\n> \n>  (Trying position based passing... can't pass None)\n> \n> \n>  bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 T\n>  machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': True, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n>  ^C2011-03-23 11:34:18,552 CRITICAL nova [-] \n>   bin/nova-manage image image_register ~/images/ubuntu/ubuntu_x64_8g.raw justinsb ubuntu_x64_8g_2 True\n>  machine {'is_public': True, 'properties': {'image_location': 'local', 'image_state': 'available', 'architecture': 'x86_64', 'owner': 'justinsb', 'is_public': False, 'type': 'machine'}, 'disk_format': 'ami', 'name': 'ubuntu_x64_8g_2', 'container_format': 'ami'}\n>  ^C2011-03-23 11:34:23,170 CRITICAL nova [-] \n> \n>  (Using position based passing; only 'T' is recognized for 'true'.  We\n>  should probably use a better boolean parsing function 0, F, False vs\n>  1, T, True, all others are errors.)\n\n", 
            "date_created": "2011-03-23 20:03:42+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "OK.... the help text definitely needs to be changed to be more helpful if\nthat's the case.  Something like\n\nnova-manage [<container_format> [<image_format> [ ...\n\nor whatever it is.\n\n\nHowever, probably the right thing to do is to plug in a better arg parser,\nso we can do\n\nnova-manage --container_format=raw\n\nand not have to deal with re-ordering parameters function-by-function.\n", 
            "date_created": "2011-03-23 22:16:10+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "I'd fix the help text for Cactus and write a better parser for Diablo.", 
            "date_created": "2011-03-28 14:04:22.780985+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Seems better now:\n\n\n./tools/with_venv.sh ./bin/nova-manage image image_register\nPossible wrong number of arguments supplied\nUploads an image into the image_service\nUsage: nova-manage image image_register <args> [options]\n\nOptions:\n  -h, --help            show this help message and exit\n  --path=<path>         Image path\n  --owner=<owner>       Image owner\n  --name=<name>         Image name\n  --public=<'T'|'F'>    Image public or not\n  --arch=<arch>         Architecture\n  --cont_format=<container format>\n                        Container format(default bare)\n  --disk_format=<disk format>\n                        Disk format(default: raw)\n  --kernel=<kernel>     Kernel\n  --ram=<ramdisk>       RAM disk\n", 
            "date_created": "2012-02-02 17:08:31.279757+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }
    ], 
    "closed": "2012-02-02 17:08:38.149772+00:00"
}