{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:31:30.558859+00:00", 
    "description": "So resize doesn't work if you only have one nova-compute node (that's cool - I didn't know that - is it supposed too?)\n\nBut my instance gets stuck in RESIZE because of the errorhandling code failing to update the model back to \"ACTIVE\"\n\n2012-08-24 19:37:11 DEBUG nova.scheduler.host_manager [req-ecca475e-e4a2-4715-a271-65456dfe1d97 ed4bd089a2f449dca0828a2c42dbfb77 3f4884d9c31d4393a11158e09b816a5b] Host filter fails for ignored host squeeze from (pid=1372) passes_filters /opt/nova/nova/scheduler/host_manager.py:156\n2012-08-24 19:37:11 WARNING nova.scheduler.manager [req-ecca475e-e4a2-4715-a271-65456dfe1d97 ed4bd089a2f449dca0828a2c42dbfb77 3f4884d9c31d4393a11158e09b816a5b] Failed to schedule_prep_resize: No valid host was found. \n2012-08-24 19:37:11 WARNING nova.scheduler.manager [req-ecca475e-e4a2-4715-a271-65456dfe1d97 ed4bd089a2f449dca0828a2c42dbfb77 3f4884d9c31d4393a11158e09b816a5b] [instance: b] Setting instance to ACTIVE state.\n2012-08-24 19:37:11 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/scheduler/manager.py\", line 176, in prep_resize\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     context, ex, request_spec)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/scheduler/manager.py\", line 220, in _set_vm_state_and_notify\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     instance_uuid, updates)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/db/api.py\", line 675, in instance_update_and_get_original\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     values)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kwargs)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/db/sqlalchemy/api.py\", line 1753, in instance_update_and_get_original\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     copy_old_instance=True)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/db/sqlalchemy/api.py\", line 1763, in _instance_update\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     raise exception.InvalidUUID(instance_uuid)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp InvalidUUID: b\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp \n2012-08-24 19:37:32 DEBUG nova.manager [req-f36b9238-bbeb-44cf-b041-09ba054c2b68 None None] Running periodic task SchedulerManager._expire_reservations from (pid=1372) periodic_tasks /opt/nova/nova/manager.py:170\n\nLooks like scheduler.manager.SchedulerManager._set_vm_state_and_notify is expecting request_spec['instance_uuids'] to be a list (honestly I would sorta expect that too), but in nova.compute.api.API.resize, it seems like there was a \"recentish\" change to always include 'instance_uuids' on the request_spec, but it's just giving it a string (which can't be right, can it?).\n\nAttach patch seems to work ok for me with the stuff I tested, ymmv", 
    "tags": [
        "resize", 
        "schedule"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1041351", 
    "owner": "https://api.launchpad.net/1.0/~clay-gerrard", 
    "id": 1041351, 
    "index": 772, 
    "openned": "2012-08-24 19:45:15.035403+00:00", 
    "created": "2012-08-24 19:45:15.035403+00:00", 
    "title": "InvalidUUID on resize because of weird value in request_spec['instance_uuids']", 
    "comments": [
        {
            "content": "So resize doesn't work if you only have one nova-compute node (that's cool - I didn't know that - is it supposed too?)\n\nBut my instance gets stuck in RESIZE because of the errorhandling code failing to update the model back to \"ACTIVE\"\n\n2012-08-24 19:37:11 DEBUG nova.scheduler.host_manager [req-ecca475e-e4a2-4715-a271-65456dfe1d97 ed4bd089a2f449dca0828a2c42dbfb77 3f4884d9c31d4393a11158e09b816a5b] Host filter fails for ignored host squeeze from (pid=1372) passes_filters /opt/nova/nova/scheduler/host_manager.py:156\n2012-08-24 19:37:11 WARNING nova.scheduler.manager [req-ecca475e-e4a2-4715-a271-65456dfe1d97 ed4bd089a2f449dca0828a2c42dbfb77 3f4884d9c31d4393a11158e09b816a5b] Failed to schedule_prep_resize: No valid host was found. \n2012-08-24 19:37:11 WARNING nova.scheduler.manager [req-ecca475e-e4a2-4715-a271-65456dfe1d97 ed4bd089a2f449dca0828a2c42dbfb77 3f4884d9c31d4393a11158e09b816a5b] [instance: b] Setting instance to ACTIVE state.\n2012-08-24 19:37:11 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/scheduler/manager.py\", line 176, in prep_resize\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     context, ex, request_spec)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/scheduler/manager.py\", line 220, in _set_vm_state_and_notify\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     instance_uuid, updates)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/db/api.py\", line 675, in instance_update_and_get_original\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     values)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kwargs)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/db/sqlalchemy/api.py\", line 1753, in instance_update_and_get_original\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     copy_old_instance=True)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp   File \"/opt/nova/nova/db/sqlalchemy/api.py\", line 1763, in _instance_update\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp     raise exception.InvalidUUID(instance_uuid)\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp InvalidUUID: b\n2012-08-24 19:37:11 TRACE nova.openstack.common.rpc.amqp \n2012-08-24 19:37:32 DEBUG nova.manager [req-f36b9238-bbeb-44cf-b041-09ba054c2b68 None None] Running periodic task SchedulerManager._expire_reservations from (pid=1372) periodic_tasks /opt/nova/nova/manager.py:170\n\nLooks like scheduler.manager.SchedulerManager._set_vm_state_and_notify is expecting request_spec['instance_uuids'] to be a list (honestly I would sorta expect that too), but in nova.compute.api.API.resize, it seems like there was a \"recentish\" change to always include 'instance_uuids' on the request_spec, but it's just giving it a string (which can't be right, can it?).\n\nAttach patch seems to work ok for me with the stuff I tested, ymmv", 
            "date_created": "2012-08-24 19:45:15.035403+00:00", 
            "author": "https://api.launchpad.net/1.0/~clay-gerrard"
        }, 
        {
            "content": "", 
            "date_created": "2012-08-24 19:45:15.035403+00:00", 
            "author": "https://api.launchpad.net/1.0/~clay-gerrard"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/11960", 
            "date_created": "2012-08-24 22:58:07.051773+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/11960\nCommitted: http://github.com/openstack/nova/commit/8ac2e27143b8961b2746514e3df605f1f3b7fb52\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8ac2e27143b8961b2746514e3df605f1f3b7fb52\nAuthor: Clay Gerrard <email address hidden>\nDate:   Fri Aug 24 17:54:20 2012 -0500\n\n    request_spec['instance_uuids'] as list in resize\n    \n    Wrap instance['uuid'] in a list when building request_spec in\n    compute.api before sending it across to the scheduler on resize\n    \n    regression introduced in I63bbc98c285faebec53f8e62857c01548807db68\n    \n    fixes bug 1041351\n    \n    Change-Id: I7cad8316171798e240bf78999cb94730c587a904\n", 
            "date_created": "2012-08-27 20:04:51.714498+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-09-19 06:34:16.698010+00:00"
}