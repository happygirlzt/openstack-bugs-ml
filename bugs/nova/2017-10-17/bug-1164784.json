{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:35:16.758782+00:00", 
    "description": "Get the following error when deleting an instance in consoleauth logs\n\n2013-04-05 10:56:38 19753 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/consoleauth/manager.py\", line 118, in delete_tokens_for_instance\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/memcache.py\", line 421, in delete\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp     self.check_key(key)\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/memcache.py\", line 1014, in check_key\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp     \"Keys must be str()'s, not unicode.  Convert your unicode \"\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp MemcachedStringEncodingError: Keys must be str()'s, not unicode.  Convert your unicode strings using mystring.encode(charset)!\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp \n2013-04-05 10:56:38 19753 ERROR nova.openstack.common.rpc.common [-] Returning exception Keys must be str()'s, not unicode.  Convert your unicode strings using mystring.encode(charset)! to caller\n2013-04-05 10:56:38 19753 ERROR nova.openstack.common.rpc.common [-] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\\n    return getattr(proxyobj, method)(ctxt, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/consoleauth/manager.py\", line 118, in delete_tokens_for_instance\\n', '  File \"/usr/lib/python2.7/dist-packages/memcache.py\", line 421, in delete\\n    self.check_key(key)\\n', '  File \"/usr/lib/python2.7/dist-packages/memcache.py\", line 1014, in check_key\\n    \"Keys must be str()\\'s, not unicode.  Convert your unicode \"\\n', \"MemcachedStringEncodingError: Keys must be str()'s, not unicode.  Convert your unicode strings using mystring.encode(charset)!\\n\"]\n\n\n\nNote this is practically the same as bug 1057279 \nIt would be good if we could integrate memcache into our testing somehow to prevent these things from happening.", 
    "tags": [], 
    "importance": "High", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1164784", 
    "owner": "https://api.launchpad.net/1.0/~stanislaw-pitucha", 
    "id": 1164784, 
    "index": 1048, 
    "openned": "2013-04-05 00:20:46.700563+00:00", 
    "created": "2013-04-05 00:20:46.700563+00:00", 
    "title": "console auth does not work with memcache, unicode error (again) ", 
    "comments": [
        {
            "content": "Get the following error when deleting an instance in consoleauth logs\n\n2013-04-05 10:56:38 19753 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/consoleauth/manager.py\", line 118, in delete_tokens_for_instance\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/memcache.py\", line 421, in delete\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp     self.check_key(key)\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/memcache.py\", line 1014, in check_key\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp     \"Keys must be str()'s, not unicode.  Convert your unicode \"\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp MemcachedStringEncodingError: Keys must be str()'s, not unicode.  Convert your unicode strings using mystring.encode(charset)!\n2013-04-05 10:56:38 19753 TRACE nova.openstack.common.rpc.amqp \n2013-04-05 10:56:38 19753 ERROR nova.openstack.common.rpc.common [-] Returning exception Keys must be str()'s, not unicode.  Convert your unicode strings using mystring.encode(charset)! to caller\n2013-04-05 10:56:38 19753 ERROR nova.openstack.common.rpc.common [-] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\\n    return getattr(proxyobj, method)(ctxt, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/consoleauth/manager.py\", line 118, in delete_tokens_for_instance\\n', '  File \"/usr/lib/python2.7/dist-packages/memcache.py\", line 421, in delete\\n    self.check_key(key)\\n', '  File \"/usr/lib/python2.7/dist-packages/memcache.py\", line 1014, in check_key\\n    \"Keys must be str()\\'s, not unicode.  Convert your unicode \"\\n', \"MemcachedStringEncodingError: Keys must be str()'s, not unicode.  Convert your unicode strings using mystring.encode(charset)!\\n\"]\n\n\n\nNote this is practically the same as bug 1057279 \nIt would be good if we could integrate memcache into our testing somehow to prevent these things from happening.", 
            "date_created": "2013-04-05 00:20:46.700563+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "https://review.openstack.org/#/c/26178/", 
            "date_created": "2013-04-05 05:50:24.384024+00:00", 
            "author": "https://api.launchpad.net/1.0/~sorrison"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/26178\nCommitted: http://github.com/openstack/nova/commit/6dadf73305c0a3d779dd625a8349b4a7341df18d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6dadf73305c0a3d779dd625a8349b4a7341df18d\nAuthor: Sam Morrison <email address hidden>\nDate:   Fri Apr 5 11:41:42 2013 +1100\n\n    Encode consoleauth token in utf-8 to make it a str\n    \n    This is needed for memcached backend, because the key cannot be a\n    unicode object in any of the exposed functions.\n    \n    Fixes bug 1164784\n    \n    Co-authored-by: Stanislaw Pitucha <email address hidden>\n    \n    Change-Id: Ieb1429116d96eefe97564fe92631063dc16117cb\n", 
            "date_created": "2013-04-23 19:37:43.470764+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/27375", 
            "date_created": "2013-04-23 19:50:05.604087+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/27375\nCommitted: http://github.com/openstack/nova/commit/1168873de8e01716558b96b179aca70af44ff28a\nSubmitter: Jenkins\nBranch:    stable/grizzly\n\ncommit 1168873de8e01716558b96b179aca70af44ff28a\nAuthor: Sam Morrison <email address hidden>\nDate:   Fri Apr 5 11:41:42 2013 +1100\n\n    Encode consoleauth token in utf-8 to make it a str\n    \n    This is needed for memcached backend, because the key cannot be a\n    unicode object in any of the exposed functions.\n    \n    Fixes bug 1164784\n    \n    Co-authored-by: Stanislaw Pitucha <email address hidden>\n    \n    Change-Id: Ieb1429116d96eefe97564fe92631063dc16117cb\n    (cherry picked from commit 6dadf73305c0a3d779dd625a8349b4a7341df18d)\n", 
            "date_created": "2013-04-27 14:33:18.929009+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-05-29 10:17:03.154373+00:00"
}