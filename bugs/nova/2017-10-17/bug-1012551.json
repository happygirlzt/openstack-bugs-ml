{
    "status": "Fix Released", 
    "last_updated": "2013-07-19 20:42:42.517138+00:00", 
    "description": "Hi \n\nI think there is a bug of nova .\nThe situation is :\n\nWhen I try to boot a instance first time , it report spawning error , The reason is My compute-node don't support kvm virtuallization , So I use qemu instead , Of course it work well after change . BUT when I try to delete the error instance , It cannot be deleted , stay at deleting .\n\nI found the reason is libvirt cannot find the error instance nova created before , The libvirt raise error when it try to create instance But store instance info into db , . So when we want to delete the error instance , the instance cannot be found by libvirt , So it cannot be destroy of course .\n\nAlso found that , the Domain XML in two place .\nOne is in /var/lib/nova/instance/instance-xxxxx/libvirt.xml which maybe create by nova I think\nThe other is in /etc/libvirt/qemu/instance-xxxxx.xml which maybe create by libvirt I think\n\nI found the error instance's domain config xml only exist in  /var/lib/nova/instance/\nThe active instance's xml in both  /var/lib/nova/instance/ and  /etc/libvirt/qemu/\n\nfinally , I have to change the db manually so that this error instance record look like terminated . and it work .\n\nMy openstack version :\n#nova-manage version\n2012.1 (2012.1-LOCALBRANCH:LOCALREVISION)\n\n\n\nThank you", 
    "tags": [
        "canonistack"
    ], 
    "importance": "Medium", 
    "heat": 50, 
    "link": "https://bugs.launchpad.net/nova/+bug/1012551", 
    "owner": "None", 
    "id": 1012551, 
    "index": 2938, 
    "openned": "2012-06-13 08:16:02.477211+00:00", 
    "created": "2012-06-13 08:16:02.477211+00:00", 
    "title": "Cannot delete instance in ERROR status", 
    "comments": [
        {
            "content": "Hi \n\nI think there is a bug of nova .\nThe situation is :\n\nWhen I try to boot a instance first time , it report spawning error , The reason is My compute-node don't support kvm virtuallization , So I use qemu instead , Of course it work well after change . BUT when I try to delete the error instance , It cannot be deleted , stay at deleting .\n\nI found the reason is libvirt cannot find the error instance nova created before , The libvirt raise error when it try to create instance But store instance info into db , . So when we want to delete the error instance , the instance cannot be found by libvirt , So it cannot be destroy of course .\n\nAlso found that , the Domain XML in two place .\nOne is in /var/lib/nova/instance/instance-xxxxx/libvirt.xml which maybe create by nova I think\nThe other is in /etc/libvirt/qemu/instance-xxxxx.xml which maybe create by libvirt I think\n\nI found the error instance's domain config xml only exist in  /var/lib/nova/instance/\nThe active instance's xml in both  /var/lib/nova/instance/ and  /etc/libvirt/qemu/\n\nfinally , I have to change the db manually so that this error instance record look like terminated . and it work .\n\nMy openstack version :\n#nova-manage version\n2012.1 (2012.1-LOCALBRANCH:LOCALREVISION)\n\n\n\nThank you", 
            "date_created": "2012-06-13 08:16:02.477211+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyzforpro"
        }, 
        {
            "content": "I'm unable to reproduce the problem.  I'm using Ubuntu 12.04 Precuse amd64, I had qemu and kvm installed and devstack on TRUNK.  It supports both kvm and qemu, so I did 'apt-get purge kvm' to remove kvm support.  I then verified nova.conf has 'libvirt_type=kvm' set, restarted nova-compute.  nova boot instance attempt resulted in 'ERROR' when nova list , which I assume is desired.   I then set nova.conf 'libvirt_type=qemu', restarted nova-compute.   I was then able to nova delete vmname as well as nova boot another vm successfully.  Therefore, was unable to reproduce the problem.", 
            "date_created": "2012-07-06 18:54:44.734994+00:00", 
            "author": "https://api.launchpad.net/1.0/~jtran"
        }, 
        {
            "content": "I can confirm this error. It has nothing to do with KVM vs. qemu. It's as the OP suggested.", 
            "date_created": "2012-09-05 01:22:18.187917+00:00", 
            "author": "https://api.launchpad.net/1.0/~mcweels"
        }, 
        {
            "content": "I am encountering same error. Can not delete the VM stuck in error state. I suspect it has something to do with KVM qemu switch. I am on VM and was previously configured to use KVM. Tried to create instances and failer.. error message. Now I changed to qemu ( sine I am running it on VM). Now I am unable to delete some of the old instances, which I believe were created when I was configured to use KVM. \n\nAlso, another issue I am facing on this system is that as soon as I issue the boot command is caused some to crash and later my IP address for eth0 interface changed from IPv4 to an IPv6 address, terminal connection were terminated due to network connectivity issue.. Also", 
            "date_created": "2012-10-08 08:18:08.554586+00:00", 
            "author": "https://api.launchpad.net/1.0/~mukul-j"
        }, 
        {
            "content": "You can reproduce this problem very quickly on a freshly installed Ubuntu 12.04 system with Folsom by following the user manual line for line due to bug #1064749", 
            "date_created": "2012-10-10 09:14:57.726638+00:00", 
            "author": "https://api.launchpad.net/1.0/~cardoe"
        }, 
        {
            "content": "Here's the debug info from Folsom.\n\n$ nova --debug delete 3935bacf-63c5-4b19-9375-f067d75d56e6\n\nREQ: curl -i http://192.168.200.135:35357/v2.0/tokens -X POST -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"User-Agent: python-novaclient\" -d '{\"auth\": {\"tenantName\": \"dev\", \"passwordCredentials\": {\"username\": \"admin\", \"password\": \"dev\"}}}'\n\nconnect: (192.168.200.135, 35357)\nsend: 'POST /v2.0/tokens HTTP/1.1\\r\\nHost: 192.168.200.135:35357\\r\\nContent-Length: 102\\r\\ncontent-type: application/json\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n{\"auth\": {\"tenantName\": \"dev\", \"passwordCredentials\": {\"username\": \"admin\", \"password\": \"dev\"}}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: Vary: X-Auth-Token\nheader: Content-Type: application/json\nheader: Date: Tue, 09 Oct 2012 23:34:02 GMT\nheader: Transfer-Encoding: chunked\nRESP:{'date': 'Tue, 09 Oct 2012 23:34:02 GMT', 'transfer-encoding': 'chunked', 'status': '200', 'content-type': 'application/json', 'vary': 'X-Auth-Token'} {\"access\": {\"token\": {\"expires\": \"2012-10-10T23:34:01Z\", \"id\": \"9545eac2bd254984805be5c6f65a943a\", \"tenant\": {\"enabled\": true, \"description\": \"EA development\", \"name\": \"dev\", \"id\": \"5aa21f92483b441f89b844421b639f9c\"}}, \"serviceCatalog\": [{\"endpoints\": [{\"adminURL\": \"http://192.168.200.135:8774/v2/5aa21f92483b441f89b844421b639f9c\", \"region\": \"Developers\", \"internalURL\": \"http://192.168.200.135:8774/v2/5aa21f92483b441f89b844421b639f9c\", \"id\": \"da16351759e0471c928e313ecf1541cd\", \"publicURL\": \"http://192.168.200.135:8774/v2/5aa21f92483b441f89b844421b639f9c\"}], \"endpoints_links\": [], \"type\": \"compute\", \"name\": \"nova\"}, {\"endpoints\": [{\"adminURL\": \"http://192.168.200.135:9292/v1\", \"region\": \"Developers\", \"internalURL\": \"http://192.168.200.135:9292/v1\", \"id\": \"618b8e6304c1460fa0c71db565975420\", \"publicURL\": \"http://192.168.200.135:9292/v1\"}], \"endpoints_links\": [], \"type\": \"image\", \"name\": \"glance\"}, {\"endpoints\": [{\"adminURL\": \"http://192.168.200.135:8776/v1/5aa21f92483b441f89b844421b639f9c\", \"region\": \"Developers\", \"internalURL\": \"http://192.168.200.135:8776/v1/5aa21f92483b441f89b844421b639f9c\", \"id\": \"1889f0b8fefa4049852427e379b2e189\", \"publicURL\": \"http://192.168.200.135:8776/v1/5aa21f92483b441f89b844421b639f9c\"}], \"endpoints_links\": [], \"type\": \"volume\", \"name\": \"volume\"}, {\"endpoints\": [{\"adminURL\": \"http://192.168.200.135:8773/services/Admin\", \"region\": \"Developers\", \"internalURL\": \"http://192.168.200.135:8773/services/Cloud\", \"id\": \"171b68c50bbf4077869aa36a1daeda6b\", \"publicURL\": \"http://192.168.200.135:8773/services/Cloud\"}], \"endpoints_links\": [], \"type\": \"ec2\", \"name\": \"ec2\"}, {\"endpoints\": [{\"adminURL\": \"http://192.168.200.135:8888/v1\", \"region\": \"Developers\", \"internalURL\": \"http://192.168.200.135:8888/v1/AUTH_5aa21f92483b441f89b844421b639f9c\", \"id\": \"4e74115c6d004c9e8e70c0624a1b498a\", \"publicURL\": \"http://192.168.200.135:8888/v1/AUTH_5aa21f92483b441f89b844421b639f9c\"}], \"endpoints_links\": [], \"type\": \"object-store\", \"name\": \"swift\"}, {\"endpoints\": [{\"adminURL\": \"http://192.168.200.135:35357/v2.0\", \"region\": \"Developers\", \"internalURL\": \"http://192.168.200.135:5000/v2.0\", \"id\": \"f26bb12c650747efb3e3838b6da0bb6d\", \"publicURL\": \"http://192.168.200.135:5000/v2.0\"}], \"endpoints_links\": [], \"type\": \"identity\", \"name\": \"keystone\"}], \"user\": {\"username\": \"admin\", \"roles_links\": [], \"id\": \"ace5f6119a6d43778da4c2181a3ef306\", \"roles\": [{\"name\": \"admin\"}], \"name\": \"admin\"}, \"metadata\": {\"is_admin\": 0, \"roles\": [\"00b8179d4c674fbfb9df5b821aaf3f83\"]}}}\n\n\nREQ: curl -i http://192.168.200.135:8774/v2/5aa21f92483b441f89b844421b639f9c/servers/3935bacf-63c5-4b19-9375-f067d75d56e6 -X GET -H \"X-Auth-Project-Id: dev\" -H \"User-Agent: python-novaclient\" -H \"Accept: application/json\" -H \"X-Auth-Token: 9545eac2bd254984805be5c6f65a943a\"\n\nconnect: (192.168.200.135, 8774)\nsend: u'GET /v2/5aa21f92483b441f89b844421b639f9c/servers/3935bacf-63c5-4b19-9375-f067d75d56e6 HTTP/1.1\\r\\nHost: 192.168.200.135:8774\\r\\nx-auth-project-id: dev\\r\\nx-auth-token: 9545eac2bd254984805be5c6f65a943a\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: X-Compute-Request-Id: req-854e4a01-36f2-4800-899b-dc37bb13fa10\nheader: Content-Type: application/json\nheader: Content-Length: 1476\nheader: Date: Tue, 09 Oct 2012 23:34:02 GMT\nRESP:{'status': '200', 'content-length': '1476', 'content-location': u'http://192.168.200.135:8774/v2/5aa21f92483b441f89b844421b639f9c/servers/3935bacf-63c5-4b19-9375-f067d75d56e6', 'x-compute-request-id': 'req-854e4a01-36f2-4800-899b-dc37bb13fa10', 'date': 'Tue, 09 Oct 2012 23:34:02 GMT', 'content-type': 'application/json'} {\"server\": {\"status\": \"ERROR\", \"updated\": \"2012-10-09T23:13:39Z\", \"hostId\": \"c5a32de0acc09c5e6a74b1c7679b85d2a418a3c6ea58147888ba8fe5\", \"OS-EXT-SRV-ATTR:host\": \"sloth\", \"addresses\": {\"private\": []}, \"links\": [{\"href\": \"http://192.168.200.135:8774/v2/5aa21f92483b441f89b844421b639f9c/servers/3935bacf-63c5-4b19-9375-f067d75d56e6\", \"rel\": \"self\"}, {\"href\": \"http://192.168.200.135:8774/5aa21f92483b441f89b844421b639f9c/servers/3935bacf-63c5-4b19-9375-f067d75d56e6\", \"rel\": \"bookmark\"}], \"key_name\": \"doug-pikewerks\", \"image\": {\"id\": \"f1736056-47ba-49f8-b451-6272595045d6\", \"links\": [{\"href\": \"http://192.168.200.135:8774/5aa21f92483b441f89b844421b639f9c/images/f1736056-47ba-49f8-b451-6272595045d6\", \"rel\": \"bookmark\"}]}, \"OS-EXT-STS:task_state\": \"deleting\", \"OS-EXT-STS:vm_state\": \"error\", \"OS-EXT-SRV-ATTR:instance_name\": \"instance-00000004\", \"OS-EXT-SRV-ATTR:hypervisor_hostname\": \"sloth\", \"flavor\": {\"id\": \"1\", \"links\": [{\"href\": \"http://192.168.200.135:8774/5aa21f92483b441f89b844421b639f9c/flavors/1\", \"rel\": \"bookmark\"}]}, \"id\": \"3935bacf-63c5-4b19-9375-f067d75d56e6\", \"security_groups\": [{\"name\": \"default\"}], \"user_id\": \"397ebab0d7de4e7bb285bbefc7e78dce\", \"name\": \"YATI\", \"created\": \"2012-10-09T22:47:49Z\", \"tenant_id\": \"5aa21f92483b441f89b844421b639f9c\", \"OS-DCF:diskConfig\": \"MANUAL\", \"accessIPv4\": \"\", \"accessIPv6\": \"\", \"fault\": {\"message\": \"Timeout\", \"code\": 500, \"created\": \"2012-10-09T23:33:34Z\"}, \"OS-EXT-STS:power_state\": 0, \"config_drive\": \"\", \"metadata\": {}}}\n\n\nREQ: curl -i http://192.168.200.135:8774/v2/5aa21f92483b441f89b844421b639f9c/servers/3935bacf-63c5-4b19-9375-f067d75d56e6 -X DELETE -H \"X-Auth-Project-Id: dev\" -H \"User-Agent: python-novaclient\" -H \"Accept: application/json\" -H \"X-Auth-Token: 9545eac2bd254984805be5c6f65a943a\"\n\nsend: u'DELETE /v2/5aa21f92483b441f89b844421b639f9c/servers/3935bacf-63c5-4b19-9375-f067d75d56e6 HTTP/1.1\\r\\nHost: 192.168.200.135:8774\\r\\nx-auth-project-id: dev\\r\\nx-auth-token: 9545eac2bd254984805be5c6f65a943a\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n'\nreply: 'HTTP/1.1 204 No Content\\r\\n'\nheader: Content-Length: 0\nheader: X-Compute-Request-Id: req-a1efad67-e227-41d5-9b71-8597ff14a93e\nheader: Content-Type: application/json\nheader: Date: Tue, 09 Oct 2012 23:34:02 GMT\nRESP:{'date': 'Tue, 09 Oct 2012 23:34:02 GMT', 'status': '204', 'content-length': '0', 'content-type': 'application/json', 'x-compute-request-id': 'req-a1efad67-e227-41d5-9b71-8597ff14a93e'} \n\nAt this point it returns to the shell prompt.", 
            "date_created": "2012-10-10 14:44:15.092597+00:00", 
            "author": "https://api.launchpad.net/1.0/~cardoe"
        }, 
        {
            "content": "As pointed out to me by ev0ldave in #openstack the way to fix this is to figure out exactly what the instance ID is.\n\n$ mysql -u root -p\nmysql> USE nova;\nmysql> SELECT id, host, hostname FROM instances;\n...\nmysql> UPDATE instances SET deleted=1, deleted_at=\"2012-10-10 14:56:30\", vm_state=\"deleted\" WHERE id = 240;\n...\nmysql> quit;\n\n$ sudo rm -rf /var/lib/nova/instances/instance-00000240\n\nSolves the issue assuming your bad instance is ID 240. Rinse and repeat for each instance.\n\nIt'd be nice to programatically fix this.", 
            "date_created": "2012-10-10 18:42:31.888509+00:00", 
            "author": "https://api.launchpad.net/1.0/~cardoe"
        }, 
        {
            "content": "I am not able to reproduce this at all on Grizzly. ", 
            "date_created": "2013-03-18 19:51:07.129778+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "I am not able to reproduce this at all on Grizzly. ", 
            "date_created": "2013-03-18 19:51:21.200084+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "It's also happening in Grizzly release (nova).:\nroot@control01:/home/user1# nova delete vm1-acc68897-1155-45c8-b8e8-37e27a9899bd\nHTTPConnectionPool(host='192.168.220.40', port=8774): Max retries exceeded with url: /v2/e54c7f63e9284138ad207559ca4a40e4/servers/acc68897-1155-45c8-b8e8-37e27a9899bd\n\nand the VM is stuck in the error state or just stays in \"Deleting\" state...\n\nwhere is this fixed? in the nova-client code or in Horizon?\n\nThank you,\nAbdi", 
            "date_created": "2013-07-19 20:42:40.654357+00:00", 
            "author": "https://api.launchpad.net/1.0/~abdi-w"
        }
    ], 
    "closed": "2013-03-19 13:45:54.164805+00:00"
}