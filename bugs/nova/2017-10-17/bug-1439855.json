{
    "status": "Confirmed", 
    "last_updated": "2017-06-02 15:23:05.115706+00:00", 
    "description": "When running the following tempest tests an error occurs in n-cpu:\n\ntempest.scenario.test_encrypted_cinder_volumes.TestEncryptedCinderVolumes.test_encrypted_cinder_volumes_cryptsetup\ntest_encrypted_cinder_volumes_luks\n\nThis occurred when using devstack with nova at:\n\nHEAD is now at d0c2684 Merge \"libvirt: Resize down an instance booted from a volume\"\n\nBoth stack traces below are from n-cpu logs:\n\nStack Trace (tempest.scenario.test_encrypted_cinder_volumes.TestEncryptedCinderVolumes.test_encrypted_cinder_volumes_cryptsetup):\n\n2015-03-27 18:03:07.990 ERROR nova.compute.manager [req-cc941973-c038-4bac-a5ca-d516cd5dd33d TestEncryptedCinderVolumes-658052177 TestEncryptedCinderVolumes-1476988517] [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Failed to attach 2ab47be7-64ac-4d34-a38c-59c5e97e2ec2 at /dev/vdb\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Traceback (most recent call last):\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 4735, in _attach_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     do_check_attach=False, do_driver_attach=True)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/block_device.py\", line 48, in wrapped\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     ret_val = method(obj, context, *args, **kwargs)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/block_device.py\", line 260, in attach\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     connector)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     six.reraise(self.type_, self.value, self.tb)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/block_device.py\", line 251, in attach\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     device_type=self['device_type'], encryption=encryption)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1065, in attach_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     self._disconnect_volume(connection_info, disk_dev)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     six.reraise(self.type_, self.value, self.tb)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1052, in attach_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     encryptor.attach_volume(context, **encryption)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/volume/encryptors/cryptsetup.py\", line 86, in attach_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     self._open_volume(passphrase, **kwargs)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/volume/encryptors/cryptsetup.py\", line 71, in _open_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     check_exit_code=True, run_as_root=True)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/utils.py\", line 206, in execute\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     return processutils.execute(*cmd, **kwargs)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/processutils.py\", line 233, in execute\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     cmd=sanitized_cmd)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] ProcessExecutionError: Unexpected error while running command.\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf cryptsetup create --key-file=- --cipher aes-xts-plain64 --key-size 512 ip-10.52.1.17:3260-iscsi-iqn.2003-10.com.lefthandnetworks:ci-vsa-12-725:159016:volume-2ab47be7-64ac-4d34-a38c-59c5e97e2ec2-lun-0 /dev/sdb\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Exit code: 1\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Stdout: u''\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Stderr: u'Name \"ip-10.52.1.17:3260-iscsi-iqn.2003-10.com.lefthandnetworks:ci-vsa-12-725:159016:volume-2ab47be7-64ac-4d34-a38c-59c5e97e2ec2-lun-0\" too long.\\n'\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]\n\n\nStack Trace (test_encrypted_cinder_volumes_luks):\n\n2015-03-27 18:06:48.928 ERROR nova.virt.libvirt.driver [req-7167f5a7-c620-474a-a6e0-1cc992192930 TestEncryptedCinderVolumes-658052177 TestEncryptedCinderVolumes-1476988517] [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Failed to attach volume at mountpoint: /dev/vdb\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Traceback (most recent call last):\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1052, in attach_volume\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     encryptor.attach_volume(context, **encryption)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/opt/stack/new/nova/nova/volume/encryptors/luks.py\", line 114, in attach_volume\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     self._open_volume(passphrase, **kwargs)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/opt/stack/new/nova/nova/volume/encryptors/luks.py\", line 89, in _open_volume\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     run_as_root=True, check_exit_code=True)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/opt/stack/new/nova/nova/utils.py\", line 206, in execute\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     return processutils.execute(*cmd, **kwargs)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/processutils.py\", line 233, in execute\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     cmd=sanitized_cmd)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] ProcessExecutionError: Unexpected error while running command.\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf cryptsetup luksOpen --key-file=- /dev/sdb ip-10.52.1.17:3260-iscsi-iqn.2003-10.com.lefthandnetworks:ci-vsa-12-725:159021:volume-e74c95eb-e69b-4cf3-ac37-74e4ef38f796-lun-0\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Exit code: 1\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Stdout: u''\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Stderr: u'Name \"ip-10.52.1.17:3260-iscsi-iqn.2003-10.com.lefthandnetworks:ci-vsa-12-725:159021:volume-e74c95eb-e69b-4cf3-ac37-74e4ef38f796-lun-0\" too long.\\n'\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]\n\n\nTo reproduce, run the tempest tests mentioned above on system that has an ip, iscsi properties and volume name which, when combined, results in a very long name used by cryptsetup.  The long name will cause the above error to occur.", 
    "tags": [
        "encryption", 
        "libvirt", 
        "low-hanging-fruit", 
        "volumes"
    ], 
    "importance": "Medium", 
    "heat": 44, 
    "link": "https://bugs.launchpad.net/nova/+bug/1439855", 
    "owner": "None", 
    "id": 1439855, 
    "index": 4211, 
    "openned": "2015-04-02 21:19:11.881801+00:00", 
    "created": "2015-04-02 21:19:11.881801+00:00", 
    "title": "encrypted iSCSI volume fails to attach, name too long", 
    "comments": [
        {
            "content": "When running the following tempest tests an error occurs in n-cpu:\n\ntempest.scenario.test_encrypted_cinder_volumes.TestEncryptedCinderVolumes.test_encrypted_cinder_volumes_cryptsetup\ntest_encrypted_cinder_volumes_luks\n\nThis occurred when using devstack with nova at:\n\nHEAD is now at d0c2684 Merge \"libvirt: Resize down an instance booted from a volume\"\n\nBoth stack traces below are from n-cpu logs:\n\nStack Trace (tempest.scenario.test_encrypted_cinder_volumes.TestEncryptedCinderVolumes.test_encrypted_cinder_volumes_cryptsetup):\n\n2015-03-27 18:03:07.990 ERROR nova.compute.manager [req-cc941973-c038-4bac-a5ca-d516cd5dd33d TestEncryptedCinderVolumes-658052177 TestEncryptedCinderVolumes-1476988517] [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Failed to attach 2ab47be7-64ac-4d34-a38c-59c5e97e2ec2 at /dev/vdb\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Traceback (most recent call last):\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 4735, in _attach_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     do_check_attach=False, do_driver_attach=True)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/block_device.py\", line 48, in wrapped\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     ret_val = method(obj, context, *args, **kwargs)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/block_device.py\", line 260, in attach\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     connector)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     six.reraise(self.type_, self.value, self.tb)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/block_device.py\", line 251, in attach\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     device_type=self['device_type'], encryption=encryption)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1065, in attach_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     self._disconnect_volume(connection_info, disk_dev)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     six.reraise(self.type_, self.value, self.tb)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1052, in attach_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     encryptor.attach_volume(context, **encryption)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/volume/encryptors/cryptsetup.py\", line 86, in attach_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     self._open_volume(passphrase, **kwargs)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/volume/encryptors/cryptsetup.py\", line 71, in _open_volume\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     check_exit_code=True, run_as_root=True)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/opt/stack/new/nova/nova/utils.py\", line 206, in execute\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     return processutils.execute(*cmd, **kwargs)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/processutils.py\", line 233, in execute\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]     cmd=sanitized_cmd)\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] ProcessExecutionError: Unexpected error while running command.\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf cryptsetup create --key-file=- --cipher aes-xts-plain64 --key-size 512 ip-10.52.1.17:3260-iscsi-iqn.2003-10.com.lefthandnetworks:ci-vsa-12-725:159016:volume-2ab47be7-64ac-4d34-a38c-59c5e97e2ec2-lun-0 /dev/sdb\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Exit code: 1\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Stdout: u''\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46] Stderr: u'Name \"ip-10.52.1.17:3260-iscsi-iqn.2003-10.com.lefthandnetworks:ci-vsa-12-725:159016:volume-2ab47be7-64ac-4d34-a38c-59c5e97e2ec2-lun-0\" too long.\\n'\n2015-03-27 18:03:07.990 29082 TRACE nova.compute.manager [instance: a2cccacf-2876-4e94-94e0-dbb3fbf51c46]\n\n\nStack Trace (test_encrypted_cinder_volumes_luks):\n\n2015-03-27 18:06:48.928 ERROR nova.virt.libvirt.driver [req-7167f5a7-c620-474a-a6e0-1cc992192930 TestEncryptedCinderVolumes-658052177 TestEncryptedCinderVolumes-1476988517] [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Failed to attach volume at mountpoint: /dev/vdb\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Traceback (most recent call last):\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1052, in attach_volume\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     encryptor.attach_volume(context, **encryption)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/opt/stack/new/nova/nova/volume/encryptors/luks.py\", line 114, in attach_volume\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     self._open_volume(passphrase, **kwargs)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/opt/stack/new/nova/nova/volume/encryptors/luks.py\", line 89, in _open_volume\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     run_as_root=True, check_exit_code=True)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/opt/stack/new/nova/nova/utils.py\", line 206, in execute\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     return processutils.execute(*cmd, **kwargs)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/processutils.py\", line 233, in execute\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]     cmd=sanitized_cmd)\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] ProcessExecutionError: Unexpected error while running command.\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf cryptsetup luksOpen --key-file=- /dev/sdb ip-10.52.1.17:3260-iscsi-iqn.2003-10.com.lefthandnetworks:ci-vsa-12-725:159021:volume-e74c95eb-e69b-4cf3-ac37-74e4ef38f796-lun-0\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Exit code: 1\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Stdout: u''\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a] Stderr: u'Name \"ip-10.52.1.17:3260-iscsi-iqn.2003-10.com.lefthandnetworks:ci-vsa-12-725:159021:volume-e74c95eb-e69b-4cf3-ac37-74e4ef38f796-lun-0\" too long.\\n'\n2015-03-27 18:06:48.928 29082 TRACE nova.virt.libvirt.driver [instance: ddeda0aa-1457-41d2-82e9-9a4ae888125a]\n\n\nTo reproduce, run the tempest tests mentioned above on system that has an ip, iscsi properties and volume name which, when combined, results in a very long name used by cryptsetup.  The long name will cause the above error to occur.", 
            "date_created": "2015-04-02 21:19:11.881801+00:00", 
            "author": "https://api.launchpad.net/1.0/~anthony-mic-lee"
        }, 
        {
            "content": "This isn't really a dup, because this is about nova failing gracefully I think.\n\nCan you provide relevant dmesg logs to figure out if this being triggered in the kernel or if this is something in cryptsetup itself, so that we can handle this in the right place?", 
            "date_created": "2015-04-03 15:17:32.585646+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Bug 1432490 is related and sounds like it's a user/config error.  Nova could parse stderr though and raise a more useful error in this case.  I can't find any docs on the max name length for cryptsetup which leads me to believe it's kernel-specific so nova would just have to catch the ProcessExecutionError and parse stderr to see if that's the issue to give a more useful nova exception back.", 
            "date_created": "2015-04-03 15:18:12.613393+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "It appears that dm-crypt only handles device names <= 127 characters in length, the above it 129 characters. libvirt should probably have handling code to fail fast if the device name is never going to work.", 
            "date_created": "2015-04-03 15:37:44.905323+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Marked low-hanging-fruit because this should be fixed on the nova side solely by creating a well understood error path here. ", 
            "date_created": "2015-04-03 15:38:56.717367+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Nova has the volume uuid at the time when the crypt name is used.  You could simply use the volume uuid as the crypt name in this case it would always be less than 127 characters.", 
            "date_created": "2015-04-13 15:43:48.048832+00:00", 
            "author": "https://api.launchpad.net/1.0/~walter-boring"
        }, 
        {
            "content": "If I change the dev_name using the uuid, does it affect any other function?", 
            "date_created": "2015-04-15 16:36:42.783420+00:00", 
            "author": "https://api.launchpad.net/1.0/~phqnha"
        }, 
        {
            "content": "I mean, does it break the contract with other parts openstack. For example, cinder always uses the dev_name formed by this:\n\n        # a unique name for the volume -- e.g., the iSCSI participant name\n        self.dev_name = self.symlink_path.split('/')[-1]\n        # the device's actual path on the compute host -- e.g., /dev/sd_\n        self.dev_path = os.path.realpath(self.symlink_path)\n  ", 
            "date_created": "2015-04-15 16:47:19.360045+00:00", 
            "author": "https://api.launchpad.net/1.0/~phqnha"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/174656", 
            "date_created": "2015-04-17 00:16:58.102832+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "hi Sean: \n\nI have not checked the kernel code. \nI just try it on my Ubuntu 14.04 \n\nIt seams it is OK device names <= 128 characters in length. \n\n\n$ wc -c <<< $DMNANE129\n129\n$ wc -c <<< $DMNANE128\n128\n\n\n$ sudo cryptsetup create --key-file=- --cipher aes-xts-plain64 --key-size 512 $DMNANE129 /dev/loop0\nName \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaddd\" too long.\n\n$ sudo cryptsetup create --key-file=- --cipher aes-xts-plain64 --key-size 512 $DMNANE128 /dev/loop0\nEnter passphrase: Error reading passphrase from terminal ", 
            "date_created": "2015-04-17 08:05:51.569921+00:00", 
            "author": "https://api.launchpad.net/1.0/~shaohef"
        }, 
        {
            "content": "declaration\uff1a \n\nEnter passphrase: Error reading passphrase from terminal \n\nfor I stop to input the \"Enter passphrase\". ", 
            "date_created": "2015-04-17 08:08:58.766209+00:00", 
            "author": "https://api.launchpad.net/1.0/~shaohef"
        }, 
        {
            "content": "I tried out the patch with our driver on our internal ci system. It gets past the iqn too long error, but is failing still. n-cpu logs attached here.", 
            "date_created": "2015-04-17 14:22:03.357490+00:00", 
            "author": "https://api.launchpad.net/1.0/~ramy-asselin"
        }, 
        {
            "content": "My comment #11 is for patch set #1 ^^.\nI see now there are new patch sets. I will run those too.", 
            "date_created": "2015-04-17 14:24:19.344528+00:00", 
            "author": "https://api.launchpad.net/1.0/~ramy-asselin"
        }, 
        {
            "content": "Adding n-cpu log for patch set #7 (run on internal ci) which passed tempest test_encrypted_cinder_volumes_cryptsetup &  test_encrypted_cinder_volumes_luks. Previously this cinder driver failed with iqn too long.\n", 
            "date_created": "2015-04-17 17:23:32.343652+00:00", 
            "author": "https://api.launchpad.net/1.0/~ramy-asselin"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/174656\nReason: This patch has been sitting unchanged for more than 12 weeks. I am therefore going to abandon it to keep the nova review queue sane. Please feel free to restore the change if you're still working on it.", 
            "date_created": "2016-10-25 16:11:03.557517+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fixing this on master (pike) now would mean fixing this in the os-brick library since Nova no longer has this code in tree:\n\nhttps://github.com/openstack/nova/commit/9c23cdc247770830fa288f429ca7231eb431a3b2", 
            "date_created": "2017-06-02 15:20:28.001520+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "The patch that is abandoned would work as long as we handle both old and new style naming conventions so we can straddle upgrades, like in this fix:\n\nhttps://github.com/openstack/nova/commit/89a61ab8f4602e018763afb173e1a862f151a222", 
            "date_created": "2017-06-02 15:23:04.396071+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ]
}