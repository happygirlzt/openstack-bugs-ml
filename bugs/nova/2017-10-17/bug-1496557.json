{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 09:03:47.581021+00:00", 
    "description": "When a request is made to boot an instance from a volume and a volume is passed in as part of the request, rather than an image to have Nova create a volume from, the image id is not passed down as part of the build request.  The boot_meta dict created in compute/api.py does not store an 'id' key/value in the dict so when it eventually gets down to the virt layer and the dict is converted to an object the 'id' attribute can not be accessed.  This causes a failure within the xenapi driver.\n\n2015-09-16 13:02:00.481 24755 DEBUG nova.virt.xenapi.vmops [req-14839809--53d088b99b2d dbf01adba9b245369ba32a46d93fdf5f 5930474 - - -] [instance: 897942e0] Updating progress to 10 _update_instance_progress /opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py:1017\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [req-14839809--53d088b99b2d dbf01adba9b245369ba32a46d93fdf5f 5930474 - - -] [instance: 897942e0] Failed to spawn, rolling back\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0] Traceback (most recent call last):\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 657, in _spawn\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     name_label)\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 212, in inner\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     rv = f(*args, **kwargs)\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 492, in create_disks_step\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     image_meta.id, disk_image_type,\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 66, in getter\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     self.obj_load_attr(name)\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 555, in obj_load_attr\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     _(\"Cannot load '%s' in the base class\") % attrname)\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0] NotImplementedError: Cannot load 'id' in the base class\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]", 
    "tags": [
        "xen"
    ], 
    "importance": "High", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1496557", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1496557, 
    "index": 1810, 
    "openned": "2015-09-16 20:11:25.291132+00:00", 
    "created": "2015-09-16 20:11:25.291132+00:00", 
    "title": "xenapi boot from volume is broken after move to ImageMeta object if volume passed in", 
    "comments": [
        {
            "content": "When a request is made to boot an instance from a volume and a volume is passed in as part of the request, rather than an image to have Nova create a volume from, the image id is not passed down as part of the build request.  The boot_meta dict created in compute/api.py does not store an 'id' key/value in the dict so when it eventually gets down to the virt layer and the dict is converted to an object the 'id' attribute can not be accessed.  This causes a failure within the xenapi driver.\n\n2015-09-16 13:02:00.481 24755 DEBUG nova.virt.xenapi.vmops [req-14839809--53d088b99b2d dbf01adba9b245369ba32a46d93fdf5f 5930474 - - -] [instance: 897942e0] Updating progress to 10 _update_instance_progress /opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py:1017\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [req-14839809--53d088b99b2d dbf01adba9b245369ba32a46d93fdf5f 5930474 - - -] [instance: 897942e0] Failed to spawn, rolling back\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0] Traceback (most recent call last):\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 657, in _spawn\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     name_label)\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 212, in inner\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     rv = f(*args, **kwargs)\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 492, in create_disks_step\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     image_meta.id, disk_image_type,\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 66, in getter\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     self.obj_load_attr(name)\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]   File \"/opt/rackstack/rackstack.381.6/nova/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 555, in obj_load_attr\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]     _(\"Cannot load '%s' in the base class\") % attrname)\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0] NotImplementedError: Cannot load 'id' in the base class\n2015-09-16 13:02:00.696 24755 ERROR nova.utils [instance: 897942e0]", 
            "date_created": "2015-09-16 20:11:25.291132+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/224286", 
            "date_created": "2015-09-16 20:20:14.929392+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/224286\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e9ecfdce11850037c823374cee6167391e8c7fb7\nSubmitter: Jenkins\nBranch:    master\n\ncommit e9ecfdce11850037c823374cee6167391e8c7fb7\nAuthor: Andrew Laski <email address hidden>\nDate:   Wed Sep 16 16:11:54 2015 -0400\n\n    Xenapi: Don't access image_meta.id when booting from a volume\n    \n    When a request is made to boot from a preexisting volume, rather than\n    asking Nova to create a volume from an image, there is no image id field\n    in the image_meta that's passed in to the virt driver.  This would be\n    fine except that there was an attempt to access image_meta.id in the\n    boot from volume case where it is not necessary.  This change moves that\n    access to a point where it is known that this is not an attempt to boot\n    from a volume and that field should be set.\n    \n    Change-Id: I9dab14762f5d331ef2e36f617f7f66c3d771f32d\n    Closes-bug: 1496557\n", 
            "date_created": "2015-09-17 16:01:47.369460+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-09-24 07:01:35.280594+00:00"
}