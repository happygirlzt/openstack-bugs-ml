{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:13:51.867370+00:00", 
    "description": "nova doesn't retry when connections to glance fail because it is being restarted.\n\nServices can restart at any time and we should be more tolerant of that and retry for a configurable period of time.\n\n2012-02-10 12:25:05,849 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/rpc/amqp.py\", line 249, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/exception.py\", line 126, in wrapped\n(nova.rpc): TRACE:     return f(*args, **kw)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 150, in decorated_function\n(nova.rpc): TRACE:     function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 173, in decorated_function\n(nova.rpc): TRACE:     self.add_instance_fault_from_exc(context, instance_uuid, e)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__\n(nova.rpc): TRACE:     self.gen.next()\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 168, in decorated_function\n(nova.rpc): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 1309, in finish_resize\n(nova.rpc): TRACE:     image_meta = _get_image_meta(context, instance_ref['image_ref'])\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 180, in _get_image_meta\n(nova.rpc): TRACE:     return image_service.show(context, image_id)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/image/glance.py\", line 218, in show\n(nova.rpc): TRACE:     image_meta = self._get_client(context).get_image_meta(image_id)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/client.py\", line 97, in get_image_meta\n(nova.rpc): TRACE:     res = self.do_request(\"HEAD\", \"/images/%s\" % image_id)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/common/client.py\", line 51, in wrapped\n(nova.rpc): TRACE:     return func(self, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/common/client.py\", line 341, in do_request\n(nova.rpc): TRACE:     headers=headers)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/common/client.py\", line 68, in wrapped\n(nova.rpc): TRACE:     return func(self, method, url, body, headers)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/common/client.py\", line 463, in _do_request\n(nova.rpc): TRACE:     raise exception.ClientConnectionError(e)\n(nova.rpc): TRACE: ClientConnectionError: There was an error connecting to a server\n(nova.rpc): TRACE: Details: [Errno 111] ECONNREFUSED\n(nova.rpc): TRACE:", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/930245", 
    "owner": "https://api.launchpad.net/1.0/~johannes.erdfelt", 
    "id": 930245, 
    "index": 3817, 
    "openned": "2012-02-10 16:29:22.388438+00:00", 
    "created": "2012-02-10 16:29:22.388438+00:00", 
    "title": "nova gives up on glance connection failures too easily", 
    "comments": [
        {
            "content": "nova doesn't retry when connections to glance fail because it is being restarted.\n\nServices can restart at any time and we should be more tolerant of that and retry for a configurable period of time.\n\n2012-02-10 12:25:05,849 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/rpc/amqp.py\", line 249, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/exception.py\", line 126, in wrapped\n(nova.rpc): TRACE:     return f(*args, **kw)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 150, in decorated_function\n(nova.rpc): TRACE:     function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 173, in decorated_function\n(nova.rpc): TRACE:     self.add_instance_fault_from_exc(context, instance_uuid, e)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__\n(nova.rpc): TRACE:     self.gen.next()\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 168, in decorated_function\n(nova.rpc): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 1309, in finish_resize\n(nova.rpc): TRACE:     image_meta = _get_image_meta(context, instance_ref['image_ref'])\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/compute/manager.py\", line 180, in _get_image_meta\n(nova.rpc): TRACE:     return image_service.show(context, image_id)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/nova/image/glance.py\", line 218, in show\n(nova.rpc): TRACE:     image_meta = self._get_client(context).get_image_meta(image_id)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/client.py\", line 97, in get_image_meta\n(nova.rpc): TRACE:     res = self.do_request(\"HEAD\", \"/images/%s\" % image_id)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/common/client.py\", line 51, in wrapped\n(nova.rpc): TRACE:     return func(self, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/common/client.py\", line 341, in do_request\n(nova.rpc): TRACE:     headers=headers)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/common/client.py\", line 68, in wrapped\n(nova.rpc): TRACE:     return func(self, method, url, body, headers)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.6/dist-packages/glance/common/client.py\", line 463, in _do_request\n(nova.rpc): TRACE:     raise exception.ClientConnectionError(e)\n(nova.rpc): TRACE: ClientConnectionError: There was an error connecting to a server\n(nova.rpc): TRACE: Details: [Errno 111] ECONNREFUSED\n(nova.rpc): TRACE:", 
            "date_created": "2012-02-10 16:29:22.388438+00:00", 
            "author": "https://api.launchpad.net/1.0/~johannes.erdfelt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/4013", 
            "date_created": "2012-02-10 17:42:26.029863+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/4013\nCommitted: http://github.com/openstack/nova/commit/9974dcbd304a4e092e952e937f4dc78f9500e304\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9974dcbd304a4e092e952e937f4dc78f9500e304\nAuthor: Johannes Erdfelt <email address hidden>\nDate:   Fri Feb 10 17:40:10 2012 +0000\n\n    Extend glance retries to show() as well\n    \n    Fixes bug 930245\n    \n    nova/image/glance.py would already retry get() requests if there was a\n    connection error, but didn't do so for show() requests.\n    \n    Change-Id: Ifb1a17da18b7e10ddaaec46e124efcc963681c80\n", 
            "date_created": "2012-02-10 20:43:39.831152+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-02-29 10:26:46.881940+00:00"
}