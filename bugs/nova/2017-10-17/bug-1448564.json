{
    "status": "Invalid", 
    "last_updated": "2016-04-18 17:32:48.620372+00:00", 
    "description": "Instance rescue gets stuck when using cells.\n\nnova version: 2014.2.2\nUsing cells (parent - child setup)\n\n\nHow to reproduce:\n\nnova rescue <instance_uuid> \n-> the instance \"task state\" stays in \"rescuing\".\n-> nova cells log of the child shows:\n\n2015-04-26 01:26:09.475 20672 ERROR nova.cells.messaging [req-162b3318-70c3-4290-8e09-ffb9fbcef19d None] Error processing message locally: save() got an unexpected keyword argument 'expected_task_state'\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging Traceback (most recent call last):\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 199, in _process_locally\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     resp_value = self.msg_runner._process_message_locally(self)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 1293, in _process_message_locally\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return fn(message, **message.method_kwargs)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 698, in run_compute_api_method\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return fn(message.ctxt, *args, **method_info['method_kwargs'])\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 224, in wrapped\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return func(self, context, target, *args, **kwargs)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 214, in inner\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return function(self, context, instance, *args, **kwargs)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 195, in inner\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return f(self, context, instance, *args, **kw)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2750, in rescue\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     instance.save(expected_task_state=[None])\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging TypeError: save() got an unexpected keyword argument 'expected_task_state'", 
    "tags": [
        "cells", 
        "low-hanging-fruit"
    ], 
    "importance": "Low", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1448564", 
    "owner": "https://api.launchpad.net/1.0/~augarret", 
    "id": 1448564, 
    "index": 1708, 
    "openned": "2015-04-25 23:39:55.865536+00:00", 
    "created": "2015-04-25 23:39:55.865536+00:00", 
    "title": "Rescue using cells fails with: unexpected keyword argument 'expected_task_state'", 
    "comments": [
        {
            "content": "Instance rescue gets stuck when using cells.\n\nnova version: 2014.2.2\nUsing cells (parent - child setup)\n\n\nHow to reproduce:\n\nnova rescue <instance_uuid> \n-> the instance \"task state\" stays in \"rescuing\".\n-> nova cells log of the child shows:\n\n2015-04-26 01:26:09.475 20672 ERROR nova.cells.messaging [req-162b3318-70c3-4290-8e09-ffb9fbcef19d None] Error processing message locally: save() got an unexpected keyword argument 'expected_task_state'\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging Traceback (most recent call last):\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 199, in _process_locally\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     resp_value = self.msg_runner._process_message_locally(self)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 1293, in _process_message_locally\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return fn(message, **message.method_kwargs)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 698, in run_compute_api_method\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return fn(message.ctxt, *args, **method_info['method_kwargs'])\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 224, in wrapped\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return func(self, context, target, *args, **kwargs)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 214, in inner\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return function(self, context, instance, *args, **kwargs)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 195, in inner\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return f(self, context, instance, *args, **kw)\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2750, in rescue\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     instance.save(expected_task_state=[None])\n2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging TypeError: save() got an unexpected keyword argument 'expected_task_state'", 
            "date_created": "2015-04-25 23:39:55.865536+00:00", 
            "author": "https://api.launchpad.net/1.0/~moreira-belmiro-email-lists"
        }, 
        {
            "content": "Will work on this during upstream training", 
            "date_created": "2015-05-16 00:43:11.537446+00:00", 
            "author": "https://api.launchpad.net/1.0/~augarret"
        }, 
        {
            "content": "Auktavian any progress on it?\n", 
            "date_created": "2015-07-03 13:39:45.579322+00:00", 
            "author": "https://api.launchpad.net/1.0/~moreira-belmiro-email-lists"
        }, 
        {
            "content": "Hi Belmiro,\n\nI have not made any progress because at the time of working on it I was\nunable to recreate the bug.  I tried setting up cells manually and with\ndevstack with no success.   Could you assist with recreation?\n\nRegards,  \n-- \nAuktavian Garrett | Software Engineer\n.:|:.:|:. | Security & Trust Organization\n CISCO  | Office: 919-392-9042 | <email address hidden>\n\nThis email may contain confidential and privileged material for the sole\nuse of the intended recipient. Any review, use, distribution or disclosure\nby others is strictly prohibited. If you are not the intended recipient\n(or authorized to receive for the recipient), please contact the sender by\nreply email and delete all copies of this message.\n\nFor corporate legal information go to:\nhttp://www.cisco.com/web/about/doing_business/legal/cri/index.html\n\n\n\n\n\n\nOn 7/3/15, 9:39 AM, \"<email address hidden> on behalf of Belmiro Moreira\"\n<<email address hidden> on behalf of <email address hidden>> wrote:\n\n>Auktavian any progress on it?\n>\n>-- \n>You received this bug notification because you are a bug assignee.\n>https://bugs.launchpad.net/bugs/1448564\n>\n>Title:\n>  Rescue using cells fails with: unexpected keyword argument\n>  'expected_task_state'\n>\n>Status in OpenStack Compute (Nova):\n>  Confirmed\n>\n>Bug description:\n>  Instance rescue gets stuck when using cells.\n>\n>  nova version: 2014.2.2\n>  Using cells (parent - child setup)\n>\n>  \n>  How to reproduce:\n>\n>  nova rescue <instance_uuid>\n>  -> the instance \"task state\" stays in \"rescuing\".\n>  -> nova cells log of the child shows:\n>\n>  2015-04-26 01:26:09.475 20672 ERROR nova.cells.messaging\n>[req-162b3318-70c3-4290-8e09-ffb9fbcef19d None] Error processing message\n>locally: save() got an unexpected keyword argument 'expected_task_state'\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging Traceback\n>(most recent call last):\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File\n>\"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 199, in\n>_process_locally\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     resp_value\n>= self.msg_runner._process_message_locally(self)\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File\n>\"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 1293, in\n>_process_message_locally\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return\n>fn(message, **message.method_kwargs)\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File\n>\"/usr/lib/python2.7/site-packages/nova/cells/messaging.py\", line 698, in\n>run_compute_api_method\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return\n>fn(message.ctxt, *args, **method_info['method_kwargs'])\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File\n>\"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 224, in\n>wrapped\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return\n>func(self, context, target, *args, **kwargs)\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File\n>\"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 214, in inner\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return\n>function(self, context, instance, *args, **kwargs)\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File\n>\"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 195, in inner\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging     return\n>f(self, context, instance, *args, **kw)\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging   File\n>\"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2750, in\n>rescue\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging\n>instance.save(expected_task_state=[None])\n>  2015-04-26 01:26:09.475 20672 TRACE nova.cells.messaging TypeError:\n>save() got an unexpected keyword argument 'expected_task_state'\n>\n>To manage notifications about this bug go to:\n>https://bugs.launchpad.net/nova/+bug/1448564/+subscriptions\n\n", 
            "date_created": "2015-07-16 14:10:21+00:00", 
            "author": "https://api.launchpad.net/1.0/~augarret"
        }, 
        {
            "content": "I think this was fixed by https://review.openstack.org/#/c/79741/", 
            "date_created": "2015-07-16 18:56:09.339738+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }, 
        {
            "content": "Indeed, I think Melanie Witt is correct and that this bug can be closed.\n\nPrior to this patch[1], it was possible for 'instance' to be a sqlalchemy model (db.instance_get_by_uuid) rather than a NovaObject (objects.Instance.get_by_uuid). Calling 'save' on a sqlalchemy model with the keyword argument 'expected_task_state' would raise this exception. On the other hand, the instance NovaObject defines a 'save' method that accepts the keyword argument 'expected_task_state'.\n\n[1] https://review.openstack.org/#/c/79741/", 
            "date_created": "2015-09-09 19:04:15.068947+00:00", 
            "author": "https://api.launchpad.net/1.0/~diana-clarke"
        }, 
        {
            "content": "Marking this as invalid because I think it's already been fixed. Please feel free to re-open this bug if you can still reproduce it.", 
            "date_created": "2016-04-18 17:32:40.577022+00:00", 
            "author": "https://api.launchpad.net/1.0/~diana-clarke"
        }
    ], 
    "closed": "2016-04-18 17:32:46.753884+00:00"
}