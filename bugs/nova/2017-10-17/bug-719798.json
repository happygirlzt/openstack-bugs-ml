{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:33:50.335762+00:00", 
    "description": "Instances that have a local route (due to installing Network Manager in ubuntu for example) cannot contact the metadata server.  This is because they send out an ARP (who-has) for 169.254.169.254 and never get a response.  This issue also affects windows vms.  The issue can be solved by giving the ip address to the host that is running nova-network, something along the lines of:\n\nip addr add 169.254.169.254/32 scope link dev eth1\n\nThis causes the network host to respond to the arp and the metadata request succeeds. Nova should automatically add this address to avoid this failure.\n\n\nExample Error messages are below:\n\n\nInstance fails to access metadata server at launch resulting it fails to complete initial booting process including sshd startup.\n\nLogs from tty linux.\n=========================================\n\nLease of 10.0.0.5 obtained, lease time 120^M\nstarting DHCP forEthernet interface eth0 [ ^[[1;32mOK^[[0;39m ]^M\ncloud-setup: checking http://169.254.169.254/2009-04-04/meta-data/instance-id^M\ncloud-setup: failed 1/30: up 7.97. iid had 1.0^M\ncloud-setup: failed 2/30: up 9.18. iid had 1.0^M\ncloud-setup: failed 3/30: up 10.35. iid had 1.0^M\ncloud-setup: failed 4/30: up 11.52. iid had 1.0^M\ncloud-setup: failed 5/30: up 12.70. iid had 1.0^M\ncloud-setup: failed 6/30: up 13.88. iid had 1.0^M\ncloud-setup: failed 7/30: up 15.06. iid had 1.0^M\ncloud-setup: failed 8/30: up 16.24. iid had 1.0^M\ncloud-setup: failed 9/30: up 17.43. iid had 1.0^M\ncloud-setup: failed 10/30: up 18.62. iid had 1.0^M\ncloud-setup: failed 11/30: up 19.81. iid had 1.0^M\ncloud-setup: failed 12/30: up 21.00. iid had 1.0^M\ncloud-setup: failed 13/30: up 22.20. iid had 1.0^M\ncloud-setup: failed 14/30: up 23.40. iid had 1.0^M\ncloud-setup: failed 15/30: up 24.60. iid had 1.0^M\ncloud-setup: failed 16/30: up 25.80. iid had 1.0^M\ncloud-setup: failed 17/30: up 27.01. iid had 1.0^M\ncloud-setup: failed 18/30: up 28.22. iid had 1.0^M\ncloud-setup: failed 19/30: up 29.43. iid had 1.0^M\ncloud-setup: failed 20/30: up 30.65. iid had 1.0^M\ncloud-setup: failed 21/30: up 31.86. iid had 1.0^M\ncloud-setup: failed 22/30: up 33.08. iid had 1.0^M\ncloud-setup: failed 23/30: up 34.30. iid had 1.0^M\ncloud-setup: failed 24/30: up 35.60. iid had 1.0^M\ncloud-setup: failed 25/30: up 36.89. iid had 1.0^M\ncloud-setup: failed 26/30: up 38.11. iid had 1.0^M\ncloud-setup: failed 27/30: up 39.34. iid had 1.0^M\ncloud-setup: failed 28/30: up 40.56. iid had 1.0^M\ncloud-setup: failed 29/30: up 41.82. iid had 1.0^M\ncloud-setup: failed 30/30: up 43.05. iid had 1.0^M\ncloud-setup: after 30 fails, debugging^M\ncloud-setup: running debug (30 tries reached)^M\n############ debug start ##############^M\n### /etc/rc.d/init.d/sshd start^M\nstty: /dev/console^M\ngenerating DSS host key [^[[1;33mWATING^[[0;39m]^[[-11G^[[1;34m..^[[0;39m [ ^[[1;32mOK^[[0;39m ]^M\ngenerating RSA host key [^[[1;33mWATING^[[0;39m]^[[-11G^[[1;34m..^[[0;39m [ ^[[1;32mOK^[[0;39m ]^M\nstartup dropbear [ ^[[1;32mOK^[[0;39m ]^M\n### ifconfig -a^M\neth0 Link encap:Ethernet HWaddr 02:16:3E:57:D3:B5 ^M\n=========================================\n\nLogs from UEC image.\n=========================================\ninit: plymouth-splash main process (263) terminated with status 2\ninit: plymouth main process (48) killed by SEGV signal\ncloud-init running: Tue, 15 Feb 2011 09:55:54 +0000. up 30.11 seconds\nconsuming user data failed!\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/bin/cloud-init\", line 103, in <module>\n\u00a0\u00a0\u00a0\u00a0main()\n\u00a0\u00a0File \"/usr/bin/cloud-init\", line 60, in main\n\u00a0\u00a0\u00a0\u00a0cloud.consume_userdata,[],False)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/__init__.py\", line 215, in sem_and_run\n\u00a0\u00a0\u00a0\u00a0if self.sem_has_run(semname,freq): return\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/__init__.py\", line 173, in sem_has_run\n\u00a0\u00a0\u00a0\u00a0semfile = self.sem_getpath(name,freq)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/__init__.py\", line 167, in sem_getpath\n\u00a0\u00a0\u00a0\u00a0freqtok = self.datasource.get_instance_id()\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/DataSourceEc2.py\", line 65, in get_instance_id\n\u00a0\u00a0\u00a0\u00a0return(self.metadata['instance-id'])\nKeyError: 'instance-id'\ninit: cloud-init main process (334) terminated with status 1\nmountall: Event failed\nmountall: Plymouth command failed\nmountall: Plymouth command failed\nmountall: Plymouth command failed\nmountall: Plymouth command failed\nmountall: Disconnected from Plymouth\ninit: plymouth-log main process (364) terminated with status 1\n\u00a0* Starting AppArmor profiles                                            [ OK ]\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n\u00a0\u00a0\u00a0\u00a0main()\n\u00a0\u00a0\u00a0\u00a0main()\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 43, in main\n\u00a0\u00a0\u00a0\u00a0cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 43, in main\n\u00a0\u00a0\u00a0\u00a0cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n\u00a0\u00a0\u00a0\u00a0self.cfg = self.get_config_obj(cfgfile)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n\u00a0\u00a0\u00a0\u00a0f=file(cfgfile)\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n\u00a0\u00a0\u00a0\u00a0self.cfg = self.get_config_obj(cfgfile)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n\u00a0\u00a0\u00a0\u00a0f=file(cfgfile)\nIOError: IOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\n\u00a0\u00a0\u00a0\u00a0main()\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 43, in main\n\u00a0\u00a0\u00a0\u00a0cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n\u00a0\u00a0\u00a0\u00a0self.cfg = self.get_config_obj(cfgfile)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n[Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\n\u00a0\u00a0\u00a0\u00a0f=file(cfgfile)\nIOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n\u00a0\u00a0\u00a0\u00a0main()\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 43, in main\n\u00a0\u00a0\u00a0\u00a0cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n\u00a0\u00a0\u00a0\u00a0self.cfg = self.get_config_obj(cfgfile)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n\u00a0\u00a0\u00a0\u00a0f=file(cfgfile)\nIOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n\u00a0\u00a0\u00a0\u00a0main()\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 43, in main\n\u00a0\u00a0\u00a0\u00a0cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n\u00a0\u00a0\u00a0\u00a0self.cfg = self.get_config_obj(cfgfile)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n\u00a0\u00a0\u00a0\u00a0f=file(cfgfile)\nIOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\nlandscape-client is not configured, please run landscape-config.\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n\u00a0\u00a0\u00a0\u00a0main()\n\u00a0\u00a0File \"/usr/bin/cloud-init-cfg\", line 43, in main\n\u00a0\u00a0\u00a0\u00a0cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n\u00a0\u00a0\u00a0\u00a0self.cfg = self.get_config_obj(cfgfile)\n\u00a0\u00a0File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n\u00a0\u00a0\u00a0\u00a0f=file(cfgfile)\nIOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'", 
    "tags": [], 
    "importance": "High", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/719798", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 719798, 
    "index": 357, 
    "openned": "2011-02-16 05:13:02.306394+00:00", 
    "created": "2011-02-16 05:13:02.306394+00:00", 
    "title": "Some instances can't connect to metadata due to ARP failure", 
    "comments": [
        {
            "content": "Instance fails to access metadata server at launch resulting it fails to complete initial booting process including sshd startup.\n\nLogs from tty linux.\n=========================================\n\nLease of 10.0.0.5 obtained, lease time 120^M\nstarting DHCP forEthernet interface eth0 [ ^[[1;32mOK^[[0;39m ]^M\ncloud-setup: checking http://169.254.169.254/2009-04-04/meta-data/instance-id^M\ncloud-setup: failed 1/30: up 7.97. iid had 1.0^M\ncloud-setup: failed 2/30: up 9.18. iid had 1.0^M\ncloud-setup: failed 3/30: up 10.35. iid had 1.0^M\ncloud-setup: failed 4/30: up 11.52. iid had 1.0^M\ncloud-setup: failed 5/30: up 12.70. iid had 1.0^M\ncloud-setup: failed 6/30: up 13.88. iid had 1.0^M\ncloud-setup: failed 7/30: up 15.06. iid had 1.0^M\ncloud-setup: failed 8/30: up 16.24. iid had 1.0^M\ncloud-setup: failed 9/30: up 17.43. iid had 1.0^M\ncloud-setup: failed 10/30: up 18.62. iid had 1.0^M\ncloud-setup: failed 11/30: up 19.81. iid had 1.0^M\ncloud-setup: failed 12/30: up 21.00. iid had 1.0^M\ncloud-setup: failed 13/30: up 22.20. iid had 1.0^M\ncloud-setup: failed 14/30: up 23.40. iid had 1.0^M\ncloud-setup: failed 15/30: up 24.60. iid had 1.0^M\ncloud-setup: failed 16/30: up 25.80. iid had 1.0^M\ncloud-setup: failed 17/30: up 27.01. iid had 1.0^M\ncloud-setup: failed 18/30: up 28.22. iid had 1.0^M\ncloud-setup: failed 19/30: up 29.43. iid had 1.0^M\ncloud-setup: failed 20/30: up 30.65. iid had 1.0^M\ncloud-setup: failed 21/30: up 31.86. iid had 1.0^M\ncloud-setup: failed 22/30: up 33.08. iid had 1.0^M\ncloud-setup: failed 23/30: up 34.30. iid had 1.0^M\ncloud-setup: failed 24/30: up 35.60. iid had 1.0^M\ncloud-setup: failed 25/30: up 36.89. iid had 1.0^M\ncloud-setup: failed 26/30: up 38.11. iid had 1.0^M\ncloud-setup: failed 27/30: up 39.34. iid had 1.0^M\ncloud-setup: failed 28/30: up 40.56. iid had 1.0^M\ncloud-setup: failed 29/30: up 41.82. iid had 1.0^M\ncloud-setup: failed 30/30: up 43.05. iid had 1.0^M\ncloud-setup: after 30 fails, debugging^M\ncloud-setup: running debug (30 tries reached)^M\n############ debug start ##############^M\n### /etc/rc.d/init.d/sshd start^M\nstty: /dev/console^M\ngenerating DSS host key [^[[1;33mWATING^[[0;39m]^[[-11G^[[1;34m..^[[0;39m [ ^[[1;32mOK^[[0;39m ]^M\ngenerating RSA host key [^[[1;33mWATING^[[0;39m]^[[-11G^[[1;34m..^[[0;39m [ ^[[1;32mOK^[[0;39m ]^M\nstartup dropbear [ ^[[1;32mOK^[[0;39m ]^M\n### ifconfig -a^M\neth0 Link encap:Ethernet HWaddr 02:16:3E:57:D3:B5 ^M\n=========================================\n\n\nLogs from UEC image.\n=========================================\ninit: plymouth-splash main process (263) terminated with status 2\ninit: plymouth main process (48) killed by SEGV signal\ncloud-init running: Tue, 15 Feb 2011 09:55:54 +0000. up 30.11 seconds\nconsuming user data failed!\nTraceback (most recent call last):\n  File \"/usr/bin/cloud-init\", line 103, in <module>\n    main()\n  File \"/usr/bin/cloud-init\", line 60, in main\n    cloud.consume_userdata,[],False)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/__init__.py\", line 215, in sem_and_run\n    if self.sem_has_run(semname,freq): return\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/__init__.py\", line 173, in sem_has_run\n    semfile = self.sem_getpath(name,freq)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/__init__.py\", line 167, in sem_getpath\n    freqtok = self.datasource.get_instance_id()\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/DataSourceEc2.py\", line 65, in get_instance_id\n    return(self.metadata['instance-id'])\nKeyError: 'instance-id'\ninit: cloud-init main process (334) terminated with status 1\nmountall: Event failed\nmountall: Plymouth command failed\nmountall: Plymouth command failed\nmountall: Plymouth command failed\nmountall: Plymouth command failed\nmountall: Disconnected from Plymouth\ninit: plymouth-log main process (364) terminated with status 1\n * Starting AppArmor profiles                                            [ OK ]\nTraceback (most recent call last):\n  File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\nTraceback (most recent call last):\n  File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n    main()\n    main()\n  File \"/usr/bin/cloud-init-cfg\", line 43, in main\n    cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n  File \"/usr/bin/cloud-init-cfg\", line 43, in main\n    cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n    self.cfg = self.get_config_obj(cfgfile)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n    f=file(cfgfile)\nTraceback (most recent call last):\n  File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n    self.cfg = self.get_config_obj(cfgfile)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n    f=file(cfgfile)\nIOError: IOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\n    main()\n  File \"/usr/bin/cloud-init-cfg\", line 43, in main\n    cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n    self.cfg = self.get_config_obj(cfgfile)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n[Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\n    f=file(cfgfile)\nIOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\nTraceback (most recent call last):\n  File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n    main()\n  File \"/usr/bin/cloud-init-cfg\", line 43, in main\n    cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n    self.cfg = self.get_config_obj(cfgfile)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n    f=file(cfgfile)\nIOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\nTraceback (most recent call last):\n  File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n    main()\n  File \"/usr/bin/cloud-init-cfg\", line 43, in main\n    cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n    self.cfg = self.get_config_obj(cfgfile)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n    f=file(cfgfile)\nIOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'\nlandscape-client is not configured, please run landscape-config.\nTraceback (most recent call last):\n  File \"/usr/bin/cloud-init-cfg\", line 56, in <module>\n    main()\n  File \"/usr/bin/cloud-init-cfg\", line 43, in main\n    cc = cloudinit.CloudConfig.CloudConfig(cfg_path)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 42, in __init__\n    self.cfg = self.get_config_obj(cfgfile)\n  File \"/usr/lib/python2.6/dist-packages/cloudinit/CloudConfig.py\", line 53, in get_config_obj\n    f=file(cfgfile)\nIOError: [Errno 2] No such file or directory: '/var/lib/cloud/data/cloud-config.txt'", 
            "date_created": "2011-02-16 05:13:02.306394+00:00", 
            "author": "https://api.launchpad.net/1.0/~hyunsun-moon"
        }, 
        {
            "content": "What network mode are you using ? Modes outside VlanNamager require specific routing for metadata server to work.", 
            "date_created": "2011-02-23 11:04:01.823643+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "It was default VLAN mode.", 
            "date_created": "2011-02-24 05:05:48.705154+00:00", 
            "author": "https://api.launchpad.net/1.0/~hyunsun-moon"
        }, 
        {
            "content": "Greetings!\n\nI've messed around quite a bit with the UEC images, and I found if you add an iptables NAT wherever your nova-api services runs it fixes the boot problems.  You would want something like this...\n\niptables -t nat -A PREROUTING -d 169.254.169.254/32 -p tcp -m tcp --dport 80 -j DNAT --to-destination <NOVA-API-SERVER-IP>:8773\n\nThierry is right though, VlanManager /usually/ doesn't need this, but it's worth a shot.  Lastly, to be honest, it looks like there is more going on with your UEC image than just the metadata server not getting contacted...if that was the only case, you'd likely see something more along, 'Cannot reach metadata server ... trying again 1/100.'  The image will try 100 times to contact the metadata server, and if it can't it will sometimes continue booting, but in my experience it just loops :(\n\nGive it a try, and let us know how it goes!\n\nCheers\n\n\n\n", 
            "date_created": "2011-02-24 05:46:10.632735+00:00", 
            "author": "https://api.launchpad.net/1.0/~wayne-walls"
        }, 
        {
            "content": "I've already tried iptables command and it didn't work for me.\nThe reason I need to access metadata server is for cloudpipe instance, get 'autorun.sh' from the server.\n\nHere's my 'iptables -L' result. \"cloud02\" the hostname of API Server.\nSomething wrong? \n\nChain INPUT (policy DROP)\ntarget     prot opt source               destination\nACCEPT     udp  --  anywhere             anywhere            udp dpt:domain\nACCEPT     tcp  --  anywhere             anywhere            tcp dpt:domain\nACCEPT     udp  --  anywhere             anywhere            udp dpt:bootps\nACCEPT     tcp  --  anywhere             anywhere            tcp dpt:bootps\nACCEPT     all  --  anywhere             anywhere\nACCEPT     icmp --  anywhere             anywhere            icmp any\nACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:ftp\nACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:ssh\nACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:telnet\nACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:smtp\nACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:www\nDROP       all  --  anywhere             anywhere            state INVALID\nACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:ssh\nACCEPT     udp  --  anywhere             anywhere            udp dpt:ntp\nnova_input  all  --  anywhere             anywhere\nACCEPT     icmp --  anywhere             anywhere\nREJECT     tcp  --  anywhere             anywhere            reject-with tcp-reset\nREJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable\n\nChain FORWARD (policy DROP)\ntarget     prot opt source               destination\nnova-local  all  --  anywhere             anywhere\nACCEPT     all  --  anywhere             anywhere\nACCEPT     all  --  anywhere             anywhere\nACCEPT     udp  --  anywhere             10.0.0.2            udp dpt:openvpn\nACCEPT     all  --  anywhere             192.168.122.0/24    state RELATED,ESTABLISHED\nACCEPT     all  --  192.168.122.0/24     anywhere\nACCEPT     all  --  anywhere             anywhere\nREJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable\nREJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable\nDROP       all  --  anywhere             anywhere            state INVALID\nACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED\nTCPMSS     tcp  --  anywhere             anywhere            tcp flags:SYN,RST/SYN TCPMSS clamp to PMTU\nnova_forward  all  --  anywhere             anywhere\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nnova-local  all  --  anywhere             anywhere\nDROP       all  --  anywhere             anywhere            state INVALID\nACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED\nnova_output  all  --  anywhere             anywhere\n\nChain nova-fallback (1 references)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             anywhere\n\nChain nova-inst-1 (1 references)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             anywhere            state INVALID\nACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED\nnova-sg-1  all  --  anywhere             anywhere\nACCEPT     udp  --  10.0.0.1             anywhere            udp spt:bootps dpt:bootpc\nACCEPT     all  --  10.0.0.0/26          anywhere\nnova-fallback  all  --  anywhere             anywhere\n\nChain nova-local (2 references)\ntarget     prot opt source               destination\nnova-inst-1  all  --  anywhere             10.0.0.3\n\nChain nova-sg-1 (1 references)\ntarget     prot opt source               destination\n\nChain nova_forward (1 references)\ntarget     prot opt source               destination\n\nChain nova_input (1 references)\ntarget     prot opt source               destination\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:8649\nACCEPT     udp  --  anywhere             cloud02             udp dpt:8649\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:www\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:https\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:3333\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:8773\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:6379\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:mysql\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:4369\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:amqp\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:53284\nACCEPT     tcp  --  10.0.0.0/12          anywhere            tcp dpt:domain\nACCEPT     udp  --  10.0.0.0/12          anywhere            udp dpt:domain\nACCEPT     udp  --  anywhere             anywhere            udp dpt:bootps\nACCEPT     tcp  --  anywhere             cloud02             tcp dpt:ldap\n\nChain nova_output (1 references)\ntarget     prot opt source               destination\n\n\n", 
            "date_created": "2011-02-24 06:07:24.005515+00:00", 
            "author": "https://api.launchpad.net/1.0/~hyunsun-moon"
        }, 
        {
            "content": "I don't really know where this fails, but the plan is to simplify metadata access by serving metadata from the local compute node rather than from the API node. This should then work in every network mode and not rely on fancy routes/rules/bridges setup.", 
            "date_created": "2011-02-24 13:39:34.228521+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "If this is a desktop image, you may have to give the 169.254 address to the network host:\nsomething like:\nip addr add 169.254.169.254/32 scope link dev eth1\nThis will allow it to arp for the address.  The eth device that you add the address to isn't particularly important, although if you decide to add it to br100 you should probably use scope global instead of scope link, or the ordering of ip addresses can sometimes mess up dhcp.\nIf this is not a desktop image, then you may be having issues with your forwarding rules. Check:\niptables -L -n -v\nfor the 169.254 rule.  Make sure that the rule has the proper ip for your api server and make sure that the rule is actually getting hit properly.\n\nThe ip addr add command really needs to be done automatically.  I consider this a must have for cactus.  The workaround of adding it manually is too much to expect users to have to do\n", 
            "date_created": "2011-03-21 19:51:54.102646+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ], 
    "closed": "2011-04-15 08:33:47.932775+00:00"
}