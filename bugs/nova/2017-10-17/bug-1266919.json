{
    "status": "Fix Released", 
    "last_updated": "2014-09-13 22:46:27.134021+00:00", 
    "description": "If you're trying to delete an instance which is out-of-sync such that it's missing a InstanceInfoCache entry, you'll will receive a traceback: http://paste.openstack.org/show/60685/\n\nDelete in this case should be allowed so that you can cleanup these 'broken' instances.\n\nThe solution is to catch the InstanceInfoCacheNotFound exception (like we do with other NotFound exceptions around this code), and continue on.", 
    "tags": [
        "havana-backport-potential", 
        "testing", 
        "unified-objects"
    ], 
    "importance": "High", 
    "heat": 38, 
    "link": "https://bugs.launchpad.net/nova/+bug/1266919", 
    "owner": "https://api.launchpad.net/1.0/~rconradharris", 
    "id": 1266919, 
    "index": 1365, 
    "openned": "2014-01-07 21:26:49.258867+00:00", 
    "created": "2014-01-07 21:26:49.258867+00:00", 
    "title": "Missing InstanceInfoCache entry prevents delete", 
    "comments": [
        {
            "content": "If you're trying to delete an instance which is out-of-sync such that it's missing a InstanceInfoCache entry, you'll will receive a traceback: http://paste.openstack.org/show/60685/\n\nDelete in this case should be allowed so that you can cleanup these 'broken' instances.\n\nThe solution is to catch the InstanceInfoCacheNotFound exception (like we do with other NotFound exceptions around this code), and continue on.", 
            "date_created": "2014-01-07 21:26:49.258867+00:00", 
            "author": "https://api.launchpad.net/1.0/~rconradharris"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/65374", 
            "date_created": "2014-01-07 21:31:31.594219+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I got similar but different logs, is your fix able to fix this exception?\n\n2014-01-18 03:41:03.919 15091 INFO nova.compute.manager [-] [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6] NV-E7B9660 Destroying instance with name label 'xw00020' which is marked as DELETED but still present on host.\n2014-01-18 03:41:03.919 15091 AUDIT nova.compute.manager [req-aef06534-ada2-4751-833f-fc99715e331e None None] [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6] NV-067140C Terminating instance\n2014-01-18 03:41:04.126 15091 ERROR nova.network.api [-] [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6] Failed storing info cache\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6] Traceback (most recent call last):\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/network/api.py\", line 83, in update_instance_cache_with_nw_info\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     ic.save(update_cells=update_cells)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 143, in wrapper\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     ctxt, self, fn.__name__, args, kwargs)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/conductor/rpcapi.py\", line 474, in object_action\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     objmethod=objmethod, args=args, kwargs=kwargs)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 85, in call\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 63, in _invoke\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     return cast_or_call(ctxt, msg, **self.kwargs)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/proxy.py\", line 126, in call\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     result = rpc.call(context, real_topic, msg, timeout)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/__init__.py\", line 139, in call\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     return _get_impl().call(CONF, context, topic, msg, timeout)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/impl_qpid.py\", line 783, in call\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     rpc_amqp.get_connection_pool(conf, Connection))\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 574, in call\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     rv = list(rv)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 539, in __iter__\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     raise result\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6] InstanceInfoCacheNotFound_Remote: Info cache for instance 6b223492-b954-4d17-9481-bfcc6208e4f6 could not be found.\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6] Traceback (most recent call last):\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\", line 576, in _object_dispatch\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     return getattr(target, method)(context, *args, **kwargs)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 152, in wrapper\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     return fn(self, ctxt, *args, **kwargs)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/objects/instance_info_cache.py\", line 91, in save\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     {'network_info': nw_info_json})\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 863, in instance_info_cache_update\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     return IMPL.instance_info_cache_update(context, instance_uuid, values)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     return f(*args, **kwargs)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 2343, in instance_info_cache_update\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]     instance_uuid=instance_uuid)\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6] InstanceInfoCacheNotFound: Info cache for instance 6b223492-b954-4d17-9481-bfcc6208e4f6 could not be found.\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.126 15091 TRACE nova.network.api [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6]\n2014-01-18 03:41:04.128 15091 WARNING nova.compute.manager [-] [instance: 6b223492-b954-4d17-9481-bfcc6208e4f6] NV-8907E85 Periodic cleanup failed to delete instance: Info cache for instance 6b223492-b954-4d17-9481-bfcc6208e4f6 could not be found.\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\", line 576, in _object_dispatch\n    return getattr(target, method)(context, *args, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 152, in wrapper\n    return fn(self, ctxt, *args, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/objects/instance_info_cache.py\", line 91, in save\n    {'network_info': nw_info_json})\n\n  File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 863, in instance_info_cache_update\n    return IMPL.instance_info_cache_update(context, instance_uuid, values)\n\n  File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 2343, in instance_info_cache_update\n    instance_uuid=instance_uuid)\n\nInstanceInfoCacheNotFound: Info cache for instance 6b223492-b954-4d17-9481-bfcc6208e4f6 could not be found.\n\nBest Regards! \n\n", 
            "date_created": "2014-01-20 02:22:06.413188+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Hitting it here too:\n\nhttp://logs.openstack.org/67/67767/2/check/check-tempest-dsvm-postgres-full/9a75aa3/logs/screen-n-cpu.txt.gz?level=TRACE", 
            "date_created": "2014-01-20 14:48:38.232473+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Nearly 744K hits on this query in the last 7 days:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiRXhjZXB0aW9uIGRpc3BhdGNoaW5nIGV2ZW50XCIgQU5EIG1lc3NhZ2U6XCJJbmZvIGNhY2hlIGZvciBpbnN0YW5jZVwiIEFORCBtZXNzYWdlOlwiY291bGQgbm90IGJlIGZvdW5kXCIgQU5EIGZpbGVuYW1lOlwibG9ncy9zY3JlZW4tbi1jcHUudHh0XCIiLCJmaWVsZHMiOltdLCJvZmZzZXQiOjAsInRpbWVmcmFtZSI6IjYwNDgwMCIsImdyYXBobW9kZSI6ImNvdW50IiwidGltZSI6eyJ1c2VyX2ludGVydmFsIjowfSwic3RhbXAiOjEzOTAyMjk1OTMzMzR9\n\nNote that there is a 10% success rate when that shows up also.", 
            "date_created": "2014-01-20 14:54:27.434107+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Making this high importance since it makes debugging the n-cpu log hard when something else fails.", 
            "date_created": "2014-01-20 22:28:35.873933+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Not sure if this is related: https://review.openstack.org/66371\n\nFrom logstash it looks like this has been showing since before that patch has been around (at least 1/8) so might not be it.", 
            "date_created": "2014-01-20 22:35:56.153345+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/65374\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=6438d2587e1b93c73b8461b0e7dbd7bcd5243aea\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6438d2587e1b93c73b8461b0e7dbd7bcd5243aea\nAuthor: Rick Harris <email address hidden>\nDate:   Tue Jan 7 15:29:03 2014 -0600\n\n    Allow delete when InstanceInfoCache entry is missing\n    \n    The existing code wouldn't allow you to delete 'broken' instances that were\n    (for whatever reason) missing their InstanceInfoCache entry. This patch fixes\n    it such that those instances can be deleted.\n    \n    Adds a test case to cover the new exception handling.\n    \n    Closes-Bug: #1266919\n    \n    Co-Authored-By: Matt Riedemann <email address hidden>\n    Change-Id: I3d566a25e340b5d5de86740141e1eaa5b3742915\n", 
            "date_created": "2014-01-25 12:18:10.831172+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-05 13:08:31.148749+00:00"
}