{
    "status": "Invalid", 
    "last_updated": "2017-05-07 19:33:54.865413+00:00", 
    "description": "### Steps to reproduce\nI have two compute node, source com and dest com.\nI did execute \"live migration\" command.\n  $ nova live-migration <instance id> <dest com>\n\n### Expected result\nThe instance is migrated to dest com host and the status change from MIGRATING to ACTIVE.\n\n### Actual result\nDuring _post_livemigration function, the multipath command somehow returned \"code 1\" , I think it's a temporary error, on source com.\nAnd the status remains MIGRATING\n\nI think retrying multipath command can avoid this problem.\n\n### Environment\n1. [version] My environment is actually Kilo (openstack-nova-compute-2015.1.1-1.el7.noarch), but I belive the implementation is not much changed on the latest version.\n2. [hypervisor] Libvirt + KVM (RHEL7.1)\n3. [storage] FC Multipath\n4. [network] openvswitch vlan\n\n### Logs \nnova-compute.log on source com:\n\nLock \"connect_volume\" acquired by \"disconnect_volume\" :: waited 0.000s inner /usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py:444\nRunning cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf multipath -l 123456789012345678901234567890123 execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:199\nCMD \"sudo nova-rootwrap /etc/nova/rootwrap.conf multipath -l 123456789012345678901234567890123\" returned: 1 in 0.109s execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:225\nu'sudo nova-rootwrap /etc/nova/rootwrap.conf multipath -l 123456789012345678901234567890123' failed. Not Retrying. execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:258\nMultipath call failed exit (1)\nLock \"connect_volume\" released by \"disconnect_volume\" :: held 0.112s inner /usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py:456\n[instance: abcdefgh-ijkl-mnlo-pqrs-tuvwxyz12345] Error monitoring migration: 'NoneType' object has no attribute '__getitem__'\n Traceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5708, in _live_migration\n    dom, finish_event)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5638, in _live_migration_monitor\n    migrate_data)\n  File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n    payload)\n  File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 355, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n  File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 343, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5355, in _post_live_migration\n    migrate_data)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5983, in post_live_migration\n    self._disconnect_volume(connection_info, disk_dev)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1023, in _disconnect_volume\n    return driver.disconnect_volume(connection_info, disk_dev)\n  File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 445, in inner\n    return f(*args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/volume.py\", line 1402, in disconnect_volume\n    devices = mdev_info['devices']\nTypeError: 'NoneType' object has no attribute '__getitem__'\n[instance: abcdefgh-ijkl-mnlo-pqrs-tuvwxyz12345] Live migration monitoring is all done _live_migration /usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py:5715", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1686868", 
    "owner": "None", 
    "id": 1686868, 
    "index": 8090, 
    "openned": "2017-04-28 01:20:14.747617+00:00", 
    "created": "2017-04-28 01:20:14.747617+00:00", 
    "title": "live-migration failed when multipath command returned code 1", 
    "comments": [
        {
            "content": "### Steps to reproduce\nI have two compute node, source com and dest com.\nI did execute \"live migration\" command.\n  $ nova live-migration <instance id> <dest com>\n\n### Expected result\nThe instance is migrated to dest com host and the status change from MIGRATING to ACTIVE.\n\n### Actual result\nDuring _post_livemigration function, the multipath command somehow returned \"code 1\" , I think it's a temporary error, on source com.\nAnd the status remains MIGRATING\n\nI think retrying multipath command can avoid this problem.\n\n### Environment\n1. [version] My environment is actually Kilo (openstack-nova-compute-2015.1.1-1.el7.noarch), but I belive the implementation is not much changed on the latest version.\n2. [hypervisor] Libvirt + KVM (RHEL7.1)\n3. [storage] FC Multipath\n4. [network] openvswitch vlan\n\n### Logs \nnova-compute.log on source com:\n\nLock \"connect_volume\" acquired by \"disconnect_volume\" :: waited 0.000s inner /usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py:444\nRunning cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf multipath -l 123456789012345678901234567890123 execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:199\nCMD \"sudo nova-rootwrap /etc/nova/rootwrap.conf multipath -l 123456789012345678901234567890123\" returned: 1 in 0.109s execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:225\nu'sudo nova-rootwrap /etc/nova/rootwrap.conf multipath -l 123456789012345678901234567890123' failed. Not Retrying. execute /usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py:258\nMultipath call failed exit (1)\nLock \"connect_volume\" released by \"disconnect_volume\" :: held 0.112s inner /usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py:456\n[instance: abcdefgh-ijkl-mnlo-pqrs-tuvwxyz12345] Error monitoring migration: 'NoneType' object has no attribute '__getitem__'\n Traceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5708, in _live_migration\n    dom, finish_event)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5638, in _live_migration_monitor\n    migrate_data)\n  File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n    payload)\n  File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 355, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n  File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 343, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5355, in _post_live_migration\n    migrate_data)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 5983, in post_live_migration\n    self._disconnect_volume(connection_info, disk_dev)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1023, in _disconnect_volume\n    return driver.disconnect_volume(connection_info, disk_dev)\n  File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 445, in inner\n    return f(*args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/volume.py\", line 1402, in disconnect_volume\n    devices = mdev_info['devices']\nTypeError: 'NoneType' object has no attribute '__getitem__'\n[instance: abcdefgh-ijkl-mnlo-pqrs-tuvwxyz12345] Live migration monitoring is all done _live_migration /usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py:5715", 
            "date_created": "2017-04-28 01:20:14.747617+00:00", 
            "author": "https://api.launchpad.net/1.0/~tsujii-tetsuo"
        }, 
        {
            "content": "> 1. [version] My environment is actually Kilo (openstack-nova-compute-2015.1.1-1.el7.noarch),\n> but I belive the implementation is not much \n\nActually it has, os-brick now handles disconnect_volume calls for multipath iSCSI volumes. The code within os-brick is also being heavily refactored at the moment on the topic below :\n\nhttps://review.openstack.org/#/q/status:open+project:openstack/os-brick+branch:master+topic:refactor/multipath\n\nMarking this bug as invalid for now, if you can reproduce against a supported release please add os-brick to the bug.", 
            "date_created": "2017-05-07 19:33:50.441126+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyarwood"
        }
    ], 
    "closed": "2017-05-07 19:33:52.903202+00:00"
}