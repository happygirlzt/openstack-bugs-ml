{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:42:59.262481+00:00", 
    "description": "2013-04-22 15:12:07    ERROR [nova.openstack.common.rpc.amqp] Exception during message handling\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 433, in _process_data\n    **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 148, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 3046, in attach_interface\n    self.conductor_api)\n  File \"/opt/stack/nova/nova/network/api.py\", line 47, in wrapper\n    res = f(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 342, in allocate_port_for_instance\n    conductor_api=conductor_api)\n  File \"/opt/stack/nova/nova/network/api.py\", line 47, in wrapper\n    res = f(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 286, in allocate_for_instance\n    nw_info = self._get_instance_nw_info(context, instance, networks=nets)\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 383, in _get_instance_nw_info\n    nw_info = self._build_network_info_model(context, instance, networks)\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 827, in _build_network_info_model\n    [n['id'] for n in networks])\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 984, in _ensure_requested_network_ordering\n    unordered.sort(key=lambda i: preferred.index(accessor(i)))\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 984, in <lambda>\n    unordered.sort(key=lambda i: preferred.index(accessor(i)))\nValueError: u'474719de-5160-48a9-8741-dcf3ff859978' is not in list\n2013-04-22 15:12:07    ERROR [nova.openstack.common.rpc.common] Returning exception u'474719de-5160-48a9-8741-dcf3ff859978' is not in list to caller\n2013-04-22 15:12:07    ERROR [nova.openstack.common.rpc.common] ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 433, in _process_data\\n    **args)\\n', '  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 148, in dispatch\\n    return getattr(proxyobj, method)(ctxt, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 3046, in attach_interface\\n    self.conductor_api)\\n', '  File \"/opt/stack/nova/nova/network/api.py\", line 47, in wrapper\\n    res = f(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 342, in allocate_port_for_instance\\n    conductor_api=conductor_api)\\n', '  File \"/opt/stack/nova/nova/network/api.py\", line 47, in wrapper\\n    res = f(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 286, in allocate_for_instance\\n    nw_info = self._get_instance_nw_info(context, instance, networks=nets)\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 383, in _get_instance_nw_info\\n    nw_info = self._build_network_info_model(context, instance, networks)\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 827, in _build_network_info_model\\n    [n[\\'id\\'] for n in networks])\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 984, in _ensure_requested_network_ordering\\n    unordered.sort(key=lambda i: preferred.index(accessor(i)))\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 984, in <lambda>\\n    unordered.sort(key=lambda i: preferred.index(accessor(i)))\\n', \"ValueError: u'474719de-5160-48a9-8741-dcf3ff859978' is not in list\\n\"]", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 28, 
    "link": "https://bugs.launchpad.net/nova/+bug/1171636", 
    "owner": "https://api.launchpad.net/1.0/~danms", 
    "id": 1171636, 
    "index": 3367, 
    "openned": "2013-04-22 22:14:06.449518+00:00", 
    "created": "2013-04-22 22:14:06.449518+00:00", 
    "title": "nova interface-attach fails with quantum", 
    "comments": [
        {
            "content": "2013-04-22 15:12:07    ERROR [nova.openstack.common.rpc.amqp] Exception during message handling\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 433, in _process_data\n    **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 148, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 3046, in attach_interface\n    self.conductor_api)\n  File \"/opt/stack/nova/nova/network/api.py\", line 47, in wrapper\n    res = f(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 342, in allocate_port_for_instance\n    conductor_api=conductor_api)\n  File \"/opt/stack/nova/nova/network/api.py\", line 47, in wrapper\n    res = f(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 286, in allocate_for_instance\n    nw_info = self._get_instance_nw_info(context, instance, networks=nets)\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 383, in _get_instance_nw_info\n    nw_info = self._build_network_info_model(context, instance, networks)\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 827, in _build_network_info_model\n    [n['id'] for n in networks])\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 984, in _ensure_requested_network_ordering\n    unordered.sort(key=lambda i: preferred.index(accessor(i)))\n  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 984, in <lambda>\n    unordered.sort(key=lambda i: preferred.index(accessor(i)))\nValueError: u'474719de-5160-48a9-8741-dcf3ff859978' is not in list\n2013-04-22 15:12:07    ERROR [nova.openstack.common.rpc.common] Returning exception u'474719de-5160-48a9-8741-dcf3ff859978' is not in list to caller\n2013-04-22 15:12:07    ERROR [nova.openstack.common.rpc.common] ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 433, in _process_data\\n    **args)\\n', '  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 148, in dispatch\\n    return getattr(proxyobj, method)(ctxt, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 3046, in attach_interface\\n    self.conductor_api)\\n', '  File \"/opt/stack/nova/nova/network/api.py\", line 47, in wrapper\\n    res = f(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 342, in allocate_port_for_instance\\n    conductor_api=conductor_api)\\n', '  File \"/opt/stack/nova/nova/network/api.py\", line 47, in wrapper\\n    res = f(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 286, in allocate_for_instance\\n    nw_info = self._get_instance_nw_info(context, instance, networks=nets)\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 383, in _get_instance_nw_info\\n    nw_info = self._build_network_info_model(context, instance, networks)\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 827, in _build_network_info_model\\n    [n[\\'id\\'] for n in networks])\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 984, in _ensure_requested_network_ordering\\n    unordered.sort(key=lambda i: preferred.index(accessor(i)))\\n', '  File \"/opt/stack/nova/nova/network/quantumv2/api.py\", line 984, in <lambda>\\n    unordered.sort(key=lambda i: preferred.index(accessor(i)))\\n', \"ValueError: u'474719de-5160-48a9-8741-dcf3ff859978' is not in list\\n\"]", 
            "date_created": "2013-04-22 22:14:06.449518+00:00", 
            "author": "https://api.launchpad.net/1.0/~arosen"
        }, 
        {
            "content": "unassigned for now... will pick up later if no one else does. I have some other stuff on my plate I need to fix first. ", 
            "date_created": "2013-04-23 00:45:06.445877+00:00", 
            "author": "https://api.launchpad.net/1.0/~arosen"
        }, 
        {
            "content": "To reproduce: \n\ncreate two networks: \n\nquantum net-create net1 \nquantum net-create net2\nquantum subnet-create net1 10.0.0.0/24\nquantum subnet-create net2 11.0.0.0/24\n\nnova boot --nic net-id=<net-1-uuid> .... vm1\nnova interface-attach --net-id <net2-uuid> <vm1>", 
            "date_created": "2013-04-23 18:01:53.913104+00:00", 
            "author": "https://api.launchpad.net/1.0/~arosen"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/27820", 
            "date_created": "2013-04-30 16:18:26.378161+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/27821", 
            "date_created": "2013-04-30 16:19:28.096988+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/27820\nCommitted: http://github.com/openstack/nova/commit/08c7cf5c67a75dea9b453bd915a0cd55e67c4adc\nSubmitter: Jenkins\nBranch:    master\n\ncommit 08c7cf5c67a75dea9b453bd915a0cd55e67c4adc\nAuthor: Dan Smith <email address hidden>\nDate:   Mon Apr 29 16:33:49 2013 -0700\n\n    Fix building quantumapi network model with network list\n    \n    Bug 1171636 occurs when _build_network_info_model() receives a list\n    of networks that does not fully map all of an instance's ports.\n    It crashes in _ensure_requested_network_ordering() when the list of\n    all ports is sorted by the subset of networks provided.\n    \n    This change simplifies the early part of that function to only\n    consider ports within the networks provided, and to always sort those\n    ports in network order. This allows us to remove some error path\n    code from the loop below that iterates over the ports (which contained\n    a fatal typo, by the way) which is now dead code.\n    \n    The affected code is really untested at the moment, due to the\n    structure of the method, making it hard to add a unit test to cover\n    this fix. In order to make the change clear from the existing code,\n    this fix is provided here first, and the following patch restructures\n    the method and add tests for this change and the rest of the surrounding\n    code.\n    \n    Fixes bug 1171636\n    \n    Change-Id: Idf519a88415844451b18959b38cc48ce92c090d1\n", 
            "date_created": "2013-05-02 14:11:20.478656+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/27821\nCommitted: http://github.com/openstack/nova/commit/43d657a11e953660f36683d595976c8bd8edb4cc\nSubmitter: Jenkins\nBranch:    master\n\ncommit 43d657a11e953660f36683d595976c8bd8edb4cc\nAuthor: Dan Smith <email address hidden>\nDate:   Tue Apr 30 09:11:48 2013 -0700\n\n    Make _build_network_info_model testable\n    \n    This restructures the quantumapi _build_network_info_model()\n    method to be testable and adds tests for each of the smaller\n    components. It also provides verification for bug 1171636 by\n    ensuring that ports returned from the client that are not in the\n    set of networks passed don't cause the failure detailed in that\n    bug.\n    \n    Change-Id: I82f20f68122fc38e72c31e52283529614252c174\n", 
            "date_created": "2013-05-02 14:14:10.605932+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/28077", 
            "date_created": "2013-05-02 19:12:03.014243+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/28078", 
            "date_created": "2013-05-02 19:13:05.788098+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/28077\nCommitted: http://github.com/openstack/nova/commit/bba57e9fa63b7f55d403d9f6950c4cde425d83b0\nSubmitter: Jenkins\nBranch:    stable/grizzly\n\ncommit bba57e9fa63b7f55d403d9f6950c4cde425d83b0\nAuthor: Dan Smith <email address hidden>\nDate:   Mon Apr 29 16:33:49 2013 -0700\n\n    Fix building quantumapi network model with network list\n    \n    Bug 1171636 occurs when _build_network_info_model() receives a list\n    of networks that does not fully map all of an instance's ports.\n    It crashes in _ensure_requested_network_ordering() when the list of\n    all ports is sorted by the subset of networks provided.\n    \n    This change simplifies the early part of that function to only\n    consider ports within the networks provided, and to always sort those\n    ports in network order. This allows us to remove some error path\n    code from the loop below that iterates over the ports (which contained\n    a fatal typo, by the way) which is now dead code.\n    \n    The affected code is really untested at the moment, due to the\n    structure of the method, making it hard to add a unit test to cover\n    this fix. In order to make the change clear from the existing code,\n    this fix is provided here first, and the following patch restructures\n    the method and add tests for this change and the rest of the surrounding\n    code.\n    \n    Fixes bug 1171636\n    \n    Change-Id: Idf519a88415844451b18959b38cc48ce92c090d1\n    (cherry picked from commit 08c7cf5c67a75dea9b453bd915a0cd55e67c4adc)\n", 
            "date_created": "2013-05-26 09:30:03.491169+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "\nI see that the bug https://bugs.launchpad.net/nova/+bug/1171636\n\nis still reproducible when I follow the steps (im using stable/grizzly branch)\n\nThe error log is as below:\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014-\nx-image-meta-size: 25165824\nx-image-meta-is_public: True\ncontent-type: text/html; charset=UTF-8\nx-image-meta-disk_format: ami\nlog_http_response /opt/stack/python-glanceclient/glanceclient/common/http.py:150\n2013-08-28 17:53:30.068 DEBUG nova.openstack.common.rpc.amqp [req-a4ad554e-ab0e-4864-8eb6-a086eebe9021 demo demo] Making synchronous call on conductor \u2026 multicall /opt/stack/nova/nova/openstack/common/rpc/amqp.py:513\n2013-08-28 17:53:30.069 DEBUG nova.openstack.common.rpc.amqp [req-a4ad554e-ab0e-4864-8eb6-a086eebe9021 demo demo] MSG_ID is 5624c471e3604533bfe29f0b9e33e5be multicall /opt/stack/nova/nova/openstack/common/rpc/amqp.py:516\n2013-08-28 17:53:30.069 DEBUG nova.openstack.common.rpc.amqp [req-a4ad554e-ab0e-4864-8eb6-a086eebe9021 demo demo] UNIQUE_ID is e417b9a25b934feb85de7e41fbad6c06. _add_unique_id /opt/stack/nova/nova/openstack/common/rpc/amqp.py:322\n2013-08-28 17:53:30.071 25065 DEBUG amqp [-] Closed channel #1 _do_close /usr/local/lib/python2.7/dist-packages/amqp/channel.py:88\n2013-08-28 17:53:30.071 25065 DEBUG amqp [-] using channel_id: 1 __init__ /usr/local/lib/python2.7/dist-packages/amqp/channel.py:70\n2013-08-28 17:53:30.072 25065 DEBUG amqp [-] Channel open _open_ok /usr/local/lib/python2.7/dist-packages/amqp/channel.py:420\n2013-08-28 17:53:30.096 ERROR nova.openstack.common.rpc.amqp [req-a4ad554e-ab0e-4864-8eb6-a086eebe9021 demo demo] Exception during message handling\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp File \u201c/opt/stack/nova/nova/openstack/common/rpc/amqp.py\u201d, line 421, in _process_data\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp **args)\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp File \u201c/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\u201d, line 172, in dispatch\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp File \u201c/opt/stack/nova/nova/compute/manager.py\u201d, line 3642, in attach_interface\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp self.driver.attach_interface(instance, image_meta, network_info[0])\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp File \u201c/opt/stack/nova/nova/virt/libvirt/driver.py\u201d, line 1174, in attach_interface\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp self.vif_driver.plug(instance, vif)\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp File \u201c/opt/stack/nova/nova/virt/libvirt/vif.py\u201d, line 750, in plug\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp return self.plug_ovs_hybrid(instance, vif)\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp File \u201c/opt/stack/nova/nova/virt/libvirt/vif.py\u201d, line 400, in plug_ovs_hybrid\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp iface_id = self.get_ovs_interfaceid(vif)\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp File \u201c/opt/stack/nova/nova/virt/libvirt/vif.py\u201d, line 736, in get_ovs_interfaceid\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp return vif.get(\u2018ovs_interfaceid\u2019) or vif['id']\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp AttributeError: \u2018str\u2019 object has no attribute \u2018get\u2019\n2013-08-28 17:53:30.096 25065 TRACE nova.openstack.common.rpc.amqp\n2013-08-28 17:53:30.097 ERROR nova.openstack.common.rpc.common [req-a4ad554e-ab0e-4864-8eb6-a086eebe9021 demo demo] Returning exception \u2018str\u2019 object has no attribute \u2018get\u2019 to caller\n2013-08-28 17:53:30.098 ERROR nova.openstack.common.rpc.common [req-a4ad554e-ab0e-4864-8eb6-a086eebe9021 demo demo] ['Traceback (most recent call last):\\n', ' File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 421, in _process_data\\n **args)\\n', ' File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\\n result = getattr(proxyobj, method)(ctxt, **kwargs)\\n', ' File \"/opt/stack/nova/nova/compute/manager.py\", line 3642, in attach_interface\\n self.driver.attach_interface(instance, image_meta, network_info[0])\\n\u2019, \u2018 File \u201c/opt/stack/nova/nova/virt/libvirt/driver.py\u201d, line 1174, in attach_interface\\n self.vif_driver.plug(instance, vif)\\n\u2019, \u2018 File \u201c/opt/stack/nova/nova/virt/libvirt/vif.py\u201d, line 750, in plug\\n return self.plug_ovs_hybrid(instance, vif)\\n\u2019, \u2018 File \u201c/opt/stack/nova/nova/virt/libvirt/vif.py\u201d, line 400, in plug_ovs_hybrid\\n iface_id = self.get_ovs_interfaceid(vif)\\n\u2019, \u2018 File \u201c/opt/stack/nova/nova/virt/libvirt/vif.py\u201d, line 736, in get_ovs_interfaceid\\n return vif.get(\\\u2019ovs_interfaceid\\\u2019) or vif[\\'id\\']\\n\u2019, \u201cAttributeError: \u2018str\u2019 object has no attribute \u2018get\u2019\\n\u201d]\n2013-08-28 17:53:30.098 DEBUG nova.openstack.common.rpc.amqp [req-a4ad554e-ab0e-4864-8eb6-a086eebe9021 demo demo] UNIQUE_ID is 20d91899ef574f559170a142017c0a9c. _add_unique_id /opt/stack/nova/nova/openstack/common/rpc/amqp.py:322\n2013-08-28 17:53:30.100 25065 DEBUG amqp [-] Closed channel #1 _do_close /usr/local/lib/python2.7/dist-packages/amqp/channel.py:88\n2013-08-28 17:53:30.100 25065 DEBUG amqp [-] using channel_id: 1 __init__ /usr/local/lib/python2.7/dist-packages/amqp/channel.py:70\n2013-08-28 17:53:30.101 25065 DEBUG amqp [-] Channel open _open_ok /usr/local/lib/python2.7/dist-packages/amqp/channel.py:420\n2013-08-28 17:53:39.893 25065 DEBUG nova.openstack.common.rpc.amqp [-] Making synchronous call on conductor \u2026 multicall /opt/stack/nova/nova/\n\nCan you please help me if I\u2019m doing something wrong?\n\nThanks,\nPraveen", 
            "date_created": "2013-08-29 01:34:24.989213+00:00", 
            "author": "https://api.launchpad.net/1.0/~inp-bitsg"
        }
    ], 
    "closed": "2013-05-29 10:26:35.242248+00:00"
}