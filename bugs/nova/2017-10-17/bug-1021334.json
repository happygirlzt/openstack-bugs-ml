{
    "status": "Invalid", 
    "last_updated": "2012-07-26 00:13:48.719816+00:00", 
    "description": "Using the flag --block_device_mapping, documented in [1] and [2], to attach during the boot a new volume to create a new instance, it does not work when xenapi is used. Below, the cmds I used to create a new instance with the volume attached and more information:\n\n-------\n::: cmd to create instance\n$ nova boot --flavor 1 --image c92354b8-8fdb-4e70-97ba-71935c622ba5 --key_name cloud --user_data cloud.conf --block_device_mapping xvdb=17:::0 xen-boot-from-vol\n\n-------\n::: Instance information\n$ nova list | grep xen-boot-vol\n| 7abdf8ef-711b-4a6c-8773-decd891d6ed8 | xen-boot-vol | ACTIVE | novanetwork=172.25.25.20, 10.170.3.39 |\n\n-------\n::: Volume Information\n$ nova volume-list | grep 7abdf8ef-711b-4a6c-8773-decd891d6ed8\n| 17 | in-use | None         | 1    | None        | 7abdf8ef-711b-4a6c-8773-decd891d6ed8 |\n\n\n-------\n::: Instance_name\n$ nova show xen-boot-vol | grep OS-EXT-SRV-ATTR:instance_name\n| OS-EXT-SRV-ATTR:instance_name       | instance-000000da                                        |\n\n-------\n::: Instance information\n$ ssh root@10.170.3.39 -i mykey.pem\nroot@xen-boot-vol [ ~ ]# ls -l /dev/xvd*\nbrw-rw---- 1 root disk 202, 0 Jul  5 11:16 /dev/xvda\nbrw-rw---- 1 root disk 202, 1 Jul  5 11:16 /dev/xvda1\n\n-------\n::: XenServer/XCP Information\n$ ssh root@xenserver-host\n# xe sr-list name-label=Disk-for:instance-000000da\n# (No output)\n\n-------\n::: Log from domu (seems all ok)\n2012-07-05 11:16:15 DEBUG nova.compute.manager [req-a61b15ca-decd-4f4c-b33f-6533d2c27582 afae889ca8c84479b8195e8b0e462320 faa2e7d479914529bfceda68c8ca33df] [instance: 7abdf8ef-711b-4a6c-8773-decd891d6ed8] Instan\nce network_info: |[VIF({'network': Network({'bridge': u'br100', 'subnets': [Subnet({'ips': [FixedIP({'meta': {}, 'version': 4, 'type': u'fixed', 'floating_ips': [], 'address': u'172.25.25.20'})], 'version': 4, '\nmeta': {u'dhcp_server': u'172.25.25.9'}, 'dns': [IP({'meta': {}, 'version': 4, 'type': u'dns', 'address': u'10.10.112.2'}), IP({'meta': {}, 'version': 4, 'type': u'dns', 'address': u'10.10.112.6'})], 'routes': [\n], 'cidr': u'172.25.25.0/24', 'gateway': IP({'meta': {}, 'version': 4, 'type': u'gateway', 'address': u'172.25.25.1'})}), Subnet({'ips': [], 'version': None, 'meta': {u'dhcp_server': u'172.25.25.9'}, 'dns': [], \n'routes': [], 'cidr': None, 'gateway': IP({'meta': {}, 'version': None, 'type': u'gateway', 'address': None})})], 'meta': {u'multi_host': True, u'should_create_bridge': True, u'bridge_interface': u'eth1', u'tena\nnt_id': u'faa2e7d479914529bfceda68c8ca33df', u'vlan': 1825, u'should_create_vlan': True}, 'id': u'e5c65a42-40fe-4b20-8783-bb4148490116', 'label': u'novanetwork'}), 'meta': {}, 'id': u'85d5e648-8996-466e-ab05-887\nb4e139175', 'address': u'fa:16:3e:28:23:ac'})]| from (pid=3649) _allocate_network /usr/lib/python2.6/site-packages/nova/compute/manager.py:566\n2012-07-05 11:16:15 DEBUG nova.compute.manager [req-a61b15ca-decd-4f4c-b33f-6533d2c27582 afae889ca8c84479b8195e8b0e462320 faa2e7d479914529bfceda68c8ca33df] [instance: 7abdf8ef-711b-4a6c-8773-decd891d6ed8] Settin\ng up bdm <nova.db.sqlalchemy.models.BlockDeviceMapping object at 0x51d2490> from (pid=3649) _setup_block_device_mapping /usr/lib/python2.6/site-packages/nova/compute/manager.py:329\n2012-07-05 11:16:15 AUDIT nova.compute.manager [req-a61b15ca-decd-4f4c-b33f-6533d2c27582 afae889ca8c84479b8195e8b0e462320 faa2e7d479914529bfceda68c8ca33df] [instance: 7abdf8ef-711b-4a6c-8773-decd891d6ed8] Booting with volume 17 at xvdb\n\n\n--------\nMore information about versions used:\n- XCP 1.4.99\n- OpenStack nova / essex from griddynamics rpm packages\n- Cloud controller and domu: CentOS 6.2 64bit\n- Instance: CentOS 6.2 64bit\n\n--------\nIn the client side all seems ok but it does not happen in the server side as the information above shows.  \n\n\n\n[1] http://wiki.openstack.org/BootFromVolume\n[2] http://docs.openstack.org/trunk/openstack-compute/admin/content/boot-from-volume.html", 
    "tags": [
        "nova", 
        "xcp", 
        "xenserver"
    ], 
    "importance": "Undecided", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1021334", 
    "owner": "None", 
    "id": 1021334, 
    "index": 4188, 
    "openned": "2012-07-05 14:45:44.884224+00:00", 
    "created": "2012-07-05 14:45:44.884224+00:00", 
    "title": "Booting from volume not works using xenapi", 
    "comments": [
        {
            "content": "Using the flag --block_device_mapping, documented in [1] and [2], to attach during the boot a new volume to create a new instance, it does not work when xenapi is used. Below, the cmds I used to create a new instance with the volume attached and more information:\n\n-------\n::: cmd to create instance\n$ nova boot --flavor 1 --image c92354b8-8fdb-4e70-97ba-71935c622ba5 --key_name cloud --user_data cloud.conf --block_device_mapping xvdb=17:::0 xen-boot-from-vol\n\n-------\n::: Instance information\n$ nova list | grep xen-boot-vol\n| 7abdf8ef-711b-4a6c-8773-decd891d6ed8 | xen-boot-vol | ACTIVE | novanetwork=172.25.25.20, 10.170.3.39 |\n\n-------\n::: Volume Information\n$ nova volume-list | grep 7abdf8ef-711b-4a6c-8773-decd891d6ed8\n| 17 | in-use | None         | 1    | None        | 7abdf8ef-711b-4a6c-8773-decd891d6ed8 |\n\n\n-------\n::: Instance_name\n$ nova show xen-boot-vol | grep OS-EXT-SRV-ATTR:instance_name\n| OS-EXT-SRV-ATTR:instance_name       | instance-000000da                                        |\n\n-------\n::: Instance information\n$ ssh root@10.170.3.39 -i mykey.pem\nroot@xen-boot-vol [ ~ ]# ls -l /dev/xvd*\nbrw-rw---- 1 root disk 202, 0 Jul  5 11:16 /dev/xvda\nbrw-rw---- 1 root disk 202, 1 Jul  5 11:16 /dev/xvda1\n\n-------\n::: XenServer/XCP Information\n$ ssh root@xenserver-host\n# xe sr-list name-label=Disk-for:instance-000000da\n# (No output)\n\n-------\n::: Log from domu (seems all ok)\n2012-07-05 11:16:15 DEBUG nova.compute.manager [req-a61b15ca-decd-4f4c-b33f-6533d2c27582 afae889ca8c84479b8195e8b0e462320 faa2e7d479914529bfceda68c8ca33df] [instance: 7abdf8ef-711b-4a6c-8773-decd891d6ed8] Instan\nce network_info: |[VIF({'network': Network({'bridge': u'br100', 'subnets': [Subnet({'ips': [FixedIP({'meta': {}, 'version': 4, 'type': u'fixed', 'floating_ips': [], 'address': u'172.25.25.20'})], 'version': 4, '\nmeta': {u'dhcp_server': u'172.25.25.9'}, 'dns': [IP({'meta': {}, 'version': 4, 'type': u'dns', 'address': u'10.10.112.2'}), IP({'meta': {}, 'version': 4, 'type': u'dns', 'address': u'10.10.112.6'})], 'routes': [\n], 'cidr': u'172.25.25.0/24', 'gateway': IP({'meta': {}, 'version': 4, 'type': u'gateway', 'address': u'172.25.25.1'})}), Subnet({'ips': [], 'version': None, 'meta': {u'dhcp_server': u'172.25.25.9'}, 'dns': [], \n'routes': [], 'cidr': None, 'gateway': IP({'meta': {}, 'version': None, 'type': u'gateway', 'address': None})})], 'meta': {u'multi_host': True, u'should_create_bridge': True, u'bridge_interface': u'eth1', u'tena\nnt_id': u'faa2e7d479914529bfceda68c8ca33df', u'vlan': 1825, u'should_create_vlan': True}, 'id': u'e5c65a42-40fe-4b20-8783-bb4148490116', 'label': u'novanetwork'}), 'meta': {}, 'id': u'85d5e648-8996-466e-ab05-887\nb4e139175', 'address': u'fa:16:3e:28:23:ac'})]| from (pid=3649) _allocate_network /usr/lib/python2.6/site-packages/nova/compute/manager.py:566\n2012-07-05 11:16:15 DEBUG nova.compute.manager [req-a61b15ca-decd-4f4c-b33f-6533d2c27582 afae889ca8c84479b8195e8b0e462320 faa2e7d479914529bfceda68c8ca33df] [instance: 7abdf8ef-711b-4a6c-8773-decd891d6ed8] Settin\ng up bdm <nova.db.sqlalchemy.models.BlockDeviceMapping object at 0x51d2490> from (pid=3649) _setup_block_device_mapping /usr/lib/python2.6/site-packages/nova/compute/manager.py:329\n2012-07-05 11:16:15 AUDIT nova.compute.manager [req-a61b15ca-decd-4f4c-b33f-6533d2c27582 afae889ca8c84479b8195e8b0e462320 faa2e7d479914529bfceda68c8ca33df] [instance: 7abdf8ef-711b-4a6c-8773-decd891d6ed8] Booting with volume 17 at xvdb\n\n\n--------\nMore information about versions used:\n- XCP 1.4.99\n- OpenStack nova / essex from griddynamics rpm packages\n- Cloud controller and domu: CentOS 6.2 64bit\n- Instance: CentOS 6.2 64bit\n\n--------\nIn the client side all seems ok but it does not happen in the server side as the information above shows.  \n\n\n\n[1] http://wiki.openstack.org/BootFromVolume\n[2] http://docs.openstack.org/trunk/openstack-compute/admin/content/boot-from-volume.html", 
            "date_created": "2012-07-05 14:45:44.884224+00:00", 
            "author": "https://api.launchpad.net/1.0/~msinhore"
        }, 
        {
            "content": "Please test the implementation described in the blueprint:\nhttps://blueprints.launchpad.net/nova/+spec/xenapi-boot-from-volume", 
            "date_created": "2012-07-17 15:06:32.545214+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Didn't realize this bug was so new, but are you using the latest code?", 
            "date_created": "2012-07-17 15:08:46.305765+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "No, I'm not using the latest code where I got this issue. I get this using essex. I will do a backport to fix it in my environment and I will post here the patch for others using the same release.\n\nthanks", 
            "date_created": "2012-07-17 18:48:44.200996+00:00", 
            "author": "https://api.launchpad.net/1.0/~msinhore"
        }, 
        {
            "content": "Bear in mind that the block_device is mount_point agnostic. See \n\nhttps://review.openstack.org/#/c/8156/\n\nfor more details.\n", 
            "date_created": "2012-07-26 00:13:48.130297+00:00", 
            "author": "https://api.launchpad.net/1.0/~armando-migliaccio"
        }
    ], 
    "closed": "2012-07-23 14:53:04.989019+00:00"
}