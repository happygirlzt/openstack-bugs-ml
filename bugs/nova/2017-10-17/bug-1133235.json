{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:23:24.925096+00:00", 
    "description": "How to reproduce:\n\nIn nova.conf, specify sqlite for baremetal db\n[baremetal]\nsql_connection = sqlite:////tmp/b.db\n\nEnsure the db file is newly created\n$ rm /tmp/b.db \n\nUpgrade to version 4\n$ nova-baremetal-manage db sync --version 4\n\ninstance_name was added to bm_nodes by upgradeing\n$ sqlite3 /tmp/b.db \nSQLite version 3.7.9 2011-11-01 00:52:41\nEnter \".help\" for instructions\nEnter SQL statements terminated with a \";\"\nsqlite> .schema bm_nodes\nCREATE TABLE bm_nodes (\n\tcreated_at DATETIME, \n\tupdated_at DATETIME, \n\tdeleted_at DATETIME, \n\tdeleted BOOLEAN, \n\tid INTEGER NOT NULL, \n\tcpus INTEGER, \n\tmemory_mb INTEGER, \n\tlocal_gb INTEGER, \n\tpm_address VARCHAR(255), \n\tpm_user VARCHAR(255), \n\tpm_password VARCHAR(255), \n\tservice_host VARCHAR(255), \n\tprov_mac_address VARCHAR(255), \n\tinstance_uuid VARCHAR(36), \n\tregistration_status VARCHAR(16), \n\ttask_state VARCHAR(255), \n\tprov_vlan_id INTEGER, \n\tterminal_port INTEGER, image_path VARCHAR(255), pxe_config_path VARCHAR(255), deploy_key VARCHAR(255), root_mb INTEGER, swap_mb INTEGER, uuid VARCHAR(36), instance_name VARCHAR(255), \n\tPRIMARY KEY (id), \n\tCHECK (deleted IN (0, 1))\n);\nCREATE INDEX deploy_key_idx ON bm_nodes (deploy_key);\nCREATE INDEX idx_bm_nodes_hmcld ON bm_nodes (service_host, memory_mb, cpus, local_gb, deleted);\nCREATE INDEX idx_bm_nodes_instance_uuid_deleted ON bm_nodes (instance_uuid, deleted);\nCREATE INDEX idx_bm_nodes_service_host_deleted ON bm_nodes (service_host, deleted);\nCREATE UNIQUE INDEX uuid_ux ON bm_nodes (uuid);\nsqlite>\n\nDowngrade to version 3\n$ nova-baremetal-manage db sync --version 3\n\ninstance_name should be dropped, but it still exists\n$ sqlite3 /tmp/b.db \nSQLite version 3.7.9 2011-11-01 00:52:41\nEnter \".help\" for instructions\nEnter SQL statements terminated with a \";\"\nsqlite> .schema bm_nodes\nCREATE TABLE bm_nodes (\n\tcreated_at DATETIME, \n\tupdated_at DATETIME, \n\tdeleted_at DATETIME, \n\tdeleted BOOLEAN, \n\tid INTEGER NOT NULL, \n\tcpus INTEGER, \n\tmemory_mb INTEGER, \n\tlocal_gb INTEGER, \n\tpm_address VARCHAR(255), \n\tpm_user VARCHAR(255), \n\tpm_password VARCHAR(255), \n\tservice_host VARCHAR(255), \n\tprov_mac_address VARCHAR(255), \n\tinstance_uuid VARCHAR(36), \n\tregistration_status VARCHAR(16), \n\ttask_state VARCHAR(255), \n\tprov_vlan_id INTEGER, \n\tterminal_port INTEGER, \n\timage_path VARCHAR(255), \n\tpxe_config_path VARCHAR(255), \n\tdeploy_key VARCHAR(255), \n\troot_mb INTEGER, \n\tswap_mb INTEGER, \n\tuuid VARCHAR(36), \n\tinstance_name VARCHAR(255), \n\tPRIMARY KEY (id), \n\tCHECK (deleted IN (0, 1))\n);\nCREATE INDEX deploy_key_idx ON bm_nodes (deploy_key);\nCREATE INDEX idx_bm_nodes_hmcld ON bm_nodes (service_host, memory_mb, cpus, local_gb, deleted);\nCREATE INDEX idx_bm_nodes_instance_uuid_deleted ON bm_nodes (instance_uuid, deleted);\nCREATE INDEX idx_bm_nodes_service_host_deleted ON bm_nodes (service_host, deleted);\nCREATE UNIQUE INDEX uuid_ux ON bm_nodes (uuid);\nsqlite>", 
    "tags": [
        "baremetal"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1133235", 
    "owner": "https://api.launchpad.net/1.0/~rconradharris", 
    "id": 1133235, 
    "index": 787, 
    "openned": "2013-02-26 11:14:53.077484+00:00", 
    "created": "2013-02-26 11:14:53.077484+00:00", 
    "title": "downgrading baremetal db (sqlite) from 004 to 003 does not drop a column added by upgrade", 
    "comments": [
        {
            "content": "How to reproduce:\n\nIn nova.conf, specify sqlite for baremetal db\n[baremetal]\nsql_connection = sqlite:////tmp/b.db\n\nEnsure the db file is newly created\n$ rm /tmp/b.db \n\nUpgrade to version 4\n$ nova-baremetal-manage db sync --version 4\n\ninstance_name was added to bm_nodes by upgradeing\n$ sqlite3 /tmp/b.db \nSQLite version 3.7.9 2011-11-01 00:52:41\nEnter \".help\" for instructions\nEnter SQL statements terminated with a \";\"\nsqlite> .schema bm_nodes\nCREATE TABLE bm_nodes (\n\tcreated_at DATETIME, \n\tupdated_at DATETIME, \n\tdeleted_at DATETIME, \n\tdeleted BOOLEAN, \n\tid INTEGER NOT NULL, \n\tcpus INTEGER, \n\tmemory_mb INTEGER, \n\tlocal_gb INTEGER, \n\tpm_address VARCHAR(255), \n\tpm_user VARCHAR(255), \n\tpm_password VARCHAR(255), \n\tservice_host VARCHAR(255), \n\tprov_mac_address VARCHAR(255), \n\tinstance_uuid VARCHAR(36), \n\tregistration_status VARCHAR(16), \n\ttask_state VARCHAR(255), \n\tprov_vlan_id INTEGER, \n\tterminal_port INTEGER, image_path VARCHAR(255), pxe_config_path VARCHAR(255), deploy_key VARCHAR(255), root_mb INTEGER, swap_mb INTEGER, uuid VARCHAR(36), instance_name VARCHAR(255), \n\tPRIMARY KEY (id), \n\tCHECK (deleted IN (0, 1))\n);\nCREATE INDEX deploy_key_idx ON bm_nodes (deploy_key);\nCREATE INDEX idx_bm_nodes_hmcld ON bm_nodes (service_host, memory_mb, cpus, local_gb, deleted);\nCREATE INDEX idx_bm_nodes_instance_uuid_deleted ON bm_nodes (instance_uuid, deleted);\nCREATE INDEX idx_bm_nodes_service_host_deleted ON bm_nodes (service_host, deleted);\nCREATE UNIQUE INDEX uuid_ux ON bm_nodes (uuid);\nsqlite>\n\nDowngrade to version 3\n$ nova-baremetal-manage db sync --version 3\n\ninstance_name should be dropped, but it still exists\n$ sqlite3 /tmp/b.db \nSQLite version 3.7.9 2011-11-01 00:52:41\nEnter \".help\" for instructions\nEnter SQL statements terminated with a \";\"\nsqlite> .schema bm_nodes\nCREATE TABLE bm_nodes (\n\tcreated_at DATETIME, \n\tupdated_at DATETIME, \n\tdeleted_at DATETIME, \n\tdeleted BOOLEAN, \n\tid INTEGER NOT NULL, \n\tcpus INTEGER, \n\tmemory_mb INTEGER, \n\tlocal_gb INTEGER, \n\tpm_address VARCHAR(255), \n\tpm_user VARCHAR(255), \n\tpm_password VARCHAR(255), \n\tservice_host VARCHAR(255), \n\tprov_mac_address VARCHAR(255), \n\tinstance_uuid VARCHAR(36), \n\tregistration_status VARCHAR(16), \n\ttask_state VARCHAR(255), \n\tprov_vlan_id INTEGER, \n\tterminal_port INTEGER, \n\timage_path VARCHAR(255), \n\tpxe_config_path VARCHAR(255), \n\tdeploy_key VARCHAR(255), \n\troot_mb INTEGER, \n\tswap_mb INTEGER, \n\tuuid VARCHAR(36), \n\tinstance_name VARCHAR(255), \n\tPRIMARY KEY (id), \n\tCHECK (deleted IN (0, 1))\n);\nCREATE INDEX deploy_key_idx ON bm_nodes (deploy_key);\nCREATE INDEX idx_bm_nodes_hmcld ON bm_nodes (service_host, memory_mb, cpus, local_gb, deleted);\nCREATE INDEX idx_bm_nodes_instance_uuid_deleted ON bm_nodes (instance_uuid, deleted);\nCREATE INDEX idx_bm_nodes_service_host_deleted ON bm_nodes (service_host, deleted);\nCREATE UNIQUE INDEX uuid_ux ON bm_nodes (uuid);\nsqlite>", 
            "date_created": "2013-02-26 11:14:53.077484+00:00", 
            "author": "https://api.launchpad.net/1.0/~arata776"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/22972", 
            "date_created": "2013-02-26 11:49:51.058141+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fixed by https://review.openstack.org/#/c/23133/ but not tagged in the commit message there.", 
            "date_created": "2013-02-28 21:17:27.922410+00:00", 
            "author": "https://api.launchpad.net/1.0/~devananda"
        }
    ], 
    "closed": "2013-03-20 16:15:30.490010+00:00"
}