{
    "status": "Fix Released", 
    "last_updated": "2016-11-17 13:12:17.329610+00:00", 
    "description": "I deployed a two compute nodes devstack environment with XenServer 7.0 (XCP platform version 2.1.0)\nI booted a VM and tried to live migrate it to another compute node, but it failed at both source compute node and dest compute node with:\n\n2016-08-08 02:29:46.042 DEBUG oslo_messaging.drivers.amqpdriver [-] received reply msg_id: 8022537717374357b576f5a11ec98719 from (pid=30939) __call_ /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:296\n2016-08-08 02:29:46.045 ERROR oslo_messaging.rpc.server [req-fc49665b-5361-4042-bcca-2992335f75a8 admin demo] Exception during message handling\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server res = self.dispatcher.dispatch(message)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server return self._do_dispatch(endpoint, method, ctxt, args)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server result = func(ctxt, **new_args)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/exception_wrapper.py\", line 75, in wrapped\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server function_name, call_dict, binary)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in _exit_\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server self.force_reraise()\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server six.reraise(self.type_, self.value, self.tb)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/exception_wrapper.py\", line 66, in wrapped\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server return f(self, context, *args, **kw)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/compute/utils.py\", line 613, in decorated_function\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server return function(self, context, *args, **kwargs)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/compute/manager.py\", line 216, in decorated_function\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server kwargs['instance'], e, sys.exc_info())\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in _exit_\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server self.force_reraise()\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server six.reraise(self.type_, self.value, self.tb)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/compute/manager.py\", line 204, in decorated_function\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server return function(self, context, *args, **kwargs)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/compute/manager.py\", line 5118, in check_can_live_migrate_source\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server block_device_info)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 484, in check_can_live_migrate_source\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server dest_check_data)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 2246, in check_can_live_migrate_source\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server raise exception.MigrationError(reason=_('XAPI supporting '\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server MigrationError: Migration error: XAPI supporting relax-xsm-sr-check=true required\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server \n2016-08-08 02:29:46.058 DEBUG oslo_messaging._drivers.amqpdriver [req-fc49665b-5361-4042-bcca-2992335f75a8 admin demo] sending reply msg_id: 65f490411aa040658334509746dc94d4 reply queue: reply_2672337a8bd94bc189201dd0bc97098d time elapsed: 0.21841500001s from (pid=30939) _send_reply /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:73\n\n=================================\n\nAnalyze:\nWith XenServer 7.0 (XCP 2.1.0), \"relax-xsm-sr-check=true\" is the default setting even it is not set in /etc/xapi.conf, so with XenServer 7.0 and later, if \"relax-xsm-sr-check=true\" is not set, nova compute driver need use the default value, related code: https://github.com/openstack/nova/blob/master/nova/virt/xenapi/vmops.py#L2218", 
    "tags": [
        "xenserver"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1610932", 
    "owner": "https://api.launchpad.net/1.0/~huan-xie", 
    "id": 1610932, 
    "index": 7634, 
    "openned": "2016-08-08 10:39:51.645827+00:00", 
    "created": "2016-08-08 10:39:51.645827+00:00", 
    "title": "XenServer 7.0 failed live-migrate with iSCSI SR volume", 
    "comments": [
        {
            "content": "I deployed a two compute nodes devstack environment with XenServer 7.0 (XCP platform version 2.1.0)\nI booted a VM and tried to live migrate it to another compute node, but it failed at both source compute node and dest compute node with:\n\n2016-08-08 02:29:46.042 DEBUG oslo_messaging.drivers.amqpdriver [-] received reply msg_id: 8022537717374357b576f5a11ec98719 from (pid=30939) __call_ /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:296\n2016-08-08 02:29:46.045 ERROR oslo_messaging.rpc.server [req-fc49665b-5361-4042-bcca-2992335f75a8 admin demo] Exception during message handling\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server res = self.dispatcher.dispatch(message)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server return self._do_dispatch(endpoint, method, ctxt, args)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server result = func(ctxt, **new_args)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/exception_wrapper.py\", line 75, in wrapped\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server function_name, call_dict, binary)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in _exit_\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server self.force_reraise()\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server six.reraise(self.type_, self.value, self.tb)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/exception_wrapper.py\", line 66, in wrapped\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server return f(self, context, *args, **kw)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/compute/utils.py\", line 613, in decorated_function\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server return function(self, context, *args, **kwargs)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/compute/manager.py\", line 216, in decorated_function\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server kwargs['instance'], e, sys.exc_info())\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in _exit_\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server self.force_reraise()\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server six.reraise(self.type_, self.value, self.tb)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/compute/manager.py\", line 204, in decorated_function\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server return function(self, context, *args, **kwargs)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/compute/manager.py\", line 5118, in check_can_live_migrate_source\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server block_device_info)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 484, in check_can_live_migrate_source\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server dest_check_data)\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 2246, in check_can_live_migrate_source\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server raise exception.MigrationError(reason=_('XAPI supporting '\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server MigrationError: Migration error: XAPI supporting relax-xsm-sr-check=true required\n2016-08-08 02:29:46.045 TRACE oslo_messaging.rpc.server \n2016-08-08 02:29:46.058 DEBUG oslo_messaging._drivers.amqpdriver [req-fc49665b-5361-4042-bcca-2992335f75a8 admin demo] sending reply msg_id: 65f490411aa040658334509746dc94d4 reply queue: reply_2672337a8bd94bc189201dd0bc97098d time elapsed: 0.21841500001s from (pid=30939) _send_reply /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:73\n\n=================================\n\nAnalyze:\nWith XenServer 7.0 (XCP 2.1.0), \"relax-xsm-sr-check=true\" is the default setting even it is not set in /etc/xapi.conf, so with XenServer 7.0 and later, if \"relax-xsm-sr-check=true\" is not set, nova compute driver need use the default value, related code: https://github.com/openstack/nova/blob/master/nova/virt/xenapi/vmops.py#L2218", 
            "date_created": "2016-08-08 10:39:51.645827+00:00", 
            "author": "https://api.launchpad.net/1.0/~huan-xie"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/359548", 
            "date_created": "2016-08-24 02:26:16.686361+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I have made a patch for this bug https://review.openstack.org/#/c/359548/", 
            "date_created": "2016-08-24 02:27:54.309104+00:00", 
            "author": "https://api.launchpad.net/1.0/~huan-xie"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/359548\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=22b8ae0975187a847fc201a750f05be0af9818a4\nSubmitter: Jenkins\nBranch:    master\n\ncommit 22b8ae0975187a847fc201a750f05be0af9818a4\nAuthor: Huan Xie <email address hidden>\nDate:   Wed Aug 24 02:25:10 2016 +0000\n\n    XenAPI: Fix VM live-migrate with iSCSI SR volume\n    \n    With XenServer 7.0 (XCP 2.1.0), VM live migration with iSCSI volume\n    will fail due to no relax_xsm_sr_check in /etc/xapi.conf in Dom0.\n    But since XS7.0, the default value of relax_xsm_sr_check is true if\n    not configured in /etc/xapi.conf in Dom0.\n    This fix is to add checks on XCP version, if it's equal or greater\n    than 2.1.0, will treat relax_xsm_sr_check=true if not found in\n    /etc/xapi.conf\n    \n    Change-Id: I88d1d384ab7587c428e517d184258bb517dfb4ab\n    Closes-bug: #1610932\n", 
            "date_created": "2016-10-20 12:20:55.746613+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b1 development milestone.", 
            "date_created": "2016-11-17 13:12:15.360498+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-10-20 12:20:51.944849+00:00"
}