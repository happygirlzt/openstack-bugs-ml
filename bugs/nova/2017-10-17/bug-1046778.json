{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:46:03.269947+00:00", 
    "description": "1. Set the network manager as VlanManager\n2. Create a network using nova-manage\n    $ nova-manage network create --label private --fixed_range_v4 10.0.0.0/24 --num_networks 1 --network_size 256 --vlan 100\n\nCommand fails with the following stack trace:\n\n2012-09-06 03:52:40 CRITICAL nova [req-e65dfede-18b3-4623-9e1c-c6a96111e2fe None None] The sum between the number of networks and the vlan start cannot be greater than 4094\n2012-09-06 03:52:40 TRACE nova Traceback (most recent call last):\n2012-09-06 03:52:40 TRACE nova   File \"/usr/local/bin/nova-manage\", line 7, in <module>\n2012-09-06 03:52:40 TRACE nova     execfile(__file__)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1387, in <module>\n2012-09-06 03:52:40 TRACE nova     main()\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1374, in main\n2012-09-06 03:52:40 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 479, in create\n2012-09-06 03:52:40 TRACE nova     net_manager.create_networks(context.get_admin_context(), **kwargs)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/nova/network/manager.py\", line 2019, in create_networks\n2012-09-06 03:52:40 TRACE nova     raise ValueError(_('The sum between the number of networks and'\n2012-09-06 03:52:40 TRACE nova ValueError: The sum between the number of networks and the vlan start cannot be greater than 4094\n2012-09-06 03:52:40 TRACE nova \nThe sum between the number of networks and the vlan start cannot be greater than 4094\n2012-09-06 03:52:40 TRACE nova Traceback (most recent call last):\n2012-09-06 03:52:40 TRACE nova   File \"/usr/local/bin/nova-manage\", line 7, in <module>\n2012-09-06 03:52:40 TRACE nova     execfile(__file__)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1387, in <module>\n2012-09-06 03:52:40 TRACE nova     main()\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1374, in main\n2012-09-06 03:52:40 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 479, in create\n2012-09-06 03:52:40 TRACE nova     net_manager.create_networks(context.get_admin_context(), **kwargs)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/nova/network/manager.py\", line 2019, in create_networks\n2012-09-06 03:52:40 TRACE nova     raise ValueError(_('The sum between the number of networks and'\n2012-09-06 03:52:40 TRACE nova ValueError: The sum between the number of networks and the vlan start cannot be greater than 4094\n2012-09-06 03:52:40 TRACE nova \n\nProblem is that nova-manage does not convert the unicodes for network_size, num_networks and  vlan_start to \"integer\", hence the conditions in VlanManage.create_network() fail.\nThis should be handled properly by nova-manage.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1046778", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 1046778, 
    "index": 3039, 
    "openned": "2012-09-06 10:57:13.221840+00:00", 
    "created": "2012-09-06 10:57:13.221840+00:00", 
    "title": "Creating a network with VlanManager fails", 
    "comments": [
        {
            "content": "1. Set the network manager as VlanManager\n2. Create a network using nova-manage\n    $ nova-manage network create --label private --fixed_range_v4 10.0.0.0/24 --num_networks 1 --network_size 256 --vlan 100\n\nCommand fails with the following stack trace:\n\n2012-09-06 03:52:40 CRITICAL nova [req-e65dfede-18b3-4623-9e1c-c6a96111e2fe None None] The sum between the number of networks and the vlan start cannot be greater than 4094\n2012-09-06 03:52:40 TRACE nova Traceback (most recent call last):\n2012-09-06 03:52:40 TRACE nova   File \"/usr/local/bin/nova-manage\", line 7, in <module>\n2012-09-06 03:52:40 TRACE nova     execfile(__file__)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1387, in <module>\n2012-09-06 03:52:40 TRACE nova     main()\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1374, in main\n2012-09-06 03:52:40 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 479, in create\n2012-09-06 03:52:40 TRACE nova     net_manager.create_networks(context.get_admin_context(), **kwargs)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/nova/network/manager.py\", line 2019, in create_networks\n2012-09-06 03:52:40 TRACE nova     raise ValueError(_('The sum between the number of networks and'\n2012-09-06 03:52:40 TRACE nova ValueError: The sum between the number of networks and the vlan start cannot be greater than 4094\n2012-09-06 03:52:40 TRACE nova \nThe sum between the number of networks and the vlan start cannot be greater than 4094\n2012-09-06 03:52:40 TRACE nova Traceback (most recent call last):\n2012-09-06 03:52:40 TRACE nova   File \"/usr/local/bin/nova-manage\", line 7, in <module>\n2012-09-06 03:52:40 TRACE nova     execfile(__file__)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1387, in <module>\n2012-09-06 03:52:40 TRACE nova     main()\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1374, in main\n2012-09-06 03:52:40 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 479, in create\n2012-09-06 03:52:40 TRACE nova     net_manager.create_networks(context.get_admin_context(), **kwargs)\n2012-09-06 03:52:40 TRACE nova   File \"/opt/stack/nova/nova/network/manager.py\", line 2019, in create_networks\n2012-09-06 03:52:40 TRACE nova     raise ValueError(_('The sum between the number of networks and'\n2012-09-06 03:52:40 TRACE nova ValueError: The sum between the number of networks and the vlan start cannot be greater than 4094\n2012-09-06 03:52:40 TRACE nova \n\nProblem is that nova-manage does not convert the unicodes for network_size, num_networks and  vlan_start to \"integer\", hence the conditions in VlanManage.create_network() fail.\nThis should be handled properly by nova-manage.", 
            "date_created": "2012-09-06 10:57:13.221840+00:00", 
            "author": "https://api.launchpad.net/1.0/~rohitk"
        }, 
        {
            "content": "Below patch can fix the above issue.\n\ndiff --git a/bin/nova-manage b/bin/nova-manage\nindex c1426e2..f856d8b 100755\n--- a/bin/nova-manage\n+++ b/bin/nova-manage\n@@ -475,6 +475,14 @@ class NetworkCommands(object):\n                        if v and k != \"self\"))\n         if multi_host is not None:\n             kwargs['multi_host'] = multi_host == 'T'\n+       if num_networks is not None:\n+           kwargs['num_networks'] = int(num_networks)\n+       if network_size is not None:\n+           kwargs['network_size'] = int(network_size)\n+       if vlan_start is not None:\n+           kwargs['vlan_start'] = int(vlan_start)\n+       if vpn_start is not None:\n+           kwargs['vpn_start'] = int(vpn_start)\n         net_manager = importutils.import_object(FLAGS.network_manager)\n         net_manager.create_networks(context.get_admin_context(), **kwargs)\n", 
            "date_created": "2012-09-07 15:05:48.408464+00:00", 
            "author": "https://api.launchpad.net/1.0/~rohitk"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/12733", 
            "date_created": "2012-09-10 19:48:04.212751+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/12733\nCommitted: http://github.com/openstack/nova/commit/3531288bc3959932eac586f582fa168b983083c2\nSubmitter: Jenkins\nBranch:    master\n\ncommit 3531288bc3959932eac586f582fa168b983083c2\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Mon Sep 10 12:46:25 2012 -0700\n\n    Convert to ints in VlanManager.create_networks\n    \n    Fixes bug 1046778\n    \n    Change-Id: I17647b0e495964c305e54221bf3fcfd6bdbc1547\n", 
            "date_created": "2012-09-11 08:39:26.811119+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-09-19 06:39:20.671368+00:00"
}