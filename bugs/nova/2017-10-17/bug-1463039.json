{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:49:50.672849+00:00", 
    "description": "XenServer CI is hitting the following issue (e.g. http://dd6b71949550285df7dc-dda4e480e005aaa13ec303551d2d8155.r49.cf1.rackcdn.com/64/188764/2/137/index.html)\n\nTraceback (most recent call last):\n  File \"/opt/stack/new/nova/nova/compute/manager.py\", line 6037, in _error_out_instance_on_exception\n    yield\n  File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2658, in rebuild_instance\n    extra_usage_info=extra_usage_info)\n  File \"/opt/stack/new/nova/nova/compute/utils.py\", line 270, in notify_usage_exists\n    ignore_missing_network_data)\n  File \"/opt/stack/new/nova/nova/notifications.py\", line 316, in bandwidth_usage\n    audit_start)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 833, in wrapper\n    return fn.__get__(None, obj)(*args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 158, in wrapper\n    args, kwargs)\n  File \"/opt/stack/new/nova/nova/conductor/rpcapi.py\", line 261, in object_class_action\n    objver=objver, args=args, kwargs=kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n    retry=self.retry)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n    timeout=timeout, retry=retry)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 361, in send\n    retry=retry)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 352, in _send\n    raise result\nAttributeError: 'BandwidthUsage' object has no attribute 'instance_uuid'\nTraceback (most recent call last):\n  File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 436, in _object_dispatch\n    return getattr(target, method)(*args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 833, in wrapper\n    return fn.__get__(None, obj)(*args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 160, in wrapper\n    result = fn(cls, context, *args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/bandwidth_usage.py\", line 88, in get_by_uuids\n    return base.obj_make_list(context, cls(), BandwidthUsage, db_bw_usages)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 811, in obj_make_list\n    **extra_args)\n  File \"/opt/stack/new/nova/nova/objects/bandwidth_usage.py\", line 40, in _from_db_object\n    bw_usage[field] = db_bw_usage[field]\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/models.py\", line 54, in __getitem__\n    return getattr(self, key)\nAttributeError: 'BandwidthUsage' object has no attribute 'instance_uuid'\n\n\nAlso seen in the periodic task:\n2015-06-05 15:26:32.219 ERROR nova.openstack.common.periodic_task [req-a13743a2-7ca0-4865-a237-6aba08e704fb None None] Error during ComputeManager._poll_bandwidth_usage: 'NoneType' object has no attribute '__getitem__'\nTraceback (most recent call last):\n\u00a0\u00a0File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 436, in _object_dispatch\n\u00a0\u00a0\u00a0\u00a0return getattr(target, method)(*args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/new/nova/nova/objects/base.py\", line 831, in wrapper\n\u00a0\u00a0\u00a0\u00a0return fn(obj, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/new/nova/nova/objects/base.py\", line 205, in wrapper\n\u00a0\u00a0\u00a0\u00a0return fn(self, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/new/nova/nova/objects/bandwidth_usage.py\", line 65, in create\n\u00a0\u00a0\u00a0\u00a0self._from_db_object(self._context, self, db_bw_usage)\n\u00a0\u00a0File \"/opt/stack/new/nova/nova/objects/bandwidth_usage.py\", line 40, in _from_db_object\n\u00a0\u00a0\u00a0\u00a0bw_usage[field] = db_bw_usage[field]\nTypeError: 'NoneType' object has no attribute '__getitem__'", 
    "tags": [
        "kilo-backport-potential", 
        "xenserver"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1463039", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1463039, 
    "index": 1757, 
    "openned": "2015-06-08 14:01:53.446669+00:00", 
    "created": "2015-06-08 14:01:53.446669+00:00", 
    "title": "BandwidthUsage object has no attribute 'instance_uuid'", 
    "comments": [
        {
            "content": "XenServer CI is hitting the following issue (e.g. http://dd6b71949550285df7dc-dda4e480e005aaa13ec303551d2d8155.r49.cf1.rackcdn.com/64/188764/2/137/index.html)\n\n2015-06-05 15:27:01.284 ERROR oslo_messaging.rpc.dispatcher [req-5abea3a3-d27b-4221-bec0-3f6ab9a8627e ServerActionsTestJSON-151373989 ServerActionsTestJSON-2013533026] Exception during message handling: 'BandwidthUsage' object has no attribute 'instance_uuid'\nTraceback (most recent call last):\n  File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 436, in _object_dispatch\n    return getattr(target, method)(*args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 833, in wrapper\n    return fn.__get__(None, obj)(*args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 160, in wrapper\n    result = fn(cls, context, *args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/bandwidth_usage.py\", line 88, in get_by_uuids\n    return base.obj_make_list(context, cls(), BandwidthUsage, db_bw_usages)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 811, in obj_make_list\n    **extra_args)\n  File \"/opt/stack/new/nova/nova/objects/bandwidth_usage.py\", line 40, in _from_db_object\n    bw_usage[field] = db_bw_usage[field]\n  File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/models.py\", line 54, in __getitem__\n    return getattr(self, key)\nAttributeError: 'BandwidthUsage' object has no attribute 'instance_uuid'\n\nAlso seen in the periodic task:\n2015-06-05 15:26:32.219 ERROR nova.openstack.common.periodic_task [req-a13743a2-7ca0-4865-a237-6aba08e704fb None None] Error during ComputeManager._poll_bandwidth_usage: 'NoneType' object has no attribute '__getitem__'\nTraceback (most recent call last):\n  File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 436, in _object_dispatch\n    return getattr(target, method)(*args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 831, in wrapper\n    return fn(obj, *args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/base.py\", line 205, in wrapper\n    return fn(self, *args, **kwargs)\n  File \"/opt/stack/new/nova/nova/objects/bandwidth_usage.py\", line 65, in create\n    self._from_db_object(self._context, self, db_bw_usage)\n  File \"/opt/stack/new/nova/nova/objects/bandwidth_usage.py\", line 40, in _from_db_object\n    bw_usage[field] = db_bw_usage[field]\nTypeError: 'NoneType' object has no attribute '__getitem__'", 
            "date_created": "2015-06-08 14:01:53.446669+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }, 
        {
            "content": "Possible (not confirmed) duplicate of https://bugs.launchpad.net/nova/+bug/1442749 - see https://review.openstack.org/#/c/172524/3/nova/objects/bandwidth_usage.py,cm", 
            "date_created": "2015-06-08 15:30:39.497086+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/189397", 
            "date_created": "2015-06-08 18:55:23.582569+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/189397\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=f99af38cade764445fe7a40b4763293a0f91b514\nSubmitter: Jenkins\nBranch:    master\n\ncommit f99af38cade764445fe7a40b4763293a0f91b514\nAuthor: Andrew Laski <email address hidden>\nDate:   Mon Jun 8 13:23:36 2015 -0400\n\n    Map uuid db field to instance_uuid in BandwidthUsage object\n    \n    The BandwidthUsage database model stores the instance relation as 'uuid'\n    but the BandwidthUsage Nova Object stores it as instance_uuid.  The\n    _from_db_object needs to handle this discrepancy.\n    \n    This wasn't caught before because unit tests were passing back a\n    simulated db return which didn't match reality.\n    \n    Change-Id: I9aeac709cbbf0f9ddfa6cf724d55af8fa3a962ee\n    Closes-Bug: 1463039\n", 
            "date_created": "2015-06-10 18:25:07.416565+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-06-24 12:16:08.599879+00:00"
}