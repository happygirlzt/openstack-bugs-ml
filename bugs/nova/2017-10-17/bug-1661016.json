{
    "status": "Fix Released", 
    "last_updated": "2017-04-19 09:54:28.206059+00:00", 
    "description": "Description\n===========\nThe second and any future attempts to swap volumes using volume-update fail due to a BDM lookup failure using the original volume id (see Logs & Configs for an example).\n\nA previous attempt to fix this was made in bug#1490236 and reverted by bug#1625660. \n\nSteps to reproduce\n==================\n- Boot an instance\n- Create multiple volumes\n- Attach a single volume\n- Swap the attached volume with one that is unattached via nova volume-update.\n- Swap the attached volume with one that is unattached via nova volume-update.\n\nExpected result\n===============\nThe second attempt succeeds and the new volume is now attached to the instance.\n\nActual result\n=============\nThe second attempt fails looking up a BDM with the ID of the original volume.\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running. See the following\n  list for all releases: http://docs.openstack.org/releases/\n   $ pwd\n   /opt/stack/nova\n   $ git rev-parse HEAD\n   dae6b760b9c40bbf3b72a0218dbf1dbc823f30e2\n\n2. Which hypervisor did you use?\n   (For example: Libvirt + KVM, Libvirt + XEN, Hyper-V, PowerKVM, ...)\n   What's the version of that?\n\n   Libvirt + KVM\n\n2. Which storage type did you use?\n   (For example: Ceph, LVM, GPFS, ...)\n   What's the version of that?\n\n   LVM/iSCSI\n\n3. Which networking type did you use?\n   (For example: nova-network, Neutron with OpenVSwitch, ...)\n\n   n/a\n\nLogs & Configs\n==============\n$ nova boot --image cirros-0.3.4-x86_64-uec --flavor 1 test-boot\n$ cinder create 1 ; cinder create 1\n\n$ nova volume-attach ef426f1e-32e4-4f8c-a3fc-b58080d38294 \\\n                     23933e67-a4c0-4de9-b0dc-3da37bce1b78\n\n$ nova volume-update ef426f1e-32e4-4f8c-a3fc-b58080d38294 \\\n                     23933e67-a4c0-4de9-b0dc-3da37bce1b78 \\\n                     cace165f-9c97-4d6d-a0e8-ea087fa80263\n\n$ nova volume-update ef426f1e-32e4-4f8c-a3fc-b58080d38294 \\\n                     cace165f-9c97-4d6d-a0e8-ea087fa80263 \\ \n                     23933e67-a4c0-4de9-b0dc-3da37bce1b78\n\nn-cpu.log :\n\n4448 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n4449 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 155, in _process_incoming\n4450 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n4451 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\n4452 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n4453 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\n4454 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n4455 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 75, in wrapped\n4456 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     function_name, call_dict, binary)\n4457 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n4458 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.force_reraise()\n4459 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n4460 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n4461 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 66, in wrapped\n4462 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n4463 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 188, in decorated_function\n4464 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     LOG.warning(msg, e, instance=instance)\n4465 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n4466 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.force_reraise()\n4467 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n4468 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n4469 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 157, in decorated_function\n4470 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n4471 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 216, in decorated_function\n4472 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n4473 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n4474 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.force_reraise()\n4475 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n4476 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n4477 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 204, in decorated_function\n4478 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n4479 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 5052, in swap_volume\n4480 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     resize_to)          \n4481 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4998, in _swap_volume\n4482 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.volume_api.unreserve_volume(context, new_volume_id)\n4483 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n4484 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.force_reraise()\n4485 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n4486 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n4487 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4976, in _swap_volume\n4488 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     resize_to)          \n4489 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1296, in swap_volume\n4490 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     nova_context.get_admin_context(), volume_id, instance.uuid)\n4491 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 177, in wrapper\n4492 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     args, kwargs)       \n4493 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 239, in object_class_action_versions\n4494 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     args=args, kwargs=kwargs)\n4495 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py\", line 169, in call\n4496 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     retry=self.retry)   \n4497 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py\", line 97, in _send\n4498 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     timeout=timeout, retry=retry)\n4499 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 458, in send\n4500 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     retry=retry)        \n4501 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 449, in _send\n4502 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     raise result        \n4503 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server VolumeBDMNotFound_Remote: No volume Block Device Mapping with id 23933e67-a4c0-4de9-b0dc-3da37bce1b78.\n4504 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n4505 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4506 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/conductor/manager.py\", line 92, in _object_dispatch\n4507 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return getattr(target, method)(*args, **kwargs)\n4508 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4509 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 184, in wrapper\n4510 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     result = fn(cls, context, *args, **kwargs)\n4511 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4512 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/objects/block_device.py\", line 242, in get_by_volume_and_instance\n4513 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     raise exception.VolumeBDMNotFound(volume_id=volume_id)\n4514 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4515 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server VolumeBDMNotFound: No volume Block Device Mapping with id 23933e67-a4c0-4de9-b0dc-3da37bce1b78.\n4516 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4517 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server", 
    "tags": [
        "libvirt", 
        "swap-volume", 
        "volumes"
    ], 
    "importance": "Medium", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1661016", 
    "owner": "https://api.launchpad.net/1.0/~lyarwood", 
    "id": 1661016, 
    "index": 4748, 
    "openned": "2017-02-01 15:20:36.522698+00:00", 
    "created": "2017-02-01 15:20:36.522698+00:00", 
    "title": "Multiple attempts to swap volumes using volume-update fail", 
    "comments": [
        {
            "content": "Description\n===========\nThe second and any future attempts to swap volumes using volume-update fail due to a BDM lookup failure using the original volume id (see Logs & Configs for an example).\n\nA previous attempt to fix this was made in bug#1490236 and reverted by bug#1625660. \n\nSteps to reproduce\n==================\n- Boot an instance\n- Create multiple volumes\n- Attach a single volume\n- Swap the attached volume with one that is unattached via nova volume-update.\n- Swap the attached volume with one that is unattached via nova volume-update.\n\nExpected result\n===============\nThe second attempt succeeds and the new volume is now attached to the instance.\n\nActual result\n=============\nThe second attempt fails looking up a BDM with the ID of the original volume.\n\nEnvironment\n===========\n1. Exact version of OpenStack you are running. See the following\n  list for all releases: http://docs.openstack.org/releases/\n   $ pwd\n   /opt/stack/nova\n   $ git rev-parse HEAD\n   dae6b760b9c40bbf3b72a0218dbf1dbc823f30e2\n\n2. Which hypervisor did you use?\n   (For example: Libvirt + KVM, Libvirt + XEN, Hyper-V, PowerKVM, ...)\n   What's the version of that?\n\n   Libvirt + KVM\n\n2. Which storage type did you use?\n   (For example: Ceph, LVM, GPFS, ...)\n   What's the version of that?\n\n   LVM/iSCSI\n\n3. Which networking type did you use?\n   (For example: nova-network, Neutron with OpenVSwitch, ...)\n\n   n/a\n\nLogs & Configs\n==============\n$ nova boot --image cirros-0.3.4-x86_64-uec --flavor 1 test-boot\n$ cinder create 1 ; cinder create 1\n\n$ nova volume-attach ef426f1e-32e4-4f8c-a3fc-b58080d38294 \\\n                     23933e67-a4c0-4de9-b0dc-3da37bce1b78\n\n$ nova volume-update ef426f1e-32e4-4f8c-a3fc-b58080d38294 \\\n                     23933e67-a4c0-4de9-b0dc-3da37bce1b78 \\\n                     cace165f-9c97-4d6d-a0e8-ea087fa80263\n\n$ nova volume-update ef426f1e-32e4-4f8c-a3fc-b58080d38294 \\\n                     cace165f-9c97-4d6d-a0e8-ea087fa80263 \\ \n                     23933e67-a4c0-4de9-b0dc-3da37bce1b78\n\nn-cpu.log :\n\n4448 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n4449 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 155, in _process_incoming\n4450 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n4451 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\n4452 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n4453 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\n4454 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n4455 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 75, in wrapped\n4456 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     function_name, call_dict, binary)\n4457 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n4458 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.force_reraise()\n4459 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n4460 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n4461 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 66, in wrapped\n4462 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n4463 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 188, in decorated_function\n4464 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     LOG.warning(msg, e, instance=instance)\n4465 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n4466 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.force_reraise()\n4467 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n4468 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n4469 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 157, in decorated_function\n4470 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n4471 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 216, in decorated_function\n4472 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n4473 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n4474 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.force_reraise()\n4475 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n4476 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n4477 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 204, in decorated_function\n4478 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n4479 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 5052, in swap_volume\n4480 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     resize_to)          \n4481 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4998, in _swap_volume\n4482 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.volume_api.unreserve_volume(context, new_volume_id)\n4483 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n4484 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     self.force_reraise()\n4485 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n4486 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n4487 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4976, in _swap_volume\n4488 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     resize_to)          \n4489 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1296, in swap_volume\n4490 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     nova_context.get_admin_context(), volume_id, instance.uuid)\n4491 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 177, in wrapper\n4492 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     args, kwargs)       \n4493 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 239, in object_class_action_versions\n4494 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     args=args, kwargs=kwargs)\n4495 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py\", line 169, in call\n4496 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     retry=self.retry)   \n4497 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py\", line 97, in _send\n4498 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     timeout=timeout, retry=retry)\n4499 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 458, in send\n4500 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     retry=retry)        \n4501 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 449, in _send\n4502 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     raise result        \n4503 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server VolumeBDMNotFound_Remote: No volume Block Device Mapping with id 23933e67-a4c0-4de9-b0dc-3da37bce1b78.\n4504 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n4505 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4506 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/conductor/manager.py\", line 92, in _object_dispatch\n4507 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     return getattr(target, method)(*args, **kwargs)\n4508 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4509 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 184, in wrapper\n4510 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     result = fn(cls, context, *args, **kwargs)\n4511 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4512 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/objects/block_device.py\", line 242, in get_by_volume_and_instance\n4513 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server     raise exception.VolumeBDMNotFound(volume_id=volume_id)\n4514 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4515 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server VolumeBDMNotFound: No volume Block Device Mapping with id 23933e67-a4c0-4de9-b0dc-3da37bce1b78.\n4516 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server                         \n4517 2017-02-01 07:35:04.931 TRACE oslo_messaging.rpc.server", 
            "date_created": "2017-02-01 15:20:36.522698+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyarwood"
        }, 
        {
            "content": "https://review.openstack.org/#/c/427364/", 
            "date_created": "2017-02-08 06:35:44.980691+00:00", 
            "author": "https://api.launchpad.net/1.0/~amotoki"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/427364\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=1bf7ac804808eb0d4a68847e466f5fa7d1dcd55e\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1bf7ac804808eb0d4a68847e466f5fa7d1dcd55e\nAuthor: Lee Yarwood <email address hidden>\nDate:   Tue Jan 31 18:39:15 2017 +0000\n\n    libvirt: Remove redundant bdm serial mangling and saving during swap_volume\n    \n    During an initial swap_volume call the serial of the original volume was\n    previously stashed in the connection_info of the new volume by the\n    compute layer. This was used by I19d5182d11 to allow the virt driver to\n    lookup and update the existing BDM with the new volume's connection_info\n    after it had been used by connect_volume.\n    \n    Future calls to swap_volume in the compute layer would not\n    update the serial found in the old volume connection_info. This would\n    result in an invalid serial being copied into the new volume\n    connection_info and used to preform a lookup of a BDM that didn't exist.\n    \n    To correct this we now explicitly set the serial of the new volume to\n    that of the new volume id. While the correct serial id should already be\n    present in the connection_info provided by most backend Cinder volume\n    drivers the act of updating this dict is required by our own functional\n    tests to invoke a failure case :\n    \n    https://git.io/vDmRE\n    \n    The serial is updated once more to match the volume id returned\n    by os-migrate-volume-completion prior to the BDM being updated in the\n    compute layer.\n    \n    The BDM lookup and save from the virt layer is also removed as the\n    compute layer retains a reference to new_cinfo and will update the BDM\n    with this, including any modifications, at the end of swap_volume.\n    \n    Finally, the associated Tempest admin test is also extended by the\n    following change to now attempt a second volume swap to verify these\n    changes :\n    \n    I2a2c80a164b9f75d0e7e0503a24194bedfc0e66b\n    \n    Closes-bug: #1661016\n    Change-Id: If74dd9d8e7191047b6f1cd7e35b6fc667f004f91\n", 
            "date_created": "2017-02-09 12:28:33.745878+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/431530", 
            "date_created": "2017-02-09 13:37:36.822372+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/431540", 
            "date_created": "2017-02-09 13:44:31.559081+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/431530\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=4bf211c617814d46d590bb7b11806170f5c19484\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit 4bf211c617814d46d590bb7b11806170f5c19484\nAuthor: Lee Yarwood <email address hidden>\nDate:   Tue Jan 31 18:39:15 2017 +0000\n\n    libvirt: Remove redundant bdm serial mangling and saving during swap_volume\n    \n    During an initial swap_volume call the serial of the original volume was\n    previously stashed in the connection_info of the new volume by the\n    compute layer. This was used by I19d5182d11 to allow the virt driver to\n    lookup and update the existing BDM with the new volume's connection_info\n    after it had been used by connect_volume.\n    \n    Future calls to swap_volume in the compute layer would not\n    update the serial found in the old volume connection_info. This would\n    result in an invalid serial being copied into the new volume\n    connection_info and used to preform a lookup of a BDM that didn't exist.\n    \n    To correct this we now explicitly set the serial of the new volume to\n    that of the new volume id. While the correct serial id should already be\n    present in the connection_info provided by most backend Cinder volume\n    drivers the act of updating this dict is required by our own functional\n    tests to invoke a failure case :\n    \n    https://git.io/vDmRE\n    \n    The serial is updated once more to match the volume id returned\n    by os-migrate-volume-completion prior to the BDM being updated in the\n    compute layer.\n    \n    The BDM lookup and save from the virt layer is also removed as the\n    compute layer retains a reference to new_cinfo and will update the BDM\n    with this, including any modifications, at the end of swap_volume.\n    \n    Finally, the associated Tempest admin test is also extended by the\n    following change to now attempt a second volume swap to verify these\n    changes :\n    \n    I2a2c80a164b9f75d0e7e0503a24194bedfc0e66b\n    \n    Closes-bug: #1661016\n    Change-Id: If74dd9d8e7191047b6f1cd7e35b6fc667f004f91\n    (cherry picked from commit 1bf7ac804808eb0d4a68847e466f5fa7d1dcd55e)\n", 
            "date_created": "2017-03-06 10:55:09.010028+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/431540\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a714ffe89f1201c2b238284be3a4817b497b161b\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit a714ffe89f1201c2b238284be3a4817b497b161b\nAuthor: Lee Yarwood <email address hidden>\nDate:   Tue Jan 31 18:39:15 2017 +0000\n\n    libvirt: Remove redundant bdm serial mangling and saving during swap_volume\n    \n    During an initial swap_volume call the serial of the original volume was\n    previously stashed in the connection_info of the new volume by the\n    compute layer. This was used by I19d5182d11 to allow the virt driver to\n    lookup and update the existing BDM with the new volume's connection_info\n    after it had been used by connect_volume.\n    \n    Future calls to swap_volume in the compute layer would not\n    update the serial found in the old volume connection_info. This would\n    result in an invalid serial being copied into the new volume\n    connection_info and used to preform a lookup of a BDM that didn't exist.\n    \n    To correct this we now explicitly set the serial of the new volume to\n    that of the new volume id. While the correct serial id should already be\n    present in the connection_info provided by most backend Cinder volume\n    drivers the act of updating this dict is required by our own functional\n    tests to invoke a failure case :\n    \n    https://git.io/vDmRE\n    \n    The serial is updated once more to match the volume id returned\n    by os-migrate-volume-completion prior to the BDM being updated in the\n    compute layer.\n    \n    The BDM lookup and save from the virt layer is also removed as the\n    compute layer retains a reference to new_cinfo and will update the BDM\n    with this, including any modifications, at the end of swap_volume.\n    \n    Finally, the associated Tempest admin test is also extended by the\n    following change to now attempt a second volume swap to verify these\n    changes :\n    \n    I2a2c80a164b9f75d0e7e0503a24194bedfc0e66b\n    \n    Conflicts:\n            nova/compute/manager.py\n    \n    NOTE(lyarwood): Simple conflict caused by I90d4ffcb adding an error\n    notification for swap_volume.\n    \n    Closes-bug: #1661016\n    Change-Id: If74dd9d8e7191047b6f1cd7e35b6fc667f004f91\n    (cherry picked from commit 1bf7ac804808eb0d4a68847e466f5fa7d1dcd55e)\n    (cherry picked from commit 4bf211c617814d46d590bb7b11806170f5c19484)\n", 
            "date_created": "2017-03-15 04:34:12.113173+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.1 release.", 
            "date_created": "2017-03-15 11:16:07.370925+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.5 release.", 
            "date_created": "2017-03-22 10:13:19.803214+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b1 development milestone.", 
            "date_created": "2017-04-14 09:24:16.456598+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/tempest 16.0.0 release.", 
            "date_created": "2017-04-19 09:54:27.354925+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-02-09 12:28:31.277922+00:00"
}