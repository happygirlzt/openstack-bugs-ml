{
    "status": "In Progress", 
    "last_updated": "2017-07-27 21:04:09.010435+00:00", 
    "description": "db sync command should give user friendly message for invalid 'version' specified \n\nThe command:\n\n$ nova-manage db sync 11111111111111111111111111111111111111111111111111\n\nLOG: \n\n2016-02-16 01:54:53.908 CRITICAL nova [-] OverflowError: range() result has too many items\n\n2016-02-16 01:54:53.908 TRACE nova Traceback (most recent call last):\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/bin/nova-manage\", line 10, in <module>\n2016-02-16 01:54:53.908 TRACE nova     sys.exit(main())\n2016-02-16 01:54:53.908 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 1448, in main\n2016-02-16 01:54:53.908 TRACE nova     ret = fn(*fn_args, **fn_kwargs)\n2016-02-16 01:54:53.908 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 932, in sync\n2016-02-16 01:54:53.908 TRACE nova     return migration.db_sync(version)\n2016-02-16 01:54:53.908 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 26, in db_sync\n2016-02-16 01:54:53.908 TRACE nova     return IMPL.db_sync(version=version, database=database)\n2016-02-16 01:54:53.908 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 57, in db_sync\n2016-02-16 01:54:53.908 TRACE nova     version)\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2016-02-16 01:54:53.908 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2016-02-16 01:54:53.908 TRACE nova   File \"<decorator-gen-15>\", line 2, in _migrate\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-02-16 01:54:53.908 TRACE nova     return f(*a, **kw)\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 345, in _migrate\n2016-02-16 01:54:53.908 TRACE nova     changeset = schema.changeset(version)\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 82, in changeset\n2016-02-16 01:54:53.908 TRACE nova     changeset = self.repository.changeset(database, start_ver, version)\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/repository.py\", line 224, in changeset\n2016-02-16 01:54:53.908 TRACE nova     versions = range(int(start) + range_mod, int(end) + range_mod, step)\n2016-02-16 01:54:53.908 TRACE nova OverflowError: range() result has too many items\n2016-02-16 01:54:53.908 TRACE nova\n\n\nThe command:\n$ nova-manage db sync 2147483\n\nLOG:\nCRITICAL nova [-] KeyError: <VerNum(315)>\n\n2016-02-16 02:06:15.045 TRACE nova Traceback (most recent call last):\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/bin/nova-manage\", line 10, in <module>\n2016-02-16 02:06:15.045 TRACE nova     sys.exit(main())\n2016-02-16 02:06:15.045 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 1448, in main\n2016-02-16 02:06:15.045 TRACE nova     ret = fn(*fn_args, **fn_kwargs)\n2016-02-16 02:06:15.045 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 932, in sync\n2016-02-16 02:06:15.045 TRACE nova     return migration.db_sync(version)\n2016-02-16 02:06:15.045 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 26, in db_sync\n2016-02-16 02:06:15.045 TRACE nova     return IMPL.db_sync(version=version, database=database)\n2016-02-16 02:06:15.045 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 57, in db_sync\n2016-02-16 02:06:15.045 TRACE nova     version)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2016-02-16 02:06:15.045 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2016-02-16 02:06:15.045 TRACE nova   File \"<decorator-gen-15>\", line 2, in _migrate\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-02-16 02:06:15.045 TRACE nova     return f(*a, **kw)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 345, in _migrate\n2016-02-16 02:06:15.045 TRACE nova     changeset = schema.changeset(version)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 82, in changeset\n2016-02-16 02:06:15.045 TRACE nova     changeset = self.repository.changeset(database, start_ver, version)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/repository.py\", line 225, in changeset\n2016-02-16 02:06:15.045 TRACE nova     changes = [self.version(v).script(database, op) for v in versions]\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/repository.py\", line 189, in version\n2016-02-16 02:06:15.045 TRACE nova     return self.versions.version(*p, **k)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/version.py\", line 163, in version\n2016-02-16 02:06:15.045 TRACE nova     return self.versions[VerNum(vernum)]\n2016-02-16 02:06:15.045 TRACE nova KeyError: <VerNum(315)>\n2016-02-16 02:06:15.045 TRACE nova\n\n\nThe command:\n$ nova-manage db sync something\n\nLOG:\n2016-02-17 00:47:20.287 CRITICAL nova [-] NovaException: version should be an integer\n\n2016-02-17 00:47:20.287 TRACE nova Traceback (most recent call last):\n2016-02-17 00:47:20.287 TRACE nova   File \"/usr/local/bin/nova-manage\", line 10, in <module>\n2016-02-17 00:47:20.287 TRACE nova     sys.exit(main())\n2016-02-17 00:47:20.287 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 1448, in main\n2016-02-17 00:47:20.287 TRACE nova     ret = fn(*fn_args, **fn_kwargs)\n2016-02-17 00:47:20.287 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 932, in sync\n2016-02-17 00:47:20.287 TRACE nova     return migration.db_sync(version)\n2016-02-17 00:47:20.287 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 26, in db_sync\n2016-02-17 00:47:20.287 TRACE nova     return IMPL.db_sync(version=version, database=database)\n2016-02-17 00:47:20.287 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 51, in db_sync\n2016-02-17 00:47:20.287 TRACE nova     raise exception.NovaException(_(\"version should be an integer\"))\n2016-02-17 00:47:20.287 TRACE nova NovaException: version should be an integer\n2016-02-17 00:47:20.287 TRACE nova\n\nSame issues are present in glance, cinder and keystone also.", 
    "tags": [
        "nova-manage"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1546441", 
    "owner": "https://api.launchpad.net/1.0/~dinesh-bhor", 
    "id": 1546441, 
    "index": 1948, 
    "openned": "2016-02-17 09:28:41.245632+00:00", 
    "created": "2016-02-17 09:28:41.245632+00:00", 
    "title": "db sync command should give user friendly message for invalid 'version' specified", 
    "comments": [
        {
            "content": "db sync command should give user friendly message for invalid 'version' specified \n\nThe command:\n\n$ nova-manage db sync 11111111111111111111111111111111111111111111111111\n\nLOG: \n\n2016-02-16 01:54:53.908 CRITICAL nova [-] OverflowError: range() result has too many items\n\n2016-02-16 01:54:53.908 TRACE nova Traceback (most recent call last):\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/bin/nova-manage\", line 10, in <module>\n2016-02-16 01:54:53.908 TRACE nova     sys.exit(main())\n2016-02-16 01:54:53.908 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 1448, in main\n2016-02-16 01:54:53.908 TRACE nova     ret = fn(*fn_args, **fn_kwargs)\n2016-02-16 01:54:53.908 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 932, in sync\n2016-02-16 01:54:53.908 TRACE nova     return migration.db_sync(version)\n2016-02-16 01:54:53.908 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 26, in db_sync\n2016-02-16 01:54:53.908 TRACE nova     return IMPL.db_sync(version=version, database=database)\n2016-02-16 01:54:53.908 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 57, in db_sync\n2016-02-16 01:54:53.908 TRACE nova     version)\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2016-02-16 01:54:53.908 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2016-02-16 01:54:53.908 TRACE nova   File \"<decorator-gen-15>\", line 2, in _migrate\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-02-16 01:54:53.908 TRACE nova     return f(*a, **kw)\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 345, in _migrate\n2016-02-16 01:54:53.908 TRACE nova     changeset = schema.changeset(version)\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 82, in changeset\n2016-02-16 01:54:53.908 TRACE nova     changeset = self.repository.changeset(database, start_ver, version)\n2016-02-16 01:54:53.908 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/repository.py\", line 224, in changeset\n2016-02-16 01:54:53.908 TRACE nova     versions = range(int(start) + range_mod, int(end) + range_mod, step)\n2016-02-16 01:54:53.908 TRACE nova OverflowError: range() result has too many items\n2016-02-16 01:54:53.908 TRACE nova\n\n\nThe command:\n$ nova-manage db sync 2147483\n\nLOG:\nCRITICAL nova [-] KeyError: <VerNum(315)>\n\n2016-02-16 02:06:15.045 TRACE nova Traceback (most recent call last):\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/bin/nova-manage\", line 10, in <module>\n2016-02-16 02:06:15.045 TRACE nova     sys.exit(main())\n2016-02-16 02:06:15.045 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 1448, in main\n2016-02-16 02:06:15.045 TRACE nova     ret = fn(*fn_args, **fn_kwargs)\n2016-02-16 02:06:15.045 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 932, in sync\n2016-02-16 02:06:15.045 TRACE nova     return migration.db_sync(version)\n2016-02-16 02:06:15.045 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 26, in db_sync\n2016-02-16 02:06:15.045 TRACE nova     return IMPL.db_sync(version=version, database=database)\n2016-02-16 02:06:15.045 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 57, in db_sync\n2016-02-16 02:06:15.045 TRACE nova     version)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2016-02-16 02:06:15.045 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2016-02-16 02:06:15.045 TRACE nova   File \"<decorator-gen-15>\", line 2, in _migrate\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-02-16 02:06:15.045 TRACE nova     return f(*a, **kw)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 345, in _migrate\n2016-02-16 02:06:15.045 TRACE nova     changeset = schema.changeset(version)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 82, in changeset\n2016-02-16 02:06:15.045 TRACE nova     changeset = self.repository.changeset(database, start_ver, version)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/repository.py\", line 225, in changeset\n2016-02-16 02:06:15.045 TRACE nova     changes = [self.version(v).script(database, op) for v in versions]\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/repository.py\", line 189, in version\n2016-02-16 02:06:15.045 TRACE nova     return self.versions.version(*p, **k)\n2016-02-16 02:06:15.045 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/version.py\", line 163, in version\n2016-02-16 02:06:15.045 TRACE nova     return self.versions[VerNum(vernum)]\n2016-02-16 02:06:15.045 TRACE nova KeyError: <VerNum(315)>\n2016-02-16 02:06:15.045 TRACE nova\n\n\nThe command:\n$ nova-manage db sync something\n\nLOG:\n2016-02-17 00:47:20.287 CRITICAL nova [-] NovaException: version should be an integer\n\n2016-02-17 00:47:20.287 TRACE nova Traceback (most recent call last):\n2016-02-17 00:47:20.287 TRACE nova   File \"/usr/local/bin/nova-manage\", line 10, in <module>\n2016-02-17 00:47:20.287 TRACE nova     sys.exit(main())\n2016-02-17 00:47:20.287 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 1448, in main\n2016-02-17 00:47:20.287 TRACE nova     ret = fn(*fn_args, **fn_kwargs)\n2016-02-17 00:47:20.287 TRACE nova   File \"/opt/stack/nova/nova/cmd/manage.py\", line 932, in sync\n2016-02-17 00:47:20.287 TRACE nova     return migration.db_sync(version)\n2016-02-17 00:47:20.287 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 26, in db_sync\n2016-02-17 00:47:20.287 TRACE nova     return IMPL.db_sync(version=version, database=database)\n2016-02-17 00:47:20.287 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 51, in db_sync\n2016-02-17 00:47:20.287 TRACE nova     raise exception.NovaException(_(\"version should be an integer\"))\n2016-02-17 00:47:20.287 TRACE nova NovaException: version should be an integer\n2016-02-17 00:47:20.287 TRACE nova\n\nSame issues are present in glance, cinder and keystone also.", 
            "date_created": "2016-02-17 09:28:41.245632+00:00", 
            "author": "https://api.launchpad.net/1.0/~dinesh-bhor"
        }, 
        {
            "content": "I could see this issue in cinder\n\nroot@sheelrana-VirtualBox:/home/sheelrana/cross_project/openstack-specs# cinder-manage db sync 4324234234\n2016-02-17 15:17:13.147 CRITICAL cinder [-] MemoryError\n\n2016-02-17 15:17:13.147 TRACE cinder Traceback (most recent call last):\n2016-02-17 15:17:13.147 TRACE cinder   File \"/usr/local/bin/cinder-manage\", line 10, in <module>\n2016-02-17 15:17:13.147 TRACE cinder     sys.exit(main())\n2016-02-17 15:17:13.147 TRACE cinder   File \"/opt/stack/cinder/cinder/cmd/manage.py\", line 575, in main\n2016-02-17 15:17:13.147 TRACE cinder     fn(*fn_args)\n2016-02-17 15:17:13.147 TRACE cinder   File \"/opt/stack/cinder/cinder/cmd/manage.py\", line 214, in sync\n2016-02-17 15:17:13.147 TRACE cinder     return db_migration.db_sync(version)\n2016-02-17 15:17:13.147 TRACE cinder   File \"/opt/stack/cinder/cinder/db/migration.py\", line 61, in db_sync\n2016-02-17 15:17:13.147 TRACE cinder     init_version=init_version)\n2016-02-17 15:17:13.147 TRACE cinder   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/migration.py\", line 79, in db_sync\n2016-02-17 15:17:13.147 TRACE cinder     migration = versioning_api.upgrade(engine, repository, version)\n2016-02-17 15:17:13.147 TRACE cinder   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2016-02-17 15:17:13.147 TRACE cinder     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2016-02-17 15:17:13.147 TRACE cinder   File \"<decorator-gen-15>\", line 2, in _migrate\n2016-02-17 15:17:13.147 TRACE cinder   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-02-17 15:17:13.147 TRACE cinder     return f(*a, **kw)\n2016-02-17 15:17:13.147 TRACE cinder   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 345, in _migrate\n2016-02-17 15:17:13.147 TRACE cinder     changeset = schema.changeset(version)\n2016-02-17 15:17:13.147 TRACE cinder   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 82, in changeset\n2016-02-17 15:17:13.147 TRACE cinder     changeset = self.repository.changeset(database, start_ver, version)\n2016-02-17 15:17:13.147 TRACE cinder   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/repository.py\", line 224, in changeset\n2016-02-17 15:17:13.147 TRACE cinder     versions = range(int(start) + range_mod, int(end) + range_mod, step)\n2016-02-17 15:17:13.147 TRACE cinder MemoryError\n2016-02-17 15:17:13.147 TRACE cinder \n", 
            "date_created": "2016-02-17 09:54:23.356870+00:00", 
            "author": "https://api.launchpad.net/1.0/~ranasheel2000"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/284156", 
            "date_created": "2016-02-24 14:21:14.632312+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/289316", 
            "date_created": "2016-03-07 13:06:24.142505+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Srushti Gadadare (<email address hidden>) on branch: master\nReview: https://review.openstack.org/289316", 
            "date_created": "2016-03-07 13:06:46.268846+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hi All,\n\nI have found two more issues related to 'glance-manage db sync'.\n\nCommands: \n'glance-manage db sync' has two arguments 'version' and 'current_version'. \nIf you give 'current_version' greater than the actual current database version it\nthrows InvalidVersionError exception with traceback.\n\n$ glance-manage db sync 45 56\n\nLOG: \n2016-03-11 10:21:37.520 CRITICAL glance [-] InvalidVersionError: 56\n2016-03-11 10:21:37.520 TRACE glance Traceback (most recent call last):\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/bin/glance-manage\", line 10, in <module>\n2016-03-11 10:21:37.520 TRACE glance     sys.exit(main())\n2016-03-11 10:21:37.520 TRACE glance   File \"/opt/stack/glance/glance/cmd/manage.py\", line 383, in main\n2016-03-11 10:21:37.520 TRACE glance     return CONF.command.action_fn(*func_args, **func_kwargs)\n2016-03-11 10:21:37.520 TRACE glance   File \"/opt/stack/glance/glance/cmd/manage.py\", line 146, in sync\n2016-03-11 10:21:37.520 TRACE glance     version=current_version)\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/migration.py\", line 153, in db_version_control\n2016-03-11 10:21:37.520 TRACE glance     versioning_api.version_control(engine, repository, version)\n2016-03-11 10:21:37.520 TRACE glance   File \"<decorator-gen-8>\", line 2, in version_control\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-03-11 10:21:37.520 TRACE glance     return f(*a, **kw)\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 250, in version_control\n2016-03-11 10:21:37.520 TRACE glance     ControlledSchema.create(engine, repository, version)\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 140, in create\n2016-03-11 10:21:37.520 TRACE glance     version = cls._validate_version(repository, version)\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 161, in _validate_version\n2016-03-11 10:21:37.520 TRACE glance     raise exceptions.InvalidVersionError(version)\n2016-03-11 10:21:37.520 TRACE glance InvalidVersionError: 56\n2016-03-11 10:21:37.520 TRACE glance\n\n\nIn case of 'current_version' greater than 0 and less than the current database version it throws DatabaseAlreadyControlledError.\n$ glance-manage db sync 100 43\n\nLOG:\n2016-03-11 09:17:18.841 CRITICAL glance [-] DatabaseAlreadyControlledError\n2016-03-11 09:17:18.841 TRACE glance Traceback (most recent call last):\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/bin/glance-manage\", line 10, in <module>\n2016-03-11 09:17:18.841 TRACE glance     sys.exit(main())\n2016-03-11 09:17:18.841 TRACE glance   File \"/opt/stack/glance/glance/cmd/manage.py\", line 353, in main\n2016-03-11 09:17:18.841 TRACE glance     return CONF.command.action_fn(*func_args, **func_kwargs)\n2016-03-11 09:17:18.841 TRACE glance   File \"/opt/stack/glance/glance/cmd/manage.py\", line 117, in sync\n2016-03-11 09:17:18.841 TRACE glance     version=current_version)\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/migration.py\", line 153, in db_version_control\n2016-03-11 09:17:18.841 TRACE glance     versioning_api.version_control(engine, repository, version)\n2016-03-11 09:17:18.841 TRACE glance   File \"<decorator-gen-8>\", line 2, in version_control\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-03-11 09:17:18.841 TRACE glance     return f(*a, **kw)\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 250, in version_control\n2016-03-11 09:17:18.841 TRACE glance     ControlledSchema.create(engine, repository, version)\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 141, in create\n2016-03-11 09:17:18.841 TRACE glance     table = cls._create_table_version(engine, repository, version)\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 189, in _create_table_version\n2016-03-11 09:17:18.841 TRACE glance     raise exceptions.DatabaseAlreadyControlledError\n2016-03-11 09:17:18.841 TRACE glance DatabaseAlreadyControlledError\n2016-03-11 09:17:18.841 TRACE glance\n\nTo fix these issues we can go with following approaches:\n\n[A] Project oslo_db is using sqlalchemy-migrate internally so as both the exceptions are raised from  \n    migrate/versioning/schema.py of sqlalchemy-migrate project [1] [2], we can handle them in oslo_db itself \n    and raise appropriate exception. Project oslo_db is imported in glance so we can easily import oslo_db.exception\n    and catch exceptions to provide user friendly messages instead of traceback.\n\t\n[B] We can use generic 'Exception' class to handle the exceptions which are raised from third party projects.\n\nSo which approach is right ? Please suggest your opinion.\n\n[1] https://github.com/openstack/sqlalchemy-migrate/blob/master/migrate/versioning/schema.py#L189\n[2] https://github.com/openstack/sqlalchemy-migrate/blob/master/migrate/versioning/schema.py#L161", 
            "date_created": "2016-03-11 10:43:58.301306+00:00", 
            "author": "https://api.launchpad.net/1.0/~dinesh-bhor"
        }, 
        {
            "content": "Hi All,\n\nI have found two more issues related to 'glance-manage db sync'.\n\nCommands: \n'glance-manage db sync' has two arguments 'version' and 'current_version'. \nIf you give 'current_version' greater than the actual current database version it\nthrows InvalidVersionError exception with traceback.\n\n$ glance-manage db sync 45 56\n\nLOG: \n2016-03-11 10:21:37.520 CRITICAL glance [-] InvalidVersionError: 56\n2016-03-11 10:21:37.520 TRACE glance Traceback (most recent call last):\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/bin/glance-manage\", line 10, in <module>\n2016-03-11 10:21:37.520 TRACE glance     sys.exit(main())\n2016-03-11 10:21:37.520 TRACE glance   File \"/opt/stack/glance/glance/cmd/manage.py\", line 383, in main\n2016-03-11 10:21:37.520 TRACE glance     return CONF.command.action_fn(*func_args, **func_kwargs)\n2016-03-11 10:21:37.520 TRACE glance   File \"/opt/stack/glance/glance/cmd/manage.py\", line 146, in sync\n2016-03-11 10:21:37.520 TRACE glance     version=current_version)\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/migration.py\", line 153, in db_version_control\n2016-03-11 10:21:37.520 TRACE glance     versioning_api.version_control(engine, repository, version)\n2016-03-11 10:21:37.520 TRACE glance   File \"<decorator-gen-8>\", line 2, in version_control\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-03-11 10:21:37.520 TRACE glance     return f(*a, **kw)\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 250, in version_control\n2016-03-11 10:21:37.520 TRACE glance     ControlledSchema.create(engine, repository, version)\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 140, in create\n2016-03-11 10:21:37.520 TRACE glance     version = cls._validate_version(repository, version)\n2016-03-11 10:21:37.520 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 161, in _validate_version\n2016-03-11 10:21:37.520 TRACE glance     raise exceptions.InvalidVersionError(version)\n2016-03-11 10:21:37.520 TRACE glance InvalidVersionError: 56\n2016-03-11 10:21:37.520 TRACE glance\n\n\nIn case of 'current_version' greater than 0 and less than the current database version it throws DatabaseAlreadyControlledError.\n$ glance-manage db sync 100 43\n\nLOG:\n2016-03-11 09:17:18.841 CRITICAL glance [-] DatabaseAlreadyControlledError\n2016-03-11 09:17:18.841 TRACE glance Traceback (most recent call last):\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/bin/glance-manage\", line 10, in <module>\n2016-03-11 09:17:18.841 TRACE glance     sys.exit(main())\n2016-03-11 09:17:18.841 TRACE glance   File \"/opt/stack/glance/glance/cmd/manage.py\", line 353, in main\n2016-03-11 09:17:18.841 TRACE glance     return CONF.command.action_fn(*func_args, **func_kwargs)\n2016-03-11 09:17:18.841 TRACE glance   File \"/opt/stack/glance/glance/cmd/manage.py\", line 117, in sync\n2016-03-11 09:17:18.841 TRACE glance     version=current_version)\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/migration.py\", line 153, in db_version_control\n2016-03-11 09:17:18.841 TRACE glance     versioning_api.version_control(engine, repository, version)\n2016-03-11 09:17:18.841 TRACE glance   File \"<decorator-gen-8>\", line 2, in version_control\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py\", line 160, in with_engine\n2016-03-11 09:17:18.841 TRACE glance     return f(*a, **kw)\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 250, in version_control\n2016-03-11 09:17:18.841 TRACE glance     ControlledSchema.create(engine, repository, version)\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 141, in create\n2016-03-11 09:17:18.841 TRACE glance     table = cls._create_table_version(engine, repository, version)\n2016-03-11 09:17:18.841 TRACE glance   File \"/usr/local/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 189, in _create_table_version\n2016-03-11 09:17:18.841 TRACE glance     raise exceptions.DatabaseAlreadyControlledError\n2016-03-11 09:17:18.841 TRACE glance DatabaseAlreadyControlledError\n2016-03-11 09:17:18.841 TRACE glance\n\nTo fix these issues we can go with following approaches:\n\n[A] Project oslo_db is using sqlalchemy-migrate internally so as both the exceptions are raised from  \n    migrate/versioning/schema.py of sqlalchemy-migrate project [1] [2], we can handle them in oslo_db itself \n    and raise appropriate exception. Project oslo_db is imported in glance so we can easily import oslo_db.exception\n    and catch exceptions to provide user friendly messages instead of traceback.\n\t\n[B] We can use generic 'Exception' class to handle the exceptions which are raised from third party projects.\n\nSo which approach is right ? Please suggest your opinion.\n\n[1] https://github.com/openstack/sqlalchemy-migrate/blob/master/migrate/versioning/schema.py#L189\n[2] https://github.com/openstack/sqlalchemy-migrate/blob/master/migrate/versioning/schema.py#L161", 
            "date_created": "2016-03-11 10:51:00.321592+00:00", 
            "author": "https://api.launchpad.net/1.0/~dinesh-bhor"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/296226", 
            "date_created": "2016-03-23 07:25:34.131293+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/296920", 
            "date_created": "2016-03-24 06:54:54.246391+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/299171", 
            "date_created": "2016-03-30 07:18:44.653890+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Sean McGinnis (<email address hidden>) on branch: master\nReview: https://review.openstack.org/284156\nReason: This review is > 4 weeks without comment and currently blocked by a core reviewer with a -2. We are abandoning this for now. Feel free to reactivate the review by pressing the restore button and contacting the reviewer with the -2 on this review to ensure you address their concerns.", 
            "date_created": "2016-09-24 22:12:01.906829+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/296920\nReason: This patch has been sitting unchanged for more than 12 weeks. I am therefore going to abandon it to keep the nova review queue sane. Please feel free to restore the change if you're still working on it.", 
            "date_created": "2016-10-25 16:09:28.757143+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Steve Martinelli (<email address hidden>) on branch: master\nReview: https://review.openstack.org/289316\nReason: no change in many months, i am abandoning this change from the keystone review queue", 
            "date_created": "2016-11-14 21:42:32.367419+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Is this change still being pursued? Looks like the patches have not been looked at in many months. They all depended on an oslo.db change (https://review.openstack.org/#/c/296209/) which never merged. ", 
            "date_created": "2016-11-14 21:43:44.496157+00:00", 
            "author": "https://api.launchpad.net/1.0/~stevemar"
        }, 
        {
            "content": "Change abandoned by Abhishek Kekane (<email address hidden>) on branch: master\nReview: https://review.openstack.org/299171\nReason: No update for more than 4 months. Abandoning to clear the review queue. Feel free to reopen.", 
            "date_created": "2017-07-24 12:19:23.850523+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/cinder 11.0.0.0b3 development milestone.", 
            "date_created": "2017-07-27 21:04:08.154996+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}