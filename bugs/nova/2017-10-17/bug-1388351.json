{
    "status": "Won't Fix", 
    "last_updated": "2015-08-07 20:54:29.263804+00:00", 
    "description": "noVNCproxy will not be functional if  python version lower than 2.7.4. It will raise exception as below: \n\nparse = urlparse.urlparse(self.path)\t\nif parse.scheme not in ('http', 'https'):\t\n\t# From a bug in urlparse in Python < 2.7.4 we cannot support \n\t# special schemes (cf: http://bugs.python.org/issue9374) \n\tif sys.version_info < (2, 7, 4):\t\n\t\traise exception.NovaException(\n\t\t\t_(\"We do not support scheme '%s' under Python < 2.7.4, \")\n\nThis statement check is Incorrect. Not only because parse.schema will always be '', but also this is not relevant to any python versions.\n\nThe reason is that \n1) When user trigger webbrower novnc url such as\nhttp://192.168.1.105:6080/vnc_auto.html?token=2d58d946-1469-48c5-9082-44ac6e1a59e5\nbasic python TCP modules will parse the request information in BaseHTTPServer.py. for the HTTP command, URI, and the request version. \n\n2)  Since the request is to get the vnc_auto.html.  the vnc module will sent out the html to browser. \n\n3) With the vnc_auto html page rendering, on page load method, it will make a new request to /websockify.\n            path = WebUtil.getQueryVar('path', 'websockify');\n           .....\n            rfb.connect(host, port, password, path);\n\n4) The /websokify request(with token in the cookie) will flow to websokify framework which following to NovaProxyRequestHandler(websockify request handler) to make token validations(rpc sent to nova consoleauth). The token is \n\n5) After token validation passed, NovaProxyRequestHandler will proxy to compute Host, vnc port(5900)\n\nSo by that means, the self.path in NovaProxyRequestHandlerBase.new_websocket_client will always being '/websockify'. \nIt will never return scheme if using urlparse.parse('/websockify') and not relevant to any python versions. \n\nWith removing the check and exception(revert commit https://review.openstack.org/#/c/125398/), the vnc function will be function well. \n\n\n\nFollowing is the right flow: \n192.168.1.104 - - [01/Nov/2014 14:31:27] # requestline in BaseHTTPServer py2.7.6: GET /vnc_auto.html?token=2d58d946-1469-48c5-9082-44ac6e1a59e5 HTTP/1.1\n192.168.1.104 - - [01/Nov/2014 14:31:27] # self.path is /vnc_auto.html?token=2d58d946-1469-48c5-9082-44ac6e1a59e5\n192.168.1.104 - - [01/Nov/2014 14:31:27] # self.request_version HTTP/1.1\n192.168.1.104 - - [01/Nov/2014 14:31:27] \"GET /vnc_auto.html?token=2d58d946-1469-48c5-9082-44ac6e1a59e5 HTTP/1.1\" 200 -\n2014-11-01 14:31:28.231 DEBUG nova.console.websocketproxy [-] 192.168.1.104: new handler Process from (pid=15763) vmsg /usr/local/lib/python2.7/dist-packages/websockify/websocket.py:824\n192.168.1.104 - - [01/Nov/2014 14:31:28] # requestline in py2.7.6: GET /websockify HTTP/1.1\n192.168.1.104 - - [01/Nov/2014 14:31:28] # self.path is /websockify\n192.168.1.104 - - [01/Nov/2014 14:31:28] # self.request_version HTTP/1.1\n192.168.1.104 - - [01/Nov/2014 14:31:28] \"GET /websockify HTTP/1.1\" 101 -\n192.168.1.104 - - [01/Nov/2014 14:31:28] 192.168.1.104: Plain non-SSL (ws://) WebSocket connection\n192.168.1.104 - - [01/Nov/2014 14:31:28] 192.168.1.104: Version hybi-13, base64: 'False'\n192.168.1.104 - - [01/Nov/2014 14:31:28] 192.168.1.104: Path: '/websockify'\n2014-11-01 14:31:28.270 INFO nova.console.websocketproxy [-] self.path in new_websocket_client in python276is  /websockify\n2014-11-01 14:31:28.271 INFO nova.console.websocketproxy [-] parse.scheme in pythone276 is\n2014-11-01 14:31:28.272 INFO nova.console.websocketproxy [-] parse.query in new_websocket_client\n2014-11-01 14:31:28.272 INFO nova.console.websocketproxy [-] token after urlparse.parse_qs:\n2014-11-01 14:31:28.273 INFO nova.console.websocketproxy [-] self.headers is Host: 192.168.1.105:6080\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:31.0) Gecko/20100101 Firefox/31.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en,zh-cn;q=0.8,zh-tw;q=0.5,en-us;q=0.3\nAccept-Encoding: gzip, deflate\nSec-WebSocket-Version: 13\nOrigin: http://192.168.1.105:6080\nSec-WebSocket-Protocol: binary, base64\nSec-WebSocket-Key: FxJXwRLEslPNU+nmcwIVzw==\nCookie: token=2d58d946-1469-48c5-9082-44ac6e1a59e5\nConnection: keep-alive, Upgrade\nPragma: no-cache\nCache-Control: no-cache\nUpgrade: websocket\n\n2014-11-01 14:31:28.282 INFO oslo.messaging._drivers.impl_rabbit [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None] Connecting to AMQP server on 127.0.0.1:5672\n2014-11-01 14:31:28.300 INFO oslo.messaging._drivers.impl_rabbit [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None] Connected to AMQP server on 127.0.0.1:5672\n2014-11-01 14:31:28.305 INFO oslo.messaging._drivers.impl_rabbit [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None] Connecting to AMQP server on 127.0.0.1:5672\n2014-11-01 14:31:28.312 INFO oslo.messaging._drivers.impl_rabbit [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None] Connected to AMQP server on 127.0.0.1:5672\n2014-11-01 14:31:28.405 INFO nova.console.websocketproxy [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None]   8: connect info: {u'instance_uuid': u'77c1709d-e051-4954-bd6e-1f444f31084e', u'internal_access_path': None, u'last_activity_at': 1414823475.800361, u'console_type': u'novnc', u'host': u'127.0.0.1', u'token': u'2d58d946-1469-48c5-9082-44ac6e1a59e5', u'port': u'5900'}\n2014-11-01 14:31:28.406 INFO nova.console.websocketproxy [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None]   8: connecting to: 127.0.0.1:5900", 
    "tags": [
        "console"
    ], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1388351", 
    "owner": "None", 
    "id": 1388351, 
    "index": 6524, 
    "openned": "2014-11-01 11:03:56.389365+00:00", 
    "created": "2014-11-01 11:03:56.389365+00:00", 
    "title": "NoVNC does not work with python lower than 2.7.4", 
    "comments": [
        {
            "content": "noVNCproxy will not be functional if  python version lower than 2.7.4. It will raise exception as below: \n\nparse = urlparse.urlparse(self.path)\t\nif parse.scheme not in ('http', 'https'):\t\n\t# From a bug in urlparse in Python < 2.7.4 we cannot support \n\t# special schemes (cf: http://bugs.python.org/issue9374) \n\tif sys.version_info < (2, 7, 4):\t\n\t\traise exception.NovaException(\n\t\t\t_(\"We do not support scheme '%s' under Python < 2.7.4, \")\n\nThis statement check is Incorrect. Not only because parse.schema will always be '', but also this is not relevant to any python versions.\n\nThe reason is that \n1) When user trigger webbrower novnc url such as\nhttp://192.168.1.105:6080/vnc_auto.html?token=2d58d946-1469-48c5-9082-44ac6e1a59e5\nbasic python TCP modules will parse the request information in BaseHTTPServer.py. for the HTTP command, URI, and the request version. \n\n2)  Since the request is to get the vnc_auto.html.  the vnc module will sent out the html to browser. \n\n3) With the vnc_auto html page rendering, on page load method, it will make a new request to /websockify.\n            path = WebUtil.getQueryVar('path', 'websockify');\n           .....\n            rfb.connect(host, port, password, path);\n\n4) The /websokify request(with token in the cookie) will flow to websokify framework which following to NovaProxyRequestHandler(websockify request handler) to make token validations(rpc sent to nova consoleauth). The token is \n\n5) After token validation passed, NovaProxyRequestHandler will proxy to compute Host, vnc port(5900)\n\nSo by that means, the self.path in NovaProxyRequestHandlerBase.new_websocket_client will always being '/websockify'. \nIt will never return scheme if using urlparse.parse('/websockify') and not relevant to any python versions. \n\nWith removing the check and exception(revert commit https://review.openstack.org/#/c/125398/), the vnc function will be function well. \n\n\n\nFollowing is the right flow: \n192.168.1.104 - - [01/Nov/2014 14:31:27] # requestline in BaseHTTPServer py2.7.6: GET /vnc_auto.html?token=2d58d946-1469-48c5-9082-44ac6e1a59e5 HTTP/1.1\n192.168.1.104 - - [01/Nov/2014 14:31:27] # self.path is /vnc_auto.html?token=2d58d946-1469-48c5-9082-44ac6e1a59e5\n192.168.1.104 - - [01/Nov/2014 14:31:27] # self.request_version HTTP/1.1\n192.168.1.104 - - [01/Nov/2014 14:31:27] \"GET /vnc_auto.html?token=2d58d946-1469-48c5-9082-44ac6e1a59e5 HTTP/1.1\" 200 -\n2014-11-01 14:31:28.231 DEBUG nova.console.websocketproxy [-] 192.168.1.104: new handler Process from (pid=15763) vmsg /usr/local/lib/python2.7/dist-packages/websockify/websocket.py:824\n192.168.1.104 - - [01/Nov/2014 14:31:28] # requestline in py2.7.6: GET /websockify HTTP/1.1\n192.168.1.104 - - [01/Nov/2014 14:31:28] # self.path is /websockify\n192.168.1.104 - - [01/Nov/2014 14:31:28] # self.request_version HTTP/1.1\n192.168.1.104 - - [01/Nov/2014 14:31:28] \"GET /websockify HTTP/1.1\" 101 -\n192.168.1.104 - - [01/Nov/2014 14:31:28] 192.168.1.104: Plain non-SSL (ws://) WebSocket connection\n192.168.1.104 - - [01/Nov/2014 14:31:28] 192.168.1.104: Version hybi-13, base64: 'False'\n192.168.1.104 - - [01/Nov/2014 14:31:28] 192.168.1.104: Path: '/websockify'\n2014-11-01 14:31:28.270 INFO nova.console.websocketproxy [-] self.path in new_websocket_client in python276is  /websockify\n2014-11-01 14:31:28.271 INFO nova.console.websocketproxy [-] parse.scheme in pythone276 is\n2014-11-01 14:31:28.272 INFO nova.console.websocketproxy [-] parse.query in new_websocket_client\n2014-11-01 14:31:28.272 INFO nova.console.websocketproxy [-] token after urlparse.parse_qs:\n2014-11-01 14:31:28.273 INFO nova.console.websocketproxy [-] self.headers is Host: 192.168.1.105:6080\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:31.0) Gecko/20100101 Firefox/31.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en,zh-cn;q=0.8,zh-tw;q=0.5,en-us;q=0.3\nAccept-Encoding: gzip, deflate\nSec-WebSocket-Version: 13\nOrigin: http://192.168.1.105:6080\nSec-WebSocket-Protocol: binary, base64\nSec-WebSocket-Key: FxJXwRLEslPNU+nmcwIVzw==\nCookie: token=2d58d946-1469-48c5-9082-44ac6e1a59e5\nConnection: keep-alive, Upgrade\nPragma: no-cache\nCache-Control: no-cache\nUpgrade: websocket\n\n2014-11-01 14:31:28.282 INFO oslo.messaging._drivers.impl_rabbit [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None] Connecting to AMQP server on 127.0.0.1:5672\n2014-11-01 14:31:28.300 INFO oslo.messaging._drivers.impl_rabbit [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None] Connected to AMQP server on 127.0.0.1:5672\n2014-11-01 14:31:28.305 INFO oslo.messaging._drivers.impl_rabbit [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None] Connecting to AMQP server on 127.0.0.1:5672\n2014-11-01 14:31:28.312 INFO oslo.messaging._drivers.impl_rabbit [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None] Connected to AMQP server on 127.0.0.1:5672\n2014-11-01 14:31:28.405 INFO nova.console.websocketproxy [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None]   8: connect info: {u'instance_uuid': u'77c1709d-e051-4954-bd6e-1f444f31084e', u'internal_access_path': None, u'last_activity_at': 1414823475.800361, u'console_type': u'novnc', u'host': u'127.0.0.1', u'token': u'2d58d946-1469-48c5-9082-44ac6e1a59e5', u'port': u'5900'}\n2014-11-01 14:31:28.406 INFO nova.console.websocketproxy [req-1404bf1a-b530-4708-be0c-007bafcbf998 None None]   8: connecting to: 127.0.0.1:5900", 
            "date_created": "2014-11-01 11:03:56.389365+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhuzhubj"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/135862", 
            "date_created": "2014-11-20 06:41:07.241814+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "that's a critical issue, and should be fixed asap ", 
            "date_created": "2014-11-24 08:28:46.251252+00:00", 
            "author": "https://api.launchpad.net/1.0/~yalei-wang"
        }, 
        {
            "content": "Change abandoned by Sean Dague (<email address hidden>) on branch: master\nReview: https://review.openstack.org/135862\nReason: This review is > 4 weeks without comment, and failed Jenkins the last time it was checked. We are abandoning this for now. Feel free to reactivate the review by pressing the restore button and leaving a 'recheck' comment to get fresh test results.", 
            "date_created": "2015-01-23 15:28:53.398637+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "So is this going anywhere?  Are we going to allow python 2.7.3 or are we going to force everyone to upgrade?", 
            "date_created": "2015-02-02 22:35:03.922025+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbf123"
        }, 
        {
            "content": "Removing \"In Progress\" status and assignee as change is abandoned.", 
            "date_created": "2015-02-12 16:47:51.061926+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }
    ], 
    "closed": "2015-08-07 20:54:26.362557+00:00"
}