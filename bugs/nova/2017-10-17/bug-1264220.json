{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:35:45.755426+00:00", 
    "description": "If passing invalid parameter to \"create flavor_extraspecs\" API, an internal error happens and Traceback is written in log file.\nNova should return BadRequest response instead of internal error.\n\n$ curl -i 'http://10.21.42.109:8774/v2/fd283c7ef47b4f46899403e9ebb1e2ed/flavors/6e05eb08-ef1a-4183-9eb9-5c175060247a/os-extra_specs' [..] -d '{\"foo\": {\"key01\": \"value01\"}}'\nHTTP/1.1 500 Internal Server Error\nContent-Length: 128\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-e8b5120c-e585-4095-a387-d3eed52b7415\nDate: Thu, 26 Dec 2013 11:06:46 GMT\n\n{\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}\n$\n\n** The log of nova-api **\n2013-12-26 20:06:46.026 ERROR nova.api.openstack [req-e8b5120c-e585-4095-a387-d3eed52b7415 admin demo] Caught error: 'NoneType' object has no attribute 'keys'\n2013-12-26 20:06:46.026 TRACE nova.api.openstack Traceback (most recent call last):\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 121, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 581, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 930, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     content_type, body, accept)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 992, in _process_stack\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1073, in dispatch\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/flavorextraspecs.py\", line 76, in create\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     specs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/api.py\", line 1487, in flavor_extra_specs_update_or_create\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     extra_specs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return f(*args, **kwargs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 4483, in flavor_extra_specs_update_or_create\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     filter(models.InstanceTypeExtraSpecs.key.in_(specs.keys())).\\\n2013-12-26 20:06:46.026 TRACE nova.api.openstack AttributeError: 'NoneType' object has no attribute 'keys'", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1264220", 
    "owner": "https://api.launchpad.net/1.0/~oomichi", 
    "id": 1264220, 
    "index": 5679, 
    "openned": "2013-12-26 05:01:49.065210+00:00", 
    "created": "2013-12-26 05:01:49.065210+00:00", 
    "title": "An internal error happens if passing invalid parameter to 'create flavor_extraspecs' API", 
    "comments": [
        {
            "content": "If passing invalid parameter to \"create flavor_extraspecs\" API, an internal error happens and Traceback is written in log file.\nNova should return BadRequest response instead of internal error.\n\n$ curl -i 'http://10.21.42.109:8774/v2/fd283c7ef47b4f46899403e9ebb1e2ed/flavors/6e05eb08-ef1a-4183-9eb9-5c175060247a/os-extra_specs' [..] -d '{\"foo\": {\"key01\": \"value01\"}}'\nHTTP/1.1 500 Internal Server Error\nContent-Length: 128\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-e8b5120c-e585-4095-a387-d3eed52b7415\nDate: Thu, 26 Dec 2013 11:06:46 GMT\n\n{\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}\n$\n\n** The log of nova-api **\n2013-12-26 20:06:46.026 ERROR nova.api.openstack [req-e8b5120c-e585-4095-a387-d3eed52b7415 admin demo] Caught error: 'NoneType' object has no attribute 'keys'\n2013-12-26 20:06:46.026 TRACE nova.api.openstack Traceback (most recent call last):\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 121, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 581, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 930, in __call__\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     content_type, body, accept)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 992, in _process_stack\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1073, in dispatch\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/flavorextraspecs.py\", line 76, in create\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     specs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/api.py\", line 1487, in flavor_extra_specs_update_or_create\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     extra_specs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     return f(*args, **kwargs)\n2013-12-26 20:06:46.026 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 4483, in flavor_extra_specs_update_or_create\n2013-12-26 20:06:46.026 TRACE nova.api.openstack     filter(models.InstanceTypeExtraSpecs.key.in_(specs.keys())).\\\n2013-12-26 20:06:46.026 TRACE nova.api.openstack AttributeError: 'NoneType' object has no attribute 'keys'", 
            "date_created": "2013-12-26 05:01:49.065210+00:00", 
            "author": "https://api.launchpad.net/1.0/~oomichi"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/75721", 
            "date_created": "2014-02-23 22:32:18.746861+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/75721\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8010c8faf9f030d2c0264189f9e6c70e10a093f2\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8010c8faf9f030d2c0264189f9e6c70e10a093f2\nAuthor: Ken'ichi Ohmichi <email address hidden>\nDate:   Mon Feb 24 16:28:41 2014 +0900\n\n    Fix the validation of flavor_extraspecs v2 API\n    \n    \"create flavor_extraspecs\" v2 API does not validate the data type\n    of a request body. If invalid parameter is passed, an internal error\n    happens. If many invalid requests come, a log file would be occupied\n    with traceback.\n    \n    In addition, it does not validate the lengths of both key and value of\n    extra_specs. extra_specs are stored into the instance_type_extra_specs\n    table, and the key and value are defined as String(255).\n    \n    This patch fixes the validation code from the viewpoint of data type\n    and key/value length.\n    \n    Closes-Bug: #1264220\n    \n    Change-Id: I195bd5d45a896e9b26dd81dab1e49c9f939b4805\n", 
            "date_created": "2014-04-02 01:35:06.913095+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-06-11 13:55:41.469054+00:00"
}