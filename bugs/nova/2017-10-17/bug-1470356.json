{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:54:47.191561+00:00", 
    "description": "Nova compute raises AttributeError on creating the instance with raw image type and instance goes in to error state.\n\nSteps to reproduce:\n\n1. Set image_type = raw in [libvirt] section of nova.conf and restart nova services.\n2. Create an instance using image (I have used default cirros image).\n$ nova boot --image 5e1659aa-6d38-44e8-aaa3-4217337436c0 --flavor 1 instance-1\n3. Run $ nova list\n4. Instance is in Error state and following error is logged in n-cpu logs\n\n2015-06-30 23:13:11.174 DEBUG oslo_concurrency.lockutils [req-f66cf801-d424-4583-8270-92023c6a70a1 demo demo] Lock \"8d2c340dcce68e48a75457b1e91457feed27a\nef5\" released by \"copy_raw_image\" :: held 0.431s from (pid=29182) inner /usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py:456\n2015-06-30 23:13:11.184 ERROR nova.compute.manager [req-f66cf801-d424-4583-8270-92023c6a70a1 demo demo] [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]\nInstance failed to spawn\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569] Traceback (most recent call last):\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/compute/manager.py\", lin\ne 2113, in _build_resources\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     yield resources\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/compute/manager.py\", lin\ne 1985, in _build_and_run_instance\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     block_device_info=block_device_info)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\",\n line 2428, in spawn\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     admin_pass=admin_password)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\",\n line 2827, in _create_image\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     instance, size, fallback_from_host)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\",\n line 5968, in _try_fetch_image_cache\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     size=size)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/imagebacken\nd.py\", line 234, in cache\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     *args, **kwargs)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/imagebacken\nd.py\", line 452, in create_image\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     copy_raw_image(base, self.path, size)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/usr/local/lib/python2.7/dist-packages/oslo_c\noncurrency/lockutils.py\", line 445, in inner\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     return f(*args, **kwargs)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/imagebacken\nd.py\", line 439, in copy_raw_image\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     disk.extend(image, size)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/disk/api.py\", line\n197, in extend\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     if not is_image_extendable(image):\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/disk/api.py\", line\n272, in is_image_extendable\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     utils.execute('e2label', image.file)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569] AttributeError: 'LocalFileImage' object has no attrib\nute 'file'\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1470356", 
    "owner": "https://api.launchpad.net/1.0/~ankitagrawal", 
    "id": 1470356, 
    "index": 1771, 
    "openned": "2015-07-01 06:39:21.522511+00:00", 
    "created": "2015-07-01 06:39:21.522511+00:00", 
    "title": "AttributeError on creating instance with raw image type", 
    "comments": [
        {
            "content": "Nova compute raises AttributeError on creating the instance with raw image type and instance goes in to error state.\n\nSteps to reproduce:\n\n1. Set image_type = raw in [libvirt] section of nova.conf and restart nova services.\n2. Create an instance using image (I have used default cirros image).\n$ nova boot --image 5e1659aa-6d38-44e8-aaa3-4217337436c0 --flavor 1 instance-1\n3. Run $ nova list\n4. Instance is in Error state and following error is logged in n-cpu logs\n\n2015-06-30 23:13:11.174 DEBUG oslo_concurrency.lockutils [req-f66cf801-d424-4583-8270-92023c6a70a1 demo demo] Lock \"8d2c340dcce68e48a75457b1e91457feed27a\nef5\" released by \"copy_raw_image\" :: held 0.431s from (pid=29182) inner /usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py:456\n2015-06-30 23:13:11.184 ERROR nova.compute.manager [req-f66cf801-d424-4583-8270-92023c6a70a1 demo demo] [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]\nInstance failed to spawn\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569] Traceback (most recent call last):\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/compute/manager.py\", lin\ne 2113, in _build_resources\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     yield resources\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/compute/manager.py\", lin\ne 1985, in _build_and_run_instance\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     block_device_info=block_device_info)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\",\n line 2428, in spawn\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     admin_pass=admin_password)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\",\n line 2827, in _create_image\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     instance, size, fallback_from_host)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\",\n line 5968, in _try_fetch_image_cache\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     size=size)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/imagebacken\nd.py\", line 234, in cache\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     *args, **kwargs)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/imagebacken\nd.py\", line 452, in create_image\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     copy_raw_image(base, self.path, size)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/usr/local/lib/python2.7/dist-packages/oslo_c\noncurrency/lockutils.py\", line 445, in inner\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     return f(*args, **kwargs)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/libvirt/imagebacken\nd.py\", line 439, in copy_raw_image\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     disk.extend(image, size)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/disk/api.py\", line\n197, in extend\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     if not is_image_extendable(image):\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]   File \"/opt/stack/nova/nova/virt/disk/api.py\", line\n272, in is_image_extendable\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569]     utils.execute('e2label', image.file)\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943-b25e-da684edaf569] AttributeError: 'LocalFileImage' object has no attrib\nute 'file'\n2015-06-30 23:13:11.184 TRACE nova.compute.manager [instance: 4a4913a9-2ea9-4943", 
            "date_created": "2015-07-01 06:39:21.522511+00:00", 
            "author": "https://api.launchpad.net/1.0/~ankitagrawal"
        }
    ], 
    "closed": "2015-07-28 09:07:54.133951+00:00"
}