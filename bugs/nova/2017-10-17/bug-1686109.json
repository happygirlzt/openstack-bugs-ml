{
    "status": "Confirmed", 
    "last_updated": "2017-07-18 03:25:58.719785+00:00", 
    "description": "We see this about 11 times in 7 days in the check and gate queues on the nova functional jobs:\n\nhttp://logs.openstack.org/20/459420/1/check/gate-nova-tox-functional-ubuntu-xenial/c0bdfa6/console.html#_2017-04-25_13_55_17_705409\n\n2017-04-25 13:55:17.704694 | Captured traceback:\n2017-04-25 13:55:17.704705 | ~~~~~~~~~~~~~~~~~~~\n2017-04-25 13:55:17.704720 |     Traceback (most recent call last):\n2017-04-25 13:55:17.704749 |       File \"nova/tests/functional/api_sample_tests/test_fixed_ips.py\", line 100, in test_get_fixed_ip\n2017-04-25 13:55:17.704763 |         self._test_get_fixed_ip()\n2017-04-25 13:55:17.704791 |       File \"nova/tests/functional/api_sample_tests/test_fixed_ips.py\", line 91, in _test_get_fixed_ip\n2017-04-25 13:55:17.704817 |         response = self._do_get('os-fixed-ips/192.168.1.1')\n2017-04-25 13:55:17.704844 |       File \"nova/tests/functional/api_samples_test_base.py\", line 488, in _do_get\n2017-04-25 13:55:17.704857 |         headers=headers)\n2017-04-25 13:55:17.704883 |       File \"nova/tests/functional/api_samples_test_base.py\", line 479, in _get_response\n2017-04-25 13:55:17.704901 |         headers=headers, strip_version=strip_version)\n2017-04-25 13:55:17.704923 |       File \"nova/tests/functional/api/client.py\", line 164, in api_request\n2017-04-25 13:55:17.704938 |         auth_result = self._authenticate()\n2017-04-25 13:55:17.704961 |       File \"nova/tests/functional/api/client.py\", line 150, in _authenticate\n2017-04-25 13:55:17.704972 |         headers=headers)\n2017-04-25 13:55:17.704994 |       File \"nova/tests/functional/api/client.py\", line 138, in request\n2017-04-25 13:55:17.705016 |         response = requests.request(method, url, data=body, headers=_headers)\n2017-04-25 13:55:17.705059 |       File \"/home/jenkins/workspace/gate-nova-tox-functional-ubuntu-xenial/.tox/functional/local/lib/python2.7/site-packages/requests/api.py\", line 56, in request\n2017-04-25 13:55:17.705083 |         return session.request(method=method, url=url, **kwargs)\n2017-04-25 13:55:17.705163 |       File \"/home/jenkins/workspace/gate-nova-tox-functional-ubuntu-xenial/.tox/functional/local/lib/python2.7/site-packages/requests/sessions.py\", line 488, in request\n2017-04-25 13:55:17.705202 |         resp = self.send(prep, **send_kwargs)\n2017-04-25 13:55:17.705280 |       File \"/home/jenkins/workspace/gate-nova-tox-functional-ubuntu-xenial/.tox/functional/local/lib/python2.7/site-packages/requests/sessions.py\", line 609, in send\n2017-04-25 13:55:17.705321 |         r = adapter.send(request, **kwargs)\n2017-04-25 13:55:17.705367 |       File \"/home/jenkins/workspace/gate-nova-tox-functional-ubuntu-xenial/.tox/functional/local/lib/python2.7/site-packages/requests/adapters.py\", line 473, in send\n2017-04-25 13:55:17.705384 |         raise ConnectionError(err, request=request)\n2017-04-25 13:55:17.705409 |     requests.exceptions.ConnectionError: ('Connection aborted.', BadStatusLine(\"''\",))\n\nWhich API it fails on is completely random I think.\n\nIt looks like this is maybe a result of the OSAPIFixture spawning a greenthread to run the nova-api service:\n\n(9:19:08 AM) cdent: if for some reason the new greenthread doesn't get yielded to when it should, the client will try to read off the socket which nothing paying proper attention on the other side\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22requests.exceptions.ConnectionError%3A%20('Connection%20aborted.'%2C%20BadStatusLine(%5C%22''%5C%22%2C))%5C%22%20AND%20tags%3A%5C%22console%5C%22%20AND%20project%3A%5C%22openstack%2Fnova%5C%22&from=7d", 
    "tags": [
        "api", 
        "testing"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1686109", 
    "owner": "None", 
    "id": 1686109, 
    "index": 4809, 
    "openned": "2017-04-25 14:21:11.953933+00:00", 
    "created": "2017-04-25 14:21:11.953933+00:00", 
    "title": "requests.exceptions.ConnectionError: ('Connection aborted.', BadStatusLine('''',)) in functional tests", 
    "comments": [
        {
            "content": "We see this about 11 times in 7 days in the check and gate queues on the nova functional jobs:\n\nhttp://logs.openstack.org/20/459420/1/check/gate-nova-tox-functional-ubuntu-xenial/c0bdfa6/console.html#_2017-04-25_13_55_17_705409\n\n2017-04-25 13:55:17.704694 | Captured traceback:\n2017-04-25 13:55:17.704705 | ~~~~~~~~~~~~~~~~~~~\n2017-04-25 13:55:17.704720 |     Traceback (most recent call last):\n2017-04-25 13:55:17.704749 |       File \"nova/tests/functional/api_sample_tests/test_fixed_ips.py\", line 100, in test_get_fixed_ip\n2017-04-25 13:55:17.704763 |         self._test_get_fixed_ip()\n2017-04-25 13:55:17.704791 |       File \"nova/tests/functional/api_sample_tests/test_fixed_ips.py\", line 91, in _test_get_fixed_ip\n2017-04-25 13:55:17.704817 |         response = self._do_get('os-fixed-ips/192.168.1.1')\n2017-04-25 13:55:17.704844 |       File \"nova/tests/functional/api_samples_test_base.py\", line 488, in _do_get\n2017-04-25 13:55:17.704857 |         headers=headers)\n2017-04-25 13:55:17.704883 |       File \"nova/tests/functional/api_samples_test_base.py\", line 479, in _get_response\n2017-04-25 13:55:17.704901 |         headers=headers, strip_version=strip_version)\n2017-04-25 13:55:17.704923 |       File \"nova/tests/functional/api/client.py\", line 164, in api_request\n2017-04-25 13:55:17.704938 |         auth_result = self._authenticate()\n2017-04-25 13:55:17.704961 |       File \"nova/tests/functional/api/client.py\", line 150, in _authenticate\n2017-04-25 13:55:17.704972 |         headers=headers)\n2017-04-25 13:55:17.704994 |       File \"nova/tests/functional/api/client.py\", line 138, in request\n2017-04-25 13:55:17.705016 |         response = requests.request(method, url, data=body, headers=_headers)\n2017-04-25 13:55:17.705059 |       File \"/home/jenkins/workspace/gate-nova-tox-functional-ubuntu-xenial/.tox/functional/local/lib/python2.7/site-packages/requests/api.py\", line 56, in request\n2017-04-25 13:55:17.705083 |         return session.request(method=method, url=url, **kwargs)\n2017-04-25 13:55:17.705163 |       File \"/home/jenkins/workspace/gate-nova-tox-functional-ubuntu-xenial/.tox/functional/local/lib/python2.7/site-packages/requests/sessions.py\", line 488, in request\n2017-04-25 13:55:17.705202 |         resp = self.send(prep, **send_kwargs)\n2017-04-25 13:55:17.705280 |       File \"/home/jenkins/workspace/gate-nova-tox-functional-ubuntu-xenial/.tox/functional/local/lib/python2.7/site-packages/requests/sessions.py\", line 609, in send\n2017-04-25 13:55:17.705321 |         r = adapter.send(request, **kwargs)\n2017-04-25 13:55:17.705367 |       File \"/home/jenkins/workspace/gate-nova-tox-functional-ubuntu-xenial/.tox/functional/local/lib/python2.7/site-packages/requests/adapters.py\", line 473, in send\n2017-04-25 13:55:17.705384 |         raise ConnectionError(err, request=request)\n2017-04-25 13:55:17.705409 |     requests.exceptions.ConnectionError: ('Connection aborted.', BadStatusLine(\"''\",))\n\nWhich API it fails on is completely random I think.\n\nIt looks like this is maybe a result of the OSAPIFixture spawning a greenthread to run the nova-api service:\n\n(9:19:08 AM) cdent: if for some reason the new greenthread doesn't get yielded to when it should, the client will try to read off the socket which nothing paying proper attention on the other side\n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22requests.exceptions.ConnectionError%3A%20('Connection%20aborted.'%2C%20BadStatusLine(%5C%22''%5C%22%2C))%5C%22%20AND%20tags%3A%5C%22console%5C%22%20AND%20project%3A%5C%22openstack%2Fnova%5C%22&from=7d", 
            "date_created": "2017-04-25 14:21:11.953933+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/459733", 
            "date_created": "2017-04-25 14:56:40.764227+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/459735", 
            "date_created": "2017-04-25 15:00:55.965604+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/459735\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=4542650b239a35c4e21b0d7801670c3ebafc986f\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4542650b239a35c4e21b0d7801670c3ebafc986f\nAuthor: Sean Dague <email address hidden>\nDate:   Tue Apr 25 10:45:05 2017 -0400\n\n    disable keepalive for functional tests\n    \n    We believe that some of the current race failures in the gate are\n    because of eventlet vs. requests for our full stack in a process\n    testing. One of the ways to make this better is turn off keepalive on\n    eventlet.\n    \n    Related-Bug: #1686109\n    \n    Change-Id: Ibdb29274cdf26de74f4ca0cc3bdab622299a91bf\n", 
            "date_created": "2017-04-25 17:29:13.161244+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Chris Dent (<email address hidden>) on branch: master\nReview: https://review.openstack.org/459733\nReason: This has proved its point (that eventlet in the tests is fraught)", 
            "date_created": "2017-04-28 13:38:40.387081+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/483972", 
            "date_created": "2017-07-14 15:43:37.151491+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/483972\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=d812c7eb3c7f0ce80c3548e9aec10b9fdc650a67\nSubmitter: Jenkins\nBranch:    master\n\ncommit d812c7eb3c7f0ce80c3548e9aec10b9fdc650a67\nAuthor: Matt Riedemann <email address hidden>\nDate:   Fri Jul 14 11:40:13 2017 -0400\n\n    Set wsgi.keep_alive=False globally for tests\n    \n    This was previously set for all functional API samples\n    tests to try and fix a weird issue where requests and responses\n    seemed to get mixed up between the compute API wsgi service\n    fixture used in the API samples functional tests and the\n    Placement API functional tests.\n    \n    However, we're also seeing these weird mixup issues in\n    non-API samples tests, and there are other wsgi server fixtures\n    that should be setting this, like the OSMetadataServer\n    fixture. And there are functional tests that don't inherit from\n    _IntegratedTestBase so we should just set this globally to be\n    safe.\n    \n    Related-Bug: #1686109\n    Related-Bug: #1696834\n    \n    Change-Id: Ie307e4d43be4b3e40dd75384ea6bb77598811713\n", 
            "date_created": "2017-07-18 03:25:58.228356+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}