{
    "status": "Invalid", 
    "last_updated": "2013-04-01 13:52:17.348528+00:00", 
    "description": "Spawn assumes there is at least one network interface defines when making this call in nova.virt.powervm.operator:\n\nmac = network_info[0]['address']\n\nSuggest to check for network_info length and default slot id to 5 (which is in the allowed range in powervm) in that scenario.\n\nvirtual_eth_mac_base_value should also be defaulted to None in lpar definition, this will let VIOS generate a mac for the interface\n\nCurrent code:\n\n        mac = network_info[0]['address']\n        mac_base_value = (mac[:-2]).replace(':', '')\n        eth_id = self._operator.get_virtual_eth_adapter_id()\n        slot_id = int(mac[-2:], 16)\n        virtual_eth_adapters = ('%(slot_id)s/0/%(eth_id)s//0/0' %\n                                locals()) \n\nSuggested code:\n\n         slot_id = 5\n        mac_base_value = None\n        eth_id = self._operator.get_virtual_eth_adapter_id()\n\n        if len(network_info) > 0:\n            mac = network_info[0]['address']\n            mac_base_value = (mac[:-2]).replace(':', '')        \n            slot_id = int(mac[-2:], 16)\n\n        virtual_eth_adapters = ('%(slot_id)s/0/%(eth_id)s//0/0' %\n                                locals())\n\n\nHere is the stack trace:\n\n2013-03-06 11:28:56.159 ERROR nova.compute.manager [req-49ba4eef-459b-4857-9d43-87b0cb270728 cf62d17147d640fb8d8c2531c1697b66 bef70326d8964d439db1e05ebb27f251] [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda] Instance failed to spawn\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda] Traceback (most recent call last):\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1052, in _spawn\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]     block_device_info)\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/driver.py\", line 103, in spawn\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]     self._powervm.spawn(context, instance, image_meta['id'], network_info)\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 325, in spawn\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]     network_info, host_stats)\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 507, in _create_lpar_instance\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]     mac = network_info[0]['address']\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda] IndexError: list index out of range\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]\n2013-03-06 11:28:58.187 ERROR nova.compute.manager [req-49ba4eef-459b-4857-9d43-87b0cb270728 cf62d17147d640fb8d8c2531c1697b66 bef70326d8964d439db1e05ebb27f251] [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda] Error: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 775, in _run_instance\\n    injected_files, admin_password)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1052, in _spawn\\n    block_device_info)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/driver.py\", line 103, in spawn\\n    self._powervm.spawn(context, instance, image_meta[\\'id\\'], network_info)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 325, in spawn\\n    network_info, host_stats)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 507, in _create_lpar_instance\\n    mac = network_info[0][\\'address\\']\\n', 'IndexError: list index out of range\\n']", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1154175", 
    "owner": "https://api.launchpad.net/1.0/~flwang", 
    "id": 1154175, 
    "index": 4776, 
    "openned": "2013-03-12 16:10:07.574150+00:00", 
    "created": "2013-03-12 16:10:07.574150+00:00", 
    "title": "Powervm spawn fails with index out of range when network is not set", 
    "comments": [
        {
            "content": "Spawn assumes there is at least one network interface defines when making this call in nova.virt.powervm.operator:\n\nmac = network_info[0]['address']\n\nSuggest to check for network_info length and default slot id to 5 (which is in the allowed range in powervm) in that scenario.\n\nvirtual_eth_mac_base_value should also be defaulted to None in lpar definition, this will let VIOS generate a mac for the interface\n\nCurrent code:\n\n        mac = network_info[0]['address']\n        mac_base_value = (mac[:-2]).replace(':', '')\n        eth_id = self._operator.get_virtual_eth_adapter_id()\n        slot_id = int(mac[-2:], 16)\n        virtual_eth_adapters = ('%(slot_id)s/0/%(eth_id)s//0/0' %\n                                locals()) \n\nSuggested code:\n\n         slot_id = 5\n        mac_base_value = None\n        eth_id = self._operator.get_virtual_eth_adapter_id()\n\n        if len(network_info) > 0:\n            mac = network_info[0]['address']\n            mac_base_value = (mac[:-2]).replace(':', '')        \n            slot_id = int(mac[-2:], 16)\n\n        virtual_eth_adapters = ('%(slot_id)s/0/%(eth_id)s//0/0' %\n                                locals())\n\n\nHere is the stack trace:\n\n2013-03-06 11:28:56.159 ERROR nova.compute.manager [req-49ba4eef-459b-4857-9d43-87b0cb270728 cf62d17147d640fb8d8c2531c1697b66 bef70326d8964d439db1e05ebb27f251] [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda] Instance failed to spawn\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda] Traceback (most recent call last):\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1052, in _spawn\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]     block_device_info)\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/driver.py\", line 103, in spawn\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]     self._powervm.spawn(context, instance, image_meta['id'], network_info)\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 325, in spawn\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]     network_info, host_stats)\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 507, in _create_lpar_instance\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]     mac = network_info[0]['address']\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda] IndexError: list index out of range\n2013-03-06 11:28:56.159 7940 TRACE nova.compute.manager [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda]\n2013-03-06 11:28:58.187 ERROR nova.compute.manager [req-49ba4eef-459b-4857-9d43-87b0cb270728 cf62d17147d640fb8d8c2531c1697b66 bef70326d8964d439db1e05ebb27f251] [instance: c0e0880f-5a54-4da8-93cb-67e36747dcda] Error: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 775, in _run_instance\\n    injected_files, admin_password)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1052, in _spawn\\n    block_device_info)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/driver.py\", line 103, in spawn\\n    self._powervm.spawn(context, instance, image_meta[\\'id\\'], network_info)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 325, in spawn\\n    network_info, host_stats)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 507, in _create_lpar_instance\\n    mac = network_info[0][\\'address\\']\\n', 'IndexError: list index out of range\\n']", 
            "date_created": "2013-03-12 16:10:07.574150+00:00", 
            "author": "https://api.launchpad.net/1.0/~dperaza"
        }, 
        {
            "content": "In the code sample above, why is an ethernet adapter being created if no network is attached?", 
            "date_created": "2013-03-14 01:07:32.567259+00:00", 
            "author": "https://api.launchpad.net/1.0/~mjfork"
        }, 
        {
            "content": "I think it's necessary since the IP address of the new instance can be configured manually or with a floating IP. I have tested the fix, it works on my dev env, so I'm going to submit a code review.", 
            "date_created": "2013-03-14 14:47:39.818913+00:00", 
            "author": "https://api.launchpad.net/1.0/~flwang"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/24446", 
            "date_created": "2013-03-14 15:26:32.498493+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Based on the code review comments, I think this debug is invalid.", 
            "date_created": "2013-04-01 13:52:16.704330+00:00", 
            "author": "https://api.launchpad.net/1.0/~flwang"
        }
    ], 
    "closed": "2013-04-01 06:39:27.698728+00:00"
}