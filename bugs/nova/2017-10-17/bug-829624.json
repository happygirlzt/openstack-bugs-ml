{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 12:59:11.353723+00:00", 
    "description": "Recent changes were made to utils/to_primitive to support classes/instances, but json still trips up over things like built-ins, modules, etc.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/829624", 
    "owner": "https://api.launchpad.net/1.0/~sandy-walsh", 
    "id": 829624, 
    "index": 3519, 
    "openned": "2011-08-19 16:34:03.437569+00:00", 
    "created": "2011-08-19 16:34:03.437569+00:00", 
    "title": "utils.to_primitive still tripping up on some objects ...", 
    "comments": [
        {
            "content": "Recent changes were made to utils/to_primitive to support classes/instances, but json still trips up over things like built-ins, modules, etc.", 
            "date_created": "2011-08-19 16:34:03.437569+00:00", 
            "author": "https://api.launchpad.net/1.0/~sandy-walsh"
        }, 
        {
            "content": "Seems like \"all\" is causing grief, although it is handled by inspect.isbuiltin()\n\nI think the \"ERROR\" part of this trace is a different issue.\n\n2011-08-27 03:05:24,701 ERROR nova.exception [-] Problem '<built-in function all> is not JSON serializable' attempting to send to notification system.\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/notifier/api.py\", line 95, in notify\n(nova.exception): TRACE:     driver.notify(msg)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/notifier/rabbit_notifier.py\", line 36, in notify\n(nova.exception): TRACE:     rpc.cast(context, topic, message)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/__init__.py\", line 58, in cast\n(nova.exception): TRACE:     return RPCIMPL.cast(context, topic, msg)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/amqp.py\", line 539, in cast\n(nova.exception): TRACE:     publisher.send(msg)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/messaging.py\", line 758, in send\n(nova.exception): TRACE:     serializer=serializer)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/messaging.py\", line 687, in create_message\n(nova.exception): TRACE:     serializer=serializer)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/carrot/serialization.py\", line 144, in encode\n(nova.exception): TRACE:     payload = encoder(data)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/anyjson/__init__.py\", line 123, in <lambda>\n(nova.exception): TRACE:     serialize = lambda value: implementation.serialize(value)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/anyjson/__init__.py\", line 85, in serialize\n(nova.exception): TRACE:     raise TypeError(*exc.args)\n(nova.exception): TRACE: TypeError: <built-in function all> is not JSON serializable\n(nova.exception): TRACE: \n2011-08-27 03:05:24,760 ERROR nova [-] Exception during message handling\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/amqp.py\", line 230, in _process_data\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 98, in wrapped\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 459, in run_instance\n(nova): TRACE:     self._run_instance(context, instance_id, **kwargs)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 414, in _run_instance\n(nova): TRACE:     instance, vpn=is_vpn)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/api.py\", line 156, in allocate_for_instance\n(nova): TRACE:     'args': args})\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/__init__.py\", line 54, in call\n(nova): TRACE:     return RPCIMPL.call(context, topic, msg)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/amqp.py\", line 527, in call\n(nova): TRACE:     rv = list(rv)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/amqp.py\", line 516, in wait\n(nova): TRACE:     raise result\n(nova): TRACE: RemoteError: AttributeError 'NoneType' object has no attribute '_keymap'\n(nova): TRACE: [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/rpc/amqp.py\", line 230, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 439, in allocate_for_instance\\n    networks, vpn=vpn)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 900, in _allocate_fixed_ips_hack\\n    self.allocate_fixed_ip(context, instance_id, nw)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 621, in allocate_fixed_ip\\n    instance_id)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 342, in fixed_ip_associate_pool\\n    instance_id, host)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 99, in wrapper\\n    return f(*args, **kwargs)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 686, in fixed_ip_associate_pool\\n    with_lockmode(\\'update\\').\\\\\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1496, in first\\n    ret = list(self[0:1])\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1405, in __getitem__\\n    return list(res)\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1669, in instances\\n    fetch = cursor.fetchall()\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 2383, in fetchall\\n    l = self.process_rows(self._fetchall_impl())\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 2366, in process_rows\\n    keymap = metadata._keymap\\n', u\"AttributeError: 'NoneType' object has no attribute '_keymap'\\n\"]\n", 
            "date_created": "2011-08-29 17:27:12.493092+00:00", 
            "author": "https://api.launchpad.net/1.0/~sandy-walsh"
        }
    ], 
    "closed": "2011-09-22 12:59:10.047164+00:00"
}