{
    "status": "Invalid", 
    "last_updated": "2014-10-06 20:58:25.825055+00:00", 
    "description": "I'm not exactly sure how to reproduce the problem.\nIn my case, one (out of two) compute nodes crashed, leaving a few instances listed which needed replacing.\n\nFirst the old instances was deleted, but it's still hanging around in the list since that compute node was crashed.\nThen released the floating ip via the horizon interface, and assigned it via nova client.\n\nWhile deleting and re-assigning floating ip's to new instances, something got set wrong. Which now result in floating ip's being broken for that tenant.\n\n```\nnova --os-tenant-name API floating-ip-list\nERROR: The resource could not be found. (HTTP 404) (Request-ID: req-9c6165ab-6312-4b98-8cf7-9ebc5d067e7c)\n```\n\nThe log from nova-api shows:\n\n```\n2013-01-22 10:20:21 ERROR nova.api.openstack [req-9c6165ab-6312-4b98-8cf7-9ebc5d067e7c 4629023da94042e5ab9b1fab79ddc2ce ab3f2999ea354cb2a1b8cd7d3066abf0] Caught error: Instance 10502b84-3d5d-459a-ab97-de762ac48a49 could not be found.\n2013-01-22 10:20:21 TRACE nova.api.openstack Traceback (most recent call last):\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 78, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1086, in get_response\n2013-01-22 10:20:21 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1055, in call_application\n2013-01-22 10:20:21 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/keystone/middleware/auth_token.py\", line 278, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 210, in call_func\n2013-01-22 10:20:21 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 885, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     content_type, body, accept)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 933, in _process_stack\n2013-01-22 10:20:21 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1021, in dispatch\n2013-01-22 10:20:21 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/floating_ips.py\", line 158, in index\n2013-01-22 10:20:21 TRACE nova.api.openstack     self._set_metadata(context, floating_ip)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/floating_ips.py\", line 130, in _set_metadata\n2013-01-22 10:20:21 TRACE nova.api.openstack     instance_uuid)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/floating_ips.py\", line 118, in _get_instance\n2013-01-22 10:20:21 TRACE nova.api.openstack     return self.compute_api.get(context, instance_id)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1018, in get\n2013-01-22 10:20:21 TRACE nova.api.openstack     instance = self.db.instance_get_by_uuid(context, instance_id)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 576, in instance_get_by_uuid\n2013-01-22 10:20:21 TRACE nova.api.openstack     return IMPL.instance_get_by_uuid(context, uuid)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n2013-01-22 10:20:21 TRACE nova.api.openstack     return f(*args, **kwargs)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1501, in instance_get_by_uuid\n2013-01-22 10:20:21 TRACE nova.api.openstack     raise exception.InstanceNotFound(instance_id=uuid)\n2013-01-22 10:20:21 TRACE nova.api.openstack InstanceNotFound: Instance 10502b84-3d5d-459a-ab97-de762ac48a49 could not be found.\n2013-01-22 10:20:21 TRACE nova.api.openstack \n2013-01-22 10:20:21 INFO nova.api.openstack [req-9c6165ab-6312-4b98-8cf7-9ebc5d067e7c 4629023da94042e5ab9b1fab79ddc2ce ab3f2999ea354cb2a1b8cd7d3066abf0] http://10.0.1.203:8774/v2/ab3f2999ea354cb2a1b8cd7d3066abf0/os-floating-ips returned with HTTP 404\n2013-01-22 10:20:21 INFO nova.osapi_compute.wsgi.server [req-9c6165ab-6312-4b98-8cf7-9ebc5d067e7c 4629023da94042e5ab9b1fab79ddc2ce ab3f2999ea354cb2a1b8cd7d3066abf0] 10.0.1.50 - - [22/Jan/2013 10:20:21] \"GET /v2/ab3f2999ea354cb2a1b8cd7d3066abf0/os-floating-ips HTTP/1.1\" 404 272 0.534521\n```\n\n\nMaybe floating ip's assigned to non-existing instances can be reclaimed somehow without poking in the database?", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 36, 
    "link": "https://bugs.launchpad.net/nova/+bug/1102886", 
    "owner": "https://api.launchpad.net/1.0/~ashwini-mhatre", 
    "id": 1102886, 
    "index": 3211, 
    "openned": "2013-01-22 09:32:46.572056+00:00", 
    "created": "2013-01-22 09:32:46.572056+00:00", 
    "title": "nova API returns 404 for floating-ip-list if an instance has disappeared", 
    "comments": [
        {
            "content": "I'm not exactly sure how to reproduce the problem.\nIn my case, one (out of two) compute nodes crashed, leaving a few instances listed which needed replacing.\n\nFirst the old instances was deleted, but it's still hanging around in the list since that compute node was crashed.\nThen released the floating ip via the horizon interface, and assigned it via nova client.\n\nWhile deleting and re-assigning floating ip's to new instances, something got set wrong. Which now result in floating ip's being broken for that tenant.\n\n```\nnova --os-tenant-name API floating-ip-list\nERROR: The resource could not be found. (HTTP 404) (Request-ID: req-9c6165ab-6312-4b98-8cf7-9ebc5d067e7c)\n```\n\nThe log from nova-api shows:\n\n```\n2013-01-22 10:20:21 ERROR nova.api.openstack [req-9c6165ab-6312-4b98-8cf7-9ebc5d067e7c 4629023da94042e5ab9b1fab79ddc2ce ab3f2999ea354cb2a1b8cd7d3066abf0] Caught error: Instance 10502b84-3d5d-459a-ab97-de762ac48a49 could not be found.\n2013-01-22 10:20:21 TRACE nova.api.openstack Traceback (most recent call last):\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/__init__.py\", line 78, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1086, in get_response\n2013-01-22 10:20:21 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1055, in call_application\n2013-01-22 10:20:21 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/keystone/middleware/auth_token.py\", line 278, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 210, in call_func\n2013-01-22 10:20:21 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 885, in __call__\n2013-01-22 10:20:21 TRACE nova.api.openstack     content_type, body, accept)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 933, in _process_stack\n2013-01-22 10:20:21 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 1021, in dispatch\n2013-01-22 10:20:21 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/floating_ips.py\", line 158, in index\n2013-01-22 10:20:21 TRACE nova.api.openstack     self._set_metadata(context, floating_ip)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/floating_ips.py\", line 130, in _set_metadata\n2013-01-22 10:20:21 TRACE nova.api.openstack     instance_uuid)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/floating_ips.py\", line 118, in _get_instance\n2013-01-22 10:20:21 TRACE nova.api.openstack     return self.compute_api.get(context, instance_id)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1018, in get\n2013-01-22 10:20:21 TRACE nova.api.openstack     instance = self.db.instance_get_by_uuid(context, instance_id)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 576, in instance_get_by_uuid\n2013-01-22 10:20:21 TRACE nova.api.openstack     return IMPL.instance_get_by_uuid(context, uuid)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n2013-01-22 10:20:21 TRACE nova.api.openstack     return f(*args, **kwargs)\n2013-01-22 10:20:21 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1501, in instance_get_by_uuid\n2013-01-22 10:20:21 TRACE nova.api.openstack     raise exception.InstanceNotFound(instance_id=uuid)\n2013-01-22 10:20:21 TRACE nova.api.openstack InstanceNotFound: Instance 10502b84-3d5d-459a-ab97-de762ac48a49 could not be found.\n2013-01-22 10:20:21 TRACE nova.api.openstack \n2013-01-22 10:20:21 INFO nova.api.openstack [req-9c6165ab-6312-4b98-8cf7-9ebc5d067e7c 4629023da94042e5ab9b1fab79ddc2ce ab3f2999ea354cb2a1b8cd7d3066abf0] http://10.0.1.203:8774/v2/ab3f2999ea354cb2a1b8cd7d3066abf0/os-floating-ips returned with HTTP 404\n2013-01-22 10:20:21 INFO nova.osapi_compute.wsgi.server [req-9c6165ab-6312-4b98-8cf7-9ebc5d067e7c 4629023da94042e5ab9b1fab79ddc2ce ab3f2999ea354cb2a1b8cd7d3066abf0] 10.0.1.50 - - [22/Jan/2013 10:20:21] \"GET /v2/ab3f2999ea354cb2a1b8cd7d3066abf0/os-floating-ips HTTP/1.1\" 404 272 0.534521\n```\n\n\nMaybe floating ip's assigned to non-existing instances can be reclaimed somehow without poking in the database?", 
            "date_created": "2013-01-22 09:32:46.572056+00:00", 
            "author": "https://api.launchpad.net/1.0/~balboah"
        }, 
        {
            "content": "So these are also broken, returning 404:\n\nnova --os-tenant-name API remove-floating-ip 10502b84-3d5d-459a-ab97-de762ac48a49 10.101.100.22\n\nnova --os-tenant-name API floating-ip-delete 10.101.100.22", 
            "date_created": "2013-01-22 09:38:01.967944+00:00", 
            "author": "https://api.launchpad.net/1.0/~balboah"
        }, 
        {
            "content": "This made it work again:\n\nnova-manage floating delete --ip_range=10.101.100.22\nnova-manage floating create --ip_range=10.101.100.22", 
            "date_created": "2013-01-22 09:41:14.228460+00:00", 
            "author": "https://api.launchpad.net/1.0/~balboah"
        }, 
        {
            "content": "I was able to reproduce this issue. This happens when:\n1. Associate floating IP with running instance.\n2. Terminate instances from step 2.\n3. list floating ips.\n\nSeems like when you terminating the instances, floating ip not being released and still links to the terminated server.\n\nTraceback attached.", 
            "date_created": "2013-02-13 17:13:37.128524+00:00", 
            "author": "https://api.launchpad.net/1.0/~igor-scalr"
        }, 
        {
            "content": "What version is this? I believe this is working in Trunk and stable/folsom", 
            "date_created": "2013-02-26 22:44:16.169444+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Hi. Any chance you can let us know what version you experienced this problem with? Thanks!", 
            "date_created": "2013-03-10 23:51:42.535889+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "This was with Folsom on ubuntu 12.04 using the ubuntu packages from http://ubuntu-cloud.archive.canonical.com/ubuntu precise-updates/folsom.\nNot sure which minor version it was as I just upgraded to the latest", 
            "date_created": "2013-03-11 15:51:18.230533+00:00", 
            "author": "https://api.launchpad.net/1.0/~balboah"
        }, 
        {
            "content": "In my case it was: Folsom 2012.2.2", 
            "date_created": "2013-03-11 16:14:43.891651+00:00", 
            "author": "https://api.launchpad.net/1.0/~igor-scalr"
        }, 
        {
            "content": "I tried to reproduce this bug but in my case the floating ip's I am assigning to server are getting released as soon as I delete the VM.\nSo can anyone suggest some other way to reproduce this bug?\n", 
            "date_created": "2014-02-26 11:55:08.474139+00:00", 
            "author": "https://api.launchpad.net/1.0/~ashwini-mhatre"
        }, 
        {
            "content": "Honestly, I'm pretty sure we managed to kill this bug. Please reopen if you see it still crop up.", 
            "date_created": "2014-09-15 12:08:52.377304+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "FYI for anyone who stumbles upon this page after searching for the error message like I did...\n\nWe ran into this issue in one of our environments where we're still running an old version of nova (2012.1.3).  Normally this version takes care of releasing a floating IP when its associated instance is terminated, but in our case, the compute node running the instance crashed.\n\nThe solution was to manually release the fixed and floating IPs in the database.", 
            "date_created": "2014-10-06 20:58:24.860935+00:00", 
            "author": "https://api.launchpad.net/1.0/~cburkett"
        }
    ], 
    "closed": "2014-09-15 12:08:31.050474+00:00"
}