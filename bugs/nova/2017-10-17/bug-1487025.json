{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:58:47.628775+00:00", 
    "description": "I saw this in a failed jenkins run with neutron:\n\nhttp://logs.openstack.org/82/200382/6/check/gate-tempest-dsvm-neutron-full/cd9bfaa/logs/screen-n-cpu.txt.gz?level=TRACE#_2015-08-20_12_36_06_873\n\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     executor_callback))\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     executor_callback)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/exception.py\", line 89, in wrapped\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     payload)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 119, in __exit__\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/exception.py\", line 72, in wrapped\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 6310, in external_instance_event\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     self.network_api.get_instance_nw_info(context, instance)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/base_api.py\", line 244, in get_instance_nw_info\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     result = self._get_instance_nw_info(context, instance, **kwargs)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/neutronv2/api.py\", line 873, in _get_instance_nw_info\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     compute_utils.refresh_info_cache_for_instance(context, instance)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/utils.py\", line 356, in refresh_info_cache_for_instance\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     instance.info_cache.refresh()\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 195, in wrapper\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     ctxt, self, fn.__name__, args, kwargs)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/conductor/rpcapi.py\", line 248, in object_action\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     objmethod=objmethod, args=args, kwargs=kwargs)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     retry=retry)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 422, in _send\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     raise result\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher InstanceInfoCacheNotFound_Remote: Info cache for instance d9b950aa-be7c-40bd-93b4-d4d575ebdace could not be found.\n\nBasically, the instance is deleted before the event is processed:\n\nhttp://logs.openstack.org/82/200382/6/check/gate-tempest-dsvm-neutron-full/cd9bfaa/logs/screen-n-cpu.txt.gz#_2015-08-20_12_36_06_097\n\nhttp://logs.openstack.org/82/200382/6/check/gate-tempest-dsvm-neutron-full/cd9bfaa/logs/screen-n-cpu.txt.gz#_2015-08-20_12_36_06_795\n\nAnd things fail.\n\nWe should handle 404 type errors in the compute manager's external_instance_event method so that we don't fail to process all events when one fails in the loop.", 
    "tags": [
        "compute", 
        "network"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1487025", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1487025, 
    "index": 4328, 
    "openned": "2015-08-20 13:09:19.948401+00:00", 
    "created": "2015-08-20 13:09:19.948401+00:00", 
    "title": "network-changed external_instance_event fails and traces hard if InstanceInfoCacheNotFound", 
    "comments": [
        {
            "content": "I saw this in a failed jenkins run with neutron:\n\nhttp://logs.openstack.org/82/200382/6/check/gate-tempest-dsvm-neutron-full/cd9bfaa/logs/screen-n-cpu.txt.gz?level=TRACE#_2015-08-20_12_36_06_873\n\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     executor_callback))\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     executor_callback)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/exception.py\", line 89, in wrapped\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     payload)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 119, in __exit__\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/exception.py\", line 72, in wrapped\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 6310, in external_instance_event\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     self.network_api.get_instance_nw_info(context, instance)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/base_api.py\", line 244, in get_instance_nw_info\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     result = self._get_instance_nw_info(context, instance, **kwargs)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/network/neutronv2/api.py\", line 873, in _get_instance_nw_info\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     compute_utils.refresh_info_cache_for_instance(context, instance)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/utils.py\", line 356, in refresh_info_cache_for_instance\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     instance.info_cache.refresh()\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 195, in wrapper\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     ctxt, self, fn.__name__, args, kwargs)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/conductor/rpcapi.py\", line 248, in object_action\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     objmethod=objmethod, args=args, kwargs=kwargs)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     retry=retry)\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 422, in _send\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher     raise result\n2015-08-20 12:36:06.873 9235 ERROR oslo_messaging.rpc.dispatcher InstanceInfoCacheNotFound_Remote: Info cache for instance d9b950aa-be7c-40bd-93b4-d4d575ebdace could not be found.\n\nBasically, the instance is deleted before the event is processed:\n\nhttp://logs.openstack.org/82/200382/6/check/gate-tempest-dsvm-neutron-full/cd9bfaa/logs/screen-n-cpu.txt.gz#_2015-08-20_12_36_06_097\n\nhttp://logs.openstack.org/82/200382/6/check/gate-tempest-dsvm-neutron-full/cd9bfaa/logs/screen-n-cpu.txt.gz#_2015-08-20_12_36_06_795\n\nAnd things fail.\n\nWe should handle 404 type errors in the compute manager's external_instance_event method so that we don't fail to process all events when one fails in the loop.", 
            "date_created": "2015-08-20 13:09:19.948401+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/215170", 
            "date_created": "2015-08-20 14:57:14.483522+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/215170\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=402b7efebb2cf9ce7759eb6b9c7e0cfaa7deb0e5\nSubmitter: Jenkins\nBranch:    master\n\ncommit 402b7efebb2cf9ce7759eb6b9c7e0cfaa7deb0e5\nAuthor: Matt Riedemann <email address hidden>\nDate:   Thu Aug 20 07:01:32 2015 -0700\n\n    Handle NotFound exceptions while processing network-changed events\n    \n    We could be getting a network-changed event from neutron in the case\n    that something is being torn down on the networking side, in which case\n    we're in a race on the nova side since we're probably deleting the\n    instance and it's network info_cache.\n    \n    We should handle NotFound exceptions in that case so that we don't stop\n    looping over all events and fail to process any others that come after\n    that network-changed event.\n    \n    Closes-Bug: #1487025\n    \n    Change-Id: Icbc4ed9776de710c0102cf411f5c9808c1a05e83\n", 
            "date_created": "2015-08-22 15:43:44.601513+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-09-03 11:45:56.499063+00:00"
}