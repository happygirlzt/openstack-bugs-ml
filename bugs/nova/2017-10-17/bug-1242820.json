{
    "status": "Invalid", 
    "last_updated": "2014-10-24 19:34:43.726799+00:00", 
    "description": "Using the nova virt docker driver and when I try to deploy an instance I get:\n\n2013-10-21 12:18:39.229 20636 ERROR nova.compute.manager [req-270deff8-b0dc-4a05-9923-417dc5b662db c99d13095fbd4605b36a802fd9539a4a a03677565e97495fa798fe6cd2628180] [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd] Error: 'Message' object has no attribute 'format'\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd] Traceback (most recent call last):\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1045, in _build_instance\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     set_access_ip=set_access_ip)\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1444, in _spawn\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     LOG.exception(_('Instance failed to spawn'), instance=instance)\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1430, in _spawn\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     block_device_info)\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/virt/docker/driver.py\", line 297, in spawn\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     LOG.info(msg.format(image_name))\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/gettextutils.py\", line 255, in __getattribute__\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     return UserString.UserString.__getattribute__(self, name)\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd] AttributeError: 'Message' object has no attribute 'format'\n\nOn a boot VM flow.\n\nBased on a tiny bit of poking it appears there is a common gettextutils method to wrapper message/string access which does not account for the use of Message.format() as used in the docker virt driver.\n\nHonestly based on the code I'm running I'm not sure how spawn worked at all for docker as the use of Message.format() is in the boot codepath:\n\n296             msg = _('Image name \"{0}\" does not exist, fetching it...')\n297             LOG.info(msg.format(image_name))\n\nThis always triggers the no attr message.\n\nI'm not up to speed on the gettextutils wrapper, but I hacked around this by adding 'format' to the list of ops in gettextutils.py:\n\n\n     def __getattribute__(self, name):\n243         # NOTE(mrodden): handle lossy operations that we can't deal with yet\n244         # These override the UserString implementation, since UserString\n245         # uses our __class__ attribute to try and build a new message\n246         # after running the inner data string through the operation.\n247         # At that point, we have lost the gettext message id and can just\n248         # safely resolve to a string instead.\n249         ops = ['capitalize', 'center', 'decode', 'encode',\n250                'expandtabs', 'ljust', 'lstrip', 'replace', 'rjust', 'rstrip',\n251                'strip', 'swapcase', 'title', 'translate', 'upper', 'zfill', 'format']\n252         if name in ops:\n253             return getattr(self.data, name)\n254         else:\n255             return UserString.UserString.__getattribute__(self, name)", 
    "tags": [
        "docker"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1242820", 
    "owner": "None", 
    "id": 1242820, 
    "index": 5480, 
    "openned": "2013-10-21 18:17:28.214792+00:00", 
    "created": "2013-10-21 18:17:28.214792+00:00", 
    "title": "Nova docker virt driver triggers - AttributeError: 'Message' object has no attribute 'format'", 
    "comments": [
        {
            "content": "Using the nova virt docker driver and when I try to deploy an instance I get:\n\n2013-10-21 12:18:39.229 20636 ERROR nova.compute.manager [req-270deff8-b0dc-4a05-9923-417dc5b662db c99d13095fbd4605b36a802fd9539a4a a03677565e97495fa798fe6cd2628180] [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd] Error: 'Message' object has no attribute 'format'\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd] Traceback (most recent call last):\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1045, in _build_instance\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     set_access_ip=set_access_ip)\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1444, in _spawn\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     LOG.exception(_('Instance failed to spawn'), instance=instance)\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1430, in _spawn\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     block_device_info)\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/virt/docker/driver.py\", line 297, in spawn\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     LOG.info(msg.format(image_name))\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/gettextutils.py\", line 255, in __getattribute__\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd]     return UserString.UserString.__getattribute__(self, name)\n2013-10-21 12:18:39.229 20636 TRACE nova.compute.manager [instance: 206bb110-4fa5-4999-be87-9b10951ad5dd] AttributeError: 'Message' object has no attribute 'format'\n\nOn a boot VM flow.\n\nBased on a tiny bit of poking it appears there is a common gettextutils method to wrapper message/string access which does not account for the use of Message.format() as used in the docker virt driver.\n\nHonestly based on the code I'm running I'm not sure how spawn worked at all for docker as the use of Message.format() is in the boot codepath:\n\n296             msg = _('Image name \"{0}\" does not exist, fetching it...')\n297             LOG.info(msg.format(image_name))\n\nThis always triggers the no attr message.\n\nI'm not up to speed on the gettextutils wrapper, but I hacked around this by adding 'format' to the list of ops in gettextutils.py:\n\n\n     def __getattribute__(self, name):\n243         # NOTE(mrodden): handle lossy operations that we can't deal with yet\n244         # These override the UserString implementation, since UserString\n245         # uses our __class__ attribute to try and build a new message\n246         # after running the inner data string through the operation.\n247         # At that point, we have lost the gettext message id and can just\n248         # safely resolve to a string instead.\n249         ops = ['capitalize', 'center', 'decode', 'encode',\n250                'expandtabs', 'ljust', 'lstrip', 'replace', 'rjust', 'rstrip',\n251                'strip', 'swapcase', 'title', 'translate', 'upper', 'zfill', 'format']\n252         if name in ops:\n253             return getattr(self.data, name)\n254         else:\n255             return UserString.UserString.__getattribute__(self, name)", 
            "date_created": "2013-10-21 18:17:28.214792+00:00", 
            "author": "https://api.launchpad.net/1.0/~boden"
        }, 
        {
            "content": "It would be better to change the log call to \n\n    msg = _('Image name \"%s\" does not exist, fetching it...')\n    LOG.info(msg, image_name)\n\nbecause that delays both the translation and the string interpolation until the log message is actually going to be emitted.\n", 
            "date_created": "2013-10-21 21:27:49.064616+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }, 
        {
            "content": "nova doesn't have a docker driver currently.", 
            "date_created": "2014-07-11 17:19:28.278510+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "I suspect we omitted this on purpose because we didn't want to have to support multiple methods of formatting strings, which is a little tricky to do for lazy translation because you have to store all of the parameters too so they can be lazily translated if necessary.  Also, as Doug noted the code that originally triggered this doesn't follow logging best practices anyway and should be changed.\n\nI'm going to close as won't-fix for the reasons above, but if anyone disagrees or finds a situation where this is absolutely needed then please feel free to reopen (or ping an Oslo person to reopen).", 
            "date_created": "2014-10-14 17:23:08.764521+00:00", 
            "author": "https://api.launchpad.net/1.0/~bnemec"
        }, 
        {
            "content": "Duh, looks like current code looks like this\n\n        msg = 'Image name \"%s\" does not exist, fetching it...'\n        LOG.debug(msg % image_meta['name'])\n\nSo marking as fixed.", 
            "date_created": "2014-10-14 18:01:27.124336+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/128376\nCommitted: https://git.openstack.org/cgit/stackforge/nova-docker/commit/?id=7c2f3c9ebb56974a453a6d7c34f0a2f0c98f4658\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7c2f3c9ebb56974a453a6d7c34f0a2f0c98f4658\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Thu Oct 23 08:43:48 2014 -0400\n\n    Fix LOG formatting and defer until emit\n    \n    Formatting could and should be deferred until logs are emitted.\n    Boden Russell found a bug where bad formatting practice resulted in\n    a developer calling format() on the output of a gettextutils call.\n    \n    Here, we standardize the debugging output in a saner, cleaner way as\n    recommended by Doug Hellmann.\n    \n    Closes-Bug: #1242820\n    \n    Change-Id: I259a435466d394c7d009f8ba2e976713f3fb4343\n", 
            "date_created": "2014-10-24 19:34:42.442415+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-07-11 17:19:34.041007+00:00"
}