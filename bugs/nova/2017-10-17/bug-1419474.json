{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:24:20.612909+00:00", 
    "description": "Steps to reproduce:\n* Attach vol-1 to vm-1\n* Change host and datastore of vm-1\n* Detach vol-1 from vm-1\n* Attach vol-1 to vm-1\n\n\n2015-02-04 14:30:21.098 DEBUG oslo.vmware.exceptions [-] Fault InvalidArgument not matched. from (pid=21418) get_fault_class /usr/local/lib/python2.7/dist-packages/oslo/vmware/exceptions.py:249\n2015-02-04 14:30:21.098 ERROR oslo.vmware.common.loopingcall [-] in fixed duration looping call\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall Traceback (most recent call last):\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/common/loopingcall.py\", line 76, in _inner\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall     self.f(*self.args, **self.kw)\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/api.py\", line 424, in _poll_task\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall     raise task_ex\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall VMwareDriverException: A specified parameter was not correct.\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall config.extraConfig[\"volume-e375857b-5b8f-409a-9303-db6d33956fe1\"]\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall\n2015-02-04 14:30:21.099 ERROR nova.virt.block_device [req-737b0e79-f91d-41b4-96f0-7449251545b9 admin demo] [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] Driver failed to attach volume e375857b-5b8f-409a-9303-db6d33956fe1 at /dev/sdb\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] Traceback (most recent call last):\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/block_device.py\", line 249, in attach\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     device_type=self['device_type'], encryption=encryption)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 479, in attach_volume\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     return _volumeops.attach_volume(connection_info, instance)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 427, in attach_volume\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     self._attach_volume_vmdk(connection_info, instance)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 395, in _attach_volume_vmdk\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     self._update_volume_details(vm_ref, instance, data['volume_id'])\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 151, in _update_volume_details \n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     vm_util.reconfigure_vm(self._session, vm_ref, extra_config_specs)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/vm_util.py\", line 1625, in reconfigure_vm\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     session._wait_for_task(reconfig_task)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 668, in _wait_for_task\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     return self.wait_for_task(task_ref)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/api.py\", line 387, in wait_for_task \n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     return evt.wait()\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     return hubs.get_hub().switch()\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 293, in switch\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/common/loopingcall.py\", line 76, in _inner\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     self.f(*self.args, **self.kw)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/api.py\", line 424, in _poll_task\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     raise task_ex\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] VMwareDriverException: A specified parameter was not correct.\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] config.extraConfig[\"volume-e375857b-5b8f-409a-9303-db6d33956fe1\"]\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]\n2015-02-04 14:30:21.100 DEBUG nova.volume.cinder [req-737b0e79-f91d-41b4-96f0-7449251545b9 admin demo] Cinderclient connection created using URL: http://192.168.200.151:8776/v1/4c54a363542f4d899dd48c0d38e46475 from (pid=21418) cinderclient /opt/stack/nova/nova/volume/cinder.py:93\n2015-02-04 14:30:21.167 ERROR nova.compute.manager [req-737b0e79-f91d-41b4-96f0-7449251545b9 admin demo] [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] Failed to attach e375857b-5b8f-409a-9303-db6d33956fe1 at /dev/sdb", 
    "tags": [
        "vmware"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1419474", 
    "owner": "https://api.launchpad.net/1.0/~vbala", 
    "id": 1419474, 
    "index": 1521, 
    "openned": "2015-02-08 17:14:30.214663+00:00", 
    "created": "2015-02-08 17:14:30.214663+00:00", 
    "title": "VMware: Volume attach fails with 'VMwareDriverException: A specified parameter was not correct.'", 
    "comments": [
        {
            "content": "Steps to reproduce:\n* Attach vol-1 to vm-1\n* Change host and datastore of vm-1\n* Detach vol-1 from vm-1\n* Attach vol-1 to vm-1\n\n\n2015-02-04 14:30:21.098 DEBUG oslo.vmware.exceptions [-] Fault InvalidArgument not matched. from (pid=21418) get_fault_class /usr/local/lib/python2.7/dist-packages/oslo/vmware/exceptions.py:249\n2015-02-04 14:30:21.098 ERROR oslo.vmware.common.loopingcall [-] in fixed duration looping call\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall Traceback (most recent call last):\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/common/loopingcall.py\", line 76, in _inner\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall     self.f(*self.args, **self.kw)\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/api.py\", line 424, in _poll_task\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall     raise task_ex\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall VMwareDriverException: A specified parameter was not correct.\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall config.extraConfig[\"volume-e375857b-5b8f-409a-9303-db6d33956fe1\"]\n2015-02-04 14:30:21.098 TRACE oslo.vmware.common.loopingcall\n2015-02-04 14:30:21.099 ERROR nova.virt.block_device [req-737b0e79-f91d-41b4-96f0-7449251545b9 admin demo] [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] Driver failed to attach volume e375857b-5b8f-409a-9303-db6d33956fe1 at /dev/sdb\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] Traceback (most recent call last):\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/block_device.py\", line 249, in attach\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     device_type=self['device_type'], encryption=encryption)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 479, in attach_volume\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     return _volumeops.attach_volume(connection_info, instance)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 427, in attach_volume\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     self._attach_volume_vmdk(connection_info, instance)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 395, in _attach_volume_vmdk\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     self._update_volume_details(vm_ref, instance, data['volume_id'])\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/volumeops.py\", line 151, in _update_volume_details \n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     vm_util.reconfigure_vm(self._session, vm_ref, extra_config_specs)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/vm_util.py\", line 1625, in reconfigure_vm\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     session._wait_for_task(reconfig_task)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 668, in _wait_for_task\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     return self.wait_for_task(task_ref)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/api.py\", line 387, in wait_for_task \n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     return evt.wait()\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     return hubs.get_hub().switch()\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 293, in switch\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/common/loopingcall.py\", line 76, in _inner\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     self.f(*self.args, **self.kw)\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]   File \"/usr/local/lib/python2.7/dist-packages/oslo/vmware/api.py\", line 424, in _poll_task\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]     raise task_ex\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] VMwareDriverException: A specified parameter was not correct.\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] config.extraConfig[\"volume-e375857b-5b8f-409a-9303-db6d33956fe1\"]\n2015-02-04 14:30:21.099 TRACE nova.virt.block_device [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591]\n2015-02-04 14:30:21.100 DEBUG nova.volume.cinder [req-737b0e79-f91d-41b4-96f0-7449251545b9 admin demo] Cinderclient connection created using URL: http://192.168.200.151:8776/v1/4c54a363542f4d899dd48c0d38e46475 from (pid=21418) cinderclient /opt/stack/nova/nova/volume/cinder.py:93\n2015-02-04 14:30:21.167 ERROR nova.compute.manager [req-737b0e79-f91d-41b4-96f0-7449251545b9 admin demo] [instance: 0f756e6b-f8c0-4efc-880e-216ebb943591] Failed to attach e375857b-5b8f-409a-9303-db6d33956fe1 at /dev/sdb", 
            "date_created": "2015-02-08 17:14:30.214663+00:00", 
            "author": "https://api.launchpad.net/1.0/~vbala"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/153878", 
            "date_created": "2015-02-08 17:25:06.673075+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/153878\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=dcff2c7cc96c19ed93520781bded83807290a8a3\nSubmitter: Jenkins\nBranch:    master\n\ncommit dcff2c7cc96c19ed93520781bded83807290a8a3\nAuthor: Vipin Balachandran <email address hidden>\nDate:   Thu Feb 5 15:44:33 2015 +0530\n\n    VMware: Fix disk UUID in instance's extra config\n    \n    During volume attach, the UUID of volume's virtual disk\n    is saved in instance's extra config. The virtual disk is\n    searched by volume's UUID assuming that the disk name\n    contains volume's UUID. But this assumption may not be\n    true always. Once the instance is migrated with an attached\n    volume, the volume's vmdk name changes after volume detach.\n    This patch fixes the problem by using the disk device info\n    of volume instead of searching the virtual disk by volume\n    UUID.\n    \n    Change-Id: Ic3a249dff65e9abafe3986789607a855df4e8481\n    Closes-Bug: #1419474\n", 
            "date_created": "2015-03-20 01:37:01.361635+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-03-20 07:41:20.231237+00:00"
}