{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:42:47.110500+00:00", 
    "description": "Under the xenapi driver, if an image is booted that uses a separate kernel/ramdisk, then the kernel/ramdisk is deleted from the dom0, and then the instance is destroyed through nova, an exception will be raised and the instance will fail to be deleted.\n\n2012-07-09 18:13:31 DEBUG nova.virt.xenapi.connection [req-b8e49927-5868-48ed-86f1-1a175ce886bf admin openstack] Got exception: ['XENAPI_PLUGIN_EXCEPTION', 'remove_kernel_ramdisk', 'OSError', \"[Errno 2] No such file or directory: '/boot/guest/8c32d293-53b5-4eda-b17d-457154678adc'\"] from (pid=31888) _unwrap_plugin_exceptions /home/johannes/openstack/nova/trunk/nova/virt/xenapi/connection.py:616\n2012-07-09 18:13:31 DEBUG nova.openstack.common.rpc.amqp [-] Sending terminate_instance on notifications.error from (pid=31888) notify /home/johannes/openstack/nova/trunk/nova/openstack/common/rpc/amqp.py:409\n2012-07-09 18:13:31 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/openstack/common/rpc/amqp.py\", line 274, in _process_data\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/openstack/common/rpc/dispatcher.py\", line 106, in dispatch\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/exception.py\", line 117, in wrapped\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__  \n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/exception.py\", line 92, in wrapped\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 178, in decorated_function\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     function(self, context, instance_uuid, *args, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 202, in decorated_function\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     sys.exc_info())\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__  \n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 196, in decorated_function\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 787, in terminate_instance\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     do_terminate_instance()\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/utils.py\", line 674, in inner\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     retval = f(*args, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 780, in do_terminate_instance\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self._delete_instance(context, instance)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 757, in _delete_instance\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self._shutdown_instance(context, instance)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 725, in _shutdown_instance\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/connection.py\", line 217, in destroy\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self._vmops.destroy(instance, network_info)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/vmops.py\", line 1082, in destroy\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return self._destroy(instance, vm_ref, network_info)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/vmops.py\", line 1106, in _destroy\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self._destroy_kernel_ramdisk(instance, vm_ref)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/vmops.py\", line 1033, in _destroy_kernel_ramdisk\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     vm_utils.destroy_kernel_ramdisk(self._session, kernel, ramdisk)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/vm_utils.py\", line 625, in destroy_kernel_ramdisk\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     session.call_plugin('kernel', 'remove_kernel_ramdisk', args) \n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/connection.py\", line 605, in call_plugin\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     host, plugin, fn, args)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/connection.py\", line 614, in _unwrap_plugin_exceptions\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return func(*args, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 229, in __call__\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return self.__send(self.__name, args)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 133, in xenapi_request\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     result = _parse_result(getattr(self, methodname)(*full_params))\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 203, in _parse_result\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     raise Failure(result['ErrorDescription'])\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp Failure: ['XENAPI_PLUGIN_EXCEPTION', 'remove_kernel_ramdisk', 'OSError', \"[Errno 2] No such file or directory: '/boot/guest/8c32d293-53b5-4eda-b17d-457154678adc'\"]", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1022681", 
    "owner": "https://api.launchpad.net/1.0/~johannes.erdfelt", 
    "id": 1022681, 
    "index": 4200, 
    "openned": "2012-07-09 18:17:52.134173+00:00", 
    "created": "2012-07-09 18:17:52.134173+00:00", 
    "title": "Instance destroy fails in xenapi driver if kernel/ramdisk images were deleted", 
    "comments": [
        {
            "content": "Under the xenapi driver, if an image is booted that uses a separate kernel/ramdisk, then the kernel/ramdisk is deleted from the dom0, and then the instance is destroyed through nova, an exception will be raised and the instance will fail to be deleted.\n\n2012-07-09 18:13:31 DEBUG nova.virt.xenapi.connection [req-b8e49927-5868-48ed-86f1-1a175ce886bf admin openstack] Got exception: ['XENAPI_PLUGIN_EXCEPTION', 'remove_kernel_ramdisk', 'OSError', \"[Errno 2] No such file or directory: '/boot/guest/8c32d293-53b5-4eda-b17d-457154678adc'\"] from (pid=31888) _unwrap_plugin_exceptions /home/johannes/openstack/nova/trunk/nova/virt/xenapi/connection.py:616\n2012-07-09 18:13:31 DEBUG nova.openstack.common.rpc.amqp [-] Sending terminate_instance on notifications.error from (pid=31888) notify /home/johannes/openstack/nova/trunk/nova/openstack/common/rpc/amqp.py:409\n2012-07-09 18:13:31 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/openstack/common/rpc/amqp.py\", line 274, in _process_data\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/openstack/common/rpc/dispatcher.py\", line 106, in dispatch\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/exception.py\", line 117, in wrapped\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__  \n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/exception.py\", line 92, in wrapped\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 178, in decorated_function\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     function(self, context, instance_uuid, *args, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 202, in decorated_function\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     sys.exc_info())\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/contextlib.py\", line 23, in __exit__  \n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 196, in decorated_function\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 787, in terminate_instance\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     do_terminate_instance()\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/utils.py\", line 674, in inner\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     retval = f(*args, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 780, in do_terminate_instance\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self._delete_instance(context, instance)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 757, in _delete_instance\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self._shutdown_instance(context, instance)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/compute/manager.py\", line 725, in _shutdown_instance\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/connection.py\", line 217, in destroy\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self._vmops.destroy(instance, network_info)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/vmops.py\", line 1082, in destroy\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return self._destroy(instance, vm_ref, network_info)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/vmops.py\", line 1106, in _destroy\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     self._destroy_kernel_ramdisk(instance, vm_ref)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/vmops.py\", line 1033, in _destroy_kernel_ramdisk\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     vm_utils.destroy_kernel_ramdisk(self._session, kernel, ramdisk)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/vm_utils.py\", line 625, in destroy_kernel_ramdisk\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     session.call_plugin('kernel', 'remove_kernel_ramdisk', args) \n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/connection.py\", line 605, in call_plugin\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     host, plugin, fn, args)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/home/johannes/openstack/nova/trunk/nova/virt/xenapi/connection.py\", line 614, in _unwrap_plugin_exceptions\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return func(*args, **kwargs)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 229, in __call__\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     return self.__send(self.__name, args)\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 133, in xenapi_request\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     result = _parse_result(getattr(self, methodname)(*full_params))\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.6/dist-packages/XenAPI.py\", line 203, in _parse_result\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp     raise Failure(result['ErrorDescription'])\n2012-07-09 18:13:31 TRACE nova.openstack.common.rpc.amqp Failure: ['XENAPI_PLUGIN_EXCEPTION', 'remove_kernel_ramdisk', 'OSError', \"[Errno 2] No such file or directory: '/boot/guest/8c32d293-53b5-4eda-b17d-457154678adc'\"]", 
            "date_created": "2012-07-09 18:17:52.134173+00:00", 
            "author": "https://api.launchpad.net/1.0/~johannes.erdfelt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/9533", 
            "date_created": "2012-07-09 18:20:42.835378+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/9533\nCommitted: http://github.com/openstack/nova/commit/a44fbea08315a30dec9ad69f92c95a532ea045c7\nSubmitter: Jenkins\nBranch:    master\n\ncommit a44fbea08315a30dec9ad69f92c95a532ea045c7\nAuthor: Johannes Erdfelt <email address hidden>\nDate:   Mon Jul 9 18:16:23 2012 +0000\n\n    Ignore failure to delete kernel/ramdisk in xenapi driver\n    \n    Fixes bug 1022681\n    \n    If deleting the kernel/ramdisk fails because the files don't exist\n    anymore, then ignore the error and continue. This will ensure that the\n    instance will get destroyed properly even if the files were deleted\n    outside of nova.\n    \n    Change-Id: I5d1f95ea2a6f552c48efbb9e92bb36767df19e34\n", 
            "date_created": "2012-07-09 18:59:42.623436+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-08-16 07:43:20.507347+00:00"
}