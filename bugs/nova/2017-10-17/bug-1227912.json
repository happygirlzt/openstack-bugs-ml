{
    "status": "Invalid", 
    "last_updated": "2015-05-26 16:23:09.264078+00:00", 
    "description": "I set the image metadata to enable qemu guest agent. When I bring up instance it fails to open socket due to permission.\nI observed this with devstack. \n\nHere is more info\n\nnova  image-meta cirros-0.3.1-x86_64-uec set  hw_qemu_guest_agent=yes\n\n2013-09-19 15:21:55.717 ERROR nova.compute.manager [req-be5e6b88-77f8-47d5-974e-85e1f875608a demo demo] [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] Error: internal error process exited while connecting to monitor: char device redirected to /dev/pts/27 (label charserial1)\nqemu-system-x86_64: -chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/org.qemu.guest_agent.0.instance-0000000b.sock,server,nowait: Failed to bind socket: Permission denied\nchardev: opening backend \"socket\" failed\n\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] Traceback (most recent call last):\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1038, in _build_instance\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     set_access_ip=set_access_ip)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1411, in _spawn\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     LOG.exception(_('Instance failed to spawn'), instance=instance)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1408, in _spawn\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     block_device_info)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2071, in spawn\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     block_device_info, context=context)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3214, in _create_domain_and_network\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     \n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3157, in _create_domain\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     \n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3152, in _create_domain\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     except Exception as e:\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 179, in doit\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 139, in proxy_call\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     rv = execute(f,*args,**kwargs)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 77, in tworker\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     rv = meth(*args,**kwargs)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 711, in createWithFlags\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] libvirtError: internal error process exited while connecting to monitor: char device redirected to /dev/pts/27 (label charserial1)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] qemu-system-x86_64: -chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/org.qemu.guest_agent.0.instance-0000000b.sock,server,nowait: Failed to bind socket: Permission denied\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] chardev: opening backend \"socket\" failed\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] \n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]", 
    "tags": [
        "libvirt", 
        "patch"
    ], 
    "importance": "Undecided", 
    "heat": 44, 
    "link": "https://bugs.launchpad.net/nova/+bug/1227912", 
    "owner": "None", 
    "id": 1227912, 
    "index": 5371, 
    "openned": "2013-09-19 22:27:25.544398+00:00", 
    "created": "2013-09-19 22:27:25.544398+00:00", 
    "title": "instance fails to boot with qemu guest agent set in image metadata", 
    "comments": [
        {
            "content": "I set the image metadata to enable qemu guest agent. When I bring up instance it fails to open socket due to permission.\nI observed this with devstack. \n\nHere is more info\n\nnova  image-meta cirros-0.3.1-x86_64-uec set  hw_qemu_guest_agent=yes\n\n2013-09-19 15:21:55.717 ERROR nova.compute.manager [req-be5e6b88-77f8-47d5-974e-85e1f875608a demo demo] [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] Error: internal error process exited while connecting to monitor: char device redirected to /dev/pts/27 (label charserial1)\nqemu-system-x86_64: -chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/org.qemu.guest_agent.0.instance-0000000b.sock,server,nowait: Failed to bind socket: Permission denied\nchardev: opening backend \"socket\" failed\n\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] Traceback (most recent call last):\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1038, in _build_instance\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     set_access_ip=set_access_ip)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1411, in _spawn\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     LOG.exception(_('Instance failed to spawn'), instance=instance)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/compute/manager.py\", line 1408, in _spawn\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     block_device_info)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2071, in spawn\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     block_device_info, context=context)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3214, in _create_domain_and_network\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     \n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3157, in _create_domain\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     \n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3152, in _create_domain\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     except Exception as e:\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 179, in doit\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 139, in proxy_call\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     rv = execute(f,*args,**kwargs)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 77, in tworker\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     rv = meth(*args,**kwargs)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 711, in createWithFlags\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] libvirtError: internal error process exited while connecting to monitor: char device redirected to /dev/pts/27 (label charserial1)\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] qemu-system-x86_64: -chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/org.qemu.guest_agent.0.instance-0000000b.sock,server,nowait: Failed to bind socket: Permission denied\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] chardev: opening backend \"socket\" failed\n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4] \n2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance: fccd153e-b8f7-4b09-aa25-b531fd618eb4]", 
            "date_created": "2013-09-19 22:27:25.544398+00:00", 
            "author": "https://api.launchpad.net/1.0/~ravivsn"
        }, 
        {
            "content": "Does cirros have the qemu guest agent installed?", 
            "date_created": "2013-09-20 14:18:04.367458+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "Could be that apparmor is enabled in your host.\nTry disabling it.\nOr change the apparmor profile to enable the operation you are doing.\n\nSrini\n", 
            "date_created": "2013-09-20 14:53:47.218034+00:00", 
            "author": "https://api.launchpad.net/1.0/~addepalli-srinivasa"
        }, 
        {
            "content": "Srini,   Thanks for the comment. It came out to be indeed apparmor issue.\nI set  the following in /etc/libvirt/qemu.conf and VMs came up fine.\nsecurity_driver = \"none\"\n\nNow the question is there must be a way for devstack to set qemu.conf if user needs to use virtio channels or nova to address apparmor template.\n", 
            "date_created": "2013-09-20 18:37:06.270507+00:00", 
            "author": "https://api.launchpad.net/1.0/~ravivsn"
        }, 
        {
            "content": "Hi Ravi, I also got this issue when I test my codes under devstack, and this is the comment about this issue:\nhttps://review.openstack.org/#/c/36372/6..7/etc/nova/nova.conf.sample\nThe original method to fix this issue is adding a config item for storing the socket file on the host, but Daniel doesn't like this, and I think the better way to notify the user about this trap is adding some doc to the release notes.", 
            "date_created": "2013-09-25 11:03:17.274369+00:00", 
            "author": "https://api.launchpad.net/1.0/~hzwangpan"
        }, 
        {
            "content": "Hi Wangpan, the exact config settings of the added feature did not come up\non devstack. I tried with virt-inst to make sure its not devstack thing but\nstill I got permission error. I have to fix libvirt-qemu apparmor settings\nto make the VM boot up.\n\nI suggest community to consider the following. I will propose BP on similar\nlines\nSource path, target name must be configurable to allow other use cases like\naccess to appliance VMs from host so that configuration can be pushed and\nrun time status can be fetched.\nFix libvirt apparmor issues or document the settings.\n\n\n\nOn Wed, Sep 25, 2013 at 4:03 AM, wangpan <email address hidden> wrote:\n\n> Hi Ravi, I also got this issue when I test my codes under devstack, and\n> this is the comment about this issue:\n> https://review.openstack.org/#/c/36372/6..7/etc/nova/nova.conf.sample\n> The original method to fix this issue is adding a config item for storing\n> the socket file on the host, but Daniel doesn't like this, and I think the\n> better way to notify the user about this trap is adding some doc to the\n> release notes.\n>\n> --\n> You received this bug notification because you are subscribed to the bug\n> report.\n> https://bugs.launchpad.net/bugs/1227912\n>\n> Title:\n>   instance fails to boot with qemu guest agent set in image metadata\n>\n> Status in OpenStack Compute (Nova):\n>   New\n>\n> Bug description:\n>   I set the image metadata to enable qemu guest agent. When I bring up\n> instance it fails to open socket due to permission.\n>   I observed this with devstack.\n>\n>   Here is more info\n>\n>   nova  image-meta cirros-0.3.1-x86_64-uec set  hw_qemu_guest_agent=yes\n>\n>   2013-09-19 15:21:55.717 ERROR nova.compute.manager\n> [req-be5e6b88-77f8-47d5-974e-85e1f875608a demo demo] [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4] Error: internal error process exited\n> while connecting to monitor: char device redirected to /dev/pts/27 (label\n> charserial1)\n>   qemu-system-x86_64: -chardev\n> socket,id=charchannel0,path=/var/lib/libvirt/qemu/org.qemu.guest_agent.0.instance-0000000b.sock,server,nowait:\n> Failed to bind socket: Permission denied\n>   chardev: opening backend \"socket\" failed\n>\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4] Traceback (most recent call last):\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/opt/stack/nova/nova/compute/manager.py\", line 1038, in _build_instance\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     set_access_ip=set_access_ip)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/opt/stack/nova/nova/compute/manager.py\", line 1411, in _spawn\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     LOG.exception(_('Instance failed\n> to spawn'), instance=instance)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/opt/stack/nova/nova/compute/manager.py\", line 1408, in _spawn\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     block_device_info)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2071, in spawn\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     block_device_info,\n> context=context)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3214, in\n> _create_domain_and_network\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3157, in _create_domain\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 3152, in _create_domain\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     except Exception as e:\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 179, in\n> doit\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     result =\n> proxy_call(self._autowrap, f, *args, **kwargs)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 139, in\n> proxy_call\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     rv = execute(f,*args,**kwargs)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 77, in\n> tworker\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     rv = meth(*args,**kwargs)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]   File\n> \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 711, in createWithFlags\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]     if ret == -1: raise libvirtError\n> ('virDomainCreateWithFlags() failed', dom=self)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4] libvirtError: internal error process\n> exited while connecting to monitor: char device redirected to /dev/pts/27\n> (label charserial1)\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4] qemu-system-x86_64: -chardev\n> socket,id=charchannel0,path=/var/lib/libvirt/qemu/org.qemu.guest_agent.0.instance-0000000b.sock,server,nowait:\n> Failed to bind socket: Permission denied\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4] chardev: opening backend \"socket\"\n> failed\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]\n>   2013-09-19 15:21:55.717 TRACE nova.compute.manager [instance:\n> fccd153e-b8f7-4b09-aa25-b531fd618eb4]\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/1227912/+subscriptions\n>\n\n\n\n-- \nRavi\n", 
            "date_created": "2013-09-25 15:16:54+00:00", 
            "author": "https://api.launchpad.net/1.0/~ravivsn"
        }, 
        {
            "content": "I have just encounter this problem in Ubuntu 14.04.1. Here's a workaround:\n\n# cd /var/lib/libvirtd/qemu\n# mkdir -p channel/target\n# chown -R libvirt-qemu:kvm channel/\n\n(The path above is used by libvirt-manager when you create the channel.)\n\nIn /etc/apparmor.d/abstractions/libvirt-qemu at the end add:\n\n\"/var/lib/libvirt/**/*.org.qemu.guest_agent.0\" rwk,\n\n(Reload apparmor profiles).\n\nThe line in libvirt-qemu could be generated in the domain specific file by virt-aa-helper to exactly match the name of the domain, but I cannot see a high security risk in being a bit unspecific here (allows one qemu to access the socket of another qemu).\n", 
            "date_created": "2014-09-20 14:44:52.226395+00:00", 
            "author": "https://api.launchpad.net/1.0/~mnl"
        }, 
        {
            "content": "Status changed to 'Confirmed' because the bug affects multiple users.", 
            "date_created": "2014-09-20 14:45:20.668197+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "MNLipp workaround moved me from the previous error to this one:\n\nUnable to complete install: 'internal error: Process exited prior to exec: libvirt:  error : unable to set AppArmor profile 'libvirt-9a3f213c-b02e-45a1-8791-109f6300d200' for '/usr/bin/qemu-system-x86_64': No such file or directory\n'\n\nTraceback (most recent call last):\n  File \"/usr/share/virt-manager/virtManager/asyncjob.py\", line 91, in cb_wrapper\n    callback(asyncjob, *args, **kwargs)\n  File \"/usr/share/virt-manager/virtManager/create.py\", line 1820, in do_install\n    guest.start_install(meter=meter)\n  File \"/usr/share/virt-manager/virtinst/guest.py\", line 403, in start_install\n    noboot)\n  File \"/usr/share/virt-manager/virtinst/guest.py\", line 467, in _create_guest\n    dom = self.conn.createLinux(start_xml or final_xml, 0)\n  File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 3398, in createLinux\n    if ret is None:raise libvirtError('virDomainCreateLinux() failed', conn=self)\nlibvirtError: internal error: Process exited prior to exec: libvirt:  error : unable to set AppArmor profile 'libvirt-9a3f213c-b02e-45a1-8791-109f6300d200' for '/usr/bin/qemu-system-x86_64': No such file or directory\n\nSystem details:\n\n$> dpkg -S /usr/bin/qemu-system-x86_64 \nqemu-system-x86: /usr/bin/qemu-system-x86_64\n\n$> COLUMNS=100 dpkg -l libvirt-bin|tail -1\n\nii  libvirt-bin         1.2.8-0ubuntu1 amd64          programs for the libvirt library\n\n$> lsb_release -a\n\n\nSetting \"security_driver=none\" and restarting libvirt-bin service at least allowed me to continue.\n\nNo LSB modules are available.\nDistributor ID:\tUbuntu\nDescription:\tUbuntu 14.10\nRelease:\t14.10\nCodename:\tutopic\n\n", 
            "date_created": "2014-11-12 20:52:03.693706+00:00", 
            "author": "https://api.launchpad.net/1.0/~lemsx1"
        }, 
        {
            "content": "\nI had the same issue when AppArmor is active (default)\nand when I try to enable qemu guest agent inside your\nguest :\n\nvirsh start test\nerror: Failed to start domain test\nerror: internal error: process exited while connecting to monitor: qemu-system-x86_64: -chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/test-virtio.sock,server,nowait: Failed to bind socket: Permission denied\nqemu-system-x86_64: -chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/test-virtio.sock,server,nowait: chardev: opening backend \"socket\" failed\n\naudit: type=1400 audit(...): apparmor=\"DENIED\" operation=\"mknod\" profile=\"libvirt-74c30212-4631-4498-a684-c62db8b2dc21\" name=\"/var/lib/libvirt/qemu/test-virtio.sock\" pid=10291 comm=\"qemu-system-x86\" requested_mask=\"c\" denied_mask=\"c\" fsuid=106 ouid=106\n\n    <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='writeback' discard='unmap'/>\n      <source dev='/var/lib/libvirt/images/test.raw'/>\n      <target dev='sda' bus='scsi'/>\n      <address type='drive' controller='0' bus='0' target='0' unit='0'/>\n    </disk>\n    <controller type='scsi' index='0' model='virtio-scsi'>\n    </controller>\n    <console type='pty'>\n      <target type='serial' port='0'/>\n    </console>\n    <channel type='unix'>\n      <source mode='bind' path='/var/lib/libvirt/qemu/test-virtio.sock'/>\n      <target type='virtio' name='org.qemu.guest_agent.0'/>\n      <address type='virtio-serial' controller='0' bus='0' port='1'/>\n    </channel>\n\nI am using qemu guest agent to be able to call guest-fstrim\nvirsh qemu-agent-command <domain> '{\"execute\":\"guest-fstrim\"}'\nguest-fstrim is doing fstrim on all partitions if discard has been\nenabled with virtio-scsi (free up deleted blocks)\n\n\n", 
            "date_created": "2015-05-26 13:51:36.893740+00:00", 
            "author": "https://api.launchpad.net/1.0/~lordbaco"
        }, 
        {
            "content": "\nIs it possible to apply this patch to libvirt-bin package and allow to write to  /var/lib/libvirt/qemu/ ?\n\nFor me it makes sense because disabling AppArmor for OpenStack is not a good idea\nso you will be exposed to security issues like Venom\nhttps://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/VENOM\n<< Additionally, the QEMU process is confined by an AppArmor profile that significantly lessens the impact of a vulnerability such as VENOM by reducing the host environment's attack surface >>\n\n$ dpkg -S /etc/apparmor.d/abstractions/libvirt-qemu\nlibvirt-bin: /etc/apparmor.d/abstractions/libvirt-qemu\n\n", 
            "date_created": "2015-05-26 15:02:03.634806+00:00", 
            "author": "https://api.launchpad.net/1.0/~lordbaco"
        }, 
        {
            "content": "The attachment \"Fix for\" seems to be a patch.  If it isn't, please remove the \"patch\" flag from the attachment, remove the \"patch\" tag, and if you are a member of the ~ubuntu-reviewers, unsubscribe the team.\n\n[This is an automated message performed by a Launchpad user owned by ~brian-murray, for any issues please contact him.]", 
            "date_created": "2015-05-26 16:23:08.569854+00:00", 
            "author": "https://api.launchpad.net/1.0/~crichton"
        }
    ], 
    "closed": "2013-10-04 19:22:19.462458+00:00"
}