{
    "status": "Won't Fix", 
    "last_updated": "2016-05-03 13:28:00.660576+00:00", 
    "description": "http://logs.openstack.org/96/219696/4/check/gate-tempest-dsvm-large-ops/158f061/logs/screen-n-cpu-1.txt.gz?level=TRACE\n\n2015-09-03 15:11:10.090 ERROR nova.compute.manager [req-ae96c425-a199-472f-a0db-e1b48147bb4c tempest-TestLargeOpsScenario-1690771764 tempest-TestLargeOpsScenario-1474206998] [instance: 195361d7-95c3-4740-825b-1acab707969e] Failed to deallocate network for instance.\n2015-09-03 15:11:11.051 ERROR nova.compute.manager [req-ae96c425-a199-472f-a0db-e1b48147bb4c tempest-TestLargeOpsScenario-1690771764 tempest-TestLargeOpsScenario-1474206998] [instance: 195361d7-95c3-4740-825b-1acab707969e] Setting instance vm_state to ERROR\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e] Traceback (most recent call last):\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2396, in do_terminate_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._delete_instance(context, instance, bdms, quotas)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/hooks.py\", line 149, in inner\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     rv = f(*args, **kwargs)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2375, in _delete_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     quotas.rollback()\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     six.reraise(self.type_, self.value, self.tb)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2338, in _delete_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._shutdown_instance(context, instance, bdms)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2265, in _shutdown_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._try_deallocate_network(context, instance, requested_networks)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2194, in _try_deallocate_network\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._set_instance_obj_error_state(context, instance)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     six.reraise(self.type_, self.value, self.tb)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2189, in _try_deallocate_network\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._deallocate_network(context, instance, requested_networks)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1812, in _deallocate_network\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     context, instance, requested_networks=requested_networks)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/network/api.py\", line 49, in wrapped\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     return func(self, context, *args, **kwargs)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/network/api.py\", line 297, in deallocate_for_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     requested_networks=requested_networks)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/network/rpcapi.py\", line 175, in deallocate_for_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     return cctxt.call(ctxt, 'deallocate_for_instance', **kwargs)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     retry=self.retry)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     timeout=timeout, retry=retry)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     retry=retry)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 420, in _send\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     result = self._waiter.wait(msg_id, timeout)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 318, in wait\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     message = self.waiters.get(msg_id, timeout=timeout)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 223, in get\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     'to message ID %s' % msg_id)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e] MessagingTimeout: Timed out waiting for a reply to message ID 20d504c45f1c45e980c0194ac492d531\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e] \n\n\n\nI see this in the n-net logs which I think we only do if something else fails:\n\nhttp://logs.openstack.org/96/219696/4/check/gate-tempest-dsvm-large-ops/158f061/logs/screen-n-net.txt.gz#_2015-09-03_15_11_10_664\n\n2015-09-03 15:11:10.664 DEBUG nova.network.manager [req-ae96c425-a199-472f-a0db-e1b48147bb4c tempest-TestLargeOpsScenario-1690771764 tempest-TestLargeOpsScenario-1474206998] [instance: 195361d7-95c3-4740-825b-1acab707969e] Explicitly disassociating fixed IP %s from instance. deallocate_fixed_ip /opt/stack/new/nova/nova/network/manager.py:1077\n\nhttps://github.com/openstack/nova/blob/master/nova/network/manager.py#L1068\n\n                    # NOTE(yufang521247): This is probably a failed dhcp fixed\n                    # ip. DHCPRELEASE packet sent to dnsmasq would not trigger\n                    # dhcp-bridge to run. Thus it is better to disassociate\n                    # such fixed ip here.\n                    fixed_ip_ref = objects.FixedIP.get_by_address(\n                        context, address)\n                    if (instance_uuid == fixed_ip_ref.instance_uuid and\n                            not fixed_ip_ref.leased):\n                        LOG.debug('Explicitly disassociating fixed IP %s from '\n                                  'instance.', instance_uuid=instance_uuid)\n                        fixed_ip_ref.disassociate()", 
    "tags": [
        "largeops", 
        "network"
    ], 
    "importance": "Medium", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1491949", 
    "owner": "None", 
    "id": 1491949, 
    "index": 4344, 
    "openned": "2015-09-03 16:53:08.833189+00:00", 
    "created": "2015-09-03 16:53:08.833189+00:00", 
    "title": "gate-tempest-dsvm-large-ops fails to deallocate instance network due to rpc timeout", 
    "comments": [
        {
            "content": "http://logs.openstack.org/96/219696/4/check/gate-tempest-dsvm-large-ops/158f061/logs/screen-n-cpu-1.txt.gz?level=TRACE\n\n2015-09-03 15:11:10.090 ERROR nova.compute.manager [req-ae96c425-a199-472f-a0db-e1b48147bb4c tempest-TestLargeOpsScenario-1690771764 tempest-TestLargeOpsScenario-1474206998] [instance: 195361d7-95c3-4740-825b-1acab707969e] Failed to deallocate network for instance.\n2015-09-03 15:11:11.051 ERROR nova.compute.manager [req-ae96c425-a199-472f-a0db-e1b48147bb4c tempest-TestLargeOpsScenario-1690771764 tempest-TestLargeOpsScenario-1474206998] [instance: 195361d7-95c3-4740-825b-1acab707969e] Setting instance vm_state to ERROR\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e] Traceback (most recent call last):\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2396, in do_terminate_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._delete_instance(context, instance, bdms, quotas)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/hooks.py\", line 149, in inner\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     rv = f(*args, **kwargs)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2375, in _delete_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     quotas.rollback()\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     six.reraise(self.type_, self.value, self.tb)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2338, in _delete_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._shutdown_instance(context, instance, bdms)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2265, in _shutdown_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._try_deallocate_network(context, instance, requested_networks)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2194, in _try_deallocate_network\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._set_instance_obj_error_state(context, instance)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     six.reraise(self.type_, self.value, self.tb)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2189, in _try_deallocate_network\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     self._deallocate_network(context, instance, requested_networks)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1812, in _deallocate_network\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     context, instance, requested_networks=requested_networks)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/network/api.py\", line 49, in wrapped\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     return func(self, context, *args, **kwargs)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/network/api.py\", line 297, in deallocate_for_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     requested_networks=requested_networks)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/opt/stack/new/nova/nova/network/rpcapi.py\", line 175, in deallocate_for_instance\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     return cctxt.call(ctxt, 'deallocate_for_instance', **kwargs)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     retry=self.retry)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     timeout=timeout, retry=retry)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     retry=retry)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 420, in _send\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     result = self._waiter.wait(msg_id, timeout)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 318, in wait\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     message = self.waiters.get(msg_id, timeout=timeout)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 223, in get\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e]     'to message ID %s' % msg_id)\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e] MessagingTimeout: Timed out waiting for a reply to message ID 20d504c45f1c45e980c0194ac492d531\n2015-09-03 15:11:11.051 22635 ERROR nova.compute.manager [instance: 195361d7-95c3-4740-825b-1acab707969e] \n\n\n\nI see this in the n-net logs which I think we only do if something else fails:\n\nhttp://logs.openstack.org/96/219696/4/check/gate-tempest-dsvm-large-ops/158f061/logs/screen-n-net.txt.gz#_2015-09-03_15_11_10_664\n\n2015-09-03 15:11:10.664 DEBUG nova.network.manager [req-ae96c425-a199-472f-a0db-e1b48147bb4c tempest-TestLargeOpsScenario-1690771764 tempest-TestLargeOpsScenario-1474206998] [instance: 195361d7-95c3-4740-825b-1acab707969e] Explicitly disassociating fixed IP %s from instance. deallocate_fixed_ip /opt/stack/new/nova/nova/network/manager.py:1077\n\nhttps://github.com/openstack/nova/blob/master/nova/network/manager.py#L1068\n\n                    # NOTE(yufang521247): This is probably a failed dhcp fixed\n                    # ip. DHCPRELEASE packet sent to dnsmasq would not trigger\n                    # dhcp-bridge to run. Thus it is better to disassociate\n                    # such fixed ip here.\n                    fixed_ip_ref = objects.FixedIP.get_by_address(\n                        context, address)\n                    if (instance_uuid == fixed_ip_ref.instance_uuid and\n                            not fixed_ip_ref.leased):\n                        LOG.debug('Explicitly disassociating fixed IP %s from '\n                                  'instance.', instance_uuid=instance_uuid)\n                        fixed_ip_ref.disassociate()", 
            "date_created": "2015-09-03 16:53:08.833189+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "http://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiVGVzdExhcmdlT3BzU2NlbmFyaW9cIiBBTkQgbWVzc2FnZTpcImRlYWxsb2NhdGVfZm9yX2luc3RhbmNlXCIgQU5EIG1lc3NhZ2U6XCJNZXNzYWdpbmdUaW1lb3V0XCIgQU5EIHRhZ3M6XCJzY3JlZW4tbi1jcHUtMS50eHRcIiIsImZpZWxkcyI6W10sIm9mZnNldCI6MCwidGltZWZyYW1lIjoiNjA0ODAwIiwiZ3JhcGhtb2RlIjoiY291bnQiLCJ0aW1lIjp7InVzZXJfaW50ZXJ2YWwiOjB9LCJzdGFtcCI6MTQ0MTM3Mzc0MjAwNywibW9kZSI6IiIsImFuYWx5emVfZmllbGQiOiIifQ==\n\n98 hits in 48 hours, check and gate, master branch only, all failures.", 
            "date_created": "2015-09-04 13:36:47.950795+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Given the logstash hits, this just started in the last 48 hours or so, since 9/3, so looking at what changed:\n\nhttps://github.com/openstack/nova/commits/master/nova/network\n\nThere were 2 neutron changes and then this for nova-network:\n\nhttps://review.openstack.org/#/c/197608/\n\n^ adds more logging, and it's in the release_fixed_ip method which is directly related to whether or not we hit the code block in:\n\nhttps://github.com/openstack/nova/blob/master/nova/network/manager.py#L1068", 
            "date_created": "2015-09-04 13:50:48.011061+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "This devstack change to turn on multihost=true is what triggered the bug:\n\nhttps://review.openstack.org/#/c/218860/\n\nThe revert is here:\n\nhttps://review.openstack.org/#/c/220525/", 
            "date_created": "2015-09-04 14:16:32.670670+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "(9:21:42 AM) sdague: so, honestly, the thing is that we're driving an unrealistic throughput on one node there\n(9:21:54 AM) sdague: because we are using fakevirt\n(9:22:39 AM) sdague: I suspect starting 175 vms on one node at once is probably not a thing with an actual hypervisor :)", 
            "date_created": "2015-09-04 14:25:28.571483+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/220525\nCommitted: https://git.openstack.org/cgit/openstack-dev/devstack/commit/?id=975243189216561f66ca91520495e0c6e2f747e2\nSubmitter: Jenkins\nBranch:    master\n\ncommit 975243189216561f66ca91520495e0c6e2f747e2\nAuthor: Matt Riedemann <email address hidden>\nDate:   Fri Sep 4 14:15:27 2015 +0000\n\n    Revert \"turn multi host true for nova network by default\"\n    \n    This reverts commit 2e1a91c50b73ca7f46871d3a906ade93bbcac6a7\n    \n    It looks like this introduced race bug 1491949 in the\n    gate-tempest-dsvm-large-ops job causing rpc timeouts when\n    deallocating network information for an instance,\n    specifically around the dnsmasq callback to release the\n    fixed IP that the instance was using which triggers the\n    disassociation between the fixed IP and the instance in the\n    nova database.\n    \n    Change-Id: I163cdeea75e92485f241647c69aea0d7456c3258\n    Closes-Bug: #1491949\n", 
            "date_created": "2015-09-04 15:59:41.344722+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This is still happening, or happening again:\n\nhttp://logs.openstack.org/97/241397/1/check/gate-tempest-dsvm-large-ops/be8ca35/logs/screen-n-cpu-1.txt.gz#_2015-11-04_14_46_57_639\n\n2015-11-04 14:46:57.639 ERROR nova.compute.manager [req-a36cc677-c460-4bae-bac5-93f5b82b8265 tempest-TestLargeOpsScenario-294201607 tempest-TestLargeOpsScenario-519728524] [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de] Setting instance vm_state to ERROR\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de] Traceback (most recent call last):\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2433, in do_terminate_instance\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     self._delete_instance(context, instance, bdms, quotas)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/hooks.py\", line 149, in inner\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     rv = f(*args, **kwargs)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2412, in _delete_instance\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     quotas.rollback()\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 197, in __exit__\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     six.reraise(self.type_, self.value, self.tb)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2375, in _delete_instance\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     self._shutdown_instance(context, instance, bdms)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2295, in _shutdown_instance\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     self._try_deallocate_network(context, instance, requested_networks)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2218, in _try_deallocate_network\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     self._set_instance_obj_error_state(context, instance)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 197, in __exit__\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     six.reraise(self.type_, self.value, self.tb)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 2213, in _try_deallocate_network\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     self._deallocate_network(context, instance, requested_networks)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 1804, in _deallocate_network\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     context, instance, requested_networks=requested_networks)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/network/api.py\", line 49, in wrapped\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     return func(self, context, *args, **kwargs)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/network/api.py\", line 297, in deallocate_for_instance\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     requested_networks=requested_networks)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/opt/stack/new/nova/nova/network/rpcapi.py\", line 180, in deallocate_for_instance\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     return cctxt.call(ctxt, 'deallocate_for_instance', **kwargs)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 403, in call\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     return self.prepare().call(ctxt, method, **kwargs)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     retry=self.retry)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     timeout=timeout, retry=retry)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 464, in send\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     retry=retry)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 453, in _send\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     result = self._waiter.wait(msg_id, timeout)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 334, in wait\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     message = self.waiters.get(msg_id, timeout=timeout)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 237, in get\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de]     'to message ID %s' % msg_id)\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de] MessagingTimeout: Timed out waiting for a reply to message ID 8564287783d147e3bcad22f153326a1a\n2015-11-04 14:46:57.639 9190 ERROR nova.compute.manager [instance: b0c2c6b3-8638-43d6-8e69-5ec1862bf6de] ", 
            "date_created": "2015-11-04 17:54:27.854997+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "http://logstash.openstack.org/#dashboard/file/logstash.json?query=message:%5C%22Setting%20instance%20vm_state%20to%20ERROR%5C%22%20AND%20message:%5C%22deallocate_for_instance%5C%22%20AND%20message:%5C%22MessagingTimeout%5C%22%20AND%20build_name:%5C%22gate-tempest-dsvm-large-ops%5C%22%20AND%20tags:%5C%22screen-n-cpu-1.txt%5C%22\n\n3 hits in 7 days, check and gate, all failures.", 
            "date_created": "2015-11-04 18:11:01.059495+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I suspect this isn't just happening for the noted test in this bug: http://logs.openstack.org/11/215311/6/check/gate-grenade-dsvm/2d9a906/logs/new/screen-n-cpu.txt.gz#_2015-12-09_18_39_40_829 I see a similar problem with a grenade test as well.", 
            "date_created": "2015-12-09 21:44:37.094428+00:00", 
            "author": "https://api.launchpad.net/1.0/~thomas-maddox"
        }, 
        {
            "content": "This job has been deleted", 
            "date_created": "2016-05-03 13:27:59.929633+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2016-05-03 13:27:45.749615+00:00"
}