{
    "status": "Invalid", 
    "last_updated": "2015-03-30 12:25:09.801874+00:00", 
    "description": "I have performed installation of Openstack Icehouse on two CentOS6.5 machines from scratch (both the OS and Openstack).\nThe problem is that the instances do not get internet access unless the following rule is added:\n\niptables -t nat -I POSTROUTING -o  eth1 -j MASQUERADE\n\nwhere eth1 is the public interface. This rule has to be re-inserted every time an instance is launched!\n\nA few words regarding the setup of the compute node. \n\n-It has two ethernet interfaces eth0 (internal network) and eth1(public network).\n-I have added a bridge interface (br100) which has been bridged with eth0.\n-Both eth0 and eth1 are running in promiscuous mode\n-In sysctl.conf ip forwarding has been enabled\n-In nova.conf I have declared the flat_interface to be eth0 while the public_interface is eth1\n-I have followed the guide from here : http://docs.openstack.org/icehouse/install-guide/install/yum/content/   for both compute and controller nodes.\n-I have added the secgroup-rules for ICMP and SSH to the default group\n\n-I am launching a cirrOS instance at the default security group which is assigned the IP 10.0.0.2.\n-I can ping the cirrOS instance\n-I can ssh to the cirrOS\n-While logged in to the instance I can resolve external addresses (e.g. nslookup openstack.org produces a correct output)\n-While logged in to the instance I can ping 10.0.0.1\n-While logged in to the instance I can ping  the compute nodes external IP\n-While logged in to the instance I CANNOT ping the compute nodes gateway or anything else outside that!!!\n\nIf I insert the afforementioned rule then pinging works as expected!\n\nIn the case I have a second instance all the above apply but also I can ping and ssh from one instance to another. Unfortunately the problem of pinging outside the compute node from both instances remains until I re-insert the afforementioned rule.\n\nTests have shown that every time I start an instance the rule has to be added at the top of the chain otherwise none of them works.\n\nThe above are also the case when floating IPs are assigned to the instances. They cannot reach an external network unless the rule has been added. When it has instances can reach and be reached from an external network.\n\nFurthermore, comparison with an Havana installation with the same network configuration and topology (two nodes, two ethernet nics each etc.) revealed that the following chains are not populated correctly in Icehouse\n\n - Chain nova-network-OUTPUT\n - Chain nova-network-POSTROUTING\n - Chain nova-network-PREROUTING\n - Chain nova-network-float-snat\n\n\nI have been trying to find a solution to this through the mailing-lists:\n\nhttp://lists.openstack.org/pipermail/openstack/2014-May/007454.html\nhttp://lists.openstack.org/pipermail/openstack/2014-May/007515.html\n\nand in the IRC channel but without success.\n\n\nI have performed the above installations twice and every time the same problem appears leading me to think that it's a bug.\n\nPlease check it!\n\nBest,\n\nG.", 
    "tags": [
        "access", 
        "icehouse", 
        "internet", 
        "nova"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1326345", 
    "owner": "None", 
    "id": 1326345, 
    "index": 6166, 
    "openned": "2014-06-04 10:48:58.952647+00:00", 
    "created": "2014-06-04 10:48:58.952647+00:00", 
    "title": "Legacy networking (nova-network) in OpenStack Icehouse Installation results in no internet access for instances", 
    "comments": [
        {
            "content": "I have performed installation of Openstack Icehouse on two CentOS6.5 machines from scratch (both the OS and Openstack).\nThe problem is that the instances do not get internet access unless the following rule is added:\n\niptables -t nat -I POSTROUTING -o  eth1 -j MASQUERADE\n\nwhere eth1 is the public interface. This rule has to be re-inserted every time an instance is launched!\n\nA few words regarding the setup of the compute node. \n\n-It has two ethernet interfaces eth0 (internal network) and eth1(public network).\n-I have added a bridge interface (br100) which has been bridged with eth0.\n-Both eth0 and eth1 are running in promiscuous mode\n-In sysctl.conf ip forwarding has been enabled\n-In nova.conf I have declared the flat_interface to be eth0 while the public_interface is eth1\n-I have followed the guide from here : http://docs.openstack.org/icehouse/install-guide/install/yum/content/   for both compute and controller nodes.\n-I have added the secgroup-rules for ICMP and SSH to the default group\n\n-I am launching a cirrOS instance at the default security group which is assigned the IP 10.0.0.2.\n-I can ping the cirrOS instance\n-I can ssh to the cirrOS\n-While logged in to the instance I can resolve external addresses (e.g. nslookup openstack.org produces a correct output)\n-While logged in to the instance I can ping 10.0.0.1\n-While logged in to the instance I can ping  the compute nodes external IP\n-While logged in to the instance I CANNOT ping the compute nodes gateway or anything else outside that!!!\n\nIf I insert the afforementioned rule then pinging works as expected!\n\nIn the case I have a second instance all the above apply but also I can ping and ssh from one instance to another. Unfortunately the problem of pinging outside the compute node from both instances remains until I re-insert the afforementioned rule.\n\nTests have shown that every time I start an instance the rule has to be added at the top of the chain otherwise none of them works.\n\nThe above are also the case when floating IPs are assigned to the instances. They cannot reach an external network unless the rule has been added. When it has instances can reach and be reached from an external network.\n\nFurthermore, comparison with an Havana installation with the same network configuration and topology (two nodes, two ethernet nics each etc.) revealed that the following chains are not populated correctly in Icehouse\n\n - Chain nova-network-OUTPUT\n - Chain nova-network-POSTROUTING\n - Chain nova-network-PREROUTING\n - Chain nova-network-float-snat\n\n\nI have been trying to find a solution to this through the mailing-lists:\n\nhttp://lists.openstack.org/pipermail/openstack/2014-May/007454.html\nhttp://lists.openstack.org/pipermail/openstack/2014-May/007515.html\n\nand in the IRC channel but without success.\n\n\nI have performed the above installations twice and every time the same problem appears leading me to think that it's a bug.\n\nPlease check it!\n\nBest,\n\nG.", 
            "date_created": "2014-06-04 10:48:58.952647+00:00", 
            "author": "https://api.launchpad.net/1.0/~giorgis-r"
        }, 
        {
            "content": "Please add all nova.conf files to help figure out configuration issues otherwise.", 
            "date_created": "2014-09-11 15:25:42.337310+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Hi Sean!\n\nIt's been too many days since the last time this problem was bugging me...therefore I no longer have the relevant conf files.\n\nIf I recall correctly I managed to solve it with some help from people at the IRC channel.\n\nBest,\n\nG.", 
            "date_created": "2014-09-11 23:15:09.195250+00:00", 
            "author": "https://api.launchpad.net/1.0/~giorgis-r"
        }, 
        {
            "content": "Do you have more details regarding what steps you took to solve it? I'm faced with an awefully similar issue.", 
            "date_created": "2014-11-18 20:24:46.343004+00:00", 
            "author": "https://api.launchpad.net/1.0/~xav0989"
        }, 
        {
            "content": " Dear Xavier,\n\n did you manage to solve this?\n\n Regards,\n\n George\n\n On Tue, 18 Nov 2014 20:24:46 -0000, Xavier L. wrote:\n> Do you have more details regarding what steps you took to solve it? \n> I'm\n> faced with an awefully similar issue.\n>\n> --\n> You received this bug notification because you are subscribed to the \n> bug\n> report.\n> https://bugs.launchpad.net/bugs/1326345\n>\n> Title:\n>   Legacy networking (nova-network) in OpenStack Icehouse Installation\n>   results in no internet access for instances\n>\n> Status in OpenStack Compute (Nova):\n>   Incomplete\n>\n> Bug description:\n>   I have performed installation of Openstack Icehouse on two\n> CentOS6.5 machines from scratch (both the OS and Openstack).\n>   The problem is that the instances do not get internet access unless\n> the following rule is added:\n>\n>   iptables -t nat -I POSTROUTING -o  eth1 -j MASQUERADE\n>\n>   where eth1 is the public interface. This rule has to be re-inserted\n>   every time an instance is launched!\n>\n>   A few words regarding the setup of the compute node.\n>\n>   -It has two ethernet interfaces eth0 (internal network) and\n> eth1(public network).\n>   -I have added a bridge interface (br100) which has been bridged \n> with eth0.\n>   -Both eth0 and eth1 are running in promiscuous mode\n>   -In sysctl.conf ip forwarding has been enabled\n>   -In nova.conf I have declared the flat_interface to be eth0 while\n> the public_interface is eth1\n>   -I have followed the guide from here :\n> http://docs.openstack.org/icehouse/install-guide/install/yum/content/\n> for both compute and controller nodes.\n>   -I have added the secgroup-rules for ICMP and SSH to the default \n> group\n>\n>   -I am launching a cirrOS instance at the default security group\n> which is assigned the IP 10.0.0.2.\n>   -I can ping the cirrOS instance\n>   -I can ssh to the cirrOS\n>   -While logged in to the instance I can resolve external addresses\n> (e.g. nslookup openstack.org produces a correct output)\n>   -While logged in to the instance I can ping 10.0.0.1\n>   -While logged in to the instance I can ping  the compute nodes \n> external IP\n>   -While logged in to the instance I CANNOT ping the compute nodes\n> gateway or anything else outside that!!!\n>\n>   If I insert the afforementioned rule then pinging works as \n> expected!\n>\n>   In the case I have a second instance all the above apply but also I\n>   can ping and ssh from one instance to another. Unfortunately the\n>   problem of pinging outside the compute node from both instances\n>   remains until I re-insert the afforementioned rule.\n>\n>   Tests have shown that every time I start an instance the rule has \n> to\n>   be added at the top of the chain otherwise none of them works.\n>\n>   The above are also the case when floating IPs are assigned to the\n>   instances. They cannot reach an external network unless the rule \n> has\n>   been added. When it has instances can reach and be reached from an\n>   external network.\n>\n>   Furthermore, comparison with an Havana installation with the same\n>   network configuration and topology (two nodes, two ethernet nics \n> each\n>   etc.) revealed that the following chains are not populated \n> correctly\n>   in Icehouse\n>\n>    - Chain nova-network-OUTPUT\n>    - Chain nova-network-POSTROUTING\n>    - Chain nova-network-PREROUTING\n>    - Chain nova-network-float-snat\n>\n>\n>   I have been trying to find a solution to this through the \n> mailing-lists:\n>\n>   http://lists.openstack.org/pipermail/openstack/2014-May/007454.html\n>   http://lists.openstack.org/pipermail/openstack/2014-May/007515.html\n>\n>   and in the IRC channel but without success.\n>\n>\n>   I have performed the above installations twice and every time the\n> same problem appears leading me to think that it's a bug.\n>\n>   Please check it!\n>\n>   Best,\n>\n>   G.\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/1326345/+subscriptions\n\n", 
            "date_created": "2014-12-08 16:52:25+00:00", 
            "author": "https://api.launchpad.net/1.0/~giorgis-r"
        }, 
        {
            "content": "No longer reproducable, was fixed by the user", 
            "date_created": "2015-03-30 12:25:09.259245+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2015-03-30 12:24:40.883460+00:00"
}