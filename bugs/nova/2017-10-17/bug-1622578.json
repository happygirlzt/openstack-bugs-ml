{
    "status": "Invalid", 
    "last_updated": "2016-09-26 09:10:20.004856+00:00", 
    "description": "Hello,\n\nwhen we start a VM the process of cloud init failed with:\n\nInside the VM\nurl_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [62/120s]: bad status code [500]\n\nThe VM is reachable and you can curl http://169.254.169.254 and get a valid result but when you curl http://169.254.169.254/latest we get: Remote metadata server experienced an internal server error. \n\nIn nova-api log I see: Unauthorized: The request you have made requires authentication. (HTTP 401)\n\n\nEnvironment\n\nOS:\nUbuntu 16.04.1 LTS\n\npackages on nova:\nii  nova-api                           2:13.1.0-0ubuntu1                     all          OpenStack Compute - API frontend\nii  nova-common                        2:13.1.0-0ubuntu1                     all          OpenStack Compute - common files\nii  nova-conductor                     2:13.1.0-0ubuntu1                     all          OpenStack Compute - conductor service\nii  nova-consoleauth                   2:13.1.0-0ubuntu1                     all          OpenStack Compute - Console Authenticator\nii  nova-novncproxy                    2:13.1.0-0ubuntu1                     all          OpenStack Compute - NoVNC proxy\nii  nova-scheduler                     2:13.1.0-0ubuntu1                     all          OpenStack Compute - virtual machine scheduler\nii  nova-spiceproxy                    2:13.1.0-0ubuntu1                     all          OpenStack Compute - spice html5 proxy\nii  python-nova                        2:13.1.0-0ubuntu1                     all          OpenStack Compute Python libraries\nii  python-novaclient                  2:3.3.1-2                             all          client library for OpenStack Compute API - Python 2.7\nii  python-neutronclient               1:4.1.1-2                             all          client API library for Neutron - Python 2.7\n\n\npackages on neutron:\n\nii  neutron-common                     2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - common\nii  neutron-dhcp-agent                 2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - DHCP agent\nii  neutron-l3-agent                   2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - l3 agent\nii  neutron-metadata-agent             2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - metadata agent\nii  neutron-openvswitch-agent          2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - Open vSwitch plugin agent\nii  neutron-plugin-ml2                 2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - ML2 plugin\nii  neutron-plugin-openvswitch-agent   2:8.1.2-0ubuntu1                all          Transitional package for neutron-openvswitch-agent\nii  neutron-server                     2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - server\nii  python-neutron                     2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - Python library\nii  python-neutron-fwaas               1:8.0.0-0ubuntu1                all          Firewall-as-a-Service driver for OpenStack Neutron\nii  python-neutron-lib                 0.0.2-2                         all          Neutron shared routines and utilities - Python 2.7\nii  python-neutronclient               1:4.1.1-2                       all          client API library for Neutron - Python 2.7\n\nHypervisor is KVM\n\nii  nova-compute-kvm                     2:13.1.0-0ubuntu1                   all          OpenStack Compute - compute node (KVM)\nii  libvirt-bin                          1.3.1-1ubuntu10.1                   amd64        programs for the libvirt library\nii  libvirt0:amd64                       1.3.1-1ubuntu10.1                   amd64        library for interfacing with different virtualization systems\nii  nova-compute-libvirt                 2:13.1.0-0ubuntu1                   all          OpenStack Compute - compute node libvirt support\nii  python-libvirt                       1.3.1-1ubuntu1                      amd64        libvirt Python bindings\n\nStorage is CEPH\nroot@openstack11:~# ceph version\nceph version 10.2.2 \n\nNetwork is Neutron with openvswitch\n\nI tried a lot to get around this issue, I hope I didn't oversee something. \n\nMaybe someone can help or fix this bug.\n\nThanks in advance", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1622578", 
    "owner": "None", 
    "id": 1622578, 
    "index": 7695, 
    "openned": "2016-09-12 11:44:43.806650+00:00", 
    "created": "2016-09-12 11:44:43.806650+00:00", 
    "title": "cloud init metadata injection failed while booting VM ", 
    "comments": [
        {
            "content": "Hello,\n\nwhen we start a VM the process of cloud init failed with:\n\nInside the VM\nurl_helper.py[WARNING]: Calling 'http://169.254.169.254/2009-04-04/meta-data/instance-id' failed [62/120s]: bad status code [500]\n\nThe VM is reachable and you can curl http://169.254.169.254 and get a valid result but when you curl http://169.254.169.254/latest we get: Remote metadata server experienced an internal server error. \n\nIn nova-api log I see: Unauthorized: The request you have made requires authentication. (HTTP 401)\n\n\nEnvironment\n\nOS:\nUbuntu 16.04.1 LTS\n\npackages on nova:\nii  nova-api                           2:13.1.0-0ubuntu1                     all          OpenStack Compute - API frontend\nii  nova-common                        2:13.1.0-0ubuntu1                     all          OpenStack Compute - common files\nii  nova-conductor                     2:13.1.0-0ubuntu1                     all          OpenStack Compute - conductor service\nii  nova-consoleauth                   2:13.1.0-0ubuntu1                     all          OpenStack Compute - Console Authenticator\nii  nova-novncproxy                    2:13.1.0-0ubuntu1                     all          OpenStack Compute - NoVNC proxy\nii  nova-scheduler                     2:13.1.0-0ubuntu1                     all          OpenStack Compute - virtual machine scheduler\nii  nova-spiceproxy                    2:13.1.0-0ubuntu1                     all          OpenStack Compute - spice html5 proxy\nii  python-nova                        2:13.1.0-0ubuntu1                     all          OpenStack Compute Python libraries\nii  python-novaclient                  2:3.3.1-2                             all          client library for OpenStack Compute API - Python 2.7\nii  python-neutronclient               1:4.1.1-2                             all          client API library for Neutron - Python 2.7\n\n\npackages on neutron:\n\nii  neutron-common                     2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - common\nii  neutron-dhcp-agent                 2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - DHCP agent\nii  neutron-l3-agent                   2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - l3 agent\nii  neutron-metadata-agent             2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - metadata agent\nii  neutron-openvswitch-agent          2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - Open vSwitch plugin agent\nii  neutron-plugin-ml2                 2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - ML2 plugin\nii  neutron-plugin-openvswitch-agent   2:8.1.2-0ubuntu1                all          Transitional package for neutron-openvswitch-agent\nii  neutron-server                     2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - server\nii  python-neutron                     2:8.1.2-0ubuntu1                all          Neutron is a virtual network service for Openstack - Python library\nii  python-neutron-fwaas               1:8.0.0-0ubuntu1                all          Firewall-as-a-Service driver for OpenStack Neutron\nii  python-neutron-lib                 0.0.2-2                         all          Neutron shared routines and utilities - Python 2.7\nii  python-neutronclient               1:4.1.1-2                       all          client API library for Neutron - Python 2.7\n\nHypervisor is KVM\n\nii  nova-compute-kvm                     2:13.1.0-0ubuntu1                   all          OpenStack Compute - compute node (KVM)\nii  libvirt-bin                          1.3.1-1ubuntu10.1                   amd64        programs for the libvirt library\nii  libvirt0:amd64                       1.3.1-1ubuntu10.1                   amd64        library for interfacing with different virtualization systems\nii  nova-compute-libvirt                 2:13.1.0-0ubuntu1                   all          OpenStack Compute - compute node libvirt support\nii  python-libvirt                       1.3.1-1ubuntu1                      amd64        libvirt Python bindings\n\nStorage is CEPH\nroot@openstack11:~# ceph version\nceph version 10.2.2 \n\nNetwork is Neutron with openvswitch\n\nI tried a lot to get around this issue, I hope I didn't oversee something. \n\nMaybe someone can help or fix this bug.\n\nThanks in advance", 
            "date_created": "2016-09-12 11:44:43.806650+00:00", 
            "author": "https://api.launchpad.net/1.0/~stefan-bujack"
        }, 
        {
            "content": "", 
            "date_created": "2016-09-12 11:44:43.806650+00:00", 
            "author": "https://api.launchpad.net/1.0/~stefan-bujack"
        }, 
        {
            "content": "Can you confirm that you did set metadata_proxy_shared_secret consistently in nova.conf and neutron/metadata_agent.ini on the controller and network nodes?", 
            "date_created": "2016-09-13 12:00:57.095551+00:00", 
            "author": "https://api.launchpad.net/1.0/~j-harbott"
        }, 
        {
            "content": "So, I'm suspecting some bad configuration on the Nova side for Keystone admin authentication from neutronclient called in the metadata API service.\n\nSince Nova recreates a new auth token for the metadata calls, we need to have the right opts in nova.conf for using the keystone strategy.\n\nCheck out nova.conf on your nova-metadata-api service and look at [keystone_authtoken] section.\n\nMarking the bug as Invalid as I'm suspecting some configuration issue.", 
            "date_created": "2016-09-13 12:12:05.166151+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "Hello,\n\nI set the metadata_proxy_shared_secret in the config files. At first I had a different secret and changed it to test but that didnt't work either. \n\nI have attached the config files. Maybe I 've overseen something.\n\nThanks for looking.", 
            "date_created": "2016-09-13 13:19:13.638166+00:00", 
            "author": "https://api.launchpad.net/1.0/~stefan-bujack"
        }, 
        {
            "content": "Hy,\n\nthis solved my problem:\n\nhttps://ask.openstack.org/en/question/95889/domainnotfound-could-not-find-domain-default/\n\nGreets ", 
            "date_created": "2016-09-26 09:10:19.235130+00:00", 
            "author": "https://api.launchpad.net/1.0/~stefan-bujack"
        }
    ], 
    "closed": "2016-09-13 12:19:56.524573+00:00"
}