{
    "status": "Confirmed", 
    "last_updated": "2017-06-27 15:52:55.866925+00:00", 
    "description": "Description:\n------------\nWhen using lxc libvirt driver, nova encounters error in deleting an instance (nova delete). The instance is not deleted from nova. However, virsh list shows that the domain is not running after nova delete completes.\n\n\nSteps to reproduce\n--\nlibvirt_type=lxc to choose LXC as hypervisor type\nlibvirt_images_type=lvm to choose LVM as imagebackend store\n\nnova boot container1\nnova boot container2\nnova delete container1\nvirsh -c lxc:/// list (to see what happens of the domain from point of view of libvirt).\n\nExpected result\n--\nNicely destroy container and remove LVM disk\n\nActual result\n--\nNova encounters error in deleting container\n\nLogs (n-cpu.log)\n----\n\n2016-08-08 16:06:08.500 ERROR oslo_messaging.rpc.server [req-d6b89fcc-9b02-4b75-a571-63bd0b82a336 demo demo] Exception during message handling\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming  \n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch   \n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 75, in wrapped\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     function_name, call_dict, binary)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 66, in wrapped\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 188, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     LOG.warning(msg, e, instance=instance)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 157, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/utils.py\", line 613, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 216, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 204, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2389, in terminate_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     do_terminate_instance(instance, bdms)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return f(*args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2387, in do_terminate_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self._set_instance_obj_error_state(context, instance)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2377, in do_terminate_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self._delete_instance(context, instance, bdms, quotas)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     rv = f(*args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2340, in _delete_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     quotas.rollback()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2196, in _shutdown_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     block_device_info)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 923, in destroy\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     destroy_disks, migrate_data)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1019, in cleanup\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self._cleanup_lvm(instance, block_device_info)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1085, in _cleanup_lvm\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     lvm.remove_volumes(disks)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/storage/lvm.py\", line 241, in remove_volumes\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     raise exception.VolumesNotRemoved(reason=(', ').join(errors))\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server VolumesNotRemoved: Failed to remove volume(s): (Unexpected error while running command.\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Command: sudo nova-rootwrap /etc/nova/rootwrap.conf lvremove -f /dev/stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Exit code: 5\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Stdout: u''\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Stderr: u'  Logical volume stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk contains a filesystem in use.\\n')\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server \n\nRelated bug:\nhttps://bugs.launchpad.net/nova/+bug/1091639\n\nEnvironment:\n-------------\n\nNova commit:\ndevdatta@devdatta-nova-trusty-2:/opt/stack/nova$ git log -1\ncommit 4cbfed44f4b1dc4af21e9a09ed830617cb3caa05\nAuthor: Anush Krishnamurthy <email address hidden>\nDate:   Wed Aug 3 05:06:06 2016 +0000\n\n    Update tags for Image file url from filesystems config option\n    \n    Updated tags for config options consistency [1].\n    \n    [1] https://wiki.openstack.org/wiki/ConfigOptionsConsistency\n    \n    Change-Id: I18bdca49ed8c8f5fb0bc6782526dca14bd5c8646\n    Implements: Blueprint centralize-config-options-newton\n\n\nHypervisor:\nLibvirt + lxc\n\nOS:\nlsb_release -rd\nDescription:\tUbuntu 14.04.5 LTS\nRelease:\t14.04\n\nKernel:\nuname -a\nLinux devdatta-nova-trusty-2 3.13.0-88-generic #135-Ubuntu SMP Wed Jun 8 21:10:42 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\nlibvirt-bin:\ndpkg -l | grep libvirt-bin\nii libvirt-bin  1.2.2-0ubuntu13.1.17  amd64  programs for the libvirt library\n\nlxc:\ndpkg -l | grep lxc        \nii  liblxc1                             1.0.8-0ubuntu0.3                      amd64        Linux Containers userspace tools (library)\nii  lxc                                 1.0.8-0ubuntu0.3                      amd64        Linux Containers userspace tools\nii  lxc-templates                       1.0.8-0ubuntu0.3                      amd64        Linux Containers userspace tools (templates)\nii  python3-lxc                         1.0.8-0ubuntu0.3                      amd64        Linux Containers userspace tools (Python 3.x bindings)\n\nStorage type:\nlvm\n\nNetwork type:\nnova-network", 
    "tags": [
        "lxc", 
        "openstack-version.newton"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1611042", 
    "owner": "None", 
    "id": 1611042, 
    "index": 4595, 
    "openned": "2016-08-08 16:27:54.280746+00:00", 
    "created": "2016-08-08 16:27:54.280746+00:00", 
    "title": "failed-to-delete-instance-lxc-with-lvm - filesystem in use", 
    "comments": [
        {
            "content": "Description:\n------------\nWhen using lxc libvirt driver, nova encounters error in deleting an instance (nova delete). The instance is not deleted from nova. However, virsh list shows that the domain is not running after nova delete completes.\n\n\nSteps to reproduce\n--\nlibvirt_type=lxc to choose LXC as hypervisor type\nlibvirt_images_type=lvm to choose LVM as imagebackend store\n\nnova boot container1\nnova boot container2\nnova delete container1\nvirsh -c lxc:/// list (to see what happens of the domain from point of view of libvirt).\n\nExpected result\n--\nNicely destroy container and remove LVM disk\n\nActual result\n--\nNova encounters error in deleting container\n\nLogs (n-cpu.log)\n----\n\n2016-08-08 16:06:08.500 ERROR oslo_messaging.rpc.server [req-d6b89fcc-9b02-4b75-a571-63bd0b82a336 demo demo] Exception during message handling\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Traceback (most recent call last):\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming  \n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch   \n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 75, in wrapped\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     function_name, call_dict, binary)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 66, in wrapped\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 188, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     LOG.warning(msg, e, instance=instance)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 157, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/utils.py\", line 613, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 216, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 204, in decorated_function\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2389, in terminate_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     do_terminate_instance(instance, bdms)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     return f(*args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2387, in do_terminate_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self._set_instance_obj_error_state(context, instance)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2377, in do_terminate_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self._delete_instance(context, instance, bdms, quotas)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     rv = f(*args, **kwargs)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2340, in _delete_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     quotas.rollback()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self.force_reraise()\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 2196, in _shutdown_instance\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     block_device_info)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 923, in destroy\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     destroy_disks, migrate_data)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1019, in cleanup\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     self._cleanup_lvm(instance, block_device_info)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1085, in _cleanup_lvm\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     lvm.remove_volumes(disks)\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/storage/lvm.py\", line 241, in remove_volumes\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server     raise exception.VolumesNotRemoved(reason=(', ').join(errors))\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server VolumesNotRemoved: Failed to remove volume(s): (Unexpected error while running command.\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Command: sudo nova-rootwrap /etc/nova/rootwrap.conf lvremove -f /dev/stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Exit code: 5\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Stdout: u''\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server Stderr: u'  Logical volume stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk contains a filesystem in use.\\n')\n2016-08-08 16:06:08.500 TRACE oslo_messaging.rpc.server \n\nRelated bug:\nhttps://bugs.launchpad.net/nova/+bug/1091639\n\nEnvironment:\n-------------\n\nNova commit:\ndevdatta@devdatta-nova-trusty-2:/opt/stack/nova$ git log -1\ncommit 4cbfed44f4b1dc4af21e9a09ed830617cb3caa05\nAuthor: Anush Krishnamurthy <email address hidden>\nDate:   Wed Aug 3 05:06:06 2016 +0000\n\n    Update tags for Image file url from filesystems config option\n    \n    Updated tags for config options consistency [1].\n    \n    [1] https://wiki.openstack.org/wiki/ConfigOptionsConsistency\n    \n    Change-Id: I18bdca49ed8c8f5fb0bc6782526dca14bd5c8646\n    Implements: Blueprint centralize-config-options-newton\n\n\nHypervisor:\nLibvirt + lxc\n\nOS:\nlsb_release -rd\nDescription:\tUbuntu 14.04.5 LTS\nRelease:\t14.04\n\nKernel:\nuname -a\nLinux devdatta-nova-trusty-2 3.13.0-88-generic #135-Ubuntu SMP Wed Jun 8 21:10:42 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\nlibvirt-bin:\ndpkg -l | grep libvirt-bin\nii libvirt-bin  1.2.2-0ubuntu13.1.17  amd64  programs for the libvirt library\n\nlxc:\ndpkg -l | grep lxc        \nii  liblxc1                             1.0.8-0ubuntu0.3                      amd64        Linux Containers userspace tools (library)\nii  lxc                                 1.0.8-0ubuntu0.3                      amd64        Linux Containers userspace tools\nii  lxc-templates                       1.0.8-0ubuntu0.3                      amd64        Linux Containers userspace tools (templates)\nii  python3-lxc                         1.0.8-0ubuntu0.3                      amd64        Linux Containers userspace tools (Python 3.x bindings)\n\nStorage type:\nlvm\n\nNetwork type:\nnova-network", 
            "date_created": "2016-08-08 16:27:54.280746+00:00", 
            "author": "https://api.launchpad.net/1.0/~devdatta-kulkarni"
        }, 
        {
            "content": "Some additional information:\n\n1) Trying the command:\nsudo nova-rootwrap /etc/nova/rootwrap.conf lvremove -f /dev/stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk\n  Logical volume stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk contains a filesystem in use.\n\n2) Trying to unmount the volume:\ndevdatta@devdatta-nova-trusty-2:/$ sudo umount /dev/stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk\numount: /dev/stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk: not mounted\n\n3) Checking information about logical volumes:\ndevdatta@devdatta-nova-trusty-2:/$ sudo lvs\n  LV                                        VG                    Attr      LSize  Pool Origin Data%  Move Log Copy%  Convert\n  9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk stack-volumes-default -wi-ao--- 24.00m                                           \n\n*** The attributes (Attr) show that the logical volume is open (the 'o' in ao). ***\n\n4) Checking the mapping of the volume\ndevdatta@devdatta-nova-trusty-2:/$ ls -ltr /dev/stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk\nlrwxrwxrwx 1 root root 7 Aug  8 16:06 /dev/stack-volumes-default/9fe6288f-e4e7-460f-925d-9379ac0f74fa_disk -> ../dm-2\n\n\n5) Checking if any process is holding a reference to the volume\ndevdatta@devdatta-nova-trusty-2:/$ sudo lsof | grep dm-2\njbd2/dm-2 11090             root  cwd       DIR              202,1     4096          2 /\njbd2/dm-2 11090             root  rtd       DIR              202,1     4096          2 /\njbd2/dm-2 11090             root  txt   unknown                                        /proc/11090/exe\n\n\n*** Looks like there is a process (11090) running that is holding handle to the volume. ***\n\n\n", 
            "date_created": "2016-08-08 21:14:37.538731+00:00", 
            "author": "https://api.launchpad.net/1.0/~devdatta-kulkarni"
        }, 
        {
            "content": "Yeah this is a long-standing issue and is the main blocker from us getting the LXC CI job working, is we have something locking here so we can't delete the instances.\n\nCan you figure out what that 11090 process is?", 
            "date_created": "2016-09-09 22:01:36.448372+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Automatically discovered version newton in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 15:52:55.260246+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}