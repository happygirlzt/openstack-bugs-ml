{
    "status": "Invalid", 
    "last_updated": "2017-07-28 12:34:54.628863+00:00", 
    "description": "stack@controller:~/devstack$ nova help volume-attach\nusage: nova volume-attach <server> <volume> [<device>]\n\nAttach a volume to a server.\n\nPositional arguments:\n  <server>  Name or ID of server.\n  <volume>  ID of the volume to attach.\n  <device>  Name of the device e.g. /dev/vdb. Use \"auto\" for autoassign (if\n            supported). Libvirt driver will use default device name.\n\n\nAs shown below:\n\n[root@greglinux2 ~(keystone_admin)]# nova volume-attachments e9c63adc-e837-4108-b5cf-10a8f147a5ab\n+----+--------+-----------+-----------+\n| ID | DEVICE | SERVER ID | VOLUME ID |\n+----+--------+-----------+-----------+\n+----+--------+-----------+-----------+\n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n\n[root@greglinux2 ~(keystone_admin)]# nova volume-attach e9c63adc-e837-4108-b5cf-10a8f147a5ab f0990f38-8fc5-4710-b9ac-e846b6c634cb /dev/vdb\n+----------+--------------------------------------+\n| Property | Value                                |\n+----------+--------------------------------------+\n| device   | /dev/vdb                             |>>>>>>>>>  attached as device /dev/vdb\n| id       | f0990f38-8fc5-4710-b9ac-e846b6c634cb |\n| serverId | e9c63adc-e837-4108-b5cf-10a8f147a5ab |\n| volumeId | f0990f38-8fc5-4710-b9ac-e846b6c634cb |\n+----------+--------------------------------------+\n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n\n\n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# nova volume-attach e9c63adc-e837-4108-b5cf-10a8f147a5ab f0990f38-8fc5-4710-b9ac-e846b6c634cb /dev/vdc >>>\n+----------+--------------------------------------+\n| Property | Value                                |\n+----------+--------------------------------------+\n| device   | /dev/vdb                             | >>>>> Still attached as /dev/vdb !!!!\n| id       | f0990f38-8fc5-4710-b9ac-e846b6c634cb |\n| serverId | e9c63adc-e837-4108-b5cf-10a8f147a5ab |\n| volumeId | f0990f38-8fc5-4710-b9ac-e846b6c634cb |\n+----------+--------------------------------------+\n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n\n\n\nIt looks like nova is not considering <device> parameter at all.\nIs it expected?\nLooking into code to reason this.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1667269", 
    "owner": "None", 
    "id": 1667269, 
    "index": 7962, 
    "openned": "2017-02-23 10:31:05.531775+00:00", 
    "created": "2017-02-23 10:31:05.531775+00:00", 
    "title": "Nova volume-attach doesnt care for <device> name given", 
    "comments": [
        {
            "content": "stack@controller:~/devstack$ nova help volume-attach\nusage: nova volume-attach <server> <volume> [<device>]\n\nAttach a volume to a server.\n\nPositional arguments:\n  <server>  Name or ID of server.\n  <volume>  ID of the volume to attach.\n  <device>  Name of the device e.g. /dev/vdb. Use \"auto\" for autoassign (if\n            supported). Libvirt driver will use default device name.\n\n\nAs shown below:\n\n[root@greglinux2 ~(keystone_admin)]# nova volume-attachments e9c63adc-e837-4108-b5cf-10a8f147a5ab\n+----+--------+-----------+-----------+\n| ID | DEVICE | SERVER ID | VOLUME ID |\n+----+--------+-----------+-----------+\n+----+--------+-----------+-----------+\n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n\n[root@greglinux2 ~(keystone_admin)]# nova volume-attach e9c63adc-e837-4108-b5cf-10a8f147a5ab f0990f38-8fc5-4710-b9ac-e846b6c634cb /dev/vdb\n+----------+--------------------------------------+\n| Property | Value                                |\n+----------+--------------------------------------+\n| device   | /dev/vdb                             |>>>>>>>>>  attached as device /dev/vdb\n| id       | f0990f38-8fc5-4710-b9ac-e846b6c634cb |\n| serverId | e9c63adc-e837-4108-b5cf-10a8f147a5ab |\n| volumeId | f0990f38-8fc5-4710-b9ac-e846b6c634cb |\n+----------+--------------------------------------+\n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n\n\n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# nova volume-attach e9c63adc-e837-4108-b5cf-10a8f147a5ab f0990f38-8fc5-4710-b9ac-e846b6c634cb /dev/vdc >>>\n+----------+--------------------------------------+\n| Property | Value                                |\n+----------+--------------------------------------+\n| device   | /dev/vdb                             | >>>>> Still attached as /dev/vdb !!!!\n| id       | f0990f38-8fc5-4710-b9ac-e846b6c634cb |\n| serverId | e9c63adc-e837-4108-b5cf-10a8f147a5ab |\n| volumeId | f0990f38-8fc5-4710-b9ac-e846b6c634cb |\n+----------+--------------------------------------+\n[root@greglinux2 ~(keystone_admin)]# \n[root@greglinux2 ~(keystone_admin)]# \n\n\n\nIt looks like nova is not considering <device> parameter at all.\nIs it expected?\nLooking into code to reason this.", 
            "date_created": "2017-02-23 10:31:05.531775+00:00", 
            "author": "https://api.launchpad.net/1.0/~nidhimittal19"
        }, 
        {
            "content": "As debug logs of python novaclient show that \n\n[root@greglinux2 cinder(keystone_admin)]# nova --debug volume-attach 31aaa8e3-3163-4f17-8ccd-f22c3c35ce95 657ed918-36ae-4ffc-a08b-275eefd0c152 /dev/vdr\n.\n.\n.\n.\nDEBUG (session:248) REQ: curl -g -i -X POST http://10.64.33.33:8774/v2/f29439bb99d54dba980631b1ef7bd8cd/servers/31aaa8e3-3163-4f17-8ccd-f22c3c35ce95/os-volume_attachments -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}f26f0791a36728ab441ffb7fff0267f4ff83d422\" -d '{\"volumeAttachment\": {\"device\": \"/dev/vdr\", \"volumeId\": \"657ed918-36ae-4ffc-a08b-275eefd0c152\"}}'\n\nDEBUG (connectionpool:395) \"POST /v2/f29439bb99d54dba980631b1ef7bd8cd/servers/31aaa8e3-3163-4f17-8ccd-f22c3c35ce95/os-volume_attachments HTTP/1.1\" 200 194\n\nDEBUG (session:277) RESP: [200] Content-Length: 194 Content-Type: application/json X-Compute-Request-Id: req-20ad8970-028b-4903-99c4-ab854c242512 Date: Wed, 05 Apr 2017 07:27:21 GMT Connection: keep-alive\n\nRESP BODY: {\"volumeAttachment\": {\"device\": \"/dev/vde\", \"serverId\": \"31aaa8e3-3163-4f17-8ccd-f22c3c35ce95\", \"id\": \"657ed918-36ae-4ffc-a08b-275eefd0c152\", \"volumeId\": \"657ed918-36ae-4ffc-a08b-275eefd0c152\"}}\n \n+----------+--------------------------------------+\n| Property | Value                                |\n+----------+--------------------------------------+\n| device   | /dev/vde                             |\n| id       | 657ed918-36ae-4ffc-a08b-275eefd0c152 |\n| serverId | 31aaa8e3-3163-4f17-8ccd-f22c3c35ce95 |\n| volumeId | 657ed918-36ae-4ffc-a08b-275eefd0c152 |\n+----------+--------------------------------------+\n\nIt shows that \"/dev/vdr\" was requested by client as device name but server prefers to ignore it.\n\n\n\nAs seen in nova server side logs :\n====================================\n\n2017-04-05 03:35:58.902 3199 WARNING nova.virt.libvirt.driver [req-90bfc957-2cb2-47e4-9018-fb0e24404f7b c2a01ca6f6f84d388dbd12c68eaa1d13 f29439bb99d54dba980631b1ef7bd8cd - - -] [instance: 31aaa8e3-3163-4f17-8ccd-f22c3c35ce95] Ignoring supplied device name: /dev/vdr  >>>>>>>>>>>>>>>>>>>>>>>>>>\n\n\n2017-04-05 03:35:58.903 3199 WARNING nova.virt.osinfo [req-90bfc957-2cb2-47e4-9018-fb0e24404f7b c2a01ca6f6f84d388dbd12c68eaa1d13 f29439bb99d54dba980631b1ef7bd8cd - - -] Cannot find OS information - Reason: (No configuration information found for operating system Empty)\n\n\n2017-04-05 03:35:59.312 3199 INFO nova.compute.manager [req-90bfc957-2cb2-47e4-9018-fb0e24404f7b c2a01ca6f6f84d388dbd12c68eaa1d13 f29439bb99d54dba980631b1ef7bd8cd - - -] [instance: 31aaa8e3-3163-4f17-8ccd-f22c3c35ce95] Attaching volume 657ed918-36ae-4ffc-a08b-275eefd0c152 to /dev/vde >>>>>>>>>>>>>>>>>>>>>>.\n\n\nWhere in code file \nnova/virt/libvirt/drivers.py \n\nwe see that if a dveice name is not none intentionally we ignore the device name coming from cli.\n\nHence i think in that case there is no use of sending device name from novaclient.\nAs we are just confusing user by asking him device name and later ignoring it intentionally.\n\nHence i m fixing it by removing device name option from shell.py in novaclient.\n\nPlease comment if opinion differs. \n \n \n \n \n", 
            "date_created": "2017-04-05 11:07:14.238103+00:00", 
            "author": "https://api.launchpad.net/1.0/~nidhimittal19"
        }, 
        {
            "content": "Kindly confirm if above suggestion suits.\nI am proceeding with above mentioned fix.", 
            "date_created": "2017-04-05 11:13:56.147823+00:00", 
            "author": "https://api.launchpad.net/1.0/~nidhimittal19"
        }, 
        {
            "content": "\nThere are no currently open reviews on this bug, changing\nthe status back to the previous state and unassigning. If\nthere are active reviews related to this bug, please include\nlinks in comments.\n", 
            "date_created": "2017-06-23 12:52:46.191216+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "The device_name was removed from the API. I think the only place it ever worked was xenserver. ", 
            "date_created": "2017-07-28 12:34:54.162517+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2017-07-28 12:34:29.852954+00:00"
}