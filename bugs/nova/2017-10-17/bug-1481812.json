{
    "status": "Fix Released", 
    "last_updated": "2016-01-21 23:18:44.063608+00:00", 
    "description": "instance test1 - test6, where test2 and test5 has been deleted:\n\n# nova list\n+--------------------------------------+-------+---------+------------+-------------+------------------+\n| ID                                   | Name  | Status  | Task State | Power State | Networks         |\n+--------------------------------------+-------+---------+------------+-------------+------------------+\n| 7e12d6a0-126f-44d0-b566-15cd5e4ab82e | test1 | SHUTOFF | -          | Shutdown    | private=10.0.0.3 |\n| 8b35f7fb-65d0-4fc3-ac22-390743c695db | test3 | ACTIVE  | -          | Running     | private=10.0.0.5 |\n| 2ab70dfe-2983-4886-a930-7deb15279763 | test4 | ACTIVE  | -          | Running     | private=10.0.0.6 |\n| 489e22cf-5e22-43a4-8c46-438f62d66e59 | test6 | ACTIVE  | -          | Running     | private=10.0.0.8 |\n+--------------------------------------+-------+---------+------------+-------------+------------------+\n\n# Get all instances with changes-since=2015-01-01 :\n# curl -s -H \"X-Auth-Token:92ecba357e5b49f88a21cedfa63bf36e\" 'http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers?changes-since=2015-01-01';\n{\"servers\": [{\"id\": \"489e22cf-5e22-43a4-8c46-438f62d66e59\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/489e22cf-5e22-43a4-8c46-438f62d66e59\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/489e22cf-5e22-43a4-8c46-438f62d66e59\", \"rel\": \"bookmark\"}], \"name\": \"test6\"}, {\"id\": \"9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"bookmark\"}], \"name\": \"test5\"}, {\"id\": \"2ab70dfe-2983-4886-a930-7deb15279763\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/2ab70dfe-2983-4886-a930-7deb15279763\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/2ab70dfe-2983-4886-a930-7deb15279763\", \"rel\": \"bookmark\"}], \"name\": \"test4\"}, {\"id\": \"8b35f7fb-65d0-4fc3-ac22-390743c695db\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/8b35f7fb-65d0-4fc3-ac22-390743c695db\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/8b35f7fb-65d0-4fc3-ac22-390743c695db\", \"rel\": \"bookmark\"}], \"name\": \"test3\"}, {\"id\": \"18d9ffbb-e1d4-4218-bb66-f792aab4e091\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/18d9ffbb-e1d4-4218-bb66-f792aab4e091\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/18d9ffbb-e1d4-4218-bb66-f792aab4e091\", \"rel\": \"bookmark\"}], \"name\": \"test2\"}, {\"id\": \"7e12d6a0-126f-44d0-b566-15cd5e4ab82e\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/7e12d6a0-126f-44d0-b566-15cd5e4ab82e\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/7e12d6a0-126f-44d0-b566-15cd5e4ab82e\", \"rel\": \"bookmark\"}], \"name\": \"test1\"}]}\n\n# query the instances in junks of 2 with changes-since and limit=2\n\n# curl -s -H \"X-Auth-Token:92ecba357e5b49f88a21cedfa63bf36e\" 'http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers?changes-since=2015-01-01&limit=2';\n{\"servers_links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers?changes-since=2015-01-01&limit=2&marker=9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"next\"}], \"servers\": [{\"id\": \"489e22cf-5e22-43a4-8c46-438f62d66e59\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/489e22cf-5e22-43a4-8c46-438f62d66e59\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/489e22cf-5e22-43a4-8c46-438f62d66e59\", \"rel\": \"bookmark\"}], \"name\": \"test6\"}, {\"id\": \"9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"bookmark\"}], \"name\": \"test5\"}]}\n\n=> returns instance test6 and test5(deleted)\n\n# use instance test5 (deleted) from previous query as a marker to get the next 2:\n\n# curl -s -H \"X-Auth-Token:92ecba357e5b49f88a21cedfa63bf36e\" 'http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers?changes-since=2015-01-01&limit=2&marker=9bda60eb-6ff7-4b84-b081-0120b62155a3';\n{\"badRequest\": {\"message\": \"marker [9bda60eb-6ff7-4b84-b081-0120b62155a3] not found\", \"code\": 400}}\n\n=> marker not found!\n\nRelated to  https://bugs.launchpad.net/nova/+bug/1398086  where fix has been submitted to resolve status=deleted&marker=X", 
    "tags": [
        "db", 
        "in-stable-kilo"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1481812", 
    "owner": "https://api.launchpad.net/1.0/~mschuppert", 
    "id": 1481812, 
    "index": 4317, 
    "openned": "2015-08-05 15:06:15.725417+00:00", 
    "created": "2015-08-05 15:06:15.725417+00:00", 
    "title": "nova servers pagination does not work with changes-since and deleted marker", 
    "comments": [
        {
            "content": "instance test1 - test6, where test2 and test5 has been deleted:\n\n# nova list\n+--------------------------------------+-------+---------+------------+-------------+------------------+\n| ID                                   | Name  | Status  | Task State | Power State | Networks         |\n+--------------------------------------+-------+---------+------------+-------------+------------------+\n| 7e12d6a0-126f-44d0-b566-15cd5e4ab82e | test1 | SHUTOFF | -          | Shutdown    | private=10.0.0.3 |\n| 8b35f7fb-65d0-4fc3-ac22-390743c695db | test3 | ACTIVE  | -          | Running     | private=10.0.0.5 |\n| 2ab70dfe-2983-4886-a930-7deb15279763 | test4 | ACTIVE  | -          | Running     | private=10.0.0.6 |\n| 489e22cf-5e22-43a4-8c46-438f62d66e59 | test6 | ACTIVE  | -          | Running     | private=10.0.0.8 |\n+--------------------------------------+-------+---------+------------+-------------+------------------+\n\n# Get all instances with changes-since=2015-01-01 :\n# curl -s -H \"X-Auth-Token:92ecba357e5b49f88a21cedfa63bf36e\" 'http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers?changes-since=2015-01-01';\n{\"servers\": [{\"id\": \"489e22cf-5e22-43a4-8c46-438f62d66e59\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/489e22cf-5e22-43a4-8c46-438f62d66e59\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/489e22cf-5e22-43a4-8c46-438f62d66e59\", \"rel\": \"bookmark\"}], \"name\": \"test6\"}, {\"id\": \"9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"bookmark\"}], \"name\": \"test5\"}, {\"id\": \"2ab70dfe-2983-4886-a930-7deb15279763\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/2ab70dfe-2983-4886-a930-7deb15279763\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/2ab70dfe-2983-4886-a930-7deb15279763\", \"rel\": \"bookmark\"}], \"name\": \"test4\"}, {\"id\": \"8b35f7fb-65d0-4fc3-ac22-390743c695db\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/8b35f7fb-65d0-4fc3-ac22-390743c695db\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/8b35f7fb-65d0-4fc3-ac22-390743c695db\", \"rel\": \"bookmark\"}], \"name\": \"test3\"}, {\"id\": \"18d9ffbb-e1d4-4218-bb66-f792aab4e091\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/18d9ffbb-e1d4-4218-bb66-f792aab4e091\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/18d9ffbb-e1d4-4218-bb66-f792aab4e091\", \"rel\": \"bookmark\"}], \"name\": \"test2\"}, {\"id\": \"7e12d6a0-126f-44d0-b566-15cd5e4ab82e\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/7e12d6a0-126f-44d0-b566-15cd5e4ab82e\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/7e12d6a0-126f-44d0-b566-15cd5e4ab82e\", \"rel\": \"bookmark\"}], \"name\": \"test1\"}]}\n\n# query the instances in junks of 2 with changes-since and limit=2\n\n# curl -s -H \"X-Auth-Token:92ecba357e5b49f88a21cedfa63bf36e\" 'http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers?changes-since=2015-01-01&limit=2';\n{\"servers_links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers?changes-since=2015-01-01&limit=2&marker=9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"next\"}], \"servers\": [{\"id\": \"489e22cf-5e22-43a4-8c46-438f62d66e59\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/489e22cf-5e22-43a4-8c46-438f62d66e59\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/489e22cf-5e22-43a4-8c46-438f62d66e59\", \"rel\": \"bookmark\"}], \"name\": \"test6\"}, {\"id\": \"9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"links\": [{\"href\": \"http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers/9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"self\"}, {\"href\": \"http://10.10.180.210:8774/30d2b54aa8f64bc2a1577c992c16271a/servers/9bda60eb-6ff7-4b84-b081-0120b62155a3\", \"rel\": \"bookmark\"}], \"name\": \"test5\"}]}\n\n=> returns instance test6 and test5(deleted)\n\n# use instance test5 (deleted) from previous query as a marker to get the next 2:\n\n# curl -s -H \"X-Auth-Token:92ecba357e5b49f88a21cedfa63bf36e\" 'http://10.10.180.210:8774/v2/30d2b54aa8f64bc2a1577c992c16271a/servers?changes-since=2015-01-01&limit=2&marker=9bda60eb-6ff7-4b84-b081-0120b62155a3';\n{\"badRequest\": {\"message\": \"marker [9bda60eb-6ff7-4b84-b081-0120b62155a3] not found\", \"code\": 400}}\n\n=> marker not found!\n\nRelated to  https://bugs.launchpad.net/nova/+bug/1398086  where fix has been submitted to resolve status=deleted&marker=X", 
            "date_created": "2015-08-05 15:06:15.725417+00:00", 
            "author": "https://api.launchpad.net/1.0/~mschuppert"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/209554", 
            "date_created": "2015-08-05 15:16:07.370067+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hmm, looks like we forbid users to list deleted instances (when done by simple \"nova list\"), but at the same time passing \"changes-since\" allows to circumvent that.\n\nubuntu@rpodolyaka-devstack-tempest:~/devstack$ nova list --deleted\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks                                               |\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n| 0fc22f61-a55e-46de-87fd-94a1e7b2141c | demo | ACTIVE | -          | Running     | private=10.0.0.5, fdad:2959:8cd7:0:f816:3eff:fe04:522d |\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n\nubuntu@rpodolyaka-devstack-tempest:~/devstack$ curl -s -H \"X-Auth-Token: e9819485d45f428c8e52c03b22460cc9\" -X GET http://192.168.0.13:8774/v2/dc3cad5a802b4ba1b86f8562d2f91c0d/servers?changes-since=2015-01-01\\&limit=2 | python -m json.tool\n{\n    \"servers\": [\n        {\n            \"id\": \"0fc22f61-a55e-46de-87fd-94a1e7b2141c\",\n            \"links\": [\n                {\n                    \"href\": \"http://192.168.0.13:8774/v2/dc3cad5a802b4ba1b86f8562d2f91c0d/servers/0fc22f61-a55e-46de-87fd-94a1e7b2141c\",\n                    \"rel\": \"self\"\n                },\n                {\n                    \"href\": \"http://192.168.0.13:8774/dc3cad5a802b4ba1b86f8562d2f91c0d/servers/0fc22f61-a55e-46de-87fd-94a1e7b2141c\",\n                    \"rel\": \"bookmark\"\n                }\n            ],\n            \"name\": \"demo\"\n        },\n        {\n            \"id\": \"7c837fc6-3503-4ae0-b474-1b1e55ca446a\",\n            \"links\": [\n                {\n                    \"href\": \"http://192.168.0.13:8774/v2/dc3cad5a802b4ba1b86f8562d2f91c0d/servers/7c837fc6-3503-4ae0-b474-1b1e55ca446a\",\n                    \"rel\": \"self\"\n                },\n                {\n                    \"href\": \"http://192.168.0.13:8774/dc3cad5a802b4ba1b86f8562d2f91c0d/servers/7c837fc6-3503-4ae0-b474-1b1e55ca446a\",\n                    \"rel\": \"bookmark\"\n                }\n            ],\n            \"name\": \"tempest-heat-319343001-Server-f5bl4lw4ejln\"\n        }\n    ],\n    \"servers_links\": [\n        {\n            \"href\": \"http://192.168.0.13:8774/v2/dc3cad5a802b4ba1b86f8562d2f91c0d/servers?changes-since=2015-01-01&limit=2&marker=7c837fc6-3503-4ae0-b474-1b1e55ca446a\",\n            \"rel\": \"next\"\n        }\n    ]\n}\n\nStill, when marker is passed, the deleted entry will be invisible to the user and cause the error.", 
            "date_created": "2015-08-06 17:15:11.424905+00:00", 
            "author": "https://api.launchpad.net/1.0/~rpodolyaka"
        }, 
        {
            "content": "This issue is not just for non admin users. It also fails for admin users who can query the deleted instances and it fails when using the marker for a deleted instance as well.\n\nThis is related to what has been already merged in https://bugs.launchpad.net/nova/+bug/1398086 / https://review.openstack.org/#/c/139306/ when status=deleted&marker= is being used.", 
            "date_created": "2015-08-07 13:00:03.597547+00:00", 
            "author": "https://api.launchpad.net/1.0/~mschuppert"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/212614", 
            "date_created": "2015-08-13 16:09:16.378607+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Martin Schuppert (<email address hidden>) on branch: master\nReview: https://review.openstack.org/212614\nReason: sorry, mistake in submit the commit", 
            "date_created": "2015-08-14 06:03:52.248690+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/209554\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=901c223f351310b38fa17aa1c3dcd758ce897e5e\nSubmitter: Jenkins\nBranch:    master\n\ncommit 901c223f351310b38fa17aa1c3dcd758ce897e5e\nAuthor: Martin Schuppert <email address hidden>\nDate:   Wed Aug 5 17:10:14 2015 +0200\n\n    Make pagination tolerate a deleted marker\n    \n    Currently, Nova does not paginate correctly if the marker is\n    a deleted server. When trying to get servers with such a\n    marker, a \"BadRequest\" error saying that the marker is\n    not found will be raised.\n    \n    We now always pass read_deleted=yes if a marker is being used.\n    \n    Change-Id: I79a1fb79a38ac4006db622590574308aafdcb5b5\n    Closes-bug: #1481812\n    Related-Bug: #1398086\n", 
            "date_created": "2015-08-14 20:17:51.681933+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/kilo\nReview: https://review.openstack.org/214986", 
            "date_created": "2015-08-20 07:09:04.155249+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/214986\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8fccffda596e7f332f7f4a440bd75c8607a7ef14\nSubmitter: Jenkins\nBranch:    stable/kilo\n\ncommit 8fccffda596e7f332f7f4a440bd75c8607a7ef14\nAuthor: Martin Schuppert <email address hidden>\nDate:   Wed Aug 5 17:10:14 2015 +0200\n\n    Make pagination tolerate a deleted marker\n    \n    Currently, Nova does not paginate correctly if the marker is\n    a deleted server. When trying to get servers with such a\n    marker, a \"BadRequest\" error saying that the marker is\n    not found will be raised.\n    \n    We now always pass read_deleted=yes if a marker is being used.\n    \n    Change-Id: I79a1fb79a38ac4006db622590574308aafdcb5b5\n    Closes-bug: #1481812\n    Related-Bug: #1398086\n    (cherry picked from commit 901c223f351310b38fa17aa1c3dcd758ce897e5e)\n", 
            "date_created": "2015-09-21 19:36:34.376790+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-09-03 11:47:24.703875+00:00"
}