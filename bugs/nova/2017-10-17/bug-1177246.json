{
    "status": "Invalid", 
    "last_updated": "2014-10-08 09:46:57.803698+00:00", 
    "description": "When i try to filter instances by IP  using the command nova list --ip , very often I am getting the error \"ERROR: The server has either erred or is incapable of performing the requested operation\". \n\nThe log file shows below error:\n\n2013-05-03 05:14:12.958 ERROR nova.openstack.common.rpc.amqp [req-95962172-06b1-474c-b9fb-8a6b5abc545a 08a2606ac80d45e19a2cd319fb147b2a d9cf934ffbcc48c4ac0b1b08838ccd57] Exception during message handling\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 465, in get_instance_uuids_by_ip_filter\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     for floating_ip in fixed_ip.get('floating_ips', []):\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/db/sqlalchemy/models.py\", line 63, in get\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     return getattr(self, key, default)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.7/site-packages/sqlalchemy/orm/attributes.py\", line 168, in __get__\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     return self.impl.get(instance_state(instance),dict_)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.7/site-packages/sqlalchemy/orm/attributes.py\", line 453, in get\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     value = self.callable_(state, passive)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.7/site-packages/sqlalchemy/orm/strategies.py\", line 481, in _load_for_state\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     (mapperutil.state_str(state), self.key)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp DetachedInstanceError: Parent instance <FixedIp at 0x43a1a90> is not bound to a Session; lazy load operation of attribute 'floating_ips' cannot proceed\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp\n2013-05-03 05:14:12.984 ERROR nova.openstack.common.rpc.common [req-95962172-06b1-474c-b9fb-8a6b5abc545a 08a2606ac80d45e19a2cd319fb147b2a d9cf934ffbcc48c4ac0b1b08838ccd57] Returning exception Parent instance <FixedIp at 0x43a1a90> is not bound to a Session; lazy load operation of attribute 'floating_ips' cannot proceed to caller", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1177246", 
    "owner": "https://api.launchpad.net/1.0/~satya-patibandla", 
    "id": 1177246, 
    "index": 4903, 
    "openned": "2013-05-07 06:52:38.198177+00:00", 
    "created": "2013-05-07 06:52:38.198177+00:00", 
    "title": "nova list --ip command returns 'ERROR: The server has either erred or is incapable of performing the requested operation'. ", 
    "comments": [
        {
            "content": "When i try to filter instances by IP  using the command nova list --ip , very often I am getting the error \"ERROR: The server has either erred or is incapable of performing the requested operation\". \n\nThe log file shows below error:\n\n2013-05-03 05:14:12.958 ERROR nova.openstack.common.rpc.amqp [req-95962172-06b1-474c-b9fb-8a6b5abc545a 08a2606ac80d45e19a2cd319fb147b2a d9cf934ffbcc48c4ac0b1b08838ccd57] Exception during message handling\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 465, in get_instance_uuids_by_ip_filter\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     for floating_ip in fixed_ip.get('floating_ips', []):\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/db/sqlalchemy/models.py\", line 63, in get\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     return getattr(self, key, default)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.7/site-packages/sqlalchemy/orm/attributes.py\", line 168, in __get__\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     return self.impl.get(instance_state(instance),dict_)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.7/site-packages/sqlalchemy/orm/attributes.py\", line 453, in get\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     value = self.callable_(state, passive)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.7/site-packages/sqlalchemy/orm/strategies.py\", line 481, in _load_for_state\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp     (mapperutil.state_str(state), self.key)\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp DetachedInstanceError: Parent instance <FixedIp at 0x43a1a90> is not bound to a Session; lazy load operation of attribute 'floating_ips' cannot proceed\n2013-05-03 05:14:12.958 12308 TRACE nova.openstack.common.rpc.amqp\n2013-05-03 05:14:12.984 ERROR nova.openstack.common.rpc.common [req-95962172-06b1-474c-b9fb-8a6b5abc545a 08a2606ac80d45e19a2cd319fb147b2a d9cf934ffbcc48c4ac0b1b08838ccd57] Returning exception Parent instance <FixedIp at 0x43a1a90> is not bound to a Session; lazy load operation of attribute 'floating_ips' cannot proceed to caller", 
            "date_created": "2013-05-07 06:52:38.198177+00:00", 
            "author": "https://api.launchpad.net/1.0/~satya-patibandla-i"
        }, 
        {
            "content": "What version of nova are you using?", 
            "date_created": "2013-05-07 21:16:49.851271+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "I am able to reproduce this issue with latest master build.", 
            "date_created": "2013-06-01 08:14:46.810035+00:00", 
            "author": "https://api.launchpad.net/1.0/~satya-patibandla"
        }, 
        {
            "content": "Unable to reproduce the bug. Can you please eloborate the steps to reproduce and the environment details.\r\n\r\nWe are following the below steps to reproduce the bug. ( Grizzly )\r\n\r\n1. glance --os-username=admin --os-password=secrete --os-tenant-name=demo --osauth-url=http://192.168.206.130:5000/v2.0 image-create --name=\"CirrOS 0.3.1\" --disk-format=qcow2 \\\r\n--container-format bare < cirros-0.3.1-x86_64-disk.img\r\n\r\n( We have tried with different combinations of disk-format and container-format )\r\n\r\n2.   nova list --ip <random-ip-generated-in-nova list-command>\r\n\r\nWe have never faced any error. Please let us know, if it is already fixed or if it is not reproducable on grizzly now.", 
            "date_created": "2013-10-25 09:19:01.769707+00:00", 
            "author": "https://api.launchpad.net/1.0/~anusha-rayani-7"
        }, 
        {
            "content": "It seems this issue got fixed in latest release build. In recent builds I did not find this issue. Hence closing the bug as Invalid. ", 
            "date_created": "2013-10-25 09:35:44.129004+00:00", 
            "author": "https://api.launchpad.net/1.0/~satya-patibandla"
        }, 
        {
            "content": "Reproduced in stable/havana.\n\nA quick and dirty patch that fixes this bug:\n\ndiff --git a/nova/db/sqlalchemy/api.py b/nova/db/sqlalchemy/api.py\nindex 48044e2..f59dc15 100644\n--- a/nova/db/sqlalchemy/api.py\n+++ b/nova/db/sqlalchemy/api.py\n@@ -1383,6 +1383,7 @@ def fixed_ip_get_by_network_host(context, network_id, host):\n @require_context\n def fixed_ips_by_virtual_interface(context, vif_id):\n     result = model_query(context, models.FixedIp, read_deleted=\"no\").\\\n+                 options(joinedload('floating_ips')).\\\n                  filter_by(virtual_interface_id=vif_id).\\\n                  all()\n", 
            "date_created": "2014-10-08 09:46:56.891523+00:00", 
            "author": "https://api.launchpad.net/1.0/~wenjianhn"
        }
    ], 
    "closed": "2013-10-25 10:31:04.013889+00:00"
}