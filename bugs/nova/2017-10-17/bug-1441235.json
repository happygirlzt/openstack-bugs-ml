{
    "status": "Confirmed", 
    "last_updated": "2015-05-05 19:49:51.721049+00:00", 
    "description": "With the latest code, cluster as  the compute driver, Taking a  snapshot is failing with following error :\n\nERROR oslo_messaging.rpc.dispatcher [req-9c49bfdd-641c-4022-90cc-aae697e387f3 admin admin] Exception during message handling: Error occurred while opening URL: https://10.1.214.7/nfc/52135ab3-7409-6a9c-30ba-65f00d264262/disk-1.vmdk for reading.\nCause: HTTPSConnectionPool(host='10.1.214.7', port=443): Max retries exceeded with url: /nfc/52135ab3-7409-6a9c-30ba-65f00d264262/disk-1.vmdk (Caused by ProxyError('Cannot connect to proxy.', error('Tunnel connection failed: 503 Service Unavailable',)))\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 324, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance_uuid=instance_uuid)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 295, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 352, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 340, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 400, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     instance=instance)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 390, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     *args, **kwargs)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 3201, in snapshot_instance\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     task_states.IMAGE_SNAPSHOT)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 3231, in _snapshot_instance\n2015-04-07 2\n\n1:16:47.166 TRACE oslo_messaging.rpc.dispatcher     update_task_state)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 506, in snapshot\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     self._vmops.snapshot(context, instance, image_id, update_task_state)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/vmops.py\", line 833, in snapshot\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     vmdk_size=vmdk.capacity_in_bytes)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/images.py\", line 457, in upload_image_stream_optimized\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     vmdk_size)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_vmware/rw_handles.py\", line 500, in __init__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     cacerts=cacerts)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_vmware/rw_handles.py\", line 79, in _create_read_connection\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     raise exceptions.VimException(excep_msg, excep)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher VimException: Error occurred while opening URL: https://10.1.214.7/nfc/52135ab3-7409-6a9c-30ba-65f00d264262/disk-1.vmdk for reading.\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher Cause: HTTPSConnectionPool(host='10.1.214.7', port=443): Max retries exceeded with url: /nfc/52135ab3-7409-6a9c-30ba-65f00d264262/disk-1.vmdk (Caused by ProxyError('Cannot connect to proxy.', error('Tunnel connection failed: 503 Service Unavailable',)))\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher\n\ngit log -1 : \ncommit bf70df295b0529da9f4381f52fc94d328fa2fdb3\nMerge: ad329b0 7560620\nAuthor: Jenkins <email address hidden>\nDate:   Mon Apr 6 23:57:10 2015 +0000\n\n\u00a0\u00a0\u00a0\u00a0Merge \"neutronv2: only create client once when adding/removing fixed IPs\"\n\n\nEnvironment : VC 5.5 U1, ESXi 5.5.0, 1834933\n\n\nIs this an environment issue ? Export OVS template task is stuck for a long time and it fails, attached the snapshot.", 
    "tags": [
        "vmware"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1441235", 
    "owner": "None", 
    "id": 1441235, 
    "index": 1672, 
    "openned": "2015-04-07 15:56:40.653190+00:00", 
    "created": "2015-04-07 15:56:40.653190+00:00", 
    "title": "VMware: Fail to take a snapshot of a VM", 
    "comments": [
        {
            "content": "With the latest code, cluster as  the compute driver, Taking a  snapshot is failing with following error : \n\nERROR oslo_messaging.rpc.dispatcher [req-9c49bfdd-641c-4022-90cc-aae697e387f3 admin admin] Exception during message handling: Error occurred while opening URL: https://10.1.214.7/nfc/52135ab3-7409-6a9c-30ba-65f00d264262/disk-1.vmdk for reading.\nCause: HTTPSConnectionPool(host='10.1.214.7', port=443): Max retries exceeded with url: /nfc/52135ab3-7409-6a9c-30ba-65f00d264262/disk-1.vmdk (Caused by ProxyError('Cannot connect to proxy.', error('Tunnel connection failed: 503 Service Unavailable',)))\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 324, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance_uuid=instance_uuid)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 295, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 352, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 340, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 400, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     instance=instance)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 390, in decorated_function\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     *args, **kwargs)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 3201, in snapshot_instance\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     task_states.IMAGE_SNAPSHOT)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 3231, in _snapshot_instance\n2015-04-07 2\n\n\n1:16:47.166 TRACE oslo_messaging.rpc.dispatcher     update_task_state)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 506, in snapshot\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     self._vmops.snapshot(context, instance, image_id, update_task_state)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/vmops.py\", line 833, in snapshot\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     vmdk_size=vmdk.capacity_in_bytes)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/virt/vmwareapi/images.py\", line 457, in upload_image_stream_optimized\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     vmdk_size)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_vmware/rw_handles.py\", line 500, in __init__\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     cacerts=cacerts)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_vmware/rw_handles.py\", line 79, in _create_read_connection\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher     raise exceptions.VimException(excep_msg, excep)\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher VimException: Error occurred while opening URL: https://10.1.214.7/nfc/52135ab3-7409-6a9c-30ba-65f00d264262/disk-1.vmdk for reading.\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher Cause: HTTPSConnectionPool(host='10.1.214.7', port=443): Max retries exceeded with url: /nfc/52135ab3-7409-6a9c-30ba-65f00d264262/disk-1.vmdk (Caused by ProxyError('Cannot connect to proxy.', error('Tunnel connection failed: 503 Service Unavailable',)))\n2015-04-07 21:16:47.166 TRACE oslo_messaging.rpc.dispatcher\n\n\n\ngit log -1\ncommit bf70df295b0529da9f4381f52fc94d328fa2fdb3\nMerge: ad329b0 7560620\nAuthor: Jenkins <email address hidden>\nDate:   Mon Apr 6 23:57:10 2015 +0000\n\n    Merge \"neutronv2: only create client once when adding/removing fixed IPs\"\n\n\nAttaching errors shown in vcenter", 
            "date_created": "2015-04-07 15:56:40.653190+00:00", 
            "author": "https://api.launchpad.net/1.0/~acbharadwaj"
        }, 
        {
            "content": "", 
            "date_created": "2015-04-07 15:56:40.653190+00:00", 
            "author": "https://api.launchpad.net/1.0/~acbharadwaj"
        }, 
        {
            "content": "", 
            "date_created": "2015-04-07 15:58:58.645729+00:00", 
            "author": "https://api.launchpad.net/1.0/~acbharadwaj"
        }, 
        {
            "content": "On further debugging, checking the ESXi hostd logs, contains this error\n\n2015-04-17T06:28:49.081Z [FFD60920 verbose 'Vmsvc.vm:/vmfs/volumes/535f3d61-7c0442d6-56c9-62552a500042/OSTACK_SNAP_3dce2adb-fbe0-49ff-a606-aed25f69c875/OSTACK_SNAP_3dce2adb-fbe0-49ff-a606-aed25f69c875.vmx' opID=2a248111-4f-bb user=vpxuser] Is disk present message: Expected device (ide0:1) does not exist. \n\nOSTACK_SNAP_3dce2adb-fbe0-49ff-a606-aed25f69c875 is the name of the OVF template which is being created as part of CreateSnapshot_Task\n\nThe OVF template does not get created and hence snapshot operation fails\n\nChanged the adapter type to \"lsiLogic\" in glance image, still the same error\n\n2015-04-17T07:02:25.686Z [2A440B70 verbose 'Vmsvc.vm:/vmfs/volumes/535f3d61-7c0442d6-56c9-62552a500042/OSTACK_SNAP_ce9e74ed-c847-4bc6-8d47-10b8e924d3a1/OSTACK_SNAP_ce9e74ed-c847-4bc6-8d47-10b8e924d3a1.vmx' opID=74009579-27-56 user=vpxuser] Is disk present message: Expected device (scsi0:0) does not exist.\n\nThe issue is occurring on devstack - nova master branch\n\nGlance image property\nchinmay@ChinmayDevstack:~/devstack$ glance image-show 9e4f5f08-364c-4f9e-ac4c-67642e228665\n+-------------------------------+--------------------------------------+\n| Property                      | Value                                |\n+-------------------------------+--------------------------------------+\n| Property 'hw_vif_model'       | e1000                                |\n| Property 'vmware_adaptertype' | lsiLogic                             |\n| Property 'vmware_disktype'    | sparse                               |\n| checksum                      | 3fd19141ff969dcb4926b610769e5ba4     |\n| container_format              | bare                                 |\n| created_at                    | 2015-04-15T11:19:00.000000           |\n| deleted                       | False                                |\n| disk_format                   | vmdk                                 |\n| id                            | 9e4f5f08-364c-4f9e-ac4c-67642e228665 |\n| is_public                     | True                                 |\n| min_disk                      | 0                                    |\n| min_ram                       | 0                                    |\n| name                          | cirros-0.3.2-i386-disk               |\n| owner                         | e4cad1de0bb44f5fbfe1ad11fb24e3c2     |\n| protected                     | False                                |\n| size                          | 17104896                             |\n| status                        | active                               |\n| updated_at                    | 2015-04-17T07:01:58.000000           |\n+-------------------------------+--------------------------------------+\n\n", 
            "date_created": "2015-04-17 07:10:39.570937+00:00", 
            "author": "https://api.launchpad.net/1.0/~sagar-r-nikam"
        }, 
        {
            "content": "The hostd log on ESXi host", 
            "date_created": "2015-04-17 07:12:46.928465+00:00", 
            "author": "https://api.launchpad.net/1.0/~sagar-r-nikam"
        }
    ]
}