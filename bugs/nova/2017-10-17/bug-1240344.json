{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 08:52:23.368944+00:00", 
    "description": "Currently, when libvirt connection is broken, there is no meaningful exception being thrown. Instead, every call result in a mutlple traces, as below.\nThis makes it imposible to handle these exceptions properly in the higher levels.\n\n2013-10-11 15:06:25.179 DEBUG nova.virt.libvirt.driver [req-cd22b4f2-0bfe-4d93-b191-02736ac8a437 None None] Connecting to libvirt: qemu:///system from (pid=28433) _get_connection /home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py:600\n2013-10-11 15:06:25.180 ERROR nova.virt.libvirt.driver [-] Connection to libvirt failed: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver Traceback (most recent call last):\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 694, in _connect\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver     return libvirt.openAuth(uri, auth, flags)\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 102, in openAuth\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver     if ret is None:raise libvirtError('virConnectOpenAuth() failed')\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver libvirtError: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver \n----------------------------------------------------------------------------------------------------------\n2013-10-11 15:06:25.188 WARNING nova.virt.libvirt.driver [req-cd22b4f2-0bfe-4d93-b191-02736ac8a437 None None] URI qemu:///system does not support events\nTraceback (most recent call last):\n  File \"/usr/lib64/python2.7/logging/__init__.py\", line 851, in emit\n2013-10-11 15:06:25.190 ERROR nova.openstack.common.periodic_task [req-cd22b4f2-0bfe-4d93-b191-02736ac8a437 None None] Error during ComputeManager.update_available_resource: 'N\noneType' object has no attribute 'getInfo'\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task Traceback (most recent call last):\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/openstack/common/periodic_task.py\", line 180, in run_periodic_\ntasks\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     task(self, context)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/compute/manager.py\", line 4867, in update_available_resource\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     rt.update_available_resource(context)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     return f(*args, **kwargs)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/compute/resource_tracker.py\", line 274, in update_available_resource\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     resources = self.driver.get_available_resource(self.nodename)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 3744, in get_available_resource\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     stats = self.host_state.get_host_stats(refresh=True)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 4779, in get_host_stats\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     self.update_status()\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 4813, in update_status\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     data[\"memory_mb\"] = self.driver.get_memory_mb_total()\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 3383, in get_memory_mb_total\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     return self._conn.getInfo()[1]\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task AttributeError: 'NoneType' object has no attribute 'getInfo'\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task \nq", 
    "tags": [
        "libvirt"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1240344", 
    "owner": "https://api.launchpad.net/1.0/~vladik-romanovsky", 
    "id": 1240344, 
    "index": 5458, 
    "openned": "2013-10-16 05:20:20.066115+00:00", 
    "created": "2013-10-16 05:20:20.066115+00:00", 
    "title": "Libvirt driver should reply with a meaningful exception, when connection to libvirt is broken", 
    "comments": [
        {
            "content": "Currently, when libvirt connection is broken, there is no meaningful exception being thrown. Instead, every call result in a mutlple traces, as below.\nThis makes it imposible to handle these exceptions properly in the higher levels.\n\n2013-10-11 15:06:25.179 DEBUG nova.virt.libvirt.driver [req-cd22b4f2-0bfe-4d93-b191-02736ac8a437 None None] Connecting to libvirt: qemu:///system from (pid=28433) _get_connection /home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py:600\n2013-10-11 15:06:25.180 ERROR nova.virt.libvirt.driver [-] Connection to libvirt failed: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver Traceback (most recent call last):\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 694, in _connect\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver     return libvirt.openAuth(uri, auth, flags)\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 102, in openAuth\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver     if ret is None:raise libvirtError('virConnectOpenAuth() failed')\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver libvirtError: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory\n2013-10-11 15:06:25.180 TRACE nova.virt.libvirt.driver \n----------------------------------------------------------------------------------------------------------\n2013-10-11 15:06:25.188 WARNING nova.virt.libvirt.driver [req-cd22b4f2-0bfe-4d93-b191-02736ac8a437 None None] URI qemu:///system does not support events\nTraceback (most recent call last):\n  File \"/usr/lib64/python2.7/logging/__init__.py\", line 851, in emit\n2013-10-11 15:06:25.190 ERROR nova.openstack.common.periodic_task [req-cd22b4f2-0bfe-4d93-b191-02736ac8a437 None None] Error during ComputeManager.update_available_resource: 'N\noneType' object has no attribute 'getInfo'\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task Traceback (most recent call last):\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/openstack/common/periodic_task.py\", line 180, in run_periodic_\ntasks\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     task(self, context)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/compute/manager.py\", line 4867, in update_available_resource\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     rt.update_available_resource(context)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     return f(*args, **kwargs)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/compute/resource_tracker.py\", line 274, in update_available_resource\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     resources = self.driver.get_available_resource(self.nodename)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 3744, in get_available_resource\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     stats = self.host_state.get_host_stats(refresh=True)\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 4779, in get_host_stats\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     self.update_status()\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 4813, in update_status\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     data[\"memory_mb\"] = self.driver.get_memory_mb_total()\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task   File \"/home/vladikr/devel/openstack/nova/nova/virt/libvirt/driver.py\", line 3383, in get_memory_mb_total\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task     return self._conn.getInfo()[1]\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task AttributeError: 'NoneType' object has no attribute 'getInfo'\n2013-10-11 15:06:25.190 TRACE nova.openstack.common.periodic_task \nq", 
            "date_created": "2013-10-16 05:20:20.066115+00:00", 
            "author": "https://api.launchpad.net/1.0/~vladik-romanovsky"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/52184\nCommitted: http://github.com/openstack/nova/commit/86be0b7fdf1af20403e0d763b86da06849bcc437\nSubmitter: Jenkins\nBranch:    master\n\ncommit 86be0b7fdf1af20403e0d763b86da06849bcc437\nAuthor: Vladik Romanovsky <email address hidden>\nDate:   Tue Oct 22 11:12:37 2013 -0400\n\n    Reply with a meaningful exception, when libvirt connection is broken.\n    \n    Libvirt driver will respond with a meaningful error on any\n    command, when the connection to the libvirt service is broken.\n    \n    Closes-bug: #1240344\n    Change-Id: I823fefaffcf969ecf9eb853ac99dc18cef92d137\n", 
            "date_created": "2013-10-23 23:26:18.968748+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-12-04 10:35:38.528431+00:00"
}