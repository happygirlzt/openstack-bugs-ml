{
    "status": "Fix Released", 
    "last_updated": "2017-01-27 00:50:55.656726+00:00", 
    "description": "When the compute is ironic driver  and the shceduler is configured with \npci passthrough filter the vm get to an error state and we can see the following error in the scheduler\n\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server [req-d627c45c-a5cf-47bc-a8d1-fe4669516380 admin admin] Exception during message handling\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 155, in _process_incoming\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 218, in inner\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     return func(*args, **kwargs)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 84, in select_destinations\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     dests = self.driver.select_destinations(ctxt, spec_obj)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 51, in select_destinations\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     selected_hosts = self._schedule(context, spec_obj)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 103, in _schedule\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     spec_obj, index=num)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/host_manager.py\", line 572, in get_filtered_hosts\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     hosts, spec_obj, index)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/filters.py\", line 89, in get_filtered_objects\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     list_objs = list(objs)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/filters.py\", line 44, in filter_all\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     if self._filter_one(obj, spec_obj):\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/filters/__init__.py\", line 26, in _filter_one\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     return self.host_passes(obj, filter_properties)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/filters/pci_passthrough_filter.py\", line 48, in host_passes\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     if not host_state.pci_stats.support_requests(pci_requests.requests):\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server AttributeError: 'NoneType' object has no attribute 'support_requests'", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1658078", 
    "owner": "https://api.launchpad.net/1.0/~moshele", 
    "id": 1658078, 
    "index": 4740, 
    "openned": "2017-01-20 12:19:03.042731+00:00", 
    "created": "2017-01-20 12:19:03.042731+00:00", 
    "title": "AttributeError: 'NoneType' object has no attribute 'support_requests'", 
    "comments": [
        {
            "content": "When the compute is ironic driver  and the shceduler is configured with \npci passthrough filter the vm get to an error state and we can see the following error in the scheduler\n\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server [req-d627c45c-a5cf-47bc-a8d1-fe4669516380 admin admin] Exception during message handling\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 155, in _process_incoming\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 218, in inner\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     return func(*args, **kwargs)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 84, in select_destinations\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     dests = self.driver.select_destinations(ctxt, spec_obj)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 51, in select_destinations\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     selected_hosts = self._schedule(context, spec_obj)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 103, in _schedule\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     spec_obj, index=num)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/host_manager.py\", line 572, in get_filtered_hosts\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     hosts, spec_obj, index)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/filters.py\", line 89, in get_filtered_objects\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     list_objs = list(objs)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/filters.py\", line 44, in filter_all\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     if self._filter_one(obj, spec_obj):\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/filters/__init__.py\", line 26, in _filter_one\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     return self.host_passes(obj, filter_properties)\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/scheduler/filters/pci_passthrough_filter.py\", line 48, in host_passes\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server     if not host_state.pci_stats.support_requests(pci_requests.requests):\n2017-01-19 06:00:35.887 105364 ERROR oslo_messaging.rpc.server AttributeError: 'NoneType' object has no attribute 'support_requests'", 
            "date_created": "2017-01-20 12:19:03.042731+00:00", 
            "author": "https://api.launchpad.net/1.0/~moshele"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/423608", 
            "date_created": "2017-01-21 09:34:07.007118+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/423608\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8d11cba5edcb71b530ea9af3afa697870bcfac3a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8d11cba5edcb71b530ea9af3afa697870bcfac3a\nAuthor: Moshe Levi <email address hidden>\nDate:   Sat Jan 21 11:27:36 2017 +0200\n\n    PCI: Check pci_requests object is empty before passing to support_requests\n    \n    This commit checks that InstancePCIRequests is empty before\n    passing it to the pci_stats.support_requests.\n    This prevents doing the support request check for host_state\n    which don't have pci_stats like ironic host.\n    \n    Closes-Bug: #1658078\n    \n    Change-Id: Ie6d870729883e2bbdc3278c52e88d147613712f6\n", 
            "date_created": "2017-01-26 09:21:25.161437+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b3 development milestone.", 
            "date_created": "2017-01-27 00:50:55.108479+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-01-26 09:21:23.134595+00:00"
}