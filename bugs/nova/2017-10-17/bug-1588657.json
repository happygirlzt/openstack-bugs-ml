{
    "status": "Fix Released", 
    "last_updated": "2017-06-16 17:28:28.143603+00:00", 
    "description": "Description\n===========\n\nNova shelve creates duplicated images in cells environment.\nI think, this behavior is caused by below patch.\n(not reproduced in icehouse version)\n\ncommit 394ac5eea215831e82f96d43177442af67b40bb4\n\nI modified source code like below, and restart nova-api. It seems working fine.\n\ndiff --git a/nova/compute/cells_api.py b/nova/compute/cells_api.py\nindex 175ece2..4fe44a3 100644\n--- a/nova/compute/cells_api.py\n+++ b/nova/compute/cells_api.py\n@@ -322,8 +322,6 @@ class ComputeCellsAPI(compute_api.API):\n\u00a0\u00a0\u00a0\u00a0\u00a0@check_instance_cell\n\u00a0\u00a0\u00a0\u00a0\u00a0def shelve(self, context, instance, clean_shutdown=True):\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"\"\"Shelve the given instance.\"\"\"\n-        super(ComputeCellsAPI, self).shelve(context, instance,\n-                clean_shutdown=clean_shutdown)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0self._cast_to_cells(context, instance, 'shelve',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0clean_shutdown=clean_shutdown)\n\nSteps to reproduce\n==================\n\n1. Create cells environment (ex. using devstack)\n\n2. Create vm by Nova\n\nopenstack@localhost:~$ nova list\n+--------------------------------------+---------+--------+------------+-------------+--------------------------------+\n| ID                                   | Name    | Status | Task State | Power State | Networks                       |\n+--------------------------------------+---------+--------+------------+-------------+--------------------------------+\n| a520a4a7-6991-40e1-885a-bd3138c2b5dc | test-vm | ACTIVE | -          | Running     | public=2001:db8::4, 172.24.4.4 |\n+--------------------------------------+---------+--------+------------+-------------+--------------------------------+\n\n3. Execute nova shelve to vm\n\nopenstack@localhost:~$ nova shelve test-vm\nopenstack@localhost:~$ nova list\n+--------------------------------------+---------+-------------------+------------+-------------+--------------------------------+\n| ID                                   | Name    | Status            | Task State | Power State | Networks                       |\n+--------------------------------------+---------+-------------------+------------+-------------+--------------------------------+\n| a520a4a7-6991-40e1-885a-bd3138c2b5dc | test-vm | SHELVED_OFFLOADED | -          | Shutdown    | public=2001:db8::4, 172.24.4.4 |\n+--------------------------------------+---------+-------------------+------------+-------------+--------------------------------+\n\n4. Two images which is named <vmname>-shelved are created in glance\n\nopenstack@localhost:~$ glance image-list\n+--------------------------------------+---------------------------------+\n| ID                                   | Name                            |\n+--------------------------------------+---------------------------------+\n| 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a | cirros-0.3.4-x86_64-uec         |\n| ffc958ac-7435-42a4-9dc6-b42a7c518c2e | cirros-0.3.4-x86_64-uec-kernel  |\n| 51378b3f-86f6-4d70-a22e-768599eafc09 | cirros-0.3.4-x86_64-uec-ramdisk |\n| 42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e | test-vm-shelved                 |\n| cc06acba-0911-49ec-86c2-d08c1084fbbe | test-vm-shelved                 |\n+--------------------------------------+---------------------------------+\n\n5. Only an glance image is used for nova-shelve.\n\nopenstack@localhost:~$ glance image-show 42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| base_image_ref   | 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a |\n| checksum         | None                                 |\n| container_format | ami                                  |\n| created_at       | 2016-06-03T06:16:32Z                 |\n| disk_format      | ami                                  |\n| id               | 42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e |\n| image_type       | snapshot                             |\n| instance_uuid    | a520a4a7-6991-40e1-885a-bd3138c2b5dc |\n| kernel_id        | ffc958ac-7435-42a4-9dc6-b42a7c518c2e |\n| min_disk         | 1                                    |\n| min_ram          | 0                                    |\n| name             | test-vm-shelved                      |\n| owner            | 73af4afafeae4d5189d8190a8e876418     |\n| protected        | False                                |\n| ramdisk_id       | 51378b3f-86f6-4d70-a22e-768599eafc09 |\n| size             | 0                                    |\n| status           | queued                               |\n| tags             | []                                   |\n| updated_at       | 2016-06-03T06:16:32Z                 |\n| user_id          | c4954683e8244a0f84f509b8f3d63a4d     |\n| virtual_size     | None                                 |\n| visibility       | private                              |\n+------------------+--------------------------------------+\nopenstack@localhost:~$ glance image-show cc06acba-0911-49ec-86c2-d08c1084fbbe\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| base_image_ref   | 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a |\n| checksum         | ac94fabcc66952b36066eebc6af577d6     |\n| container_format | ami                                  |\n| created_at       | 2016-06-03T06:16:33Z                 |\n| disk_format      | ami                                  |\n| id               | cc06acba-0911-49ec-86c2-d08c1084fbbe |\n| image_location   | snapshot                             |\n| image_state      | available                            |\n| image_type       | snapshot                             |\n| instance_uuid    | a520a4a7-6991-40e1-885a-bd3138c2b5dc |\n| kernel_id        | ffc958ac-7435-42a4-9dc6-b42a7c518c2e |\n| min_disk         | 1                                    |\n| min_ram          | 0                                    |\n| name             | test-vm-shelved                      |\n| owner            | 73af4afafeae4d5189d8190a8e876418     |\n| owner_id         | 73af4afafeae4d5189d8190a8e876418     |\n| protected        | False                                |\n| ramdisk_id       | 51378b3f-86f6-4d70-a22e-768599eafc09 |\n| size             | 10682368                             |\n| status           | active                               |\n| tags             | []                                   |\n| updated_at       | 2016-06-03T06:17:02Z                 |\n| user_id          | c4954683e8244a0f84f509b8f3d63a4d     |\n| virtual_size     | None                                 |\n| visibility       | private                              |\n+------------------+--------------------------------------+\n\nExpected result\n===============\n\n* Only an image is created\n\nopenstack@localhost:~$ glance image-list\n+--------------------------------------+---------------------------------+\n| ID                                   | Name                            |\n+--------------------------------------+---------------------------------+\n| 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a | cirros-0.3.4-x86_64-uec         |\n| ffc958ac-7435-42a4-9dc6-b42a7c518c2e | cirros-0.3.4-x86_64-uec-kernel  |\n| 51378b3f-86f6-4d70-a22e-768599eafc09 | cirros-0.3.4-x86_64-uec-ramdisk |\n| cc06acba-0911-49ec-86c2-d08c1084fbbe | test-vm-shelved                 |\n+--------------------------------------+---------------------------------+\n\nActual result\n=============\n\n* Duplicated image is created on glance\n\nopenstack@localhost:~$ glance image-list\n+--------------------------------------+---------------------------------+\n| ID                                   | Name                            |\n+--------------------------------------+---------------------------------+\n| 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a | cirros-0.3.4-x86_64-uec         |\n| ffc958ac-7435-42a4-9dc6-b42a7c518c2e | cirros-0.3.4-x86_64-uec-kernel  |\n| 51378b3f-86f6-4d70-a22e-768599eafc09 | cirros-0.3.4-x86_64-uec-ramdisk |\n| 42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e | test-vm-shelved                 |\n| cc06acba-0911-49ec-86c2-d08c1084fbbe | test-vm-shelved                 |\n+--------------------------------------+---------------------------------+\n\nEnvironment\n===========\n\n* Devstack with cell\n** This is snippet of localrc\n\nENABLED_SERVICES=g-api,g-reg,key,n-api,n-cpu,n-cell,n-net,n-cond,n-sch,n-novnc,n-cauth,mysql,neutron,q-svc,q-agt,q-dhcp,q-l3,q-meta,horizon,s-proxy,s-object,s-container,s-account,rabbit\n\n* nova version\n** This is on stable/liberty\n\ngit log -1\nc5d0d2d0f4940d2e9f5888d7229fa4ac202ff161\n\nLogs & Configs\n==============\n\n* Duplicated image is created on nova-api\n\n2016-06-03 02:16:32.537 DEBUG glanceclient.common.http [req-c7963aa0-f38a-4580-98b2-fc1464adabed admin admin] curl -g -i -X POST -H 'x-image-meta-property-user_id: c4954683e8244a0f84f509b8f3d63a4d' -H 'X-Auth-Token: {SHA1}0d0ff6398ca7d37\n52cf85f625b8009e3373c20af' -H 'Accept: */*' -H 'User-Agent: python-glanceclient' -H 'x-image-meta-name: test-vm-shelved' -H 'x-image-meta-container_format: ami' -H 'X-Tenant-Id: 73af4afafeae4d5189d8190a8e876418' -H 'x-image-meta-property\n-image_type: snapshot' -H 'X-User-Id: c4954683e8244a0f84f509b8f3d63a4d' -H 'x-image-meta-min_ram: 0' -H 'Accept-Encoding: gzip, deflate' -H 'x-image-meta-property-instance_uuid: a520a4a7-6991-40e1-885a-bd3138c2b5dc' -H 'x-image-meta-prop\nerty-ramdisk_id: 51378b3f-86f6-4d70-a22e-768599eafc09' -H 'Connection: keep-alive' -H 'x-image-meta-property-kernel_id: ffc958ac-7435-42a4-9dc6-b42a7c518c2e' -H 'x-image-meta-min_disk: 1' -H 'X-Roles: admin' -H 'x-image-meta-property-bas\ne_image_ref: 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a' -H 'x-image-meta-is_public: False' -H 'X-Identity-Status: Confirmed' -H 'Content-Type: application/octet-stream' -H 'x-image-meta-disk_format: ami' http://192.168.56.101:9292/v1/images from (pid=16454) log_curl_request /usr/lib/python2.7/site-packages/glanceclient/common/http.py:189\n2016-06-03 02:16:32.770 DEBUG glanceclient.common.http [req-c7963aa0-f38a-4580-98b2-fc1464adabed admin admin]\nHTTP/1.1 201 Created\nContent-Length: 755\nConnection: keep-alive\nLocation: http://192.168.56.101:9292/v1/images/42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e\nDate: Fri, 03 Jun 2016 06:16:32 GMT\nContent-Type: application/json\nX-Openstack-Request-Id: req-d1bd0257-5771-4f4b-8ca2-25e1284664d9\n\n{\"image\": {\"status\": \"queued\", \"deleted\": false, \"container_format\": \"ami\", \"min_ram\": 0, \"updated_at\": \"2016-06-03T06:16:32.000000\", \"owner\": \"73af4afafeae4d5189d8190a8e876418\", \"min_disk\": 1, \"is_public\": false, \"deleted_at\": null, \"id\n\": \"42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e\", \"size\": 0, \"virtual_size\": null, \"name\": \"test-vm-shelved\", \"checksum\": null, \"created_at\": \"2016-06-03T06:16:32.000000\", \"disk_format\": \"ami\", \"properties\": {\"instance_uuid\": \"a520a4a7-6991-40e\n1-885a-bd3138c2b5dc\", \"user_id\": \"c4954683e8244a0f84f509b8f3d63a4d\", \"image_type\": \"snapshot\", \"ramdisk_id\": \"51378b3f-86f6-4d70-a22e-768599eafc09\", \"kernel_id\": \"ffc958ac-7435-42a4-9dc6-b42a7c518c2e\", \"base_image_ref\": \"3a106d4e-0b55-4e\n84-990a-a8aa4ae68c2a\"}, \"protected\": false}}\n\n* nova-cell(child) also creates the image\n\n2016-06-03 02:16:32.973 DEBUG glanceclient.common.http [req-c7963aa0-f38a-4580-98b2-fc1464adabed admin admin] curl -g -i -X POST -H 'x-image-meta-property-user_id: c4954683e8244a0f84f509b8f3d63a4d' -H 'X-Auth-Token: {SHA1}0d0ff6398ca7d37\n52cf85f625b8009e3373c20af' -H 'Accept: */*' -H 'User-Agent: python-glanceclient' -H 'x-image-meta-name: test-vm-shelved' -H 'x-image-meta-container_format: ami' -H 'X-Tenant-Id: 73af4afafeae4d5189d8190a8e876418' -H 'x-image-meta-property\n-image_type: snapshot' -H 'X-User-Id: c4954683e8244a0f84f509b8f3d63a4d' -H 'x-image-meta-min_ram: 0' -H 'Accept-Encoding: gzip, deflate' -H 'x-image-meta-property-instance_uuid: a520a4a7-6991-40e1-885a-bd3138c2b5dc' -H 'x-image-meta-prop\nerty-ramdisk_id: 51378b3f-86f6-4d70-a22e-768599eafc09' -H 'Connection: keep-alive' -H 'x-image-meta-property-kernel_id: ffc958ac-7435-42a4-9dc6-b42a7c518c2e' -H 'x-image-meta-min_disk: 1' -H 'X-Roles: admin' -H 'x-image-meta-property-bas\ne_image_ref: 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a' -H 'x-image-meta-is_public: False' -H 'X-Identity-Status: Confirmed' -H 'Content-Type: application/octet-stream' -H 'x-image-meta-disk_format: ami' http://192.168.56.101:9292/v1/images f\nrom (pid=31995) log_curl_request /usr/lib/python2.7/site-packages/glanceclient/common/http.py:189\n2016-06-03 02:16:33.045 DEBUG glanceclient.common.http [req-c7963aa0-f38a-4580-98b2-fc1464adabed admin admin]\nHTTP/1.1 201 Created\nContent-Length: 755\nConnection: keep-alive\nLocation: http://192.168.56.101:9292/v1/images/cc06acba-0911-49ec-86c2-d08c1084fbbe\nDate: Fri, 03 Jun 2016 06:16:33 GMT\nContent-Type: application/json\nX-Openstack-Request-Id: req-fa0bde4b-c741-4922-8c40-741d3a4576c2\n\n{\"image\": {\"status\": \"queued\", \"deleted\": false, \"container_format\": \"ami\", \"min_ram\": 0, \"updated_at\": \"2016-06-03T06:16:33.000000\", \"owner\": \"73af4afafeae4d5189d8190a8e876418\", \"min_disk\": 1, \"is_public\": false, \"deleted_at\": null, \"id\n\": \"cc06acba-0911-49ec-86c2-d08c1084fbbe\", \"size\": 0, \"virtual_size\": null, \"name\": \"test-vm-shelved\", \"checksum\": null, \"created_at\": \"2016-06-03T06:16:33.000000\", \"disk_format\": \"ami\", \"properties\": {\"instance_uuid\": \"a520a4a7-6991-40e\n1-885a-bd3138c2b5dc\", \"user_id\": \"c4954683e8244a0f84f509b8f3d63a4d\", \"image_type\": \"snapshot\", \"ramdisk_id\": \"51378b3f-86f6-4d70-a22e-768599eafc09\", \"kernel_id\": \"ffc958ac-7435-42a4-9dc6-b42a7c518c2e\", \"base_image_ref\": \"3a106d4e-0b55-4e\n84-990a-a8aa4ae68c2a\"}, \"protected\": false}}\n\n* Config\n** set 'glanceclient=DEBUG' to show glanceclient log on nova-cell\n\nnova-cells.conf\n\n\u00a0[DEFAULT]\n\u00a0default_log_levels=amqp=DEBUG,amqplib=DEBUG,boto=WARN,qpid=WARN,sqlalchemy=WARN,suds=INFO,oslo.messaging=DEBUG,iso8601=WARN,glanceclient=DEBUG", 
    "tags": [
        "cells", 
        "mitaka-backport-potential", 
        "shelve"
    ], 
    "importance": "Low", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1588657", 
    "owner": "https://api.launchpad.net/1.0/~honjo-rikimaru-c6", 
    "id": 1588657, 
    "index": 2015, 
    "openned": "2016-06-03 06:50:13.096432+00:00", 
    "created": "2016-06-03 06:50:13.096432+00:00", 
    "title": "Nova shelve creates duplicated images in cells environment", 
    "comments": [
        {
            "content": "Description\n===========\n\nNova shelve creates duplicated images in cells environment.\nI think, this behavior is caused by below patch.\n(not reproduced in icehouse version)\n\ncommit 394ac5eea215831e82f96d43177442af67b40bb4\n\nI modified source code like below, and restart nova-api. It seems working fine.\n\ndiff --git a/nova/compute/cells_api.py b/nova/compute/cells_api.py\nindex 175ece2..4fe44a3 100644\n--- a/nova/compute/cells_api.py\n+++ b/nova/compute/cells_api.py\n@@ -322,8 +322,6 @@ class ComputeCellsAPI(compute_api.API):\n     @check_instance_cell\n     def shelve(self, context, instance, clean_shutdown=True):\n         \"\"\"Shelve the given instance.\"\"\"\n-        super(ComputeCellsAPI, self).shelve(context, instance,\n-                clean_shutdown=clean_shutdown)\n         self._cast_to_cells(context, instance, 'shelve',\n                 clean_shutdown=clean_shutdown)\n\nSteps to reproduce\n==================\n\n1. Create cells environment (ex. using devstack)\n\n2. Create vm by Nova\n\nopenstack@localhost:~$ nova list\n+--------------------------------------+---------+--------+------------+-------------+--------------------------------+\n| ID                                   | Name    | Status | Task State | Power State | Networks                       |\n+--------------------------------------+---------+--------+------------+-------------+--------------------------------+\n| a520a4a7-6991-40e1-885a-bd3138c2b5dc | test-vm | ACTIVE | -          | Running     | public=2001:db8::4, 172.24.4.4 |\n+--------------------------------------+---------+--------+------------+-------------+--------------------------------+\n\n3. Execute nova shelve to vm\n\nopenstack@localhost:~$ nova shelve test-vm\nopenstack@localhost:~$ nova list\n+--------------------------------------+---------+-------------------+------------+-------------+--------------------------------+\n| ID                                   | Name    | Status            | Task State | Power State | Networks                       |\n+--------------------------------------+---------+-------------------+------------+-------------+--------------------------------+\n| a520a4a7-6991-40e1-885a-bd3138c2b5dc | test-vm | SHELVED_OFFLOADED | -          | Shutdown    | public=2001:db8::4, 172.24.4.4 |\n+--------------------------------------+---------+-------------------+------------+-------------+--------------------------------+\n\n4. Two images which is named <vmname>-shelved are created in glance\n\nopenstack@localhost:~$ glance image-list\n+--------------------------------------+---------------------------------+\n| ID                                   | Name                            |\n+--------------------------------------+---------------------------------+\n| 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a | cirros-0.3.4-x86_64-uec         |\n| ffc958ac-7435-42a4-9dc6-b42a7c518c2e | cirros-0.3.4-x86_64-uec-kernel  |\n| 51378b3f-86f6-4d70-a22e-768599eafc09 | cirros-0.3.4-x86_64-uec-ramdisk |\n| 42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e | test-vm-shelved                 |\n| cc06acba-0911-49ec-86c2-d08c1084fbbe | test-vm-shelved                 |\n+--------------------------------------+---------------------------------+\n\n5. Only an glance image is used for nova-shelve.\n\nopenstack@localhost:~$ glance image-show 42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| base_image_ref   | 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a |\n| checksum         | None                                 |\n| container_format | ami                                  |\n| created_at       | 2016-06-03T06:16:32Z                 |\n| disk_format      | ami                                  |\n| id               | 42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e |\n| image_type       | snapshot                             |\n| instance_uuid    | a520a4a7-6991-40e1-885a-bd3138c2b5dc |\n| kernel_id        | ffc958ac-7435-42a4-9dc6-b42a7c518c2e |\n| min_disk         | 1                                    |\n| min_ram          | 0                                    |\n| name             | test-vm-shelved                      |\n| owner            | 73af4afafeae4d5189d8190a8e876418     |\n| protected        | False                                |\n| ramdisk_id       | 51378b3f-86f6-4d70-a22e-768599eafc09 |\n| size             | 0                                    |\n| status           | queued                               |\n| tags             | []                                   |\n| updated_at       | 2016-06-03T06:16:32Z                 |\n| user_id          | c4954683e8244a0f84f509b8f3d63a4d     |\n| virtual_size     | None                                 |\n| visibility       | private                              |\n+------------------+--------------------------------------+\nopenstack@localhost:~$ glance image-show cc06acba-0911-49ec-86c2-d08c1084fbbe\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| base_image_ref   | 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a |\n| checksum         | ac94fabcc66952b36066eebc6af577d6     |\n| container_format | ami                                  |\n| created_at       | 2016-06-03T06:16:33Z                 |\n| disk_format      | ami                                  |\n| id               | cc06acba-0911-49ec-86c2-d08c1084fbbe |\n| image_location   | snapshot                             |\n| image_state      | available                            |\n| image_type       | snapshot                             |\n| instance_uuid    | a520a4a7-6991-40e1-885a-bd3138c2b5dc |\n| kernel_id        | ffc958ac-7435-42a4-9dc6-b42a7c518c2e |\n| min_disk         | 1                                    |\n| min_ram          | 0                                    |\n| name             | test-vm-shelved                      |\n| owner            | 73af4afafeae4d5189d8190a8e876418     |\n| owner_id         | 73af4afafeae4d5189d8190a8e876418     |\n| protected        | False                                |\n| ramdisk_id       | 51378b3f-86f6-4d70-a22e-768599eafc09 |\n| size             | 10682368                             |\n| status           | active                               |\n| tags             | []                                   |\n| updated_at       | 2016-06-03T06:17:02Z                 |\n| user_id          | c4954683e8244a0f84f509b8f3d63a4d     |\n| virtual_size     | None                                 |\n| visibility       | private                              |\n+------------------+--------------------------------------+\n\nExpected result\n===============\n\n* Only a image is created\n\nopenstack@localhost:~$ glance image-list\n+--------------------------------------+---------------------------------+\n| ID                                   | Name                            |\n+--------------------------------------+---------------------------------+\n| 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a | cirros-0.3.4-x86_64-uec         |\n| ffc958ac-7435-42a4-9dc6-b42a7c518c2e | cirros-0.3.4-x86_64-uec-kernel  |\n| 51378b3f-86f6-4d70-a22e-768599eafc09 | cirros-0.3.4-x86_64-uec-ramdisk |\n| cc06acba-0911-49ec-86c2-d08c1084fbbe | test-vm-shelved                 |\n+--------------------------------------+---------------------------------+\n\nActual result\n=============\n\n* Duplicated image is created on glance\n\nopenstack@localhost:~$ glance image-list\n+--------------------------------------+---------------------------------+\n| ID                                   | Name                            |\n+--------------------------------------+---------------------------------+\n| 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a | cirros-0.3.4-x86_64-uec         |\n| ffc958ac-7435-42a4-9dc6-b42a7c518c2e | cirros-0.3.4-x86_64-uec-kernel  |\n| 51378b3f-86f6-4d70-a22e-768599eafc09 | cirros-0.3.4-x86_64-uec-ramdisk |\n| 42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e | test-vm-shelved                 |\n| cc06acba-0911-49ec-86c2-d08c1084fbbe | test-vm-shelved                 |\n+--------------------------------------+---------------------------------+\n\nEnvironment\n===========\n\n* Devstack with cell\n** This is snippet of localrc\n\nENABLED_SERVICES=g-api,g-reg,key,n-api,n-cpu,n-cell,n-net,n-cond,n-sch,n-novnc,n-cauth,mysql,neutron,q-svc,q-agt,q-dhcp,q-l3,q-meta,horizon,s-proxy,s-object,s-container,s-account,rabbit\n\n* nova version\n** This is on stable/liberty\n\ngit log -1\nc5d0d2d0f4940d2e9f5888d7229fa4ac202ff161\n\nLogs & Configs\n==============\n\n* Duplicated image is created on nova-api\n\n2016-06-03 02:16:32.537 DEBUG glanceclient.common.http [req-c7963aa0-f38a-4580-98b2-fc1464adabed admin admin] curl -g -i -X POST -H 'x-image-meta-property-user_id: c4954683e8244a0f84f509b8f3d63a4d' -H 'X-Auth-Token: {SHA1}0d0ff6398ca7d37\n52cf85f625b8009e3373c20af' -H 'Accept: */*' -H 'User-Agent: python-glanceclient' -H 'x-image-meta-name: test-vm-shelved' -H 'x-image-meta-container_format: ami' -H 'X-Tenant-Id: 73af4afafeae4d5189d8190a8e876418' -H 'x-image-meta-property\n-image_type: snapshot' -H 'X-User-Id: c4954683e8244a0f84f509b8f3d63a4d' -H 'x-image-meta-min_ram: 0' -H 'Accept-Encoding: gzip, deflate' -H 'x-image-meta-property-instance_uuid: a520a4a7-6991-40e1-885a-bd3138c2b5dc' -H 'x-image-meta-prop\nerty-ramdisk_id: 51378b3f-86f6-4d70-a22e-768599eafc09' -H 'Connection: keep-alive' -H 'x-image-meta-property-kernel_id: ffc958ac-7435-42a4-9dc6-b42a7c518c2e' -H 'x-image-meta-min_disk: 1' -H 'X-Roles: admin' -H 'x-image-meta-property-bas\ne_image_ref: 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a' -H 'x-image-meta-is_public: False' -H 'X-Identity-Status: Confirmed' -H 'Content-Type: application/octet-stream' -H 'x-image-meta-disk_format: ami' http://192.168.56.101:9292/v1/images from (pid=16454) log_curl_request /usr/lib/python2.7/site-packages/glanceclient/common/http.py:189\n2016-06-03 02:16:32.770 DEBUG glanceclient.common.http [req-c7963aa0-f38a-4580-98b2-fc1464adabed admin admin]\nHTTP/1.1 201 Created\nContent-Length: 755\nConnection: keep-alive\nLocation: http://192.168.56.101:9292/v1/images/42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e\nDate: Fri, 03 Jun 2016 06:16:32 GMT\nContent-Type: application/json\nX-Openstack-Request-Id: req-d1bd0257-5771-4f4b-8ca2-25e1284664d9\n\n{\"image\": {\"status\": \"queued\", \"deleted\": false, \"container_format\": \"ami\", \"min_ram\": 0, \"updated_at\": \"2016-06-03T06:16:32.000000\", \"owner\": \"73af4afafeae4d5189d8190a8e876418\", \"min_disk\": 1, \"is_public\": false, \"deleted_at\": null, \"id\n\": \"42a6f2b0-c1b4-43d2-95c8-45e7c2d6ca3e\", \"size\": 0, \"virtual_size\": null, \"name\": \"test-vm-shelved\", \"checksum\": null, \"created_at\": \"2016-06-03T06:16:32.000000\", \"disk_format\": \"ami\", \"properties\": {\"instance_uuid\": \"a520a4a7-6991-40e\n1-885a-bd3138c2b5dc\", \"user_id\": \"c4954683e8244a0f84f509b8f3d63a4d\", \"image_type\": \"snapshot\", \"ramdisk_id\": \"51378b3f-86f6-4d70-a22e-768599eafc09\", \"kernel_id\": \"ffc958ac-7435-42a4-9dc6-b42a7c518c2e\", \"base_image_ref\": \"3a106d4e-0b55-4e\n84-990a-a8aa4ae68c2a\"}, \"protected\": false}}\n\n* nova-cell(child) also creates the image\n\n2016-06-03 02:16:32.973 DEBUG glanceclient.common.http [req-c7963aa0-f38a-4580-98b2-fc1464adabed admin admin] curl -g -i -X POST -H 'x-image-meta-property-user_id: c4954683e8244a0f84f509b8f3d63a4d' -H 'X-Auth-Token: {SHA1}0d0ff6398ca7d37\n52cf85f625b8009e3373c20af' -H 'Accept: */*' -H 'User-Agent: python-glanceclient' -H 'x-image-meta-name: test-vm-shelved' -H 'x-image-meta-container_format: ami' -H 'X-Tenant-Id: 73af4afafeae4d5189d8190a8e876418' -H 'x-image-meta-property\n-image_type: snapshot' -H 'X-User-Id: c4954683e8244a0f84f509b8f3d63a4d' -H 'x-image-meta-min_ram: 0' -H 'Accept-Encoding: gzip, deflate' -H 'x-image-meta-property-instance_uuid: a520a4a7-6991-40e1-885a-bd3138c2b5dc' -H 'x-image-meta-prop\nerty-ramdisk_id: 51378b3f-86f6-4d70-a22e-768599eafc09' -H 'Connection: keep-alive' -H 'x-image-meta-property-kernel_id: ffc958ac-7435-42a4-9dc6-b42a7c518c2e' -H 'x-image-meta-min_disk: 1' -H 'X-Roles: admin' -H 'x-image-meta-property-bas\ne_image_ref: 3a106d4e-0b55-4e84-990a-a8aa4ae68c2a' -H 'x-image-meta-is_public: False' -H 'X-Identity-Status: Confirmed' -H 'Content-Type: application/octet-stream' -H 'x-image-meta-disk_format: ami' http://192.168.56.101:9292/v1/images f\nrom (pid=31995) log_curl_request /usr/lib/python2.7/site-packages/glanceclient/common/http.py:189\n2016-06-03 02:16:33.045 DEBUG glanceclient.common.http [req-c7963aa0-f38a-4580-98b2-fc1464adabed admin admin]\nHTTP/1.1 201 Created\nContent-Length: 755\nConnection: keep-alive\nLocation: http://192.168.56.101:9292/v1/images/cc06acba-0911-49ec-86c2-d08c1084fbbe\nDate: Fri, 03 Jun 2016 06:16:33 GMT\nContent-Type: application/json\nX-Openstack-Request-Id: req-fa0bde4b-c741-4922-8c40-741d3a4576c2\n\n{\"image\": {\"status\": \"queued\", \"deleted\": false, \"container_format\": \"ami\", \"min_ram\": 0, \"updated_at\": \"2016-06-03T06:16:33.000000\", \"owner\": \"73af4afafeae4d5189d8190a8e876418\", \"min_disk\": 1, \"is_public\": false, \"deleted_at\": null, \"id\n\": \"cc06acba-0911-49ec-86c2-d08c1084fbbe\", \"size\": 0, \"virtual_size\": null, \"name\": \"test-vm-shelved\", \"checksum\": null, \"created_at\": \"2016-06-03T06:16:33.000000\", \"disk_format\": \"ami\", \"properties\": {\"instance_uuid\": \"a520a4a7-6991-40e\n1-885a-bd3138c2b5dc\", \"user_id\": \"c4954683e8244a0f84f509b8f3d63a4d\", \"image_type\": \"snapshot\", \"ramdisk_id\": \"51378b3f-86f6-4d70-a22e-768599eafc09\", \"kernel_id\": \"ffc958ac-7435-42a4-9dc6-b42a7c518c2e\", \"base_image_ref\": \"3a106d4e-0b55-4e\n84-990a-a8aa4ae68c2a\"}, \"protected\": false}}\n\n* Config\n** set 'glanceclient=DEBUG' to show glanceclient log on nova-cell\n\nnova-cells.conf\n\n [DEFAULT]\n default_log_levels=amqp=DEBUG,amqplib=DEBUG,boto=WARN,qpid=WARN,sqlalchemy=WARN,suds=INFO,oslo.messaging=DEBUG,iso8601=WARN,glanceclient=DEBUG", 
            "date_created": "2016-06-03 06:50:13.096432+00:00", 
            "author": "https://api.launchpad.net/1.0/~miki-ryo-e"
        }, 
        {
            "content": "For the most part we've said we won't fix latent bugs in cells v1:\n\nhttp://docs.openstack.org/developer/nova/cells.html#status\n\nHowever, this looks like a regression and potentially trivial fix, so we should let it in.", 
            "date_created": "2016-06-03 19:08:47.016398+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Hey Ryo, \n\nIf you think that your changes to source code fix all the problems described in this bug, then please commit your changes so that I can unassign myself from this bug. \n\nIf not, I'd like to spend some more time as a newbie, learning about Nova and Cells codebase as a part of resolving this bug.", 
            "date_created": "2016-06-06 11:37:31.333037+00:00", 
            "author": "https://api.launchpad.net/1.0/~vipulnayyar"
        }, 
        {
            "content": "Hello Vipul,\n\nI think my code fixes all of the problem, so I can push the patch.\n(but, I need some time to add a unit test too.)\n\nIf it's alright with you, I'll assign myself.\n", 
            "date_created": "2016-06-07 09:54:57.985246+00:00", 
            "author": "https://api.launchpad.net/1.0/~miki-ryo-e"
        }, 
        {
            "content": "Sure, please go ahead and assign yourself.", 
            "date_created": "2016-06-07 10:03:18.901777+00:00", 
            "author": "https://api.launchpad.net/1.0/~vipulnayyar"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/327001", 
            "date_created": "2016-06-08 11:07:13.251687+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/327001\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=32be8108366bf47f0066deb53a5330379f6fd10c\nSubmitter: Jenkins\nBranch:    master\n\ncommit 32be8108366bf47f0066deb53a5330379f6fd10c\nAuthor: Ryo Miki <email address hidden>\nDate:   Wed Jun 8 19:29:22 2016 +0900\n\n    Nova shelve creates duplicated images in cells\n    \n    Calling super method in cells_api.py causes duplicated method call in\n    nova-api and nova-cell. I found the problem in shelve and unshelve,\n    so fix about them. (Nova cell v1 may have similar problems)\n    \n    Change-Id: I8030b6ffc1710bca733e38a9a6fb0d7de5f24268\n    Closes-bug: #1588657\n", 
            "date_created": "2016-09-23 10:41:15.178323+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/mitaka\nReview: https://review.openstack.org/375565", 
            "date_created": "2016-09-23 15:17:20.934882+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/375565\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=50cff0ddf11dda7171ed9db776d24393928b590d\nSubmitter: Jenkins\nBranch:    stable/mitaka\n\ncommit 50cff0ddf11dda7171ed9db776d24393928b590d\nAuthor: Ryo Miki <email address hidden>\nDate:   Wed Jun 8 19:29:22 2016 +0900\n\n    Nova shelve creates duplicated images in cells\n    \n    Calling super method in cells_api.py causes duplicated method call in\n    nova-api and nova-cell. I found the problem in shelve and unshelve,\n    so fix about them. (Nova cell v1 may have similar problems)\n    \n    Change-Id: I8030b6ffc1710bca733e38a9a6fb0d7de5f24268\n    Closes-bug: #1588657\n    (cherry picked from commit 32be8108366bf47f0066deb53a5330379f6fd10c)\n", 
            "date_created": "2016-10-05 00:57:31.295880+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.1.2 release.", 
            "date_created": "2016-10-10 13:19:16.057731+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.1.2 release.", 
            "date_created": "2016-11-10 02:05:49.913759+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b1 development milestone.", 
            "date_created": "2016-11-17 13:14:24.108920+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-09-23 10:41:12.341016+00:00"
}