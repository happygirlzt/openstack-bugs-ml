{
    "status": "Expired", 
    "last_updated": "2016-01-20 04:17:34.463334+00:00", 
    "description": "In nova.conf\uff0cwhen scheduler_default_filters include ComputeCapabilitiesFilter and AggregateInstanceExtraSpecsFilter, I set flavor extra_specs and aggregate1 to node_type=kvm\uff0cthen I boot an instance with this flavor\uff0cexcept the instance is assigned to hosts of aggregate1(az1) ,but the vm state is error\uff0cin scheduler log\uff1a\n2015-11-20 09:55:53.577 12227 INFO nova.filters [req-b48f1a33-fc4d-4ea2-82a4-9a827e6a7a61 bf2c688edb5d41b0ba66e1a4fe510985 db57c7f7bc7f420fb4f0c1663da05a42] Filter ComputeCapabilitiesFilter returned 0 hosts\n I think this is unreasonable\uff0cAggregateInstanceExtraSpecsFilter and ComputeCapabilitiesFilter are all check flavor extra_specs\uff0cThis causes a conflict.I expect can choose the matching host according to flavor extra_specs and aggregate metadata.\nThe ComputeCapabilitiesFilter always return 0 hosts when the flavor extra_specs add new properties.\n\ntest steps:\n1\u3001 nova aggregate-list \n+----+------------+-------------------+\n| Id | Name       | Availability Zone |\n+----+------------+-------------------+\n| 1  | aggregate1 | az1               |\n| 2  | aggregate2 | az2               |\n+----+------------+-------------------+\n2\u3001 nova aggregate-set-metadata aggregate1 node_type=kvm\nMetadata has been successfully updated for aggregate 1.\n+----+------------+-------------------+---------------------------------------+------------------------------------------+\n| Id | Name       | Availability Zone | Hosts                                 | Metadata                                 |\n+----+------------+-------------------+---------------------------------------+------------------------------------------+\n| 1  | aggregate1 | az1               | '98f537e1af0d', 'SBCR-chenling-slot4' | 'availability_zone=az1', 'node_type=kvm' |\n+----+------------+-------------------+---------------------------------------+------------------------------------------+\n3\u3001nova flavor-key 2 set node_type=kvm\n\n4\u3001add AggregateInstanceExtraSpecsFilter to scheduler_default_filters in nova.conf\nscheduler_default_filters=RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,ComputeCapabilitiesFilter,ImagePropertiesFilter,CoreFilter,PciPassthroughFilter,AggregateInstanceExtraSpecsFilter\n5.\u3001systemctl restart openstack-nova-scheduler.service\n6\u3001boot an instance\uff0cbut ComputeCapabilitiesFilter return 0 hosts\nnova boot --flavor 2 --boot-volume 8a2ba353-75a6-4eea-bf3c-35f8f42b94a2 --nic net-id=ab66d9e3-c6ee-49ec-b192-fdee4d41c088  test_vm1\nscheduler log:\n2015-11-20 09:55:53.559 12227 INFO nova.scheduler.filter_scheduler [req-b48f1a33-fc4d-4ea2-82a4-9a827e6a7a61 bf2c688edb5d41b0ba66e1a4fe510985 db57c7f7bc7f420fb4f0c1663da05a42] Attempting to build 1 instance(s) uuids: [u'70eb860d-e0ce-4202-a250-6f15ccf2021a']\n2015-11-20 09:55:53.577 12227 INFO nova.filters [req-b48f1a33-fc4d-4ea2-82a4-9a827e6a7a61 bf2c688edb5d41b0ba66e1a4fe510985 db57c7f7bc7f420fb4f0c1663da05a42] Filter ComputeCapabilitiesFilter returned 0 hosts\n2015-11-20 09:55:53.578 12227 WARNING nova.scheduler.driver [req-b48f1a33-fc4d-4ea2-82a4-9a827e6a7a61 bf2c688edb5d41b0ba66e1a4fe510985 db57c7f7bc7f420fb4f0c1663da05a42] [instance: 70eb860d-e0ce-4202-a250-6f15ccf2021a] Setting instance to ERROR state.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1518230", 
    "owner": "None", 
    "id": 1518230, 
    "index": 7126, 
    "openned": "2015-11-20 09:26:17.667717+00:00", 
    "created": "2015-11-20 09:26:17.667717+00:00", 
    "title": "AggregateInstanceExtraSpecsFilter and ComputeCapabilitiesFilter check flavor extra_specs which causes a conflict", 
    "comments": [
        {
            "content": "In nova.conf\uff0cwhen scheduler_default_filters include ComputeCapabilitiesFilter and AggregateInstanceExtraSpecsFilter, I set flavor extra_specs and aggregate1 to node_type=kvm\uff0cthen I boot an instance with this flavor\uff0cexcept the instance is assigned to hosts of aggregate1(az1) ,but the vm state is error\uff0cin scheduler log\uff1a\n2015-11-20 09:55:53.577 12227 INFO nova.filters [req-b48f1a33-fc4d-4ea2-82a4-9a827e6a7a61 bf2c688edb5d41b0ba66e1a4fe510985 db57c7f7bc7f420fb4f0c1663da05a42] Filter ComputeCapabilitiesFilter returned 0 hosts\n I think this is unreasonable\uff0cAggregateInstanceExtraSpecsFilter and ComputeCapabilitiesFilter are all check flavor extra_specs\uff0cThis causes a conflict.I expect can choose the matching host according to flavor extra_specs and aggregate metadata.\nThe ComputeCapabilitiesFilter always return 0 hosts when the flavor extra_specs add new properties.\n\ntest steps:\n1\u3001 nova aggregate-list \n+----+------------+-------------------+\n| Id | Name       | Availability Zone |\n+----+------------+-------------------+\n| 1  | aggregate1 | az1               |\n| 2  | aggregate2 | az2               |\n+----+------------+-------------------+\n2\u3001 nova aggregate-set-metadata aggregate1 node_type=kvm\nMetadata has been successfully updated for aggregate 1.\n+----+------------+-------------------+---------------------------------------+------------------------------------------+\n| Id | Name       | Availability Zone | Hosts                                 | Metadata                                 |\n+----+------------+-------------------+---------------------------------------+------------------------------------------+\n| 1  | aggregate1 | az1               | '98f537e1af0d', 'SBCR-chenling-slot4' | 'availability_zone=az1', 'node_type=kvm' |\n+----+------------+-------------------+---------------------------------------+------------------------------------------+\n3\u3001nova flavor-key 2 set node_type=kvm\n\n4\u3001add AggregateInstanceExtraSpecsFilter to scheduler_default_filters in nova.conf\nscheduler_default_filters=RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,ComputeCapabilitiesFilter,ImagePropertiesFilter,CoreFilter,PciPassthroughFilter,AggregateInstanceExtraSpecsFilter\n5.\u3001systemctl restart openstack-nova-scheduler.service\n6\u3001boot an instance\uff0cbut ComputeCapabilitiesFilter return 0 hosts\nnova boot --flavor 2 --boot-volume 8a2ba353-75a6-4eea-bf3c-35f8f42b94a2 --nic net-id=ab66d9e3-c6ee-49ec-b192-fdee4d41c088  test_vm1\nscheduler log:\n2015-11-20 09:55:53.559 12227 INFO nova.scheduler.filter_scheduler [req-b48f1a33-fc4d-4ea2-82a4-9a827e6a7a61 bf2c688edb5d41b0ba66e1a4fe510985 db57c7f7bc7f420fb4f0c1663da05a42] Attempting to build 1 instance(s) uuids: [u'70eb860d-e0ce-4202-a250-6f15ccf2021a']\n2015-11-20 09:55:53.577 12227 INFO nova.filters [req-b48f1a33-fc4d-4ea2-82a4-9a827e6a7a61 bf2c688edb5d41b0ba66e1a4fe510985 db57c7f7bc7f420fb4f0c1663da05a42] Filter ComputeCapabilitiesFilter returned 0 hosts\n2015-11-20 09:55:53.578 12227 WARNING nova.scheduler.driver [req-b48f1a33-fc4d-4ea2-82a4-9a827e6a7a61 bf2c688edb5d41b0ba66e1a4fe510985 db57c7f7bc7f420fb4f0c1663da05a42] [instance: 70eb860d-e0ce-4202-a250-6f15ccf2021a] Setting instance to ERROR state.", 
            "date_created": "2015-11-20 09:26:17.667717+00:00", 
            "author": "https://api.launchpad.net/1.0/~song-ruixia"
        }, 
        {
            "content": "You had misunderstood with the extra spec settings of aggregate filter.\nExtra spec should be wrote begin with \"aggregate_instance_extra_specs\", therefore you\nshould write it as \"aggregate_instance_extra_specs:node_type=kvm\".\nHowever in [1], it had wrote no scope will also been used to match. \nBut non-scope extra specs will been also used to match in ComputeCapabilitiesFilter.\nThen your scheduler will return no valid host found because of it can find capabilities named node_type. \nTherefore this is correct situation.\n\n[1] http://docs.openstack.org/developer/nova/filter_scheduler.html", 
            "date_created": "2015-11-20 10:53:50.073082+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyanchih"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2016-01-20 04:17:31.489416+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2016-01-20 04:17:32.120440+00:00"
}