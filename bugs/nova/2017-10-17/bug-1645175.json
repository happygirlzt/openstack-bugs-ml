{
    "status": "Fix Released", 
    "last_updated": "2017-07-28 07:41:06.368898+00:00", 
    "description": "When attach an pre created Neutron port to Nova instances and got failed, the port will be deleted in Neutron:\n\nHow to reproduce:\n\nStep 1: create a new Neutron Port:\n\nroot@SZX1000191849:/opt/stack/nova# neutron port-create e1775804-7670-482c-bf1a-309fff85f598 \nCreated a new port:\n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:host_id       |                                                                                    |\n| binding:profile       | {}                                                                                 |\n| binding:vif_details   | {}                                                                                 |\n| binding:vif_type      | unbound                                                                            |\n| binding:vnic_type     | normal                                                                             |\n| created_at            | 2016-11-28T02:20:26Z                                                               |\n| description           |                                                                                    |\n| device_id             |                                                                                    |\n| device_owner          |                                                                                    |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"6cf2ed09-8394-4e3e-81d5-3880fe1c6984\", \"ip_address\": \"172.24.4.2\"}  |\n|                       | {\"subnet_id\": \"6b3902ca-deea-46f0-97e9-80c70243413e\", \"ip_address\": \"2001:db8::6\"} |\n| id                    | fd240a85-53cb-467a-8e43-330bb5c928ab                                               |\n| mac_address           | fa:16:3e:cc:fb:9e                                                                  |\n| name                  |                                                                                    |\n| network_id            | e1775804-7670-482c-bf1a-309fff85f598                                               |\n| port_security_enabled | True                                                                               |\n| project_id            | 405a8b8100ae47ffaa89730681ee400f                                                   |\n| revision_number       | 6                                                                                  |\n| security_groups       | 9ea518bb-ee12-489a-ac6a-3434d2c081c4                                               |\n| status                | DOWN                                                                               |\n| tenant_id             | 405a8b8100ae47ffaa89730681ee400f                                                   |\n| updated_at            | 2016-11-28T02:20:27Z                                                               |\n+-----------------------+------------------------------------------------------------------------------------+\nroot@SZX1000191849:/opt/stack/nova# neutron port-list\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                               |\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n| 453879db-6bc2-4a40-89eb-588a15cf33c4 |      | fa:16:3e:19:9e:27 | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.9\"}         |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::8\"} |\n| 4cd1ad8e-86df-4454-a187-08bb3faa32ec |      | fa:16:3e:60:b4:8f | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.13\"}        |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::5\"} |\n| 74a0b31a-3a26-4b20-bdb2-0bb0d343c551 |      | fa:16:3e:12:6b:9a | {\"subnet_id\": \"6cf2ed09-8394-4e3e-81d5-3880fe1c6984\", \"ip_address\": \"172.24.4.10\"}      |\n|                                      |      |                   | {\"subnet_id\": \"6b3902ca-deea-46f0-97e9-80c70243413e\", \"ip_address\": \"2001:db8::a\"}      |\n| 8fc6af24-78f8-4234-9a5a-c348ba873aff |      | fa:16:3e:e3:25:62 | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.1\"}         |\n| eaf6a086-a146-4e45-8c4c-a54b209e80c4 |      | fa:16:3e:5d:89:bd | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.2\"}         |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::2\"} |\n| ebce0f96-984b-4890-bd6b-dc561973b615 |      | fa:16:3e:da:1b:7f | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::1\"} |\n| fd240a85-53cb-467a-8e43-330bb5c928ab |      | fa:16:3e:cc:fb:9e | {\"subnet_id\": \"6cf2ed09-8394-4e3e-81d5-3880fe1c6984\", \"ip_address\": \"172.24.4.2\"}       |\n|                                      |      |                   | {\"subnet_id\": \"6b3902ca-deea-46f0-97e9-80c70243413e\", \"ip_address\": \"2001:db8::6\"}      |\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n\nStep 2: Attach it to the Nova instance, and error is raised by intension\n\nroot@SZX1000191849:/opt/stack/nova# nova interface-attach  e1213eee-5378-472c-8f66-a35b7bdb09e3 --port-id fd240a85-53cb-467a-8e43-330bb5c928ab \nERROR (ClientException): Failed to attach network adapter device to e1213eee-5378-472c-8f66-a35b7bdb09e3 (HTTP 500) (Request-ID: req-7ab972a5-91d7-49d9-96bc-f063cf4dd1f2)\n\nStep 3: Check the neutron ports again, the port is gone.\n\nroot@SZX1000191849:/opt/stack/nova# neutron port-list\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                               |\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n| 453879db-6bc2-4a40-89eb-588a15cf33c4 |      | fa:16:3e:19:9e:27 | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.9\"}         |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::8\"} |\n| 4cd1ad8e-86df-4454-a187-08bb3faa32ec |      | fa:16:3e:60:b4:8f | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.13\"}        |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::5\"} |\n| 74a0b31a-3a26-4b20-bdb2-0bb0d343c551 |      | fa:16:3e:12:6b:9a | {\"subnet_id\": \"6cf2ed09-8394-4e3e-81d5-3880fe1c6984\", \"ip_address\": \"172.24.4.10\"}      |\n|                                      |      |                   | {\"subnet_id\": \"6b3902ca-deea-46f0-97e9-80c70243413e\", \"ip_address\": \"2001:db8::a\"}      |\n| 8fc6af24-78f8-4234-9a5a-c348ba873aff |      | fa:16:3e:e3:25:62 | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.1\"}         |\n| eaf6a086-a146-4e45-8c4c-a54b209e80c4 |      | fa:16:3e:5d:89:bd | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.2\"}         |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::2\"} |\n| ebce0f96-984b-4890-bd6b-dc561973b615 |      | fa:16:3e:da:1b:7f | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::1\"} |\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n\nThis is due to when we do clean up here:\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/network/neutronv2/api.py#n1201\nwe treat this port as nova-created port as it has not been included in the preexisting ports.", 
    "tags": [
        "neutron"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1645175", 
    "owner": "https://api.launchpad.net/1.0/~zhengzhenyu", 
    "id": 1645175, 
    "index": 4692, 
    "openned": "2016-11-28 02:29:51.514634+00:00", 
    "created": "2016-11-28 02:29:51.514634+00:00", 
    "title": "Neutron port got deleted when attach interface failed", 
    "comments": [
        {
            "content": "When attach an pre created Neutron port to Nova instances and got failed, the port will be deleted in Neutron:\n\nHow to reproduce:\n\nStep 1: create a new Neutron Port:\n\nroot@SZX1000191849:/opt/stack/nova# neutron port-create e1775804-7670-482c-bf1a-309fff85f598 \nCreated a new port:\n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:host_id       |                                                                                    |\n| binding:profile       | {}                                                                                 |\n| binding:vif_details   | {}                                                                                 |\n| binding:vif_type      | unbound                                                                            |\n| binding:vnic_type     | normal                                                                             |\n| created_at            | 2016-11-28T02:20:26Z                                                               |\n| description           |                                                                                    |\n| device_id             |                                                                                    |\n| device_owner          |                                                                                    |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"6cf2ed09-8394-4e3e-81d5-3880fe1c6984\", \"ip_address\": \"172.24.4.2\"}  |\n|                       | {\"subnet_id\": \"6b3902ca-deea-46f0-97e9-80c70243413e\", \"ip_address\": \"2001:db8::6\"} |\n| id                    | fd240a85-53cb-467a-8e43-330bb5c928ab                                               |\n| mac_address           | fa:16:3e:cc:fb:9e                                                                  |\n| name                  |                                                                                    |\n| network_id            | e1775804-7670-482c-bf1a-309fff85f598                                               |\n| port_security_enabled | True                                                                               |\n| project_id            | 405a8b8100ae47ffaa89730681ee400f                                                   |\n| revision_number       | 6                                                                                  |\n| security_groups       | 9ea518bb-ee12-489a-ac6a-3434d2c081c4                                               |\n| status                | DOWN                                                                               |\n| tenant_id             | 405a8b8100ae47ffaa89730681ee400f                                                   |\n| updated_at            | 2016-11-28T02:20:27Z                                                               |\n+-----------------------+------------------------------------------------------------------------------------+\nroot@SZX1000191849:/opt/stack/nova# neutron port-list\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                               |\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n| 453879db-6bc2-4a40-89eb-588a15cf33c4 |      | fa:16:3e:19:9e:27 | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.9\"}         |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::8\"} |\n| 4cd1ad8e-86df-4454-a187-08bb3faa32ec |      | fa:16:3e:60:b4:8f | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.13\"}        |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::5\"} |\n| 74a0b31a-3a26-4b20-bdb2-0bb0d343c551 |      | fa:16:3e:12:6b:9a | {\"subnet_id\": \"6cf2ed09-8394-4e3e-81d5-3880fe1c6984\", \"ip_address\": \"172.24.4.10\"}      |\n|                                      |      |                   | {\"subnet_id\": \"6b3902ca-deea-46f0-97e9-80c70243413e\", \"ip_address\": \"2001:db8::a\"}      |\n| 8fc6af24-78f8-4234-9a5a-c348ba873aff |      | fa:16:3e:e3:25:62 | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.1\"}         |\n| eaf6a086-a146-4e45-8c4c-a54b209e80c4 |      | fa:16:3e:5d:89:bd | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.2\"}         |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::2\"} |\n| ebce0f96-984b-4890-bd6b-dc561973b615 |      | fa:16:3e:da:1b:7f | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::1\"} |\n| fd240a85-53cb-467a-8e43-330bb5c928ab |      | fa:16:3e:cc:fb:9e | {\"subnet_id\": \"6cf2ed09-8394-4e3e-81d5-3880fe1c6984\", \"ip_address\": \"172.24.4.2\"}       |\n|                                      |      |                   | {\"subnet_id\": \"6b3902ca-deea-46f0-97e9-80c70243413e\", \"ip_address\": \"2001:db8::6\"}      |\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n\nStep 2: Attach it to the Nova instance, and error is raised by intension\n\nroot@SZX1000191849:/opt/stack/nova# nova interface-attach  e1213eee-5378-472c-8f66-a35b7bdb09e3 --port-id fd240a85-53cb-467a-8e43-330bb5c928ab \nERROR (ClientException): Failed to attach network adapter device to e1213eee-5378-472c-8f66-a35b7bdb09e3 (HTTP 500) (Request-ID: req-7ab972a5-91d7-49d9-96bc-f063cf4dd1f2)\n\nStep 3: Check the neutron ports again, the port is gone.\n\nroot@SZX1000191849:/opt/stack/nova# neutron port-list\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                               |\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n| 453879db-6bc2-4a40-89eb-588a15cf33c4 |      | fa:16:3e:19:9e:27 | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.9\"}         |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::8\"} |\n| 4cd1ad8e-86df-4454-a187-08bb3faa32ec |      | fa:16:3e:60:b4:8f | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.13\"}        |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::5\"} |\n| 74a0b31a-3a26-4b20-bdb2-0bb0d343c551 |      | fa:16:3e:12:6b:9a | {\"subnet_id\": \"6cf2ed09-8394-4e3e-81d5-3880fe1c6984\", \"ip_address\": \"172.24.4.10\"}      |\n|                                      |      |                   | {\"subnet_id\": \"6b3902ca-deea-46f0-97e9-80c70243413e\", \"ip_address\": \"2001:db8::a\"}      |\n| 8fc6af24-78f8-4234-9a5a-c348ba873aff |      | fa:16:3e:e3:25:62 | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.1\"}         |\n| eaf6a086-a146-4e45-8c4c-a54b209e80c4 |      | fa:16:3e:5d:89:bd | {\"subnet_id\": \"ce211f7b-e808-4222-80e4-9bec9113afa3\", \"ip_address\": \"10.0.0.2\"}         |\n|                                      |      |                   | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::2\"} |\n| ebce0f96-984b-4890-bd6b-dc561973b615 |      | fa:16:3e:da:1b:7f | {\"subnet_id\": \"5ff9100a-02ff-40a2-8c33-0f0d285b72ad\", \"ip_address\": \"2001:db8:8000::1\"} |\n+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------------------+\n\nThis is due to when we do clean up here:\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/network/neutronv2/api.py#n1201\nwe treat this port as nova-created port as it has not been included in the preexisting ports.", 
            "date_created": "2016-11-28 02:29:51.514634+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhengzhenyu"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/403568", 
            "date_created": "2016-11-28 09:03:51.112816+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/452577", 
            "date_created": "2017-04-03 00:53:23.851811+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Kevin, what release did you test this against? See the questions and comments between myself and John Garbutt in the review here:\n\nhttps://review.openstack.org/#/c/452577/\n\nIn short, it seems the existing code should be working. The instance.info_cache.network_info should be getting updated after the port is attached and associated with the instance, such that when we deallocate the port on failure, the network info cache should have the preserve_on_delete flag set on that VIF in the NetworkInfo object.", 
            "date_created": "2017-04-18 19:09:49.620817+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "@Matt, Hi, I was testing on Master back in Nov. 2016 so it must be Ocata.\n\nAnd I tested again with the current master in my devstack env:\n\nI raise exception.InterfaceAttachFailed(instance_uuid=instance.uuid) directly at:\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/virt/libvirt/driver.py#n1392 to create the attach\nfailure scenario.\n\nand then I create a port:\nroot@SZX1000291919:/opt/stack/nova# neutron port-create 72cc44fa-575b-4eee-8b31-62628a6849a6\nneutron CLI is deprecated and will be removed in the future. Use openstack CLI instead.\nCreated a new port:\n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:host_id       |                                                                                    |\n| binding:profile       | {}                                                                                 |\n| binding:vif_details   | {}                                                                                 |\n| binding:vif_type      | unbound                                                                            |\n| binding:vnic_type     | normal                                                                             |\n| created_at            | 2017-04-19T02:06:20Z                                                               |\n| description           |                                                                                    |\n| device_id             |                                                                                    |\n| device_owner          |                                                                                    |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"146fd32e-e896-4b98-8edb-60583d3fa886\", \"ip_address\": \"172.24.4.9\"}  |\n|                       | {\"subnet_id\": \"8b9f5ac6-0dfa-4c7b-bcb1-e3f10874570c\", \"ip_address\": \"2001:db8::9\"} |\n| id                    | f87cac88-0303-4e0e-9831-9e843db892ef                                               |\n| mac_address           | fa:16:3e:6e:b2:03                                                                  |\n| name                  |                                                                                    |\n| network_id            | 72cc44fa-575b-4eee-8b31-62628a6849a6                                               |\n| port_security_enabled | True                                                                               |\n| project_id            | 3e1e1a22750840d591509807b0251acb                                                   |\n| revision_number       | 6                                                                                  |\n| security_groups       | c0f36b5e-dc65-4209-9529-5a72e2ed8f1b                                               |\n| status                | DOWN                                                                               |\n| tags                  |                                                                                    |\n| tenant_id             | 3e1e1a22750840d591509807b0251acb                                                   |\n| updated_at            | 2017-04-19T02:06:20Z                                                               |\n+-----------------------+------------------------------------------------------------------------------------+\nroot@SZX1000291919:/opt/stack/nova# neutron port-list\nneutron CLI is deprecated and will be removed in the future. Use openstack CLI instead.\n+--------------------------------------+------+----------------------------------+-------------------+-------------------------------------------------------------------------------------------------------------+\n| id                                   | name | tenant_id                        | mac_address       | fixed_ips                                                                                                   |\n+--------------------------------------+------+----------------------------------+-------------------+-------------------------------------------------------------------------------------------------------------+\n| 295440a7-a4e7-47b5-bfb5-20d38c0a6786 |      |                                  | fa:16:3e:5b:b4:7e | {\"subnet_id\": \"146fd32e-e896-4b98-8edb-60583d3fa886\", \"ip_address\": \"172.24.4.6\"}                           |\n|                                      |      |                                  |                   | {\"subnet_id\": \"8b9f5ac6-0dfa-4c7b-bcb1-e3f10874570c\", \"ip_address\": \"2001:db8::1\"}                          |\n| 6cedc98f-1179-4a68-854a-ef8baa9d4199 |      | 3e1e1a22750840d591509807b0251acb | fa:16:3e:e2:ab:5a | {\"subnet_id\": \"d30c955b-2719-49d3-9c4b-991847cb332b\", \"ip_address\": \"10.0.0.12\"}                            |\n|                                      |      |                                  |                   | {\"subnet_id\": \"010b64b9-8f3f-4087-a7a5-fd446ca0254f\", \"ip_address\": \"fd60:cdc5:3b4f:0:f816:3eff:fee2:ab5a\"} |\n| 9e44e2b2-db9e-4c90-9ff0-c18aaa753f9a |      | e4ab939775f943f685ff02042490fe6d | fa:16:3e:da:52:cc | {\"subnet_id\": \"d30c955b-2719-49d3-9c4b-991847cb332b\", \"ip_address\": \"10.0.0.2\"}                             |\n|                                      |      |                                  |                   | {\"subnet_id\": \"010b64b9-8f3f-4087-a7a5-fd446ca0254f\", \"ip_address\": \"fd60:cdc5:3b4f:0:f816:3eff:feda:52cc\"} |\n| 9fb2b024-62c5-4c43-8140-3a08cbc4694c |      | e4ab939775f943f685ff02042490fe6d | fa:16:3e:17:67:60 | {\"subnet_id\": \"d30c955b-2719-49d3-9c4b-991847cb332b\", \"ip_address\": \"10.0.0.1\"}                             |\n| f2b66a85-e02b-4fb3-b603-5c1f9bd59d72 |      | e4ab939775f943f685ff02042490fe6d | fa:16:3e:ca:b4:19 | {\"subnet_id\": \"010b64b9-8f3f-4087-a7a5-fd446ca0254f\", \"ip_address\": \"fd60:cdc5:3b4f::1\"}                    |\n| f87cac88-0303-4e0e-9831-9e843db892ef |      | 3e1e1a22750840d591509807b0251acb | fa:16:3e:6e:b2:03 | {\"subnet_id\": \"146fd32e-e896-4b98-8edb-60583d3fa886\", \"ip_address\": \"172.24.4.9\"}                           |\n|                                      |      |                                  |                   | {\"subnet_id\": \"8b9f5ac6-0dfa-4c7b-bcb1-e3f10874570c\", \"ip_address\": \"2001:db8::9\"}                          |\n+--------------------------------------+------+----------------------------------+-------------------+-------------------------------------------------------------------------------------------------------------+\n\nThe port id of the newly created port is  f87cac88-0303-4e0e-9831-9e843db892ef \n\n=========================================================================================================\n\nThen attach it to the instance:\n\nroot@SZX1000291919:/opt/stack/nova# nova interface-attach e3d024eb-b2aa-44b2-a5b6-610d1ff7d188 --port-id f87cac88-0303-4e0e-9831-9e843db892ef \n/usr/local/lib/python2.7/dist-packages/novaclient/client.py:278: UserWarning: The 'tenant_id' argument is deprecated in Ocata and its use may result in errors in future releases. As 'project_id' is provided, the 'tenant_id' argument will be ignored.\n  warnings.warn(msg)\nERROR (ClientException): Failed to attach network adapter device to e3d024eb-b2aa-44b2-a5b6-610d1ff7d188 (HTTP 500) (Request-ID: req-03308477-7bda-4375-b724-a0c1e8b77ee9)\n\nError raised as I raised it directly\n\n===================================================================================================================\n\n\nList again all ports,  f87cac88-0303-4e0e-9831-9e843db892ef  is missing\n\n\nroot@SZX1000291919:/opt/stack/nova# neutron port-list\nneutron CLI is deprecated and will be removed in the future. Use openstack CLI instead.\n+--------------------------------------+------+----------------------------------+-------------------+-------------------------------------------------------------------------------------------------------------+\n| id                                   | name | tenant_id                        | mac_address       | fixed_ips                                                                                                   |\n+--------------------------------------+------+----------------------------------+-------------------+-------------------------------------------------------------------------------------------------------------+\n| 295440a7-a4e7-47b5-bfb5-20d38c0a6786 |      |                                  | fa:16:3e:5b:b4:7e | {\"subnet_id\": \"146fd32e-e896-4b98-8edb-60583d3fa886\", \"ip_address\": \"172.24.4.6\"}                           |\n|                                      |      |                                  |                   | {\"subnet_id\": \"8b9f5ac6-0dfa-4c7b-bcb1-e3f10874570c\", \"ip_address\": \"2001:db8::1\"}                          |\n| 6cedc98f-1179-4a68-854a-ef8baa9d4199 |      | 3e1e1a22750840d591509807b0251acb | fa:16:3e:e2:ab:5a | {\"subnet_id\": \"d30c955b-2719-49d3-9c4b-991847cb332b\", \"ip_address\": \"10.0.0.12\"}                            |\n|                                      |      |                                  |                   | {\"subnet_id\": \"010b64b9-8f3f-4087-a7a5-fd446ca0254f\", \"ip_address\": \"fd60:cdc5:3b4f:0:f816:3eff:fee2:ab5a\"} |\n| 9e44e2b2-db9e-4c90-9ff0-c18aaa753f9a |      | e4ab939775f943f685ff02042490fe6d | fa:16:3e:da:52:cc | {\"subnet_id\": \"d30c955b-2719-49d3-9c4b-991847cb332b\", \"ip_address\": \"10.0.0.2\"}                             |\n|                                      |      |                                  |                   | {\"subnet_id\": \"010b64b9-8f3f-4087-a7a5-fd446ca0254f\", \"ip_address\": \"fd60:cdc5:3b4f:0:f816:3eff:feda:52cc\"} |\n| 9fb2b024-62c5-4c43-8140-3a08cbc4694c |      | e4ab939775f943f685ff02042490fe6d | fa:16:3e:17:67:60 | {\"subnet_id\": \"d30c955b-2719-49d3-9c4b-991847cb332b\", \"ip_address\": \"10.0.0.1\"}                             |\n| f2b66a85-e02b-4fb3-b603-5c1f9bd59d72 |      | e4ab939775f943f685ff02042490fe6d | fa:16:3e:ca:b4:19 | {\"subnet_id\": \"010b64b9-8f3f-4087-a7a5-fd446ca0254f\", \"ip_address\": \"fd60:cdc5:3b4f::1\"}                    |\n+--------------------------------------+------+----------------------------------+-------------------+-------------------------------------------------------------------------------------------------------------+\n\n\nSo seems the bug is still valid in current master, but correct me if I did something wrong.", 
            "date_created": "2017-04-19 02:17:15.640053+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhengzhenyu"
        }, 
        {
            "content": "Change abandoned by Matt Riedemann (<email address hidden>) on branch: master\nReview: https://review.openstack.org/452577\nReason: Kevin figured out what the root issue was in https://review.openstack.org/#/c/403568/ so let's focus on that fix which is simpler.", 
            "date_created": "2017-06-21 16:01:37.879928+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/403568\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=115cf068a6d48cdf8b0d20a3c5a779bb8120aa9b\nSubmitter: Jenkins\nBranch:    master\n\ncommit 115cf068a6d48cdf8b0d20a3c5a779bb8120aa9b\nAuthor: Kevin_Zheng <email address hidden>\nDate:   Mon Nov 28 16:12:51 2016 +0800\n\n    Don't delete neutron port when attach failed\n    \n    Currently, when attaching neutron pre-existing\n    port to an instance, if the attach failed, it\n    will also be deleted in Neutron side due to\n    bad judgement of the who created the port by\n    reading not up-to-date info_cache.\n    \n    The workflow starts at:\n    https://github.com/openstack/nova/blob/9ed0d6114/nova/network/neutronv2/api.py#L881\n    ordered_ports and preexisting_port_ids are\n    the same when attaching a preexisting port\n    to an instance and it calls\n    https://github.com/openstack/nova/blob/9ed0d6114/nova/network/base_api.py#L246\n    which calls back into the neutronv2 api code\n    https://github.com/openstack/nova/blob/9ed0d6114/nova/network/neutronv2/api.py#L1274\n    and at this point, compute_utils.refresh_info_cache_for_instance(context,\n    instance) won't have the newly attached port in it(see\n    debug log: http://paste.openstack.org/show/613232/)\n    because _build_network_info_model() is going to\n    process it. The instance obj in memoryt with old\n    info_cache will be used at rollback process and\n    causing the miss-judging.\n    \n    This patch fixed it by updating instance.info_cache\n    to the new ic after it is created.\n    \n    Co-Authored-By: <email address hidden>\n    Change-Id: Ib323b74d4ea1e874b476ab5addfc6bc79cb7c751\n    closes-bug: #1645175\n", 
            "date_created": "2017-07-05 01:29:40.255086+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b3 development milestone.", 
            "date_created": "2017-07-28 07:41:05.435937+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-07-05 01:29:36.869759+00:00"
}