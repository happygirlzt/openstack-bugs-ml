{
    "status": "Invalid", 
    "last_updated": "2014-10-16 18:03:24.456441+00:00", 
    "description": "Seeing oslo.messaging timeouts while assocating floating IPs in the API logs:\n\nhttp://logs.openstack.org/08/110008/1/gate/gate-tempest-dsvm-postgres-full/04890fa/logs/screen-n-api.txt.gz?level=TRACE#_2014-07-28_16_18_36_915\n\n2014-07-28 16:18:36.915 ERROR nova.api.openstack.compute.contrib.floating_ips [req-d0ee3c07-0ae3-49d2-bad7-c4874096cc52 FloatingIPsTestJSON-352614651 FloatingIPsTestJSON-1773137245] Error. Unable to associate floating ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips Traceback (most recent call last):\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/api/openstack/compute/contrib/floating_ips.py\", line 258, in _add_floating_ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     fixed_address=fixed_address)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/api.py\", line 44, in wrapped\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     return func(self, context, *args, **kwargs)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/base_api.py\", line 60, in wrapper\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     res = f(self, context, *args, **kwargs)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/api.py\", line 190, in associate_floating_ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     context, floating_address, fixed_address, affect_auto_assigned)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/utils.py\", line 949, in wrapper\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     return func(*args, **kwargs)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/server.py\", line 138, in inner\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     return func(*args, **kwargs)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/floating_ips.py\", line 347, in associate_floating_ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     fixed_ip.instance_uuid)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/rpcapi.py\", line 324, in _associate_floating_ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     interface=interface, instance_uuid=instance_uuid)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     retry=self.retry)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     timeout=timeout, retry=retry)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 404, in send\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     retry=retry)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 393, in _send\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     result = self._waiter.wait(msg_id, timeout)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 281, in wait\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     reply, ending = self._poll_connection(msg_id, timeout)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 231, in _poll_connection\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     % msg_id)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips MessagingTimeout: Timed out waiting for a reply to message ID b463ca53f2bb42f6992b5e262b494f78\n\nAnd when you look in the nova-network logs, it appears there is a deadlock with iptables while playing with floating IPs:\n\nhttp://logs.openstack.org/08/110008/1/gate/gate-tempest-dsvm-postgres-full/04890fa/logs/screen-n-net.txt.gz\n\nThe last message in the n-net logs is trying to grab a lock:\n\n2014-07-28 16:17:37.011 DEBUG nova.openstack.common.lockutils [req-d0ee3c07-0ae3-49d2-bad7-c4874096cc52 FloatingIPsTestJSON-352614651 FloatingIPsTestJSON-1773137245] Attempting to grab external lock \"iptables\" external_lock /opt/stack/new/nova/nova/openstack/common/lockutils.py:230\n\nFrom logstash:\n\nmessage:\"HTTP exception thrown: Error. Unable to associate floating ip\" AND tags:\"screen-n-api.txt\"\n\nThere are 94 hits in 2 weeks, looks like it started on 7/19:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiSFRUUCBleGNlcHRpb24gdGhyb3duOiBFcnJvci4gVW5hYmxlIHRvIGFzc29jaWF0ZSBmbG9hdGluZyBpcFwiIEFORCB0YWdzOlwic2NyZWVuLW4tYXBpLnR4dFwiIiwiZmllbGRzIjpbXSwib2Zmc2V0IjowLCJ0aW1lZnJhbWUiOiJjdXN0b20iLCJncmFwaG1vZGUiOiJjb3VudCIsInRpbWUiOnsiZnJvbSI6IjIwMTQtMDctMTRUMjE6NDM6MTIrMDA6MDAiLCJ0byI6IjIwMTQtMDctMjhUMjE6NDM6MTIrMDA6MDAiLCJ1c2VyX2ludGVydmFsIjoiMCJ9LCJzdGFtcCI6MTQwNjU4MzkyMjc5Nn0=\n\nThis is also showing up in the api logs:\n\n2014-07-28 16:20:48.331 WARNING nova.compute.api [req-5c540168-bde5-45fe-926f-f24a8f242b72 ServersAdminTestJSON-253527515 ServersAdminTestJSON-735286156] [instance: 748ad6e1-7741-4ff4-be1b-66af4466e019] instance's host devstack-trusty-hpcloud-b5-1122950 is down, deleting from database\n\nI'm not sure if it's related though, but looking at logstash:\n\nmessage:\"instance's host\" AND message:\"is down, deleting from database\" AND tags:\"screen-n-api.txt\"\n\nThere are 548 hits in 2 weeks, which also appears to have started around 7/19:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiaW5zdGFuY2UncyBob3N0XCIgQU5EIG1lc3NhZ2U6XCJpcyBkb3duLCBkZWxldGluZyBmcm9tIGRhdGFiYXNlXCIgQU5EIHRhZ3M6XCJzY3JlZW4tbi1hcGkudHh0XCIiLCJmaWVsZHMiOltdLCJvZmZzZXQiOjAsInRpbWVmcmFtZSI6ImN1c3RvbSIsImdyYXBobW9kZSI6ImNvdW50IiwidGltZSI6eyJmcm9tIjoiMjAxNC0wNy0xNFQyMTozNTozNiswMDowMCIsInRvIjoiMjAxNC0wNy0yOFQyMTozNTozNiswMDowMCIsInVzZXJfaW50ZXJ2YWwiOiIwIn0sInN0YW1wIjoxNDA2NTg0MDIwNjE5fQ==\n\nThose are only on nova-network jobs though so most likely related.", 
    "tags": [
        "gate-failure", 
        "network", 
        "nova-network", 
        "testing"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1349590", 
    "owner": "None", 
    "id": 1349590, 
    "index": 1549, 
    "openned": "2014-07-28 21:48:39.949197+00:00", 
    "created": "2014-07-28 21:48:39.949197+00:00", 
    "title": "nova-network appears to lock up while associating floating ip's", 
    "comments": [
        {
            "content": "Seeing oslo.messaging timeouts while assocating floating IPs in the API logs:\n\nhttp://logs.openstack.org/08/110008/1/gate/gate-tempest-dsvm-postgres-full/04890fa/logs/screen-n-api.txt.gz?level=TRACE#_2014-07-28_16_18_36_915\n\n2014-07-28 16:18:36.915 ERROR nova.api.openstack.compute.contrib.floating_ips [req-d0ee3c07-0ae3-49d2-bad7-c4874096cc52 FloatingIPsTestJSON-352614651 FloatingIPsTestJSON-1773137245] Error. Unable to associate floating ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips Traceback (most recent call last):\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/api/openstack/compute/contrib/floating_ips.py\", line 258, in _add_floating_ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     fixed_address=fixed_address)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/api.py\", line 44, in wrapped\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     return func(self, context, *args, **kwargs)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/base_api.py\", line 60, in wrapper\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     res = f(self, context, *args, **kwargs)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/api.py\", line 190, in associate_floating_ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     context, floating_address, fixed_address, affect_auto_assigned)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/utils.py\", line 949, in wrapper\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     return func(*args, **kwargs)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/server.py\", line 138, in inner\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     return func(*args, **kwargs)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/floating_ips.py\", line 347, in associate_floating_ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     fixed_ip.instance_uuid)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/opt/stack/new/nova/nova/network/rpcapi.py\", line 324, in _associate_floating_ip\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     interface=interface, instance_uuid=instance_uuid)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     retry=self.retry)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     timeout=timeout, retry=retry)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 404, in send\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     retry=retry)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 393, in _send\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     result = self._waiter.wait(msg_id, timeout)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 281, in wait\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     reply, ending = self._poll_connection(msg_id, timeout)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 231, in _poll_connection\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips     % msg_id)\n2014-07-28 16:18:36.915 18485 TRACE nova.api.openstack.compute.contrib.floating_ips MessagingTimeout: Timed out waiting for a reply to message ID b463ca53f2bb42f6992b5e262b494f78\n\nAnd when you look in the nova-network logs, it appears there is a deadlock with iptables while playing with floating IPs:\n\nhttp://logs.openstack.org/08/110008/1/gate/gate-tempest-dsvm-postgres-full/04890fa/logs/screen-n-net.txt.gz\n\nThe last message in the n-net logs is trying to grab a lock:\n\n2014-07-28 16:17:37.011 DEBUG nova.openstack.common.lockutils [req-d0ee3c07-0ae3-49d2-bad7-c4874096cc52 FloatingIPsTestJSON-352614651 FloatingIPsTestJSON-1773137245] Attempting to grab external lock \"iptables\" external_lock /opt/stack/new/nova/nova/openstack/common/lockutils.py:230\n\nFrom logstash:\n\nmessage:\"HTTP exception thrown: Error. Unable to associate floating ip\" AND tags:\"screen-n-api.txt\"\n\nThere are 94 hits in 2 weeks, looks like it started on 7/19:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiSFRUUCBleGNlcHRpb24gdGhyb3duOiBFcnJvci4gVW5hYmxlIHRvIGFzc29jaWF0ZSBmbG9hdGluZyBpcFwiIEFORCB0YWdzOlwic2NyZWVuLW4tYXBpLnR4dFwiIiwiZmllbGRzIjpbXSwib2Zmc2V0IjowLCJ0aW1lZnJhbWUiOiJjdXN0b20iLCJncmFwaG1vZGUiOiJjb3VudCIsInRpbWUiOnsiZnJvbSI6IjIwMTQtMDctMTRUMjE6NDM6MTIrMDA6MDAiLCJ0byI6IjIwMTQtMDctMjhUMjE6NDM6MTIrMDA6MDAiLCJ1c2VyX2ludGVydmFsIjoiMCJ9LCJzdGFtcCI6MTQwNjU4MzkyMjc5Nn0=\n\nThis is also showing up in the api logs:\n\n2014-07-28 16:20:48.331 WARNING nova.compute.api [req-5c540168-bde5-45fe-926f-f24a8f242b72 ServersAdminTestJSON-253527515 ServersAdminTestJSON-735286156] [instance: 748ad6e1-7741-4ff4-be1b-66af4466e019] instance's host devstack-trusty-hpcloud-b5-1122950 is down, deleting from database\n\nI'm not sure if it's related though, but looking at logstash:\n\nmessage:\"instance's host\" AND message:\"is down, deleting from database\" AND tags:\"screen-n-api.txt\"\n\nThere are 548 hits in 2 weeks, which also appears to have started around 7/19:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiaW5zdGFuY2UncyBob3N0XCIgQU5EIG1lc3NhZ2U6XCJpcyBkb3duLCBkZWxldGluZyBmcm9tIGRhdGFiYXNlXCIgQU5EIHRhZ3M6XCJzY3JlZW4tbi1hcGkudHh0XCIiLCJmaWVsZHMiOltdLCJvZmZzZXQiOjAsInRpbWVmcmFtZSI6ImN1c3RvbSIsImdyYXBobW9kZSI6ImNvdW50IiwidGltZSI6eyJmcm9tIjoiMjAxNC0wNy0xNFQyMTozNTozNiswMDowMCIsInRvIjoiMjAxNC0wNy0yOFQyMTozNTozNiswMDowMCIsInVzZXJfaW50ZXJ2YWwiOiIwIn0sInN0YW1wIjoxNDA2NTg0MDIwNjE5fQ==\n\nThose are only on nova-network jobs though so most likely related.", 
            "date_created": "2014-07-28 21:48:39.949197+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "e-r query: https://review.openstack.org/#/c/110142/", 
            "date_created": "2014-07-28 21:53:38.631785+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "For the latter issue on 'instance's host is down, deleting from database', I'm wondering is this is related, it merged on 7/18:\n\nhttps://github.com/openstack/nova/commit/d6ca1cc02ab58615a6bb1b337db34dd06525112e\n\nThere isn't much for nova commits that jumps out at me which merged on 7/19.  This merged on 7/19 and touches nova/network/manager.py but it seems pretty harmless:\n\nhttps://github.com/openstack/nova/commit/284e5ac022e20ac8150df7d3a7692bd1e2deadbf", 
            "date_created": "2014-07-28 22:11:05.415097+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "So the 7/19 thing is not correct, we only keep 10 days of logstash data so that's why it appears to show up then. :(", 
            "date_created": "2014-07-28 22:20:58.831949+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Looks like this has dropped down, 5 hits in 10 days:\n\nmessage:\"HTTP exception thrown: Error. Unable to associate floating ip\" AND tags:\"screen-n-api.txt\"\n\nIt's all check queue right now.", 
            "date_created": "2014-09-16 14:36:01.775458+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "There are no hits after 9/10, and this merged on 9/12, so we should check the logs again if we have a more recent hit so we can see if the logs in nova-network make more sense:\n\nhttps://review.openstack.org/#/c/120934/", 
            "date_created": "2014-09-16 14:50:44.329589+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Might be worth noting if this helps at all: https://review.openstack.org/#/c/115859/", 
            "date_created": "2014-09-16 15:49:53.367221+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "This might also be useful because looking through the nova-net logs on one of these fails you'll see the nw info dict rebuilt several times:\n\nhttps://review.openstack.org/#/c/119523/", 
            "date_created": "2014-09-16 15:51:04.718259+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/121916", 
            "date_created": "2014-09-16 16:03:37.215395+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/121916\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=404f7ca9ce96c0b321b8fdfc9d2f9329970fc051\nSubmitter: Jenkins\nBranch:    master\n\ncommit 404f7ca9ce96c0b321b8fdfc9d2f9329970fc051\nAuthor: Matt Riedemann <email address hidden>\nDate:   Tue Sep 16 09:01:57 2014 -0700\n\n    Add more information to generic _add_floating_ip exception message\n    \n    When we fail in some unexpected way in the _add_floating_ip method it'd\n    be good to have more information in the error message that's passed back\n    to the caller so they don't have to dig into the logs for the variables\n    involved, especially since the fixed IP might not be provided on the\n    request.\n    \n    We're seeing messaging timeouts in the gate and it'd be nice to have the\n    error information right up front so we can fingerprint on it in\n    elastic-recheck.\n    \n    Related-Bug: #1349590\n    \n    Change-Id: I7c19c5c1bc5d41a922435d78aca0160c45130276\n", 
            "date_created": "2014-09-17 10:31:02.815078+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This doesn't seem to be showing up anymore.", 
            "date_created": "2014-10-15 21:42:16.439723+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Since we haven't seen this in a while marking the bug as closed. If this is seen again feel free to re-open.", 
            "date_created": "2014-10-16 18:03:14.004460+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }
    ], 
    "closed": "2014-10-16 18:03:21.359979+00:00"
}