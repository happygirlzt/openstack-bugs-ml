{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:04:09.634954+00:00", 
    "description": "After Bug 1261475 was fixed, A new issue in Ice-house was introduced. Basically now that ice-house is doing the call guestfs.GuestFS (close_on_exit = False), there are different requirements on the version of libguestfs.x86_64 and python-libguestfs.x86_64.\n\nDuring the deployment of a VM I would get the following error on the compute node:\n\n2014-01-20 16:51:32.395 7723 ERROR nova.compute.manager [req-482a2eec-238c-4696-8aab-acc0d404e627 45a71543cb6f4022ac4f56855a7ff197 4a5f610e660347b6a629a27ffea92240] [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] Error: __init__() got an unexpected keyword argument 'close_on_exit'\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] Traceback (most recent call last):\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1062, in _build_instance\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] set_access_ip=set_access_ip)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 362, in decorated_function\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] return function(self, context, *args, **kwargs)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1497, in _spawn\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] LOG.exception(_('Instance failed to spawn'), instance=instance)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] six.reraise(self.type_, self.value, self.tb)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1483, in _spawn\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] block_device_info)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2174, in spawn\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] admin_pass=admin_password)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2477, in _create_image\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] project_id=instance['project_id'])\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/imagebackend.py\", line 187, in cache\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] *args, **kwargs)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/imagebackend.py\", line 337, in create_image\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] copy_qcow2_image(base, self.path, size)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 249, in inner\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] return f(*args, **kwargs)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/imagebackend.py\", line 303, in copy_qcow2_image\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] disk.extend(target, size, use_cow=True)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/disk/api.py\", line 149, in extend\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] if not is_image_partitionless(image, use_cow):\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/disk/api.py\", line 189, in is_image_partitionless\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] fs.setup()\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/disk/vfs/guestfs.py\", line 111, in setup\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] self.handle = tpool.Proxy(guestfs.GuestFS(close_on_exit=False))\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] TypeError: __init__() got an unexpected keyword argument 'close_on_exit'\n\nAfter doing some research I found out that the close_on_exit parameter is supported only on the newer versions of libguestfs.x86_64 and python-libguestfs.x86_64.\n\nIn my system (RHEL 6.4) I had\nlibguestfs.x86_64 1:1.16.34-2.el6\npython-libguestfs.x86_64 1:1.16.34-2.el6\n\nAfter updating to the following versions the deploy operation started working again.\nlibguestfs.x86_64 1:1.20.11-2.el6\npython-libguestfs.x86_64 1:1.20.11-2.el6", 
    "tags": [
        "compute"
    ], 
    "importance": "Critical", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1271562", 
    "owner": "https://api.launchpad.net/1.0/~russellb", 
    "id": 1271562, 
    "index": 170, 
    "openned": "2014-01-22 14:24:56.745047+00:00", 
    "created": "2014-01-22 14:24:56.745047+00:00", 
    "title": "Failed deployment of VM due to the use of guestfs.GuestFS (close_on_exit = False)", 
    "comments": [
        {
            "content": "After Bug 1261475 was fixed, A new issue in Ice-house was introduced. Basically now that ice-house is doing the call guestfs.GuestFS (close_on_exit = False), there are different requirements on the version of libguestfs.x86_64 and python-libguestfs.x86_64.\n\nDuring the deployment of a VM I would get the following error on the compute node:\n\n2014-01-20 16:51:32.395 7723 ERROR nova.compute.manager [req-482a2eec-238c-4696-8aab-acc0d404e627 45a71543cb6f4022ac4f56855a7ff197 4a5f610e660347b6a629a27ffea92240] [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] Error: __init__() got an unexpected keyword argument 'close_on_exit'\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] Traceback (most recent call last):\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1062, in _build_instance\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] set_access_ip=set_access_ip)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 362, in decorated_function\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] return function(self, context, *args, **kwargs)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1497, in _spawn\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] LOG.exception(_('Instance failed to spawn'), instance=instance)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] six.reraise(self.type_, self.value, self.tb)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1483, in _spawn\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] block_device_info)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2174, in spawn\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] admin_pass=admin_password)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2477, in _create_image\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] project_id=instance['project_id'])\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/imagebackend.py\", line 187, in cache\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] *args, **kwargs)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/imagebackend.py\", line 337, in create_image\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] copy_qcow2_image(base, self.path, size)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 249, in inner\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] return f(*args, **kwargs)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/imagebackend.py\", line 303, in copy_qcow2_image\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] disk.extend(target, size, use_cow=True)\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/disk/api.py\", line 149, in extend\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] if not is_image_partitionless(image, use_cow):\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/disk/api.py\", line 189, in is_image_partitionless\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] fs.setup()\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] File \"/usr/lib/python2.6/site-packages/nova/virt/disk/vfs/guestfs.py\", line 111, in setup\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] self.handle = tpool.Proxy(guestfs.GuestFS(close_on_exit=False))\n2014-01-20 16:51:32.395 7723 TRACE nova.compute.manager [instance: d4083a7f-0c2d-44b3-a79b-7f498ea75ecd] TypeError: __init__() got an unexpected keyword argument 'close_on_exit'\n\nAfter doing some research I found out that the close_on_exit parameter is supported only on the newer versions of libguestfs.x86_64 and python-libguestfs.x86_64.\n\nIn my system (RHEL 6.4) I had\nlibguestfs.x86_64 1:1.16.34-2.el6\npython-libguestfs.x86_64 1:1.16.34-2.el6\n\nAfter updating to the following versions the deploy operation started working again.\nlibguestfs.x86_64 1:1.20.11-2.el6\npython-libguestfs.x86_64 1:1.20.11-2.el6", 
            "date_created": "2014-01-22 14:24:56.745047+00:00", 
            "author": "https://api.launchpad.net/1.0/~jorgedr"
        }, 
        {
            "content": "Hi Jorge,\n\nHow did you install the later versions of libguestfs and python-libguestfs?  I'm relying on EPEL and they're not available yet there.  A manual download of libguestfs and install bring up  a whole bunch of additional dependencies... It's going to be a nightmare to install them all manually.\n\nThanks!\nTom.", 
            "date_created": "2014-01-23 22:41:19.063063+00:00", 
            "author": "https://api.launchpad.net/1.0/~tdeckers"
        }, 
        {
            "content": "I have removed the close_on_exit parameter locally as a workaround.   That seems to do the trick too.\n\nRegards,\nTom.", 
            "date_created": "2014-01-24 09:02:54.567338+00:00", 
            "author": "https://api.launchpad.net/1.0/~tdeckers"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/70354\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=fd621ef05a024b8319f2c67f7e5c084b9ab77755\nSubmitter: Jenkins\nBranch:    master\n\ncommit fd621ef05a024b8319f2c67f7e5c084b9ab77755\nAuthor: Russell Bryant <email address hidden>\nDate:   Fri Jan 31 09:28:50 2014 -0500\n\n    Deal with old versions of libguestfs\n    \n    Commit 02abbef960b12deaa7a911788dbc56f3a0bd555a added the use of the\n    close_on_exit parameter.  This is supported by libguestfs 1.20 and up.\n    Catch the exeption raised when this parameter isn't supported and retry\n    without it.\n    \n    Change-Id: Ic47c1cb997ece3710f8c4465733148fcfa94068d\n    Closes-Bug: #1271562\n    Related-Bug: #1261475\n", 
            "date_created": "2014-01-31 18:56:09.091376+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/70419", 
            "date_created": "2014-01-31 19:41:19.035268+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hello, how can I tell what version of OpenStack the fix was merged into?  ", 
            "date_created": "2014-02-05 17:24:42.929874+00:00", 
            "author": "https://api.launchpad.net/1.0/~jorgedr"
        }, 
        {
            "content": "Tom,\n\nI got the library from one of my company's repositories. I think they have access to beta packages.   After installing it in one of our systems I could no longer find the packages anymore so I did the same thing that you did.     That is why I want to know what version of open stack this fix is into.    Our product is going to be be based on ice-house so I need to make sure we are going to pick the fix for it. ", 
            "date_created": "2014-02-05 18:00:53.047256+00:00", 
            "author": "https://api.launchpad.net/1.0/~jorgedr"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/70419\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a154ff8e54478d6b2a2396eada97eb5229d74811\nSubmitter: Jenkins\nBranch:    master\n\ncommit a154ff8e54478d6b2a2396eada97eb5229d74811\nAuthor: Russell Bryant <email address hidden>\nDate:   Fri Jan 31 14:30:13 2014 -0500\n\n    Test guestfs without support for close_on_exit\n    \n    A previous commit, fd621ef05a024b8319f2c67f7e5c084b9ab77755, fixed support for\n    versions of libguestfs that did not support the close_on_exit parameter.  This\n    patch adds unit test coverage for that code path.\n    \n    Change-Id: Ic3cc0057e24ac00e6435a9555a19c076ddc9b02e\n    Related-Bug: #1271562\n    Related-Bug: #1261475\n", 
            "date_created": "2014-02-10 19:20:23.903432+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-05 13:06:30.304794+00:00"
}