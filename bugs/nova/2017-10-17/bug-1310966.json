{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:27:57.340302+00:00", 
    "description": "nova-network with floating IPs is currently broken due to a direct DB access\n\n2014-04-22 08:04:32.395 ESC[01;31mERROR oslo.messaging.rpc.dispatcher [ESC[01;36mreq-8fa8da3a-2e61-47e9-a6c6-68f598e979ad ESC[00;36mTestServerAdvancedOps-228418898\nTestServerAdvancedOps-892915532ESC[01;31m] ESC[01;35mESC[01;31mException during message handling: nova-computeESC[00m\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 133, in _dispatch_and_reply\n\u00a0\u00a0\u00a0\u00a0incoming.message))\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 176, in _dispatch\n\u00a0\u00a0\u00a0\u00a0return self._do_dispatch(endpoint, method, ctxt, args)\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 122, in _do_dispatch\n\u00a0\u00a0\u00a0\u00a0result = getattr(endpoint, method)(ctxt, **new_args)\n\u00a0\u00a0File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n\u00a0\u00a0\u00a0\u00a0payload)\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\u00a0\u00a0File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n\u00a0\u00a0\u00a0\u00a0return f(self, context, *args, **kw)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 276, in decorated_function\n\u00a0\u00a0\u00a0\u00a0pass\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 262, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 329, in decorated_function\n\u00a0\u00a0\u00a0\u00a0function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 250, in decorated_function\n\u00a0\u00a0\u00a0\u00a0migration.instance_uuid, exc_info=True)\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 237, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 305, in decorated_function\n\u00a0\u00a0\u00a0\u00a0e, sys.exc_info())\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 292, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 3472, in resize_instance\n\u00a0\u00a0\u00a0\u00a0migration_p)\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/api.py\", line 45, in wrapped\n\u00a0\u00a0\u00a0\u00a0return func(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/api.py\", line 492, in migrate_instance_start\n\u00a0\u00a0\u00a0\u00a0self._get_floating_ip_addresses(context, instance)\n\u00a0\u00a0File \"/opt/stack/nova/nova/network/api.py\", line 474, in _get_floating_ip_addresses\n\u00a0\u00a0\u00a0\u00a0instance['uuid'])\n\u00a0\u00a0File \"/opt/stack/nova/nova/db/api.py\", line 700, in instance_floating_address_get_all\n\u00a0\u00a0\u00a0\u00a0return IMPL.instance_floating_address_get_all(context, instance_uuid)\n\u00a0\u00a0File \"/opt/stack/nova/nova/cmd/compute.py\", line 52, in __call__\n\u00a0\u00a0\u00a0\u00a0raise exception.DBNotAllowed('nova-compute')\nDBNotAllowed: nova-compute", 
    "tags": [
        "network"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1310966", 
    "owner": "None", 
    "id": 1310966, 
    "index": 1483, 
    "openned": "2014-04-22 08:17:07.243433+00:00", 
    "created": "2014-04-22 08:17:07.243433+00:00", 
    "title": "nova network floating IP has direct DB access", 
    "comments": [
        {
            "content": "2014-04-22 08:04:32.395 ESC[01;31mERROR oslo.messaging.rpc.dispatcher [ESC[01;36mreq-8fa8da3a-2e61-47e9-a6c6-68f598e979ad ESC[00;36mTestServerAdvancedOps-228418898\nTestServerAdvancedOps-892915532ESC[01;31m] ESC[01;35mESC[01;31mException during message handling: nova-computeESC[00m\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 133, in _dispatch_and_reply\n    incoming.message))\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 176, in _dispatch\n    return self._do_dispatch(endpoint, method, ctxt, args)\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 122, in _do_dispatch\n    result = getattr(endpoint, method)(ctxt, **new_args)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    payload)\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 276, in decorated_function\n    pass\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 262, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 329, in decorated_function\n    function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 250, in decorated_function\n    migration.instance_uuid, exc_info=True)\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 237, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 305, in decorated_function\n    e, sys.exc_info())\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 292, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 3472, in resize_instance\n    migration_p)\n  File \"/opt/stack/nova/nova/network/api.py\", line 45, in wrapped\n    return func(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/network/api.py\", line 492, in migrate_instance_start\n    self._get_floating_ip_addresses(context, instance)\n  File \"/opt/stack/nova/nova/network/api.py\", line 474, in _get_floating_ip_addresses\n    instance['uuid'])\n  File \"/opt/stack/nova/nova/db/api.py\", line 700, in instance_floating_address_get_all\n    return IMPL.instance_floating_address_get_all(context, instance_uuid)\n  File \"/opt/stack/nova/nova/cmd/compute.py\", line 52, in __call__\n    raise exception.DBNotAllowed('nova-compute')\nDBNotAllowed: nova-compute", 
            "date_created": "2014-04-22 08:17:07.243433+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }, 
        {
            "content": "This bug was introduced by commit https://review.openstack.org/#/c/87019/", 
            "date_created": "2014-04-22 08:22:16.124262+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/89580\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=625e48f82b5c7f1d55641b4207afd85b0b798cc2\nSubmitter: Jenkins\nBranch:    master\n\ncommit 625e48f82b5c7f1d55641b4207afd85b0b798cc2\nAuthor: Dan Smith <email address hidden>\nDate:   Tue Apr 22 06:59:43 2014 -0700\n\n    Fix migrate_instance_*() using DB for floating addresses\n    \n    This fixes the network api's migrate_instance_start() and\n    migrate_instance_finish() methods that are still hitting the database\n    directly for an oddball call to get a list of floating addresses.\n    \n    Change-Id: Ia310e31d31aaf5c979e41c64af8223202a18e03a\n    Closes-bug: #1310966\n", 
            "date_created": "2014-04-22 21:58:37.080494+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }
    ], 
    "closed": "2014-06-11 13:42:30.809957+00:00"
}