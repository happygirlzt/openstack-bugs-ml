{
    "status": "Invalid", 
    "last_updated": "2012-06-07 07:58:42.801364+00:00", 
    "description": "Key pair creation with invalid/empty public key returns error 500.\n\nExpected result:\n============\nIt should return 404\n\nBelow is the log:\n============\n\n-<error type=\"__builtin__.str\">\n<![CDATA[Traceback (most recent call last): File \"/usr/local/lib/python2.7/dist-packages/unittest2-0.5.1-py2.7.egg/unittest2/case.py\", line 340, in run testMethod() File \"/usr/local/lib/python2.7/dist-packages/nose-1.1.2-py2.7.egg/nose/tools.py\", line 80, in newfunc func(*arg, **kw) File \"/home/umamaheshk/source/csbu-qa/AutomatedTests/python_tests/hp_regression/nova/consolidationrunST2/keypairs/test_keypairs.py\", line 223, in test_006_create_keypair_with_empty_pubkey body=request_data) File \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.8-py2.7.egg/novaclient/client.py\", line 145, in post return self._cs_request(url, 'POST', **kwargs) File \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.8-py2.7.egg/novaclient/client.py\", line 121, in _cs_request **kwargs) File \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.8-py2.7.egg/novaclient/client.py\", line 104, in request raise exceptions.from_response(resp, body) BadRequest: Keypair data is invalid (HTTP 400) -------------------- >> begin captured logging << -------------------- novaclient.client: DEBUG: REQ: curl -i http://10.233.52.27:8774/v2/8a05c089f11b421dac57f11f10495238//os-keypairs -X POST -H \"X-Auth-Project-Id: demo\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"X-Auth-Token: c4f1896dc8e1481783e8936707ac7bff\" novaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"public_key\": \"\", \"name\": \"empty-pubkey\"}} novaclient.client: DEBUG: RESP:{'date': 'Thu, 12 Apr 2012 13:34:28 GMT', 'status': '400', 'content-length': '67', 'content-type': 'application/json; charset=UTF-8', 'x-compute-request-id': 'req-d3e6fabd-62d1-49d7-a418-b103afa17d8d'} {\"badRequest\": {\"message\": \"Keypair data is invalid\", \"code\": 400}} --------------------- >> end captured logging << ---------------------]]>\n</error>\n\n======================================================================\nERROR: test_005_create_keypair_with_invalid_pubkey (test_key_pairs.testKeyPairs)\n----------------------------------------------------------------------\nTraceback (most recent call last):\nFile \"/usr/local/lib/python2.7/dist-packages/nose-1.1.2-py2.7.egg/nose/tools.py\", line 80, in newfunc\nfunc(*arg, **kw)\nFile \"/home/sapank/source/csbu-qa/AutomatedTests/python_tests/hp_regression/nova_regression/test_key_pairs.py\", line 193, in test_005_create_keypair_with_invalid_pubkey\nbody=request_data)\nFile \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.7-py2.7.egg/novaclient/client.py\", line 135, in post\nreturn self._cs_request(url, 'POST', **kwargs)\nFile \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.7-py2.7.egg/novaclient/client.py\", line 119, in _cs_request\n**kwargs)\nFile \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.7-py2.7.egg/novaclient/client.py\", line 102, in request\nraise exceptions.from_response(resp, body)\nClientException: <attribute 'message' of 'exceptions.BaseException' objects> (HTTP Unexpected error while running command.\nCommand: ssh-keygen -q -l -f /tmp/tmprxEA_5/import.pub\nExit code: 1\nStdout: '/tmp/tmprxEA_5/import.pub is not a public key file.\\n'\nStderr: 'line 1 too long: invalid...\\r\\n' (HTTP 500)\n-------------------- >> begin captured logging << --------------------\nnovaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"name\": \"keyname_0\"}}\n\nnovaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"name\": \"keyname_1\"}}\n\nnovaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"name\": \"keyname_2\"}}\n\nnovaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"public_key\": \"invalid\", \"name\": \"invalid-pubkey\"}}\n\n--------------------- >> end captured logging << ---------------------)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/980695", 
    "owner": "None", 
    "id": 980695, 
    "index": 4036, 
    "openned": "2012-04-13 10:51:11.432777+00:00", 
    "created": "2012-04-13 10:51:11.432777+00:00", 
    "title": "Keypair creation with invalid/empty public key returns error 500", 
    "comments": [
        {
            "content": "Key pair creation with invalid/empty public key returns error 500.\n\nExpected result:\n============\nIt should return 404\n\nBelow is the log:\n============\n\n-<error type=\"__builtin__.str\">\n<![CDATA[Traceback (most recent call last): File \"/usr/local/lib/python2.7/dist-packages/unittest2-0.5.1-py2.7.egg/unittest2/case.py\", line 340, in run testMethod() File \"/usr/local/lib/python2.7/dist-packages/nose-1.1.2-py2.7.egg/nose/tools.py\", line 80, in newfunc func(*arg, **kw) File \"/home/umamaheshk/source/csbu-qa/AutomatedTests/python_tests/hp_regression/nova/consolidationrunST2/keypairs/test_keypairs.py\", line 223, in test_006_create_keypair_with_empty_pubkey body=request_data) File \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.8-py2.7.egg/novaclient/client.py\", line 145, in post return self._cs_request(url, 'POST', **kwargs) File \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.8-py2.7.egg/novaclient/client.py\", line 121, in _cs_request **kwargs) File \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.8-py2.7.egg/novaclient/client.py\", line 104, in request raise exceptions.from_response(resp, body) BadRequest: Keypair data is invalid (HTTP 400) -------------------- >> begin captured logging << -------------------- novaclient.client: DEBUG: REQ: curl -i http://10.233.52.27:8774/v2/8a05c089f11b421dac57f11f10495238//os-keypairs -X POST -H \"X-Auth-Project-Id: demo\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"X-Auth-Token: c4f1896dc8e1481783e8936707ac7bff\" novaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"public_key\": \"\", \"name\": \"empty-pubkey\"}} novaclient.client: DEBUG: RESP:{'date': 'Thu, 12 Apr 2012 13:34:28 GMT', 'status': '400', 'content-length': '67', 'content-type': 'application/json; charset=UTF-8', 'x-compute-request-id': 'req-d3e6fabd-62d1-49d7-a418-b103afa17d8d'} {\"badRequest\": {\"message\": \"Keypair data is invalid\", \"code\": 400}} --------------------- >> end captured logging << ---------------------]]>\n</error>\n\n======================================================================\nERROR: test_005_create_keypair_with_invalid_pubkey (test_key_pairs.testKeyPairs)\n----------------------------------------------------------------------\nTraceback (most recent call last):\nFile \"/usr/local/lib/python2.7/dist-packages/nose-1.1.2-py2.7.egg/nose/tools.py\", line 80, in newfunc\nfunc(*arg, **kw)\nFile \"/home/sapank/source/csbu-qa/AutomatedTests/python_tests/hp_regression/nova_regression/test_key_pairs.py\", line 193, in test_005_create_keypair_with_invalid_pubkey\nbody=request_data)\nFile \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.7-py2.7.egg/novaclient/client.py\", line 135, in post\nreturn self._cs_request(url, 'POST', **kwargs)\nFile \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.7-py2.7.egg/novaclient/client.py\", line 119, in _cs_request\n**kwargs)\nFile \"/usr/local/lib/python2.7/dist-packages/python_novaclient-2.6.7-py2.7.egg/novaclient/client.py\", line 102, in request\nraise exceptions.from_response(resp, body)\nClientException: <attribute 'message' of 'exceptions.BaseException' objects> (HTTP Unexpected error while running command.\nCommand: ssh-keygen -q -l -f /tmp/tmprxEA_5/import.pub\nExit code: 1\nStdout: '/tmp/tmprxEA_5/import.pub is not a public key file.\\n'\nStderr: 'line 1 too long: invalid...\\r\\n' (HTTP 500)\n-------------------- >> begin captured logging << --------------------\nnovaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"name\": \"keyname_0\"}}\n\nnovaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"name\": \"keyname_1\"}}\n\nnovaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"name\": \"keyname_2\"}}\n\nnovaclient.client: DEBUG: REQ BODY: {\"keypair\": {\"public_key\": \"invalid\", \"name\": \"invalid-pubkey\"}}\n\n--------------------- >> end captured logging << ---------------------)", 
            "date_created": "2012-04-13 10:51:11.432777+00:00", 
            "author": "https://api.launchpad.net/1.0/~sahitya-k"
        }, 
        {
            "content": "I tested with the latest nova code. Here is what it returns:\n400 is the returned code. Is this what you expect, Sahitya?\n=================\n[Thu Jun 07 15:47:47 2012] [error] INFO:horizon.dashboards.nova.access_and_security.keypairs.forms:Importing keypair \"gd\"\n[Thu Jun 07 15:47:47 2012] [error] DEBUG:horizon.api.nova:novaclient connection created using token \"cf6585377a7d4148b86122bcee2de6f7\" and url \"http://9.119.148.201:8774/v2/9461b20ea1a549279b3542d765d7b11b\"\n[Thu Jun 07 15:47:47 2012] [error] DEBUG:novaclient.client:REQ: curl -i http://9.119.148.201:8774/v2/9461b20ea1a549279b3542d765d7b11b/os-keypairs -X POST -H \"X-Auth-Project-Id: 9461b20ea1a549279b3542d765d7b11b\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: cf6585377a7d4148b86122bcee2de6f7\"\n[Thu Jun 07 15:47:47 2012] [error]\n[Thu Jun 07 15:47:47 2012] [error] DEBUG:novaclient.client:REQ BODY: {\"keypair\": {\"public_key\": \"gdfgfgd\", \"name\": \"gd\"}}\n[Thu Jun 07 15:47:47 2012] [error]\n[Thu Jun 07 15:47:47 2012] [error] DEBUG:novaclient.client:RESP:{'date': 'Thu, 07 Jun 2012 07:47:47 GMT', 'status': '400', 'content-length': '67', 'content-type': 'application/json; charset=UTF-8', 'x-compute-request-id': 'req-57cfb4e5-04c2-4f69-b69f-82ec3edfaca6'} {\"badRequest\": {\"message\": \"Keypair data is invalid\", \"code\": 400}}\n[Thu Jun 07 15:47:47 2012] [error]\n[Thu Jun 07 15:47:47 2012] [error] ERROR:horizon.dashboards.nova.access_and_security.keypairs.forms:ClientException in ImportKeypair\n[Thu Jun 07 15:47:47 2012] [error] Traceback (most recent call last):\n[Thu Jun 07 15:47:47 2012] [error]   File \"/opt/stack/horizon/openstack_dashboard/wsgi/../../horizon/dashboards/nova/access_and_security/keypairs/forms.py\", line 64, in handle\n[Thu Jun 07 15:47:47 2012] [error]     api.keypair_import(request, data['name'], data['public_key'])\n[Thu Jun 07 15:47:47 2012] [error]   File \"/opt/stack/horizon/openstack_dashboard/wsgi/../../horizon/api/nova.py\", line 278, in keypair_import\n[Thu Jun 07 15:47:47 2012] [error]     return novaclient(request).keypairs.create(name, public_key)\n[Thu Jun 07 15:47:47 2012] [error]   File \"/opt/stack/python-novaclient/novaclient/v1_1/keypairs.py\", line 58, in create\n[Thu Jun 07 15:47:47 2012] [error]     return self._create('/os-keypairs', body, 'keypair')\n[Thu Jun 07 15:47:47 2012] [error]   File \"/opt/stack/python-novaclient/novaclient/base.py\", line 149, in _create\n[Thu Jun 07 15:47:47 2012] [error]     resp, body = self.api.client.post(url, body=body)\n[Thu Jun 07 15:47:47 2012] [error]   File \"/opt/stack/python-novaclient/novaclient/client.py\", line 140, in post\n[Thu Jun 07 15:47:47 2012] [error]     return self._cs_request(url, 'POST', **kwargs)\n[Thu Jun 07 15:47:47 2012] [error]   File \"/opt/stack/python-novaclient/novaclient/client.py\", line 125, in _cs_request\n[Thu Jun 07 15:47:47 2012] [error]     **kwargs)\n[Thu Jun 07 15:47:47 2012] [error]   File \"/opt/stack/python-novaclient/novaclient/client.py\", line 108, in request\n[Thu Jun 07 15:47:47 2012] [error]     raise exceptions.from_response(resp, body)\n[Thu Jun 07 15:47:47 2012] [error] BadRequest: Keypair data is invalid (HTTP 400) (Request-ID: req-57cfb4e5-04c2-4f69-b69f-82ec3edfaca6)\n[Thu Jun 07 15:47:47 2012] [error] DEBUG:django.db.backends:(0.001) SELECT \"django_session\".\"session_key\", \"django_session\".\"session_data\", \"django_session\".\"expire_date\" FROM \"django_session\" WHERE (\"django_session\".\"session_key\" = e868b4afed172b398b84af95bdbbb70f  AND \"django_session\".\"expire_date\" > 2012-06-07 15:47:47.860107 ); args=('e868b4afed172b398b84af95bdbbb70f', u'2012-06-07 15:47:47.860107')\n[Thu Jun 07 15:47:47 2012] [error] DEBUG:horizon.api.keystone:Creating a new keystoneclient connection to http://9.119.148.201:5000/v2.0.\n[Thu Jun 07 15:47:47 2012] [error] DEBUG:keystoneclient.client:REQ: curl -i http://9.119.148.201:5000/v2.0/tenants -X GET -H \"User-Agent: python-keystoneclient\" -H \"X-Auth-Token: 27b5ad77c17247dca3234d179477b04f\"\n[Thu Jun 07 15:47:47 2012] [error]\n[Thu Jun 07 15:47:47 2012] [error] DEBUG:keystoneclient.client:RESP: {'status': '200', 'content-length': '231', 'content-location': u'http://9.119.148.201:5000/v2.0/tenants', 'vary': 'X-Auth-Token', 'date': 'Thu, 07 Jun 2012 07:47:47 GMT', 'content-type': 'application/json'}\n[Thu Jun 07 15:47:47 2012] [error] RESP BODY: {\"tenants_links\": [], \"tenants\": [{\"enabled\": true, \"description\": null, \"name\": \"admin\", \"id\": \"4b941097ba21478eadd75dfb780a581c\"}, {\"enabled\": true, \"description\": null, \"name\": \"demo\", \"id\": \"9461b20ea1a549279b3542d765d7b11b\"}]}\n[Thu Jun 07 15:47:47 2012] [error]\n==================================", 
            "date_created": "2012-06-07 07:53:55.773901+00:00", 
            "author": "https://api.launchpad.net/1.0/~houshengbo"
        }, 
        {
            "content": "Can you test again?\n\nI tested \"POST /os-keypairs\", it works well. \nIf the public key is empty, it will create one. \nIf the public key is invalid, it will return error code 400 \"Bad Request\". There is a log in the backend: HTTP exception thrown: Keypair data is invalid.\n\nI noticed the url link in your log is : http://10.233.52.27:8774/v2/8a05c089f11b421dac57f11f10495238//os-keypairs. Please note there are two \"/\" before \"os-keypairs\". \n\nPlease test again. If there are still problems, you can let us know. Thanks.\n", 
            "date_created": "2012-06-07 07:58:41.386036+00:00", 
            "author": "https://api.launchpad.net/1.0/~daisy-ycguo"
        }
    ], 
    "closed": "2012-06-07 07:56:34.548733+00:00"
}