{
    "status": "Expired", 
    "last_updated": "2016-07-05 09:53:20.215225+00:00", 
    "description": "When doing a concurrent spawn for VMs(30). Noticed some VM spawn failures due to error below.\n\nThe reason is that during prebuild_instance, it will list all instances of existing. But if concurrent process for spawning is happening, it is possible that certain VM is just in process of creation in VCenter, and the vsphere SDK only return partial object for that VM. So there is no propSet for that VM created at the phase. \n\nShould add check for these cases. \n\n\n2014-09-14 03:53:31.311 2680 ERROR oslo.messaging.rpc.dispatcher [-] Exception during message handling: ObjectContent instance has no attribute 'propSet'\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/messaging/rpc/server.py\", line 139, in inner\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return func(*args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 88, in wrapped\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 71, in wrapped\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 282, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 268, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 335, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     function(self, context, *args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 311, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     e, sys.exc_info())\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 298, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2140, in run_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     do_run_instance()\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 249, in inner\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2139, in do_run_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     legacy_bdm_in_spec)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1236, in _run_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     notify(\"error\", fault=e)  # notify that build failed\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1206, in _run_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     self._prebuild_instance(context, instance)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1239, in _prebuild_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     self._check_instance_exists(context, instance)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1504, in _check_instance_exists\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     if self.driver.instance_exists(instance['name']):\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/virt/driver.py\", line 204, in instance_exists\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return instance_id in self.list_instances()\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 604, in list_instances\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     instances.extend(vmops.list_instances())\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 2067, in list_instances\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     lst_vm_names = self._get_valid_vms_from_retrieve_result(vms)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 1851, in _get_valid_vms_from_retrieve_result\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     for prop in vm.propSet:\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher AttributeError: ObjectContent instance has no attribute 'propSet'\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher", 
    "tags": [
        "vmware"
    ], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1372708", 
    "owner": "None", 
    "id": 1372708, 
    "index": 6443, 
    "openned": "2014-09-23 01:26:24.785233+00:00", 
    "created": "2014-09-23 01:26:24.785233+00:00", 
    "title": "VMWare: vm spawn failure due to no attribute 'propSet' in concurrent case", 
    "comments": [
        {
            "content": "When doing a concurrent spawn for VMs(30). Noticed some VM spawn failures due to error below.\n\nThe reason is that during prebuild_instance, it will list all instances of existing. But if concurrent process for spawning is happening, it is possible that certain VM is just in process of creation in VCenter, and the vsphere SDK only return partial object for that VM. So there is no propSet for that VM created at the phase. \n\nShould add check for these cases. \n\n\n2014-09-14 03:53:31.311 2680 ERROR oslo.messaging.rpc.dispatcher [-] Exception during message handling: ObjectContent instance has no attribute 'propSet'\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/oslo/messaging/rpc/server.py\", line 139, in inner\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return func(*args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 88, in wrapped\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 71, in wrapped\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 282, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 268, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 335, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     function(self, context, *args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 311, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     e, sys.exc_info())\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 298, in decorated_function\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2140, in run_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     do_run_instance()\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 249, in inner\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return f(*args, **kwargs)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2139, in do_run_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     legacy_bdm_in_spec)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1236, in _run_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     notify(\"error\", fault=e)  # notify that build failed\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1206, in _run_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     self._prebuild_instance(context, instance)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1239, in _prebuild_instance\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     self._check_instance_exists(context, instance)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1504, in _check_instance_exists\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     if self.driver.instance_exists(instance['name']):\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/virt/driver.py\", line 204, in instance_exists\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     return instance_id in self.list_instances()\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 604, in list_instances\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     instances.extend(vmops.list_instances())\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 2067, in list_instances\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     lst_vm_names = self._get_valid_vms_from_retrieve_result(vms)\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 1851, in _get_valid_vms_from_retrieve_result\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher     for prop in vm.propSet:\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher AttributeError: ObjectContent instance has no attribute 'propSet'\n2014-09-14 03:53:31.311 2680 TRACE oslo.messaging.rpc.dispatcher", 
            "date_created": "2014-09-23 01:26:24.785233+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhuzhubj"
        }, 
        {
            "content": "Zhu Zhu, will you be filing a review with a fix?", 
            "date_created": "2014-09-23 01:43:13.162543+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/123309", 
            "date_created": "2014-09-23 01:49:31.463893+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Patch stalled in merge conflict", 
            "date_created": "2015-03-30 18:14:34.855654+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Change abandoned by Zhu Zhu (<email address hidden>) on branch: master\nReview: https://review.openstack.org/123309", 
            "date_created": "2015-04-20 03:50:37.571104+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Raising an AttributeError is the right behavior IMO. The same issue happened under scale test, but for a VM deletion. A retry successfully deleted the error-ed VM.\n\nThe abandoned review returns a None in place of a missing propSet which is not doing to help complete VM operations like spawn or delete successfully.\n\n", 
            "date_created": "2015-09-07 06:56:47.850840+00:00", 
            "author": "https://api.launchpad.net/1.0/~visnusaran-murugan"
        }, 
        {
            "content": "_get_object_from_results initiates a ContinueRetrievePropertiesEx  if the queried object is None. _get_object_for_value should check Token attribute in the resultSet and return None instead of accessing propSet which ends in an AttributeError.\n\nPlease ignore my earlier comment (#5)", 
            "date_created": "2015-09-07 11:28:21.285108+00:00", 
            "author": "https://api.launchpad.net/1.0/~visnusaran-murugan"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/221038", 
            "date_created": "2015-09-07 15:11:45.165568+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Visnusaran Murugan (<email address hidden>) on branch: master\nReview: https://review.openstack.org/221038", 
            "date_created": "2015-09-09 05:50:25.685820+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This defect is handled in kilo+ code and affects Juno only. Refer to @garyk's comment in the review.", 
            "date_created": "2015-09-09 05:52:59.899662+00:00", 
            "author": "https://api.launchpad.net/1.0/~visnusaran-murugan"
        }, 
        {
            "content": "\nThis is an automated cleanup. This bug report has been closed because it\nis older than 18 months and there is no open code change to fix this.\nAfter this time it is unlikely that the circumstances which lead to\nthe observed issue can be reproduced.\n\nIf you can reproduce the bug, please:\n* reopen the bug report (set to status \"New\")\n* AND add the detailed steps to reproduce the issue (if applicable)\n* AND leave a comment \"CONFIRMED FOR: <RELEASE_NAME>\"\n  Only still supported release names are valid (LIBERTY, MITAKA, OCATA, NEWTON).\n  Valid example: CONFIRMED FOR: LIBERTY\n", 
            "date_created": "2016-07-05 09:53:19.561654+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ], 
    "closed": "2016-07-05 09:53:17.632967+00:00"
}