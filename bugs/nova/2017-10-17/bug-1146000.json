{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:17:45.241759+00:00", 
    "description": "branch: master\ncommit: bcdbe9ba881db8b38525bfc44a182e6b210459cd\n\n2013-03-05 12:37:29.658 ERROR nova.openstack.common.rpc.amqp [req-5f8a3941-839b-4226-b6e6-709627aaeecd 1458120d63784bb49858437c275dc59e 7dd8607e7d294efc845ccf68f8d282b7] Exception during message handling\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 393, in _process_data\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/floating_ips.py\", line 116, in allocate_for_instance\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     **kwargs)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 508, in allocate_for_instance\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     requested_networks=requested_networks)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 211, in _allocate_fixed_ips\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     vpn=vpn, address=address)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 1658, in allocate_fixed_ip\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     instance_id)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 380, in _do_trigger_security_group_members_refresh_for_instance\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     group_ids)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 3147, in trigger_members_refresh\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     context, instance['host'], instance)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/rpcapi.py\", line 669, in refresh_instance_security_rules\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     instance_p = jsonutils.to_primitive(instance)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/jsonutils.py\", line 107, in to_primitive\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     return recursive(dict(value.iteritems()), level=level + 1)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/db/sqlalchemy/models.py\", line 88, in iteritems\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     local = dict(self)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/db/sqlalchemy/models.py\", line 77, in next\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     return n, getattr(self, n)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 168, in __get__\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     return self.impl.get(instance_state(instance),dict_)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 453, in get\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     value = self.callable_(state, passive)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 481, in _load_for_state\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     (mapperutil.state_str(state), self.key)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp DetachedInstanceError: Parent instance <Instance at 0x5888190> is not bound to a Session; lazy load operation of attribute 'system_metadata' cannot proceed\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [], 
    "importance": "High", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1146000", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 1146000, 
    "index": 1001, 
    "openned": "2013-03-05 04:55:50.112450+00:00", 
    "created": "2013-03-05 04:55:50.112450+00:00", 
    "title": "lazy load 'system_metadata' error in nova-network", 
    "comments": [
        {
            "content": "branch: master\ncommit: bcdbe9ba881db8b38525bfc44a182e6b210459cd\n\n2013-03-05 12:37:29.658 ERROR nova.openstack.common.rpc.amqp [req-5f8a3941-839b-4226-b6e6-709627aaeecd 1458120d63784bb49858437c275dc59e 7dd8607e7d294efc845ccf68f8d282b7] Exception during message handling\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 393, in _process_data\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/floating_ips.py\", line 116, in allocate_for_instance\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     **kwargs)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 508, in allocate_for_instance\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     requested_networks=requested_networks)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 211, in _allocate_fixed_ips\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     vpn=vpn, address=address)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 1658, in allocate_fixed_ip\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     instance_id)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 380, in _do_trigger_security_group_members_refresh_for_instance\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     group_ids)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 3147, in trigger_members_refresh\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     context, instance['host'], instance)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/rpcapi.py\", line 669, in refresh_instance_security_rules\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     instance_p = jsonutils.to_primitive(instance)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/jsonutils.py\", line 107, in to_primitive\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     return recursive(dict(value.iteritems()), level=level + 1)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/db/sqlalchemy/models.py\", line 88, in iteritems\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     local = dict(self)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/db/sqlalchemy/models.py\", line 77, in next\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     return n, getattr(self, n)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 168, in __get__\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     return self.impl.get(instance_state(instance),dict_)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 453, in get\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     value = self.callable_(state, passive)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 481, in _load_for_state\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp     (mapperutil.state_str(state), self.key)\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp DetachedInstanceError: Parent instance <Instance at 0x5888190> is not bound to a Session; lazy load operation of attribute 'system_metadata' cannot proceed\n2013-03-05 12:37:29.658 14282 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2013-03-05 04:55:50.112450+00:00", 
            "author": "https://api.launchpad.net/1.0/~motokentsai"
        }, 
        {
            "content": "How can I reproduce this?", 
            "date_created": "2013-03-11 06:27:10.606184+00:00", 
            "author": "https://api.launchpad.net/1.0/~niuwl586-v"
        }, 
        {
            "content": "I haven't reproduced this bug.\n", 
            "date_created": "2013-03-12 09:31:02.568278+00:00", 
            "author": "https://api.launchpad.net/1.0/~niuwl586-v"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/24221", 
            "date_created": "2013-03-12 17:51:29.933112+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/24221\nCommitted: http://github.com/openstack/nova/commit/edf57ca3f4e822e45300f50471fbb90f14f1ab94\nSubmitter: Jenkins\nBranch:    master\n\ncommit edf57ca3f4e822e45300f50471fbb90f14f1ab94\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Tue Mar 12 10:49:21 2013 -0700\n\n    Don't load system_metadata when it isn't joined.\n    \n    If we always load system_metadata, it will throw a sqlalchemy\n    error if it isn't joined in the column. Rather than putting it\n    in extra keys we need to explicitly join it if it is missing.\n    \n    Adds a test to make sure that system_metadata is returned\n    properly from the migration call even though the extra keys\n    parameter was removed.\n    \n    Fixes bug 1146000\n    \n    Change-Id: I05365906ed528a06fe5704449dab72c857fefa65\n", 
            "date_created": "2013-03-13 22:01:23.984952+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-03-20 16:07:29.164799+00:00"
}