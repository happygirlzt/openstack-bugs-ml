{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:17:47.033666+00:00", 
    "description": "Using recent Nova grizzly code (git bcafae5) I'm now seeing the following exception when I try to delete an instance in the RESIZE state.\n\n\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.7/contextlib.py\", line 24, in __exit__\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 256, in decorated_function\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     event_name, instance_uuid):\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/compute/utils.py\", line 317, in __enter__\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     self.conductor.action_event_start(self.context, event)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/conductor/api.py\", line 261, in action_event_start\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     return self._manager.action_event_start(context, values)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/utils.py\", line 1430, in wrapper\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     return func(*args, **kwargs)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 331, in action_event_start\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     evt = self.db.action_event_start(context, values)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 1637, in action_event_start\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     return IMPL.action_event_start(context, values)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 4556, in action_event_start\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     instance_uuid=values['instance_uuid'])\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp InstanceActionNotFound: Action for request_id req-1d8a3942-3f64-40fd-829f-4832d83c56fb on instance af217dbd-286e-47f9-aed7-0b9389bda5c4 not found\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp\n2013-03-05 10:28:57.805 ERROR nova.openstack.common.rpc.common [req-1d8a3942-3f64-40fd-829f-4832d83c56fb 649f11019c074251a512e8275ff333dc c8d62a65698f4398ba3d3c458aceb0ad] Returning exception Action for request_id req-1d8a3942-3f64-40fd-829f-4832d83c56fb on instance af217dbd-286e-47f9-aed7-0b9389bda5c4 not found to caller\n\n-----\n\nThe issue seems to be that when doing a delete on a resized instance Nova automatically does the resize revert/confirm for you... but we are missing an extra instance_action_start in that case.", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1147387", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 1147387, 
    "index": 1002, 
    "openned": "2013-03-05 17:57:13.206457+00:00", 
    "created": "2013-03-05 17:57:13.206457+00:00", 
    "title": "trying to delete an instance in 'RESIZE' state fails", 
    "comments": [
        {
            "content": "Using recent Nova grizzly code (git bcafae5) I'm now seeing the following exception when I try to delete an instance in the RESIZE state.\n\n\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib64/python2.7/contextlib.py\", line 24, in __exit__\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 256, in decorated_function\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     event_name, instance_uuid):\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/compute/utils.py\", line 317, in __enter__\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     self.conductor.action_event_start(self.context, event)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/conductor/api.py\", line 261, in action_event_start\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     return self._manager.action_event_start(context, values)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/utils.py\", line 1430, in wrapper\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     return func(*args, **kwargs)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 331, in action_event_start\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     evt = self.db.action_event_start(context, values)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 1637, in action_event_start\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     return IMPL.action_event_start(context, values)\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 4556, in action_event_start\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp     instance_uuid=values['instance_uuid'])\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp InstanceActionNotFound: Action for request_id req-1d8a3942-3f64-40fd-829f-4832d83c56fb on instance af217dbd-286e-47f9-aed7-0b9389bda5c4 not found\n2013-03-05 10:28:57.803 21673 TRACE nova.openstack.common.rpc.amqp\n2013-03-05 10:28:57.805 ERROR nova.openstack.common.rpc.common [req-1d8a3942-3f64-40fd-829f-4832d83c56fb 649f11019c074251a512e8275ff333dc c8d62a65698f4398ba3d3c458aceb0ad] Returning exception Action for request_id req-1d8a3942-3f64-40fd-829f-4832d83c56fb on instance af217dbd-286e-47f9-aed7-0b9389bda5c4 not found to caller\n\n-----\n\nThe issue seems to be that when doing a delete on a resized instance Nova automatically does the resize revert/confirm for you... but we are missing an extra instance_action_start in that case.", 
            "date_created": "2013-03-05 17:57:13.206457+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/23583", 
            "date_created": "2013-03-05 18:03:09.026381+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/23583\nCommitted: http://github.com/openstack/nova/commit/4e118a45e7cce335efe9d1286eac4f6c8bd69e4d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4e118a45e7cce335efe9d1286eac4f6c8bd69e4d\nAuthor: Dan Prince <email address hidden>\nDate:   Tue Mar 5 12:59:11 2013 -0500\n\n    Add missing action_start if deleting resized inst.\n    \n    When trying to delete a resized instance Nova will automatically\n    call confirm on the resized instance to help clean things\n    up. With some of the recent action event changes in grizzly this\n    code path was broken due to a missing record_action_start\n    call on the confirm_resize operation.\n    \n    Fixes LP Bug #1147387.\n    \n    Change-Id: I23e84de8675c980656a71b71e34ffa0a0801f389\n", 
            "date_created": "2013-03-07 19:57:29.019572+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-03-20 16:07:32.186634+00:00"
}