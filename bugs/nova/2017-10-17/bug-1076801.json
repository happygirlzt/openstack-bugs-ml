{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:09:54.100163+00:00", 
    "description": "During finish_resize the computer manager calls volume_api.initialize_connection but doesn't use the return value.\n\nIf the connection info changes (e.g. new iqn or chap) the new resized instance can't attach the volumes and goes to error:\n\n2012-11-08 22:00:08 DEBUG nova.openstack.common.lockutils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Got semaphore \"connect_volume\n\" for method \"connect_volume\"... from (pid=13925) inner /opt/stack/nova/nova/openstack/common/lockutils.py:186\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 255 from (pid=13925) execute /opt/stack\n/nova/nova/utils.py:197\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 --op new from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 0 from (pid=13925) execute /opt/stack/n\nova/nova/utils.py:197\n2012-11-08 22:00:08 DEBUG nova.virt.libvirt.volume [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] iscsiadm ('--op', 'new'): stdout=New\n iSCSI node [tcp:[hw=,ip=,net_if=,iscsi_if=default] 10.127.0.162,3260,-1 iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24\n056-fabf-4721-b4ae-199eaac665dd] added\n stderr= from (pid=13925) _run_iscsiadm /opt/stack/nova/nova/virt/libvirt/volume.py:119\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 --login from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 255 from (pid=13925) execute /opt/stack\n/nova/nova/utils.py:197\n2012-11-08 22:00:09 DEBUG nova.virt.libvirt.volume [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] iscsiadm ('--login',): stdout=Loggin\ng in to [iface: default, target: iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd, portal:\n 10.127.0.162,3260]\n stderr=iscsiadm: Could not login to [iface: default, target: iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-47\n21-b4ae-199eaac665dd, portal: 10.127.0.162,3260]: \niscsiadm: initiator reported error (19 - encountered non-retryable iSCSI login failure)\n from (pid=13925) _run_iscsiadm /opt/stack/nova/nova/virt/libvirt/volume.py:119\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 --op update -n node.startup -v automatic from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 0 from (pid=13925) execute /opt/stack/n\nova/nova/utils.py:197\n2012-11-08 22:00:09 DEBUG nova.virt.libvirt.volume [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] iscsiadm ('--op', 'update', '-n', 'n\node.startup', '-v', 'automatic'): stdout= stderr= from (pid=13925) _run_iscsiadm /opt/stack/nova/nova/virt/libvirt/volume.py:119\n2012-11-08 22:00:09 WARNING nova.virt.libvirt.volume [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] ISCSI volume not yet found at: vdb\n. Will rescan & retry.  Try number: 0\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 --rescan from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 255 from (pid=13925) execute /opt/stack/nova/nova/utils.py:197\n2012-11-08 22:00:09 ERROR nova.compute.manager [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] [instance: 87b81085-6caa-46c8-9e20-d36b4ae509d9] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p 10.127.0.162:3260 --rescan\nExit code: 255\nStdout: ''\nStderr: 'iscsiadm: No portal found.\\n'. Setting instance vm_state to ERROR\n\n\n2012-11-08 22:00:10 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 276, in _process_da\nta\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispa\ntch\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 115, in wrapped\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 175, in decorated_function\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     pass\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 161, in decorated_function\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 190, in decorated_function\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1911, in finish_resize\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self._set_instance_error_state(context, instance['uuid'])\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1899, in finish_resize\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     disk_info, image)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1866, in _finish_resize\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 115, in wrapped\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2886, in finish_migration\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     block_device_info=block_device_info)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1833, in to_xml\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     rescue, block_device_info)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1787, in get_guest_config\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     root_device):\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1656, in get_guest_storage_config\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     mount_device)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 629, in volume_driver_method\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return method(connection_info, *args, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 229, in inner\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     retval = f(*args, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 183, in connect_volume\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self._run_iscsiadm(iscsi_properties, (\"--rescan\",))\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 117, in _run_iscsiadm\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     check_exit_code=check_exit_code)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/utils.py\", line 204, in execute\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     cmd=' '.join(cmd))\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p 10.127.0.162:3260 --rescan\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Exit code: 255\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Stdout: ''\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Stderr: 'iscsiadm: No portal found.\\n'\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [
        "folsom-backport-potential", 
        "low-hanging-fruit", 
        "volume"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1076801", 
    "owner": "https://api.launchpad.net/1.0/~rconradharris", 
    "id": 1076801, 
    "index": 3140, 
    "openned": "2012-11-08 23:28:04.923030+00:00", 
    "created": "2012-11-08 23:28:04.923030+00:00", 
    "title": "resize instance doesn't use connection_info from initialize_connection", 
    "comments": [
        {
            "content": "During finish_resize the computer manager calls volume_api.initialize_connection but doesn't use the return value.\n\nIf the connection info changes (e.g. new iqn or chap) the new resized instance can't attach the volumes and goes to error:\n\n2012-11-08 22:00:08 DEBUG nova.openstack.common.lockutils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Got semaphore \"connect_volume\n\" for method \"connect_volume\"... from (pid=13925) inner /opt/stack/nova/nova/openstack/common/lockutils.py:186\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 255 from (pid=13925) execute /opt/stack\n/nova/nova/utils.py:197\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 --op new from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 0 from (pid=13925) execute /opt/stack/n\nova/nova/utils.py:197\n2012-11-08 22:00:08 DEBUG nova.virt.libvirt.volume [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] iscsiadm ('--op', 'new'): stdout=New\n iSCSI node [tcp:[hw=,ip=,net_if=,iscsi_if=default] 10.127.0.162,3260,-1 iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24\n056-fabf-4721-b4ae-199eaac665dd] added\n stderr= from (pid=13925) _run_iscsiadm /opt/stack/nova/nova/virt/libvirt/volume.py:119\n2012-11-08 22:00:08 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 --login from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 255 from (pid=13925) execute /opt/stack\n/nova/nova/utils.py:197\n2012-11-08 22:00:09 DEBUG nova.virt.libvirt.volume [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] iscsiadm ('--login',): stdout=Loggin\ng in to [iface: default, target: iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd, portal:\n 10.127.0.162,3260]\n stderr=iscsiadm: Could not login to [iface: default, target: iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-47\n21-b4ae-199eaac665dd, portal: 10.127.0.162,3260]: \niscsiadm: initiator reported error (19 - encountered non-retryable iSCSI login failure)\n from (pid=13925) _run_iscsiadm /opt/stack/nova/nova/virt/libvirt/volume.py:119\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 --op update -n node.startup -v automatic from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 0 from (pid=13925) execute /opt/stack/n\nova/nova/utils.py:197\n2012-11-08 22:00:09 DEBUG nova.virt.libvirt.volume [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] iscsiadm ('--op', 'update', '-n', 'n\node.startup', '-v', 'automatic'): stdout= stderr= from (pid=13925) _run_iscsiadm /opt/stack/nova/nova/virt/libvirt/volume.py:119\n2012-11-08 22:00:09 WARNING nova.virt.libvirt.volume [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] ISCSI volume not yet found at: vdb\n. Will rescan & retry.  Try number: 0\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Running cmd (subprocess): sudo nova-rootwrap /etc/\nnova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p\n 10.127.0.162:3260 --rescan from (pid=13925) execute /opt/stack/nova/nova/utils.py:181\n2012-11-08 22:00:09 DEBUG nova.utils [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] Result was 255 from (pid=13925) execute /opt/stack/nova/nova/utils.py:197\n2012-11-08 22:00:09 ERROR nova.compute.manager [req-574278b6-3610-4657-a7b1-3f6897d46b0a admin demo] [instance: 87b81085-6caa-46c8-9e20-d36b4ae509d9] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p 10.127.0.162:3260 --rescan\nExit code: 255\nStdout: ''\nStderr: 'iscsiadm: No portal found.\\n'. Setting instance vm_state to ERROR\n\n\n2012-11-08 22:00:10 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 276, in _process_da\nta\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispa\ntch\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 115, in wrapped\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 175, in decorated_function\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     pass\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 161, in decorated_function\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 202, in decorated_function\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     kwargs['instance']['uuid'], e, sys.exc_info())\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 190, in decorated_function\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1911, in finish_resize\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self._set_instance_error_state(context, instance['uuid'])\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1899, in finish_resize\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     disk_info, image)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1866, in _finish_resize\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 115, in wrapped\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kw)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2886, in finish_migration\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     block_device_info=block_device_info)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1833, in to_xml\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     rescue, block_device_info)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1787, in get_guest_config\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     root_device):\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1656, in get_guest_storage_config\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     mount_device)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 629, in volume_driver_method\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     return method(connection_info, *args, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 229, in inner\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     retval = f(*args, **kwargs)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 183, in connect_volume\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     self._run_iscsiadm(iscsi_properties, (\"--rescan\",))\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/virt/libvirt/volume.py\", line 117, in _run_iscsiadm\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     check_exit_code=check_exit_code)\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/utils.py\", line 204, in execute\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp     cmd=' '.join(cmd))\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Command: sudo nova-rootwrap /etc/nova/rootwrap.conf iscsiadm -m node -T iqn.2010-11.com.rackspace:5ae88a6d-ba7a-4dd0-a1c1-d770395612a0.d2f24056-fabf-4721-b4ae-199eaac665dd -p 10.127.0.162:3260 --rescan\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Exit code: 255\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Stdout: ''\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp Stderr: 'iscsiadm: No portal found.\\n'\n2012-11-08 22:00:10 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2012-11-08 23:28:04.923030+00:00", 
            "author": "https://api.launchpad.net/1.0/~clay-gerrard"
        }, 
        {
            "content": "", 
            "date_created": "2012-11-08 23:28:04.923030+00:00", 
            "author": "https://api.launchpad.net/1.0/~clay-gerrard"
        }, 
        {
            "content": "Can you please submit this through gerrit?\n\nhttp://wiki.openstack.org/HowToContribute\nhttp://wiki.openstack.org/GerritWorkflow\n", 
            "date_created": "2012-11-09 14:50:42.505481+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/15796", 
            "date_created": "2012-11-09 23:22:27.941461+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "So \"with volumes\" doesn't get hit much in nova.tests.compute.test_compute.ComputeTestCase\n\nI managed to get in test_finish_resize_with_volumes:\n\nhttps://review.openstack.org/#/c/15796/\n\nBut I found that pre_live_migration, and finish_revert_resize do the same thing.", 
            "date_created": "2012-11-09 23:23:28.910057+00:00", 
            "author": "https://api.launchpad.net/1.0/~clay-gerrard"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/21921", 
            "date_created": "2013-02-13 23:13:45.522892+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/21921\nCommitted: http://github.com/openstack/nova/commit/befa4a61b03cd589ab9a616d3b5c265d8b17f524\nSubmitter: Jenkins\nBranch:    master\n\ncommit befa4a61b03cd589ab9a616d3b5c265d8b17f524\nAuthor: Clay Gerrard <email address hidden>\nDate:   Fri Nov 9 17:13:20 2012 -0600\n\n    Use connection_info on resize\n    \n    During finish_migration the manager calls initialize_connection but doesn't\n    update the block_device_mapping with the (potentially new) connection_info\n    returned.\n    \n    This can cause the bdm to get out of sync, the volume to fail to attach, and\n    the resize to fail.\n    \n    Fixes bug #1076801\n    \n    Change-Id: Ie49ccd2138905e178843b375a9b16c3fe572d1db\n", 
            "date_created": "2013-02-16 08:58:55.534283+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-02-21 08:52:12.841625+00:00"
}