{
    "status": "Opinion", 
    "last_updated": "2017-05-07 07:05:18.239767+00:00", 
    "description": "Request to be served by nova fails with operational error:\nFor reference adding floating ip to the server \nInput task :\nRally:\n\"NovaServers.bootvm_userdata_test_snat\": [\n    {\n      \"runner\": {\n        \"type\": \"constant\", \n        \"concurrency\": 7, \n        \"times\": 22\n      }, \n\nBelow traces can be found: req-d5bc233e-d1de-45d8-a353-c17ced17cd63\n\n2017-04-28 11:20:50.598 21334 DEBUG nova.api.openstack.wsgi [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] Action: 'action', calling method: <bound method FloatingIPActionController._add_floating_ip of <nova.api.openstack.compute.floating_ips.FloatingIPActionController object at 0x7f0e421a8750>>, body: {\"addFloatingIp\": {\"fixed_address\": \"1.2.44.3\", \"address\": \"61.26.96.145\"}} _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:623\n2017-04-28 11:20:50.601 21334 DEBUG nova.compute.api [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] [instance: c57cddc2-3aed-4c47-99b0-6f3ac16015b2] Fetching instance by UUID get /opt/stack/nova/nova/compute/api.py:2352\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] Unexpected exception in API method\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/floating_ips.py\", line 223, in _add_floating_ip\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     expected_attrs=['flavor'])\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/common.py\", line 481, in get_instance\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     expected_attrs=expected_attrs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2355, in get\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     expected_attrs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2315, in _get_instance\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     context, instance_uuid, expected_attrs=expected_attrs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 184, in wrapper\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     result = fn(cls, context, *args, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 463, in get_by_uuid\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     use_slave=use_slave)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 235, in wrapper\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     with reader_mode.using(context):\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/contextlib.py\", line 17, in __enter__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self.gen.next()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 944, in _transaction_scope\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     allow_async=self._allow_async) as resource:\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/contextlib.py\", line 17, in __enter__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self.gen.next()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 558, in _session\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     bind=self.connection, mode=self.mode)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 317, in _create_session\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self._start()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 403, in _start\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     engine_args, maker_args)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 427, in _setup_for_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     sql_connection=sql_connection, **engine_kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/engines.py\", line 155, in create_engine\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     test_conn = _test_connection(engine, max_retries, retry_interval)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/engines.py\", line 331, in _test_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return engine.connect()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2018, in connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self._connection_cls(self, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 72, in __init__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     if connection is not None else engine.raw_connection()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2104, in raw_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self.pool.unique_connection, _connection)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2078, in _wrap_pool_connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     e, dialect, self)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1401, in _handle_dbapi_exception_noconnection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     util.raise_from_cause(newraise, exc_info)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/compat.py\", line 203, in raise_from_cause\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     reraise(type(exception), exception, tb=exc_tb, cause=cause)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return fn()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 318, in unique_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return _ConnectionFairy._checkout(self)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     fairy = _ConnectionRecord.checkout(pool)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     rec = pool._do_get()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1060, in _do_get\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self._dec_overflow()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     compat.reraise(exc_type, exc_value, exc_tb)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1057, in _do_get\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self._create_connection()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 323, in _create_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return _ConnectionRecord(self)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 449, in __init__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self.connection = self.__connect()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 607, in __connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     connection = self.__pool._invoke_creator(self)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/strategies.py\", line 97, in connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return dialect.connect(*cargs, **cparams)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 385, in connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self.dbapi.connect(*cargs, **cparams)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/__init__.py\", line 90, in Connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return Connection(*args, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 688, in __init__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self.connect()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 905, in connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self._get_server_information()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1207, in _get_server_information\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     packet = self._read_packet()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 981, in _read_packet\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     packet.check_error()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 393, in check_error\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     err.raise_mysql_exception(self._data)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/err.py\", line 107, in raise_mysql_exception\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     raise errorclass(errno, errval)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions OperationalError: (pymysql.err.OperationalError) (1040, u'Too many connections')\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions\n2017-04-28 11:20:50.613 21334 INFO nova.api.openstack.wsgi [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.OperationalError'>\n2017-04-28 11:20:50.614 21334 DEBUG nova.api.openstack.wsgi [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n\nAt several stages this error is found in the logs.\n\nReuestid : req-25c9aee8-8713-4b6a-8f10-1b79a44c598c\n\nOpenstack branch : stable/ocata\nUbuntu controller version : 16.04.2\nHypervisor : KVM\nstack@ocatacont:~/nsbu_cqe_openstack/devstack$ pip freeze | grep nova\n-e git+https://git.openstack.org//openstack/nova.git@506465a027dd1ba1c90949dc58297edae32da7e4#egg=nova\npython-novaclient==7.1.0", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1688220", 
    "owner": "None", 
    "id": 1688220, 
    "index": 8103, 
    "openned": "2017-05-04 10:07:40.441819+00:00", 
    "created": "2017-05-04 10:07:40.441819+00:00", 
    "title": "Operational error thrown by nova-api while serving the request", 
    "comments": [
        {
            "content": "Request to be served by nova fails with operational error:\nFor reference adding floating ip to the server \nInput task :\nRally:\n\"NovaServers.bootvm_userdata_test_snat\": [\n    {\n      \"runner\": {\n        \"type\": \"constant\", \n        \"concurrency\": 7, \n        \"times\": 22\n      }, \n\nBelow traces can be found: req-d5bc233e-d1de-45d8-a353-c17ced17cd63\n\n2017-04-28 11:20:50.598 21334 DEBUG nova.api.openstack.wsgi [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] Action: 'action', calling method: <bound method FloatingIPActionController._add_floating_ip of <nova.api.openstack.compute.floating_ips.FloatingIPActionController object at 0x7f0e421a8750>>, body: {\"addFloatingIp\": {\"fixed_address\": \"1.2.44.3\", \"address\": \"61.26.96.145\"}} _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:623\n2017-04-28 11:20:50.601 21334 DEBUG nova.compute.api [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] [instance: c57cddc2-3aed-4c47-99b0-6f3ac16015b2] Fetching instance by UUID get /opt/stack/nova/nova/compute/api.py:2352\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] Unexpected exception in API method\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/floating_ips.py\", line 223, in _add_floating_ip\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     expected_attrs=['flavor'])\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/common.py\", line 481, in get_instance\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     expected_attrs=expected_attrs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2355, in get\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     expected_attrs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2315, in _get_instance\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     context, instance_uuid, expected_attrs=expected_attrs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 184, in wrapper\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     result = fn(cls, context, *args, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 463, in get_by_uuid\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     use_slave=use_slave)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 235, in wrapper\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     with reader_mode.using(context):\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/contextlib.py\", line 17, in __enter__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self.gen.next()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 944, in _transaction_scope\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     allow_async=self._allow_async) as resource:\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/contextlib.py\", line 17, in __enter__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self.gen.next()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 558, in _session\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     bind=self.connection, mode=self.mode)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 317, in _create_session\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self._start()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 403, in _start\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     engine_args, maker_args)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 427, in _setup_for_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     sql_connection=sql_connection, **engine_kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/engines.py\", line 155, in create_engine\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     test_conn = _test_connection(engine, max_retries, retry_interval)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/engines.py\", line 331, in _test_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return engine.connect()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2018, in connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self._connection_cls(self, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 72, in __init__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     if connection is not None else engine.raw_connection()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2104, in raw_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self.pool.unique_connection, _connection)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2078, in _wrap_pool_connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     e, dialect, self)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1401, in _handle_dbapi_exception_noconnection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     util.raise_from_cause(newraise, exc_info)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/compat.py\", line 203, in raise_from_cause\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     reraise(type(exception), exception, tb=exc_tb, cause=cause)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2074, in _wrap_pool_connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return fn()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 318, in unique_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return _ConnectionFairy._checkout(self)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 713, in _checkout\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     fairy = _ConnectionRecord.checkout(pool)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 480, in checkout\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     rec = pool._do_get()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1060, in _do_get\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self._dec_overflow()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     compat.reraise(exc_type, exc_value, exc_tb)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 1057, in _do_get\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self._create_connection()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 323, in _create_connection\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return _ConnectionRecord(self)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 449, in __init__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self.connection = self.__connect()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/pool.py\", line 607, in __connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     connection = self.__pool._invoke_creator(self)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/strategies.py\", line 97, in connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return dialect.connect(*cargs, **cparams)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 385, in connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return self.dbapi.connect(*cargs, **cparams)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/__init__.py\", line 90, in Connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     return Connection(*args, **kwargs)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 688, in __init__\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self.connect()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 905, in connect\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     self._get_server_information()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1207, in _get_server_information\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     packet = self._read_packet()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 981, in _read_packet\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     packet.check_error()\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 393, in check_error\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     err.raise_mysql_exception(self._data)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/pymysql/err.py\", line 107, in raise_mysql_exception\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions     raise errorclass(errno, errval)\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions OperationalError: (pymysql.err.OperationalError) (1040, u'Too many connections')\n2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions\n2017-04-28 11:20:50.613 21334 INFO nova.api.openstack.wsgi [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.OperationalError'>\n2017-04-28 11:20:50.614 21334 DEBUG nova.api.openstack.wsgi [req-d5bc233e-d1de-45d8-a353-c17ced17cd63 c_rally_46c61b3d_hnwpef3T c_rally_46c61b3d_aYPvYjVl] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n\nAt several stages this error is found in the logs.\n\nReuestid : req-25c9aee8-8713-4b6a-8f10-1b79a44c598c\n\nOpenstack branch : stable/ocata\nUbuntu controller version : 16.04.2\nHypervisor : KVM\nstack@ocatacont:~/nsbu_cqe_openstack/devstack$ pip freeze | grep nova\n-e git+https://git.openstack.org//openstack/nova.git@506465a027dd1ba1c90949dc58297edae32da7e4#egg=nova\npython-novaclient==7.1.0", 
            "date_created": "2017-05-04 10:07:40.441819+00:00", 
            "author": "https://api.launchpad.net/1.0/~ashish-kumar-gupta"
        }, 
        {
            "content": "", 
            "date_created": "2017-05-04 10:07:40.441819+00:00", 
            "author": "https://api.launchpad.net/1.0/~ashish-kumar-gupta"
        }, 
        {
            "content": "2017-04-28 11:20:50.609 21334 ERROR nova.api.openstack.extensions OperationalError: (pymysql.err.OperationalError) (1040, u'Too many connections')\n\nthis looks like a mysql settings issue? I can't remember clearly but seems some bugs used to report similar issue and it turn out that this need some update on the conf of db?", 
            "date_created": "2017-05-05 02:16:52.814121+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "@jichenjc .\nCan you please tell me what configuration in mysql needed to solve this issue.", 
            "date_created": "2017-05-05 06:46:23.389247+00:00", 
            "author": "https://api.launchpad.net/1.0/~ashish-kumar-gupta"
        }, 
        {
            "content": "Configuration file for mysql :\n/etc/mysql/mysql.conf.d/mysqld.cnf\n\nuser            = mysql\npid-file        = /var/run/mysqld/mysqld.pid\nsocket          = /var/run/mysqld/mysqld.sock\nport            = 3306\nbasedir         = /usr\ndatadir         = /var/lib/mysql\ntmpdir          = /tmp\nlc-messages-dir = /usr/share/mysql\nskip-external-locking\n\nkey_buffer_size         = 16M\nmax_allowed_packet      = 16M\nthread_stack            = 192K\nthread_cache_size       = 8\n\nquery_cache_limit       = 1M\nquery_cache_size        = 16M\n", 
            "date_created": "2017-05-05 07:55:00.786803+00:00", 
            "author": "https://api.launchpad.net/1.0/~ashish-kumar-gupta"
        }, 
        {
            "content": "Error in the mysql logs cane be seen:\n2017-05-05T05:35:06.324752Z 0 [Note] InnoDB: Buffer pool(s) load completed at 170505  5:35:06\n\n2017-05-05T05:56:34.990804Z 792 [Note] Aborted connection 792 to db: 'nova' user: 'root' host: 'localhost' (Got an error reading communication packets)\n2017-05-05T06:00:14.329171Z 701 [Note] Aborted connection 701 to db: 'nova' user: 'root' host: 'localhost' (Got an error reading communication packets)\n2017-05-05T06:09:15.583067Z 773 [Note] Aborted connection 773 to db: 'nova' user: 'root' host: 'localhost' (Got an error reading communication packets)\n", 
            "date_created": "2017-05-07 06:45:36.268648+00:00", 
            "author": "https://api.launchpad.net/1.0/~ashish-kumar-gupta"
        }, 
        {
            "content": "Issue is reproducible :\nstack@controller:/opt/stack/logs$ nova list --all-tenants\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'sqlalchemy.exc.OperationalError'> (HTTP 500) (Request-ID: req-7e8cc6d4-f023-418c-bd8e-90e7570b4cf5)\nstack@controller:/opt/stack/logs$ sudo lsof -i :8774 | wc -l\n34\n\nstack@controller:/opt/stack/logs$ pip freeze | grep nova\n-e git+https://git.openstack.org//openstack/nova.git@506465a027dd1ba1c90949dc58297edae32da7e4#egg=nova\npython-novaclient==7.1.0\n", 
            "date_created": "2017-05-07 07:05:17.867539+00:00", 
            "author": "https://api.launchpad.net/1.0/~ashish-kumar-gupta"
        }
    ], 
    "closed": "2017-05-05 06:46:36.891246+00:00"
}