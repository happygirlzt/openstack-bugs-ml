{
    "status": "Confirmed", 
    "last_updated": "2017-08-01 09:16:22.347610+00:00", 
    "description": "Description\n===========\nwhen instance in block_device_mapping task state, can't force-delete it by nova force-delete command.\n\nSteps to reproduce\n==================\n* Boot an instance, as soon as instance task state changed to block_device_mapping, run nova force-delete INSTANCE_UUID command, get some error:\n\n# nova force-delete 08ed7e71-4470-4746-ae65-d17c659f29c9\n/usr/lib/python2.7/site-packages/novaclient/client.py:278: UserWarning: The 'tenant_id' argument is deprecated in Ocata and its use may result in errors in future releases. As 'project_id' is provided, the 'tenant_id' argument will be ignored.\n  warnings.warn(msg)\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InstanceInvalidState'> (HTTP 500) (Request-ID: req-b185ecd7-5f0d-441e-8263-59af8b66aae7)\n\n\nExpected result\n===============\nforce delete instance sucessfully\n\nActual result\n=============\nget some error and force delete instance failed\n\nEnvironment\n===========\n# rpm -qa | grep nova\nopenstack-nova-api-15.0.0-1.el7.noarch\nopenstack-nova-console-15.0.0-1.el7.noarch\nopenstack-nova-common-15.0.0-1.el7.noarch\nopenstack-nova-conductor-15.0.0-1.el7.noarch\nopenstack-nova-novncproxy-15.0.0-1.el7.noarch\npuppet-nova-10.3.0-1.el7.noarch\npython-nova-15.0.0-1.el7.noarch\nopenstack-nova-cert-15.0.0-1.el7.noarch\nopenstack-nova-placement-api-15.0.0-1.el7.noarch\nopenstack-nova-compute-15.0.0-1.el7.noarch\nopenstack-nova-scheduler-15.0.0-1.el7.noarch\npython2-novaclient-7.1.0-1.el7.noarch\n\nLogs & Configs\n==============\n2017-07-18 15:47:22.159 36543 DEBUG nova.api.openstack.wsgi [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] Action: 'action', calling method: <bound method DeferredDeleteController._force_delete of <nova.api.openstack.compute.deferred_delete.DeferredDeleteController object at 0x83f4c10>>, body: {\"forceDelete\": null} _process_stack /usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py:623\n2017-07-18 15:47:22.159 36543 DEBUG nova.compute.api [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] [instance: 08ed7e71-4470-4746-ae65-d17c659f29c9] Fetching instance by UUID get /usr/lib/python2.7/site-packages/nova/compute/api.py:2313\n2017-07-18 15:47:22.172 36543 DEBUG oslo_db.sqlalchemy.engines [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] MySQL server mode set to STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION _check_effective_sql_mode /usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/engines.py:261\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] Unexpected exception in API method\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/deferred_delete.py\", line 64, in _force_delete\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions     self.compute_api.force_delete(context, instance)\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 170, in inner\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions     return function(self, context, instance, *args, **kwargs)\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 143, in inner\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions     method=f.__name__)\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions InstanceInvalidState: Instance 08ed7e71-4470-4746-ae65-d17c659f29c9 in task_state block_device_mapping. Cannot force_delete while the instance is in this state.\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions\n2017-07-18 15:47:22.219 36543 INFO nova.api.openstack.wsgi [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InstanceInvalidState'>\n2017-07-18 15:47:22.220 36543 DEBUG nova.api.openstack.wsgi [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InstanceInvalidState'> __call__ /usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py:1039\n2017-07-18 15:47:22.221 36543 INFO nova.osapi_compute.wsgi.server [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] 192.168.2.145 \"POST /v2.1/227c2369e7e9475f93c3ec7f07082937/servers/08ed7e71-4470-4746-ae65-d17c659f29c9/action HTTP/1.1\" status: 500 len: 578 time: 0.0697980", 
    "tags": [
        "api", 
        "cinder", 
        "low-hanging-fruit"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1704945", 
    "owner": "https://api.launchpad.net/1.0/~blkart", 
    "id": 1704945, 
    "index": 4870, 
    "openned": "2017-07-18 08:06:05.802286+00:00", 
    "created": "2017-07-18 08:06:05.802286+00:00", 
    "title": "nova force-delete can't delete instance in vm_state block_device_mapping", 
    "comments": [
        {
            "content": "Description\n===========\nwhen instance in block_device_mapping task state, can't force-delete it by nova force-delete command.\n\nSteps to reproduce\n==================\n* Boot an instance, as soon as instance task state changed to block_device_mapping, run nova force-delete INSTANCE_UUID command, get some error:\n\n# nova force-delete 08ed7e71-4470-4746-ae65-d17c659f29c9\n/usr/lib/python2.7/site-packages/novaclient/client.py:278: UserWarning: The 'tenant_id' argument is deprecated in Ocata and its use may result in errors in future releases. As 'project_id' is provided, the 'tenant_id' argument will be ignored.\n  warnings.warn(msg)\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InstanceInvalidState'> (HTTP 500) (Request-ID: req-b185ecd7-5f0d-441e-8263-59af8b66aae7)\n\n\nExpected result\n===============\nforce delete instance sucessfully\n\nActual result\n=============\nget some error and force delete instance failed\n\nEnvironment\n===========\n# rpm -qa | grep nova\nopenstack-nova-api-15.0.0-1.el7.noarch\nopenstack-nova-console-15.0.0-1.el7.noarch\nopenstack-nova-common-15.0.0-1.el7.noarch\nopenstack-nova-conductor-15.0.0-1.el7.noarch\nopenstack-nova-novncproxy-15.0.0-1.el7.noarch\npuppet-nova-10.3.0-1.el7.noarch\npython-nova-15.0.0-1.el7.noarch\nopenstack-nova-cert-15.0.0-1.el7.noarch\nopenstack-nova-placement-api-15.0.0-1.el7.noarch\nopenstack-nova-compute-15.0.0-1.el7.noarch\nopenstack-nova-scheduler-15.0.0-1.el7.noarch\npython2-novaclient-7.1.0-1.el7.noarch\n\nLogs & Configs\n==============\n2017-07-18 15:47:22.159 36543 DEBUG nova.api.openstack.wsgi [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] Action: 'action', calling method: <bound method DeferredDeleteController._force_delete of <nova.api.openstack.compute.deferred_delete.DeferredDeleteController object at 0x83f4c10>>, body: {\"forceDelete\": null} _process_stack /usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py:623\n2017-07-18 15:47:22.159 36543 DEBUG nova.compute.api [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] [instance: 08ed7e71-4470-4746-ae65-d17c659f29c9] Fetching instance by UUID get /usr/lib/python2.7/site-packages/nova/compute/api.py:2313\n2017-07-18 15:47:22.172 36543 DEBUG oslo_db.sqlalchemy.engines [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] MySQL server mode set to STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION _check_effective_sql_mode /usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/engines.py:261\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] Unexpected exception in API method\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/deferred_delete.py\", line 64, in _force_delete\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions     self.compute_api.force_delete(context, instance)\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 170, in inner\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions     return function(self, context, instance, *args, **kwargs)\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 143, in inner\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions     method=f.__name__)\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions InstanceInvalidState: Instance 08ed7e71-4470-4746-ae65-d17c659f29c9 in task_state block_device_mapping. Cannot force_delete while the instance is in this state.\n2017-07-18 15:47:22.212 36543 ERROR nova.api.openstack.extensions\n2017-07-18 15:47:22.219 36543 INFO nova.api.openstack.wsgi [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InstanceInvalidState'>\n2017-07-18 15:47:22.220 36543 DEBUG nova.api.openstack.wsgi [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'nova.exception.InstanceInvalidState'> __call__ /usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py:1039\n2017-07-18 15:47:22.221 36543 INFO nova.osapi_compute.wsgi.server [req-b185ecd7-5f0d-441e-8263-59af8b66aae7 - - - - -] 192.168.2.145 \"POST /v2.1/227c2369e7e9475f93c3ec7f07082937/servers/08ed7e71-4470-4746-ae65-d17c659f29c9/action HTTP/1.1\" status: 500 len: 578 time: 0.0697980", 
            "date_created": "2017-07-18 08:06:05.802286+00:00", 
            "author": "https://api.launchpad.net/1.0/~blkart"
        }, 
        {
            "content": "This bug report has an assignee. So set its status to 'In Progress.'.", 
            "date_created": "2017-07-27 13:45:53.868991+00:00", 
            "author": "https://api.launchpad.net/1.0/~natsume-takashi"
        }, 
        {
            "content": "We only assign bugs to \"In progress\" if there is an uploaded change for reviewing.\n\nUnless there is a Gerrit change, putting it back to Confirmed.", 
            "date_created": "2017-08-01 09:14:58.050741+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }
    ]
}