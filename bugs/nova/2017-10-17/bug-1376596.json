{
    "status": "Won't Fix", 
    "last_updated": "2015-08-07 20:57:12.996044+00:00", 
    "description": "Hi!\n\nI was testing packstack --allinone on \"RDO test day Juno milestone 3\" and i cannot start nova-network.\n\nOS: CentOS7\nOpenstack version: juno-1\nPackstack cmd: packstack --allinone --os-neutron-install=n --os-heat-cfn-install=y --os-heat-install=y --use-epel=y\n\nError:\n\n2014-10-01 18:17:53.853 6108 AUDIT nova.service [-] Starting network node (version 2014.2-0.4.b3.el7.centos)\n2014-10-01 18:17:54.055 6108 ERROR nova.openstack.common.threadgroup [-] Failed to add interface: can't add lo to bridge br100: Invalid argument\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/threadgroup.py\", line 125, in wait\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 173, in wait\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 121, in wait\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 293, in switch\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 212, in main\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/service.py\", line 492, in run_service\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     service.start()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 164, in start\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1776, in init_host\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     super(FlatDHCPManager, self).init_host()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 334, in init_host\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     self._setup_network_on_host(ctxt, network)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1785, in _setup_network_on_host\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     self._initialize_network(network)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1451, in _initialize_network\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     self.l3driver.initialize_gateway(network)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/l3.py\", line 105, in initialize_gateway\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     gateway=(network_ref['gateway'] is not None))\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 1411, in plug\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return _get_interface_driver().plug(network, mac_address, gateway)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 1460, in plug\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     network, gateway)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 325, in inner\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 1575, in ensure_bridge\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     raise exception.NovaException(msg)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup NovaException: Failed to add interface: can't add lo to bridge br100: Invalid argument", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1376596", 
    "owner": "https://api.launchpad.net/1.0/~beagles", 
    "id": 1376596, 
    "index": 6459, 
    "openned": "2014-10-02 08:08:19.850161+00:00", 
    "created": "2014-10-02 08:08:19.850161+00:00", 
    "title": "Cannot start nova-network on juno and kilo", 
    "comments": [
        {
            "content": "Hi!\n\nI was testing packstack --allinone on \"RDO test day Juno milestone 3\" and i cannot start nova-network.\n\nOS: CentOS7\nOpenstack version: juno-1\nPackstack cmd: packstack --allinone --os-neutron-install=n --os-heat-cfn-install=y --os-heat-install=y --use-epel=y\n\nError:\n\n2014-10-01 18:17:53.853 6108 AUDIT nova.service [-] Starting network node (version 2014.2-0.4.b3.el7.centos)\n2014-10-01 18:17:54.055 6108 ERROR nova.openstack.common.threadgroup [-] Failed to add interface: can't add lo to bridge br100: Invalid argument\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/threadgroup.py\", line 125, in wait\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/threadgroup.py\", line 47, in wait\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 173, in wait\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 121, in wait\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 293, in switch\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 212, in main\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/service.py\", line 492, in run_service\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     service.start()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 164, in start\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1776, in init_host\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     super(FlatDHCPManager, self).init_host()\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 334, in init_host\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     self._setup_network_on_host(ctxt, network)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1785, in _setup_network_on_host\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     self._initialize_network(network)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/manager.py\", line 1451, in _initialize_network\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     self.l3driver.initialize_gateway(network)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/l3.py\", line 105, in initialize_gateway\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     gateway=(network_ref['gateway'] is not None))\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 1411, in plug\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return _get_interface_driver().plug(network, mac_address, gateway)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 1460, in plug\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     network, gateway)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\", line 325, in inner\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/site-packages/nova/network/linux_net.py\", line 1575, in ensure_bridge\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup     raise exception.NovaException(msg)\n2014-10-01 18:17:54.055 6108 TRACE nova.openstack.common.threadgroup NovaException: Failed to add interface: can't add lo to bridge br100: Invalid argument", 
            "date_created": "2014-10-02 08:08:19.850161+00:00", 
            "author": "https://api.launchpad.net/1.0/~bruno-bompastor"
        }, 
        {
            "content": "Hi again!\n\nSo I found the problem.\n\nSo on juno you changed the logic on this file /usr/lib/python2.7/site-packages/nova/network/linux_net.py\n\nRDO packages:\nicehouse: python-nova.noarch                     2014.1.2-1.el6            @openstack-icehouse\njuno: python-nova.noarch                          2014.2-0.4.b3.el7.centos   @openstack-juno\n\nicehouse ensure_bridge function:\n\n        if interface:\n            msg = _('Adding interface %(interface)s to bridge %(bridge)s')\n            LOG.debug(msg, {'interface': interface, 'bridge': bridge})\n            out, err = _execute('brctl', 'addif', bridge, interface,\n                                check_exit_code=False, run_as_root=True)\n            out, err = _execute('ip', 'link', 'set', interface, 'up',\n                                check_exit_code=False, run_as_root=True)\n\nmaster/juno ensure_bridge function:\n\n        if interface:\n            msg = _('Adding interface %(interface)s to bridge %(bridge)s')\n            LOG.debug(msg, {'interface': interface, 'bridge': bridge})\n            out, err = _execute('brctl', 'addif', bridge, interface,\n                                check_exit_code=False, run_as_root=True)\n            if (err and err != \"device %s is already a member of a bridge; \"\n                     \"can't enslave it to bridge %s.\\n\" % (interface, bridge)):\n                msg = _('Failed to add interface: %s') % err\n                raise exception.NovaException(msg)\n\n            out, err = _execute('ip', 'link', 'set', interface, 'up',\n                                check_exit_code=False, run_as_root=True)\n\nI understand that the developer was trying not to lose the error message here but it didnt catch it properly.\n\nI hope that helps!", 
            "date_created": "2014-10-02 13:07:47.962977+00:00", 
            "author": "https://api.launchpad.net/1.0/~bruno-bompastor"
        }, 
        {
            "content": "This seems right, interface shouldn't have been 'lo' I don't think.", 
            "date_created": "2014-10-03 14:37:42.901094+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Yeah you are probably right. But if i comment flat_interface on nova.conf, it will put 'lo' by default. It's weird.", 
            "date_created": "2014-10-03 15:04:53.041815+00:00", 
            "author": "https://api.launchpad.net/1.0/~bruno-bompastor"
        }, 
        {
            "content": "Can you figure this out?\n\nPeople are implementing workarounds (http://sethanil.blogspot.ch/2014/11/openstack-nova-compute-fails-to-start.html) because this is not fixed.\n\nSetting flat_interface on nova.conf to None should work, so i think is a bug.", 
            "date_created": "2015-07-08 09:35:46.330862+00:00", 
            "author": "https://api.launchpad.net/1.0/~bruno-bompastor"
        }, 
        {
            "content": "I believe Nova-network was deprecated in RDO Havana . So,  RDO IceHouse,Juno,Kilo don't support nova-network as well.", 
            "date_created": "2015-07-21 10:23:00.531637+00:00", 
            "author": "https://api.launchpad.net/1.0/~bderzhavets"
        }, 
        {
            "content": "From an OpenStack perspective, Nova network has not been deprecated. See http://docs.openstack.org/openstack-ops/content/nova-network-deprecation.html. It is still used by over 30% of the current deployments.\n\nCan you point me to where this was announced for RDO ?\n\n\n", 
            "date_created": "2015-07-21 10:57:25.120659+00:00", 
            "author": "https://api.launchpad.net/1.0/~tim-bell"
        }, 
        {
            "content": "nova-network was not announced for RDO because RDO is vanilla upstream packaging and as long as upstream has it, RDO will include.\nBut RDO CI jobs only cover neutron networking[1] and what's not tested is broken by definition.\n\n[1] https://prod-rdojenkins.rhcloud.com/search/?q=khaleesi-rdo-kilo-production", 
            "date_created": "2015-07-21 11:08:37.484704+00:00", 
            "author": "https://api.launchpad.net/1.0/~apevec"
        }, 
        {
            "content": "Correction: nova-network _deprecation_ was not announced...", 
            "date_created": "2015-07-21 11:52:24.422510+00:00", 
            "author": "https://api.launchpad.net/1.0/~apevec"
        }, 
        {
            "content": "Clearly was not deprecated since neutron does not provide the same functionality (FlatDHCP for example) and there is not a migration path yet...\n\nConcerning the bug, I think we could improve the situation in two ways:\n\n1) Not setting the flat_interface on nova.conf should not bridge the interfaces (right now forces 'lo');\n2) if NOT, check if the interface is 'lo' like here http://sethanil.blogspot.ch/2014/11/openstack-nova-compute-fails-to-start.html and not bridge the interfaces.\n\nThe origin of this bug is due to the impossibility to add loopback to the bridge on rhel 7 (reference: https://bugzilla.redhat.com/show_bug.cgi?format=multiple&id=1153079)", 
            "date_created": "2015-07-21 13:00:12.664370+00:00", 
            "author": "https://api.launchpad.net/1.0/~bruno-bompastor"
        }, 
        {
            "content": "It seems packstack that is setting the flat_interface configuration to 'lo' - which is invalid. However, when I take an answerfile approach and unset the *PRIVIF  configuration variable (which you can -probably SHOULD- do for an allinone setup since there is no external connectivity required for the tenant network bridge), it balks at the empty value. In any case, this is more of a packstack issue - not a nova one.", 
            "date_created": "2015-07-21 17:23:34.473480+00:00", 
            "author": "https://api.launchpad.net/1.0/~beagles"
        }
    ], 
    "closed": "2015-08-07 20:57:10.641249+00:00"
}