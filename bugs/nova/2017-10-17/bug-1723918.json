{
    "status": "New", 
    "last_updated": "2017-10-16 10:25:29.502334+00:00", 
    "description": "Description:\nUpgraded first from Mitaka to Newton, then to Ocata, and also upgraded openSUSE Leap 42.1 to Leap 42.3, so it's not a fresh installation, but since I couldn't find any hint to check the /etc/apache2/vhosts.d/nova-placement-api.conf.sample I assume this will also be a problem in a fresh installation.\n\nI followed OBS install guide [1] to configure nova-placement-api:\n\n1. Created the Placement API entry in the service catalog successfully...\n2. Created the Placement API service endpoints successfully:\n  openstack endpoint create --region RegionOne placement public http://controller:8778\n  openstack endpoint create --region RegionOne placement internal http://controller:8778\n  openstack endpoint create --region RegionOne placement admin http://controller:8778\n3. Synced databases and registered cell0 database successfully...\n4. Enabled the placement API Apache vhost:\n  mv /etc/apache2/vhosts.d/nova-placement-api.conf.sample /etc/apache2/vhosts.d/nova-placement-api.conf\n  systemctl reload apache2.service\n\nExpected results:\n\n- nova-compute reports success (\"Created resource provider record via placement API for resource provider...\")\n- \"nova-status upgrade check\" shows upgrade status\n\nActual results:\n\n- nova-compute reports:\n2017-10-16 10:53:31.247 8400 WARNING nova.scheduler.client.report [req-20cf1da3-86c4-4b03-bb13-84a54fd38425 - - - - -] Placement API service is not responding.\n2017-10-16 10:53:31.249 8400 WARNING nova.scheduler.client.report [req-20cf1da3-86c4-4b03-bb13-84a54fd38425 - - - - -] Placement API service is not responding.\n2017-10-16 10:53:31.249 8400 WARNING nova.scheduler.client.report [req-20cf1da3-86c4-4b03-bb13-84a54fd38425 - - - - -] Unable to refresh my resource provider record\n\n- \"nova-status upgrade check\" shows connection error:\n\n---cut here---\ncontrol1:/var/log/cinder #  nova-status upgrade check\nError:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/nova/cmd/status.py\", line 456, in main\n    ret = fn(*fn_args, **fn_kwargs)\n  File \"/usr/lib/python2.7/site-packages/nova/cmd/status.py\", line 386, in check\n    result = func(self)\n  File \"/usr/lib/python2.7/site-packages/nova/cmd/status.py\", line 201, in _check_placement\n    versions = self._placement_get(\"/\")\n  File \"/usr/lib/python2.7/site-packages/nova/cmd/status.py\", line 189, in _placement_get\n    return client.get(path, endpoint_filter=ks_filter).json()\n  File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 758, in get\n    return self.request(url, 'GET', **kwargs)\n  File \"/usr/lib/python2.7/site-packages/positional/__init__.py\", line 101, in inner\n    return wrapped(*args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 616, in request\n    resp = send(**kwargs)\n  File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 690, in _send_request\n    raise exceptions.ConnectFailure(msg)\nConnectFailure: Unable to establish connection to http://controller:8778/: HTTPConnectionPool(host='controller', port=8778): Max retries exceeded with url: / (Caused by NewConnectionError('<requests.packages.urllib3.connection.HTTPConnection object at 0x7fd616954950>: Failed to establish a new connection: [Errno 111] ECONNREFUSED',))\n---cut-here---\n\nThe problem is a port misconfiguration in the nova-placement-api vhost, it doesn't match the endpoint configuration:\n \n---cut-here---\ncontrol1:/var/log/cinder # diff -u /etc/apache2/vhosts.d/nova-placement-api.conf.dist /etc/apache2/vhosts.d/nova-placement-api.conf\n--- /etc/apache2/vhosts.d/nova-placement-api.conf.dist  2017-10-16 12:19:28.503899981 +0200\n+++ /etc/apache2/vhosts.d/nova-placement-api.conf       2017-10-16 12:19:41.363642540 +0200\n@@ -1,8 +1,8 @@\n # OpenStack nova-placement-api Apache2 example configuration\n\n-Listen 8780\n+Listen 8778\n\n-<VirtualHost *:8780>\n+<VirtualHost *:8778>\n     WSGIScriptAlias / /srv/www/nova-placement-api/app.wsgi\n     WSGIDaemonProcess nova-placement-api processes=2 threads=1 user=nova group=nova\n     WSGIProcessGroup nova-placement-api\n---cut-here---\n\nChanging the port to match the port configured in the endpoints solves the problem.\n\n[1] https://docs.openstack.org/ocata/install-guide-obs/nova-controller-install.html#install-and-configure-components", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1723918", 
    "owner": "None", 
    "id": 1723918, 
    "index": 8344, 
    "openned": "2017-10-16 10:25:29.502334+00:00", 
    "created": "2017-10-16 10:25:29.502334+00:00", 
    "title": "nova-placement-api port mismatch", 
    "comments": [
        {
            "content": "Description:\nUpgraded first from Mitaka to Newton, then to Ocata, and also upgraded openSUSE Leap 42.1 to Leap 42.3, so it's not a fresh installation, but since I couldn't find any hint to check the /etc/apache2/vhosts.d/nova-placement-api.conf.sample I assume this will also be a problem in a fresh installation.\n\nI followed OBS install guide [1] to configure nova-placement-api:\n\n1. Created the Placement API entry in the service catalog successfully...\n2. Created the Placement API service endpoints successfully:\n  openstack endpoint create --region RegionOne placement public http://controller:8778\n  openstack endpoint create --region RegionOne placement internal http://controller:8778\n  openstack endpoint create --region RegionOne placement admin http://controller:8778\n3. Synced databases and registered cell0 database successfully...\n4. Enabled the placement API Apache vhost:\n  mv /etc/apache2/vhosts.d/nova-placement-api.conf.sample /etc/apache2/vhosts.d/nova-placement-api.conf\n  systemctl reload apache2.service\n\nExpected results:\n\n- nova-compute reports success (\"Created resource provider record via placement API for resource provider...\")\n- \"nova-status upgrade check\" shows upgrade status\n\nActual results:\n\n- nova-compute reports:\n2017-10-16 10:53:31.247 8400 WARNING nova.scheduler.client.report [req-20cf1da3-86c4-4b03-bb13-84a54fd38425 - - - - -] Placement API service is not responding.\n2017-10-16 10:53:31.249 8400 WARNING nova.scheduler.client.report [req-20cf1da3-86c4-4b03-bb13-84a54fd38425 - - - - -] Placement API service is not responding.\n2017-10-16 10:53:31.249 8400 WARNING nova.scheduler.client.report [req-20cf1da3-86c4-4b03-bb13-84a54fd38425 - - - - -] Unable to refresh my resource provider record\n\n- \"nova-status upgrade check\" shows connection error:\n\n---cut here---\ncontrol1:/var/log/cinder #  nova-status upgrade check\nError:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/nova/cmd/status.py\", line 456, in main\n    ret = fn(*fn_args, **fn_kwargs)\n  File \"/usr/lib/python2.7/site-packages/nova/cmd/status.py\", line 386, in check\n    result = func(self)\n  File \"/usr/lib/python2.7/site-packages/nova/cmd/status.py\", line 201, in _check_placement\n    versions = self._placement_get(\"/\")\n  File \"/usr/lib/python2.7/site-packages/nova/cmd/status.py\", line 189, in _placement_get\n    return client.get(path, endpoint_filter=ks_filter).json()\n  File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 758, in get\n    return self.request(url, 'GET', **kwargs)\n  File \"/usr/lib/python2.7/site-packages/positional/__init__.py\", line 101, in inner\n    return wrapped(*args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 616, in request\n    resp = send(**kwargs)\n  File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 690, in _send_request\n    raise exceptions.ConnectFailure(msg)\nConnectFailure: Unable to establish connection to http://controller:8778/: HTTPConnectionPool(host='controller', port=8778): Max retries exceeded with url: / (Caused by NewConnectionError('<requests.packages.urllib3.connection.HTTPConnection object at 0x7fd616954950>: Failed to establish a new connection: [Errno 111] ECONNREFUSED',))\n---cut-here---\n\nThe problem is a port misconfiguration in the nova-placement-api vhost, it doesn't match the endpoint configuration:\n \n---cut-here---\ncontrol1:/var/log/cinder # diff -u /etc/apache2/vhosts.d/nova-placement-api.conf.dist /etc/apache2/vhosts.d/nova-placement-api.conf\n--- /etc/apache2/vhosts.d/nova-placement-api.conf.dist  2017-10-16 12:19:28.503899981 +0200\n+++ /etc/apache2/vhosts.d/nova-placement-api.conf       2017-10-16 12:19:41.363642540 +0200\n@@ -1,8 +1,8 @@\n # OpenStack nova-placement-api Apache2 example configuration\n\n-Listen 8780\n+Listen 8778\n\n-<VirtualHost *:8780>\n+<VirtualHost *:8778>\n     WSGIScriptAlias / /srv/www/nova-placement-api/app.wsgi\n     WSGIDaemonProcess nova-placement-api processes=2 threads=1 user=nova group=nova\n     WSGIProcessGroup nova-placement-api\n---cut-here---\n\nChanging the port to match the port configured in the endpoints solves the problem.\n\n[1] https://docs.openstack.org/ocata/install-guide-obs/nova-controller-install.html#install-and-configure-components", 
            "date_created": "2017-10-16 10:25:29.502334+00:00", 
            "author": "https://api.launchpad.net/1.0/~eblock"
        }
    ]
}