{
    "status": "Fix Released", 
    "last_updated": "2017-04-11 08:45:15.464574+00:00", 
    "description": "Description\n===========\nUsing NFS Shared storage, when I try to boot a VM out of a smaller snapshot (1GB) it works fine.\nAlthough, when i try to do the same out of a larger snapshot (30GB+) it fails regardless of the OpenStack Release Newton or Mitaka.\n\nSteps to reproduce\n==================\nA chronological list of steps which will bring off the\nissue you noticed:\n* I have OpenStack RDO MNewton (or Mitaka) installed and functional\n* I boot a VM out of a QCOW2 image of about 1GB\n* Then I loginto that VM and create a large file (33GB) to inflat the VM image\n* then I shutoff the VM and take a snapshot of it that i call \"largeVMsnapshotImage\"\n\nAlternatively to the steps above,\n* I have a snapshot from a large VM (30GB+) that I upload in glance and call \"largeVMsnapshotImage\"\n\nThen I do:\n* then I try to boot a new VM out of that snapshot using the same network\n* Although the image seems to be copied to the compute node, the VM Creation fails on \"qemu-img info\" command\n\nIf I run the same command manually, it works:\n/usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/2b54e1ca13134ceb7fc489d58d7aa6fd321b1885\nimage: /var/lib/nova/instances/_base/2b54e1ca13134ceb7fc489d58d7aa6fd321b1885\nfile format: raw\nvirtual size: 80G (85899345920 bytes)\ndisk size: 37G\n\nAlthough, in the logs it fails and the VM Creation is interrupted, see log from nova-compute.log on the compute node:\n...\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] BuildAbortException: Build of instance d6889ea2-f277-40e5-afdc-b3b0698537ed aborted: Disk info file is invalid: qemu-img failed to execute on /var/lib/nova/instances/_base/2b54e1ca13134ceb7fc489d58d7aa6fd321b1885 : Unexpected error while running command.\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] Command: /usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/2b54e1ca13134ceb7fc489d58d7aa6fd321b1885\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] Exit code: -9\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] Stdout: u''\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] Stderr: u''\n...\n\n\nExpected result\n===============\nThe VM should have been created/booted out of the larg snapshot image.\n\nActual result\n=============\nThe command fails with exit code -9 when Noiva\n\nEnvironment\n===========\n1. Running RDO Newton on Centos 7.2 (or Oracle Linux 7.2) and reproduced on RDO Mitaka as well\n\n   If this is from a distro please provide\n       $ [root@controller ~]# rpm -qa|grep nova\nopenstack-nova-console-14.0.0-1.el7.noarch\npuppet-nova-9.4.0-1.el7.noarch\npython-nova-14.0.0-1.el7.noarch\nopenstack-nova-novncproxy-14.0.0-1.el7.noarch\nopenstack-nova-conductor-14.0.0-1.el7.noarch\nopenstack-nova-api-14.0.0-1.el7.noarch\nopenstack-nova-common-14.0.0-1.el7.noarch\nopenstack-nova-scheduler-14.0.0-1.el7.noarch\nopenstack-nova-serialproxy-14.0.0-1.el7.noarch\npython2-novaclient-6.0.0-1.el7.noarch\nopenstack-nova-cert-14.0.0-1.el7.noarch\n\n\n2. Which hypervisor did you use?\n   KVM\n   \n   details:\n   [root@compute4 nova]# rpm -qa|grep -Ei \"kvm|qemu|libvirt\"\nlibvirt-gobject-0.1.9-1.el7.x86_64\nlibvirt-gconfig-0.1.9-1.el7.x86_64\nlibvirt-daemon-1.2.17-13.0.1.el7.x86_64\nqemu-kvm-common-1.5.3-105.el7.x86_64\nqemu-img-1.5.3-105.el7.x86_64\nipxe-roms-qemu-20130517-7.gitc4bce43.el7.noarch\nlibvirt-client-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-nodedev-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-lxc-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-kvm-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-secret-1.2.17-13.0.1.el7.x86_64\nlibvirt-python-1.2.17-2.el7.x86_64\nlibvirt-daemon-config-network-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-config-nwfilter-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-storage-1.2.17-13.0.1.el7.x86_64\nqemu-kvm-1.5.3-105.el7.x86_64\nlibvirt-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-interface-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-network-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-nwfilter-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-qemu-1.2.17-13.0.1.el7.x86_64\nlibvirt-glib-0.1.9-1.el7.x86_64\n\n\n2. Which storage type did you use?\n   NFS\n   From a Sun ZFS or just from a server (both environment would have the same issue)\n   [root@compute4 nova]# mount | grep -i instance\n172.31.254.254:/nova on /var/lib/nova/instances type nfs4 (rw,relatime,vers=4.0,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=172.31.0.114,local_lock=none,addr=172.31.254.254)\n\n   \n\n3. Which networking type did you use?\n   Neutron with OpenVSwitch\n\nLogs & Configs\n==============\n\nFrom nova-compute.log:\n\n2016-11-30 11:34:50.855 29776 INFO nova.compute.resource_tracker [req-dc5e7f75-5ae5-4929-a7b5-f4fdb95c171e - - - - -] Compute_service record updated for c00b05:c00b05\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Instance failed to spawn\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Traceback (most recent call last):\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2078, in _build_resources\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     yield resources\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1920, in _build_and_run_instance\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     block_device_info=block_device_info)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2571, in spawn\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     admin_pass=admin_password)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2975, in _create_image\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     fallback_from_host)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 3075, in _create_and_inject_local_root\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     instance, size, fallback_from_host)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 6537, in _try_fetch_image_cache\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     size=size)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 218, in cache\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     *args, **kwargs)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 565, in create_image\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     self.verify_base_size(base, size)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 265, in verify_base_size\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     base_size = self.get_disk_size(base)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 277, in get_disk_size\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     return disk.get_disk_size(name)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/disk/api.py\", line 148, in get_disk_size\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     return images.qemu_img_info(path).virtual_size\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/images.py\", line 67, in qemu_img_info\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     raise exception.InvalidDiskInfo(reason=msg)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] InvalidDiskInfo: Disk info file is invalid: qemu-img failed to execute on /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52 : Unexpected error while running command.\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Command: /usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Exit code: -9\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Stdout: u''\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Stderr: u''\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]\n2016-11-30 11:35:11.005 29776 WARNING nova.image.glance [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] No protocol specified in for api_server 'http://10.240.121.13:9292', please update [glance] api_servers with fully qualified url including scheme (http / https)\n2016-11-30 11:35:11.016 29776 INFO nova.virt.libvirt.driver [-] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] During wait destroy, instance disappeared.\n2016-11-30 11:35:11.045 29776 INFO nova.virt.libvirt.driver [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Deleting instance files /var/lib/nova/instances/1e1c2b5a-803a-4701-bc71-254699243f7d_del\n2016-11-30 11:35:11.056 29776 INFO nova.virt.libvirt.driver [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Deletion of /var/lib/nova/instances/1e1c2b5a-803a-4701-bc71-254699243f7d_del complete\n2016-11-30 11:35:11.194 29776 INFO nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Took 0.18 seconds to destroy the instance on the hypervisor.\n2016-11-30 11:35:11.610 29776 INFO nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Took 0.42 seconds to deallocate network for instance.\n2016-11-30 11:35:11.610 29776 WARNING nova.image.glance [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] No protocol specified in for api_server 'http://10.240.121.13:9292', please update [glance] api_servers with fully qualified url including scheme (http / https)\n2016-11-30 11:35:11.789 29776 WARNING nova.image.glance [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] No protocol specified in for api_server 'http://10.240.121.13:9292', please update [glance] api_servers with fully qualified url including scheme (http / https)\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Build of instance 1e1c2b5a-803a-4701-bc71-254699243f7d aborted: Disk info file is invalid: qemu-img failed to execute on /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52 : Unexpected error while running command.\nCommand: /usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52\nExit code: -9\nStdout: u''\nStderr: u''\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Traceback (most recent call last):\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1779, in _do_build_and_run_instance\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     filter_properties)\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1971, in _build_and_run_instance\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     reason=e.format_message())\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] BuildAbortException: Build of instance 1e1c2b5a-803a-4701-bc71-254699243f7d aborted: Disk info file is invalid: qemu-img failed to execute on /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52 : Unexpected error while running command.\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Command: /usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Exit code: -9\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Stdout: u''\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Stderr: u''\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]\n2016-11-30 11:35:11.881 29776 INFO nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Took 0.09 seconds to deallocate network for instance.\n2016-11-30 11:35:12.177 29776 INFO nova.compute.manager [-] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] During sync_power_state the instance has a pending task (spawning). Skip.", 
    "tags": [
        "in-stable-ocata", 
        "nfs"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1646181", 
    "owner": "https://api.launchpad.net/1.0/~sdague", 
    "id": 1646181, 
    "index": 4695, 
    "openned": "2016-11-30 16:38:53.977854+00:00", 
    "created": "2016-11-30 16:38:53.977854+00:00", 
    "title": "NFS: Fail to boot VM out of large snapshots (30GB+)", 
    "comments": [
        {
            "content": "Description\n===========\nUsing NFS Shared storage, when I try to boot a VM out of a smaller snapshot (1GB) it works fine.\nAlthough, when i try to do the same out of a larger snapshot (30GB+) it fails regardless of the OpenStack Release Newton or Mitaka.\n\nSteps to reproduce\n==================\nA chronological list of steps which will bring off the\nissue you noticed:\n* I have OpenStack RDO MNewton (or Mitaka) installed and functional\n* I boot a VM out of a QCOW2 image of about 1GB\n* Then I loginto that VM and create a large file (33GB) to inflat the VM image\n* then I shutoff the VM and take a snapshot of it that i call \"largeVMsnapshotImage\"\n\nAlternatively to the steps above,\n* I have a snapshot from a large VM (30GB+) that I upload in glance and call \"largeVMsnapshotImage\"\n\nThen I do:\n* then I try to boot a new VM out of that snapshot using the same network\n* Although the image seems to be copied to the compute node, the VM Creation fails on \"qemu-img info\" command\n\nIf I run the same command manually, it works:\n/usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/2b54e1ca13134ceb7fc489d58d7aa6fd321b1885\nimage: /var/lib/nova/instances/_base/2b54e1ca13134ceb7fc489d58d7aa6fd321b1885\nfile format: raw\nvirtual size: 80G (85899345920 bytes)\ndisk size: 37G\n\nAlthough, in the logs it fails and the VM Creation is interrupted, see log from nova-compute.log on the compute node:\n...\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] BuildAbortException: Build of instance d6889ea2-f277-40e5-afdc-b3b0698537ed aborted: Disk info file is invalid: qemu-img failed to execute on /var/lib/nova/instances/_base/2b54e1ca13134ceb7fc489d58d7aa6fd321b1885 : Unexpected error while running command.\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] Command: /usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/2b54e1ca13134ceb7fc489d58d7aa6fd321b1885\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] Exit code: -9\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] Stdout: u''\n2016-11-29 17:52:23.581 10284 ERROR nova.compute.manager [instance: d6889ea2-f277-40e5-afdc-b3b0698537ed] Stderr: u''\n...\n\n\nExpected result\n===============\nThe VM should have been created/booted out of the larg snapshot image.\n\nActual result\n=============\nThe command fails with exit code -9 when Noiva\n\nEnvironment\n===========\n1. Running RDO Newton on Centos 7.2 (or Oracle Linux 7.2) and reproduced on RDO Mitaka as well\n\n   If this is from a distro please provide\n       $ [root@controller ~]# rpm -qa|grep nova\nopenstack-nova-console-14.0.0-1.el7.noarch\npuppet-nova-9.4.0-1.el7.noarch\npython-nova-14.0.0-1.el7.noarch\nopenstack-nova-novncproxy-14.0.0-1.el7.noarch\nopenstack-nova-conductor-14.0.0-1.el7.noarch\nopenstack-nova-api-14.0.0-1.el7.noarch\nopenstack-nova-common-14.0.0-1.el7.noarch\nopenstack-nova-scheduler-14.0.0-1.el7.noarch\nopenstack-nova-serialproxy-14.0.0-1.el7.noarch\npython2-novaclient-6.0.0-1.el7.noarch\nopenstack-nova-cert-14.0.0-1.el7.noarch\n\n\n2. Which hypervisor did you use?\n   KVM\n   \n   details:\n   [root@compute4 nova]# rpm -qa|grep -Ei \"kvm|qemu|libvirt\"\nlibvirt-gobject-0.1.9-1.el7.x86_64\nlibvirt-gconfig-0.1.9-1.el7.x86_64\nlibvirt-daemon-1.2.17-13.0.1.el7.x86_64\nqemu-kvm-common-1.5.3-105.el7.x86_64\nqemu-img-1.5.3-105.el7.x86_64\nipxe-roms-qemu-20130517-7.gitc4bce43.el7.noarch\nlibvirt-client-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-nodedev-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-lxc-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-kvm-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-secret-1.2.17-13.0.1.el7.x86_64\nlibvirt-python-1.2.17-2.el7.x86_64\nlibvirt-daemon-config-network-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-config-nwfilter-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-storage-1.2.17-13.0.1.el7.x86_64\nqemu-kvm-1.5.3-105.el7.x86_64\nlibvirt-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-interface-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-network-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-nwfilter-1.2.17-13.0.1.el7.x86_64\nlibvirt-daemon-driver-qemu-1.2.17-13.0.1.el7.x86_64\nlibvirt-glib-0.1.9-1.el7.x86_64\n\n\n2. Which storage type did you use?\n   NFS\n   From a Sun ZFS or just from a server (both environment would have the same issue)\n   [root@compute4 nova]# mount | grep -i instance\n172.31.254.254:/nova on /var/lib/nova/instances type nfs4 (rw,relatime,vers=4.0,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=172.31.0.114,local_lock=none,addr=172.31.254.254)\n\n   \n\n3. Which networking type did you use?\n   Neutron with OpenVSwitch\n\nLogs & Configs\n==============\n\nFrom nova-compute.log:\n\n2016-11-30 11:34:50.855 29776 INFO nova.compute.resource_tracker [req-dc5e7f75-5ae5-4929-a7b5-f4fdb95c171e - - - - -] Compute_service record updated for c00b05:c00b05\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Instance failed to spawn\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Traceback (most recent call last):\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2078, in _build_resources\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     yield resources\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1920, in _build_and_run_instance\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     block_device_info=block_device_info)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2571, in spawn\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     admin_pass=admin_password)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2975, in _create_image\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     fallback_from_host)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 3075, in _create_and_inject_local_root\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     instance, size, fallback_from_host)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 6537, in _try_fetch_image_cache\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     size=size)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 218, in cache\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     *args, **kwargs)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 565, in create_image\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     self.verify_base_size(base, size)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 265, in verify_base_size\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     base_size = self.get_disk_size(base)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 277, in get_disk_size\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     return disk.get_disk_size(name)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/disk/api.py\", line 148, in get_disk_size\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     return images.qemu_img_info(path).virtual_size\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/virt/images.py\", line 67, in qemu_img_info\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     raise exception.InvalidDiskInfo(reason=msg)\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] InvalidDiskInfo: Disk info file is invalid: qemu-img failed to execute on /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52 : Unexpected error while running command.\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Command: /usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Exit code: -9\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Stdout: u''\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Stderr: u''\n2016-11-30 11:35:10.983 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]\n2016-11-30 11:35:11.005 29776 WARNING nova.image.glance [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] No protocol specified in for api_server 'http://10.240.121.13:9292', please update [glance] api_servers with fully qualified url including scheme (http / https)\n2016-11-30 11:35:11.016 29776 INFO nova.virt.libvirt.driver [-] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] During wait destroy, instance disappeared.\n2016-11-30 11:35:11.045 29776 INFO nova.virt.libvirt.driver [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Deleting instance files /var/lib/nova/instances/1e1c2b5a-803a-4701-bc71-254699243f7d_del\n2016-11-30 11:35:11.056 29776 INFO nova.virt.libvirt.driver [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Deletion of /var/lib/nova/instances/1e1c2b5a-803a-4701-bc71-254699243f7d_del complete\n2016-11-30 11:35:11.194 29776 INFO nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Took 0.18 seconds to destroy the instance on the hypervisor.\n2016-11-30 11:35:11.610 29776 INFO nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Took 0.42 seconds to deallocate network for instance.\n2016-11-30 11:35:11.610 29776 WARNING nova.image.glance [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] No protocol specified in for api_server 'http://10.240.121.13:9292', please update [glance] api_servers with fully qualified url including scheme (http / https)\n2016-11-30 11:35:11.789 29776 WARNING nova.image.glance [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] No protocol specified in for api_server 'http://10.240.121.13:9292', please update [glance] api_servers with fully qualified url including scheme (http / https)\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Build of instance 1e1c2b5a-803a-4701-bc71-254699243f7d aborted: Disk info file is invalid: qemu-img failed to execute on /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52 : Unexpected error while running command.\nCommand: /usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52\nExit code: -9\nStdout: u''\nStderr: u''\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Traceback (most recent call last):\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1779, in _do_build_and_run_instance\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     filter_properties)\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1971, in _build_and_run_instance\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]     reason=e.format_message())\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] BuildAbortException: Build of instance 1e1c2b5a-803a-4701-bc71-254699243f7d aborted: Disk info file is invalid: qemu-img failed to execute on /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52 : Unexpected error while running command.\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Command: /usr/bin/python2 -m oslo_concurrency.prlimit --as=1073741824 --cpu=2 -- env LC_ALL=C LANG=C qemu-img info /var/lib/nova/instances/_base/4cfca5366c949a8588736b75803acd375751ca52\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Exit code: -9\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Stdout: u''\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Stderr: u''\n2016-11-30 11:35:11.793 29776 ERROR nova.compute.manager [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d]\n2016-11-30 11:35:11.881 29776 INFO nova.compute.manager [req-ee0aafda-9ab6-4e8a-b7ad-669f84a5eaf8 7004c133bffa42858f0438c3866c5224 67d87660f58d4cc08c05227b7b668b2d - - -] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] Took 0.09 seconds to deallocate network for instance.\n2016-11-30 11:35:12.177 29776 INFO nova.compute.manager [-] [instance: 1e1c2b5a-803a-4701-bc71-254699243f7d] During sync_power_state the instance has a pending task (spawning). Skip.", 
            "date_created": "2016-11-30 16:38:53.977854+00:00", 
            "author": "https://api.launchpad.net/1.0/~jbbroccard"
        }, 
        {
            "content": "Anyone?\nI'm still investigating the issue and trying to debug images.py and the execute wrapper to see what's causing the issue.\n", 
            "date_created": "2016-12-05 18:22:53.180718+00:00", 
            "author": "https://api.launchpad.net/1.0/~jbbroccard"
        }, 
        {
            "content": "All,\nI was able to get around the issue by triggering the \"qemu-img info\" command right before the python code executes it. See my change in /usr/lib/python2.7/site-packages/nova/virt/images.py :\n\ndef qemu_img_info(path, format=None):\n    \"\"\"Return an object containing the parsed output from qemu-img info.\"\"\"\n    # TODO(mikal): this code should not be referring to a libvirt specific\n    # flag.\n    # NOTE(sirp): The config option import must go here to avoid an import\n    # cycle\n    CONF.import_opt('images_type', 'nova.virt.libvirt.imagebackend',\n                    group='libvirt')\n    if not os.path.exists(path) and CONF.libvirt.images_type != 'rbd':\n        raise exception.DiskNotFound(location=path)\n\n    try:\n        cmd = ('env', 'LC_ALL=C', 'LANG=C', 'qemu-img', 'info', path)\n        if format is not None:\n            cmd = cmd + ('-f', format)\n        os.system('(time /usr/bin/qemu-img info ' + str(path) + ') >> /tmp/testfile 2>&1') # <- my change\n        out, err = utils.execute(*cmd, prlimit=QEMU_IMG_LIMITS)\n\nWith this the issue does not occur anymore.\nWhat I noticed is that through NFS accessing files on the NFS mounted FS can be very slow right after the copy/convert, running the same command right before the ones that trigger the exception made it.\n\nI tried to track down where the Exit code: -9  came from but it seems to be coming from qemu-img program itself and oslo_concurrency libraries does not interpret this \"-9\".\n\nCould anyone give an opinion on this workaround?\n\n", 
            "date_created": "2016-12-06 14:56:27.727230+00:00", 
            "author": "https://api.launchpad.net/1.0/~jbbroccard"
        }, 
        {
            "content": "So is the issue the prlimit command is getting in the way? What if you remove the prlimit?", 
            "date_created": "2016-12-07 20:43:38.741581+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Or increase the QEMU_IMG_LIMITS to a larger value for cpu, my guess is the limits are getting hit because the NFS server is so slow, the command is bailing on that.", 
            "date_created": "2016-12-07 20:46:17.604566+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Sean, how can i increase that value?", 
            "date_created": "2016-12-07 22:21:01.071599+00:00", 
            "author": "https://api.launchpad.net/1.0/~jbbroccard"
        }, 
        {
            "content": "I found this in the images.py code. But if that works with ... say multiply by 10:\n\n...\nQEMU_IMG_LIMITS = processutils.ProcessLimits(\n    cpu_time=2,\n    address_space=1 * units.Gi * 10)\n...\n\nThis still requires to modify thenova code. Is there a way to change it from the outside, like from a parameter in nova.conf?", 
            "date_created": "2016-12-07 22:24:01.031559+00:00", 
            "author": "https://api.launchpad.net/1.0/~jbbroccard"
        }, 
        {
            "content": "Was discussing this issue with QEMU upstream this morning. (Thanks to \nStefan Hajnoczi & Dan Berrange for the chat on IRC).\n\nThe \"-9\" is actually SIGKILL signal, which is expected when the CPU / \nmemory limits are hit.\n\nAlso:\n\n    'Exit status' comes from an exception which is in turn populated \n    from python subprocess \"returncode\" attribute, whichis just\n    documented as \"Exit status of the child process\"\n\n---\n\nI was also incidentally triaging a downstream bug report that has \nsimilar error:  they seem to notice the said error if they upload images\nto Glance that are > ~20GB in size and then booting an instance out of\nit.\n\nAnd, it seems like the reporter downstream has confirmed by increasing \nthe CPU limit from 2 to 8, they're able to successfully boot instances.\n\n\nSo, can you also try by increasing the CPU limit from 2 -> 8 (or \nsimilar, based on your machine's specifications)?", 
            "date_created": "2016-12-08 13:08:12.567702+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/408668", 
            "date_created": "2016-12-08 15:12:19.669867+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Please see if the attached patch works for you and makes the issue go away.", 
            "date_created": "2016-12-08 15:31:43.853282+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Sean,\nI did not that patch but rather just changed cpu_time from 2 to 8 and it worked.\nThanks for the help - hopefully this patch will be rolled in the master branch for future releases.", 
            "date_created": "2016-12-08 16:31:10.221852+00:00", 
            "author": "https://api.launchpad.net/1.0/~jbbroccard"
        }, 
        {
            "content": "Sean, the cpu_time seems to be a variable to me, shouldn't it be changeable from the outside (like in nova.conf) instead of having to tune inside the nova code?", 
            "date_created": "2016-12-08 16:48:12.154459+00:00", 
            "author": "https://api.launchpad.net/1.0/~jbbroccard"
        }, 
        {
            "content": "JB it's really a backstop for \"stuff went horribly wrong and we're trying to protect you\". I don't think we want to make this configurable. ", 
            "date_created": "2016-12-08 17:13:30.236743+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/408668\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=b78b1f8ce3aa407307a6adc5c60de1e960547897\nSubmitter: Jenkins\nBranch:    master\n\ncommit b78b1f8ce3aa407307a6adc5c60de1e960547897\nAuthor: Sean Dague <email address hidden>\nDate:   Thu Dec 8 10:09:06 2016 -0500\n\n    Bump prlimit cpu time for qemu from 2 to 8\n    \n    We've got user reported bugs that when opperating with slow NFS\n    backends with large (30+ GB) disk files, the prlimit of cpu_time 2 is\n    guessed to be the issue at hand because if folks hot patch a qemu-img\n    that runs before the prlimitted one, the prlimitted one succeeds.\n    \n    This increases the allowed cpu timeout, as well as tweaking the error\n    message so that we return something more prescriptive when the\n    qemu-img command fails with prlimit abort.\n    \n    The original bug (#1449062) the main mitigation concern here was a\n    carefully crafted image that gets qemu-img to generate > 1G of json,\n    and hence could be a node attack vector. cpu_time was never mentioned,\n    and I think was added originally as a belt and suspenders addition. As\n    such, bumping it to 8 seconds shouldn't impact our protection in any\n    real way.\n    \n    Change-Id: I1f4549b787fd3b458e2c48a90bf80025987f08c4\n    Closes-Bug: #1646181\n", 
            "date_created": "2016-12-09 16:14:29.479833+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/409774", 
            "date_created": "2016-12-12 12:48:16.749433+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/mitaka\nReview: https://review.openstack.org/409775", 
            "date_created": "2016-12-12 12:48:32.692221+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Kashyap Chamarthy (<email address hidden>) on branch: stable/mitaka\nReview: https://review.openstack.org/409775\nReason: Alright, it skipped me that Mitaka is now Security-supported only, so obviously this doesn't fit into that criteria. Therefore, abandoning.", 
            "date_created": "2016-12-12 16:34:07.242859+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/409774\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a859481b797048579f69e8c07b09a4628776fb1f\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit a859481b797048579f69e8c07b09a4628776fb1f\nAuthor: Sean Dague <email address hidden>\nDate:   Thu Dec 8 10:09:06 2016 -0500\n\n    Bump prlimit cpu time for qemu from 2 to 8\n    \n    We've got user reported bugs that when opperating with slow NFS\n    backends with large (30+ GB) disk files, the prlimit of cpu_time 2 is\n    guessed to be the issue at hand because if folks hot patch a qemu-img\n    that runs before the prlimitted one, the prlimitted one succeeds.\n    \n    This increases the allowed cpu timeout, as well as tweaking the error\n    message so that we return something more prescriptive when the\n    qemu-img command fails with prlimit abort.\n    \n    The original bug (#1449062) the main mitigation concern here was a\n    carefully crafted image that gets qemu-img to generate > 1G of json,\n    and hence could be a node attack vector. cpu_time was never mentioned,\n    and I think was added originally as a belt and suspenders addition. As\n    such, bumping it to 8 seconds shouldn't impact our protection in any\n    real way.\n    \n    Change-Id: I1f4549b787fd3b458e2c48a90bf80025987f08c4\n    Closes-Bug: #1646181\n    (cherry picked from commit b78b1f8ce3aa407307a6adc5c60de1e960547897)\n", 
            "date_created": "2016-12-14 11:08:16.323748+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b2 development milestone.", 
            "date_created": "2016-12-15 17:34:17.994045+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.3 release.", 
            "date_created": "2016-12-19 12:01:52.974744+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Is possible to fix it also in Mitaka?", 
            "date_created": "2017-02-21 16:22:48.146094+00:00", 
            "author": "https://api.launchpad.net/1.0/~jacolex"
        }, 
        {
            "content": "For Cinder, this same issue affects image->volume and needs the same fix.", 
            "date_created": "2017-03-09 16:50:27.717508+00:00", 
            "author": "https://api.launchpad.net/1.0/~eharney"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/443752", 
            "date_created": "2017-03-09 16:52:09.788177+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/443752\nCommitted: https://git.openstack.org/cgit/openstack/cinder/commit/?id=52310fa8645cc10b91de7d2b4e10a3b42d4ef073\nSubmitter: Jenkins\nBranch:    master\n\ncommit 52310fa8645cc10b91de7d2b4e10a3b42d4ef073\nAuthor: Eric Harney <email address hidden>\nDate:   Thu Mar 9 11:25:53 2017 -0500\n\n    Bump prlimit cpu time for qemu-img from 2 to 8\n    \n    Users have reported that the current CPU limit is not\n    sufficient for processing large enough images when\n    downloading images to volumes.\n    \n    This mirrors a similar increase made in Nova (b78b1f8ce).\n    \n    Closes-Bug: #1646181\n    \n    Change-Id: I5edea7d1d19fd991e51dca963d2beb7004177498\n", 
            "date_created": "2017-03-13 11:45:00.312057+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/444913", 
            "date_created": "2017-03-13 13:53:14.081310+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/444996", 
            "date_created": "2017-03-13 16:44:25.204339+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/444913\nCommitted: https://git.openstack.org/cgit/openstack/cinder/commit/?id=2a5e0086e130e5e7960f743b6db8344caf65b9e5\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit 2a5e0086e130e5e7960f743b6db8344caf65b9e5\nAuthor: Eric Harney <email address hidden>\nDate:   Thu Mar 9 11:25:53 2017 -0500\n\n    Bump prlimit cpu time for qemu-img from 2 to 8\n    \n    Users have reported that the current CPU limit is not\n    sufficient for processing large enough images when\n    downloading images to volumes.\n    \n    This mirrors a similar increase made in Nova (b78b1f8ce).\n    \n    Closes-Bug: #1646181\n    \n    Change-Id: I5edea7d1d19fd991e51dca963d2beb7004177498\n    (cherry picked from commit 52310fa8645cc10b91de7d2b4e10a3b42d4ef073)\n", 
            "date_created": "2017-03-13 17:31:09.837072+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/444996\nCommitted: https://git.openstack.org/cgit/openstack/cinder/commit/?id=46799c4ff57e818fad770c5266f553a30fab6de2\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit 46799c4ff57e818fad770c5266f553a30fab6de2\nAuthor: Eric Harney <email address hidden>\nDate:   Thu Mar 9 11:25:53 2017 -0500\n\n    Bump prlimit cpu time for qemu-img from 2 to 8\n    \n    Users have reported that the current CPU limit is not\n    sufficient for processing large enough images when\n    downloading images to volumes.\n    \n    This mirrors a similar increase made in Nova (b78b1f8ce).\n    \n    Closes-Bug: #1646181\n    \n    Change-Id: I5edea7d1d19fd991e51dca963d2beb7004177498\n    (cherry picked from commit 52310fa8645cc10b91de7d2b4e10a3b42d4ef073)\n    (cherry picked from commit 2a5e0086e130e5e7960f743b6db8344caf65b9e5)\n", 
            "date_created": "2017-03-24 18:47:41.848331+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/cinder 9.1.3 release.", 
            "date_created": "2017-03-29 13:30:48.380997+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/cinder 10.0.1 release.", 
            "date_created": "2017-04-10 18:04:48.155479+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/cinder 11.0.0.0b1 development milestone.", 
            "date_created": "2017-04-11 08:45:14.489896+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-12-09 16:14:26.344485+00:00"
}