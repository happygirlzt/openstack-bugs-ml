{
    "status": "Fix Released", 
    "last_updated": "2017-02-27 20:29:39.117040+00:00", 
    "description": "The multi-queue feature was added:\nhttps://blueprints.launchpad.net/nova/+spec/libvirt-virtio-net-multiqueue\nand it is controlled using image metadata: hw_vif_mutliqueue_enabled=true|false\nwhen it is set to be true, the related xml config will be handled:\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/virt/libvirt/vif.py#n130\n\nwhen users want to launch an instance with a SRIOV port and several normal ports\nwith multi-queue feature, ERROR can take place due to wrong driver name for SRIOV\ninterface:\n\n2016-11-15T06:15:41.621+08:00 localhost nova-compute DEBUG [pid:17224] [MainThread] [tid:115210352] [vif.py:745 plug] [req-52fba1f0-008e-43dc-bc02-16ea378a41bd] vif_type=hw_veb instance=Instance(access_ip_v4=None,access_ip_v6=None,architecture=None,auto_disk_config=False,availability_zone='az1.dc1',cell_name=None,cleaned=False,config_drive='',created_at=2016-11-14T22:15:35Z,default_ephemeral_device=None,default_swap_device=None,deleted=False,deleted_at=None,disable_terminate=False,display_description='fzx_sriov',display_name='fzx_sriov',ec2_ids=EC2Ids,ephemeral_gb=0,ephemeral_key_uuid=None,fault=<?>,flavor=Flavor(11),host='68D366CE-0AF4-8E11-8567-000000821800',hostname='fzx-sriov',id=137,image_ref='5d4b082a-3b47-4505-93b7-f242ca59e940',info_cache=InstanceInfoCache,instance_type_id=11,kernel_id='',key_data=None,key_name=None,launch_index=0,launched_at=None,launched_on='68D366CE-0AF4-8E11-8567-000000821800',locked=False,locked_by=None,memory_mb=1024,metadata={},migration_context=<?>,new_flavor=None,node='68D366CE-0AF4-8E11-8567-000000821800',numa_topology=None,old_flavor=None,os_type=None,pci_devices=PciDeviceList,pci_requests=InstancePCIRequests,power_state=0,progress=0,project_id='0a00fefb88cd407a9b768678fad26f5c',ramdisk_id='',reservation_id='r-0050r6iu',root_device_name='/dev/vda',root_gb=1,security_groups=SecurityGroupList,services=<?>,shutdown_terminate=False,system_metadata={booted_volume='False',image_base_image_ref='5d4b082a-3b47-4505-93b7-f242ca59e940',image_container_format='bare',image_disk_format='qcow2',image_hw_vif_multiqueue_enabled='true',image_min_disk='1',image_min_ram='0',network_allocated='True'},tags=<?>,task_state='spawning',terminated_at=None,updated_at=2016-11-14T22:15:40Z,user_data=None,user_id='20ad13b54d7a4950a30ccb3697eea438',uuid=d8a1c18a-6e20-41da-9115-c3f3e6c6b836,vcpu_model=VirtCPUModel,vcpus=4,vm_mode=None,vm_state='building') vif=VIF({'profile': {u'pci_slot': u'0000:02:10.6', u'physical_network': u'sriov_phynet', u'pci_vendor_info': u'8086:10ed'}, 'ovs_interfaceid': None, 'preserve_on_delete': True, 'network': Network({'bridge': None, 'subnets': [Subnet({'ips': [FixedIP({'meta': {}, 'version': 4, 'type': 'fixed', 'floating_ips': [], 'address': u'10.38.0.3'})], 'version': 4, 'meta': {'dhcp_server': u'10.38.0.2'}, 'dns': [], 'routes': [], 'cidr': u'10.38.0.0/16', 'gateway': IP({'meta': {}, 'version': 4, 'type': 'gateway', 'address': u'10.38.0.1'})})], 'meta': {'injected': False, 'tenant_id': u'0a00fefb88cd407a9b768678fad26f5c', 'physical_network': u'sriov_phynet', 'mtu': 1500}, 'id': u'28c3c2a5-12b5-45ae-910e-64426f6228a1', 'label': u'sriov-net'}), 'devname': u'tap63a1f051-00', 'vnic_type': u'direct', 'qbh_params': None, 'meta': {'pci_slotnum': 3}, 'details': {u'port_filter': False, u'vlan': u'63'}, 'address': u'fa:16:3e:91:f3:4f', 'active': False, 'type': u'hw_veb', 'id': u'63a1f051-0025-4ff4-a050-eef37a67f245', 'qbg_params': None}) plug /usr/lib/python2.7/site-packages/nova/virt/libvirt/vif.py:745\n2016-11-15T06:15:41.721+08:00 localhost nova-compute ERROR [pid:17224] [MainThread] [tid:115210352] [guest.py:127 create] [req-52fba1f0-008e-43dc-bc02-16ea378a41bd] Error defining a domain with XML: <domain type=\"kvm\">\n  <uuid>d8a1c18a-6e20-41da-9115-c3f3e6c6b836</uuid>\n  <name>instance-00000089</name>\n  <memory>1048576</memory>\n  <maxMemory slots=\"64\" unit=\"KiB\">4398046511104</maxMemory>\n  <vcpu current=\"4\" cpuset=\"0-3,6-11,14-15\">255</vcpu>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"13.0.1-0.20161112210228.6f14d8b\"/>\n      <nova:name>fzx_sriov</nova:name>\n      <nova:creationTime>2016-11-14 22:15:41</nova:creationTime>\n      <nova:flavor name=\"fzx.1024.1.4\">\n        <nova:memory>1024</nova:memory>\n        <nova:disk>1</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>4</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"20ad13b54d7a4950a30ccb3697eea438\">nova</nova:user>\n        <nova:project uuid=\"0a00fefb88cd407a9b768678fad26f5c\">service</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"5d4b082a-3b47-4505-93b7-f242ca59e940\"/>\n      <nova:extend_properties>\n        <nova:realtime>False</nova:realtime>\n      </nova:extend_properties>\n    </nova:instance>\n  </metadata>\n  <sysinfo type=\"smbios\">\n    <system>\n      <entry name=\"manufacturer\">OpenStack Foundation</entry>\n      <entry name=\"product\">OpenStack Nova</entry>\n      <entry name=\"version\">13.0.1-0.20161112210228.6f14d8b</entry>\n      <entry name=\"serial\">02b471f9-21bb-4e31-a835-72846f082ac0</entry>\n      <entry name=\"uuid\">d8a1c18a-6e20-41da-9115-c3f3e6c6b836</entry>\n      <entry name=\"family\">Virtual Machine</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type>hvm</type>\n    <smbios mode=\"sysinfo\"/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cputune>\n    <shares>4096</shares>\n  </cputune>\n  <clock offset=\"variable\" basis=\"utc\"/>\n  <cpu mode=\"host-passthrough\" match=\"exact\">\n    <topology sockets=\"255\" cores=\"1\" threads=\"1\"/>\n    <numa>\n      <cell id=\"0\" cpus=\"0-254\" memory=\"1048576\"/>\n    </numa>\n  </cpu>\n  <devices>\n    <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\" io=\"threads\"/>\n      <source file=\"/opt/HUAWEI/image/instances/d8a1c18a-6e20-41da-9115-c3f3e6c6b836/disk\"/>\n      <target bus=\"virtio\" dev=\"vda\"/>\n      <boot order=\"1\"/>\n    </disk>\n    <interface type=\"hostdev\" managed=\"yes\">\n      <mac address=\"fa:16:3e:91:f3:4f\"/>\n      <driver name=\"vhost\" queues=\"4\"/>\n      <source>\n        <address type=\"pci\" domain=\"0x0000\" bus=\"0x02\" slot=\"0x10\" function=\"0x6\"/>\n      </source>\n      <vlan>\n        <tag id=\"63\"/>\n      </vlan>\n      <address bus=\"0x00\" domain=\"0x0000\" function=\"0x0\" slot=\"0x3\" type=\"pci\"/>\n    </interface>\n    <serial type=\"file\">\n      <source path=\"/var/log/libvirt/qemu/instance-00000089.seriallog\"/>\n    </serial>\n    <input type=\"tablet\" bus=\"usb\"/>\n    <video>\n      <model type=\"cirrus\"/>\n    </video>\n    <memballoon model=\"virtio\">\n      <stats period=\"10\"/>\n    </memballoon>\n    <graphics type=\"vnc\" autoport=\"yes\" keymap=\"en-us\" listen=\"172.28.0.3\" passwd=\"t2I870T4\"/>\n    <channel type=\"unix\">\n      <source mode=\"bind\" path=\"/var/run/libvirt/qemu/instance-00000089.extend\"/>\n      <target name=\"org.qemu.guest_agent.1\" type=\"virtio\"/>\n      <address bus=\"0\" controller=\"0\" port=\"1\" type=\"virtio-serial\"/>\n    </channel>\n    <channel type=\"unix\">\n      <source mode=\"bind\" path=\"/var/run/libvirt/qemu/instance-00000089.agent\"/>\n      <target name=\"org.qemu.guest_agent.0\" type=\"virtio\"/>\n      <address bus=\"0\" controller=\"0\" port=\"2\" type=\"virtio-serial\"/>\n    </channel>\n    <channel type=\"unix\">\n      <source mode=\"bind\" path=\"/var/run/libvirt/qemu/instance-00000089.hostd\"/>\n      <target name=\"org.qemu.guest_agent.2\" type=\"virtio\"/>\n      <address bus=\"0\" controller=\"0\" port=\"3\" type=\"virtio-serial\"/>\n    </channel>\n    <channel type=\"unix\">\n      <source mode=\"bind\" path=\"/var/run/libvirt/qemu/instance-00000089.upgraded\"/>\n      <target name=\"org.qemu.guest_agent.3\" type=\"virtio\"/>\n      <address bus=\"0\" controller=\"0\" port=\"4\" type=\"virtio-serial\"/>\n    </channel>\n  </devices>\n  <qemu:commandline xmlns:qemu=\"http://libvirt.org/schemas/domain/qemu/1.0\">\n    <qemu:arg value=\"-device\"/>\n    <qemu:arg value=\"pv_channel,bus=pci.0,addr=0x1f\"/>\n    <qemu:arg value=\"-chardev\"/>\n    <qemu:arg value=\"file,id=seabios,path=/var/log/libvirt/qemu/instance-00000089.seabios,mux=off\"/>\n    <qemu:arg value=\"-device\"/>\n    <qemu:arg value=\"isa-debugcon,iobase=0x402,chardev=seabios\"/>\n    <qemu:arg value=\"-consolelog\"/>\n    <qemu:arg value=\"path=/var/log/libvirt/qemu/instance-00000089.consolelog\"/>\n  </qemu:commandline>\n</domain>\n2016-11-15T06:15:41.721+08:00 localhost nova-compute ERROR [pid:17224] [MainThread] [tid:115210352] [manager.py:542 _build_resources] [req-52fba1f0-008e-43dc-bc02-16ea378a41bd] [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836] Instance failed to spawn\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836] Traceback (most recent call last):\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/huawei/compute/manager.py\", line 536, in _build_resources\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     yield resources\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2065, in _build_and_run_instance\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     block_device_info=block_device_info)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/huawei/virt/libvirt/driver.py\", line 2416, in spawn\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     block_device_info)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2770, in spawn\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     block_device_info=block_device_info)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4910, in _create_domain_and_network\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     xml, pause=pause, power_on=power_on)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4836, in _create_domain\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     guest = libvirt_guest.Guest.create(xml, self._host)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 127, in create\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     encodeutils.safe_decode(xml))\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     self.force_reraise()\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     six.reraise(self.type_, self.value, self.tb)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 123, in create\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     domain = host.write_instance_config(xml)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/host.py\", line 981, in write_instance_config\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     return self.get_connection().defineXML(xml)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 186, in doit\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 144, in proxy_call\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     rv = execute(f, *args, **kwargs)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 125, in execute\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     six.reraise(c, e, tb)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 83, in tworker\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     rv = meth(*args, **kwargs)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 3751, in defineXML\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836] libvirtError: unsupported configuration: Unknown PCI device <driver name='vhost'/> has been specified\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1641814", 
    "owner": "https://api.launchpad.net/1.0/~zhengzhenyu", 
    "id": 1641814, 
    "index": 4679, 
    "openned": "2016-11-15 03:59:41.439605+00:00", 
    "created": "2016-11-15 03:59:41.439605+00:00", 
    "title": "Don't apply multi-queue to SRIOV ports", 
    "comments": [
        {
            "content": "The multi-queue feature was added:\nhttps://blueprints.launchpad.net/nova/+spec/libvirt-virtio-net-multiqueue\nand it is controlled using image metadata: hw_vif_mutliqueue_enabled=true|false\nwhen it is set to be true, the related xml config will be handled:\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/virt/libvirt/vif.py#n130\n\nwhen users want to launch an instance with a SRIOV port and several normal ports\nwith multi-queue feature, ERROR can take place due to wrong driver name for SRIOV\ninterface:\n\n2016-11-15T06:15:41.621+08:00 localhost nova-compute DEBUG [pid:17224] [MainThread] [tid:115210352] [vif.py:745 plug] [req-52fba1f0-008e-43dc-bc02-16ea378a41bd] vif_type=hw_veb instance=Instance(access_ip_v4=None,access_ip_v6=None,architecture=None,auto_disk_config=False,availability_zone='az1.dc1',cell_name=None,cleaned=False,config_drive='',created_at=2016-11-14T22:15:35Z,default_ephemeral_device=None,default_swap_device=None,deleted=False,deleted_at=None,disable_terminate=False,display_description='fzx_sriov',display_name='fzx_sriov',ec2_ids=EC2Ids,ephemeral_gb=0,ephemeral_key_uuid=None,fault=<?>,flavor=Flavor(11),host='68D366CE-0AF4-8E11-8567-000000821800',hostname='fzx-sriov',id=137,image_ref='5d4b082a-3b47-4505-93b7-f242ca59e940',info_cache=InstanceInfoCache,instance_type_id=11,kernel_id='',key_data=None,key_name=None,launch_index=0,launched_at=None,launched_on='68D366CE-0AF4-8E11-8567-000000821800',locked=False,locked_by=None,memory_mb=1024,metadata={},migration_context=<?>,new_flavor=None,node='68D366CE-0AF4-8E11-8567-000000821800',numa_topology=None,old_flavor=None,os_type=None,pci_devices=PciDeviceList,pci_requests=InstancePCIRequests,power_state=0,progress=0,project_id='0a00fefb88cd407a9b768678fad26f5c',ramdisk_id='',reservation_id='r-0050r6iu',root_device_name='/dev/vda',root_gb=1,security_groups=SecurityGroupList,services=<?>,shutdown_terminate=False,system_metadata={booted_volume='False',image_base_image_ref='5d4b082a-3b47-4505-93b7-f242ca59e940',image_container_format='bare',image_disk_format='qcow2',image_hw_vif_multiqueue_enabled='true',image_min_disk='1',image_min_ram='0',network_allocated='True'},tags=<?>,task_state='spawning',terminated_at=None,updated_at=2016-11-14T22:15:40Z,user_data=None,user_id='20ad13b54d7a4950a30ccb3697eea438',uuid=d8a1c18a-6e20-41da-9115-c3f3e6c6b836,vcpu_model=VirtCPUModel,vcpus=4,vm_mode=None,vm_state='building') vif=VIF({'profile': {u'pci_slot': u'0000:02:10.6', u'physical_network': u'sriov_phynet', u'pci_vendor_info': u'8086:10ed'}, 'ovs_interfaceid': None, 'preserve_on_delete': True, 'network': Network({'bridge': None, 'subnets': [Subnet({'ips': [FixedIP({'meta': {}, 'version': 4, 'type': 'fixed', 'floating_ips': [], 'address': u'10.38.0.3'})], 'version': 4, 'meta': {'dhcp_server': u'10.38.0.2'}, 'dns': [], 'routes': [], 'cidr': u'10.38.0.0/16', 'gateway': IP({'meta': {}, 'version': 4, 'type': 'gateway', 'address': u'10.38.0.1'})})], 'meta': {'injected': False, 'tenant_id': u'0a00fefb88cd407a9b768678fad26f5c', 'physical_network': u'sriov_phynet', 'mtu': 1500}, 'id': u'28c3c2a5-12b5-45ae-910e-64426f6228a1', 'label': u'sriov-net'}), 'devname': u'tap63a1f051-00', 'vnic_type': u'direct', 'qbh_params': None, 'meta': {'pci_slotnum': 3}, 'details': {u'port_filter': False, u'vlan': u'63'}, 'address': u'fa:16:3e:91:f3:4f', 'active': False, 'type': u'hw_veb', 'id': u'63a1f051-0025-4ff4-a050-eef37a67f245', 'qbg_params': None}) plug /usr/lib/python2.7/site-packages/nova/virt/libvirt/vif.py:745\n2016-11-15T06:15:41.721+08:00 localhost nova-compute ERROR [pid:17224] [MainThread] [tid:115210352] [guest.py:127 create] [req-52fba1f0-008e-43dc-bc02-16ea378a41bd] Error defining a domain with XML: <domain type=\"kvm\">\n  <uuid>d8a1c18a-6e20-41da-9115-c3f3e6c6b836</uuid>\n  <name>instance-00000089</name>\n  <memory>1048576</memory>\n  <maxMemory slots=\"64\" unit=\"KiB\">4398046511104</maxMemory>\n  <vcpu current=\"4\" cpuset=\"0-3,6-11,14-15\">255</vcpu>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"13.0.1-0.20161112210228.6f14d8b\"/>\n      <nova:name>fzx_sriov</nova:name>\n      <nova:creationTime>2016-11-14 22:15:41</nova:creationTime>\n      <nova:flavor name=\"fzx.1024.1.4\">\n        <nova:memory>1024</nova:memory>\n        <nova:disk>1</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>4</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"20ad13b54d7a4950a30ccb3697eea438\">nova</nova:user>\n        <nova:project uuid=\"0a00fefb88cd407a9b768678fad26f5c\">service</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"5d4b082a-3b47-4505-93b7-f242ca59e940\"/>\n      <nova:extend_properties>\n        <nova:realtime>False</nova:realtime>\n      </nova:extend_properties>\n    </nova:instance>\n  </metadata>\n  <sysinfo type=\"smbios\">\n    <system>\n      <entry name=\"manufacturer\">OpenStack Foundation</entry>\n      <entry name=\"product\">OpenStack Nova</entry>\n      <entry name=\"version\">13.0.1-0.20161112210228.6f14d8b</entry>\n      <entry name=\"serial\">02b471f9-21bb-4e31-a835-72846f082ac0</entry>\n      <entry name=\"uuid\">d8a1c18a-6e20-41da-9115-c3f3e6c6b836</entry>\n      <entry name=\"family\">Virtual Machine</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type>hvm</type>\n    <smbios mode=\"sysinfo\"/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cputune>\n    <shares>4096</shares>\n  </cputune>\n  <clock offset=\"variable\" basis=\"utc\"/>\n  <cpu mode=\"host-passthrough\" match=\"exact\">\n    <topology sockets=\"255\" cores=\"1\" threads=\"1\"/>\n    <numa>\n      <cell id=\"0\" cpus=\"0-254\" memory=\"1048576\"/>\n    </numa>\n  </cpu>\n  <devices>\n    <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\" io=\"threads\"/>\n      <source file=\"/opt/HUAWEI/image/instances/d8a1c18a-6e20-41da-9115-c3f3e6c6b836/disk\"/>\n      <target bus=\"virtio\" dev=\"vda\"/>\n      <boot order=\"1\"/>\n    </disk>\n    <interface type=\"hostdev\" managed=\"yes\">\n      <mac address=\"fa:16:3e:91:f3:4f\"/>\n      <driver name=\"vhost\" queues=\"4\"/>\n      <source>\n        <address type=\"pci\" domain=\"0x0000\" bus=\"0x02\" slot=\"0x10\" function=\"0x6\"/>\n      </source>\n      <vlan>\n        <tag id=\"63\"/>\n      </vlan>\n      <address bus=\"0x00\" domain=\"0x0000\" function=\"0x0\" slot=\"0x3\" type=\"pci\"/>\n    </interface>\n    <serial type=\"file\">\n      <source path=\"/var/log/libvirt/qemu/instance-00000089.seriallog\"/>\n    </serial>\n    <input type=\"tablet\" bus=\"usb\"/>\n    <video>\n      <model type=\"cirrus\"/>\n    </video>\n    <memballoon model=\"virtio\">\n      <stats period=\"10\"/>\n    </memballoon>\n    <graphics type=\"vnc\" autoport=\"yes\" keymap=\"en-us\" listen=\"172.28.0.3\" passwd=\"t2I870T4\"/>\n    <channel type=\"unix\">\n      <source mode=\"bind\" path=\"/var/run/libvirt/qemu/instance-00000089.extend\"/>\n      <target name=\"org.qemu.guest_agent.1\" type=\"virtio\"/>\n      <address bus=\"0\" controller=\"0\" port=\"1\" type=\"virtio-serial\"/>\n    </channel>\n    <channel type=\"unix\">\n      <source mode=\"bind\" path=\"/var/run/libvirt/qemu/instance-00000089.agent\"/>\n      <target name=\"org.qemu.guest_agent.0\" type=\"virtio\"/>\n      <address bus=\"0\" controller=\"0\" port=\"2\" type=\"virtio-serial\"/>\n    </channel>\n    <channel type=\"unix\">\n      <source mode=\"bind\" path=\"/var/run/libvirt/qemu/instance-00000089.hostd\"/>\n      <target name=\"org.qemu.guest_agent.2\" type=\"virtio\"/>\n      <address bus=\"0\" controller=\"0\" port=\"3\" type=\"virtio-serial\"/>\n    </channel>\n    <channel type=\"unix\">\n      <source mode=\"bind\" path=\"/var/run/libvirt/qemu/instance-00000089.upgraded\"/>\n      <target name=\"org.qemu.guest_agent.3\" type=\"virtio\"/>\n      <address bus=\"0\" controller=\"0\" port=\"4\" type=\"virtio-serial\"/>\n    </channel>\n  </devices>\n  <qemu:commandline xmlns:qemu=\"http://libvirt.org/schemas/domain/qemu/1.0\">\n    <qemu:arg value=\"-device\"/>\n    <qemu:arg value=\"pv_channel,bus=pci.0,addr=0x1f\"/>\n    <qemu:arg value=\"-chardev\"/>\n    <qemu:arg value=\"file,id=seabios,path=/var/log/libvirt/qemu/instance-00000089.seabios,mux=off\"/>\n    <qemu:arg value=\"-device\"/>\n    <qemu:arg value=\"isa-debugcon,iobase=0x402,chardev=seabios\"/>\n    <qemu:arg value=\"-consolelog\"/>\n    <qemu:arg value=\"path=/var/log/libvirt/qemu/instance-00000089.consolelog\"/>\n  </qemu:commandline>\n</domain>\n2016-11-15T06:15:41.721+08:00 localhost nova-compute ERROR [pid:17224] [MainThread] [tid:115210352] [manager.py:542 _build_resources] [req-52fba1f0-008e-43dc-bc02-16ea378a41bd] [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836] Instance failed to spawn\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836] Traceback (most recent call last):\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/huawei/compute/manager.py\", line 536, in _build_resources\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     yield resources\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2065, in _build_and_run_instance\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     block_device_info=block_device_info)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/huawei/virt/libvirt/driver.py\", line 2416, in spawn\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     block_device_info)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2770, in spawn\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     block_device_info=block_device_info)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4910, in _create_domain_and_network\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     xml, pause=pause, power_on=power_on)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4836, in _create_domain\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     guest = libvirt_guest.Guest.create(xml, self._host)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 127, in create\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     encodeutils.safe_decode(xml))\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     self.force_reraise()\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     six.reraise(self.type_, self.value, self.tb)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 123, in create\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     domain = host.write_instance_config(xml)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/host.py\", line 981, in write_instance_config\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     return self.get_connection().defineXML(xml)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 186, in doit\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 144, in proxy_call\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     rv = execute(f, *args, **kwargs)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 125, in execute\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     six.reraise(c, e, tb)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 83, in tworker\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     rv = meth(*args, **kwargs)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 3751, in defineXML\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836] libvirtError: unsupported configuration: Unknown PCI device <driver name='vhost'/> has been specified\n2016-11-15 06:15:41.624 17224 ERROR nova.huawei.compute.manager [instance: d8a1c18a-6e20-41da-9115-c3f3e6c6b836]", 
            "date_created": "2016-11-15 03:59:41.439605+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhengzhenyu"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/397545", 
            "date_created": "2016-11-15 06:25:45.385065+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "nova.huawei.compute.manager huh :)", 
            "date_created": "2016-12-30 15:01:31.901294+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/397545\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=fb3b2d9eaf8317cec62e52a99f17946610b8cdca\nSubmitter: Jenkins\nBranch:    master\n\ncommit fb3b2d9eaf8317cec62e52a99f17946610b8cdca\nAuthor: Kevin_Zheng <email address hidden>\nDate:   Tue Nov 15 14:13:58 2016 +0800\n\n    Don't apply multi-queue to SRIOV ports\n    \n    The multi-queue feature was added:\n    https://blueprints.launchpad.net/nova/+spec/libvirt-virtio-net-multiqueue\n    and it is controlled using image metadata:\n    hw_vif_mutliqueue_enabled=true|false\n    \n    when users want to launch an instance with\n    a SRIOV port and several normal ports\n    with multi-queue feature, ERROR can take\n    place due to wrong driver name for SRIOV\n    interface. Details could be found in bug\n    description.\n    \n    Change-Id: I52c51ff17f43133154f6ea8aa4107f1673f82dde\n    Closes-bug: #1641814\n", 
            "date_created": "2017-01-03 11:51:09.530755+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/416299", 
            "date_created": "2017-01-03 17:02:16.870032+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/416299\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a6a67d821446afc71ac34d19e2f17d7d0e03d178\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit a6a67d821446afc71ac34d19e2f17d7d0e03d178\nAuthor: Kevin_Zheng <email address hidden>\nDate:   Tue Nov 15 14:13:58 2016 +0800\n\n    Don't apply multi-queue to SRIOV ports\n    \n    The multi-queue feature was added:\n    https://blueprints.launchpad.net/nova/+spec/libvirt-virtio-net-multiqueue\n    and it is controlled using image metadata:\n    hw_vif_mutliqueue_enabled=true|false\n    \n    when users want to launch an instance with\n    a SRIOV port and several normal ports\n    with multi-queue feature, ERROR can take\n    place due to wrong driver name for SRIOV\n    interface. Details could be found in bug\n    description.\n    \n    Conflicts:\n            nova/tests/unit/virt/libvirt/test_vif.py\n            nova/virt/libvirt/vif.py\n    \n    NOTE(mriedem): The test conflict is due to\n    77dee9505860be11c2b14c35d403fe2c49a0bcfd not being in\n    Newton. The vif.py conflict is due to\n    e5e4dfcfdb918b57dcbd3e3cfb171e3b70e3c701 not being in\n    Newton.\n    \n    Change-Id: I52c51ff17f43133154f6ea8aa4107f1673f82dde\n    Closes-bug: #1641814\n    (cherry picked from commit fb3b2d9eaf8317cec62e52a99f17946610b8cdca)\n", 
            "date_created": "2017-01-04 01:55:37.403590+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b3 development milestone.", 
            "date_created": "2017-01-27 00:52:14.897779+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.4 release.", 
            "date_created": "2017-02-27 20:29:37.842946+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-01-03 11:51:06.400146+00:00"
}