{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:24:51.902042+00:00", 
    "description": "OS: Ubuntu 12.04\nOpenStack: 2013.1+git201303220742~precise-0ubuntu1 (from openstack-ubuntu-testing-grizzly-trunk-testing-precise).\n\nSimilar to https://bugs.launchpad.net/nova/+bug/1152792\n\nIn resize autoconfirm nova-compute gets error:\n2013-03-28 15:49:05.767 INFO nova.compute.manager [req-b4b63030-490f-4368-b403-22172f705c2d None None] Found 1 unconfirmed migrations older than 60 seconds\n2013-03-28 15:49:05.768 INFO nova.compute.manager [req-b4b63030-490f-4368-b403-22172f705c2d None None] Automatically confirming migration 3 for instance 557df7f9-6d33-4cf4-9f7d-309a5731416a\n2013-03-28 15:49:05.768 DEBUG nova.openstack.common.rpc.amqp [req-b4b63030-490f-4368-b403-22172f705c2d None None] Making synchronous call on conductor ... multicall /usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py:584\n2013-03-28 15:49:05.768 DEBUG nova.openstack.common.rpc.amqp [req-b4b63030-490f-4368-b403-22172f705c2d None None] MSG_ID is 212d7d8cca8a4e30baa348aad4504be5 multicall /usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py:587\n2013-03-28 15:49:05.769 DEBUG nova.openstack.common.rpc.amqp [req-b4b63030-490f-4368-b403-22172f705c2d None None] UNIQUE_ID is 15b963d02f7e4067a72883c2278392ef. _add_unique_id /usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py:337\n2013-03-28 15:49:05.861 DEBUG nova.utils [req-b4b63030-490f-4368-b403-22172f705c2d None None] Reloading cached file /etc/nova/policy.json read_cached_file /usr/lib/python2.7/dist-packages/nova/utils.py:1078\n2013-03-28 15:49:05.866 ERROR nova.compute [req-b4b63030-490f-4368-b403-22172f705c2d None None] No db access allowed in nova-compute:   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 631, in _inner\n    idle = self.f(*self.args, **self.kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 571, in periodic_tasks\n    return self.manager.periodic_tasks(ctxt, raise_on_error=raise_on_error)\n  File \"/usr/lib/python2.7/dist-packages/nova/manager.py\", line 241, in periodic_tasks\n    task(self, context)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3436, in _poll_unconfirmed_resizes\n    migration_ref=migration)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 163, in wrapped\n    return func(self, context, target, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 153, in inner\n    return function(self, context, instance, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 134, in inner\n    return f(self, context, instance, *args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1860, in confirm_resize\n    deltas = self._downsize_quota_delta(context, migration_ref)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1940, in _downsize_quota_delta\n    migration_ref['old_instance_type_id'])\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/instance_types.py\", line 188, in get_instance_type\n    return db.instance_type_get(ctxt, instance_type_id)\n  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 1280, in instance_type_get\n    return IMPL.instance_type_get(context, id)\n  File \"/usr/bin/nova-compute\", line 66, in __call__\n    stacktrace = \"\".join(traceback.format_stack())\n\n2013-03-28 15:49:05.866 ERROR nova.compute.manager [req-b4b63030-490f-4368-b403-22172f705c2d None None] [instance: 557df7f9-6d33-4cf4-9f7d-309a5731416a] Error auto-confirming resize: nova-compute. Will retry later.", 
    "tags": [
        "grizzly-rc-potential"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1161402", 
    "owner": "https://api.launchpad.net/1.0/~danms", 
    "id": 1161402, 
    "index": 1043, 
    "openned": "2013-03-28 13:50:39.612514+00:00", 
    "created": "2013-03-28 13:50:39.612514+00:00", 
    "title": "automatic confirmation after resize still fails", 
    "comments": [
        {
            "content": "OS: Ubuntu 12.04\nOpenStack: 2013.1+git201303220742~precise-0ubuntu1 (from openstack-ubuntu-testing-grizzly-trunk-testing-precise).\n\nSimilar to https://bugs.launchpad.net/nova/+bug/1152792\n\nIn resize autoconfirm nova-compute gets error:\n2013-03-28 15:49:05.767 INFO nova.compute.manager [req-b4b63030-490f-4368-b403-22172f705c2d None None] Found 1 unconfirmed migrations older than 60 seconds\n2013-03-28 15:49:05.768 INFO nova.compute.manager [req-b4b63030-490f-4368-b403-22172f705c2d None None] Automatically confirming migration 3 for instance 557df7f9-6d33-4cf4-9f7d-309a5731416a\n2013-03-28 15:49:05.768 DEBUG nova.openstack.common.rpc.amqp [req-b4b63030-490f-4368-b403-22172f705c2d None None] Making synchronous call on conductor ... multicall /usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py:584\n2013-03-28 15:49:05.768 DEBUG nova.openstack.common.rpc.amqp [req-b4b63030-490f-4368-b403-22172f705c2d None None] MSG_ID is 212d7d8cca8a4e30baa348aad4504be5 multicall /usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py:587\n2013-03-28 15:49:05.769 DEBUG nova.openstack.common.rpc.amqp [req-b4b63030-490f-4368-b403-22172f705c2d None None] UNIQUE_ID is 15b963d02f7e4067a72883c2278392ef. _add_unique_id /usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py:337\n2013-03-28 15:49:05.861 DEBUG nova.utils [req-b4b63030-490f-4368-b403-22172f705c2d None None] Reloading cached file /etc/nova/policy.json read_cached_file /usr/lib/python2.7/dist-packages/nova/utils.py:1078\n2013-03-28 15:49:05.866 ERROR nova.compute [req-b4b63030-490f-4368-b403-22172f705c2d None None] No db access allowed in nova-compute:   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 631, in _inner\n    idle = self.f(*self.args, **self.kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 571, in periodic_tasks\n    return self.manager.periodic_tasks(ctxt, raise_on_error=raise_on_error)\n  File \"/usr/lib/python2.7/dist-packages/nova/manager.py\", line 241, in periodic_tasks\n    task(self, context)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3436, in _poll_unconfirmed_resizes\n    migration_ref=migration)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 163, in wrapped\n    return func(self, context, target, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 153, in inner\n    return function(self, context, instance, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 134, in inner\n    return f(self, context, instance, *args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1860, in confirm_resize\n    deltas = self._downsize_quota_delta(context, migration_ref)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1940, in _downsize_quota_delta\n    migration_ref['old_instance_type_id'])\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/instance_types.py\", line 188, in get_instance_type\n    return db.instance_type_get(ctxt, instance_type_id)\n  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 1280, in instance_type_get\n    return IMPL.instance_type_get(context, id)\n  File \"/usr/bin/nova-compute\", line 66, in __call__\n    stacktrace = \"\".join(traceback.format_stack())\n\n2013-03-28 15:49:05.866 ERROR nova.compute.manager [req-b4b63030-490f-4368-b403-22172f705c2d None None] [instance: 557df7f9-6d33-4cf4-9f7d-309a5731416a] Error auto-confirming resize: nova-compute. Will retry later.", 
            "date_created": "2013-03-28 13:50:39.612514+00:00", 
            "author": "https://api.launchpad.net/1.0/~nerijus-bendziunas"
        }, 
        {
            "content": "I think this may be a dupe of bug 1160489, which was fixed a few days ago. Can you see if it's still a problem?", 
            "date_created": "2013-03-28 15:53:52.676570+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "I updated nova to 1:2013.1+git201303281803~precise-0ubuntu1.\n\nProblem exists but now error is little bit different:\n\n2013-03-29 14:45:37.470 23044 ERROR nova.compute [-] No db access allowed in nova-compute:   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 631, in _inner\n    idle = self.f(*self.args, **self.kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 571, in periodic_tasks\n    return self.manager.periodic_tasks(ctxt, raise_on_error=raise_on_error)\n  File \"/usr/lib/python2.7/dist-packages/nova/manager.py\", line 241, in periodic_tasks\n    task(self, context)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3442, in _poll_unconfirmed_resizes\n    migration_ref=migration)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 164, in wrapped\n    return func(self, context, target, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 154, in inner\n    return function(self, context, instance, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 135, in inner\n    return f(self, context, instance, *args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1865, in confirm_resize\n    expected_task_state=None)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 164, in wrapped\n    return func(self, context, target, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 998, in update\n    _, updated = self._update(context, instance, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1005, in _update\n    context, instance['uuid'], kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 692, in instance_update_and_get_original\n    rv = IMPL.instance_update_and_get_original(context, instance_uuid, values)\n  File \"/usr/bin/nova-compute\", line 66, in __call__\n    stacktrace = \"\".join(traceback.format_stack())\n\n2013-03-29 14:45:37.470 23044 ERROR nova.compute.manager [-] [instance: f757ae67-ee15-49d8-b848-489cec27aa00] Error auto-confirming resize: nova-compute. Will retry later.", 
            "date_created": "2013-03-29 12:49:35.047603+00:00", 
            "author": "https://api.launchpad.net/1.0/~nerijus-bendziunas"
        }, 
        {
            "content": "Can you attach your nova config file please?", 
            "date_created": "2013-03-29 13:52:14.648963+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "Attached.", 
            "date_created": "2013-03-29 14:54:05.657092+00:00", 
            "author": "https://api.launchpad.net/1.0/~nerijus-bendziunas"
        }, 
        {
            "content": "I've confirmed this, thanks.", 
            "date_created": "2013-03-29 15:16:44.105324+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/25729", 
            "date_created": "2013-03-29 16:24:28.466490+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: milestone-proposed\nReview: https://review.openstack.org/25738", 
            "date_created": "2013-03-29 18:00:28.177681+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/25729\nCommitted: http://github.com/openstack/nova/commit/ec75cc2a6bc6e3f367b3377515cb9c4b99a6ab29\nSubmitter: Jenkins\nBranch:    master\n\ncommit ec75cc2a6bc6e3f367b3377515cb9c4b99a6ab29\nAuthor: Dan Smith <email address hidden>\nDate:   Fri Mar 29 09:19:57 2013 -0700\n\n    Fix automatic confirmation of resizes for no-db-compute\n    \n    compute/api.py:confirm_resize() was still making a bunch of calls\n    against the database that were tripping over the no-db-compute\n    enforcement checks. Instead of trying to unwind all of the instance\n    action, quota, etc code and divert to conductor, just farm out the\n    entire confirm_resize() call to conductor.\n    \n    Fixes bug 1161402\n    \n    Change-Id: I121040a3b575f5866d45cc8ef6862d67f5558715\n", 
            "date_created": "2013-03-29 18:10:25.806331+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/25738\nCommitted: http://github.com/openstack/nova/commit/73f580449dd68a9bbfe4455788b62bf49210d348\nSubmitter: Jenkins\nBranch:    milestone-proposed\n\ncommit 73f580449dd68a9bbfe4455788b62bf49210d348\nAuthor: Dan Smith <email address hidden>\nDate:   Fri Mar 29 09:19:57 2013 -0700\n\n    Fix automatic confirmation of resizes for no-db-compute\n    \n    compute/api.py:confirm_resize() was still making a bunch of calls\n    against the database that were tripping over the no-db-compute\n    enforcement checks. Instead of trying to unwind all of the instance\n    action, quota, etc code and divert to conductor, just farm out the\n    entire confirm_resize() call to conductor.\n    \n    Fixes bug 1161402\n    \n    Change-Id: I121040a3b575f5866d45cc8ef6862d67f5558715\n    (cherry picked from commit ec75cc2a6bc6e3f367b3377515cb9c4b99a6ab29)\n", 
            "date_created": "2013-03-29 22:02:41.553242+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-03-29 22:02:39.289635+00:00"
}