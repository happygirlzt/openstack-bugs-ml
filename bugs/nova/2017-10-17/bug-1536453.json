{
    "status": "Expired", 
    "last_updated": "2016-11-07 11:07:39.373484+00:00", 
    "description": "version : kilo\n\ndescription:\n\nI migrate a volume which is in in-use status on lvm to another VG . It will be error in most time . I don\u2018t know why .\nBecasuse when I don't use the volume on lvm to migrate .It will be ok.\n\n\nproduct steps:\n\n1 create a volume on VG\n2 create a vm\n3 attach the volume to the vm\n4 migrate the volume to another VG.\n\nerror logs:\n\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5582, in _swap_volume\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     resize_to)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1232, in swap_volume\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     self._swap_volume(virt_dom, disk_dev, conf.source_path, resize_to)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1203, in _swap_volume\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     self._conn.defineXML(xml)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     rv = execute(f, *args, **kwargs)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     six.reraise(c, e, tb)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     rv = meth(*args, **kwargs)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 3632, in defineXML\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd] libvirtError: block copy still active: domain has active block job\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd] \n2016-01-21 11:13:41.686 27863 INFO nova.scheduler.client.report [req-c59264b3-9223-472e-b1c4-bfc3f5643393 9134a1a11e5441c29e37757231f36450 32bfe3124bb2478aad3e6aa1cee09f14 - - -] Compute_service record updated for ('2C5_19_CG2', '2C5_19_CG2')\n2016-01-21 11:13:41.687 27863 ERROR oslo_messaging.rpc.dispatcher [req-c59264b3-9223-472e-b1c4-bfc3f5643393 9134a1a11e5441c29e37757231f36450 32bfe3124bb2478aad3e6aa1cee09f14 - - -] Exception during message handling: block copy still active: domain has active block job\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 8262, in swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     new_volume_id)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     payload)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 71, in wrapped\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 376, in decorated_function\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance_uuid=instance_uuid)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 347, in decorated_function\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 404, in decorated_function\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 392, in decorated_function\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5634, in swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     new_volume_id)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5601, in _swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     self.volume_api.unreserve_volume(context, new_volume_id)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5582, in _swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     resize_to)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1232, in swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     self._swap_volume(virt_dom, disk_dev, conf.source_path, resize_to)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1203, in _swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     self._conn.defineXML(xml)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     rv = execute(f, *args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(c, e, tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     rv = meth(*args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 3632, in defineXML\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1536453", 
    "owner": "None", 
    "id": 1536453, 
    "index": 7240, 
    "openned": "2016-01-21 03:24:22.971674+00:00", 
    "created": "2016-01-21 03:24:22.971674+00:00", 
    "title": "swap volume failed because block copy still active", 
    "comments": [
        {
            "content": "version : kilo\n\ndescription:\n\nI migrate a volume which is in in-use status on lvm to another VG . It will be error in most time . I don\u2018t know why .\nBecasuse when I don't use the volume on lvm to migrate .It will be ok.\n\n\nproduct steps:\n\n1 create a volume on VG\n2 create a vm\n3 attach the volume to the vm\n4 migrate the volume to another VG.\n\nerror logs:\n\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5582, in _swap_volume\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     resize_to)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1232, in swap_volume\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     self._swap_volume(virt_dom, disk_dev, conf.source_path, resize_to)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1203, in _swap_volume\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     self._conn.defineXML(xml)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     rv = execute(f, *args, **kwargs)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     six.reraise(c, e, tb)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     rv = meth(*args, **kwargs)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 3632, in defineXML\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd]     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd] libvirtError: block copy still active: domain has active block job\n2016-01-21 11:13:40.918 27863 TRACE nova.compute.manager [instance: 35158835-9b79-49e9-9a92-e6bbfaba50dd] \n2016-01-21 11:13:41.686 27863 INFO nova.scheduler.client.report [req-c59264b3-9223-472e-b1c4-bfc3f5643393 9134a1a11e5441c29e37757231f36450 32bfe3124bb2478aad3e6aa1cee09f14 - - -] Compute_service record updated for ('2C5_19_CG2', '2C5_19_CG2')\n2016-01-21 11:13:41.687 27863 ERROR oslo_messaging.rpc.dispatcher [req-c59264b3-9223-472e-b1c4-bfc3f5643393 9134a1a11e5441c29e37757231f36450 32bfe3124bb2478aad3e6aa1cee09f14 - - -] Exception during message handling: block copy still active: domain has active block job\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 8262, in swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     new_volume_id)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     payload)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 71, in wrapped\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 376, in decorated_function\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance_uuid=instance_uuid)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 347, in decorated_function\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 404, in decorated_function\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 392, in decorated_function\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5634, in swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     new_volume_id)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5601, in _swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     self.volume_api.unreserve_volume(context, new_volume_id)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5582, in _swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     resize_to)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1232, in swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     self._swap_volume(virt_dom, disk_dev, conf.source_path, resize_to)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1203, in _swap_volume\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     self._conn.defineXML(xml)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     rv = execute(f, *args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     six.reraise(c, e, tb)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     rv = meth(*args, **kwargs)\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 3632, in defineXML\n2016-01-21 11:13:41.687 27863 TRACE oslo_messaging.rpc.dispatcher     if ret is None:raise libvirtError('virDomainDefineXML() failed', conn=self)", 
            "date_created": "2016-01-21 03:24:22.971674+00:00", 
            "author": "https://api.launchpad.net/1.0/~liang-jingtao"
        }, 
        {
            "content": "Bug skimming result\n===================\nThis report doesn't have enough information to allow us a proper\nanalysis of the issue you described. Please update the description\nwith the following information:\n\n* The version of libvirt/kvm/qemu:\n    $ virsh -c qemu:///system version --daemon\n* The exact version of Nova:\n       If this is from a distro please provide\n           $ dpkg -l | grep nova\n           or\n           $ rpm -ql | grep nova\n       If this is from git, please provide\n           $ git log -1\n\nThere is a chance that you hit the libvirt bug [1].\n\nI'm changing the status of this report to \"Incomplete\". When you have\nprovided the asked questions, please switch it back to \"New\".\n\nIf you have questions, I'm available in the IRC channel #openstack-nova\nunder the name \"markus_z\".\n\nReferences\n==========\n[1] https://www.redhat.com/archives/libvirt-users/2015-January/msg00042.html", 
            "date_created": "2016-01-22 16:19:25.939169+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "thank you, I have checked the version as following:\n\n* The version of libvirt/kvm/qemu:\n\n[root@2C5_10_DELL05 nova(keystone_admin)]# virsh -c qemu:///system version --daemon\nCompiled against library: libvirt 1.2.15\nUsing library: libvirt 1.2.15\nUsing API: QEMU 1.2.15\nRunning hypervisor: QEMU 2.2.1\nRunning against daemon: 1.2.15\n\nThe exact version of Nova:\n\n[root@2C5_10_DELL05 nova(keystone_admin)]# rpm -qa | grep nova\nopenstack-nova-compute-2015.1.0-1.1.393.noarch\nopenstack-nova-monitor-2015.1.0-1.1.393.noarch\nopenstack-nova-api-2015.1.0-1.1.393.noarch\npython-novaclient-2.23.0-1.1.393.noarch\n\nplease help me check it ", 
            "date_created": "2016-01-25 01:15:25.363626+00:00", 
            "author": "https://api.launchpad.net/1.0/~liang-jingtao"
        }, 
        {
            "content": "Hi Jingtao Liang,\n\nA few comments:\n\n- Your test case isn't clear, can you include the *exact* commands you've\n  invoked, so that I (or others) can try to reproduce the issue locally?\n\n- Second, if you're able to consistenlty reproduce this issue, can you\n  add these libvirt log filters (check what values you have currently,\n  and replace them with below) in /etc/libvirtd.conf:\n\n    log_filters=\"3:event 3:file 1:util 1:security 1:qemu 1:libvirt\"\n    log_outputs=\"1:file:/var/log/libvirt/libvirtd.log\"\n\n  Restart libvirt daemon, repeat your test, and attach the libvirtd.log\n  to this bug.\n\n- As additional information, when you see this error, find the block\n  device (from `virsh domblklist $UUID`) that is being migrated (when\n  you say \"migrate the volume to another VG.\"), and run (assuming the\n  block device name is 'vda') the below command & see if it spews out\n  some information (it tells if you there really are any block\n  operations in progress): \n\n      $ virsh blockjob $UUID-of-NovaInstance vda --info.\n\n  Another thing to try, to see what events libvirt is pusing out: (a)\n  Before you perform the test, run this command in one shell:\n\n    $ virsh qemu-monitor-event $UUID-of-NovaInstance --pretty --loop\n\n  Which will spew out some events, (e.g. BLOCK_JOB_READY,\n  BLOCK_JOB_COMPLETED (this one is unlikely in this bug, as your error\n  still says there's an active block copy job), or BLOCK_JOB_CANCELLED\n  (if the copy job is aborted with CTL+C)\n    \n- Lastly, if time permits, can you also try reproducing this with\n  Liberty release (it's the latest stable)?", 
            "date_created": "2016-02-10 11:25:34.280266+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "tks,I found lvm is esay to reproduce the bug. And our team is trying to find the solution.when I get the reason ,i will tell you .", 
            "date_created": "2016-03-08 01:28:19.774217+00:00", 
            "author": "https://api.launchpad.net/1.0/~liang-jingtao"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2016-05-07 04:17:40.850162+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "I faced a same error when executing 'nova volume-update' in mitaka version with LVMVolumeDriver and found out what root cause is.\nTo begin with, current code has a problem that there is no exception code.\nSo, we can not find out what root cause is.\nI've modified nova/virt/libvirt/driver.py like this:\n\n@@ -1394,6 +1395,9 @@\n                 while dev.wait_for_job(wait_for_job_clean=True):\n                     time.sleep(0.5)\n                 dev.resize(resize_to * units.Gi / units.Ki)\n+        except Exception:\n+            with excutils.save_and_reraise_exception():\n+                LOG.exception(_LE(\"Failed to swap volume\"))\n         finally:\n             self._host.write_instance_config(xml)\n             \n<error logs after patching above>\n\n Traceback (most recent call last):\n   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1389, in _swap_volume\n     dev.abort_job(pivot=True)\n   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 500, in abort_job\n     self._guest._domain.blockJobAbort(self._disk, flags=flags)\n   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 183, in doit\n     result = proxy_call(self._autowrap, f, *args, **kwargs)\n   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 141, in proxy_call\n     rv = execute(f, *args, **kwargs)\n   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 122, in execute\n     six.reraise(c, e, tb)\n   File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 80, in tworker\n     rv = meth(*args, **kwargs)\n   File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 733, in blockJobAbort\n     if ret == -1: raise libvirtError ('virDomainBlockJobAbort() failed', dom=self)\n libvirtError: block copy still active: disk 'vdb' not ready for pivot yet\n\n\nAs you can see, a root cause is a abort_job method.\nBefore executing this method, nova executes a wait_for_job method to wait for job completion, but it seems that it doesn't work correctly.\n\nI added a following sleep method as a test and confirmed a 'nova volume-update' command works correctly.\n\n@@ -1386,6 +1386,7 @@\n             while dev.wait_for_job():\n                 time.sleep(0.5)\n\n+            time.sleep(10)\n             dev.abort_job(pivot=True)\n             if resize_to:\n                 # NOTE(alex_xu): domain.blockJobAbort isn't sync call. This\n\n\nI don't know the reason why wait_for_job method doesn't work correctly.\nDoes anyone know it?\n\n<my environment>\nlibvirt-1.2.17-13.el7_2.5.x86_64\nopenstack-nova-compute-13.1.1-2.el7ost.noarch\nqemu-kvm-common-rhev-2.3.0-31.el7_2.21.x86_64\nqemu-kvm-rhev-2.3.0-31.el7_2.21.x86_64", 
            "date_created": "2016-11-07 08:02:57.342648+00:00", 
            "author": "https://api.launchpad.net/1.0/~h-eguchi"
        }, 
        {
            "content": "this bug is related to https://bugs.launchpad.net/nova/+bug/1630600", 
            "date_created": "2016-11-07 11:07:38.748745+00:00", 
            "author": "https://api.launchpad.net/1.0/~h-eguchi"
        }
    ], 
    "closed": "2016-05-07 04:17:41.435667+00:00"
}