{
    "status": "Fix Released", 
    "last_updated": "2012-11-21 20:34:25.577541+00:00", 
    "description": "Hi all,\n\nI've got a 2 nodes openstack setup  were I'm testing a VlanManager network: both the nodes are natty 11.04 64bit running Diablo milestone (2011.3~d3-0ubuntu0~ppa1~natty1).\nOne of the node runs the nova-sheduler and the nova-network services. \nIt has the following network related flags:\n--network_manager=nova.network.manager.VlanManager\n--flat_network_dhcp_start=10.12.1.1\n--flat_network_dns=212.29.129.3\n--fixed_range=10.12.0.0/16\n--iscsi_ip_prefix=10.10.11.\n--vlan_interface=eth0\n--flat_interface=eth0\n--public_interface=eth1\n\nThe other runs nova-compute and has the following network related flags:\n--network_manager=nova.network.manager.VlanManager\n--flat_network_dhcp_start=10.12.1.1\n--flat_network_dns=212.29.129.3\n--fixed_range=10.12.0.0/16\n--iscsi_ip_prefix=10.10.11.\n--vlan_interface=eth4\n--flat_interface=eth4\n--public_interface=eth1\n--logdir=/var/log/nova\n--state_path=/var/lib/nova\n--verbose\n\nIf I check the registered vlan config on this node I got:\nroot@beta:~# nova-manage config list|grep vlan\n--vlan_interface=eth4\n--vlan_start=100\n\nIf i look in the nova-compute.log, at service startup i can see:\n2011-08-24 10:18:59,542 DEBUG nova [-] find_host_timeout : 30 from (pid=3460) serve /usr/lib/pymodules/python2.7/nova/service.py:366\n2011-08-24 10:18:59,542 DEBUG nova [-] vlan_interface : eth4 from (pid=3460) serve /usr/lib/pymodules/python2.7/nova/service.py:366\n2011-08-24 10:18:59,542 DEBUG nova [-] aws_access_key_id : admin from (pid=3460) serve /usr/lib/pymodules/python2.7/nova/service.py:366\n\nBut when i deploy a vm from a project who is placed on vlan 12, in the same log I can see:\n2011-08-24 10:21:45,862 DEBUG nova.linux_net [-] Starting VLAN inteface vlan12 from (pid=3460) ensure_vlan /usr/lib/pymodules/python2.7/nova/network/linux_net.py:466\n2011-08-24 10:21:45,862 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig set_name_type VLAN_PLUS_VID_NO_PAD from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-08-24 10:21:45,907 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig add eth0 12 from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-08-24 10:21:45,921 DEBUG nova.utils [-] Running cmd (subprocess): sudo ip link set vlan12 up from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-08-24 10:21:45,937 DEBUG nova.utils [-] Attempting to grab semaphore \"ensure_bridge\" for method \"ensure_bridge\"... from (pid=3460) inner /usr/lib/pymodules/python2.7/nova/utils.py:600\n2011-08-24 10:21:45,937 DEBUG nova.utils [-] Attempting to grab file lock \"ensure_bridge\" for method \"ensure_bridge\"... from (pid=3460) inner /usr/lib/pymodules/python2.7/nova/utils.py:605\n2011-08-24 10:21:45,938 DEBUG nova.utils [-] Running cmd (subprocess): ip link show dev br12 from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-08-24 10:21:45,943 DEBUG nova.utils [-] Result was 255 from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:161\n2011-08-24 10:21:45,944 DEBUG nova.linux_net [-] Starting Bridge interface for vlan12 from (pid=3460) ensure_bridge /usr/lib/pymodules/python2.7/nova/network/linux_net.py:489\n\nthe compute node uses eth0 to create the vlan instead of eth4.\nIn this case eth0 is both the default value and the controller node's vlan_interface value.\nAm i missing some further flag in my nova.conf?\n\nThanks\nGiuseppe", 
    "tags": [
        "in-stable-diablo"
    ], 
    "importance": "Wishlist", 
    "heat": 26, 
    "link": "https://bugs.launchpad.net/nova/+bug/833426", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 833426, 
    "index": 2375, 
    "openned": "2011-08-24 23:07:41.512152+00:00", 
    "created": "2011-08-24 23:07:41.512152+00:00", 
    "title": "Nonhomogeneous networks not supported", 
    "comments": [
        {
            "content": "Hi all,\n\nI've got a 2 nodes openstack setup  were I'm testing a VlanManager network: both the nodes are natty 11.04 64bit running Diablo milestone (2011.3~d3-0ubuntu0~ppa1~natty1).\nOne of the node runs the nova-sheduler and the nova-network services. \nIt has the following network related flags:\n--network_manager=nova.network.manager.VlanManager\n--flat_network_dhcp_start=10.12.1.1\n--flat_network_dns=212.29.129.3\n--fixed_range=10.12.0.0/16\n--iscsi_ip_prefix=10.10.11.\n--vlan_interface=eth0\n--flat_interface=eth0\n--public_interface=eth1\n\nThe other runs nova-compute and has the following network related flags:\n--network_manager=nova.network.manager.VlanManager\n--flat_network_dhcp_start=10.12.1.1\n--flat_network_dns=212.29.129.3\n--fixed_range=10.12.0.0/16\n--iscsi_ip_prefix=10.10.11.\n--vlan_interface=eth4\n--flat_interface=eth4\n--public_interface=eth1\n--logdir=/var/log/nova\n--state_path=/var/lib/nova\n--verbose\n\nIf I check the registered vlan config on this node I got:\nroot@beta:~# nova-manage config list|grep vlan\n--vlan_interface=eth4\n--vlan_start=100\n\nIf i look in the nova-compute.log, at service startup i can see:\n2011-08-24 10:18:59,542 DEBUG nova [-] find_host_timeout : 30 from (pid=3460) serve /usr/lib/pymodules/python2.7/nova/service.py:366\n2011-08-24 10:18:59,542 DEBUG nova [-] vlan_interface : eth4 from (pid=3460) serve /usr/lib/pymodules/python2.7/nova/service.py:366\n2011-08-24 10:18:59,542 DEBUG nova [-] aws_access_key_id : admin from (pid=3460) serve /usr/lib/pymodules/python2.7/nova/service.py:366\n\nBut when i deploy a vm from a project who is placed on vlan 12, in the same log I can see:\n2011-08-24 10:21:45,862 DEBUG nova.linux_net [-] Starting VLAN inteface vlan12 from (pid=3460) ensure_vlan /usr/lib/pymodules/python2.7/nova/network/linux_net.py:466\n2011-08-24 10:21:45,862 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig set_name_type VLAN_PLUS_VID_NO_PAD from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-08-24 10:21:45,907 DEBUG nova.utils [-] Running cmd (subprocess): sudo vconfig add eth0 12 from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-08-24 10:21:45,921 DEBUG nova.utils [-] Running cmd (subprocess): sudo ip link set vlan12 up from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-08-24 10:21:45,937 DEBUG nova.utils [-] Attempting to grab semaphore \"ensure_bridge\" for method \"ensure_bridge\"... from (pid=3460) inner /usr/lib/pymodules/python2.7/nova/utils.py:600\n2011-08-24 10:21:45,937 DEBUG nova.utils [-] Attempting to grab file lock \"ensure_bridge\" for method \"ensure_bridge\"... from (pid=3460) inner /usr/lib/pymodules/python2.7/nova/utils.py:605\n2011-08-24 10:21:45,938 DEBUG nova.utils [-] Running cmd (subprocess): ip link show dev br12 from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:143\n2011-08-24 10:21:45,943 DEBUG nova.utils [-] Result was 255 from (pid=3460) execute /usr/lib/pymodules/python2.7/nova/utils.py:161\n2011-08-24 10:21:45,944 DEBUG nova.linux_net [-] Starting Bridge interface for vlan12 from (pid=3460) ensure_bridge /usr/lib/pymodules/python2.7/nova/network/linux_net.py:489\n\nthe compute node uses eth0 to create the vlan instead of eth4.\nIn this case eth0 is both the default value and the controller node's vlan_interface value.\nAm i missing some further flag in my nova.conf?\n\nThanks\nGiuseppe", 
            "date_created": "2011-08-24 23:07:41.512152+00:00", 
            "author": "https://api.launchpad.net/1.0/~tr3buchet"
        }, 
        {
            "content": "plan: reduce flat_interface and vlan_interface to bridge_interface. Default these flags to none. If the flag is specified it will override the value in the table. Upon network creation the flag will only be used if the --bridge_interface parameter is not passed.", 
            "date_created": "2011-08-24 23:09:14.852029+00:00", 
            "author": "https://api.launchpad.net/1.0/~tr3buchet"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/3687", 
            "date_created": "2012-02-02 19:03:19.478894+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/3687\nCommitted: http://github.com/openstack/nova/commit/8efe15209aaee6b15c8edb21362c08137294a7de\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8efe15209aaee6b15c8edb21362c08137294a7de\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Thu Feb 2 10:59:43 2012 -0800\n\n    Provides flag override for vlan interface\n    \n    This means you can have your vlan_interface be different on\n    different hosts machines by setting vlan_interface differently\n    on each host.\n    \n     * Allow non-homogenous vlan networks\n     * Fixes bug 833426\n     * Includes failing test for linux_net\n    \n    Change-Id: I2f0d43c1366f88a8832a779c4065b37dd1a5bdf8\n", 
            "date_created": "2012-02-03 23:09:20.921470+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/diablo\nReview: https://review.openstack.org/3836", 
            "date_created": "2012-02-07 01:59:51.362997+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/3836\nCommitted: http://github.com/openstack/nova/commit/d064c4460b8719ac3fda3d8e369fa5dc77ac6ec4\nSubmitter: Jenkins\nBranch:    stable/diablo\n\ncommit d064c4460b8719ac3fda3d8e369fa5dc77ac6ec4\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Thu Feb 2 10:59:43 2012 -0800\n\n    Provides flag override for vlan interface\n    \n    This means you can have your vlan_interface be different on\n    different hosts machines by setting vlan_interface differently\n    on each host.\n    \n     * Allow non-homogenous vlan networks\n     * Fixes bug 833426\n     * Includes failing test for linux_net\n    \n    (cherry picked from commit 8efe15209aaee6b15c8edb21362c08137294a7de)\n    \n    Resolved Conflicts:\n    \n    \tnova/tests/test_linux_net.py\n    \n    Change-Id: I68aa52e745318cedfbefb6fbac8187fceb1ae06b\n", 
            "date_created": "2012-02-07 10:11:10.623854+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-02-29 10:33:28.207064+00:00"
}