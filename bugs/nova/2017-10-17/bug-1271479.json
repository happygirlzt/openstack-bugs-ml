{
    "status": "Expired", 
    "last_updated": "2016-07-05 09:45:50.406137+00:00", 
    "description": "Hello\n\nwe have a openstack havana controller installation with 2 compute nodes  centos 6.4 /KVM \n\ni get 3 ide disk images from i need to build a vm by booting on the first one and attach the 2 others as volumes\n\nwhen i play the nova command line below the vm start well and volumes are attached\n\nnova boot --flavor vcdn_mn --key_name KEY_NAME --availability-zone nova:vcdn_kvm5 --image c5813703-2bfb-4f58-b0f1-9cd08fb8e596  --nic net-id=a2b8e7e4-cceb-4e5a-881b-8d872f6384db --nic net-id=d2292ebe-a431-4bd9-a5e4-570e2f98f169 --nic net-id=7368ec5a-3f9d-49af-a254-87a754f9b952 --block-device source=volume,dest=volume,id=8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42,bus=ide,shutdown=preserve --block-device source=volume,dest=volume,id=7379756e-e435-40ad-8f0c-de43b0adcac4,bus=ide,shutdown=preserve mn1.vxn1s1.cdn\n \nthe libvirt.xml disk device section looks like :\n\n <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/var/lib/nova/instances/a8a255cd-0b60-436d-ae71-e00f28e725bd/disk\"/>\n      <target bus=\"ide\" dev=\"hda\"/>\n    </disk>\n    <disk type=\"block\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source dev=\"/dev/disk/by-path/ip-192.168.60.23:3260-iscsi-iqn.2010-10.org.openstack:volume-8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42-lun-1\"/>\n      <target bus=\"ide\" dev=\"hdb\"/>\n      <serial>8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42</serial>\n    </disk>\n    <disk type=\"block\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source dev=\"/dev/disk/by-path/ip-192.168.60.23:3260-iscsi-iqn.2010-10.org.openstack:volume-7379756e-e435-40ad-8f0c-de43b0adcac4-lun-1\"/>\n      <target bus=\"ide\" dev=\"hdc\"/>\n      <serial>7379756e-e435-40ad-8f0c-de43b0adcac4</serial>\n    </disk>\n\nbut if i restart the vm from the dashboard  the libvirt.xml is modified and looks like, the target bus is changed from \"ide\" to virtio\" so the vm cant boot anymore because of partition table ... : \n\n <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/var/lib/nova/instances/a8a255cd-0b60-436d-ae71-e00f28e725bd/disk\"/>\n      <target bus=\"virtio\" dev=\"hda\"/>\n    </disk>\n    <disk type=\"block\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source dev=\"/dev/disk/by-path/ip-192.168.60.23:3260-iscsi-iqn.2010-10.org.openstack:volume-8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42-lun-1\"/>\n      <target bus=\"ide\" dev=\"hdb\"/>\n      <serial>8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42</serial>\n    </disk>\n    <disk type=\"block\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source dev=\"/dev/disk/by-path/ip-192.168.60.23:3260-iscsi-iqn.2010-10.org.openstack:volume-7379756e-e435-40ad-8f0c-de43b0adcac4-lun-1\"/>\n      <target bus=\"ide\" dev=\"hdc\"/>\n      <serial>7379756e-e435-40ad-8f0c-de43b0adcac4</serial>\n    </disk>\n\n\ni ve tried to set libvirt_disk_prefix=hd (even if it not seems possible value..) into /etc/nova/nova.conf\n\ni ve  set some metadata on boot disk image  => disk_bus, disk_dev, hw_disk_bus  without success\n\n+------------------------+--------------------------------------+\n| Property               | Value                                |\n+------------------------+--------------------------------------+\n| Property 'disk_bus'    | ide                                  |\n| Property 'disk_dev'    | hda                                  |\n| Property 'hw_disk_bus' | ide                                  |\n| checksum               | 29bd44d6edd8358d6b74967ab7eaf526     |\n| container_format       | bare                                 |\n| created_at             | 2014-01-21T12:41:29                  |\n| deleted                | False                                |\n| deleted_at             | None                                 |\n| disk_format            | qcow2                                |\n| id                     | c5813703-2bfb-4f58-b0f1-9cd08fb8e596 |\n| is_public              | True                                 |\n| min_disk               | 0                                    |\n| min_ram                | 0                                    |\n| name                   | vcdn_mn_img0                         |\n| owner                  | None                                 |\n| protected              | False                                |\n| size                   | 915537920                            |\n| status                 | active                               |\n| updated_at             | 2014-01-22T10:24:35                  |\n+------------------------+--------------------------------------+\n\ni ve tried some modification tests into /usr/lib/python2.6/site-packages/nova/virt/libvirt/blockinfo.py but without success\n\n\n\nthanks for your help \nKR\n\nPhilippe", 
    "tags": [
        "libvirt"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1271479", 
    "owner": "None", 
    "id": 1271479, 
    "index": 5765, 
    "openned": "2014-01-22 10:32:12.294322+00:00", 
    "created": "2014-01-22 10:32:12.294322+00:00", 
    "title": "ide disk type is not set when starting vm from dashboard", 
    "comments": [
        {
            "content": "Hello\n\nwe have a openstack havana controller installation with 2 compute nodes  centos 6.4 /KVM \n\ni get 3 ide disk images from i need to build a vm by booting on the first one and attach the 2 others as volumes\n\nwhen i play the nova command line below the vm start well and volumes are attached\n\nnova boot --flavor vcdn_mn --key_name KEY_NAME --availability-zone nova:vcdn_kvm5 --image c5813703-2bfb-4f58-b0f1-9cd08fb8e596  --nic net-id=a2b8e7e4-cceb-4e5a-881b-8d872f6384db --nic net-id=d2292ebe-a431-4bd9-a5e4-570e2f98f169 --nic net-id=7368ec5a-3f9d-49af-a254-87a754f9b952 --block-device source=volume,dest=volume,id=8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42,bus=ide,shutdown=preserve --block-device source=volume,dest=volume,id=7379756e-e435-40ad-8f0c-de43b0adcac4,bus=ide,shutdown=preserve mn1.vxn1s1.cdn\n \nthe libvirt.xml disk device section looks like :\n\n <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/var/lib/nova/instances/a8a255cd-0b60-436d-ae71-e00f28e725bd/disk\"/>\n      <target bus=\"ide\" dev=\"hda\"/>\n    </disk>\n    <disk type=\"block\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source dev=\"/dev/disk/by-path/ip-192.168.60.23:3260-iscsi-iqn.2010-10.org.openstack:volume-8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42-lun-1\"/>\n      <target bus=\"ide\" dev=\"hdb\"/>\n      <serial>8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42</serial>\n    </disk>\n    <disk type=\"block\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source dev=\"/dev/disk/by-path/ip-192.168.60.23:3260-iscsi-iqn.2010-10.org.openstack:volume-7379756e-e435-40ad-8f0c-de43b0adcac4-lun-1\"/>\n      <target bus=\"ide\" dev=\"hdc\"/>\n      <serial>7379756e-e435-40ad-8f0c-de43b0adcac4</serial>\n    </disk>\n\nbut if i restart the vm from the dashboard  the libvirt.xml is modified and looks like, the target bus is changed from \"ide\" to virtio\" so the vm cant boot anymore because of partition table ... : \n\n <disk type=\"file\" device=\"disk\">\n      <driver name=\"qemu\" type=\"qcow2\" cache=\"none\"/>\n      <source file=\"/var/lib/nova/instances/a8a255cd-0b60-436d-ae71-e00f28e725bd/disk\"/>\n      <target bus=\"virtio\" dev=\"hda\"/>\n    </disk>\n    <disk type=\"block\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source dev=\"/dev/disk/by-path/ip-192.168.60.23:3260-iscsi-iqn.2010-10.org.openstack:volume-8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42-lun-1\"/>\n      <target bus=\"ide\" dev=\"hdb\"/>\n      <serial>8d8a2e6d-9c7e-4905-b194-8a74b6ae6c42</serial>\n    </disk>\n    <disk type=\"block\" device=\"disk\">\n      <driver name=\"qemu\" type=\"raw\" cache=\"none\"/>\n      <source dev=\"/dev/disk/by-path/ip-192.168.60.23:3260-iscsi-iqn.2010-10.org.openstack:volume-7379756e-e435-40ad-8f0c-de43b0adcac4-lun-1\"/>\n      <target bus=\"ide\" dev=\"hdc\"/>\n      <serial>7379756e-e435-40ad-8f0c-de43b0adcac4</serial>\n    </disk>\n\n\ni ve tried to set libvirt_disk_prefix=hd (even if it not seems possible value..) into /etc/nova/nova.conf\n\ni ve  set some metadata on boot disk image  => disk_bus, disk_dev, hw_disk_bus  without success\n\n+------------------------+--------------------------------------+\n| Property               | Value                                |\n+------------------------+--------------------------------------+\n| Property 'disk_bus'    | ide                                  |\n| Property 'disk_dev'    | hda                                  |\n| Property 'hw_disk_bus' | ide                                  |\n| checksum               | 29bd44d6edd8358d6b74967ab7eaf526     |\n| container_format       | bare                                 |\n| created_at             | 2014-01-21T12:41:29                  |\n| deleted                | False                                |\n| deleted_at             | None                                 |\n| disk_format            | qcow2                                |\n| id                     | c5813703-2bfb-4f58-b0f1-9cd08fb8e596 |\n| is_public              | True                                 |\n| min_disk               | 0                                    |\n| min_ram                | 0                                    |\n| name                   | vcdn_mn_img0                         |\n| owner                  | None                                 |\n| protected              | False                                |\n| size                   | 915537920                            |\n| status                 | active                               |\n| updated_at             | 2014-01-22T10:24:35                  |\n+------------------------+--------------------------------------+\n\ni ve tried some modification tests into /usr/lib/python2.6/site-packages/nova/virt/libvirt/blockinfo.py but without success\n\n\n\nthanks for your help \nKR\n\nPhilippe", 
            "date_created": "2014-01-22 10:32:12.294322+00:00", 
            "author": "https://api.launchpad.net/1.0/~philippe-deshayes"
        }, 
        {
            "content": "Does this only happen when you restart the VM from the dashboard? what about if its restarted from the command line?", 
            "date_created": "2014-01-23 20:13:12.802420+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Hello\n\nthe command line  :  nova reboot mn1.vxn1s1.cd   work fine and  the libvirt.xml file is not updated\n\nthe case which fail is the \"hard reboot\" from dashboard  , a \"soft reboot\" is ok \n\nKR\n\nPhilippe", 
            "date_created": "2014-01-24 09:09:23.864407+00:00", 
            "author": "https://api.launchpad.net/1.0/~philippe-deshayes"
        }, 
        {
            "content": "Sorry \n\n the command line : nova reboot mn1.vxn1s1.cd   is a soft reboot\n\nbut \n\n \"nova reboot --hard mn1.vxn1s1.cd\"  command fails to restart the vm and in that case the libvirt.xml is modifed with the virtio target bus type .\n\nKR", 
            "date_created": "2014-01-24 09:12:47.174952+00:00", 
            "author": "https://api.launchpad.net/1.0/~philippe-deshayes"
        }, 
        {
            "content": "If I had to guess, I'd say it sounds like we're loosing the image metadata when restarting the guest, causing it to fallback to using the default disk bus, which is virtio.", 
            "date_created": "2014-11-19 13:59:03.149664+00:00", 
            "author": "https://api.launchpad.net/1.0/~berrange"
        }, 
        {
            "content": "Hi Philippe,\n\nCan you specify the command-line of Glance you used to upload the IDE img?\n\nIf possible, can you share your ide img so that I can also try here? ", 
            "date_created": "2015-02-09 10:31:38.446248+00:00", 
            "author": "https://api.launchpad.net/1.0/~trung-t-trinh"
        }, 
        {
            "content": "Hi all,\n\nI've tried re-producing this problem as follows:\n1.  Install OpenStack release of stable Juno with DevStack\n2.  Use Glance CLI to set the property of \"hw_disk_bus\" to \"ide\" for the image file \"Fedora\" which is available in Glance by default:\n          glance image-update --property hw_disk_bus=ide Fedora-x86_64-20-20140618-sda\n3. Make sure the setting is correct with:\n\nxtrutri@ubuntu:~/Work/devstack$ glance image-show Fedora-x86_64-20-20140618-sda\n+------------------------+--------------------------------------+\n| Property               | Value                                |\n+------------------------+--------------------------------------+\n| Property 'hw_disk_bus' | ide                                  |\n| checksum               | 9e486c3bf76219a6a37add392e425b36     |\n| container_format       | bare                                 |\n| created_at             | 2015-03-06T04:24:40                  |\n| deleted                | False                                |\n| disk_format            | qcow2                                |\n| id                     | 224029af-9ee1-4f0e-9842-8ba16a30a1af |\n| is_public              | True                                 |\n| min_disk               | 0                                    |\n| min_ram                | 0                                    |\n| name                   | Fedora-x86_64-20-20140618-sda        |\n| owner                  | 795d9a55f96d4d77adecd476b45cc3fd     |\n| protected              | False                                |\n| size                   | 209649664                            |\n| status                 | active                               |\n| updated_at             | 2015-03-12T08:18:46                  |\n+------------------------+--------------------------------------+\n\n4. Use OpenStack dashboard to launch a new VM from the modified image file of \"Fedora\". The process is successful.\n5. After that, try with \"soft-reboot\" and \"hard-reboot\". All are working fine.\n6. Finally, check the \"libvirt.xml\" file if the \"target bus\" is set to \"ide\" or not. The answer is YES\n\n\nSo, the question is if this problem can be prevented if the image file in Glance is set to \"target bus\" of \"ide\" by Glance?\nOr, can you please provide me the buggy image file so that I can try locally here?\n", 
            "date_created": "2015-03-12 08:44:57.032486+00:00", 
            "author": "https://api.launchpad.net/1.0/~trung-t-trinh"
        }, 
        {
            "content": "Can  someone feedback? \nThanks", 
            "date_created": "2015-04-10 04:02:18.061874+00:00", 
            "author": "https://api.launchpad.net/1.0/~trung-t-trinh"
        }, 
        {
            "content": "Can we set this bug to \"Invalid\" or \"Incomplete\" because it can't be re-produced with my workflow mentioned above?", 
            "date_created": "2015-04-24 06:21:20.515741+00:00", 
            "author": "https://api.launchpad.net/1.0/~trung-t-trinh"
        }, 
        {
            "content": "\nThis is an automated cleanup. This bug report has been closed because it\nis older than 18 months and there is no open code change to fix this.\nAfter this time it is unlikely that the circumstances which lead to\nthe observed issue can be reproduced.\n\nIf you can reproduce the bug, please:\n* reopen the bug report (set to status \"New\")\n* AND add the detailed steps to reproduce the issue (if applicable)\n* AND leave a comment \"CONFIRMED FOR: <RELEASE_NAME>\"\n  Only still supported release names are valid (LIBERTY, MITAKA, OCATA, NEWTON).\n  Valid example: CONFIRMED FOR: LIBERTY\n", 
            "date_created": "2016-07-05 09:45:49.966128+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ], 
    "closed": "2016-07-05 09:45:47.221994+00:00"
}