{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:16:36.317564+00:00", 
    "description": "When booting from volume with a config drive, libvirt fails to instantiate because the disk.config is never created in the instance directory.  This was recently broken.\n\nThis could be related to bug 984996 (instance directory not created) but I'm not sure\n\nI boot a VM from volume using this:\n\nnova boot --config-drive=true --block-device-mapping vda=<VOLUME ID HERE>:::0 --flavor=1 --nic net-id=38278b90-9f80-44ec-b2a5-dac6a7066a5e autoBFV\n\nThis will generate the following error:\n\n2013-02-13 14:29:20.831 DEBUG nova.utils [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Result was 0 execute /usr/lib/python2.7/dist-packages/nova/utils.py:231\n2013-02-13 14:29:20.833 DEBUG nova.utils [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/dist-packages/nova/utils.py:207\n2013-02-13 14:29:20.909 DEBUG nova.utils [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Result was 0 execute /usr/lib/python2.7/dist-packages/nova/utils.py:231\n2013-02-13 14:29:20.910 DEBUG nova.network.linux_net [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] IPTablesManager.apply completed with success _apply /usr/lib/python2.7/dist-packages/nova/network/linux_net.py:391\n2013-02-13 14:29:20.911 DEBUG nova.openstack.common.lockutils [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Released file lock \"iptables\" at /var/lock/nova/nova-iptables for method \"_apply\"... inner /usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py:235\n2013-02-13 14:29:22.607 ERROR nova.compute.manager [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6] Instance failed to spawn\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6] Traceback (most recent call last):\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 985, in _spawn\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     block_device_info)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1205, in spawn\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     block_device_info)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2087, in _create_domain_and_network\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     domain = self._create_domain(xml, instance=instance)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2048, in _create_domain\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     domain.createWithFlags(launch_flags)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 187, in doit\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 147, in proxy_call\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     rv = execute(f,*args,**kwargs)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 76, in tworker\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     rv = meth(*args,**kwargs)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 650, in createWithFlags\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6] libvirtError: Unable to allow access for disk path /var/lib/nova/instances/instance-0000002d/disk.config: No such file or directory", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1124441", 
    "owner": "https://api.launchpad.net/1.0/~ndipanov", 
    "id": 1124441, 
    "index": 965, 
    "openned": "2013-02-13 19:35:13.469123+00:00", 
    "created": "2013-02-13 19:35:13.469123+00:00", 
    "title": "config drive not created when booting from volume", 
    "comments": [
        {
            "content": "When booting from volume with a config drive, libvirt fails to instantiate because the disk.config is never created in the instance directory.  This was recently broken.\n\nThis could be related to bug 984996 (instance directory not created) but I'm not sure\n\nI boot a VM from volume using this:\n\nnova boot --config-drive=true --block-device-mapping vda=<VOLUME ID HERE>:::0 --flavor=1 --nic net-id=38278b90-9f80-44ec-b2a5-dac6a7066a5e autoBFV\n\nThis will generate the following error:\n\n2013-02-13 14:29:20.831 DEBUG nova.utils [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Result was 0 execute /usr/lib/python2.7/dist-packages/nova/utils.py:231\n2013-02-13 14:29:20.833 DEBUG nova.utils [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf iptables-restore -c execute /usr/lib/python2.7/dist-packages/nova/utils.py:207\n2013-02-13 14:29:20.909 DEBUG nova.utils [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Result was 0 execute /usr/lib/python2.7/dist-packages/nova/utils.py:231\n2013-02-13 14:29:20.910 DEBUG nova.network.linux_net [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] IPTablesManager.apply completed with success _apply /usr/lib/python2.7/dist-packages/nova/network/linux_net.py:391\n2013-02-13 14:29:20.911 DEBUG nova.openstack.common.lockutils [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] Released file lock \"iptables\" at /var/lock/nova/nova-iptables for method \"_apply\"... inner /usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py:235\n2013-02-13 14:29:22.607 ERROR nova.compute.manager [req-ab6b48d5-c2e6-43c4-970c-f65b16acfda5 8636766bc6b342539a9c1b0e3e0c24cc 24e6c25ee7bf4f5bbcd19c53bbe84f37] [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6] Instance failed to spawn\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6] Traceback (most recent call last):\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 985, in _spawn\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     block_device_info)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1205, in spawn\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     block_device_info)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2087, in _create_domain_and_network\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     domain = self._create_domain(xml, instance=instance)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2048, in _create_domain\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     domain.createWithFlags(launch_flags)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 187, in doit\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 147, in proxy_call\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     rv = execute(f,*args,**kwargs)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 76, in tworker\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     rv = meth(*args,**kwargs)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 650, in createWithFlags\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2013-02-13 14:29:22.607 3204 TRACE nova.compute.manager [instance: ab87f0d0-15bf-4c23-b504-227ba274b5e6] libvirtError: Unable to allow access for disk path /var/lib/nova/instances/instance-0000002d/disk.config: No such file or directory", 
            "date_created": "2013-02-13 19:35:13.469123+00:00", 
            "author": "https://api.launchpad.net/1.0/~boris-michel-deschenes"
        }, 
        {
            "content": "This is definitely related to bug 1131913, the problem is the libvirt driver not calling the _create_image function when booting from volume (because there is no image metadata).\n\nCould you link this bug with 1131913 please", 
            "date_created": "2013-02-26 13:41:15.964722+00:00", 
            "author": "https://api.launchpad.net/1.0/~boris-michel-deschenes"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/23818", 
            "date_created": "2013-03-07 15:15:44.070332+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/23818\nCommitted: http://github.com/openstack/nova/commit/3133096f2bf2c8de04c70c3f3209d727a4c8cfb3\nSubmitter: Jenkins\nBranch:    master\n\ncommit 3133096f2bf2c8de04c70c3f3209d727a4c8cfb3\nAuthor: Nikola Dipanov <email address hidden>\nDate:   Thu Mar 7 15:54:07 2013 +0100\n\n    Libvirt driver create images even without meta\n    \n    This patch allows the libvirt driver to call _create_image and\n    create instance directory and other needed images even when there is no\n    image metadata specified.\n    \n    As an added bonus, this patch refactors the code of _create_image\n    method a bit to make it more clear to the reader when some of the images\n    will and will not be created, especially with regard to booting from\n    volume.\n    \n    Fixes bug: 1124441\n    Fixes bug: 1131913\n    Fixes bug: 1123274\n    \n    blueprint: improve-boot-from-volume\n    \n    Change-Id: I5a028dc0585876d35be4fb86df3a423d89e054ee\n", 
            "date_created": "2013-03-11 17:35:01.430161+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-03-20 16:05:39.494225+00:00"
}