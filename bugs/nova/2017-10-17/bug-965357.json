{
    "status": "Invalid", 
    "last_updated": "2012-03-26 21:13:12.185831+00:00", 
    "description": "I've installed this version of nova-compute:\n\n\nii  nova-compute                      2012.1~rc1~20120316.13416-0ubuntu1       OpenStack Compute - compute node\n\n\nFurthermore, I'm using tgt, as specified in nova.conf:\n[...]\n--iscsi_helper=tgtadm\n[...]\n\nTrying to attach a volume to a VM fails with a bug very similar to https://bugs.launchpad.net/ubuntu/+source/nova/+bug/871278 ... here's what I see in nova-compute.log:\n\n\n2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--login',): stdout=Logging in to [iface: default, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\nLogin to [iface: default, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]: successful\n stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:06 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --op update -n node.startup -v automatic from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--op', 'update', '-n', 'node.startup', '-v', 'automatic'): stdout= stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:06 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 0\n2012-03-25 13:53:06 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:07 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 1\n2012-03-25 13:53:07 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-03-25 13:53:07 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:11 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 2\n2012-03-25 13:53:11 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-03-25 13:53:11 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:20 ERROR nova.compute.manager [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] [instance: f537dc16-5df3-4d0f-9c3f-81ac3310eaeb] Attach failed /dev/vdb, removing\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1704, in attach_volume\n(nova.compute.manager): TRACE:     mountpoint)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n(nova.compute.manager): TRACE:     return f(*args, **kw)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 545, in attach_volume\n(nova.compute.manager): TRACE:     mount_device)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 537, in volume_driver_method\n(nova.compute.manager): TRACE:     return method(connection_info, *args, **kwargs)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 905, in inner\n(nova.compute.manager): TRACE:     retval = f(*args, **kwargs)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py\", line 154, in connect_volume\n(nova.compute.manager): TRACE:     (host_device))\n(nova.compute.manager): TRACE: Error: iSCSI device not found at /dev/disk/by-path/ip-10.42.0.6:3260-iscsi-iqn.2010-10.org.openstack:volume-00000002-lun-0\n\nI'll be happy to supply more information upon request :)", 
    "tags": [
        "essex-rc-potential"
    ], 
    "importance": "Critical", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/965357", 
    "owner": "None", 
    "id": 965357, 
    "index": 55, 
    "openned": "2012-03-26 14:41:50.016501+00:00", 
    "created": "2012-03-26 14:41:50.016501+00:00", 
    "title": "nova-compute fails to attach volumes to VMs when using tgt (lun-0 vs. lun-1)", 
    "comments": [
        {
            "content": "I've installed this version of nova-compute:\n\n\nii  nova-compute                      2012.1~rc1~20120316.13416-0ubuntu1       OpenStack Compute - compute node\n\n\nFurthermore, I'm using tgt, as specified in nova.conf:\n[...]\n--iscsi_helper=tgtadm\n[...]\n\nTrying to attach a volume to a VM fails with a bug very similar to https://bugs.launchpad.net/ubuntu/+source/nova/+bug/871278 ... here's what I see in nova-compute.log:\n\n\n2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--login',): stdout=Logging in to [iface: default, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\nLogin to [iface: default, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]: successful\n stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:06 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --op update -n node.startup -v automatic from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--op', 'update', '-n', 'node.startup', '-v', 'automatic'): stdout= stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:06 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 0\n2012-03-25 13:53:06 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:07 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 1\n2012-03-25 13:53:07 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-03-25 13:53:07 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:11 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 2\n2012-03-25 13:53:11 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-03-25 13:53:11 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n2012-03-25 13:53:20 ERROR nova.compute.manager [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] [instance: f537dc16-5df3-4d0f-9c3f-81ac3310eaeb] Attach failed /dev/vdb, removing\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1704, in attach_volume\n(nova.compute.manager): TRACE:     mountpoint)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n(nova.compute.manager): TRACE:     return f(*args, **kw)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 545, in attach_volume\n(nova.compute.manager): TRACE:     mount_device)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 537, in volume_driver_method\n(nova.compute.manager): TRACE:     return method(connection_info, *args, **kwargs)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 905, in inner\n(nova.compute.manager): TRACE:     retval = f(*args, **kwargs)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py\", line 154, in connect_volume\n(nova.compute.manager): TRACE:     (host_device))\n(nova.compute.manager): TRACE: Error: iSCSI device not found at /dev/disk/by-path/ip-10.42.0.6:3260-iscsi-iqn.2010-10.org.openstack:volume-00000002-lun-0\n\nI'll be happy to supply more information upon request :)", 
            "date_created": "2012-03-26 14:41:50.016501+00:00", 
            "author": "https://api.launchpad.net/1.0/~martin-loschwitz"
        }, 
        {
            "content": "This was originally fixed in bug 871278, but since then the file evolved significantly. Maybe the new logic introduced at commit 509e5ad9 has introduced a regression ?\n\nhttps://github.com/openstack/nova/commit/509e5ad9ef6ed38caa69d2c76b1adccedcdd315e", 
            "date_created": "2012-03-26 14:48:52.813846+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Is the same iscsi flag set on nova-volume?  Was it set when the volume was created?  I suspect that it was created without the flag set and so it was assigned lun-0.\n\nVish\n\nOn Mar 26, 2012, at 7:41 AM, Martin Gerhard Loschwitz wrote:\n\n> Public bug reported:\n> \n> I've installed this version of nova-compute:\n> \n> \n> ii  nova-compute                      2012.1~rc1~20120316.13416-0ubuntu1       OpenStack Compute - compute node\n> \n> \n> Furthermore, I'm using tgt, as specified in nova.conf:\n> [...]\n> --iscsi_helper=tgtadm\n> [...]\n> \n> Trying to attach a volume to a VM fails with a bug very similar to\n> https://bugs.launchpad.net/ubuntu/+source/nova/+bug/871278 ... here's\n> what I see in nova-compute.log:\n> \n> \n> 2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--login',): stdout=Logging in to [iface: default, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n> Login to [iface: default, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]: successful\n> stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n> 2012-03-25 13:53:06 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --op update -n node.startup -v automatic from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n> 2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--op', 'update', '-n', 'node.startup', '-v', 'automatic'): stdout= stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n> 2012-03-25 13:53:06 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 0\n> 2012-03-25 13:53:06 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n> 2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n> stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n> 2012-03-25 13:53:07 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 1\n> 2012-03-25 13:53:07 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n> 2012-03-25 13:53:07 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n> stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n> 2012-03-25 13:53:11 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 2\n> 2012-03-25 13:53:11 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n> 2012-03-25 13:53:11 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n> stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n> 2012-03-25 13:53:20 ERROR nova.compute.manager [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] [instance: f537dc16-5df3-4d0f-9c3f-81ac3310eaeb] Attach failed /dev/vdb, removing\n> (nova.compute.manager): TRACE: Traceback (most recent call last):\n> (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1704, in attach_volume\n> (nova.compute.manager): TRACE:     mountpoint)\n> (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n> (nova.compute.manager): TRACE:     return f(*args, **kw)\n> (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 545, in attach_volume\n> (nova.compute.manager): TRACE:     mount_device)\n> (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 537, in volume_driver_method\n> (nova.compute.manager): TRACE:     return method(connection_info, *args, **kwargs)\n> (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 905, in inner\n> (nova.compute.manager): TRACE:     retval = f(*args, **kwargs)\n> (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py\", line 154, in connect_volume\n> (nova.compute.manager): TRACE:     (host_device))\n> (nova.compute.manager): TRACE: Error: iSCSI device not found at /dev/disk/by-path/ip-10.42.0.6:3260-iscsi-iqn.2010-10.org.openstack:volume-00000002-lun-0\n> \n> I'll be happy to supply more information upon request :)\n> \n> ** Affects: nova\n>     Importance: Critical\n>         Status: New\n> \n> \n> ** Tags: essex-rc-potential\n> \n> -- \n> You received this bug notification because you are subscribed to\n> OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/965357\n> \n> Title:\n>  nova-compute fails to attach volumes to VMs when using tgt (lun-0 vs.\n>  lun-1)\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  I've installed this version of nova-compute:\n> \n> \n>  ii  nova-compute                      2012.1~rc1~20120316.13416-0ubuntu1       OpenStack Compute - compute node\n> \n> \n>  Furthermore, I'm using tgt, as specified in nova.conf:\n>  [...]\n>  --iscsi_helper=tgtadm\n>  [...]\n> \n>  Trying to attach a volume to a VM fails with a bug very similar to\n>  https://bugs.launchpad.net/ubuntu/+source/nova/+bug/871278 ... here's\n>  what I see in nova-compute.log:\n> \n> \n>  2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--login',): stdout=Logging in to [iface: default, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n>  Login to [iface: default, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]: successful\n>   stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n>  2012-03-25 13:53:06 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --op update -n node.startup -v automatic from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n>  2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--op', 'update', '-n', 'node.startup', '-v', 'automatic'): stdout= stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n>  2012-03-25 13:53:06 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 0\n>  2012-03-25 13:53:06 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n>  2012-03-25 13:53:06 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n>   stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n>  2012-03-25 13:53:07 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 1\n>  2012-03-25 13:53:07 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n>  2012-03-25 13:53:07 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n>   stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n>  2012-03-25 13:53:11 WARNING nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] ISCSI volume not yet found at: vdb. Will rescan & retry.  Try number: 2\n>  2012-03-25 13:53:11 DEBUG nova.utils [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] Running cmd (subprocess): sudo iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000002 -p 10.42.0.6:3260 --rescan from (pid=650) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n>  2012-03-25 13:53:11 DEBUG nova.virt.libvirt.volume [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] iscsiadm ('--rescan',): stdout=Rescanning session [sid: 5, target: iqn.2010-10.org.openstack:volume-00000002, portal: 10.42.0.6,3260]\n>   stderr= from (pid=650) _run_iscsiadm /usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py:98\n>  2012-03-25 13:53:20 ERROR nova.compute.manager [req-06900c40-7127-4a00-844c-65f8aca738ea b78954494dad48a99dd79b33be0b3d92 dd074310cca745fd8925646e2431a622] [instance: f537dc16-5df3-4d0f-9c3f-81ac3310eaeb] Attach failed /dev/vdb, removing\n>  (nova.compute.manager): TRACE: Traceback (most recent call last):\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1704, in attach_volume\n>  (nova.compute.manager): TRACE:     mountpoint)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n>  (nova.compute.manager): TRACE:     return f(*args, **kw)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 545, in attach_volume\n>  (nova.compute.manager): TRACE:     mount_device)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 537, in volume_driver_method\n>  (nova.compute.manager): TRACE:     return method(connection_info, *args, **kwargs)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 905, in inner\n>  (nova.compute.manager): TRACE:     retval = f(*args, **kwargs)\n>  (nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/volume.py\", line 154, in connect_volume\n>  (nova.compute.manager): TRACE:     (host_device))\n>  (nova.compute.manager): TRACE: Error: iSCSI device not found at /dev/disk/by-path/ip-10.42.0.6:3260-iscsi-iqn.2010-10.org.openstack:volume-00000002-lun-0\n> \n>  I'll be happy to supply more information upon request :)\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/965357/+subscriptions\n\n", 
            "date_created": "2012-03-26 17:24:25+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Good catch there. I started off with a completely new nova database in MySQL and created the volume with the option in place in nova.conf and it appears to just work. I must have gotten in a rot somewhere in the process of writing up the documentation ... I suggest we mark this bug as invalid :)\n\nThanks a lot for finding out!\n\nBest regards\nMartin", 
            "date_created": "2012-03-26 20:56:11.988587+00:00", 
            "author": "https://api.launchpad.net/1.0/~martin-loschwitz"
        }
    ], 
    "closed": "2012-03-26 21:13:10.119801+00:00"
}