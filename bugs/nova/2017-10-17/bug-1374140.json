{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:59:39.055210+00:00", 
    "description": "This is not really useful:\n\nhttp://logs.openstack.org/17/123917/2/check/check-tempest-dsvm-neutron/4bc2052/logs/screen-n-cpu.txt.gz?level=TRACE#_2014-09-25_17_35_11_635\n\n2014-09-25 17:35:11.635 ERROR nova.virt.libvirt.driver [req-50afcbfb-203e-454d-a7eb-1549691caf77 TestNetworkBasicOps-985093118 TestNetworkBasicOps-1055683132] [instance: 960ee0b1-9c96-4d5b-b5f5-be76ae19a536] detaching network adapter failed.\n2014-09-25 17:35:11.635 27689 ERROR oslo.messaging.rpc.dispatcher [-] Exception during message handling: <nova.objects.instance.Instance object at 0x422fe90>\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 133, in _dispatch_and_reply\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 176, in _dispatch\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 122, in _do_dispatch\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 393, in decorated_function\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 4411, in detach_interface\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     self.driver.detach_interface(instance, condemned)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1448, in detach_interface\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     raise exception.InterfaceDetachFailed(instance)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher InterfaceDetachFailed: <nova.objects.instance.Instance object at 0x422fe90>\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher \n\n\nThe code is logging that there was an error, but not the error itself:\n\n        try:\n            self.vif_driver.unplug(instance, vif)\n            flags = libvirt.VIR_DOMAIN_AFFECT_CONFIG\n            state = LIBVIRT_POWER_STATE[virt_dom.info()[0]]\n            if state == power_state.RUNNING or state == power_state.PAUSED:\n                flags |= libvirt.VIR_DOMAIN_AFFECT_LIVE\n            virt_dom.detachDeviceFlags(cfg.to_xml(), flags)\n        except libvirt.libvirtError as ex:\n            error_code = ex.get_error_code()\n            if error_code == libvirt.VIR_ERR_NO_DOMAIN:\n                LOG.warn(_LW(\"During detach_interface, \"\n                             \"instance disappeared.\"),\n                         instance=instance)\n            else:\n                LOG.error(_LE('detaching network adapter failed.'),\n                         instance=instance)\n                raise exception.InterfaceDetachFailed(\n                        instance_uuid=instance['uuid'])\n\nWe should log the original libvirt error.", 
    "tags": [
        "icehouse-backport-potential", 
        "libvirt", 
        "logging"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1374140", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1374140, 
    "index": 4058, 
    "openned": "2014-09-25 20:39:05.016011+00:00", 
    "created": "2014-09-25 20:39:05.016011+00:00", 
    "title": "Need to log the orignial libvirtError when InterfaceDetachFailed", 
    "comments": [
        {
            "content": "This is not really useful:\n\nhttp://logs.openstack.org/17/123917/2/check/check-tempest-dsvm-neutron/4bc2052/logs/screen-n-cpu.txt.gz?level=TRACE#_2014-09-25_17_35_11_635\n\n2014-09-25 17:35:11.635 ERROR nova.virt.libvirt.driver [req-50afcbfb-203e-454d-a7eb-1549691caf77 TestNetworkBasicOps-985093118 TestNetworkBasicOps-1055683132] [instance: 960ee0b1-9c96-4d5b-b5f5-be76ae19a536] detaching network adapter failed.\n2014-09-25 17:35:11.635 27689 ERROR oslo.messaging.rpc.dispatcher [-] Exception during message handling: <nova.objects.instance.Instance object at 0x422fe90>\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 133, in _dispatch_and_reply\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 176, in _dispatch\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 122, in _do_dispatch\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 393, in decorated_function\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 4411, in detach_interface\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     self.driver.detach_interface(instance, condemned)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 1448, in detach_interface\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher     raise exception.InterfaceDetachFailed(instance)\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher InterfaceDetachFailed: <nova.objects.instance.Instance object at 0x422fe90>\n2014-09-25 17:35:11.635 27689 TRACE oslo.messaging.rpc.dispatcher \n\n\nThe code is logging that there was an error, but not the error itself:\n\n        try:\n            self.vif_driver.unplug(instance, vif)\n            flags = libvirt.VIR_DOMAIN_AFFECT_CONFIG\n            state = LIBVIRT_POWER_STATE[virt_dom.info()[0]]\n            if state == power_state.RUNNING or state == power_state.PAUSED:\n                flags |= libvirt.VIR_DOMAIN_AFFECT_LIVE\n            virt_dom.detachDeviceFlags(cfg.to_xml(), flags)\n        except libvirt.libvirtError as ex:\n            error_code = ex.get_error_code()\n            if error_code == libvirt.VIR_ERR_NO_DOMAIN:\n                LOG.warn(_LW(\"During detach_interface, \"\n                             \"instance disappeared.\"),\n                         instance=instance)\n            else:\n                LOG.error(_LE('detaching network adapter failed.'),\n                         instance=instance)\n                raise exception.InterfaceDetachFailed(\n                        instance_uuid=instance['uuid'])\n\nWe should log the original libvirt error.", 
            "date_created": "2014-09-25 20:39:05.016011+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/124178", 
            "date_created": "2014-09-25 20:47:22.420740+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Tagging for Icehouse as well since I hit this in an Icehouse Jenkins run.", 
            "date_created": "2014-09-25 20:48:18.537622+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "This is the actual libvirt error:\n\nhttp://logs.openstack.org/17/123917/2/check/check-tempest-dsvm-neutron/4bc2052/logs/libvirtd.txt.gz#_2014-09-25_17_35_10_340\n\n2014-09-25 17:35:10.340+0000: 15824: error : qemuMonitorIORead:513 : Unable to read from monitor: Connection reset by peer\n\nWhich is bug 1349617 I think.", 
            "date_created": "2014-09-25 20:50:54.621949+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/124178\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=1af3ca69c250f8cd2f8e60ed596ad2df30353713\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1af3ca69c250f8cd2f8e60ed596ad2df30353713\nAuthor: Matt Riedemann <email address hidden>\nDate:   Thu Sep 25 13:44:46 2014 -0700\n\n    libvirt: log exception info when interface detach failed\n    \n    The detach_interface method is catching a libvirtError and logging an\n    error message but it doesn't include the contents of the root\n    libvirtError, so log that information as well for debugging.\n    \n    Closes-Bug: #1374140\n    \n    Change-Id: I042c2956c7393a2ee1ccd026421c8df537aa1a87\n", 
            "date_created": "2014-09-29 23:10:58.988815+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-10-01 07:45:04.976314+00:00"
}