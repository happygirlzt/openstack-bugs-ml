{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:39:32.208939+00:00", 
    "description": "When default_ephemeral_format option is set to ext4, called mkfs.ext4 on non-block device is interactive. Therefore creation of ephemeral volume fails.\nFix is simple - add parameter -F to mkfs.ext4 to force action on non-block device.\n\nPatch is attached.\n\nFull traceback:\n\n2012-06-05 15:42:21 ERROR nova.rpc.amqp [req-d2d175eb-06fc-430b-9c21-b9a881993487 3dd66ac7dbc640ef975c53583821858b f602ad74a59947e79db3ddc4b3106279] Exception during message handling\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 253, in _process_data\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 183, in decorated_function\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     sys.exc_info())\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 177, in decorated_function\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 657, in run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     do_run_instance()\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/utils.py\", line 946, in inner\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     retval = f(*args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 656, in do_run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._run_instance(context, instance_uuid, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 457, in _run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._set_instance_error_state(context, instance_uuid)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 438, in _run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._deallocate_network(context, instance)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 435, in _run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     injected_files, admin_password)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 598, in _spawn\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._legacy_nw_info(network_info), block_device_info)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 928, in spawn\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     block_device_info=block_device_info)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1262, in _create_image\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     ephemeral_size=ephemeral_gb)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1117, in _cache_image\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     call_if_not_exists(base, fn, *args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/utils.py\", line 946, in inner\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     retval = f(*args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1114, in call_if_not_exists\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     fn(target=base, *args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1159, in _create_ephemeral\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._create_local(target, ephemeral_size)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1156, in _create_local\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     libvirt_utils.mkfs(fs_format, target, label)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/utils.py\", line 142, in mkfs\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     execute(*args)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/utils.py\", line 35, in execute\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     return utils.execute(*args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n2012-06-05 15:42:21 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Command: mkfs -t ext4 -FF /var/lib/nova/instances/_base/ephemeral_0_20_None\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Exit code: 1\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Stdout: ''\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Stderr: 'mke2fs 1.41.12 (17-May-2010)\\nmkfs.ext4: \\xc5\\xa1patn\\xc3\\xbd po\\xc4\\x8det blok\\xc5\\xaf\\xc2\\xa0- /var/lib/nova/instances/_base/ephemeral_0_20_None\\n'", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1009041", 
    "owner": "https://api.launchpad.net/1.0/~heut2008", 
    "id": 1009041, 
    "index": 4129, 
    "openned": "2012-06-05 14:23:53.212061+00:00", 
    "created": "2012-06-05 14:23:53.212061+00:00", 
    "title": "Creation of ext4 formatted ephemeral fails", 
    "comments": [
        {
            "content": "When default_ephemeral_format option is set to ext4, called mkfs.ext4 on non-block device is interactive. Therefore creation of ephemeral volume fails.\nFix is simple - add parameter -F to mkfs.ext4 to force action on non-block device.\n\nPatch is attached.\n\nFull traceback:\n\n2012-06-05 15:42:21 ERROR nova.rpc.amqp [req-d2d175eb-06fc-430b-9c21-b9a881993487 3dd66ac7dbc640ef975c53583821858b f602ad74a59947e79db3ddc4b3106279] Exception during message handling\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 253, in _process_data\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 183, in decorated_function\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     sys.exc_info())\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 177, in decorated_function\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 657, in run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     do_run_instance()\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/utils.py\", line 946, in inner\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     retval = f(*args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 656, in do_run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._run_instance(context, instance_uuid, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 457, in _run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._set_instance_error_state(context, instance_uuid)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 438, in _run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._deallocate_network(context, instance)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 435, in _run_instance\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     injected_files, admin_password)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/compute/manager.py\", line 598, in _spawn\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._legacy_nw_info(network_info), block_device_info)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 928, in spawn\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     block_device_info=block_device_info)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1262, in _create_image\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     ephemeral_size=ephemeral_gb)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1117, in _cache_image\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     call_if_not_exists(base, fn, *args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/utils.py\", line 946, in inner\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     retval = f(*args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1114, in call_if_not_exists\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     fn(target=base, *args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1159, in _create_ephemeral\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     self._create_local(target, ephemeral_size)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1156, in _create_local\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     libvirt_utils.mkfs(fs_format, target, label)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/utils.py\", line 142, in mkfs\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     execute(*args)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/virt/libvirt/utils.py\", line 35, in execute\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     return utils.execute(*args, **kwargs)\n2012-06-05 15:42:21 TRACE nova.rpc.amqp   File \"/opt/common-python/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n2012-06-05 15:42:21 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n2012-06-05 15:42:21 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Command: mkfs -t ext4 -FF /var/lib/nova/instances/_base/ephemeral_0_20_None\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Exit code: 1\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Stdout: ''\n2012-06-05 15:42:21 TRACE nova.rpc.amqp Stderr: 'mke2fs 1.41.12 (17-May-2010)\\nmkfs.ext4: \\xc5\\xa1patn\\xc3\\xbd po\\xc4\\x8det blok\\xc5\\xaf\\xc2\\xa0- /var/lib/nova/instances/_base/ephemeral_0_20_None\\n'", 
            "date_created": "2012-06-05 14:23:53.212061+00:00", 
            "author": "https://api.launchpad.net/1.0/~filip-pytloun"
        }, 
        {
            "content": "", 
            "date_created": "2012-06-05 14:23:53.212061+00:00", 
            "author": "https://api.launchpad.net/1.0/~filip-pytloun"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/8187", 
            "date_created": "2012-06-05 16:29:55.072662+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/8187\nCommitted: http://github.com/openstack/nova/commit/05130daeaa490070c52499c9fac26dd16c38074d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 05130daeaa490070c52499c9fac26dd16c38074d\nAuthor: yaguang tang <email address hidden>\nDate:   Wed Jun 6 00:26:17 2012 +0800\n\n    fix bug lp:1009041,add option \"-F\" to make mkfs non-interactive.\n    \n    Change-Id: Ic8be1657dbad0cd91fdb5176f17f7b1ba034c2e0\n", 
            "date_created": "2012-06-05 18:45:29.817800+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Just one note: I have no idea why, but creating default ext3 ephemeral works also without this fix, but it shouldn't because mkfs.ext3 has the same parameters and behavior as mkfs.ext4.", 
            "date_created": "2012-06-05 19:30:59.937362+00:00", 
            "author": "https://api.launchpad.net/1.0/~filip-pytloun"
        }
    ], 
    "closed": "2012-07-04 08:31:38.493474+00:00"
}