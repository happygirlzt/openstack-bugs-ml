{
    "status": "Fix Released", 
    "last_updated": "2016-12-07 10:45:38.353313+00:00", 
    "description": "We tried to add some negative test case to Tempest for the other bug.\nHowever, Nova still returns HTTP500 error if attaching the already attached volume like:\n\nhttp://logs.openstack.org/83/382083/12/check/gate-tempest-dsvm-neutron-full-ubuntu-xenial/66f700f/logs/screen-n-api.txt.gz#_2016-10-11_19_28_54_097\n\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions [req-3a860748-ab8f-4ce7-8412-90f787dd151d tempest-AttachVolumeNegativeTest-1404533522 tempest-AttachVolumeNegativeTest-1404533522] Unexpected exception in API method\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/volumes.py\", line 325, in create\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     volume_id, device)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 164, in inner\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return function(self, context, instance, *args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 145, in inner\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return f(self, context, instance, *args, **kw)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 3481, in attach_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     disk_bus, device_type)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 3424, in _attach_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     volume_bdm.destroy()\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     self.force_reraise()\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 3420, in _attach_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     self._check_attach_and_reserve_volume(context, volume_id, instance)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 3407, in _check_attach_and_reserve_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     self.volume_api.reserve_volume(context, volume_id)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 196, in wrapper\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     _reraise(exception.InvalidInput(reason=err_msg))\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 246, in _reraise\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     six.reraise(type(desired_exc), desired_exc, sys.exc_info()[2])\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 188, in wrapper\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     res = method(self, ctx, *args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 210, in wrapper\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     res = method(self, ctx, volume_id, *args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 327, in reserve_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     cinderclient(context).volumes.reserve(volume_id)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/v3/volumes.py\", line 383, in reserve\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return self._action('os-reserve', volume)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/v3/volumes.py\", line 346, in _action\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     resp, body = self.api.client.post(url, body=body)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 146, in post\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return self._cs_request(url, 'POST', **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 134, in _cs_request\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return self.request(url, method, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 123, in request\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     raise exceptions.from_response(resp, body)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions InvalidInput: Invalid input received: Invalid volume: Volume status must be available to reserve. (HTTP 400) (Request-ID: req-1af67f41-54a7-4539-89f2-c08d45184153)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1632513", 
    "owner": "https://api.launchpad.net/1.0/~oomichi", 
    "id": 1632513, 
    "index": 4647, 
    "openned": "2016-10-11 23:34:30.788690+00:00", 
    "created": "2016-10-11 23:34:30.788690+00:00", 
    "title": "Nova returns HTTP500 if attaching the attached volume", 
    "comments": [
        {
            "content": "We tried to add some negative test case to Tempest for the other bug.\nHowever, Nova still returns HTTP500 error if attaching the already attached volume like:\n\nhttp://logs.openstack.org/83/382083/12/check/gate-tempest-dsvm-neutron-full-ubuntu-xenial/66f700f/logs/screen-n-api.txt.gz#_2016-10-11_19_28_54_097\n\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions [req-3a860748-ab8f-4ce7-8412-90f787dd151d tempest-AttachVolumeNegativeTest-1404533522 tempest-AttachVolumeNegativeTest-1404533522] Unexpected exception in API method\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/extensions.py\", line 338, in wrapped\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/validation/__init__.py\", line 73, in wrapper\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/api/openstack/compute/volumes.py\", line 325, in create\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     volume_id, device)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 164, in inner\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return function(self, context, instance, *args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 145, in inner\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return f(self, context, instance, *args, **kw)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 3481, in attach_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     disk_bus, device_type)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 3424, in _attach_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     volume_bdm.destroy()\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     self.force_reraise()\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 3420, in _attach_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     self._check_attach_and_reserve_volume(context, volume_id, instance)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/compute/api.py\", line 3407, in _check_attach_and_reserve_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     self.volume_api.reserve_volume(context, volume_id)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 196, in wrapper\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     _reraise(exception.InvalidInput(reason=err_msg))\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 246, in _reraise\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     six.reraise(type(desired_exc), desired_exc, sys.exc_info()[2])\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 188, in wrapper\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     res = method(self, ctx, *args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 210, in wrapper\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     res = method(self, ctx, volume_id, *args, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/opt/stack/new/nova/nova/volume/cinder.py\", line 327, in reserve_volume\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     cinderclient(context).volumes.reserve(volume_id)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/v3/volumes.py\", line 383, in reserve\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return self._action('os-reserve', volume)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/v3/volumes.py\", line 346, in _action\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     resp, body = self.api.client.post(url, body=body)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 146, in post\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return self._cs_request(url, 'POST', **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 134, in _cs_request\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     return self.request(url, method, **kwargs)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/cinderclient/client.py\", line 123, in request\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions     raise exceptions.from_response(resp, body)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions InvalidInput: Invalid input received: Invalid volume: Volume status must be available to reserve. (HTTP 400) (Request-ID: req-1af67f41-54a7-4539-89f2-c08d45184153)\n2016-10-11 19:28:54.097 3865 ERROR nova.api.openstack.extensions", 
            "date_created": "2016-10-11 23:34:30.788690+00:00", 
            "author": "https://api.launchpad.net/1.0/~oomichi"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/385200", 
            "date_created": "2016-10-11 23:38:16.386970+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/385200\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=21961e7bc5c9c9650597a9ed7f15a913fcab09d9\nSubmitter: Jenkins\nBranch:    master\n\ncommit 21961e7bc5c9c9650597a9ed7f15a913fcab09d9\nAuthor: Ken'ichi Ohmichi <email address hidden>\nDate:   Tue Oct 11 16:27:10 2016 -0700\n\n    Add InvalidInput handling for attach-volume\n    \n    If attaching the already attached volume to a server, Cinder returns\n    HTTP400 response to Nova but Nova didn't except the response.\n    Then Nova returned HTTP500 response to a client.\n    Tempest test I594566704b9794457d224031802d9cbf132e765f reproduces\n    this error case.\n    \n    Closes-Bug: #1632513\n    Change-Id: I6718883cb6b42d9b816e3799324a166cbfe92b40\n", 
            "date_created": "2016-10-14 16:23:41.430404+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/386718", 
            "date_created": "2016-10-14 17:57:58.865624+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/386718\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=d2a4decffe3cc3a12624ff8e8f50b8c27c3b8775\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit d2a4decffe3cc3a12624ff8e8f50b8c27c3b8775\nAuthor: Ken'ichi Ohmichi <email address hidden>\nDate:   Tue Oct 11 16:27:10 2016 -0700\n\n    Add InvalidInput handling for attach-volume\n    \n    If attaching the already attached volume to a server, Cinder returns\n    HTTP400 response to Nova but Nova didn't except the response.\n    Then Nova returned HTTP500 response to a client.\n    Tempest test I594566704b9794457d224031802d9cbf132e765f reproduces\n    this error case.\n    \n    Closes-Bug: #1632513\n    Change-Id: I6718883cb6b42d9b816e3799324a166cbfe92b40\n    (cherry picked from commit 21961e7bc5c9c9650597a9ed7f15a913fcab09d9)\n", 
            "date_created": "2016-10-16 01:27:59.883039+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.2 release.", 
            "date_created": "2016-11-07 04:59:38.978843+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.2 release.", 
            "date_created": "2016-11-10 02:34:05.517531+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b1 development milestone.", 
            "date_created": "2016-11-17 13:12:40.868872+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.2 release.", 
            "date_created": "2016-12-07 10:45:37.464149+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-10-14 16:23:38.592480+00:00"
}