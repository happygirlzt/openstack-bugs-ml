{
    "status": "Invalid", 
    "last_updated": "2014-09-17 11:53:23.775283+00:00", 
    "description": "I installed the folsom-2012.2 nova/glance/keystone in a singe node and all things seemed right\nexcept for that the instance can't get their private fixed IP via DHCP protocol under FlatDHCP network mode.\n\nAfter I used vnc to get access to vm instance and use command `ip addr add %FIXED-IP%/%NETMASK% dev eth0` to configure\nthe ip address for instance manually, the network of the instance became to work.\n(the image of the instances is debian-6.0.4-amd64-standard)\n\nThen I tried to use tcpdump to capture the udp packets on br100(which nova-network is using), found that the dnsmasq(which acted as dhcp server)\ndidn't respond to the DHCPDISCOVER requests send by dhcp client inside the instance.\n\n\nI also found similar problem reported by others, but in this case my server's kernel version is 3.2\n\nDHCP broken for Openstack Nova instances since kernel v3.3\nhttps://bugs.launchpad.net/ubuntu/+source/linux/+bug/1035172\n\n\n\nBellow are debug infos, can anyone give some help? thx\n\nkernel version\n\n    hzzhanggy % uname -a\n    Linux DEV6 3.2.0-3-amd64 #1 SMP Mon Jul 23 02:45:17 UTC 2012 x86_64 GNU/Linux\n\n\ndnsmasq version\n\n    hzzhanggy % sudo aptitude show dnsmasq\n    Package: dnsmasq\n    State: installed\n    Automatically installed: no\n    Version: 2.63-4\n    Priority: optional\n    Section: net\n    Maintainer: Simon Kelley <email address hidden>\n    Architecture: all\n    Uncompressed Size: 39.9 k\n    Depends: netbase, dnsmasq-base (>= 2.63-4)\n    Suggests: resolvconf\n    Conflicts: resolvconf (< 1.15)\n    Description: Small caching DNS proxy and DHCP/TFTP server\n     Dnsmasq is a lightweight, easy to configure, DNS forwarder and DHCP server. It is designed to provide DNS and optionally, DHCP, to a small network. It can serve the names of local machines which are\n     not in the global DNS. The DHCP server integrates with the DNS server and allows machines with DHCP-allocated addresses to appear in the DNS with names configured either in each host or in a central\n     configuration file. Dnsmasq supports static and dynamic DHCP leases and BOOTP/TFTP for network booting of diskless machines.\n\n\nnetwork interface\n\n    hzzhanggy % ip a\n    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue state UNKNOWN \n        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n        inet 127.0.0.1/8 scope host lo\n        inet 169.254.169.254/32 scope link lo\n        inet6 ::1/128 scope host \n           valid_lft forever preferred_lft forever\n    2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 1000\n        link/ether 5c:f3:fc:98:97:d8 brd ff:ff:ff:ff:ff:ff\n        inet xxx.xxx.xxx.6/24 brd xxx.xxx.xxx.255 scope global eth0\n        inet6 fe80::5ef3:fcff:fe98:97d8/64 scope link \n           valid_lft forever preferred_lft forever\n    3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq master br100 state UP qlen 1000\n        link/ether 5c:f3:fc:98:97:da brd ff:ff:ff:ff:ff:ff\n        inet6 fe80::5ef3:fcff:fe98:97da/64 scope link \n           valid_lft forever preferred_lft forever\n    4: usb0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000\n        link/ether 5e:f3:fc:9c:97:db brd ff:ff:ff:ff:ff:ff\n    78: br101: <BROADCAST,MULTICAST,PROMISC> mtu 1500 qdisc noqueue state DOWN \n        link/ether 2a:bc:e5:2f:4b:4c brd ff:ff:ff:ff:ff:ff\n        inet 10.120.33.1/25 brd 10.120.33.127 scope global br101\n    81: br100: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP \n        link/ether 5c:f3:fc:98:97:da brd ff:ff:ff:ff:ff:ff\n        inet 10.120.33.1/25 brd 10.120.33.127 scope global br100\n        inet6 fe80::5ef3:fcff:fe98:97da/64 scope link \n           valid_lft forever preferred_lft forever\n    102: vnet1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br100 state UNKNOWN qlen 500\n        link/ether fe:16:3e:06:c4:71 brd ff:ff:ff:ff:ff:ff\n        inet6 fe80::fc16:3eff:fe06:c471/64 scope link \n           valid_lft forever preferred_lft forever\n    103: vnet0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br100 state UNKNOWN qlen 500\n        link/ether fe:16:3e:08:1d:0d brd ff:ff:ff:ff:ff:ff\n        inet6 fe80::fc16:3eff:fe08:1d0d/64 scope link \n           valid_lft forever preferred_lft forever\n\n\ndnsmasq process\n\n    hzzhanggy % ps aux|grep dnsmasq\n    nobody   24867  0.0  0.0  21360   952 ?        SN   17:49   0:00 /usr/sbin/dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/home/hzzhanggy/lib/nova/networks/nova-br100.pid --listen-address=10.120.33.1 --except-interface=lo --dhcp-range=set:'private',10.120.33.2,static,120s --dhcp-lease-max=128 --dhcp-hostsfile=/home/hzzhanggy/lib/nova/networks/nova-br100.conf --dhcp-script=/usr/local/bin/nova-dhcpbridge --leasefile-ro\n    root     24868  0.0  0.0  21332   420 ?        SN   17:49   0:00 /usr/sbin/dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/home/hzzhanggy/lib/nova/networks/nova-br100.pid --listen-address=10.120.33.1 --except-interface=lo --dhcp-range=set:'private',10.120.33.2,static,120s --dhcp-lease-max=128 --dhcp-hostsfile=/home/hzzhanggy/lib/nova/networks/nova-br100.conf --dhcp-script=/usr/local/bin/nova-dhcpbridge --leasefile-ro\n\n\nthe dnamasq listening port\n\n    hzzhanggy % sudo netstat -anpu|grep dns\n    udp        0      0 10.120.33.1:53          0.0.0.0:*                           24867/dnsmasq\n    udp        0      0 0.0.0.0:67              0.0.0.0:*                           24867/dnsmasq\n\n\n\nthe content of dhcp-hostsfile\n\n    hzzhanggy % cat ~/lib/nova/networks/nova-br100.conf\n    fa:16:3e:08:1d:0d,server-001.novalocal,10.120.33.44\n    fa:16:3e:06:c4:71,server-002.novalocal,10.120.33.45\n\n\nrun dhclient in instance with mac \"fa:16:3e:08:1d:0d\", while running tcpdump to capture udp packets on br100 on openstack server,\njust DHCPDISCOVER packets captured.\n\n    root # dhclient eth0\n\n\n    hzzhanggy % sudo tcpdump -v -i br100 udp\n\n    22:01:03.347651 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)\n        0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from fa:16:3e:08:1d:0d (oui Unknown), length 300, xid 0xd5a2dd48, Flags [none]\n              Client-Ethernet-Address fa:16:3e:08:1d:0d (oui Unknown)\n              Vendor-rfc1048 Extensions\n                Magic Cookie 0x63825363\n                DHCP-Message Option 53, length 1: Discover\n                Parameter-Request Option 55, length 13:\n                  Subnet-Mask, BR, Time-Zone, Default-Gateway\n                  Domain-Name, Domain-Name-Server, Option 119, Hostname\n                  Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route\n                  NTP\n    22:01:05.351754 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)\n        0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from fa:16:3e:08:1d:0d (oui Unknown), length 300, xid 0xa59d1867, secs 8, Flags [none]\n              Client-Ethernet-Address fa:16:3e:08:1d:0d (oui Unknown)\n              Vendor-rfc1048 Extensions\n                Magic Cookie 0x63825363\n                DHCP-Message Option 53, length 1: Discover\n                Parameter-Request Option 55, length 13:\n                  Subnet-Mask, BR, Time-Zone, Default-Gateway\n                  Domain-Name, Domain-Name-Server, Option 119, Hostname\n                  Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route\n                  NTP\n    22:01:05.443905 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)\n        0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from fa:16:3e:08:1d:0d (oui Unknown), length 300, xid 0x56275753, Flags [none]\n              Client-Ethernet-Address fa:16:3e:08:1d:0d (oui Unknown)\n              Vendor-rfc1048 Extensions\n                Magic Cookie 0x63825363\n                DHCP-Message Option 53, length 1: Discover\n                Parameter-Request Option 55, length 13:\n                  Subnet-Mask, BR, Time-Zone, Default-Gateway\n                  Domain-Name, Domain-Name-Server, Option 119, Hostname\n                  Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route\n                  NTP\n    22:01:06.346870 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)\n        0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from fa:16:3e:08:1d:0d (oui Unknown), length 300, xid 0xd5a2dd48, secs 3, Flags [none]\n              Client-Ethernet-Address fa:16:3e:08:1d:0d (oui Unknown)\n              Vendor-rfc1048 Extensions\n                Magic Cookie 0x63825363\n                DHCP-Message Option 53, length 1: Discover\n                Parameter-Request Option 55, length 13:\n                  Subnet-Mask, BR, Time-Zone, Default-Gateway\n                  Domain-Name, Domain-Name-Server, Option 119, Hostname\n                  Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route\n                  NTP\n\n\n\ntrace iptables, the dhcp request matched an ACCEPT rule\n\n    hzzhanggy % dmesg|grep \"fa:16:3e:08:1d:0d\"|tail -n 10\n\n    [1481865.887860] TRACE: filter:nova-network-local:return:1 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887874] TRACE: filter:nova-filter-top:rule:2 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887888] TRACE: filter:nova-compute-local:return:3 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887903] TRACE: filter:nova-filter-top:rule:3 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887916] TRACE: filter:nova-api-local:return:1 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887931] TRACE: filter:nova-filter-top:return:4 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887943] TRACE: filter:FORWARD:rule:2 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887958] TRACE: filter:nova-network-FORWARD:rule:1 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887980] TRACE: filter:INPUT:rule:1 IN=br100 OUT= PHYSIN=vnet0 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887995] TRACE: filter:nova-network-INPUT:rule:1 IN=br100 OUT= PHYSIN=vnet0 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n\n\n    hzzhanggy % sudo iptables-save|grep nova-network-INPUT\n\n    :nova-network-INPUT - [0:0]\n    -A INPUT -j nova-network-INPUT\n    -A nova-network-INPUT -i br100 -p udp -m udp --dport 67 -j ACCEPT\n    -A nova-network-INPUT -i br100 -p tcp -m tcp --dport 67 -j ACCEPT\n    -A nova-network-INPUT -i br100 -p udp -m udp --dport 53 -j ACCEPT\n    -A nova-network-INPUT -i br100 -p tcp -m tcp --dport 53 -j ACCEPT\n\n\nstrace dnsmasq, found that the dnsmasq wait at the \"select\" operation, seemded not data reveiced\n\n    hzzhanggy % sudo strace -p 24867\n\n    time(NULL)                              = 1351256984\n    fcntl(4, F_GETFL)                       = 0x2 (flags O_RDWR)\n    fcntl(4, F_SETFL, O_RDWR|O_NONBLOCK)    = 0\n    recvmsg(4, {msg_name(12)={sa_family=AF_NETLINK, pid=0, groups=00000400}, msg_iov(1)=[{\"\\200\\0\\0\\0\\31\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\n\\200\\0\\0\\377\\0\\0\\1\\0\\2\\0\\0\\10\\0\\17\\0\"..., 384}], msg_controllen=0, msg_flags=0}, MSG_PEEK|MSG_TRUNC) = 128\n    recvmsg(4, {msg_name(12)={sa_family=AF_NETLINK, pid=0, groups=00000400}, msg_iov(1)=[{\"\\200\\0\\0\\0\\31\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\n\\200\\0\\0\\377\\0\\0\\1\\0\\2\\0\\0\\10\\0\\17\\0\"..., 384}], msg_controllen=0, msg_flags=0}, 0) = 128\n    fcntl(4, F_SETFL, O_RDWR)               = 0\n    select(8, [3 4 5 6 7], [], [], NULL   \n\n\nlsof result of dnsmasq\n\n    hzzhanggy % sudo lsof -p 24867\n\n    COMMAND   PID   USER   FD      TYPE             DEVICE SIZE/OFF      NODE NAME\n    dnsmasq 24867 nobody  cwd       DIR                8,1     4096         2 /\n    dnsmasq 24867 nobody  rtd       DIR                8,1     4096         2 /\n    dnsmasq 24867 nobody  txt       REG                8,1   253592     81988 /usr/sbin/dnsmasq\n    dnsmasq 24867 nobody  mem       REG                8,1    14768    123450 /lib/x86_64-linux-gnu/libdl-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,1    31744    123456 /lib/x86_64-linux-gnu/librt-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,1   131107    123454 /lib/x86_64-linux-gnu/libpthread-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,1  1583120    123435 /lib/x86_64-linux-gnu/libc-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,1   211376    123191 /usr/lib/x86_64-linux-gnu/libidn.so.11.6.8\n    dnsmasq 24867 nobody  mem       REG                8,1    24712     82068 /usr/lib/libnfnetlink.so.0.2.0\n    dnsmasq 24867 nobody  mem       REG                8,1    96520    123284 /usr/lib/x86_64-linux-gnu/libnetfilter_conntrack.so.3.3.0\n    dnsmasq 24867 nobody  mem       REG                8,1   286488    123894 /lib/x86_64-linux-gnu/libdbus-1.so.3.7.2\n    dnsmasq 24867 nobody  mem       REG                8,1   136936    123458 /lib/x86_64-linux-gnu/ld-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,6   217016    851971 /var/cache/nscd/group\n    dnsmasq 24867 nobody  mem       REG                8,6   217016    851970 /var/cache/nscd/passwd\n    dnsmasq 24867 nobody  mem       REG                8,1  1534672     92791 /usr/lib/locale/locale-archive\n    dnsmasq 24867 nobody  mem       REG                8,1    26066    123643 /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache\n    dnsmasq 24867 nobody    0u      CHR                1,3      0t0      1028 /dev/null\n    dnsmasq 24867 nobody    1u      CHR                1,3      0t0      1028 /dev/null\n    dnsmasq 24867 nobody    2u      CHR                1,3      0t0      1028 /dev/null\n    dnsmasq 24867 nobody    3u     IPv4          387210551      0t0       UDP *:bootps\n    dnsmasq 24867 nobody    4u  netlink                         0t0 387210552 ROUTE\n    dnsmasq 24867 nobody    5u     IPv4          387210563      0t0       UDP 10.120.33.1:domain\n    dnsmasq 24867 nobody    6u     IPv4          387210564      0t0       TCP 10.120.33.1:domain (LISTEN)\n    dnsmasq 24867 nobody    7r     FIFO                0,8      0t0 387208289 pipe\n    dnsmasq 24867 nobody    8w     FIFO                0,8      0t0 387208289 pipe\n    dnsmasq 24867 nobody    9u     unix 0xffff880665f44c40      0t0 387210157 socket\n    dnsmasq 24867 nobody   12w     FIFO                0,8      0t0 387210158 pipe\n\n\nbut when I kill the dnsmasq process and use nc to listen on udp 67 port, it definately could received something.\n\n    hzzhanggy % _ nc -l -u -p 67|xxd\n    0000000: 0101 0600 c12f 2d0f 0014 0000 0000 0000  ...../-.........\n    0000010: 0000 0000 0000 0000 0000 0000 fa16 3e75  ..............>u\n    0000020: 38c3 0000 0000 0000 0000 0000 0000 0000  8...............\n    0000030: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000040: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000060: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000070: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000080: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000090: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000e0: 0000 0000 0000 0000 0000 0000 6382 5363  ............c.Sc\n    00000f0: 3501 0137 0d01 1c02 030f 0677 0c2c 2f1a  5..7.......w.,/.\n    0000100: 792a ff00 0000 0000 0000 0000 0000 0000  y*..............\n    0000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1072014", 
    "owner": "None", 
    "id": 1072014, 
    "index": 4436, 
    "openned": "2012-10-27 08:48:40.211187+00:00", 
    "created": "2012-10-27 08:48:40.211187+00:00", 
    "title": "instance cannot get ip automatically under FlatDHCP mode", 
    "comments": [
        {
            "content": "I installed the folsom-2012.2 nova/glance/keystone in a singe node and all things seemed right\nexcept for that the instance can't get their private fixed IP via DHCP protocol under FlatDHCP network mode.\n\nAfter I used vnc to get access to vm instance and use command `ip addr add %FIXED-IP%/%NETMASK% dev eth0` to configure\nthe ip address for instance manually, the network of the instance became to work.\n(the image of the instances is debian-6.0.4-amd64-standard)\n\nThen I tried to use tcpdump to capture the udp packets on br100(which nova-network is using), found that the dnsmasq(which acted as dhcp server)\ndidn't respond to the DHCPDISCOVER requests send by dhcp client inside the instance.\n\n\nI also found similar problem reported by others, but in this case my server's kernel version is 3.2\n\nDHCP broken for Openstack Nova instances since kernel v3.3\nhttps://bugs.launchpad.net/ubuntu/+source/linux/+bug/1035172\n\n\n\nBellow are debug infos, can anyone give some help? thx\n\nkernel version\n\n    hzzhanggy % uname -a\n    Linux DEV6 3.2.0-3-amd64 #1 SMP Mon Jul 23 02:45:17 UTC 2012 x86_64 GNU/Linux\n\n\ndnsmasq version\n\n    hzzhanggy % sudo aptitude show dnsmasq\n    Package: dnsmasq\n    State: installed\n    Automatically installed: no\n    Version: 2.63-4\n    Priority: optional\n    Section: net\n    Maintainer: Simon Kelley <email address hidden>\n    Architecture: all\n    Uncompressed Size: 39.9 k\n    Depends: netbase, dnsmasq-base (>= 2.63-4)\n    Suggests: resolvconf\n    Conflicts: resolvconf (< 1.15)\n    Description: Small caching DNS proxy and DHCP/TFTP server\n     Dnsmasq is a lightweight, easy to configure, DNS forwarder and DHCP server. It is designed to provide DNS and optionally, DHCP, to a small network. It can serve the names of local machines which are\n     not in the global DNS. The DHCP server integrates with the DNS server and allows machines with DHCP-allocated addresses to appear in the DNS with names configured either in each host or in a central\n     configuration file. Dnsmasq supports static and dynamic DHCP leases and BOOTP/TFTP for network booting of diskless machines.\n\n\nnetwork interface\n\n    hzzhanggy % ip a\n    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue state UNKNOWN \n        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n        inet 127.0.0.1/8 scope host lo\n        inet 169.254.169.254/32 scope link lo\n        inet6 ::1/128 scope host \n           valid_lft forever preferred_lft forever\n    2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 1000\n        link/ether 5c:f3:fc:98:97:d8 brd ff:ff:ff:ff:ff:ff\n        inet xxx.xxx.xxx.6/24 brd xxx.xxx.xxx.255 scope global eth0\n        inet6 fe80::5ef3:fcff:fe98:97d8/64 scope link \n           valid_lft forever preferred_lft forever\n    3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq master br100 state UP qlen 1000\n        link/ether 5c:f3:fc:98:97:da brd ff:ff:ff:ff:ff:ff\n        inet6 fe80::5ef3:fcff:fe98:97da/64 scope link \n           valid_lft forever preferred_lft forever\n    4: usb0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000\n        link/ether 5e:f3:fc:9c:97:db brd ff:ff:ff:ff:ff:ff\n    78: br101: <BROADCAST,MULTICAST,PROMISC> mtu 1500 qdisc noqueue state DOWN \n        link/ether 2a:bc:e5:2f:4b:4c brd ff:ff:ff:ff:ff:ff\n        inet 10.120.33.1/25 brd 10.120.33.127 scope global br101\n    81: br100: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP \n        link/ether 5c:f3:fc:98:97:da brd ff:ff:ff:ff:ff:ff\n        inet 10.120.33.1/25 brd 10.120.33.127 scope global br100\n        inet6 fe80::5ef3:fcff:fe98:97da/64 scope link \n           valid_lft forever preferred_lft forever\n    102: vnet1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br100 state UNKNOWN qlen 500\n        link/ether fe:16:3e:06:c4:71 brd ff:ff:ff:ff:ff:ff\n        inet6 fe80::fc16:3eff:fe06:c471/64 scope link \n           valid_lft forever preferred_lft forever\n    103: vnet0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br100 state UNKNOWN qlen 500\n        link/ether fe:16:3e:08:1d:0d brd ff:ff:ff:ff:ff:ff\n        inet6 fe80::fc16:3eff:fe08:1d0d/64 scope link \n           valid_lft forever preferred_lft forever\n\n\ndnsmasq process\n\n    hzzhanggy % ps aux|grep dnsmasq\n    nobody   24867  0.0  0.0  21360   952 ?        SN   17:49   0:00 /usr/sbin/dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/home/hzzhanggy/lib/nova/networks/nova-br100.pid --listen-address=10.120.33.1 --except-interface=lo --dhcp-range=set:'private',10.120.33.2,static,120s --dhcp-lease-max=128 --dhcp-hostsfile=/home/hzzhanggy/lib/nova/networks/nova-br100.conf --dhcp-script=/usr/local/bin/nova-dhcpbridge --leasefile-ro\n    root     24868  0.0  0.0  21332   420 ?        SN   17:49   0:00 /usr/sbin/dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/home/hzzhanggy/lib/nova/networks/nova-br100.pid --listen-address=10.120.33.1 --except-interface=lo --dhcp-range=set:'private',10.120.33.2,static,120s --dhcp-lease-max=128 --dhcp-hostsfile=/home/hzzhanggy/lib/nova/networks/nova-br100.conf --dhcp-script=/usr/local/bin/nova-dhcpbridge --leasefile-ro\n\n\nthe dnamasq listening port\n\n    hzzhanggy % sudo netstat -anpu|grep dns\n    udp        0      0 10.120.33.1:53          0.0.0.0:*                           24867/dnsmasq\n    udp        0      0 0.0.0.0:67              0.0.0.0:*                           24867/dnsmasq\n\n\n\nthe content of dhcp-hostsfile\n\n    hzzhanggy % cat ~/lib/nova/networks/nova-br100.conf\n    fa:16:3e:08:1d:0d,server-001.novalocal,10.120.33.44\n    fa:16:3e:06:c4:71,server-002.novalocal,10.120.33.45\n\n\nrun dhclient in instance with mac \"fa:16:3e:08:1d:0d\", while running tcpdump to capture udp packets on br100 on openstack server,\njust DHCPDISCOVER packets captured.\n\n    root # dhclient eth0\n\n\n    hzzhanggy % sudo tcpdump -v -i br100 udp\n\n    22:01:03.347651 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)\n        0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from fa:16:3e:08:1d:0d (oui Unknown), length 300, xid 0xd5a2dd48, Flags [none]\n              Client-Ethernet-Address fa:16:3e:08:1d:0d (oui Unknown)\n              Vendor-rfc1048 Extensions\n                Magic Cookie 0x63825363\n                DHCP-Message Option 53, length 1: Discover\n                Parameter-Request Option 55, length 13:\n                  Subnet-Mask, BR, Time-Zone, Default-Gateway\n                  Domain-Name, Domain-Name-Server, Option 119, Hostname\n                  Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route\n                  NTP\n    22:01:05.351754 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)\n        0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from fa:16:3e:08:1d:0d (oui Unknown), length 300, xid 0xa59d1867, secs 8, Flags [none]\n              Client-Ethernet-Address fa:16:3e:08:1d:0d (oui Unknown)\n              Vendor-rfc1048 Extensions\n                Magic Cookie 0x63825363\n                DHCP-Message Option 53, length 1: Discover\n                Parameter-Request Option 55, length 13:\n                  Subnet-Mask, BR, Time-Zone, Default-Gateway\n                  Domain-Name, Domain-Name-Server, Option 119, Hostname\n                  Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route\n                  NTP\n    22:01:05.443905 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)\n        0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from fa:16:3e:08:1d:0d (oui Unknown), length 300, xid 0x56275753, Flags [none]\n              Client-Ethernet-Address fa:16:3e:08:1d:0d (oui Unknown)\n              Vendor-rfc1048 Extensions\n                Magic Cookie 0x63825363\n                DHCP-Message Option 53, length 1: Discover\n                Parameter-Request Option 55, length 13:\n                  Subnet-Mask, BR, Time-Zone, Default-Gateway\n                  Domain-Name, Domain-Name-Server, Option 119, Hostname\n                  Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route\n                  NTP\n    22:01:06.346870 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)\n        0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from fa:16:3e:08:1d:0d (oui Unknown), length 300, xid 0xd5a2dd48, secs 3, Flags [none]\n              Client-Ethernet-Address fa:16:3e:08:1d:0d (oui Unknown)\n              Vendor-rfc1048 Extensions\n                Magic Cookie 0x63825363\n                DHCP-Message Option 53, length 1: Discover\n                Parameter-Request Option 55, length 13:\n                  Subnet-Mask, BR, Time-Zone, Default-Gateway\n                  Domain-Name, Domain-Name-Server, Option 119, Hostname\n                  Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route\n                  NTP\n\n\n\ntrace iptables, the dhcp request matched an ACCEPT rule\n\n    hzzhanggy % dmesg|grep \"fa:16:3e:08:1d:0d\"|tail -n 10\n\n    [1481865.887860] TRACE: filter:nova-network-local:return:1 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887874] TRACE: filter:nova-filter-top:rule:2 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887888] TRACE: filter:nova-compute-local:return:3 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887903] TRACE: filter:nova-filter-top:rule:3 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887916] TRACE: filter:nova-api-local:return:1 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887931] TRACE: filter:nova-filter-top:return:4 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887943] TRACE: filter:FORWARD:rule:2 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887958] TRACE: filter:nova-network-FORWARD:rule:1 IN=br100 OUT=br100 PHYSIN=vnet0 PHYSOUT=eth1 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887980] TRACE: filter:INPUT:rule:1 IN=br100 OUT= PHYSIN=vnet0 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n    [1481865.887995] TRACE: filter:nova-network-INPUT:rule:1 IN=br100 OUT= PHYSIN=vnet0 MAC=ff:ff:ff:ff:ff:ff:fa:16:3e:08:1d:0d:08:00 SRC=0.0.0.0 DST=255.255.255.255 LEN=328 TOS=0x10 PREC=0x00 TTL=128 ID=0 PROTO=UDP SPT=68 DPT=67 LEN=308\n\n\n    hzzhanggy % sudo iptables-save|grep nova-network-INPUT\n\n    :nova-network-INPUT - [0:0]\n    -A INPUT -j nova-network-INPUT\n    -A nova-network-INPUT -i br100 -p udp -m udp --dport 67 -j ACCEPT\n    -A nova-network-INPUT -i br100 -p tcp -m tcp --dport 67 -j ACCEPT\n    -A nova-network-INPUT -i br100 -p udp -m udp --dport 53 -j ACCEPT\n    -A nova-network-INPUT -i br100 -p tcp -m tcp --dport 53 -j ACCEPT\n\n\nstrace dnsmasq, found that the dnsmasq wait at the \"select\" operation, seemded not data reveiced\n\n    hzzhanggy % sudo strace -p 24867\n\n    time(NULL)                              = 1351256984\n    fcntl(4, F_GETFL)                       = 0x2 (flags O_RDWR)\n    fcntl(4, F_SETFL, O_RDWR|O_NONBLOCK)    = 0\n    recvmsg(4, {msg_name(12)={sa_family=AF_NETLINK, pid=0, groups=00000400}, msg_iov(1)=[{\"\\200\\0\\0\\0\\31\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\n\\200\\0\\0\\377\\0\\0\\1\\0\\2\\0\\0\\10\\0\\17\\0\"..., 384}], msg_controllen=0, msg_flags=0}, MSG_PEEK|MSG_TRUNC) = 128\n    recvmsg(4, {msg_name(12)={sa_family=AF_NETLINK, pid=0, groups=00000400}, msg_iov(1)=[{\"\\200\\0\\0\\0\\31\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\n\\200\\0\\0\\377\\0\\0\\1\\0\\2\\0\\0\\10\\0\\17\\0\"..., 384}], msg_controllen=0, msg_flags=0}, 0) = 128\n    fcntl(4, F_SETFL, O_RDWR)               = 0\n    select(8, [3 4 5 6 7], [], [], NULL   \n\n\nlsof result of dnsmasq\n\n    hzzhanggy % sudo lsof -p 24867\n\n    COMMAND   PID   USER   FD      TYPE             DEVICE SIZE/OFF      NODE NAME\n    dnsmasq 24867 nobody  cwd       DIR                8,1     4096         2 /\n    dnsmasq 24867 nobody  rtd       DIR                8,1     4096         2 /\n    dnsmasq 24867 nobody  txt       REG                8,1   253592     81988 /usr/sbin/dnsmasq\n    dnsmasq 24867 nobody  mem       REG                8,1    14768    123450 /lib/x86_64-linux-gnu/libdl-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,1    31744    123456 /lib/x86_64-linux-gnu/librt-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,1   131107    123454 /lib/x86_64-linux-gnu/libpthread-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,1  1583120    123435 /lib/x86_64-linux-gnu/libc-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,1   211376    123191 /usr/lib/x86_64-linux-gnu/libidn.so.11.6.8\n    dnsmasq 24867 nobody  mem       REG                8,1    24712     82068 /usr/lib/libnfnetlink.so.0.2.0\n    dnsmasq 24867 nobody  mem       REG                8,1    96520    123284 /usr/lib/x86_64-linux-gnu/libnetfilter_conntrack.so.3.3.0\n    dnsmasq 24867 nobody  mem       REG                8,1   286488    123894 /lib/x86_64-linux-gnu/libdbus-1.so.3.7.2\n    dnsmasq 24867 nobody  mem       REG                8,1   136936    123458 /lib/x86_64-linux-gnu/ld-2.13.so\n    dnsmasq 24867 nobody  mem       REG                8,6   217016    851971 /var/cache/nscd/group\n    dnsmasq 24867 nobody  mem       REG                8,6   217016    851970 /var/cache/nscd/passwd\n    dnsmasq 24867 nobody  mem       REG                8,1  1534672     92791 /usr/lib/locale/locale-archive\n    dnsmasq 24867 nobody  mem       REG                8,1    26066    123643 /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache\n    dnsmasq 24867 nobody    0u      CHR                1,3      0t0      1028 /dev/null\n    dnsmasq 24867 nobody    1u      CHR                1,3      0t0      1028 /dev/null\n    dnsmasq 24867 nobody    2u      CHR                1,3      0t0      1028 /dev/null\n    dnsmasq 24867 nobody    3u     IPv4          387210551      0t0       UDP *:bootps\n    dnsmasq 24867 nobody    4u  netlink                         0t0 387210552 ROUTE\n    dnsmasq 24867 nobody    5u     IPv4          387210563      0t0       UDP 10.120.33.1:domain\n    dnsmasq 24867 nobody    6u     IPv4          387210564      0t0       TCP 10.120.33.1:domain (LISTEN)\n    dnsmasq 24867 nobody    7r     FIFO                0,8      0t0 387208289 pipe\n    dnsmasq 24867 nobody    8w     FIFO                0,8      0t0 387208289 pipe\n    dnsmasq 24867 nobody    9u     unix 0xffff880665f44c40      0t0 387210157 socket\n    dnsmasq 24867 nobody   12w     FIFO                0,8      0t0 387210158 pipe\n\n\nbut when I kill the dnsmasq process and use nc to listen on udp 67 port, it definately could received something.\n\n    hzzhanggy % _ nc -l -u -p 67|xxd\n    0000000: 0101 0600 c12f 2d0f 0014 0000 0000 0000  ...../-.........\n    0000010: 0000 0000 0000 0000 0000 0000 fa16 3e75  ..............>u\n    0000020: 38c3 0000 0000 0000 0000 0000 0000 0000  8...............\n    0000030: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000040: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000060: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000070: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000080: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    0000090: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................\n    00000e0: 0000 0000 0000 0000 0000 0000 6382 5363  ............c.Sc\n    00000f0: 3501 0137 0d01 1c02 030f 0677 0c2c 2f1a  5..7.......w.,/.\n    0000100: 792a ff00 0000 0000 0000 0000 0000 0000  y*..............\n    0000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................", 
            "date_created": "2012-10-27 08:48:40.211187+00:00", 
            "author": "https://api.launchpad.net/1.0/~stanzgy"
        }, 
        {
            "content": "", 
            "date_created": "2012-10-27 08:48:40.211187+00:00", 
            "author": "https://api.launchpad.net/1.0/~stanzgy"
        }, 
        {
            "content": "", 
            "date_created": "2012-10-27 08:55:39.150257+00:00", 
            "author": "https://api.launchpad.net/1.0/~stanzgy"
        }, 
        {
            "content": "Any chance your guest images are configured to change the mac address of the primary ethernet adapter via udev or similar? What image are you trying and where did you get it? Does CirrOS work?", 
            "date_created": "2012-11-27 19:25:13.709417+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "hi, i'm using debian-6.0.4-amd64-stand w/o any modifications as my guest's image.\nthere is no chance that guest vm will change its mac address.\n\nit's has been a long time since i reported this bug.\nthe system's environment on this server has changed significantly and couldn't reproduce the bug on it.\n\nbut i succeeded to reproduce this bug on my personal server w/ both debian-6.0.4 and cirros guest images.\n\n\nstanzgy % uname -a\nLinux stanzgy-netease 3.6.8-1-ARCH #1 SMP PREEMPT Mon Nov 26 22:10:40 CET 2012 x86_64 GNU/Linux\n\nstanzgy % qemu-kvm --version\nQEMU emulator version 1.2.0 (qemu-kvm-1.2.0), Copyright (c) 2003-2008 Fabrice Bellard\n\nstanzgy % libvirtd --version\nlibvirtd (libvirt) 1.0.0\n\nstanzgy % dnsmasq --version\nDnsmasq version 2.63rc6  Copyright (c) 2000-2012 Simon Kelley\nCompile time options: IPv6 GNU-getopt DBus no-i18n no-IDN DHCP DHCPv6 no-Lua TFTP no-conntrack\n\n\n(in guest vm) root # dhclient -v -4 -1 eth0 \nInternet Systems Consortium DHCP Client 4.1.1-P1\nCopyright 2004-2010 Internet Systems Consortium.\nAll rights reserved.\nFor info, please visit https://www.isc.org/software/dhcp/\n\nListening on LPF/eth0/fa:16:3e:5a:cf:47\nSending on   LPF/eth0/fa:16:3e:5a:cf:47\nSending on   Socket/fallback\nDHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 8\nDHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 9\nDHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 9\nDHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 20\nDHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 15\n5 bad udp checksums in 5 packets\nNo DHCPOFFERS received.\nUnable to obtain a lease on first try.  Exiting.\n\n\nstanzgy % sudo tcpdump -ni br100 udp port 67 or udp port 68\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br100, link-type EN10MB (Ethernet), capture size 65535 bytes\n17:22:53.501451 IP 0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from fa:16:3e:5a:cf:47, length 300\n17:22:53.501633 IP 10.0.0.1.67 > 10.0.1.13.68: BOOTP/DHCP, Reply, length 309\n17:23:01.507726 IP 0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from fa:16:3e:5a:cf:47, length 300\n17:23:01.507874 IP 10.0.0.1.67 > 10.0.1.13.68: BOOTP/DHCP, Reply, length 309\n17:23:10.508736 IP 0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from fa:16:3e:5a:cf:47, length 300\n17:23:10.508909 IP 10.0.0.1.67 > 10.0.1.13.68: BOOTP/DHCP, Reply, length 309\n17:23:19.508799 IP 0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from fa:16:3e:5a:cf:47, length 300\n17:23:19.508963 IP 10.0.0.1.67 > 10.0.1.13.68: BOOTP/DHCP, Reply, length 309\n17:23:39.519797 IP 0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from fa:16:3e:5a:cf:47, length 300\n17:23:39.519947 IP 10.0.0.1.67 > 10.0.1.13.68: BOOTP/DHCP, Reply, length 309\n\n10 packets captured\n10 packets received by filter\n0 packets dropped by kernel\n\n\nit looked like sth got broken with udp checksum. after a search i found explanation about this bug here:\nhttps://access.redhat.com/knowledge/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Virtualization_Host_Configuration_and_Guest_Installation_Guide/ch11s02.html\n\nthe temporarily workaround is to manually add an iptable rule\nstanzgy % sudo iptables -t mangle -A POSTROUTING -p udp -m udp --dport 68 -j CHECKSUM --checksum-fill\n\n\nthen dhcp works good again\n\n(in guest vm) root # dhclient -v -4 -1 eth0 \nInternet Systems Consortium DHCP Client 4.1.1-P1\nCopyright 2004-2010 Internet Systems Consortium.\nAll rights reserved.\nFor info, please visit https://www.isc.org/software/dhcp/\n\nListening on LPF/eth0/fa:16:3e:5a:cf:47\nSending on   LPF/eth0/fa:16:3e:5a:cf:47\nSending on   Socket/fallback\nDHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 5\nDHCPOFFER from 10.0.0.1\nDHCPREQUEST on eth0 to 255.255.255.255 port 67\nDHCPACK from 10.0.0.1\nbound to 10.0.1.13 -- renewal in 48 seconds.\n\n\nstanzgy % sudo tcpdump -ni br100 udp port 67 or udp port 68\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br100, link-type EN10MB (Ethernet), capture size 65535 bytes\n17:26:18.502548 IP 0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from fa:16:3e:5a:cf:47, length 300\n17:26:18.502731 IP 10.0.0.1.67 > 10.0.1.13.68: BOOTP/DHCP, Reply, length 309\n17:26:18.502965 IP 0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from fa:16:3e:5a:cf:47, length 300\n17:26:18.521110 IP 10.0.0.1.67 > 10.0.1.13.68: BOOTP/DHCP, Reply, length 309\n\n4 packets captured\n4 packets received by filter\n0 packets dropped by kernel", 
            "date_created": "2012-11-29 09:45:23.565975+00:00", 
            "author": "https://api.launchpad.net/1.0/~stanzgy"
        }, 
        {
            "content": "i don't know whether the reason that dhcp didn't work on these two server is same, but currently it's sure that the nova-network dhcp service won't work under the situation described above.", 
            "date_created": "2012-11-29 10:03:29.924432+00:00", 
            "author": "https://api.launchpad.net/1.0/~stanzgy"
        }, 
        {
            "content": "This has not been touched in over 2 years.  Im marking it incomplete for now.  If someone wants to repo on juno and it is still an issue please attach logs and reopen.  ", 
            "date_created": "2014-07-09 16:40:05.267553+00:00", 
            "author": "https://api.launchpad.net/1.0/~tjones-i"
        }
    ], 
    "closed": "2014-09-17 11:53:21.176419+00:00"
}