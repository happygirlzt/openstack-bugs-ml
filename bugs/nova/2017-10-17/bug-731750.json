{
    "status": "Fix Released", 
    "last_updated": "2011-04-21 07:14:38.385159+00:00", 
    "description": "The code that caches and creates the base image needs some kind of guard so that multiple greenthreads don't try to run the caching code at the same time.  Specifically it is the truncate command that it is failing. Note that the offending resize only happens for images of size m1.small and greater\n\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 116, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 407, in spawn\n(nova.exception): TRACE:     self._create_image(instance, xml) \n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 623, in _create_image\n(nova.exception): TRACE:     size=size)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 549, in _cache_image\n(nova.exception): TRACE:     fn(target=base, *args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 561, in _fetch_image\n(nova.exception): TRACE:     disk.extend(target, size)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/disk.py\", line 52, in extend \n(nova.exception): TRACE:     utils.execute('truncate -s %s %s' % (size, image))\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 159, in execute\n(nova.exception): TRACE:     cmd=cmd)\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: truncate -s 10737418240 /var/lib/nova/instances/_base/ami-maverick\n(nova.exception): TRACE: Exit code: 1\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: \"truncate: cannot open `/var/lib/nova/instances/_base/ami-maverick' for writing: Permission denied\\n\" \n(nova.exception): TRACE:", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/731750", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 731750, 
    "index": 2306, 
    "openned": "2011-03-09 03:11:09.528536+00:00", 
    "created": "2011-03-09 03:11:09.528536+00:00", 
    "title": "nova compute race condition on truncate", 
    "comments": [
        {
            "content": "The code that caches and creates the base image needs some kind of guard so that multiple greenthreads don't try to run the caching code at the same time.  Specifically it is the truncate command that it is failing. Note that the offending resize only happens for images of size m1.small and greater\n\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 116, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 407, in spawn\n(nova.exception): TRACE:     self._create_image(instance, xml) \n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 623, in _create_image\n(nova.exception): TRACE:     size=size)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 549, in _cache_image\n(nova.exception): TRACE:     fn(target=base, *args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 561, in _fetch_image\n(nova.exception): TRACE:     disk.extend(target, size)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/disk.py\", line 52, in extend \n(nova.exception): TRACE:     utils.execute('truncate -s %s %s' % (size, image))\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 159, in execute\n(nova.exception): TRACE:     cmd=cmd)\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: truncate -s 10737418240 /var/lib/nova/instances/_base/ami-maverick\n(nova.exception): TRACE: Exit code: 1\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: \"truncate: cannot open `/var/lib/nova/instances/_base/ami-maverick' for writing: Permission denied\\n\" \n(nova.exception): TRACE:", 
            "date_created": "2011-03-09 03:11:09.528536+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ], 
    "closed": "2011-04-21 07:14:37.252176+00:00"
}