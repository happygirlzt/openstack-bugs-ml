{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:49:31.792330+00:00", 
    "description": "This commit added some new default flags for migration in the libvirt driver:\n\nhttps://github.com/openstack/nova/commit/26504d71ceaecf22f135d8321769db801290c405\n\nHowever those new flags weren't added to nova.tests.virt.libvirt.fakelibvirt, so if you're not running with a real libvirt you're going to get this:\n\nFAIL: nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_uses_migrateToURI_without_dest_listen_addrs\ntags: worker-1\n----------------------------------------------------------------------\nEmpty attachments:\n  stderr\n  stdout\n\npythonlogging:'': {{{\nINFO [nova.network.driver] Loading network driver 'nova.network.linux_net'\nINFO [nova.virt.driver] Loading compute driver 'nova.virt.fake.FakeDriver'\nWARNING [nova.virt.libvirt.firewall] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\nERROR [nova.virt.libvirt.driver] Live Migration failure: 'module' object has no attribute 'VIR_MIGRATE_LIVE'\n}}}\n\ntraceback-1: {{{\nTraceback (most recent call last):\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/fixtures/fixture.py\", line 112, in cleanUp\n    return self._cleanups(raise_errors=raise_first)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/fixtures/callmany.py\", line 88, in __call__\n    reraise(error[0], error[1], error[2])\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/fixtures/callmany.py\", line 82, in __call__\n    cleanup(*args, **kwargs)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/mox.py\", line 286, in VerifyAll\n    mock_obj._Verify()\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/mox.py\", line 506, in _Verify\n    raise ExpectedMethodCallsError(self._expected_calls_queue)\nExpectedMethodCallsError: Verify: Expected methods never called:\n  0.  Stub for Domain.migrateToURI() -> None.__call__('qemu+tcp://dest/system', <IgnoreArg>, None, 0) -> None\n}}}\n\nTraceback (most recent call last):\n  File \"nova/tests/virt/libvirt/test_driver.py\", line 4607, in test_live_migration_uses_migrateToURI_without_dest_listen_addrs\n    migrate_data=migrate_data)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 393, in assertRaises\n    self.assertThat(our_callable, matcher)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 404, in assertThat\n    mismatch_error = self._matchHelper(matchee, matcher, message, verbose)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 454, in _matchHelper\n    mismatch = matcher.match(matchee)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/matchers/_exception.py\", line 108, in match\n    mismatch = self.exception_matcher.match(exc_info)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/matchers/_higherorder.py\", line 62, in match\n    mismatch = matcher.match(matchee)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 385, in match\n    reraise(*matchee)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/matchers/_exception.py\", line 101, in match\n    result = matchee()\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 902, in __call__\n    return self._callable_object(*self._args, **self._kwargs)\n  File \"nova/virt/libvirt/driver.py\", line 4798, in _live_migration\n    recover_method(context, instance, dest, block_migration)\n  File \"nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"nova/virt/libvirt/driver.py\", line 4764, in _live_migration\n    flagvals = [getattr(libvirt, x.strip()) for x in flaglist]\nAttributeError: 'module' object has no attribute 'VIR_MIGRATE_LIVE'\n\nThat is in basically anything that goes through the _live_migrate method.", 
    "tags": [
        "libvirt", 
        "testing"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1359475", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1359475, 
    "index": 6362, 
    "openned": "2014-08-21 00:40:21.320364+00:00", 
    "created": "2014-08-21 00:40:21.320364+00:00", 
    "title": "AttributeError: 'module' object has no attribute 'VIR_MIGRATE_LIVE'", 
    "comments": [
        {
            "content": "This commit added some new default flags for migration in the libvirt driver:\n\nhttps://github.com/openstack/nova/commit/26504d71ceaecf22f135d8321769db801290c405\n\nHowever those new flags weren't added to nova.tests.virt.libvirt.fakelibvirt, so if you're not running with a real libvirt you're going to get this:\n\nFAIL: nova.tests.virt.libvirt.test_driver.LibvirtConnTestCase.test_live_migration_uses_migrateToURI_without_dest_listen_addrs\ntags: worker-1\n----------------------------------------------------------------------\nEmpty attachments:\n  stderr\n  stdout\n\npythonlogging:'': {{{\nINFO [nova.network.driver] Loading network driver 'nova.network.linux_net'\nINFO [nova.virt.driver] Loading compute driver 'nova.virt.fake.FakeDriver'\nWARNING [nova.virt.libvirt.firewall] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.\nERROR [nova.virt.libvirt.driver] Live Migration failure: 'module' object has no attribute 'VIR_MIGRATE_LIVE'\n}}}\n\ntraceback-1: {{{\nTraceback (most recent call last):\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/fixtures/fixture.py\", line 112, in cleanUp\n    return self._cleanups(raise_errors=raise_first)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/fixtures/callmany.py\", line 88, in __call__\n    reraise(error[0], error[1], error[2])\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/fixtures/callmany.py\", line 82, in __call__\n    cleanup(*args, **kwargs)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/mox.py\", line 286, in VerifyAll\n    mock_obj._Verify()\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/mox.py\", line 506, in _Verify\n    raise ExpectedMethodCallsError(self._expected_calls_queue)\nExpectedMethodCallsError: Verify: Expected methods never called:\n  0.  Stub for Domain.migrateToURI() -> None.__call__('qemu+tcp://dest/system', <IgnoreArg>, None, 0) -> None\n}}}\n\nTraceback (most recent call last):\n  File \"nova/tests/virt/libvirt/test_driver.py\", line 4607, in test_live_migration_uses_migrateToURI_without_dest_listen_addrs\n    migrate_data=migrate_data)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 393, in assertRaises\n    self.assertThat(our_callable, matcher)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 404, in assertThat\n    mismatch_error = self._matchHelper(matchee, matcher, message, verbose)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 454, in _matchHelper\n    mismatch = matcher.match(matchee)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/matchers/_exception.py\", line 108, in match\n    mismatch = self.exception_matcher.match(exc_info)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/matchers/_higherorder.py\", line 62, in match\n    mismatch = matcher.match(matchee)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 385, in match\n    reraise(*matchee)\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/matchers/_exception.py\", line 101, in match\n    result = matchee()\n  File \"/home/jenkins/workspace/osee-nova-merge/.tox/py27/local/lib/python2.7/site-packages/testtools/testcase.py\", line 902, in __call__\n    return self._callable_object(*self._args, **self._kwargs)\n  File \"nova/virt/libvirt/driver.py\", line 4798, in _live_migration\n    recover_method(context, instance, dest, block_migration)\n  File \"nova/openstack/common/excutils.py\", line 82, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"nova/virt/libvirt/driver.py\", line 4764, in _live_migration\n    flagvals = [getattr(libvirt, x.strip()) for x in flaglist]\nAttributeError: 'module' object has no attribute 'VIR_MIGRATE_LIVE'\n\nThat is in basically anything that goes through the _live_migrate method.", 
            "date_created": "2014-08-21 00:40:21.320364+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I'm also wondering if this code in the libvirt driver's _live_migrate method should be using hasattr on the values and logging a warning if they aren't there...\n\nflagvals = [getattr(libvirt, x.strip()) for x in flaglist]", 
            "date_created": "2014-08-21 01:05:06.013883+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/115839", 
            "date_created": "2014-08-21 01:33:17.414505+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "FWIW I think failing if there is a requested flag that doesn't exist is appropriate - we can't tell how important a given flag is in general.", 
            "date_created": "2014-08-21 02:21:23.725949+00:00", 
            "author": "https://api.launchpad.net/1.0/~lifeless"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/115839\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=52409a957ebfc2ab99ff6bc6c80cabe94d4c3990\nSubmitter: Jenkins\nBranch:    master\n\ncommit 52409a957ebfc2ab99ff6bc6c80cabe94d4c3990\nAuthor: Matt Riedemann <email address hidden>\nDate:   Wed Aug 20 15:20:37 2014 -0700\n\n    Add missing flags to fakelibvirt for migration\n    \n    Commit 26504d71ceaecf22f135d8321769db801290c405 added\n    VIR_MIGRATE_UNDEFINE_SOURCE and VIR_MIGRATE_PEER2PEER\n    to the live and block migration default flags but did\n    not add those flags to the fakelibvirt module for\n    testing.\n    \n    This change adds the missing flags and also adds\n    VIR_MIGRATE_NON_SHARED_INC for block migration which\n    was also missing.\n    \n    Change-Id: I5f3af95a56b95ec20f93b12360bf8b3d40b5f45f\n    Closes-Bug: #1359475\n", 
            "date_created": "2014-08-21 11:46:53.076410+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-09-05 09:56:29.807326+00:00"
}