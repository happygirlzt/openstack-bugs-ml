{
    "status": "Expired", 
    "last_updated": "2016-09-12 04:17:21.572077+00:00", 
    "description": "Error occured when migrate instance after delete flavor.\n\nReproduce step :\n\n1. create flavor A\n2. boot instance using flavor A\n3. delete flavor A\n4. migrate instance (ex : nova migrate [instance_uuid])\n5. Error occured\n\nError Log :\n==========================================================================\nnova-compute.log\n\u00a0\u00a0\u00a0File \"/opt/openstack/src/nova/nova/conductor/manager.py\", line 422, in _object_dispatch\n\u00a0\u00a0\u00a0\u00a0\u00a0return getattr(target, method)(*args, **kwargs)\n\n\u00a0\u00a0\u00a0File \"/opt/openstack/src/nova/nova/objects/base.py\", line 163, in wrapper\n\u00a0\u00a0\u00a0\u00a0\u00a0result = fn(cls, context, *args, **kwargs)\n\n\u00a0\u00a0\u00a0File \"/opt/openstack/src/nova/nova/objects/flavor.py\", line 132, in get_by_id\n\u00a0\u00a0\u00a0\u00a0\u00a0db_flavor = db.flavor_get(context, id)\n\n\u00a0\u00a0\u00a0File \"/opt/openstack/src/nova/nova/db/api.py\", line 1479, in flavor_get\n\u00a0\u00a0\u00a0\u00a0\u00a0return IMPL.flavor_get(context, id)\n\n\u00a0\u00a0\u00a0File \"/opt/openstack/src/nova/nova/db/sqlalchemy/api.py\", line 233, in wrapper\n\u00a0\u00a0\u00a0\u00a0\u00a0return f(*args, **kwargs)\n\n\u00a0\u00a0\u00a0File \"/opt/openstack/src/nova/nova/db/sqlalchemy/api.py\", line 4732, in flavor_get\n\u00a0\u00a0\u00a0\u00a0\u00a0raise exception.FlavorNotFound(flavor_id=id)\n\n\u00a0FlavorNotFound: Flavor 8 could not be found.\n==========================================================================\n\nThis Error is occured when resize_instance method is called as below code:\n/opt/openstack/src/nova/nova/compute/manager.py\n\n\u00a0\u00a0\u00a0\u00a0def resize_instance(self, context, instance, image,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0reservations, migration, instance_type,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0clean_shutdown=True):\n....\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (not instance_type or\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0not isinstance(instance_type, objects.Flavor)):\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0instance_type = objects.Flavor.get_by_id(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context, migration['new_instance_type_id'])\n....\n\ncontext parameter has this data:\n{'domain': None, 'project_name': u'admin', 'project_domain': None, 'timestamp': '2016-06-14T04:34:50.759410', 'auth_token': u'457802dc378442a6ac4a5b952587927e', 'remote_address': u'10.10.10.5, 'quota_class': None, 'resource_uuid': None, 'is_admin': True, 'user': u'694df2010229405e966aafc16a30784f', 'service_catalog': [{u'endpoints': [{u'adminURL': u'https://devel-api.com:8776/v2/9b7ce4df5e1549058687d82e31d127b1', u'region': u'RegionOne', u'internalURL': u'https://devel-api.com:8776/v2/9b7ce4df5e1549058687d82e31d127b1', u'publicURL': u'https://devel-api.com:8776/v2/9b7ce4df5e1549058687d82e31d127b1'}], u'type': u'volumev2', u'name': u'cinderv2'}, {u'endpoints': [{u'adminURL': u'https://devel-api.com:8776/v1/9b7ce4df5e1549058687d82e31d127b1', u'region': u'RegionOne', u'internalURL': u'https://devel-api.com:8776/v1/9b7ce4df5e1549058687d82e31d127b1', u'publicURL': u'https://devel-api.com:8776/v1/9b7ce4df5e1549058687d82e31d127b1'}], u'type': u'volume', u'name': u'cinder'}], 'tenant': u'9b7ce4df5e1549058687d82e31d127b1', 'read_only': False, 'project_id': u'9b7ce4df5e1549058687d82e31d127b1', 'user_id': u'694df2010229405e966aafc16a30784f', 'show_deleted': False, 'roles': [u'admin'], 'user_identity': '694df2010229405e966aafc16a30784f 9b7ce4df5e1549058687d82e31d127b1 - - -', 'read_deleted': 'no', 'request_id': u'req-59dca904-6384-4ca0-b696-5731c80198d7', 'instance_lock_checked': False, 'user_domain': None, 'user_name': u'admin'}\n\nWhen objects.Flavor.get_by_id method is called, error is occurred because the default value of read_deleted is \"no\".\nSo, I think context.read_deleted attribute should be set to \"yes\" before objects.Flavor.get_by_id method is called.\n\nI've tested this using stable/kilo and I think liberty, mitaka has same problem.\n\nThanks.", 
    "tags": [
        "migrate", 
        "nova"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1592253", 
    "owner": "None", 
    "id": 1592253, 
    "index": 7544, 
    "openned": "2016-06-14 05:04:15.143039+00:00", 
    "created": "2016-06-14 05:04:15.143039+00:00", 
    "title": "Bug: migrate instance after delete flavor", 
    "comments": [
        {
            "content": "Error occured when migrate instance after delete flavor.\n\nReproduce step :\n\n1. create flavor A\n2. boot instance using flavor A\n3. delete flavor A\n4. migrate instance (ex : nova migrate [instance_uuid])\n5. Error occured\n\nError Log :\n=============================================================================================\nnova-compute.log\n   File \"/opt/openstack/src/nova/nova/conductor/manager.py\", line 422, in _object_dispatch\n     return getattr(target, method)(*args, **kwargs)\n\n   File \"/opt/openstack/src/nova/nova/objects/base.py\", line 163, in wrapper\n     result = fn(cls, context, *args, **kwargs)\n\n   File \"/opt/openstack/src/nova/nova/objects/flavor.py\", line 132, in get_by_id\n     db_flavor = db.flavor_get(context, id)\n\n   File \"/opt/openstack/src/nova/nova/db/api.py\", line 1479, in flavor_get\n     return IMPL.flavor_get(context, id)\n\n   File \"/opt/openstack/src/nova/nova/db/sqlalchemy/api.py\", line 233, in wrapper\n     return f(*args, **kwargs)\n\n   File \"/opt/openstack/src/nova/nova/db/sqlalchemy/api.py\", line 4732, in flavor_get\n     raise exception.FlavorNotFound(flavor_id=id)\n\n FlavorNotFound: Flavor 8 could not be found.\n=============================================================================================\n\nThis Error is occured when resize_instance method is called as below code:\n/opt/openstack/src/nova/nova/compute/manager.py\n\n    def resize_instance(self, context, instance, image,\n                        reservations, migration, instance_type,\n                        clean_shutdown=True):\n....\n            if (not instance_type or\n                not isinstance(instance_type, objects.Flavor)):\n                instance_type = objects.Flavor.get_by_id(\n                    context, migration['new_instance_type_id'])\n....\n\ncontext parameter has this data:\n{'domain': None, 'project_name': u'admin', 'project_domain': None, 'timestamp': '2016-06-14T04:34:50.759410', 'auth_token': u'457802dc378442a6ac4a5b952587927e', 'remote_address': u'10.10.10.5, 'quota_class': None, 'resource_uuid': None, 'is_admin': True, 'user': u'694df2010229405e966aafc16a30784f', 'service_catalog': [{u'endpoints': [{u'adminURL': u'https://devel-api.iwilab.com:8776/v2/9b7ce4df5e1549058687d82e31d127b1', u'region': u'RegionOne', u'internalURL': u'https://devel-api.iwilab.com:8776/v2/9b7ce4df5e1549058687d82e31d127b1', u'publicURL': u'https://devel-api.iwilab.com:8776/v2/9b7ce4df5e1549058687d82e31d127b1'}], u'type': u'volumev2', u'name': u'cinderv2'}, {u'endpoints': [{u'adminURL': u'https://devel-api.iwilab.com:8776/v1/9b7ce4df5e1549058687d82e31d127b1', u'region': u'RegionOne', u'internalURL': u'https://devel-api.iwilab.com:8776/v1/9b7ce4df5e1549058687d82e31d127b1', u'publicURL': u'https://devel-api.iwilab.com:8776/v1/9b7ce4df5e1549058687d82e31d127b1'}], u'type': u'volume', u'name': u'cinder'}], 'tenant': u'9b7ce4df5e1549058687d82e31d127b1', 'read_only': False, 'project_id': u'9b7ce4df5e1549058687d82e31d127b1', 'user_id': u'694df2010229405e966aafc16a30784f', 'show_deleted': False, 'roles': [u'admin'], 'user_identity': '694df2010229405e966aafc16a30784f 9b7ce4df5e1549058687d82e31d127b1 - - -', 'read_deleted': 'no', 'request_id': u'req-59dca904-6384-4ca0-b696-5731c80198d7', 'instance_lock_checked': False, 'user_domain': None, 'user_name': u'admin'}\n\nWhen objects.Flavor.get_by_id method is called, error is occurred because the default value of read_deleted is \"no\".\nSo, I think context.read_deleted attribute should be set to \"yes\" before objects.Flavor.get_by_id method is called.\n\nI've tested this using stable/kilo and I think liberty, mitaka has same problem.\n\nThanks.", 
            "date_created": "2016-06-14 05:04:15.143039+00:00", 
            "author": "https://api.launchpad.net/1.0/~raymon-ha"
        }, 
        {
            "content": "I'm pretty sure we fixed this in this and the fix was backported to kilo because we added a Tempest test for it. I'll look that up.", 
            "date_created": "2016-06-14 18:06:58.637444+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "This was the kilo fix:\n\nhttps://review.openstack.org/#/c/309168/\n\nFor bug 1570748. I'm going to duplicate this bug against bug 1570748 - if it's not the same issue, please re-open and explain why.", 
            "date_created": "2016-06-14 18:08:16.525830+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Hi, Matt Riedemann\nThank you for comment.\n\nI think this is not the same issue with bug 1570748.\n\nIn bug 1570748, only resize-revert bug is fixed and above issue is for nova migrate.\n(I reported bug 1570748 and I wrote that issue can be reproduced in nova resize but actually that was nova migrate. So the people who tested that couldn't reproduce the issue for \"nova resize\".)\n\nWhen \"nova resize\" is requested there is no problem because there is flavor.\n : nova resize <server> <flavor>\n\nBut, when \"nova migrate\" is requested it can be error state because there is no flavor.\n : nova migrate <server>\n\nSo, please check again this. You can simply reproduce this with above steps.\nThank you.", 
            "date_created": "2016-06-15 04:17:09.369103+00:00", 
            "author": "https://api.launchpad.net/1.0/~raymon-ha"
        }, 
        {
            "content": "Hi, Matt Riedemann\nThank you for comment.\n\nI think this is not the same issue with bug 1570748.\n\nIn bug 1570748, only resize-revert bug is fixed and above issue is for nova migrate.\n(I reported bug 1570748 and I wrote that issue can be reproduced in nova resize but actually that was nova migrate. So the people who tested that couldn't reproduce the issue for \"nova resize\".)\n\nWhen \"nova resize\" is requested there is no problem because there is flavor.\n : nova resize <server> <flavor>\n\nBut, when \"nova migrate\" is requested it can be error state because there is no flavor.\n : nova migrate <server>\n\nSo, please check again this. You can simply reproduce this with above steps.\nThank you.", 
            "date_created": "2016-06-15 04:20:12.235447+00:00", 
            "author": "https://api.launchpad.net/1.0/~raymon-ha"
        }, 
        {
            "content": "Hi,\n\nI tried to reproduce the bug with the above steps in current master(Newton). I couldn't reproduce the issue, i didn't get the error \"Flavor could not be found\". I haven't tried with kilo though.", 
            "date_created": "2016-06-15 17:20:39.294149+00:00", 
            "author": "https://api.launchpad.net/1.0/~anusha-unnam"
        }, 
        {
            "content": "This can't be reproduced in master branch as of today.", 
            "date_created": "2016-07-13 07:05:31.312666+00:00", 
            "author": "https://api.launchpad.net/1.0/~oss-xzdong"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2016-09-12 04:17:15.855325+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2016-09-12 04:17:18.152016+00:00"
}