{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 09:03:37.705969+00:00", 
    "description": "nova configuration:\n\n[ephemeral_storage_encryption]\nenabled = True\ncipher = aes-xts-plain64\nkey_size = 512\n\n[default]\n# use lvm as images_type                                                                                                                       |\nimages_type=lvm                                                                                                                                |\n# use that volume group                                                                                                                        |\n# /opt/stack/data/stack-volumes-default-backing-file                                                                                           |\nimages_volume_group=stack-volumes-default                                                                                                      |\n                                           \nreproduce:\n\n+--------------------------------------+-------+--------+------------+-------------+----------+\nroot@taget-ThinkStation-P300:/opt/stack/nova# nova boot --security-groups default  --key-name testkey --image 57b26b8f-0e8c-4ffd-87b9-0177e6331\nb29 --nic net-id=e1d6382e-0e01-4172-9772-19d83058f8f3 --flavor 1 test3\n\nroot@taget-ThinkStation-P300:/opt/stack/nova# nova delete test3\n\nroot@taget-ThinkStation-P300:/opt/stack/nova# nova list\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| ID                                   | Name  | Status | Task State | Power State | Networks |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| 9ac19e94-06e0-42c9-bbb5-aff44a70959e | test1 | ERROR  | deleting   | NOSTATE     |          |\n| 6b8c201c-6e83-4eed-a12e-190e2fa9c1a5 | test2 | ERROR  | deleting   | NOSTATE     |          |\n| d58b12ca-f983-47b8-93d8-a570fe4458d0 | test3 | ERROR  | -          | Shutdown    |          |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n\n\n\n\n2015-08-20 15:52:22.113 ERROR oslo_messaging.rpc.dispatcher [req-5a58977e-04d6-47d4-b962-a98601d400d6 admin admin] Exception during message handling: Failed to remove volume(s): (Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf lvremove -f /dev/stack-volumes-default/d58b12ca-f983-47b8-93d8-a570fe4458d0_disk\nExit code: 5\nStdout: u''\nStderr: u'  WARNING: Ignoring duplicate config node: global_filter (seeking global_filter)\\n  WARNING: Ignoring duplicate config node: global_filter (seeking global_filter)\\n  Logical volume stack-volumes-default/d58b12ca-f983-47b8-93d8-a570fe4458d0_disk is used by another device.\\n')\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 119, in __exit__\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 345, in decorated_function\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance_uuid=instance_uuid)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 119, in __exit__\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 316, in decorated_function", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1486880", 
    "owner": "https://api.launchpad.net/1.0/~taget-9", 
    "id": 1486880, 
    "index": 1798, 
    "openned": "2015-08-20 07:57:10.141377+00:00", 
    "created": "2015-08-20 07:57:10.141377+00:00", 
    "title": "Can't delete an instance if boot from  encryption volume ", 
    "comments": [
        {
            "content": "nova configuration:\n\n[ephemeral_storage_encryption]\nenabled = True\ncipher = aes-xts-plain64\nkey_size = 512\n\n[default]\n# use lvm as images_type                                                                                                                       |\nimages_type=lvm                                                                                                                                |\n# use that volume group                                                                                                                        |\n# /opt/stack/data/stack-volumes-default-backing-file                                                                                           |\nimages_volume_group=stack-volumes-default                                                                                                      |\n                                           \nreproduce:\n\n+--------------------------------------+-------+--------+------------+-------------+----------+\nroot@taget-ThinkStation-P300:/opt/stack/nova# nova boot --security-groups default  --key-name testkey --image 57b26b8f-0e8c-4ffd-87b9-0177e6331\nb29 --nic net-id=e1d6382e-0e01-4172-9772-19d83058f8f3 --flavor 1 test3\n\nroot@taget-ThinkStation-P300:/opt/stack/nova# nova delete test3\n\nroot@taget-ThinkStation-P300:/opt/stack/nova# nova list\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| ID                                   | Name  | Status | Task State | Power State | Networks |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| 9ac19e94-06e0-42c9-bbb5-aff44a70959e | test1 | ERROR  | deleting   | NOSTATE     |          |\n| 6b8c201c-6e83-4eed-a12e-190e2fa9c1a5 | test2 | ERROR  | deleting   | NOSTATE     |          |\n| d58b12ca-f983-47b8-93d8-a570fe4458d0 | test3 | ERROR  | -          | Shutdown    |          |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n\n\n\n\n2015-08-20 15:52:22.113 ERROR oslo_messaging.rpc.dispatcher [req-5a58977e-04d6-47d4-b962-a98601d400d6 admin admin] Exception during message handling: Failed to remove volume(s): (Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf lvremove -f /dev/stack-volumes-default/d58b12ca-f983-47b8-93d8-a570fe4458d0_disk\nExit code: 5\nStdout: u''\nStderr: u'  WARNING: Ignoring duplicate config node: global_filter (seeking global_filter)\\n  WARNING: Ignoring duplicate config node: global_filter (seeking global_filter)\\n  Logical volume stack-volumes-default/d58b12ca-f983-47b8-93d8-a570fe4458d0_disk is used by another device.\\n')\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 89, in wrapped\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     payload)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 119, in __exit__\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 72, in wrapped\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 345, in decorated_function\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance_uuid=instance_uuid)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 119, in __exit__\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-08-20 15:52:22.113 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 316, in decorated_function", 
            "date_created": "2015-08-20 07:57:10.141377+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "related changes: Change-Id: Ifb20655c32896b640672917e3840add81b136780\n\n\n", 
            "date_created": "2015-08-20 08:00:07.653411+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/216123", 
            "date_created": "2015-08-24 06:59:17.866246+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/216123\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=891984c8f58fb1e7efd92b8a3f9b4e06f0a9bbff\nSubmitter: Jenkins\nBranch:    master\n\ncommit 891984c8f58fb1e7efd92b8a3f9b4e06f0a9bbff\nAuthor: Eli Qiao <email address hidden>\nDate:   Mon Aug 24 14:27:30 2015 +0800\n\n    Pass block_device_info when delete an encrypted lvm\n    \n    This is a regression bug, in Ifb20655c32896b640672917e3840add81b136780,\n    we made get_instance_disk_info() conservative, it requires block_device_info\n    if disk_type is `block`.\n    \n    But currently, in _detach_encrypted_volumes, we don't pass bdi when calling\n    get_instance_disk_info, so it returns nothing, and nova doesn't delete the\n    encryptor volume, and failed to delete the lvm when deleting instance.\n    \n    Co-Authored-By: LisaLi <email address hidden>\n    Closes-Bug: #1486880\n    Change-Id: Ibc7e4a3c0e98dc70f7bd30d789069ba27eec7d76\n", 
            "date_created": "2015-09-17 21:15:57.383239+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-09-24 07:01:17.014961+00:00"
}