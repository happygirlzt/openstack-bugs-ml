{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:59:46.577459+00:00", 
    "description": "When resizing from a flavor with no ephemeral disk to a flavor which includes one an error is raise due to a migrated ephemeral disk not being found.  The migration code needs to consider the original flavor when looking for migrated ephemeral disks.\n\n\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     import_root=import_root)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/vm_utils.py\", line 2532, in import_all_migrated_disks\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     eph_vdis = _import_migrate_ephemeral_disks(session, instance)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/vm_utils.py\", line 2554, in _import_migrate_ephemeral_disks\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     vdi_label)     \n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/vm_utils.py\", line 2566, in _import_migrated_vhds\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     sr_path=get_sr_path(session), uuid_stack=_make_uuid_stack())\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 227, in call_plugin_serialized\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     rv = self.call_plugin(plugin, fn, params)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 223, in call_plugin \n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     self.host_ref, plugin, fn, args)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 297, in _unwrap_plugin_exceptions\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     return func(*args, **kwargs)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/XenAPI.py\", line 229, in __call__\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     return self.__send(self.__name, args)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     result = _parse_result(getattr(self, methodname)(*full_params))\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     raise Failure(result['ErrorDescription'])\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d] Failure: ['XENAPI_PLUGIN_FAILURE', 'move_vhds_into_sr', 'OSError', \"[Errno 2] No such file or directory: '/images/instance38a0406d-1ba0f514764d_ephemeral_1'\"]", 
    "tags": [
        "resize", 
        "xen"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1488635", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1488635, 
    "index": 6992, 
    "openned": "2015-08-25 19:22:41.828092+00:00", 
    "created": "2015-08-25 19:22:41.828092+00:00", 
    "title": "xen: resize assumes an ephemeral was migrated if the new flavor has one", 
    "comments": [
        {
            "content": "When resizing from a flavor with no ephemeral disk to a flavor which includes one an error is raise due to a migrated ephemeral disk not being found.  The migration code needs to consider the original flavor when looking for migrated ephemeral disks.\n\n\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     import_root=import_root)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/vm_utils.py\", line 2532, in import_all_migrated_disks\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     eph_vdis = _import_migrate_ephemeral_disks(session, instance)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/vm_utils.py\", line 2554, in _import_migrate_ephemeral_disks\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     vdi_label)     \n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/vm_utils.py\", line 2566, in _import_migrated_vhds\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     sr_path=get_sr_path(session), uuid_stack=_make_uuid_stack())\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 227, in call_plugin_serialized\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     rv = self.call_plugin(plugin, fn, params)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 223, in call_plugin \n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     self.host_ref, plugin, fn, args)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 297, in _unwrap_plugin_exceptions\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     return func(*args, **kwargs)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/XenAPI.py\", line 229, in __call__\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     return self.__send(self.__name, args)\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     result = _parse_result(getattr(self, methodname)(*full_params))\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]   File \"/opt/rackstack/rackstack.348.13/nova/lib/python2.7/site-packages/XenAPI.py\", line 203, in _parse_result\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d]     raise Failure(result['ErrorDescription'])\n2015-08-20 14:38:07.744 23025 ERROR nova.utils [instance: 38a0406d-1ba0f514764d] Failure: ['XENAPI_PLUGIN_FAILURE', 'move_vhds_into_sr', 'OSError', \"[Errno 2] No such file or directory: '/images/instance38a0406d-1ba0f514764d_ephemeral_1'\"]", 
            "date_created": "2015-08-25 19:22:41.828092+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/217176", 
            "date_created": "2015-08-26 14:06:02.384702+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/217176\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=773408408cbace35957390811df33462cdc73e7d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 773408408cbace35957390811df33462cdc73e7d\nAuthor: Andrew Laski <email address hidden>\nDate:   Wed Aug 26 10:00:27 2015 -0400\n\n    Xen: import migrated ephemeral disk based on previous size\n    \n    When migrating an instance with the xenapi driver it copies the VHDs\n    over to the destination host and then imports them into the SR on that\n    host.  It was attempting to import ephemeral disks based on the size of\n    the ephemeral disk for the new flavor, not the old flavor being\n    migrated.  This caused a failure when the old flavor did not have an\n    ephemeral and the new flavor did so Nova was attempting to import an\n    ephemeral disk that didn't exist.\n    \n    Now ephemeral disks will be imported based on what the old flavor would\n    have migrated.\n    \n    Change-Id: I80485fd473e8b580cc4b0a537c716bf6202a5eb2\n    Closes-Bug: 1488635\n", 
            "date_created": "2015-08-28 06:47:47.311850+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-09-03 11:47:51.027634+00:00"
}