{
    "status": "Opinion", 
    "last_updated": "2015-04-01 14:08:28.642025+00:00", 
    "description": "There is a limitation where the name of the XenServer interface (PIF) used for VLANs and the name of the interface in the nova-network domU must be the same name, for example eth0.\n\nWhen using bonding, this should be bond0, then eth0 for the nova-network domU.", 
    "tags": [
        "xenserver"
    ], 
    "importance": "Wishlist", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1214865", 
    "owner": "None", 
    "id": 1214865, 
    "index": 2671, 
    "openned": "2013-08-21 12:15:20.435763+00:00", 
    "created": "2013-08-21 12:15:20.435763+00:00", 
    "title": "xenserver: VLAN mode in nova-network does not work with bonded nics", 
    "comments": [
        {
            "content": "There is a limitation where the name of the XenServer interface (PIF) used for VLANs and the name of the interface in the nova-network domU must be the name, for example eth0.\n\nWhen using bonding, this should be bond0, then eth0 for the nova-network domU.", 
            "date_created": "2013-08-21 12:15:20.435763+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Waiting for stack trace from m1n0x88", 
            "date_created": "2013-08-21 12:17:17.142573+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "The stack trace:\n\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf ip link add li\nnk bond0 name vlan1001 type vlan id 1001\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Exit code: 255\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Stdout: ''\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Stderr: 'Cannot find device \"bond0\"\\n'\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Traceback (most recent call last):\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc\n/amqp.py\", line 276, in _process_data\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc\n/dispatcher.py\", line 145, in dispatch\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\",\n line 266, in wrapped\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     return func(self, context, *args, **kwargs)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\",\n line 329, in allocate_for_instance\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     **kwargs)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\",\n line 266, in wrapped\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     return func(self, context, *args, **kwargs)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\",\n line 1028, in allocate_for_instance\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     requested_networks=requested_networks)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\",\n line 213, in _allocate_fixed_ips\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     vpn=vpn, address=address)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\",\n line 2071, in allocate_fixed_ip\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     self._setup_network_on_host(context, network)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\",\n line 2140, in _setup_network_on_host\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     self.l3driver.initialize_gateway(network)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/l3.py\", line\n 96, in initialize_gateway\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     gateway=(network_ref['gateway'] is not None))\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\n\", line 1079, in plug\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     return _get_interface_driver().plug(network, mac_address, gate\nway)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\n\", line 1118, in plug\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     mac_address)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\n\", line 1141, in ensure_vlan_bridge\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     bridge_interface, mac_address)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 795,\n in inner\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     retval = f(*args, **kwargs)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\n\", line 1155, in ensure_vlan\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     check_exit_code=[0, 2, 254])\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\n\", line 975, in _execute\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     return utils.execute(*cmd, **kwargs)\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 210,\n in execute\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]     cmd=' '.join(cmd))\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] ProcessExecutionError: Unexpected error while running command.\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf ip link add li\nnk bond0 name vlan1001 type vlan id 1001\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Exit code: 255\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Stdout: ''\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23] Stderr: 'Cannot find device \"bond0\"\\n'\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n2013-08-21 14:01:23 13803 TRACE nova.compute.manager [instance: bb124ec8-0383-4163-842b-b991f1098a23]\n", 
            "date_created": "2013-08-21 12:18:19.247432+00:00", 
            "author": "https://api.launchpad.net/1.0/~mbenitohoz"
        }, 
        {
            "content": "Made this wishlist, because the real fix is to use neutron.\n\nIt would probably just need another flag as an alterative to VLAN_INTERFACE, here:\nhttps://github.com/openstack/nova/blob/master/nova/virt/xenapi/vif.py#L77", 
            "date_created": "2013-08-21 12:19:14.621431+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Is this still an issue? Its been over a year since this was last updated.", 
            "date_created": "2014-09-09 22:48:32.241029+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }
    ], 
    "closed": "2015-04-01 14:08:26.088819+00:00"
}