{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 12:02:36.216366+00:00", 
    "description": "Alex Xu\treports on a related code review https://review.openstack.org/#/c/41647/\n\n\"\"\"\nXavier, When create vm as below, i got some error from nova-compute side:\n\n'{\"server\": {\"name\": \"vm3\", \"image_ref\": \"b8cd5faa-a65f-4e47-bfc8-68061574b428\", \"flavor_ref\": \"1\", \"max_count\": 1, \"min_count\": 1, \"os-block-device-mapping:block_device_mapping\": [{\"device_name\": \"/dev/vdc\", \"source_type\": \"blank\", \"destination_type\": \"local\", \"boot_index\": 0}], \"networks\": [{\"uuid\": \"b6ba34f1-5504-4aca-825b-04511c104802\"}]}}'\n\n2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] Traceback (most recent call last): 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/compute/manager.py\", line 1018, in _build_instance 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] set_access_ip=set_access_ip) 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/compute/manager.py\", line 1392, in _spawn 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] LOG.exception(_('Instance failed to spawn'), instance=instance) 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/compute/manager.py\", line 1388, in _spawn 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] block_device_info) 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1689, in spawn 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] admin_pass=admin_password) 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2002, in _create_image 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] size = eph['size'] * 1024 * 1024 * 1024 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] TypeError: unsupported operand type(s) for *: 'NoneType' and 'int'\n\nThat because I miss 'volume_size' in the request.\n\"\"\"\n\nI was also able to reproduce on devstack with latest master.", 
    "tags": [
        "compute"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1218861", 
    "owner": "https://api.launchpad.net/1.0/~ndipanov", 
    "id": 1218861, 
    "index": 3548, 
    "openned": "2013-08-30 11:39:53.767719+00:00", 
    "created": "2013-08-30 11:39:53.767719+00:00", 
    "title": "Nova compute throws an exception if ephemeral is passed wiithout size.", 
    "comments": [
        {
            "content": "Alex Xu\treports on a related code review https://review.openstack.org/#/c/41647/\n\n\"\"\"\nXavier, When create vm as below, i got some error from nova-compute side:\n\n'{\"server\": {\"name\": \"vm3\", \"image_ref\": \"b8cd5faa-a65f-4e47-bfc8-68061574b428\", \"flavor_ref\": \"1\", \"max_count\": 1, \"min_count\": 1, \"os-block-device-mapping:block_device_mapping\": [{\"device_name\": \"/dev/vdc\", \"source_type\": \"blank\", \"destination_type\": \"local\", \"boot_index\": 0}], \"networks\": [{\"uuid\": \"b6ba34f1-5504-4aca-825b-04511c104802\"}]}}'\n\n2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] Traceback (most recent call last): 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/compute/manager.py\", line 1018, in _build_instance 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] set_access_ip=set_access_ip) 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/compute/manager.py\", line 1392, in _spawn 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] LOG.exception(_('Instance failed to spawn'), instance=instance) 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/compute/manager.py\", line 1388, in _spawn 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] block_device_info) 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1689, in spawn 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] admin_pass=admin_password) 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2002, in _create_image 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] size = eph['size'] * 1024 * 1024 * 1024 2013-08-30 11:01:32.500 TRACE nova.compute.manager [instance: bc919048-049b-445a-a676-e037d7b1fe31] TypeError: unsupported operand type(s) for *: 'NoneType' and 'int'\n\nThat because I miss 'volume_size' in the request.\n\"\"\"\n\nI was also able to reproduce on devstack with latest master.", 
            "date_created": "2013-08-30 11:39:53.767719+00:00", 
            "author": "https://api.launchpad.net/1.0/~ndipanov"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/44669", 
            "date_created": "2013-09-02 09:57:49.125158+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/44669\nCommitted: http://github.com/openstack/nova/commit/a957beb94720ca3f171149155f9dcabd20e6141b\nSubmitter: Jenkins\nBranch:    master\n\ncommit a957beb94720ca3f171149155f9dcabd20e6141b\nAuthor: Nikola Dipanov <email address hidden>\nDate:   Mon Sep 2 11:49:08 2013 +0200\n\n    Interpret BDM None size field as 0 on compute side\n    \n    This patch makes sure that even if we receive an ephemeral or swap BDM\n    without size information - it is defaulted to 0 by the compute service\n    prior to booting the VM, as the size is expected to be present and an\n    integer number by the driver code that uses it.\n    \n    Closes-bug: #1218861\n    \n    Change-Id: Ic6fc15d1cf876aa4fd99e17c582c1ab55e3a18c1\n", 
            "date_created": "2013-09-05 03:53:29.072169+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-09-05 15:47:57.237118+00:00"
}