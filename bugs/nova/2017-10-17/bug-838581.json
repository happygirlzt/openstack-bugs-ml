{
    "status": "Fix Released", 
    "last_updated": "2014-12-03 09:18:52.942154+00:00", 
    "description": "Running rev 1514, getting this on instance build in XenServer.\n\n2011-09-01 02:38:04,374 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 98, in wrapped\n(nova.rpc): TRACE:     return f(*args, **kw)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 453, in run_instance\n(nova.rpc): TRACE:     self._run_instance(context, instance_id, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 392, in _run_instance\n(nova.rpc): TRACE:     requested_networks=requested_networks)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/api.py\", line 162, in allocate_for_instance\n(nova.rpc): TRACE:     'args': args})\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/__init__.py\", line 45, in call\n(nova.rpc): TRACE:     return get_impl().call(context, topic, msg)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 739, in call\n(nova.rpc): TRACE:     rv = list(rv)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 703, in __iter__\n(nova.rpc): TRACE:     raise result\n(nova.rpc): TRACE: RemoteError: AttributeError 'NoneType' object has no attribute '_keymap'\n(nova.rpc): TRACE: [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 620, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 462, in allocate_for_instance\\n    networks, vpn=vpn)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 971, in _allocate_fixed_ips_hack\\n    self.allocate_fixed_ip(context, instance_id, nw)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 653, in allocate_fixed_ip\\n    instance_id)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 343, in fixed_ip_associate_pool\\n    instance_id, host)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 100, in wrapper\\n    return f(*args, **kwargs)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 714, in fixed_ip_associate_pool\\n    with_lockmode(\\'update\\').\\\\\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1496, in first\\n    ret = list(self[0:1])\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1405, in __getitem__\\n    return list(res)\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1669, in instances\\n    fetch = cursor.fetchall()\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 2383, in fetchall\\n    l = self.process_rows(self._fetchall_impl())\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 2366, in process_rows\\n    keymap = metadata._keymap\\n', u\"AttributeError: 'NoneType' object has no attribute '_keymap'\\n\"]\n(nova.rpc): TRACE:", 
    "tags": [
        "server-o-rs", 
        "verification-done"
    ], 
    "importance": "High", 
    "heat": 42, 
    "link": "https://bugs.launchpad.net/nova/+bug/838581", 
    "owner": "https://api.launchpad.net/1.0/~blamar", 
    "id": 838581, 
    "index": 472, 
    "openned": "2011-09-01 04:30:49.175775+00:00", 
    "created": "2011-09-01 04:30:49.175775+00:00", 
    "title": "Failures in db_pool code: 'NoneType' object has no attribute '_keymap' or not returning rows.", 
    "comments": [
        {
            "content": "Running rev 1514, getting this on instance build in XenServer.\n\n2011-09-01 02:38:04,374 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 98, in wrapped\n(nova.rpc): TRACE:     return f(*args, **kw)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 453, in run_instance\n(nova.rpc): TRACE:     self._run_instance(context, instance_id, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 392, in _run_instance\n(nova.rpc): TRACE:     requested_networks=requested_networks)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/api.py\", line 162, in allocate_for_instance\n(nova.rpc): TRACE:     'args': args})\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/__init__.py\", line 45, in call\n(nova.rpc): TRACE:     return get_impl().call(context, topic, msg)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 739, in call\n(nova.rpc): TRACE:     rv = list(rv)\n(nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 703, in __iter__\n(nova.rpc): TRACE:     raise result\n(nova.rpc): TRACE: RemoteError: AttributeError 'NoneType' object has no attribute '_keymap'\n(nova.rpc): TRACE: [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 620, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 462, in allocate_for_instance\\n    networks, vpn=vpn)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 971, in _allocate_fixed_ips_hack\\n    self.allocate_fixed_ip(context, instance_id, nw)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 653, in allocate_fixed_ip\\n    instance_id)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 343, in fixed_ip_associate_pool\\n    instance_id, host)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 100, in wrapper\\n    return f(*args, **kwargs)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 714, in fixed_ip_associate_pool\\n    with_lockmode(\\'update\\').\\\\\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1496, in first\\n    ret = list(self[0:1])\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1405, in __getitem__\\n    return list(res)\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1669, in instances\\n    fetch = cursor.fetchall()\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 2383, in fetchall\\n    l = self.process_rows(self._fetchall_impl())\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 2366, in process_rows\\n    keymap = metadata._keymap\\n', u\"AttributeError: 'NoneType' object has no attribute '_keymap'\\n\"]\n(nova.rpc): TRACE:", 
            "date_created": "2011-09-01 04:30:49.175775+00:00", 
            "author": "https://api.launchpad.net/1.0/~antonym"
        }, 
        {
            "content": "My suspicion here is that fixed_ip_associate_pool is failing when being called in quick succession aka at the 'same time'. I believe this is what \"with_lockmode\" is supposed to prevent...but the SQLAlchemy documentation is very poor in this area.\n\nWe're using InnoDB tables are being used.", 
            "date_created": "2011-09-02 18:46:33.895979+00:00", 
            "author": "https://api.launchpad.net/1.0/~blamar"
        }, 
        {
            "content": "Arg, my guess is that the combination of SQLAlchemy + eventlet's db_pool is doing this? I'm going to have to look at this more closely but for now Ant, if you want to experiment...on the nova-network nodes just put --sql_max_pool=1 --sql_min_pool=1 to see if these errors go away.", 
            "date_created": "2011-09-02 18:53:32.115537+00:00", 
            "author": "https://api.launchpad.net/1.0/~blamar"
        }, 
        {
            "content": "That is odd, in mysql, with_lockmode is supposed to row lock and the ip should not be returned on the next query.  Perhaps there is some other race condition occurring?\n\nOn Sep 2, 2011, at 11:46 AM, Brian Lamar wrote:\n\n> My suspicion here is that fixed_ip_associate_pool is failing when being\n> called in quick succession aka at the 'same time'. I believe this is\n> what \"with_lockmode\" is supposed to prevent...but the SQLAlchemy\n> documentation is very poor in this area.\n> \n> We're using InnoDB tables are being used.\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/838581\n> \n> Title:\n>  'NoneType' object has no attribute '_keymap' on xenserver instance\n>  build\n> \n> Status in OpenStack Compute (Nova):\n>  New\n> \n> Bug description:\n>  Running rev 1514, getting this on instance build in XenServer.\n> \n>  2011-09-01 02:38:04,374 ERROR nova.rpc [-] Exception during message handling\n>  (nova.rpc): TRACE: Traceback (most recent call last):\n>  (nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 620, in _process_data\n>  (nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n>  (nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 98, in wrapped\n>  (nova.rpc): TRACE:     return f(*args, **kw)\n>  (nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 453, in run_instance\n>  (nova.rpc): TRACE:     self._run_instance(context, instance_id, **kwargs)\n>  (nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 392, in _run_instance\n>  (nova.rpc): TRACE:     requested_networks=requested_networks)\n>  (nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/api.py\", line 162, in allocate_for_instance\n>  (nova.rpc): TRACE:     'args': args})\n>  (nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/__init__.py\", line 45, in call\n>  (nova.rpc): TRACE:     return get_impl().call(context, topic, msg)\n>  (nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 739, in call\n>  (nova.rpc): TRACE:     rv = list(rv)\n>  (nova.rpc): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 703, in __iter__\n>  (nova.rpc): TRACE:     raise result\n>  (nova.rpc): TRACE: RemoteError: AttributeError 'NoneType' object has no attribute '_keymap'\n>  (nova.rpc): TRACE: [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/rpc/impl_kombu.py\", line 620, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 462, in allocate_for_instance\\n    networks, vpn=vpn)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 971, in _allocate_fixed_ips_hack\\n    self.allocate_fixed_ip(context, instance_id, nw)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 653, in allocate_fixed_ip\\n    instance_id)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 343, in fixed_ip_associate_pool\\n    instance_id, host)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 100, in wrapper\\n    return f(*args, **kwargs)\\n', u'  File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 714, in fixed_ip_associate_pool\\n    with_lockmode(\\'update\\').\\\\\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1496, in first\\n    ret = list(self[0:1])\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1405, in __getitem__\\n    return list(res)\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1669, in instances\\n    fetch = cursor.fetchall()\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 2383, in fetchall\\n    l = self.process_rows(self._fetchall_impl())\\n', u'  File \"/usr/lib/python2.6/dist-packages/sqlalchemy/engine/base.py\", line 2366, in process_rows\\n    keymap = metadata._keymap\\n', u\"AttributeError: 'NoneType' object has no attribute '_keymap'\\n\"]\n>  (nova.rpc): TRACE:\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/838581/+subscriptions\n\n", 
            "date_created": "2011-09-02 19:31:45+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Yup, this is fixed by adding a @utils.synchronized decorator on the DB API method which using SQLAlchemy's with_lockmode. What is happening SHOULD look something like this (queries have been simplified to protect my sanity):\n\n\nEventlet Greenthread #1 (green1)\nEventlet Greenthread #2 (green2)\n\n\ngreen1: START TRANSACTION;\ngreen2: START TRANSACTION;\ngreen1: SELECT * FROM fixed_ips WHERE instance_id is NULL LIMIT 1 FOR UPDATE;\ngreen2: SELECT * FROM fixed_ips WHERE instance_id is NULL LIMIT 1 FOR UPDATE;\n\nAt this point \"green2\" is 100% locked until...\n\ngreen1: UPDATE fixed_ips SET instance_id = '1' WHERE address = '192.168.0.0';\ngreen1: COMMIT;\n\nThen green2 is able to continue...\n\ngreen2: UPDATE fixed_ips SET instance_id = '1' WHERE address = '192.168.0.1';\ngreen2: COMMIT;\n\n\nThis very much should work, and is what we *should* being doing in this situation. However, since we're doing 'weird' things with SQLAlchemy + eventlet I don't exactly know which piece is failing (although it seems to be SQLAlchemy?).\n\nI'm going to see if I can investigate a little more, because I don't want to blindly 'fix' this without knowing what is going on, but the linked branch seems to fix all of the issues I can reproduce on my end.", 
            "date_created": "2011-09-06 16:58:29.186223+00:00", 
            "author": "https://api.launchpad.net/1.0/~blamar"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/678\nCommitted: http://github.com/openstack/nova/commit/f3dd56e916232e38e74d9e2f24ce9a738cac63cf\nSubmitter: Jenkins\nBranch:    master\n\n status fixcommitted\n done\n\ncommit f3dd56e916232e38e74d9e2f24ce9a738cac63cf\nAuthor: Brian Lamar <email address hidden>\nDate:   Mon Sep 26 11:52:21 2011 -0400\n\n    Removed db_pool complexities from nova.db.sqlalchemy.session. Fixes bug 838581.\n    \n    Change-Id: I9b1f4790fcdb890a5113b853f1b1483f3212c530\n", 
            "date_created": "2011-09-27 17:00:55+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Oops. I was trying to find out what \"fix released\" meant and did not realize I was changing the state the state of this ticket. It won't let me change it back.", 
            "date_created": "2011-09-27 19:10:46.690992+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "I patched my api.py to revert the db_pool complexities, but it still gives error like this when spawning 25+ instances at once:\n\n2011-10-06 16:36:58,945 DEBUG nova.network.manager [6bf528ce-4e3d-4061-bd3b-1d25602a59ef None None] Leased IP |10.0.0.24| from (pid=27883) lease_fixed_ip /usr/lib/python2.7/dist-packages/nova/network/manager.py:645\nERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 221, in allocate_for_instance\n(nova.rpc): TRACE:     ips = super(FloatingIP, self).allocate_for_instance(context, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 444, in allocate_for_instance\n(nova.rpc): TRACE:     requested_networks=requested_networks)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 171, in _allocate_fixed_ips\n(nova.rpc): TRACE:     vpn=vpn, address=address)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 615, in allocate_fixed_ip\n(nova.rpc): TRACE:     instance_id)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 347, in fixed_ip_associate_pool\n(nova.rpc): TRACE:     instance_id, host)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 101, in wrapper\n(nova.rpc): TRACE:     return f(*args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 724, in fixed_ip_associate_pool\n(nova.rpc): TRACE:     #             then this has concurrency issues\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1652, in first\n(nova.rpc): TRACE:     ret = list(self[0:1])\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1560, in __getitem__\n(nova.rpc): TRACE:     return list(res)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1823, in instances\n(nova.rpc): TRACE:     fetch = cursor.fetchall()\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2528, in fetchall\n(nova.rpc): TRACE:     l = self.process_rows(self._fetchall_impl())\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2497, in _fetchall_impl\n(nova.rpc): TRACE:     self._non_result()\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2502, in _non_result\n(nova.rpc): TRACE:     \"This result object does not return rows. \"\n(nova.rpc): TRACE: ResourceClosedError: This result object does not return rows. It has been closed automatically.\n(nova.rpc): TRACE:\nERROR nova.rpc [-] Returning exception This result object does not return rows. It has been closed automatically. to caller\n\n\n", 
            "date_created": "2011-10-06 15:12:50.070474+00:00", 
            "author": "https://api.launchpad.net/1.0/~bas-t"
        }, 
        {
            "content": "Hi,\n  I've just uploaded a ppa build of nova to https://launchpad.net/~smoser/+archive/ppa with a patch pulled back from trunk which is reported to fix this issue.\n  Could someone listening here please try to with my ppa build and report back if that fixes your problem.\n\n  To do this, simply run the following on your openstack systems.\n  sudo apt-add-repository ppa:smoser/ppa\n  sudo apt-get update\n  sudo apt-get install nova\n\nThen do whatever you did that would previously cause the failure.\n\nThanks.", 
            "date_created": "2011-10-09 23:56:04.862935+00:00", 
            "author": "https://api.launchpad.net/1.0/~smoser"
        }, 
        {
            "content": "Hi Scott,\n\nJust tested your PPA, and it seems to work fine now. I created 40 instances simultaneously, and it worked out fine now. What are the changes you made?\n\nThanks,\n\nBas\n", 
            "date_created": "2011-10-10 12:01:25.667599+00:00", 
            "author": "https://api.launchpad.net/1.0/~bas-t"
        }, 
        {
            "content": "bas-t,\n https://code.launchpad.net/~smoser/nova/lp838581/+merge/78528\nhas the changes i made.\n\nWe've ", 
            "date_created": "2011-10-10 18:18:24.483399+00:00", 
            "author": "https://api.launchpad.net/1.0/~smoser"
        }, 
        {
            "content": "I upgraded from Scott's ppa and still see the signs of bug 855030:\n\nAMQPChannelException: (404, u\"NOT_FOUND - no exchange '4b0a4421eb4a44ce96ce5f71c8523d16' in vhost '/'\", (60, 40), 'Channel.basic_publish')\n\nI looked at  /usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/session.py and verified that it had the change mentioned in Scott's last comment. Many vms are created successfully but eventually this always happens to me when I create multiple instances with a single euca-run-instances command. I cannot understand why others do not see this problem. I will reopen that bug.", 
            "date_created": "2011-10-10 19:02:00.542335+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "> on the nova-network nodes just put --sql_max_pool=1 --sql_min_pool=1 to see if these errors go away.\n\nTried that, but got same exceptions. Noticed that simultaneous connections exist anyway, opened lp872780.", 
            "date_created": "2011-10-12 11:09:51.023023+00:00", 
            "author": "https://api.launchpad.net/1.0/~chemikadze"
        }, 
        {
            "content": "Hello Antony, or anyone else affected,\n\nAccepted nova into oneiric-proposed, the package will build now and be available in a few hours. Please test and give feedback here. See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed. Thank you in advance!", 
            "date_created": "2011-10-14 08:17:48.578531+00:00", 
            "author": "https://api.launchpad.net/1.0/~pitti"
        }, 
        {
            "content": "This bug was fixed in the package nova - 2011.3-0ubuntu7\n\n---------------\nnova (2011.3-0ubuntu7) precise; urgency=low\n\n  [Scott Moser]\n  * Removed db_pool complexities from nova.db.sqlalchemy.session (LP: #838581)\n\n  [Chuck Short]\n  * debian/patches/fix-iscsi-target-path.patch: Fix ISCSI target path patch.\n    (LP: #871278)\n  * debian/control: Either install xen-hypervisor-4.1-amd64 or\n    xen-hypervisor-4.1-i386 for nova-compute-xen. (LP: #873243)\n -- Dave Walker (Daviey) <email address hidden>   Sun, 16 Oct 2011 23:00:52 +0100", 
            "date_created": "2011-10-16 22:05:11.496679+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/937\nCommitted: http://github.com/openstack/nova/commit/1a5e3e0c4cc2a3bf55331d46f702b980af1fbf97\nSubmitter: Jenkins\nBranch:    stable/diablo\n\n status fixcommitted\n done\n\ncommit 1a5e3e0c4cc2a3bf55331d46f702b980af1fbf97\nAuthor: Brian Lamar <email address hidden>\nDate:   Mon Sep 26 11:52:21 2011 -0400\n\n    Removed db_pool complexities from nova.db.sqlalchemy.session. Fixes bug 838581.\n    \n    (cherry picked from commit f3dd56e916232e38e74d9e2f24ce9a738cac63cf)\n    \n    Change-Id: I96442f9c9eeddc48ce8307da93ff289e3d679553\n", 
            "date_created": "2011-10-19 08:26:58+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "oneiric-proposed has been superseded by the 2011.3-0ubuntu6.2 security update.", 
            "date_created": "2011-10-25 17:15:11.351278+00:00", 
            "author": "https://api.launchpad.net/1.0/~jdstrand"
        }, 
        {
            "content": "Dropping Ubuntu Oneiric upload back to Inprogress as the security upload superseeded it.\n\nThanks.", 
            "date_created": "2011-11-17 14:50:30.196834+00:00", 
            "author": "https://api.launchpad.net/1.0/~davewalker"
        }, 
        {
            "content": "Just wanted to say the fix in Scott's pap worked for me.\n\nK", 
            "date_created": "2011-12-13 21:45:32.050486+00:00", 
            "author": "https://api.launchpad.net/1.0/~marzubus"
        }, 
        {
            "content": "Hello Antony, or anyone else affected,\n\nAccepted nova into oneiric-proposed, the package will build now and be available in a few hours. Please test and give feedback here. See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed. Thank you in advance!", 
            "date_created": "2011-12-19 14:54:15.353321+00:00", 
            "author": "https://api.launchpad.net/1.0/~pitti"
        }, 
        {
            "content": "I've tested the package in oneiric-proposed and it fixed the issue. Thanks!", 
            "date_created": "2012-02-02 23:59:29.378936+00:00", 
            "author": "https://api.launchpad.net/1.0/~tellis"
        }, 
        {
            "content": "I know this is an old bug, but I'm pretty confident now that the problem isn't in db_pool, just that the increased concurrency exposed bugs in nova. This was complicated by bugs in SQLAlchemy (since fixed) and in MySQLdb (which I've opened up a bug report and supplied a patch) that masked the real bug in nova.\n\nThe \"'NoneType' object has no attribute '_keymap'\" exception is most likely caused by a bug in SQLAlchemy that has been fixed for a while. I was only able to reproduce this with older versions of SQLAlchemy, whereas upgrading to a recent version results in the \"ResourceClosedError: This result object does not return rows. It has been closed automatically.\" exception.\n\nThe exception is generated by SQLAlchemy, but is ultimately a bug in MySQLdb, where it doesn't always raise an exception correctly when it is received by the server. For some reason, with subtle changes to the query, errors can happen at different points in the protocol and MySQLdb doesn't handle it correctly if the error is received when calling mysql_store_result().\n\nI opened up this bug report and attached a patch to fix the bug in MySQLdb:\n\nhttps://sourceforge.net/tracker/?func=detail&aid=3546166&group_id=22307&atid=374932\n\nAfter upgrading SQLAlchemy and fixing MySQLdb, you'll see the real problem, which is likely this exception:\n\n\"OperationError: Deadlock found when trying to get lock; try restarting transaction\"\n\nAt least that was the case with the quota reservation code, tracked by this bug:\n\nhttps://bugs.launchpad.net/nova/+bug/1026709\n\nI strongly suspect these other cases are similar bugs with incorrect locking since at least the fixed_ip code uses with_lockmode as well.", 
            "date_created": "2012-07-20 01:29:33.566129+00:00", 
            "author": "https://api.launchpad.net/1.0/~johannes.erdfelt"
        }, 
        {
            "content": "oneiric has seen the end of its life and is no longer receiving any updates. Marking the oneiric task for this ticket as \"Won't Fix\".", 
            "date_created": "2014-12-03 09:18:45.035534+00:00", 
            "author": "https://api.launchpad.net/1.0/~r0lf"
        }
    ], 
    "closed": "2011-11-17 09:53:51.006484+00:00"
}