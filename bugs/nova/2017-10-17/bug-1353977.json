{
    "status": "Invalid", 
    "last_updated": "2015-04-01 14:06:26.903536+00:00", 
    "description": "Test Environment:\n\u00a0\u00a0\u00a0\u00a0\u00a0VMware vCenter version: 5.1\n\u00a0\u00a0\u00a0\u00a0\u00a0Image: Sparse + ide\n\nLog:\n-------\n2014-08-07 07:49:18.949 25720 WARNING nova.virt.vmwareapi.driver [-] Task [CopyVirtualDisk_Task] (returnval){\n\u00a0\u00a0\u00a0value = \"task-4469\"\n\u00a0\u00a0\u00a0_type = \"Task\"\n\u00a0} status: error A specified parameter was not correct.\nfileType\n2014-08-07 07:49:18.950 25720 WARNING nova.virt.vmwareapi.error_util [-] Fault InvalidArgument not matched.\n2014-08-07 07:49:18.950 25720 ERROR nova.compute.manager [req-8f4578d9-834d-4e4d-a309-f4d117cc7a13 None] [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf] Instance failed to spawn\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf] Traceback (most recent call last):\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2111, in _build_resources\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]     yield resources\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1997, in _build_and_run_instance\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]     block_device_info=block_device_info)\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 643, in spawn\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]     admin_password, network_info, block_device_info)\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 399, in spawn\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]     copy_spec)\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vm_util.py\", line 1312, in copy_virtual_disk\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]     session._wait_for_task(vmdk_copy_task)\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 1013, in _wait_for_task\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]     ret_val = done.wait()\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 120, in wait\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]     return hubs.get_hub().switch()\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 187, in switch\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf]     return self.greenlet.switch()\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf] VMwareDriverException: A specified parameter was not correct.\n2014-08-07 07:49:18.950 25720 TRACE nova.compute.manager [instance: 069fc3ba-52cd-44fe-9035-7551d70f2daf] fileType\n---------\n\nThe following code causes this issue. When disk_type is 'sparse' and adapter_type is 'ide' copy_spec will be set as None.\nAPI CopyVirtualDisk_Task: If destSpec not specified, a preallocated format and 'busLogic' adapter type is assume. So adapter_type is force modified from 'ide' to 'busLogic'.\n\n----from vmops.py\n\n\u00a0\u00a0\u00a0\u00a0\u00a0if not is_iso and disk_type == \"sparse\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# Copy the sparse virtual disk to a thin virtual disk\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0disk_type = \"thin\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0copy_spec = self.get_copy_virtual_disk_spec(client_factory,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0adapter_type,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0disk_type)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vm_util.copy_virtual_disk(self._session, dc_info.ref,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0str(sparse_ds_loc),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0str(upload_path_loc),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0copy_spec)\n---------------", 
    "tags": [
        "vmware"
    ], 
    "importance": "Undecided", 
    "heat": 24, 
    "link": "https://bugs.launchpad.net/nova/+bug/1353977", 
    "owner": "None", 
    "id": 1353977, 
    "index": 6326, 
    "openned": "2014-08-07 11:59:14.889864+00:00", 
    "created": "2014-08-07 11:59:14.889864+00:00", 
    "title": "VMware vCenter Driver copy_virtual_disk failed with fileType error", 
    "comments": [
        {
            "content": "Test Environment:\n     VMware", 
            "date_created": "2014-08-07 11:59:14.889864+00:00", 
            "author": "https://api.launchpad.net/1.0/~faguo"
        }, 
        {
            "content": "Hi, \n\nThe copy operation invoke through VC is intentionally passed a null copy_spec. That in itself should not be the cause of the failure. Can you confirm the image you used in a monolithic sparse image. I tested with an ide sparse vmdk, and the embedded descriptor information (you can get that by doing head -20 mysparse.vmkd) reads:\n\nKDM6\n\n# Disk DescriptorFile\nversion=1\nencoding=\"UTF-8\"\nCID=1e521528\nparentCID=ffffffff\nisNativeSnapshot=\"no\"\ncreateType=\"monolithicSparse\"\n\n# Extent description\nRW 524288 SPARSE \"dsl-disk1.vmdk\"\n\n# The Disk Data Base\n#DDB\n\nddb.adapterType = \"ide\"\n\nThis disk spawns fine for me.\n\nI used the following to import the image:\nglance image-create --name=msp_ide --disk-format=vmdk --container-format=bare --is-public=True --property vmware_adaptertype=\"ide\" --property vmware_disktype=\"sparse\" < msp_ide.vmdk\n\n\nThis is verified on upstream master code today. Please verify the image format and glance properties.\nIf the problem still persists, we may have to look into the VC/ESX logs to understand the root cause.", 
            "date_created": "2014-08-18 17:15:51.162797+00:00", 
            "author": "https://api.launchpad.net/1.0/~vui"
        }, 
        {
            "content": "Just to reiterate, when connecting to VC, the copy_spec should _always_ be None regardless of disktype/adapter type.\nThe error looks very much like what one would see if somehow copy_spec was not None. Please verify that copy_spec is indeed set to None if possible.", 
            "date_created": "2014-08-18 17:54:00.678058+00:00", 
            "author": "https://api.launchpad.net/1.0/~vui"
        }, 
        {
            "content": "Can you please retry with the latest code. If it preoduces lets open again an address. There has beena  ton of changes since last year...", 
            "date_created": "2015-04-01 14:06:26.393882+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }
    ], 
    "closed": "2015-04-01 14:06:01.516281+00:00"
}