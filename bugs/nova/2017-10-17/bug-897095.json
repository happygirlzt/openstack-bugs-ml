{
    "status": "Won't Fix", 
    "last_updated": "2014-09-15 11:53:06.300181+00:00", 
    "description": "I setup a bonding network. \nso, I modified a my nova.conf.\n--flat_interface=bond1\n--fixed_range=10.101.0.0/16\n\nWhen I execute 'nova-network', nova-network make a bridge(br100)\n\nnova@cn2:/$ ifconfig bond1\nbond1     Link encap:Ethernet  HWaddr 10:1f:74:2b:89:3c\n          inet6 addr: fe80::121f:74ff:fe2b:893c/64 Scope:Link\n          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1\n          RX packets:14538 errors:0 dropped:370 overruns:0 frame:0\n          TX packets:3353 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:1125692 (1.1 MB)  TX bytes:210490 (210.4 KB)\n\nnova@cn2:/$ ifconfig br100\nbr100     Link encap:Ethernet  HWaddr 10:1f:74:2b:89:3c\n          inet addr:10.101.0.6  Bcast:10.101.1.255  Mask:255.255.254.0\n          inet6 addr: fe80::acd0:d6ff:fe13:e495/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:3254 errors:0 dropped:38 overruns:0 frame:0\n          TX packets:352 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:170306 (170.3 KB)  TX bytes:28092 (28.0 KB)\n\nthen, I try to pinging to other compute node. but It can't connect.\n\nIn my search result, It maybe ARP problem for bridge on a bonded interface.\nhttp://ubuntuforums.org/showthread.php?t=835732\n\nThere are some solutions for this problem by turn on stp for bridge.\n\nnova@cn2:/$ sudo brctl stp br100 on\n\nafter that command, ping to other compute node is success.\n\n\n\nAnd I found nova source code about create a bride.\nIt's in 'nova/network/linux_net.py', I commented a source for stp option.\n\n 949         if not _device_exists(bridge):\n 950             LOG.debug(_('Starting Bridge interface for %s'), interface)\n 951             _execute('brctl', 'addbr', bridge, run_as_root=True)\n 952             _execute('brctl', 'setfd', bridge, 0, run_as_root=True)\n 953             # _execute('brctl setageing %s 10' % bridge, run_as_root=True)\n 954             #commented by jslee\n 955             #_execute('brctl', 'stp', bridge, 'off', run_as_root=True)\n 956             _execute('brctl', 'stp', bridge, 'on', run_as_root=True)\n 957             # (danwent) bridge device MAC address can't be set directly.\n 958             # instead it inherits the MAC address of the first device on the\n 959             # bridge, which will either be the vlan interface, or a\n 960             # physical NIC.\n 961             _execute('ip', 'link', 'set', bridge, 'up', run_as_root=True)\n\nA genuine source is turn off a stp option, Are there some reason to turn off stp option?", 
    "tags": [
        "bond", 
        "bonding", 
        "bridge"
    ], 
    "importance": "Wishlist", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/897095", 
    "owner": "None", 
    "id": 897095, 
    "index": 2421, 
    "openned": "2011-11-28 07:33:41.226039+00:00", 
    "created": "2011-11-28 07:33:41.226039+00:00", 
    "title": "Nova doesn't support bridge on bonded interfaces", 
    "comments": [
        {
            "content": "I setup a bonding network. \nso, I modified a my nova.conf.\n--flat_interface=bond1\n--fixed_range=10.101.0.0/16\n\nWhen I execute 'nova-network', nova-network make a bridge(br100)\n\nnova@cn2:/$ ifconfig bond1\nbond1     Link encap:Ethernet  HWaddr 10:1f:74:2b:89:3c\n          inet6 addr: fe80::121f:74ff:fe2b:893c/64 Scope:Link\n          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1\n          RX packets:14538 errors:0 dropped:370 overruns:0 frame:0\n          TX packets:3353 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:1125692 (1.1 MB)  TX bytes:210490 (210.4 KB)\n\nnova@cn2:/$ ifconfig br100\nbr100     Link encap:Ethernet  HWaddr 10:1f:74:2b:89:3c\n          inet addr:10.101.0.6  Bcast:10.101.1.255  Mask:255.255.254.0\n          inet6 addr: fe80::acd0:d6ff:fe13:e495/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:3254 errors:0 dropped:38 overruns:0 frame:0\n          TX packets:352 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:170306 (170.3 KB)  TX bytes:28092 (28.0 KB)\n\nthen, I try to pinging to other compute node. but It can't connect.\n\nIn my search result, It maybe ARP problem for bridge on a bonded interface.\nhttp://ubuntuforums.org/showthread.php?t=835732\n\nThere are some solutions for this problem by turn on stp for bridge.\n\nnova@cn2:/$ sudo brctl stp br100 on\n\nafter that command, ping to other compute node is success.\n\n\n\nAnd I found nova source code about create a bride.\nIt's in 'nova/network/linux_net.py', I commented a source for stp option.\n\n 949         if not _device_exists(bridge):\n 950             LOG.debug(_('Starting Bridge interface for %s'), interface)\n 951             _execute('brctl', 'addbr', bridge, run_as_root=True)\n 952             _execute('brctl', 'setfd', bridge, 0, run_as_root=True)\n 953             # _execute('brctl setageing %s 10' % bridge, run_as_root=True)\n 954             #commented by jslee\n 955             #_execute('brctl', 'stp', bridge, 'off', run_as_root=True)\n 956             _execute('brctl', 'stp', bridge, 'on', run_as_root=True)\n 957             # (danwent) bridge device MAC address can't be set directly.\n 958             # instead it inherits the MAC address of the first device on the\n 959             # bridge, which will either be the vlan interface, or a\n 960             # physical NIC.\n 961             _execute('ip', 'link', 'set', bridge, 'up', run_as_root=True)\n\nA genuine source is turn off a stp option, Are there some reason to turn off stp option?", 
            "date_created": "2011-11-28 07:33:41.226039+00:00", 
            "author": "https://api.launchpad.net/1.0/~hyangii"
        }, 
        {
            "content": "Is this still valid?", 
            "date_created": "2014-09-09 23:14:19.275907+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }
    ], 
    "closed": "2014-09-15 11:53:03.834425+00:00"
}