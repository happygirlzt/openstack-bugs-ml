{
    "status": "Expired", 
    "last_updated": "2017-05-01 04:17:30.309656+00:00", 
    "description": "Description: When a host goes down and instances on that host are deleted while the host is down, this request should be tracked in the database so that when the host comes back up it can scrub the delete request against the status of the active instance and delete it if necessary. The overall goal is for the delete to be processed so that any attached volumes return to an available state instead of being left in an in-use state. (attached to a non-existent instance)\n\nThis is being experienced while using Cloud Foundry. When the host goes down, Bosh attempts to re-create the instance along with associating any previous known volumes.\n\nThis has been tested on the following tag:\n10.1.18\n\nIf this was not an issue, I would expect the delete request to go through while the host was down and the system itself would clean up the mess once the host comes back online freeing up the volume for use immediately.\n\n(This is going to be tested in Liberty as well and further notes will be attached to the bug report)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1626702", 
    "owner": "None", 
    "id": 1626702, 
    "index": 7718, 
    "openned": "2016-09-22 19:12:02.338270+00:00", 
    "created": "2016-09-22 19:12:02.338270+00:00", 
    "title": "Instances deletes should be asynchronous with host availability", 
    "comments": [
        {
            "content": "Description: When a host goes down and instances on that host are deleted while the host is down, this request should be tracked in the database so that when the host comes back up it can scrub the delete request against the status of the active instance and delete it if necessary. The overall goal is for the delete to be processed so that any attached volumes return to an available state instead of being left in an in-use state. (attached to a non-existent instance)\n\nThis is being experienced while using Cloud Foundry. When the host goes down, Bosh attempts to re-create the instance along with associating any previous known volumes.\n\nThis has been tested on the following tag:\n10.1.18\n\nIf this was not an issue, I would expect the delete request to go through while the host was down and the system itself would clean up the mess once the host comes back online freeing up the volume for use immediately.\n\n(This is going to be tested in Liberty as well and further notes will be attached to the bug report)", 
            "date_created": "2016-09-22 19:12:02.338270+00:00", 
            "author": "https://api.launchpad.net/1.0/~wdarrenc"
        }, 
        {
            "content": "to help clarify:\n\nbosh is a tool used to deploy Cloud Foundry. It has a feature called the resurrector that watches VMs and if contact is lost, attempts to recreate them.\n\nCurrently, this is what happens:\n- a physical host with a given instance goes down\n- bosh notices the instance missing, issues a delete request \n- if the delete request is issued within 1-2 minutes of the host going offline, the delete request never completes and bosh gives up trying to recreate the instance\n- if the delete request is issued after that time, the delete request completes and bosh recreates the instance, but fails to reattach the volume to the new instance because the volume is still attached to the old (deleted) instance.\n\nThe fabric should accept the delete request, mark any attached volumes as detached, and return something like 204, handling any actual cleanup on physical nodes asynchronously.\n", 
            "date_created": "2016-09-22 19:36:24.932827+00:00", 
            "author": "https://api.launchpad.net/1.0/~craigbookwalter"
        }, 
        {
            "content": "Without logs I'm having a hard time seeing what's blowing up here, or in what version. This would be better if you could provide recreate steps using devstack with a more recent version of nova since liberty is going to be end of life in less than 2 months.\n\nAlso, by 'bosh recreates the instance', do you mean it evacuates the instance from the downed host or creates a new instance using the same image/flavor/volume/etc?\n\nBy the way, when the compute host is down during a delete request, the compute API code goes down a 'local delete' path which should detach the volume here:\n\nhttps://github.com/openstack/nova/blob/43826e458eefc4157b45d8a04422cbdcdec4f7ff/nova/compute/api.py#L1939\n\nIn that case the volume should be changed from 'available' to 'in-use'.\n\nThere have been known races in the local delete code in the compute API especially with volumes attached but work has gone into fixing that problem in the newton release of nova.", 
            "date_created": "2016-09-24 00:57:22.538235+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Sorry, correction in comment 2, the volume should be detached and go from 'in-use' to 'available', I had those state transitions backward.", 
            "date_created": "2016-09-24 00:58:49.015585+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "we're working on reproducing on a current fabric\n\n'bosh recreate' == deletes the vm, creates new VM with same image/flavor/(usually) IP, attaches any volumes that used to be attached to the old VM\n\nwe can also grab OpenStack logs -- which ones are best to grab?\n\n", 
            "date_created": "2016-09-26 19:47:32.841980+00:00", 
            "author": "https://api.launchpad.net/1.0/~craigbookwalter"
        }, 
        {
            "content": "npva-api would be a good start. If you think volumes could be an issue, then cinder-api as well.", 
            "date_created": "2016-10-02 01:49:49.446924+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "Below are the nova / cinder logs as requested:\nVOLUME ID: af657eb4-bdca-4d2c-8829-606e3a16e598 \nINSTANCE ID: edd84425-1a8f-4542-97c2-397374bfd521\nOPENSTACK RELEASE: JUNO\n################################################\n################################################\n\nNOVA_API:\n2016-10-03 15:22:07.619 41709 WARNING nova.compute.api [req-39abba41-8023-447b-9964-abddcf936d25 None] [instance: edd84425-1a8f-4542-97c2-397374bfd521] instance's host uclacpu102 is down, deleting from database\n2016-10-03 15:22:08.688 41709 INFO nova.osapi_compute.wsgi.server [req-39abba41-8023-447b-9964-abddcf936d25 None] 10.81.203.19,10.81.200.11 \"DELETE /v2/ceea62f29f424833b4f7418765f9414f/servers/edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 204 len: 198 time: 1.2727830\n2016-10-03 15:22:10.667 41716 INFO nova.osapi_compute.wsgi.server [-] 10.81.200.11 \"OPTIONS / HTTP/1.0\" status: 200 len: 429 time: 0.0009520\n2016-10-03 15:22:11.096 41716 INFO nova.osapi_compute.wsgi.server [req-0958a414-fb17-49d1-a87f-59b7c3b8969d None] 10.55.220.105,10.81.200.11 \"GET /v2/ HTTP/1.1\" status: 200 len: 620 time: 0.0075588\n2016-10-03 15:22:11.379 41716 INFO nova.osapi_compute.wsgi.server [req-28323d74-6810-48ff-90eb-a82f19685dd2 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers?name=edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 200 len: 206 time: 0.0451400\n2016-10-03 15:22:12.505 41716 INFO nova.osapi_compute.wsgi.server [req-62ccd0e8-f8aa-4b22-95e5-0baec584b465 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/flavors/detail.json HTTP/1.1\" status: 200 len: 6866 time: 0.0270731\n2016-10-03 15:22:13.078 41709 INFO nova.osapi_compute.wsgi.server [req-8c3a68fd-ca69-4f41-85c1-b645247d1796 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/fd27b75d-379c-47d7-8bdd-c0fd1a52fa5b.json HTTP/1.1\" status: 200 len: 1522 time: 0.0836358\n2016-10-03 15:22:14.258 41713 INFO nova.api.openstack.wsgi [req-8d09882e-d77c-4d19-b42d-bfa8700ea676 None] HTTP exception thrown: Instance could not be found\n2016-10-03 15:22:14.260 41713 INFO nova.osapi_compute.wsgi.server [req-8d09882e-d77c-4d19-b42d-bfa8700ea676 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 404 len: 286 time: 0.0586329\n2016-10-03 15:22:17.179 41717 INFO nova.osapi_compute.wsgi.server [req-ba990ff3-80cb-4246-b987-a03a8baba908 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f HTTP/1.1\" status: 404 len: 259 time: 0.2219639\n2016-10-03 15:22:17.430 41716 INFO nova.osapi_compute.wsgi.server [req-6aa74a7d-7e8b-4e8e-ae7d-ab0c26fc7cc1 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers?name=edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 200 len: 206 time: 0.0584500\n2016-10-03 15:22:18.473 41716 INFO nova.osapi_compute.wsgi.server [req-7cfbc38c-6be6-4cd5-ae5b-9c392c4f9bee None] 10.81.203.19,10.81.200.11 \"DELETE /v2/ceea62f29f424833b4f7418765f9414f/servers/fd27b75d-379c-47d7-8bdd-c0fd1a52fa5b HTTP/1.1\" status: 204 len: 198 time: 0.2282281\n2016-10-03 15:22:20.191 41711 INFO nova.osapi_compute.wsgi.server [req-2b12f0f3-4a9f-4b99-b8e0-a90507fcf314 None] 10.55.220.105,10.81.200.11 \"GET /v2/ HTTP/1.1\" status: 200 len: 620 time: 0.0065541\n2016-10-03 15:22:20.498 41711 INFO nova.osapi_compute.wsgi.server [req-93a5a243-e96e-4977-a218-e4c1671fa87b None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers?name=edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 200 len: 206 time: 0.0527880\n2016-10-03 15:22:22.126 41712 INFO nova.osapi_compute.wsgi.server [req-092abb71-4e88-4657-9e49-ad8d3dff2da4 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/flavors/detail.json HTTP/1.1\" status: 200 len: 6866 time: 0.0247021\n2016-10-03 15:22:22.669 41711 INFO nova.osapi_compute.wsgi.server [-] 10.81.200.11 \"OPTIONS / HTTP/1.0\" status: 200 len: 429 time: 0.0006709\n2016-10-03 15:22:22.727 41715 INFO nova.osapi_compute.wsgi.server [req-08b0213e-fa2c-46e3-8378-35a08d6fb924 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/04aa5a64-e8a5-4854-b7c6-405c12965c06.json HTTP/1.1\" status: 200 len: 1522 time: 0.0899260\n2016-10-03 15:22:23.593 41717 INFO nova.api.openstack.wsgi [req-e8673b00-9563-4305-9e2e-bbf6e22c1b52 None] HTTP exception thrown: Instance could not be found\n2016-10-03 15:22:23.595 41717 INFO nova.osapi_compute.wsgi.server [req-e8673b00-9563-4305-9e2e-bbf6e22c1b52 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 404 len: 286 time: 0.0573411\n2016-10-03 15:22:26.576 41717 INFO nova.osapi_compute.wsgi.server [req-87c06293-686a-4c63-b8ee-2ad5c0e7ac97 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f HTTP/1.1\" status: 404 len: 259 time: 0.0641780\n2016-10-03 15:22:26.934 41716 INFO nova.osapi_compute.wsgi.server [req-c28c9ff2-263c-454b-9d39-bd8ba4467a71 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers?name=edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 200 len: 206 time: 0.0512090\n2016-10-03 15:22:28.126 41707 INFO nova.osapi_compute.wsgi.server [req-f34c5e5d-19a5-4f37-912e-53c7e8b374a4 None] 10.81.203.19,10.81.200.11 \"DELETE /v2/ceea62f29f424833b4f7418765f9414f/servers/04aa5a64-e8a5-4854-b7c6-405c12965c06 HTTP/1.1\" status: 204 len: 198 time: 0.2470911\n2016-10-03 15:22:29.803 41707 INFO nova.osapi_compute.wsgi.server [req-a91f760d-9aa2-4934-a1e4-1edbdd044822 None] 10.55.220.105,10.81.200.11 \"GET /v2/ HTTP/1.1\" status: 200 len: 620 time: 0.0067019\n2016-10-03 15:22:30.078 41707 INFO nova.osapi_compute.wsgi.server [req-72aa770b-c6c0-45fd-993c-abc2b5f9d8af None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers?name=edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 200 len: 206 time: 0.0474391\n2016-10-03 15:22:31.825 41709 INFO nova.osapi_compute.wsgi.server [req-4092ec63-e72f-4844-917f-3956291338b8 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/flavors/detail.json HTTP/1.1\" status: 200 len: 6866 time: 0.0304329\n2016-10-03 15:22:32.446 41711 INFO nova.osapi_compute.wsgi.server [req-b9e887e2-6bf1-45d0-9ff1-704679d82060 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/ccfc3d76-d396-4b68-87fd-0885536e97e7.json HTTP/1.1\" status: 200 len: 1522 time: 0.1036649\n2016-10-03 15:22:32.866 41710 INFO nova.api.openstack.wsgi [req-31b369ad-e03b-4edf-bf67-2c76137ea47b None] HTTP exception thrown: Instance could not be found\n2016-10-03 15:22:32.867 41710 INFO nova.osapi_compute.wsgi.server [req-31b369ad-e03b-4edf-bf67-2c76137ea47b None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 404 len: 286 time: 0.0410140\n2016-10-03 15:22:34.671 41716 INFO nova.osapi_compute.wsgi.server [-] 10.81.200.11 \"OPTIONS / HTTP/1.0\" status: 200 len: 429 time: 0.0011809\n2016-10-03 15:22:35.817 41712 INFO nova.osapi_compute.wsgi.server [req-9b1991b6-9df2-49b5-ae67-b57ad34b2ab0 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f HTTP/1.1\" status: 404 len: 259 time: 0.0937991\n2016-10-03 15:22:36.045 41712 INFO nova.osapi_compute.wsgi.server [req-e5089adf-3b6f-43a8-ba17-d0e5703d48f5 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers?name=edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 200 len: 206 time: 0.0384259\n2016-10-03 15:22:37.842 41716 INFO nova.osapi_compute.wsgi.server [req-59283bdc-d8be-466f-a56a-b7100b328f1c None] 10.81.203.19,10.81.200.11 \"DELETE /v2/ceea62f29f424833b4f7418765f9414f/servers/ccfc3d76-d396-4b68-87fd-0885536e97e7 HTTP/1.1\" status: 204 len: 198 time: 0.2579820\n2016-10-03 15:22:38.816 41712 INFO nova.osapi_compute.wsgi.server [req-a0bd03b5-65a3-474e-baf9-5c51041e4355 None] 10.55.220.105,10.81.200.11 \"GET /v2/ HTTP/1.1\" status: 200 len: 620 time: 0.0082490\n2016-10-03 15:22:39.098 41712 INFO nova.osapi_compute.wsgi.server [req-f7e4bdc8-21e9-449f-a98c-0f88f0ee2692 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers?name=edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 200 len: 2\n06 time: 0.0501111\n2016-10-03 15:22:41.554 41709 INFO nova.osapi_compute.wsgi.server [req-a2a632b3-d0c3-404c-bc59-4389395dd79a None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/flavors/detail.json HTTP/1.1\" status: 200 len: 6866 time: 0.0289140\n2016-10-03 15:22:41.717 41713 INFO nova.osapi_compute.wsgi.server [req-68aef10e-c8fd-43a2-ac9c-c8ab4507d056 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f HTTP/1.1\" status: 404 len: 259 time: 0.0622771\n2016-10-03 15:22:41.893 41709 INFO nova.api.openstack.wsgi [req-02abd5d5-41fa-49ff-8ee2-f2ac6b424c50 None] HTTP exception thrown: Instance could not be found\n2016-10-03 15:22:41.894 41709 INFO nova.osapi_compute.wsgi.server [req-02abd5d5-41fa-49ff-8ee2-f2ac6b424c50 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 404 len: 286 time: 0.0500131\n2016-10-03 15:22:42.004 41709 INFO nova.osapi_compute.wsgi.server [req-f3fda2b6-d6ef-432a-8c02-065686d7de64 None] 10.55.220.105,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers?name=edd84425-1a8f-4542-97c2-397374bfd521 HTTP/1.1\" status: 200 len: 206 time: 0.0396869\n2016-10-03 15:22:46.675 41715 INFO nova.osapi_compute.wsgi.server [-] 10.81.200.11 \"OPTIONS / HTTP/1.0\" status: 200 len: 429 time: 0.0012758\n2016-10-03 15:22:47.313 41712 INFO nova.osapi_compute.wsgi.server [req-efb0d376-4a43-4b18-998b-524806c66fa6 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/fcee4e90-32ea-4502-90eb-b0ecb3746215.json HTTP/1.1\" status: 200 len: 1595 time: 0.1299479\n2016-10-03 15:22:51.195 41711 INFO nova.osapi_compute.wsgi.server [req-cbbccd5d-4109-43ef-b2fc-001b667e2a95 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/os-security-groups.json HTTP/1.1\" status: 200 len: 5327 time: 0.2970829\n2016-10-03 15:22:51.515 41712 INFO nova.osapi_compute.wsgi.server [req-0ef6a9f7-39c9-4417-bfa6-d0084e3ccd76 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/os-keypairs.json HTTP/1.1\" status: 200 len: 725 time: 0.0189409\n2016-10-03 15:22:57.297 41712 INFO nova.osapi_compute.wsgi.server [req-8d9b90dc-edfe-40db-b959-6862d184040d None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/79f4ff7f-53de-4601-a6f6-8ece565b3e0d.json HTTP/1.1\" status: 200 len: 1595 time: 0.1259189\n2016-10-03 15:22:58.678 41708 INFO nova.osapi_compute.wsgi.server [-] 10.81.200.11 \"OPTIONS / HTTP/1.0\" status: 200 len: 429 time: 0.0012372\n2016-10-03 15:23:10.682 41709 INFO nova.osapi_compute.wsgi.server [-] 10.81.200.11 \"OPTIONS / HTTP/1.0\" status: 200 len: 429 time: 0.0012181\n2016-10-03 15:23:22.683 41709 INFO nova.osapi_compute.wsgi.server [-] 10.81.200.11 \"OPTIONS / HTTP/1.0\" status: 200 len: 429 time: 0.0012689\n2016-10-03 15:23:24.446 41710 INFO nova.osapi_compute.wsgi.server [req-2a80ad36-df05-40ac-9331-ea20f88a2453 None] 10.81.203.19,10.81.200.11 \"GET /v2/ceea62f29f424833b4f7418765f9414f/servers/detail.json HTTP/1.1\" status: 200 len: 36097 time: 0.4547710\n################################################\n################################################\n\nNOVA_COMPUTE_LOGS:\n2016-10-03 15:23:50.527 27532 INFO nova.virt.libvirt.driver [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Deleting instance files /var/lib/nova/instances/edd84425-1a8f-4542-97c2-397374bfd521_del\n2016-10-03 15:23:50.528 27532 INFO nova.virt.libvirt.driver [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Deletion of /var/lib/nova/instances/edd84425-1a8f-4542-97c2-397374bfd521_del complete\n2016-10-03 15:25:58.294 27532 INFO nova.compute.manager [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Destroying instance with name label 'instance-0000100e' which is marked as DELETED but still present on host.\n2016-10-03 15:25:58.296 27532 AUDIT nova.compute.manager [req-64751536-29c9-44d6-a14f-6d049b6b8e27 None] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Terminating instance\n2016-10-03 15:25:58.953 27532 INFO nova.virt.libvirt.driver [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Instance destroyed successfully.\n2016-10-03 15:26:00.015 27532 INFO nova.virt.libvirt.driver [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Deletion of /var/lib/nova/instances/edd84425-1a8f-4542-97c2-397374bfd521_del complete\n2016-10-03 15:26:00.163 27532 ERROR nova.network.base_api [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Failed storing info cache\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521] Traceback (most recent call last):\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/network/base_api.py\", line 46, in update_instance_cache_with_nw_info\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     ic.save(update_cells=update_cells)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/objects/base.py\", line 189, in wrapper\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     ctxt, self, fn.__name__, args, kwargs)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/rpcapi.py\", line 364, in object_action\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     objmethod=objmethod, args=args, kwargs=kwargs)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     retry=self.retry)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     timeout=timeout, retry=retry)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 416, in send\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     retry=retry)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 407, in _send\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     raise result\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521] InstanceInfoCacheNotFound_Remote: Info cache for instance edd84425-1a8f-4542-97c2-397374bfd521 could not be found.\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521] Traceback (most recent call last):\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 400, in _object_dispatch\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     return getattr(target, method)(context, *args, **kwargs)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/objects/base.py\", line 204, in wrapper\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     return fn(self, ctxt, *args, **kwargs)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/objects/instance_info_cache.py\", line 91, in save\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     {'network_info': nw_info_json})\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/db/api.py\", line 872, in instance_info_cache_update\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     return IMPL.instance_info_cache_update(context, instance_uuid, values)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 143, in wrapper\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     return f(*args, **kwargs)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]   File \"/usr/local/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2434, in instance_info_cache_update\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]     instance_uuid=instance_uuid)\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521] InstanceInfoCacheNotFound: Info cache for instance edd84425-1a8f-4542-97c2-397374bfd521 could not be found.\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.163 27532 TRACE nova.network.base_api [instance: edd84425-1a8f-4542-97c2-397374bfd521]\n2016-10-03 15:26:00.166 27532 ERROR nova.compute.manager [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Failed to deallocate network for instance.\n2016-10-03 15:26:00.228 27532 WARNING nova.compute.manager [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] Periodic cleanup failed to delete instance: Info cache for instance edd84425-1a8f-4542-97c2-397374bfd521 could not be found.\nTraceback (most recent call last):\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 400, in _object_dispatch\n      return getattr(target, method)(context, *args, **kwargs)\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/objects/base.py\", line 204, in wrapper\n    return fn(self, ctxt, *args, **kwargs)\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/objects/instance_info_cache.py\", line 91, in save\n    {'network_info': nw_info_json})\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/db/api.py\", line 872, in instance_info_cache_update\n    return IMPL.instance_info_cache_update(context, instance_uuid, values)\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 143, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/usr/local/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2434, in instance_info_cache_update\n    instance_uuid=instance_uuid)\n\nInstanceInfoCacheNotFound: Info cache for instance edd84425-1a8f-4542-97c2-397374bfd521 could not be found.\n\n2016-10-03 15:26:13.949 27532 INFO nova.compute.manager [-] [instance: edd84425-1a8f-4542-97c2-397374bfd521] VM Stopped (Lifecycle Event)\n2016-10-03 15:26:14.076 27532 INFO nova.compute.manager [req-a449f8ca-00e3-4fd5-ae3a-d435fd700388 None] [instance: edd84425-1a8f-4542-97c2-397374bfd521] During _sync_instance_power_state the DB power_state (1) does not match the vm_power_state from the hypervisor (4). Updating power_state in the DB to match the hypervisor.\n################################################\n################################################\n\nCINDER_API_LOGS:\n2016-10-03 15:22:07.909 21157 INFO cinder.api.openstack.wsgi [req-18f4cc48-3ff6-4ba5-a617-8369e688668b 8575933031a04a4e9ae47fed476f4215 ceea62f29f424833b4f7418765f9414f - - -] POST http://10.81.200.5:8776/v1/ceea62f29f424833b4f7418765f9414f/volumes/af657eb4-bdca-4d2c-8829-606e3a16e598/action\n2016-10-03 15:22:07.937 21157 INFO oslo.messaging._drivers.impl_rabbit [req-18f4cc48-3ff6-4ba5-a617-8369e688668b 8575933031a04a4e9ae47fed476f4215 ceea62f29f424833b4f7418765f9414f - - -] Connecting to AMQP server on 10.81.200.238:5672\n2016-10-03 15:22:07.949 21157 INFO oslo.messaging._drivers.impl_rabbit [req-18f4cc48-3ff6-4ba5-a617-8369e688668b 8575933031a04a4e9ae47fed476f4215 ceea62f29f424833b4f7418765f9414f - - -] Connected to AMQP server on 10.81.200.238:5672\n2016-10-03 15:22:07.958 21157 INFO oslo.messaging._drivers.impl_rabbit [req-18f4cc48-3ff6-4ba5-a617-8369e688668b 8575933031a04a4e9ae47fed476f4215 ceea62f29f424833b4f7418765f9414f - - -] Connecting to AMQP server on 10.81.200.229:5672\n2016-10-03 15:22:07.968 21157 INFO oslo.messaging._drivers.impl_rabbit [req-18f4cc48-3ff6-4ba5-a617-8369e688668b 8575933031a04a4e9ae47fed476f4215 ceea62f29f424833b4f7418765f9414f - - -] Connected to AMQP server on 10.81.200.229:5672\n2016-10-03 15:22:08.002 21157 INFO cinder.api.openstack.wsgi [req-18f4cc48-3ff6-4ba5-a617-8369e688668b 8575933031a04a4e9ae47fed476f4215 ceea62f29f424833b4f7418765f9414f - - -] http://10.81.200.5:8776/v1/ceea62f29f424833b4f7418765f9414f/volumes/af657eb4-bdca-4d2c-8829-606e3a16e598/action returned with HTTP 202\n2016-10-03 15:22:08.003 21157 INFO eventlet.wsgi.server [req-18f4cc48-3ff6-4ba5-a617-8369e688668b 8575933031a04a4e9ae47fed476f4215 ceea62f29f424833b4f7418765f9414f - - -] 10.81.200.127,10.81.200.11 - - [03/Oct/2016 15:22:08] \"POST /v1/ceea62f29f424833b4f7418765f9414f/volumes/af657eb4-bdca-4d2c-8829-606e3a16e598/action HTTP/1.1\" 202 206 0.097226\n\n", 
            "date_created": "2016-10-10 17:00:46.095685+00:00", 
            "author": "https://api.launchpad.net/1.0/~gnieto"
        }, 
        {
            "content": "Note that the Nova version in question here is Juno, which has been EOL since 2015-12-07.\n\nI would expect the recreate steps for the current Nova version would be something like:\n\n  1. Create an instance\n  2. Kill the nova-compute process\n  3. Delete the instance\n  4. Check whether volumes are 'in-use' or 'available'\n\nThis may no longer be a bug present in the current version of Nova.", 
            "date_created": "2016-10-18 17:32:48.566145+00:00", 
            "author": "https://api.launchpad.net/1.0/~melwitt"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2016-12-18 04:17:31.096766+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "We have reproduced this bug in Liberty using the above steps, slightly modified:\n\n1. Create an instance\n2. Kill the nova-compute process\n=> 3. Wait until the compute shows as down on nova service-list\n4. Delete the instance\n5. Check whether volumes are 'in-use' or 'available'\n\nThe delete request will go through, and the volume will show as still attached to the deleted instance.", 
            "date_created": "2017-02-22 19:01:47.316804+00:00", 
            "author": "https://api.launchpad.net/1.0/~craigbookwalter"
        }, 
        {
            "content": "Attaching nova-compute logs for the above", 
            "date_created": "2017-02-22 19:02:28.575555+00:00", 
            "author": "https://api.launchpad.net/1.0/~craigbookwalter"
        }, 
        {
            "content": "Also I realize Liberty is also end of life, we will reproduce on another later fabric ASAP.", 
            "date_created": "2017-02-22 19:03:29.793908+00:00", 
            "author": "https://api.launchpad.net/1.0/~craigbookwalter"
        }, 
        {
            "content": "Can't reproduce behaviour on the master. See http://ix.io/nR9. Provide additional details, please.", 
            "date_created": "2017-03-01 10:28:35.095951+00:00", 
            "author": "https://api.launchpad.net/1.0/~avolkov"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2017-05-01 04:17:26.957621+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2017-05-01 04:17:27.908739+00:00"
}