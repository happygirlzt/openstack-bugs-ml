{
    "status": "Fix Released", 
    "last_updated": "2017-04-14 09:22:31.577896+00:00", 
    "description": "NFS driver Cinder CI jobs failed on following error\n\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server [req-70f771a4-6cd2-497d-8428-45ed14caa416 tempest-VolumesAdminNegativeTest-1024673784 tempest-VolumesAdminNegativeTest-1024673784] Exception during message handling\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 157, in _process_incoming\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 75, in wrapped\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     function_name, call_dict, binary)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 66, in wrapped\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 215, in decorated_function\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 203, in decorated_function\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4805, in attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     do_attach_volume(context, instance, driver_bdm)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return f(*args, **kwargs)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4803, in do_attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     bdm.destroy()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4800, in do_attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return self._attach_volume(context, instance, driver_bdm)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4823, in _attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.volume_api.unreserve_volume(context, bdm.volume_id)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4815, in _attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     do_driver_attach=True)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/block_device.py\", line 48, in wrapped\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     ret_val = method(obj, context, *args, **kwargs)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/block_device.py\", line 282, in attach\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     connector)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/block_device.py\", line 273, in attach\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     device_type=self['device_type'], encryption=encryption)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1204, in attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self._connect_volume(connection_info, disk_info, instance)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1145, in _connect_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     vol_driver.connect_volume(connection_info, disk_info, instance)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server TypeError: connect_volume() takes exactly 3 arguments (4 given)\n\n\nOn IRC I got to know that https://review.openstack.org/#/c/438970/ could be the culprit\n\nFailure CI logs are http://openstack-ci.tintri.com/tintri/refs-changes-59-448159-4/logs/screen-n-cpu.log.txt", 
    "tags": [], 
    "importance": "High", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1675584", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1675584, 
    "index": 2055, 
    "openned": "2017-03-23 22:18:11.599955+00:00", 
    "created": "2017-03-23 22:18:11.599955+00:00", 
    "title": "TypeError: connect_volume() takes exactly 3 arguments (4 given) for NFS Cinder drivers", 
    "comments": [
        {
            "content": "NFS driver Cinder CI jobs failed on following error\n\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server [req-70f771a4-6cd2-497d-8428-45ed14caa416 tempest-VolumesAdminNegativeTest-1024673784 tempest-VolumesAdminNegativeTest-1024673784] Exception during message handling\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 157, in _process_incoming\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 75, in wrapped\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     function_name, call_dict, binary)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/exception_wrapper.py\", line 66, in wrapped\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 215, in decorated_function\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 203, in decorated_function\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4805, in attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     do_attach_volume(context, instance, driver_bdm)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return f(*args, **kwargs)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4803, in do_attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     bdm.destroy()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4800, in do_attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     return self._attach_volume(context, instance, driver_bdm)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4823, in _attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.volume_api.unreserve_volume(context, bdm.volume_id)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/compute/manager.py\", line 4815, in _attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     do_driver_attach=True)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/block_device.py\", line 48, in wrapped\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     ret_val = method(obj, context, *args, **kwargs)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/block_device.py\", line 282, in attach\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     connector)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/block_device.py\", line 273, in attach\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     device_type=self['device_type'], encryption=encryption)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1204, in attach_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     self._connect_volume(connection_info, disk_info, instance)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 1145, in _connect_volume\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server     vol_driver.connect_volume(connection_info, disk_info, instance)\n2017-03-23 11:12:34.533 3875 ERROR oslo_messaging.rpc.server TypeError: connect_volume() takes exactly 3 arguments (4 given)\n\n\nOn IRC I got to know that https://review.openstack.org/#/c/438970/ could be the culprit\n\nFailure CI logs are http://openstack-ci.tintri.com/tintri/refs-changes-59-448159-4/logs/screen-n-cpu.log.txt", 
            "date_created": "2017-03-23 22:18:11.599955+00:00", 
            "author": "https://api.launchpad.net/1.0/~apoorvad"
        }, 
        {
            "content": "One more Cinder CI failed with the same conect_volume() error http://78.46.57.153:8081/refs-changes-59-448159-4/logs/screen-n-cpu.log.txt", 
            "date_created": "2017-03-23 22:28:19.481967+00:00", 
            "author": "https://api.launchpad.net/1.0/~apoorvad"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/449362", 
            "date_created": "2017-03-23 23:33:55.777083+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/449362\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=de7c0594d19666bf20755dd0b8a040eb6a1217c0\nSubmitter: Jenkins\nBranch:    master\n\ncommit de7c0594d19666bf20755dd0b8a040eb6a1217c0\nAuthor: Matt Riedemann <email address hidden>\nDate:   Thu Mar 23 23:33:45 2017 +0000\n\n    Revert \"libvirt: Pass instance to connect_volume and ...\"\n    \n    This reverts commit f0153fa4c87528e1dcbda8cba55d34ab7aec4e7a.\n    \n    This broke a whole set of FS-based volume drivers since it\n    didn't change the method signatures in those drivers to take\n    the new instance argument.\n    \n    I was working on adding them but then just decided this\n    isn't even used right now so it's faster to revert.\n    \n    When this is added back in, I want to see the\n    LibvirtBaseVolumeDriver class turned into an ABC and\n    the connect_volume and disconnect_volume methods turned\n    into abstractmethods in LibvirtBaseVolumeDriver so this\n    kind of thing does not happen again.\n    \n    Change-Id: If1ee6d6e4004750f80424ec54d7dabc564ec9e06\n    Closes-Bug: #1675584\n", 
            "date_created": "2017-03-24 04:58:14.988490+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b1 development milestone.", 
            "date_created": "2017-04-14 09:22:31.001636+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-03-24 04:58:12.586798+00:00"
}