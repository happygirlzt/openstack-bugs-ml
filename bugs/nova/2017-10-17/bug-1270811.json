{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:16:21.048059+00:00", 
    "description": "I found a testcase bug in nova/tests/api/openstack/compute/plugins/v3/test_availability_zone.py\n\n\u00a0\u00a0\u00a0\u00a0\u00a0def test_create_instance_with_availability_zone(self):\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0def create(*args, **kwargs):\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0self.assertIn('availability_zone', kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return old_create(*args, **kwargs)\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0old_create = compute_api.API.create\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0self.stubs.Set(compute_api.API, 'create', create)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0image_href = '76fa36fc-c930-4bf3-8c8a-ea2a2420deb6'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0flavor_ref = 'http://localhost/v3/flavors/3'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0body = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'server': {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'name': 'config_drive_test',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'image_ref': image_href,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'flavor_ref': flavor_ref,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'metadata': {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'hello': 'world',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'open': 'stack',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u2605  'availability_zone': \"nova\",\u2605\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0req = fakes.HTTPRequestV3.blank('/v3/servers')\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0req.method = 'POST'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0req.body = jsonutils.dumps(body)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0req.headers[\"content-type\"] = \"application/json\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0admin_context = context.get_admin_context()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0service1 = db.service_create(admin_context, {'host': 'host1_zones',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'binary': \"nova-compute\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'topic': 'compute',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'report_count': 0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0agg = db.aggregate_create(admin_context,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0{'name': 'agg1'}, {'availability_zone': 'nova'})\u2605\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0db.aggregate_host_add(admin_context, agg['id'], 'host1_zones')\n\nThe correct request for availability-zone option is 'os-availability-zone:availability_zone'.", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1270811", 
    "owner": "https://api.launchpad.net/1.0/~xu-haiwei", 
    "id": 1270811, 
    "index": 1131, 
    "openned": "2014-01-20 12:39:41.165842+00:00", 
    "created": "2014-01-20 12:39:41.165842+00:00", 
    "title": "Wrong option is used in test_availability.py", 
    "comments": [
        {
            "content": "I found a testcase bug in nova/tests/api/openstack/compute/plugins/v3/test_availability_zone.py\n\n     def test_create_instance_with_availability_zone(self):\n         def create(*args, **kwargs):\n             self.assertIn('availability_zone', kwargs)\n             return old_create(*args, **kwargs)\n\n         old_create = compute_api.API.create\n         self.stubs.Set(compute_api.API, 'create', create)\n         image_href = '76fa36fc-c930-4bf3-8c8a-ea2a2420deb6'\n         flavor_ref = 'http://localhost/v3/flavors/3'\n         body = {\n             'server': {\n                 'name': 'config_drive_test',\n                 'image_ref': image_href,\n                 'flavor_ref': flavor_ref,\n                 'metadata': {\n                     'hello': 'world',\n                     'open': 'stack',\n                 },\n               \u2605  'availability_zone': \"nova\",\u2605\n             },\n         }\n\n         req = fakes.HTTPRequestV3.blank('/v3/servers')\n         req.method = 'POST'\n         req.body = jsonutils.dumps(body)\n         req.headers[\"content-type\"] = \"application/json\"\n         admin_context = context.get_admin_context()\n         service1 = db.service_create(admin_context, {'host': 'host1_zones',\n                                          'binary': \"nova-compute\",\n                                          'topic': 'compute',\n                                          'report_count': 0})\n         agg = db.aggregate_create(admin_context,\n                 {'name': 'agg1'}, {'availability_zone': 'nova'})\u2605\n         db.aggregate_host_add(admin_context, agg['id'], 'host1_zones')\n\nThe create request for availability option is 'os-availability-zone:availability_zone'.", 
            "date_created": "2014-01-20 12:39:41.165842+00:00", 
            "author": "https://api.launchpad.net/1.0/~xu-haiwei"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/67825", 
            "date_created": "2014-01-20 12:49:04.075533+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/67825\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=861d67120227f7a52ff3f9ef7225b84a9ac26647\nSubmitter: Jenkins\nBranch:    master\n\ncommit 861d67120227f7a52ff3f9ef7225b84a9ac26647\nAuthor: Haiwei Xu <email address hidden>\nDate:   Tue Jan 21 06:43:20 2014 +0900\n\n    Fix availability-zone option miss when creates an instance\n    \n    In test_availability_zone.py the availability-zone option is\n    used as 'availability_zone' which should be modified to\n    'os-availability-zone:availability_zone'.\n    \n    Change-Id: I765d07b699ecb425dadccb22af834b11f52ff5b0\n    Closes-Bug: #1270811\n", 
            "date_created": "2014-03-26 02:17:45.134499+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-31 19:10:08.894708+00:00"
}