{
    "status": "Won't Fix", 
    "last_updated": "2016-05-17 13:55:18.381866+00:00", 
    "description": "Setup:\nOpenStack Grizzly and XCP on Debian Wheezy from the repositories (Kronos).\nShared storage based on NFS as the default SR configured for live migration.\n\nWhen pressing the \"More->Migrate Instance\" on Horizon web interface, a resize is initiated (Migrate here is misleading since it's basically resize but this is another thing) which always fails with the following errors:\n\n2013-07-16 17:49:35.684 ERROR nova.compute.manager [req-7a04e85c-0663-4772-bb5b-006516bde71f 8ca2f0ccd55f4d9ba53847755f2e0b18 10c16ce5ffb54c56925152b7d331a8d2] [instance: 93cb5f1a-5f63-4ac0-b7f4-77ee8e976484] Migration error: Failed to transfer vhd to new host. Setting instance vm_state to ERROR\n2013-07-16 17:49:41.862 ERROR nova.openstack.common.rpc.amqp [req-7a04e85c-0663-4772-bb5b-006516bde71f 8ca2f0ccd55f4d9ba53847755f2e0b18 10c16ce5ffb54c56925152b7d331a8d2] Exception during message handling\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 117, in wrapped\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 94, in wrapped\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 209, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     pass\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 195, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 260, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 237, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 224, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2373, in resize_instance\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 243, in migrate_disk_and_power_off\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     dest, instance_type)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 905, in migrate_disk_and_power_off\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     context, instance, dest, vm_ref, sr_path)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 850, in _migrate_disk_resizing_up\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     self._migrate_vhd(instance, vdi_uuid, dest, sr_path, seq_num)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 765, in _migrate_vhd\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     raise exception.MigrationError(reason=msg)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp MigrationError: Migration error: Failed to transfer vhd to new host\n\n\nExactly the same happens when I try to resize an instance from the command line (either up or down)\n\n~# nova resize <image-id> m1.small --poll\nInstance resizing... 40% complete\nError resizing instance\n\nI assume it might be because of the shared storage? \nAnyway it's a bug which puts the VM in ERROR state so it should be handled properly.", 
    "tags": [
        "xcp", 
        "xenserver"
    ], 
    "importance": "Wishlist", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1201863", 
    "owner": "None", 
    "id": 1201863, 
    "index": 2657, 
    "openned": "2013-07-16 16:00:18.236915+00:00", 
    "created": "2013-07-16 16:00:18.236915+00:00", 
    "title": "XenAPI Resize Fails with Migration Error: Failed to transfer vhd to new host", 
    "comments": [
        {
            "content": "Setup:\nOpenStack Grizzly and XCP on Debian Wheezy from the repositories (Kronos).\nShared storage based on NFS as the default SR configured for live migration.\n\nWhen pressing the \"More->Migrate Instance\" on Horizon web interface, a resize is initiated (Migrate here is misleading since it's basically resize but this is another thing) which always fails with the following errors:\n\n2013-07-16 17:49:35.684 ERROR nova.compute.manager [req-7a04e85c-0663-4772-bb5b-006516bde71f 8ca2f0ccd55f4d9ba53847755f2e0b18 10c16ce5ffb54c56925152b7d331a8d2] [instance: 93cb5f1a-5f63-4ac0-b7f4-77ee8e976484] Migration error: Failed to transfer vhd to new host. Setting instance vm_state to ERROR\n2013-07-16 17:49:41.862 ERROR nova.openstack.common.rpc.amqp [req-7a04e85c-0663-4772-bb5b-006516bde71f 8ca2f0ccd55f4d9ba53847755f2e0b18 10c16ce5ffb54c56925152b7d331a8d2] Exception during message handling\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 117, in wrapped\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     temp_level, payload)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 94, in wrapped\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 209, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     pass\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 195, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 260, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 237, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     self.gen.next()\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 224, in decorated_function\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2373, in resize_instance\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 243, in migrate_disk_and_power_off\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     dest, instance_type)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 905, in migrate_disk_and_power_off\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     context, instance, dest, vm_ref, sr_path)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 850, in _migrate_disk_resizing_up\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     self._migrate_vhd(instance, vdi_uuid, dest, sr_path, seq_num)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 765, in _migrate_vhd\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp     raise exception.MigrationError(reason=msg)\n2013-07-16 17:49:41.862 5363 TRACE nova.openstack.common.rpc.amqp MigrationError: Migration error: Failed to transfer vhd to new host\n\n\nExactly the same happens when I try to resize an instance from the command line (either up or down)\n\n~# nova resize <image-id> m1.small --poll\nInstance resizing... 40% complete\nError resizing instance\n\nI assume it might be because of the shared storage? \nAnyway it's a bug which puts the VM in ERROR state so it should be handled properly.", 
            "date_created": "2013-07-16 16:00:18.236915+00:00", 
            "author": "https://api.launchpad.net/1.0/~cyberang3l"
        }, 
        {
            "content": "Agreed the shared storage is the likely cause.  The resize code (as opposed to the migrate) is specifically intended for local storage.\nVM migrate (from the command line) should work in this scenario", 
            "date_created": "2013-07-16 16:14:58.620032+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }, 
        {
            "content": "Live migration from the command line works with some effort: https://answers.launchpad.net/nova/+question/232484", 
            "date_created": "2013-07-16 17:07:25.286687+00:00", 
            "author": "https://api.launchpad.net/1.0/~cyberang3l"
        }, 
        {
            "content": "So we don't really fully support the use of shared storage with xenserver today, most of the things that work are down to \"luck\".\n\nlive-migrate was added to work with pools, but the pool support is very \"dodgy\".\n\nYou could use migrate between pools, and it will work.\n\nReally, there should be a better error message when you try migrate with pools.", 
            "date_created": "2013-07-18 17:08:09.470493+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "No current plans to fix this; use live migration not resize", 
            "date_created": "2016-05-17 13:55:17.905170+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }
    ], 
    "closed": "2016-05-17 13:54:50.978393+00:00"
}