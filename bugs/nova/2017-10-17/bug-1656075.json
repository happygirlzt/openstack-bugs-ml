{
    "status": "Fix Released", 
    "last_updated": "2017-02-03 19:08:35.217604+00:00", 
    "description": "I noticed this in a TripleO job:\n\nhttp://logs.openstack.org/04/419604/1/check/gate-puppet-openstack-integration-4-scenario004-tempest-centos-7/5d95a8c/logs/nova/nova-compute.txt.gz#_2017-01-12_18_53_43_459\n\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager [req-59098025-7c99-41b2-aaa9-0e5714770b3a - - - - -] Error updating resources for node centos-7-osic-cloud1-s3500-6631948.\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager Traceback (most recent call last):\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6537, in update_available_resource_for_node\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     rt.update_available_resource(context, nodename)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/compute/resource_tracker.py\", line 540, in update_available_resource\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self._update_available_resource(context, resources)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return f(*args, **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/compute/resource_tracker.py\", line 564, in _update_available_resource\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self._init_compute_node(context, resources)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/compute/resource_tracker.py\", line 451, in _init_compute_node\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self.scheduler_client.update_resource_stats(self.compute_node)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/__init__.py\", line 60, in update_resource_stats\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self.reportclient.update_resource_stats(compute_node)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/__init__.py\", line 37, in __run_method\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return getattr(self.instance, __name)(*args, **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 476, in update_resource_stats\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     compute_node.hypervisor_hostname)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 296, in _ensure_resource_provider\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     rp = self._get_resource_provider(uuid)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 53, in wrapper\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return f(self, *a, **k)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 209, in _get_resource_provider\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     resp = self.get(\"/resource_providers/%s\" % uuid)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 174, in get\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     endpoint_filter=self.ks_filter, raise_exc=False)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 710, in get\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return self.request(url, 'GET', **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/positional/__init__.py\", line 101, in inner\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return wrapped(*args, **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 467, in request\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     auth_headers = self.get_auth_headers(auth)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 770, in get_auth_headers\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return auth.get_headers(self, **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/plugin.py\", line 90, in get_headers\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     token = self.get_token(session)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/base.py\", line 90, in get_token\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return self.get_access(session).auth_token\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/base.py\", line 136, in get_access\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self.auth_ref = self.get_auth_ref(session)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/generic/base.py\", line 196, in get_auth_ref\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self._plugin = self._do_create_plugin(session)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/generic/base.py\", line 191, in _do_create_plugin\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     raise exceptions.DiscoveryFailure('Could not determine a suitable URL '\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager DiscoveryFailure: Could not determine a suitable URL for the plugin\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager \n\nLooks like another type of keystoneauth1 exception that we're not handling in the safe_connect() decorator. At some point we'll probably just want to handle all KSA failures globally...", 
    "tags": [
        "low-hanging-fruit", 
        "placement"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1656075", 
    "owner": "https://api.launchpad.net/1.0/~roman-dobosz", 
    "id": 1656075, 
    "index": 2143, 
    "openned": "2017-01-12 19:15:49.012888+00:00", 
    "created": "2017-01-12 19:15:49.012888+00:00", 
    "title": "DiscoveryFailure when trying to get resource providers from the scheduler report client", 
    "comments": [
        {
            "content": "I noticed this in a TripleO job:\n\nhttp://logs.openstack.org/04/419604/1/check/gate-puppet-openstack-integration-4-scenario004-tempest-centos-7/5d95a8c/logs/nova/nova-compute.txt.gz#_2017-01-12_18_53_43_459\n\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager [req-59098025-7c99-41b2-aaa9-0e5714770b3a - - - - -] Error updating resources for node centos-7-osic-cloud1-s3500-6631948.\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager Traceback (most recent call last):\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6537, in update_available_resource_for_node\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     rt.update_available_resource(context, nodename)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/compute/resource_tracker.py\", line 540, in update_available_resource\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self._update_available_resource(context, resources)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return f(*args, **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/compute/resource_tracker.py\", line 564, in _update_available_resource\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self._init_compute_node(context, resources)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/compute/resource_tracker.py\", line 451, in _init_compute_node\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self.scheduler_client.update_resource_stats(self.compute_node)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/__init__.py\", line 60, in update_resource_stats\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self.reportclient.update_resource_stats(compute_node)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/__init__.py\", line 37, in __run_method\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return getattr(self.instance, __name)(*args, **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 476, in update_resource_stats\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     compute_node.hypervisor_hostname)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 296, in _ensure_resource_provider\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     rp = self._get_resource_provider(uuid)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 53, in wrapper\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return f(self, *a, **k)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 209, in _get_resource_provider\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     resp = self.get(\"/resource_providers/%s\" % uuid)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/nova/scheduler/client/report.py\", line 174, in get\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     endpoint_filter=self.ks_filter, raise_exc=False)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 710, in get\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return self.request(url, 'GET', **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/positional/__init__.py\", line 101, in inner\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return wrapped(*args, **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 467, in request\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     auth_headers = self.get_auth_headers(auth)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 770, in get_auth_headers\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return auth.get_headers(self, **kwargs)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/plugin.py\", line 90, in get_headers\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     token = self.get_token(session)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/base.py\", line 90, in get_token\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     return self.get_access(session).auth_token\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/base.py\", line 136, in get_access\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self.auth_ref = self.get_auth_ref(session)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/generic/base.py\", line 196, in get_auth_ref\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     self._plugin = self._do_create_plugin(session)\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/generic/base.py\", line 191, in _do_create_plugin\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager     raise exceptions.DiscoveryFailure('Could not determine a suitable URL '\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager DiscoveryFailure: Could not determine a suitable URL for the plugin\n2017-01-12 18:53:43.459 15495 ERROR nova.compute.manager \n\nLooks like another type of keystoneauth1 exception that we're not handling in the safe_connect() decorator. At some point we'll probably just want to handle all KSA failures globally...", 
            "date_created": "2017-01-12 19:15:49.012888+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "In this case the keystone stuff was done after nova-compute was started:\n\nhttp://logs.openstack.org/04/419604/1/check/gate-puppet-openstack-integration-4-scenario004-tempest-centos-7/5d95a8c/logs/puppet-20170112_185646.txt.gz#_2017-01-12_18_55_40\n\n2017-01-12 18:55:40 +0000 /Stage[main]/Nova::Keystone::Auth_placement/Keystone::Resource::Service_identity[placement]/Keystone_endpoint[RegionOne/placement::placement]/ensure (notice): created", 
            "date_created": "2017-01-12 19:17:22.021618+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/422780", 
            "date_created": "2017-01-19 17:42:25.132346+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/422780\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=4dbc0ddc740881a409085feeca2a1771a9ea95f3\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4dbc0ddc740881a409085feeca2a1771a9ea95f3\nAuthor: Roman Dobosz <email address hidden>\nDate:   Thu Jan 19 18:26:45 2017 +0100\n\n    Prevent compute crash on discovery failure\n    \n    Keystoneauth1 may crash during discovery of URL for placement API. This is\n    often happen on situation, when all services are started at once, compute will\n    first be up while keystone still not. This patch fixes this by catching\n    DiscoveyFailure as additional expected failures.\n    \n    Closes-Bug: #1656075\n    \n    Change-Id: I48aa6802286b408260b9d10f9d13860b44bd7d34\n", 
            "date_created": "2017-01-28 02:16:44.712414+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0rc1 release candidate.", 
            "date_created": "2017-02-03 19:08:34.365299+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-01-28 02:16:41.193373+00:00"
}