{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:14:23.623722+00:00", 
    "description": "Related to https://bugs.launchpad.net/nova/+bug/1262288 when the Nova node shuts down it leaves it's vSphere SOAP session open. This session remains open blocking connection by administrators and by OpenStack.\n\nThe result is administrative control over the entire vSphere, vCenter, and ESX infrastructure is temporarily lost.\n\nPython CLI users experience:\npyVmomi.VmomiSupport.HostConnectFault: (vim.fault.HostConnectFault) {\n   dynamicType = <unset>,\n   dynamicProperty = (vmodl.DynamicProperty) [],\n   msg = '503 Service Unavailable',\n   faultCause = <unset>,\n   faultMessage = (vmodl.LocalizableMessage) []\n}\n\n\nVpXClient users experience:\n\nCall \"ServiceInstance.RetrieveContent\" for object \"ServiceInstance\" on Server \"<server_name>\" failed.\n\nOpenStack users experience:\n2014-03-14 08:55:06.579 ERROR suds.client [-] <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<SOAP-ENV:Envelope xmlns:ns0=\"urn:vim25\" xmlns:ns1=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\">\n   <ns1:Body>\n      <ns0:RetrieveServiceContent>\n         <ns0:_this type=\"ServiceInstance\">ServiceInstance</ns0:_this>\n      </ns0:RetrieveServiceContent>\n   </ns1:Body>\n</SOAP-ENV:Envelope>\n2014-03-14 08:55:06.581 CRITICAL nova.virt.vmwareapi.driver [-] Unable to connect to server at 192.168.2.36, sleeping for 2 seconds\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver Traceback (most recent call last):\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 753, in _create_session\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     self.vim = self._get_vim_object()\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 742, in _get_vim_object\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     return vim.Vim(protocol=self._scheme, host=self._host_ip)\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/vim.py\", line 117, in __init__\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     self._service_content = self.retrieve_service_content()\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/vim.py\", line 120, in retrieve_service_content\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     return self.RetrieveServiceContent(\"ServiceInstance\")\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/vim.py\", line 223, in vim_request_handler\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     _(\"Exception in %s \") % (attr_name), excep)\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver VimException: Exception in RetrieveServiceContent : (503, u'Service Unavailable')\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver \n\n\nAll administrative control of the cloud is temporarily lost for a timespan of up to 30 minutes.", 
    "tags": [
        "vmware"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1292583", 
    "owner": "https://api.launchpad.net/1.0/~hartsock", 
    "id": 1292583, 
    "index": 1433, 
    "openned": "2014-03-14 15:56:22.954497+00:00", 
    "created": "2014-03-14 15:56:22.954497+00:00", 
    "title": "VMware: nova nodes crash on 503 errors, control of vSphere infrastructure completely lost", 
    "comments": [
        {
            "content": "Related to https://bugs.launchpad.net/nova/+bug/1262288 when the Nova node shuts down it leaves it's vSphere SOAP session open. This session remains open blocking connection by administrators and by OpenStack.\n\nThe result is administrative control over the entire vSphere, vCenter, and ESX infrastructure is temporarily lost.\n\nPython CLI users experience:\npyVmomi.VmomiSupport.HostConnectFault: (vim.fault.HostConnectFault) {\n   dynamicType = <unset>,\n   dynamicProperty = (vmodl.DynamicProperty) [],\n   msg = '503 Service Unavailable',\n   faultCause = <unset>,\n   faultMessage = (vmodl.LocalizableMessage) []\n}\n\n\nVpXClient users experience:\n\nCall \"ServiceInstance.RetrieveContent\" for object \"ServiceInstance\" on Server \"<server_name>\" failed.\n\nOpenStack users experience:\n2014-03-14 08:55:06.579 ERROR suds.client [-] <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<SOAP-ENV:Envelope xmlns:ns0=\"urn:vim25\" xmlns:ns1=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\">\n   <ns1:Body>\n      <ns0:RetrieveServiceContent>\n         <ns0:_this type=\"ServiceInstance\">ServiceInstance</ns0:_this>\n      </ns0:RetrieveServiceContent>\n   </ns1:Body>\n</SOAP-ENV:Envelope>\n2014-03-14 08:55:06.581 CRITICAL nova.virt.vmwareapi.driver [-] Unable to connect to server at 192.168.2.36, sleeping for 2 seconds\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver Traceback (most recent call last):\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 753, in _create_session\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     self.vim = self._get_vim_object()\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 742, in _get_vim_object\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     return vim.Vim(protocol=self._scheme, host=self._host_ip)\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/vim.py\", line 117, in __init__\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     self._service_content = self.retrieve_service_content()\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/vim.py\", line 120, in retrieve_service_content\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     return self.RetrieveServiceContent(\"ServiceInstance\")\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver   File \"/opt/stack/nova/nova/virt/vmwareapi/vim.py\", line 223, in vim_request_handler\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver     _(\"Exception in %s \") % (attr_name), excep)\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver VimException: Exception in RetrieveServiceContent : (503, u'Service Unavailable')\n2014-03-14 08:55:06.581 TRACE nova.virt.vmwareapi.driver \n\n\nAll administrative control of the cloud is temporarily lost for a timespan of up to 30 minutes.", 
            "date_created": "2014-03-14 15:56:22.954497+00:00", 
            "author": "https://api.launchpad.net/1.0/~hartsock"
        }, 
        {
            "content": "See: https://review.openstack.org/#/c/75262/", 
            "date_created": "2014-03-14 16:06:21.902265+00:00", 
            "author": "https://api.launchpad.net/1.0/~hartsock"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/75262\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=5fc7ee5f62903082bb86a4206ae6efce0e28a425\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5fc7ee5f62903082bb86a4206ae6efce0e28a425\nAuthor: Shawn Hartsock <email address hidden>\nDate:   Thu Feb 20 19:34:41 2014 -0500\n\n    add support for host driver cleanup during shutdown\n    \n    Provides a place for any drivers to potentially\n    setup graceful-shutdown code.\n    \n    VMware driver's proper driver-lifecycle code included.\n    This is critical in environments where the the vmware\n    driver is setup and torn down at high frequency.\n    \n    Prevents run-away vSphere by closing stateless\n    HTTP management sessions gracefully.\n    \n    Change-Id: I67a91613643540243ab1210b333ed8e121f05802\n    related to bug: 1262288\n    Closes-bug: 1292583\n", 
            "date_created": "2014-03-15 13:56:24.796062+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/havana\nReview: https://review.openstack.org/82269", 
            "date_created": "2014-03-22 01:43:09.138065+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-31 19:05:24.702967+00:00"
}