{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:36:57.933114+00:00", 
    "description": "If I run network create command with insufficient subnet range, then it crashes in middle. It seems like fixed_ip range check is not implemented.\n\n$/usr/local/bin/nova-manage --flagfile=/etc/nova/nova.conf network create 10.0.0.0/28 2 64\n\nFixed_ips range:10.0.0.0/28\nnumber of networks=2 \nnetwork size per network=64\n\nError Reported on Console\n----------------------------------\n2011-02-07 11:18:15,879 INFO sqlalchemy.orm.mapper.Mapper [-] (Project|projects) _post_configure_properties() complete\n2011-02-07 11:18:16,008 CRITICAL nova.root [-]\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE: File \"/usr/local/bin/nova-manage\", line 5, in <module>\n(nova.root): TRACE: pkg_resources.run_script('nova==2011.1', 'nova-manage')\n(nova.root): TRACE: File \"/usr/lib/python2.6/dist-packages/pkg_resources.py\", line 461, in run_script\n(nova.root): TRACE: self.require(requires)[0].run_script(script_name, ns)\n(nova.root): TRACE: File \"/usr/lib/python2.6/dist-packages/pkg_resources.py\", line 1194, in run_script\n(nova.root): TRACE: execfile(script_filename, namespace, namespace)\n(nova.root): TRACE: File \"/usr/local/lib/python2.6/dist-packages/nova-2011.1-py2.6.egg/EGG-INFO/scripts/nova-manage\", line 694, in <module>\n(nova.root): TRACE: main()\n(nova.root): TRACE: File \"/usr/local/lib/python2.6/dist-packages/nova-2011.1-py2.6.egg/EGG-INFO/scripts/nova-manage\", line 686, in main\n(nova.root): TRACE: fn(*argv)\n(nova.root): TRACE: File \"/usr/local/lib/python2.6/dist-packages/nova-2011.1-py2.6.egg/EGG-INFO/scripts/nova-manage\", line 500, in create\n(nova.root): TRACE: vpn_start=int(vpn_start))\n(nova.root): TRACE: File \"/usr/local/lib/python2.6/dist-packages/nova-2011.1-py2.6.egg/nova/network/manager.py\", line 536, in create_networks\n(nova.root): TRACE: cidr = \"%s/%s\" % (fixed_net[start], significant_bits)\n(nova.root): TRACE: File \"/usr/lib/pymodules/python2.6/IPy.py\", line 880, in getitem\n(nova.root): TRACE: return IP(IPint.getitem(self, key))\n(nova.root): TRACE: File \"/usr/lib/pymodules/python2.6/IPy.py\", line 561, in getitem\n(nova.root): TRACE: raise IndexError?\n(nova.root): TRACE: IndexError?\n(nova.root): TRACE:", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/715424", 
    "owner": "https://api.launchpad.net/1.0/~rcarrillocruz", 
    "id": 715424, 
    "index": 92, 
    "openned": "2011-02-08 21:24:00.413574+00:00", 
    "created": "2011-02-08 21:24:00.413574+00:00", 
    "title": "nova-manage : create network crashes when subnet range provided is not enough", 
    "comments": [
        {
            "content": "If I run network create command with insufficient subnet range, then it crashes in middle. It seems like fixed_ip range check is not implemented.\n\n$/usr/local/bin/nova-manage --flagfile=/etc/nova/nova.conf network create 10.0.0.0/28 2 64\n\nFixed_ips range:10.0.0.0/28\nnumber of networks=2 \nnetwork size per network=64\n\nError Reported on Console\n----------------------------------\n2011-02-07 11:18:15,879 INFO sqlalchemy.orm.mapper.Mapper [-] (Project|projects) _post_configure_properties() complete\n2011-02-07 11:18:16,008 CRITICAL nova.root [-]\n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE: File \"/usr/local/bin/nova-manage\", line 5, in <module>\n(nova.root): TRACE: pkg_resources.run_script('nova==2011.1', 'nova-manage')\n(nova.root): TRACE: File \"/usr/lib/python2.6/dist-packages/pkg_resources.py\", line 461, in run_script\n(nova.root): TRACE: self.require(requires)[0].run_script(script_name, ns)\n(nova.root): TRACE: File \"/usr/lib/python2.6/dist-packages/pkg_resources.py\", line 1194, in run_script\n(nova.root): TRACE: execfile(script_filename, namespace, namespace)\n(nova.root): TRACE: File \"/usr/local/lib/python2.6/dist-packages/nova-2011.1-py2.6.egg/EGG-INFO/scripts/nova-manage\", line 694, in <module>\n(nova.root): TRACE: main()\n(nova.root): TRACE: File \"/usr/local/lib/python2.6/dist-packages/nova-2011.1-py2.6.egg/EGG-INFO/scripts/nova-manage\", line 686, in main\n(nova.root): TRACE: fn(*argv)\n(nova.root): TRACE: File \"/usr/local/lib/python2.6/dist-packages/nova-2011.1-py2.6.egg/EGG-INFO/scripts/nova-manage\", line 500, in create\n(nova.root): TRACE: vpn_start=int(vpn_start))\n(nova.root): TRACE: File \"/usr/local/lib/python2.6/dist-packages/nova-2011.1-py2.6.egg/nova/network/manager.py\", line 536, in create_networks\n(nova.root): TRACE: cidr = \"%s/%s\" % (fixed_net[start], significant_bits)\n(nova.root): TRACE: File \"/usr/lib/pymodules/python2.6/IPy.py\", line 880, in getitem\n(nova.root): TRACE: return IP(IPint.getitem(self, key))\n(nova.root): TRACE: File \"/usr/lib/pymodules/python2.6/IPy.py\", line 561, in getitem\n(nova.root): TRACE: raise IndexError?\n(nova.root): TRACE: IndexError?\n(nova.root): TRACE:", 
            "date_created": "2011-02-08 21:24:00.413574+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "Ricardo: did you start working on that ? If yes, please set this to \"In progress\" and link any branch you may have. If not, maybe unassign you to give someone else a chance to take it ?", 
            "date_created": "2011-02-17 14:43:49.541202+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Stack trace is different from the original bug poster:\n\nroot@dormammu-VirtualBox:/home/dormammu/src/nova/lp715424/bin# ./nova-manage network create 10.0.0.0/28 2 64\n2011-02-21 21:36:52,452 CRITICAL nova.root [-] \n(nova.root): TRACE: Traceback (most recent call last):\n(nova.root): TRACE:   File \"./nova-manage\", line 746, in <module>\n(nova.root): TRACE:     main()\n(nova.root): TRACE:   File \"./nova-manage\", line 738, in main\n(nova.root): TRACE:     fn(*argv)\n(nova.root): TRACE:   File \"./nova-manage\", line 532, in create\n(nova.root): TRACE:     label=label)\n(nova.root): TRACE:   File \"/home/dormammu/src/nova/lp715424/nova/network/manager.py\", line 532, in create_networks\n(nova.root): TRACE:     cidr = \"%s/%s\" % (fixed_net[start], significant_bits)\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/IPy.py\", line 880, in __getitem__\n(nova.root): TRACE:     return IP(IPint.__getitem__(self, key))\n(nova.root): TRACE:   File \"/usr/lib/pymodules/python2.6/IPy.py\", line 561, in __getitem__\n(nova.root): TRACE:     raise IndexError\n(nova.root): TRACE: IndexError\n(nova.root): TRACE: \nroot@dormammu-VirtualBox:/home/dormammu/src/nova/lp715424/bin# ./nova-manage network list\nnetwork                 netmask         start address   DNS            \n10.0.0.0/27             255.255.255.224 10.0.0.3        None           \n10.0.0.0/26             255.255.255.192 10.0.0.3        None           \n10.0.0.0/26             255.255.255.192 10.0.0.3        None           \n10.0.0.0/24             255.255.255.0   10.0.0.3        None           \n10.0.1.0/24             255.255.255.0   10.0.1.3        None           \n10.0.0.0/26             255.255.255.192 10.0.0.3        None           \n10.0.0.0/26             255.255.255.192 10.0.0.3        None           \n10.0.0.0/26             255.255.255.192 10.0.0.3        None           \n\nAnyways, truth is the networks are added despite the trace, we need to check for overlapping existing networks.", 
            "date_created": "2011-02-21 20:39:02.042451+00:00", 
            "author": "https://api.launchpad.net/1.0/~rcarrillocruz"
        }, 
        {
            "content": "Dig into IPy documentation, looks like IP.len() might do the trick, that gives the amount of hosts for a given CIDR network.\nFor example:\n\n>>> ip = IPy.IP(\"10.0.0.0/28\")\n>>> print ip.len()\n16\n\nIt would be a matter of making sure fixed_net.len() can fit num_networks * network_size .\n", 
            "date_created": "2011-02-21 22:10:06.513064+00:00", 
            "author": "https://api.launchpad.net/1.0/~rcarrillocruz"
        }
    ], 
    "closed": "2011-04-15 08:36:56.458122+00:00"
}