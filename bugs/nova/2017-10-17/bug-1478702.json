{
    "status": "Fix Released", 
    "last_updated": "2015-12-09 23:27:09.563828+00:00", 
    "description": "I'm seeing this trace in an ironic job but it shows up in other jobs as well:\n\nhttp://logs.openstack.org/75/190675/2/check/gate-tempest-dsvm-ironic-pxe_ssh-full-nv/2c65f3f/logs/screen-n-cpu.txt.gz#_2015-07-26_00_36_47_257\n\n2015-07-26 00:36:47.257 ERROR nova.network.neutronv2.api [req-57d4e9e6-adf1-4774-a27a-63d096fe48e6 tempest-ServersTestJSON-1332826451 tempest-ServersTestJSON-2014105270] Unable to clear device ID for port 'None'\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api Traceback (most recent call last):\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/opt/stack/new/nova/nova/network/neutronv2/api.py\", line 365, in _unbind_ports\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     port_client.update_port(port_id, port_req_body)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 102, in with_params\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     ret = self.function(instance, *args, **kwargs)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 549, in update_port\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     return self.put(self.port_path % (port), body=body)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 302, in put\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     headers=headers, params=params)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 270, in retry_request\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     headers=headers, params=params)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 211, in do_request\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     self._handle_fault_response(status_code, replybody)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 185, in _handle_fault_response\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     exception_handler_v20(status_code, des_error_body)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 83, in exception_handler_v20\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     message=message)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api NeutronClientException: 404 Not Found\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api \n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api The resource could not be found.\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api \n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api    \n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api \n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiVW5hYmxlIHRvIGNsZWFyIGRldmljZSBJRCBmb3IgcG9ydCAnTm9uZSdcIiBBTkQgdGFnczpcInNjcmVlbi1uLWNwdS50eHRcIiIsImZpZWxkcyI6W10sIm9mZnNldCI6MCwidGltZWZyYW1lIjoiNjA0ODAwIiwiZ3JhcGhtb2RlIjoiY291bnQiLCJ0aW1lIjp7InVzZXJfaW50ZXJ2YWwiOjB9LCJzdGFtcCI6MTQzODAzMTMwMzgzNX0=\n\nmaster and stable/kilo when we added the preserve pre-existing ports stuff in the neutron v2 API in nova.\n\nMy guess is this happens in the deallocate_for_instance call and the port_id in the requested_networks dict is None, but we don't filter those out properly.", 
    "tags": [
        "kilo-backport-potential", 
        "network", 
        "neutron"
    ], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1478702", 
    "owner": "https://api.launchpad.net/1.0/~danms", 
    "id": 1478702, 
    "index": 4305, 
    "openned": "2015-07-27 21:17:58.241408+00:00", 
    "created": "2015-07-27 21:17:58.241408+00:00", 
    "title": "Unable to clear device ID for port 'None'", 
    "comments": [
        {
            "content": "I'm seeing this trace in an ironic job but it shows up in other jobs as well:\n\nhttp://logs.openstack.org/75/190675/2/check/gate-tempest-dsvm-ironic-pxe_ssh-full-nv/2c65f3f/logs/screen-n-cpu.txt.gz#_2015-07-26_00_36_47_257\n\n2015-07-26 00:36:47.257 ERROR nova.network.neutronv2.api [req-57d4e9e6-adf1-4774-a27a-63d096fe48e6 tempest-ServersTestJSON-1332826451 tempest-ServersTestJSON-2014105270] Unable to clear device ID for port 'None'\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api Traceback (most recent call last):\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/opt/stack/new/nova/nova/network/neutronv2/api.py\", line 365, in _unbind_ports\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     port_client.update_port(port_id, port_req_body)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 102, in with_params\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     ret = self.function(instance, *args, **kwargs)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 549, in update_port\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     return self.put(self.port_path % (port), body=body)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 302, in put\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     headers=headers, params=params)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 270, in retry_request\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     headers=headers, params=params)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 211, in do_request\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     self._handle_fault_response(status_code, replybody)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 185, in _handle_fault_response\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     exception_handler_v20(status_code, des_error_body)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 83, in exception_handler_v20\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api     message=message)\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api NeutronClientException: 404 Not Found\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api \n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api The resource could not be found.\n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api \n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api    \n2015-07-26 00:36:47.257 20871 ERROR nova.network.neutronv2.api \n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiVW5hYmxlIHRvIGNsZWFyIGRldmljZSBJRCBmb3IgcG9ydCAnTm9uZSdcIiBBTkQgdGFnczpcInNjcmVlbi1uLWNwdS50eHRcIiIsImZpZWxkcyI6W10sIm9mZnNldCI6MCwidGltZWZyYW1lIjoiNjA0ODAwIiwiZ3JhcGhtb2RlIjoiY291bnQiLCJ0aW1lIjp7InVzZXJfaW50ZXJ2YWwiOjB9LCJzdGFtcCI6MTQzODAzMTMwMzgzNX0=\n\nmaster and stable/kilo when we added the preserve pre-existing ports stuff in the neutron v2 API in nova.\n\nMy guess is this happens in the deallocate_for_instance call and the port_id in the requested_networks dict is None, but we don't filter those out properly.", 
            "date_created": "2015-07-27 21:17:58.241408+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/206236", 
            "date_created": "2015-07-27 21:56:44.427072+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/206236\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=5ec5e9892903cf62151d406ca5b4e059d29f6bc3\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5ec5e9892903cf62151d406ca5b4e059d29f6bc3\nAuthor: Matt Riedemann <email address hidden>\nDate:   Mon Jul 27 14:47:13 2015 -0700\n\n    neutron: filter None port_ids from ports list in _unbind_ports\n    \n    The compute manager calls deallocate_for_instance with the original\n    requested_networks when an instance fails to build and we try to\n    cleanup. The port_id in the requested_networks tuple is optional, so we\n    can end up passing a list of ports to _unbind_ports with None in it,\n    which will result in a 404 back from neutron since a port with id None\n    does not exist. This doesn't fail the operation but it results in an\n    ugly stacktrace in the compute logs.\n    \n    This change simply checks for None in _unbind_ports when iterating over\n    the list of ports passed in.\n    \n    Note that the filtering could be done in deallocate_for_instance when\n    building the ports_to_skip list from requested_networks, but I opted to\n    future proof the _unbind_ports method in case other callers forget to\n    filter the list passed in, and there are other callers of _unbind_ports.\n    \n    Closes-Bug: #1478702\n    \n    Change-Id: Ie5980be71a1d83f03ab5d232f29da7e67caf6f35\n", 
            "date_created": "2015-08-14 07:40:57.130179+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I'm facing this issue on Kilo for an Ironic job. Is a Kilo fix planned? If not, I can help with the fix if necessary. ", 
            "date_created": "2015-12-09 23:27:08.787510+00:00", 
            "author": "https://api.launchpad.net/1.0/~rajagast"
        }
    ], 
    "closed": "2015-09-03 11:45:31.394664+00:00"
}