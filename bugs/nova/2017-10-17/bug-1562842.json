{
    "status": "Opinion", 
    "last_updated": "2016-04-01 15:02:13.336939+00:00", 
    "description": "When providing invalid v4-fixed-ip in nova boot command, the instance will queue with the scheduler but fail to boot. Instead what should happen is, there should be check at client side or server side and error message should be thrown so that VM does not get queued with the scheduler.\n\n\nneutron net-list\n+--------------------------------------+---------+----------------------------------------------------------+\n| id                                   | name    | subnets                                                  |\n+--------------------------------------+---------+----------------------------------------------------------+\n| 97adf977-8b62-4996-a800-bbbdaf9c0fd9 | public  | 35364205-3b7d-47db-8bf3-e1590416d9f1 2001:db8::/64       |\n|                                      |         | ddacd805-5e07-4e63-a827-fd094c61e84a 172.24.4.0/24       |\n| f9976ad3-33fb-44a4-b25f-e8356de9e7d2 | private | 6427f306-2646-479e-b47b-5a115f020d1c 10.0.0.0/24         |\n|                                      |         | 4de2d8be-0c1a-4b9c-aabf-3a896a7c67c0 fd07:4910:1fa6::/64 |\n+--------------------------------------+---------+----------------------------------------------------------+\n\n\nnova boot abi_1 --image a258964a-4250-4b6d-9fe9-492ac2b3d8da --flavor m1.tiny --nic net-id=97adf977-8b62-4996-a800-bbbdaf9c0fd9,v6-fixed-ip=1.0.0.255\n(note: 1.0.0.255 is broadcast ip for the network, should be invalid.)\n\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          |                                                                |\n| OS-EXT-SRV-ATTR:host                 | -                                                              |\n| OS-EXT-SRV-ATTR:hostname             | abi-1                                                          |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                              |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000004e                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | e2a5fdda-7422-4e41-b59a-fa2dad82583e                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | 4ea6bc99-2c01-459b-9ce1-b6bc6a51ad79                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-wt958hij                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | -                                                              |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 0                                                              |\n| OS-EXT-STS:task_state                | scheduling                                                     |\n| OS-EXT-STS:vm_state                  | building                                                       |\n| OS-SRV-USG:launched_at               | -                                                              |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| adminPass                            | FtPf4XB3exjh                                                   |\n| config_drive                         |                                                                |\n| created                              | 2016-03-28T12:33:13Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               |                                                                |\n| id                                   | fb037e34-7372-45ee-88b6-7dc1d228fe46                           |\n| image                                | cirros-0.3.4-x86_64-uec (a258964a-4250-4b6d-9fe9-492ac2b3d8da) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | abi_1                                                          |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | BUILD                                                          |\n| tenant_id                            | 9f87ed00b37d434abd0e422d9f0b9a9b                               |\n| updated                              | 2016-03-28T12:33:13Z                                           |\n| user_id                              | 19250807be0c4c42b970a02ccf3126d2                               |\n+--------------------------------------+----------------------------------------------------------------+\n\nnova list\n+--------------------------------------+------------+--------+------------+-------------+----------------------------------+\n| ID                                   | Name       | Status | Task State | Power State | Networks                         |\n+--------------------------------------+------------+--------+------------+-------------+----------------------------------+\n| 5fefe57f-77cb-4779-9727-fa7d82cf857b | abhilash_1 | ACTIVE | -          | Running     | public=2001:db8::2d, 172.24.4.44 |\n| 28bd1ecf-393d-4073-9f00-62c07fe2ad49 | abi_2      | ERROR  | -          | NOSTATE     |                                  |\n+--------------------------------------+------------+--------+------------+-------------+----------------------------------+\n\n\nThis abi_2 is in error state, which should instead through message at boot command only.", 
    "tags": [
        "network", 
        "neutron", 
        "scheduler"
    ], 
    "importance": "Wishlist", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1562842", 
    "owner": "None", 
    "id": 1562842, 
    "index": 3059, 
    "openned": "2016-03-28 12:36:49.821884+00:00", 
    "created": "2016-03-28 12:36:49.821884+00:00", 
    "title": "instance going to scheduler when invalid v4-fixed-ip is provided in nova boot command", 
    "comments": [
        {
            "content": "When providing invalid v4-fixed-ip in nova boot command, the instance will queue with the scheduler but fail to boot. Instead what should happen is, there should be check at client side or server side and error message should be thrown so that VM does not get queued with the scheduler.\n\n\nneutron net-list\n+--------------------------------------+---------+----------------------------------------------------------+\n| id                                   | name    | subnets                                                  |\n+--------------------------------------+---------+----------------------------------------------------------+\n| 97adf977-8b62-4996-a800-bbbdaf9c0fd9 | public  | 35364205-3b7d-47db-8bf3-e1590416d9f1 2001:db8::/64       |\n|                                      |         | ddacd805-5e07-4e63-a827-fd094c61e84a 172.24.4.0/24       |\n| f9976ad3-33fb-44a4-b25f-e8356de9e7d2 | private | 6427f306-2646-479e-b47b-5a115f020d1c 10.0.0.0/24         |\n|                                      |         | 4de2d8be-0c1a-4b9c-aabf-3a896a7c67c0 fd07:4910:1fa6::/64 |\n+--------------------------------------+---------+----------------------------------------------------------+\n\n\nnova boot abi_1 --image a258964a-4250-4b6d-9fe9-492ac2b3d8da --flavor m1.tiny --nic net-id=97adf977-8b62-4996-a800-bbbdaf9c0fd9,v6-fixed-ip=1.0.0.255\n(note: 1.0.0.255 is broadcast ip for the network, should be invalid.)\n\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          |                                                                |\n| OS-EXT-SRV-ATTR:host                 | -                                                              |\n| OS-EXT-SRV-ATTR:hostname             | abi-1                                                          |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                              |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000004e                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | e2a5fdda-7422-4e41-b59a-fa2dad82583e                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | 4ea6bc99-2c01-459b-9ce1-b6bc6a51ad79                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-wt958hij                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | -                                                              |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 0                                                              |\n| OS-EXT-STS:task_state                | scheduling                                                     |\n| OS-EXT-STS:vm_state                  | building                                                       |\n| OS-SRV-USG:launched_at               | -                                                              |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| adminPass                            | FtPf4XB3exjh                                                   |\n| config_drive                         |                                                                |\n| created                              | 2016-03-28T12:33:13Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               |                                                                |\n| id                                   | fb037e34-7372-45ee-88b6-7dc1d228fe46                           |\n| image                                | cirros-0.3.4-x86_64-uec (a258964a-4250-4b6d-9fe9-492ac2b3d8da) |\n| key_name                             | -                                                              |\n| metadata                             | {}                                                             |\n| name                                 | abi_1                                                          |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | BUILD                                                          |\n| tenant_id                            | 9f87ed00b37d434abd0e422d9f0b9a9b                               |\n| updated                              | 2016-03-28T12:33:13Z                                           |\n| user_id                              | 19250807be0c4c42b970a02ccf3126d2                               |\n+--------------------------------------+----------------------------------------------------------------+\n\nnova list\n+--------------------------------------+------------+--------+------------+-------------+----------------------------------+\n| ID                                   | Name       | Status | Task State | Power State | Networks                         |\n+--------------------------------------+------------+--------+------------+-------------+----------------------------------+\n| 5fefe57f-77cb-4779-9727-fa7d82cf857b | abhilash_1 | ACTIVE | -          | Running     | public=2001:db8::2d, 172.24.4.44 |\n| 28bd1ecf-393d-4073-9f00-62c07fe2ad49 | abi_2      | ERROR  | -          | NOSTATE     |                                  |\n+--------------------------------------+------------+--------+------------+-------------+----------------------------------+\n\n\nThis abi_2 is in error state, which should instead through message at boot command only.", 
            "date_created": "2016-03-28 12:36:49.821884+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhilash-goyal"
        }, 
        {
            "content": "We need more information to do an analysis of the root cause:\n\nlogs\n----\nWould you please double-check these logs for errors:\n* nova-compute\n* nova-conductor\n* neutron\nand add them to this bug report? You could also use \"sosreport\" to\ncollect this information:\n\n    $ sudo sosreport -o openstack_nova --batch\n\nversion\n-------\nWe also need the exact version of OpenStack you are running. See the\nfollowing list for all releases: http://docs.openstack.org/releases/\n   \n       If this is from a distro please provide\n           $ dpkg -l | grep <projectname>\n           or\n           $ rpm -ql | grep <projectname>\n       If this is from git, please provide\n           $ git log -1\n\nmisc\n----\nYou are talking about \"v4-fixed-ip\" in the title and description but\nuse the \"v6-fixed-ip\" argument in the \"nova boot\" command. Is that\na typo or maybe already the issue?\n\n\ntodo\n----\nPlease provide the information for the questions above and set the\nstatus back to \"New\". That's the signal for the nvoa bugs team to\ncheck this report again.", 
            "date_created": "2016-03-29 09:58:34.113337+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "@Markus Zoeller, I have update it to v4-fixed-ip. Attaching sosreport of openstack_nova.", 
            "date_created": "2016-03-31 12:38:58.484229+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhilash-goyal"
        }, 
        {
            "content": "@Ahilash:\nThanks for the sosreport! Unfortunately it doesn't contain the needed log files. Usually they are in \"/var/logs/nova/\". If you use devstack they are usually at \"opt/stack/logs/\". Please look for them and attach them to this bug report. We also need the version you have installed:\n       If this is from a distro please provide\n           $ dpkg -l | grep <projectname>\n           or\n           $ rpm -ql | grep <projectname>\n       If this is from git, please provide\n           $ git log -1", 
            "date_created": "2016-03-31 12:57:13.772331+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "version I am using is '12.0.3'.\nI am attaching the logs files.", 
            "date_created": "2016-04-01 05:17:10.855559+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhilash-goyal"
        }, 
        {
            "content": "@Abhilash:\n\nroot cause\n----------\nThe nova conductor log file \"n-cond.log\" you attached shows the error:\n\n    Invalid input received: \n    Fixed IP 1.0.0.255 is not a valid ip address for network\n    97adf977-8b62-4996-a800-bbbdaf9c0fd9.\n\nThis gets raised in Liberty code at [1]. It's also there in Mitaka and\ncurrent master (Newton). \nAs you already mentioned, this happens after the scheduler chose one \ncompute host and the spawn of the instance has started.\n\nconclusion\n----------\nThe CLI doesn't offer any client side validation. It returns the server\nside created response. Because the spawn of an instance is a long \nrunning task, the \"launch\" REST API triggers the creation asynchronously.\nThis means the CLI only returns that the trigger of the creation got\naccepted. It doesn't make a statement if this will succeed.\nI don't see a benefit in introducing a \"pre-validation\" before the \nscheduler decides where to place an instance. I'm closing the bug report\nas \"Opinion/wishlist\" as it doesn't look like a bug to me. If you think\nthis is wrong, please reopen it and add a reasoning.\n\nReferences:\n[1] https://github.com/openstack/nova/blob/acb2dc5e27a85b9148599f1c4dd59e317752f125/nova/network/neutronv2/api.py#L367-L370", 
            "date_created": "2016-04-01 15:01:49.697199+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ], 
    "closed": "2016-04-01 15:01:38.474005+00:00"
}