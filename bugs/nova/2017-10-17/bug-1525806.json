{
    "status": "Fix Released", 
    "last_updated": "2017-06-16 17:19:42.359571+00:00", 
    "description": "An incorrect value for block_device_mapping_v2 causes HTTP 500 response when creating a VM instance.\nIt should be validated and not to return HTTP 500 response.\n\n[How to reproduce]\na) destination_type is \"\"(an empty string)\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}00abb28e025a6770fc13d70fc6a41e327bca90d6\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"1\", \"source_type\": \"image\", \"destination_type\": \"\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.6\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 194\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-29fb2efe-eda8-43dd-8ea1-5f73b86f6171\nDate: Mon, 14 Dec 2015 07:17:24 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<type 'exceptions.ValueError'>\", \"code\": 500}}\n--------------------------------------\n\nb) destination_type is neither 'volume' nor 'local'\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}7add7a5e501cc287f6043d83144ea24a69134ae7\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"1\", \"source_type\": \"image\", \"destination_type\": \"XXXXX\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.6\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 194\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-f3644722-ba2c-49bf-9db0-badfd7dffa30\nDate: Mon, 14 Dec 2015 07:30:02 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<type 'exceptions.ValueError'>\", \"code\": 500}}\n--------------------------------------\n\nc) volume_size is \"\"(an empty string)\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}85cc81c3f710561ddd640ce26c41990703d925ce\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"\", \"source_type\": \"image\", \"destination_type\": \"volume\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.1\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 194\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-46cb61d3-c110-4bbb-9248-3ebe0f909c23\nDate: Mon, 14 Dec 2015 07:36:27 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<type 'exceptions.ValueError'>\", \"code\": 500}}\n--------------------------------------\n\nd) volume_size is 0\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}85cc81c3f710561ddd640ce26c41990703d925ce\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"0\", \"source_type\": \"image\", \"destination_type\": \"volume\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.1\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 199\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-ed2f5bce-704c-4fb4-bd64-8246746a28a8\nDate: Mon, 14 Dec 2015 07:38:27 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'nova.exception.InvalidBDM'>\", \"code\": 500}}\n--------------------------------------\n\ne) volume_size is more than DB column limit(> 9223372036854775807)\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}85cc81c3f710561ddd640ce26c41990703d925ce\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"9223372036854775808\", \"source_type\": \"image\", \"destination_type\": \"volume\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.1\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 203\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-b8815b21-33ff-4a9b-94bb-7cc72663f868\nDate: Mon, 14 Dec 2015 07:39:59 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'oslo_db.exception.DBDataError'>\", \"code\": 500}}\n--------------------------------------\n\n[Environment]\nOS: Ubuntu 14.04 LTS\nnova: master(commit: 415b221e3345e332f78c9833c2e4e7f0d38bf9c5)", 
    "tags": [
        "api"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1525806", 
    "owner": "https://api.launchpad.net/1.0/~natsume-takashi", 
    "id": 1525806, 
    "index": 4411, 
    "openned": "2015-12-14 07:49:26.737677+00:00", 
    "created": "2015-12-14 07:49:26.737677+00:00", 
    "title": "An incorrect value for block_device_mapping_v2 causes HTTP 500 response when creating a VM instance", 
    "comments": [
        {
            "content": "An incorrect value for block_device_mapping_v2 causes HTTP 500 response when creating a VM instance.\nIt should be validated and not to return HTTP 500 response.\n\n[How to reproduce]\na) destination_type is \"\"(an empty string)\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}00abb28e025a6770fc13d70fc6a41e327bca90d6\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"1\", \"source_type\": \"image\", \"destination_type\": \"\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.6\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 194\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-29fb2efe-eda8-43dd-8ea1-5f73b86f6171\nDate: Mon, 14 Dec 2015 07:17:24 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<type 'exceptions.ValueError'>\", \"code\": 500}}\n--------------------------------------\n\nb) destination_type is neither 'volume' nor 'local'\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}7add7a5e501cc287f6043d83144ea24a69134ae7\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"1\", \"source_type\": \"image\", \"destination_type\": \"XXXXX\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.6\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 194\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-f3644722-ba2c-49bf-9db0-badfd7dffa30\nDate: Mon, 14 Dec 2015 07:30:02 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<type 'exceptions.ValueError'>\", \"code\": 500}}\n--------------------------------------\n\nc) volume_size is \"\"(an empty string)\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}85cc81c3f710561ddd640ce26c41990703d925ce\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"\", \"source_type\": \"image\", \"destination_type\": \"volume\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.1\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 194\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-46cb61d3-c110-4bbb-9248-3ebe0f909c23\nDate: Mon, 14 Dec 2015 07:36:27 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<type 'exceptions.ValueError'>\", \"code\": 500}}\n--------------------------------------\n\nd) volume_size is 0\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}85cc81c3f710561ddd640ce26c41990703d925ce\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"0\", \"source_type\": \"image\", \"destination_type\": \"volume\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.1\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 199\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-ed2f5bce-704c-4fb4-bd64-8246746a28a8\nDate: Mon, 14 Dec 2015 07:38:27 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'nova.exception.InvalidBDM'>\", \"code\": 500}}\n--------------------------------------\n\ne) volume_size is more than DB column limit(> 9223372036854775807)\nExecute the following command(REST API).\ncurl -g -i --cacert \"/opt/stack/data/CA/int-ca/ca-chain.pem\" -X POST http://10.0.2.15:8774/v2.1/e7e043ffac8d4325b2872bd2b53cce2b/os-volumes_boot -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}85cc81c3f710561ddd640ce26c41990703d925ce\" -d '{\"server\": {\"name\": \"server1\", \"imageRef\": \"\", \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"4115a0d1-eee2-4c3e-847d-e50250a989a3\", \"volume_size\": \"9223372036854775808\", \"source_type\": \"image\", \"destination_type\": \"volume\", \"delete_on_termination\": false}], \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1}}'\n\nThe response is as follows:\n--------------------------------------\nHTTP/1.1 500 Internal Server Error\nX-Openstack-Nova-Api-Version: 2.1\nVary: X-OpenStack-Nova-API-Version\nContent-Length: 203\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-b8815b21-33ff-4a9b-94bb-7cc72663f868\nDate: Mon, 14 Dec 2015 07:39:59 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'oslo_db.exception.DBDataError'>\", \"code\": 500}}\n--------------------------------------\n\n[Environment]\nOS: Ubuntu 14.04 LTS\nnova: master(commit: 415b221e3345e332f78c9833c2e4e7f0d38bf9c5)", 
            "date_created": "2015-12-14 07:49:26.737677+00:00", 
            "author": "https://api.launchpad.net/1.0/~natsume-takashi"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/258788", 
            "date_created": "2015-12-17 04:03:03.513406+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/258788\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9ad3dad0c6ab868566e74f0c35a5375d4eaad560\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9ad3dad0c6ab868566e74f0c35a5375d4eaad560\nAuthor: Takashi NATSUME <email address hidden>\nDate:   Mon Mar 14 14:26:11 2016 +0900\n\n    Add validations for volume_size and destination_type\n    \n    Add validations for volume_size and destination_type of\n    block device mapping when creating an instance\n    in order to avoid HTTP 500 errors.\n    Validations has been added in V2.1 API only.\n    Validations that has been added are as follows:\n    \n    * volume_size: an empty string\n    * volume_size: zero\n    * volume_size: greater than DB column's limit\n    * destination_type: an empty string\n    * destination_type: invalid value\n    \n    Change-Id: I2d3084cccd15f409616031f106c611ff07ac4abf\n    Closes-Bug: #1525806\n", 
            "date_created": "2016-05-03 17:58:29.616097+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/mitaka\nReview: https://review.openstack.org/313198", 
            "date_created": "2016-05-06 01:29:17.360693+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0b1 development milestone.", 
            "date_created": "2016-06-02 19:33:18.366054+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/313198\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=eb0d70a7c985e39d4f14d3e71d5514412d56e4d7\nSubmitter: Jenkins\nBranch:    stable/mitaka\n\ncommit eb0d70a7c985e39d4f14d3e71d5514412d56e4d7\nAuthor: Takashi NATSUME <email address hidden>\nDate:   Mon Mar 14 14:26:11 2016 +0900\n\n    Add validations for volume_size and destination_type\n    \n    Add validations for volume_size and destination_type of\n    block device mapping when creating an instance\n    in order to avoid HTTP 500 errors.\n    Validations has been added in V2.1 API only.\n    Validations that has been added are as follows:\n    \n    * volume_size: an empty string\n    * volume_size: zero\n    * volume_size: greater than DB column's limit\n    * destination_type: an empty string\n    * destination_type: invalid value\n    \n    Change-Id: I2d3084cccd15f409616031f106c611ff07ac4abf\n    Closes-Bug: #1525806\n    (cherry picked from commit 9ad3dad0c6ab868566e74f0c35a5375d4eaad560)\n", 
            "date_created": "2016-06-09 05:50:18.072801+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.1.0 release.", 
            "date_created": "2016-06-14 15:41:30.640308+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }
    ], 
    "closed": "2016-05-03 17:58:27.378240+00:00"
}