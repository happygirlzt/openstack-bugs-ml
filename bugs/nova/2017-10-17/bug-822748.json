{
    "status": "Fix Released", 
    "last_updated": "2011-12-29 02:45:33.652356+00:00", 
    "description": "Sometime recently, many exceptions in nova are resulting in a traceback similar to this:\n\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/amqp.py\", line 230, in _process_data\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 125, in wrapped\n(nova): TRACE:     raise\n(nova): TRACE: TypeError: exceptions must be old-style classes or derived from BaseException, not NoneType\n(nova): TRACE: \n\nThis appears to be an unrelated problem that is obscuring the real exception and makes it difficult to troubleshoot other problems.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 26, 
    "link": "https://bugs.launchpad.net/nova/+bug/822748", 
    "owner": "https://api.launchpad.net/1.0/~johannes.erdfelt", 
    "id": 822748, 
    "index": 3498, 
    "openned": "2011-08-08 15:09:35.015874+00:00", 
    "created": "2011-08-08 15:09:35.015874+00:00", 
    "title": "exceptions must be old-style classes or derived from BaseException, not NoneType", 
    "comments": [
        {
            "content": "Sometime recently, many exceptions in nova are resulting in a traceback similar to this:\n\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/amqp.py\", line 230, in _process_data\n(nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 125, in wrapped\n(nova): TRACE:     raise\n(nova): TRACE: TypeError: exceptions must be old-style classes or derived from BaseException, not NoneType\n(nova): TRACE: \n\nThis appears to be an unrelated problem that is obscuring the real exception and makes it difficult to troubleshoot other problems.", 
            "date_created": "2011-08-08 15:09:35.015874+00:00", 
            "author": "https://api.launchpad.net/1.0/~johannes.erdfelt"
        }, 
        {
            "content": "I don't think this bug is entirely stamped out. I am running a test we created  that heavily stresses the OSAPI and see the following in nova-network.log. I am running\n\nii  nova-network                2011.3-0ubuntu6.2           OpenStack Compute - Network manager\n\nwhich should have the change that was supposed to fix this. I verified it is there in the source. This is a single-node configuration of nova. This particular version of the test is creating and destroying vms. I am including the nova.conf at the end.\n\n2011-10-31 10:49:54,178 DEBUG nova.network.manager [51c0fc51-12ab-4a81-9b0b-46b788dbdf63 None None] Leased IP |10.0.0.2| from (pid=104\\\n10) lease_fixed_ip /usr/lib/python2.7/dist-packages/nova/network/manager.py:645\n2011-10-31 10:49:54,314 ERROR nova.exception [-] DB exception wrapped.\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 78, in _wrap\n(nova.exception): TRACE:     return f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1400, in flush\n(nova.exception): TRACE:     self._flush(objects)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1488, in _flush\n(nova.exception): TRACE:     raise\n(nova.exception): TRACE: TypeError: exceptions must be old-style classes or derived from BaseException, not NoneType\n(nova.exception): TRACE:\n2011-10-31 10:49:54,315 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 655, in lease_fixed_ip\n(nova.rpc): TRACE:     'updated_at': now})\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 402, in fixed_ip_update\n(nova.rpc): TRACE:     return IMPL.fixed_ip_update(context, address, values)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 119, in wrapper\n(nova.rpc): TRACE:     return f(*args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 885, in fixed_ip_update\n(nova.rpc): TRACE:     fixed_ip_ref.save(session=session)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/models.py\", line 59, in save\n(nova.rpc): TRACE:     session.flush()\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 81, in _wrap\n(nova.rpc): TRACE:     raise DBError(e)\n(nova.rpc): TRACE: DBError: exceptions must be old-style classes or derived from BaseException, not NoneType\n(nova.rpc): TRACE:\n2011-10-31 10:50:01,043 DEBUG nova.rpc [-] received {u'_context_roles': [], u'_msg_id': u'acc9ab22f22f41b39bd453a15d8e3e86', u'_contex\\\nt_read_deleted': False, u'_context_request_id': u'e63bf738-5258-4383-bcaa-f5330a4ba302', u'args': {u'project_id': u'testproject', u're\\\nquested_networks': None, u'instance_type_id': 1, u'instance_id': 111, u'host': u'xg11eth0', u'vpn': False}, u'_context_auth_token': No\\\nne, u'_context_strategy': u'noauth', u'_context_is_admin': True, u'_context_project_id': u'testproject', u'_context_timestamp': u'2011\\\n-10-31T14:49:57.960865', u'_context_user_id': u'tester', u'method': u'allocate_for_instance', u'_context_remote_address': u'127.0.0.1'\\\n} from (pid=10410) __call__ /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:600\n\n--flagfile=/etc/nova/nova-compute.conf\n--use_deprecated_auth\n--dhcpbridge_flagfile=/etc/nova/nova.conf\n--dhcpbridge=/usr/bin/nova-dhcpbridge\n--sql_connection=mysql://nova:notnova@172.18.0.171/nova\n--s3_host=172.18.0.171\n--rabbit_host=172.18.0.171\n--glance_api_servers=172.18.0.171:9292\n--logdir=/var/log/nova\n--state_path=/var/lib/nova\n--lock_path=/var/lock/nova\n--verbose\n--ec2_url=http://172.18.0.171:8773/services/Cloud\n--dmz_cidr=172.18.0.171/32\n--fixed_range=10.0.0.0/24\n--network_size=256\n--image_service=nova.image.glance.GlanceImageService\n--bridge_interface=eth1\n--flat_network_bridge=br100\n--flat_interface=eth1\n--network_manager=nova.network.manager.FlatDHCPManager\n--public_interface=eth0\n--multi_host=1\n--osapi_host=172.18.0.171\n--quota_instances=1000000\n--quota_ram=1000000\n--quota_cores=100\n--iscsi_ip_prefix=172.18.0\n\n", 
            "date_created": "2011-10-31 16:12:27.089285+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "I'm also seeing this with diablo.\nI only started seeing this after I configured MySQL in a multi-master configuration.", 
            "date_created": "2011-11-17 11:48:13.150685+00:00", 
            "author": "https://api.launchpad.net/1.0/~tellis"
        }, 
        {
            "content": "I should also mention that RabbitMQ is controlled by Pacemaker and at the moment there is only one compute node.\nI only really see it when I fire off multiple instances at once. If I run euca-run-instances sequentially, it copes fine but when running 'euca-run-instances -n 3', I see this error and the instances fail to launch.\n", 
            "date_created": "2011-11-17 12:18:15.612939+00:00", 
            "author": "https://api.launchpad.net/1.0/~tellis"
        }, 
        {
            "content": "A) Do you know if multi-master sql supports row locking?\n\nB) Can you switch to the carrot driver for rpc and see if you still see the error:\n--rpc_backend=nova.rpc.impl_carrot\n\nOn Nov 17, 2011, at 4:18 AM, Tom Ellis wrote:\n\n> I should also mention that RabbitMQ is controlled by Pacemaker and at the moment there is only one compute node.\n> I only really see it when I fire off multiple instances at once. If I run euca-run-instances sequentially, it copes fine but when running 'euca-run-instances -n 3', I see this error and the instances fail to launch.\n> \n> -- \n> You received this bug notification because you are subscribed to\n> OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/822748\n> \n> Title:\n>  exceptions must be old-style classes or derived from BaseException,\n>  not NoneType\n> \n> Status in OpenStack Compute (Nova):\n>  Fix Released\n> \n> Bug description:\n>  Sometime recently, many exceptions in nova are resulting in a\n>  traceback similar to this:\n> \n>  (nova): TRACE: Traceback (most recent call last):\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/rpc/amqp.py\", line 230, in _process_data\n>  (nova): TRACE:     rval = node_func(context=ctxt, **node_args)\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 125, in wrapped\n>  (nova): TRACE:     raise\n>  (nova): TRACE: TypeError: exceptions must be old-style classes or derived from BaseException, not NoneType\n>  (nova): TRACE: \n> \n>  This appears to be an unrelated problem that is obscuring the real\n>  exception and makes it difficult to troubleshoot other problems.\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/822748/+subscriptions\n\n", 
            "date_created": "2011-11-17 18:58:51+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ], 
    "closed": "2011-09-22 13:14:24.370996+00:00"
}