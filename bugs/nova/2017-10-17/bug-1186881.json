{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:55:06.367161+00:00", 
    "description": "Repro:\n       1 Create a Flavor m8, and set extra_specs :{u'disk_available': u'130', u'vcpus_used': u'<= 5'}\n       2 Boot an Instance with flavor m8\n  \nExpected:\n       Can Boot Instance successfully when there are hosts match the the os-extra_specs requests\n\nActual: \n        Boot Instance fail with the Error: message:NoValidHost Code:500 \n\nnova-list \n| ID                                                               | Name        | Status       | Task State | Power State | Networks  \n| 896a28b4-a09b-40bc-a269-0ac208fea553 | hahahaha  | ERROR   | None         | NOSTATE   |                 \n\nnova show \n| Property                    | Value                                                                           |\n+-----------------------------+---------------------------------------------------------------------------------+\n| status                      | ERROR   \n| fault                       | {u'message': u'NoValidHost', u'code': 500, u'created': u'2013-06-03T05:42:18Z'} |\n\nthe type of the parameter values in the  capabilities are numbers, while the match() method in the extra_specs_ops.py  handle it as str type, and return false.\nFor example the 'disk_available' value in the capabilities is 131, while in the instance_type extra_specs is '131'\n/nova/nova/scheduler/filters/compute_capabilities_filter.py\nhttps://github.com/openstack/nova/blob/master/nova/scheduler/filters/compute_capabilities_filter.py\n\n/nova/nova/scheduler/filters/extra_specs_ops.py\nhttps://github.com/openstack/nova/blob/master/nova/scheduler/filters/extra_specs_ops.py\n\ncapabilities = {u'disk_available': 131, u'vcpus_used': 1, u'supported_instances': [[u'i686', u'qemu', u'hvm'], [u'i686', u'kvm', u'hvm'], [u'x86_64', u'qemu', u'hvm']], u'hypervisor_type': u'QEMU', u'host_ip': u'127.0.0.1', u'hypervisor_hostname': u'hfl-ThinkPad-T400', u'host_memory_free': 1612, u'disk_total': 143, u'cpu_info': {u'vendor': u'Intel', u'model': u'n270', u'arch': u'i686', u'features': [u'lahf_lm', u'lm', u'sse4.1', u'xtpr', u'cx16', u'tm2', u'est', u'vmx', u'ds_cpl', u'pbe', u'tm', u'ht', u'ss', u'acpi', u'ds', u'pse36'], u'topology': {u'cores': 2, u'threads': 1, u'sockets': 1}}, u'host_memory_total': 2902, 'timestamp': datetime.datetime(2013, 5, 29, 3, 5, 46, 764863), u'hypervisor_version': 1000000, u'disk_used': 5, u'vcpus': 2} \n\ninstance_type = {u'disabled': False, u'root_gb': 1, u'name': u'm6', u'flavorid': u'44', u'deleted': 0, u'created_at': u'2013-05-29T03:02:22.000000', u'ephemeral_gb': 0, u'updated_at': None, u'memory_mb': 512, u'vcpus': 1, u'extra_specs': {u'disk_available': u'=131'}, u'swap': 0, u'rxtx_factor': 1.0, u'is_public': True, u'deleted_at': None, u'vcpu_weight': None, u'id': 21}", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1186881", 
    "owner": "https://api.launchpad.net/1.0/~jiataotj", 
    "id": 1186881, 
    "index": 4974, 
    "openned": "2013-06-03 06:40:26.087680+00:00", 
    "created": "2013-06-03 06:40:26.087680+00:00", 
    "title": "Boot Instance Error with a  Flavor which is set  with os-extra_specs and has hosts meet the requirements in the cloud system", 
    "comments": [
        {
            "content": "Repro:\n       1 Create a Flavor m8, and set extra_specs :{u'disk_available': u'130', u'vcpus_used': u'<= 5'}\n       2 Boot an Instance with flavor m8\n  \nExpected:\n       Can Boot Instance successfully when there are hosts match the the os-extra_specs requests\n\nActual: \n        Boot Instance fail with the Error: message:NoValidHost Code:500 \n\nnova-list \n| ID                                                               | Name        | Status       | Task State | Power State | Networks  \n| 896a28b4-a09b-40bc-a269-0ac208fea553 | hahahaha  | ERROR   | None         | NOSTATE   |                 \n\nnova show \n| Property                    | Value                                                                           |\n+-----------------------------+---------------------------------------------------------------------------------+\n| status                      | ERROR   \n| fault                       | {u'message': u'NoValidHost', u'code': 500, u'created': u'2013-06-03T05:42:18Z'} |\n\nthe type of the parameter values in the  capabilities are numbers, while the match() method in the extra_specs_ops.py  handle it as str type, and return false.\nFor example the 'disk_available' value in the capabilities is 131, while in the instance_type extra_specs is '131'\n/nova/nova/scheduler/filters/compute_capabilities_filter.py\nhttps://github.com/openstack/nova/blob/master/nova/scheduler/filters/compute_capabilities_filter.py\n\n/nova/nova/scheduler/filters/extra_specs_ops.py\nhttps://github.com/openstack/nova/blob/master/nova/scheduler/filters/extra_specs_ops.py\n\ncapabilities = {u'disk_available': 131, u'vcpus_used': 1, u'supported_instances': [[u'i686', u'qemu', u'hvm'], [u'i686', u'kvm', u'hvm'], [u'x86_64', u'qemu', u'hvm']], u'hypervisor_type': u'QEMU', u'host_ip': u'127.0.0.1', u'hypervisor_hostname': u'hfl-ThinkPad-T400', u'host_memory_free': 1612, u'disk_total': 143, u'cpu_info': {u'vendor': u'Intel', u'model': u'n270', u'arch': u'i686', u'features': [u'lahf_lm', u'lm', u'sse4.1', u'xtpr', u'cx16', u'tm2', u'est', u'vmx', u'ds_cpl', u'pbe', u'tm', u'ht', u'ss', u'acpi', u'ds', u'pse36'], u'topology': {u'cores': 2, u'threads': 1, u'sockets': 1}}, u'host_memory_total': 2902, 'timestamp': datetime.datetime(2013, 5, 29, 3, 5, 46, 764863), u'hypervisor_version': 1000000, u'disk_used': 5, u'vcpus': 2} \n\ninstance_type = {u'disabled': False, u'root_gb': 1, u'name': u'm6', u'flavorid': u'44', u'deleted': 0, u'created_at': u'2013-05-29T03:02:22.000000', u'ephemeral_gb': 0, u'updated_at': None, u'memory_mb': 512, u'vcpus': 1, u'extra_specs': {u'disk_available': u'=131'}, u'swap': 0, u'rxtx_factor': 1.0, u'is_public': True, u'deleted_at': None, u'vcpu_weight': None, u'id': 21}", 
            "date_created": "2013-06-03 06:40:26.087680+00:00", 
            "author": "https://api.launchpad.net/1.0/~hufali87"
        }, 
        {
            "content": "https://github.com/openstack/nova/blob/master/nova/tests/scheduler/test_host_filters.py\n\nIn the UT for the extra_specs_ops.py, it translates str type of data to extra_specs_ops.match() method, I think  the extra_specs_ops.match() is  designed for str type of data. We can translate the numbers to str type in compute_capabilities_filter.py before invoking the extra_specs_ops.match() function.\n", 
            "date_created": "2013-06-04 05:49:17.554503+00:00", 
            "author": "https://api.launchpad.net/1.0/~hufali87"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/31474\nCommitted: http://github.com/openstack/nova/commit/e5e0fddad9ac208087f4e5b5c644575ad6d5c796\nSubmitter: Jenkins\nBranch:    master\n\ncommit e5e0fddad9ac208087f4e5b5c644575ad6d5c796\nAuthor: jiataotj <email address hidden>\nDate:   Mon Jun 3 16:36:05 2013 +0800\n\n    Fix flavor extra_specs filter doesn't work for number\n    \n    In extra_specs_ops.match(value, req) function, req are\n    always string,but value of host capabilities may be number.\n    When filter host by comparing number with string,even right\n    os-extra_specs can't pass filter.\n    We should convert value to string to make the filter work\n    correctly.\n    \n    Fixes: bug #1186881\n    \n    Change-Id: I3e1ab60109673450caae3a7f0bc4a3610ae619ef\n", 
            "date_created": "2013-06-18 22:05:13.798950+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-07-17 12:34:52.950862+00:00"
}