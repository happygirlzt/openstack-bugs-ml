{
    "status": "Expired", 
    "last_updated": "2017-09-27 04:18:21.483066+00:00", 
    "description": "This is a complicated one.\n\nStart with a boot from volume instance. Instance uses a 1G volume, and a tiny image. Make a snapshot of this, which results in a volume snapshot plus a image in glance. Image details:\n\n# openstack image show a9a2a4af-0383-47a0-85e6-c3211f11459e\n+------------------+-----------------------------------------------------------+\n| Field            | Value                                                     |\n+------------------+-----------------------------------------------------------+\n| checksum         | d41d8cd98f00b204e9800998ecf8427e                          |\n| container_format | bare                                                      |\n| created_at       | 2016-11-21T18:13:23Z                                      |\n| disk_format      | qcow2                                                     |\n| file             | /v2/images/a9a2a4af-0383-47a0-85e6-c3211f11459e/file      |\n| id               | a9a2a4af-0383-47a0-85e6-c3211f11459e                      |\n| min_disk         | 10                                                        |\n| min_ram          | 0                                                         |\n| name             | testsnap                                                  |\n| owner            | 6fe9193745c64a44ab30d6bd1c5cb8bb                          |\n| properties       | base_image_ref='', bdm_v2='True',                         |\n|                  | block_device_mapping='[{\"guest_format\": null,             |\n|                  | \"boot_index\": 0, \"delete_on_termination\": false,          |\n|                  | \"no_device\": null, \"snapshot_id\": \"5186f403-bf91-49d4     |\n|                  | -b3db-c273e087fcfa\", \"device_name\": \"/dev/vda\",           |\n|                  | \"disk_bus\": \"virtio\", \"image_id\": null, \"source_type\":    |\n|                  | \"snapshot\", \"tag\": null, \"device_type\": \"disk\",           |\n|                  | \"volume_id\": null, \"destination_type\": \"volume\",          |\n|                  | \"volume_size\": 1}]', owner_specified.shade.md5='133eae9fb |\n|                  | 1c98f45894a4e60d8736619',                                 |\n|                  | owner_specified.shade.object='images/cirros', owner_speci |\n|                  | fied.shade.sha256='f11286e2bd317ee1a1d0469a6b182b33bda4af |\n|                  | 6f35ba224ca49d75752c81e20a', root_device_name='/dev/vda'  |\n| protected        | False                                                     |\n| schema           | /v2/schemas/image                                         |\n| size             | 0                                                         |\n| status           | active                                                    |\n| tags             |                                                           |\n| updated_at       | 2016-11-21T18:13:24Z                                      |\n| virtual_size     | None                                                      |\n| visibility       | private                                                   |\n+------------------+-----------------------------------------------------------+\n\nFirst, try booting just using the image:\n\n# openstack server create --image a9a2a4af-0383-47a0-85e6-c3211f11459e --flavor 2 --nic net-id=832c3099-a589-4f05-8f70-c5af5b2f852b lolwhut\nVolume is smaller than the minimum size specified in image metadata. Volume size is 1073741824 bytes, minimum size is 10737418240 bytes. (HTTP 400) (Request-ID: req-97cc0a55-7d5b-4e14-8f4b-e8a501f96f11)\n\nNova is saying that the minimum size is 10G, but the requested bdm size is 1. I'm assuming that's coming from the instance data's block_device_mapping key, which has volume_size of 1.\n\nNow, try doing this where you're also requesting to boot from volume, of size 15 (this was done via horizon):\n\n2016-11-21 19:50:28.398 12516 DEBUG nova.api.openstack.wsgi [req-4481446f-e026-4e83-b07a-1acdfa08194f 4921001dd4944f1396f7e6d64717f044 6fe9193745c64a44ab30d6bd1c5cb8bb - default default] Action: 'create', calling method: <bound method ServersController.create of <nova.api.openstack.compute.servers.ServersController object at 0x7fed5204cd50>>, body: {\"server\": {\"name\": \"jlkwhat\", \"imageRef\": \"\", \"availability_zone\": \"ci\", \"key_name\": \"turtle-key\", \"flavorRef\": \"2\", \"OS-DCF:diskConfig\": \"AUTO\", \"max_count\": 1, \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"a9a2a4af-0383-47a0-85e6-c3211f11459e\", \"volume_size\": 15, \"device_name\": \"vda\", \"source_type\": \"image\", \"destination_type\": \"volume\", \"delete_on_termination\": false}], \"min_count\": 1, \"networks\": [{\"uuid\": \"832c3099-a589-4f05-8f70-c5af5b2f852b\"}], \"security_groups\": [{\"name\": \"f8cb8d50-698a-48b0-9a83-1201e89834e0\"}]}} _process_stack /opt/bbc/openstack-2016.2-newton/nova/local/lib/python2.7/site-packages/nova/api/openstack/wsgi.py:633\n\n\nSee that it has a source_type of image, and a destination_type of volume, and block_device_mapping_v2 shows volume_size of 15 (but references that image UUID from above).\n\nNova STILL spits out the same warning:\n\n2016-11-21 19:50:29.004 12516 DEBUG nova.api.openstack.wsgi [req-4481446f-e026-4e83-b07a-1acdfa08194f 4921001dd4944f1396f7e6d64717f044 6fe9193745c64a44ab30d6bd1c5cb8bb - default default] Returning 400 to user: Volume is smaller than the minimum size specified in image metadata. Volume size is 1073741824 bytes, minimum size is 10737418240 bytes. __call__ /opt/bbc/openstack-2016.2-newton/nova/local/lib/python2.7/site-packages/nova/api/openstack/wsgi.py:1044\n\nIt would appear that even though I'm asking nova to create and boot from a 15 gig volume, the internal check for validity of the target is using the info it gleans from the image's own block_device_mapping, not the boot request's block_device_mapping(_v2).\n\nThis is all done on a stable/newton install, from commit 867661d51bdb0cf2a6f326cb18f26bbc1f04eb15", 
    "tags": [
        "openstack-version.newton"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1643684", 
    "owner": "None", 
    "id": 1643684, 
    "index": 7814, 
    "openned": "2016-11-21 20:32:22.152219+00:00", 
    "created": "2016-11-21 20:32:22.152219+00:00", 
    "title": "_check_requested_image uses incorrect bdm info to validate target volume when booting from boot from volume instance snapshot image", 
    "comments": [
        {
            "content": "This is a complicated one.\n\nStart with a boot from volume instance. Instance uses a 1G volume, and a tiny image. Make a snapshot of this, which results in a volume snapshot plus a image in glance. Image details:\n\n# openstack image show a9a2a4af-0383-47a0-85e6-c3211f11459e\n+------------------+-----------------------------------------------------------+\n| Field            | Value                                                     |\n+------------------+-----------------------------------------------------------+\n| checksum         | d41d8cd98f00b204e9800998ecf8427e                          |\n| container_format | bare                                                      |\n| created_at       | 2016-11-21T18:13:23Z                                      |\n| disk_format      | qcow2                                                     |\n| file             | /v2/images/a9a2a4af-0383-47a0-85e6-c3211f11459e/file      |\n| id               | a9a2a4af-0383-47a0-85e6-c3211f11459e                      |\n| min_disk         | 10                                                        |\n| min_ram          | 0                                                         |\n| name             | testsnap                                                  |\n| owner            | 6fe9193745c64a44ab30d6bd1c5cb8bb                          |\n| properties       | base_image_ref='', bdm_v2='True',                         |\n|                  | block_device_mapping='[{\"guest_format\": null,             |\n|                  | \"boot_index\": 0, \"delete_on_termination\": false,          |\n|                  | \"no_device\": null, \"snapshot_id\": \"5186f403-bf91-49d4     |\n|                  | -b3db-c273e087fcfa\", \"device_name\": \"/dev/vda\",           |\n|                  | \"disk_bus\": \"virtio\", \"image_id\": null, \"source_type\":    |\n|                  | \"snapshot\", \"tag\": null, \"device_type\": \"disk\",           |\n|                  | \"volume_id\": null, \"destination_type\": \"volume\",          |\n|                  | \"volume_size\": 1}]', owner_specified.shade.md5='133eae9fb |\n|                  | 1c98f45894a4e60d8736619',                                 |\n|                  | owner_specified.shade.object='images/cirros', owner_speci |\n|                  | fied.shade.sha256='f11286e2bd317ee1a1d0469a6b182b33bda4af |\n|                  | 6f35ba224ca49d75752c81e20a', root_device_name='/dev/vda'  |\n| protected        | False                                                     |\n| schema           | /v2/schemas/image                                         |\n| size             | 0                                                         |\n| status           | active                                                    |\n| tags             |                                                           |\n| updated_at       | 2016-11-21T18:13:24Z                                      |\n| virtual_size     | None                                                      |\n| visibility       | private                                                   |\n+------------------+-----------------------------------------------------------+\n\nFirst, try booting just using the image:\n\n# openstack server create --image a9a2a4af-0383-47a0-85e6-c3211f11459e --flavor 2 --nic net-id=832c3099-a589-4f05-8f70-c5af5b2f852b lolwhut\nVolume is smaller than the minimum size specified in image metadata. Volume size is 1073741824 bytes, minimum size is 10737418240 bytes. (HTTP 400) (Request-ID: req-97cc0a55-7d5b-4e14-8f4b-e8a501f96f11)\n\nNova is saying that the minimum size is 10G, but the requested bdm size is 1. I'm assuming that's coming from the instance data's block_device_mapping key, which has volume_size of 1.\n\nNow, try doing this where you're also requesting to boot from volume, of size 15 (this was done via horizon):\n\n2016-11-21 19:50:28.398 12516 DEBUG nova.api.openstack.wsgi [req-4481446f-e026-4e83-b07a-1acdfa08194f 4921001dd4944f1396f7e6d64717f044 6fe9193745c64a44ab30d6bd1c5cb8bb - default default] Action: 'create', calling method: <bound method ServersController.create of <nova.api.openstack.compute.servers.ServersController object at 0x7fed5204cd50>>, body: {\"server\": {\"name\": \"jlkwhat\", \"imageRef\": \"\", \"availability_zone\": \"ci\", \"key_name\": \"turtle-key\", \"flavorRef\": \"2\", \"OS-DCF:diskConfig\": \"AUTO\", \"max_count\": 1, \"block_device_mapping_v2\": [{\"boot_index\": \"0\", \"uuid\": \"a9a2a4af-0383-47a0-85e6-c3211f11459e\", \"volume_size\": 15, \"device_name\": \"vda\", \"source_type\": \"image\", \"destination_type\": \"volume\", \"delete_on_termination\": false}], \"min_count\": 1, \"networks\": [{\"uuid\": \"832c3099-a589-4f05-8f70-c5af5b2f852b\"}], \"security_groups\": [{\"name\": \"f8cb8d50-698a-48b0-9a83-1201e89834e0\"}]}} _process_stack /opt/bbc/openstack-2016.2-newton/nova/local/lib/python2.7/site-packages/nova/api/openstack/wsgi.py:633\n\n\nSee that it has a source_type of image, and a destination_type of volume, and block_device_mapping_v2 shows volume_size of 15 (but references that image UUID from above).\n\nNova STILL spits out the same warning:\n\n2016-11-21 19:50:29.004 12516 DEBUG nova.api.openstack.wsgi [req-4481446f-e026-4e83-b07a-1acdfa08194f 4921001dd4944f1396f7e6d64717f044 6fe9193745c64a44ab30d6bd1c5cb8bb - default default] Returning 400 to user: Volume is smaller than the minimum size specified in image metadata. Volume size is 1073741824 bytes, minimum size is 10737418240 bytes. __call__ /opt/bbc/openstack-2016.2-newton/nova/local/lib/python2.7/site-packages/nova/api/openstack/wsgi.py:1044\n\nIt would appear that even though I'm asking nova to create and boot from a 15 gig volume, the internal check for validity of the target is using the info it gleans from the image's own block_device_mapping, not the boot request's block_device_mapping(_v2).\n\nThis is all done on a stable/newton install, from commit 867661d51bdb0cf2a6f326cb18f26bbc1f04eb15", 
            "date_created": "2016-11-21 20:32:22.152219+00:00", 
            "author": "https://api.launchpad.net/1.0/~jesse-keating"
        }, 
        {
            "content": "Spoke with Jesse about this and said I'd investigate his issue. Had him create a bug so I had an artifact to work from.", 
            "date_created": "2016-11-22 00:10:37.289616+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "How is the work going, Augustina - any progress? Are you still working on this item?", 
            "date_created": "2017-03-08 17:28:57.679025+00:00", 
            "author": "https://api.launchpad.net/1.0/~mszankin"
        }, 
        {
            "content": "Automatically discovered version newton in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 15:56:21.752197+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "There are no currently open reviews on this bug, changing the status back to the previous state and unassigning. If there are active reviews related to this bug, please include links in comments. ", 
            "date_created": "2017-06-27 19:30:37.721426+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Is there a reproduce on current master. I know a lot of the bug participants here are no longer working on openstack very actively.", 
            "date_created": "2017-07-28 17:06:34.055740+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2017-09-27 04:18:17.256231+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2017-09-27 04:18:18.039256+00:00"
}