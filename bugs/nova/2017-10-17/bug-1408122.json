{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:20:29.725387+00:00", 
    "description": "When pulling service information on a compute node with cells there is a failure to convert the compute node db dict into an object.  This is due to the id field being of the form 'region!child@1' while the compute_node object id field is expected to be an int.\n\n2015-01-06 17:17:07.365 ERROR nova.api.openstack [req-b8e62f38-a1b1-4d41-9502-484c706cba5c HostsAdminTestJSON-320709791 HostsAdminTestJSON-164089223] Caught error: invalid literal for int() with base 10: 'region!child@1'\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack Traceback (most recent call last):\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 125, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return req.get_response(self.application)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     application, catch_exc_info=False)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 823, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return self._call_app(env, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 758, in _call_app\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return self._app(env, _fake_start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return resp(environ, start_response)2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 752, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     content_type, body, accept)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 817, in _process_stack\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 907, in dispatch\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return method(req=request, **action_args)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/hosts.py\", line 272, in show\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     service = self.api.service_get_by_compute_host(context, host_name)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/cells_api.py\", line 570, in service_get_by_compute_host\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     db_service)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/service.py\", line 77, in _from_db_object\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     service._do_compute_node(context, service, db_service)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/service.py\", line 68, in _do_compute_node\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     context, objects.ComputeNode(), db_compute)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/compute_node.py\", line 130, in _from_db_object\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     compute[key] = db_compute[key]\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 598, in __setitem__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     setattr(self, name, value)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 76, in setter\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     field_value = field.coerce(self, name, value)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/fields.py\", line 189, in coerce\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return self._type.coerce(obj, attr, value)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/fields.py\", line 264, in coerce\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return int(value)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack ValueError: invalid literal for int() with base 10: 'region!child@1'\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1408122", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1408122, 
    "index": 6631, 
    "openned": "2015-01-06 22:11:57.749081+00:00", 
    "created": "2015-01-06 22:11:57.749081+00:00", 
    "title": "Cells service_get_by_compute_host fails on object conversion", 
    "comments": [
        {
            "content": "When pulling service information on a compute node with cells there is a failure to convert the compute node db dict into an object.  This is due to the id field being of the form 'region!child@1' while the compute_node object id field is expected to be an int.\n\n2015-01-06 17:17:07.365 ERROR nova.api.openstack [req-b8e62f38-a1b1-4d41-9502-484c706cba5c HostsAdminTestJSON-320709791 HostsAdminTestJSON-164089223] Caught error: invalid literal for int() with base 10: 'region!child@1'\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack Traceback (most recent call last):\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 125, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return req.get_response(self.application)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1320, in send\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     application, catch_exc_info=False)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1284, in call_application\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 823, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return self._call_app(env, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token.py\", line 758, in _call_app\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return self._app(env, _fake_start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return resp(environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return resp(environ, start_response)2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 752, in __call__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     content_type, body, accept)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 817, in _process_stack\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 907, in dispatch\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return method(req=request, **action_args)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/hosts.py\", line 272, in show\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     service = self.api.service_get_by_compute_host(context, host_name)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/compute/cells_api.py\", line 570, in service_get_by_compute_host\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     db_service)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/service.py\", line 77, in _from_db_object\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     service._do_compute_node(context, service, db_service)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/service.py\", line 68, in _do_compute_node\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     context, objects.ComputeNode(), db_compute)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/compute_node.py\", line 130, in _from_db_object\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     compute[key] = db_compute[key]\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 598, in __setitem__\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     setattr(self, name, value)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/base.py\", line 76, in setter\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     field_value = field.coerce(self, name, value)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/fields.py\", line 189, in coerce\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return self._type.coerce(obj, attr, value)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack   File \"/opt/stack/nova/nova/objects/fields.py\", line 264, in coerce\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack     return int(value)\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack ValueError: invalid literal for int() with base 10: 'region!child@1'\n2015-01-06 17:17:07.365 21844 TRACE nova.api.openstack", 
            "date_created": "2015-01-06 22:11:57.749081+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/145362", 
            "date_created": "2015-01-06 22:30:23.679989+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/145362\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=19c2b3e966f32b9351e86dc34eac6e8fdc88b29a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 19c2b3e966f32b9351e86dc34eac6e8fdc88b29a\nAuthor: Andrew Laski <email address hidden>\nDate:   Tue Jan 6 17:12:45 2015 -0500\n\n    Cells: Fix service_get_by_compute_host\n    \n    Compute_node objects require that the 'id' field be an int, but with\n    cells the 'id' is a string with routing information.  So conversion of\n    the dict returned via RPC from a child cell fails.\n    \n    This patch adds a proxy object to keep the routing information visible\n    via the API without changing the underlying object model.\n    \n    Change-Id: I71ab82841983798105237804d20bd41c04acfc7b\n    Closes-bug: #1408122\n", 
            "date_created": "2015-02-04 14:37:21.392967+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-02-05 20:24:39.929627+00:00"
}