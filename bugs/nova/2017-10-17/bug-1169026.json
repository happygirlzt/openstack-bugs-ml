{
    "status": "Fix Released", 
    "last_updated": "2014-05-04 10:13:04.704026+00:00", 
    "description": "In Vlan mode when I tried to create a network without setting the --vlan mode, I got the DuplicateVlan exception.\n\n$ nova network-create --fixed-range-v4 192.168.3.1/24 net\n\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-14c6c520-d6a4-4d6e-9280-3957091f4631)\n\nThe log in the nova-network service is :\n\n2013-04-15 03:10:37    ERROR [nova.openstack.common.rpc.amqp] Exception during message handling\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/network/manager.py\", line 1817, in create_networks\n    self, context, vpn=True, **kwargs)\n  File \"/opt/stack/nova/nova/network/manager.py\", line 1058, in create_networks\n    return self._do_create_networks(context, **kwargs)\n  File \"/opt/stack/nova/nova/network/manager.py\", line 1187, in _do_create_networks\n    network = self.db.network_create_safe(context, net)\n  File \"/opt/stack/nova/nova/db/api.py\", line 797, in network_create_safe\n    return IMPL.network_create_safe(context, values)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 96, in wrapper\n    return f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2164, in network_create_safe\n    raise exception.DuplicateVlan(vlan=values['vlan'])\nDuplicateVlan: Detected existing vlan with id 100\n2013-04-15 03:10:37    DEBUG [nova.openstack.common.rpc.amqp] Pool creating new connection\n2013-04-15 03:10:37     INFO [nova.openstack.common.rpc.common] Connected to AMQP server on localhost:5672\n2013-04-15 03:10:37    ERROR [nova.openstack.common.rpc.common] Returning exception Detected existing vlan with id 100 to caller\n2013-04-15 03:10:37    ERROR [nova.openstack.common.rpc.common] ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\\n', '  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\\n    return getattr(proxyobj, method)(ctxt, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1817, in create_networks\\n    self, context, vpn=True, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1058, in create_networks\\n    return self._do_create_networks(context, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1187, in _do_create_networks\\n    network = self.db.network_create_safe(context, net)\\n', '  File \"/opt/stack/nova/nova/db/api.py\", line 797, in network_create_safe\\n    return IMPL.network_create_safe(context, values)\\n', '  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 96, in wrapper\\n    return f(*args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2164, in network_create_safe\\n    raise exception.DuplicateVlan(vlan=values[\\'vlan\\'])\\n', 'DuplicateVlan: Detected existing vlan with id 100\\n']\n\nThis is because \"vlan\" is set to the default value 100, if the --vlan option isn't set.\nSo I think we should make \"vlan\" an essential option to fix to bug.", 
    "tags": [
        "network"
    ], 
    "importance": "Medium", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1169026", 
    "owner": "https://api.launchpad.net/1.0/~aloga", 
    "id": 1169026, 
    "index": 3357, 
    "openned": "2013-04-15 04:12:40.760318+00:00", 
    "created": "2013-04-15 04:12:40.760318+00:00", 
    "title": "In Vlan mode can't create a network when --vlan option is not set", 
    "comments": [
        {
            "content": "In Vlan mode when I tried to create a network without setting the --vlan mode, I got the DuplicateVlan exception.\n\n$ nova network-create --fixed-range-v4 192.168.3.1/24 net\n\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-14c6c520-d6a4-4d6e-9280-3957091f4631)\n\nThe log in the nova-network service is :\n\n2013-04-15 03:10:37    ERROR [nova.openstack.common.rpc.amqp] Exception during message handling\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/network/manager.py\", line 1817, in create_networks\n    self, context, vpn=True, **kwargs)\n  File \"/opt/stack/nova/nova/network/manager.py\", line 1058, in create_networks\n    return self._do_create_networks(context, **kwargs)\n  File \"/opt/stack/nova/nova/network/manager.py\", line 1187, in _do_create_networks\n    network = self.db.network_create_safe(context, net)\n  File \"/opt/stack/nova/nova/db/api.py\", line 797, in network_create_safe\n    return IMPL.network_create_safe(context, values)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 96, in wrapper\n    return f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2164, in network_create_safe\n    raise exception.DuplicateVlan(vlan=values['vlan'])\nDuplicateVlan: Detected existing vlan with id 100\n2013-04-15 03:10:37    DEBUG [nova.openstack.common.rpc.amqp] Pool creating new connection\n2013-04-15 03:10:37     INFO [nova.openstack.common.rpc.common] Connected to AMQP server on localhost:5672\n2013-04-15 03:10:37    ERROR [nova.openstack.common.rpc.common] Returning exception Detected existing vlan with id 100 to caller\n2013-04-15 03:10:37    ERROR [nova.openstack.common.rpc.common] ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 430, in _process_data\\n    rval = self.proxy.dispatch(ctxt, version, method, **args)\\n', '  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\\n    return getattr(proxyobj, method)(ctxt, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1817, in create_networks\\n    self, context, vpn=True, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1058, in create_networks\\n    return self._do_create_networks(context, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1187, in _do_create_networks\\n    network = self.db.network_create_safe(context, net)\\n', '  File \"/opt/stack/nova/nova/db/api.py\", line 797, in network_create_safe\\n    return IMPL.network_create_safe(context, values)\\n', '  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 96, in wrapper\\n    return f(*args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2164, in network_create_safe\\n    raise exception.DuplicateVlan(vlan=values[\\'vlan\\'])\\n', 'DuplicateVlan: Detected existing vlan with id 100\\n']\n\nThis is because \"vlan\" is set to the default value 100, if the --vlan option isn't set.\nSo I think we should make \"vlan\" an essential option to fix to bug.", 
            "date_created": "2013-04-15 04:12:40.760318+00:00", 
            "author": "https://api.launchpad.net/1.0/~xu-haiwei"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/34529\nCommitted: http://github.com/openstack/nova/commit/ec4a9490047106b36c8a6bdf91fc7579b84868dd\nSubmitter: Jenkins\nBranch:    master\n\ncommit ec4a9490047106b36c8a6bdf91fc7579b84868dd\nAuthor: Alvaro Lopez Garcia <email address hidden>\nDate:   Wed Jul 17 13:20:33 2013 +0200\n\n    Fix network creation in Vlan mode\n    \n    - If \"vlan\" is specified when creating a network, we honour the option.\n    - If it is not specified, the Vlan number is calculated as follows:\n    CONF.vlan_start + num_existing_networks + index_of_requested_network\n    - If the above vlan is in use, try to get the next free vlan.\n    \n    Fixes bug 1194835\n    Fixes bug 1169026\n    \n    Change-Id: Id4476c14f9dadcf498a499534337477b3f64f604\n", 
            "date_created": "2013-09-02 05:18:28.526893+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "If vlan is not specified, instead of calculating why not just use the smallest available vlan id?\n\n\n\n", 
            "date_created": "2014-05-04 10:13:03.839267+00:00", 
            "author": "https://api.launchpad.net/1.0/~wenjianhn"
        }
    ], 
    "closed": "2013-09-05 15:40:58.922490+00:00"
}