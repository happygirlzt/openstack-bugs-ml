{
    "status": "Invalid", 
    "last_updated": "2013-10-06 16:46:58.418874+00:00", 
    "description": "We've been seeing a trend of people being unable to start instances, investigation yields the following tracebacks in the nova-compute.log on the relevant compute nodes:\n\n2012-04-04 14:21:10 ERROR nova.compute.manager [-] [instance: d86678fb-2a29-4b4e-84b4-c1cb2d81a6e2] Instance failed network setup\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.compute.manager): TRACE:     requested_networks=requested_networks)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.compute.manager): TRACE:     'args': args})\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 68, in call\n(nova.compute.manager): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.compute.manager): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 338, in call\n(nova.compute.manager): TRACE:     rv = list(rv)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 299, in __iter__\n(nova.compute.manager): TRACE:     self._iterator.next()\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 572, in iterconsume\n(nova.compute.manager): TRACE:     yield self.ensure(_error_callback, _consume)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 503, in ensure\n(nova.compute.manager): TRACE:     error_callback(e)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 553, in _error_callback\n(nova.compute.manager): TRACE:     raise rpc_common.Timeout()\n(nova.compute.manager): TRACE: Timeout: Timeout while waiting on RPC response.\n(nova.compute.manager): TRACE:\n2012-04-04 14:21:10 ERROR nova.rpc.amqp [-] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 648, in run_instance\n(nova.rpc.amqp): TRACE:     self._run_instance(context, instance_uuid, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 451, in _run_instance\n(nova.rpc.amqp): TRACE:     self._set_instance_error_state(context, instance_uuid)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 424, in _run_instance\n(nova.rpc.amqp): TRACE:     requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.rpc.amqp): TRACE:     requested_networks=requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     'args': args})\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 68, in call\n(nova.rpc.amqp): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.rpc.amqp): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 338, in call\n(nova.rpc.amqp): TRACE:     rv = list(rv)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 299, in __iter__\n(nova.rpc.amqp): TRACE:     self._iterator.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 572, in iterconsume\n(nova.rpc.amqp): TRACE:     yield self.ensure(_error_callback, _consume)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 503, in ensure\n(nova.rpc.amqp): TRACE:     error_callback(e)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 553, in _error_callback\n(nova.rpc.amqp): TRACE:     raise rpc_common.Timeout()\n(nova.rpc.amqp): TRACE: Timeout: Timeout while waiting on RPC response.\n(nova.rpc.amqp): TRACE:\n\nThen the instance is destroyed because it couldn't come up cleanly.  Restarting nova-network on the network manager, then nova-compute on the compute node seems to fix this for a time, but it recurs after a few hours.  Is there further debugging information we can provide?  I haven't found log messages that appear related in nova-network or the rabbitmq logs.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/973609", 
    "owner": "None", 
    "id": 973609, 
    "index": 4017, 
    "openned": "2012-04-04 17:48:03.770383+00:00", 
    "created": "2012-04-04 17:48:03.770383+00:00", 
    "title": "Instances go to error state with RPC timeout", 
    "comments": [
        {
            "content": "We've been seeing a trend of people being unable to start instances, investigation yields the following tracebacks in the nova-compute.log on the relevant compute nodes:\n\n2012-04-04 14:21:10 ERROR nova.compute.manager [-] [instance: d86678fb-2a29-4b4e-84b4-c1cb2d81a6e2] Instance failed network setup\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.compute.manager): TRACE:     requested_networks=requested_networks)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.compute.manager): TRACE:     'args': args})\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 68, in call\n(nova.compute.manager): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.compute.manager): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 338, in call\n(nova.compute.manager): TRACE:     rv = list(rv)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 299, in __iter__\n(nova.compute.manager): TRACE:     self._iterator.next()\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 572, in iterconsume\n(nova.compute.manager): TRACE:     yield self.ensure(_error_callback, _consume)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 503, in ensure\n(nova.compute.manager): TRACE:     error_callback(e)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 553, in _error_callback\n(nova.compute.manager): TRACE:     raise rpc_common.Timeout()\n(nova.compute.manager): TRACE: Timeout: Timeout while waiting on RPC response.\n(nova.compute.manager): TRACE:\n2012-04-04 14:21:10 ERROR nova.rpc.amqp [-] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 648, in run_instance\n(nova.rpc.amqp): TRACE:     self._run_instance(context, instance_uuid, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 451, in _run_instance\n(nova.rpc.amqp): TRACE:     self._set_instance_error_state(context, instance_uuid)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 424, in _run_instance\n(nova.rpc.amqp): TRACE:     requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.rpc.amqp): TRACE:     requested_networks=requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     'args': args})\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 68, in call\n(nova.rpc.amqp): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.rpc.amqp): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 338, in call\n(nova.rpc.amqp): TRACE:     rv = list(rv)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 299, in __iter__\n(nova.rpc.amqp): TRACE:     self._iterator.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 572, in iterconsume\n(nova.rpc.amqp): TRACE:     yield self.ensure(_error_callback, _consume)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 503, in ensure\n(nova.rpc.amqp): TRACE:     error_callback(e)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 553, in _error_callback\n(nova.rpc.amqp): TRACE:     raise rpc_common.Timeout()\n(nova.rpc.amqp): TRACE: Timeout: Timeout while waiting on RPC response.\n(nova.rpc.amqp): TRACE:\n\nThen the instance is destroyed because it couldn't come up cleanly.  Restarting nova-network on the network manager, then nova-compute on the compute node seems to fix this for a time, but it recurs after a few hours.  Is there further debugging information we can provide?  I haven't found log messages that appear related in nova-network or the rabbitmq logs.", 
            "date_created": "2012-04-04 17:48:03.770383+00:00", 
            "author": "https://api.launchpad.net/1.0/~deej"
        }, 
        {
            "content": "This should only happen if network is blocking for a long time or the network node is not connected for some reason.  Are you running only one nova-network? If so it could be getting overloaded with requests.  You might try using multi_host mode and running one nova-network on each compute host.\nyou might try:\nrabbitmqctl list_queues\n\nit should show you how many messages are waiting in the queue.  If the number is greater than 0 either the worker is blocking doing some work or it can't keep up with the messages.\n\nFYI you can also change the timeout using:\nrpc_response_timeout=<timeout_seconds>\n\nso you could set it much higher and see if that helps.", 
            "date_created": "2012-04-04 18:15:07.176752+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Also, if you are using one network node, it may be getting overloaded with lease and release requests.  You should probably extend the lease time to something more reasonable than 2 minutes via:\n\ndhcp_lease_time=86400 # set the lease time to 24 hours\nfixed_ip_disassociate_timeout=172800 # timeout expired leases after 48 hours\n\nNote if you are spawning a lot of instances you will definitely want:\n\nforce_dhcp_release=true\n\nor you will have to wait 48 hours to get your ips back and you risk using up all of them.", 
            "date_created": "2012-04-04 18:20:17.327413+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "I have no reproduce steps, but I did bump into this yesterday.  There was an issue with an unreleased iptables lock that froze nova-network.", 
            "date_created": "2012-04-04 18:25:28.053259+00:00", 
            "author": "https://api.launchpad.net/1.0/~sleepsonthefloor"
        }, 
        {
            "content": "We are using one network node, I'll see if I can provoke this issue and check the network queue to see if events are stacking up in there.  Likewise, we'll tweak some of the lease timing and see if that helps.  I'm puzzled by why it appears to require restarting nova-network to fix this though, presumably eventually the queue would drain of events and things would return to normal.", 
            "date_created": "2012-04-04 18:28:21.967102+00:00", 
            "author": "https://api.launchpad.net/1.0/~deej"
        }, 
        {
            "content": "Hmm, good point. Perhaps anthony is right and there is a lockfile somewhere. Although in that case I would expect to see a message in the log \"attempting to grab lock...\"  with no further output from that greenthread.\n\nMight help if you could tar up your network log from the failed state and attach it.  Is nova-network running by itself? Or are there other workers on the box?\n\nVish", 
            "date_created": "2012-04-04 18:42:37+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "I'm not seeing anything stacking up in the network message queue, but I did find this in the nova-network.log:\n\n2012-04-04 19:58:55 DEBUG nova.utils [-] Attempting to grab semaphore \"iptables\" for method \"apply\"... from (pid=5853) inner /usr/lib/python2.7/dist-packages/nova/utils.py:891\n2012-04-04 19:58:55 DEBUG nova.network.linux_net [-] IPTablesManager.apply completed with success from (pid=5853) apply /usr/lib/python2.7/dist-packages/nova/network/linux_net.py:340\n2012-04-04 19:58:55 ERROR nova.rpc.amqp [-] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 263, in wrapped\n(nova.rpc.amqp): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 469, in associate_floating_ip\n(nova.rpc.amqp): TRACE:     fixed_address, interface)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 490, in _associate_floating_ip\n(nova.rpc.amqp): TRACE:     interface)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/l3.py\", line 99, in add_floating_ip\n(nova.rpc.amqp): TRACE:     linux_net.ensure_floating_forward(floating_ip, fixed_ip)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 507, in ensure_floating_forward\n(nova.rpc.amqp): TRACE:     iptables_manager.apply()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 907, in inner\n(nova.rpc.amqp): TRACE:     retval = f(*args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 230, in __exit__\n(nova.rpc.amqp): TRACE:     self.release()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 273, in release\n(nova.rpc.amqp): TRACE:     raise NotMyLock\n(nova.rpc.amqp): TRACE: NotMyLock\n(nova.rpc.amqp): TRACE:\n2012-04-04 19:58:55 ERROR nova.rpc.amqp [-] Returning exception  to caller\n\nI'll check the log to see if anything needs redacting and tar it up for you.", 
            "date_created": "2012-04-04 21:48:12.319673+00:00", 
            "author": "https://api.launchpad.net/1.0/~deej"
        }, 
        {
            "content": "Are you running off of reasonably current code?  Haven't seen NotMyLock since bug 956313 was fixed.", 
            "date_created": "2012-04-04 22:32:39.731082+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "nova-network                    2012.1~rc1~20120309.13261-0ubuntu1\n\nIt LOOKS like it should have the fix for bug 956313 in it, but I'm honestly not sure, we'll be upgrading to the latest on Monday I believe, though if you think the latest code will fix this issue we may expedite it.  Do you still want a log file?", 
            "date_created": "2012-04-05 16:38:45.627713+00:00", 
            "author": "https://api.launchpad.net/1.0/~deej"
        }, 
        {
            "content": "Should be pretty easy to determine.  Check utils.py and see if it contains the GreenFileLock class.", 
            "date_created": "2012-04-05 22:46:34.774938+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "I'm assuming you meant /usr/lib/python2.7/dist-packages/nova/utils.py, if so it doesn't have a GreenFileLock class.  I assume that means we need to update and this will be resolved.", 
            "date_created": "2012-04-06 01:29:18.192460+00:00", 
            "author": "https://api.launchpad.net/1.0/~deej"
        }, 
        {
            "content": "Yes. Should be resolved with the update then. That is good news.\nOn Apr 5, 2012 6:35 PM, \"David Lawson\" <email address hidden> wrote:\n\n> I'm assuming you meant /usr/lib/python2.7/dist-packages/nova/utils.py,\n> if so it doesn't have a GreenFileLock class.  I assume that means we\n> need to update and this will be resolved.\n>\n> --\n> You received this bug notification because you are subscribed to\n> OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/973609\n>\n> Title:\n>  Instances go to error state with RPC timeout\n>\n> Status in OpenStack Compute (Nova):\n>  Incomplete\n>\n> Bug description:\n>  We've been seeing a trend of people being unable to start instances,\n>  investigation yields the following tracebacks in the nova-compute.log\n>  on the relevant compute nodes:\n>\n>  2012-04-04 14:21:10 ERROR nova.compute.manager [-] [instance:\n> d86678fb-2a29-4b4e-84b4-c1cb2d81a6e2] Instance failed network setup\n>  (nova.compute.manager): TRACE: Traceback (most recent call last):\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 559, in\n> _allocate_network\n>  (nova.compute.manager): TRACE:     requested_networks=requested_networks)\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 170, in\n> allocate_for_instance\n>  (nova.compute.manager): TRACE:     'args': args})\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 68, in call\n>  (nova.compute.manager): TRACE:     return _get_impl().call(context,\n> topic, msg, timeout)\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 674, in call\n>  (nova.compute.manager): TRACE:     return rpc_amqp.call(context, topic,\n> msg, timeout, Connection.pool)\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 338, in call\n>  (nova.compute.manager): TRACE:     rv = list(rv)\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 299, in __iter__\n>  (nova.compute.manager): TRACE:     self._iterator.next()\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 572, in\n> iterconsume\n>  (nova.compute.manager): TRACE:     yield self.ensure(_error_callback,\n> _consume)\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 503, in\n> ensure\n>  (nova.compute.manager): TRACE:     error_callback(e)\n>  (nova.compute.manager): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 553, in\n> _error_callback\n>  (nova.compute.manager): TRACE:     raise rpc_common.Timeout()\n>  (nova.compute.manager): TRACE: Timeout: Timeout while waiting on RPC\n> response.\n>  (nova.compute.manager): TRACE:\n>  2012-04-04 14:21:10 ERROR nova.rpc.amqp [-] Exception during message\n> handling\n>  (nova.rpc.amqp): TRACE: Traceback (most recent call last):\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in\n> _process_data\n>  (nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n>  (nova.rpc.amqp): TRACE:     return f(*args, **kw)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 177, in\n> decorated_function\n>  (nova.rpc.amqp): TRACE:     sys.exc_info())\n>  (nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line\n> 24, in __exit__\n>  (nova.rpc.amqp): TRACE:     self.gen.next()\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 171, in\n> decorated_function\n>  (nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid,\n> *args, **kwargs)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 648, in\n> run_instance\n>  (nova.rpc.amqp): TRACE:     self._run_instance(context, instance_uuid,\n> **kwargs)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 451, in\n> _run_instance\n>  (nova.rpc.amqp): TRACE:     self._set_instance_error_state(context,\n> instance_uuid)\n>  (nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line\n> 24, in __exit__\n>  (nova.rpc.amqp): TRACE:     self.gen.next()\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 424, in\n> _run_instance\n>  (nova.rpc.amqp): TRACE:     requested_networks)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 559, in\n> _allocate_network\n>  (nova.rpc.amqp): TRACE:     requested_networks=requested_networks)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 170, in\n> allocate_for_instance\n>  (nova.rpc.amqp): TRACE:     'args': args})\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 68, in call\n>  (nova.rpc.amqp): TRACE:     return _get_impl().call(context, topic, msg,\n> timeout)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 674, in call\n>  (nova.rpc.amqp): TRACE:     return rpc_amqp.call(context, topic, msg,\n> timeout, Connection.pool)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 338, in call\n>  (nova.rpc.amqp): TRACE:     rv = list(rv)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 299, in __iter__\n>  (nova.rpc.amqp): TRACE:     self._iterator.next()\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 572, in\n> iterconsume\n>  (nova.rpc.amqp): TRACE:     yield self.ensure(_error_callback, _consume)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 503, in\n> ensure\n>  (nova.rpc.amqp): TRACE:     error_callback(e)\n>  (nova.rpc.amqp): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 553, in\n> _error_callback\n>  (nova.rpc.amqp): TRACE:     raise rpc_common.Timeout()\n>  (nova.rpc.amqp): TRACE: Timeout: Timeout while waiting on RPC response.\n>  (nova.rpc.amqp): TRACE:\n>\n>  Then the instance is destroyed because it couldn't come up cleanly.\n>  Restarting nova-network on the network manager, then nova-compute on\n>  the compute node seems to fix this for a time, but it recurs after a\n>  few hours.  Is there further debugging information we can provide?  I\n>  haven't found log messages that appear related in nova-network or the\n>  rabbitmq logs.\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/973609/+subscriptions\n>\n", 
            "date_created": "2012-04-06 04:58:44+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "I have same issue in a test deployment with only one node.\n\nroot@ubuntu01:~# nova-manage service list\nBinary           Host                                 Zone             Status     State Updated_At\nnova-scheduler   ubuntu01                             internal         enabled    :-)   2013-10-06 16:43:28\nnova-conductor   ubuntu01                             internal         enabled    :-)   2013-10-06 16:43:28\nnova-network     ubuntu01                             internal         enabled    :-)   2013-10-06 16:43:24\nnova-cert        ubuntu01                             internal         enabled    :-)   2013-10-06 16:43:22\nnova-consoleauth ubuntu01                             internal         enabled    :-)   2013-10-06 16:43:28\nnova-compute     ubuntu01                             nova             enabled    :-)   2013-10-06 16:43:29\n\nroot@ubuntu01:~# nova network-show dc6cc0b2-bed5-45af-9dbe-6db52dd9579e\n+---------------------+--------------------------------------+\n| Property            | Value                                |\n+---------------------+--------------------------------------+\n| bridge              | br100                                |\n| vpn_public_port     | None                                 |\n| dhcp_start          | 192.168.210.2                        |\n| bridge_interface    | eth0                                 |\n| updated_at          | 2013-10-06T15:42:47.000000           |\n| id                  | dc6cc0b2-bed5-45af-9dbe-6db52dd9579e |\n| cidr_v6             | None                                 |\n| deleted_at          | None                                 |\n| gateway             | 192.168.210.1                        |\n| rxtx_base           | None                                 |\n| label               | private                              |\n| priority            | None                                 |\n| project_id          | None                                 |\n| vpn_private_address | None                                 |\n| deleted             | 0                                    |\n| vlan                | None                                 |\n| broadcast           | 192.168.210.255                      |\n| netmask             | 255.255.255.0                        |\n| injected            | False                                |\n| cidr                | 192.168.210.0/24                     |\n| vpn_public_address  | None                                 |\n| multi_host          | False                                |\n| dns2                | None                                 |\n| created_at          | 2013-10-06T15:41:01.000000           |\n| host                | ubuntu01                             |\n| gateway_v6          | None                                 |\n| netmask_v6          | None                                 |\n| dns1                | 8.8.4.4                              |\n+---------------------+--------------------------------------+\n\nroot@ubuntu01:~# ifconfig br100\nbr100     Link encap:Ethernet  direcci\u00f3nHW 00:0c:29:85:46:af\n          Direc. inet:192.168.210.1  Difus.:192.168.210.255  M\u00e1sc:255.255.255.0\n          Direcci\u00f3n inet6: fe80::a007:67ff:fe5e:90e3/64 Alcance:Enlace\n          ACTIVO DIFUSI\u00d3N FUNCIONANDO MULTICAST  MTU:1500  M\u00e9trica:1\n          Paquetes RX:12252 errores:0 perdidos:10 overruns:0 frame:0\n          Paquetes TX:12463 errores:0 perdidos:0 overruns:0 carrier:0\n          colisiones:0 long.colaTX:0\n          Bytes RX:1156170 (1.1 MB)  TX bytes:6932529 (6.9 MB)\n\nMy rabbitmq isn't overloaded.\n", 
            "date_created": "2013-10-06 16:46:57.346395+00:00", 
            "author": "https://api.launchpad.net/1.0/~icalvete"
        }
    ], 
    "closed": "2012-04-06 14:14:48.314426+00:00"
}