{
    "status": "Won't Fix", 
    "last_updated": "2012-06-07 19:54:28.267928+00:00", 
    "description": "I'm  trying to delete 2 volumes one after another and i get error in nova-volume.log (removing 2nd volume):\n\n2012-06-06 10:10:47 DEBUG nova.utils [req-c72b75f3-939b-4406-a957-c621135dd131 4b949a49b41a4688a4a0b26de8010105 1975ac81b61d47e094781c2727eabc3f] Running cmd (subprocess): sudo nova-rootwrap dd if=/dev/zero of=/dev/mapper/nova--volumes-volume--00000002 count=1024 bs=1M from (pid=12819) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-06-06 10:11:10 ERROR nova.exception [-] DB exception wrapped.\n2012-06-06 10:11:10 TRACE nova.exception Traceback (most recent call last):\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 90, in _wrap\n2012-06-06 10:11:10 TRACE nova.exception     return f(*args, **kwargs)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1547, in flush\n2012-06-06 10:11:10 TRACE nova.exception     self._flush(objects)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1616, in _flush\n2012-06-06 10:11:10 TRACE nova.exception     flush_context.execute()\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 328, in execute\n2012-06-06 10:11:10 TRACE nova.exception     rec.execute(self)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 472, in execute\n2012-06-06 10:11:10 TRACE nova.exception     uow\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2224, in _save_obj\n2012-06-06 10:11:10 TRACE nova.exception     execute(statement, params)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1405, in execute\n2012-06-06 10:11:10 TRACE nova.exception     params)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1538, in _execute_clauseelement\n2012-06-06 10:11:10 TRACE nova.exception     compiled_sql, distilled_params\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1646, in _execute_context\n2012-06-06 10:11:10 TRACE nova.exception     context)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_context\n2012-06-06 10:11:10 TRACE nova.exception     context)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 330, in do_execute\n2012-06-06 10:11:10 TRACE nova.exception     cursor.execute(statement, parameters)\n2012-06-06 10:11:10 TRACE nova.exception OperationalError: (OperationalError) database is locked u'UPDATE services SET updated_at=?, report_count=? WHERE services.id = ?' ('2012-06-06 14:11:05.779063', 29, 5)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1009530", 
    "owner": "None", 
    "id": 1009530, 
    "index": 4131, 
    "openned": "2012-06-06 14:15:48.394892+00:00", 
    "created": "2012-06-06 14:15:48.394892+00:00", 
    "title": "nova volume-delete create lock", 
    "comments": [
        {
            "content": "I'm  trying to delete 2 volumes one after another and i get error in nova-volume.log (removing 2nd volume):\n\n2012-06-06 10:10:47 DEBUG nova.utils [req-c72b75f3-939b-4406-a957-c621135dd131 4b949a49b41a4688a4a0b26de8010105 1975ac81b61d47e094781c2727eabc3f] Running cmd (subprocess): sudo nova-rootwrap dd if=/dev/zero of=/dev/mapper/nova--volumes-volume--00000002 count=1024 bs=1M from (pid=12819) execute /usr/lib/python2.7/dist-packages/nova/utils.py:219\n2012-06-06 10:11:10 ERROR nova.exception [-] DB exception wrapped.\n2012-06-06 10:11:10 TRACE nova.exception Traceback (most recent call last):\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 90, in _wrap\n2012-06-06 10:11:10 TRACE nova.exception     return f(*args, **kwargs)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1547, in flush\n2012-06-06 10:11:10 TRACE nova.exception     self._flush(objects)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1616, in _flush\n2012-06-06 10:11:10 TRACE nova.exception     flush_context.execute()\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 328, in execute\n2012-06-06 10:11:10 TRACE nova.exception     rec.execute(self)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 472, in execute\n2012-06-06 10:11:10 TRACE nova.exception     uow\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2224, in _save_obj\n2012-06-06 10:11:10 TRACE nova.exception     execute(statement, params)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1405, in execute\n2012-06-06 10:11:10 TRACE nova.exception     params)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1538, in _execute_clauseelement\n2012-06-06 10:11:10 TRACE nova.exception     compiled_sql, distilled_params\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1646, in _execute_context\n2012-06-06 10:11:10 TRACE nova.exception     context)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_context\n2012-06-06 10:11:10 TRACE nova.exception     context)\n2012-06-06 10:11:10 TRACE nova.exception   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 330, in do_execute\n2012-06-06 10:11:10 TRACE nova.exception     cursor.execute(statement, parameters)\n2012-06-06 10:11:10 TRACE nova.exception OperationalError: (OperationalError) database is locked u'UPDATE services SET updated_at=?, report_count=? WHERE services.id = ?' ('2012-06-06 14:11:05.779063', 29, 5)", 
            "date_created": "2012-06-06 14:15:48.394892+00:00", 
            "author": "https://api.launchpad.net/1.0/~vkhomenko"
        }, 
        {
            "content": "Are you using sqlite?  Sqlite is for testing purposes only and shouldn't be used in a real production.  Table locks only happen on sqlite afaik.", 
            "date_created": "2012-06-06 17:36:22.924541+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Yes, it's on sqlite.\nIs it good idea to lock table while performing long-lasting disk operations?", 
            "date_created": "2012-06-06 18:49:58.502220+00:00", 
            "author": "https://api.launchpad.net/1.0/~vkhomenko"
        }, 
        {
            "content": "Like VIsh said, sqlite just isn't going to work with nova.  Switch to MySQL and this will go away.", 
            "date_created": "2012-06-07 19:32:08.342791+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }
    ], 
    "closed": "2012-06-07 19:31:37.403675+00:00"
}