{
    "status": "Fix Released", 
    "last_updated": "2016-11-29 18:20:16.057859+00:00", 
    "description": "I have two host: tecs-controller-node and tecs-OpenStack-Nova.\n\n1. I did migrate action, then instance's state is as follow:\n+--------------------------------------+----------+---------------+------------+-------------+--------------------------------+\n| ID                                   | Name     | Status        | Task State | Power State | Networks                       |\n+--------------------------------------+----------+---------------+------------+-------------+--------------------------------+\n| ea40a5f7-d92b-4ad6-94c0-a18f2465519e | hanrong1 | VERIFY_RESIZE | -          | Running     | public=172.24.4.2, 2001:db8::8 |\n+--------------------------------------+----------+---------------+------------+-------------+--------------------------------+\n\n2. I did look at migrations' table for instance source_node and dest_node.\n\nmysql> select * from migrations where instance_uuid='ea40a5f7-d92b-4ad6-94c0-a18f2465519e';\n+---------------------+---------------------+------------+----+----------------------+---------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n| created_at          | updated_at          | deleted_at | id | source_compute       | dest_compute        | dest_host    | status   | instance_uuid                        | old_instance_type_id | new_instance_type_id | source_node          | dest_node           | deleted | migration_type | hidden | memory_total | memory_processed | memory_remaining | disk_total | disk_processed | disk_remaining |\n+---------------------+---------------------+------------+----+----------------------+---------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n| 2016-09-20 02:38:24 | 2016-09-20 02:38:58 | NULL       |  1 | tecs-controller-node | tecs-OpenStack-Nova | 192.168.1.60 | finished | ea40a5f7-d92b-4ad6-94c0-a18f2465519e |                    6 |                    6 | tecs-controller-node | tecs-OpenStack-Nova |       0 | migration      |      0 |         NULL |             NULL |             NULL |       NULL |           NULL |           NULL |\n+---------------------+---------------------+------------+----+----------------------+---------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n\nsource_compute: tecs-controller-node\nsource_node: tecs-controller-node\ndest_compute:tecs-OpenStack-Nova\ndest_node: tecs-OpenStack-Nova\n\n3. I did resize-revert action\nstack@tecs-controller-node:~$ nova resize-revert hanrong1\nstack@tecs-controller-node:~$ nova list\n+--------------------------------------+----------+---------------+------------------+-------------+--------------------------------+\n| ID                                   | Name     | Status        | Task State       | Power State | Networks                       |\n+--------------------------------------+----------+---------------+------------------+-------------+--------------------------------+\n| ea40a5f7-d92b-4ad6-94c0-a18f2465519e | hanrong1 | REVERT_RESIZE | resize_reverting | Running     | public=172.24.4.2, 2001:db8::8 |\n+--------------------------------------+----------+---------------+------------------+-------------+--------------------------------+\nstack@tecs-controller-node:~$ nova list\n+--------------------------------------+----------+--------+------------+-------------+--------------------------------+\n| ID                                   | Name     | Status | Task State | Power State | Networks                       |\n+--------------------------------------+----------+--------+------------+-------------+--------------------------------+\n| ea40a5f7-d92b-4ad6-94c0-a18f2465519e | hanrong1 | ACTIVE | -          | Running     | public=172.24.4.2, 2001:db8::8 |\n+--------------------------------------+----------+--------+------------+-------------+--------------------------------+\n\n4. I did look at migrations' table for instance source_node and dest_node.\nmysql> select * from migrations where instance_uuid='ea40a5f7-d92b-4ad6-94c0-a18f2465519e';\n+---------------------+---------------------+------------+----+----------------------+----------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n| created_at          | updated_at          | deleted_at | id | source_compute       | dest_compute         | dest_host    | status   | instance_uuid                        | old_instance_type_id | new_instance_type_id | source_node          | dest_node           | deleted | migration_type | hidden | memory_total | memory_processed | memory_remaining | disk_total | disk_processed | disk_remaining |\n+---------------------+---------------------+------------+----+----------------------+----------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n| 2016-09-20 02:38:24 | 2016-09-20 03:52:01 | NULL       |  1 | tecs-controller-node | tecs-controller-node | 192.168.1.60 | reverted | ea40a5f7-d92b-4ad6-94c0-a18f2465519e |                    6 |                    6 | tecs-controller-node | tecs-OpenStack-Nova |       0 | migration      |      0 |         NULL |             NULL |             NULL |       NULL |           NULL |           NULL |\n+---------------------+---------------------+------------+----+----------------------+----------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n\nsource_compute: tecs-controller-node\nsource_node: tecs-controller-node\ndest_compute:tecs-controller-node\ndest_node: tecs-OpenStack-Nova\n\nThe value of the dest_compute is not incorrect, it should be \"tecs-OpenStack-Nova\" after \nfinish_revert_resize operation.\n\nExpected result\n===============\n\nsource_compute: tecs-controller-node\nsource_node: tecs-controller-node\ndest_compute:tecs-OpenStack-Nova\ndest_node: tecs-controller-node\n\nEnvironment\n===========\n1. git log -1\ncommit c6a07f5f0cbd978cc2a23214ddf4ecd520ce8335\nMerge: 14d816e 09627f2\nAuthor: Jenkins <email address hidden>\nDate:   Wed Sep 7 22:36:12 2016 +0000\n\n\u00a0\u00a0\u00a0\u00a0Merge \"[placement] Allow inventory to violate allo\n\n2. Which hypervisor did you use?\nlibvirt + kvm", 
    "tags": [
        "migrate", 
        "resize"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1625462", 
    "owner": "https://api.launchpad.net/1.0/~hanrong", 
    "id": 1625462, 
    "index": 2077, 
    "openned": "2016-09-20 06:07:53.381398+00:00", 
    "created": "2016-09-20 06:07:53.381398+00:00", 
    "title": "The value of migration.dest_compute is incorrect after resize_revert operation successfully", 
    "comments": [
        {
            "content": "I have two host: tecs-controller-node and tecs-OpenStack-Nova.\n\n1. I did migrate action, then instance's state is as follow:\n+--------------------------------------+----------+---------------+------------+-------------+--------------------------------+\n| ID                                   | Name     | Status        | Task State | Power State | Networks                       |\n+--------------------------------------+----------+---------------+------------+-------------+--------------------------------+\n| ea40a5f7-d92b-4ad6-94c0-a18f2465519e | hanrong1 | VERIFY_RESIZE | -          | Running     | public=172.24.4.2, 2001:db8::8 |\n+--------------------------------------+----------+---------------+------------+-------------+--------------------------------+\n\n\n2. I did look at migrations' table for instance source_node and dest_node.\n\nmysql> select * from migrations where instance_uuid='ea40a5f7-d92b-4ad6-94c0-a18f2465519e';\n+---------------------+---------------------+------------+----+----------------------+---------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n| created_at          | updated_at          | deleted_at | id | source_compute       | dest_compute        | dest_host    | status   | instance_uuid                        | old_instance_type_id | new_instance_type_id | source_node          | dest_node           | deleted | migration_type | hidden | memory_total | memory_processed | memory_remaining | disk_total | disk_processed | disk_remaining |\n+---------------------+---------------------+------------+----+----------------------+---------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n| 2016-09-20 02:38:24 | 2016-09-20 02:38:58 | NULL       |  1 | tecs-controller-node | tecs-OpenStack-Nova | 192.168.1.60 | finished | ea40a5f7-d92b-4ad6-94c0-a18f2465519e |                    6 |                    6 | tecs-controller-node | tecs-OpenStack-Nova |       0 | migration      |      0 |         NULL |             NULL |             NULL |       NULL |           NULL |           NULL |\n+---------------------+---------------------+------------+----+----------------------+---------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n\nsource_compute: tecs-controller-node\nsource_node: tecs-controller-node\ndest_compute:tecs-OpenStack-Nova\ndest_node: tecs-OpenStack-Nova\n\n3. I did resize-revert action\nstack@tecs-controller-node:~$ nova resize-revert hanrong1\nstack@tecs-controller-node:~$ nova list\n+--------------------------------------+----------+---------------+------------------+-------------+--------------------------------+\n| ID                                   | Name     | Status        | Task State       | Power State | Networks                       |\n+--------------------------------------+----------+---------------+------------------+-------------+--------------------------------+\n| ea40a5f7-d92b-4ad6-94c0-a18f2465519e | hanrong1 | REVERT_RESIZE | resize_reverting | Running     | public=172.24.4.2, 2001:db8::8 |\n+--------------------------------------+----------+---------------+------------------+-------------+--------------------------------+\nstack@tecs-controller-node:~$ nova list\n+--------------------------------------+----------+--------+------------+-------------+--------------------------------+\n| ID                                   | Name     | Status | Task State | Power State | Networks                       |\n+--------------------------------------+----------+--------+------------+-------------+--------------------------------+\n| ea40a5f7-d92b-4ad6-94c0-a18f2465519e | hanrong1 | ACTIVE | -          | Running     | public=172.24.4.2, 2001:db8::8 |\n+--------------------------------------+----------+--------+------------+-------------+--------------------------------+\n\n\n4. I did look at migrations' table for instance source_node and dest_node.\nmysql> select * from migrations where instance_uuid='ea40a5f7-d92b-4ad6-94c0-a18f2465519e';\n+---------------------+---------------------+------------+----+----------------------+----------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n| created_at          | updated_at          | deleted_at | id | source_compute       | dest_compute         | dest_host    | status   | instance_uuid                        | old_instance_type_id | new_instance_type_id | source_node          | dest_node           | deleted | migration_type | hidden | memory_total | memory_processed | memory_remaining | disk_total | disk_processed | disk_remaining |\n+---------------------+---------------------+------------+----+----------------------+----------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n| 2016-09-20 02:38:24 | 2016-09-20 03:52:01 | NULL       |  1 | tecs-controller-node | tecs-controller-node | 192.168.1.60 | reverted | ea40a5f7-d92b-4ad6-94c0-a18f2465519e |                    6 |                    6 | tecs-controller-node | tecs-OpenStack-Nova |       0 | migration      |      0 |         NULL |             NULL |             NULL |       NULL |           NULL |           NULL |\n+---------------------+---------------------+------------+----+----------------------+----------------------+--------------+----------+--------------------------------------+----------------------+----------------------+----------------------+---------------------+---------+----------------+--------+--------------+------------------+------------------+------------+----------------+----------------+\n\nsource_compute: tecs-controller-node\nsource_node: tecs-controller-node\ndest_compute:tecs-controller-node\ndest_node: tecs-OpenStack-Nova\n\n\ndest_node is not incorrect.\n\nExpected result\n===============\n\nsource_compute: tecs-controller-node\nsource_node: tecs-controller-node\ndest_compute:tecs-controller-node\ndest_node: tecs-controller-node\n\nEnvironment\n===========\n1. git log -1\ncommit c6a07f5f0cbd978cc2a23214ddf4ecd520ce8335\nMerge: 14d816e 09627f2\nAuthor: Jenkins <email address hidden>\nDate:   Wed Sep 7 22:36:12 2016 +0000\n\n    Merge \"[placement] Allow inventory to violate allo\n\n2. Which hypervisor did you use?\nlibvirt + kvm", 
            "date_created": "2016-09-20 06:07:53.381398+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "sorry, Rajesh Tailor \n\nI had sumbmited a patch set.\n\nhttps://review.openstack.org/#/c/335270/", 
            "date_created": "2016-09-23 00:44:08.621905+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "The API of os-migrations is also used by admin-user to query the history. When we revert the resize, the migration object's dest_compute shouldn't be changed, otherwise the history of migrations will changed.\n\nI prefer to keep the dest_compute/node as original one.", 
            "date_created": "2016-09-27 02:21:14.909123+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }, 
        {
            "content": "I agree with your point.\n\nI will modify patch code.", 
            "date_created": "2016-09-28 02:06:44.628256+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/335270\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=b816e3cc33ad37c4b4850e05336fd3ed7ac9e197\nSubmitter: Jenkins\nBranch:    master\n\ncommit b816e3cc33ad37c4b4850e05336fd3ed7ac9e197\nAuthor: zte-hanrong <email address hidden>\nDate:   Wed Jun 29 08:53:53 2016 +0800\n\n    migration.source_compute should be unchanged after finish_revert_resize.\n    \n    The field of dest_compute in migration table represent destination host\n    name during a migration. The value of migration.dest_compute has been\n    changed to migration's source host name after resize-revert operation.\n    That would lead to history records of migrations are not accurate.\n    This change modifies this problem.\n    \n    Close-Bug:#1625462\n    Change-Id: Ie616045c40ea4a18977c18df9f5624efa4ba7e6a\n", 
            "date_created": "2016-11-10 16:25:40.208500+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-11-29 18:20:13.978779+00:00"
}