{
    "status": "Expired", 
    "last_updated": "2015-10-05 04:17:39.837996+00:00", 
    "description": "[Env]\nUbuntu 14.04\nOpenStack Icehouse\n\n\n[Descrition]\nI am usting pdb to debug nova attach_volume operation, due to the reason that the command is timeout, the volume failed to be attached to the instance, however, in the nova db, the attachment device is already recorded other than fallback, which is completely not right from user's perspective.\n\nFor example, nova instance '1' shows \"os-extended-volumes:volumes_attached | [{\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}] |\"  even if the volume 3c8205b9-5066-42ea-9180-601fac50a08e is actually available.\n\nI am concerning there are some situations nova attach_volume would fail in the middle procedure which would have this issue as well, is it better to delay the db persistent step after the device is really being attached? \n\nubuntu@xianghui-bastion:~/openstack-charm-testing/test$ nova list\n+--------------------------------------+------+--------+------------+-------------+----------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks             |\n+--------------------------------------+------+--------+------------+-------------+----------------------+\n| d58a3b25-0434-4b92-a3a8-8b4188c611c3 | 1    | ACTIVE | -          | Running     | private=192.168.21.4 |\n+--------------------------------------+------+--------+------------+-------------+----------------------+\nubuntu@xianghui-bastion:~/openstack-charm-testing/test$ nova volume-list\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\n| ID                                   | Status    | Display Name | Size | Volume Type | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\n| 3c8205b9-5066-42ea-9180-601fac50a08e | available | test         | 2    | None        |             |\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\nubuntu@xianghui-bastion:~/openstack-charm-testing/test$ nova show 1\n+--------------------------------------+-------------------------------------------------------------------------------------------------------\n-------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                 \n                                                                                           |\n+--------------------------------------+-------------------------------------------------------------------------------------------------------\n-------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                \n                                                                                           |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                  \n                                                                                           |\n| OS-EXT-SRV-ATTR:host                 | juju-xianghui-machine-12                                                                              \n                                                                                           |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | juju-xianghui-machine-12.openstacklocal                                                               \n                                                                                           |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                                                                     \n                                                                                           |\n| OS-EXT-STS:power_state               | 1                                                                                                     \n                                                                                           |\n| OS-EXT-STS:task_state                | -                                                                                                     \n                                                                                           |\n| OS-EXT-STS:vm_state                  | active                                                                                                \n                                                                                           |\n| OS-SRV-USG:launched_at               | 2015-06-29T05:22:09.000000                                                                            \n                                                                                           |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                                                                |\n| accessIPv4                           |                                                                                                                                                                                                  |\n| accessIPv6                           |                                                                                                                                                                                                  |\n| config_drive                         |                                                                                                                                                                                                  |\n| created                              | 2015-06-29T05:22:03Z                                                                                                                                                                             |\n| flavor                               | m1.small (2)                                                                                                                                                                                     |\n| hostId                               | 101a1d8f15e8d05cd9435d49e42c2c95b3c9f3d6665663bfa3ad23a0                                                                                                                                         |\n| id                                   | d58a3b25-0434-4b92-a3a8-8b4188c611c3                                                                                                                                                             |\n| image                                | trusty (1d009366-0c2a-4495-8245-a00b5f8ade1d)                                                                                                                                                    |\n| key_name                             | -                                                                                                                                                                                                |\n| metadata                             | {}                                                                                                                                                                                               |\n| name                                 | 1                                                                                                                                                                                                |\n| os-extended-volumes:volumes_attached | [{\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}] |\n| private network                      | 192.168.21.4                                                                                                                                                                                     |\n| progress                             | 0                                                                                                                                                                                                |\n| security_groups                      | default                                                                                                                                                                                          |\n| status                               | ACTIVE                                                                                                                                                                                           |\n| tenant_id                            | 678f85bad9bd43b5a3ef50b1ff84eb17                                                                                                                                                                 |\n| updated                              | 2015-06-29T05:22:10Z                                                                                                                                                                             |\n| user_id                              | 42eb684528754ba2b78ecca15ff01c4d                                                                                                                                                                 |\n+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\nubuntu@xianghui-bastion:~/openstack-charm-testing/test$ cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 3c8205b9-5066-42ea-9180-601fac50a08e | available |     test     |  2   |     None    |  false   |             |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+", 
    "tags": [
        "volumes"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1469661", 
    "owner": "None", 
    "id": 1469661, 
    "index": 6891, 
    "openned": "2015-06-29 09:28:10.153582+00:00", 
    "created": "2015-06-29 09:28:10.153582+00:00", 
    "title": " 'volumes_attached' included the volume_id which is actually available", 
    "comments": [
        {
            "content": "[Env]\nUbuntu 14.04\nOpenStack Icehouse\n\n\n[Descrition]\nI am usting pdb to debug nova attach_volume operation, due to the reason that the command is timeout, the volume failed to be attached to the instance, however, in the nova db, the attachment device is already recorded other than fallback, which is completely not right from user's perspective.\n\nFor example, nova instance '1' shows \"os-extended-volumes:volumes_attached | [{\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}] |\"  even if the volume 3c8205b9-5066-42ea-9180-601fac50a08e is actually available.\n\nI am concerning there are some situations nova attach_volume would fail in the middle procedure which would have this issue as well, is it better to delay the db persistent step after the device is really being attached? \n\nubuntu@xianghui-bastion:~/openstack-charm-testing/test$ nova list\n+--------------------------------------+------+--------+------------+-------------+----------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks             |\n+--------------------------------------+------+--------+------------+-------------+----------------------+\n| d58a3b25-0434-4b92-a3a8-8b4188c611c3 | 1    | ACTIVE | -          | Running     | private=192.168.21.4 |\n+--------------------------------------+------+--------+------------+-------------+----------------------+\nubuntu@xianghui-bastion:~/openstack-charm-testing/test$ nova volume-list\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\n| ID                                   | Status    | Display Name | Size | Volume Type | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\n| 3c8205b9-5066-42ea-9180-601fac50a08e | available | test         | 2    | None        |             |\n+--------------------------------------+-----------+--------------+------+-------------+-------------+\nubuntu@xianghui-bastion:~/openstack-charm-testing/test$ nova show 1\n+--------------------------------------+-------------------------------------------------------------------------------------------------------\n-------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                 \n                                                                                           |\n+--------------------------------------+-------------------------------------------------------------------------------------------------------\n-------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                \n                                                                                           |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                  \n                                                                                           |\n| OS-EXT-SRV-ATTR:host                 | juju-xianghui-machine-12                                                                              \n                                                                                           |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | juju-xianghui-machine-12.openstacklocal                                                               \n                                                                                           |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000002                                                                                     \n                                                                                           |\n| OS-EXT-STS:power_state               | 1                                                                                                     \n                                                                                           |\n| OS-EXT-STS:task_state                | -                                                                                                     \n                                                                                           |\n| OS-EXT-STS:vm_state                  | active                                                                                                \n                                                                                           |\n| OS-SRV-USG:launched_at               | 2015-06-29T05:22:09.000000                                                                            \n                                                                                           |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                                                                |\n| accessIPv4                           |                                                                                                                                                                                                  |\n| accessIPv6                           |                                                                                                                                                                                                  |\n| config_drive                         |                                                                                                                                                                                                  |\n| created                              | 2015-06-29T05:22:03Z                                                                                                                                                                             |\n| flavor                               | m1.small (2)                                                                                                                                                                                     |\n| hostId                               | 101a1d8f15e8d05cd9435d49e42c2c95b3c9f3d6665663bfa3ad23a0                                                                                                                                         |\n| id                                   | d58a3b25-0434-4b92-a3a8-8b4188c611c3                                                                                                                                                             |\n| image                                | trusty (1d009366-0c2a-4495-8245-a00b5f8ade1d)                                                                                                                                                    |\n| key_name                             | -                                                                                                                                                                                                |\n| metadata                             | {}                                                                                                                                                                                               |\n| name                                 | 1                                                                                                                                                                                                |\n| os-extended-volumes:volumes_attached | [{\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}, {\"id\": \"3c8205b9-5066-42ea-9180-601fac50a08e\"}] |\n| private network                      | 192.168.21.4                                                                                                                                                                                     |\n| progress                             | 0                                                                                                                                                                                                |\n| security_groups                      | default                                                                                                                                                                                          |\n| status                               | ACTIVE                                                                                                                                                                                           |\n| tenant_id                            | 678f85bad9bd43b5a3ef50b1ff84eb17                                                                                                                                                                 |\n| updated                              | 2015-06-29T05:22:10Z                                                                                                                                                                             |\n| user_id                              | 42eb684528754ba2b78ecca15ff01c4d                                                                                                                                                                 |\n+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\nubuntu@xianghui-bastion:~/openstack-charm-testing/test$ cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 3c8205b9-5066-42ea-9180-601fac50a08e | available |     test     |  2   |     None    |  false   |             |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+", 
            "date_created": "2015-06-29 09:28:10.153582+00:00", 
            "author": "https://api.launchpad.net/1.0/~xianghui"
        }, 
        {
            "content": "I wonder how that's possible, as we have a roll back here: https://github.com/openstack/nova/blob/2014.1.5/nova/compute/manager.py#L4221-L4236 (bdm.destroy() call)\n\nI tried to raise an exception after Nova DB state was updated and before Cinder was notified the volume should be put into 'in-use' state, and rollback works as expected destroying the BDM entry.\n\nCould you please provide the steps how to reproduce this?", 
            "date_created": "2015-08-05 16:43:45.030305+00:00", 
            "author": "https://api.launchpad.net/1.0/~rpodolyaka"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2015-10-05 04:17:36.715872+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2015-10-05 04:17:37.375470+00:00"
}