{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 09:58:57.097069+00:00", 
    "description": "The metadata service component of the nova-api is repeatedly failing with tracebacks.\n\nTraceback: (also at http://paste.openstack.org/show/3865/)\n\n2011-12-16 16:32:00,716 INFO nova.api [-] 0.244149s 10.0.0.26 GET /2009-04-04/meta-data/instance-type None:None 500 [Python-urllib/2.7] t\next/plain text/plain\n2011-12-16 16:32:01,721 DEBUG nova.compute.api [1b3384a9-77ef-45d7-b830-a48eefbfb992 None None] Searching by: {'deleted': False, 'fixed_i\np': '10.0.0.26'} from (pid=3586) get_all /usr/lib/python2.7/dist-packages/nova/compute/api.py:937\n2011-12-16 16:32:01,722 DEBUG nova.rpc [1b3384a9-77ef-45d7-b830-a48eefbfb992 None None] Making asynchronous call on network ... from (pid\n=3586) multicall /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:730\n2011-12-16 16:32:01,722 DEBUG nova.rpc [1b3384a9-77ef-45d7-b830-a48eefbfb992 None None] MSG_ID is c4bf2b7029f548eda4b4545a85258bfd from (\npid=3586) multicall /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:733\n2011-12-16 16:32:02,006 DEBUG nova.compute.api [1b3384a9-77ef-45d7-b830-a48eefbfb992 None None] Searching by: {'deleted': False, 'project\n_id': '2'} from (pid=3586) get_all /usr/lib/python2.7/dist-packages/nova/compute/api.py:937\n2011-12-16 16:32:02,038 INFO nova.api [-] 0.316515s 10.0.0.26 GET /2009-04-04/meta-data/instance-type None:None 200 [Python-urllib/2.7] t\next/plain text/html\n2011-12-16 16:32:02,041 DEBUG nova.compute.api [058508f3-3cba-4bff-8fea-477a81365a48 None None] Searching by: {'deleted': False, 'fixed_i\np': '10.0.0.26'} from (pid=3586) get_all /usr/lib/python2.7/dist-packages/nova/compute/api.py:937\n2011-12-16 16:32:02,041 DEBUG nova.rpc [058508f3-3cba-4bff-8fea-477a81365a48 None None] Making asynchronous call on network ... from (pid\n=3586) multicall /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:730\n2011-12-16 16:32:02,042 DEBUG nova.rpc [058508f3-3cba-4bff-8fea-477a81365a48 None None] MSG_ID is b0dbdd942eca4612ad451e9ef80f638e from (\npid=3586) multicall /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:733\n2011-12-16 16:32:02,242 ERROR nova.api.metadata [058508f3-3cba-4bff-8fea-477a81365a48 None None] Failed to get metadata for ip: 10.0.0.26\n(nova.api.metadata): TRACE: Traceback (most recent call last):\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/metadata/handler.py\", line 248, in __call__\n(nova.api.metadata): TRACE:     meta_data = self.get_metadata(remote_address)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/metadata/handler.py\", line 145, in get_metadata\n(nova.api.metadata): TRACE:     search_opts=search_opts)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 981, in get_all\n(nova.api.metadata): TRACE:     inst_models = self._get_instances_by_filters(context, filters)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1015, in _get_instances_by_filters\n(nova.api.metadata): TRACE:     filters)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 194, in get_instance_uuids_by_ip_filter\n(nova.api.metadata): TRACE:     'args': args})\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 45, in call\n(nova.api.metadata): TRACE:     return get_impl().call(context, topic, msg)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 747, in call\n(nova.api.metadata): TRACE:     rv = list(rv)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 715, in __iter__\n(nova.api.metadata): TRACE:     raise result\n(nova.api.metadata): TRACE: RemoteError: Remote error: DetachedInstanceError Parent instance <FixedIp at 0x3b786d0> is not bound to a Session; lazy load operation of attribute 'floating_ips' cannot proceed\n(nova.api.metadata): TRACE: [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_carrot.py\", line 284, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 584, in get_instance_uuids_by_ip_filter\\n    for floating_ip in fixed_ip.get(\\'floating_ips\\', []):\\n', u'  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/models.py\", line 77, in get\\n    return getattr(self, key, default)\\n', u'  File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 168, in __get__\\n    instance_dict(instance))\\n', u'  File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 388, in get\\n    value = callable_(passive=passive)\\n', u'  File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 599, in __call__\\n    (mapperutil.state_str(state), self.key)\\n', u\"DetachedInstanceError: Parent instance <FixedIp at 0x3b786d0> is not bound to a Session; lazy load operation of attribute 'floating_ips' cannot proceed\\n\"].\n(nova.api.metadata): TRACE: \n2011-12-16 16:32:02,244 INFO nova.api [-] 0.202969s 10.0.0.26 GET /2009-04-04/meta-data/instance-id None:None 500 [Python-urllib/2.7] text/plain text/plain", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/905398", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 905398, 
    "index": 543, 
    "openned": "2011-12-16 16:35:53.686862+00:00", 
    "created": "2011-12-16 16:35:53.686862+00:00", 
    "title": "metadata service failing on essex-2 with traceback", 
    "comments": [
        {
            "content": "The metadata service component of the nova-api is repeatedly failing with tracebacks.\n\nTraceback: (also at http://paste.openstack.org/show/3865/)\n\n2011-12-16 16:32:00,716 INFO nova.api [-] 0.244149s 10.0.0.26 GET /2009-04-04/meta-data/instance-type None:None 500 [Python-urllib/2.7] t\next/plain text/plain\n2011-12-16 16:32:01,721 DEBUG nova.compute.api [1b3384a9-77ef-45d7-b830-a48eefbfb992 None None] Searching by: {'deleted': False, 'fixed_i\np': '10.0.0.26'} from (pid=3586) get_all /usr/lib/python2.7/dist-packages/nova/compute/api.py:937\n2011-12-16 16:32:01,722 DEBUG nova.rpc [1b3384a9-77ef-45d7-b830-a48eefbfb992 None None] Making asynchronous call on network ... from (pid\n=3586) multicall /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:730\n2011-12-16 16:32:01,722 DEBUG nova.rpc [1b3384a9-77ef-45d7-b830-a48eefbfb992 None None] MSG_ID is c4bf2b7029f548eda4b4545a85258bfd from (\npid=3586) multicall /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:733\n2011-12-16 16:32:02,006 DEBUG nova.compute.api [1b3384a9-77ef-45d7-b830-a48eefbfb992 None None] Searching by: {'deleted': False, 'project\n_id': '2'} from (pid=3586) get_all /usr/lib/python2.7/dist-packages/nova/compute/api.py:937\n2011-12-16 16:32:02,038 INFO nova.api [-] 0.316515s 10.0.0.26 GET /2009-04-04/meta-data/instance-type None:None 200 [Python-urllib/2.7] t\next/plain text/html\n2011-12-16 16:32:02,041 DEBUG nova.compute.api [058508f3-3cba-4bff-8fea-477a81365a48 None None] Searching by: {'deleted': False, 'fixed_i\np': '10.0.0.26'} from (pid=3586) get_all /usr/lib/python2.7/dist-packages/nova/compute/api.py:937\n2011-12-16 16:32:02,041 DEBUG nova.rpc [058508f3-3cba-4bff-8fea-477a81365a48 None None] Making asynchronous call on network ... from (pid\n=3586) multicall /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:730\n2011-12-16 16:32:02,042 DEBUG nova.rpc [058508f3-3cba-4bff-8fea-477a81365a48 None None] MSG_ID is b0dbdd942eca4612ad451e9ef80f638e from (\npid=3586) multicall /usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py:733\n2011-12-16 16:32:02,242 ERROR nova.api.metadata [058508f3-3cba-4bff-8fea-477a81365a48 None None] Failed to get metadata for ip: 10.0.0.26\n(nova.api.metadata): TRACE: Traceback (most recent call last):\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/metadata/handler.py\", line 248, in __call__\n(nova.api.metadata): TRACE:     meta_data = self.get_metadata(remote_address)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/metadata/handler.py\", line 145, in get_metadata\n(nova.api.metadata): TRACE:     search_opts=search_opts)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 981, in get_all\n(nova.api.metadata): TRACE:     inst_models = self._get_instances_by_filters(context, filters)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 1015, in _get_instances_by_filters\n(nova.api.metadata): TRACE:     filters)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 194, in get_instance_uuids_by_ip_filter\n(nova.api.metadata): TRACE:     'args': args})\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 45, in call\n(nova.api.metadata): TRACE:     return get_impl().call(context, topic, msg)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 747, in call\n(nova.api.metadata): TRACE:     rv = list(rv)\n(nova.api.metadata): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 715, in __iter__\n(nova.api.metadata): TRACE:     raise result\n(nova.api.metadata): TRACE: RemoteError: Remote error: DetachedInstanceError Parent instance <FixedIp at 0x3b786d0> is not bound to a Session; lazy load operation of attribute 'floating_ips' cannot proceed\n(nova.api.metadata): TRACE: [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_carrot.py\", line 284, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 584, in get_instance_uuids_by_ip_filter\\n    for floating_ip in fixed_ip.get(\\'floating_ips\\', []):\\n', u'  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/models.py\", line 77, in get\\n    return getattr(self, key, default)\\n', u'  File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 168, in __get__\\n    instance_dict(instance))\\n', u'  File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 388, in get\\n    value = callable_(passive=passive)\\n', u'  File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 599, in __call__\\n    (mapperutil.state_str(state), self.key)\\n', u\"DetachedInstanceError: Parent instance <FixedIp at 0x3b786d0> is not bound to a Session; lazy load operation of attribute 'floating_ips' cannot proceed\\n\"].\n(nova.api.metadata): TRACE: \n2011-12-16 16:32:02,244 INFO nova.api [-] 0.202969s 10.0.0.26 GET /2009-04-04/meta-data/instance-id None:None 500 [Python-urllib/2.7] text/plain text/plain", 
            "date_created": "2011-12-16 16:35:53.686862+00:00", 
            "author": "https://api.launchpad.net/1.0/~heckj"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/2431\nCommitted: http://github.com/openstack/nova/commit/2f76cd502fcc434b33af8963ac01c2ff6b8c723e\nSubmitter: Jenkins\nBranch:    master\n\n status fixcommitted\n done\n\ncommit 2f76cd502fcc434b33af8963ac01c2ff6b8c723e\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Fri Dec 16 13:08:56 2011 -0800\n\n    Adds missing joinedload for vif loading.\n    \n     * fixes bug 905398\n    \n    Change-Id: I76ffea1437459942f5156d199592931afed4ae1b\n", 
            "date_created": "2011-12-16 21:51:30+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Thank you!!!!", 
            "date_created": "2011-12-17 00:08:49.280183+00:00", 
            "author": "https://api.launchpad.net/1.0/~heckj"
        }, 
        {
            "content": "Thank you!!!", 
            "date_created": "2011-12-30 06:00:45.268420+00:00", 
            "author": "https://api.launchpad.net/1.0/~zyluo"
        }
    ], 
    "closed": "2012-01-25 09:53:10.879186+00:00"
}