{
    "status": "Invalid", 
    "last_updated": "2014-09-18 12:35:22.311387+00:00", 
    "description": "Steps to reproduce on essex-4:\n\n1. Boot an instance using flavor ID 1\n2. After the instance is active, delete the flavor (nova-manage flavor delete m1.tiny)\n3. Make a call to /servers/details (ie nova list)\n\n# nova list\nThe server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400)\n\nfrom nova-api.log:\n\n2012-03-22 14:56:40 INFO nova.api.openstack.wsgi [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] GET http://10.10.10.90:8774/v1.1/test/servers/detail\n2012-03-22 14:56:40 DEBUG nova.api.openstack.wsgi [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Unrecognized Content-Type provided in request from (pid=23300\n) get_body /usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py:694\n2012-03-22 14:56:40 DEBUG nova.compute.api [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Searching by: {'deleted': False, 'project_id': 'test'} from (pid=233\n00) get_all /usr/lib/python2.6/site-packages/nova/compute/api.py:1009\n2012-03-22 14:56:40 DEBUG nova.api.openstack.common [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Generated ACTIVE from vm_state=active task_state=None. from\n (pid=23300) status_from_state /usr/lib/python2.6/site-packages/nova/api/openstack/common.py:98\n2012-03-22 14:56:40 ERROR nova.api.openstack.wsgi [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Exception handling resource: 'NoneType' object is unsubscript\nable\n(nova.api.openstack.wsgi): TRACE: Traceback (most recent call last):\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 848, in _process_stack\n(nova.api.openstack.wsgi): TRACE:     action_result = self.dispatch(meth, request, action_args)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 924, in dispatch\n(nova.api.openstack.wsgi): TRACE:     return method(req=request, **action_args)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/servers.py\", line 382, in detail\n(nova.api.openstack.wsgi): TRACE:     servers = self._get_servers(req, is_detail=True)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/servers.py\", line 465, in _get_servers\n(nova.api.openstack.wsgi): TRACE:     return self._view_builder.detail(req, limited_list)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 123, in detail\n(nova.api.openstack.wsgi): TRACE:     return self._list_view(self.show, request, instances)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 127, in _list_view\n(nova.api.openstack.wsgi): TRACE:     server_list = [func(request, server)[\"server\"] for server in servers]\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 61, in wrapped\n(nova.api.openstack.wsgi): TRACE:     return func(self, request, instance)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 97, in show\n(nova.api.openstack.wsgi): TRACE:     \"flavor\": self._get_flavor(request, instance),\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 172, in _get_flavor\n(nova.api.openstack.wsgi): TRACE:     flavor_id = instance[\"instance_type\"][\"flavorid\"]\n(nova.api.openstack.wsgi): TRACE: TypeError: 'NoneType' object is unsubscriptable\n(nova.api.openstack.wsgi): TRACE: \n2012-03-22 14:56:40 INFO nova.api.openstack.wsgi [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] http://10.10.10.90:8774/v1.1/test/servers/detail returned with\n HTTP 400\n\nEither users should be blocked from deleting a flavor until all instances booted from it terminate, or this should be more robust (I'd propose the latter).", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 42, 
    "link": "https://bugs.launchpad.net/nova/+bug/962549", 
    "owner": "None", 
    "id": 962549, 
    "index": 3983, 
    "openned": "2012-03-22 21:13:12.578239+00:00", 
    "created": "2012-03-22 21:13:12.578239+00:00", 
    "title": "Deleting a flavor can cause servers/detail to return HTTP 400", 
    "comments": [
        {
            "content": "Steps to reproduce on essex-4:\n\n1. Boot an instance using flavor ID 1\n2. After the instance is active, delete the flavor (nova-manage flavor delete m1.tiny)\n3. Make a call to /servers/details (ie nova list)\n\n# nova list\nThe server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400)\n\nfrom nova-api.log:\n\n2012-03-22 14:56:40 INFO nova.api.openstack.wsgi [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] GET http://10.10.10.90:8774/v1.1/test/servers/detail\n2012-03-22 14:56:40 DEBUG nova.api.openstack.wsgi [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Unrecognized Content-Type provided in request from (pid=23300\n) get_body /usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py:694\n2012-03-22 14:56:40 DEBUG nova.compute.api [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Searching by: {'deleted': False, 'project_id': 'test'} from (pid=233\n00) get_all /usr/lib/python2.6/site-packages/nova/compute/api.py:1009\n2012-03-22 14:56:40 DEBUG nova.api.openstack.common [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Generated ACTIVE from vm_state=active task_state=None. from\n (pid=23300) status_from_state /usr/lib/python2.6/site-packages/nova/api/openstack/common.py:98\n2012-03-22 14:56:40 ERROR nova.api.openstack.wsgi [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Exception handling resource: 'NoneType' object is unsubscript\nable\n(nova.api.openstack.wsgi): TRACE: Traceback (most recent call last):\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 848, in _process_stack\n(nova.api.openstack.wsgi): TRACE:     action_result = self.dispatch(meth, request, action_args)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 924, in dispatch\n(nova.api.openstack.wsgi): TRACE:     return method(req=request, **action_args)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/servers.py\", line 382, in detail\n(nova.api.openstack.wsgi): TRACE:     servers = self._get_servers(req, is_detail=True)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/servers.py\", line 465, in _get_servers\n(nova.api.openstack.wsgi): TRACE:     return self._view_builder.detail(req, limited_list)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 123, in detail\n(nova.api.openstack.wsgi): TRACE:     return self._list_view(self.show, request, instances)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 127, in _list_view\n(nova.api.openstack.wsgi): TRACE:     server_list = [func(request, server)[\"server\"] for server in servers]\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 61, in wrapped\n(nova.api.openstack.wsgi): TRACE:     return func(self, request, instance)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 97, in show\n(nova.api.openstack.wsgi): TRACE:     \"flavor\": self._get_flavor(request, instance),\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\", line 172, in _get_flavor\n(nova.api.openstack.wsgi): TRACE:     flavor_id = instance[\"instance_type\"][\"flavorid\"]\n(nova.api.openstack.wsgi): TRACE: TypeError: 'NoneType' object is unsubscriptable\n(nova.api.openstack.wsgi): TRACE: \n2012-03-22 14:56:40 INFO nova.api.openstack.wsgi [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] http://10.10.10.90:8774/v1.1/test/servers/detail returned with\n HTTP 400\n\nEither users should be blocked from deleting a flavor until all instances booted from it terminate, or this should be more robust (I'd propose the latter).", 
            "date_created": "2012-03-22 21:13:12.578239+00:00", 
            "author": "https://api.launchpad.net/1.0/~ryan-tidwell"
        }, 
        {
            "content": "The possible solutions that can be proposed for resolving this bug are:\n\n1. Either the user has to be given a notification that the instance type or flavor cannot be deleted since the instances are associated with it, and he will be able to delete the flavor only if the instances that are associated with that respective flavor are deleted.\n\n2. Or while fetching the instances from the instances table using \"nova list\", the code has to be changed in such a way the instance_type_id is not fetched and there is no association of the instances with the instance_type_id. Hence, even if the instance_type is deleted the instance list can be fetched using the \"nova list\" command.", 
            "date_created": "2012-07-04 12:41:08.440739+00:00", 
            "author": "https://api.launchpad.net/1.0/~guduru-sirisha"
        }, 
        {
            "content": "Perhaps a 3rd solution:\n\nAllow the flavor to be deleted, but mark it as in a state of deletion (as in, the deletion is in progress, no new instances can be started with this flavor, etc), and the actual deletion itself will take place when any instances still using that flavor are stopped.\n\nMichael", 
            "date_created": "2012-07-10 04:11:09.672382+00:00", 
            "author": "https://api.launchpad.net/1.0/~michael-sykosoft"
        }, 
        {
            "content": "I have seen the same problems, \nBut how to restore my instance after this?\n", 
            "date_created": "2012-08-29 07:22:48.539255+00:00", 
            "author": "https://api.launchpad.net/1.0/~deanraccoon"
        }, 
        {
            "content": "By the way, this issue also surfaces during nova-compute restart. nova-compute fails to start if any of the instances have references deleted flavors.", 
            "date_created": "2012-12-01 20:04:25.644875+00:00", 
            "author": "https://api.launchpad.net/1.0/~subbu"
        }, 
        {
            "content": "Is this still valid?", 
            "date_created": "2014-07-12 19:28:32.885944+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "I'm not observing my described behavior in Icehouse.  Here's what I did:\n\n1. Started an instance with a created flavor.\n2. Did a 'nova list', got back a response.\n3. Deleted the flavor.\n4. Did a 'nova list', got back a response.\n\nK\n\n\nOn Sat, Jul 12, 2014 at 12:28 PM, Joe Gordon <email address hidden>\nwrote:\n\n> Is this still valid?\n>\n> ** Changed in: nova\n>        Status: In Progress => Incomplete\n>\n> --\n> You received this bug notification because you are subscribed to a\n> duplicate bug report (990127).\n> https://bugs.launchpad.net/bugs/962549\n>\n> Title:\n>   Deleting a flavor can cause servers/detail to return HTTP 400\n>\n> Status in OpenStack Compute (Nova):\n>   Incomplete\n>\n> Bug description:\n>   Steps to reproduce on essex-4:\n>\n>   1. Boot an instance using flavor ID 1\n>   2. After the instance is active, delete the flavor (nova-manage flavor\n> delete m1.tiny)\n>   3. Make a call to /servers/details (ie nova list)\n>\n>   # nova list\n>   The server could not comply with the request since it is either\n> malformed or otherwise incorrect. (HTTP 400)\n>\n>   from nova-api.log:\n>\n>   2012-03-22 14:56:40 INFO nova.api.openstack.wsgi\n> [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] GET\n> http://10.10.10.90:8774/v1.1/test/servers/detail\n>   2012-03-22 14:56:40 DEBUG nova.api.openstack.wsgi\n> [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Unrecognized\n> Content-Type provided in request from (pid=23300\n>   ) get_body\n> /usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py:694\n>   2012-03-22 14:56:40 DEBUG nova.compute.api\n> [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Searching by:\n> {'deleted': False, 'project_id': 'test'} from (pid=233\n>   00) get_all /usr/lib/python2.6/site-packages/nova/compute/api.py:1009\n>   2012-03-22 14:56:40 DEBUG nova.api.openstack.common\n> [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Generated ACTIVE from\n> vm_state=active task_state=None. from\n>    (pid=23300) status_from_state\n> /usr/lib/python2.6/site-packages/nova/api/openstack/common.py:98\n>   2012-03-22 14:56:40 ERROR nova.api.openstack.wsgi\n> [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test] Exception handling\n> resource: 'NoneType' object is unsubscript\n>   able\n>   (nova.api.openstack.wsgi): TRACE: Traceback (most recent call last):\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 848, in\n> _process_stack\n>   (nova.api.openstack.wsgi): TRACE:     action_result =\n> self.dispatch(meth, request, action_args)\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 924, in\n> dispatch\n>   (nova.api.openstack.wsgi): TRACE:     return method(req=request,\n> **action_args)\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/servers.py\",\n> line 382, in detail\n>   (nova.api.openstack.wsgi): TRACE:     servers = self._get_servers(req,\n> is_detail=True)\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/servers.py\",\n> line 465, in _get_servers\n>   (nova.api.openstack.wsgi): TRACE:     return\n> self._view_builder.detail(req, limited_list)\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\",\n> line 123, in detail\n>   (nova.api.openstack.wsgi): TRACE:     return self._list_view(self.show,\n> request, instances)\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\",\n> line 127, in _list_view\n>   (nova.api.openstack.wsgi): TRACE:     server_list = [func(request,\n> server)[\"server\"] for server in servers]\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\",\n> line 61, in wrapped\n>   (nova.api.openstack.wsgi): TRACE:     return func(self, request,\n> instance)\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\",\n> line 97, in show\n>   (nova.api.openstack.wsgi): TRACE:     \"flavor\":\n> self._get_flavor(request, instance),\n>   (nova.api.openstack.wsgi): TRACE:   File\n> \"/usr/lib/python2.6/site-packages/nova/api/openstack/compute/views/servers.py\",\n> line 172, in _get_flavor\n>   (nova.api.openstack.wsgi): TRACE:     flavor_id =\n> instance[\"instance_type\"][\"flavorid\"]\n>   (nova.api.openstack.wsgi): TRACE: TypeError: 'NoneType' object is\n> unsubscriptable\n>   (nova.api.openstack.wsgi): TRACE:\n>   2012-03-22 14:56:40 INFO nova.api.openstack.wsgi\n> [req-43268d0b-0b3f-451f-b36f-bfcb49b68ff9 ryan test]\n> http://10.10.10.90:8774/v1.1/test/servers/detail returned with\n>    HTTP 400\n>\n>   Either users should be blocked from deleting a flavor until all\n>   instances booted from it terminate, or this should be more robust (I'd\n>   propose the latter).\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/962549/+subscriptions\n>\n", 
            "date_created": "2014-07-14 13:16:21+00:00", 
            "author": "https://api.launchpad.net/1.0/~kordless"
        }, 
        {
            "content": "I reported this against Essex but haven't really been following it too closely.  If we're not observing this on Icehouse, I'm thinking this is no longer a valid issue.", 
            "date_created": "2014-07-14 16:37:58.247133+00:00", 
            "author": "https://api.launchpad.net/1.0/~ryan-tidwell"
        }, 
        {
            "content": "This is fixed with the system metadata flavor saving", 
            "date_created": "2014-09-18 12:35:21.544701+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2014-09-18 12:35:07.873523+00:00"
}