{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:02:32.794773+00:00", 
    "description": "when create multiple servers, in nova v3 api,  the min_count and min_count should be converted into the type: int. otherwise some problem will arise.\n\nthe tempest v3 tests log:\n2013-11-25 16:04:21,000 Request: POST http://9.115.126.211:8774/v3/servers\n2013-11-25 16:04:21,001 Request Headers: {'Content-Type': 'application/xml', 'Accept': 'application/xml', 'X-Auth-Token': '<Token omitted>'}\n2013-11-25 16:04:21,001 Request Body: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<server xmlns=\"http://docs.openstack.org/compute/api/v1.1\" name=\"multiple-create-test-tempest-917155335\" os-multiple-create:max_count=\"2\" os-multiple-create:return_reservation_id=\"True\" xmlns:os-multiple-create=\"http://docs.openstack.org/compute/ext/multiplecreate/api/v3\" image_ref=\"08850447-5bfc-49ab-a728-92c056829e99\" flavor_ref=\"42\" os-multiple-create:min_count=\"1\"/>\n2013-11-25 16:04:21,684 Response Status: 400\n2013-11-25 16:04:21,684 Nova request id: req-3ad76a84-dfd1-4d5d-8bd9-8a5879b16b6f\n2013-11-25 16:04:21,684 Response Headers: {'content-length': '203', 'date': 'Mon, 25 Nov 2013 08:04:21 GMT', 'content-type': 'application/xml; charset=UTF-8', 'connection': 'close'}\n2013-11-25 16:04:21,684 Response Body: <badRequest code=\"400\" xmlns=\"http://docs.openstack.org/compute/api/v1.1\"><message>The server could not comply with the request since it is either malformed or otherwise incorrect.</message></badRequest>\n\n\nnova v3 api log:\n2013-11-25 16:04:21.679 ERROR nova.api.openstack.wsgi [req-3ad76a84-dfd1-4d5d-8bd9-8a5879b16b6f demo demo] Exception handling resource: coercing to Unicode: need string or buffer, long found\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi Traceback (most recent call last):\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 999, in _process_stack\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     action_result = self.dispatch(meth, request, action_args)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1080, in dispatch\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     return method(req=request, **action_args)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/api/openstack/compute/plugins/v3/servers.py\", line 773, in create\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     **create_kwargs)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/hooks.py\", line 105, in inner\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     rv = f(*args, **kwargs)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/compute/api.py\", line 1234, in create\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     legacy_bdm=legacy_bdm)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/compute/api.py\", line 883, in _create_instance\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     block_device_mapping)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/compute/api.py\", line 759, in _provision_instances\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     context, instance_type, min_count, max_count)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/compute/api.py\", line 344, in _check_num_instances_quota\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     cores=req_cores, ram=req_ram)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/quota.py\", line 1272, in reserve\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     user_id=user_id)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/quota.py\", line 500, in reserve\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     project_id=project_id, user_id=user_id)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/db/api.py\", line 1097, in quota_reserve\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     project_id=project_id, user_id=user_id)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     return f(*args, **kwargs)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 168, in wrapped\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     return f(*args, **kwargs)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 3186, in quota_reserve\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     project_usages[res]['total'] or\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi TypeError: coercing to Unicode: need string or buffer, long found\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi \n2013-11-25 16:04:21.682 DEBUG nova.api.openstack.wsgi [req-3ad76a84-dfd1-4d5d-8bd9-8a5879b16b6f demo demo] Returning 400 to user: The server could not comply with the request since it is either malformed or otherwise incorrect. from (pid=10829) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1225\n2013-11-25 16:04:21.683 INFO nova.osapi_compute.wsgi.server [req-3ad76a84-dfd1-4d5d-8bd9-8a5879b16b6f demo demo] 9.115.126.211 \"POST /v3/servers HTTP/1.1\" status: 400 len: 418 time: 0.6807010", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1254616", 
    "owner": "https://api.launchpad.net/1.0/~ivan-zhu", 
    "id": 1254616, 
    "index": 5577, 
    "openned": "2013-11-25 08:14:48.209190+00:00", 
    "created": "2013-11-25 08:14:48.209190+00:00", 
    "title": "max_count and min_count should be converted into the type: int", 
    "comments": [
        {
            "content": "when create multiple servers, in nova v3 api,  the min_count and min_count should be converted into the type: int. otherwise some problem will arise.\n\nthe tempest v3 tests log:\n2013-11-25 16:04:21,000 Request: POST http://9.115.126.211:8774/v3/servers\n2013-11-25 16:04:21,001 Request Headers: {'Content-Type': 'application/xml', 'Accept': 'application/xml', 'X-Auth-Token': '<Token omitted>'}\n2013-11-25 16:04:21,001 Request Body: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<server xmlns=\"http://docs.openstack.org/compute/api/v1.1\" name=\"multiple-create-test-tempest-917155335\" os-multiple-create:max_count=\"2\" os-multiple-create:return_reservation_id=\"True\" xmlns:os-multiple-create=\"http://docs.openstack.org/compute/ext/multiplecreate/api/v3\" image_ref=\"08850447-5bfc-49ab-a728-92c056829e99\" flavor_ref=\"42\" os-multiple-create:min_count=\"1\"/>\n2013-11-25 16:04:21,684 Response Status: 400\n2013-11-25 16:04:21,684 Nova request id: req-3ad76a84-dfd1-4d5d-8bd9-8a5879b16b6f\n2013-11-25 16:04:21,684 Response Headers: {'content-length': '203', 'date': 'Mon, 25 Nov 2013 08:04:21 GMT', 'content-type': 'application/xml; charset=UTF-8', 'connection': 'close'}\n2013-11-25 16:04:21,684 Response Body: <badRequest code=\"400\" xmlns=\"http://docs.openstack.org/compute/api/v1.1\"><message>The server could not comply with the request since it is either malformed or otherwise incorrect.</message></badRequest>\n\n\nnova v3 api log:\n2013-11-25 16:04:21.679 ERROR nova.api.openstack.wsgi [req-3ad76a84-dfd1-4d5d-8bd9-8a5879b16b6f demo demo] Exception handling resource: coercing to Unicode: need string or buffer, long found\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi Traceback (most recent call last):\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 999, in _process_stack\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     action_result = self.dispatch(meth, request, action_args)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 1080, in dispatch\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     return method(req=request, **action_args)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/api/openstack/compute/plugins/v3/servers.py\", line 773, in create\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     **create_kwargs)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/hooks.py\", line 105, in inner\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     rv = f(*args, **kwargs)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/compute/api.py\", line 1234, in create\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     legacy_bdm=legacy_bdm)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/compute/api.py\", line 883, in _create_instance\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     block_device_mapping)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/compute/api.py\", line 759, in _provision_instances\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     context, instance_type, min_count, max_count)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/compute/api.py\", line 344, in _check_num_instances_quota\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     cores=req_cores, ram=req_ram)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/quota.py\", line 1272, in reserve\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     user_id=user_id)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/quota.py\", line 500, in reserve\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     project_id=project_id, user_id=user_id)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/db/api.py\", line 1097, in quota_reserve\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     project_id=project_id, user_id=user_id)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 130, in wrapper\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     return f(*args, **kwargs)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 168, in wrapped\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     return f(*args, **kwargs)\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 3186, in quota_reserve\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi     project_usages[res]['total'] or\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi TypeError: coercing to Unicode: need string or buffer, long found\n2013-11-25 16:04:21.679 TRACE nova.api.openstack.wsgi \n2013-11-25 16:04:21.682 DEBUG nova.api.openstack.wsgi [req-3ad76a84-dfd1-4d5d-8bd9-8a5879b16b6f demo demo] Returning 400 to user: The server could not comply with the request since it is either malformed or otherwise incorrect. from (pid=10829) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1225\n2013-11-25 16:04:21.683 INFO nova.osapi_compute.wsgi.server [req-3ad76a84-dfd1-4d5d-8bd9-8a5879b16b6f demo demo] 9.115.126.211 \"POST /v3/servers HTTP/1.1\" status: 400 len: 418 time: 0.6807010", 
            "date_created": "2013-11-25 08:14:48.209190+00:00", 
            "author": "https://api.launchpad.net/1.0/~ivan-zhu"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/58220", 
            "date_created": "2013-11-25 08:44:39.607476+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/58220\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9b7d87181ba2406496c4b977a1b24c8173080ad6\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9b7d87181ba2406496c4b977a1b24c8173080ad6\nAuthor: ivan-zhu <email address hidden>\nDate:   Mon Nov 25 16:28:26 2013 +0800\n\n    convert min_count and max_count to type int in nova v3 api\n    \n    this converts min_count and max_count to type:int in nova\n    v3 api.\n    If the string type hasn't been converted, in the method\n    _check_num_instances_quota of nova/compute/api.py, something\n    like req_ram = '2'*128 will occur. That's why the issue in\n    bug 1254616 arise.\n    \n    Change-Id: I567b249e7a30681980ed760d5d09aad4c8e603b9\n    Closes-bug: 1254616\n", 
            "date_created": "2013-12-27 13:37:14.692784+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-01-22 16:20:12.375528+00:00"
}