{
    "status": "Invalid", 
    "last_updated": "2012-12-04 18:42:44.058085+00:00", 
    "description": "Discovered while working on Folsom packages deployed in Chef:\n\n---- Begin output of nova-manage network create --label=net_for_demo --fixed_range_v4=10.0.0.0/24 --multi_host='T' --num_networks=1 --network_size=255 --bridge=br100 --bridge_interface=bond1.2002 ----\nSTDOUT: Command failed, please check log for more info\nSTDERR: 2012-12-04 15:30:20 CRITICAL nova [req-f7b3cd1e-95f0-43ac-88f0-e8a419c6343e None None] 'vlan_start'\n2012-12-04 15:30:20 TRACE nova Traceback (most recent call last):\n2012-12-04 15:30:20 TRACE nova   File \"/usr/bin/nova-manage\", line 1400, in <module>\n2012-12-04 15:30:20 TRACE nova     main()\n2012-12-04 15:30:20 TRACE nova   File \"/usr/bin/nova-manage\", line 1387, in main\n2012-12-04 15:30:20 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-12-04 15:30:20 TRACE nova   File \"/usr/bin/nova-manage\", line 476, in create\n2012-12-04 15:30:20 TRACE nova     net_manager.create_networks(context.get_admin_context(), **kwargs)\n2012-12-04 15:30:20 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 2040, in create_networks\n2012-12-04 15:30:20 TRACE nova     if kwargs['num_networks'] + kwargs['vlan_start'] > 4094:\n2012-12-04 15:30:20 TRACE nova KeyError: 'vlan_start'\n2012-12-04 15:30:20 TRACE nova\n\nSeems that if network_manager = VlanManager, and no --vlan_start option is provided, this happens. It should default to 100 (or 0?)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1086434", 
    "owner": "None", 
    "id": 1086434, 
    "index": 4514, 
    "openned": "2012-12-04 15:41:13.937052+00:00", 
    "created": "2012-12-04 15:41:13.937052+00:00", 
    "title": "nova-manage network create results in No Such table nova.networks error after upgrade to Folsom packages", 
    "comments": [
        {
            "content": "Discovered while working on Folsom packages deployed in Chef:\n\n---- Begin output of nova-manage network create --label=net_for_demo --fixed_range_v4=10.0.0.0/24 --multi_host='T' --num_networks=1 --network_size=255 --bridge=br100 --bridge_interface=bond1.2002 ----\nSTDOUT: Command failed, please check log for more info\nSTDERR: 2012-12-04 15:30:20 CRITICAL nova [req-f7b3cd1e-95f0-43ac-88f0-e8a419c6343e None None] 'vlan_start'\n2012-12-04 15:30:20 TRACE nova Traceback (most recent call last):\n2012-12-04 15:30:20 TRACE nova   File \"/usr/bin/nova-manage\", line 1400, in <module>\n2012-12-04 15:30:20 TRACE nova     main()\n2012-12-04 15:30:20 TRACE nova   File \"/usr/bin/nova-manage\", line 1387, in main\n2012-12-04 15:30:20 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-12-04 15:30:20 TRACE nova   File \"/usr/bin/nova-manage\", line 476, in create\n2012-12-04 15:30:20 TRACE nova     net_manager.create_networks(context.get_admin_context(), **kwargs)\n2012-12-04 15:30:20 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 2040, in create_networks\n2012-12-04 15:30:20 TRACE nova     if kwargs['num_networks'] + kwargs['vlan_start'] > 4094:\n2012-12-04 15:30:20 TRACE nova KeyError: 'vlan_start'\n2012-12-04 15:30:20 TRACE nova\n\nSeems that if network_manager = VlanManager, and no --vlan_start option is provided, this happens. It should default to 1 (or 0?)", 
            "date_created": "2012-12-04 15:41:13.937052+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Well, that didn't work.... turns out vlan_start isn't a parameter:\n\nnova-manage: error: no such option: --vlan_start\n", 
            "date_created": "2012-12-04 15:46:58.039417+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Looking into things further, turns out that --vlan is stored in vlan_start, but there is no default anymore... it used to be 100.", 
            "date_created": "2012-12-04 15:52:02.686928+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "After adding a default for --vlan argument to nova-manage, re-running nova-manage network create results in an error about nova.networks not existing :(\n\n2012-12-04 15:54:43 CRITICAL nova [req-df75694f-7355-48ba-bc5a-07c15647fecb None None] (ProgrammingError) (1146, \"Table 'nova.networks' doesn't exist\") 'SELECT networks.created_at AS networks_created_at, networks.updated_at AS networks_updated_at, networks.deleted_at AS networks_deleted_at, networks.deleted AS networks_deleted, networks.id AS networks_id, networks.label AS networks_label, networks.injected AS networks_injected, networks.cidr AS networks_cidr, networks.cidr_v6 AS networks_cidr_v6, networks.multi_host AS networks_multi_host, networks.gateway_v6 AS networks_gateway_v6, networks.netmask_v6 AS networks_netmask_v6, networks.netmask AS networks_netmask, networks.bridge AS networks_bridge, networks.bridge_interface AS networks_bridge_interface, networks.gateway AS networks_gateway, networks.broadcast AS networks_broadcast, networks.dns1 AS networks_dns1, networks.dns2 AS networks_dns2, networks.vlan AS networks_vlan, networks.vpn_public_address AS networks_vpn_public_address, networks.vpn_public_port AS networks_vpn_public_port, networks.vpn_private_address AS networks_vpn_private_address, networks.dhcp_start AS networks_dhcp_start, networks.rxtx_base AS networks_rxtx_base, networks.project_id AS networks_project_id, networks.priority AS networks_priority, networks.host AS networks_host, networks.uuid AS networks_uuid \\nFROM networks \\nWHERE networks.deleted = %s' (0,)\n2012-12-04 15:54:43 TRACE nova Traceback (most recent call last):\n2012-12-04 15:54:43 TRACE nova   File \"/usr/bin/nova-manage\", line 1400, in <module>\n2012-12-04 15:54:43 TRACE nova     main()\n2012-12-04 15:54:43 TRACE nova   File \"/usr/bin/nova-manage\", line 1387, in main\n2012-12-04 15:54:43 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/bin/nova-manage\", line 476, in create\n2012-12-04 15:54:43 TRACE nova     net_manager.create_networks(context.get_admin_context(), **kwargs)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 2055, in create_networks\n2012-12-04 15:54:43 TRACE nova     self, context, vpn=True, **kwargs)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 1442, in create_networks\n2012-12-04 15:54:43 TRACE nova     return self._do_create_networks(context, **kwargs)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 1479, in _do_create_networks\n2012-12-04 15:54:43 TRACE nova     nets = self.db.network_get_all(context)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 820, in network_get_all\n2012-12-04 15:54:43 TRACE nova     return IMPL.network_get_all(context)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n2012-12-04 15:54:43 TRACE nova     return f(*args, **kwargs)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 2155, in network_get_all\n2012-12-04 15:54:43 TRACE nova     result = model_query(context, models.Network, read_deleted=\"no\").all()\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2115, in all\n2012-12-04 15:54:43 TRACE nova     return list(self)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2227, in __iter__\n2012-12-04 15:54:43 TRACE nova     return self._execute_and_instances(context)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2242, in _execute_and_instances\n2012-12-04 15:54:43 TRACE nova     result = conn.execute(querycontext.statement, self._params)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1449, in execute\n2012-12-04 15:54:43 TRACE nova     params)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1584, in _execute_clauseelement\n2012-12-04 15:54:43 TRACE nova     compiled_sql, distilled_params\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1698, in _execute_context\n2012-12-04 15:54:43 TRACE nova     context)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1691, in _execute_context\n2012-12-04 15:54:43 TRACE nova     context)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 331, in do_execute\n2012-12-04 15:54:43 TRACE nova     cursor.execute(statement, parameters)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\n2012-12-04 15:54:43 TRACE nova     self.errorhandler(self, exc, value)\n2012-12-04 15:54:43 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n2012-12-04 15:54:43 TRACE nova     raise errorclass, errorvalue\n2012-12-04 15:54:43 TRACE nova ProgrammingError: (ProgrammingError) (1146, \"Table 'nova.networks' doesn't exist\") 'SELECT networks.created_at AS networks_created_at, networks.updated_at AS networks_updated_at, networks.deleted_at AS networks_deleted_at, networks.deleted AS networks_deleted, networks.id AS networks_id, networks.label AS networks_label, networks.injected AS networks_injected, networks.cidr AS networks_cidr, networks.cidr_v6 AS networks_cidr_v6, networks.multi_host AS networks_multi_host, networks.gateway_v6 AS networks_gateway_v6, networks.netmask_v6 AS networks_netmask_v6, networks.netmask AS networks_netmask, networks.bridge AS networks_bridge, networks.bridge_interface AS networks_bridge_interface, networks.gateway AS networks_gateway, networks.broadcast AS networks_broadcast, networks.dns1 AS networks_dns1, networks.dns2 AS networks_dns2, networks.vlan AS networks_vlan, networks.vpn_public_address AS networks_vpn_public_address, networks.vpn_public_port AS networks_vpn_public_port, networks.vpn_private_address AS networks_vpn_private_address, networks.dhcp_start AS networks_dhcp_start, networks.rxtx_base AS networks_rxtx_base, networks.project_id AS networks_project_id, networks.priority AS networks_priority, networks.host AS networks_host, networks.uuid AS networks_uuid \\nFROM networks \\nWHERE networks.deleted = %s' (0,)\n2012-12-04 15:54:43 TRACE nova\n---- End output of nova-manage network create --label=net_for_demo --fixed_range_v4=10.0.0.0/24 --multi_host='T' --num_networks=1 --network_size=255 --bridge=br100 --bridge_interface=bond1.2002 --vlan=100 ----\nRan nova-manage network create --label=net_for_demo --fixed_range_v4=10.0.0.0/24 --multi_host='T' --num_networks=1 --network_size=255 --bridge=br100 --bridge_interface=bond1.2002 --vlan=100 returned 1\n", 
            "date_created": "2012-12-04 15:56:24.126403+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Apparently, after running nova-manage db sync, our nova database was deleted.\n\nmysql> use nova\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nmysql> show tables;\n+-----------------+\n| Tables_in_nova  |\n+-----------------+\n| migrate_version |\n+-----------------+\n1 row in set (0.00 sec)\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| glance             |\n| keystone           |\n| mysql              |\n| nova               |\n| performance_schema |\n| test               |\n+--------------------+\n7 rows in set (0.00 sec)\n\nmysql> use glance\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nmysql> show tables;\n+------------------+\n| Tables_in_glance |\n+------------------+\n| image_members    |\n| image_properties |\n| image_tags       |\n| images           |\n| migrate_version  |\n+------------------+\n5 rows in set (0.00 sec)\n", 
            "date_created": "2012-12-04 18:25:52.788432+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Running nova-manage db sync manually restored the tables... still trying to figure out wtf happend.", 
            "date_created": "2012-12-04 18:30:45.824095+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "this was due to a b0rked environment. sorry for the noise.", 
            "date_created": "2012-12-04 18:42:43.421324+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }
    ], 
    "closed": "2012-12-04 18:42:24.086565+00:00"
}