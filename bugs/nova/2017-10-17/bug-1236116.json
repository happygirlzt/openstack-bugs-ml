{
    "status": "Invalid", 
    "last_updated": "2015-08-26 22:55:38.611017+00:00", 
    "description": "Attaching multiple networks results in a backtrace and undeleteable instance when used with Neutron.\n\nRun reproducer as follows:\n[sdake@bigiron ~]$ less reproducer\n#!/bin/bash\n\nglance image-create --name=cirros-0.3.0-x86_64 --disk-format=qcow2 --container-f\normat=bare < cirros.img\nid1=`neutron net-list -c id -f csv --quote none | grep -v id | tail -1 | tr -d '\n\\r'`\nid2=`neutron net-list -c id -f csv --quote none | grep -v id | head -1 | tr -d '\n\\r'`\nnova boot --flavor m1.tiny --image cirros-0.3.0-x86_64 --security_group default \n--nic net-id=$id1 --nic net-id=$id2 cirros\n\nRun nova list waiting for server to become active.  Once server is active, delete the server via the nova delete <id> operation.  Server will enter an undeleteable saying it is \"ACTIVE\".  It is important that both networks are connected when the delete operation is run, as for some reason one of the networks gets disconnected by some component (not sure which).\n\nFurther delete operations are either unsuccessful or block further ability to create instances with instances finishing in the ERROR state after creation.\n\nn-cpu backtraces with:\n2013-10-06 18:03:11.269 ERROR nova.openstack.common.rpc.amqp [req-4f7cf630-d1eb-4fcd-af22-c11fa77fd3dd admin admin] Exception during message handling\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 353, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 243, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     pass\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 229, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 294, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 258, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File 2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 294, in decorated_function\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_function\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 258, in decorated_function\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1793, in terminate_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     do_terminate_instance(instance, bdms)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1785, in do_terminate_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     reservations=reservations)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/hooks.py\", line 105, in inner\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     rv = f(*args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1758, in _delete_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     user_id=user_id)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1730, in _delete_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     self._shutdown_instance(context, db_inst, bdms)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1640, in _shutdown_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     network_info = self._get_instance_nw_info(context, instance)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 877, in _get_instance_nw_info\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     instance)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 455, in get_instance_nw_info\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     result = self._get_instance_nw_info(context, instance, networks)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 463, in _get_instance_nw_info\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     nw_info = self._build_network_info_model(context, instance, networks)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 1009, in _build_network_info_model\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     subnets)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 962, in _nw_info_build_network\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     label=network_name,\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp UnboundLocalError: local variable 'network_name' referenced before assignment\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1236116", 
    "owner": "https://api.launchpad.net/1.0/~sdake", 
    "id": 1236116, 
    "index": 5424, 
    "openned": "2013-10-07 01:14:32.467533+00:00", 
    "created": "2013-10-07 01:14:32.467533+00:00", 
    "title": "attaching all devstack quantum networks to a nova server results in un-deletable server", 
    "comments": [
        {
            "content": "Attaching multiple networks results in a backtrace and undeleteable instance when used with Neutron.\n\nRun reproducer as follows:\n[sdake@bigiron ~]$ less reproducer\n#!/bin/bash\n\nglance image-create --name=cirros-0.3.0-x86_64 --disk-format=qcow2 --container-f\normat=bare < cirros.img\nid1=`neutron net-list -c id -f csv --quote none | grep -v id | tail -1 | tr -d '\n\\r'`\nid2=`neutron net-list -c id -f csv --quote none | grep -v id | head -1 | tr -d '\n\\r'`\nnova boot --flavor m1.tiny --image cirros-0.3.0-x86_64 --security_group default \n--nic net-id=$id1 --nic net-id=$id2 cirros\n\nRun nova list waiting for server to become active.  Once server is active, delete the server via the nova delete <id> operation.  Server will enter an undeleteable saying it is \"ACTIVE\".  It is important that both networks are connected when the delete operation is run, as for some reason one of the networks gets disconnected by some component (not sure which).\n\nFurther delete operations are either unsuccessful or block further ability to create instances with instances finishing in the ERROR state after creation.\n\nn-cpu backtraces with:\n2013-10-06 18:03:11.269 ERROR nova.openstack.common.rpc.amqp [req-4f7cf630-d1eb-4fcd-af22-c11fa77fd3dd admin admin] Exception during message handling\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 353, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 90, in wrapped\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/exception.py\", line 73, in wrapped\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 243, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     pass\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 229, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 294, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 258, in decorated_function\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:03:11.269 TRACE nova.openstack.common.rpc.amqp   File 2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 294, in decorated_function\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 271, in decorated_function\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 258, in decorated_function\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1793, in terminate_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     do_terminate_instance(instance, bdms)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1785, in do_terminate_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     reservations=reservations)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/hooks.py\", line 105, in inner\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     rv = f(*args, **kwargs)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1758, in _delete_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     user_id=user_id)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1730, in _delete_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     self._shutdown_instance(context, db_inst, bdms)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 1640, in _shutdown_instance\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     network_info = self._get_instance_nw_info(context, instance)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/manager.py\", line 877, in _get_instance_nw_info\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     instance)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 455, in get_instance_nw_info\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     result = self._get_instance_nw_info(context, instance, networks)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 463, in _get_instance_nw_info\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     nw_info = self._build_network_info_model(context, instance, networks)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 1009, in _build_network_info_model\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     subnets)\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/network/neutronv2/api.py\", line 962, in _nw_info_build_network\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp     label=network_name,\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp UnboundLocalError: local variable 'network_name' referenced before assignment\n2013-10-06 18:13:02.653 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2013-10-07 01:14:32.467533+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdake"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/49976", 
            "date_created": "2013-10-07 01:33:13.299359+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Is this still valid, the patch was abandoned.", 
            "date_created": "2014-07-10 01:20:11.708290+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "Old incomplete bug. Please reopen if still an issue.", 
            "date_created": "2014-09-17 13:58:35.915313+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2014-09-17 13:58:21.959544+00:00"
}