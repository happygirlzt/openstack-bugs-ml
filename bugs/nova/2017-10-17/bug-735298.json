{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:34:38.522845+00:00", 
    "description": "after updating to bzr rev 802 i can't start nova-compute. fails with the following error.\n\ni'm using libvirt-0.8.8 (default configuration) with kvm.\n\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/bin/nova-compute\", line 48, in <module>\n(nova): TRACE:     service.serve()\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/service.py\", line 284, in serve\n(nova): TRACE:     x.start()\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/service.py\", line 96, in start\n(nova): TRACE:     self.manager.update_available_resource(ctxt)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 120, in _wrap\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 799, in update_available_resource\n(nova): TRACE:     return self.driver.update_available_resource(context, self.host)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 1078, in update_available_resource\n(nova): TRACE:     'cpu_info': self.get_cpu_info()}\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 991, in get_cpu_info\n(nova): TRACE:     + xml.serialize())\n(nova): TRACE: Invalid: Invalid xml. '<cpu>' must be 1,but 5\n(nova): TRACE: <?xml version=\"1.0\"?>\n(nova): TRACE: <capabilities>\n(nova): TRACE: \n(nova): TRACE:   <host>\n(nova): TRACE:     <uuid>00000000-0000-0000-0000-001d7d4bca3c</uuid>\n(nova): TRACE:     <cpu>\n(nova): TRACE:       <arch>x86_64</arch>\n(nova): TRACE:       <model>core2duo</model>\n(nova): TRACE:       <vendor>Intel</vendor>\n(nova): TRACE:       <topology sockets=\"1\" cores=\"4\" threads=\"1\"/>\n(nova): TRACE:       <feature name=\"lahf_lm\"/>\n(nova): TRACE:       <feature name=\"xtpr\"/>\n(nova): TRACE:       <feature name=\"cx16\"/>\n(nova): TRACE:       <feature name=\"tm2\"/>\n(nova): TRACE:       <feature name=\"est\"/>\n(nova): TRACE:       <feature name=\"vmx\"/>\n(nova): TRACE:       <feature name=\"ds_cpl\"/>\n(nova): TRACE:       <feature name=\"pbe\"/>\n(nova): TRACE:       <feature name=\"tm\"/>\n(nova): TRACE:       <feature name=\"ht\"/>\n(nova): TRACE:       <feature name=\"ss\"/>\n(nova): TRACE:       <feature name=\"acpi\"/>\n(nova): TRACE:       <feature name=\"ds\"/>\n(nova): TRACE:     </cpu>\n(nova): TRACE:     <migration_features>\n(nova): TRACE:       <live/>\n(nova): TRACE:       <uri_transports>\n(nova): TRACE:         <uri_transport>tcp</uri_transport>\n(nova): TRACE:       </uri_transports>\n(nova): TRACE:     </migration_features>\n(nova): TRACE:     <topology>\n(nova): TRACE:       <cells num=\"1\">\n(nova): TRACE:         <cell id=\"0\">\n(nova): TRACE:           <cpus num=\"4\">\n(nova): TRACE:             <cpu id=\"0\"/>\n(nova): TRACE:             <cpu id=\"1\"/>\n(nova): TRACE:             <cpu id=\"2\"/>\n(nova): TRACE:             <cpu id=\"3\"/>\n(nova): TRACE:           </cpus>\n(nova): TRACE:         </cell>\n(nova): TRACE:       </cells>\n(nova): TRACE:     </topology>\n(nova): TRACE:   </host>\n(nova): TRACE: \n(nova): TRACE:   <guest>\n(nova): TRACE:     <os_type>hvm</os_type>\n(nova): TRACE:     <arch name=\"i686\">\n(nova): TRACE:       <wordsize>32</wordsize>\n(nova): TRACE:       <emulator>/usr/bin/qemu-kvm</emulator>\n(nova): TRACE:       <machine>pc-0.12</machine>\n(nova): TRACE:       <machine canonical=\"pc-0.12\">pc</machine>\n(nova): TRACE:       <machine>pc-0.11</machine>\n(nova): TRACE:       <machine>pc-0.10</machine>\n(nova): TRACE:       <machine>isapc</machine>\n(nova): TRACE:       <machine>mac</machine>\n(nova): TRACE:       <domain type=\"qemu\">\n(nova): TRACE:       </domain>\n(nova): TRACE:       <domain type=\"kvm\">\n(nova): TRACE:         <emulator>/usr/bin/qemu-kvm</emulator>\n(nova): TRACE:       </domain>\n(nova): TRACE:     </arch>\n(nova): TRACE:     <features>\n(nova): TRACE:       <cpuselection/>\n(nova): TRACE:       <pae/>\n(nova): TRACE:       <nonpae/>\n(nova): TRACE:       <acpi default=\"on\" toggle=\"yes\"/>\n(nova): TRACE:       <apic default=\"on\" toggle=\"no\"/>\n(nova): TRACE:     </features>\n(nova): TRACE:   </guest>\n(nova): TRACE: \n(nova): TRACE:   <guest>\n(nova): TRACE:     <os_type>hvm</os_type>\n(nova): TRACE:     <arch name=\"x86_64\">\n(nova): TRACE:       <wordsize>64</wordsize>\n(nova): TRACE:       <emulator>/usr/bin/qemu-kvm</emulator>\n(nova): TRACE:       <machine>pc-0.12</machine>\n(nova): TRACE:       <machine canonical=\"pc-0.12\">pc</machine>\n(nova): TRACE:       <machine>pc-0.11</machine>\n(nova): TRACE:       <machine>pc-0.10</machine>\n(nova): TRACE:       <machine>isapc</machine>\n(nova): TRACE:       <machine>mac</machine>\n(nova): TRACE:       <domain type=\"qemu\">\n(nova): TRACE:       </domain>\n(nova): TRACE:       <domain type=\"kvm\">\n(nova): TRACE:         <emulator>/usr/bin/qemu-kvm</emulator>\n(nova): TRACE:       </domain>\n(nova): TRACE:     </arch>\n(nova): TRACE:     <features>\n(nova): TRACE:       <cpuselection/>\n(nova): TRACE:       <acpi default=\"on\" toggle=\"yes\"/>\n(nova): TRACE:       <apic default=\"on\" toggle=\"no\"/>\n(nova): TRACE:     </features>\n(nova): TRACE:   </guest>\n(nova): TRACE: \n(nova): TRACE: </capabilities>\n(nova): TRACE: \n(nova): TRACE:", 
    "tags": [], 
    "importance": "High", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/735298", 
    "owner": "https://api.launchpad.net/1.0/~berendt", 
    "id": 735298, 
    "index": 374, 
    "openned": "2011-03-15 07:03:17.834279+00:00", 
    "created": "2011-03-15 07:03:17.834279+00:00", 
    "title": "can't start nova-compute: Invalid: Invalid xml. '<cpu>' must be 1,but 5", 
    "comments": [
        {
            "content": "after updating to bzr rev 802 i can't start nova-compute. fails with the following error.\n\ni'm using libvirt-0.8.8 (default configuration) with kvm.\n\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/bin/nova-compute\", line 48, in <module>\n(nova): TRACE:     service.serve()\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/service.py\", line 284, in serve\n(nova): TRACE:     x.start()\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/service.py\", line 96, in start\n(nova): TRACE:     self.manager.update_available_resource(ctxt)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 120, in _wrap\n(nova): TRACE:     return f(*args, **kw)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 799, in update_available_resource\n(nova): TRACE:     return self.driver.update_available_resource(context, self.host)\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 1078, in update_available_resource\n(nova): TRACE:     'cpu_info': self.get_cpu_info()}\n(nova): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/virt/libvirt_conn.py\", line 991, in get_cpu_info\n(nova): TRACE:     + xml.serialize())\n(nova): TRACE: Invalid: Invalid xml. '<cpu>' must be 1,but 5\n(nova): TRACE: <?xml version=\"1.0\"?>\n(nova): TRACE: <capabilities>\n(nova): TRACE: \n(nova): TRACE:   <host>\n(nova): TRACE:     <uuid>00000000-0000-0000-0000-001d7d4bca3c</uuid>\n(nova): TRACE:     <cpu>\n(nova): TRACE:       <arch>x86_64</arch>\n(nova): TRACE:       <model>core2duo</model>\n(nova): TRACE:       <vendor>Intel</vendor>\n(nova): TRACE:       <topology sockets=\"1\" cores=\"4\" threads=\"1\"/>\n(nova): TRACE:       <feature name=\"lahf_lm\"/>\n(nova): TRACE:       <feature name=\"xtpr\"/>\n(nova): TRACE:       <feature name=\"cx16\"/>\n(nova): TRACE:       <feature name=\"tm2\"/>\n(nova): TRACE:       <feature name=\"est\"/>\n(nova): TRACE:       <feature name=\"vmx\"/>\n(nova): TRACE:       <feature name=\"ds_cpl\"/>\n(nova): TRACE:       <feature name=\"pbe\"/>\n(nova): TRACE:       <feature name=\"tm\"/>\n(nova): TRACE:       <feature name=\"ht\"/>\n(nova): TRACE:       <feature name=\"ss\"/>\n(nova): TRACE:       <feature name=\"acpi\"/>\n(nova): TRACE:       <feature name=\"ds\"/>\n(nova): TRACE:     </cpu>\n(nova): TRACE:     <migration_features>\n(nova): TRACE:       <live/>\n(nova): TRACE:       <uri_transports>\n(nova): TRACE:         <uri_transport>tcp</uri_transport>\n(nova): TRACE:       </uri_transports>\n(nova): TRACE:     </migration_features>\n(nova): TRACE:     <topology>\n(nova): TRACE:       <cells num=\"1\">\n(nova): TRACE:         <cell id=\"0\">\n(nova): TRACE:           <cpus num=\"4\">\n(nova): TRACE:             <cpu id=\"0\"/>\n(nova): TRACE:             <cpu id=\"1\"/>\n(nova): TRACE:             <cpu id=\"2\"/>\n(nova): TRACE:             <cpu id=\"3\"/>\n(nova): TRACE:           </cpus>\n(nova): TRACE:         </cell>\n(nova): TRACE:       </cells>\n(nova): TRACE:     </topology>\n(nova): TRACE:   </host>\n(nova): TRACE: \n(nova): TRACE:   <guest>\n(nova): TRACE:     <os_type>hvm</os_type>\n(nova): TRACE:     <arch name=\"i686\">\n(nova): TRACE:       <wordsize>32</wordsize>\n(nova): TRACE:       <emulator>/usr/bin/qemu-kvm</emulator>\n(nova): TRACE:       <machine>pc-0.12</machine>\n(nova): TRACE:       <machine canonical=\"pc-0.12\">pc</machine>\n(nova): TRACE:       <machine>pc-0.11</machine>\n(nova): TRACE:       <machine>pc-0.10</machine>\n(nova): TRACE:       <machine>isapc</machine>\n(nova): TRACE:       <machine>mac</machine>\n(nova): TRACE:       <domain type=\"qemu\">\n(nova): TRACE:       </domain>\n(nova): TRACE:       <domain type=\"kvm\">\n(nova): TRACE:         <emulator>/usr/bin/qemu-kvm</emulator>\n(nova): TRACE:       </domain>\n(nova): TRACE:     </arch>\n(nova): TRACE:     <features>\n(nova): TRACE:       <cpuselection/>\n(nova): TRACE:       <pae/>\n(nova): TRACE:       <nonpae/>\n(nova): TRACE:       <acpi default=\"on\" toggle=\"yes\"/>\n(nova): TRACE:       <apic default=\"on\" toggle=\"no\"/>\n(nova): TRACE:     </features>\n(nova): TRACE:   </guest>\n(nova): TRACE: \n(nova): TRACE:   <guest>\n(nova): TRACE:     <os_type>hvm</os_type>\n(nova): TRACE:     <arch name=\"x86_64\">\n(nova): TRACE:       <wordsize>64</wordsize>\n(nova): TRACE:       <emulator>/usr/bin/qemu-kvm</emulator>\n(nova): TRACE:       <machine>pc-0.12</machine>\n(nova): TRACE:       <machine canonical=\"pc-0.12\">pc</machine>\n(nova): TRACE:       <machine>pc-0.11</machine>\n(nova): TRACE:       <machine>pc-0.10</machine>\n(nova): TRACE:       <machine>isapc</machine>\n(nova): TRACE:       <machine>mac</machine>\n(nova): TRACE:       <domain type=\"qemu\">\n(nova): TRACE:       </domain>\n(nova): TRACE:       <domain type=\"kvm\">\n(nova): TRACE:         <emulator>/usr/bin/qemu-kvm</emulator>\n(nova): TRACE:       </domain>\n(nova): TRACE:     </arch>\n(nova): TRACE:     <features>\n(nova): TRACE:       <cpuselection/>\n(nova): TRACE:       <acpi default=\"on\" toggle=\"yes\"/>\n(nova): TRACE:       <apic default=\"on\" toggle=\"no\"/>\n(nova): TRACE:     </features>\n(nova): TRACE:   </guest>\n(nova): TRACE: \n(nova): TRACE: </capabilities>\n(nova): TRACE: \n(nova): TRACE:", 
            "date_created": "2011-03-15 07:03:17.834279+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "Looks like this is a case of bad XML parsing. IIRC, there was a note from Kei that elements like <element /> were not parsed correctly and that they needed to be in the long format <element>blah</element>. Looking at the output, it seems cpu is the only element that uses the short format of <cpu /> instead of <cpu></cpu>? Kei, what do you think?", 
            "date_created": "2011-03-15 16:05:50.161968+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "didnt expect cpu tag appears more than 1 in our hardware envrionments. I think this patch works.. can you try it?", 
            "date_created": "2011-03-16 04:21:18.157849+00:00", 
            "author": "https://api.launchpad.net/1.0/~masumotok"
        }, 
        {
            "content": "P.S. I created it based on rev 807.", 
            "date_created": "2011-03-16 04:22:47.949451+00:00", 
            "author": "https://api.launchpad.net/1.0/~masumotok"
        }, 
        {
            "content": "I had to correct the path for more XML object, see my attached branch. After adding the correct paths I can start nova-compute, again. The linked branch is working fine on a system with one installed cpu package (with 4 cores).\n\nI have not yet testet it on a system with more cpu packages, but here is the output of \"virsh capabilities\" of a system with 2 installed cpu packages. There is only one //host/cpu entry, so I think this patch should work for n (n>=1) cpu packages. I'll open a merge propsal for my linked branch.\n\n---snip---\n<capabilities>\n\n  <host>\n    <uuid>50596b67-071e-b211-9111-47b1dc6fb85c</uuid>\n    <cpu>\n      <arch>x86_64</arch>\n      <model>Opteron_G2</model>\n      <vendor>AMD</vendor>\n      <topology sockets='1' cores='2' threads='1'/>\n      <feature name='cr8legacy'/>\n      <feature name='extapic'/>\n      <feature name='cmp_legacy'/>\n      <feature name='3dnow'/>\n      <feature name='3dnowext'/>\n      <feature name='fxsr_opt'/>\n      <feature name='mmxext'/>\n      <feature name='ht'/>\n      <feature name='vme'/>\n    </cpu>\n    <migration_features>\n      <live/>\n      <uri_transports>\n        <uri_transport>tcp</uri_transport>\n      </uri_transports>\n    </migration_features>\n    <topology>\n      <cells num='2'>\n        <cell id='0'>\n          <cpus num='2'>\n            <cpu id='0'/>\n            <cpu id='2'/>\n          </cpus>\n        </cell>\n        <cell id='1'>\n          <cpus num='2'>\n            <cpu id='1'/>\n            <cpu id='3'/>\n          </cpus>\n        </cell>\n      </cells>\n    </topology>\n  </host>\n\n  <guest>\n    <os_type>hvm</os_type>\n    <arch name='i686'>\n      <wordsize>32</wordsize>\n      <emulator>/usr/bin/qemu-kvm</emulator>\n      <machine>pc-0.12</machine>\n      <machine canonical='pc-0.12'>pc</machine>\n      <machine>pc-0.11</machine>\n      <machine>pc-0.10</machine>\n      <machine>isapc</machine>\n      <machine>mac</machine>\n      <domain type='qemu'>\n      </domain>\n      <domain type='kvm'>\n        <emulator>/usr/bin/qemu-kvm</emulator>\n      </domain>\n    </arch>\n    <features>\n      <cpuselection/>\n      <pae/>\n      <nonpae/>\n      <acpi default='on' toggle='yes'/>\n      <apic default='on' toggle='no'/>\n    </features>\n  </guest>\n\n  <guest>\n    <os_type>hvm</os_type>\n    <arch name='x86_64'>\n      <wordsize>64</wordsize>\n      <emulator>/usr/bin/qemu-kvm</emulator>\n      <machine>pc-0.12</machine>\n      <machine canonical='pc-0.12'>pc</machine>\n      <machine>pc-0.11</machine>\n      <machine>pc-0.10</machine>\n      <machine>isapc</machine>\n      <machine>mac</machine>\n      <domain type='qemu'>\n      </domain>\n      <domain type='kvm'>\n        <emulator>/usr/bin/qemu-kvm</emulator>\n      </domain>\n    </arch>\n    <features>\n      <cpuselection/>\n      <acpi default='on' toggle='yes'/>\n      <apic default='on' toggle='no'/>\n    </features>\n  </guest>\n\n</capabilities>\n---snap---", 
            "date_created": "2011-03-16 10:08:44.024071+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "I checked your branch. and agree to your changes. thank you!", 
            "date_created": "2011-03-16 11:11:14.700931+00:00", 
            "author": "https://api.launchpad.net/1.0/~masumotok"
        }
    ], 
    "closed": "2011-04-15 08:34:36.937885+00:00"
}