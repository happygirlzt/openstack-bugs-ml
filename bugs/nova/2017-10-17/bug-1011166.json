{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:32:56.221087+00:00", 
    "description": "[root@camel-nova nova]# nova volume-attach toattach 17 /dev/vdd\n\n[root@camel-vdsa ~]# iscsiadm -m session\ntcp: [21] 10.35.97.20:3260,1 iqn.2010-10.org.openstack:volume-00000011\n[root@camel-vdsa ~]# iscsiadm -m session -u\nLogging out of session [sid: 21, target: iqn.2010-10.org.openstack:volume-00000011, portal: 10.35.97.20,3260]\nLogout of [sid: 21, target: iqn.2010-10.org.openstack:volume-00000011, portal: 10.35.97.20,3260] successful.\n\n[root@camel-nova nova]# nova volume-detach toattach 17\n\nCompute.log:\n2012-06-10 16:52:09 ERROR nova.rpc.amqp [req-691b5982-1882-4c5e-b8fc-3b3da26a0699 2f4edfa99cab42de92eacda360043116 7eed65dd55474b9e94cd412d9f66b406] Exception during message handling\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 153, in decorated_function\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     function(self, context, instance_uuid, *args, **kwargs)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 177, in decorated_function\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     sys.exc_info())\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 171, in decorated_function\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1770, in detach_volume\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     self._detach_volume(context, instance_ref, bdm)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1760, in _detach_volume\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     mp)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 582, in detach_volume\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     mount_device)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 524, in volume_driver_method\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     return method(connection_info, *args, **kwargs)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 946, in inner\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     retval = f(*args, **kwargs)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/volume.py\", line 206, in disconnect_volume\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     check_exit_code=[0, 255])\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/volume.py\", line 110, in _run_iscsiadm\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     check_exit_code=check_exit_code)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n2012-06-10 16:52:09 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Command: sudo nova-rootwrap iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000011 -p 10.35.97.20:3260 --logout\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Exit code: 21\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Stdout: ''\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Stderr: 'iscsiadm: No matching sessions found\\n'\n2012-06-10 16:52:09 TRACE nova.rpc.amqp \n\n[root@camel-nova nova]# nova volume-list\n+----+-----------+-------------------+------+-------------+--------------------------------------+\n| ID |   Status  |    Display Name   | Size | Volume Type |             Attached to              |\n| 17 | in-use    | a                 | 1    | None        | 704340ab-4c9a-42e1-b676-fb33ae624adf |\n\n[root@camel-nova nova]# nova delete toattach\n[same error in compute log]\n2012-06-10 16:54:52 TRACE nova.rpc.amqp Command: sudo nova-rootwrap iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000011 -p 10.35.97.20:3260 --logout\n2012-06-10 16:54:52 TRACE nova.rpc.amqp Exit code: 21\n2012-06-10 16:54:52 TRACE nova.rpc.amqp Stdout: ''\n2012-06-10 16:54:52 TRACE nova.rpc.amqp Stderr: 'iscsiadm: No matching sessions found\\n'\n\n[root@camel-nova nova]# nova list\n+--------------------------------------+----------+---------+----------------------+\n|                  ID                  |   Name   |  Status |       Networks       |\n+--------------------------------------+----------+---------+----------------------+\n| 704340ab-4c9a-42e1-b676-fb33ae624adf | toattach | ACTIVE  | davidnet=192.168.1.4 |\n+--------------------------------------+----------+---------+----------------------+", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1011166", 
    "owner": "https://api.launchpad.net/1.0/~zulcss", 
    "id": 1011166, 
    "index": 4142, 
    "openned": "2012-06-10 13:56:56.250150+00:00", 
    "created": "2012-06-10 13:56:56.250150+00:00", 
    "title": "[Nova-volume][tgtd] Failed to detach volume / delete instance when target is already disconnected", 
    "comments": [
        {
            "content": "[root@camel-nova nova]# nova volume-attach toattach 17 /dev/vdd\n\n[root@camel-vdsa ~]# iscsiadm -m session\ntcp: [21] 10.35.97.20:3260,1 iqn.2010-10.org.openstack:volume-00000011\n[root@camel-vdsa ~]# iscsiadm -m session -u\nLogging out of session [sid: 21, target: iqn.2010-10.org.openstack:volume-00000011, portal: 10.35.97.20,3260]\nLogout of [sid: 21, target: iqn.2010-10.org.openstack:volume-00000011, portal: 10.35.97.20,3260] successful.\n\n[root@camel-nova nova]# nova volume-detach toattach 17\n\nCompute.log:\n2012-06-10 16:52:09 ERROR nova.rpc.amqp [req-691b5982-1882-4c5e-b8fc-3b3da26a0699 2f4edfa99cab42de92eacda360043116 7eed65dd55474b9e94cd412d9f66b406] Exception during message handling\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 153, in decorated_function\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     function(self, context, instance_uuid, *args, **kwargs)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 177, in decorated_function\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     sys.exc_info())\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     self.gen.next()\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 171, in decorated_function\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1770, in detach_volume\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     self._detach_volume(context, instance_ref, bdm)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1760, in _detach_volume\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     mp)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 582, in detach_volume\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     mount_device)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 524, in volume_driver_method\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     return method(connection_info, *args, **kwargs)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 946, in inner\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     retval = f(*args, **kwargs)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/volume.py\", line 206, in disconnect_volume\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     check_exit_code=[0, 255])\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/volume.py\", line 110, in _run_iscsiadm\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     check_exit_code=check_exit_code)\n2012-06-10 16:52:09 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n2012-06-10 16:52:09 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n2012-06-10 16:52:09 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Command: sudo nova-rootwrap iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000011 -p 10.35.97.20:3260 --logout\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Exit code: 21\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Stdout: ''\n2012-06-10 16:52:09 TRACE nova.rpc.amqp Stderr: 'iscsiadm: No matching sessions found\\n'\n2012-06-10 16:52:09 TRACE nova.rpc.amqp \n\n[root@camel-nova nova]# nova volume-list\n+----+-----------+-------------------+------+-------------+--------------------------------------+\n| ID |   Status  |    Display Name   | Size | Volume Type |             Attached to              |\n| 17 | in-use    | a                 | 1    | None        | 704340ab-4c9a-42e1-b676-fb33ae624adf |\n\n[root@camel-nova nova]# nova delete toattach\n[same error in compute log]\n2012-06-10 16:54:52 TRACE nova.rpc.amqp Command: sudo nova-rootwrap iscsiadm -m node -T iqn.2010-10.org.openstack:volume-00000011 -p 10.35.97.20:3260 --logout\n2012-06-10 16:54:52 TRACE nova.rpc.amqp Exit code: 21\n2012-06-10 16:54:52 TRACE nova.rpc.amqp Stdout: ''\n2012-06-10 16:54:52 TRACE nova.rpc.amqp Stderr: 'iscsiadm: No matching sessions found\\n'\n\n[root@camel-nova nova]# nova list\n+--------------------------------------+----------+---------+----------------------+\n|                  ID                  |   Name   |  Status |       Networks       |\n+--------------------------------------+----------+---------+----------------------+\n| 704340ab-4c9a-42e1-b676-fb33ae624adf | toattach | ACTIVE  | davidnet=192.168.1.4 |\n+--------------------------------------+----------+---------+----------------------+", 
            "date_created": "2012-06-10 13:56:56.250150+00:00", 
            "author": "https://api.launchpad.net/1.0/~davidnaori3"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/11930\nCommitted: http://github.com/openstack/nova/commit/9135f836151df4bc32e3c3fea208e3cee6f7d6dc\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9135f836151df4bc32e3c3fea208e3cee6f7d6dc\nAuthor: Chuck Short <email address hidden>\nDate:   Fri Aug 24 10:48:09 2012 -0500\n\n    Trap iscsiadm error\n    \n    If the iscsitarget was previously deleted and the user tries\n    to delete the iscsi target again, then you get a nasty traceback\n    in the logfiles.\n    \n    According to the iscsiadm man page, iscsiadm returns an error 21,\n    ISCSI_ERR_NO_OBJS_FOUND if there is no records/targets/sessions/portals\n    found to execute the operation on.\n    \n    LP: #1011166\n    \n    Change-Id: I3087c1a114fe91bd7361d92688d4f926bc3f8951\n    Signed-off-by: Chuck Short <email address hidden>\n", 
            "date_created": "2012-08-24 21:47:51.305302+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-09-19 06:41:04.343434+00:00"
}