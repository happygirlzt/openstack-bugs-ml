{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:54:37.348918+00:00", 
    "description": "This was running Tempest against the latest essex devstack on libvirt/kvm/precise. It is not entirely reproducible but kind of. Running the latest tempest tests ends up failing, usually in the floating ips test,  and can no longer create new vms so the rest of the tests fail. Attempts to create new instances end up in the error state. There are these tracebacks in the logs.\n\nTempest transcript:\n\n$ TEMPEST_CONFIG=tempest.essex.conf nosetests -vx tempest\nAll public and private addresses for ... ok\nProviding a network type should filter ... ok\nList addresses by network should fail if network name not valid ... ok\nList addresses request should fail if server id not in system ... ok\nList of all extensions ... ok\nThe expected flavor details should be returned ... ok\nflavor details are not returned for non existant flavors ... ok\nList of all flavors should contain the expected flavor ... ok\nThe detailed list of flavors should be filtered by disk space ... ok\nThe detailed list of flavors should be filtered by RAM ... ok\nOnly the expected number of flavors (detailed) should be returned ... ok\nThe list of flavors should start from the provided marker ... /usr/lib/python2.6/site-packages/unittest2-0.5.1-py2.6.egg/unittest2/case.py:349: DeprecationWarning: Use of a TestResult without an addExpectedFailure method is deprecated\n  DeprecationWarning)\nok\nThe list of flavors should be filtered by disk space ... ok\nThe list of flavors should be filtered by RAM ... ok\nOnly the expected number of flavors should be returned ... ok\nThe list of flavors should start from the provided marker ... ok\nDetailed list of all flavors should contain the expected flavor ... ok\nPositive test:Allocation of a new floating IP to a project ... ok\nPositive test:Associate the provided floating IP to a specific server ... ok\nNegative test:Association of a non existant floating IP ... ok\nPositive test:Deletion of valid floating IP from project ... ok\nNegative test:Deletion of a nonexistant floating IP ... ok\nPositive test:Dissociate the provided floating IP ... ok\nNegative test:Dissociation of a non existant floating IP should fail ... ok\nThe metadata value/key pair should be deleted from the image ... ok\nNegative test: Shouldnt be able to delete metadata ... ok\nThe value for a specific metadata key should be returned ... ok\nNegative test: Get on nonexistant image should not happen ... ok\nAll metadata key/value pairs for an image should be returned ... ok\nNegative test: List on nonexistant image ... ok\nThe metadata for the image should match the new values ... ok\nThe value provided for the given meta item should be set for the image ... ok\nNegative test: Metadata should not be set to a nonexistant image ... ok\nNegative test: Metadata item should not be set to a ... ok\nThe metadata for the image should match the updated values ... ok\nNegative test:An update should not happen for a nonexistant image ... ok\nAn image for the provided server should be created ... ok\nAn image should not be created if the server instance is removed ... ok\nKeypairs with duplicate names should not be created ... ok\nKeypairs with name being an empty string should not be created ... ok\nKeypairs with name longer than 255 chars should not be created ... ok\nKeypair should be created, verified and deleted ... ok\nKeypair should not be created with a non RSA public key ... ok\nKeypair should be created with a given public key ... ok\nNon-existant key deletion should throw a proper error ... ok\nKeypairs created should be available in the response list ... ok\nPositive test:Should be able to GET the details of floatingIP ... ok\nNegative test:Should not be able to GET the details ... SKIP: Skipping until Nova Bug 940500 is fixed\nPositive test:Should return the list of floating IPs ... ok\nERROR\n\n======================================================================\nERROR: test suite for <class 'tempest.tests.test_list_images.ListImagesTest'>\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/usr/lib/python2.6/site-packages/nose-1.1.2-py2.6.egg/nose/suite.py\", line 208, in run\n    self.setUp()\n  File \"/usr/lib/python2.6/site-packages/nose-1.1.2-py2.6.egg/nose/suite.py\", line 291, in setUp\n    self.setupContext(ancestor)\n  File \"/usr/lib/python2.6/site-packages/nose-1.1.2-py2.6.egg/nose/suite.py\", line 314, in setupContext\n    try_run(context, names)\n  File \"/usr/lib/python2.6/site-packages/nose-1.1.2-py2.6.egg/nose/util.py\", line 478, in try_run\n    return func()\n  File \"/cygdrive/c/source/tempest/tempest/tests/test_list_images.py\", line 34, in setUpClass\n    cls.servers_client.wait_for_server_status(cls.server1['id'], 'ACTIVE')\n  File \"/cygdrive/c/source/tempest/tempest/services/nova/json/servers_client.py\", line 147, in wait_for_server_status\n    raise exceptions.BuildErrorException(server_id=server_id)\nBuildErrorException: Server cf256252-528c-4d69-a4a5-e6889bccf380 failed to build and is in ERROR status\n\n----------------------------------------------------------------------\nRan 49 tests in 319.152s\n\n\nFrom nova-compute log:\n(nova.rpc.common): TRACE:     channel, method_sig, args, content = read_timeout(timeout)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/dist-packages/kombu/transport/pyamqplib.py\", line 94, in read_timeout\n(nova.rpc.common): TRACE:     return self.method_reader.read_method()\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/dist-packages/amqplib/client_0_8/method_framing.py\", line 221, in read_method\n(nova.rpc.common): TRACE:     raise m\n(nova.rpc.common): TRACE: timeout: timed out\n(nova.rpc.common): TRACE:\n2012-03-15 14:57:24 ERROR nova.compute.manager [-] [instance: 2b8b0ddf-7850-4319-b151-10ff7d482287] Instance failed network setup\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.compute.manager): TRACE:     requested_networks=requested_networks)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.compute.manager): TRACE:     'args': args})\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/__init__.py\", line 68, in call\n(nova.compute.manager): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.compute.manager): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 338, in call\n(nova.compute.manager): TRACE:     rv = list(rv)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 299, in __iter__\n(nova.compute.manager): TRACE:     self._iterator.next()\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 572, in iterconsume\n(nova.compute.manager): TRACE:     yield self.ensure(_error_callback, _consume)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 503, in ensure\n(nova.compute.manager): TRACE:     error_callback(e)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 553, in _error_callback\n(nova.compute.manager): TRACE:     raise rpc_common.Timeout()\n(nova.compute.manager): TRACE: Timeout: Timeout while waiting on RPC response.\n(nova.compute.manager): TRACE:\n2012-03-15 14:57:24 ERROR nova.rpc.amqp [-] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 648, in run_instance\n(nova.rpc.amqp): TRACE:     self._run_instance(context, instance_uuid, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 451, in _run_instance\n(nova.rpc.amqp): TRACE:     self._set_instance_error_state(context, instance_uuid)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 424, in _run_instance\n(nova.rpc.amqp): TRACE:     requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.rpc.amqp): TRACE:     requested_networks=requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     'args': args})\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/__init__.py\", line 68, in call\n(nova.rpc.amqp): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.rpc.amqp): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 338, in call\n(nova.rpc.amqp): TRACE:     rv = list(rv)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 299, in __iter__\n(nova.rpc.amqp): TRACE:     self._iterator.next()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 572, in iterconsume\n(nova.rpc.amqp): TRACE:     yield self.ensure(_error_callback, _consume)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 503, in ensure\n(nova.rpc.amqp): TRACE:     error_callback(e)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 553, in _error_callback\n(nova.rpc.amqp): TRACE:     raise rpc_common.Timeout()\n(nova.rpc.amqp): TRACE: Timeout: Timeout while waiting on RPC response.\n(nova.rpc.amqp): TRACE:\n2012-03-15 14:57:51 DEBUG nova.manager [-] Running periodic task ComputeManager._publish_service_capabilities from (pid=3883) periodic_tasks /opt/stack/nova/nova/manager.py:152\n2012-03-15 14:57:51 DEBUG nova.manager [-] Notifying Schedulers of capabilities ... from (pid=3883) _publish_service_capabilities /opt/stack/nova/nova/manager.py:203\n2012-03-15 14:57:51 DEBUG nova.rpc.amqp [-] Making asynchronous fanout cast... from (pid=3883) fanout_cast /opt/stack/nova/nova/rpc/amqp.py:354\n2012-03-15 14:57:51 DEBUG nova.manager [-] Running periodic task ComputeManager._poll_rescued_instances from (pid=3883) periodic_tasks /opt/stack/nova/nova/manager.py:152\n2012-03-15 14:57:51 DEBUG nova.manager [-] Skipping ComputeManager._sync_power_states, 5 ticks left until next run from (pid=3883) periodic_tasks /opt/stack/nova/nova/manager.py:147\n2012-03-15 14:57:51 DEBUG nova.manager [-] Running periodic task ComputeManager._poll_bandwidth_usage from (pid=3883) periodic_tasks /opt/stack/nova/nova/manager\n\n\nFrom nova-network log:\nnova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 258, in wrapped\n(nova.rpc.amqp): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 313, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 258, in wrapped\n(nova.rpc.amqp): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 899, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     requested_networks=requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 214, in _allocate_fixed_ips\n(nova.rpc.amqp): TRACE:     vpn=vpn, address=address)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 1190, in allocate_fixed_ip\n(nova.rpc.amqp): TRACE:     self._setup_network_on_host(context, network)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 1663, in _setup_network_on_host\n(nova.rpc.amqp): TRACE:     self.l3driver.initialize_gateway(network)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/l3.py\", line 98, in initialize_gateway\n(nova.rpc.amqp): TRACE:     gateway=(network_ref['gateway'] is not None))\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/linux_net.py\", line 921, in plug\n(nova.rpc.amqp): TRACE:     return _get_interface_driver().plug(network, mac_address, gateway)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/linux_net.py\", line 969, in plug\n(nova.rpc.amqp): TRACE:     iptables_manager.apply()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/utils.py\", line 901, in inner\n(nova.rpc.amqp): TRACE:     retval = f(*args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 230, in __exit__\n(nova.rpc.amqp): TRACE:     self.release()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 273, in release\n(nova.rpc.amqp): TRACE:     raise NotMyLock\n(nova.rpc.amqp): TRACE: NotMyLock\n(nova.rpc.amqp): TRACE:\n2012-03-15 14:56:25 ERROR nova.rpc.amqp [-] Returning exception  to caller\n2012-03-15 14:56:25 ERROR nova.rpc.amqp [-] ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 313, in allocate_for_instance\\n    **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 899, in allocate_for_instance\\n    requested_networks=requested_networks)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 214, in _allocate_fixed_ips\\n    vpn=vpn, address=address)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1190, in allocate_fixed_ip\\n    self._setup_network_on_host(context, network)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1663, in _setup_network_on_host\\n    self.l3driver.initialize_gateway(network)\\n', '  File \"/opt/stack/nova/nova/network/l3.py\", line 98, in initialize_gateway\\n    gateway=(network_ref[\\'gateway\\'] is not None))\\n', '  File \"/opt/stack/nova/nova/network/linux_net.py\", line 921, in plug\\n    return _get_interface_driver().plug(network, mac_address, gateway)\\n', '  File \"/opt/stack/nova/nova/network/linux_net.py\", line 969, in plug\\n    iptables_manager.apply()\\n', '  File \"/opt/stack/nova/nova/utils.py\", line 901, in inner\\n    retval = f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 230, in __exit__\\n    self.release()\\n', '  File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 273, in release\\n    raise NotMyLock\\n', 'NotMyLock\\n']\n2012-03-15 14:56:25 DEBUG nova.utils [-] Got semaphore \"iptables\" for method \"apply\"... from (pid=4342) inner /opt/stack/nova/nova/utils.py:", 
    "tags": [], 
    "importance": "High", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/956313", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 956313, 
    "index": 631, 
    "openned": "2012-03-15 19:05:01.498315+00:00", 
    "created": "2012-03-15 19:05:01.498315+00:00", 
    "title": "Nova loses ability to build instances", 
    "comments": [
        {
            "content": "This was running Tempest against the latest essex devstack on libvirt/kvm/precise. It is not entirely reproducible but kind of. Running the latest tempest tests ends up failing, usually in the floating ips test,  and can no longer create new vms so the rest of the tests fail. Attempts to create new instances end up in the error state. There are these tracebacks in the logs.\n\nTempest transcript:\n\n$ TEMPEST_CONFIG=tempest.essex.conf nosetests -vx tempest\nAll public and private addresses for ... ok\nProviding a network type should filter ... ok\nList addresses by network should fail if network name not valid ... ok\nList addresses request should fail if server id not in system ... ok\nList of all extensions ... ok\nThe expected flavor details should be returned ... ok\nflavor details are not returned for non existant flavors ... ok\nList of all flavors should contain the expected flavor ... ok\nThe detailed list of flavors should be filtered by disk space ... ok\nThe detailed list of flavors should be filtered by RAM ... ok\nOnly the expected number of flavors (detailed) should be returned ... ok\nThe list of flavors should start from the provided marker ... /usr/lib/python2.6/site-packages/unittest2-0.5.1-py2.6.egg/unittest2/case.py:349: DeprecationWarning: Use of a TestResult without an addExpectedFailure method is deprecated\n  DeprecationWarning)\nok\nThe list of flavors should be filtered by disk space ... ok\nThe list of flavors should be filtered by RAM ... ok\nOnly the expected number of flavors should be returned ... ok\nThe list of flavors should start from the provided marker ... ok\nDetailed list of all flavors should contain the expected flavor ... ok\nPositive test:Allocation of a new floating IP to a project ... ok\nPositive test:Associate the provided floating IP to a specific server ... ok\nNegative test:Association of a non existant floating IP ... ok\nPositive test:Deletion of valid floating IP from project ... ok\nNegative test:Deletion of a nonexistant floating IP ... ok\nPositive test:Dissociate the provided floating IP ... ok\nNegative test:Dissociation of a non existant floating IP should fail ... ok\nThe metadata value/key pair should be deleted from the image ... ok\nNegative test: Shouldnt be able to delete metadata ... ok\nThe value for a specific metadata key should be returned ... ok\nNegative test: Get on nonexistant image should not happen ... ok\nAll metadata key/value pairs for an image should be returned ... ok\nNegative test: List on nonexistant image ... ok\nThe metadata for the image should match the new values ... ok\nThe value provided for the given meta item should be set for the image ... ok\nNegative test: Metadata should not be set to a nonexistant image ... ok\nNegative test: Metadata item should not be set to a ... ok\nThe metadata for the image should match the updated values ... ok\nNegative test:An update should not happen for a nonexistant image ... ok\nAn image for the provided server should be created ... ok\nAn image should not be created if the server instance is removed ... ok\nKeypairs with duplicate names should not be created ... ok\nKeypairs with name being an empty string should not be created ... ok\nKeypairs with name longer than 255 chars should not be created ... ok\nKeypair should be created, verified and deleted ... ok\nKeypair should not be created with a non RSA public key ... ok\nKeypair should be created with a given public key ... ok\nNon-existant key deletion should throw a proper error ... ok\nKeypairs created should be available in the response list ... ok\nPositive test:Should be able to GET the details of floatingIP ... ok\nNegative test:Should not be able to GET the details ... SKIP: Skipping until Nova Bug 940500 is fixed\nPositive test:Should return the list of floating IPs ... ok\nERROR\n\n======================================================================\nERROR: test suite for <class 'tempest.tests.test_list_images.ListImagesTest'>\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/usr/lib/python2.6/site-packages/nose-1.1.2-py2.6.egg/nose/suite.py\", line 208, in run\n    self.setUp()\n  File \"/usr/lib/python2.6/site-packages/nose-1.1.2-py2.6.egg/nose/suite.py\", line 291, in setUp\n    self.setupContext(ancestor)\n  File \"/usr/lib/python2.6/site-packages/nose-1.1.2-py2.6.egg/nose/suite.py\", line 314, in setupContext\n    try_run(context, names)\n  File \"/usr/lib/python2.6/site-packages/nose-1.1.2-py2.6.egg/nose/util.py\", line 478, in try_run\n    return func()\n  File \"/cygdrive/c/source/tempest/tempest/tests/test_list_images.py\", line 34, in setUpClass\n    cls.servers_client.wait_for_server_status(cls.server1['id'], 'ACTIVE')\n  File \"/cygdrive/c/source/tempest/tempest/services/nova/json/servers_client.py\", line 147, in wait_for_server_status\n    raise exceptions.BuildErrorException(server_id=server_id)\nBuildErrorException: Server cf256252-528c-4d69-a4a5-e6889bccf380 failed to build and is in ERROR status\n\n----------------------------------------------------------------------\nRan 49 tests in 319.152s\n\n\nFrom nova-compute log:\n(nova.rpc.common): TRACE:     channel, method_sig, args, content = read_timeout(timeout)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/dist-packages/kombu/transport/pyamqplib.py\", line 94, in read_timeout\n(nova.rpc.common): TRACE:     return self.method_reader.read_method()\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/dist-packages/amqplib/client_0_8/method_framing.py\", line 221, in read_method\n(nova.rpc.common): TRACE:     raise m\n(nova.rpc.common): TRACE: timeout: timed out\n(nova.rpc.common): TRACE:\n2012-03-15 14:57:24 ERROR nova.compute.manager [-] [instance: 2b8b0ddf-7850-4319-b151-10ff7d482287] Instance failed network setup\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.compute.manager): TRACE:     requested_networks=requested_networks)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.compute.manager): TRACE:     'args': args})\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/__init__.py\", line 68, in call\n(nova.compute.manager): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.compute.manager): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 338, in call\n(nova.compute.manager): TRACE:     rv = list(rv)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 299, in __iter__\n(nova.compute.manager): TRACE:     self._iterator.next()\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 572, in iterconsume\n(nova.compute.manager): TRACE:     yield self.ensure(_error_callback, _consume)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 503, in ensure\n(nova.compute.manager): TRACE:     error_callback(e)\n(nova.compute.manager): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 553, in _error_callback\n(nova.compute.manager): TRACE:     raise rpc_common.Timeout()\n(nova.compute.manager): TRACE: Timeout: Timeout while waiting on RPC response.\n(nova.compute.manager): TRACE:\n2012-03-15 14:57:24 ERROR nova.rpc.amqp [-] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 648, in run_instance\n(nova.rpc.amqp): TRACE:     self._run_instance(context, instance_uuid, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 451, in _run_instance\n(nova.rpc.amqp): TRACE:     self._set_instance_error_state(context, instance_uuid)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 424, in _run_instance\n(nova.rpc.amqp): TRACE:     requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.rpc.amqp): TRACE:     requested_networks=requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     'args': args})\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/__init__.py\", line 68, in call\n(nova.rpc.amqp): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.rpc.amqp): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 338, in call\n(nova.rpc.amqp): TRACE:     rv = list(rv)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 299, in __iter__\n(nova.rpc.amqp): TRACE:     self._iterator.next()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 572, in iterconsume\n(nova.rpc.amqp): TRACE:     yield self.ensure(_error_callback, _consume)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 503, in ensure\n(nova.rpc.amqp): TRACE:     error_callback(e)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 553, in _error_callback\n(nova.rpc.amqp): TRACE:     raise rpc_common.Timeout()\n(nova.rpc.amqp): TRACE: Timeout: Timeout while waiting on RPC response.\n(nova.rpc.amqp): TRACE:\n2012-03-15 14:57:51 DEBUG nova.manager [-] Running periodic task ComputeManager._publish_service_capabilities from (pid=3883) periodic_tasks /opt/stack/nova/nova/manager.py:152\n2012-03-15 14:57:51 DEBUG nova.manager [-] Notifying Schedulers of capabilities ... from (pid=3883) _publish_service_capabilities /opt/stack/nova/nova/manager.py:203\n2012-03-15 14:57:51 DEBUG nova.rpc.amqp [-] Making asynchronous fanout cast... from (pid=3883) fanout_cast /opt/stack/nova/nova/rpc/amqp.py:354\n2012-03-15 14:57:51 DEBUG nova.manager [-] Running periodic task ComputeManager._poll_rescued_instances from (pid=3883) periodic_tasks /opt/stack/nova/nova/manager.py:152\n2012-03-15 14:57:51 DEBUG nova.manager [-] Skipping ComputeManager._sync_power_states, 5 ticks left until next run from (pid=3883) periodic_tasks /opt/stack/nova/nova/manager.py:147\n2012-03-15 14:57:51 DEBUG nova.manager [-] Running periodic task ComputeManager._poll_bandwidth_usage from (pid=3883) periodic_tasks /opt/stack/nova/nova/manager\n\n\nFrom nova-network log:\nnova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 258, in wrapped\n(nova.rpc.amqp): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 313, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 258, in wrapped\n(nova.rpc.amqp): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 899, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     requested_networks=requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 214, in _allocate_fixed_ips\n(nova.rpc.amqp): TRACE:     vpn=vpn, address=address)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 1190, in allocate_fixed_ip\n(nova.rpc.amqp): TRACE:     self._setup_network_on_host(context, network)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/manager.py\", line 1663, in _setup_network_on_host\n(nova.rpc.amqp): TRACE:     self.l3driver.initialize_gateway(network)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/l3.py\", line 98, in initialize_gateway\n(nova.rpc.amqp): TRACE:     gateway=(network_ref['gateway'] is not None))\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/linux_net.py\", line 921, in plug\n(nova.rpc.amqp): TRACE:     return _get_interface_driver().plug(network, mac_address, gateway)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/network/linux_net.py\", line 969, in plug\n(nova.rpc.amqp): TRACE:     iptables_manager.apply()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/utils.py\", line 901, in inner\n(nova.rpc.amqp): TRACE:     retval = f(*args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 230, in __exit__\n(nova.rpc.amqp): TRACE:     self.release()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 273, in release\n(nova.rpc.amqp): TRACE:     raise NotMyLock\n(nova.rpc.amqp): TRACE: NotMyLock\n(nova.rpc.amqp): TRACE:\n2012-03-15 14:56:25 ERROR nova.rpc.amqp [-] Returning exception  to caller\n2012-03-15 14:56:25 ERROR nova.rpc.amqp [-] ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 313, in allocate_for_instance\\n    **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 899, in allocate_for_instance\\n    requested_networks=requested_networks)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 214, in _allocate_fixed_ips\\n    vpn=vpn, address=address)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1190, in allocate_fixed_ip\\n    self._setup_network_on_host(context, network)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1663, in _setup_network_on_host\\n    self.l3driver.initialize_gateway(network)\\n', '  File \"/opt/stack/nova/nova/network/l3.py\", line 98, in initialize_gateway\\n    gateway=(network_ref[\\'gateway\\'] is not None))\\n', '  File \"/opt/stack/nova/nova/network/linux_net.py\", line 921, in plug\\n    return _get_interface_driver().plug(network, mac_address, gateway)\\n', '  File \"/opt/stack/nova/nova/network/linux_net.py\", line 969, in plug\\n    iptables_manager.apply()\\n', '  File \"/opt/stack/nova/nova/utils.py\", line 901, in inner\\n    retval = f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 230, in __exit__\\n    self.release()\\n', '  File \"/usr/lib/python2.7/dist-packages/lockfile.py\", line 273, in release\\n    raise NotMyLock\\n', 'NotMyLock\\n']\n2012-03-15 14:56:25 DEBUG nova.utils [-] Got semaphore \"iptables\" for method \"apply\"... from (pid=4342) inner /opt/stack/nova/nova/utils.py:", 
            "date_created": "2012-03-15 19:05:01.498315+00:00", 
            "author": "https://api.launchpad.net/1.0/~david-kranz"
        }, 
        {
            "content": "After restarting nova-compute, I'm having the same error:\n\n\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 648, in run_instance\n(nova.rpc.amqp): TRACE:     self._run_instance(context, instance_uuid, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 451, in _run_instance\n(nova.rpc.amqp): TRACE:     self._set_instance_error_state(context, instance_uuid)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 424, in _run_instance\n(nova.rpc.amqp): TRACE:     requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 559, in _allocate_network\n(nova.rpc.amqp): TRACE:     requested_networks=requested_networks)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/api.py\", line 170, in allocate_for_instance\n(nova.rpc.amqp): TRACE:     'args': args})\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/__init__.py\", line 68, in call\n(nova.rpc.amqp): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/impl_kombu.py\", line 674, in call\n(nova.rpc.amqp): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 338, in call\n(nova.rpc.amqp): TRACE:     rv = list(rv)\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 306, in __iter__\n(nova.rpc.amqp): TRACE:     raise result\n(nova.rpc.amqp): TRACE: RemoteError: Remote error: NotMyLock \n", 
            "date_created": "2012-03-15 20:07:01.230959+00:00", 
            "author": "https://api.launchpad.net/1.0/~patrick-hetu"
        }, 
        {
            "content": "I'm running into the same issue.  With nova-compute on one node, and nova-network on a different one.  Exact same log entries.", 
            "date_created": "2012-03-15 20:27:29.630155+00:00", 
            "author": "https://api.launchpad.net/1.0/~trhoden"
        }, 
        {
            "content": "Something is removing the lock file early.   If the lock file was removed out from under whoever locked it... then NotMyLock is raised.\n\nInteresting.", 
            "date_created": "2012-03-15 20:28:38.898704+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "Ok found out why this is raising.  Python-lockfile does not support multiple filelocks for the same thread:\n\nhttp://bugs.debian.org/cgi-bin/bugreport.cgi?bug=632857", 
            "date_created": "2012-03-16 16:26:08.392738+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/5462", 
            "date_created": "2012-03-16 20:41:15.805185+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/5462\nCommitted: http://github.com/openstack/nova/commit/eb42e7fcd7bb67ab951c9bc6c80a78cd23011458\nSubmitter: Jenkins\nBranch:    master\n\ncommit eb42e7fcd7bb67ab951c9bc6c80a78cd23011458\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Fri Mar 16 13:25:05 2012 -0700\n\n    Workaround issue with greenthreads and lockfiles\n    \n     * Adds a GreenLockFile that always works in greenthreads\n     * Adds test to verify that regular Lockfile is broken\n     * Adds test to verify that GreenLockfile works\n     * Adds note about limitation of external locks\n     * Adds test showing limitation of nested locks\n     * Fixes bug 956313\n    \n    Change-Id: I11cd1206611aa4862dadd2fcc077c4c2e0f798f6\n", 
            "date_created": "2012-03-16 21:19:04.115488+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-03-20 08:42:31.337330+00:00"
}