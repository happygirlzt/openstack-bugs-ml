{
    "status": "Invalid", 
    "last_updated": "2013-06-26 15:24:21.530242+00:00", 
    "description": "Running exercise.sh, I experience the following:\n\n+ timeout 1000 sh -c 'while ! euca-describe-volumes vol-00000001 | grep -q available; do sleep 1; done'\n\n+ euca-attach-volume -i i-00000001 -d /dev/vdc vol-00000001\nVOLUME\tvol-00000001\n+ timeout 500 sh -c 'while ! euca-describe-volumes vol-00000001 | grep -A 1 in-use | grep -q attach; do sleep 1; done'\n\n+ die 100 'Could not attach vol-00000001 to i-00000001'\n+ local exitcode=0\n+ set +o xtrace\n[ERROR] /opt/stack/devstack/exercises/euca.sh:100 Could not attach vol-00000001 to i-00000001\n\nIn the compute logs, the following lines grabbed my attention:\n\nFailed to attach volume ca6e35e2-7056-42b8-a4d4-546cc1a8c998 at /dev/xvdc\nTraceback (most recent call last):\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 3091, in _attach_volume\n\u00a0\u00a0\u00a0\u00a0mountpoint)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 367, in attach_volume\n\u00a0\u00a0\u00a0\u00a0mountpoint)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/volumeops.py\", line 58, in attach_volume\n\u00a0\u00a0\u00a0\u00a0hotplug=hotplug)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/volumeops.py\", line 96, in _connect_volume\n\u00a0\u00a0\u00a0\u00a0self._session, sr_uuid, sr_label, sr_params)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/volume_utils.py\", line 74, in introduce_sr\n\u00a0\u00a0\u00a0\u00a0session.call_xenapi(\"SR.scan\", sr_ref)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 725, in call_xenapi\n\u00a0\u00a0\u00a0\u00a0return session.xenapi_request(method, args)\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 133, in xenapi_request\n\u00a0\u00a0\u00a0\u00a0result = _parse_result(getattr(self, methodname)(*full_params))\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 203, in _parse_result\n\u00a0\u00a0\u00a0\u00a0raise Failure(result['ErrorDescription'])\nFailure: ['SR_BACKEND_FAILURE_40', '', 'The SR scan failed  [opterr=[\\'INTERNAL_ERROR\\', \\'Db_exn.Uniqueness_constraint_violation(\"VDI\", \"uuid\", \"bab415f3-62da-8bae-b80e-d3ce45a1ca5c\")\\']]', '']\n\n...\n\n[req-286ae122-06e4-4dfc-9e91-4416e37689b1 demo demo] Exception during message handling\nTraceback (most recent call last):\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 433, in _process_data\n\u00a0\u00a0\u00a0\u00a0**args)\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n\u00a0\u00a0\u00a0\u00a0result = getattr(proxyobj, method)(ctxt, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/exception.py\", line 99, in wrapped\n\u00a0\u00a0\u00a0\u00a0temp_level, payload)\n\u00a0\u00a0File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/opt/stack/nova/nova/exception.py\", line 76, in wrapped\n\u00a0\u00a0\u00a0\u00a0return f(self, context, *args, **kw)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 215, in decorated_function\n\u00a0\u00a0\u00a0\u00a0pass\n\u00a0\u00a0File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 201, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 243, in decorated_function\n\u00a0\u00a0\u00a0\u00a0e, sys.exc_info())\n\u00a0\u00a0File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 230, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 3064, in attach_volume\n\u00a0\u00a0\u00a0\u00a0context, instance, mountpoint)\n\u00a0\u00a0File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 3059, in attach_volume\n\u00a0\u00a0\u00a0\u00a0mountpoint, instance)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 3101, in _attach_volume\n\u00a0\u00a0\u00a0\u00a0connector)\n\u00a0\u00a0File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 3091, in _attach_volume\n\u00a0\u00a0\u00a0\u00a0mountpoint)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 367, in attach_volume\n\u00a0\u00a0\u00a0\u00a0mountpoint)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/volumeops.py\", line 58, in attach_volume\n\u00a0\u00a0\u00a0\u00a0hotplug=hotplug)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/volumeops.py\", line 96, in _connect_volume\n\u00a0\u00a0\u00a0\u00a0self._session, sr_uuid, sr_label, sr_params)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/volume_utils.py\", line 74, in introduce_sr\n\u00a0\u00a0\u00a0\u00a0session.call_xenapi(\"SR.scan\", sr_ref)\n\u00a0\u00a0File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 725, in call_xenapi\n\u00a0\u00a0\u00a0\u00a0return session.xenapi_request(method, args)\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 133, in xenapi_request\n\u00a0\u00a0\u00a0\u00a0result = _parse_result(getattr(self, methodname)(*full_params))\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 203, in _parse_result\n\u00a0\u00a0\u00a0\u00a0raise Failure(result['ErrorDescription'])\nFailure: ['SR_BACKEND_FAILURE_40', '', 'The SR scan failed  [opterr=[\\'INTERNAL_ERROR\\', \\'Db_exn.Uniqueness_constraint_violation(\"VDI\", \"uuid\", \"bab415f3-62da-8bae-b80e-d3ce45a1ca5c\")\\']]', '']\n\nAlso interesting, but not sure if it's related:\n\n2013-06-26 14:02:34.851 DEBUG nova.virt.xenapi.volumeops [req-286ae122-06e4-4dfc-9e91-4416e37689b1 demo demo] Attach_volume: {u'driver_volume_type': u'iscsi', 'serial': u'ca6e35e2-7056-42b8-a4d4-546cc1a8c998',\n\u00a0u'data': {u'target_discovered': False, u'target_iqn': u'iqn.2010-10.org.openstack:volume-ca6e35e2-7056-42b8-a4d4-546cc1a8c998', u'target_portal': u'10.219.3.143:3260', u'volume_id': u'ca6e35e2-7056-42b8-a4d4-\n546cc1a8c998', u'target_lun': 1, u'auth_password': u'KErojkWaXXJLGRrk9mBM', u'auth_username': u'boAtvqyJyX5i2DkdccDG', u'auth_method': u'CHAP'}}, instance-00000001,\" /dev/xvdc from (pid=23955) attach_volume /o\npt/stack/nova/nova/virt/xenapi/volumeops.py:51\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/lib/python2.7/logging/__init__.py\", line 846, in emit\n\u00a0\u00a0\u00a0\u00a0msg = self.format(record)\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/log.py\", line 551, in format\n\u00a0\u00a0\u00a0\u00a0return logging.StreamHandler.format(self, record)\n\u00a0\u00a0File \"/usr/lib/python2.7/logging/__init__.py\", line 723, in format\n\u00a0\u00a0\u00a0\u00a0return fmt.format(record)\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/log.py\", line 515, in format\n\u00a0\u00a0\u00a0\u00a0return logging.Formatter.format(self, record)\n\u00a0\u00a0File \"/usr/lib/python2.7/logging/__init__.py\", line 464, in format\n\u00a0\u00a0\u00a0\u00a0record.message = record.getMessage()\n\u00a0\u00a0File \"/usr/lib/python2.7/logging/__init__.py\", line 328, in getMessage\n\u00a0\u00a0\u00a0\u00a0msg = msg % self.args\nTypeError: not enough arguments for format string\nLogged from file volume_utils.py, line 237", 
    "tags": [
        "xenserver"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1194903", 
    "owner": "https://api.launchpad.net/1.0/~mate-lakat", 
    "id": 1194903, 
    "index": 905, 
    "openned": "2013-06-26 14:44:10.957415+00:00", 
    "created": "2013-06-26 14:44:10.957415+00:00", 
    "title": "xenapi: euca attach volume fails", 
    "comments": [
        {
            "content": "Runnin exercise.sh, I experience the following:\n\n+ timeout 1000 sh -c 'while ! euca-describe-volumes vol-00000001 | grep -q available; do sleep 1; done'\n\n+ euca-attach-volume -i i-00000001 -d /dev/vdc vol-00000001\nVOLUME\tvol-00000001\n+ timeout 500 sh -c 'while ! euca-describe-volumes vol-00000001 | grep -A 1 in-use | grep -q attach; do sleep 1; done'\n\n+ die 100 'Could not attach vol-00000001 to i-00000001'\n+ local exitcode=0\n+ set +o xtrace\n[ERROR] /opt/stack/devstack/exercises/euca.sh:100 Could not attach vol-00000001 to i-00000001\n\nIn the compute logs, the following lines grabbed my attention:\n\nFailed to attach volume ca6e35e2-7056-42b8-a4d4-546cc1a8c998 at /dev/xvdc\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 3091, in _attach_volume\n    mountpoint)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 367, in attach_volume\n    mountpoint)\n  File \"/opt/stack/nova/nova/virt/xenapi/volumeops.py\", line 58, in attach_volume\n    hotplug=hotplug)\n  File \"/opt/stack/nova/nova/virt/xenapi/volumeops.py\", line 96, in _connect_volume\n    self._session, sr_uuid, sr_label, sr_params)\n  File \"/opt/stack/nova/nova/virt/xenapi/volume_utils.py\", line 74, in introduce_sr\n    session.call_xenapi(\"SR.scan\", sr_ref)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 725, in call_xenapi\n    return session.xenapi_request(method, args)\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 133, in xenapi_request\n    result = _parse_result(getattr(self, methodname)(*full_params))\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 203, in _parse_result\n    raise Failure(result['ErrorDescription'])\nFailure: ['SR_BACKEND_FAILURE_40', '', 'The SR scan failed  [opterr=[\\'INTERNAL_ERROR\\', \\'Db_exn.Uniqueness_constraint_violation(\"VDI\", \"uuid\", \"bab415f3-62da-8bae-b80e-d3ce45a1ca5c\")\\']]', '']\n\n...\n\n\n[req-286ae122-06e4-4dfc-9e91-4416e37689b1 demo demo] Exception during message handling\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 433, in _process_data\n    **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n    result = getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/exception.py\", line 99, in wrapped\n    temp_level, payload)\n  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/opt/stack/nova/nova/exception.py\", line 76, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 215, in decorated_function\n    pass\n  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 201, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 243, in decorated_function\n    e, sys.exc_info())\n  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 230, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 3064, in attach_volume\n    context, instance, mountpoint)\n  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 3059, in attach_volume\n    mountpoint, instance)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 3101, in _attach_volume\n    connector)\n  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n    self.gen.next()\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 3091, in _attach_volume\n    mountpoint)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 367, in attach_volume\n    mountpoint)\n  File \"/opt/stack/nova/nova/virt/xenapi/volumeops.py\", line 58, in attach_volume\n    hotplug=hotplug)\n  File \"/opt/stack/nova/nova/virt/xenapi/volumeops.py\", line 96, in _connect_volume\n    self._session, sr_uuid, sr_label, sr_params)\n  File \"/opt/stack/nova/nova/virt/xenapi/volume_utils.py\", line 74, in introduce_sr\n    session.call_xenapi(\"SR.scan\", sr_ref)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 725, in call_xenapi\n    return session.xenapi_request(method, args)\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 133, in xenapi_request\n    result = _parse_result(getattr(self, methodname)(*full_params))\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 203, in _parse_result\n    raise Failure(result['ErrorDescription'])\nFailure: ['SR_BACKEND_FAILURE_40', '', 'The SR scan failed  [opterr=[\\'INTERNAL_ERROR\\', \\'Db_exn.Uniqueness_constraint_violation(\"VDI\", \"uuid\", \"bab415f3-62da-8bae-b80e-d3ce45a1ca5c\")\\']]', '']\n\n\nAlso interesting, but not sure if it's related:\n\n2013-06-26 14:02:34.851 DEBUG nova.virt.xenapi.volumeops [req-286ae122-06e4-4dfc-9e91-4416e37689b1 demo demo] Attach_volume: {u'driver_volume_type': u'iscsi', 'serial': u'ca6e35e2-7056-42b8-a4d4-546cc1a8c998',\n u'data': {u'target_discovered': False, u'target_iqn': u'iqn.2010-10.org.openstack:volume-ca6e35e2-7056-42b8-a4d4-546cc1a8c998', u'target_portal': u'10.219.3.143:3260', u'volume_id': u'ca6e35e2-7056-42b8-a4d4-\n546cc1a8c998', u'target_lun': 1, u'auth_password': u'KErojkWaXXJLGRrk9mBM', u'auth_username': u'boAtvqyJyX5i2DkdccDG', u'auth_method': u'CHAP'}}, instance-00000001,\" /dev/xvdc from (pid=23955) attach_volume /o\npt/stack/nova/nova/virt/xenapi/volumeops.py:51\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/logging/__init__.py\", line 846, in emit\n    msg = self.format(record)\n  File \"/opt/stack/nova/nova/openstack/common/log.py\", line 551, in format\n    return logging.StreamHandler.format(self, record)\n  File \"/usr/lib/python2.7/logging/__init__.py\", line 723, in format\n    return fmt.format(record)\n  File \"/opt/stack/nova/nova/openstack/common/log.py\", line 515, in format\n    return logging.Formatter.format(self, record)\n  File \"/usr/lib/python2.7/logging/__init__.py\", line 464, in format\n    record.message = record.getMessage()\n  File \"/usr/lib/python2.7/logging/__init__.py\", line 328, in getMessage\n    msg = msg % self.args\nTypeError: not enough arguments for format string\nLogged from file volume_utils.py, line 237", 
            "date_created": "2013-06-26 14:44:10.957415+00:00", 
            "author": "https://api.launchpad.net/1.0/~mate-lakat"
        }, 
        {
            "content": "Doing a manual SR scan:\n\n[root@megadodo ~]# xe sr-scan uuid=FA15E-D15C-ca6e35e2-7056-42b8-a4d4-546cc1a8c998\nError code: SR_BACKEND_FAILURE_40\nError parameters: , The SR scan failed  [opterr=['INTERNAL_ERROR', 'Db_exn.Uniqueness_constraint_violation(\"VDI\", \"uuid\", \"bab415f3-62da-8bae-b80e-d3ce45a1ca5c\")']],\n\n[root@megadodo ~]# xe vdi-list uuid=bab415f3-62da-8bae-b80e-d3ce45a1ca5c\nuuid ( RO)                : bab415f3-62da-8bae-b80e-d3ce45a1ca5c\n          name-label ( RW): \n    name-description ( RW): \n             sr-uuid ( RO): FA15E-D15C-b1d592e9-e99c-4b4a-98dd-4796b39d6169\n        virtual-size ( RO): 1073741824\n            sharable ( RO): false\n           read-only ( RO): false\n\n[root@megadodo ~]# xe vbd-list vdi-uuid=bab415f3-62da-8bae-b80e-d3ce45a1ca5c\n\nSo it seems, that I already have a vdi with the very same uuid. Could this be a uuid collision?\n\n", 
            "date_created": "2013-06-26 15:00:57.057417+00:00", 
            "author": "https://api.launchpad.net/1.0/~mate-lakat"
        }, 
        {
            "content": "After removing the orphan vdi (bab415f3-62da-8bae-b80e-d3ce45a1ca5c)  no more errors happened. I am assuming, it was the result of using a non-clean environment. Marking as invalid, create a separate bug for the logging error (that's still a problem)\n", 
            "date_created": "2013-06-26 15:23:41.084724+00:00", 
            "author": "https://api.launchpad.net/1.0/~mate-lakat"
        }
    ], 
    "closed": "2013-06-26 15:24:02.702398+00:00"
}