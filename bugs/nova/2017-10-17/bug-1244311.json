{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 08:48:06.342913+00:00", 
    "description": "The _sync_power_states periodic task pull instances without system_metadata in order to reduce network bandwidth being unnecessarily consumed.  Most of the time this is fine, but \"if vm_power_state != db_power_state\" then the instance is updated and saved.  As part of saving the instance a notification is sent.  In order to send the notification it extracts flavor information from the system_metadata on the instance.  But system_metadata isn't loaded, and won't be lazy loaded.  So an exception is raised and the notification isn't sent.\n\n2013-10-23 03:30:35.714 21492 ERROR nova.notifications [-] [instance: fa0cee4b-6825-47af-bf6f-64491326feab] Failed to send state update notification\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] Traceback (most recent call last):\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] File \"/opt/rackstack/472.23/nova/lib/python2.6/site-packages/nova/notifications.py\", line 146, in send_update\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] old_display_name=old_display_name)\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] File \"/opt/rackstack/472.23/nova/lib/python2.6/site-packages/nova/notifications.py\", line 199, in _send_instance_update_notification\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] payload = info_from_instance(context, instance, None, None)\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] File \"/opt/rackstack/472.23/nova/lib/python2.6/site-packages/nova/notifications.py\", line 343, in info_from_instance\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] instance_type = flavors.extract_flavor(instance_ref)\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] File \"/opt/rackstack/472.23/nova/lib/python2.6/site-packages/nova/compute/flavors.py\", line 282, in extract_flavor\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] instance_type[key] = type_fn(sys_meta[type_key])\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] KeyError: 'instance_type_memory_mb'\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab]\n2013-10-23 03:30:35.718 21492 WARNING nova.compute.manager [-] [instance: fa0cee4b-6825-47af-bf6f-64491326feab] Instance shutdown by itself. Calling the stop API.", 
    "tags": [
        "unified-objects"
    ], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1244311", 
    "owner": "https://api.launchpad.net/1.0/~alaski", 
    "id": 1244311, 
    "index": 1288, 
    "openned": "2013-10-24 16:44:28.103693+00:00", 
    "created": "2013-10-24 16:44:28.103693+00:00", 
    "title": "notification failure in _sync_power_states", 
    "comments": [
        {
            "content": "The _sync_power_states periodic task pull instances without system_metadata in order to reduce network bandwidth being unnecessarily consumed.  Most of the time this is fine, but \"if vm_power_state != db_power_state\" then the instance is updated and saved.  As part of saving the instance a notification is sent.  In order to send the notification it extracts flavor information from the system_metadata on the instance.  But system_metadata isn't loaded, and won't be lazy loaded.  So an exception is raised and the notification isn't sent.\n\n2013-10-23 03:30:35.714 21492 ERROR nova.notifications [-] [instance: fa0cee4b-6825-47af-bf6f-64491326feab] Failed to send state update notification\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] Traceback (most recent call last):\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] File \"/opt/rackstack/472.23/nova/lib/python2.6/site-packages/nova/notifications.py\", line 146, in send_update\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] old_display_name=old_display_name)\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] File \"/opt/rackstack/472.23/nova/lib/python2.6/site-packages/nova/notifications.py\", line 199, in _send_instance_update_notification\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] payload = info_from_instance(context, instance, None, None)\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] File \"/opt/rackstack/472.23/nova/lib/python2.6/site-packages/nova/notifications.py\", line 343, in info_from_instance\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] instance_type = flavors.extract_flavor(instance_ref)\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] File \"/opt/rackstack/472.23/nova/lib/python2.6/site-packages/nova/compute/flavors.py\", line 282, in extract_flavor\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] instance_type[key] = type_fn(sys_meta[type_key])\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab] KeyError: 'instance_type_memory_mb'\n2013-10-23 03:30:35.714 21492 TRACE nova.notifications [instance: fa0cee4b-6825-47af-bf6f-64491326feab]\n2013-10-23 03:30:35.718 21492 WARNING nova.compute.manager [-] [instance: fa0cee4b-6825-47af-bf6f-64491326feab] Instance shutdown by itself. Calling the stop API.", 
            "date_created": "2013-10-24 16:44:28.103693+00:00", 
            "author": "https://api.launchpad.net/1.0/~alaski"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/53708\nCommitted: http://github.com/openstack/nova/commit/e03963b1e42ca2900b108201e77edf2386c5c46a\nSubmitter: Jenkins\nBranch:    master\n\ncommit e03963b1e42ca2900b108201e77edf2386c5c46a\nAuthor: Andrew Laski <email address hidden>\nDate:   Thu Oct 24 13:48:24 2013 -0400\n\n    Pull system_metadata for notifications on instance.save()\n    \n    When saving changes on an instance object a notification is sent out.\n    An attempt is made to pull flavor information from the instance but if\n    system_metadata is not joined then an exception is raised and the\n    notification fails.  This ensures that system_metadata is available for\n    those notifications.\n    \n    Change-Id: Ifd317f847c3839cd6019038bb3dc856b9f107000\n    Closes-bug: 1244311\n", 
            "date_created": "2013-10-30 19:38:25.267064+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/havana\nReview: https://review.openstack.org/54863", 
            "date_created": "2013-11-01 02:00:38.812117+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/54863\nCommitted: http://github.com/openstack/nova/commit/e360dc2adcf18cfdc2b39cbea708bb27bf741e2d\nSubmitter: Jenkins\nBranch:    stable/havana\n\ncommit e360dc2adcf18cfdc2b39cbea708bb27bf741e2d\nAuthor: Andrew Laski <email address hidden>\nDate:   Thu Oct 24 13:48:24 2013 -0400\n\n    Pull system_metadata for notifications on instance.save()\n    \n    When saving changes on an instance object a notification is sent out.\n    An attempt is made to pull flavor information from the instance but if\n    system_metadata is not joined then an exception is raised and the\n    notification fails.  This ensures that system_metadata is available for\n    those notifications.\n    \n    Conflicts:\n    \n    \tnova/objects/base.py\n    \n    The conflict is from change Icd2944f17b6100d51007dbc48da90e4e992bbd48\n    \n    Change-Id: Ifd317f847c3839cd6019038bb3dc856b9f107000\n    Closes-bug: 1244311\n    (cherry picked from commit e03963b1e42ca2900b108201e77edf2386c5c46a)\n", 
            "date_created": "2013-11-02 19:38:39.171938+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-12-04 10:04:23.985456+00:00"
}