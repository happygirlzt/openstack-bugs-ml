{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:10:21.448615+00:00", 
    "description": "The fake_notifier code is using anyjson, which today is failing to serialize something in a notification payload. Failure looks like this:\n\n    Traceback (most recent call last):\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/mock.py\", line 1201, in patched\n        return func(*args, **keywargs)\n      File \"nova/tests/unit/compute/test_compute.py\", line 2774, in test_reboot_fail\n        self._test_reboot(False, fail_reboot=True)\n      File \"nova/tests/unit/compute/test_compute.py\", line 2744, in _test_reboot\n        reboot_type=reboot_type)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 420, in assertRaises\n        self.assertThat(our_callable, matcher)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 431, in assertThat\n        mismatch_error = self._matchHelper(matchee, matcher, message, verbose)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 481, in _matchHelper\n        mismatch = matcher.match(matchee)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/matchers/_exception.py\", line 108, in match\n        mismatch = self.exception_matcher.match(exc_info)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/matchers/_higherorder.py\", line 62, in match\n        mismatch = matcher.match(matchee)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 412, in match\n        reraise(*matchee)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/matchers/_exception.py\", line 101, in match\n        result = matchee()\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 965, in __call__\n        return self._callable_object(*self._args, **self._kwargs)\n      File \"nova/exception.py\", line 88, in wrapped\n        payload)\n      File \"nova/tests/unit/fake_notifier.py\", line 57, in _notify\n        anyjson.serialize(payload)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/anyjson/__init__.py\", line 141, in dumps\n        return implementation.dumps(value)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/anyjson/__init__.py\", line 87, in dumps\n        return self._encode(data)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/oslo/serialization/jsonutils.py\", line 186, in dumps\n        return json.dumps(obj, default=default, **kwargs)\n      File \"/usr/lib64/python2.7/json/__init__.py\", line 250, in dumps\n        sort_keys=sort_keys, **kw).encode(obj)\n      File \"/usr/lib64/python2.7/json/encoder.py\", line 207, in encode\n        chunks = self.iterencode(o, _one_shot=True)\n      File \"/usr/lib64/python2.7/json/encoder.py\", line 270, in iterencode\n        return _iterencode(o, 0)\n    ValueError: Circular reference detected", 
    "tags": [], 
    "importance": "Critical", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1403162", 
    "owner": "https://api.launchpad.net/1.0/~danms", 
    "id": 1403162, 
    "index": 226, 
    "openned": "2014-12-16 18:35:14.397993+00:00", 
    "created": "2014-12-16 18:35:14.397993+00:00", 
    "title": "fake_notifier: ValueError: Circular reference detected", 
    "comments": [
        {
            "content": "The fake_notifier code is using anyjson, which today is failing to serialize something in a notification payload. Failure looks like this:\n\n    Traceback (most recent call last):\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/mock.py\", line 1201, in patched\n        return func(*args, **keywargs)\n      File \"nova/tests/unit/compute/test_compute.py\", line 2774, in test_reboot_fail\n        self._test_reboot(False, fail_reboot=True)\n      File \"nova/tests/unit/compute/test_compute.py\", line 2744, in _test_reboot\n        reboot_type=reboot_type)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 420, in assertRaises\n        self.assertThat(our_callable, matcher)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 431, in assertThat\n        mismatch_error = self._matchHelper(matchee, matcher, message, verbose)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 481, in _matchHelper\n        mismatch = matcher.match(matchee)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/matchers/_exception.py\", line 108, in match\n        mismatch = self.exception_matcher.match(exc_info)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/matchers/_higherorder.py\", line 62, in match\n        mismatch = matcher.match(matchee)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 412, in match\n        reraise(*matchee)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/matchers/_exception.py\", line 101, in match\n        result = matchee()\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/testtools/testcase.py\", line 965, in __call__\n        return self._callable_object(*self._args, **self._kwargs)\n      File \"nova/exception.py\", line 88, in wrapped\n        payload)\n      File \"nova/tests/unit/fake_notifier.py\", line 57, in _notify\n        anyjson.serialize(payload)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/anyjson/__init__.py\", line 141, in dumps\n        return implementation.dumps(value)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/anyjson/__init__.py\", line 87, in dumps\n        return self._encode(data)\n      File \"/home/dan/nova/.tox/py27/lib/python2.7/site-packages/oslo/serialization/jsonutils.py\", line 186, in dumps\n        return json.dumps(obj, default=default, **kwargs)\n      File \"/usr/lib64/python2.7/json/__init__.py\", line 250, in dumps\n        sort_keys=sort_keys, **kw).encode(obj)\n      File \"/usr/lib64/python2.7/json/encoder.py\", line 207, in encode\n        chunks = self.iterencode(o, _one_shot=True)\n      File \"/usr/lib64/python2.7/json/encoder.py\", line 270, in iterencode\n        return _iterencode(o, 0)\n    ValueError: Circular reference detected", 
            "date_created": "2014-12-16 18:35:14.397993+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "327 occurrences in last 24 hours: http://goo.gl/LBSz8M", 
            "date_created": "2014-12-16 18:38:28.532606+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "http://logstash.openstack.org/#eyJzZWFyY2giOiJtZXNzYWdlOlwiVmFsdWVFcnJvcjogQ2lyY3VsYXIgcmVmZXJlbmNlIGRldGVjdGVkXCIgQU5EIHRhZ3M6XCJjb25zb2xlXCIgQU5EIGJ1aWxkX25hbWU6XCJnYXRlLW5vdmEtcHl0aG9uMjdcIiIsImZpZWxkcyI6W10sIm9mZnNldCI6MCwidGltZWZyYW1lIjoiMTcyODAwIiwiZ3JhcGhtb2RlIjoiY291bnQiLCJ0aW1lIjp7InVzZXJfaW50ZXJ2YWwiOjB9LCJzdGFtcCI6MTQxODc1NDMxMjYyOCwibW9kZSI6IiIsImFuYWx5emVfZmllbGQiOiIifQ==", 
            "date_created": "2014-12-16 18:41:10.198063+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Proposal can be found here https://review.openstack.org/#/c/142175", 
            "date_created": "2014-12-16 22:13:54.170183+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/142175\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=7ed9268a1f61b708cb1360c2d89aa25e935a8f4a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7ed9268a1f61b708cb1360c2d89aa25e935a8f4a\nAuthor: Dan Smith <email address hidden>\nDate:   Tue Dec 16 10:19:56 2014 -0800\n\n    Fix using anyjson in fake_notifier\n    \n    For some reason we were using anyjson.serialize() in our fake_notifier.\n    That may have been to mirror kombu, but really we need to mirror what we\n    do when we convert our payloads to primitives, which is using jsonutils.\n    \n    Closes-Bug: #1403162\n    Change-Id: I92a4708e0700e88f4b2554aa4e7ad3856f5be1e0\n", 
            "date_created": "2014-12-16 22:41:07.920070+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-12-18 19:57:44.510075+00:00"
}