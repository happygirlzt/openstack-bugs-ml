{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:23:36.726902+00:00", 
    "description": "centos 7 unit test fails.\n\nto pass this test:\nexport OPENSSL_ENABLE_MD5_VERIFY=1\nexport NSS_HASH_ALG_SUPPORT=+MD5 \n\n\n# ./run_tests.sh -V -s nova.tests.unit.test_crypto.X509Test\nRunning `tools/with_venv.sh python setup.py testr --testr-args='--subunit --concurrency 0  nova.tests.unit.test_crypto.X509Test'`\nnova.tests.unit.test_crypto.X509Test\n    test_encrypt_decrypt_x509                                         OK  2.73\n    test_can_generate_x509                                            FAIL\n\nSlowest 2 tests took 6.24 secs:\nnova.tests.unit.test_crypto.X509Test\n    test_can_generate_x509                                                3.51\n    test_encrypt_decrypt_x509                                             2.73\n\n======================================================================\nFAIL: nova.tests.unit.test_crypto.X509Test.test_can_generate_x509\n----------------------------------------------------------------------", 
    "tags": [
        "in-stable-icehouse", 
        "in-stable-juno", 
        "low-hanging-fruit"
    ], 
    "importance": "Low", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1399498", 
    "owner": "https://api.launchpad.net/1.0/~dims-v", 
    "id": 1399498, 
    "index": 1451, 
    "openned": "2014-12-05 01:11:36.445118+00:00", 
    "created": "2014-12-05 01:11:36.445118+00:00", 
    "title": "centos 7 unit test fails", 
    "comments": [
        {
            "content": "centos 7 unit test fails.\n\nto pass this test:\nexport OPENSSL_ENABLE_MD5_VERIFY=1\nexport NSS_HASH_ALG_SUPPORT=+MD5 \n\n\n# ./run_tests.sh -V -s nova.tests.unit.test_crypto.X509Test\nRunning `tools/with_venv.sh python setup.py testr --testr-args='--subunit --concurrency 0  nova.tests.unit.test_crypto.X509Test'`\nnova.tests.unit.test_crypto.X509Test\n    test_encrypt_decrypt_x509                                         OK  2.73\n    test_can_generate_x509                                            FAIL\n\nSlowest 2 tests took 6.24 secs:\nnova.tests.unit.test_crypto.X509Test\n    test_can_generate_x509                                                3.51\n    test_encrypt_decrypt_x509                                             2.73\n\n======================================================================\nFAIL: nova.tests.unit.test_crypto.X509Test.test_can_generate_x509\n----------------------------------------------------------------------", 
            "date_created": "2014-12-05 01:11:36.445118+00:00", 
            "author": "https://api.launchpad.net/1.0/~warp-kawada"
        }, 
        {
            "content": "Here's a bit more detail\n\n\n[stack@dc8f7542d504 nova]$ tox -e py27 nova.tests.unit.test_crypto.X509Test.test_can_generate_x509\npy27 develop-inst-noop: /opt/stack/nova\npy27 runtests: PYTHONHASHSEED='0'\npy27 runtests: commands[0] | find . -type f -name *.pyc -delete\npy27 runtests: commands[1] | bash tools/pretty_tox.sh nova.tests.unit.test_crypto.X509Test.test_can_generate_x509\nrunning testr\nrunning=OS_STDOUT_CAPTURE=${OS_STDOUT_CAPTURE:-1} \\\nOS_STDERR_CAPTURE=${OS_STDERR_CAPTURE:-1} \\\nOS_TEST_TIMEOUT=${OS_TEST_TIMEOUT:-160} \\\n${PYTHON:-python} -m subunit.run discover -t ./ ${OS_TEST_PATH:-./nova/tests} --list\nrunning=OS_STDOUT_CAPTURE=${OS_STDOUT_CAPTURE:-1} \\\nOS_STDERR_CAPTURE=${OS_STDERR_CAPTURE:-1} \\\nOS_TEST_TIMEOUT=${OS_TEST_TIMEOUT:-160} \\\n${PYTHON:-python} -m subunit.run discover -t ./ ${OS_TEST_PATH:-./nova/tests}  --load-list /tmp/tmpR91GkK\n\n{0} nova.tests.unit.test_crypto.X509Test.test_can_generate_x509 [5.409021s] ... FAILED\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"nova/tests/unit/test_crypto.py\", line 50, in test_can_generate_x509\n        project_cert_file, '-verbose', signed_cert_file)\n      File \"nova/utils.py\", line 164, in execute\n        return processutils.execute(*cmd, **kwargs)\n      File \"/opt/stack/nova/.tox/py27/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n        cmd=sanitized_cmd)\n    ProcessExecutionError: Unexpected error while running command.\n    Command: openssl verify -CAfile /tmp/tmpcHtkYL/tmp1Sfc6G/project -verbose /tmp/tmpcHtkYL/tmp1Sfc6G/signed\n    Exit code: 2\n    Stdout: u'/tmp/tmpcHtkYL/tmp1Sfc6G/signed: C = US, ST = California, O = OpenStack, OU = NovaDev, CN = fake-fake-2014-12-08T16:12:47Z\\nerror 7 at 0 depth lookup:certificate signature failure\\n'\n    Stderr: u'140085465835424:error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm:a_verify.c:179:\\n'\n    Traceback (most recent call last):\n    _StringException: Empty attachments:\n      stderr\n      stdout\n\n    pythonlogging:'': {{{2014-12-08 16:12:46,482 INFO [248_add_expire_reservations_index] Skipped adding reservations_deleted_expire_idx because an equivalent index already exists.}}}\n\n    Traceback (most recent call last):\n      File \"nova/tests/unit/test_crypto.py\", line 50, in test_can_generate_x509\n        project_cert_file, '-verbose', signed_cert_file)\n      File \"nova/utils.py\", line 164, in execute\n        return processutils.execute(*cmd, **kwargs)\n      File \"/opt/stack/nova/.tox/py27/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n        cmd=sanitized_cmd)\n    ProcessExecutionError: Unexpected error while running command.\n    Command: openssl verify -CAfile /tmp/tmpcHtkYL/tmp1Sfc6G/project -verbose /tmp/tmpcHtkYL/tmp1Sfc6G/signed\n    Exit code: 2\n    Stdout: u'/tmp/tmpcHtkYL/tmp1Sfc6G/signed: C = US, ST = California, O = OpenStack, OU = NovaDev, CN = fake-fake-2014-12-08T16:12:47Z\\nerror 7 at 0 depth lookup:certificate signature failure\\n'\n    Stderr: u'140085465835424:error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm:a_verify.c:179:\\n'\n\n    Traceback (most recent call last):\n    _StringException: Empty attachments:\n      stderr\n      stdout\n\n    pythonlogging:'': {{{2014-12-08 16:12:46,482 INFO [248_add_expire_reservations_index] Skipped adding reservations_deleted_expire_idx because an equivalent index already exists.}}}\n\n    Traceback (most recent call last):\n      File \"nova/tests/unit/test_crypto.py\", line 50, in test_can_generate_x509\n        project_cert_file, '-verbose', signed_cert_file)\n      File \"nova/utils.py\", line 164, in execute\n        return processutils.execute(*cmd, **kwargs)\n      File \"/opt/stack/nova/.tox/py27/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n        cmd=sanitized_cmd)\n    ProcessExecutionError: Unexpected error while running command.\n    Command: openssl verify -CAfile /tmp/tmpcHtkYL/tmp1Sfc6G/project -verbose /tmp/tmpcHtkYL/tmp1Sfc6G/signed\n    Exit code: 2\n    Stdout: u'/tmp/tmpcHtkYL/tmp1Sfc6G/signed: C = US, ST = California, O = OpenStack, OU = NovaDev, CN = fake-fake-2014-12-08T16:12:47Z\\nerror 7 at 0 depth lookup:certificate signature failure\\n'\n    Stderr: u'140085465835424:error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm:a_verify.c:179:\\n'\n\n\n\nCaptured pythonlogging:\n~~~~~~~~~~~~~~~~~~~~~~~\n    2014-12-08 16:12:46,482 INFO [248_add_expire_reservations_index] Skipped adding reservations_deleted_expire_idx because an equivalent index already exists.\n\nSlowest Tests\nTest id                                                      Runtime (s)\n-----------------------------------------------------------  -----------\nnova.tests.unit.test_crypto.X509Test.test_can_generate_x509  5.409\n\n==============================\nFailed 1 tests - output below:\n==============================\n\nnova.tests.unit.test_crypto.X509Test.test_can_generate_x509\n-----------------------------------------------------------\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"nova/tests/unit/test_crypto.py\", line 50, in test_can_generate_x509\n        project_cert_file, '-verbose', signed_cert_file)\n      File \"nova/utils.py\", line 164, in execute\n        return processutils.execute(*cmd, **kwargs)\n      File \"/opt/stack/nova/.tox/py27/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n        cmd=sanitized_cmd)\n    ProcessExecutionError: Unexpected error while running command.\n    Command: openssl verify -CAfile /tmp/tmpcHtkYL/tmp1Sfc6G/project -verbose /tmp/tmpcHtkYL/tmp1Sfc6G/signed\n    Exit code: 2\n    Stdout: u'/tmp/tmpcHtkYL/tmp1Sfc6G/signed: C = US, ST = California, O = OpenStack, OU = NovaDev, CN = fake-fake-2014-12-08T16:12:47Z\\nerror 7 at 0 depth lookup:certificate signature failure\\n'\n    Stderr: u'140085465835424:error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm:a_verify.c:179:\\n'\n    Traceback (most recent call last):\n    _StringException: Empty attachments:\n      stderr\n      stdout\n\n    pythonlogging:'': {{{2014-12-08 16:12:46,482 INFO [248_add_expire_reservations_index] Skipped adding reservations_deleted_expire_idx because an equivalent index already exists.}}}\n\n    Traceback (most recent call last):\n      File \"nova/tests/unit/test_crypto.py\", line 50, in test_can_generate_x509\n        project_cert_file, '-verbose', signed_cert_file)\n      File \"nova/utils.py\", line 164, in execute\n        return processutils.execute(*cmd, **kwargs)\n      File \"/opt/stack/nova/.tox/py27/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n        cmd=sanitized_cmd)\n    ProcessExecutionError: Unexpected error while running command.\n    Command: openssl verify -CAfile /tmp/tmpcHtkYL/tmp1Sfc6G/project -verbose /tmp/tmpcHtkYL/tmp1Sfc6G/signed\n    Exit code: 2\n    Stdout: u'/tmp/tmpcHtkYL/tmp1Sfc6G/signed: C = US, ST = California, O = OpenStack, OU = NovaDev, CN = fake-fake-2014-12-08T16:12:47Z\\nerror 7 at 0 depth lookup:certificate signature failure\\n'\n    Stderr: u'140085465835424:error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm:a_verify.c:179:\\n'\n\n    Traceback (most recent call last):\n    _StringException: Empty attachments:\n      stderr\n      stdout\n\n    pythonlogging:'': {{{2014-12-08 16:12:46,482 INFO [248_add_expire_reservations_index] Skipped adding reservations_deleted_expire_idx because an equivalent index already exists.}}}\n\n    Traceback (most recent call last):\n      File \"nova/tests/unit/test_crypto.py\", line 50, in test_can_generate_x509\n        project_cert_file, '-verbose', signed_cert_file)\n      File \"nova/utils.py\", line 164, in execute\n        return processutils.execute(*cmd, **kwargs)\n      File \"/opt/stack/nova/.tox/py27/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 224, in execute\n        cmd=sanitized_cmd)\n    ProcessExecutionError: Unexpected error while running command.\n    Command: openssl verify -CAfile /tmp/tmpcHtkYL/tmp1Sfc6G/project -verbose /tmp/tmpcHtkYL/tmp1Sfc6G/signed\n    Exit code: 2\n    Stdout: u'/tmp/tmpcHtkYL/tmp1Sfc6G/signed: C = US, ST = California, O = OpenStack, OU = NovaDev, CN = fake-fake-2014-12-08T16:12:47Z\\nerror 7 at 0 depth lookup:certificate signature failure\\n'\n    Stderr: u'140085465835424:error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm:a_verify.c:179:\\n'\n\n\n\nCaptured pythonlogging:\n~~~~~~~~~~~~~~~~~~~~~~~\n    2014-12-08 16:12:46,482 INFO [248_add_expire_reservations_index] Skipped adding reservations_deleted_expire_idx because an equivalent index already exists.\n\n\n\n======\nTotals\n======\nRun: 1 in 5.409021 sec.\n - Passed: 0\n - Skipped: 0\n - Failed: 1\n\n==============\nWorker Balance\n==============\n - Worker 0 (1 tests) => 0:00:05.409021s\nERROR: InvocationError: '/bin/bash tools/pretty_tox.sh nova.tests.unit.test_crypto.X509Test.test_can_generate_x509'\n______________________________________________________________________ summary _______________________________________________________________________\nERROR:   py27: commands failed\n[stack@dc8f7542d504 nova]$ uname -a\nLinux dc8f7542d504 3.13.0-29-generic #53-Ubuntu SMP Wed Jun 4 21:00:20 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux\n[stack@dc8f7542d504 nova]$ cat /etc/*release*\nCentOS Linux release 7.0.1406 (Core)\nNAME=\"CentOS Linux\"\nVERSION=\"7 (Core)\"\nID=\"centos\"\nID_LIKE=\"rhel fedora\"\nVERSION_ID=\"7\"\nPRETTY_NAME=\"CentOS Linux 7 (Core)\"\nANSI_COLOR=\"0;31\"\nCPE_NAME=\"cpe:/o:centos:centos:7\"\nHOME_URL=\"https://www.centos.org/\"\nBUG_REPORT_URL=\"https://bugs.centos.org/\"\n\nCentOS Linux release 7.0.1406 (Core)\nCentOS Linux release 7.0.1406 (Core)\ncpe:/o:centos:centos:7", 
            "date_created": "2014-12-08 16:16:41.677439+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "This looks like an issue with missing dependencies. We try to keep a record of what packages are needed to make the unit tests pass here http://docs.openstack.org/developer/nova/devref/development.environment.html#linux-systems\n\nSo once we find the missing package we should update that document http://git.openstack.org/cgit/openstack/nova/tree/doc/source/devref/development.environment.rst", 
            "date_created": "2014-12-10 19:07:42.684808+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "is this really a packaging thing?   From what I can tell, this is a redhat/fedora patch to openssl and is just their behavior now:\n\nhttps://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.0_Release_Notes/Known-Issues-Networking.html#varl-Red_Hat_Enterprise_Linux-7.0_Release_Notes-Networking-openssl_component_BZ1062656\n\nhttps://lists.fedoraproject.org/pipermail/scm-commits/Week-of-Mon-20131111/1144043.html\n\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1062656#c12\n\netc.\n\nI would think the solution is to just add these environment variables to tox.ini.", 
            "date_created": "2015-01-06 20:43:58.791249+00:00", 
            "author": "https://api.launchpad.net/1.0/~zzzeek"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/153339", 
            "date_created": "2015-02-05 19:01:32.475088+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/153339\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=f4495de5a04b03bbd6773b6b059ea0341a2d0aea\nSubmitter: Jenkins\nBranch:    master\n\ncommit f4495de5a04b03bbd6773b6b059ea0341a2d0aea\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Thu Feb 5 13:57:04 2015 -0500\n\n    Make tests use sha256 as openssl default digest algorithm\n    \n    The tests previously used md5, which is considered broken,\n    and distros are starting to disable this in their openssl\n    builds.\n    \n    Make the tests use sha256 as the default as a long term\n    sane alternative that should work on all distros.\n    \n    This will fix Centos 7, and future proof the tests.\n    \n    Closes-Bug: #1399498\n    Change-Id: Ic6cc92e47a318d789db3c3c98c67948eefb51fc2\n", 
            "date_created": "2015-02-09 21:06:13.903607+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/158816", 
            "date_created": "2015-02-24 18:42:30.687223+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/158895", 
            "date_created": "2015-02-24 22:29:33.586687+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/158816\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=b3f80bd23855fa49420f5b66698d3e88e965e808\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit b3f80bd23855fa49420f5b66698d3e88e965e808\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Thu Feb 5 13:57:04 2015 -0500\n\n    Make tests use sha256 as openssl default digest algorithm\n    \n    The tests previously used md5, which is considered broken,\n    and distros are starting to disable this in their openssl\n    builds.\n    \n    Make the tests use sha256 as the default as a long term\n    sane alternative that should work on all distros.\n    \n    This will fix Centos 7, and future proof the tests.\n    \n    Closes-Bug: #1399498\n    Change-Id: Ic6cc92e47a318d789db3c3c98c67948eefb51fc2\n    (cherry picked from commit f4495de5a04b03bbd6773b6b059ea0341a2d0aea)\n", 
            "date_created": "2015-03-10 09:12:55.699157+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/158895\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e27596102087984d2b8c9b74ef0e340c372d0b77\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit e27596102087984d2b8c9b74ef0e340c372d0b77\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Thu Feb 5 13:57:04 2015 -0500\n\n    Make tests use sha256 as openssl default digest algorithm\n    \n    The tests previously used md5, which is considered broken,\n    and distros are starting to disable this in their openssl\n    builds.\n    \n    Make the tests use sha256 as the default as a long term\n    sane alternative that should work on all distros.\n    \n    This will fix Centos 7, and future proof the tests.\n    \n    Closes-Bug: #1399498\n    Change-Id: Ic6cc92e47a318d789db3c3c98c67948eefb51fc2\n    (cherry picked from commit f4495de5a04b03bbd6773b6b059ea0341a2d0aea)\n", 
            "date_created": "2015-03-10 09:13:11.173944+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-03-20 07:40:10.673396+00:00"
}