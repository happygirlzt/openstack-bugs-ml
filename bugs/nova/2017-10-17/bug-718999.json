{
    "status": "Fix Released", 
    "last_updated": "2011-04-21 07:13:44.634625+00:00", 
    "description": "When using an expired auth token in the openstack api, the call to db/sqlalchemy/api.py auth_destroy_token fails:\n\n2011-02-14 21:03:04,399 ERROR nova.api.openstack [-] Caught error: Object '<AuthToken at 0x301cb90>' is already attached to session '48825808' (this is '50390416')\n(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/__init__.py\", line 52, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/auth.py\", line 53, in __call__\n(nova.api.openstack): TRACE:     user = self.get_user_by_authentication(req)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/auth.py\", line 66, in get_user_by_authentication\n(nova.api.openstack): TRACE:     return self.authorize_token(req.headers[\"X-Auth-Token\"])\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/auth.py\", line 110, in authorize_token\n(nova.api.openstack): TRACE:     self.db.auth_destroy_token(ctxt, token)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 615, in auth_destroy_token\n(nova.api.openstack): TRACE:     return IMPL.auth_destroy_token(context, token)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 99, in wrapper\n(nova.api.openstack): TRACE:     return f(*args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 1220, in auth_destroy_token\n(nova.api.openstack): TRACE:     session.delete(token)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/session.py\", line 1097, in delete\n(nova.api.openstack): TRACE:     self._attach(state)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/session.py\", line 1282, in _attach\n(nova.api.openstack): TRACE:     state.session_id, self.hash_key))\n(nova.api.openstack): TRACE: InvalidRequestError: Object '<AuthToken at 0x301cb90>' is already attached to session '48825808' (this is '50390416')", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/718999", 
    "owner": "https://api.launchpad.net/1.0/~klmitch", 
    "id": 718999, 
    "index": 2279, 
    "openned": "2011-02-14 21:18:31.797344+00:00", 
    "created": "2011-02-14 21:18:31.797344+00:00", 
    "title": "Expired Auth Token Deletion Failure", 
    "comments": [
        {
            "content": "When using an expired auth token in the openstack api, the call to db/sqlalchemy/api.py auth_destroy_token fails:\n\n2011-02-14 21:03:04,399 ERROR nova.api.openstack [-] Caught error: Object '<AuthToken at 0x301cb90>' is already attached to session '48825808' (this is '50390416')\n(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/__init__.py\", line 52, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/auth.py\", line 53, in __call__\n(nova.api.openstack): TRACE:     user = self.get_user_by_authentication(req)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/auth.py\", line 66, in get_user_by_authentication\n(nova.api.openstack): TRACE:     return self.authorize_token(req.headers[\"X-Auth-Token\"])\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/api/openstack/auth.py\", line 110, in authorize_token\n(nova.api.openstack): TRACE:     self.db.auth_destroy_token(ctxt, token)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 615, in auth_destroy_token\n(nova.api.openstack): TRACE:     return IMPL.auth_destroy_token(context, token)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 99, in wrapper\n(nova.api.openstack): TRACE:     return f(*args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 1220, in auth_destroy_token\n(nova.api.openstack): TRACE:     session.delete(token)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/session.py\", line 1097, in delete\n(nova.api.openstack): TRACE:     self._attach(state)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/session.py\", line 1282, in _attach\n(nova.api.openstack): TRACE:     state.session_id, self.hash_key))\n(nova.api.openstack): TRACE: InvalidRequestError: Object '<AuthToken at 0x301cb90>' is already attached to session '48825808' (this is '50390416')", 
            "date_created": "2011-02-14 21:18:31.797344+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }
    ], 
    "closed": "2011-04-21 07:13:42.957047+00:00"
}