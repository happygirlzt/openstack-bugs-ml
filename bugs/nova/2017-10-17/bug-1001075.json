{
    "status": "Invalid", 
    "last_updated": "2012-09-13 09:39:24.899338+00:00", 
    "description": "Installing Devstack with Quantum and Linux Bridge plugin enabled. nova-network  fails to excute:\n\n2012-05-18 11:46:53 DEBUG nova.utils [req-a196bf88-01e7-42e5-af61-d546f996b54a None None] Running cmd (subprocess\n): sudo /usr/local/bin/nova-rootwrap sysctl -w net.ipv4.ip_forward=1 from (pid=28327) execute /opt/stack/nova/nov\na/utils.py:176\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()\n  File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/service.py\", line 110, in run_server\n    server.start()\n  File \"/opt/stack/nova/nova/service.py\", line 183, in start\n    self.manager.init_host()\n  File \"/opt/stack/nova/nova/network/quantum/manager.py\", line 91, in init_host\n    super(QuantumManager, self).init_host()\n  File \"/opt/stack/nova/nova/network/manager.py\", line 790, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/opt/stack/nova/nova/network/quantum/manager.py\", line 120, in _setup_network_on_host\n    self.l3driver.initialize_gateway(network)\n  File \"/opt/stack/nova/nova/network/l3.py\", line 99, in initialize_gateway\n    linux_net.initialize_gateway_device(dev, network_ref)\n  File \"/opt/stack/nova/nova/network/linux_net.py\", line 534, in initialize_gateway_device\n    network_ref['cidr'].rpartition('/')[2])\n2012-05-18 11:46:54 CRITICAL nova [-] 'NoneType' object has no attribute 'rpartition'\n2012-05-18 11:46:54 TRACE nova Traceback (most recent call last):\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/bin/nova-network\", line 49, in <module>\n2012-05-18 11:46:54 TRACE nova     service.wait()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 453, in wait\n2012-05-18 11:46:54 TRACE nova     _launcher.wait()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 149, in wait\n2012-05-18 11:46:54 TRACE nova     service.wait()\n2012-05-18 11:46:54 TRACE nova   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 166, in wait\n2012-05-18 11:46:54 TRACE nova     return self._exit_event.wait()\n2012-05-18 11:46:54 TRACE nova   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2012-05-18 11:46:54 TRACE nova     return hubs.get_hub().switch()\n2012-05-18 11:46:54 TRACE nova   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 177, in switch\n2012-05-18 11:46:54 TRACE nova     return self.greenlet.switch()\n2012-05-18 11:46:54 TRACE nova   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n2012-05-18 11:46:54 TRACE nova     result = function(*args, **kwargs)\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 110, in run_server\n2012-05-18 11:46:54 TRACE nova     server.start()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 183, in start\n2012-05-18 11:46:54 TRACE nova     self.manager.init_host()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/quantum/manager.py\", line 91, in init_host\n2012-05-18 11:46:54 TRACE nova     super(QuantumManager, self).init_host()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/manager.py\", line 790, in init_host\n2012-05-18 11:46:54 TRACE nova     self._setup_network_on_host(ctxt, network)\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/quantum/manager.py\", line 120, in _setup_network_on_host\n2012-05-18 11:46:54 TRACE nova     self.l3driver.initialize_gateway(network)\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/l3.py\", line 99, in initialize_gateway\n2012-05-18 11:46:54 TRACE nova     linux_net.initialize_gateway_device(dev, network_ref)\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/linux_net.py\", line 534, in initialize_gateway_device\n2012-05-18 11:46:54 TRACE nova     network_ref['cidr'].rpartition('/')[2])\n2012-05-18 11:46:54 TRACE nova AttributeError: 'NoneType' object has no attribute 'rpartition'\n2012-05-18 11:46:54 TRACE nova\n\nMy configuration info:\n\n/opt/stack/devstack/stackrc :\n------------------------------------\nENABLED_SERVICES=g-api,g-reg,key,n-api,n-crt,n-obj,n-cpu,n-net,n-vol,n-sch,n-novnc,n-xvnc,n-cauth,horizon,mysql,rabbit,melange,m-svc,q-svc,quantum,q-agt\n\n/opt/stack/devstack/localrc :\n-----------------------------------\nMYSQL_PASSWORD=openstack\nRABBIT_PASSWORD=openstack\nSERVICE_TOKEN=openstack\nSERVICE_PASSWORD=openstack\nADMIN_PASSWORD=openstack\nPUBLIC_INTERFACE=eth0\nVLAN_INTERFACE=eth0\nFLAT_NETWORK_BRIDGE=br100\nFLAT_INTERFACE=eth0\nQ_PLUGIN=linuxbridge", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1001075", 
    "owner": "https://api.launchpad.net/1.0/~danwent", 
    "id": 1001075, 
    "index": 2916, 
    "openned": "2012-05-18 04:01:11.539481+00:00", 
    "created": "2012-05-18 04:01:11.539481+00:00", 
    "title": "nova-network fails to start: missing CIDR (with Quantum/Linux bridge plugin)", 
    "comments": [
        {
            "content": "Installing Devstack with Quantum and Linux Bridge plugin enabled. nova-network  fails to excute:\n\n2012-05-18 11:46:53 DEBUG nova.utils [req-a196bf88-01e7-42e5-af61-d546f996b54a None None] Running cmd (subprocess\n): sudo /usr/local/bin/nova-rootwrap sysctl -w net.ipv4.ip_forward=1 from (pid=28327) execute /opt/stack/nova/nov\na/utils.py:176\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()\n  File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/service.py\", line 110, in run_server\n    server.start()\n  File \"/opt/stack/nova/nova/service.py\", line 183, in start\n    self.manager.init_host()\n  File \"/opt/stack/nova/nova/network/quantum/manager.py\", line 91, in init_host\n    super(QuantumManager, self).init_host()\n  File \"/opt/stack/nova/nova/network/manager.py\", line 790, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/opt/stack/nova/nova/network/quantum/manager.py\", line 120, in _setup_network_on_host\n    self.l3driver.initialize_gateway(network)\n  File \"/opt/stack/nova/nova/network/l3.py\", line 99, in initialize_gateway\n    linux_net.initialize_gateway_device(dev, network_ref)\n  File \"/opt/stack/nova/nova/network/linux_net.py\", line 534, in initialize_gateway_device\n    network_ref['cidr'].rpartition('/')[2])\n2012-05-18 11:46:54 CRITICAL nova [-] 'NoneType' object has no attribute 'rpartition'\n2012-05-18 11:46:54 TRACE nova Traceback (most recent call last):\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/bin/nova-network\", line 49, in <module>\n2012-05-18 11:46:54 TRACE nova     service.wait()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 453, in wait\n2012-05-18 11:46:54 TRACE nova     _launcher.wait()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 149, in wait\n2012-05-18 11:46:54 TRACE nova     service.wait()\n2012-05-18 11:46:54 TRACE nova   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 166, in wait\n2012-05-18 11:46:54 TRACE nova     return self._exit_event.wait()\n2012-05-18 11:46:54 TRACE nova   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2012-05-18 11:46:54 TRACE nova     return hubs.get_hub().switch()\n2012-05-18 11:46:54 TRACE nova   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 177, in switch\n2012-05-18 11:46:54 TRACE nova     return self.greenlet.switch()\n2012-05-18 11:46:54 TRACE nova   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n2012-05-18 11:46:54 TRACE nova     result = function(*args, **kwargs)\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 110, in run_server\n2012-05-18 11:46:54 TRACE nova     server.start()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 183, in start\n2012-05-18 11:46:54 TRACE nova     self.manager.init_host()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/quantum/manager.py\", line 91, in init_host\n2012-05-18 11:46:54 TRACE nova     super(QuantumManager, self).init_host()\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/manager.py\", line 790, in init_host\n2012-05-18 11:46:54 TRACE nova     self._setup_network_on_host(ctxt, network)\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/quantum/manager.py\", line 120, in _setup_network_on_host\n2012-05-18 11:46:54 TRACE nova     self.l3driver.initialize_gateway(network)\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/l3.py\", line 99, in initialize_gateway\n2012-05-18 11:46:54 TRACE nova     linux_net.initialize_gateway_device(dev, network_ref)\n2012-05-18 11:46:54 TRACE nova   File \"/opt/stack/nova/nova/network/linux_net.py\", line 534, in initialize_gateway_device\n2012-05-18 11:46:54 TRACE nova     network_ref['cidr'].rpartition('/')[2])\n2012-05-18 11:46:54 TRACE nova AttributeError: 'NoneType' object has no attribute 'rpartition'\n2012-05-18 11:46:54 TRACE nova\n\nMy configuration info:\n\n/opt/stack/devstack/stackrc :\n------------------------------------\nENABLED_SERVICES=g-api,g-reg,key,n-api,n-crt,n-obj,n-cpu,n-net,n-vol,n-sch,n-novnc,n-xvnc,n-cauth,horizon,mysql,rabbit,melange,m-svc,q-svc,quantum,q-agt\n\n/opt/stack/devstack/localrc :\n-----------------------------------\nMYSQL_PASSWORD=openstack\nRABBIT_PASSWORD=openstack\nSERVICE_TOKEN=openstack\nSERVICE_PASSWORD=openstack\nADMIN_PASSWORD=openstack\nPUBLIC_INTERFACE=eth0\nVLAN_INTERFACE=eth0\nFLAT_NETWORK_BRIDGE=br100\nFLAT_INTERFACE=eth0\nQ_PLUGIN=linuxbridge", 
            "date_created": "2012-05-18 04:01:11.539481+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhang-hare"
        }, 
        {
            "content": "", 
            "date_created": "2012-05-18 04:01:11.539481+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhang-hare"
        }, 
        {
            "content": "Here's the dump for network_ref variable:\n\n('created_at', datetime.datetime(2012, 5, 24, 7, 0, 56))\n('updated_at', datetime.datetime(2012, 5, 24, 7, 0, 56))\n('deleted_at', None)\n('deleted', False)\n('id', 1L)\n('label', u'private')\n('injected', False)\n('cidr', None)\n('cidr_v6', None)\n('multi_host', False)\n('gateway_v6', None)\n('netmask_v6', None)\n('netmask', None)\n('bridge', None)\n('bridge_interface', None)\n('gateway', None)\n('broadcast', None)\n('dns1', None)\n('dns2', None)\n('vlan', None)\n('vpn_public_address', None)\n('vpn_public_port', None)\n('vpn_private_address', None)\n('dhcp_start', u'10.0.0.2')\n('rxtx_base', None)\n('project_id', u'default')\n('priority', None)\n('host', u'ubuntu')\n('uuid', u'902ca521-e211-49f4-ad1c-527b309e469f')\n", 
            "date_created": "2012-05-24 07:43:01.120933+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhang-hare"
        }, 
        {
            "content": "With folsom, nova-network should not be run at the same time as quantum.  It appears that this is the case in this setup.  \n\nENABLED_SERVICES=g-api,g-reg,key,n-api,n-crt,n-obj,n-cpu,n-net,n-vol,n-sch,n-novnc,n-xvnc,n-cauth,horizon,mysql,rabbit,melange,m-svc,q-svc,quantum,q-agt\n\nSince this is an unsupported config, I haven't looked into the exact cause of the exception in detail, but my guess is that it is because devstack checks if quantum is enabled, and either configures nova, or configures quantum.  Likely what is happening is that nova is missing some key configuration required by nova-network, since devstack sees that quantum is running and therefore does not configure nova-network.  ", 
            "date_created": "2012-09-11 22:11:22.128044+00:00", 
            "author": "https://api.launchpad.net/1.0/~danwent"
        }
    ], 
    "closed": "2012-09-11 22:11:50.560867+00:00"
}