{
    "status": "Confirmed", 
    "last_updated": "2017-06-27 19:23:41.069680+00:00", 
    "description": "Hi All,\n\nI started building a Openstack cloud based on the new LTS version of Ubuntu (14.04). I installed both Control and Compute nodes as VM's on a XenServer. I selected the option 'Other Operating System' so this is running as HVM.\n\nThe cluster is up and running: i can start instances, create storage and allocate IP addresses. But the error i got is popping up when the instance is in spawning state. The error i attached is from the nova-compute node.\n\n...\n\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9] StorageError: Timeout waiting for device hdb to be created\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]", 
    "tags": [
        "xenserver"
    ], 
    "importance": "Medium", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1318544", 
    "owner": "None", 
    "id": 1318544, 
    "index": 3902, 
    "openned": "2014-05-12 08:42:49.037778+00:00", 
    "created": "2014-05-12 08:42:49.037778+00:00", 
    "title": "XenServer - Nova-Compute StorageError Waiting for device", 
    "comments": [
        {
            "content": "Hi All,\n\nI started building a Openstack cloud based on the new LTS version of Ubuntu (14.04). I installed both Control and Compute nodes as VM's on a XenServer. I selected the option 'Other Operating System' so this is running as HVM.\n\nThe cluster is up and running: i can start instances, create storage and allocate IP addresses. But the error i got is popping up when the instance is in spawning state. The error i attached is from the nova-compute node. \n\nI use a IBM storwize backend with Cinder connection using iSCSI. I can see the instances being created, the storage being connected but the following error is keep coming back.\n\nLocally on the XenServer SDB and SDC existed, which leaded to a earlier error in which HDB was HDC. I removed SDC locally from the XenServer using: \"echo 1 > /sys/block/sdc/device/delete\". This changed the HDC error message to HDB. The same thing i did for SDB. Both where virtual drives from DRAC. But still this message is keep popping up with HDB. \n\nI read an other article about a similar error, this guy was pointed in the direction of a HVM vs PV solution because the VM is communicating with the DOM0 via it's kernel. I checked and after installing the XenServer tools the UUID is there and is readable. \n\nWhile trying the solution above i also focused on the HDB reference, this was strange because with all the rewrite options in nova i would expect a reference to xvda: \"xenapi_remap_vbd_dev=false\"\n\nCould you guys point me in the right direction or help me solve this problem? I think this isn't a mis-configuration because i tried all possible configurations and this message keeps popping up. \n\n This is the last step towards a working openstack cloud with Ubuntu 14.04 and XenServer 6.2 all patches applied. \n\n2014-05-12 09:00:30.918 6660 ERROR nova.compute.manager [req-595bc50b-e8b2-4de4-8c38-09887c8d4c82 f8609ec1f5254fcfb1fdf6df76876805 41971b840c7a405d9da5052a2506a1c9] [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9] Error: Timeout waiting for device hdb to be created\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9] Traceback (most recent call last):\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1311, in _build_instance\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     set_access_ip=set_access_ip)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 399, in decorated_function\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     return function(self, context, *args, **kwargs)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1723, in _spawn\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     LOG.exception(_('Instance failed to spawn'), instance=instance)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     six.reraise(self.type_, self.value, self.tb)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1720, in _spawn\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     block_device_info)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 230, in spawn\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     admin_password, network_info, block_device_info)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 357, in spawn\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     network_info, block_device_info, name_label, rescue)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 526, in _spawn\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     undo_mgr.rollback_and_reraise(msg=msg, instance=instance)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 830, in rollback_and_reraise\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     self._rollback()\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     six.reraise(self.type_, self.value, self.tb)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 509, in _spawn\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     attach_devices_step(undo_mgr, vm_ref, vdis, disk_image_type)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 146, in inner\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     rv = f(*args, **kwargs)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 443, in attach_devices_step\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     attach_disks(undo_mgr, vm_ref, vdis, disk_image_type)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 390, in attach_disks\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     injected_files)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 595, in _attach_disks\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     flavor['root_gb'])\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vm_utils.py\", line 1037, in try_auto_configure_disk\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     _auto_configure_disk(session, vdi_ref, new_gb)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vm_utils.py\", line 1018, in _auto_configure_disk\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     with vdi_attached_here(session, vdi_ref, read_only=False) as dev:\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/contextlib.py\", line 17, in __enter__\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     return self.gen.next()\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vm_utils.py\", line 2200, in vdi_attached_here\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     _wait_for_device(dev)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vm_utils.py\", line 2155, in _wait_for_device\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9]     _('Timeout waiting for device %s to be created') % dev)\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9] StorageError: Timeout waiting for device hdb to be created\n2014-05-12 09:00:30.918 6660 TRACE nova.compute.manager [instance: 00e2c60e-372b-43d2-a2fd-bcc3628c24a9] \n\nBest,\n- Thijs", 
            "date_created": "2014-05-12 08:42:49.037778+00:00", 
            "author": "https://api.launchpad.net/1.0/~n-thijs"
        }, 
        {
            "content": "", 
            "date_created": "2014-05-12 08:42:49.037778+00:00", 
            "author": "https://api.launchpad.net/1.0/~n-thijs"
        }, 
        {
            "content": "Please attach a longer output from the log file; there are debug messages immediately before the TRACE that could be useful in identifying the problem.\n\nI suspect the issue is that the Nova Compute domain must be running as PV, not HVM with PV tools.  You can convert the domain using a guide such as http://wiki.univention.com/index.php?title=Citrix_Xen_Server#Convert_the_UCS_system_to_paravirtualization\n\n", 
            "date_created": "2014-05-22 14:26:30.681127+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }, 
        {
            "content": "Was this boot from volume? there is a bug that has been recently fixed in that area.\n\nWhat version of Nova is this please?", 
            "date_created": "2014-06-02 14:34:52.365253+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Long incomplete bug", 
            "date_created": "2014-09-17 11:45:25.555149+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Identified + confirmed this issue.\n\nvdi_attached_here retrieves a \"guess\" of the device name from XAPI.  When using HVM guests, XAPI assumes that the guest is Windows and therefore returns \"hdb\".  This is clearly wrong.\n\nWe need to change the _wait_for_dev function to iterate over sysfs to find the correct disk.\ne.g. assuming the UUID of the disk plugged was 8bf0e9c2-b636-4e43-a1a4-e02a339d7d82:\n{quote}\nroot@DevStackOSDomU:~# xenstore-read domid\n35\nroot@DevStackOSDomU:~# ls -d /sys/devices/vbd-*\n/sys/devices/vbd-51712  /sys/devices/vbd-51728\n\nroot@DevStackOSDomU:~# xenstore-read /local/domain/0/backend/vbd/35/51712/vdi\n[\"VDI\", \"1a6bad09-c13f-c7dd-b0af-cfb7e8de518c\\\\/9dcb54df-71f0-46eb-8db5-400f62e68629\"]\n\nroot@DevStackOSDomU:~# xenstore-read /local/domain/0/backend/vbd/35/51728/vdi\n[\"VDI\", \"1a6bad09-c13f-c7dd-b0af-cfb7e8de518c\\\\/8bf0e9c2-b636-4e43-a1a4-e02a339d7d82\"]\n\nroot@DevStackOSDomU:~# ls /sys/devices/vbd-51728/block\nxvdb\n{/quote}\n\n", 
            "date_created": "2015-07-17 15:54:58.124092+00:00", 
            "author": "https://api.launchpad.net/1.0/~bob-ball"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/213112", 
            "date_created": "2015-08-14 12:01:23.928003+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/213112\nReason: This patch has been sitting unchanged for more than 12 weeks. I am therefore going to abandon it to keep the nova review queue sane. Please feel free to restore the change if you're still working on it.", 
            "date_created": "2016-10-25 16:10:45.843037+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Huan Xie (<email address hidden>) on branch: master\nReview: https://review.openstack.org/213112\nReason: Will move the fix in os-xenapi", 
            "date_created": "2016-11-16 02:07:36.350980+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "There are no currently open reviews on this bug, changing the status back to the previous state and unassigning. If there are active reviews related to this bug, please include links in comments. ", 
            "date_created": "2017-06-27 19:23:38.016692+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}