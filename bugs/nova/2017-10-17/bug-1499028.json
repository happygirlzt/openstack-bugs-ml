{
    "status": "Fix Released", 
    "last_updated": "2015-10-23 15:35:37.127663+00:00", 
    "description": "https://review.openstack.org/#/c/200485/ patch makes rebuild use migration context added earlier in Liberty for proper resource tracking when doing rebuild/evacuate. \n\nSadly the above patch missed that we need to make sure we set the proper data from the context when calling the driver methods so that we make sure the stashed migration context data is applied when rebuilding.\n\nHEAD at 568be05", 
    "tags": [
        "in-stable-liberty", 
        "liberty-rc-potential"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1499028", 
    "owner": "https://api.launchpad.net/1.0/~ndipanov", 
    "id": 1499028, 
    "index": 4359, 
    "openned": "2015-09-23 18:19:52.238737+00:00", 
    "created": "2015-09-23 18:19:52.238737+00:00", 
    "title": "Rebuild would not apply the migration context before calling the driver", 
    "comments": [
        {
            "content": "https://review.openstack.org/#/c/200485/ patch makes rebuild use migration context added earlier in Liberty for proper resource tracking when doing rebuild/evacuate. \n\nSadly the above patch missed that we need to make sure we set the proper data from the context when calling the driver methods so that we make sure the stashed migration context data is applied when rebuilding.\n\nHEAD at 568be05", 
            "date_created": "2015-09-23 18:19:52.238737+00:00", 
            "author": "https://api.launchpad.net/1.0/~ndipanov"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/226923", 
            "date_created": "2015-09-23 18:27:38.090154+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/226923\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=66e0744471ce491371a67ffdd8ba3c105919e255\nSubmitter: Jenkins\nBranch:    master\n\ncommit 66e0744471ce491371a67ffdd8ba3c105919e255\nAuthor: Nikola Dipanov <email address hidden>\nDate:   Wed Sep 23 19:21:16 2015 +0100\n\n    rebuild: Apply migration context before calling the driver\n    \n    In I0233f964d8f294f0ffd9edcb16b1aaf93486177f we made sure that we are\n    properly using the data stashed in the migration context for resource\n    tracking, however - we missed that we need to also apply it when passing\n    data to the driver to do the spawn (or rebuild if implemented).\n    \n    This patch adds a context manager that helps us temporarily apply the\n    migration context to an instance object, as we want to make sure that we\n    don't save the new data before it's ready to be used by the resource\n    tracker.\n    \n    Change-Id: I9a4b86e176f408c1495d5308d3e7041292c2625a\n    Closes-bug: #1499028\n", 
            "date_created": "2015-09-29 10:38:17.076116+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/liberty\nReview: https://review.openstack.org/228843", 
            "date_created": "2015-09-29 11:01:07.007889+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/228843\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=fb23e596542d6bd052f5d3c5e193ffea7bb26028\nSubmitter: Jenkins\nBranch:    stable/liberty\n\ncommit fb23e596542d6bd052f5d3c5e193ffea7bb26028\nAuthor: Nikola Dipanov <email address hidden>\nDate:   Wed Sep 23 19:21:16 2015 +0100\n\n    rebuild: Apply migration context before calling the driver\n    \n    In I0233f964d8f294f0ffd9edcb16b1aaf93486177f we made sure that we are\n    properly using the data stashed in the migration context for resource\n    tracking, however - we missed that we need to also apply it when passing\n    data to the driver to do the spawn (or rebuild if implemented).\n    \n    This patch adds a context manager that helps us temporarily apply the\n    migration context to an instance object, as we want to make sure that we\n    don't save the new data before it's ready to be used by the resource\n    tracker.\n    \n    Change-Id: I9a4b86e176f408c1495d5308d3e7041292c2625a\n    Closes-bug: #1499028\n    (cherry picked from commit 66e0744471ce491371a67ffdd8ba3c105919e255)\n", 
            "date_created": "2015-10-03 15:39:06.763657+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/235181", 
            "date_created": "2015-10-15 09:20:37.446881+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/235181\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=d8a3b9d6408627ce9a293d1e62d003757af655a1\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6df6ad3ff32f2b1fe2978df1032002548ad8eb66\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Wed Oct 7 08:11:35 2015 -0700\n\n    Omnibus stable/liberty fix\n    \n    There are currently 3 different blocking issues in stable/liberty due\n    to library releases: webob 1.5, oslo.db 3.0.0, and\n    oslo.versionedobjects 0.11.0. This is a squashed fix for all of them\n    as none can land without the others.\n    \n    Issue #1 - oslo.db\n    \n    Add testresources used by oslo.db fixture\n    \n    If we use oslo.db fixtures, we'll need the package or\n    the next version of oslo.db release will break us.\n    \n    (Cherry-picked from 4bcc26487837b7ece7797f88622dea1b6d09bd94)\n    \n    Closes-Bug: #1503501\n    \n    Issue #2 - oslo.versionedobjects\n    \n    Drop unused obj_to_primitive() override\n    \n    This was a band-aid override until o.vo gained the obj_relationships fix\n    that this method overrides. That has been in place since o.vo 0.8.0, which\n    means this is long since no longer necessary (and is actually blocking our\n    ability to absorb bug fixes to this code in o.vo). Further, we no longer\n    use this directly because we're doing backports based on version manifests,\n    which means we no longer consult child_versions _or_ obj_relationships.\n    \n    (cherry picked from commit 142f1d9cc4ace90956c665c40b1f78795f9f7e29)\n    \n    Issue #3 - webob\n    \n    Default ConvertedException code to 500\n    \n    webob 1.5.0 released on 10/11 has change f6c749011 which\n    strictly enforces status codes in exceptions, and 0 is not\n    a valid status code so tests fail.\n    \n    Change the default to 500 to match the default in the parent\n    class in webob.\n    \n    Closes-Bug: #1505153\n    (cherry picked from commit 10438c0fc34bd088e018e1a5e8ec57b396528792)\n    \n    Change-Id: I1e06e77308a7dd23209124f0807d61fb52470188\n\ncommit 606204354b5ed96852240020769c81acda9f9fc8\nAuthor: Matt Riedemann <email address hidden>\nDate:   Mon Oct 5 20:32:58 2015 +0000\n\n    Revert \"[libvirt] Move cleanup of imported files to imagebackend\"\n    \n    This reverts commit 9ba70756de326ffaa8be43acfde12cad04ed0af2\n    \n    The change introduced an UnboundLocalError if we fail to\n    create the config_drive_image variable. Also, the original\n    change didn't have any unit tests and came late in the\n    liberty release so I don't really want to mess with fixing\n    this given we need the fix in liberty-rc2.\n    \n    Change-Id: Ia7b70aa139b67cf58b5c0f9fbcd2a4deb465914e\n    Closes-Bug: #1502961\n\ncommit ef655379445693443146f8a3ed31cabb011d9937\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Thu Oct 8 06:41:06 2015 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: Idcac653033ab9808e06451a0dd690db4736834b2\n\ncommit eda3029aa74932f421d2992ac24f5ac3c92f347c\nAuthor: Dan Smith <email address hidden>\nDate:   Tue Oct 6 10:58:18 2015 -0700\n\n    Fix InstanceV1 backports to use context\n    \n    This fixes the InstanceV1 and InstanceListV1 backport code to properly\n    initialize the temporary objects with a context. Without them, the\n    objects are orphaned and can't do certain things.\n    \n    This should be backported to liberty\n    \n    Closes-Bug: #1503708\n    Change-Id: I537734c0f10110ac64799cc1232edbc18a16c794\n    (cherry picked from commit e571d88604353a0443ae4ca24e3ce72fb4c615f2)\n\ncommit 6cc3f4f6043e83d5d180a51bac5b9254cee8245e\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Tue Oct 6 06:39:20 2015 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: Ib23288ea4eefac2f44cc9ac6bcb672dba4c3f6cb\n\ncommit 8af97531e3fbd2f24c091f14c3a20cacf538cff2\nAuthor: Jim Rollenhagen <email address hidden>\nDate:   Thu Oct 1 21:12:53 2015 -0700\n\n    Ironic: Fix bad capacity reporting if instance_info is unset\n    \n    If node.instance_info is unset for a node that has an instance on it\n    (for example, when upgrading Nova from before the patch that set these\n    values on spawn), the Ironic driver reports 0 for both $resource and\n    $resource_used. The resource tracker will correct $resource_used, and\n    resources available will be reported as a negative number.\n    \n    Correct this by reporting the original value if instance_info is unset.\n    \n    Closes-Bug: #1502177\n    Change-Id: I13c5e5430fd305cd0ee2f24cd95304660ccf11eb\n    (cherry picked from commit 047da6498dbb3af71bcb9e6d0e2c38aa23b06615)\n\ncommit a79e09548844fdb02b96a7f033efc0b23e7882e3\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Mon Oct 5 06:33:17 2015 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: I7ad39496a3e4bab408d208c88b2e2e4b9f776b7c\n\ncommit 83089e7e67ca0149f9637d73448edfcba1edbf84\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Sat Oct 3 06:34:44 2015 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: I2ddf857098bbda7048caadb752b659f446d192cc\n\ncommit c24bf9e469dbc2df8e8b8900015197dc7c388e8c\nAuthor: Matt Riedemann <email address hidden>\nDate:   Fri Oct 2 13:00:43 2015 -0700\n\n    libvirt: check if ImageMeta.disk_format is set before accessing it\n    \n    Commit 4f43bbafa4bfc2ab149d5db4eb55320c1602658b changed\n    blockinfo.get_root_info to access the disk_format attribute on the\n    passed in image_meta (ImageMeta object) like an object, but if that\n    attribute is not set you'll get an error.\n    \n    image_meta can be an empty object in the case of evacuate where\n    image_ref is passed as None to the compute manager's rebuild_instance\n    method in the case of evacuate, so image_meta defaults to {}. So when\n    the ImageMeta object is created in LibvirtDriver.spawn, there is nothing\n    in it.\n    \n    We have to check if the attribute is set before accessing it using\n    obj_attr_is_set because the ImageMeta class does not include the\n    NovaObjectDictCompat mixin, so we can't use\n    image_meta.get('disk_format').\n    \n    Closes-Bug: #1501831\n    \n    Change-Id: I95e543415b881603bb997ae0e159017c03e58a53\n    (cherry picked from commit 2b1a2bc034e371a9f6d95f48ed8fa77e0854d675)\n\ncommit 579b02163e66502d22812f91d82e65f4019bedd4\nAuthor: Tony Breeds <email address hidden>\nDate:   Fri Oct 2 12:28:42 2015 +1000\n\n    Add Pillow to test-requirements.txt\n    \n    Pillow isn't directly used by nova but it is used by\n    sphinxcontrib-seqdiag.\n    \n    Add it to test-requirements as a work around to:\n    http://lists.openstack.org/pipermail/openstack-dev/2015-October/076030.html\n    \n    Change-Id: I4face1fdb56c30bfeffca8808f422565eb21de83\n    (cherry picked from commit 03cae1c43124d03e747ea51cfcbc0737bbf4287a)\n\ncommit 2dbd0512ed4e51edab2a2f2d23d759ae8da9dc0c\nAuthor: Andreas Jaeger <email address hidden>\nDate:   Thu Sep 24 20:39:16 2015 +0200\n\n    Cleanup of Translations\n    \n    In preparation for the release, do some cleanups for translations.\n    \n    Removes all po files that are partially translated. The translation\n    team has decided to exclude files with less than 66 % of translated\n    content. There is no content lost, all data is in the translation\n    server, we just remove it from the repository.\n    \n    This change needs to be done manually since the automatic import does\n    not handle some of these cases.\n    \n    Change-Id: I662f6af336947188c74ea439ebba308bd4055fb8\n\ncommit fb23e596542d6bd052f5d3c5e193ffea7bb26028\nAuthor: Nikola Dipanov <email address hidden>\nDate:   Wed Sep 23 19:21:16 2015 +0100\n\n    rebuild: Apply migration context before calling the driver\n    \n    In I0233f964d8f294f0ffd9edcb16b1aaf93486177f we made sure that we are\n    properly using the data stashed in the migration context for resource\n    tracking, however - we missed that we need to also apply it when passing\n    data to the driver to do the spawn (or rebuild if implemented).\n    \n    This patch adds a context manager that helps us temporarily apply the\n    migration context to an instance object, as we want to make sure that we\n    don't save the new data before it's ready to be used by the resource\n    tracker.\n    \n    Change-Id: I9a4b86e176f408c1495d5308d3e7041292c2625a\n    Closes-bug: #1499028\n    (cherry picked from commit 66e0744471ce491371a67ffdd8ba3c105919e255)\n\ncommit 3be67646c46f7ca58b570770074c1f269c187a30\nAuthor: He Jie Xu <email address hidden>\nDate:   Mon Sep 28 13:24:06 2015 +0800\n\n    Correct Instance type check to work with InstanceV1\n    \n    When Liberty controller running with Kilo compute node, the Kilo\n    compute node will send the InstanceV1 to the Liberty controller.\n    Then all the checks like \"isinstance(instance, objects.Instance)\"\n    on the Liberty controller won't works. Because objects.Instance\n    pointed to objects.InstanceV2 now.\n    \n    This patch corrects all the Instance type check to make sure the\n    upgrade works.\n    \n    Change-Id: Ib431c08dc6934631a71ef55c564fbbf4bde22642\n    Closes-bug: #1500289\n    (cherry picked from commit 093272489ceb13d4df26916c7ed8b66e39f7c1a4)\n\ncommit 51d74bdf18df39695ad5e500db6db830f21da36a\nAuthor: Yingxin Cheng <email address hidden>\nDate:   Wed Sep 9 11:20:19 2015 -0400\n\n    Fix MetricWeigher to use MonitorMetricList\n    \n    The commit I4dfbea27ce6c3eecc1a8658b1f9dc0feb2298705 changes\n    'HostState.metrics' to 'objects.MonitorMetricList'. But MetricWeigher\n    still use the old dictionary of 'host_manager.MetricItem'. This patch\n    corrects the behavior of MetricWeigher with related tests, and delete\n    unused MetricItem.\n    \n    Co-Authored-By: Sylvain Bauza <email address hidden>\n    \n    Closes-Bug: #1493680\n    (cherry picked from commit fd2b868d41a632748939b82ed1b8927adcdfb113)\n    \n    Fix NoneType error when calling MetricsWeigher\n    \n    (this is a squashed commit since commit fd2b868 was buggy)\n    Given that dict comprehensions don't allow to have None as a list, we had\n    a problem with the Ironic gate-ironic-inspector-dsvm job because\n    host_state.metrics was set to None by default.\n    \n    Adding a unittest to make sure we don't regress.\n    \n    Closes-Bug: #1499271\n    (cherry picked from commit ccea5d6b0ace535b375d3e63bd572885cb5dbc91)\n    \n    Change-Id: I9690bc4f6f1dca8f2bf8c5a83f16af6200015506\n", 
            "date_created": "2015-10-23 15:35:36.711304+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-10-05 09:56:18.370598+00:00"
}