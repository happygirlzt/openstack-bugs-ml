{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:27:33.253327+00:00", 
    "description": "Bug 754900 fixes a long standing issue of not deleting from fixed_ips when a network is deleted. However, the manner in which it \"deletes\" a fixed_ip (by setting the deleted column to true) is inconsistent with how the network is deleted (by actually deleting the record). Running `nova-manage fixed list` does not seem to honor the deleted column of fixed_ips, and proceeds to complain about the non-existent network.\n\nThe networks table has a deleted column, but it doesn't seem to be used. For the sake of audit-ability (hence the deleted column), shouldn't deleting a network just mark it as deleted, and all tools modified to honor the deleted state? If audit-ability is handled in another manner, shouldn't the fixed_ips records be deleted, as the associated network is?\n\nStep to reproduce:\n\n$ sudo nova-manage network list\n\nid   \tIPv4              \tIPv6           \tstart address  \tDNS1           \tDNS2           \tVlanID         \tproject        \tuuid\n1    \t10.0.19.0/24      \tNone           \t10.0.19.3      \tNone           \tNone           \t100            \ttenant1        \t99658bf1-f2fc-46ce-9adf-83bd7f7cdb72\n2    \t10.1.19.0/24      \tNone           \t10.1.19.3      \tNone           \tNone           \t101            \ttenant2        \tdd660168-81b8-4b6f-b054-a5d1b8d5b293\n\n$ sudo nova-manage network modify 10.0.19.0/24 --disassociate-project\n$ sudo nova-manage network delete 10.0.19.0/24\n$ sudo nova-manage network list\n\nid   \tIPv4              \tIPv6           \tstart address  \tDNS1           \tDNS2           \tVlanID         \tproject        \tuuid\n2    \t10.1.19.0/24      \tNone           \t10.1.19.3      \tNone           \tNone           \t101            \ttenant2        \tdd660168-81b8-4b6f-b054-a5d1b8d5b293\n\n$ sudo nova-manage fixed list\n\nnetwork           \tIP address     \thostname       \thost\nCommand failed, please check log for more info\n2012-07-06 11:04:31 CRITICAL nova [req-1de63acb-5a4b-40f0-9aee-53e86806dbee None None] Network 1 could not be found.\n2012-07-06 11:04:31 TRACE nova Traceback (most recent call last):\n2012-07-06 11:04:31 TRACE nova   File \"/usr/bin/nova-manage\", line 1746, in <module>\n2012-07-06 11:04:31 TRACE nova     main()\n2012-07-06 11:04:31 TRACE nova   File \"/usr/bin/nova-manage\", line 1733, in main\n2012-07-06 11:04:31 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-07-06 11:04:31 TRACE nova   File \"/usr/bin/nova-manage\", line 584, in list\n2012-07-06 11:04:31 TRACE nova     fixed_ip['network_id'])\n2012-07-06 11:04:31 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 755, in network_get\n2012-07-06 11:04:31 TRACE nova     return IMPL.network_get(context, network_id)\n2012-07-06 11:04:31 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\n2012-07-06 11:04:31 TRACE nova     return f(*args, **kwargs)\n2012-07-06 11:04:31 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1933, in network_get\n2012-07-06 11:04:31 TRACE nova     raise exception.NetworkNotFound(network_id=network_id)\n2012-07-06 11:04:31 TRACE nova NetworkNotFound: Network 1 could not be found.\n2012-07-06 11:04:31 TRACE nova\n\nVersions:\n\nUbuntu - 12.04 LTS\nNova - 2012.1+stable~20120612-3ee026e-0ubuntu1.1", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1021810", 
    "owner": "https://api.launchpad.net/1.0/~litong01", 
    "id": 1021810, 
    "index": 2964, 
    "openned": "2012-07-06 16:46:46.674037+00:00", 
    "created": "2012-07-06 16:46:46.674037+00:00", 
    "title": "`nova-manage fixed list` fails if network has been deleted", 
    "comments": [
        {
            "content": "Bug 754900 fixes a long standing issue of not deleting from fixed_ips when a network is deleted. However, the manner in which it \"deletes\" a fixed_ip (by setting the deleted column to true) is inconsistent with how the network is deleted (by actually deleting the record). Running `nova-manage fixed list` does not seem to honor the deleted column of fixed_ips, and proceeds to complain about the non-existent network.\n\nThe networks table has a deleted column, but it doesn't seem to be used. For the sake of audit-ability (hence the deleted column), shouldn't deleting a network just marked it as deleted, and all tools modified to honor the deleted state? If audit-ability is handled in another manner, shouldn't the fixed_ips records be deleted, as the associated network is?\n\nStep to reproduce:\n\n$ sudo nova-manage network list\n\nid   \tIPv4              \tIPv6           \tstart address  \tDNS1           \tDNS2           \tVlanID         \tproject        \tuuid           \n1    \t10.0.19.0/24      \tNone           \t10.0.19.3      \tNone           \tNone           \t100            \ttenant1        \t99658bf1-f2fc-46ce-9adf-83bd7f7cdb72\n2    \t10.1.19.0/24      \tNone           \t10.1.19.3      \tNone           \tNone           \t101            \ttenant2        \tdd660168-81b8-4b6f-b054-a5d1b8d5b293\n\n$ sudo nova-manage network modify 10.0.19.0/24 --disassociate-project\n$ sudo nova-manage network delete 10.0.19.0/24\n$ sudo nova-manage network list\n\nid   \tIPv4              \tIPv6           \tstart address  \tDNS1           \tDNS2           \tVlanID         \tproject        \tuuid           \n2    \t10.1.19.0/24      \tNone           \t10.1.19.3      \tNone           \tNone           \t101            \ttenant2        \tdd660168-81b8-4b6f-b054-a5d1b8d5b293\n\n$ sudo nova-manage fixed list\n\nnetwork           \tIP address     \thostname       \thost\nCommand failed, please check log for more info\n2012-07-06 11:04:31 CRITICAL nova [req-1de63acb-5a4b-40f0-9aee-53e86806dbee None None] Network 1 could not be found.\n2012-07-06 11:04:31 TRACE nova Traceback (most recent call last):\n2012-07-06 11:04:31 TRACE nova   File \"/usr/bin/nova-manage\", line 1746, in <module>\n2012-07-06 11:04:31 TRACE nova     main()\n2012-07-06 11:04:31 TRACE nova   File \"/usr/bin/nova-manage\", line 1733, in main\n2012-07-06 11:04:31 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-07-06 11:04:31 TRACE nova   File \"/usr/bin/nova-manage\", line 584, in list\n2012-07-06 11:04:31 TRACE nova     fixed_ip['network_id'])\n2012-07-06 11:04:31 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 755, in network_get\n2012-07-06 11:04:31 TRACE nova     return IMPL.network_get(context, network_id)\n2012-07-06 11:04:31 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\n2012-07-06 11:04:31 TRACE nova     return f(*args, **kwargs)\n2012-07-06 11:04:31 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1933, in network_get\n2012-07-06 11:04:31 TRACE nova     raise exception.NetworkNotFound(network_id=network_id)\n2012-07-06 11:04:31 TRACE nova NetworkNotFound: Network 1 could not be found.\n2012-07-06 11:04:31 TRACE nova \n\n\nVersions:\n\nUbuntu - 12.04 LTS\nNova - 2012.1+stable~20120612-3ee026e-0ubuntu1.1", 
            "date_created": "2012-07-06 16:46:46.674037+00:00", 
            "author": "https://api.launchpad.net/1.0/~byron-mccollum"
        }, 
        {
            "content": "The problem is that in nova-manage, the code catches exception.NetworkNotFound and blindly say \"Command failed, please check log for more info\" regardless what the exception might be. \n\nWith latest code as July 17, 2012,  in the scenario you described, the following command will both produce that error.\n\nwith latest code, July 17, 2012,\n\n$nova-manage fixed list \nnetwork                 IP address      hostname        host\n10.0.0.0/24             10.0.0.0        None            None\n10.0.0.0/24             10.0.0.1        None            None\n10.0.0.0/24             10.0.0.2        None            None\n10.0.0.0/24             10.0.0.3        None            None\n10.0.0.0/24             10.0.0.4        None            None\n\n$nova-manage network list\nid      IPv4                    IPv6            start address   DNS1            DNS2            VlanID          project         uuid\n1       10.0.0.0/24             None            10.0.0.2        8.8.4.4         None            None            None            0440a6eb-9407-4aeb-a9db-05c38211ee0a\n\n$nova-manage network delete 10.0.0.0/24\n\n$nova-manage fixed list\nnetwork                 IP address      hostname        host\nCommand failed, please check log for more info\n\n$ nova-manage network list\nid      IPv4                    IPv6            start address   DNS1            DNS2            VlanID          project         uuid\nCommand failed, please check log for more info\n\nThe fixes should be in file nova/bin/nova-manage", 
            "date_created": "2012-07-17 18:31:08.039872+00:00", 
            "author": "https://api.launchpad.net/1.0/~litong01"
        }, 
        {
            "content": "Status changed to 'Confirmed' because the bug affects multiple users.", 
            "date_created": "2012-07-17 18:55:22.176884+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/9967", 
            "date_created": "2012-07-18 15:27:19.886770+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/9967\nCommitted: http://github.com/openstack/nova/commit/458a5d61eac5eb5cef34ab301b67fa37271ba407\nSubmitter: Jenkins\nBranch:    master\n\ncommit 458a5d61eac5eb5cef34ab301b67fa37271ba407\nAuthor: Tong Li <email address hidden>\nDate:   Wed Jul 18 11:26:12 2012 -0400\n\n    fixes for nova-manage network list  if network has been deleted\n    \n    this fix addresses the  bug #1021810\n    Currently command 'nova-manage network list' or\n    'nova-manage fixed list'  will return 'Command failed.' message when\n    there is no network defined or networks get deleted. This fix combined\n    with fixes to bug 1025827 will fix both command problem.\n    also change the print out message so that it can be translated.\n    code structure changes according to the suggestion from comments.\n    \n    Change-Id: Id9a1a10217aac971cbbba9db5829c8478892db1a\n", 
            "date_created": "2012-07-20 19:24:02.496148+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-08-16 07:35:46.074832+00:00"
}