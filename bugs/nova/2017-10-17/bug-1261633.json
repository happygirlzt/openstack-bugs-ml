{
    "status": "Fix Released", 
    "last_updated": "2014-03-19 22:10:32.432117+00:00", 
    "description": "Tenant of admin create vm in another tenant network,then   deleting that vm will failed,the failed log is bellow\nmy environment is: OS  ubuntu 12.04 \nopenstack package:2013.2-0ubuntu1~cloud0 \n\nTRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n     **args)\n   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n     result = getattr(proxyobj, method)(ctxt, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 353, in decorated_function\n     return function(self, context, *args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 90, in wrapped\n     payload)\n   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 73, in wrapped\n     return f(self, context, *args, **kw)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 243, in decorated_function\n     pass\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 229, in decorated_function\n    return function(self, context, *args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 294, in decorated_function\n     function(self, context, *args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 271, in decorated_function\n     e, sys.exc_info())\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 258, in decorated_function\n     return function(self, context, *args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1792, in terminate_instance\n     do_terminate_instance(instance, bdms)\n   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 246, in inner\n     return f(*args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1784, in do_terminate_instance\n     reservations=reservations)\n   File \"/usr/lib/python2.7/dist-packages/nova/hooks.py\", line 105, in inner\n     rv = f(*args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1757, in _delete_instance\n     user_id=user_id)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1729, in _delete_instance\n     self._shutdown_instance(context, db_inst, bdms)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1639, in _shutdown_instance\n     network_info = self._get_instance_nw_info(context, instance)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 876, in _get_instance_nw_info\n     instance)\n   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 455, in get_instance_nw_info\n     result = self._get_instance_nw_info(context, instance, networks)\n   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 463, in _get_instance_nw_info\n     nw_info = self._build_network_info_model(context, instance, networks)\n   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 997, in _build_network_info_model\n     ports = [port for port in ports if port['network_id'] in net_ids]\n   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 962, in _nw_info_build_network\n     label=network_name,\n UnboundLocalError: local variable 'network_name' referenced before assignment\n\nI analyse the failed log, in  _build_network_info_model\n\nnetworks = self._get_available_networks(context,\n                                                    instance['project_id'])\nwhen tenant of admin deleting vm, nova get network according to the tenant ID ,but that network  doesn't belong to admin,so the error  \" local variable 'network_name' referenced before assignment \" happens", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/1261633", 
    "owner": "https://api.launchpad.net/1.0/~shihanzhang", 
    "id": 1261633, 
    "index": 3748, 
    "openned": "2013-12-17 06:44:33.466208+00:00", 
    "created": "2013-12-17 06:44:33.466208+00:00", 
    "title": "tenant of admin delete vm failed", 
    "comments": [
        {
            "content": "Tenant of admin create vm in another tenant network,then   deleting that vm will failed,the failed log is bellow\nmy environment is: OS  ubuntu 12.04 \nopenstack package:2013.2-0ubuntu1~cloud0 \n\nTRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n     **args)\n   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n     result = getattr(proxyobj, method)(ctxt, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 353, in decorated_function\n     return function(self, context, *args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 90, in wrapped\n     payload)\n   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 73, in wrapped\n     return f(self, context, *args, **kw)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 243, in decorated_function\n     pass\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 229, in decorated_function\n    return function(self, context, *args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 294, in decorated_function\n     function(self, context, *args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 271, in decorated_function\n     e, sys.exc_info())\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 258, in decorated_function\n     return function(self, context, *args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1792, in terminate_instance\n     do_terminate_instance(instance, bdms)\n   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 246, in inner\n     return f(*args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1784, in do_terminate_instance\n     reservations=reservations)\n   File \"/usr/lib/python2.7/dist-packages/nova/hooks.py\", line 105, in inner\n     rv = f(*args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1757, in _delete_instance\n     user_id=user_id)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1729, in _delete_instance\n     self._shutdown_instance(context, db_inst, bdms)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1639, in _shutdown_instance\n     network_info = self._get_instance_nw_info(context, instance)\n   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 876, in _get_instance_nw_info\n     instance)\n   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 455, in get_instance_nw_info\n     result = self._get_instance_nw_info(context, instance, networks)\n   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 463, in _get_instance_nw_info\n     nw_info = self._build_network_info_model(context, instance, networks)\n   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 997, in _build_network_info_model\n     ports = [port for port in ports if port['network_id'] in net_ids]\n   File \"/usr/lib/python2.7/dist-packages/nova/network/neutronv2/api.py\", line 962, in _nw_info_build_network\n     label=network_name,\n UnboundLocalError: local variable 'network_name' referenced before assignment\n\nI analyse the failed log, in  _build_network_info_model\n\nnetworks = self._get_available_networks(context,\n                                                    instance['project_id'])\nwhen tenant of admin deleting vm, nova get network according to the tenant ID ,but that network  doesn't belong to admin,so the error  \" local variable 'network_name' referenced before assignment \" happens", 
            "date_created": "2013-12-17 06:44:33.466208+00:00", 
            "author": "https://api.launchpad.net/1.0/~shihanzhang"
        }, 
        {
            "content": "I will fix the bug as soon as possible!", 
            "date_created": "2013-12-17 06:59:55.134703+00:00", 
            "author": "https://api.launchpad.net/1.0/~shihanzhang"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/62583", 
            "date_created": "2013-12-17 09:05:34.840377+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/63040", 
            "date_created": "2013-12-19 01:21:19.893674+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "The two proposed fixes for this issue were abandoned, yet the bug is marked as \"fix released\". I've been trying to find the fix and have been unable to. Any pointers?", 
            "date_created": "2014-03-19 22:10:31.730745+00:00", 
            "author": "https://api.launchpad.net/1.0/~fghaas"
        }
    ], 
    "closed": "2014-02-25 07:00:23.624694+00:00"
}