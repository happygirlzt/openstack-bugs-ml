{
    "status": "Invalid", 
    "last_updated": "2017-08-02 11:33:16.220555+00:00", 
    "description": "When migrating VMs I get the following error message in Nova API logs with the Newton release:\n\nUnexpected exception in API method\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n    return f(*args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/migrate_server.py\", line 52, in _migrate\n    self.compute_api.resize(req.environ['nova.context'], instance)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 166, in inner\n    return function(self, context, instance, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 173, in _wrapped\n    return fn(self, context, instance, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 147, in inner\n    return f(self, context, instance, *args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 3033, in resize\n    request_spec=request_spec)\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/api.py\", line 192, in resize_instance\n    request_spec=request_spec)\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/rpcapi.py\", line 317, in migrate_server\n    return cctxt.call(context, 'migrate_server', **kw)\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 169, in call\n    retry=self.retry)\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 97, in _send\n    timeout=timeout, retry=retry)\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 464, in send\n    retry=retry)\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 455, in _send\n    raise result\nRequestSpecNotFound_Remote: RequestSpec not found for instance 6415561e-d93e-4497-bec4-572aa24544a9\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming\n    res = self.dispatcher.dispatch(message)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\n    return self._do_dispatch(endpoint, method, ctxt, args)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch\n    result = func(ctxt, **new_args)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 199, in inner\n    return func(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/utils.py\", line 613, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 220, in migrate_server\n    reservations, clean_shutdown, request_spec)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 287, in _cold_migrate\n    request_spec.save()\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 226, in wrapper\n    return fn(self, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/objects/request_spec.py\", line 484, in save\n    db_spec = self._save_in_db(self._context, self.instance_uuid, updates)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 824, in wrapper\n    return fn(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/objects/request_spec.py\", line 476, in _save_in_db\n    instance_uuid)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 824, in wrapper\n    return fn(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/objects/request_spec.py\", line 425, in _get_by_instance_uuid_from_db\n    instance_uuid=instance_uuid)\n\nRequestSpecNotFound: RequestSpec not found for instance 6415561e-d93e-4497-bec4-572aa24544a9\n\nHTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'RequestSpecNotFound_Remote'>\n192.168.32.26 \"POST /v2.1/d7400e965d5a40a79708649ae64a9d85/servers/6415561e-d93e-4497-bec4-572aa24544a9/action HTTP/1.1\" status: 500 len: 567 time: 0.5891929", 
    "tags": [
        "conductor"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1707934", 
    "owner": "None", 
    "id": 1707934, 
    "index": 8233, 
    "openned": "2017-08-01 14:37:45.509331+00:00", 
    "created": "2017-08-01 14:37:45.509331+00:00", 
    "title": "RequestSpec not found error message during VM migration", 
    "comments": [
        {
            "content": "When migrating VMs I get the following error message in Nova API logs with the Newton release:\n\nUnexpected exception in API method\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n    return f(*args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/migrate_server.py\", line 52, in _migrate\n    self.compute_api.resize(req.environ['nova.context'], instance)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 166, in inner\n    return function(self, context, instance, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 173, in _wrapped\n    return fn(self, context, instance, *args, **kwargs)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 147, in inner\n    return f(self, context, instance, *args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 3033, in resize\n    request_spec=request_spec)\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/api.py\", line 192, in resize_instance\n    request_spec=request_spec)\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/rpcapi.py\", line 317, in migrate_server\n    return cctxt.call(context, 'migrate_server', **kw)\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 169, in call\n    retry=self.retry)\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 97, in _send\n    timeout=timeout, retry=retry)\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 464, in send\n    retry=retry)\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 455, in _send\n    raise result\nRequestSpecNotFound_Remote: RequestSpec not found for instance 6415561e-d93e-4497-bec4-572aa24544a9\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming\n    res = self.dispatcher.dispatch(message)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\n    return self._do_dispatch(endpoint, method, ctxt, args)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch\n    result = func(ctxt, **new_args)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 199, in inner\n    return func(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/compute/utils.py\", line 613, in decorated_function\n    return function(self, context, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 220, in migrate_server\n    reservations, clean_shutdown, request_spec)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/conductor/manager.py\", line 287, in _cold_migrate\n    request_spec.save()\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 226, in wrapper\n    return fn(self, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/objects/request_spec.py\", line 484, in save\n    db_spec = self._save_in_db(self._context, self.instance_uuid, updates)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 824, in wrapper\n    return fn(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/objects/request_spec.py\", line 476, in _save_in_db\n    instance_uuid)\n\n  File \"/usr/lib/python2.7/dist-packages/oslo_db/sqlalchemy/enginefacade.py\", line 824, in wrapper\n    return fn(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/dist-packages/nova/objects/request_spec.py\", line 425, in _get_by_instance_uuid_from_db\n    instance_uuid=instance_uuid)\n\nRequestSpecNotFound: RequestSpec not found for instance 6415561e-d93e-4497-bec4-572aa24544a9\n\nHTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<class 'RequestSpecNotFound_Remote'>\n192.168.32.26 \"POST /v2.1/d7400e965d5a40a79708649ae64a9d85/servers/6415561e-d93e-4497-bec4-572aa24544a9/action HTTP/1.1\" status: 500 len: 567 time: 0.5891929", 
            "date_created": "2017-08-01 14:37:45.509331+00:00", 
            "author": "https://api.launchpad.net/1.0/~kleini76"
        }, 
        {
            "content": "Looks like you tried to migrate an instance that was created in Nova in a previous release (Mitaka or older). Did you upgraded your cloud ?\n\nIf so, you need to run nova-manage db online_data_migrations in order to make sure you create the RequestSpec records for all instances created before Newton.\nFor those created in Newton, they will automatically have a new RequestSpec record so when we update that record when you cold-migrate, it's not getting you an exception.\n\nI leave you push the bug report back to Confirmed if I'm wrong.", 
            "date_created": "2017-08-02 10:47:06.996175+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "The problem is, that there is no upgrade guide any more since the Liberty release. Manually set up clouds are pretty lost without these upgrade guides. The existing upgrade guides just cover openstack-ansible, which is not usable when you initially set up OpenStack manually.\r\n\r\nAnyway the issue seems to be solved after running the online_data_migrations.", 
            "date_created": "2017-08-02 11:33:13.914078+00:00", 
            "author": "https://api.launchpad.net/1.0/~kleini76"
        }
    ], 
    "closed": "2017-08-02 11:33:14.858720+00:00"
}