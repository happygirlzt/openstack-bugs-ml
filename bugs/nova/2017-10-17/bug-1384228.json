{
    "status": "Invalid", 
    "last_updated": "2015-10-16 08:57:50.317908+00:00", 
    "description": "I have the following code\n\ntry:\n\u00a0\u00a0\u00a0\u00a0instance.add_fixed_ip(network.id)\nexcept Exception as e:\n\u00a0\u00a0\u00a0\u00a0...\n\nThe issue is that in Nova compute logs I can see exception, but it is not thrown on client side.\nSince add_fixed_ip() returns nothing, it is difficult to find if fixed address was assigned.\n\nException:\n\"\"\"\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 393, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/exception.py\", line 71, in wrapped\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 274, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 260, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 303, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     e, sys.exc_info())\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 290, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 3621, in add_fixed_ip_to_instance\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     network_id)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/network/api.py\", line 49, in wrapper\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     res = f(self, context, *args, **kwargs)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/network/neutronv2/api.py\", line 562, in add_fixed_ip_to_instance\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     instance_id=instance['uuid'])\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher NetworkNotFoundForInstance: Network could not be found for instance b58e9e7a-b65e-494f-a5bb-43b2a1ead197.\n\"\"\"\n\nThis exception, most probably, was caused by dhcp agent failing to find tap device:\n\"\"\"\nStderr: 'Cannot find device \"tap41e55d74-72\"\\n'\n\"\"\"\n\nThe device indeed was missing, but after I restarted all services, it did not appear.\n\nI use Icehouse.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1384228", 
    "owner": "https://api.launchpad.net/1.0/~pushkar-umaranikar", 
    "id": 1384228, 
    "index": 6498, 
    "openned": "2014-10-22 12:18:30.453710+00:00", 
    "created": "2014-10-22 12:18:30.453710+00:00", 
    "title": "Exception should be raised if nova has failed to add fixed ip", 
    "comments": [
        {
            "content": "I have the following code\n\ntry:\n    instance.add_fixed_ip(network.id)\nexcept Exception as e:\n    ...\n\nThe issue is that in Nova compute logs I can see exception, but it is not thrown on client side. \nSince add_fixed_ip() returns nothing, it is difficult to find if fixed address was assigned.\n\nException:\n\"\"\"\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 393, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/exception.py\", line 88, in wrapped\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/exception.py\", line 71, in wrapped\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 274, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 260, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 303, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     e, sys.exc_info())\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 290, in decorated_function\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 3621, in add_fixed_ip_to_instance\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     network_id)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/network/api.py\", line 49, in wrapper\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     res = f(self, context, *args, **kwargs)\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher   File \"/home/vb/.virtualenvs/ecs/local/lib/python2.7/site-packages/nova/network/neutronv2/api.py\", line 562, in add_fixed_ip_to_instance\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher     instance_id=instance['uuid'])\n2014-10-22 13:06:59.936 1015 TRACE oslo.messaging.rpc.dispatcher NetworkNotFoundForInstance: Network could not be found for instance b58e9e7a-b65e-494f-a5bb-43b2a1ead197.\n\"\"\"\n\nThis exception, most probably, was caused by dhcp agent failing to find tap device:\n\"\"\"\nStderr: 'Cannot find device \"tap41e55d74-72\"\\n'\n\"\"\"\n\nThe device indeed was missing, but after I restarted all services, it did not appear.", 
            "date_created": "2014-10-22 12:18:30.453710+00:00", 
            "author": "https://api.launchpad.net/1.0/~vb-d"
        }, 
        {
            "content": "add_fixed_ip is an asynchronous call from the api to the compute manager. Eg we don't wait around to see if it\nsucceeded before returning. Note the 202 success code returned (eg, request has been accepted, but not completed).\n\nI think this is another thing we'll need to leave to the tasks api so you'll be able to poll after the api returns to see if the request succeded or if not why it failed.\n", 
            "date_created": "2014-10-23 03:42:52.960506+00:00", 
            "author": "https://api.launchpad.net/1.0/~cyeoh-0"
        }, 
        {
            "content": "Thanks, it would be much more easier to use.", 
            "date_created": "2014-10-23 09:36:29.831009+00:00", 
            "author": "https://api.launchpad.net/1.0/~vb-d"
        }, 
        {
            "content": "That call is a cast, which means it's async and will not return an error. This is expected and desired as part of nova's design.", 
            "date_created": "2015-10-14 21:22:16.337654+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "This is not a bug. As cyeoh pointed out a long time ago, adding a fixed IP is a cast:\n\nhttps://github.com/openstack/nova/blob/master/nova/compute/rpcapi.py#L384\n\nSo you get a 202 response back from the API.  If it fails in the compute node, there is an instance fault associated with the instance:\n\nhttps://github.com/openstack/nova/blob/master/nova/compute/manager.py#L3980\n\nThere is an API and CLI for getting instance fault information.  The tasks framework is not even started yet, so a bug isn't going to fix that.", 
            "date_created": "2015-10-14 21:22:31.694504+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Able to reproduce this bug through CLI and test client using API call. As discussed,  add_fixed_ip is an asynchronous call from the api to the compute manager. This is expected as due to asynchronous behavior it won't check if call to add_fixed_ip is successful or not before returning. ", 
            "date_created": "2015-10-15 14:57:26.611769+00:00", 
            "author": "https://api.launchpad.net/1.0/~pushkar-umaranikar"
        }, 
        {
            "content": "You should let user know that it is async call. Most of other API calls return result instantly.\nI haven't seen that information in documentation, there were no comments in code as well.\n", 
            "date_created": "2015-10-16 08:57:49.896455+00:00", 
            "author": "https://api.launchpad.net/1.0/~vb-d"
        }
    ], 
    "closed": "2015-10-14 21:21:18.184519+00:00"
}