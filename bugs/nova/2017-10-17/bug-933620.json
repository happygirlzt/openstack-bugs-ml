{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:33:15.611921+00:00", 
    "description": "I see this stacktrace in the compute log.\n\nFeb 16 13:09:52 8E-B1-AF-C3-4C-C9 nova-compute ERROR Error during ComputeManager._poll_bandwidth_usage: Object '<BandwidthUsage at 0xa42dccc>' is already attached to session '170412556' (this is '167661484')\n(nova.manager): TRACE: Traceback (most recent call last):\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/manager.py\", line 155, in periodic_tasks\n(nova.manager): TRACE:     task(self, context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2088, in _poll_bandwidth_usage\n(nova.manager): TRACE:     usage['bw_in'], usage['bw_out'])\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 1561, in bw_usage_update\n(nova.manager): TRACE:     bw_in, bw_out)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 119, in wrapper\n(nova.manager): TRACE:     return f(*args, **kwargs)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 3737, in bw_usage_update\n(nova.manager): TRACE:     bwusage.save(session=session)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/models.py\", line 56, in save\n(nova.manager): TRACE:     session.add(self)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1101, in add\n(nova.manager): TRACE:     self._save_or_update_state(state)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1110, in _save_or_update_state\n(nova.manager): TRACE:     self._save_or_update_impl(state)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1307, in _save_or_update_impl\n(nova.manager): TRACE:     self._update_impl(state)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1299, in _update_impl\n(nova.manager): TRACE:     self._attach(state)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1333, in _attach\n(nova.manager): TRACE:     state.session_id, self.hash_key))\n(nova.manager): TRACE: InvalidRequestError: Object '<BandwidthUsage at 0xa42dccc>' is already attached to session '170412556' (this is '167661484')\n(nova.manager): TRACE:\n\n\nIt does not happen every time, I am using xenapi as backend driver. This happens on Essex trunk (or very close to it).\n\nI'll try to dig out more info, but any further insight would be helpful.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/933620", 
    "owner": "https://api.launchpad.net/1.0/~armando-migliaccio", 
    "id": 933620, 
    "index": 3851, 
    "openned": "2012-02-16 17:42:46.179923+00:00", 
    "created": "2012-02-16 17:42:46.179923+00:00", 
    "title": "Error during ComputeManager._poll_bandwidth_usage", 
    "comments": [
        {
            "content": "I see this stacktrace in the compute log.\n\nFeb 16 13:09:52 8E-B1-AF-C3-4C-C9 nova-compute ERROR Error during ComputeManager._poll_bandwidth_usage: Object '<BandwidthUsage at 0xa42dccc>' is already attached to session '170412556' (this is '167661484')\n(nova.manager): TRACE: Traceback (most recent call last):\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/manager.py\", line 155, in periodic_tasks\n(nova.manager): TRACE:     task(self, context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2088, in _poll_bandwidth_usage\n(nova.manager): TRACE:     usage['bw_in'], usage['bw_out'])\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 1561, in bw_usage_update\n(nova.manager): TRACE:     bw_in, bw_out)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 119, in wrapper\n(nova.manager): TRACE:     return f(*args, **kwargs)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 3737, in bw_usage_update\n(nova.manager): TRACE:     bwusage.save(session=session)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/models.py\", line 56, in save\n(nova.manager): TRACE:     session.add(self)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1101, in add\n(nova.manager): TRACE:     self._save_or_update_state(state)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1110, in _save_or_update_state\n(nova.manager): TRACE:     self._save_or_update_impl(state)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1307, in _save_or_update_impl\n(nova.manager): TRACE:     self._update_impl(state)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1299, in _update_impl\n(nova.manager): TRACE:     self._attach(state)\n(nova.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/SQLAlchemy-0.6.5-py2.6.egg/sqlalchemy/orm/session.py\", line 1333, in _attach\n(nova.manager): TRACE:     state.session_id, self.hash_key))\n(nova.manager): TRACE: InvalidRequestError: Object '<BandwidthUsage at 0xa42dccc>' is already attached to session '170412556' (this is '167661484')\n(nova.manager): TRACE:\n\n\nIt does not happen every time, I am using xenapi as backend driver. This happens on Essex trunk (or very close to it).\n\nI'll try to dig out more info, but any further insight would be helpful.", 
            "date_created": "2012-02-16 17:42:46.179923+00:00", 
            "author": "https://api.launchpad.net/1.0/~armando-migliaccio"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/4271", 
            "date_created": "2012-02-17 11:50:41.904330+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/4271\nCommitted: http://github.com/openstack/nova/commit/57da3b12b14ce7676b51904c97a4685692d7b5cc\nSubmitter: Jenkins\nBranch:    master\n\ncommit 57da3b12b14ce7676b51904c97a4685692d7b5cc\nAuthor: Armando Migliaccio <email address hidden>\nDate:   Fri Feb 17 11:44:27 2012 +0000\n\n    bug 933620: Error during ComputeManager._poll_bandwidth_usage\n    \n    add missing session to model query.\n    \n    Change-Id: I3cb8ebcff1fd286ef198f33514d4ce3d884c5921\n", 
            "date_created": "2012-02-17 16:06:10.456847+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-02-29 10:28:00.788804+00:00"
}