{
    "status": "Opinion", 
    "last_updated": "2015-04-01 16:18:04.189714+00:00", 
    "description": "Summary: \nwhen the Management IP address of a compute node differs with its \"my_ip\" config of nova.conf, nova-conductor would prefer the \"my_ip\" config and store it into the \"compute_nodes\" table \"host_ip\" column of nova database. Certainly, this would lead to the failure of this compute node, but it's hard to notice, because it turns out good in the \"nova service-list\" command, and nowhere to see the cause, even the log didn't say anything meaningful.\n\nScenario: \nWhen you dulicate a new compute node using snapshots, this problem easily happens.\n\nExample:\n1) Here's an example, we have two compute nodes named ly-compute1 and ly-compute2. The \"my_ip\" of ly-compute1 is misconfigured because 10.0.0.35 does not exist.\n*********************************************************************\nly-compute1 (Compute Node 1)\n*********************************************************************\nManagement IP:\nEthernet(eth1)\nIP Address: 10.0.0.31\n\nnova.conf:\n[DEFAULT]\nmy_ip = 10.0.0.35\n*********************************************************************\nly-compute2 (Compute Node 2)\n*********************************************************************\nManagement IP:\nEthernet(eth1)\nIP Address: 10.0.0.32\n\nnova.conf:\n[DEFAULT]\nmy_ip = 10.0.0.32\n*********************************************************************\n\n2) Here's a fraction of \"compute_nodes\" table in nova database, from which we can see that, nova has got the wrong my_ip value.\n*********************************************************************\nnova database:\nhypervisor_hostname\tdeleted\t\thost_ip\nly-compute1\t\t\t0\t\t\t10.0.0.35\nly-compute2\t\t\t0\t\t\t10.0.0.32\n*********************************************************************\n\n3) However, the \"nova service-list\" says everything's ok as belows, dashboard would fail all VNC connections to VMs running on ly-compute1, but there's no information telling me what's going on, nova-compute.log on ly-compute1 doesn't say anything meaningful either.\n\nC:\\Windows\\system32>nova service-list\n+----+------------------+---------------+----------+---------+-------+----------------------------+-----------------+\n| Id | Binary           | Host          | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n+----+------------------+---------------+----------+---------+-------+----------------------------+-----------------+\n| 1  | nova-cert        | ly-controller | internal | enabled | up    | 2014-12-28T12:08:47.000000 | -               |\n| 2  | nova-consoleauth | ly-controller | internal | enabled | up    | 2014-12-28T12:08:53.000000 | -               |\n| 3  | nova-scheduler   | ly-controller | internal | enabled | up    | 2014-12-28T12:08:53.000000 | -               |\n| 4  | nova-conductor   | ly-controller | internal | enabled | up    | 2014-12-28T12:08:52.000000 | -               |\n| 5  | nova-compute     | ly-compute1   | nova     | enabled | up    | 2014-12-28T12:08:52.000000 | None            |\n| 6  | nova-network     | ly-compute1   | internal | enabled | up    | 2014-12-28T12:08:52.000000 | -               |\n| 7  | nova-network     | ly-compute2   | internal | enabled | up    | 2014-12-28T12:08:53.000000 | -               |\n| 8  | nova-compute     | ly-compute2   | nova     | enabled | up    | 2014-12-28T12:08:47.000000 | None            |\n+----+------------------+---------------+----------+---------+-------+----------------------------+-----------------+\n\nRequest:\nI think that a clearer error message should be presented about this misconfiguration, like adding some code checking if Management IP of a compute node is the same with its my_ip, or just let the nova-compute service down, so the admin would know where the fault locates, using command such as \"nova service-list\".", 
    "tags": [
        "conductor", 
        "db"
    ], 
    "importance": "Wishlist", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1406093", 
    "owner": "None", 
    "id": 1406093, 
    "index": 2918, 
    "openned": "2014-12-28 12:26:17.583077+00:00", 
    "created": "2014-12-28 12:26:17.583077+00:00", 
    "title": "Error message lacks when compute node management IP differs with its config address.", 
    "comments": [
        {
            "content": "Summary: \nwhen the Management IP address of a compute node differs with its \"my_ip\" config of nova.conf, nova-conductor would prefer the \"my_ip\" config and store it into the \"compute_nodes\" table \"host_ip\" column of nova database. Certainly, this would lead to the failure of this compute node, but it's hard to notice, because it turns out good in the \"nova service-list\" command, and nowhere to see the cause, even the log didn't say anything meaningful.\n\nScenario: \nWhen you dulicate a new compute node using snapshots, this problem easily happens.\n\nExample:\n1) Here's an example, we have two compute nodes named ly-compute1 and ly-compute2. The \"my_ip\" of ly-compute1 is misconfigured because 10.0.0.35 does not exist.\n*********************************************************************\nly-compute1 (Compute Node 1)\n*********************************************************************\nManagement IP:\nEthernet(eth1)\nIP Address: 10.0.0.31\n\nnova.conf:\n[DEFAULT]\nmy_ip = 10.0.0.35\n*********************************************************************\nly-compute2 (Compute Node 2)\n*********************************************************************\nManagement IP:\nEthernet(eth1)\nIP Address: 10.0.0.32\n\nnova.conf:\n[DEFAULT]\nmy_ip = 10.0.0.32\n*********************************************************************\n\n2) Here's a fraction of \"compute_nodes\" table in nova database, from which we can see that, nova has got the wrong my_ip value.\n*********************************************************************\nnova database:\nhypervisor_hostname\tdeleted\t\thost_ip\nly-compute1\t\t\t0\t\t\t10.0.0.35\nly-compute2\t\t\t0\t\t\t10.0.0.32\n*********************************************************************\n\n3) However, the \"nova service-list\" says everything's ok as belows, dashboard would fail all VNC connections to VMs running on ly-compute1, but there's no information telling me what's going on, nova-compute.log on ly-compute1 doesn't say anything meaningful either.\n\nC:\\Windows\\system32>nova service-list\n+----+------------------+---------------+----------+---------+-------+----------------------------+-----------------+\n| Id | Binary           | Host          | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n+----+------------------+---------------+----------+---------+-------+----------------------------+-----------------+\n| 1  | nova-cert        | ly-controller | internal | enabled | up    | 2014-12-28T12:08:47.000000 | -               |\n| 2  | nova-consoleauth | ly-controller | internal | enabled | up    | 2014-12-28T12:08:53.000000 | -               |\n| 3  | nova-scheduler   | ly-controller | internal | enabled | up    | 2014-12-28T12:08:53.000000 | -               |\n| 4  | nova-conductor   | ly-controller | internal | enabled | up    | 2014-12-28T12:08:52.000000 | -               |\n| 5  | nova-compute     | ly-compute1   | nova     | enabled | up    | 2014-12-28T12:08:52.000000 | None            |\n| 6  | nova-network     | ly-compute1   | internal | enabled | up    | 2014-12-28T12:08:52.000000 | -               |\n| 7  | nova-network     | ly-compute2   | internal | enabled | up    | 2014-12-28T12:08:53.000000 | -               |\n| 8  | nova-compute     | ly-compute2   | nova     | enabled | up    | 2014-12-28T12:08:47.000000 | None            |\n+----+------------------+---------------+----------+---------+-------+----------------------------+-----------------+\n\nRequest:\nI think that a clearer error message should be presented about this misconfiguration, like adding some code checking if Management IP of a compute node is the same with its my_ip, or just let the nova-compute service down, so the admin would know where the fault locates, using command such as \"nova service-list\".", 
            "date_created": "2014-12-28 12:26:17.583077+00:00", 
            "author": "https://api.launchpad.net/1.0/~hsluoyz"
        }, 
        {
            "content": "If the compute node has several IP address\nwhich one should be the right one? so my_ip will tell which one is right one to use \n\nin worst case, I can run compute service on another machine for some hypervisors, \nI think it's hard to handle this case?\n\n\n\n", 
            "date_created": "2015-02-12 20:33:23.794987+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "If several IP addresss are owned by compute node, a checking should be added that my_ip matches at least one of them. If checking fails, then makes the compute service unavailable to attract human attention. Maybe this is a good way for handling this?", 
            "date_created": "2015-02-13 02:33:53.964517+00:00", 
            "author": "https://api.launchpad.net/1.0/~hsluoyz"
        }
    ], 
    "closed": "2015-04-01 16:18:00.644925+00:00"
}