{
    "status": "In Progress", 
    "last_updated": "2016-11-18 01:31:24.457545+00:00", 
    "description": "1. I have a flavor named 'disk0' that's disk size is 0.\n[root@opencos114-222 ~(keystone_admin)]# nova flavor-list\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID                                   | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1                                    | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |\n| 2                                    | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3                                    | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4                                    | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 41ef4850-14a6-424a-81b6-99ba0edbec52 | disk0     | 100       | 0    | 0         |      | 1     | 1.0         | True      |\n| 5                                    | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n\n2. I use disk0 flavor to boot a instance and instance' uuid is  9fb1389d-5d1b-45ac-8a9d-437f69f88422.\n[root@opencos114-222 ~(keystone_admin)]# nova boot --image 66d2336c-31d2-495a-833d-6470b3d46263 --flavor 41ef4850-14a6-424a-81b6-99ba0edbec52 --nic net-id=9b68affa-f2f1-4d74-99d0-5b3d712846dc hanrong\n+--------------------------------------+-----------------------------------------------+\n| Property                             | Value                                         |\n+--------------------------------------+-----------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                        |\n| OS-EXT-AZ:availability_zone          | nova                                          |\n| OS-EXT-SRV-ATTR:host                 | -                                             |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                             |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000015                             |\n| OS-EXT-STS:power_state               | 0                                             |\n| OS-EXT-STS:task_state                | scheduling                                    |\n| OS-EXT-STS:vm_state                  | building                                      |\n| OS-SRV-USG:launched_at               | -                                             |\n| OS-SRV-USG:terminated_at             | -                                             |\n| accessIPv4                           |                                               |\n| accessIPv6                           |                                               |\n| adminPass                            | Q5iUAxTW5r29                                  |\n| config_drive                         |                                               |\n| created                              | 2015-03-28T08:38:38Z                          |\n| flavor                               | disk0 (41ef4850-14a6-424a-81b6-99ba0edbec52)  |\n| hostId                               |                                               |\n| id                                   | 9fb1389d-5d1b-45ac-8a9d-437f69f88422          |\n| image                                | cirror (66d2336c-31d2-495a-833d-6470b3d46263) |\n| key_name                             | -                                             |\n| metadata                             | {}                                            |\n| name                                 | hanrong                                       |\n| os-extended-volumes:volumes_attached | []                                            |\n| progress                             | 0                                             |\n| security_groups                      | default                                       |\n| serial_type                          | file                                          |\n| status                               | BUILD                                         |\n| tenant_id                            | 94d1a1b3260648f4be6bc423fab73bfa              |\n| updated                              | 2015-03-28T08:38:38Z                          |\n| user_id                              | 1f60084b664844aab2304eb0fc288fba              |\n+--------------------------------------+-----------------------------------------------+\n\n3. I see the instance's root_gb is 0 in nova database.\n[root@opencos114-222 ~(keystone_admin)]# mysql\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 9905\nServer version: 5.5.36-MariaDB-wsrep MariaDB Server, wsrep_25.9.r3961\n\nCopyright (c) 2000, 2013, Oracle, Monty Program Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]> use nova\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nMariaDB [nova]> select uuid,root_gb from instances where uuid='9fb1389d-5d1b-45ac-8a9d-437f69f88422';\n+--------------------------------------+---------+\n| uuid                                 | root_gb |\n+--------------------------------------+---------+\n| 9fb1389d-5d1b-45ac-8a9d-437f69f88422 |       0 |\n+--------------------------------------+---------+\n1 row in set (0.00 sec)\n\n4. But this instance's actual root disk size is not 0.\n[root@opencos114-98 instances]# cd 9fb1389d-5d1b-45ac-8a9d-437f69f88422/\n[root@opencos114-98 9fb1389d-5d1b-45ac-8a9d-437f69f88422]# ll\ntotal 992\n-rw-rw---- 1 root root   16750 Mar 28 16:39 console.log\n-rw-r--r-- 1 root root 1048576 Mar 28 16:39 disk\n-rw-r--r-- 1 root root      79 Mar 28 16:38 disk.info\n-rw-r--r-- 1 root root    1725 Mar 28 16:38 libvirt.xml\n[root@opencos114-98 9fb1389d-5d1b-45ac-8a9d-437f69f88422]# qemu-img info disk\nimage: disk\nfile format: qcow2\nvirtual size: 39M (41126400 bytes)\ndisk size: 1.3M\ncluster_size: 65536\nbacking file: /var/lib/nova/instances/_base/cff6eefd4b2262239fafae317589c4507325abe9\nFormat specific information:\n\u00a0\u00a0\u00a0\u00a0compat: 1.1\n\u00a0\u00a0\u00a0\u00a0lazy refcounts: false\n\n5. Many disk  statistics are resulting from instances'  root_gb field. I think 0 is improper, image's virtual size would be more appropriate.", 
    "tags": [
        "compute", 
        "scheduler"
    ], 
    "importance": "Wishlist", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1414947", 
    "owner": "https://api.launchpad.net/1.0/~hanrong", 
    "id": 1414947, 
    "index": 2928, 
    "openned": "2015-01-27 09:11:23.172596+00:00", 
    "created": "2015-01-27 09:11:23.172596+00:00", 
    "title": "instance\u2018s root_gb is 0, but the actual root_gb size is not 0.", 
    "comments": [
        {
            "content": "1. I have a flavor named 'disk0' that's disk size is 0.\n[root@opencos114-222 ~(keystone_admin)]# nova flavor-list\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID                                   | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1                                    | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |\n| 2                                    | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3                                    | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4                                    | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 41ef4850-14a6-424a-81b6-99ba0edbec52 | disk0     | 100       | 0    | 0         |      | 1     | 1.0         | True      |\n| 5                                    | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n\n2. I use disk0 flavor to boot a instance and instance' uuid is  9fb1389d-5d1b-45ac-8a9d-437f69f88422. \n[root@opencos114-222 ~(keystone_admin)]# nova boot --image 66d2336c-31d2-495a-833d-6470b3d46263 --flavor 41ef4850-14a6-424a-81b6-99ba0edbec52 --nic net-id=9b68affa-f2f1-4d74-99d0-5b3d712846dc hanrong\n+--------------------------------------+-----------------------------------------------+\n| Property                             | Value                                         |\n+--------------------------------------+-----------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                        |\n| OS-EXT-AZ:availability_zone          | nova                                          |\n| OS-EXT-SRV-ATTR:host                 | -                                             |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                             |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000015                             |\n| OS-EXT-STS:power_state               | 0                                             |\n| OS-EXT-STS:task_state                | scheduling                                    |\n| OS-EXT-STS:vm_state                  | building                                      |\n| OS-SRV-USG:launched_at               | -                                             |\n| OS-SRV-USG:terminated_at             | -                                             |\n| accessIPv4                           |                                               |\n| accessIPv6                           |                                               |\n| adminPass                            | Q5iUAxTW5r29                                  |\n| config_drive                         |                                               |\n| created                              | 2015-03-28T08:38:38Z                          |\n| flavor                               | disk0 (41ef4850-14a6-424a-81b6-99ba0edbec52)  |\n| hostId                               |                                               |\n| id                                   | 9fb1389d-5d1b-45ac-8a9d-437f69f88422          |\n| image                                | cirror (66d2336c-31d2-495a-833d-6470b3d46263) |\n| key_name                             | -                                             |\n| metadata                             | {}                                            |\n| name                                 | hanrong                                       |\n| os-extended-volumes:volumes_attached | []                                            |\n| progress                             | 0                                             |\n| security_groups                      | default                                       |\n| serial_type                          | file                                          |\n| status                               | BUILD                                         |\n| tenant_id                            | 94d1a1b3260648f4be6bc423fab73bfa              |\n| updated                              | 2015-03-28T08:38:38Z                          |\n| user_id                              | 1f60084b664844aab2304eb0fc288fba              |\n+--------------------------------------+-----------------------------------------------+\n\n3. I see the instance's root_gb is 0 in nova database.\n[root@opencos114-222 ~(keystone_admin)]# mysql\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 9905\nServer version: 5.5.36-MariaDB-wsrep MariaDB Server, wsrep_25.9.r3961\n\nCopyright (c) 2000, 2013, Oracle, Monty Program Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]> use nova\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nMariaDB [nova]> select uuid,root_gb from instances where uuid='9fb1389d-5d1b-45ac-8a9d-437f69f88422';\n+--------------------------------------+---------+\n| uuid                                 | root_gb |\n+--------------------------------------+---------+\n| 9fb1389d-5d1b-45ac-8a9d-437f69f88422 |       0 |\n+--------------------------------------+---------+\n1 row in set (0.00 sec)\n\n4. But this instance's actual root disk size is not 0.\n[root@opencos114-98 instances]# cd 9fb1389d-5d1b-45ac-8a9d-437f69f88422/\n[root@opencos114-98 9fb1389d-5d1b-45ac-8a9d-437f69f88422]# ll\ntotal 992\n-rw-rw---- 1 root root   16750 Mar 28 16:39 console.log\n-rw-r--r-- 1 root root 1048576 Mar 28 16:39 disk\n-rw-r--r-- 1 root root      79 Mar 28 16:38 disk.info\n-rw-r--r-- 1 root root    1725 Mar 28 16:38 libvirt.xml\n[root@opencos114-98 9fb1389d-5d1b-45ac-8a9d-437f69f88422]# qemu-img info disk\nimage: disk\nfile format: qcow2\nvirtual size: 39M (41126400 bytes)\ndisk size: 1.3M\ncluster_size: 65536\nbacking file: /var/lib/nova/instances/_base/cff6eefd4b2262239fafae317589c4507325abe9\nFormat specific information:\n    compat: 1.1\n    lazy refcounts: false\n\n5. Many disk  statistics is resulting from instances'  root_gb field. I think 0 is improper.", 
            "date_created": "2015-01-27 09:11:23.172596+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "Hi,\nI do not think that this is a bug. When the flavor size is 0 then the driver will make use of the size of the image that is downloaded.\nThanks\nGary", 
            "date_created": "2015-01-28 17:52:59.659796+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "This is the currently defined behavior of nova. 0 means be adaptive.", 
            "date_created": "2015-01-28 23:42:36.650578+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "With this behaviour nova can keep scheduling instances with a disk size = 0 flavor without realizing it's actually filling up the disk of the compute nodes.\n\nThat does look like a bug to me, and it could even lead to a denial of service, no?", 
            "date_created": "2015-07-24 14:57:35.269513+00:00", 
            "author": "https://api.launchpad.net/1.0/~adri2000"
        }, 
        {
            "content": "@Adrien Cunin (adri2000), I agree with you.\n\nI think instance's root_gb is virtual size of used image when this instance's flavor.root_gb is 0.", 
            "date_created": "2016-11-04 03:05:24.209784+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "A couple of months back I added a clarification to the doc about disks == 0 case https://review.openstack.org/#/c/339034/ \nIt might not an optimal behavior but it is a documented behavior of nova.", 
            "date_created": "2016-11-15 12:07:54.185243+00:00", 
            "author": "https://api.launchpad.net/1.0/~balazs-gibizer"
        }, 
        {
            "content": "Thank you\uff0cI see\u3002\n\nBut I have a use case:\nUsers may create some virtual machines for the processing of their business, these virtual machines use customized images which can meet their requirement. When users create virtual machines using these customized images in batches, they don't need to know the size of instance's root_gb, so they can use flavor with its disk size as 0.\nIn this case, the value of root_gb's filed in db table of instances is 0 for every virtual machine, but it's real value is not 0. This will lead to live migrate failure since live-migration's destination compute node's disk_available_least is always less than 0.\nWe often enable disk_filter to control compute nodes's disk space, but when the value of root_gb's filed in db table of instances is 0, this filter doesn't work.\n\nSo, I think the value of root_gb's filed in db table of instances should be equal to image's virtual size in this use case.", 
            "date_created": "2016-11-17 02:57:43.760671+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/398891", 
            "date_created": "2016-11-17 09:55:51.096139+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}