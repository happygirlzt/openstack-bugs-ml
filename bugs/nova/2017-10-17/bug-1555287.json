{
    "status": "Fix Released", 
    "last_updated": "2017-06-16 12:15:06.528838+00:00", 
    "description": "Recently the ceph job (and any other configuration that doesn't use disk image as the backend storage) started failing like this:\n\n\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     incoming.message))\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _dispatch\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/exception.py\", line 110, in wrapped\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     payload)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/exception.py\", line 89, in wrapped\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 359, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance=instance)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 328, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 409, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 316, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     migration.instance_uuid, exc_info=True)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 293, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 387, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 375, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 3876, in resize_instance\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     timeout, retry_interval)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 7237, in migrate_disk_and_power_off\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     shared_storage)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 7230, in migrate_disk_and_power_off\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     host=dest, on_execute=on_execute,\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher UnboundLocalError: local variable 'on_execute' referenced before assignment", 
    "tags": [
        "ceph", 
        "in-stable-kilo", 
        "in-stable-liberty"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1555287", 
    "owner": "https://api.launchpad.net/1.0/~mbooth-9", 
    "id": 1555287, 
    "index": 1896, 
    "openned": "2016-03-09 18:46:19.397492+00:00", 
    "created": "2016-03-09 18:46:19.397492+00:00", 
    "title": "Libvirt driver broken for non-disk-image backends", 
    "comments": [
        {
            "content": "Recently the ceph job (and any other configuration that doesn't use disk image as the backend storage) started failing like this:\n\n\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     incoming.message))\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _dispatch\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/exception.py\", line 110, in wrapped\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     payload)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/exception.py\", line 89, in wrapped\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 359, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance=instance)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 328, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 409, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 316, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     migration.instance_uuid, exc_info=True)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 293, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 387, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 375, in decorated_function\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 3876, in resize_instance\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     timeout, retry_interval)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 7237, in migrate_disk_and_power_off\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     shared_storage)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     self.force_reraise()\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 7230, in migrate_disk_and_power_off\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher     host=dest, on_execute=on_execute,\n2016-03-09 14:47:29.102 17597 ERROR oslo_messaging.rpc.dispatcher UnboundLocalError: local variable 'on_execute' referenced before assignment", 
            "date_created": "2016-03-09 18:46:19.397492+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "Fix proposed to branch: stable/liberty\nReview: https://review.openstack.org/290843", 
            "date_created": "2016-03-09 20:50:09.297256+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/kilo\nReview: https://review.openstack.org/290847", 
            "date_created": "2016-03-09 20:56:21.028118+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/290715\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=ccd6195e67c735aa216bea51d9dccfed631dc814\nSubmitter: Jenkins\nBranch:    master\n\ncommit ccd6195e67c735aa216bea51d9dccfed631dc814\nAuthor: Matthew Booth <email address hidden>\nDate:   Wed Mar 9 17:27:03 2016 +0000\n\n    Fix processing of libvirt disk.info in non-disk-image cases\n    \n    In Idfc16f54049aaeab31ac1c1d8d79a129acc9fb87 a change was made\n    that caused non-disk-image backends to fall over because of an\n    undefined variable because they skipped processing of the disk.info\n    file. This adds a check for that case to make sure we don't run\n    that path in the non-disk-image backend case.\n    \n    Closes-Bug: #1555287\n    \n    Change-Id: I02f8a5f0e29816336e500a8fe8dcc9ece15968e9\n", 
            "date_created": "2016-03-09 23:53:20.779766+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/290847\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=2d7166db25c2d6f5147f4da2c6067895420d5995\nSubmitter: Jenkins\nBranch:    stable/kilo\n\ncommit 2d7166db25c2d6f5147f4da2c6067895420d5995\nAuthor: Matthew Booth <email address hidden>\nDate:   Wed Mar 9 17:27:03 2016 +0000\n\n    Fix processing of libvirt disk.info in non-disk-image cases\n    \n    In Idfc16f54049aaeab31ac1c1d8d79a129acc9fb87 a change was made\n    that caused non-disk-image backends to fall over because of an\n    undefined variable because they skipped processing of the disk.info\n    file. This adds a check for that case to make sure we don't run\n    that path in the non-disk-image backend case.\n    \n    Closes-Bug: #1555287\n    \n    Change-Id: I02f8a5f0e29816336e500a8fe8dcc9ece15968e9\n", 
            "date_created": "2016-03-10 03:10:08.028152+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/290843\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e8dc5c876cbade81a0a2991a8c100bc9afc0e42a\nSubmitter: Jenkins\nBranch:    stable/liberty\n\ncommit e8dc5c876cbade81a0a2991a8c100bc9afc0e42a\nAuthor: Matthew Booth <email address hidden>\nDate:   Wed Mar 9 17:27:03 2016 +0000\n\n    Fix processing of libvirt disk.info in non-disk-image cases\n    \n    In Idfc16f54049aaeab31ac1c1d8d79a129acc9fb87 a change was made\n    that caused non-disk-image backends to fall over because of an\n    undefined variable because they skipped processing of the disk.info\n    file. This adds a check for that case to make sure we don't run\n    that path in the non-disk-image backend case.\n    \n    Closes-Bug: #1555287\n    \n    Change-Id: I02f8a5f0e29816336e500a8fe8dcc9ece15968e9\n", 
            "date_created": "2016-03-10 04:23:28.007126+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.0.0.0rc1 release candidate.", 
            "date_created": "2016-03-16 18:00:24.254318+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 12.0.3 release.", 
            "date_created": "2016-04-14 12:29:23.110014+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 2015.1.4 release.", 
            "date_created": "2016-05-10 13:37:47.990218+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 2015.1.4 release.", 
            "date_created": "2016-11-10 00:55:53.867089+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-03-09 23:53:18.958018+00:00"
}