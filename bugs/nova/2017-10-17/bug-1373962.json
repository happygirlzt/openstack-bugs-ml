{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:56:22.641192+00:00", 
    "description": "LVM ephemeral storage backend is broken in the most recent Nova (commit 945646e1298a53be6ae284766f5023d754dfe57d)\n\nTo reproduce in Devstack:\n\n1. Configure Nova to use LVM ephemeral storage by adding to create_nova_conf function in lib/nova\n\n        iniset $NOVA_CONF libvirt images_type \"lvm\"\n        iniset $NOVA_CONF libvirt images_volume_group \"nova-lvm\"\n\n2. Create a backing file for LVM\n\n        truncate -s 5G nova-backing-file\n\n3. Mount the file via loop device\n\n        sudo losetup /dev/loop0 nova-backing-file\n\n4. Create nova-lvm volume group\n\n        sudo vgcreate nova-lvm /dev/loop0\n\n5. Launch Devstack\n\n6. Alternatively, skipping step 1, /etc/nova/nova.conf can be modified after Devstack is launched by adding\n\n        [libvirt]\n        images_type = lvm\n        images_volume_group = nova-lvm\n\n    and then restarting nova-compute by entering the Devstack screen session, going to the n-cpu screen and hitting Ctrl-C, Up-arrow, and Enter.\n\n7. Launch an instance\n\n        nova boot test --flavor 1 --image cirros-0.3.2-x86_64-uec\n\nInstance fails to launch. Nova compute reports\n\n2014-09-25 10:11:08.180 ERROR nova.compute.manager [req-b7924ad0-5f4b-46eb-a798-571d97c77145 demo demo] [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] Instance failed to spawn\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] Traceback (most recent call last):\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2231, in _build_resources\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     yield resources\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2101, in _build_and_run_instance\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     block_device_info=block_device_info)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2617, in spawn\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     block_device_info, disk_info=disk_info)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4434, in _create_domain_and_network\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     domain.destroy()\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4358, in _create_domain\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     for vif in network_info if vif.get('active', True) is False]\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     six.reraise(self.type_, self.value, self.tb)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4349, in _create_domain\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     raise exception.VirtualInterfaceCreateException()\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     rv = execute(f, *args, **kwargs)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     six.reraise(c, e, tb)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     rv = meth(*args, **kwargs)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 711, in createWithFlags\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] libvirtError: cannot open file '/dev/nova-lvm/8d69f0de-253a-403e-a137-0da77b0d415c_disk.config': No such file or directory\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]\n2014-09-25 10:11:08.218 AUDIT nova.compute.manager [req-b7924ad0-5f4b-46eb-a798-571d97c77145 demo demo] [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] Terminating instance\n2014-09-25 10:11:08.228 29649 INFO nova.virt.libvirt.driver [-] [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] Instance destroyed successfully.", 
    "tags": [
        "libvirt", 
        "lvm"
    ], 
    "importance": "High", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1373962", 
    "owner": "None", 
    "id": 1373962, 
    "index": 1626, 
    "openned": "2014-09-25 14:12:27.354974+00:00", 
    "created": "2014-09-25 14:12:27.354974+00:00", 
    "title": "LVM backed VM fails to launch", 
    "comments": [
        {
            "content": "LVM ephemeral storage backend is broken in the most recent Nova (commit 945646e1298a53be6ae284766f5023d754dfe57d)\n\nTo reproduce in Devstack:\n\n1. Configure Nova to use LVM ephemeral storage by adding to create_nova_conf function in lib/nova\n\n        iniset $NOVA_CONF libvirt images_type \"lvm\"\n        iniset $NOVA_CONF libvirt images_volume_group \"nova-lvm\"\n\n2. Create a backing file for LVM\n\n        truncate -s 5G nova-backing-file\n\n3. Mount the file via loop device\n\n        sudo losetup /dev/loop0 nova-backing-file\n\n4. Create nova-lvm volume group\n\n        sudo vgcreate nova-lvm /dev/loop0\n\n5. Launch Devstack\n\n6. Alternatively, skipping step 1, /etc/nova/nova.conf can be modified after Devstack is launched by adding\n\n        [libvirt]\n        images_type = lvm\n        images_volume_group = nova-lvm\n\n    and then restarting nova-compute by entering the Devstack screen session, going to the n-cpu screen and hitting Ctrl-C, Up-arrow, and Enter.\n\n7. Launch an instance\n\n        nova boot test --flavor 1 --image cirros-0.3.2-x86_64-uec\n\nInstance fails to launch. Nova compute reports\n\n2014-09-25 10:11:08.180 ERROR nova.compute.manager [req-b7924ad0-5f4b-46eb-a798-571d97c77145 demo demo] [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] Instance failed to spawn\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] Traceback (most recent call last):\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2231, in _build_resources\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     yield resources\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2101, in _build_and_run_instance\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     block_device_info=block_device_info)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 2617, in spawn\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     block_device_info, disk_info=disk_info)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4434, in _create_domain_and_network\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     domain.destroy()\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4358, in _create_domain\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     for vif in network_info if vif.get('active', True) is False]\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     six.reraise(self.type_, self.value, self.tb)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/opt/stack/nova/nova/virt/libvirt/driver.py\", line 4349, in _create_domain\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     raise exception.VirtualInterfaceCreateException()\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     rv = execute(f, *args, **kwargs)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     six.reraise(c, e, tb)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     rv = meth(*args, **kwargs)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 711, in createWithFlags\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] libvirtError: cannot open file '/dev/nova-lvm/8d69f0de-253a-403e-a137-0da77b0d415c_disk.config': No such file or directory\n2014-09-25 10:11:08.180 29649 TRACE nova.compute.manager [instance: 8d69f0de-253a-403e-a137-0da77b0d415c]\n2014-09-25 10:11:08.218 AUDIT nova.compute.manager [req-b7924ad0-5f4b-46eb-a798-571d97c77145 demo demo] [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] Terminating instance\n2014-09-25 10:11:08.228 29649 INFO nova.virt.libvirt.driver [-] [instance: 8d69f0de-253a-403e-a137-0da77b0d415c] Instance destroyed successfully.", 
            "date_created": "2014-09-25 14:12:27.354974+00:00", 
            "author": "https://api.launchpad.net/1.0/~daniel-genin"
        }, 
        {
            "content": "The commit hash doesn't seem to be valid, can you provide a link to the review?\n", 
            "date_created": "2014-09-25 17:08:00.808059+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Can you provide your entire nova.conf? I'm curious if there is other interaction with the ephemeral key work.", 
            "date_created": "2014-09-25 17:14:01.604931+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Here is the git log excerpt for the commit\n\ncommit 945646e1298a53be6ae284766f5023d754dfe57d\nMerge: f3c99ba 4adc837\nAuthor: Jenkins <email address hidden>\nDate:   Wed Sep 24 17:59:03 2014 +0000\n\n    Merge \"Sync network_info if instance not found before _build_resources yield\"", 
            "date_created": "2014-09-25 17:29:25.668162+00:00", 
            "author": "https://api.launchpad.net/1.0/~daniel-genin"
        }, 
        {
            "content": "My nova.conf\n\n[libvirt]\ninject_partition = -2\nuse_usb_tablet = False\ncpu_mode = none\nvirt_type = kvm\nimages_volume_group = nova-lvm\nimages_type = lvm\n\n[DEFAULT]\nflat_interface = eth0\nflat_network_bridge = br100\nvlan_interface = eth0\npublic_interface = br100\nnetwork_manager = nova.network.manager.FlatDHCPManager\nfirewall_driver = nova.virt.libvirt.firewall.IptablesFirewallDriver\ncompute_driver = libvirt.LibvirtDriver\ndefault_ephemeral_format = ext4\nrabbit_password = password\nrabbit_hosts = 192.168.123.2\nrpc_backend = nova.openstack.common.rpc.impl_kombu\nec2_dmz_host = 192.168.123.2\nvncserver_proxyclient_address = 127.0.0.1\nvncserver_listen = 127.0.0.1\nvnc_enabled = true\nxvpvncproxy_base_url = http://192.168.123.2:6081/console\nnovncproxy_base_url = http://192.168.123.2:6080/vnc_auto.html\nlogging_context_format_string = %(asctime)s.%(msecs)03d %(levelname)s %(name)s [%(request_id)s %(user_name)s %(project_name)s] %(instance)s%(message)s\nforce_config_drive = always\nuse_syslog = True\ninstances_path = /opt/stack/data/nova/instances\nlock_path = /opt/stack/data/nova\nstate_path = /opt/stack/data/nova\nenabled_apis = ec2,osapi_compute,metadata\ninstance_name_template = instance-%08x\nsql_connection = mysql://root:password@127.0.0.1/nova?charset=utf8\nmetadata_workers = 1\nec2_workers = 0\nosapi_compute_workers = 1\nmy_ip = 192.168.123.2\ns3_port = 3333\ns3_host = 192.168.123.2\ndefault_floating_pool = public\nfixed_range = \nforce_dhcp_release = True\ndhcpbridge_flagfile = /etc/nova/nova.conf\nscheduler_driver = nova.scheduler.filter_scheduler.FilterScheduler\nrootwrap_config = /etc/nova/rootwrap.conf\napi_paste_config = /etc/nova/api-paste.ini\nallow_resize_to_same_host = True\nauth_strategy = keystone\ndebug = True\nverbose = True\n\n[conductor]\nworkers = 1\n\n[osapi_v3]\nenabled = True\n\n[keystone_authtoken]\nsigning_dir = /var/cache/nova\nadmin_password = password\nadmin_user = nova\ncafile = \nadmin_tenant_name = service\nidentity_uri = http://192.168.123.2:35357\n\n[spice]\nenabled = false\nhtml5proxy_base_url = http://192.168.123.2:6082/spice_auto.html\n\n[glance]\napi_servers = 192.168.123.2:9292\n\n[keymgr]\nfixed_key = FC00478BB84CC84C86B8200D5B96378C4BB174FEA6354C106D2CE1CD6F131CD3", 
            "date_created": "2014-09-25 17:30:16.079037+00:00", 
            "author": "https://api.launchpad.net/1.0/~daniel-genin"
        }, 
        {
            "content": "This merged recently, no idea if it's related:\n\nhttps://github.com/openstack/nova/commit/97a5578657ef3a9efaaff134780f565b9c5f415f", 
            "date_created": "2014-09-25 17:32:15.327823+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "It looks like this was possibly broken with - https://github.com/openstack/nova/commit/97a5578657ef3a9efaaff134780f565b9c5f415f ", 
            "date_created": "2014-09-25 17:33:23.495510+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "http://lists.openstack.org/pipermail/openstack-dev/2014-September/046741.html", 
            "date_created": "2014-09-25 21:09:58.159053+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fixed by https://github.com/openstack/nova/commit/9bc59c02d5d4fdf2237760ba4a80bc64e68fb179", 
            "date_created": "2014-09-26 14:06:39.630339+00:00", 
            "author": "https://api.launchpad.net/1.0/~daniel-genin"
        }
    ], 
    "closed": "2014-10-01 07:39:23.025985+00:00"
}