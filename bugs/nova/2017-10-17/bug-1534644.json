{
    "status": "Invalid", 
    "last_updated": "2016-03-02 18:09:25.133422+00:00", 
    "description": "For softly-deleted instance 'nova restore <server>' command returns:\nroot@node-7:~# nova restore vm1\nERROR (CommandError): No server with a name or ID of 'vm1' exists.\n\nSteps to reproduce:\n\n1. On every controller and compute add the reclaim_instance_interval=86400 line to [DEFAULT] section of /etc/nova/nova.conf\n\n2. Restart nova-api service on controllers and nova-compute service on computes\n\n3. Create net01: net01__subnet, 192.168.1.0/24:\nneutron net-create net01\nneutron subnet-create net01 192.168.1.0/24 --enable-dhcp --name net01__subnet\n\n4. Boot instance vm1 in net01:\nNET_ID=$(neutron net-list | grep 'net01' | awk '{print $2}')\nnova boot --flavor m1.micro --image TestVM --nic net-id=$NET_ID  --security-groups default vm1\n\n5. Create a volume and attach it to an instance vm1:\ncinder create 10 --display-name test-volume --availability-zone nova\nVM_ID=$(nova show vm1 | grep '| id ' | awk  '{print $4}')\nVOL_ID=$(cinder list | grep 'test-volume'| awk '{print $2}')\nnova volume-attach $VM_ID $VOL_ID /dev/vdb\n\n6. Delete instance vm1:\nnova delete vm1\n\n7. Check that instance vm1 is really in SOFT-DELETE state:\nroot@node-7:~# curl -s -H \"X-Auth-Token: $TOKEN\" $NOVA_ENDPOINT/servers/395ae0d7-59d9-4475-876d-3da1d0acc430\n{\"server\": {\"status\": \"SOFT_DELETED\", \"updated\": \"2016-01-15T14:57:10Z\", \"hostId\": \"4ab2af2839510dd4a32c0c0225646b8ce4d865161930fd9d0d075c68\", \"OS-EXT-SRV-ATTR:host\": \"node-9.test.domain.local\", \"addresses\": {\"net01\": [{\"OS-EXT-IPS-MAC:mac_addr\": \"fa:16:3e:b6:98:bc\", \"version\": 4, \"addr\": \"192.168.1.43\", \"OS-EXT-IPS:type\": \"fixed\"}]}, \"links\": [{\"href\": \"http://10.109.13.3:8774/v2/65d0c9e644ac4c518e76bc9922ef47ee/servers/395ae0d7-59d9-4475-876d-3da1d0acc430\", \"rel\": \"self\"}, {\"href\": \"http://10.109.13.3:8774/65d0c9e644ac4c518e76bc9922ef47ee/servers/395ae0d7-59d9-4475-876d-3da1d0acc430\", \"rel\": \"bookmark\"}], \"key_name\": null, \"image\": {\"id\": \"06c7e85d-5023-43ef-a738-8f9aef71fd7a\", \"links\": [{\"href\": \"http://10.109.13.3:8774/65d0c9e644ac4c518e76bc9922ef47ee/images/06c7e85d-5023-43ef-a738-8f9aef71fd7a\", \"rel\": \"bookmark\"}]}, \"OS-EXT-STS:task_state\": null, \"OS-EXT-STS:vm_state\": \"soft-delete\", \"OS-EXT-SRV-ATTR:instance_name\": \"instance-0000004b\", \"OS-SRV-USG:launched_at\": \"2016-01-15T14:53:52.000000\", \"OS-EXT-SRV-ATTR:hypervisor_hostname\": \"node-9.test.domain.local\", \"flavor\": {\"id\": \"11ecb4f1-144a-4bb9-96ff-89bedcd5acde\", \"links\": [{\"href\": \"http://10.109.13.3:8774/65d0c9e644ac4c518e76bc9922ef47ee/flavors/11ecb4f1-144a-4bb9-96ff-89bedcd5acde\", \"rel\": \"bookmark\"}]}, \"id\": \"395ae0d7-59d9-4475-876d-3da1d0acc430\", \"security_groups\": [{\"name\": \"default\"}], \"OS-SRV-USG:terminated_at\": null, \"OS-EXT-AZ:availability_zone\": \"nova\", \"user_id\": \"7f0fce3a7e3f479b9933eff3df35649d\", \"name\": \"vm1\", \"created\": \"2016-01-15T14:53:17Z\", \"tenant_id\": \"65d0c9e644ac4c518e76bc9922ef47ee\", \"OS-DCF:diskConfig\": \"MANUAL\", \"os-extended-volumes:volumes_attached\": [{\"id\": \"ebcbb2f9-5125-4ef7-a507-3b7dfaa997bd\"}], \"accessIPv4\": \"\", \"accessIPv6\": \"\", \"OS-EXT-STS:power_state\": 4, \"config_drive\": \"\", \"metadata\": {}}}root@node-7:~# nova restore 395ae0d7-59d9-4475-876d-3da1d0acc430\n\n8. Try to restore the previously-deleted instance with its name as an argument:\nnova restore vm1\nThe result is:\nERROR (CommandError): No server with a name or ID of 'vm1' exists\n\n9. Try to restore the previously-deleted instance again with its  ID as an argument:\nnova restore 395ae0d7-59d9-4475-876d-3da1d0acc430\nThe result is:\nroot@node-7:~# nova list | grep vm1\n| 395ae0d7-59d9-4475-876d-3da1d0acc430 | vm1  | ACTIVE | -          | Running     | net01=192.168.1.43 |\n\nIn total,\nExpected result: both name and ID of server are accepted and processed correctly by 'nova restore' command\nActual result: only ID of server is accepted, not its name\n\nNova version - http://paste.openstack.org/show/483603/", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1534644", 
    "owner": "None", 
    "id": 1534644, 
    "index": 7234, 
    "openned": "2016-01-15 15:51:47.434387+00:00", 
    "created": "2016-01-15 15:51:47.434387+00:00", 
    "title": "'Nova restore <server>' accepts only ID of server, not its name", 
    "comments": [
        {
            "content": "For softly-deleted instance 'nova restore <server>' command returns:\nroot@node-7:~# nova restore vm1\nERROR (CommandError): No server with a name or ID of 'vm1' exists.\n\nSteps to reproduce:\n\n1. On every controller and compute add the reclaim_instance_interval=86400 line to [DEFAULT] section of /etc/nova/nova.conf\n\n2. Restart nova-api service on controllers and nova-compute service on computes\n\n3. Create net01: net01__subnet, 192.168.1.0/24:\nneutron net-create net01\nneutron subnet-create net01 192.168.1.0/24 --enable-dhcp --name net01__subnet\n\n4. Boot instance vm1 in net01:\nNET_ID=$(neutron net-list | grep 'net01' | awk '{print $2}')\nnova boot --flavor m1.micro --image TestVM --nic net-id=$NET_ID  --security-groups default vm1\n\n5. Create a volume and attach it to an instance vm1:\ncinder create 10 --display-name test-volume --availability-zone nova\nVM_ID=$(nova show vm1 | grep '| id ' | awk  '{print $4}')\nVOL_ID=$(cinder list | grep 'test-volume'| awk '{print $2}')\nnova volume-attach $VM_ID $VOL_ID /dev/vdb\n\n6. Delete instance vm1:\nnova delete vm1\n\n7. Check that instance vm1 is really in SOFT-DELETE state:\nroot@node-7:~# curl -s -H \"X-Auth-Token: $TOKEN\" $NOVA_ENDPOINT/servers/395ae0d7-59d9-4475-876d-3da1d0acc430\n{\"server\": {\"status\": \"SOFT_DELETED\", \"updated\": \"2016-01-15T14:57:10Z\", \"hostId\": \"4ab2af2839510dd4a32c0c0225646b8ce4d865161930fd9d0d075c68\", \"OS-EXT-SRV-ATTR:host\": \"node-9.test.domain.local\", \"addresses\": {\"net01\": [{\"OS-EXT-IPS-MAC:mac_addr\": \"fa:16:3e:b6:98:bc\", \"version\": 4, \"addr\": \"192.168.1.43\", \"OS-EXT-IPS:type\": \"fixed\"}]}, \"links\": [{\"href\": \"http://10.109.13.3:8774/v2/65d0c9e644ac4c518e76bc9922ef47ee/servers/395ae0d7-59d9-4475-876d-3da1d0acc430\", \"rel\": \"self\"}, {\"href\": \"http://10.109.13.3:8774/65d0c9e644ac4c518e76bc9922ef47ee/servers/395ae0d7-59d9-4475-876d-3da1d0acc430\", \"rel\": \"bookmark\"}], \"key_name\": null, \"image\": {\"id\": \"06c7e85d-5023-43ef-a738-8f9aef71fd7a\", \"links\": [{\"href\": \"http://10.109.13.3:8774/65d0c9e644ac4c518e76bc9922ef47ee/images/06c7e85d-5023-43ef-a738-8f9aef71fd7a\", \"rel\": \"bookmark\"}]}, \"OS-EXT-STS:task_state\": null, \"OS-EXT-STS:vm_state\": \"soft-delete\", \"OS-EXT-SRV-ATTR:instance_name\": \"instance-0000004b\", \"OS-SRV-USG:launched_at\": \"2016-01-15T14:53:52.000000\", \"OS-EXT-SRV-ATTR:hypervisor_hostname\": \"node-9.test.domain.local\", \"flavor\": {\"id\": \"11ecb4f1-144a-4bb9-96ff-89bedcd5acde\", \"links\": [{\"href\": \"http://10.109.13.3:8774/65d0c9e644ac4c518e76bc9922ef47ee/flavors/11ecb4f1-144a-4bb9-96ff-89bedcd5acde\", \"rel\": \"bookmark\"}]}, \"id\": \"395ae0d7-59d9-4475-876d-3da1d0acc430\", \"security_groups\": [{\"name\": \"default\"}], \"OS-SRV-USG:terminated_at\": null, \"OS-EXT-AZ:availability_zone\": \"nova\", \"user_id\": \"7f0fce3a7e3f479b9933eff3df35649d\", \"name\": \"vm1\", \"created\": \"2016-01-15T14:53:17Z\", \"tenant_id\": \"65d0c9e644ac4c518e76bc9922ef47ee\", \"OS-DCF:diskConfig\": \"MANUAL\", \"os-extended-volumes:volumes_attached\": [{\"id\": \"ebcbb2f9-5125-4ef7-a507-3b7dfaa997bd\"}], \"accessIPv4\": \"\", \"accessIPv6\": \"\", \"OS-EXT-STS:power_state\": 4, \"config_drive\": \"\", \"metadata\": {}}}root@node-7:~# nova restore 395ae0d7-59d9-4475-876d-3da1d0acc430\n\n8. Try to restore the previously-deleted instance with its name as an argument:\nnova restore vm1\nThe result is:\nERROR (CommandError): No server with a name or ID of 'vm1' exists\n\n9. Try to restore the previously-deleted instance again with its  ID as an argument:\nnova restore 395ae0d7-59d9-4475-876d-3da1d0acc430\nThe result is:\nroot@node-7:~# nova list | grep vm1\n| 395ae0d7-59d9-4475-876d-3da1d0acc430 | vm1  | ACTIVE | -          | Running     | net01=192.168.1.43 |\n\nIn total,\nExpected result: both name and ID of server are accepted and processed correctly by 'nova restore' command\nActual result: only ID of server is accepted, not its name\n\nNova version - http://paste.openstack.org/show/483603/", 
            "date_created": "2016-01-15 15:51:47.434387+00:00", 
            "author": "https://api.launchpad.net/1.0/~ababich"
        }, 
        {
            "content": "Now found out that 'nova show ' also doesn't accept the name of softly-deleted instance as an argument:\n\nroot@node-7:~# nova list\n+--------------------------------------+-------+--------+------------+-------------+--------------------+\n| ID                                   | Name  | Status | Task State | Power State | Networks           |\n+--------------------------------------+-------+--------+------------+-------------+--------------------+\n| 395ae0d7-59d9-4475-876d-3da1d0acc430 | vm1   | ACTIVE | -          | Running     | net01=192.168.1.43 |\n| fe0c024c-f094-4012-9068-3f43f2a90c8e | vm3   | ACTIVE | -          | Running     | net01=192.168.1.36 |\n| 87122a88-5d5e-4177-a5b1-59a9abdf0c99 | vm4   | ACTIVE | -          | Running     | net01=192.168.1.37 |\n| 0448668e-c093-4e35-961a-99b21ba51d26 | vm5   | ACTIVE | -          | Running     | net01=192.168.1.38 |\n| 5c3dd42c-6980-41c4-8d66-af47a028bb45 | vm555 | ACTIVE | -          | Running     | net01=192.168.1.44 |\n+--------------------------------------+-------+--------+------------+-------------+--------------------+\nroot@node-7:~# nova delete vm555\nRequest to delete server vm555 has been accepted.\nroot@node-7:~# nova list\n+--------------------------------------+------+--------+------------+-------------+--------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks           |\n+--------------------------------------+------+--------+------------+-------------+--------------------+\n| 395ae0d7-59d9-4475-876d-3da1d0acc430 | vm1  | ACTIVE | -          | Running     | net01=192.168.1.43 |\n| fe0c024c-f094-4012-9068-3f43f2a90c8e | vm3  | ACTIVE | -          | Running     | net01=192.168.1.36 |\n| 87122a88-5d5e-4177-a5b1-59a9abdf0c99 | vm4  | ACTIVE | -          | Running     | net01=192.168.1.37 |\n| 0448668e-c093-4e35-961a-99b21ba51d26 | vm5  | ACTIVE | -          | Running     | net01=192.168.1.38 |\n+--------------------------------------+------+--------+------------+-------------+--------------------+\nroot@node-7:~# nova restore vm555\nERROR (CommandError): No server with a name or ID of 'vm555' exists.\nroot@node-7:~# nova show vm555\nERROR (CommandError): No server with a name or ID of 'vm555' exists.\nroot@node-7:~# nova show 5c3dd42c-6980-41c4-8d66-af47a028bb45\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                   |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| OS-EXT-SRV-ATTR:host                 | node-10.test.domain.local                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | node-10.test.domain.local                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000004e                                        |\n| OS-EXT-STS:power_state               | 4                                                        |\n| OS-EXT-STS:task_state                | -                                                        |\n| OS-EXT-STS:vm_state                  | soft-delete                                              |\n| OS-SRV-USG:launched_at               | 2016-01-15T16:04:48.000000                               |\n| OS-SRV-USG:terminated_at             | -                                                        |\n| accessIPv4                           |                                                          |\n| accessIPv6                           |                                                          |\n| config_drive                         |                                                          |\n| created                              | 2016-01-15T16:04:34Z                                     |\n| flavor                               | m1.micro (11ecb4f1-144a-4bb9-96ff-89bedcd5acde)          |\n| hostId                               | 74344c4233399652024bffbd0dad72bee8c05a937fc8b57259f63fa1 |\n| id                                   | 5c3dd42c-6980-41c4-8d66-af47a028bb45                     |\n| image                                | TestVM (06c7e85d-5023-43ef-a738-8f9aef71fd7a)            |\n| key_name                             | -                                                        |\n| metadata                             | {}                                                       |\n| name                                 | vm555                                                    |\n| net01 network                        | 192.168.1.44                                             |\n| os-extended-volumes:volumes_attached | [{\"id\": \"4d50e16d-0694-42fc-bfd1-709d1272d17b\"}]         |\n| security_groups                      | default                                                  |\n| status                               | SOFT_DELETED                                             |\n| tenant_id                            | 65d0c9e644ac4c518e76bc9922ef47ee                         |\n| updated                              | 2016-01-15T16:06:54Z                                     |\n| user_id                              | 7f0fce3a7e3f479b9933eff3df35649d                         |\n+--------------------------------------+----------------------------------------------------------+\nroot@node-7:~# ", 
            "date_created": "2016-01-15 16:11:43.645483+00:00", 
            "author": "https://api.launchpad.net/1.0/~ababich"
        }, 
        {
            "content": "Bug skimming\n------------\nThe REST API of Nova only accepts IDs. The translation from instance \nname to instance ID happens in the \"python-novaclient\" CLI. \nThe translation seems to have an issue with soft deleted instances.", 
            "date_created": "2016-01-25 10:21:26.897272+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "yes, I confirmed this with a test\na python-novaclinet change should fix the problem", 
            "date_created": "2016-01-25 10:58:14.586382+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/272508", 
            "date_created": "2016-01-26 12:41:11.781006+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/272508\nCommitted: https://git.openstack.org/cgit/openstack/python-novaclient/commit/?id=6791a8be69529cc9557761183ea8cb00d253fe51\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6791a8be69529cc9557761183ea8cb00d253fe51\nAuthor: jichenjc <email address hidden>\nDate:   Sat Jan 23 22:06:48 2016 +0800\n\n    Allow restore command with name param\n    \n    when we try to restore an instance, it's already deleted state,\n    so we need to add 'delete=True' as default to restore command,\n    otherwise, the search function can't find the instance\n    whose state is deleted with the given name\n    \n    Change-Id: I81cdc46897d76333452069a691824264ad504518\n    Closes-Bug: 1534644\n", 
            "date_created": "2016-01-27 12:50:31.678002+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/python-novaclient 3.3.0 release.", 
            "date_created": "2016-03-02 18:09:24.680034+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }
    ], 
    "closed": "2016-01-25 10:21:11.481544+00:00"
}