{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:58:41.434787+00:00", 
    "description": "Neutron does not support creating or using floating ips on an ipv6 network. When nova gets a create floating ip call and does the passthrough call to neutron it will get a 400 response from neutron saying there is not ipv4 subnet available. This goes unhandled by nova and will cause a 500 response. Since this is an expected error, nova should catch it and return a 400 to the user for the same reason.\n\nFor example logs with the unhandled exception see:\n\nhttp://logs.openstack.org/47/210647/2/check/gate-tempest-dsvm-neutron-full/ea565de/logs/screen-n-api.txt.gz?level=TRACE\n\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack Traceback (most recent call last):\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 128, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return req.get_response(self.application)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1317, in send\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     application, catch_exc_info=False)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1281, in call_application\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return resp(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/__init__.py\", line 434, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     response = req.get_response(self._app)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1317, in send\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     application, catch_exc_info=False)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1281, in call_application\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return resp(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return resp(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 136, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     response = self.app(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return resp(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 756, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     content_type, body, accept)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 821, in _process_stack\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 911, in dispatch\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return method(req=request, **action_args)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/contrib/floating_ips.py\", line 115, in create\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     address = self.network_api.allocate_floating_ip(context, pool)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/network/neutronv2/api.py\", line 1392, in allocate_floating_ip\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     fip = client.create_floatingip(param)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 102, in with_params\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     ret = self.function(instance, *args, **kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 701, in create_floatingip\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return self.post(self.floatingips_path, body=body)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 298, in post\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     headers=headers, params=params)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 211, in do_request\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     self._handle_fault_response(status_code, replybody)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 185, in _handle_fault_response\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     exception_handler_v20(status_code, des_error_body)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 70, in exception_handler_v20\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     status_code=status_code)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack BadRequest: Bad floatingip request: Network c8f0e88f-ae41-47cb-be6c-d8256ba80576 does not contain any IPv4 subnet\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack", 
    "tags": [
        "ipv6", 
        "juno-backport-potential", 
        "kilo-backport-potential", 
        "network", 
        "neutron"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1482816", 
    "owner": "https://api.launchpad.net/1.0/~treinish", 
    "id": 1482816, 
    "index": 4320, 
    "openned": "2015-08-08 03:01:24.701862+00:00", 
    "created": "2015-08-08 03:01:24.701862+00:00", 
    "title": "Nova should not return a 500 on floating ip create with ipv6", 
    "comments": [
        {
            "content": "Neutron does not support creating or using floating ips on an ipv6 network. When nova gets a create floating ip call and does the passthrough call to neutron it will get a 400 response from neutron saying there is not ipv4 subnet available. This goes unhandled by nova and will cause a 500 response. Since this is an expected error, nova should catch it and return a 400 to the user for the same reason.\n\nFor example logs with the unhandled exception see:\n\nhttp://logs.openstack.org/47/210647/2/check/gate-tempest-dsvm-neutron-full/ea565de/logs/screen-n-api.txt.gz?level=TRACE\n\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack Traceback (most recent call last):\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 128, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return req.get_response(self.application)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1317, in send\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     application, catch_exc_info=False)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1281, in call_application\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return resp(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/keystonemiddleware/auth_token/__init__.py\", line 434, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     response = req.get_response(self._app)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1317, in send\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     application, catch_exc_info=False)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1281, in call_application\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     app_iter = application(self.environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return resp(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return resp(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/routes/middleware.py\", line 136, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     response = self.app(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return resp(environ, start_response)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return self.func(req, *args, **kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 756, in __call__\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     content_type, body, accept)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 821, in _process_stack\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 911, in dispatch\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return method(req=request, **action_args)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/contrib/floating_ips.py\", line 115, in create\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     address = self.network_api.allocate_floating_ip(context, pool)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/opt/stack/new/nova/nova/network/neutronv2/api.py\", line 1392, in allocate_floating_ip\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     fip = client.create_floatingip(param)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 102, in with_params\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     ret = self.function(instance, *args, **kwargs)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 701, in create_floatingip\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     return self.post(self.floatingips_path, body=body)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 298, in post\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     headers=headers, params=params)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 211, in do_request\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     self._handle_fault_response(status_code, replybody)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 185, in _handle_fault_response\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     exception_handler_v20(status_code, des_error_body)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/neutronclient/v2_0/client.py\", line 70, in exception_handler_v20\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack     status_code=status_code)\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack BadRequest: Bad floatingip request: Network c8f0e88f-ae41-47cb-be6c-d8256ba80576 does not contain any IPv4 subnet\n2015-08-08 01:55:33.923 20521 ERROR nova.api.openstack", 
            "date_created": "2015-08-08 03:01:24.701862+00:00", 
            "author": "https://api.launchpad.net/1.0/~treinish"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/210684", 
            "date_created": "2015-08-08 03:28:24.640099+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/210684\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=f500f99aadde965500fd813bf0229e8d19cd00ea\nSubmitter: Jenkins\nBranch:    master\n\ncommit f500f99aadde965500fd813bf0229e8d19cd00ea\nAuthor: Matthew Treinish <email address hidden>\nDate:   Fri Aug 7 23:17:39 2015 -0400\n\n    Handle neutron exception on bad floating ip create request\n    \n    This commit adds a new nova exception to handle a floating ip create\n    failure with a BadRequest exception from neutronclient. This is then\n    used in all 3 nova api implementations to ensure a 400 response is\n    returned just as neutron is returning to nova.\n    \n    Change-Id: I36e8ef0113ae91e3b15c846c6d10e0b766cf2a37\n    Closes-Bug: #1482816\n", 
            "date_created": "2015-08-28 23:25:11.091580+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-09-03 11:45:46.449028+00:00"
}