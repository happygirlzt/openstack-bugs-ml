{
    "status": "Expired", 
    "last_updated": "2016-04-18 04:17:46.433034+00:00", 
    "description": "If I set \"mage_cache_subdirectory_name=_base$my_ip\" in nova.conf  for using glance cache function.  Then I create a instance failed.\n\n[DEFAULT]\nverbose = True\ndhcpbridge_flagfile=/etc/nova/nova.conf\ndhcpbridge=/usr/bin/nova-dhcpbridge\nlogdir=/var/log/nova\nstate_path=/var/lib/nova\nlock_path=/var/lock/nova\nforce_dhcp_release=True\nlibvirt_use_virtio_for_bridges=True\nverbose=True\nec2_private_dns_show_ip=True\napi_paste_config=/etc/nova/api-paste.ini\nenabled_apis=ec2,osapi_compute,metadata\nrpc_backend = rabbit\nauth_strategy = keystone\nmy_ip = 10.10.10.30\nnetwork_api_class = nova.network.neutronv2.api.API\nsecurity_group_api = neutron\nlinuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver\nfirewall_driver = nova.virt.firewall.NoopFirewallDriver\n\nimage_cache_subdirectory_name = _base$my_ip\n[oslo_messaging_rabbit]\nrabbit_host = 10.10.10.10\nrabbit_userid = openstack\nrabbit_password = 123qwe\n\n[keystone_authtoken]\nauth_uri = http://10.10.10.10:5000\nauth_url = http://10.10.10.10:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = nova\npassword = 123qwe\n\n[vnc]\nenabled = True\nvncserver_listen = 0.0.0.0\nvncserver_proxyclient_address = 10.10.10.30\nnovncproxy_base_url = http://10.10.10.10:6080/vnc_auto.html\n\n[glance]\nhost = 10.10.10.10\n\n[oslo_concurrency]\nlock_path = /var/lib/nova/tmp\n\n[neutron]\nurl = http://10.10.10.10:9696\nauth_url = http://10.10.10.10:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = 123qwe\n\n[xenserver]\ncache_images = all\n\n\nI found some error informations in /var/log/nova/nova-compute.log\n\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a] Traceback (most recent call last):\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2155, in _build_resources\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     yield resources\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2009, in _build_and_run_instance\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     block_device_info=block_device_info)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2444, in spawn\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     block_device_info=block_device_info)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 4519, in _create_domain_and_network\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     xml, pause=pause, power_on=power_on)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 4449, in _create_domain\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     guest.launch(pause=pause)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/guest.py\", line 141, in launch\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     self._encoded_xml, errors='ignore')\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     six.reraise(self.type_, self.value, self.tb)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/guest.py\", line 136, in launch\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     return self._domain.createWithFlags(flags)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     rv = execute(f, *args, **kwargs)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     six.reraise(c, e, tb)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     rv = meth(*args, **kwargs)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a] libvirtError: internal error: process exited while connecting to monitor: 2015-10-27T02:23:16.229430Z qemu-system-x86_64: -drive file=/var/lib/nova/instances/1e208e90-a6cd-415f-be9c-7f7af3cec69a/disk,if=none,id=drive-virtio-disk0,format=qcow2,cache=none: Could not open backing file: Could not open '/var/lib/nova/instances/_base10.10.10.30/cd799cdd4ec3bfd3f43e3a0e995909464d6dcfc2': Permission denied\n\nI check that the owner of _base$my_ip is not nova,  then get permission denied.", 
    "tags": [
        "glance", 
        "libvirt"
    ], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1524205", 
    "owner": "None", 
    "id": 1524205, 
    "index": 7163, 
    "openned": "2015-12-09 07:22:11.721713+00:00", 
    "created": "2015-12-09 07:22:11.721713+00:00", 
    "title": "To set 'image_cache_subdirectory_name=_base$my_ip',  and create a instance failed.  ", 
    "comments": [
        {
            "content": "If I set \"mage_cache_subdirectory_name=_base$my_ip\" in nova.conf  for using glance cache function.  Then I create a instance failed.\n\n[DEFAULT]\nverbose = True\ndhcpbridge_flagfile=/etc/nova/nova.conf\ndhcpbridge=/usr/bin/nova-dhcpbridge\nlogdir=/var/log/nova\nstate_path=/var/lib/nova\nlock_path=/var/lock/nova\nforce_dhcp_release=True\nlibvirt_use_virtio_for_bridges=True\nverbose=True\nec2_private_dns_show_ip=True\napi_paste_config=/etc/nova/api-paste.ini\nenabled_apis=ec2,osapi_compute,metadata\nrpc_backend = rabbit\nauth_strategy = keystone\nmy_ip = 10.10.10.30\nnetwork_api_class = nova.network.neutronv2.api.API\nsecurity_group_api = neutron\nlinuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver\nfirewall_driver = nova.virt.firewall.NoopFirewallDriver\n\nimage_cache_subdirectory_name = _base$my_ip\n[oslo_messaging_rabbit]\nrabbit_host = 10.10.10.10\nrabbit_userid = openstack\nrabbit_password = 123qwe\n\n[keystone_authtoken]\nauth_uri = http://10.10.10.10:5000\nauth_url = http://10.10.10.10:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = nova\npassword = 123qwe\n\n[vnc]\nenabled = True\nvncserver_listen = 0.0.0.0\nvncserver_proxyclient_address = 10.10.10.30\nnovncproxy_base_url = http://10.10.10.10:6080/vnc_auto.html\n\n[glance]\nhost = 10.10.10.10\n\n[oslo_concurrency]\nlock_path = /var/lib/nova/tmp\n\n[neutron]\nurl = http://10.10.10.10:9696\nauth_url = http://10.10.10.10:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = 123qwe\n\n[xenserver]\ncache_images = all\n\n\nI found some error informations in /var/log/nova/nova-compute.log\n\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a] Traceback (most recent call last):\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2155, in _build_resources\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     yield resources\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2009, in _build_and_run_instance\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     block_device_info=block_device_info)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 2444, in spawn\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     block_device_info=block_device_info)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 4519, in _create_domain_and_network\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     xml, pause=pause, power_on=power_on)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 4449, in _create_domain\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     guest.launch(pause=pause)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/guest.py\", line 141, in launch\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     self._encoded_xml, errors='ignore')\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     six.reraise(self.type_, self.value, self.tb)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/guest.py\", line 136, in launch\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     return self._domain.createWithFlags(flags)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     rv = execute(f, *args, **kwargs)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     six.reraise(c, e, tb)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     rv = meth(*args, **kwargs)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2015-10-27 10:23:16.719 39365 ERROR nova.compute.manager [instance: 1e208e90-a6cd-415f-be9c-7f7af3cec69a] libvirtError: internal error: process exited while connecting to monitor: 2015-10-27T02:23:16.229430Z qemu-system-x86_64: -drive file=/var/lib/nova/instances/1e208e90-a6cd-415f-be9c-7f7af3cec69a/disk,if=none,id=drive-virtio-disk0,format=qcow2,cache=none: Could not open backing file: Could not open '/var/lib/nova/instances/_base10.10.10.30/cd799cdd4ec3bfd3f43e3a0e995909464d6dcfc2': Permission denied\n\nI check that the owner of _base$my_ip is not nova,  then get permission denied.", 
            "date_created": "2015-12-09 07:22:11.721713+00:00", 
            "author": "https://api.launchpad.net/1.0/~ytwxy99"
        }, 
        {
            "content": "AFAIK, glance image cache is transparent to the user: so the user don't know if he is using cache or not.\nIt also doesn't have any dependencies on nova caching implementation. \nAFAIU caching in nova is managed by Nova so please change affected projects. Please, reopen a bug if there is glance dependencies on it.", 
            "date_created": "2015-12-22 16:06:50.326156+00:00", 
            "author": "https://api.launchpad.net/1.0/~kkushaev"
        }, 
        {
            "content": "What is 'ls -la' on /var/lib/nova/instances/_base10.10.10.30  after this happens", 
            "date_created": "2016-02-17 20:58:50.022663+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2016-04-18 04:17:43.325977+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2016-04-18 04:17:44.101399+00:00"
}