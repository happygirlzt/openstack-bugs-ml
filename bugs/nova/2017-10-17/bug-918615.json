{
    "status": "Fix Released", 
    "last_updated": "2012-02-27 10:34:55.036527+00:00", 
    "description": "When I tried to start instance that is previously stopped using start method of compute API, I get the following error.\n\n------------------------------------\n2012-01-19 17:09:10,466 DEBUG nova.rpc [-] received {u'_context_roles': [u'Member', u'sysadmin', u'netadmin'], u'_context_request_id': u'req-542cdb1d-205c-43fc-bedc-c27fda6392c5', u'_context_read_deleted': u'no', u'args': {u'topic': u'compute', u'instance_uuid': u'4d631686-572a-4e67-b49a-77b3fb42692b'}, u'_context_auth_token': u'd05e72c3-1bac-4841-9ea5-51e92557750b', u'_context_strategy': u'keystone', u'_context_is_admin': False, u'_context_project_id': u'2', u'_context_timestamp': u'2012-01-19T08:09:10.324649', u'_context_user_id': u'demo', u'method': u'start_instance', u'_context_remote_address': u'192.168.1.138'} from (pid=18608) debug /opt/stack/nova/nova/log.py:175\n2012-01-19 17:09:10,467 DEBUG nova.rpc [req-542cdb1d-205c-43fc-bedc-c27fda6392c5 demo 2] unpacked context: {'request_id': u'req-542cdb1d-205c-43fc-bedc-c27fda6392c5', 'user_id': u'demo', 'roles': [u'Member', u'sysadmin', u'netadmin'], 'timestamp': '2012-01-19T08:09:10.324649', 'is_admin': False, 'auth_token': u'd05e72c3-1bac-4841-9ea5-51e92557750b', 'project_id': u'2', 'remote_address': u'192.168.1.138', 'read_deleted': u'no', 'strategy': u'keystone'} from (pid=18608) debug /opt/stack/nova/nova/log.py:175\n2012-01-19 17:09:10,467 WARNING nova.scheduler.manager [-] Failed to schedule_start_instance: schedule_start_instance() takes at least 3 arguments (2 given)\n2012-01-19 17:09:10,467 WARNING nova.scheduler.manager [-] Setting instance 4d631686-572a-4e67-b49a-77b3fb42692b to ERROR state.\n2012-01-19 17:09:10,556 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 723, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 106, in _schedule\n(nova.rpc): TRACE:     self._set_instance_error(method, context, ex, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc): TRACE:     self.gen.next()\n(nova.rpc): TRACE:   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 101, in _schedule\n(nova.rpc): TRACE:     return real_meth(*args, **kwargs)\n(nova.rpc): TRACE: TypeError: schedule_start_instance() takes at least 3 arguments (2 given)\n(nova.rpc): TRACE:\n--------------------------------\n\nAnd the following change seems to solve the problem.\n--------------------------------\ndiff --git a/nova/scheduler/simple.py b/nova/scheduler/simple.py\nindex fb80075..008348a 100644\n--- a/nova/scheduler/simple.py\n+++ b/nova/scheduler/simple.py\n@@ -101,12 +101,12 @@ class SimpleScheduler(chance.ChanceScheduler):\n             del request_spec['instance_properties']['uuid']\n         return instances\n \n-    def schedule_start_instance(self, context, instance_id, *_args, **_kwargs):\n-        instance_ref = db.instance_get(context, instance_id)\n+    def schedule_start_instance(self, context, instance_uuid, *_args, **_kwargs):\n+        instance_ref = db.instance_get(context, instance_uuid)\n         host = self._schedule_instance(context, instance_ref,\n                 *_args, **_kwargs)\n         driver.cast_to_compute_host(context, host, 'start_instance',\n-                instance_id=instance_id, **_kwargs)\n+                instance_uuid=instance_uuid, **_kwargs)\n \n     def schedule_create_volume(self, context, volume_id, *_args, **_kwargs):\n         \"\"\"Picks a host that is up and has the fewest volumes.\"\"\"\n\n\n--------------------------------", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/918615", 
    "owner": "https://api.launchpad.net/1.0/~cbehrens", 
    "id": 918615, 
    "index": 411, 
    "openned": "2012-01-19 10:38:08.322220+00:00", 
    "created": "2012-01-19 10:38:08.322220+00:00", 
    "title": "compute_api.start() crashes at schedule_start_instance()", 
    "comments": [
        {
            "content": "When I tried to start instance that is previously stopped using start method of compute API, I get the following error.\n\n------------------------------------\n2012-01-19 17:09:10,466 DEBUG nova.rpc [-] received {u'_context_roles': [u'Member', u'sysadmin', u'netadmin'], u'_context_request_id': u'req-542cdb1d-205c-43fc-bedc-c27fda6392c5', u'_context_read_deleted': u'no', u'args': {u'topic': u'compute', u'instance_uuid': u'4d631686-572a-4e67-b49a-77b3fb42692b'}, u'_context_auth_token': u'd05e72c3-1bac-4841-9ea5-51e92557750b', u'_context_strategy': u'keystone', u'_context_is_admin': False, u'_context_project_id': u'2', u'_context_timestamp': u'2012-01-19T08:09:10.324649', u'_context_user_id': u'demo', u'method': u'start_instance', u'_context_remote_address': u'192.168.1.138'} from (pid=18608) debug /opt/stack/nova/nova/log.py:175\n2012-01-19 17:09:10,467 DEBUG nova.rpc [req-542cdb1d-205c-43fc-bedc-c27fda6392c5 demo 2] unpacked context: {'request_id': u'req-542cdb1d-205c-43fc-bedc-c27fda6392c5', 'user_id': u'demo', 'roles': [u'Member', u'sysadmin', u'netadmin'], 'timestamp': '2012-01-19T08:09:10.324649', 'is_admin': False, 'auth_token': u'd05e72c3-1bac-4841-9ea5-51e92557750b', 'project_id': u'2', 'remote_address': u'192.168.1.138', 'read_deleted': u'no', 'strategy': u'keystone'} from (pid=18608) debug /opt/stack/nova/nova/log.py:175\n2012-01-19 17:09:10,467 WARNING nova.scheduler.manager [-] Failed to schedule_start_instance: schedule_start_instance() takes at least 3 arguments (2 given)\n2012-01-19 17:09:10,467 WARNING nova.scheduler.manager [-] Setting instance 4d631686-572a-4e67-b49a-77b3fb42692b to ERROR state.\n2012-01-19 17:09:10,556 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 723, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 106, in _schedule\n(nova.rpc): TRACE:     self._set_instance_error(method, context, ex, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc): TRACE:     self.gen.next()\n(nova.rpc): TRACE:   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 101, in _schedule\n(nova.rpc): TRACE:     return real_meth(*args, **kwargs)\n(nova.rpc): TRACE: TypeError: schedule_start_instance() takes at least 3 arguments (2 given)\n(nova.rpc): TRACE:\n--------------------------------\n\nAnd the following change seems to solve the problem.\n--------------------------------\ndiff --git a/nova/scheduler/simple.py b/nova/scheduler/simple.py\nindex fb80075..008348a 100644\n--- a/nova/scheduler/simple.py\n+++ b/nova/scheduler/simple.py\n@@ -101,12 +101,12 @@ class SimpleScheduler(chance.ChanceScheduler):\n             del request_spec['instance_properties']['uuid']\n         return instances\n \n-    def schedule_start_instance(self, context, instance_id, *_args, **_kwargs):\n-        instance_ref = db.instance_get(context, instance_id)\n+    def schedule_start_instance(self, context, instance_uuid, *_args, **_kwargs):\n+        instance_ref = db.instance_get(context, instance_uuid)\n         host = self._schedule_instance(context, instance_ref,\n                 *_args, **_kwargs)\n         driver.cast_to_compute_host(context, host, 'start_instance',\n-                instance_id=instance_id, **_kwargs)\n+                instance_uuid=instance_uuid, **_kwargs)\n \n     def schedule_create_volume(self, context, volume_id, *_args, **_kwargs):\n         \"\"\"Picks a host that is up and has the fewest volumes.\"\"\"\n\n\n--------------------------------", 
            "date_created": "2012-01-19 10:38:08.322220+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomoe"
        }, 
        {
            "content": "What command were you running to reproduce this behavior?", 
            "date_created": "2012-01-20 07:18:16.151496+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "euca-start-instance should reproduce the issue, although I was trying something different .\nI've been working on adding new api for blueprint https://blueprints.launchpad.net/nova/+spec/start-stop-methods-support-in-os-servers-xapi. so I was calling this api directly from my new controller.", 
            "date_created": "2012-01-20 08:19:32.836258+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomoe"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/3267", 
            "date_created": "2012-01-21 08:11:17.072617+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/3267\nCommitted: http://github.com/openstack/nova/commit/26b7c43ca1fe94f937d6a6d89b3114ce9931c74d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 26b7c43ca1fe94f937d6a6d89b3114ce9931c74d\nAuthor: Chris Behrens <email address hidden>\nDate:   Sat Jan 21 08:04:19 2012 +0000\n\n    Make start_instance cast directly to compute host\n    \n    Fixes bug 918615\n    \n    start_instance doesn't need to go through scheduler because it still has\n    instance['host'] set and resources are still accounted for in the\n    scheduler, which means there's still room to restart it on its assigned\n    host (even though it is deleted from the virt layer)\n    \n    Change-Id: I3cdd73b7ad2297b57f7e36be84819ff233ac8f08\n", 
            "date_created": "2012-01-22 15:29:19.984225+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-02-27 10:34:53.039433+00:00"
}