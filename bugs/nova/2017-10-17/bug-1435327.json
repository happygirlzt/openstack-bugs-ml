{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:29:15.144566+00:00", 
    "description": "After v2.1 policy separated into policy.d. The unittest will failed. Because fake policy fixture will load policy config from real '/etc/nova/policy.d' which override the fake policy rules.\n\n\n\n\n{7} nova.tests.unit.api.openstack.compute.contrib.test_cells.CellsTestV21.test_detail [0.020009s] ... FAILED\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"nova/tests/unit/api/openstack/compute/contrib/test_cells.py\", line 119, in test_detail\n        res_dict = self.controller.detail(req)\n      File \"nova/api/openstack/extensions.py\", line 478, in wrapped\n        return f(*args, **kwargs)\n      File \"nova/api/openstack/common.py\", line 551, in inner\n        return function(*args, **kwargs)\n      File \"nova/api/openstack/compute/plugins/v3/cells.py\", line 121, in detail\n        authorize(ctxt)\n      File \"nova/api/openstack/extensions.py\", line 347, in authorize\n        nova.policy.enforce(context, act, target)\n      File \"nova/policy.py\", line 104, in enforce\n        {'action': action, 'credentials': credentials})\n      File \"/opt/stack/nova/.tox/py27/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n        six.reraise(self.type_, self.value, self.tb)\n      File \"nova/policy.py\", line 98, in enforce\n        do_raise=do_raise, exc=exc, action=action)\n      File \"nova/openstack/common/policy.py\", line 363, in enforce\n        raise exc(*args, **kwargs)\n    nova.exception.PolicyNotAuthorized: Policy doesn't allow os_compute_api:os-cells to be performed.\n\n{5} nova.tests.unit.api.openstack.compute.contrib.test_aggregates.AggregateTestCaseV21.test_remove_host_no_admin [0.027056s] ... ok\n{7} nova.tests.unit.api.openstack.compute.contrib.test_cells.CellsTestV21.test_index [0.018851s] ... FAILED\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"nova/tests/unit/api/openstack/compute/contrib/test_cells.py\", line 109, in test_index\n        res_dict = self.controller.index(req)\n      File \"nova/api/openstack/extensions.py\", line 478, in wrapped\n        return f(*args, **kwargs)\n      File \"nova/api/openstack/common.py\", line 551, in inner\n        return function(*args, **kwargs)\n      File \"nova/api/openstack/compute/plugins/v3/cells.py\", line 113, in index\n        authorize(ctxt)\n      File \"nova/api/openstack/extensions.py\", line 347, in authorize\n        nova.policy.enforce(context, act, target)\n      File \"nova/policy.py\", line 104, in enforce\n        {'action': action, 'credentials': credentials})\n      File \"/opt/stack/nova/.tox/py27/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n        six.reraise(self.type_, self.value, self.tb)\n      File \"nova/policy.py\", line 98, in enforce\n        do_raise=do_raise, exc=exc, action=action)\n      File \"nova/openstack/common/policy.py\", line 363, in enforce\n        raise exc(*args, **kwargs)\n    nova.exception.PolicyNotAuthorized: Policy doesn't allow os_compute_api:os-cells to be performed.", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1435327", 
    "owner": "https://api.launchpad.net/1.0/~xuhj", 
    "id": 1435327, 
    "index": 1630, 
    "openned": "2015-03-23 13:24:48.153443+00:00", 
    "created": "2015-03-23 13:24:48.153443+00:00", 
    "title": "api unittest failed with policy config in '/etc/nova/policy.d'", 
    "comments": [
        {
            "content": "After v2.1 policy separated into policy.d. The unittest will failed. Because fake policy fixture will load policy config from real '/etc/nova/policy.d' which override the fake policy rules.\n\n\n\n\n{7} nova.tests.unit.api.openstack.compute.contrib.test_cells.CellsTestV21.test_detail [0.020009s] ... FAILED\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"nova/tests/unit/api/openstack/compute/contrib/test_cells.py\", line 119, in test_detail\n        res_dict = self.controller.detail(req)\n      File \"nova/api/openstack/extensions.py\", line 478, in wrapped\n        return f(*args, **kwargs)\n      File \"nova/api/openstack/common.py\", line 551, in inner\n        return function(*args, **kwargs)\n      File \"nova/api/openstack/compute/plugins/v3/cells.py\", line 121, in detail\n        authorize(ctxt)\n      File \"nova/api/openstack/extensions.py\", line 347, in authorize\n        nova.policy.enforce(context, act, target)\n      File \"nova/policy.py\", line 104, in enforce\n        {'action': action, 'credentials': credentials})\n      File \"/opt/stack/nova/.tox/py27/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n        six.reraise(self.type_, self.value, self.tb)\n      File \"nova/policy.py\", line 98, in enforce\n        do_raise=do_raise, exc=exc, action=action)\n      File \"nova/openstack/common/policy.py\", line 363, in enforce\n        raise exc(*args, **kwargs)\n    nova.exception.PolicyNotAuthorized: Policy doesn't allow os_compute_api:os-cells to be performed.\n\n{5} nova.tests.unit.api.openstack.compute.contrib.test_aggregates.AggregateTestCaseV21.test_remove_host_no_admin [0.027056s] ... ok\n{7} nova.tests.unit.api.openstack.compute.contrib.test_cells.CellsTestV21.test_index [0.018851s] ... FAILED\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"nova/tests/unit/api/openstack/compute/contrib/test_cells.py\", line 109, in test_index\n        res_dict = self.controller.index(req)\n      File \"nova/api/openstack/extensions.py\", line 478, in wrapped\n        return f(*args, **kwargs)\n      File \"nova/api/openstack/common.py\", line 551, in inner\n        return function(*args, **kwargs)\n      File \"nova/api/openstack/compute/plugins/v3/cells.py\", line 113, in index\n        authorize(ctxt)\n      File \"nova/api/openstack/extensions.py\", line 347, in authorize\n        nova.policy.enforce(context, act, target)\n      File \"nova/policy.py\", line 104, in enforce\n        {'action': action, 'credentials': credentials})\n      File \"/opt/stack/nova/.tox/py27/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n        six.reraise(self.type_, self.value, self.tb)\n      File \"nova/policy.py\", line 98, in enforce\n        do_raise=do_raise, exc=exc, action=action)\n      File \"nova/openstack/common/policy.py\", line 363, in enforce\n        raise exc(*args, **kwargs)\n    nova.exception.PolicyNotAuthorized: Policy doesn't allow os_compute_api:os-cells to be performed.", 
            "date_created": "2015-03-23 13:24:48.153443+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/166811", 
            "date_created": "2015-03-23 13:26:55.682339+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/166811\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e77be6c6da0720f8c28b983746579188245c58d0\nSubmitter: Jenkins\nBranch:    master\n\ncommit e77be6c6da0720f8c28b983746579188245c58d0\nAuthor: He Jie Xu <email address hidden>\nDate:   Mon Mar 23 21:24:06 2015 +0800\n\n    Avoid load real policy from policy.d when using fake policy fixture\n    \n    The v2.1 API policy rules separated into a file in policy.d. But the\n    fake policy fixture didn't override the default policy_dirs config,\n    that leads to fake policy fixture will load real policy config from\n    \"/etc/nova/policy.d\" and unittest will failed.\n    \n    This patch override default policy_dirs value to empty list.\n    \n    Change-Id: I7d8958dc2f0bb927b98b2bb86c99e855db6c5e2e\n    Closes-Bug: #1435327\n", 
            "date_created": "2015-04-02 15:07:12.187535+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-04-10 09:23:04.538002+00:00"
}