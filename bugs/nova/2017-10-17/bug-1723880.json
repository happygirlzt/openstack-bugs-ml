{
    "status": "Confirmed", 
    "last_updated": "2017-10-16 15:24:25.288381+00:00", 
    "description": "I create an instance with the availability zone named 'test_az' and host named 'compute', and then shelve the instance, then delete the availability zone test_az.\nBut the instance availability zone is still 'test_az',and unshelve the instance failed with the message \"No valid host found for unshelve instance\"\n[root@controller ~(admin)]$ nova show test3\n+--------------------------------------+---------------------------------------------------+\n| Property                             | Value                                             |\n+--------------------------------------+---------------------------------------------------+\n| OS-DCF:diskConfig                    | AUTO                                              |\n| OS-EXT-AZ:availability_zone          | test_az                                           |\n| OS-EXT-SRV-ATTR:host                 | -                                                 |\n| OS-EXT-SRV-ATTR:hostname             | test3                                             |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                 |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000004                                 |\n| OS-EXT-SRV-ATTR:kernel_id            |                                                   |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                 |\n| OS-EXT-SRV-ATTR:ramdisk_id           |                                                   |\n| OS-EXT-SRV-ATTR:reservation_id       | r-3i45u68y                                        |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                          |\n| OS-EXT-SRV-ATTR:user_data            | -                                                 |\n| OS-EXT-STS:power_state               | 4                                                 |\n| OS-EXT-STS:task_state                | -                                                 |\n| OS-EXT-STS:vm_state                  | shelved_offloaded                                 |\n| OS-SRV-USG:launched_at               | 2017-10-16T07:05:18.000000                        |\n| OS-SRV-USG:terminated_at             | -                                                 |\n| accessIPv4                           |                                                   |\n| accessIPv6                           |                                                   |\n| config_drive                         |                                                   |\n| created                              | 2017-10-16T07:05:12Z                              |\n| description                          | test3                                             |\n| flavor                               | m1.small (2)                                      |\n| hostId                               |                                                   |\n| host_status                          |                                                   |\n| id                                   | 8cf627b7-fe67-405b-92b1-a42a6c66f8a6              |\n| image                                | centos_7_2 (090d5564-9c64-459e-8d10-4382f1c72488) |\n| key_name                             | -                                                 |\n| locked                               | False                                             |\n| metadata                             | {}                                                |\n| name                                 | test3                                             |\n| os-extended-volumes:volumes_attached | []                                                |\n| security_groups                      | default                                           |\n| status                               | SHELVED_OFFLOADED                                 |\n| tenant_id                            | 764169e694474ba0a40030e6c8531704                  |\n| test network                         | 192.168.0.5                                       |\n| updated                              | 2017-10-16T07:07:33Z                              |\n| user_id                              | 2ccb44e4ce2e42d5b805b898f2c10243                  |\n+--------------------------------------+---------------------------------------------------+", 
    "tags": [
        "availability-zones", 
        "shelve"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1723880", 
    "owner": "None", 
    "id": 1723880, 
    "index": 8342, 
    "openned": "2017-10-16 08:21:13.978610+00:00", 
    "created": "2017-10-16 08:21:13.978610+00:00", 
    "title": "Unshelve instance failed with availability zone which be deleted", 
    "comments": [
        {
            "content": "I create an instance with the availability zone named 'test_az' and host named 'compute', and then shelve the instance, then delete the availability zone test_az.\nBut the instance availability zone is still 'test_az',and unshelve the instance failed with the message \"No valid host found for unshelve instance\"\n[root@controller ~(admin)]$ nova show test3\n+--------------------------------------+---------------------------------------------------+\n| Property                             | Value                                             |\n+--------------------------------------+---------------------------------------------------+\n| OS-DCF:diskConfig                    | AUTO                                              |\n| OS-EXT-AZ:availability_zone          | test_az                                           |\n| OS-EXT-SRV-ATTR:host                 | -                                                 |\n| OS-EXT-SRV-ATTR:hostname             | test3                                             |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                 |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000004                                 |\n| OS-EXT-SRV-ATTR:kernel_id            |                                                   |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                 |\n| OS-EXT-SRV-ATTR:ramdisk_id           |                                                   |\n| OS-EXT-SRV-ATTR:reservation_id       | r-3i45u68y                                        |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                          |\n| OS-EXT-SRV-ATTR:user_data            | -                                                 |\n| OS-EXT-STS:power_state               | 4                                                 |\n| OS-EXT-STS:task_state                | -                                                 |\n| OS-EXT-STS:vm_state                  | shelved_offloaded                                 |\n| OS-SRV-USG:launched_at               | 2017-10-16T07:05:18.000000                        |\n| OS-SRV-USG:terminated_at             | -                                                 |\n| accessIPv4                           |                                                   |\n| accessIPv6                           |                                                   |\n| config_drive                         |                                                   |\n| created                              | 2017-10-16T07:05:12Z                              |\n| description                          | test3                                             |\n| flavor                               | m1.small (2)                                      |\n| hostId                               |                                                   |\n| host_status                          |                                                   |\n| id                                   | 8cf627b7-fe67-405b-92b1-a42a6c66f8a6              |\n| image                                | centos_7_2 (090d5564-9c64-459e-8d10-4382f1c72488) |\n| key_name                             | -                                                 |\n| locked                               | False                                             |\n| metadata                             | {}                                                |\n| name                                 | test3                                             |\n| os-extended-volumes:volumes_attached | []                                                |\n| security_groups                      | default                                           |\n| status                               | SHELVED_OFFLOADED                                 |\n| tenant_id                            | 764169e694474ba0a40030e6c8531704                  |\n| test network                         | 192.168.0.5                                       |\n| updated                              | 2017-10-16T07:07:33Z                              |\n| user_id                              | 2ccb44e4ce2e42d5b805b898f2c10243                  |\n+--------------------------------------+---------------------------------------------------+", 
            "date_created": "2017-10-16 08:21:13.978610+00:00", 
            "author": "https://api.launchpad.net/1.0/~qearl"
        }, 
        {
            "content": "Hmm, sounds legitimate. The question would be what we should do about this. Should a user expect that if they created an instance in a specific AZ and shelve offload it, that when unshelving it the instance will go back into that same AZ? We don't allow overriding an AZ on unshelve, so we'd have to use what was in the original request spec and if that AZ is now gone, do we just ignore the AZ - some might consider that an error too.\n\nThis probably wouldn't happen in a normal production stable cloud since the AZs shouldn't be changing like this without at least migrating the instances out of those AZs first.", 
            "date_created": "2017-10-16 14:03:29.132574+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Brought this up in the operators ML:\n\nhttp://lists.openstack.org/pipermail/openstack-operators/2017-October/014393.html", 
            "date_created": "2017-10-16 15:24:24.795236+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ]
}