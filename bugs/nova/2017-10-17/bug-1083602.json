{
    "status": "Opinion", 
    "last_updated": "2017-05-10 07:37:25.273812+00:00", 
    "description": "I'm testing nova client 2.9.0.\n\nI worked as a user with admin privileges.\n\nI created a private flavor with command:\n\n$ nova flavor-create myFlavor 10 512 1 1 --is-public false\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| ID | Name     | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | extra_specs |\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| 10 | myFlavor | 512       | 1    | 0         |      | 1     | 1           | False     | {}          |\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n\nThen, I associated the just created flavor to the tenant I was using with command:\n\n$ nova flavor-access-add 10 admin\n+-----------+-----------+\n| Flavor_ID | Tenant_ID |\n+-----------+-----------+\n| 10        | admin     |\n+-----------+-----------+\n\nIf I list the flavors, with command nova flavor-list, the new flavor is not displayed:\n\n$ nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | extra_specs |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| 1  | m1.tiny   | 512       | 0    | 0         |      | 1     | 1.0         | True      | {}          |\n| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      | {}          |\n| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      | {}          |\n| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      | {}          |\n| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      | {}          |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n\nEven in the case I list with this other command, the new flavor is not shown:\n\n$ nova flavor-access-list --flavor=10\nERROR: Failed to get access list for public flavor type.\n\n$ nova flavor-access-list --tenant admin\nERROR: Sorry, query by tenant not supported.\n\nPlease note that I get the same results if I don't associate the private flavor to any project.\n\nAccording to the specification I found here https://blueprints.launchpad.net/nova/+spec/project-specific-flavors, It seems to me that private flavor types are not working.", 
    "tags": [
        "flavor"
    ], 
    "importance": "Wishlist", 
    "heat": 28, 
    "link": "https://bugs.launchpad.net/nova/+bug/1083602", 
    "owner": "None", 
    "id": 1083602, 
    "index": 2574, 
    "openned": "2012-11-27 14:09:33.274588+00:00", 
    "created": "2012-11-27 14:09:33.274588+00:00", 
    "title": "Private flavors can't be used", 
    "comments": [
        {
            "content": "I'm testing nova client 2.9.0.\n\nI worked as a user with admin privileges.\n\nI created a private flavor with command:\n\n$ nova flavor-create myFlavor 10 512 1 1 --is-public false\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| ID | Name     | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | extra_specs |\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| 10 | myFlavor | 512       | 1    | 0         |      | 1     | 1           | False     | {}          |\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n\nThen, I associated the just created flavor to the tenant I was using with command:\n\n$ nova flavor-access-add 10 admin\n+-----------+-----------+\n| Flavor_ID | Tenant_ID |\n+-----------+-----------+\n| 10        | admin     |\n+-----------+-----------+\n\nIf I list the flavors, with command nova flavor-list, the new flavor is not displayed:\n\n$ nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | extra_specs |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| 1  | m1.tiny   | 512       | 0    | 0         |      | 1     | 1.0         | True      | {}          |\n| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      | {}          |\n| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      | {}          |\n| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      | {}          |\n| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      | {}          |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n\nEven in the case I list with this other command, the new flavor is not shown:\n\n$ nova flavor-access-list --flavor=10\nERROR: Failed to get access list for public flavor type.\n\n$ nova flavor-access-list --tenant admin\nERROR: Sorry, query by tenant not supported.\n\nPlease note that I get the same results if I don't associate the private flavor to any project.\n\nAccording to the specification I found here https://blueprints.launchpad.net/nova/+spec/project-specific-flavors, It seems to me that private flavor types are not working.", 
            "date_created": "2012-11-27 14:09:33.274588+00:00", 
            "author": "https://api.launchpad.net/1.0/~marco-consonni"
        }, 
        {
            "content": "More information and, very likely, a different bug.\n\nI launched an instance using the private flavor and it worked.\nFine!\nSo, what I reported when I opened the bug seems to be related to display.\n\nBut, if I change the current project (aka tenant), I can still use the flavor that's supposed to be private.\n\nIn fact I changed the current user and the current tenant, the latter is NOT associated to the private flavor.\n\nThen I launched an instance indicating the private flavor I created.\n\n$ nova boot testFlavor10Marco1 --image f413b150-48d3-4c50-a265-9711805cce17 --flavor 10\n\n+------------------------+--------------------------------------+\n| Property               | Value                                |\n+------------------------+--------------------------------------+\n| OS-DCF:diskConfig      | MANUAL                               |\n| OS-EXT-STS:power_state | 0                                    |\n| OS-EXT-STS:task_state  | scheduling                           |\n| OS-EXT-STS:vm_state    | building                             |\n| accessIPv4             |                                      |\n| accessIPv6             |                                      |\n| adminPass              | qdsRTn27B7Wb                         |\n| config_drive           |                                      |\n| created                | 2012-11-27T15:18:57Z                 |\n| flavor                 | myFlavor                             |\n| hostId                 |                                      |\n| id                     | 8d1ad41a-f3fc-4b39-9a8a-274f3d1f6692 |\n| image                  | cirros-0.3.0-x86_64-disk             |\n| key_name               | None                                 |\n| metadata               | {}                                   |\n| name                   | testFlavor10Marco1                   |\n| progress               | 0                                    |\n| security_groups        | [{u'name': u'default'}]              |\n| status                 | BUILD                                |\n| tenant_id              | 2648f9f2fa894e2c82d2f29aa1b0fc37     |\n| updated                | 2012-11-27T15:19:00Z                 |\n| user_id                | 3af9666f4e504c65b6b2c3257e8c752d     |\n+------------------------+--------------------------------------+\n\n\nThe operation succeed but it shouldn't because the tenant I'm using is NOT associated to the private flavor.", 
            "date_created": "2012-11-27 14:25:59.908523+00:00", 
            "author": "https://api.launchpad.net/1.0/~marco-consonni"
        }, 
        {
            "content": "Another strange behavior.\n\nI submitted the following command indicating the private flavor I created:\n\n$ nova flavor-show 10\n+----------------------------+----------+\n| Property                   | Value    |\n+----------------------------+----------+\n| OS-FLV-DISABLED:disabled   | False    |\n| OS-FLV-EXT-DATA:ephemeral  | 0        |\n| disk                       | 30       |\n| extra_specs                | {}       |\n| id                         | 10       |\n| name                       | myFlavor |\n| os-flavor-access:is_public | True     |\n| ram                        | 700      |\n| rxtx_factor                | 1.0      |\n| swap                       |          |\n| vcpus                      | 3        |\n+----------------------------+----------+\n\nIt's interesting to notice that os-flavor-access:is_public is set to TRUE but, if submit the 'plain' command nova flavor-list, flavor 10 is not displayed (it is not public, as expected).  This is also confirmed by looking in mysql DB where I find that flag is_public is set to 0.\n\nGiven that, what's the meaning of os-flavor-access:is_public ?\n\n\n\n\n\n", 
            "date_created": "2012-11-27 14:45:22.579374+00:00", 
            "author": "https://api.launchpad.net/1.0/~marco-consonni"
        }, 
        {
            "content": "I was albe to replicate this. I was able to create an instance from a NON public flavor I have NO access to.", 
            "date_created": "2012-12-12 17:54:52.195760+00:00", 
            "author": "https://api.launchpad.net/1.0/~sulochan-acharya"
        }, 
        {
            "content": "I'm able to reproduce this.\nThere is anyone working on it?", 
            "date_created": "2013-02-07 14:51:02.849471+00:00", 
            "author": "https://api.launchpad.net/1.0/~moreira-belmiro-email-lists"
        }, 
        {
            "content": "Hi, I am very honored to share ideas. i want to prevent other tenants accessing my  private flavor, such as  these commands nova \n\nflavor-list ,nova  flavor-show  .  We all know that only administrator can run these commands,such as  create flavor and\n\nnova flavor-access-add.\n\ncodes:      (flavors.py)\ndef show(self, req, id):                                                                                                                                     \n    \"\"\"Return data about the given flavor id.\"\"\"                            \n    try:                                                                    \n    flavor = instance_types.get_instance_type_by_flavor_id(id)          \n    context = req.environ['nova.context']                               \n    if not context.is_admin:                                            \n        flavors = self._get_flavors(req)                                \n        flavor_is_not = False                                           \n        for k in flavors:                                               \n            if k.get('flavorid', None) != flavor.get('flavorid', None)\\ \n                               and flavor.get('is_public', None) == False:      \n                flavor_is_not = True                                    \n        if flavor_is_not:                                               \n            raise webob.exc.HTTPNotFound()                              \n    req.cache_db_flavor(flavor)                                         \n    except exception.NotFound:                                              \n        raise webob.exc.HTTPNotFound()                                      \n                                                                                 \n    return self._view_builder.show(req, flavor)    \n\n\n", 
            "date_created": "2013-05-24 03:06:56.106371+00:00", 
            "author": "https://api.launchpad.net/1.0/~82433422-a"
        }, 
        {
            "content": "It seems that multiple problems are raised here:\n\n1) $ nova flavor-access-add <flavor_id> <tenant_name>\nadds a rule which is never used.\nIn fact a correct way to add access to a flavor is to use tenant_id instead of tenant_name.\nNova should reject such requests. Novaclient should convert tenant_name to tenant_id as it is done for objects of another types.\nBut since OS could work with no Keystone, it seems not possible to verify a tenant id, or get a tenant id by a tenant name.\n\n2) An admin role user can run an instance with a flavor which isn't available for the instance tenant.\nBut the same happens to an image. If the image is private and isn't visible in a tenant, an admin can boot an instnace in the tenant from this image. I guess the same happens for volumes and snapshots as well.\nSo this looks like a feature and shouldn't be fixed separately from images/volumes/snapshots/etc.\n\n3) A filter by is_public property isn't available for novaclient cli.\nThe filter was promised by the blueprint.\n\n4) A filter by a tenant isn't available for neither REST nor cli.\nThe filter was promised by the blueprint.\n\n5) Under some circumstances a private flavor become public.\nIt's not reproduced for me.\n\nSomething else?", 
            "date_created": "2015-04-13 20:47:38.483211+00:00", 
            "author": "https://api.launchpad.net/1.0/~ftersin"
        }, 
        {
            "content": "The last check was done 1 year ago and this report describes multiple issues at once. There is not enough time to double-check each bug report. I'm closing this one. If you want to work on that, consider opening new bug reports, each one with one single and very specific issue. Otherwise it's not possible to solve them completely.", 
            "date_created": "2016-05-17 12:25:23.685089+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Hello, @Feodor Tersin (ftersin) \n\nHave you (or your co-worker) distributed the bugs mentioned in #6?\nIf yes, could you post the link here?\n", 
            "date_created": "2017-05-09 08:34:28.738198+00:00", 
            "author": "https://api.launchpad.net/1.0/~watanabe.isao"
        }, 
        {
            "content": "I just found that another bug [1] has mentioned this bug.\nAnd [1]'s duplicated bug [2] has been fixed 3 days ago(2017/5/6)...\n\nNote that, there is a BP [3].\n\n[1]https://bugs.launchpad.net/nova/+bug/1317515\n[2]https://bugs.launchpad.net/nova/+bug/1544989\n[3]https://blueprints.launchpad.net/nova/+spec/validate-project-with-keystone\n", 
            "date_created": "2017-05-09 08:46:49.528679+00:00", 
            "author": "https://api.launchpad.net/1.0/~watanabe.isao"
        }, 
        {
            "content": "Hi. No, i have not. I just posted that comment, nothing more.", 
            "date_created": "2017-05-10 07:37:24.620459+00:00", 
            "author": "https://api.launchpad.net/1.0/~ftersin"
        }
    ], 
    "closed": "2016-05-17 12:25:29.965619+00:00"
}