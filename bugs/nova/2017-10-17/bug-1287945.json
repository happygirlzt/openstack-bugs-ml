{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:13:53.628753+00:00", 
    "description": "I am getting with the latest version of the trunk:\n\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/poll.py\", line 97, in wait\n\u00a0\u00a0\u00a0\u00a0readers.get(fileno, noop).cb(fileno)\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n\u00a0\u00a0\u00a0\u00a0result = function(*args, **kwargs)\n\u00a0\u00a0File \"/opt/stack/nova/nova/openstack/common/service.py\", line 480, in run_service\n\u00a0\u00a0\u00a0\u00a0service.start()\n\u00a0\u00a0File \"/opt/stack/nova/nova/service.py\", line 180, in start\n\u00a0\u00a0\u00a0\u00a0self.manager.init_host()\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 824, in init_host\n\u00a0\u00a0\u00a0\u00a0self._init_instance(context, instance)\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/manager.py\", line 684, in _init_instance\n\u00a0\u00a0\u00a0\u00a0if instance.task_state == task_states.DELETING:\nAttributeError: 'dict' object has no attribute 'task_state'\nRemoving descriptor: 6\n2014-03-04 13:59:14.304 ERROR nova.openstack.common.threadgroup [-] 'dict' object has no attribute 'task_state'\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 117, in wait\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 49, in wait\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/service.py\", line 480, in run_service\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     service.start()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 180, in start\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 824, in init_host\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     self._init_instance(context, instance)\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 684, in _init_instance\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     if instance.task_state == task_states.DELETING:\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup AttributeError: 'dict' object has no attribute 'task_state'\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup\n\nI get this exception when creating a snapshot, put a breakpoint in the virt layer (in this case vmware_images/snapshot), stop nova-cpu, restart nova-cpu, delete the snapshot.\nnova-cpu crashes.", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1287945", 
    "owner": "https://api.launchpad.net/1.0/~arnaudleg", 
    "id": 1287945, 
    "index": 1412, 
    "openned": "2014-03-04 22:08:21.061864+00:00", 
    "created": "2014-03-04 22:08:21.061864+00:00", 
    "title": "Instance doesn't have a task state", 
    "comments": [
        {
            "content": "I am getting with the latest version of the trunk:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/poll.py\", line 97, in wait\n    readers.get(fileno, noop).cb(fileno)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/openstack/common/service.py\", line 480, in run_service\n    service.start()\n  File \"/opt/stack/nova/nova/service.py\", line 180, in start\n    self.manager.init_host()\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 824, in init_host\n    self._init_instance(context, instance)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 684, in _init_instance\n    if instance.task_state == task_states.DELETING:\nAttributeError: 'dict' object has no attribute 'task_state'\nRemoving descriptor: 6\n2014-03-04 13:59:14.304 ERROR nova.openstack.common.threadgroup [-] 'dict' object has no attribute 'task_state'\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 117, in wait\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 49, in wait\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/service.py\", line 480, in run_service\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     service.start()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 180, in start\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 824, in init_host\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     self._init_instance(context, instance)\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 684, in _init_instance\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup     if instance.task_state == task_states.DELETING:\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup AttributeError: 'dict' object has no attribute 'task_state'\n2014-03-04 13:59:14.304 TRACE nova.openstack.common.threadgroup", 
            "date_created": "2014-03-04 22:08:21.061864+00:00", 
            "author": "https://api.launchpad.net/1.0/~arnaudleg"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/78820", 
            "date_created": "2014-03-07 00:10:46.078986+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/78820\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=bb83f1a743150779e190705d2875a2319720c60c\nSubmitter: Jenkins\nBranch:    master\n\ncommit bb83f1a743150779e190705d2875a2319720c60c\nAuthor: Arnaud Legendre <email address hidden>\nDate:   Thu Mar 6 15:57:37 2014 -0800\n\n    Use instance object instead of _instance_update()\n    \n    Currently, if a user takes a snapshot of a VM, stops nova-cpu\n    before the snapshot operation is finished, and restart nova-cpu:\n    nova-cpu will crash with the error:\n    AttributeError: 'dict' object has no attribute 'task_state'\n    This happens because the _instance_update() method returns a dict\n    and not an Instance object.\n    \n    This patch fixes the issue by not using _instance_update()\n    in the compute manager which is returning a dict and using\n    the instance object instead.\n    \n    Change-Id: I3af0b09aeff7790b147a684f7c90af17d8ee7ae2\n    Closes-Bug: #1287945\n", 
            "date_created": "2014-03-11 02:09:30.066186+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-31 19:04:32.978904+00:00"
}