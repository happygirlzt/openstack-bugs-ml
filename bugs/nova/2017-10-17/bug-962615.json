{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:18:44.125035+00:00", 
    "description": "On a fresh devstack install, if I build a volume, snapshot that volume, then build a volume from that snapshot, I can no longer list all volumes:\n\nvagrant@devstack:~/devstack$ nova volume-create 1\nvagrant@devstack:~/devstack$ nova volume-snapshot-create 1\nvagrant@devstack:~/devstack$ nova volume-create --snapshot_id=1 1\nvagrant@devstack:~/devstack$ nova volume-list\nERROR: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400)\n\nTraceback from nova-api.log:\n(nova.api.openstack.wsgi): TRACE: Traceback (most recent call last):\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 851, in _process_stack\n(nova.api.openstack.wsgi): TRACE:     action_result = self.dispatch(meth, request, action_args)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 926, in dispatch\n(nova.api.openstack.wsgi): TRACE:     return method(req=request, **action_args)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/api/openstack/volume/volumes.py\", line 201, in detail\n(nova.api.openstack.wsgi): TRACE:     return self._items(req, entity_maker=_translate_volume_detail_view)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/api/openstack/volume/volumes.py\", line 207, in _items\n(nova.api.openstack.wsgi): TRACE:     volumes = self.volume_api.get_all(context)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/volume/api.py\", line 164, in get_all\n(nova.api.openstack.wsgi): TRACE:     context.project_id)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/db/api.py\", line 1015, in volume_get_all_by_project\n(nova.api.openstack.wsgi): TRACE:     return IMPL.volume_get_all_by_project(context, project_id)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n(nova.api.openstack.wsgi): TRACE:     return f(*args, **kwargs)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2517, in volume_get_all_by_project\n(nova.api.openstack.wsgi): TRACE:     return _volume_get_query(context).filter_by(project_id=project_id).all()\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1611, in all\n(nova.api.openstack.wsgi): TRACE:     return list(self)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1830, in instances\n(nova.api.openstack.wsgi): TRACE:     rows = [process[0](row, None) for row in fetch]\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2291, in _instance\n(nova.api.openstack.wsgi): TRACE:     populate_state(state, dict_, row, isnew, only_load_props)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2169, in populate_state\n(nova.api.openstack.wsgi): TRACE:     populator(state, dict_, row)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 130, in new_execute\n(nova.api.openstack.wsgi): TRACE:     dict_[key] = row[col]\n(nova.api.openstack.wsgi): TRACE: TypeError: expected string or Unicode object, long found", 
    "tags": [
        "in-stable-essex", 
        "verification-done"
    ], 
    "importance": "High", 
    "heat": 52, 
    "link": "https://bugs.launchpad.net/nova/+bug/962615", 
    "owner": "https://api.launchpad.net/1.0/~john-griffith", 
    "id": 962615, 
    "index": 642, 
    "openned": "2012-03-22 22:32:33.868451+00:00", 
    "created": "2012-03-22 22:32:33.868451+00:00", 
    "title": "[SRU] Unable to list volumes after building from snapshot", 
    "comments": [
        {
            "content": "On a fresh devstack install, if I build a volume, snapshot that volume, then build a volume from that snapshot, I can no longer list all volumes:\n\nvagrant@devstack:~/devstack$ nova volume-create 1\nvagrant@devstack:~/devstack$ nova volume-snapshot-create 1\nvagrant@devstack:~/devstack$ nova volume-create --snapshot_id=1 1\nvagrant@devstack:~/devstack$ nova volume-list\nERROR: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400)\n\nTraceback from nova-api.log:\n(nova.api.openstack.wsgi): TRACE: Traceback (most recent call last):\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 851, in _process_stack\n(nova.api.openstack.wsgi): TRACE:     action_result = self.dispatch(meth, request, action_args)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 926, in dispatch\n(nova.api.openstack.wsgi): TRACE:     return method(req=request, **action_args)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/api/openstack/volume/volumes.py\", line 201, in detail\n(nova.api.openstack.wsgi): TRACE:     return self._items(req, entity_maker=_translate_volume_detail_view)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/api/openstack/volume/volumes.py\", line 207, in _items\n(nova.api.openstack.wsgi): TRACE:     volumes = self.volume_api.get_all(context)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/volume/api.py\", line 164, in get_all\n(nova.api.openstack.wsgi): TRACE:     context.project_id)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/db/api.py\", line 1015, in volume_get_all_by_project\n(nova.api.openstack.wsgi): TRACE:     return IMPL.volume_get_all_by_project(context, project_id)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n(nova.api.openstack.wsgi): TRACE:     return f(*args, **kwargs)\n(nova.api.openstack.wsgi): TRACE:   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2517, in volume_get_all_by_project\n(nova.api.openstack.wsgi): TRACE:     return _volume_get_query(context).filter_by(project_id=project_id).all()\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1611, in all\n(nova.api.openstack.wsgi): TRACE:     return list(self)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1830, in instances\n(nova.api.openstack.wsgi): TRACE:     rows = [process[0](row, None) for row in fetch]\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2291, in _instance\n(nova.api.openstack.wsgi): TRACE:     populate_state(state, dict_, row, isnew, only_load_props)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2169, in populate_state\n(nova.api.openstack.wsgi): TRACE:     populator(state, dict_, row)\n(nova.api.openstack.wsgi): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 130, in new_execute\n(nova.api.openstack.wsgi): TRACE:     dict_[key] = row[col]\n(nova.api.openstack.wsgi): TRACE: TypeError: expected string or Unicode object, long found", 
            "date_created": "2012-03-22 22:32:33.868451+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "I took a look at this tonight and was not able to reproduce.  Initially I received some errors on the volume-create --snapshot command because the backing store by default was not large enough.\n\nAfter increasing the backing to 4GB I was able to run the sequence of commands successfully.  Not sure if this has been fixed indirectly or if it's specific to Precise?", 
            "date_created": "2012-04-03 03:33:31.203639+00:00", 
            "author": "https://api.launchpad.net/1.0/~john-griffith"
        }, 
        {
            "content": "I can't reproduce on Oneiric. This could have been a side-effect of the volumes api attribute changes that has since been fixed.", 
            "date_created": "2012-04-03 05:38:16.610698+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "Hi stackers,\n\nI have the same problem than Brian.\nI use the last milestone proposed.\n\nI create a volume and a snapshot from this volume.\nAnd if I try to create a new volume from the created snapshot, I cannot list volume anymore:\n\n2012-04-03 12:50:45 INFO nova.api.openstack.wsgi [req-656f9d29-7916-4f19-b231-a75d5644cef2 ab79adcd89b04c6498ea267154f9443f bc919cb0d95d4629aa740a9353f7f9c0] GET http://p-novamaster2.rd.francetelecom.fr:8776/v1/bc919cb0d95d4629aa740a9353f7f9c0/volumes/detail\n2012-04-03 12:50:45 DEBUG nova.api.openstack.wsgi [req-656f9d29-7916-4f19-b231-a75d5644cef2 ab79adcd89b04c6498ea267154f9443f bc919cb0d95d4629aa740a9353f7f9c0] Unrecognized Content-Type provided in request from (pid=9739) get_body /usr/local/src/nova/nova/api/openstack/wsgi.py:697\n2012-04-03 12:50:45 ERROR nova.api.openstack.wsgi [req-656f9d29-7916-4f19-b231-a75d5644cef2 ab79adcd89b04c6498ea267154f9443f bc919cb0d95d4629aa740a9353f7f9c0] Exception handling resource: expected string or Unicode object, long found\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi Traceback (most recent call last):\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/src/nova/nova/api/openstack/wsgi.py\", line 851, in _process_stack\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     action_result = self.dispatch(meth, request, action_args)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/src/nova/nova/api/openstack/wsgi.py\", line 926, in dispatch\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     return method(req=request, **action_args)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/src/nova/nova/api/openstack/volume/volumes.py\", line 201, in detail\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     return self._items(req, entity_maker=_translate_volume_detail_view)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/src/nova/nova/api/openstack/volume/volumes.py\", line 207, in _items\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     volumes = self.volume_api.get_all(context)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/src/nova/nova/volume/api.py\", line 167, in get_all\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     volumes = self.db.volume_get_all(context)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/src/nova/nova/db/api.py\", line 953, in volume_get_all\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     return IMPL.volume_get_all(context)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/src/nova/nova/db/sqlalchemy/api.py\", line 102, in wrapper\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     return f(*args, **kwargs)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/src/nova/nova/db/sqlalchemy/api.py\", line 2391, in volume_get_all\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     return _volume_get_query(context).all()\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2066, in all\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     return list(self)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2297, in instances\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     rows = [process[0](row, None) for row in fetch]\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2114, in _instance\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     populate_state(state, dict_, row, isnew, only_load_props)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 1968, in populate_state\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     populator(state, dict_, row)\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 150, in fetch_col\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi     dict_[key] = row[col]\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi TypeError: expected string or Unicode object, long found\n2012-04-03 12:50:45 TRACE nova.api.openstack.wsgi \n2012-04-03 12:50:45 INFO nova.api.openstack.wsgi [req-656f9d29-7916-4f19-b231-a75d5644cef2 ab79adcd89b04c6498ea267154f9443f bc919cb0d95d4629aa740a9353f7f9c0] http://p-novamaster2.rd.francetelecom.fr:8776/v1/bc919cb0d95d4629aa740a9353f7f9c0/volumes/detail returned with HTTP 400\n\nI check my disk and I've enough space to create the new volume. I check the database (nova.volume) and I saw a new empty entry (lot of null values).\nI made this test through the Nova APIs but I get the same result with Horizon.", 
            "date_created": "2012-04-03 12:54:32.603112+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "I just built a new devstack environment based on milestone-proposed, and I could not reproduce this. Edouard, can you make sure all of your components are up to date?", 
            "date_created": "2012-04-03 18:55:07.590258+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "Hi all,\n\nI would like to confirm the bug explained by \u00c9douard.\nMy OpenStack configuration is : Ubuntu Precise with the last packages available.\n\nThe issue happens after:\n1. I create a volume (via horizon)\n2. I snapshot the volume (via horizon)\n2bis. I can check that everything is right (via horizon or via nova client : \"nova volume-list\" and \"nova volume-snapshot-list\")\n3. I create a volume from this snapshot (via nova client : nova volume-create --snapshot_id 1 --display_name \"volume from snap\" --display_description \"kjh\" 1 )\n4. I am no more able to list the volumes. Via horizon or via nova client :\n#nova volume-list\nERROR: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400)\n\nI got a trace very similar to the one provided by \u00c9douard.\n\nRegards,\nJ\u00e9r\u00f4me", 
            "date_created": "2012-04-11 15:18:43.409142+00:00", 
            "author": "https://api.launchpad.net/1.0/~jerome-gallard"
        }, 
        {
            "content": "Temporary fix\n\nDetete rows from table \"volumes\" and corresponding rows from tables \"block_device_mapping\" and \"iscsi_targets\".", 
            "date_created": "2012-04-17 11:41:00.332057+00:00", 
            "author": "https://api.launchpad.net/1.0/~sajuptpm"
        }, 
        {
            "content": "We also have the same issue in our environment.  \n\nI get a 500 return code with the following Traceback:\n\n\n2012-04-18 17:50:10 ERROR nova.api.openstack [req-fb168c27-222a-4598-8dc7-2cc0e2c03648 162472 4801] Caught error: expected string or Unicode object, long found\n2012-04-18 17:50:10 TRACE nova.api.openstack Traceback (most recent call last):\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/api/openstack/__init__.py\", line 41, in __call__\n2012-04-18 17:50:10 TRACE nova.api.openstack     return req.get_response(self.application)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 919, in get_response\n2012-04-18 17:50:10 TRACE nova.api.openstack     application, catch_exc_info=False)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/webob/request.py\", line 887, in call_application\n2012-04-18 17:50:10 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n2012-04-18 17:50:10 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n2012-04-18 17:50:10 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n2012-04-18 17:50:10 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/routes/middleware.py\", line 131, in __call__\n2012-04-18 17:50:10 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 159, in __call__\n2012-04-18 17:50:10 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 147, in __call__\n2012-04-18 17:50:10 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/pymodules/python2.6/webob/dec.py\", line 208, in call_func\n2012-04-18 17:50:10 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/api/openstack/wsgi.py\", line 803, in __call__\n2012-04-18 17:50:10 TRACE nova.api.openstack     content_type, body, accept)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/api/openstack/wsgi.py\", line 851, in _process_stack\n2012-04-18 17:50:10 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/api/openstack/wsgi.py\", line 926, in dispatch\n2012-04-18 17:50:10 TRACE nova.api.openstack     return method(req=request, **action_args)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/api/openstack/volume/volumes.py\", line 201, in detail\n2012-04-18 17:50:10 TRACE nova.api.openstack     return self._items(req, entity_maker=_translate_volume_detail_view)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/api/openstack/volume/volumes.py\", line 207, in _items\n2012-04-18 17:50:10 TRACE nova.api.openstack     volumes = self.volume_api.get_all(context)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/volume/api.py\", line 171, in get_all\n2012-04-18 17:50:10 TRACE nova.api.openstack     context.project_id)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/db/api.py\", line 1016, in volume_get_all_by_project\n2012-04-18 17:50:10 TRACE nova.api.openstack     return IMPL.volume_get_all_by_project(context, project_id)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n2012-04-18 17:50:10 TRACE nova.api.openstack     return f(*args, **kwargs)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/nova/db/sqlalchemy/api.py\", line 2512, in volume_get_all_by_project\n2012-04-18 17:50:10 TRACE nova.api.openstack     return _volume_get_query(context).filter_by(project_id=project_id).all()\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1453, in all\n2012-04-18 17:50:10 TRACE nova.api.openstack     return list(self)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/query.py\", line 1676, in instances\n2012-04-18 17:50:10 TRACE nova.api.openstack     rows = [process[0](row, None) for row in fetch]\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/mapper.py\", line 2234, in _instance\n2012-04-18 17:50:10 TRACE nova.api.openstack     populate_state(state, dict_, row, isnew, only_load_props)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/mapper.py\", line 2113, in populate_state\n2012-04-18 17:50:10 TRACE nova.api.openstack     populator(state, dict_, row)\n2012-04-18 17:50:10 TRACE nova.api.openstack   File \"/usr/lib/python2.6/dist-packages/sqlalchemy/orm/strategies.py\", line 127, in new_execute\n2012-04-18 17:50:10 TRACE nova.api.openstack     dict_[key] = row[col]\n2012-04-18 17:50:10 TRACE nova.api.openstack TypeError: expected string or Unicode object, long found\n\nmanually setting the snapshot_id to NULL will allow you to list again.\n\nBrian Waldon:  For context this is currently happening in our Dev environment (see me on IRC if you need more details)", 
            "date_created": "2012-04-18 22:24:32.796275+00:00", 
            "author": "https://api.launchpad.net/1.0/~cthier"
        }, 
        {
            "content": "Hi,\n\nI am trying to reproduce this on nova Essex version and unable to reproduce. This is working fine for me. Please find the trace below:\n\nroot@vmessex118:~# nova volume-create 1\nroot@vmessex118:~# nova volume-list\n+----+-----------+--------------+------+--------------------------------------+\n| ID |   Status  | Display Name | Size |             Attached to              |\n+----+-----------+--------------+------+--------------------------------------+\n| 16 | available | None         | 1    | None                                 |\n+----+-----------+--------------+------+--------------------------------------+\nroot@vmessex118:~# nova volume-snapshot-create 16\nroot@vmessex118:~# nova volume-snapshot-list\n+----+-----------+-----------+--------------+------+\n| ID | Volume ID |   Status  | Display Name | Size |\n+----+-----------+-----------+--------------+------+\n| 1  | 9         | available | None         | 1    |\n| 2  | 16        | available | None         | 1    |\n+----+-----------+-----------+--------------+------+\nroot@vmessex118:~# nova volume-create --snapshot_id=2 1\nroot@vmessex118:~# nova volume-list\n+----+-----------+--------------+------+--------------------------------------+\n| ID |   Status  | Display Name | Size |             Attached to              |\n+----+-----------+--------------+------+--------------------------------------+\n| 16 | available | None         | 1    | None                                 |\n| 17 | creating  | None         | 1    | None                                 |\n+----+-----------+--------------+------+--------------------------------------+\nroot@vmessex118:~# nova volume-list\n+----+-----------+--------------+------+--------------------------------------+\n| ID |   Status  | Display Name | Size |             Attached to              |\n+----+-----------+--------------+------+--------------------------------------+\n| 16 | available | None         | 1    | None                                 |\n| 17 | available | None         | 1    | None                                 |\n+----+-----------+--------------+------+--------------------------------------+\n\nPlease let me know if I need to reproduce in other way.\n\nThanks,\nSateesh B.", 
            "date_created": "2012-04-24 11:06:09.398395+00:00", 
            "author": "https://api.launchpad.net/1.0/~sateesh-bodla"
        }, 
        {
            "content": "Just as a side note, I wonder if this is due possibly to a missing upgrade?  (I haven't had a chance to track it down) but it would seem to match up with it working in fresh installs, and not in some others'.\n\n--\nChuck", 
            "date_created": "2012-04-25 21:24:18.838621+00:00", 
            "author": "https://api.launchpad.net/1.0/~cthier"
        }, 
        {
            "content": "Ewww... that could be ugly.  Did Brian every find anything?  TBH I\nhaven't looked at this any more since he said he was on it and he\nseemed to have found evidence that it was specific to the RAX\nenvironment.\n\n\n\nOn Wed, Apr 25, 2012 at 3:24 PM, Chuck Thier <email address hidden> wrote:\n> Just as a side note, I wonder if this is due possibly to a missing\n> upgrade? \u00a0(I haven't had a chance to track it down) but it would seem to\n> match up with it working in fresh installs, and not in some others'.\n>\n> --\n> Chuck\n>\n> --\n> You received this bug notification because you are subscribed to the bug\n> report.\n> https://bugs.launchpad.net/bugs/962615\n>\n> Title:\n> \u00a0Unable to list volumes after building from snapshot\n>\n> Status in OpenStack Compute (Nova):\n> \u00a0Confirmed\n>\n> Bug description:\n> \u00a0On a fresh devstack install, if I build a volume, snapshot that\n> \u00a0volume, then build a volume from that snapshot, I can no longer list\n> \u00a0all volumes:\n>\n> \u00a0vagrant@devstack:~/devstack$ nova volume-create 1\n> \u00a0vagrant@devstack:~/devstack$ nova volume-snapshot-create 1\n> \u00a0vagrant@devstack:~/devstack$ nova volume-create --snapshot_id=1 1\n> \u00a0vagrant@devstack:~/devstack$ nova volume-list\n> \u00a0ERROR: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400)\n>\n> \u00a0Traceback from nova-api.log:\n> \u00a0(nova.api.openstack.wsgi): TRACE: Traceback (most recent call last):\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 851, in _process_stack\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 action_result = self.dispatch(meth, request, action_args)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 926, in dispatch\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 return method(req=request, **action_args)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/opt/stack/nova/nova/api/openstack/volume/volumes.py\", line 201, in detail\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 return self._items(req, entity_maker=_translate_volume_detail_view)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/opt/stack/nova/nova/api/openstack/volume/volumes.py\", line 207, in _items\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 volumes = self.volume_api.get_all(context)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/opt/stack/nova/nova/volume/api.py\", line 164, in get_all\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 context.project_id)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/opt/stack/nova/nova/db/api.py\", line 1015, in volume_get_all_by_project\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 return IMPL.volume_get_all_by_project(context, project_id)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 129, in wrapper\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 return f(*args, **kwargs)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2517, in volume_get_all_by_project\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 return _volume_get_query(context).filter_by(project_id=project_id).all()\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1611, in all\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 return list(self)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 1830, in instances\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 rows = [process[0](row, None) for row in fetch]\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2291, in _instance\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 populate_state(state, dict_, row, isnew, only_load_props)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 2169, in populate_state\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 populator(state, dict_, row)\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 130, in new_execute\n> \u00a0(nova.api.openstack.wsgi): TRACE: \u00a0 \u00a0 dict_[key] = row[col]\n> \u00a0(nova.api.openstack.wsgi): TRACE: TypeError: expected string or Unicode object, long found\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/962615/+subscriptions\n", 
            "date_created": "2012-04-25 21:33:37+00:00", 
            "author": "https://api.launchpad.net/1.0/~john-griffith"
        }, 
        {
            "content": "I think I may have tracked down the issue.  The migration code adds snapshot_id to volumes as an integer\n\nmigrate_repo/versions/020_add_snapshot_id_to_volumes.py\n29:    snapshot_id = Column('snapshot_id', Integer())\n\nbut it is listed as a volume in models.py\n\nmodels.py\n347:    snapshot_id = Column(String(255))\n\nI think the following change should fix the issue:\n\ndiff --git a/nova/db/sqlalchemy/models.py b/nova/db/sqlalchemy/models.py\nindex 634f04d..01eae5c 100644\n--- a/nova/db/sqlalchemy/models.py\n+++ b/nova/db/sqlalchemy/models.py\n@@ -344,7 +344,7 @@ class Volume(BASE, NovaBase):\n     user_id = Column(String(255))\n     project_id = Column(String(255))\n \n-    snapshot_id = Column(String(255))\n+    snapshot_id = Column(Integer)\n \n     host = Column(String(255))  # , ForeignKey('hosts.id'))\n     size = Column(Integer)\n\n\nWould someone give that a shot and see if it resolves the problem?  If so I can propose it.\n\n\n", 
            "date_created": "2012-04-25 22:10:31+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Vish, your patch works for me.\n\nI just replaced line \"snapshot_id = Column(String(255))\" in \"/usr/share/pyshared/nova/db/sqlalchemy/models.py\" with \"snapshot_id = Column(Integer)\" and then restarted nova-api service and I can see the volumes in Dashboard and well as CLI.\n\nThanks for the quick fix.", 
            "date_created": "2012-05-02 02:57:42.721635+00:00", 
            "author": "https://api.launchpad.net/1.0/~gmi"
        }, 
        {
            "content": "And by the way, I'm running Ubuntu 12.04 with official packages installed:\n\nroot@controller:~# dpkg -l | egrep \"nova|volume\"\nii  nova-api                         2012.1-0ubuntu2            OpenStack Compute - API frontend\nii  nova-common                      2012.1-0ubuntu2            OpenStack Compute - common files\nii  nova-consoleauth                 2012.1-0ubuntu2            OpenStack Compute - Console Authenticator\nii  nova-doc                         2012.1-0ubuntu2            OpenStack Compute - documentation\nii  nova-objectstore                 2012.1-0ubuntu2            OpenStack Compute - object store\nii  nova-scheduler                   2012.1-0ubuntu2            OpenStack Compute - virtual machine scheduler\nrc  nova-vncproxy                    2012.1-0ubuntu2            OpenStack Compute - VNC proxy\nii  python-nova                      2012.1-0ubuntu2            OpenStack Compute Python libraries\nii  python-novaclient                2012.1-0ubuntu1            client library for OpenStack Compute API\n\n", 
            "date_created": "2012-05-02 03:10:18.381730+00:00", 
            "author": "https://api.launchpad.net/1.0/~gmi"
        }, 
        {
            "content": "Fix proposed to branch: stable/essex\nReview: https://review.openstack.org/7509", 
            "date_created": "2012-05-16 17:11:15.701560+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/7509\nCommitted: http://github.com/openstack/nova/commit/2d7d51c5ea2a885ee6160d11c8a9afdbb86d1c43\nSubmitter: Jenkins\nBranch:    stable/essex\n\ncommit 2d7d51c5ea2a885ee6160d11c8a9afdbb86d1c43\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Wed May 16 10:04:26 2012 -0700\n\n    Fix type of snapshot_id column to match db\n    \n     * Migrations create a snaphsot_id column that is an integer, but\n       models incorrectly list it as a string.\n     * The above issue causes errors in certain situations when trying\n       to list instances. It seems to be only certain db configurations\n       or versions of sqlalchemy that exhibit the issue.\n     * Issue was fixed in trunk as part of a conversion to uuids in\n       commit 407e16b863bac1dfbf4e954837009abf9c17f018 so a straight\n       backport is not possible\n     * Fixes bug 962615\n    \n    Change-Id: I8e9fc9712c141822890feffee838faf8b41ee4f5\n", 
            "date_created": "2012-05-18 00:46:15.868683+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hi,\n\nI tried to replaced the line in \"/usr/share/pyshared/nova/db/sqlalchemy/models.py\" with \"snapshot_id = Column(Integer)\" when I could not list volumes. \nAfter replacing the line, I restarted nova-api then I could list volumes with \"volume-list\" command. \nBut the Status of volumes are always \"creating\" if the volumes have been created with the snapshots. \nDo I miss something ?\n\nI use Ubuntu 12.04 with the package installed:\n\nroot@Controller: dpkg -l |egrep \"nova|volume\"\nii  nova-ajax-console-proxy          2012.1-0ubuntu2.1                        OpenStack Compute - AJAX console proxy - transitional package\nii  nova-api                         2012.1-0ubuntu2.1                        OpenStack Compute - API frontend\nii  nova-cert                        2012.1-0ubuntu2.1                        OpenStack Compute - certificate management\nii  nova-common                      2012.1-0ubuntu2.1                        OpenStack Compute - common files\nii  nova-compute                     2012.1-0ubuntu2.1                        OpenStack Compute - compute node\nii  nova-compute-kvm                 2012.1-0ubuntu2.1                        OpenStack Compute - compute node (KVM)\nii  nova-consoleauth                 2012.1-0ubuntu2.1                        OpenStack Compute - Console Authenticator\nii  nova-doc                         2012.1-0ubuntu2.1                        OpenStack Compute - documentation\nii  nova-network                     2012.1-0ubuntu2.1                        OpenStack Compute - Network manager\nii  nova-scheduler                   2012.1-0ubuntu2.1                        OpenStack Compute - virtual machine scheduler\nii  nova-vncproxy                    2012.1-0ubuntu2.1                        OpenStack Compute - VNC proxy\nii  nova-volume                      2012.1-0ubuntu2.1                        OpenStack Compute - storage\nii  python-nova                      2012.1-0ubuntu2.1                        OpenStack Compute Python libraries\nii  python-novaclient                2012.1-0ubuntu1                          client library for OpenStack Compute API\n", 
            "date_created": "2012-06-06 10:10:17.260557+00:00", 
            "author": "https://api.launchpad.net/1.0/~cutekimimaru"
        }, 
        {
            "content": "No you don't miss anything. The big problem of OpenStack is this - when some bug/issue happen the DB stuff (not only) is in inconsistent state, unfortunately OpenStack don't try to fix the inconsistent state.\n\nSo you created the volume, but in process of creating task you reach the bug. So volume was not created and the database include record about creating.... :(. Now you have to know the procedure which openstack does and \"revert it manually\" (update DB records, handle iSCSI tasks,....)", 
            "date_created": "2012-06-06 10:41:24.814192+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaroslav-pulchart-4"
        }, 
        {
            "content": "** Impact **\n\n* Migrations create a snaphsot_id column that is an integer, but\nmodels incorrectly list it as a string.\n* The above issue causes errors in certain situations when trying\nto list instances. It seems to be only certain db configurations\nor versions of sqlalchemy that exhibit the issue.\n* Issue was fixed in trunk as part of a conversion to uuids in\ncommit 407e16b863bac1dfbf4e954837009abf9c17f018 so a straight\nbackport is not possible\n\n** Developmen Fix **\n\nFixed in development runk at commit 407e16b863bac1dfbf4e954837009abf9c17f018 and fixed in quantal.\n\n** Stable Fix **\n\nThis has been addressed in the stable/essex branch https://review.openstack.org/7509\n1. I create a volume (via horizon)\n2. I snapshot the volume (via horizon)\n2bis. I can check that everything is right (via horizon or via nova client : \"nova volume-list\" and \"nova volume-snapshot-list\")\n3. I create a volume from this snapshot (via nova client : nova volume-create --snapshot_id 1 --display_name \"volume from snap\" --display_description \"kjh\" 1 )\n4. I am no more able to list the volumes. Via horizon or via nova client :\n#nova volume-list\nERROR: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400)\n** Test Case **\n\n** Regression Potential **\n\nMinimal.", 
            "date_created": "2012-06-07 14:54:19.280795+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "Hello Brian, or anyone else affected,\n\nAccepted nova into precise-proposed. The package will build now and be available in a few hours. Please help us by testing this new package.  See https://wiki.ubuntu.com/Testing/EnableProposed for documentation how to enable and use -proposed. Your feedback will aid us getting this update out to other Ubuntu users.  If this package fixes the bug for you please change the bug tag from verification-needed to verification-done.  If it does not, change the tag to verification-failed.  In either case details of your testing will help us make a better decision.  Further information regarding the verification process can be found at https://wiki.ubuntu.com/QATeam/PerformingSRUVerification . Thank you in advance!", 
            "date_created": "2012-06-25 20:02:06.835969+00:00", 
            "author": "https://api.launchpad.net/1.0/~vorlon"
        }, 
        {
            "content": "Please find the attached Jenkins job results from the Ubuntu Server Team's CI\ninfrastructure.  As part of the verification process for this bug, Nova has\nbeen deployed and configured across multiple nodes using precise-proposed as\nan installation source.  After successful bring-up and configuration of the\ncluster, a number of exercises and smoke tests have be invoked to ensure the\nupdated package did not introduce any regressions. A number of test iterations\nwere carried out to catch any possible transient errors.\n\nNote the list of installed packages at the top and bottom of the report.\n\nFor records of upstream test coverage of this update, please see the\nJenkins links in the comments of the relevant upstream code-review:\n\nhttps://review.openstack.org/7509\n\nAs per the provisional Micro Release Exception granted to this package by\nthe Technical Board, we hope this contributes toward verification of this\nupdate.\n", 
            "date_created": "2012-06-29 00:51:41.126761+00:00", 
            "author": "https://api.launchpad.net/1.0/~gandelman-a"
        }, 
        {
            "content": "This bug was fixed in the package nova - 2012.1+stable~20120612-3ee026e-0ubuntu1\n\n---------------\nnova (2012.1+stable~20120612-3ee026e-0ubuntu1) precise-proposed; urgency=low\n\n  * New upstream snapshot. (LP: #1010473)\n  * Dropped, superseeded by new snapshot:\n    - debian/patches/upstream/0001-fix-bug-where-nova-ignores-glance-host-in-imageref.patch\n    - debian/patches/upstream/0002-Stop-libvirt-test-from-deleting-instances-dir.patch\n    - debian/patches/upstream/0003-Allow-unprivileged-RADOS-users-to-access-rbd-volumes.patch\n    - debian/patches/upstream/0004-Fixed-bug-962840-added-a-test-case.patch\n    - debian/patches/upstream/0005-Populate-image-properties-with-project_id-again.patch\n    - debian/patches/upstream/0006-Use-project_id-in-ec2.cloud._format_image.patc\n    - debian/patches/CVE-2012-2101.patch\n    - debian/patches/CVE-2012-2654.patch\n  * Resynchronize with stable/essex:\n    - 3ee026e Only invoke .lower() on non-None protocols. (LP: #1010514)\n    - f0a9f47 Create a utf8 version of the dns_domains table. (LP: #993663)\n    - 84a43e1 Report memory correctly on Xen. (LP: #997014)\n    - 8c72924 Add libvirt get_console_output tests: pty and file. (LP: #990237)\n    - 4e423cd Fix Multi_Scheduler to process host capabilities. (LP: #1000403)\n    - 4aea7f1 Nail pep8 dependencies to 1.0.1\n    - 2b3bbc4 handle updated qemu-img info output. (LP: #1000261)\n    - 2d7d51c Fix type of snapshot_id column to match db. (LP: #962615)\n    - ec70c69 Generate a Changelog for Nova\n    - e5e890f Fix nova.tests.test_nova_rootwrap on Fedora 17. (LP: #992916)\n    - 9e9a554 Ec2 handle strings with \"0x\" (LP: #983206)\n    - 26dc6b7 QuantumManager will start dnsmasq during startup. Fixes (LP: #977759)\n    - 7028d66 Introduced flag base_dir_name. (LP: #973194)\n    - 76b525a Get unit tests functional in OS X.\n    - facb936 Update KillFilter to handle 'deleted' exe's. (LP: #967931)\n    - 1209af4 Checks if value is string or not before decode. (LP: #952176)\n    - 1209af4 Fix timeout in EC2 CloudController.create_image(). (LP: #989764)\n    - 108e74b Re-add console_log from console_console_output(). (LP: #987335)\n    - 48a0768 Don't leak RPC connections on timeouts or other exceptions. (LP: #968843)\n    - 7c64de9 Cloudpipe tap vpn not always working. (LP: #975043)\n    - 5ab5051 add libvirt_inject_key flag fix (LP: #971640)\n    - 6c68ef5 Xen: Pass session to destroy_vdi. (LP: #988615)\n    - 015744e Delete fixed_ips when network is deleted. (LP: #754900)\n  * Add debian/scripts/changelog.sh to help generate the changelog.\n  * Add debian/nova-common.docs:\n    - Include changelog and README.rst\n  * debian/rules: Generate a tarball from git snapshot.\n  * debian/patches/fix-pep8-errors.patch: Fix pep8 errors due to pep8 upstream\n    migration.\n -- Chuck Short <email address hidden>   Tue, 05 Jun 2012 09:50:59 -0400", 
            "date_created": "2012-07-03 01:00:20.059959+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2012-05-23 12:57:48.516321+00:00"
}