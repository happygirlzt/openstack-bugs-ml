{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:55:31.362534+00:00", 
    "description": "nova-compute fails to create the instance:\n\n2012-02-28 05:02:17 ERROR nova.compute.manager [-] [instance: 8e0dc25b-45da-4249-989f-c7906a663add] Instance\nfailed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 593, i\nn _spawn\n(nova.compute.manager): TRACE:     self._legacy_nw_info(network_info), block_device_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 112, in wrap\nped\n(nova.compute.manager): TRACE:     return f(*args, **kw)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", lin\ne 876, in spawn\n(nova.compute.manager): TRACE:     self.firewall_driver.prepare_instance_filter(instance, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/vir\nt/firewall.py\", line 136, in prepare_instance_filter\n(nova.compute.manager): TRACE:     self.add_filters_for_instance(instance)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 178, in add_filters_for_instance\n(nova.compute.manager): TRACE:     ipv4_rules, ipv6_rules = self.instance_rules(instance, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 334, in instance_rules\n(nova.compute.manager): TRACE:     ips.extend(net[1]['ips'])\n(nova.compute.manager): TRACE: KeyError: 1\n(nova.compute.manager): TRACE:\n\nRelevant code in virt/firewall.py:\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for net in nw_info:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ips.extend(net[1]['ips'])\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LOG.info('ips: %r', ips)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for ip in ips:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0subrule = args + ['-s %s' % ip['ip']]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fw_rules += [' '.join(subrule)]\n\nThis fails cause net is of type nova.network.model.VIF, while ips is an empty list. I assume it's wrong, but this is what got me beyond this error:\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for net in nw_info.fixed_ips():\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ips.append(net['address'])\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LOG.info('ips: %r', ips)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for ip in ips:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0subrule = args + ['-s %s' % ip]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fw_rules += [' '.join(subrule)]", 
    "tags": [
        "canonistack"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/942593", 
    "owner": "https://api.launchpad.net/1.0/~ivoks", 
    "id": 942593, 
    "index": 2777, 
    "openned": "2012-02-28 12:58:38.082233+00:00", 
    "created": "2012-02-28 12:58:38.082233+00:00", 
    "title": "KeyError with nova-compute", 
    "comments": [
        {
            "content": "nova-compute fails to create the image:\n\n2012-02-28 05:02:17 ERROR nova.compute.manager [-] [instance: 8e0dc25b-45da-4249-989f-c7906a663add] Instance \nfailed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 593, i\nn _spawn\n(nova.compute.manager): TRACE:     self._legacy_nw_info(network_info), block_device_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 112, in wrap\nped\n(nova.compute.manager): TRACE:     return f(*args, **kw)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", lin\ne 876, in spawn\n(nova.compute.manager): TRACE:     self.firewall_driver.prepare_instance_filter(instance, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/vir\nt/firewall.py\", line 136, in prepare_instance_filter\n(nova.compute.manager): TRACE:     self.add_filters_for_instance(instance)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 178, in add_filters_for_instance\n(nova.compute.manager): TRACE:     ipv4_rules, ipv6_rules = self.instance_rules(instance, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/virt/firewall.py\", line 334, in instance_rules\n(nova.compute.manager): TRACE:     ips.extend(net[1]['ips'])\n(nova.compute.manager): TRACE: KeyError: 1\n(nova.compute.manager): TRACE:\n\nRelevant code in virt/firewall.py:\n\n                            for net in nw_info:\n                                ips.extend(net[1]['ips'])\n\n                            LOG.info('ips: %r', ips)\n                            for ip in ips:\n                                subrule = args + ['-s %s' % ip['ip']]\n                                fw_rules += [' '.join(subrule)]\n\nThis fails cause net is of type nova.network.model.VIF, while ips is an empty string. I assume it's wrong, but this is what got me beyond this error:\n\n                            for net in nw_info.fixed_ips():\n                                ips.append(net['address'])\n\n                            LOG.info('ips: %r', ips)\n                            for ip in ips:\n                                subrule = args + ['-s %s' % ip]\n                                fw_rules += [' '.join(subrule)]", 
            "date_created": "2012-02-28 12:58:38.082233+00:00", 
            "author": "https://api.launchpad.net/1.0/~ivoks"
        }, 
        {
            "content": "at this level, network_info should have been converted back to legacy... Something is passing it down to virt without first converting it. see nova/compute/utils.py", 
            "date_created": "2012-02-28 20:53:15.219886+00:00", 
            "author": "https://api.launchpad.net/1.0/~tr3buchet"
        }, 
        {
            "content": "actually no, your patch is correct. I suggest merge prop.", 
            "date_created": "2012-02-28 20:59:59.841385+00:00", 
            "author": "https://api.launchpad.net/1.0/~tr3buchet"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/4743", 
            "date_created": "2012-03-01 08:39:52.973248+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/4743\nCommitted: http://github.com/openstack/nova/commit/c919ba6602d3e99b23f133b68ec3a484aca3c78d\nSubmitter: Jenkins\nBranch:    master\n\ncommit c919ba6602d3e99b23f133b68ec3a484aca3c78d\nAuthor: Ante Karamati\u0107 <email address hidden>\nDate:   Thu Mar 1 09:38:37 2012 +0100\n\n    Since 'net' is of nova.network.model.VIF class and 'ips' is an empty\n    list, net needs to be pulled from hydrated nw_info.fixed_ips(), and\n    appended to ips.\n    \n    bug 942593\n    \n    Change-Id: I9c2f55e300d1dad503b15c261027d988073e8e61\n", 
            "date_created": "2012-03-10 00:50:59.159015+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-03-20 08:43:32.537928+00:00"
}