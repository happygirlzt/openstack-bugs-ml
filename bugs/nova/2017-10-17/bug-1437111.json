{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:29:30.082490+00:00", 
    "description": "when do a live migration which the instance is in a state like this\ntaget@liyong:~/devstack$ nova list\n+--------------------------------------+-------+--------+------------+-------------+----------------------+\n| ID                                   | Name  | Status | Task State | Power State | Networks             |\n+--------------------------------------+-------+--------+------------+-------------+----------------------+\n| 1d114104-9a62-49ba-b209-6a42beff4133 | test1 | ACTIVE | -          | NOSTATE     | private_net=10.0.0.9 |\n+--------------------------------------+-------+--------+------------+-------------+----------------------+\n\nrest api raise conflictRequest, this is correct, but the message is not correct.\n\n(0, '{\"conflictingRequest\": {\"message\": \"Instance 1d114104-9a62-49ba-b209-6a42beff4133 is in an invalid state for \\'os-migrateLive\\'\", \"code\": 409}}', '  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\\n                                 Dload  Upload   Total   Spent    Left  Speed\\n\\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\\r100    92    0     0  100    92      0     76  0:00:01  0:00:01 --:--:--    76\\r100   233  100   141  100    92     78     51  0:00:01  0:00:01 --:--:--    78\\r100   233  100   141  100    92     78     51  0:00:01  0:00:01 --:--:--    78\\n')\n\n\nin live_migrate.py, we check if instance in active state, it do the right thing.\n\n    def _check_instance_is_active(self):\n        if self.instance.power_state not in (power_state.RUNNING,\n                                             power_state.PAUSED):\n            raise exception.InstanceInvalidState(\n                    instance_uuid = self.instance.uuid,\n                    attr = 'power_state',\n                    state = self.instance.power_state,\n                    method = 'live migrate')\n\nbut in this case,  power_state is an Integer zero, \nthe logic in raise_http_conflict_for_instance_invalid_state\n\nby checking code of raise_http_conflict_for_instance_invalid_state\n\ndef raise_http_conflict_for_instance_invalid_state(exc, action, server_id):\n    \"\"\"Raises a webob.exc.HTTPConflict instance containing a message\n    appropriate to return via the API based on the original\n    InstanceInvalidState exception.\n    \"\"\"\n    attr = exc.kwargs.get('attr')\n    state = exc.kwargs.get('state')\n    not_launched = exc.kwargs.get('not_launched')\n    if attr and state: <<<<<<<<<<<<<------------ should go this condition but state is zero.\n        msg = _(\"Cannot '%(action)s' instance %(server_id)s while it is in \"\n                \"%(attr)s %(state)s\") % {'action': action, 'attr': attr,\n                                         'state': state,\n                                         'server_id': server_id}", 
    "tags": [
        "api"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1437111", 
    "owner": "https://api.launchpad.net/1.0/~taget-9", 
    "id": 1437111, 
    "index": 1649, 
    "openned": "2015-03-27 02:04:23.058032+00:00", 
    "created": "2015-03-27 02:04:23.058032+00:00", 
    "title": "os-migrateLive fault but rest api raise a incorrect conflict message", 
    "comments": [
        {
            "content": "when do a live migration which the instance is in a state like this\ntaget@liyong:~/devstack$ nova list\n+--------------------------------------+-------+--------+------------+-------------+----------------------+\n| ID                                   | Name  | Status | Task State | Power State | Networks             |\n+--------------------------------------+-------+--------+------------+-------------+----------------------+\n| 1d114104-9a62-49ba-b209-6a42beff4133 | test1 | ACTIVE | -          | NOSTATE     | private_net=10.0.0.9 |\n+--------------------------------------+-------+--------+------------+-------------+----------------------+\n\nrest api raise conflictRequest, this is correct, but the message is not correct.\n\n(0, '{\"conflictingRequest\": {\"message\": \"Instance 1d114104-9a62-49ba-b209-6a42beff4133 is in an invalid state for \\'os-migrateLive\\'\", \"code\": 409}}', '  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\\n                                 Dload  Upload   Total   Spent    Left  Speed\\n\\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\\r100    92    0     0  100    92      0     76  0:00:01  0:00:01 --:--:--    76\\r100   233  100   141  100    92     78     51  0:00:01  0:00:01 --:--:--    78\\r100   233  100   141  100    92     78     51  0:00:01  0:00:01 --:--:--    78\\n')\n\n\nin live_migrate.py, we check if instance in active state, it do the right thing.\n\n    def _check_instance_is_active(self):\n        if self.instance.power_state not in (power_state.RUNNING,\n                                             power_state.PAUSED):\n            raise exception.InstanceInvalidState(\n                    instance_uuid = self.instance.uuid,\n                    attr = 'power_state',\n                    state = self.instance.power_state,\n                    method = 'live migrate')\n\nbut in this case,  power_state is an Integer zero, \nthe logic in raise_http_conflict_for_instance_invalid_state\n\nby checking code of raise_http_conflict_for_instance_invalid_state\n\ndef raise_http_conflict_for_instance_invalid_state(exc, action, server_id):\n    \"\"\"Raises a webob.exc.HTTPConflict instance containing a message\n    appropriate to return via the API based on the original\n    InstanceInvalidState exception.\n    \"\"\"\n    attr = exc.kwargs.get('attr')\n    state = exc.kwargs.get('state')\n    not_launched = exc.kwargs.get('not_launched')\n    if attr and state: <<<<<<<<<<<<<------------ should go this condition but state is zero.\n        msg = _(\"Cannot '%(action)s' instance %(server_id)s while it is in \"\n                \"%(attr)s %(state)s\") % {'action': action, 'attr': attr,\n                                         'state': state,\n                                         'server_id': server_id}", 
            "date_created": "2015-03-27 02:04:23.058032+00:00", 
            "author": "https://api.launchpad.net/1.0/~taget-9"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/168211", 
            "date_created": "2015-03-27 03:07:58.888667+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/168211\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=70f3c8d3d33a12ee002753f7867c6c12d2b0fc84\nSubmitter: Jenkins\nBranch:    master\n\ncommit 70f3c8d3d33a12ee002753f7867c6c12d2b0fc84\nAuthor: Eli Qiao <email address hidden>\nDate:   Fri Mar 27 10:15:38 2015 +0800\n\n    Fix incorrect http_conflict error message\n    \n    instance power state may be integer zero, in that case the error message would\n    be no correct.\n    \n    BTW, this patch remove 'not_launched' from kwargs since no other code set this\n    parameter into kwargs.\n    \n    Closes-bug: 1437111\n    Change-Id: Id2fb561a79d627eb8c6b41e4fe3549dc69dc7d99\n", 
            "date_created": "2015-03-31 19:11:48.302437+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-04-10 09:23:24.690994+00:00"
}