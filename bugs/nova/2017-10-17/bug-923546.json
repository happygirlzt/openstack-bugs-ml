{
    "status": "Fix Released", 
    "last_updated": "2013-01-02 21:14:52.313524+00:00", 
    "description": "When I run euca-create-image, I get an error. Here's the log when I run euca-create-image i-00000001 -n created-image:\n\n----------------------------\n2012-01-30 09:30:09,586 DEBUG nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] action: CreateImage from (pid=17424) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:30:09,586 DEBUG nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] arg: Name           val: created-image from (pid=17424) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:30:09,586 DEBUG nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] arg: InstanceId             val: i-00000001 from (pid=17424) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:30:09,624 ERROR nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Unexpected error raised: wrapped() takes at least 3 arguments (2 given)\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 460, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/apirequest.py\", line 90, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/cloud.py\", line 1536, in create_image\n(nova.api): TRACE:     self.compute_api.stop(context, instance_id=instance_id)\n(nova.api): TRACE: TypeError: wrapped() takes at least 3 arguments (2 given)\n(nova.api): TRACE:\n2012-01-30 09:30:09,625 ERROR nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Environment: {\"HTTP_AUTHORIZATION\": \"Basic None\", \"SCRIPT_NAME\": \"/services/Cloud\", \"REQUEST_METHOD\": \"POST\", \"PATH_INFO\": \"/\", \"SERVER_PROTOCOL\": \"HTTP/1.0\", \"HTTP_X_IDENTITY_STATUS\": \"Confirmed\", \"HTTP_USER_AGENT\": \"Boto/2.0 (linux2)\", \"SERVER_NAME\": \"192.168.1.138\", \"REMOTE_ADDR\": \"192.168.1.138\", \"wsgi.url_scheme\": \"http\", \"SERVER_PORT\": \"8773\", \"CONTENT_TYPE\": \"application/x-www-form-urlencoded; charset=UTF-8\", \"HTTP_HOST\": \"192.168.1.138:8773\", \"GATEWAY_INTERFACE\": \"CGI/1.1\", \"HTTP_ACCEPT_ENCODING\": \"identity\"}\n2012-01-30 09:30:09,625 ERROR nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] UnknownError: An unknown error has occurred. Please try your request again.\n2012-01-30 09:30:09,626 INFO nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] 0.146677s 192.168.1.138 POST /services/Cloud/ CloudController:CreateImage 400 [Boto/2.0 (linux2)] application/x-www-form-urlencoded text/xml\n---------------------------", 
    "tags": [
        "ec2"
    ], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/923546", 
    "owner": "None", 
    "id": 923546, 
    "index": 2738, 
    "openned": "2012-01-30 00:36:21.848012+00:00", 
    "created": "2012-01-30 00:36:21.848012+00:00", 
    "title": "euca-create-image doesn't work", 
    "comments": [
        {
            "content": "When I run euca-create-image, I get an error. Here's the log when I run euca-create-image i-00000001 -n created-image:\n\n----------------------------\n2012-01-30 09:30:09,586 DEBUG nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] action: CreateImage from (pid=17424) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:30:09,586 DEBUG nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] arg: Name           val: created-image from (pid=17424) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:30:09,586 DEBUG nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] arg: InstanceId             val: i-00000001 from (pid=17424) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:30:09,624 ERROR nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Unexpected error raised: wrapped() takes at least 3 arguments (2 given)\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 460, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/apirequest.py\", line 90, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/cloud.py\", line 1536, in create_image\n(nova.api): TRACE:     self.compute_api.stop(context, instance_id=instance_id)\n(nova.api): TRACE: TypeError: wrapped() takes at least 3 arguments (2 given)\n(nova.api): TRACE:\n2012-01-30 09:30:09,625 ERROR nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Environment: {\"HTTP_AUTHORIZATION\": \"Basic None\", \"SCRIPT_NAME\": \"/services/Cloud\", \"REQUEST_METHOD\": \"POST\", \"PATH_INFO\": \"/\", \"SERVER_PROTOCOL\": \"HTTP/1.0\", \"HTTP_X_IDENTITY_STATUS\": \"Confirmed\", \"HTTP_USER_AGENT\": \"Boto/2.0 (linux2)\", \"SERVER_NAME\": \"192.168.1.138\", \"REMOTE_ADDR\": \"192.168.1.138\", \"wsgi.url_scheme\": \"http\", \"SERVER_PORT\": \"8773\", \"CONTENT_TYPE\": \"application/x-www-form-urlencoded; charset=UTF-8\", \"HTTP_HOST\": \"192.168.1.138:8773\", \"GATEWAY_INTERFACE\": \"CGI/1.1\", \"HTTP_ACCEPT_ENCODING\": \"identity\"}\n2012-01-30 09:30:09,625 ERROR nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] UnknownError: An unknown error has occurred. Please try your request again.\n2012-01-30 09:30:09,626 INFO nova.api [req-9a280f7c-cd2f-4aa9-8c70-595dccbe3b40 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] 0.146677s 192.168.1.138 POST /services/Cloud/ CloudController:CreateImage 400 [Boto/2.0 (linux2)] application/x-www-form-urlencoded text/xml\n---------------------------", 
            "date_created": "2012-01-30 00:36:21.848012+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomoe"
        }, 
        {
            "content": "I tried the following patch to fix the obvious bugs, but it still doesn't work. \nSeems like this feature is not working, or am I missing something?\n\nThe patch:\n-------------------------------\n\nmidokura@midokura-iMac:/opt/stack/nova$ git diff\ndiff --git a/nova/api/ec2/cloud.py b/nova/api/ec2/cloud.py\nindex 5a3b952..7a18595 100644\n--- a/nova/api/ec2/cloud.py\n+++ b/nova/api/ec2/cloud.py\n@@ -1533,7 +1533,7 @@ class CloudController(object):\n \n             if vm_state in (vm_states.ACTIVE, vm_states.SHUTOFF):\n                 restart_instance = True\n-                self.compute_api.stop(context, instance_id=instance_id)\n+                self.compute_api.stop(context, instance)\n \n             # wait instance for really stopped\n             start_time = time.time()\n@@ -1549,7 +1549,15 @@ class CloudController(object):\n                     raise exception.ApiError(\n                         _('Couldn\\'t stop instance with in %d sec') % timeout)\n \n-        src_image = self._get_image(context, instance['image_ref'])\n+        image_uuid = instance['image_ref']\n+        image_id = self._get_image_id(context, image_uuid)\n+        ec2_image_id = ec2utils.image_ec2_id(image_id)\n+\n+        print ' image_ref ----------> ', instance['image_ref']\n+        print ' ec2_image_id -------> ', ec2_image_id\n+\n+        src_image = self._get_image(context, ec2_image_id)\n+        print'  src_image ', src_image\n         properties = src_image['properties']\n         if instance['root_device_name']:\n             properties['root_device_name'] = instance['root_device_name']\n---------------------\n\n\nAnother Error:\n---------------------\n2012-01-30 09:53:55,982 DEBUG keystone.middleware.auth_token [-] Sending request to next app in WSGI pipeline from (pid=23018) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:53:55,983 DEBUG nova.api [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] action: CreateImage from (pid=23018) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:53:55,983 DEBUG nova.api [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] arg: Name           val: created-image from (pid=23018) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:53:55,983 DEBUG nova.api [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] arg: InstanceId             val: i-00000001 from (pid=23018) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:53:56,020 DEBUG nova.compute.api [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Going to try to stop 5e32efbc-77ad-4108-a237-e5cf9f5a0ae7 from (pid=23018) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:53:56,101 DEBUG nova.rpc [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Making asynchronous cast on compute.midokura-iMac... from (pid=23018) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:53:56,101 DEBUG nova.rpc [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Pool creating new connection from (pid=23018) debug /opt/stack/nova/nova/log.py:175\n2012-01-30 09:53:56,107 INFO nova.rpc [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Connected to AMQP server on localhost:5672\n image_ref ---------->  871e53a5-be19-4084-acad-4f53dc47fae0\n ec2_image_id ------->  ami-00000003\n  src_image  {'status': 'active', 'name': 'cirros-0.3.0-x86_64-blank', 'deleted': False, 'container_format': 'ami', 'created_at': datetime.datetime(2012, 1, 30, 0, 24, 15), 'disk_format': 'ami', 'updated_at': datetime.datetime(2012, 1, 30, 0, 24, 15), 'properties': {'kernel_id': 2L, 'ramdisk_id': 1L}, 'min_ram': '0', 'checksum': '2f81976cae15c16ef0010c51e3a6c163', 'min_disk': '0', 'is_public': True, 'deleted_at': None, 'id': 3L, 'size': 25165824}\n2012-01-30 09:53:59,323 ERROR nova.api [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Unexpected error raised: 'image_location'\n(nova.api): TRACE: Traceback (most recent call last):\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/__init__.py\", line 460, in __call__\n(nova.api): TRACE:     result = api_request.invoke(context)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/apirequest.py\", line 90, in invoke\n(nova.api): TRACE:     result = method(context, **args)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/cloud.py\", line 1617, in create_image\n(nova.api): TRACE:     image_id = self._register_image(context, src_image)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/api/ec2/cloud.py\", line 1422, in _register_image\n(nova.api): TRACE:     image = self.image_service.create(context, metadata)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/image/s3.py\", line 105, in create\n(nova.api): TRACE:     image = self._s3_create(context, metadata)\n(nova.api): TRACE:   File \"/opt/stack/nova/nova/image/s3.py\", line 256, in _s3_create\n(nova.api): TRACE:     image_location = metadata['properties']['image_location']\n(nova.api): TRACE: KeyError: 'image_location'\n(nova.api): TRACE:\n2012-01-30 09:53:59,324 ERROR nova.api [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] Environment: {\"HTTP_AUTHORIZATION\": \"Basic None\", \"SCRIPT_NAME\": \"/services/Cloud\", \"REQUEST_METHOD\": \"POST\", \"PATH_INFO\": \"/\", \"SERVER_PROTOCOL\": \"HTTP/1.0\", \"HTTP_X_IDENTITY_STATUS\": \"Confirmed\", \"HTTP_USER_AGENT\": \"Boto/2.0 (linux2)\", \"SERVER_NAME\": \"192.168.1.138\", \"REMOTE_ADDR\": \"192.168.1.138\", \"wsgi.url_scheme\": \"http\", \"SERVER_PORT\": \"8773\", \"CONTENT_TYPE\": \"application/x-www-form-urlencoded; charset=UTF-8\", \"HTTP_HOST\": \"192.168.1.138:8773\", \"GATEWAY_INTERFACE\": \"CGI/1.1\", \"HTTP_ACCEPT_ENCODING\": \"identity\"}\n2012-01-30 09:53:59,324 ERROR nova.api [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] UnknownError: An unknown error has occurred. Please try your request again.\n2012-01-30 09:53:59,325 INFO nova.api [req-ad27ede4-b92b-4ca4-8c6e-5349fee5cd0f 5e653de2fb5d4b508012406df77ec445 03c6ffa2bee74bca9bec99e82d872673] 3.448191s 192.168.1.138 POST /services/Cloud/ CloudController:CreateImage 400 [Boto/2.0 (linux2)] application/x-www-form-urlencoded text/xml\n------------------------------------------------------------------------\n\nI'd be happy to help debugging the issue.\n", 
            "date_created": "2012-01-30 01:03:41.617594+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomoe"
        }, 
        {
            "content": "Has anyone looked into this yet?", 
            "date_created": "2012-02-06 05:48:50.029783+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomoe"
        }, 
        {
            "content": "Is this on diablo or essex?", 
            "date_created": "2012-02-26 13:51:22.576206+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "This is on Essex. Not sure about Diablo.", 
            "date_created": "2012-02-26 14:11:18.520627+00:00", 
            "author": "https://api.launchpad.net/1.0/~tomoe"
        }, 
        {
            "content": "Im not able to reproduce this anymore, please re-open if you can on folsom or grizzly.", 
            "date_created": "2013-01-02 21:14:48.046674+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }
    ], 
    "closed": "2013-01-02 21:14:50.175398+00:00"
}