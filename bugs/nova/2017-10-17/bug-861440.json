{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 09:36:48.614324+00:00", 
    "description": "Using venv, I'm seeing test_create_multiple_servers fail on master\n\nThe test was introduced by:\n\n  commit 0fab78825ef06310926181f6f97d377058b56b97\n  Author: Chris Behrens <email address hidden>\n  Date:   Sat Sep 24 23:49:36 2011 +0000\n\n    compute_api create*() and schedulers refactoring\n\nThe error is:\n\n2011-09-28 14:03:24,538 INFO nova.rpc [-] Connected to AMQP server on localhost:5672\n2011-09-28 14:03:24,544 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/exception.py\", line 98, in wrapped\n(nova.rpc): TRACE:     return f(*args, **kw)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 119, in decorated_function\n(nova.rpc): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 512, in terminate_instance\n(nova.rpc): TRACE:     self._delete_instance(context, instance_id)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 493, in _delete_instance\n(nova.rpc): TRACE:     self._shutdown_instance(context, instance_id, 'Terminating')\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 474, in _shutdown_instance\n(nova.rpc): TRACE:     network_info = self._get_instance_nw_info(context, instance)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 241, in _get_instance_nw_info\n(nova.rpc): TRACE:     instance)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/network/api.py\", line 210, in get_instance_nw_info\n(nova.rpc): TRACE:     'args': args})\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/__init__.py\", line 45, in call\n(nova.rpc): TRACE:     return get_impl().call(context, topic, msg)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 738, in call\n(nova.rpc): TRACE:     rv = list(rv)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 705, in __iter__\n(nova.rpc): TRACE:     self.done()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 685, in done\n(nova.rpc): TRACE:     self._connection.close()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 570, in close\n(nova.rpc): TRACE:     self._done()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 547, in _done\n(nova.rpc): TRACE:     self.connection.reset()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 382, in reset\n(nova.rpc): TRACE:     self.channel.close()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/.nova-venv/lib/python2.7/site-packages/kombu/transport/virtual/__init__.py\", line 560, in close\n(nova.rpc): TRACE:     self._qos.restore_unacked_once()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/.nova-venv/lib/python2.7/site-packages/kombu/transport/virtual/__init__.py\", line 165, in restore_unacked_once\n(nova.rpc): TRACE:     assert not state\n(nova.rpc): TRACE: AssertionError", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/861440", 
    "owner": "https://api.launchpad.net/1.0/~blamar", 
    "id": 861440, 
    "index": 3562, 
    "openned": "2011-09-28 14:08:13.509452+00:00", 
    "created": "2011-09-28 14:08:13.509452+00:00", 
    "title": "test_create_multiple_servers fails on master with venv", 
    "comments": [
        {
            "content": "Using venv, I'm seeing test_create_multiple_servers fail on master\n\nThe test was introduced by:\n\n  commit 0fab78825ef06310926181f6f97d377058b56b97\n  Author: Chris Behrens <email address hidden>\n  Date:   Sat Sep 24 23:49:36 2011 +0000\n\n    compute_api create*() and schedulers refactoring\n\nThe error is:\n\n2011-09-28 14:03:24,538 INFO nova.rpc [-] Connected to AMQP server on localhost:5672\n2011-09-28 14:03:24,544 ERROR nova.rpc [-] Exception during message handling\n(nova.rpc): TRACE: Traceback (most recent call last):\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 620, in _process_data\n(nova.rpc): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/exception.py\", line 98, in wrapped\n(nova.rpc): TRACE:     return f(*args, **kw)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 119, in decorated_function\n(nova.rpc): TRACE:     function(self, context, instance_id, *args, **kwargs)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 512, in terminate_instance\n(nova.rpc): TRACE:     self._delete_instance(context, instance_id)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 493, in _delete_instance\n(nova.rpc): TRACE:     self._shutdown_instance(context, instance_id, 'Terminating')\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 474, in _shutdown_instance\n(nova.rpc): TRACE:     network_info = self._get_instance_nw_info(context, instance)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/compute/manager.py\", line 241, in _get_instance_nw_info\n(nova.rpc): TRACE:     instance)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/network/api.py\", line 210, in get_instance_nw_info\n(nova.rpc): TRACE:     'args': args})\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/__init__.py\", line 45, in call\n(nova.rpc): TRACE:     return get_impl().call(context, topic, msg)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 738, in call\n(nova.rpc): TRACE:     rv = list(rv)\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 705, in __iter__\n(nova.rpc): TRACE:     self.done()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 685, in done\n(nova.rpc): TRACE:     self._connection.close()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 570, in close\n(nova.rpc): TRACE:     self._done()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 547, in _done\n(nova.rpc): TRACE:     self.connection.reset()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/nova/rpc/impl_kombu.py\", line 382, in reset\n(nova.rpc): TRACE:     self.channel.close()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/.nova-venv/lib/python2.7/site-packages/kombu/transport/virtual/__init__.py\", line 560, in close\n(nova.rpc): TRACE:     self._qos.restore_unacked_once()\n(nova.rpc): TRACE:   File \"/home/markmc/projects/openstack/git/nova/.nova-venv/lib/python2.7/site-packages/kombu/transport/virtual/__init__.py\", line 165, in restore_unacked_once\n(nova.rpc): TRACE:     assert not state\n(nova.rpc): TRACE: AssertionError", 
            "date_created": "2011-09-28 14:08:13.509452+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "It's a bug in kombu memory transport used for tests.  Need to downgrade to version 1.0.4, which is the same version that's in our ppa until we can get a fix into newer kombu...   or..  we stop using kombu's memory transport for tests in favor of a fakerabbit port.\n\nNote that other tests will randomly fail with the same thing...  some snapshot tests.", 
            "date_created": "2011-09-28 16:15:05.375033+00:00", 
            "author": "https://api.launchpad.net/1.0/~cbehrens"
        }, 
        {
            "content": "@Lorin, you've marked this Fix Committed for a nova task, can you comment where this is?  I couldn't find the commit.\n\nThanks.", 
            "date_created": "2011-10-18 13:12:02.714198+00:00", 
            "author": "https://api.launchpad.net/1.0/~davewalker"
        }, 
        {
            "content": "This bug was fixed in the package kombu - 1.2.1-1ubuntu1\n\n---------------\nkombu (1.2.1-1ubuntu1) precise; urgency=low\n\n  * debian/patches/remove_assert_virtual_transport_restore_unacked_once.\n    patch: Disabled seemingly invalid assert in virtual transport which\n    was causing nova testsuite to fail.  Pending better solution.\n    - LP: #861440\n -- Dave Walker (Daviey) <email address hidden>   Tue, 18 Oct 2011 15:16:16 +0100", 
            "date_created": "2011-10-18 14:50:12.318124+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "@Dave:\n\nI think it's eb4bd86f.\n\n", 
            "date_created": "2011-10-18 16:18:17.655593+00:00", 
            "author": "https://api.launchpad.net/1.0/~lorinh"
        }, 
        {
            "content": "Here it is in Github: https://github.com/openstack/nova/commit/eb4bd86f\n\nAt the time, I didn't realize the Gerrit marks the bugs off as committed when they're linked, so I just manually set this one to fix committed when I found that it fixed the issue I was having.", 
            "date_created": "2011-10-18 16:19:53.406689+00:00", 
            "author": "https://api.launchpad.net/1.0/~lorinh"
        }
    ], 
    "closed": "2011-11-17 10:02:12.447778+00:00"
}