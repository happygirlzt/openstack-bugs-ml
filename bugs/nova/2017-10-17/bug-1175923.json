{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:43:15.984110+00:00", 
    "description": "I use Havana openstack, and after installing all the modules, i use :nova boot --image XXX --flavor 1 instance_name\" , BUT the instance come to ERROR state. I looked up the compute.log,\n\nERROR is :\n\n2013-05-03 00:20:55    ERROR [nova.openstack.common.rpc.amqp] Exception during scheduler.run_instance\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 433, in _process_data\n\u00a0\u00a0\u00a0\u00a0**args)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 148, in dispatch\n\u00a0\u00a0\u00a0\u00a0return getattr(proxyobj, method)(ctxt, **kwargs)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 117, in wrapped\n\u00a0\u00a0\u00a0\u00a0temp_level, payload)\n\u00a0\u00a0File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 94, in wrapped\n\u00a0\u00a0\u00a0\u00a0return f(self, context, *args, **kw)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 213, in decorated_function\n\u00a0\u00a0\u00a0\u00a0pass\n\u00a0\u00a0File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 199, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 264, in decorated_function\n\u00a0\u00a0\u00a0\u00a0function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 241, in decorated_function\n\u00a0\u00a0\u00a0\u00a0e, sys.exc_info())\n\u00a0\u00a0File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 228, in decorated_function\n\u00a0\u00a0\u00a0\u00a0return function(self, context, *args, **kwargs)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1319, in run_instance\n\u00a0\u00a0\u00a0\u00a0do_run_instance()\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 242, in inner\n\u00a0\u00a0\u00a0\u00a0retval = f(*args, **kwargs)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1318, in do_run_instance\n\u00a0\u00a0\u00a0\u00a0admin_password, is_first_time, node, instance)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 877, in _run_instance\n\u00a0\u00a0\u00a0\u00a0notify(\"error\", msg=unicode(e))  # notify that build failed\n\u00a0\u00a0File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.gen.next()\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 861, in _run_instance\n\u00a0\u00a0\u00a0\u00a0admin_password, is_first_time, node, instance, image_meta)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 920, in _build_instance\n\u00a0\u00a0\u00a0\u00a0with rt.instance_claim(context, instance, limits):\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 242, in inner\n\u00a0\u00a0\u00a0\u00a0retval = f(*args, **kwargs)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 103, in instance_claim\n\u00a0\u00a0\u00a0\u00a0if claim.test(self.compute_node, limits):\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/claims.py\", line 120, in test\n\u00a0\u00a0\u00a0\u00a0can_claim = (self._test_memory(resources, memory_mb_limit) and\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/claims.py\", line 138, in _test_memory\n\u00a0\u00a0\u00a0\u00a0return self._test(type_, unit, total, used, requested, limit)\n\u00a0\u00a0File \"/usr/lib/python2.6/site-packages/nova/compute/claims.py\", line 175, in _test\n\u00a0\u00a0\u00a0\u00a0\"%(unit)s\") % locals()\n\nWHEN I comment the line out , boot can be active.\n\n\u00a0   msg = _(\"%(type_)s limit: %(limit)d %(unit)s, free: %(free)d %(unit)s\") % locals()\n\nBY THE WAY, when I change it to \n\n    msg = _(\"%(type_)s limit: %(limit)f %(unit)s, free: %(free)f %(unit)s\") % locals()\n\nnova boot can success also,  \"limit\" may be a float instead of a integer.\n\nThank you", 
    "tags": [
        "compute", 
        "keyerror", 
        "nova"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1175923", 
    "owner": "https://api.launchpad.net/1.0/~mikal", 
    "id": 1175923, 
    "index": 3377, 
    "openned": "2013-05-03 07:41:54.756486+00:00", 
    "created": "2013-05-03 07:41:54.756486+00:00", 
    "title": "nova boot fail because KeyError : u'disk_gb_limit'", 
    "comments": [
        {
            "content": "I use Havana openstack, and after installing all the modules, i use :nova boot --image XXX --flavor 1 instance_name\" , BUT the instance come to ERROR state. I looked up the compute.log,\n\nERROR is :\n\n\n2013-05-03 00:20:55    ERROR [nova.openstack.common.rpc.amqp] Exception during scheduler.run_instance\nTraceback (most recent call last):\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 433, in _process_data\n    **args)\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 148, in dispatch\n    return getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 117, in wrapped\n    temp_level, payload)\n  File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 94, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 213, in decorated_function\n    pass\n  File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 199, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 264, in decorated_function\n    function(self, context, *args, **kwargs)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 241, in decorated_function\n    e, sys.exc_info())\n  File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 228, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1319, in run_instance\n    do_run_instance()\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 242, in inner\n    retval = f(*args, **kwargs)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1318, in do_run_instance\n    admin_password, is_first_time, node, instance)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 877, in _run_instance\n    notify(\"error\", msg=unicode(e))  # notify that build failed\n  File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n    self.gen.next()\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 861, in _run_instance\n    admin_password, is_first_time, node, instance, image_meta)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 920, in _build_instance\n    with rt.instance_claim(context, instance, limits):\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 242, in inner\n    retval = f(*args, **kwargs)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 103, in instance_claim\n    if claim.test(self.compute_node, limits):\n  File \"/usr/lib/python2.6/site-packages/nova/compute/claims.py\", line 120, in test\n    can_claim = (self._test_memory(resources, memory_mb_limit) and\n  File \"/usr/lib/python2.6/site-packages/nova/compute/claims.py\", line 138, in _test_memory\n    return self._test(type_, unit, total, used, requested, limit)\n  File \"/usr/lib/python2.6/site-packages/nova/compute/claims.py\", line 175, in _test\n    \"%(unit)s\") % locals()\n\nWHEN I comment the line out , boot can be active.\n\n msg = _(\"%(type_)s limit: %(limit)d %(unit)s, free: %(free)d %(unit)s\") % locals()\n\nBY THE WAY, when I change it to  msg = _(\"%(type_)s limit: %(limit)f %(unit)s, free: %(free)f %(unit)s\") % locals()\n\nnova boot can success also,  \"limit\" may be a float instead of a integer.\n\nThank you", 
            "date_created": "2013-05-03 07:41:54.756486+00:00", 
            "author": "https://api.launchpad.net/1.0/~kaitian521"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/28493", 
            "date_created": "2013-05-08 02:17:23.483662+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "FYI, this is a related bug: https://bugs.launchpad.net/nova/+bug/1176164", 
            "date_created": "2013-05-08 13:17:35.324165+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/28493\nCommitted: http://github.com/openstack/nova/commit/f53df8c4f50437eb7568979636c7503fcd43afee\nSubmitter: Jenkins\nBranch:    master\n\ncommit f53df8c4f50437eb7568979636c7503fcd43afee\nAuthor: Michael Still <email address hidden>\nDate:   Wed May 8 12:02:59 2013 +1000\n\n    Fix format error in claims.\n    \n    I have now seen two bug reports today about log message formatting\n    in the claims code. I'm not 100% sure what's going on here, but\n    I've removed the use of locals() in the hope it makes it clearer.\n    I've also moved to treating limits as floats because I think it\n    makes the messages clearer, but it is not a functional change.\n    \n    Resolves bug 1175923.\n    \n    Change-Id: I8b7b31f2637d1ab41d0fb2f274545181f9fddd9d\n", 
            "date_created": "2013-05-14 02:14:35.626715+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-05-29 10:26:41.811972+00:00"
}