{
    "status": "Won't Fix", 
    "last_updated": "2016-03-08 18:34:34.187385+00:00", 
    "description": "I am seeing a behavior, while deleting nova instance it returns status as an Error and fails to delete itself. \nSo scenario, where I see this behavior is as follow:\nCreate a nova VM instance.\nCreate a cinder volume\nAttach this volume to nova vm instance and after that wait for volume to go to \u2018In-use\u2019 state.\nMount the created partition to VM\nUnmount the created partition\nDetach the volume from VM instance and after that wait for volume to go to \u2018Available\u2019 state\nDelete the volume\nDelete the nova VM instance ==> It fails at this step, because status of server instance is set to Error.\n\nBased on logs I also see Rabbitmq error, which might explain the problem.\n3908 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit Traceback (most r     ecent call last):\n3909 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 648, in ensure\n3910 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     return method     (*args, **kwargs)\n3911 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 753, in _publish\n3912 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     publisher = c     ls(self.conf, self.channel, topic, **kwargs)\n3913 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 420, in __init__\n3914 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     super(NotifyP     ublisher, self).__init__(conf, channel, topic, **kwargs)\n3915 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 396, in __init__\n3916 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     **options)\n3917 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 339, in __init__\n3918 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.reconnec     t(channel)\n2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 423, in reconnect\n3920 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     super(NotifyP     ublisher, self).reconnect(channel)\n3921 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 347, in reconnect\n3922 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     routing_key=s     elf.routing_key)\n3923 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/kombu/messaging.py\", line 84, in __init__\n3924 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.revive(s     elf._channel)\n3925 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/kombu/messaging.py\", line 218, in revive\n3926 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.declare(     )\n3927 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/kombu/messaging.py\", line 104, in declare\n3928 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.exchange     .declare()\n3929 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/kombu/entity.py\", line 166, in declare\n3930 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     nowait=nowait     , passive=passive,\n3931 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/amqp/channel.py\", line 613, in exchange_declare\n3932 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self._send_me     thod((40, 10), args)\n3933 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/amqp/abstract_channel.py\", line 56, in _send_method\n3934 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.channel_     id, method_sig, args, content,\n3935 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/amqp/method_framing.py\", line 221, in write_method\n3936 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     write_frame(1     , channel, payload)\n3937 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/amqp/transport.py\", line 177, in write_frame\n3938 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     frame_type, c     hannel, size, payload, 0xce,\n3939 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/eventlet/greenio.py\", line 307, in sendall\n3940 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     tail = self.s     end(data, flags)\n3941 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/eventlet/greenio.py\", line 293, in send\n3942 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     total_sent +=      fd.send(data[total_sent:], flags)\n3943 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit error: [Errno 32]      Broken pipe\n3944 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit\n3945 <182>Sep 29 16:14:57 node-6 nova-api 2014-09-29 16:14:57.084 29278 INFO oslo.messaging._d     rivers.impl_rabbit [req-e1e3acf2-2e42-40bb-bcb9-839151099a96 ] Reconnecting to AMQP serve     r on 192.168.9.5:5672", 
    "tags": [
        "oslo"
    ], 
    "importance": "Undecided", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1375408", 
    "owner": "None", 
    "id": 1375408, 
    "index": 6453, 
    "openned": "2014-09-29 18:33:00.583616+00:00", 
    "created": "2014-09-29 18:33:00.583616+00:00", 
    "title": "nova instance delete issue", 
    "comments": [
        {
            "content": "I am seeing a behavior, while deleting nova instance it returns status as an Error and fails to delete itself. \nSo scenario, where I see this behavior is as follow:\nCreate a nova VM instance.\nCreate a cinder volume\nAttach this volume to nova vm instance and after that wait for volume to go to \u2018In-use\u2019 state.\nMount the created partition to VM\nUnmount the created partition\nDetach the volume from VM instance and after that wait for volume to go to \u2018Available\u2019 state\nDelete the volume\nDelete the nova VM instance ==> It fails at this step, because status of server instance is set to Error.\n\nBased on logs I also see Rabbitmq error, which might explain the problem.\n3908 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit Traceback (most r     ecent call last):\n3909 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 648, in ensure\n3910 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     return method     (*args, **kwargs)\n3911 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 753, in _publish\n3912 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     publisher = c     ls(self.conf, self.channel, topic, **kwargs)\n3913 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 420, in __init__\n3914 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     super(NotifyP     ublisher, self).__init__(conf, channel, topic, **kwargs)\n3915 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 396, in __init__\n3916 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     **options)\n3917 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 339, in __init__\n3918 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.reconnec     t(channel)\n2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 423, in reconnect\n3920 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     super(NotifyP     ublisher, self).reconnect(channel)\n3921 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 347, in reconnect\n3922 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     routing_key=s     elf.routing_key)\n3923 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/kombu/messaging.py\", line 84, in __init__\n3924 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.revive(s     elf._channel)\n3925 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/kombu/messaging.py\", line 218, in revive\n3926 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.declare(     )\n3927 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/kombu/messaging.py\", line 104, in declare\n3928 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.exchange     .declare()\n3929 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/kombu/entity.py\", line 166, in declare\n3930 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     nowait=nowait     , passive=passive,\n3931 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/amqp/channel.py\", line 613, in exchange_declare\n3932 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self._send_me     thod((40, 10), args)\n3933 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/amqp/abstract_channel.py\", line 56, in _send_method\n3934 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     self.channel_     id, method_sig, args, content,\n3935 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/amqp/method_framing.py\", line 221, in write_method\n3936 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     write_frame(1     , channel, payload)\n3937 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/amqp/transport.py\", line 177, in write_frame\n3938 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     frame_type, c     hannel, size, payload, 0xce,\n3939 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/eventlet/greenio.py\", line 307, in sendall\n3940 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     tail = self.s     end(data, flags)\n3941 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/     python2.7/dist-packages/eventlet/greenio.py\", line 293, in send\n3942 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit     total_sent +=      fd.send(data[total_sent:], flags)\n3943 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit error: [Errno 32]      Broken pipe\n3944 2014-09-29 16:14:57.080 29278 TRACE oslo.messaging._drivers.impl_rabbit\n3945 <182>Sep 29 16:14:57 node-6 nova-api 2014-09-29 16:14:57.084 29278 INFO oslo.messaging._d     rivers.impl_rabbit [req-e1e3acf2-2e42-40bb-bcb9-839151099a96 ] Reconnecting to AMQP serve     r on 192.168.9.5:5672", 
            "date_created": "2014-09-29 18:33:00.583616+00:00", 
            "author": "https://api.launchpad.net/1.0/~harsshah"
        }, 
        {
            "content": "", 
            "date_created": "2014-09-29 18:33:00.583616+00:00", 
            "author": "https://api.launchpad.net/1.0/~harsshah"
        }, 
        {
            "content": "", 
            "date_created": "2014-09-29 18:33:50.744530+00:00", 
            "author": "https://api.launchpad.net/1.0/~harsshah"
        }, 
        {
            "content": "It seems to be a duplicate of https://bugs.launchpad.net/mos/+bug/1371723", 
            "date_created": "2015-07-22 07:22:43.246772+00:00", 
            "author": "https://api.launchpad.net/1.0/~yichengli"
        }
    ], 
    "closed": "2016-03-08 18:34:25.021596+00:00"
}