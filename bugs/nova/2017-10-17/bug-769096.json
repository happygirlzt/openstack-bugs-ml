{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 09:33:12.333432+00:00", 
    "description": "Revision 989 (Cactus).  \n\nI have got an exception during the launch of an instance. I get the following stacktrace in nova-compute.log:\n\n2011-04-21 22:47:12,887 DEBUG nova [-] injecting network info to xs for vm: |OpaqueRef:31c1cdee-b215-470a-8a93-07599fb4ab28| from (pid=2349) _inject_network_info /usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py:859\n2011-04-21 22:47:13,606 WARNING nova.virt.xenapi [-] Task [Async.host.call_plugin] OpaqueRef:6897e357-a275-828b-fe22-74ffe95df056 status: failure    ['XENAPI_PLUGIN_FAILURE', 'non-zero exit', '', '']\n2011-04-21 22:47:13,612 ERROR nova.compute.manager [58X1QE5AKBX4UWIBNJRX dashboard dashboard] Instance '1' failed to spawn. Is virtualization enabled in the BIOS?\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 234, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi_conn.py\", line 188, in spawn\n(nova.compute.manager): TRACE:     self._vmops.spawn(instance)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 118, in spawn\n(nova.compute.manager): TRACE:     vm_ref = self._create_vm(instance, vdi_uuid, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 179, in _create_vm\n(nova.compute.manager): TRACE:     self.inject_network_info(instance, network_info, vm_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 850, in inject_network_info\n(nova.compute.manager): TRACE:     self._inject_network_info(instance, network_info, vm_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 875, in _inject_network_info\n(nova.compute.manager): TRACE:     vm_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 977, in _make_plugin_call\n(nova.compute.manager): TRACE:     err_msg = err_trace.splitlines()[-1]\n(nova.compute.manager): TRACE: IndexError: list index out of range\n(nova.compute.manager): TRACE:\n\nTwo points here:\n\n1) \"Instance '1' failed to spawn. Is virtualization enabled in the BIOS?\" as error message is misleading and does not really a clue of what's going on\n2) There's an unhandled exception within the catch block in vmops.py:977\n\nAs for /var/log/messages on the host, I get:\n\nApr 22 03:00:39 localhost fe: 20110422T03:00:39.664Z||5861|Args after replacement = [/etc/xapi.d/plugins/xenstore.py;<methodCall><methodName>write_record</methodName><params><param><value>OpaqueRef:8985f82c-2c1a-bf2f-d452-8d19b2589b3e</value></param><param><value><struct><member><name>path</name><value>vm-data/networking/02163e0e00b9</value></member><member><name>dom_id</name><value>-1</value></member><member><name>value</name><value>{&quot;label&quot;: &quot;public&quot;, &quot;broadcast&quot;: &quot;10.0.0.31&quot;, &quot;ips&quot;: [{&quot;ip&quot;: &quot;10.0.0.2&quot;, &quot;netmask&quot;: &quot;255.255.255.224&quot;, &quot;enabled&quot;: &quot;1&quot;}], &quot;mac&quot;: &quot;02:16:3e:0e:00:b9&quot;, &quot;dns&quot;: [&quot;192.168.1.1&quot;], &quot;gateway&quot;: &quot;10.0.0.1&quot;}</value></member></struct></value></param></params></methodCall>]\nApr 22 03:00:39 localhost fe: 20110422T03:00:39.664Z||5861|I've received the following fds: [2;1]\nApr 22 03:00:39 localhost fe: 20110422T03:00:39.666Z||5862|Caught unexpected exception: Unix.Unix_error(1, \"execve\", \"/etc/xapi.d/plugins/xenstore.py\")\nApr 22 03:00:39 localhost fe: 5862 (/etc/xapi.d/plugins/xenstore.py <methodCall><methodName>write_record</methodN...) exitted with code 1\n\nNo exception handling, that let us get a clue of what's going on.\n\nAny idea of what might have gone wrong?\nThanks,\nArmando", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/769096", 
    "owner": "https://api.launchpad.net/1.0/~johannes.erdfelt", 
    "id": 769096, 
    "index": 2400, 
    "openned": "2011-04-22 17:14:17.173143+00:00", 
    "created": "2011-04-22 17:14:17.173143+00:00", 
    "title": "xenstore.py inadequate exception handling", 
    "comments": [
        {
            "content": "Revision 989 (Cactus).  \n\nI have got an exception during the launch of an instance. I get the following stacktrace in nova-compute.log:\n\n2011-04-21 22:47:12,887 DEBUG nova [-] injecting network info to xs for vm: |OpaqueRef:31c1cdee-b215-470a-8a93-07599fb4ab28| from (pid=2349) _inject_network_info /usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py:859\n2011-04-21 22:47:13,606 WARNING nova.virt.xenapi [-] Task [Async.host.call_plugin] OpaqueRef:6897e357-a275-828b-fe22-74ffe95df056 status: failure    ['XENAPI_PLUGIN_FAILURE', 'non-zero exit', '', '']\n2011-04-21 22:47:13,612 ERROR nova.compute.manager [58X1QE5AKBX4UWIBNJRX dashboard dashboard] Instance '1' failed to spawn. Is virtualization enabled in the BIOS?\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 234, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi_conn.py\", line 188, in spawn\n(nova.compute.manager): TRACE:     self._vmops.spawn(instance)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 118, in spawn\n(nova.compute.manager): TRACE:     vm_ref = self._create_vm(instance, vdi_uuid, network_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 179, in _create_vm\n(nova.compute.manager): TRACE:     self.inject_network_info(instance, network_info, vm_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 850, in inject_network_info\n(nova.compute.manager): TRACE:     self._inject_network_info(instance, network_info, vm_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 875, in _inject_network_info\n(nova.compute.manager): TRACE:     vm_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/virt/xenapi/vmops.py\", line 977, in _make_plugin_call\n(nova.compute.manager): TRACE:     err_msg = err_trace.splitlines()[-1]\n(nova.compute.manager): TRACE: IndexError: list index out of range\n(nova.compute.manager): TRACE:\n\nTwo points here:\n\n1) \"Instance '1' failed to spawn. Is virtualization enabled in the BIOS?\" as error message is misleading and does not really a clue of what's going on\n2) There's an unhandled exception within the catch block in vmops.py:977\n\nAs for /var/log/messages on the host, I get:\n\nApr 22 03:00:39 localhost fe: 20110422T03:00:39.664Z||5861|Args after replacement = [/etc/xapi.d/plugins/xenstore.py;<methodCall><methodName>write_record</methodName><params><param><value>OpaqueRef:8985f82c-2c1a-bf2f-d452-8d19b2589b3e</value></param><param><value><struct><member><name>path</name><value>vm-data/networking/02163e0e00b9</value></member><member><name>dom_id</name><value>-1</value></member><member><name>value</name><value>{&quot;label&quot;: &quot;public&quot;, &quot;broadcast&quot;: &quot;10.0.0.31&quot;, &quot;ips&quot;: [{&quot;ip&quot;: &quot;10.0.0.2&quot;, &quot;netmask&quot;: &quot;255.255.255.224&quot;, &quot;enabled&quot;: &quot;1&quot;}], &quot;mac&quot;: &quot;02:16:3e:0e:00:b9&quot;, &quot;dns&quot;: [&quot;192.168.1.1&quot;], &quot;gateway&quot;: &quot;10.0.0.1&quot;}</value></member></struct></value></param></params></methodCall>]\nApr 22 03:00:39 localhost fe: 20110422T03:00:39.664Z||5861|I've received the following fds: [2;1]\nApr 22 03:00:39 localhost fe: 20110422T03:00:39.666Z||5862|Caught unexpected exception: Unix.Unix_error(1, \"execve\", \"/etc/xapi.d/plugins/xenstore.py\")\nApr 22 03:00:39 localhost fe: 5862 (/etc/xapi.d/plugins/xenstore.py <methodCall><methodName>write_record</methodN...) exitted with code 1\n\nNo exception handling, that let us get a clue of what's going on.\n\nAny idea of what might have gone wrong?\nThanks,\nArmando", 
            "date_created": "2011-04-22 17:14:17.173143+00:00", 
            "author": "https://api.launchpad.net/1.0/~armando-migliaccio"
        }, 
        {
            "content": "The root of the problem is with the fact that xenstore.py was not executable.", 
            "date_created": "2011-04-22 18:12:23.409565+00:00", 
            "author": "https://api.launchpad.net/1.0/~armando-migliaccio"
        }, 
        {
            "content": "So is that a packaging issue ?", 
            "date_created": "2011-05-24 20:23:58.607602+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Thierry,\n\napart from the fact that xenstore.py was not executable (which, as you said it's a packaging problem), I see two problems here:\n\n1) 'Is virtualization enabled in the BIOS?' error message does give misleading information (in my case it wasn't related to the BIOS at all, and it took me a while to figure out what was going on).\n2) There's an unhandled exception within the catch block in vmops.py:977, which means that the catch block raises an exception because of a bug in dealing with this line:\n\n(nova.compute.manager): TRACE: err_msg = err_trace.splitlines()[-1]", 
            "date_created": "2011-05-25 10:37:01.596466+00:00", 
            "author": "https://api.launchpad.net/1.0/~armando-migliaccio"
        }, 
        {
            "content": "@Armando: could you raise a separate bug against the Ubuntu packaging explaining that xenstore.py should be executable (and why) ? Follow https://bugs.launchpad.net/ubuntu/+source/nova/+filebug", 
            "date_created": "2011-05-25 11:57:45.704300+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Thierry,\n\nI am not very familiar with the Nova/Ubuntu packaging, but I believe that this is not a packaging problem specific to Nova/Ubuntu, but rather a packaging problem that one can experience when plugin files are to be packaged/installed on a XenServer/XCP host.\n\nBy the way, the url you specified above seems to be invalid. \n\nHope this help!\nThanks,\nArmando", 
            "date_created": "2011-05-25 12:11:23.127886+00:00", 
            "author": "https://api.launchpad.net/1.0/~armando-migliaccio"
        }, 
        {
            "content": "Then we can open bug tasks against all the packaging downstreams... My point is that it's not something that can be fixed in nova code, hence the need for a separate bug to track it. The link works for me... If all else fails try clicking \"Report a bug\" on: \n\nhttps://bugs.launchpad.net/ubuntu/+source/nova", 
            "date_created": "2011-05-25 14:24:42.866301+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "FWIW, the permissions in the tree made stumbling upon this bug fairly easy. I got a change merged a couple of months ago to fix the permissions and make it harder to stumble upon it.\n\nhttp://bazaar.launchpad.net/~nova-core/nova/github/revision/1287\n\nThat said, this bug probably should be closed. Any other problems are probably packaging problems.", 
            "date_created": "2011-09-29 15:27:52.537790+00:00", 
            "author": "https://api.launchpad.net/1.0/~johannes.erdfelt"
        }, 
        {
            "content": "I'll just close this out now since my change to fix the permissions in the tree has been merged for a few months.", 
            "date_created": "2011-10-27 20:33:47.520418+00:00", 
            "author": "https://api.launchpad.net/1.0/~johannes.erdfelt"
        }
    ], 
    "closed": "2011-11-17 09:54:44.479301+00:00"
}