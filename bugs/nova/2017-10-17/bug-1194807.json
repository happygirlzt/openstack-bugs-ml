{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:47:28.038114+00:00", 
    "description": "quantum-server is failing to start with:\n\nTraceback (most recent call last):\n\u00a0\u00a0File \"/opt/stack/venvs/quantum/bin/quantum-server\", line 8, in <module>\n\u00a0\u00a0\u00a0\u00a0load_entry_point('quantum==2013.2.a3.g090432c', 'console_scripts', 'quantum-server')()\n\u00a0\u00a0File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/pkg_resources.py\", line 347, in load_entry_point\n\u00a0\u00a0\u00a0\u00a0return get_distribution(dist).load_entry_point(group, name)\n\u00a0\u00a0File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/pkg_resources.py\", line 2517, in load_entry_point\n\u00a0\u00a0\u00a0\u00a0return ep.load()\n\u00a0\u00a0File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/pkg_resources.py\", line 2211, in load\n\u00a0\u00a0\u00a0\u00a0entry = __import__(self.module_name, globals(),globals(), ['__name__'])\n\u00a0\u00a0File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/quantum/server/__init__.py\", line 26, in <module>\n\u00a0\u00a0\u00a0\u00a0from quantum.common import config\n\u00a0\u00a0File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/quantum/common/config.py\", line 29, in <module>\n\u00a0\u00a0\u00a0\u00a0from quantum.openstack.common.db.sqlalchemy import session as db_session\n\u00a0\u00a0File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/quantum/openstack/common/db/sqlalchemy/session.py\", line 283, in <module>\n\u00a0\u00a0\u00a0\u00a0deprecated_opts=[cfg.DeprecatedOpt('sql_connection',\nAttributeError: 'module' object has no attribute 'DeprecatedOpt'\n\nSeems that something was merged in quantum that depends on trunk unreleased oslo components.\n\nOslo version I've installed: oslo.config-1.1.1", 
    "tags": [], 
    "importance": "High", 
    "heat": 52, 
    "link": "https://bugs.launchpad.net/nova/+bug/1194807", 
    "owner": "https://api.launchpad.net/1.0/~markmc", 
    "id": 1194807, 
    "index": 1141, 
    "openned": "2013-07-02 11:57:06.596555+00:00", 
    "created": "2013-06-26 09:24:01.536956+00:00", 
    "title": "too old oslo.config: AttributeError: 'module' object has no attribute 'DeprecatedOpt'", 
    "comments": [
        {
            "content": "quantum-server is failing to start with:\n\nTraceback (most recent call last):\n  File \"/opt/stack/venvs/quantum/bin/quantum-server\", line 8, in <module>\n    load_entry_point('quantum==2013.2.a3.g090432c', 'console_scripts', 'quantum-server')()\n  File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/pkg_resources.py\", line 347, in load_entry_point\n    return get_distribution(dist).load_entry_point(group, name)\n  File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/pkg_resources.py\", line 2517, in load_entry_point\n    return ep.load()\n  File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/pkg_resources.py\", line 2211, in load\n    entry = __import__(self.module_name, globals(),globals(), ['__name__'])\n  File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/quantum/server/__init__.py\", line 26, in <module>\n    from quantum.common import config\n  File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/quantum/common/config.py\", line 29, in <module>\n    from quantum.openstack.common.db.sqlalchemy import session as db_session\n  File \"/opt/stack/venvs/quantum/local/lib/python2.7/site-packages/quantum/openstack/common/db/sqlalchemy/session.py\", line 283, in <module>\n    deprecated_opts=[cfg.DeprecatedOpt('sql_connection',\nAttributeError: 'module' object has no attribute 'DeprecatedOpt'\n\n\nSeems that something was merged in quantum that depends on trunk unreleased oslo components.", 
            "date_created": "2013-06-26 09:24:01.536956+00:00", 
            "author": "https://api.launchpad.net/1.0/~lucasagomes"
        }, 
        {
            "content": "what version of your oslo are u using?\n\ntry to remove your current oslo module in system and then install: http://tarballs.openstack.org/oslo.config/oslo.config-1.2.0a2.tar.gz#egg=oslo.config-1.2.0a2.\n\nFor example:\ncd /usr/local/lib/python2.7/dist-packages/\nrm -rf oslo\npip install http://tarballs.openstack.org/oslo.config/oslo.config-1.2.0a2.tar.gz#egg=oslo.config-1.2.0a2\n\n", 
            "date_created": "2013-06-26 09:35:19.795666+00:00", 
            "author": "https://api.launchpad.net/1.0/~gongysh"
        }, 
        {
            "content": "Hey gongysh,\n\nThanks for that, worked great!\n\n[root@localhost ~]# systemctl status quantum-server\nquantum-server.service - quantum-server Service\n   Loaded: loaded (/usr/lib/systemd/system/quantum-server.service; enabled)\n   Active: active (running) since Wed 2013-06-26 06:03:47 EDT; 6s ago\n Main PID: 4767 (quantum-server)\n   CGroup: name=systemd:/system/quantum-server.service\n           \u2514\u25004767 /opt/stack/venvs/quantum/bin/python /opt/stack/venvs/quantum/bin/quantum-server --config-file /etc/quantum/quantum.conf --config-file /etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini ...\n\n...\n", 
            "date_created": "2013-06-26 10:09:12.965024+00:00", 
            "author": "https://api.launchpad.net/1.0/~lucasagomes"
        }, 
        {
            "content": "Ok, so not a quantum bug; we have something polluting the site packages.", 
            "date_created": "2013-06-26 11:20:10.041503+00:00", 
            "author": "https://api.launchpad.net/1.0/~lifeless"
        }, 
        {
            "content": "I have the same issue when I do a quantum/run_test.sh", 
            "date_created": "2013-06-26 11:55:20.454831+00:00", 
            "author": "https://api.launchpad.net/1.0/~mathieu-rohon"
        }, 
        {
            "content": "Same issue for me when running quantum tests or even starting quantum server. I can confirm Yong's workaround fixed the issue, however.", 
            "date_created": "2013-06-26 13:43:14.140130+00:00", 
            "author": "https://api.launchpad.net/1.0/~mestery"
        }, 
        {
            "content": "Another workaround would be to remove the /lib/python2.7/site-packages/oslo.config-1.1.1-py2.7-nspkg.pth file which seems to be setting the old version as the default oslo\n\n(quantum)[root@localhost /]# quantum-server --config-file /etc/quantum/quantum.conf --config-file /etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini --config-dir /etc/quantum \nTraceback (most recent call last):\n  File \"/opt/stack/venvs/quantum/bin/quantum-server\", line 8, in <module>\n    load_entry_point('quantum==2013.2.a3.g090432c', 'console_scripts', 'quantum-server')()\n  File \"/opt/stack/venvs/quantum/lib/python2.7/site-packages/pkg_resources.py\", line 347, in load_entry_point\n    return get_distribution(dist).load_entry_point(group, name)\n  File \"/opt/stack/venvs/quantum/lib/python2.7/site-packages/pkg_resources.py\", line 2517, in load_entry_point\n    return ep.load()\n  File \"/opt/stack/venvs/quantum/lib/python2.7/site-packages/pkg_resources.py\", line 2211, in load\n    entry = __import__(self.module_name, globals(),globals(), ['__name__'])\n  File \"/opt/stack/venvs/quantum/lib/python2.7/site-packages/quantum/server/__init__.py\", line 26, in <module>\n    from quantum.common import config\n  File \"/opt/stack/venvs/quantum/lib/python2.7/site-packages/quantum/common/config.py\", line 29, in <module>\n    from quantum.openstack.common.db.sqlalchemy import session as db_session\n  File \"/opt/stack/venvs/quantum/lib/python2.7/site-packages/quantum/openstack/common/db/sqlalchemy/session.py\", line 283, in <module>\n    deprecated_opts=[cfg.DeprecatedOpt('sql_connection',\nAttributeError: 'module' object has no attribute 'DeprecatedOpt'\n(quantum)[root@localhost /]# mv /lib/python2.7/site-packages/oslo.config-1.1.1-py2.7-nspkg.pth /tmp/\n(quantum)[root@localhost /]# quantum-server --config-file /etc/quantum/quantum.conf --config-file /etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini --config-dir /etc/quantum \n2013-06-26 11:17:39.791 27692 INFO quantum.common.config [-] Logging enabled!\n2013-06-26 11:17:39.791 27692 DEBUG quantum.service [-] ******************************************************************************** log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1572\n2013-06-26 11:17:39.791 27692 DEBUG quantum.service [-] Configuration options gathered from: log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1573\n2013-06-26 11:17:39.791 27692 DEBUG quantum.service [-] command line args: ['--config-file', '/etc/quantum/quantum.conf', '--config-file', '/etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini', '--config-dir', '/etc/quantum'] log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1574\n2013-06-26 11:17:39.791 27692 DEBUG quantum.service [-] config files: ['/etc/quantum/quantum.conf', '/etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini'] log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1575\n2013-06-26 11:17:39.791 27692 DEBUG quantum.service [-] ================================================================================ log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1576\n2013-06-26 11:17:39.792 27692 DEBUG quantum.service [-] allow_bulk                     = True log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.792 27692 DEBUG quantum.service [-] allow_overlapping_ips          = False log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.792 27692 DEBUG quantum.service [-] allow_pagination               = False log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.792 27692 DEBUG quantum.service [-] allow_sorting                  = False log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.792 27692 DEBUG quantum.service [-] allowed_rpc_exception_modules  = ['quantum.openstack.common.exception', 'nova.exception', 'cinder.exception', 'exceptions'] log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.793 27692 DEBUG quantum.service [-] api_extensions_path            =  log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.793 27692 DEBUG quantum.service [-] api_paste_config               = api-paste.ini log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.793 27692 DEBUG quantum.service [-] auth_strategy                  = keystone log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.793 27692 DEBUG quantum.service [-] backdoor_port                  = None log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.793 27692 DEBUG quantum.service [-] backlog                        = 4096 log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.794 27692 DEBUG quantum.service [-] base_mac                       = fa:16:3e:00:00:00 log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.794 27692 DEBUG quantum.service [-] bind_host                      = 0.0.0.0 log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.794 27692 DEBUG quantum.service [-] bind_port                      = 9696 log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.794 27692 DEBUG quantum.service [-] config_dir                     = /etc/quantum log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.794 27692 DEBUG quantum.service [-] config_file                    = ['/etc/quantum/quantum.conf', '/etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini'] log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.795 27692 DEBUG quantum.service [-] control_exchange               = quantum log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.795 27692 DEBUG quantum.service [-] core_plugin                    = quantum.plugins.openvswitch.ovs_quantum_plugin.OVSQuantumPluginV2 log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.795 27692 DEBUG quantum.service [-] debug                          = True log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.795 27692 DEBUG quantum.service [-] default_log_levels             = ['amqplib=WARN', 'sqlalchemy=WARN', 'boto=WARN', 'suds=INFO', 'keystone=INFO', 'eventlet.wsgi.server=WARN'] log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585\n2013-06-26 11:17:39.795 27692 DEBUG quantum.service [-] dhcp_agent_notification        = True log_opt_values /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/config/cfg.py:1585", 
            "date_created": "2013-06-26 15:42:51.935232+00:00", 
            "author": "https://api.launchpad.net/1.0/~lucasagomes"
        }, 
        {
            "content": "As far as I can tell Yong's fix does not apply when running tests in a virtualenv. ", 
            "date_created": "2013-06-26 16:13:43.623743+00:00", 
            "author": "https://api.launchpad.net/1.0/~armando-migliaccio"
        }, 
        {
            "content": "Here is the problem:\n\nInstalling collected packages: Paste, PasteDeploy, Routes, amqplib, eventlet, greenlet, httplib2, iso8601, kombu, netaddr, python-quantumclient, pyudev, sqlalchemy, WebOb, python-keystoneclient, alembic, oslo.config-1.2.0a2, stevedore, python-novaclient, repoze.lru, amqp, cliff, pyparsing, simplejson, oslo.config, Mako, cmd2, MarkupSafe\n  Running setup.py install for Paste\n<...>\n  Running setup.py install for oslo.config-1.2.0a2\n<...>\n  Running setup.py install for oslo.config\n    Skipping installation of /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo/__init__.py (namespace package)\n    \n    warning: no previously-included files found matching '.gitignore'\n    warning: no previously-included files found matching '.gitreview'\n    Installing /opt/stack/venvs/quantum/lib/python2.7/site-packages/oslo.config-1.1.1-py2.7-nspkg.pth\n\n\nhttp://54.228.118.193/toci/toci_logs_W9TkGtY/setup.out\n\nin the quantum venv we isntall the correct version and then the wrong version afterwards", 
            "date_created": "2013-06-26 22:15:42.015700+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "The oslo.config 1.2 requirement is coming directly from quantum (https://review.openstack.org/#/c/33429/) The second oslo.config is coming from python-keystoneclient.   and because  oslo.config-1.2.0a2 is an alpha and oslo.config>1.1 is not, pip overwrites oslo.config-1.2.0a2 with oslo.config-1.1", 
            "date_created": "2013-06-26 22:30:53.339607+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "How to  reproduce:\n\nreqs.txt:\npython-keystoneclient>=0.2.0\nhttp://tarballs.openstack.org/oslo.config/oslo.config-1.2.0a2.tar.gz#egg=oslo.config-1.2.0a2\n\nvirtualenv venv\nsource venv/bin/activate\npip install -r reqs.txt\npip freeze\n\n\n\n$ pip freeze\nargparse==1.2.1\nd2to1==0.2.10\niso8601==0.1.4\noslo.config==1.1.1\npbr==0.5.17\nprettytable==0.7.2\npython-keystoneclient==0.3.0\nrequests==1.2.3\nsetuptools-git==1.0b1\nsimplejson==3.3.0\nsix==1.3.0\nwsgiref==0.1.2\n", 
            "date_created": "2013-06-26 22:44:23.991159+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "so I think the fix should be to push a new official version of oslo.config-1.2.0", 
            "date_created": "2013-06-27 00:35:26.879288+00:00", 
            "author": "https://api.launchpad.net/1.0/~gongysh"
        }, 
        {
            "content": ">  because oslo.config-1.2.0a2 is an alpha and oslo.config>1.1 is not, pip overwrites oslo.config-1.2.0a2 with oslo.config-1.1\n\nOh, what the hell? That's insane", 
            "date_created": "2013-06-27 06:02:01.769486+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "oslo.config stopped generating a .pth file as of\n\ncommit d47560cce25d87212f852891a762e41c40535c7f\n    Merge \"Update build to use pbr.\"\n\ninstalling oslo.config in a venv (with oslo 1.1.1 installed system wide), I can reproduce what looks like the problem after the switch to using pbr\n\nBefore pbr\n$ venv/bin/python -d -c 'import oslo.config ; print oslo.config.__file__'\n/root/tmp/venv/local/lib/python2.7/site-packages/oslo/config/__init__.pyc\n$ find venv/ | grep -i .pth | grep oslo\nvenv/lib/python2.7/site-packages/oslo.config-1.2.0.a17.g1c1ae83-py2.7-nspkg.pth\n$\n\n\nAfter pbr\n$ venv/bin/python -d -c 'import oslo.config ; print oslo.config.__file__'\n/usr/local/lib/python2.7/dist-packages/oslo/config/__init__.pyc\n$ find venv/ | grep -i .pth | grep oslo\n$\n\nA new release of oslo.config would possibly solve this for new systems that don't have the old release installed, but would the correct solution be to figure out how to have the oslo.config versions prioritized correctly once again?\n", 
            "date_created": "2013-06-27 06:05:35.709762+00:00", 
            "author": "https://api.launchpad.net/1.0/~derekh"
        }, 
        {
            "content": "I can't shake the feeling this is somehow related to bug #1194742", 
            "date_created": "2013-06-27 06:43:10.759801+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Ahh, I had a hunch it had something todo with namespace_packages but couldn't yet figure out how to get oslo to include it in the tarball.\n\nThe pth file seems to get written out by setuptools/command/install_egg_info.py in install_namespaces which does nothing if namespaces don't exist\n\n        if not nsp: return\n", 
            "date_created": "2013-06-27 06:50:20.136559+00:00", 
            "author": "https://api.launchpad.net/1.0/~derekh"
        }, 
        {
            "content": "Ok, well here's confirmation that using 'pip install -r quantum/requirements.txt' doesn't result in oslo.config 1.2.0a2 winning:\n\n $> virtualenv t\n $> . ./t/bin/activate\n $> pip install http://tarballs.openstack.org/oslo.config/oslo.config-1.2.0a2.tar.gz#egg=oslo.config-1.2.0a2 python-keystoneclient\n $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n Traceback (most recent call last):\n   File \"<string>\", line 1, in <module>\n ImportError: cannot import name DeprecatedOpt\n $> pip freeze | grep oslo.config\n oslo.config==1.1.1\n\nThis seems like a pip bug to me because if you install each of these individually, 1.2.0a2 does win:\n\n $> virtualenv t2\n $> . ./t2/bin/activate\n $> pip install http://tarballs.openstack.org/oslo.config/oslo.config-1.2.0a2.tar.gz#egg=oslo.config-1.2.0a2\n $> pip install python-keystoneclient\n $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n $> pip freeze | grep oslo.config\n oslo.config==1.2.0a2\n\n\n\nHowever, another thing to note is that between devstack and pbr, you actually see different semantics when doing this in devstack. That's because 'python setup.py egg_info' with pbr writes out 'oslo.config>=1.2.0a2' in requires.txt and the URL in dependency_links.txt so devstack winds up doing:\n\n $> virtualenv t1\n $> . ./t1/bin/activate\n $> pip install -f http://tarballs.openstack.org/oslo.config/oslo.config-1.2.0a2.tar.gz#egg=oslo.config-1.2.0a2 'oslo.config>=1.2.0a2' python-keystoneclient\n $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n $> pip freeze | grep oslo.config\n oslo.config==1.2.0a2\n\n\n", 
            "date_created": "2013-06-27 06:53:51.733455+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Thanks for looking into this Derek\n\nI think the only sane conclusion is that we really need to fix bug #1194742 and see if that helps.  We don't know for certain it will be enough to fix this issue, but it's very likely its at least a related issue.", 
            "date_created": "2013-06-27 10:44:27.197483+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "ok, now that  bug #1194742 is fixed ...\n\n  $> virtualenv t5\n  $> . t5/bin/activate\n  $> pip install http://tarballs.openstack.org/oslo.config/oslo.config-master.tar.gz#egg=oslo.config-1.2.0.a34.g08203f6/ python-keystoneclient\n  $> python -c 'from oslo.config.cfg import DeprecatedOpt'Traceback (most recent call last):\n   File \"<string>\", line 1, in <module>\n ImportError: cannot import name DeprecatedOpt\n $> pip freeze | grep oslo.config\n oslo.config==1.2.0.a34.g08203f6\n\ni.e. the code in t5/lib/python2.7/site-packages/oslo/config/__init__.py is the 1.1.1 code, whereas pip thinks the 1.2.0 version is installed\n\nI can't see how this isn't a pip bug\n\n", 
            "date_created": "2013-06-27 15:18:29.949084+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "For completeness\n\n$> uname -a\nLinux sorcha 3.5.2-3.fc17.x86_64 #1 SMP Tue Aug 21 19:06:52 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux\n$> virtualenv --version\n1.8.3\n$> . ./t5/bin/activate\n(t5)$> pip --version\npip 1.2.1 from .../t5/lib/python2.7/site-packages/pip-1.2.1-py2.7.egg (python 2.7)\n$> python --version\nPython 2.7.3\n\n", 
            "date_created": "2013-06-27 15:25:43.627102+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/34715\nCommitted: http://github.com/stackforge/tripleo-image-elements/commit/880e112e6f652878bdb9d53c7918785aea17692b\nSubmitter: Jenkins\nBranch:    master\n\ncommit 880e112e6f652878bdb9d53c7918785aea17692b\nAuthor: Derek Higgins <email address hidden>\nDate:   Fri Jun 28 14:10:59 2013 +0100\n\n    Install clients in their own venv\n    \n    Fixes bug 1194807\n    \n    This prevents dependencies from polluting the system\n    environment.\n    \n    Change-Id: I47905f00ef0ffe7521098508def5f29839f9ae3f\n", 
            "date_created": "2013-06-28 19:58:53.235371+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Changing this:\n\n     $ pip install http://tarballs.openstack.org/oslo.config/oslo.config-master.tar.gz#egg=oslo.config-1.2.0.a34.g08203f6 python-keystoneclient\n\nto this:\n\n    $ pip install http://tarballs.openstack.org/oslo.config/oslo.config-master.tar.gz#egg=oslo.config python-keystoneclient\n\nwill install the 1.2.0 version of the library.  The fragment part of the URL tells pip what the name of the package will be when it is installed and doesn't need a version.  The strange this is that my 'pip freeze' output doesn't show oslo.config 1.2.0 it shows version 1.1.1.", 
            "date_created": "2013-07-01 15:32:08.394548+00:00", 
            "author": "https://api.launchpad.net/1.0/~dstanek"
        }, 
        {
            "content": "Thanks, yes - dstufft also noticed that dropping the version part of the egg fragment helps\n\nThe problem with that is the way our setup.py works, we parse this URL and extract the egg fragment so that e.g. 'oslo.config>=1.2.0.a2' would end up in requires.txt\n\nSee https://github.com/openstack-dev/pbr/blob/master/pbr/packaging.py#L128\n\ni.e. we can't easily just drop the version part of the egg fragment", 
            "date_created": "2013-07-01 16:03:04.422676+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "It seems that pbr is going against the common use case.  Would it be possible to change the URL format to something like:\n\n    http://tarballs.openstack.org/oslo.config/oslo.config-master.tar.gz#egg=oslo.config&version=1.2.0\n\npip can handle this URL OK and pbr could be changed to accept this new format and still be backward compatible.  Then other projects could be changed to use this new format.\n\nI'm surprised that this hasn't come up before.", 
            "date_created": "2013-07-01 16:51:11.839252+00:00", 
            "author": "https://api.launchpad.net/1.0/~dstanek"
        }, 
        {
            "content": "Quick update on this\n\nFirstly, I think the current behaviour of pip is definitely a bug and seems pretty fixable. Basically, it takes the egg= fragment and treats oslo.config-1.2.0a2 as the package name and installs *both* 'oslo.config-1.2.0a2' and 'oslo.config'. Simply fixing pip to strip the version from the package name in egg= fragment fixes this behaviour.\n\nWe obviously don't want to wait for pip to be fixed, thought. It looks like if we simply do:\n\n  -f http://tarballs.openstack.org/oslo.config/oslo.config-1.2.0a2.tar.gz#egg=oslo.config-1.2.0a2\n oslo.config>=1.2.0a2\n\nthen that will work just fine and will mirror the semantics we actually want. I'm actually a bit perplexed as to why we haven't always done this.\n\nOne possible complication is that the gating infrastructure around the requirements repo might reject it, but that should be fixable.\n\nAnyway, I'll continue to push work on this today and will also file a bug against pip.", 
            "date_created": "2013-07-02 06:39:31.008234+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Adding back the neutron task - if you do 'pip install -r quantum/requirements.txt' then you end up with the 1.1.1 version of the code installed", 
            "date_created": "2013-07-02 11:27:52.495322+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "David mentioned above that he was seeing '1.1.1' in his pip freeze\n\nI'm pretty sure that if there are two .egg-info/ dirs in the same sys.path entry, the one pip reports is based on readdir() order ... which is completely filesystem specific. So, that would explain it?\n\nDoes that mean you should never be able to persuade pip to install two eggs in the same sys.path entry?", 
            "date_created": "2013-07-02 11:51:40.084382+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/35279", 
            "date_created": "2013-07-02 11:56:00.603985+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "The nova task is to track reverting this revert: https://review.openstack.org/33888", 
            "date_created": "2013-07-02 11:59:20.307631+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/35280", 
            "date_created": "2013-07-02 12:04:32.927523+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/35281", 
            "date_created": "2013-07-02 12:07:30.494354+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/35293", 
            "date_created": "2013-07-02 13:19:32.115067+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/35296", 
            "date_created": "2013-07-02 13:24:46.935983+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/35296\nCommitted: http://github.com/openstack-infra/config/commit/69f5a95ff1f7cb5e456b488f6cb2a0c2b831bb8c\nSubmitter: Jenkins\nBranch:    master\n\ncommit 69f5a95ff1f7cb5e456b488f6cb2a0c2b831bb8c\nAuthor: Mark McLoughlin <email address hidden>\nDate:   Tue Jul 2 14:11:11 2013 +0100\n\n    Ignore --find-links lines in requirement checks\n    \n    Fixes bug #1194807\n    \n    In quantum, we currently have a URL based requirement:\n    \n      http://.../oslo.config-1.2.0a2.tar.gz#egg=oslo.config-1.2.0a2\n    \n    The requirements check currently ignores this.\n    \n    It turns out that pip has a bug which doesn't where you can end up with\n    the oslo.config 1.1.1 code installed. This is because oslo.config>=1.1.0\n    gets pulled in as a transitive dep and pip gets confused. You can\n    reproduce with e.g.\n    \n      $> pip install \\\n           http://.../oslo.config-1.2.0a3.tar.gz#egg=oslo.config-1.2.0a3 \\\n           python-keystoneclient\n      $> pip freeze | grep oslo.config\n      oslo.config-1.2.0a3\n      $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n      Traceback (most recent call last):\n        File \"<string>\", line 1, in <module>\n      ImportError: cannot import name DeprecatedOpt\n    \n    This is because of a bug with pip where it sees oslo.config-1.2.0a3 and\n    oslo.config as two unrelated things. It should strip the version part of\n    the egg= fragment before using it as a package name, but it doesn't.\n    \n    However, we can simply use the -f/--find-links pip option in our\n    requirements.txt to add the tarball URL to the list of URLs considered\n    and also add the oslo.config>=1.2.0a3 dependency:\n    \n      $> pip install \\\n           -f http://.../oslo.config-1.2.0a3.tar.gz#egg=oslo.config-1.2.0a3 \\\n           'oslo.config>=1.2.0a3' \\\n           python-keystoneclient\n      $> pip freeze | grep oslo.config\n      oslo.config-1.2.0a3\n      $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n    \n    This is actually exactly the semantics we want and we go to great\n    lengths in pbr to get these semantics while using a single tarball URL.\n    The only downside to this --find-links strategy is that we gain an extra\n    line in our requirements.txt ... but it does work around the pip bug.\n    \n    I think it makes sense for the requirements check to just ignore\n    --find-links lines for now like it does for URLs and -editable lines.\n    Using this method means we actually do require new versions of libraries\n    consumed this way to be approved into openstack/requirements first since\n    we have an explicit 'oslo.config>=1.2.0a3' listed rather than that being\n    derived from a URL.\n    \n    It may make sense in future to have automation around checking which\n    find-links URLs are allowed ... but the same can be true for normal\n    dependency URLs. This change allows us to move forward and use latest\n    oslo.config in Nova, Neutron, etc. without falling foul of the pip bug.\n    \n    Change-Id: I6f3eb5fd2c75615d9a1cae172aed859b36b27d4c\n", 
            "date_created": "2013-07-02 23:14:18.782792+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I wrote up a bunch of stuff to provide some background why \"just release to pypi\" isn't an answer - https://wiki.openstack.org/wiki/Oslo#Why_aren.27t_alphas_releases_of_oslo.config_published_to_PyPI.3F", 
            "date_created": "2013-07-05 10:53:09.452880+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "The same issue when run quantum/run_test.sh.", 
            "date_created": "2013-07-08 10:36:19.899449+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhang-jinnan"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/35280\nCommitted: http://github.com/openstack/oslo-incubator/commit/9f09474c5f8f591453e1dc5e3c1ddc3c7efd4985\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9f09474c5f8f591453e1dc5e3c1ddc3c7efd4985\nAuthor: Mark McLoughlin <email address hidden>\nDate:   Tue Jul 2 13:01:26 2013 +0100\n\n    Fix issue with pip installing oslo.config-1.2.0\n    \n    Fixes bug #1194807\n    \n    Firstly, we update the oslo.config dep to 1.2.0a3 because of the issue\n    with namespace packages (bug #1194742).\n    \n    But the main issue here is that if we ever added a dependency to our\n    requirements.txt that had a dependency on an older version of\n    oslo.config we would see the same issue thatt Nova and Quantum recently\n    experienced where you end up with the oslo.config 1.1.1 code installed.\n    This is because oslo.config>=1.1.0 gets pulled in as a transitive dep\n    and pip gets confused. You can reproduce with e.g.\n    \n      $> pip install \\\n           http://.../oslo.config-1.2.0a3.tar.gz#egg=oslo.config-1.2.0a3 \\\n           python-keystoneclient\n      $> pip freeze | grep oslo.config\n      oslo.config-1.2.0a3\n      $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n      Traceback (most recent call last):\n        File \"<string>\", line 1, in <module>\n      ImportError: cannot import name DeprecatedOpt\n    \n    This is because of a bug with pip where it sees oslo.config-1.2.0a3 and\n    oslo.config as two unrelated things. It should strip the version part of\n    the egg= fragment before using it as a package name, but it doesn't.\n    \n    However, we can simply use the -f/--find-links pip option in our\n    requirements.txt to add the tarball URL to the list of URLs considered\n    and also add the oslo.config>=1.2.0a3 dependency:\n    \n      $> pip install \\\n           -f http://.../oslo.config-1.2.0a3.tar.gz#egg=oslo.config-1.2.0a3 \\\n           'oslo.config>=1.2.0a3' \\\n           python-keystoneclient\n      $> pip freeze | grep oslo.config\n      oslo.config-1.2.0a3\n      $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n    \n    This is actually exactly the semantics we want and we go to great\n    lengths in pbr to get these semantics while using a single tarball URL.\n    The only downside to this --find-links strategy is that we gain an extra\n    line in our requirements.txt ... but it does work around the pip bug.\n    \n    Change-Id: I6f3eb5fd2c75615d9a1cae172aed859b36b27d4c\n", 
            "date_created": "2013-07-11 20:45:06.850840+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/35279\nCommitted: http://github.com/openstack/neutron/commit/7d2588935086e7afce6969ff1f44239473af9953\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7d2588935086e7afce6969ff1f44239473af9953\nAuthor: Mark McLoughlin <email address hidden>\nDate:   Tue Jul 2 12:25:58 2013 +0100\n\n    Fix issue with pip installing oslo.config-1.2.0\n    \n    Fixes bug #1194807\n    \n    Firstly, we update the oslo.config dep to 1.2.0a3 because of the issue\n    with namespace packages (bug #1194742).\n    \n    But the main issue here is that if you currently do:\n    \n      $> pip install -r quantum/requirements.txt\n    \n    then you end up with the oslo.config 1.1.1 code installed. This is\n    because oslo.config>=1.1.0 gets pulled in as a transitive dep and pip\n    gets confused. You can reproduce with e.g.\n    \n      $> pip install \\\n           http://.../oslo.config-1.2.0a3.tar.gz#egg=oslo.config-1.2.0a3 \\\n           python-keystoneclient\n      $> pip freeze | grep oslo.config\n      oslo.config-1.2.0a3\n      $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n      Traceback (most recent call last):\n        File \"<string>\", line 1, in <module>\n      ImportError: cannot import name DeprecatedOpt\n    \n    This is because of a bug with pip where it sees oslo.config-1.2.0a3 and\n    oslo.config as two unrelated things. It should strip the version part of\n    the egg= fragment before using it as a package name, but it doesn't.\n    \n    However, we can simply use the -f/--find-links pip option in our\n    requirements.txt to add the tarball URL to the list of URLs considered\n    and also add the oslo.config>=1.2.0a3 dependency:\n    \n      $> pip install \\\n           -f http://.../oslo.config-1.2.0a3.tar.gz#egg=oslo.config-1.2.0a3 \\\n           'oslo.config>=1.2.0a3' \\\n           python-keystoneclient\n      $> pip freeze | grep oslo.config\n      oslo.config-1.2.0a3\n      $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n    \n    This is actually exactly the semantics we want and we go to great\n    lengths in pbr to get these semantics while using a single tarball URL.\n    The only downside to this --find-links strategy is that we gain an extra\n    line in our requirements.txt ... but it does work around the pip bug.\n    \n    Change-Id: I6f3eb5fd2c75615d9a1cae172aed859b36b27d4c\n", 
            "date_created": "2013-07-12 05:31:36.556456+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I finally sent a pull request for the pip bug: https://github.com/pypa/pip/issues/1042", 
            "date_created": "2013-07-12 07:31:18.083020+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/35281\nCommitted: http://github.com/openstack/nova/commit/59b799d30e58cc294e843dfc25895574b2ab40a7\nSubmitter: Jenkins\nBranch:    master\n\ncommit 59b799d30e58cc294e843dfc25895574b2ab40a7\nAuthor: Mark McLoughlin <email address hidden>\nDate:   Tue Jul 2 13:05:08 2013 +0100\n\n    Fix issue with pip installing oslo.config-1.2.0\n    \n    Fixes bug #1194807\n    \n    Firstly, we update the oslo.config dep to 1.2.0a3 because of the issue\n    with namespace packages (bug #1194742).\n    \n    But the main issue here is that when we previously depended on 1.2.0a3\n    we found that if you did:\n    \n      $> pip install -r nova/requirements.txt\n    \n    then you end up with the oslo.config 1.1.1 code installed. This is\n    because oslo.config>=1.1.0 gets pulled in as a transitive dep and pip\n    gets confused.\n    \n    See I977700d73342e81ee962019b76238d2cb2b1fff4\n    \n    You can reproduce with e.g.\n    \n      $> pip install \\\n           http://.../oslo.config-1.2.0a3.tar.gz#egg=oslo.config-1.2.0a3 \\\n           python-keystoneclient\n      $> pip freeze | grep oslo.config\n      oslo.config-1.2.0a3\n      $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n      Traceback (most recent call last):\n        File \"<string>\", line 1, in <module>\n      ImportError: cannot import name DeprecatedOpt\n    \n    This is because of a bug with pip where it sees oslo.config-1.2.0a3 and\n    oslo.config as two unrelated things. It should strip the version part of\n    the egg= fragment before using it as a package name, but it doesn't.\n    \n    However, we can simply use the -f/--find-links pip option in our\n    requirements.txt to add the tarball URL to the list of URLs considered\n    and also add the oslo.config>=1.2.0a3 dependency:\n    \n      $> pip install \\\n           -f http://.../oslo.config-1.2.0a3.tar.gz#egg=oslo.config-1.2.0a3 \\\n           'oslo.config>=1.2.0a3' \\\n           python-keystoneclient\n      $> pip freeze | grep oslo.config\n      oslo.config-1.2.0a3\n      $> python -c 'from oslo.config.cfg import DeprecatedOpt'\n    \n    This is actually exactly the semantics we want and we go to great\n    lengths in pbr to get these semantics while using a single tarball URL.\n    The only downside to this --find-links strategy is that we gain an extra\n    line in our requirements.txt ... but it does work around the pip bug.\n    \n    Change-Id: I6f3eb5fd2c75615d9a1cae172aed859b36b27d4c\n", 
            "date_created": "2013-07-16 15:44:45.147783+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-07-17 12:21:27.177868+00:00"
}