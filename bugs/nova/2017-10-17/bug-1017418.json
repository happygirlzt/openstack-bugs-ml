{
    "status": "Fix Released", 
    "last_updated": "2012-09-03 15:24:49.511411+00:00", 
    "description": "Problem: NoMoreFloatingIps: Zero floating ips available\nConfiguration: \tFlatDHCP, auto_assign_floating_ip\n\t\tmulti_host\n\nFloating Ranges created using:\nnova-manage floating create 172.29.3.0/24\nnova-manage floating create 172.29.4.0/24\n\nThis gives me 512 floating addresses I can use.\n\nPublic: bond0 (eth0 and eth1)\nPrivate: eth2 (unbonded)\n\nOS: Ubuntu 12.04 LTS\n\nii  nova-api                         2012.1-0ubuntu2.3                        OpenStack Compute - API frontend\nii  nova-common                      2012.1-0ubuntu2.3                        OpenStack Compute - common files\nii  nova-compute                     2012.1-0ubuntu2.3                        OpenStack Compute - compute node\nii  nova-compute-kvm                 2012.1-0ubuntu2.3                        OpenStack Compute - compute node (KVM)\nii  nova-network                     2012.1-0ubuntu2.3                        OpenStack Compute - Network manager\nii  python-glance                    2012.1-0ubuntu2.1                        OpenStack Image Registry and Delivery Service - Python library\nii  python-keystone                  2012.1-0ubuntu1                          OpenStack identity service - Python library\nii  python-keystoneclient            2012.1-0ubuntu1                          Client libary for Openstack Keystone API\nii  python-nova                      2012.1-0ubuntu2.3                        OpenStack Compute Python libraries\nii  python-novaclient                2012.1-0ubuntu1                          client library for OpenStack Compute API\n\n\nI run a script to create and destroy instances repeatedly and report on the number of instances that made it to active state and the number of machines set to error state.\nAfter a while of running the script (which just creates instances of the same type, waits for 20 seconds, then deletes them, waits for 20 seconds, and repeats) I get ERRORS.\nOn viewing the logs I see lots of errors relating to Floating IPs:\n\n/var/log/nova/nova-network.log:\n2012-06-25 10:11:13 ERROR nova.rpc.amqp [req-6814af4e-90ef-425f-9756-11fcf84b0a39 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-25 10:11:13 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 371, in deallocate_for_instance\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     affect_auto_assigned=True)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 520, in disassociate_floating_ip\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     raise exception.FloatingIpNotAssociated(address=floating_address)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp FloatingIpNotAssociated: Floating ip 172.29.4.6 is not associated.\n2012-06-25 10:11:13 TRACE nova.rpc.amqp \n\n\nRun 1, Num Errors: 0, Num Active: 21\nRun 2, Num Errors: 0, Num Active: 19\nRun 3, Num Errors: 0, Num Active: 19\nRun 4, Num Errors: 0, Num Active: 17\nRun 5, Num Errors: 2, Num Active: 19\nRun 6, Num Errors: 0, Num Active: 18\nRun 7, Num Errors: 0, Num Active: 21\nRun 8, Num Errors: 1, Num Active: 20\nRun 9, Num Errors: 1, Num Active: 19\nRun 10, Num Errors: 0, Num Active: 21\nRun 11, Num Errors: 0, Num Active: 21\nRun 12, Num Errors: 0, Num Active: 21\nRun 13, Num Errors: 0, Num Active: 19\nRun 14, Num Errors: 0, Num Active: 21\nRun 15, Num Errors: 1, Num Active: 17\n\nnova list\n+----+------+--------+----------+\n| ID | Name | Status | Networks |\n+----+------+--------+----------+\n+----+------+--------+----------+\n\nnova-manage floating list\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.1\tMissing instance 5762\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.2\tMissing instance 5765\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.3\tMissing instance 5771\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.4\tMissing instance 5774\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.5\tMissing instance 5768\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.6\tMissing instance 5777\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.7\tMissing instance 5780\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.8\tMissing instance 5786\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.9\tMissing instance 5783\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.10\tMissing instance 5789\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.11\tMissing instance 5792\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.12\tMissing instance 5795\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.13\tMissing instance 5801\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.14\tMissing instance 5798\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.15\tMissing instance 5804\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.16\tMissing instance 5807\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.17\tMissing instance 5813\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.18\tMissing instance 5819\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.19\tMissing instance 5816\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.20\tMissing instance 5822\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.21\tMissing instance 5828\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.22\tMissing instance 5810\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.23\tMissing instance 5825\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.24\tMissing instance 5834\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.25\tMissing instance 5831\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.26\tMissing instance 5837\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.27\tMissing instance 5840\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.28\tMissing instance 5846\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.29\tMissing instance 5843\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.30\tMissing instance 5849\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.31\tMissing instance 5852\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.32\tMissing instance 5858\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.33\tMissing instance 5855\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.34\tMissing instance 5864\tnova\tbond0\n\n\nShowing what is not in this \"Missing instance\" state:\n\nnova-manage floating list | egrep -v \"Missing\"\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.234\tNone\tnova\tbond0\nNone\t172.29.4.193\tNone\tnova\tbond0\nNone\t172.29.4.194\tNone\tnova\tbond0\nNone\t172.29.4.195\tNone\tnova\tbond0\nNone\t172.29.4.196\tNone\tnova\tbond0\nNone\t172.29.4.197\tNone\tnova\tbond0\nNone\t172.29.4.198\tNone\tnova\tbond0\nNone\t172.29.4.199\tNone\tnova\tbond0\nNone\t172.29.4.200\tNone\tnova\tbond0\nNone\t172.29.4.201\tNone\tnova\tbond0\nNone\t172.29.4.202\tNone\tnova\tbond0\nNone\t172.29.4.203\tNone\tnova\tbond0\nNone\t172.29.4.204\tNone\tnova\tbond0\nNone\t172.29.4.205\tNone\tnova\tbond0\nNone\t172.29.4.206\tNone\tnova\tbond0\nNone\t172.29.4.207\tNone\tnova\tbond0\nNone\t172.29.4.208\tNone\tnova\tbond0\nNone\t172.29.4.209\tNone\tnova\tbond0\nNone\t172.29.4.210\tNone\tnova\tbond0\nNone\t172.29.4.211\tNone\tnova\tbond0\nNone\t172.29.4.212\tNone\tnova\tbond0\nNone\t172.29.4.213\tNone\tnova\tbond0\nNone\t172.29.4.214\tNone\tnova\tbond0\nNone\t172.29.4.215\tNone\tnova\tbond0\nNone\t172.29.4.216\tNone\tnova\tbond0\nNone\t172.29.4.217\tNone\tnova\tbond0\nNone\t172.29.4.218\tNone\tnova\tbond0\nNone\t172.29.4.219\tNone\tnova\tbond0\nNone\t172.29.4.220\tNone\tnova\tbond0\nNone\t172.29.4.221\tNone\tnova\tbond0\nNone\t172.29.4.222\tNone\tnova\tbond0\nNone\t172.29.4.223\tNone\tnova\tbond0\nNone\t172.29.4.224\tNone\tnova\tbond0\nNone\t172.29.4.225\tNone\tnova\tbond0\nNone\t172.29.4.226\tNone\tnova\tbond0\nNone\t172.29.4.227\tNone\tnova\tbond0\nNone\t172.29.4.228\tNone\tnova\tbond0\nNone\t172.29.4.229\tNone\tnova\tbond0\nNone\t172.29.4.230\tNone\tnova\tbond0\nNone\t172.29.4.231\tNone\tnova\tbond0\nNone\t172.29.4.232\tNone\tnova\tbond0\nNone\t172.29.4.233\tNone\tnova\tbond0\nNone\t172.29.4.234\tNone\tnova\tbond0\nNone\t172.29.4.235\tNone\tnova\tbond0\nNone\t172.29.4.236\tNone\tnova\tbond0\nNone\t172.29.4.237\tNone\tnova\tbond0\nNone\t172.29.4.238\tNone\tnova\tbond0\nNone\t172.29.4.239\tNone\tnova\tbond0\nNone\t172.29.4.240\tNone\tnova\tbond0\nNone\t172.29.4.241\tNone\tnova\tbond0\nNone\t172.29.4.242\tNone\tnova\tbond0\nNone\t172.29.4.243\tNone\tnova\tbond0\nNone\t172.29.4.244\tNone\tnova\tbond0\nNone\t172.29.4.245\tNone\tnova\tbond0\nNone\t172.29.4.246\tNone\tnova\tbond0\nNone\t172.29.4.247\tNone\tnova\tbond0\nNone\t172.29.4.248\tNone\tnova\tbond0\nNone\t172.29.4.249\tNone\tnova\tbond0\nNone\t172.29.4.250\tNone\tnova\tbond0\nNone\t172.29.4.251\tNone\tnova\tbond0\nNone\t172.29.4.252\tNone\tnova\tbond0\nNone\t172.29.4.253\tNone\tnova\tbond0\nNone\t172.29.4.254\tNone\tnova\tbond0\n\n\nKick off test again:\n\non compute hosts /var/log/nova/nova-network.log:\n2012-06-25 10:49:28 ERROR nova.rpc.amqp [req-9911e91f-2175-4aaf-899c-e6dabcfaaa29 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-25 10:49:28 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 371, in deallocate_for_instance\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     affect_auto_assigned=True)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 520, in disassociate_floating_ip\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     raise exception.FloatingIpNotAssociated(address=floating_address)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp FloatingIpNotAssociated: Floating ip 172.29.4.210 is not associated.\n2012-06-25 10:49:28 TRACE nova.rpc.amqp \n2012-06-25 10:49:34 ERROR nova.rpc.amqp [req-303bd4ee-5104-4658-be1d-117016841263 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-25 10:49:34 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 371, in deallocate_for_instance\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     affect_auto_assigned=True)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 520, in disassociate_floating_ip\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     raise exception.FloatingIpNotAssociated(address=floating_address)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp FloatingIpNotAssociated: Floating ip 172.29.4.221 is not associated.\n2012-06-25 10:49:34 TRACE nova.rpc.amqp \n\nThen eventually\n\nRun 1, Num Errors: 0, Num Active: 21\nRun 2, Num Errors: 1, Num Active: 19\nRun 3, Num Errors: 27, Num Active: 3\nRun 4, Num Errors: 30, Num Active: 0\n\n\n2012-06-25 10:53:31 ERROR nova.rpc.amqp [req-54164eb0-8e71-42bc-b812-7c55ceca6bcf cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Returning exception Zero floating ips available. to caller\n2012-06-25 10:53:31 ERROR nova.rpc.amqp [req-54164eb0-8e71-42bc-b812-7c55ceca6bcf cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 324, in allocate_for_instance\\n    floating_address = self.allocate_floating_ip(context, project_id)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 408, in allocate_floating_ip\\n    pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 246, in floating_ip_allocate_address\\n    return IMPL.floating_ip_allocate_address(context, project_id, pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\\n    return f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 642, in floating_ip_allocate_address\\n    raise exception.NoMoreFloatingIps()\\n', 'NoMoreFloatingIps: Zero floating ips available.\\n']\n2012-06-25 10:53:34 ERROR nova.rpc.amqp [req-326cd1e6-7024-4b58-8b47-43b1cbc493ec cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-25 10:53:34 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 324, in allocate_for_instance\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     floating_address = self.allocate_floating_ip(context, project_id)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 408, in allocate_floating_ip\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     pool)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 246, in floating_ip_allocate_address\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     return IMPL.floating_ip_allocate_address(context, project_id, pool)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     return f(*args, **kwargs)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 642, in floating_ip_allocate_address\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     raise exception.NoMoreFloatingIps()\n2012-06-25 10:53:34 TRACE nova.rpc.amqp NoMoreFloatingIps: Zero floating ips available.\n2012-06-25 10:53:34 TRACE nova.rpc.amqp \n2012-06-25 10:53:34 ERROR nova.rpc.amqp [req-326cd1e6-7024-4b58-8b47-43b1cbc493ec cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Returning exception Zero floating ips available. to caller\n2012-06-25 10:53:34 ERROR nova.rpc.amqp [req-326cd1e6-7024-4b58-8b47-43b1cbc493ec cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 324, in allocate_for_instance\\n    floating_address = self.allocate_floating_ip(context, project_id)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 408, in allocate_floating_ip\\n    pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 246, in floating_ip_allocate_address\\n    return IMPL.floating_ip_allocate_address(context, project_id, pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\\n    return f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 642, in floating_ip_allocate_address\\n    raise exception.NoMoreFloatingIps()\\n', 'NoMoreFloatingIps: Zero floating ips available.\\n']\n2012-06-25 10:54:04 ERROR nova.network.manager [req-3beb2739-cd48-41a8-870d-d69c4fe530ae cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.19 because vif doesn't exist.\n2012-06-25 10:54:10 ERROR nova.network.manager [req-e8e13ea9-c8e2-46e5-a790-4d40c990f16c cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.21 because vif doesn't exist.\n2012-06-25 10:54:12 ERROR nova.network.manager [req-45de33b1-b132-448c-9a67-fe14ed06423d cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.24 because vif doesn't exist.\n2012-06-25 10:54:17 ERROR nova.network.manager [req-68e2a7bb-9a20-4565-b880-012be66c9618 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.29 because vif doesn't exist.\n2012-06-25 10:54:20 ERROR nova.network.manager [req-9b104583-de0d-4a6c-a8f8-7b750c5f8ea7 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.36 because vif doesn't exist.\n2012-06-25 10:54:23 ERROR nova.network.manager [req-c7d11987-7148-41a9-a1c1-a759343347d6 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.37 because vif doesn't exist.", 
    "tags": [
        "verification-done"
    ], 
    "importance": "Critical", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1017418", 
    "owner": "https://api.launchpad.net/1.0/~vishvananda", 
    "id": 1017418, 
    "index": 62, 
    "openned": "2012-06-25 10:01:04.780933+00:00", 
    "created": "2012-06-25 10:01:04.780933+00:00", 
    "title": "NoMoreFloatingIps: Zero floating ips available after repeatedly creating and destroying instances over time", 
    "comments": [
        {
            "content": "Problem: NoMoreFloatingIps: Zero floating ips available\nConfiguration: \tFlatDHCP, auto_assign_floating_ip\n\t\tmulti_host\n\nFloating Ranges created using:\nnova-manage floating create 172.29.3.0/24\nnova-manage floating create 172.29.4.0/24\n\nThis gives me 512 floating addresses I can use.\n\nPublic: bond0 (eth0 and eth1)\nPrivate: eth2 (unbonded)\n\nOS: Ubuntu 12.04 LTS\n\nii  nova-api                         2012.1-0ubuntu2.3                        OpenStack Compute - API frontend\nii  nova-common                      2012.1-0ubuntu2.3                        OpenStack Compute - common files\nii  nova-compute                     2012.1-0ubuntu2.3                        OpenStack Compute - compute node\nii  nova-compute-kvm                 2012.1-0ubuntu2.3                        OpenStack Compute - compute node (KVM)\nii  nova-network                     2012.1-0ubuntu2.3                        OpenStack Compute - Network manager\nii  python-glance                    2012.1-0ubuntu2.1                        OpenStack Image Registry and Delivery Service - Python library\nii  python-keystone                  2012.1-0ubuntu1                          OpenStack identity service - Python library\nii  python-keystoneclient            2012.1-0ubuntu1                          Client libary for Openstack Keystone API\nii  python-nova                      2012.1-0ubuntu2.3                        OpenStack Compute Python libraries\nii  python-novaclient                2012.1-0ubuntu1                          client library for OpenStack Compute API\n\n\nI run a script to create and destroy instances repeatedly and report on the number of instances that made it to active state and the number of machines set to error state.\nAfter a while of running the script (which just creates instances of the same type, waits for 20 seconds, then deletes them, waits for 20 seconds, and repeats) I get ERRORS.\nOn viewing the logs I see lots of errors relating to Floating IPs:\n\n/var/log/nova/nova-network.log:\n2012-06-25 10:11:13 ERROR nova.rpc.amqp [req-6814af4e-90ef-425f-9756-11fcf84b0a39 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-25 10:11:13 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 371, in deallocate_for_instance\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     affect_auto_assigned=True)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 520, in disassociate_floating_ip\n2012-06-25 10:11:13 TRACE nova.rpc.amqp     raise exception.FloatingIpNotAssociated(address=floating_address)\n2012-06-25 10:11:13 TRACE nova.rpc.amqp FloatingIpNotAssociated: Floating ip 172.29.4.6 is not associated.\n2012-06-25 10:11:13 TRACE nova.rpc.amqp \n\n\nRun 1, Num Errors: 0, Num Active: 21\nRun 2, Num Errors: 0, Num Active: 19\nRun 3, Num Errors: 0, Num Active: 19\nRun 4, Num Errors: 0, Num Active: 17\nRun 5, Num Errors: 2, Num Active: 19\nRun 6, Num Errors: 0, Num Active: 18\nRun 7, Num Errors: 0, Num Active: 21\nRun 8, Num Errors: 1, Num Active: 20\nRun 9, Num Errors: 1, Num Active: 19\nRun 10, Num Errors: 0, Num Active: 21\nRun 11, Num Errors: 0, Num Active: 21\nRun 12, Num Errors: 0, Num Active: 21\nRun 13, Num Errors: 0, Num Active: 19\nRun 14, Num Errors: 0, Num Active: 21\nRun 15, Num Errors: 1, Num Active: 17\n\nnova list\n+----+------+--------+----------+\n| ID | Name | Status | Networks |\n+----+------+--------+----------+\n+----+------+--------+----------+\n\nnova-manage floating list\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.1\tMissing instance 5762\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.2\tMissing instance 5765\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.3\tMissing instance 5771\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.4\tMissing instance 5774\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.5\tMissing instance 5768\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.6\tMissing instance 5777\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.7\tMissing instance 5780\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.8\tMissing instance 5786\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.9\tMissing instance 5783\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.10\tMissing instance 5789\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.11\tMissing instance 5792\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.12\tMissing instance 5795\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.13\tMissing instance 5801\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.14\tMissing instance 5798\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.15\tMissing instance 5804\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.16\tMissing instance 5807\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.17\tMissing instance 5813\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.18\tMissing instance 5819\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.19\tMissing instance 5816\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.20\tMissing instance 5822\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.21\tMissing instance 5828\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.22\tMissing instance 5810\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.23\tMissing instance 5825\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.24\tMissing instance 5834\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.25\tMissing instance 5831\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.26\tMissing instance 5837\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.27\tMissing instance 5840\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.28\tMissing instance 5846\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.29\tMissing instance 5843\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.30\tMissing instance 5849\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.31\tMissing instance 5852\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.32\tMissing instance 5858\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.33\tMissing instance 5855\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.34\tMissing instance 5864\tnova\tbond0\n\n\nShowing what is not in this \"Missing instance\" state:\n\nnova-manage floating list | egrep -v \"Missing\"\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.234\tNone\tnova\tbond0\nNone\t172.29.4.193\tNone\tnova\tbond0\nNone\t172.29.4.194\tNone\tnova\tbond0\nNone\t172.29.4.195\tNone\tnova\tbond0\nNone\t172.29.4.196\tNone\tnova\tbond0\nNone\t172.29.4.197\tNone\tnova\tbond0\nNone\t172.29.4.198\tNone\tnova\tbond0\nNone\t172.29.4.199\tNone\tnova\tbond0\nNone\t172.29.4.200\tNone\tnova\tbond0\nNone\t172.29.4.201\tNone\tnova\tbond0\nNone\t172.29.4.202\tNone\tnova\tbond0\nNone\t172.29.4.203\tNone\tnova\tbond0\nNone\t172.29.4.204\tNone\tnova\tbond0\nNone\t172.29.4.205\tNone\tnova\tbond0\nNone\t172.29.4.206\tNone\tnova\tbond0\nNone\t172.29.4.207\tNone\tnova\tbond0\nNone\t172.29.4.208\tNone\tnova\tbond0\nNone\t172.29.4.209\tNone\tnova\tbond0\nNone\t172.29.4.210\tNone\tnova\tbond0\nNone\t172.29.4.211\tNone\tnova\tbond0\nNone\t172.29.4.212\tNone\tnova\tbond0\nNone\t172.29.4.213\tNone\tnova\tbond0\nNone\t172.29.4.214\tNone\tnova\tbond0\nNone\t172.29.4.215\tNone\tnova\tbond0\nNone\t172.29.4.216\tNone\tnova\tbond0\nNone\t172.29.4.217\tNone\tnova\tbond0\nNone\t172.29.4.218\tNone\tnova\tbond0\nNone\t172.29.4.219\tNone\tnova\tbond0\nNone\t172.29.4.220\tNone\tnova\tbond0\nNone\t172.29.4.221\tNone\tnova\tbond0\nNone\t172.29.4.222\tNone\tnova\tbond0\nNone\t172.29.4.223\tNone\tnova\tbond0\nNone\t172.29.4.224\tNone\tnova\tbond0\nNone\t172.29.4.225\tNone\tnova\tbond0\nNone\t172.29.4.226\tNone\tnova\tbond0\nNone\t172.29.4.227\tNone\tnova\tbond0\nNone\t172.29.4.228\tNone\tnova\tbond0\nNone\t172.29.4.229\tNone\tnova\tbond0\nNone\t172.29.4.230\tNone\tnova\tbond0\nNone\t172.29.4.231\tNone\tnova\tbond0\nNone\t172.29.4.232\tNone\tnova\tbond0\nNone\t172.29.4.233\tNone\tnova\tbond0\nNone\t172.29.4.234\tNone\tnova\tbond0\nNone\t172.29.4.235\tNone\tnova\tbond0\nNone\t172.29.4.236\tNone\tnova\tbond0\nNone\t172.29.4.237\tNone\tnova\tbond0\nNone\t172.29.4.238\tNone\tnova\tbond0\nNone\t172.29.4.239\tNone\tnova\tbond0\nNone\t172.29.4.240\tNone\tnova\tbond0\nNone\t172.29.4.241\tNone\tnova\tbond0\nNone\t172.29.4.242\tNone\tnova\tbond0\nNone\t172.29.4.243\tNone\tnova\tbond0\nNone\t172.29.4.244\tNone\tnova\tbond0\nNone\t172.29.4.245\tNone\tnova\tbond0\nNone\t172.29.4.246\tNone\tnova\tbond0\nNone\t172.29.4.247\tNone\tnova\tbond0\nNone\t172.29.4.248\tNone\tnova\tbond0\nNone\t172.29.4.249\tNone\tnova\tbond0\nNone\t172.29.4.250\tNone\tnova\tbond0\nNone\t172.29.4.251\tNone\tnova\tbond0\nNone\t172.29.4.252\tNone\tnova\tbond0\nNone\t172.29.4.253\tNone\tnova\tbond0\nNone\t172.29.4.254\tNone\tnova\tbond0\n\n\nKick off test again:\n\non compute hosts /var/log/nova/nova-network.log:\n2012-06-25 10:49:28 ERROR nova.rpc.amqp [req-9911e91f-2175-4aaf-899c-e6dabcfaaa29 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-25 10:49:28 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 371, in deallocate_for_instance\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     affect_auto_assigned=True)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 520, in disassociate_floating_ip\n2012-06-25 10:49:28 TRACE nova.rpc.amqp     raise exception.FloatingIpNotAssociated(address=floating_address)\n2012-06-25 10:49:28 TRACE nova.rpc.amqp FloatingIpNotAssociated: Floating ip 172.29.4.210 is not associated.\n2012-06-25 10:49:28 TRACE nova.rpc.amqp \n2012-06-25 10:49:34 ERROR nova.rpc.amqp [req-303bd4ee-5104-4658-be1d-117016841263 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-25 10:49:34 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 371, in deallocate_for_instance\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     affect_auto_assigned=True)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 520, in disassociate_floating_ip\n2012-06-25 10:49:34 TRACE nova.rpc.amqp     raise exception.FloatingIpNotAssociated(address=floating_address)\n2012-06-25 10:49:34 TRACE nova.rpc.amqp FloatingIpNotAssociated: Floating ip 172.29.4.221 is not associated.\n2012-06-25 10:49:34 TRACE nova.rpc.amqp \n\nThen eventually\n\nRun 1, Num Errors: 0, Num Active: 21\nRun 2, Num Errors: 1, Num Active: 19\nRun 3, Num Errors: 27, Num Active: 3\nRun 4, Num Errors: 30, Num Active: 0\n\n\n2012-06-25 10:53:31 ERROR nova.rpc.amqp [req-54164eb0-8e71-42bc-b812-7c55ceca6bcf cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Returning exception Zero floating ips available. to caller\n2012-06-25 10:53:31 ERROR nova.rpc.amqp [req-54164eb0-8e71-42bc-b812-7c55ceca6bcf cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 324, in allocate_for_instance\\n    floating_address = self.allocate_floating_ip(context, project_id)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 408, in allocate_floating_ip\\n    pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 246, in floating_ip_allocate_address\\n    return IMPL.floating_ip_allocate_address(context, project_id, pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\\n    return f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 642, in floating_ip_allocate_address\\n    raise exception.NoMoreFloatingIps()\\n', 'NoMoreFloatingIps: Zero floating ips available.\\n']\n2012-06-25 10:53:34 ERROR nova.rpc.amqp [req-326cd1e6-7024-4b58-8b47-43b1cbc493ec cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-25 10:53:34 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 324, in allocate_for_instance\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     floating_address = self.allocate_floating_ip(context, project_id)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 408, in allocate_floating_ip\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     pool)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 246, in floating_ip_allocate_address\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     return IMPL.floating_ip_allocate_address(context, project_id, pool)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     return f(*args, **kwargs)\n2012-06-25 10:53:34 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 642, in floating_ip_allocate_address\n2012-06-25 10:53:34 TRACE nova.rpc.amqp     raise exception.NoMoreFloatingIps()\n2012-06-25 10:53:34 TRACE nova.rpc.amqp NoMoreFloatingIps: Zero floating ips available.\n2012-06-25 10:53:34 TRACE nova.rpc.amqp \n2012-06-25 10:53:34 ERROR nova.rpc.amqp [req-326cd1e6-7024-4b58-8b47-43b1cbc493ec cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Returning exception Zero floating ips available. to caller\n2012-06-25 10:53:34 ERROR nova.rpc.amqp [req-326cd1e6-7024-4b58-8b47-43b1cbc493ec cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 324, in allocate_for_instance\\n    floating_address = self.allocate_floating_ip(context, project_id)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 408, in allocate_floating_ip\\n    pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 246, in floating_ip_allocate_address\\n    return IMPL.floating_ip_allocate_address(context, project_id, pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\\n    return f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 642, in floating_ip_allocate_address\\n    raise exception.NoMoreFloatingIps()\\n', 'NoMoreFloatingIps: Zero floating ips available.\\n']\n2012-06-25 10:54:04 ERROR nova.network.manager [req-3beb2739-cd48-41a8-870d-d69c4fe530ae cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.19 because vif doesn't exist.\n2012-06-25 10:54:10 ERROR nova.network.manager [req-e8e13ea9-c8e2-46e5-a790-4d40c990f16c cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.21 because vif doesn't exist.\n2012-06-25 10:54:12 ERROR nova.network.manager [req-45de33b1-b132-448c-9a67-fe14ed06423d cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.24 because vif doesn't exist.\n2012-06-25 10:54:17 ERROR nova.network.manager [req-68e2a7bb-9a20-4565-b880-012be66c9618 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.29 because vif doesn't exist.\n2012-06-25 10:54:20 ERROR nova.network.manager [req-9b104583-de0d-4a6c-a8f8-7b750c5f8ea7 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.36 because vif doesn't exist.\n2012-06-25 10:54:23 ERROR nova.network.manager [req-c7d11987-7148-41a9-a1c1-a759343347d6 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Unable to release 10.29.4.37 because vif doesn't exist.", 
            "date_created": "2012-06-25 10:01:04.780933+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "Is it possible that your script is deleting instances before they are done creating? I don't see any way for the code path with the error to get hit unless the network deallocate is getting called before the allocation is done somehow.  Can you try either waiting until the api says the instance is running or upping the wait to a minute to see if the error persists?  That will help us track down if it is a race condition or a logic error somewhere.\n\nVish", 
            "date_created": "2012-06-25 18:36:43.185275+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Hi Vish, you are correct in assuming the script doesn't wait for the machines to finish booting before deleting them.  Patience was never a strong point of mine... the test I was performing was as follows - not pretty, but highlights the issue:\n\nNUM_INSTANCES=30\nNUM_ITERATIONS=15\n\nfor I in `seq 1 ${NUM_ITERATIONS}`\ndo\n        # Spin up N instances\n        for a in `seq 1 ${NUM_INSTANCES}`; do nova boot kevinj${a} --flavor=2 --image 57a173b0-f24d-4e2d-b914-e8f60ed1b881 --key_name kevinj --security_groups default 2>&1 > /dev/null; done\n\n        sleep 20\n\n        NUM_ERRORS=$(nova list | grep -c ERR)\n        NUM_ACTIVE=$(nova list | grep -c ACTIVE)\n\n        echo \"Run $I, Num Errors: ${NUM_ERRORS}, Num Active: ${NUM_ACTIVE}\"\n        for a in `seq 1 ${NUM_INSTANCES}`; do nova delete kevinj${a} 2>&1 > /dev/null; done\n\n        sleep 20\ndone\n\n\nI'll re-run the test with the --poll option to see if it makes a difference.\n\nEither way, if this is the case that a race condition can cause the floating IPs to become unavailable - where --auto_assign_floating_ip is used, and therefore cause no more instances to spawn - this is a Security/DDoS issue.", 
            "date_created": "2012-06-26 07:52:20.643101+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "Would that be caught by quota limitations ?\r\nAlso would the floating IPs be freed after a period of time ? Would the consumer of those be billed for the usage ? This is not a DoS attack if the attacker is just a user that gets billed for resources he consumes and everything gets back to normal if he stops ?", 
            "date_created": "2012-06-26 10:30:17.165835+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Ah, Thierry - I forgot to add this little ditty which is crucial to this.  I modified the rate limit - as well as quotas (for internal clouds, the quotas are too strict when the idea is, under an account, to spin up as many machines as required - especially for a \"production\" tenant)...:\n\n/etc/nova/api-paste.ini:\n[filter:ratelimit]\npaste.filter_factory = nova.api.openstack.compute.limits:RateLimitingMiddleware.factory\nlimits =(\"POST\", \"*\", \".*\", 120, MINUTE);(\"POST\", \"*/servers\", \"^/servers\", 1000, DAY);(\"PUT\", \"*\", \".*\", 120, MINUTE);(\"GET\", \"*changes-since*\", \".*changes-since.*\", 30, MINUTE);(\"DELETE\", \"*\", \".*\", 100,MINUTE)\n\nIn terms of DoS and billed: for internal private clouds, this very probably won't involved money changing hands so this makes the resource \"limitless\" providing the local network level DoS\n\nI don't think ratelimit or quota will help this race condition.\nI've not seen floating ips re-appear after a while - after returning the next day to the environment, the environment is still broke.", 
            "date_created": "2012-06-26 10:54:52.546663+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "Awesome, adding VMT to track this", 
            "date_created": "2012-06-26 11:04:38.507097+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "I re-ran that script above, adding --poll to the end of the nova boot command:\n\nRun 1, Num Errors: 0, Num Active: 30\nRun 2, Num Errors: 0, Num Active: 30\nRun 3, Num Errors: 0, Num Active: 30\nRun 4, Num Errors: 0, Num Active: 30\nRun 5, Num Errors: 0, Num Active: 30\nRun 6, Num Errors: 0, Num Active: 30\nRun 7, Num Errors: 0, Num Active: 30\nRun 8, Num Errors: 0, Num Active: 30\nRun 9, Num Errors: 0, Num Active: 30\nRun 10, Num Errors: 0, Num Active: 30\nRun 11, Num Errors: 0, Num Active: 30\nRun 12, Num Errors: 0, Num Active: 30\nRun 13, Num Errors: 0, Num Active: 30\nRun 14, Num Errors: 0, Num Active: 30\nRun 15, Num Errors: 0, Num Active: 30\n\nsudo nova-manage floating list\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.1\tMissing instance 7469\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.2\tMissing instance 7472\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.3\tMissing instance 7475\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.4\tMissing instance 7478\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.5\tMissing instance 7481\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.6\tMissing instance 7484\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.7\tMissing instance 7487\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.8\tMissing instance 7490\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.9\tMissing instance 7493\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.10\tMissing instance 7496\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.4.11\tMissing instance 7499\tnova\tbond0\n...\nNone\t172.29.4.244\tNone\tnova\tbond0\nNone\t172.29.4.245\tNone\tnova\tbond0\nNone\t172.29.4.246\tNone\tnova\tbond0\nNone\t172.29.4.247\tNone\tnova\tbond0\nNone\t172.29.4.248\tNone\tnova\tbond0\nNone\t172.29.4.249\tNone\tnova\tbond0\nNone\t172.29.4.250\tNone\tnova\tbond0\nNone\t172.29.4.251\tNone\tnova\tbond0\nNone\t172.29.4.252\tNone\tnova\tbond0\nNone\t172.29.4.253\tNone\tnova\tbond0\nNone\t172.29.4.254\tNone\tnova\tbond0\n\n\nRe-running again\n\nRun 1, Num Errors: 0, Num Active: 30\nRun 2, Num Errors: 2, Num Active: 28\nRun 3, Num Errors: 30, Num Active: 0\nRun 4, Num Errors: 30, Num Active: 0\nRun 5, Num Errors: 30, Num Active: 0\nRun 6, Num Errors: 30, Num Active: 0\nRun 7, Num Errors: 30, Num Active: 0\nRun 8, Num Errors: 30, Num Active: 0\n\nwhen running\n\nsudo nova-manage floating list\n\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.250\tMissing instance 8974\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.251\tMissing instance 8977\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.252\tMissing instance 8980\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.253\tMissing instance 8983\tnova\tbond0\nb3ecef20bbb842929cee0d7523a0b2e4\t172.29.3.254\tMissing instance 8986\tnova\tbond0\n\nall now show as Missing.\n\n/var/log/nova/nova-network.log\n\n012-06-26 12:57:51 ERROR nova.rpc.amqp [req-f4557acc-e19e-4289-8216-a5dc15623ce6 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Exception during message handling\n2012-06-26 12:57:51 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-26 12:57:51 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-06-26 12:57:51 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-26 12:57:51 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-26 12:57:51 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-26 12:57:51 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 324, in allocate_for_instance\n2012-06-26 12:57:51 TRACE nova.rpc.amqp     floating_address = self.allocate_floating_ip(context, project_id)\n2012-06-26 12:57:51 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\n2012-06-26 12:57:51 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-26 12:57:51 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 408, in allocate_floating_ip\n2012-06-26 12:57:51 TRACE nova.rpc.amqp     pool)\n2012-06-26 12:57:51 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 246, in floating_ip_allocate_address\n2012-06-26 12:57:51 TRACE nova.rpc.amqp     return IMPL.floating_ip_allocate_address(context, project_id, pool)\n2012-06-26 12:57:51 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\n2012-06-26 12:57:51 TRACE nova.rpc.amqp     return f(*args, **kwargs)\n2012-06-26 12:57:51 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 642, in floating_ip_allocate_address\n2012-06-26 12:57:51 TRACE nova.rpc.amqp     raise exception.NoMoreFloatingIps()\n2012-06-26 12:57:51 TRACE nova.rpc.amqp NoMoreFloatingIps: Zero floating ips available.\n2012-06-26 12:57:51 TRACE nova.rpc.amqp\n2012-06-26 12:57:51 ERROR nova.rpc.amqp [req-f4557acc-e19e-4289-8216-a5dc15623ce6 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] Returning exception Zero floating ips available. to caller\n2012-06-26 12:57:51 ERROR nova.rpc.amqp [req-f4557acc-e19e-4289-8216-a5dc15623ce6 cb704aa5159b4aa887f17f0349a7f7c9 b3ecef20bbb842929cee0d7523a0b2e4] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 324, in allocate_for_instance\\n    floating_address = self.allocate_floating_ip(context, project_id)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 258, in wrapped\\n    return func(self, context, *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 408, in allocate_floating_ip\\n    pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 246, in floating_ip_allocate_address\\n    return IMPL.floating_ip_allocate_address(context, project_id, pool)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\\n    return f(*args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 642, in floating_ip_allocate_address\\n    raise exception.NoMoreFloatingIps()\\n', 'NoMoreFloatingIps: Zero floating ips available.\\n']\n", 
            "date_created": "2012-06-26 12:12:05.958457+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "So if I understand the post above, the poll option fixes the issue, so it is a race condition on deleting an instance that has not finished spawning that causes the ip to leak?", 
            "date_created": "2012-06-26 16:58:59.793403+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Seeing incomplete modifications of the floating_ips table when deleting long-lived instances in a multi-host, auto_assign_floating_ip environment.\n\nHere is record in the floating_ips table for the floating IP in question AFTER terminating the associated instance\n\"2012-06-20 21:46:30.253886\";\"2012-06-26 21:57:29.50243\";\"\";FALSE;\"105\";\"16.125.108.105\";;\"d7127ed3027044c4942fc2f94549489e\";\"\";TRUE;\"nova\";\"eth0\"\n\nThe project_id column is not properly updated, nor is the auto_assigned column.  The network manager code looks like it should be nulling out project_id, host, and fixed_ip_id, as well as setting auto_assigned to False. fixed_ip_id and host are updated properly.\n\nIn addition, I was finally was able to locate the related traceback that is logged when this occurs:\n\n2012-06-26 15:57:29 ERROR nova.rpc.amqp [req-d094a9f3-a0b6-4d8e-adf7-6d9e8eb5117f e4a51bc329a74001806ce7820b784313 d7127ed3027044c4942fc2f94549489e] Exception during message handling\n2012-06-26 15:57:29 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-06-26 15:57:29 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 253, in _process_data\n2012-06-26 15:57:29 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-06-26 15:57:29 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 257, in wrapped\n2012-06-26 15:57:29 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-26 15:57:29 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 374, in deallocate_for_instance\n2012-06-26 15:57:29 TRACE nova.rpc.amqp     affect_auto_assigned=True)\n2012-06-26 15:57:29 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 257, in wrapped\n2012-06-26 15:57:29 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-06-26 15:57:29 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 425, in deallocate_floating_ip\n2012-06-26 15:57:29 TRACE nova.rpc.amqp     raise exception.FloatingIpAssociated(address=floating_address)\n2012-06-26 15:57:29 TRACE nova.rpc.amqp FloatingIpAssociated: Floating ip 16.125.108.105 is associated.\n\n", 
            "date_created": "2012-06-26 22:15:44.343599+00:00", 
            "author": "https://api.launchpad.net/1.0/~ryan-tidwell"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/9040", 
            "date_created": "2012-06-27 00:58:04.698158+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/essex\nReview: https://review.openstack.org/9041", 
            "date_created": "2012-06-27 00:59:06.195759+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I actually think that this issue was fixed in this review:\n\nhttps://review.openstack.org/#/c/8339/\n\nI've made one additional change that could be causing issues and pulled the relevent changes from the other patch into a backport.", 
            "date_created": "2012-06-27 01:03:28.828348+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "If you could try applying the change here and verify that it fixes the issue, that would be amazing:\n\nhttps://review.openstack.org/9041", 
            "date_created": "2012-06-27 01:05:02.221328+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "FixedIp variant: bug 1014769", 
            "date_created": "2012-06-27 09:10:37.071054+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/9040\nCommitted: http://github.com/openstack/nova/commit/c689891226baa8877f6fb7b3c468b06972068847\nSubmitter: Jenkins\nBranch:    master\n\ncommit c689891226baa8877f6fb7b3c468b06972068847\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Tue Jun 26 17:56:21 2012 -0700\n\n    Avoid casts in network manager to prevent races\n    \n     * Part of fix for bug 1017418\n    \n    Change-Id: I3251f02fc5fcb8305f12b6b8a9644232b9146db2\n", 
            "date_created": "2012-06-27 21:23:07.193701+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Vish: do you agree that this is a valid attack scenario and therefore we should consider this a vulnerability ? How about the FixedIp variant on bug 1014769 ?", 
            "date_created": "2012-06-28 10:07:34.127841+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Cheers Vish, I'm just playing catch up here - will look at this today.\n\nKev\n\nOn 27 June 2012 02:05, Vish Ishaya <email address hidden> wrote:\n\n> If you could try applying the change here and verify that it fixes the\n> issue, that would be amazing:\n>\n> https://review.openstack.org/9041\n>\n>\n-- \nKevin Jackson\n@itarchitectkev\n", 
            "date_created": "2012-06-28 10:26:17+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "ttx: I think they are both high priority, but I don't know about security vulnerability. They both only occur under certain configurations that are non-default", 
            "date_created": "2012-06-28 18:31:08.220727+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/9041\nCommitted: http://github.com/openstack/nova/commit/80d302670f8db37b297ea0618cc14851aab6fff5\nSubmitter: Jenkins\nBranch:    stable/essex\n\ncommit 80d302670f8db37b297ea0618cc14851aab6fff5\nAuthor: Vishvananda Ishaya <email address hidden>\nDate:   Tue Jun 26 17:56:21 2012 -0700\n\n    Avoid casts in network manager to prevent races\n    \n     * Fixes bug 1017418\n     * Includes a change to turn the floating ip casts\n       into calls which is part of commit\n       82599c77346bbefd550ea4ee6c0b13a3df4950af\n     * These calls are to prevent race conditions that\n       were preventing floating ips from being deallocated\n       properly\n    \n    Change-Id: I3251f02fc5fcb8305f12b6b8a9644232b9146db2\n    (cherry picked from commit c689891226baa8877f6fb7b3c468b06972068847)\n", 
            "date_created": "2012-07-24 06:40:36.982849+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Please find the attached test log from the Ubuntu Server Team's CI infrastructure.  As part of the verification process for this bug, Nova has been deployed and configured across multiple nodes using precise-proposed as an installation source.  After successful bring-up and configuration of the cluster, a number of exercises and smoke tests have be invoked to ensure the updated package did not introduce any regressions. A number of test iterations were carried out to catch any possible transient errors.\n\nPlease Note the list of installed packages at the top and bottom of the report.\n\nFor records of upstream test coverage of this update, please see the Jenkins links in the comments of the relevant  upstream code-review(s):\n\nTrunk review: https://review.openstack.org/9040\nStable review: https://review.openstack.org/9041\n\nAs per the provisional Micro Release Exception granted to this package by the Technical Board, we hope this contributes toward verification of this update.", 
            "date_created": "2012-08-30 07:36:08.620861+00:00", 
            "author": "https://api.launchpad.net/1.0/~gandelman-a"
        }, 
        {
            "content": "Test coverage log.", 
            "date_created": "2012-08-30 07:36:12.056506+00:00", 
            "author": "https://api.launchpad.net/1.0/~gandelman-a"
        }, 
        {
            "content": "This bug was fixed in the package nova - 2012.1.3+stable-20120827-4d2a4afe-0ubuntu1\n\n---------------\nnova (2012.1.3+stable-20120827-4d2a4afe-0ubuntu1) precise-proposed; urgency=low\n\n  * New upstream snapshot, fixes FTBFS in -proposed. (LP: #1041120)\n  * Resynchronize with stable/essex (4d2a4afe):\n    - [5d63601] Inappropriate exception handling on kvm live/block migration\n      (LP: #917615)\n    - [ae280ca] Deleted floating ips can cause instance delete to fail\n      (LP: #1038266)\n\nnova (2012.1.3+stable-20120824-86fb7362-0ubuntu1) precise-proposed; urgency=low\n\n  * New upstream snapshot. (LP: #1041120)\n  * Dropped, superseded by new snapshot:\n    - debian/patches/CVE-2012-3447.patch: [d9577ce]\n    - debian/patches/CVE-2012-3371.patch: [25f5bd3]\n    - debian/patches/CVE-2012-3360+3361.patch: [b0feaff]\n  * Resynchronize with stable/essex (86fb7362):\n    - [86fb736] Libvirt driver reports incorrect error when volume-detach fails\n      (LP: #1029463)\n    - [272b98d] nova delete lxc-instance umounts the wrong rootfs (LP: #971621)\n    - [09217ab] Block storage connections are NOT restored on system reboot\n      (LP: #1036902)\n    - [d9577ce] CVE-2012-3361 not fully addressed (LP: #1031311)\n    - [e8ef050] pycrypto is unused and the existing code is potentially insecure\n      to use (LP: #1033178)\n    - [3b4ac31] cannot umount guestfs  (LP: #1013689)\n    - [f8255f3] qpid_heartbeat setting in ineffective (LP: #1030430)\n    - [413c641] Deallocation of fixed IP occurs before security group refresh\n      leading to potential security issue in error / race conditions\n      (LP: #1021352)\n    - [219c5ca] Race condition in network/deallocate_for_instance() leads to\n      security issue (LP: #1021340)\n    - [f2bc403] cleanup_file_locks does not remove stale sentinel files\n      (LP: #1018586)\n    - [4c7d671] Deleting Flavor currently in use by instance creates error\n      (LP: #994935)\n    - [7e88e39] nova testsuite errors on newer versions of python-boto (e.g.\n      2.5.2) (LP: #1027984)\n    - [80d3026] NoMoreFloatingIps: Zero floating ips available after repeatedly\n      creating and destroying instances over time (LP: #1017418)\n    - [4d74631] Launching with source groups under load produces lazy load error\n      (LP: #1018721)\n    - [08e5128] API 'v1.1/{tenant_id}/os-hosts' does not return a list of hosts\n      (LP: #1014925)\n    - [801b94a] Restarting nova-compute removes ip packet filters (LP: #1027105)\n    - [f6d1f55] instance live migration should create virtual_size disk image\n      (LP: #977007)\n    - [4b89b4f] [nova][volumes] Exceeding volumes, gigabytes and floating_ips\n      quotas returns general uninformative HTTP 500 error (LP: #1021373)\n    - [6e873bc] [nova][volumes] Exceeding volumes, gigabytes and floating_ips\n      quotas returns general uninformative HTTP 500 error (LP: #1021373)\n    - [7b215ed] Use default qemu-img cluster size in libvirt connection driver\n    - [d3a87a2] Listing flavors with marker set returns 400 (LP: #956096)\n    - [cf6a85a] nova-rootwrap hardcodes paths instead of using\n      /sbin:/usr/sbin:/usr/bin:/bin (LP: #1013147)\n    - [2efc87c] affinity filters don't work if scheduler_hints is None\n      (LP: #1007573)\n    - [48e5f46] metadata injection is broken in xen (LP: #1022036)\n    - [25f5bd3] scheduler hang (DOS) possible with\n      DifferentHostFilter/SameHostFilter  (LP: #1017795)\n    - [1c1b858] cannot umount guestfs  (LP: #1013689)\n    - [835ba4f] not able to get host total memory in xen with libvirt\n      (LP: #1004298)\n    - [00e5104] Call to network_get_all_by_uuids missing 'db' (LP: #986922)\n    - [4c49df7] [nova][volumes] Exceeding volumes, gigabytes and floating_ips\n      quotas returns general uninformative HTTP 500 error (LP: #1021373)\n    - [19631f3] [nova][volumes] Exceeding volumes quotas logs\n      \"VolumeSizeTooLarge\" instead of \"VolumeLimitExceeded\"  (LP: #1020634)\n    - [b0feaff] Remote arbitrary file corruption / creation flaw via injected\n      files (LP: #1015531)\n    - [3cb6e57] NoMoreFixedIps: Zero fixed ips available. Nova seems leaking\n      them. (LP: #1014769)\n    - [5d8431b] ram_allocation_ratio does not work (LP: #1016273)\n    - [410060f] test_get_console_output_file requires sudo NOPASSWD\n      (LP: #992805)\n    - [33c2575] Stop/start a KVM instance with volumes attached produces an\n      error state (LP: #1013782)\n    - [6c01c01] Backport tox settings to unbreak jenkins jobs.\n    - [344125f] Set defaultbranch in .gitreview to stable/essex\n    - [9b789be] floating ips are not disassociated from instances on deletion\n      (LP: #997763)\n    - [d89c2f3] qpid timeout causing compute service to crash (LP: #999698)\n    - [caae0e9] floating ips do not display in 'nova list' after association to\n      instance (LP: #939122)\n    - [1dc9f19] impl_qpid doesn't ACK messages (LP: #1012374)\n    - [bc621bc] Restarting nova-network removes ip packet filters\n      (LP: #1000853)\n    - [7870157] Add caching to openstack.common.cfg\n    - [27133ee] Firewall rules from nova-compute are not refreshed after host\n      reboot (LP: #985162)\n    - [3ee026e] Source group based security group rule without protocol and port\n      causes failures (LP: #1010514)\n    - [f0a9f47] [SRU] dns_domains table mysql charset is 'latin1'. Should be\n      'utf8' (LP: #993663)\n    - [cc8fd97] euca-describe-keypair NonExistent returns 200 (LP: #1006664)\n    - [9f9e9da] Security groups fail to be set correctly if incorrect case is\n      used for protocol specification (LP: #985184)\n -- Adam Gandelman <email address hidden>   Mon, 27 Aug 2012 14:50:40 -0700", 
            "date_created": "2012-09-03 15:18:08.793162+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }, 
        {
            "content": "The verification of this Stable Release Update has completed successfully and the package has now been released to -updates.  Subsequently, the Ubuntu Stable Release Updates Team is being unsubscribed and will not receive messages about this bug report.  In the event that you encounter a regression using the package from -updates please report a new bug using ubuntu-bug and tag the bug report regression-update so we can easily find any regresssions.", 
            "date_created": "2012-09-03 15:24:48.717034+00:00", 
            "author": "https://api.launchpad.net/1.0/~clint-fewbar"
        }
    ], 
    "closed": "2012-07-04 08:27:04.465473+00:00"
}