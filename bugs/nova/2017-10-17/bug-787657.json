{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:34:35.435413+00:00", 
    "description": "Hi,\n\nI use Nova (bzr1101) with an ESXi 4.1 hypervisor.\nI set the flag 'vlan_interface' inm y configuration file but Nova didn't start and log says :\n\n\n2011-05-24 18:10:38,728 ERROR nova [-] in Service.create()\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 267, in serve\n(nova): TRACE:     services = [Service.create()]\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 164, in create\n(nova): TRACE:     report_interval, periodic_interval)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 69, in __init__\n(nova): TRACE:     self.manager = manager_class(host=self.host, *args, **kwargs)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 132, in __init__\n(nova): TRACE:     self.network_manager = utils.import_object(FLAGS.network_manager)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 73, in import_object\n(nova): TRACE:     return cls()\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 123, in __init__\n(nova): TRACE:     self.driver = utils.import_object(network_driver)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 69, in import_object\n(nova): TRACE:     __import__(import_str)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/vmwareapi_net.py\", line 34, in <module>\n(nova): TRACE:     'Physical network adapter name in VMware ESX host for '\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/flags.py\", line 215, in _wrapped\n(nova): TRACE:     func(*args, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1808, in DEFINE_string\n(nova): TRACE:     DEFINE(parser, name, default, help, flag_values, serializer, **args)\n(nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1701, in DEFINE\n(nova): TRACE:     flag_values)\n(nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1716, in DEFINE_flag\n(nova): TRACE:     fv[flag.name] = flag\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/flags.py\", line 131, in __setitem__\n(nova): TRACE:     gflags.FlagValues.__setitem__(self, name, flag)\n(nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 791, in __setitem__\n(nova): TRACE:     raise DuplicateFlagError(name, self)\n(nova): TRACE: DuplicateFlagError: The flag 'vlan_interface' is defined twice. First from nova.network.manager, Second from nova.network.vmwareapi_net\n(nova): TRACE: \n2011-05-24 18:10:38,750 CRITICAL nova [-] The flag 'vlan_interface' is defined twice. First from nova.network.manager, Second from nova.network.vmwareapi_net\n\nIf I comment lines in source file 'nova/network/vmwareapi_net.py', it works correctly:\n    flags.DEFINE_string('vlan_interface', 'vmnic0',\n                         'Physical network adapter name in VMware ESX host for '\n                         'vlan networking')", 
    "tags": [
        "vmware"
    ], 
    "importance": "High", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/787657", 
    "owner": "https://api.launchpad.net/1.0/~sateesh-chodapuneedi", 
    "id": 787657, 
    "index": 410, 
    "openned": "2011-05-24 16:14:30.804427+00:00", 
    "created": "2011-05-24 16:14:30.804427+00:00", 
    "title": "VMware vlan_interface flag defined txice", 
    "comments": [
        {
            "content": "Hi,\n\nI use Nova (bzr1101) with an ESXi 4.1 hypervisor.\nI set the flag 'vlan_interface' inm y configuration file but Nova didn't start and log says :\n\n\n2011-05-24 18:10:38,728 ERROR nova [-] in Service.create()\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 267, in serve\n(nova): TRACE:     services = [Service.create()]\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 164, in create\n(nova): TRACE:     report_interval, periodic_interval)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 69, in __init__\n(nova): TRACE:     self.manager = manager_class(host=self.host, *args, **kwargs)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 132, in __init__\n(nova): TRACE:     self.network_manager = utils.import_object(FLAGS.network_manager)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 73, in import_object\n(nova): TRACE:     return cls()\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 123, in __init__\n(nova): TRACE:     self.driver = utils.import_object(network_driver)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 69, in import_object\n(nova): TRACE:     __import__(import_str)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/vmwareapi_net.py\", line 34, in <module>\n(nova): TRACE:     'Physical network adapter name in VMware ESX host for '\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/flags.py\", line 215, in _wrapped\n(nova): TRACE:     func(*args, **kw)\n(nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1808, in DEFINE_string\n(nova): TRACE:     DEFINE(parser, name, default, help, flag_values, serializer, **args)\n(nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1701, in DEFINE\n(nova): TRACE:     flag_values)\n(nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1716, in DEFINE_flag\n(nova): TRACE:     fv[flag.name] = flag\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/flags.py\", line 131, in __setitem__\n(nova): TRACE:     gflags.FlagValues.__setitem__(self, name, flag)\n(nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 791, in __setitem__\n(nova): TRACE:     raise DuplicateFlagError(name, self)\n(nova): TRACE: DuplicateFlagError: The flag 'vlan_interface' is defined twice. First from nova.network.manager, Second from nova.network.vmwareapi_net\n(nova): TRACE: \n2011-05-24 18:10:38,750 CRITICAL nova [-] The flag 'vlan_interface' is defined twice. First from nova.network.manager, Second from nova.network.vmwareapi_net\n\nIf I comment lines in source file 'nova/network/vmwareapi_net.py', it works correctly:\n    flags.DEFINE_string('vlan_interface', 'vmnic0',\n                         'Physical network adapter name in VMware ESX host for '\n                         'vlan networking')", 
            "date_created": "2011-05-24 16:14:30.804427+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "Might have been fixed with recent rev1105...", 
            "date_created": "2011-05-24 20:59:45.450851+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "I try again with nova-compute rev1108 but the bug persists.", 
            "date_created": "2011-05-25 15:51:23.839413+00:00", 
            "author": "https://api.launchpad.net/1.0/~ethuleau"
        }, 
        {
            "content": "The flag is actually is defined twice.  I'm not sure why it is redefined in vmwareapi_net.py.\n\nI'm not sure if this is a naming conflict or the author was simply trying to change the default value of the flag.  In any case, here is a possible fix:\n\n=== modified file 'nova/network/vmwareapi_net.py'\n--- nova/network/vmwareapi_net.py       2011-05-11 19:24:01 +0000\n+++ nova/network/vmwareapi_net.py       2011-05-25 18:13:39 +0000\n@@ -30,9 +30,7 @@\n \n \n FLAGS = flags.FLAGS\n-flags.DEFINE_string('vlan_interface', 'vmnic0',\n-                    'Physical network adapter name in VMware ESX host for '\n-                    'vlan networking')\n+FLAGS['vlan_interface'].SetDefault('vmnic0')\n \n \n def ensure_vlan_bridge(vlan_num, bridge, net_attrs=None):\n\nVish\n\nOn May 25, 2011, at 8:51 AM, Edouard Thuleau wrote:\n\n> I try again with nova-compute rev1108 but the bug persists.\n> \n> -- \n> You received this bug notification because you are a member of Nova Bug\n> Team, which is subscribed to OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/787657\n> \n> Title:\n>  VMware vlan_interface flag defined txice\n> \n> Status in OpenStack Compute (Nova):\n>  Triaged\n> \n> Bug description:\n>  Hi,\n> \n>  I use Nova (bzr1101) with an ESXi 4.1 hypervisor.\n>  I set the flag 'vlan_interface' inm y configuration file but Nova didn't start and log says :\n> \n> \n>  2011-05-24 18:10:38,728 ERROR nova [-] in Service.create()\n>  (nova): TRACE: Traceback (most recent call last):\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 267, in serve\n>  (nova): TRACE:     services = [Service.create()]\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 164, in create\n>  (nova): TRACE:     report_interval, periodic_interval)\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/service.py\", line 69, in __init__\n>  (nova): TRACE:     self.manager = manager_class(host=self.host, *args, **kwargs)\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 132, in __init__\n>  (nova): TRACE:     self.network_manager = utils.import_object(FLAGS.network_manager)\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 73, in import_object\n>  (nova): TRACE:     return cls()\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/manager.py\", line 123, in __init__\n>  (nova): TRACE:     self.driver = utils.import_object(network_driver)\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 69, in import_object\n>  (nova): TRACE:     __import__(import_str)\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/network/vmwareapi_net.py\", line 34, in <module>\n>  (nova): TRACE:     'Physical network adapter name in VMware ESX host for '\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/flags.py\", line 215, in _wrapped\n>  (nova): TRACE:     func(*args, **kw)\n>  (nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1808, in DEFINE_string\n>  (nova): TRACE:     DEFINE(parser, name, default, help, flag_values, serializer, **args)\n>  (nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1701, in DEFINE\n>  (nova): TRACE:     flag_values)\n>  (nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 1716, in DEFINE_flag\n>  (nova): TRACE:     fv[flag.name] = flag\n>  (nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/flags.py\", line 131, in __setitem__\n>  (nova): TRACE:     gflags.FlagValues.__setitem__(self, name, flag)\n>  (nova): TRACE:   File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 791, in __setitem__\n>  (nova): TRACE:     raise DuplicateFlagError(name, self)\n>  (nova): TRACE: DuplicateFlagError: The flag 'vlan_interface' is defined twice. First from nova.network.manager, Second from nova.network.vmwareapi_net\n>  (nova): TRACE: \n>  2011-05-24 18:10:38,750 CRITICAL nova [-] The flag 'vlan_interface' is defined twice. First from nova.network.manager, Second from nova.network.vmwareapi_net\n> \n>  If I comment lines in source file 'nova/network/vmwareapi_net.py', it works correctly:\n>      flags.DEFINE_string('vlan_interface', 'vmnic0',\n>                           'Physical network adapter name in VMware ESX host for '\n>                           'vlan networking')\n\n", 
            "date_created": "2011-05-25 18:14:57+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "@Thierry: Does this bug needs to be marked as 'Fix Released'?", 
            "date_created": "2011-09-17 11:36:55.380145+00:00", 
            "author": "https://api.launchpad.net/1.0/~sateesh-chodapuneedi"
        }, 
        {
            "content": "It will be marked FixReleased on Diablo release day.", 
            "date_created": "2011-09-19 15:55:13.100035+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ], 
    "closed": "2011-09-22 13:34:34.317093+00:00"
}