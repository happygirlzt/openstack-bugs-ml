{
    "status": "Confirmed", 
    "last_updated": "2016-07-14 10:03:00.263070+00:00", 
    "description": "This bug occurred with versions 2015.1.0 of Nova and Cinder installed.\n\nWhen bulk deleting large numbers of Nova instances, we occasionally encounter something that appears to be a race condition where Cinder believes a volume is detached and available but Nova reports the volume is still attached to an instance.\n\nExample below shows an instance in ERROR state (some output of nova show truncated for brevity) and Cinder showing that the volume Nova thinks is attached is available:\n\n+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                                                                                                                                                |\n+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                                                                                                                                               |\n| OS-EXT-AZ:availability_zone          | ---                                                                                                                                                                                                                              |\n| OS-EXT-SRV-ATTR:host                 | ---                                                                                                                                                                                                                       |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | ---                                                                                                                                                                                                         |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000427f                                                                                                                                                                                                                    |\n| OS-EXT-STS:power_state               | 0                                                                                                                                                                                                                                    |\n| OS-EXT-STS:task_state                | -                                                                                                                                                                                                                                    |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                                                                                                |\n| OS-SRV-USG:launched_at               | 2015-09-22T15:39:06.000000                                                                                                                                                                                                           |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                                                                                                    |\n| accessIPv4                           |                                                                                                                                                                                                                                      |\n| accessIPv6                           |                                                                                                                                                                                                                                      |\n| config_drive                         |                                                                                                                                                                                                                                      |\n| created                              | 2015-09-22T14:04:40Z                                                                                                                                                                                                                 |\n                                                                                                                                                                              |\n| flavor                               | m1.small (2)                                                                                                                                                                                                                         |\n| hostId                               | e2d6789d6505366a3d78097d4c0bf99b8f30dd49b5561b1f94e0cdcb                                                                                                                                                                             |\n| id                                   | 247d9ebe-6794-4119-b677-d990fd6244b1                                                                                                                                                                                                 |\n| image                                | Red Hat Enterprise Linux 7 (current) (297e1979-cfa0-4596-8446-95c29ac640cc)                                                                                                                                                          |\n| key_name                             | ---                                                                                                                                                                                                                         |\n| metadata                             | {}                                                                                                                                                                                                                                   |\n| name                                 | r_img_test_z2_1                                                                                                                                                                                                                      |\n| os-extended-volumes:volumes_attached | [{\"id\": \"7adab934-360f-4cd0-9c98-7d6bea1554b3\"}]                                                                                                                                                                                     |\n| security_groups                      | default                                                                                                                                                                                                                              |\n| status                               | ERROR                                                                                                                                                                                                                                |\n| tenant_id                            | a9421c18f6fc48fea53c5685654f625a                                                                                                                                                                                                     |\n| updated                              | 2015-09-23T13:51:10Z                                                                                                                                                                                                                 |\n| user_id                              | ---                                                                                                                                                                                                                            |\n+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n+--------------------------------------+----------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |            Tenant ID             |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+----------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 7adab934-360f-4cd0-9c98-7d6bea1554b3 | a9421c18f6fc48fea53c5685654f625a | available |    test2     |  20  |     SSD     |  false   |             |\n+--------------------------------------+----------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\nAttempting to delete the instance while in this state results in the following traceback from nova-client:\n\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 343, in decorated_function\n  return function(self, context, *args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2737, in terminate_instance\n  do_terminate_instance(instance, bdms)\nFile \\\"/usr/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\\\", line 445, in inner\n  return f(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2735, in do_terminate_instance\n  self._set_instance_error_state(context, instance)\nFile \\\"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\\\", line 85, in __exit__\n  six.reraise(self.type_, self.value, self.tb)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2725, in do_terminate_instance\n  self._delete_instance(context, instance, bdms, quotas)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/hooks.py\\\", line 149, in inner\n  rv = f(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2694, in _delete_instance\n  quotas.rollback()\nFile \\\"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\\\", line 85, in __exit__\n  six.reraise(self.type_, self.value, self.tb)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2664, in _delete_instance\n  self._shutdown_instance(context, instance, bdms)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2604, in _shutdown_instance\n  self.volume_api.detach(context, bdm.volume_id)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\\\", line 214, in wrapper\n  res = method(self, ctx, volume_id, *args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\\\", line 365, in detach\n  cinderclient(context).volumes.detach(volume_id)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/v2/volumes.py\\\", line 334, in detach\n  return self._action('os-detach', volume)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/v2/volumes.py\\\", line 311, in _action\n  return self.api.client.post(url, body=body)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/client.py\\\", line 91, in post\n  return self._cs_request(url, 'POST', **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/client.py\\\", line 85, in _cs_request\n  return self.request(url, method, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/client.py\\\", line 80, in request\n  return super(SessionClient, self).request(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/keystoneclient/adapter.py\\\", line 200, in request\n  resp = super(LegacyJsonAdapter, self).request(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/keystoneclient/adapter.py\\\", line 89, in request\n  return self.session.request(url, method, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/keystoneclient/utils.py\\\", line 318, in inner\n  return func(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/keystoneclient/session.py\\\", line 389, in request\n  raise exceptions.from_response(resp, method, url)\n\nCinder logs an exception stating that the volume has no attachments:\n\n2015-09-23 09:49:47.923 42963 ERROR cinder.volume.manager [req-4a2f6878-54ec-45a9-abcf-f4439a6c2de8 cloud_ll2 e000f9d1f3bf4f758e1d77c94da61281 - - -] Volume 7adab934-360f-4cd0-9c98-7d6bea1554b3 doesn't have any attachments to detach\n2015-09-23 09:49:47.924 42963 ERROR oslo_messaging.rpc.dispatcher [req-4a2f6878-54ec-45a9-abcf-f4439a6c2de8 cloud_ll2 e000f9d1f3bf4f758e1d77c94da61281 - - -] Exception during message handling: Invalid volume: Volume 7adab934-360f-4cd0-9c98-7d6bea1554b3 doesn't have any attachments to detach\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/osprofiler/profiler.py\", line 105, in wrapper\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/cinder/volume/manager.py\", line 157, in ldo_inner1\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     return ldo_inner2(inst, context, volume_id, attachment_id, **kwargs)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 445, in inner\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/cinder/volume/manager.py\", line 156, in ldo_inner2\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     return f(*_args, **_kwargs)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/cinder/volume/manager.py\", line 882, in detach_volume\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     raise exception.InvalidVolume(reason=msg)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher InvalidVolume: Invalid volume: Volume 7adab934-360f-4cd0-9c98-7d6bea1554b3 doesn't have any attachments to detach\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher\n\nWhile in this state, Nova refuses to take any action on the instance, including force deletion. Removing the volume via cinder delete unsticks things; nova delete will remove the instance once the offending volume has been removed.", 
    "tags": [
        "compute", 
        "volumes"
    ], 
    "importance": "High", 
    "heat": 32, 
    "link": "https://bugs.launchpad.net/nova/+bug/1499012", 
    "owner": "None", 
    "id": 1499012, 
    "index": 1814, 
    "openned": "2015-09-23 17:39:54.265093+00:00", 
    "created": "2015-09-23 17:39:54.265093+00:00", 
    "title": "Nova and Cinder get desynced on volume attachments", 
    "comments": [
        {
            "content": "This bug occurred with versions 2015.1.0 of Nova and Cinder installed.\n\nWhen bulk deleting large numbers of Nova instances, we occasionally encounter something that appears to be a race condition where Cinder believes a volume is detached and available but Nova reports the volume is still attached to an instance.\n\nExample below shows an instance in ERROR state (some output of nova show truncated for brevity) and Cinder showing that the volume Nova thinks is attached is available:\n\n+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                                                                                                                                                |\n+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                                                                                                                                               |\n| OS-EXT-AZ:availability_zone          | ---                                                                                                                                                                                                                              |\n| OS-EXT-SRV-ATTR:host                 | ---                                                                                                                                                                                                                       |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | ---                                                                                                                                                                                                         |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000427f                                                                                                                                                                                                                    |\n| OS-EXT-STS:power_state               | 0                                                                                                                                                                                                                                    |\n| OS-EXT-STS:task_state                | -                                                                                                                                                                                                                                    |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                                                                                                |\n| OS-SRV-USG:launched_at               | 2015-09-22T15:39:06.000000                                                                                                                                                                                                           |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                                                                                                    |\n| accessIPv4                           |                                                                                                                                                                                                                                      |\n| accessIPv6                           |                                                                                                                                                                                                                                      |\n| config_drive                         |                                                                                                                                                                                                                                      |\n| created                              | 2015-09-22T14:04:40Z                                                                                                                                                                                                                 |\n                                                                                                                                                                              |\n| flavor                               | m1.small (2)                                                                                                                                                                                                                         |\n| hostId                               | e2d6789d6505366a3d78097d4c0bf99b8f30dd49b5561b1f94e0cdcb                                                                                                                                                                             |\n| id                                   | 247d9ebe-6794-4119-b677-d990fd6244b1                                                                                                                                                                                                 |\n| image                                | Red Hat Enterprise Linux 7 (current) (297e1979-cfa0-4596-8446-95c29ac640cc)                                                                                                                                                          |\n| key_name                             | ---                                                                                                                                                                                                                         |\n| metadata                             | {}                                                                                                                                                                                                                                   |\n| name                                 | r_img_test_z2_1                                                                                                                                                                                                                      |\n| os-extended-volumes:volumes_attached | [{\"id\": \"7adab934-360f-4cd0-9c98-7d6bea1554b3\"}]                                                                                                                                                                                     |\n| security_groups                      | default                                                                                                                                                                                                                              |\n| status                               | ERROR                                                                                                                                                                                                                                |\n| tenant_id                            | a9421c18f6fc48fea53c5685654f625a                                                                                                                                                                                                     |\n| updated                              | 2015-09-23T13:51:10Z                                                                                                                                                                                                                 |\n| user_id                              | ---                                                                                                                                                                                                                            |\n+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n+--------------------------------------+----------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |            Tenant ID             |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+----------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 7adab934-360f-4cd0-9c98-7d6bea1554b3 | a9421c18f6fc48fea53c5685654f625a | available |    test2     |  20  |     SSD     |  false   |             |\n+--------------------------------------+----------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\nAttempting to delete the instance while in this state results in the following traceback from nova-client:\n\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 343, in decorated_function\n  return function(self, context, *args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2737, in terminate_instance\n  do_terminate_instance(instance, bdms)\nFile \\\"/usr/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\\\", line 445, in inner\n  return f(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2735, in do_terminate_instance\n  self._set_instance_error_state(context, instance)\nFile \\\"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\\\", line 85, in __exit__\n  six.reraise(self.type_, self.value, self.tb)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2725, in do_terminate_instance\n  self._delete_instance(context, instance, bdms, quotas)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/hooks.py\\\", line 149, in inner\n  rv = f(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2694, in _delete_instance\n  quotas.rollback()\nFile \\\"/usr/lib/python2.7/dist-packages/oslo_utils/excutils.py\\\", line 85, in __exit__\n  six.reraise(self.type_, self.value, self.tb)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2664, in _delete_instance\n  self._shutdown_instance(context, instance, bdms)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\\\", line 2604, in _shutdown_instance\n  self.volume_api.detach(context, bdm.volume_id)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\\\", line 214, in wrapper\n  res = method(self, ctx, volume_id, *args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/nova/volume/cinder.py\\\", line 365, in detach\n  cinderclient(context).volumes.detach(volume_id)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/v2/volumes.py\\\", line 334, in detach\n  return self._action('os-detach', volume)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/v2/volumes.py\\\", line 311, in _action\n  return self.api.client.post(url, body=body)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/client.py\\\", line 91, in post\n  return self._cs_request(url, 'POST', **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/client.py\\\", line 85, in _cs_request\n  return self.request(url, method, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/cinderclient/client.py\\\", line 80, in request\n  return super(SessionClient, self).request(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/keystoneclient/adapter.py\\\", line 200, in request\n  resp = super(LegacyJsonAdapter, self).request(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/keystoneclient/adapter.py\\\", line 89, in request\n  return self.session.request(url, method, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/keystoneclient/utils.py\\\", line 318, in inner\n  return func(*args, **kwargs)\nFile \\\"/usr/lib/python2.7/dist-packages/keystoneclient/session.py\\\", line 389, in request\n  raise exceptions.from_response(resp, method, url)\n\nCinder logs an exception stating that the volume has no attachments:\n\n2015-09-23 09:49:47.923 42963 ERROR cinder.volume.manager [req-4a2f6878-54ec-45a9-abcf-f4439a6c2de8 cloud_ll2 e000f9d1f3bf4f758e1d77c94da61281 - - -] Volume 7adab934-360f-4cd0-9c98-7d6bea1554b3 doesn't have any attachments to detach\n2015-09-23 09:49:47.924 42963 ERROR oslo_messaging.rpc.dispatcher [req-4a2f6878-54ec-45a9-abcf-f4439a6c2de8 cloud_ll2 e000f9d1f3bf4f758e1d77c94da61281 - - -] Exception during message handling: Invalid volume: Volume 7adab934-360f-4cd0-9c98-7d6bea1554b3 doesn't have any attachments to detach\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/osprofiler/profiler.py\", line 105, in wrapper\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/cinder/volume/manager.py\", line 157, in ldo_inner1\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     return ldo_inner2(inst, context, volume_id, attachment_id, **kwargs)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 445, in inner\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/cinder/volume/manager.py\", line 156, in ldo_inner2\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     return f(*_args, **_kwargs)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/dist-packages/cinder/volume/manager.py\", line 882, in detach_volume\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher     raise exception.InvalidVolume(reason=msg)\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher InvalidVolume: Invalid volume: Volume 7adab934-360f-4cd0-9c98-7d6bea1554b3 doesn't have any attachments to detach\n2015-09-23 09:49:47.924 42963 TRACE oslo_messaging.rpc.dispatcher\n\nWhile in this state, Nova refuses to take any action on the instance, including force deletion. Removing the volume via cinder delete unsticks things; nova delete will remove the instance once the offending volume has been removed.", 
            "date_created": "2015-09-23 17:39:54.265093+00:00", 
            "author": "https://api.launchpad.net/1.0/~erhudy"
        }, 
        {
            "content": "Yes, there is a race in this code path. Nikola had expressed an interest in removing the volume state checks in Nova (i.e. check_attach, check_attached, check_detached) which would help eliminate this race. We'll also need some \"try:\" blocks in the Nova detach_volume code, and there is work in Cinder to use compare-and-swap on DB transactions to close the race on the Cinder side. There's work planned in the longer time frame for changes to Cinder API and how Nova consumes it that should help as well.", 
            "date_created": "2015-11-06 17:34:54.180281+00:00", 
            "author": "https://api.launchpad.net/1.0/~scott-dangelo"
        }, 
        {
            "content": "Hopefully this will get resolved as part of the current Cinder<->Nova API rework.\n\nAs an aside, it would be nice to more information about the logs that cause the instance to go into the Error state, and info on if the volume is actually attached to the VM, or its just that Nova is out of sync with reality, etc.", 
            "date_created": "2016-07-14 10:02:59.535375+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }
    ]
}