{
    "status": "Incomplete", 
    "last_updated": "2017-09-06 08:27:40.528518+00:00", 
    "description": "Here is an example of a job at http://logs.openstack.org/58/487458/6/check/gate-grenade-dsvm-ironic-ubuntu-xenial/d8f187e/console.html#_2017-07-28_09_33_52_031224\n\n2017-07-28 09:33:52.027473 | Captured pythonlogging:\n2017-07-28 09:33:52.027484 | ~~~~~~~~~~~~~~~~~~~~~~~\n2017-07-28 09:33:52.027539 |     2017-07-28 09:15:48,746 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:test_create_port_in_allowed_allocation_pools): 201 POST http://149.202.183.40:9696/v2.0/networks 0.342s\n2017-07-28 09:33:52.027604 |     2017-07-28 09:15:48,746 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.027633 |             Body: {\"network\": {\"name\": \"tempest-PortsTestJSON-test-network-1596805013\"}}\n2017-07-28 09:33:52.027728 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:15:48 GMT', u'x-openstack-request-id': 'req-0502025a-db49-4f1f-b30d-c38b8098b79e', u'content-type': 'application/json', u'content-length': '582', 'content-location': 'http://149.202.183.40:9696/v2.0/networks', 'status': '201', u'connection': 'close'}\n2017-07-28 09:33:52.027880 |             Body: {\"network\":{\"status\":\"ACTIVE\",\"router:external\":false,\"availability_zone_hints\":[],\"availability_zones\":[],\"description\":\"\",\"subnets\":[],\"shared\":false,\"tenant_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"created_at\":\"2017-07-28T09:15:48Z\",\"tags\":[],\"ipv6_address_scope\":null,\"mtu\":1450,\"updated_at\":\"2017-07-28T09:15:48Z\",\"admin_state_up\":true,\"revision_number\":2,\"ipv4_address_scope\":null,\"is_default\":false,\"port_security_enabled\":true,\"project_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"id\":\"b8a3fb1c-86a4-4518-8c3a-dd12db585659\",\"name\":\"tempest-PortsTestJSON-test-network-1596805013\"}}\n2017-07-28 09:33:52.027936 |     2017-07-28 09:15:49,430 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:test_create_port_in_allowed_allocation_pools): 201 POST http://149.202.183.40:9696/v2.0/subnets 0.682s\n2017-07-28 09:33:52.027998 |     2017-07-28 09:15:49,431 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.028054 |             Body: {\"subnet\": {\"ip_version\": 4, \"allocation_pools\": [{\"end\": \"10.1.0.14\", \"start\": \"10.1.0.2\"}], \"network_id\": \"b8a3fb1c-86a4-4518-8c3a-dd12db585659\", \"gateway_ip\": \"10.1.0.1\", \"cidr\": \"10.1.0.0/28\"}}\n2017-07-28 09:33:52.028135 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:15:49 GMT', u'x-openstack-request-id': 'req-1a50b739-8683-4aaa-ba4a-6e9daf73f1c8', u'content-type': 'application/json', u'content-length': '594', 'content-location': 'http://149.202.183.40:9696/v2.0/subnets', 'status': '201', u'connection': 'close'}\n2017-07-28 09:33:52.030085 |             Body: {\"subnet\":{\"service_types\":[],\"description\":\"\",\"enable_dhcp\":true,\"tags\":[],\"network_id\":\"b8a3fb1c-86a4-4518-8c3a-dd12db585659\",\"tenant_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"created_at\":\"2017-07-28T09:15:49Z\",\"dns_nameservers\":[],\"updated_at\":\"2017-07-28T09:15:49Z\",\"gateway_ip\":\"10.1.0.1\",\"ipv6_ra_mode\":null,\"allocation_pools\":[{\"start\":\"10.1.0.2\",\"end\":\"10.1.0.14\"}],\"host_routes\":[],\"revision_number\":0,\"ip_version\":4,\"ipv6_address_mode\":null,\"cidr\":\"10.1.0.0/28\",\"project_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"id\":\"be974b50-e56b-44a8-86a9-6bcc345f9d55\",\"subnetpool_id\":null,\"name\":\"\"}}\n2017-07-28 09:33:52.030176 |     2017-07-28 09:15:50,616 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:test_create_port_in_allowed_allocation_pools): 201 POST http://149.202.183.40:9696/v2.0/ports 1.185s\n2017-07-28 09:33:52.030232 |     2017-07-28 09:15:50,617 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.030259 |             Body: {\"port\": {\"network_id\": \"b8a3fb1c-86a4-4518-8c3a-dd12db585659\"}}\n2017-07-28 09:33:52.030369 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:15:50 GMT', u'x-openstack-request-id': 'req-6b57ff81-c874-4e97-8183-bd57c7e8de81', u'content-type': 'application/json', u'content-length': '691', 'content-location': 'http://149.202.183.40:9696/v2.0/ports', 'status': '201', u'connection': 'close'}\n2017-07-28 09:33:52.030596 |             Body: {\"port\":{\"status\":\"DOWN\",\"created_at\":\"2017-07-28T09:15:49Z\",\"description\":\"\",\"allowed_address_pairs\":[],\"tags\":[],\"network_id\":\"b8a3fb1c-86a4-4518-8c3a-dd12db585659\",\"tenant_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"extra_dhcp_opts\":[],\"admin_state_up\":true,\"updated_at\":\"2017-07-28T09:15:50Z\",\"name\":\"\",\"device_owner\":\"\",\"revision_number\":3,\"mac_address\":\"fa:16:3e:a4:39:53\",\"binding:vnic_type\":\"normal\",\"port_security_enabled\":true,\"project_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"fixed_ips\":[{\"subnet_id\":\"be974b50-e56b-44a8-86a9-6bcc345f9d55\",\"ip_address\":\"10.1.0.4\"}],\"id\":\"a873e67a-a171-4860-9f47-be50dc061b10\",\"security_groups\":[\"107c3ae4-4c9f-4851-935f-5602c35270dc\"],\"device_id\":\"\"}}\n2017-07-28 09:33:52.030660 |     2017-07-28 09:15:51,354 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:_run_cleanups): 204 DELETE http://149.202.183.40:9696/v2.0/ports/a873e67a-a171-4860-9f47-be50dc061b10 0.735s\n2017-07-28 09:33:52.030736 |     2017-07-28 09:15:51,354 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.030747 |             Body: None\n2017-07-28 09:33:52.030824 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:15:51 GMT', u'x-openstack-request-id': 'req-018a5b4a-cb5e-4dc1-b807-e3223b1fc83a', u'content-length': '0', 'content-location': 'http://149.202.183.40:9696/v2.0/ports/a873e67a-a171-4860-9f47-be50dc061b10', 'status': '204', u'connection': 'close'}\n2017-07-28 09:33:52.030835 |             Body: \n2017-07-28 09:33:52.030918 |     2017-07-28 09:16:51,390 9778 WARNING  [urllib3.connectionpool] Retrying (Retry(total=9, connect=None, read=None, redirect=5, status=None)) after connection broken by 'ReadTimeoutError(\"HTTPConnectionPool(host='149.202.183.40', port=9696): Read timed out. (read timeout=60)\",)': /v2.0/subnets/be974b50-e56b-44a8-86a9-6bcc345f9d55\n2017-07-28 09:33:52.030974 |     2017-07-28 09:16:51,508 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:_run_cleanups): 404 DELETE http://149.202.183.40:9696/v2.0/subnets/be974b50-e56b-44a8-86a9-6bcc345f9d55 60.153s\n2017-07-28 09:33:52.031023 |     2017-07-28 09:16:51,508 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.031047 |             Body: None\n2017-07-28 09:33:52.031161 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:16:51 GMT', u'x-openstack-request-id': 'req-86d01b29-c1b1-4396-a0a8-c360c78dcbd5', u'content-type': 'application/json', u'content-length': '136', 'content-location': 'http://149.202.183.40:9696/v2.0/subnets/be974b50-e56b-44a8-86a9-6bcc345f9d55', 'status': '404', u'connection': 'close'}\n2017-07-28 09:33:52.031224 |             Body: {\"NeutronError\": {\"message\": \"Subnet be974b50-e56b-44a8-86a9-6bcc345f9d55 could not be found.\", \"type\": \"SubnetNotFound\", \"detail\": \"\"}}\n\n\nSeems like there is some kind of race here, this failure should not be related to ironic.", 
    "tags": [
        "gate-failure", 
        "tempest"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1707160", 
    "owner": "None", 
    "id": 1707160, 
    "index": 4879, 
    "openned": "2017-08-02 18:49:51.649953+00:00", 
    "created": "2017-07-28 10:02:43.608114+00:00", 
    "title": "test_create_port_in_allowed_allocation_pools test fails on ironic grenade", 
    "comments": [
        {
            "content": "Here is an example of a job at http://logs.openstack.org/58/487458/6/check/gate-grenade-dsvm-ironic-ubuntu-xenial/d8f187e/console.html#_2017-07-28_09_33_52_031224\n\n2017-07-28 09:33:52.027473 | Captured pythonlogging:\n2017-07-28 09:33:52.027484 | ~~~~~~~~~~~~~~~~~~~~~~~\n2017-07-28 09:33:52.027539 |     2017-07-28 09:15:48,746 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:test_create_port_in_allowed_allocation_pools): 201 POST http://149.202.183.40:9696/v2.0/networks 0.342s\n2017-07-28 09:33:52.027604 |     2017-07-28 09:15:48,746 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.027633 |             Body: {\"network\": {\"name\": \"tempest-PortsTestJSON-test-network-1596805013\"}}\n2017-07-28 09:33:52.027728 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:15:48 GMT', u'x-openstack-request-id': 'req-0502025a-db49-4f1f-b30d-c38b8098b79e', u'content-type': 'application/json', u'content-length': '582', 'content-location': 'http://149.202.183.40:9696/v2.0/networks', 'status': '201', u'connection': 'close'}\n2017-07-28 09:33:52.027880 |             Body: {\"network\":{\"status\":\"ACTIVE\",\"router:external\":false,\"availability_zone_hints\":[],\"availability_zones\":[],\"description\":\"\",\"subnets\":[],\"shared\":false,\"tenant_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"created_at\":\"2017-07-28T09:15:48Z\",\"tags\":[],\"ipv6_address_scope\":null,\"mtu\":1450,\"updated_at\":\"2017-07-28T09:15:48Z\",\"admin_state_up\":true,\"revision_number\":2,\"ipv4_address_scope\":null,\"is_default\":false,\"port_security_enabled\":true,\"project_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"id\":\"b8a3fb1c-86a4-4518-8c3a-dd12db585659\",\"name\":\"tempest-PortsTestJSON-test-network-1596805013\"}}\n2017-07-28 09:33:52.027936 |     2017-07-28 09:15:49,430 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:test_create_port_in_allowed_allocation_pools): 201 POST http://149.202.183.40:9696/v2.0/subnets 0.682s\n2017-07-28 09:33:52.027998 |     2017-07-28 09:15:49,431 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.028054 |             Body: {\"subnet\": {\"ip_version\": 4, \"allocation_pools\": [{\"end\": \"10.1.0.14\", \"start\": \"10.1.0.2\"}], \"network_id\": \"b8a3fb1c-86a4-4518-8c3a-dd12db585659\", \"gateway_ip\": \"10.1.0.1\", \"cidr\": \"10.1.0.0/28\"}}\n2017-07-28 09:33:52.028135 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:15:49 GMT', u'x-openstack-request-id': 'req-1a50b739-8683-4aaa-ba4a-6e9daf73f1c8', u'content-type': 'application/json', u'content-length': '594', 'content-location': 'http://149.202.183.40:9696/v2.0/subnets', 'status': '201', u'connection': 'close'}\n2017-07-28 09:33:52.030085 |             Body: {\"subnet\":{\"service_types\":[],\"description\":\"\",\"enable_dhcp\":true,\"tags\":[],\"network_id\":\"b8a3fb1c-86a4-4518-8c3a-dd12db585659\",\"tenant_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"created_at\":\"2017-07-28T09:15:49Z\",\"dns_nameservers\":[],\"updated_at\":\"2017-07-28T09:15:49Z\",\"gateway_ip\":\"10.1.0.1\",\"ipv6_ra_mode\":null,\"allocation_pools\":[{\"start\":\"10.1.0.2\",\"end\":\"10.1.0.14\"}],\"host_routes\":[],\"revision_number\":0,\"ip_version\":4,\"ipv6_address_mode\":null,\"cidr\":\"10.1.0.0/28\",\"project_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"id\":\"be974b50-e56b-44a8-86a9-6bcc345f9d55\",\"subnetpool_id\":null,\"name\":\"\"}}\n2017-07-28 09:33:52.030176 |     2017-07-28 09:15:50,616 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:test_create_port_in_allowed_allocation_pools): 201 POST http://149.202.183.40:9696/v2.0/ports 1.185s\n2017-07-28 09:33:52.030232 |     2017-07-28 09:15:50,617 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.030259 |             Body: {\"port\": {\"network_id\": \"b8a3fb1c-86a4-4518-8c3a-dd12db585659\"}}\n2017-07-28 09:33:52.030369 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:15:50 GMT', u'x-openstack-request-id': 'req-6b57ff81-c874-4e97-8183-bd57c7e8de81', u'content-type': 'application/json', u'content-length': '691', 'content-location': 'http://149.202.183.40:9696/v2.0/ports', 'status': '201', u'connection': 'close'}\n2017-07-28 09:33:52.030596 |             Body: {\"port\":{\"status\":\"DOWN\",\"created_at\":\"2017-07-28T09:15:49Z\",\"description\":\"\",\"allowed_address_pairs\":[],\"tags\":[],\"network_id\":\"b8a3fb1c-86a4-4518-8c3a-dd12db585659\",\"tenant_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"extra_dhcp_opts\":[],\"admin_state_up\":true,\"updated_at\":\"2017-07-28T09:15:50Z\",\"name\":\"\",\"device_owner\":\"\",\"revision_number\":3,\"mac_address\":\"fa:16:3e:a4:39:53\",\"binding:vnic_type\":\"normal\",\"port_security_enabled\":true,\"project_id\":\"5c851bb85bef4b008714ef04d1fe3671\",\"fixed_ips\":[{\"subnet_id\":\"be974b50-e56b-44a8-86a9-6bcc345f9d55\",\"ip_address\":\"10.1.0.4\"}],\"id\":\"a873e67a-a171-4860-9f47-be50dc061b10\",\"security_groups\":[\"107c3ae4-4c9f-4851-935f-5602c35270dc\"],\"device_id\":\"\"}}\n2017-07-28 09:33:52.030660 |     2017-07-28 09:15:51,354 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:_run_cleanups): 204 DELETE http://149.202.183.40:9696/v2.0/ports/a873e67a-a171-4860-9f47-be50dc061b10 0.735s\n2017-07-28 09:33:52.030736 |     2017-07-28 09:15:51,354 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.030747 |             Body: None\n2017-07-28 09:33:52.030824 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:15:51 GMT', u'x-openstack-request-id': 'req-018a5b4a-cb5e-4dc1-b807-e3223b1fc83a', u'content-length': '0', 'content-location': 'http://149.202.183.40:9696/v2.0/ports/a873e67a-a171-4860-9f47-be50dc061b10', 'status': '204', u'connection': 'close'}\n2017-07-28 09:33:52.030835 |             Body: \n2017-07-28 09:33:52.030918 |     2017-07-28 09:16:51,390 9778 WARNING  [urllib3.connectionpool] Retrying (Retry(total=9, connect=None, read=None, redirect=5, status=None)) after connection broken by 'ReadTimeoutError(\"HTTPConnectionPool(host='149.202.183.40', port=9696): Read timed out. (read timeout=60)\",)': /v2.0/subnets/be974b50-e56b-44a8-86a9-6bcc345f9d55\n2017-07-28 09:33:52.030974 |     2017-07-28 09:16:51,508 9778 INFO     [tempest.lib.common.rest_client] Request (PortsTestJSON:_run_cleanups): 404 DELETE http://149.202.183.40:9696/v2.0/subnets/be974b50-e56b-44a8-86a9-6bcc345f9d55 60.153s\n2017-07-28 09:33:52.031023 |     2017-07-28 09:16:51,508 9778 DEBUG    [tempest.lib.common.rest_client] Request - Headers: {'X-Auth-Token': '<omitted>', 'Accept': 'application/json', 'Content-Type': 'application/json'}\n2017-07-28 09:33:52.031047 |             Body: None\n2017-07-28 09:33:52.031161 |         Response - Headers: {u'date': 'Fri, 28 Jul 2017 09:16:51 GMT', u'x-openstack-request-id': 'req-86d01b29-c1b1-4396-a0a8-c360c78dcbd5', u'content-type': 'application/json', u'content-length': '136', 'content-location': 'http://149.202.183.40:9696/v2.0/subnets/be974b50-e56b-44a8-86a9-6bcc345f9d55', 'status': '404', u'connection': 'close'}\n2017-07-28 09:33:52.031224 |             Body: {\"NeutronError\": {\"message\": \"Subnet be974b50-e56b-44a8-86a9-6bcc345f9d55 could not be found.\", \"type\": \"SubnetNotFound\", \"detail\": \"\"}}\n\n\nSeems like there is some kind of race here, this failure should not be related to ironic.", 
            "date_created": "2017-07-28 10:02:43.608114+00:00", 
            "author": "https://api.launchpad.net/1.0/~vdrok"
        }, 
        {
            "content": "I see http://logs.openstack.org/58/487458/6/check/gate-grenade-dsvm-ironic-ubuntu-xenial/d8f187e/logs/new/screen-q-svc.txt.gz#_2017-07-28_09_15_51_588 happening before the DELETE subnet API request.", 
            "date_created": "2017-07-28 10:09:15.784582+00:00", 
            "author": "https://api.launchpad.net/1.0/~vdrok"
        }, 
        {
            "content": "I also see that after reconnection deletion seems to pass:\n\nhttp://logs.openstack.org/58/487458/6/check/gate-grenade-dsvm-ironic-ubuntu-xenial/d8f187e/logs/new/screen-q-svc.txt.gz#_2017-07-28_09_17_28_452\n\nhttp://logs.openstack.org/58/487458/6/check/gate-grenade-dsvm-ironic-ubuntu-xenial/d8f187e/logs/new/screen-q-svc.txt.gz#_2017-07-28_09_17_28_457", 
            "date_created": "2017-07-28 10:20:57.553283+00:00", 
            "author": "https://api.launchpad.net/1.0/~vdrok"
        }, 
        {
            "content": "That's a pretty precise troubleshooting,\n\nneutron-client calls delete subnet but neutron is slow for some reason (maybe rabbit issue where neutron-server notifies dhcp agent to delete port and namespace) and the operation takes 97 seconds to delete the subnet. Client times out and tries to delete it again, but the first call eventually is completed. The next call fails cause subnet was deleted in previous call.", 
            "date_created": "2017-07-28 10:42:03.380394+00:00", 
            "author": "https://api.launchpad.net/1.0/~libosvar"
        }, 
        {
            "content": "We landed a fix for https://bugs.launchpad.net/neutron/+bug/1705351 and think it's related and should help here. Could you please check if you still have the problem?", 
            "date_created": "2017-08-01 16:52:16.151269+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "Hi Ihar, do you mean the ignoring exception patch? If so, it does help in not raising exception further up, but here we just see some super-slowness from neutron or rabbit, which might be related. This log is what we see after that fix merged. Sometimes we see this not found exception for subnet, sometimes for router, sometimes for router interface, on random api tests as it seems to me.", 
            "date_created": "2017-08-01 17:09:28.301426+00:00", 
            "author": "https://api.launchpad.net/1.0/~vdrok"
        }, 
        {
            "content": "FYI the neutron fix in question that should have fixed this was: https://review.openstack.org/#/c/485365/", 
            "date_created": "2017-08-01 17:10:18.601775+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "And now I also see this stuff on grenade -- http://logs.openstack.org/42/358142/35/check/gate-grenade-dsvm-ironic-ubuntu-xenial/2e6b101/logs/new/screen-q-svc.txt.gz#_2017-08-01_17_07_08_874\n\nI'm not even sure if it's a separate thing or the root of all of these is the same.", 
            "date_created": "2017-08-01 17:33:50.946434+00:00", 
            "author": "https://api.launchpad.net/1.0/~vdrok"
        }, 
        {
            "content": "I think the security groups NotFound error is the result of https://review.openstack.org/#/c/410422/ landed. A possible fix is: https://review.openstack.org/486687", 
            "date_created": "2017-08-01 18:13:18.358794+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/489697", 
            "date_created": "2017-08-01 18:17:25.470034+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Testing two options: revert for security group push notifications patch; and a patch to catch all NotFound for all RPC endpoints; using those two Depends-On patches for ironic:\n\nhttps://review.openstack.org/489699\nhttps://review.openstack.org/489701", 
            "date_created": "2017-08-01 18:21:42.421866+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "FYI: Even though https://review.openstack.org/#/c/486687/ (Catch exceptions for all rpc casts) merged it has not resolved the Ironic gate errors we are seeing.\n\nThe test of the revert has passed twice, I am doing another recheck now.\nhttps://review.openstack.org/#/c/489699/", 
            "date_created": "2017-08-02 15:58:29.491048+00:00", 
            "author": "https://api.launchpad.net/1.0/~happycamp"
        }, 
        {
            "content": "Change abandoned by Ihar Hrachyshka (<email address hidden>) on branch: master\nReview: https://review.openstack.org/489697", 
            "date_created": "2017-08-02 18:27:43.317472+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "The latest recheck on the revert patch suggests that it doesn't help either.", 
            "date_created": "2017-08-02 18:31:05.904403+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "In the last failure, it's not neutron API but nova API that times out:\n\nhttp://logs.openstack.org/99/489699/1/check/gate-grenade-dsvm-ironic-ubuntu-xenial/2e8b6fa/logs/testr_results.html.gz\n\nThe relevant log messages for the Nova API request start at:\n\nhttp://logs.openstack.org/99/489699/1/check/gate-grenade-dsvm-ironic-ubuntu-xenial/2e8b6fa/logs/new/screen-n-api.txt.gz#_2017-08-02_17_40_21_213\n\n2017-08-02 17:40:21.149 30615 DEBUG nova.osapi_compute.wsgi.server [req-84752f96-9ca4-43dd-86ed-64620eb7d8ca - -] (30615) accepted ('10.0.1.169', 52578) server /usr/local/lib/python2.7/dist-packages/eventlet/wsgi.py:883\n2017-08-02 17:40:21.213 30615 DEBUG nova.api.openstack.wsgi [req-04a0710f-c696-415e-a2a7-1381bf0174b1 tempest-TestServerBasicOps-512068857 tempest-TestServerBasicOps-512068857] Action: 'create', calling method: <function version_select at 0x7f90a183bc08>, body: {\"security_group\": {\"name\": \"tempest-TestServerBasicOps-722492525\", \"description\": \"tempest-TestServerBasicOps-722492525 description\"}} _process_stack /opt/stack/new/nova/nova/api/openstack/wsgi.py:609\n2017-08-02 17:40:21.619 30615 INFO nova.osapi_compute.wsgi.server [req-04a0710f-c696-415e-a2a7-1381bf0174b1 tempest-TestServerBasicOps-512068857 tempest-TestServerBasicOps-512068857] 10.0.1.169 \"POST /v2.1/os-security-groups HTTP/1.1\" status: 200 len: 637 time: 0.4696331\n2017-08-02 17:40:21.623 30615 DEBUG nova.osapi_compute.wsgi.server [req-84752f96-9ca4-43dd-86ed-64620eb7d8ca - -] (30615) accepted ('10.0.1.169', 52582) server /usr/local/lib/python2.7/dist-packages/eventlet/wsgi.py:883\n2017-08-02 17:40:21.651 30615 DEBUG nova.api.openstack.wsgi [req-983ceec8-1c1e-4d6e-b560-9f4aa358bf6a tempest-TestServerBasicOps-512068857 tempest-TestServerBasicOps-512068857] Action: 'create', calling method: <function version_select at 0x7f90a183b140>, body: {\"security_group_rule\": {\"from_port\": 22, \"to_port\": 22, \"ip_protocol\": \"tcp\", \"cidr\": \"0.0.0.0/0\", \"parent_group_id\": \"1da383d4-6d09-451b-8e87-1d708803ae02\"}} _process_stack /opt/stack/new/nova/nova/api/openstack/wsgi.py:609\n\nThere seems to be no completion for the request.", 
            "date_created": "2017-08-02 18:49:44.151920+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "I marked the bug as fixed for neutron; if you still experience problems with Neutron though, feel free to reopen (a ping in IRC would also help to get my attention).", 
            "date_created": "2017-08-02 18:54:53.695095+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "OK, I still see this failing on a neutron api request here: http://logs.openstack.org/01/489701/1/check/gate-grenade-dsvm-ironic-ubuntu-xenial/50785e5/logs/testr_results.html.gz\n\nIn neutron-server log, we see first NotFound ERROR message from the missing fanout exchange (that's not an issue per se, and I sent a patch to downgrade the message to DEBUG [1]); then the request handler attempts to fanout another event to agents; then request is locked for ~115 seconds to end with:\n\n2017-08-01 22:50:59.696 1787 ERROR oslo.messaging._drivers.impl_rabbit [req-765ebd21-ee44-4db2-85f8-f6b7e52cdf19 tempest-RoutersTest-175057974 tempest-RoutersTest-175057974] [fdb10a5b-b3c8-436c-ba74-193c721329bb] AMQP server on 104.130.216.130:5672 is unreachable: timed out. Trying again in 1 seconds. Client port: None: timeout: timed out\n2017-08-01 22:51:00.715 1787 INFO oslo.messaging._drivers.impl_rabbit [req-765ebd21-ee44-4db2-85f8-f6b7e52cdf19 tempest-RoutersTest-175057974 tempest-RoutersTest-175057974] [fdb10a5b-b3c8-436c-ba74-193c721329bb] Reconnected to AMQP server on 104.130.216.130:5672 via [amqp] client with port 51878.\n\nWhen we look at rabbitmq logs around the time of failure we see:\n\n=ERROR REPORT==== 1-Aug-2017::22:49:05 ===\nChannel error on connection <0.3221.0> (104.130.216.130:43578 -> 104.130.216.130:5672, vhost: '/', user: 'stackrabbit'), channel 1:\n{amqp_error,not_found,\n            \"no exchange 'q-agent-notifier-port-delete_fanout' in vhost '/'\",\n            'basic.publish'}\n\n=WARNING REPORT==== 1-Aug-2017::22:50:59 ===\nclosing AMQP connection <0.3221.0> (104.130.216.130:43578 -> 104.130.216.130:5672):\nconnection_closed_abruptly\n\nI suspect that after NotFound is raised, oslo.messaging channels get into a state that doesn't allow to send any more messages, and only connection reset restores connectivity.\n\n[1] https://review.openstack.org/#/c/490139/", 
            "date_created": "2017-08-02 19:17:23.614981+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "The issue is extensively being discussed in #openstack-oslo; logs: http://eavesdrop.openstack.org/irclogs/%23openstack-oslo/%23openstack-oslo.2017-08-02.log.html#t2017-08-02T19:18:05\n\nCurrent thinking is that we hit a race between\n\n1) rabbitmq cleaning up the topic after rabbit_transient_queues_ttl [30 mins] since the last usage by a neutron agent (new agent doesn't use it anymore) and\n2) oslo.messaging sending a fanout to a topic.\n\nIn regular setup, a fanout to a non-existent topic results in its creation; but if it is pulled from under fanout attempt in the middle of it, then we may hit the issue.\n\nA possible solution would be then to catch the error, do any necessary cleanup for connection channel, and repeat the attempt, now first creating the topic.", 
            "date_created": "2017-08-02 21:02:05.707859+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "Looks like the bug is not related to Nova but rather oslo.messaging to me when looking at the logs and the above discussion. \n\nAny reason why we don't push that bug to Oslo component ? ", 
            "date_created": "2017-08-03 09:20:56.424284+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "It is not clear this is really a Nova bug, putting into incomplete. It's definitely not critical in Nova unless it's confirmed that it's something we need to handle.", 
            "date_created": "2017-08-03 14:32:09.731408+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "For Neutron, a workaround was committed as: https://review.openstack.org/#/c/490305/", 
            "date_created": "2017-08-07 16:04:10.613038+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "Adding oslo to the list of affected projects. The fix is here: https://review.openstack.org/#/c/486706/", 
            "date_created": "2017-08-07 16:07:17.748699+00:00", 
            "author": "https://api.launchpad.net/1.0/~ihar-hrachyshka"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/486706\nCommitted: https://git.openstack.org/cgit/openstack/oslo.messaging/commit/?id=f059bba6ae9642675bc1c9004a4a4adc5d1b19a6\nSubmitter: Jenkins\nBranch:    master\n\ncommit f059bba6ae9642675bc1c9004a4a4adc5d1b19a6\nAuthor: Kenneth Giusti <email address hidden>\nDate:   Mon Jul 24 13:36:17 2017 -0400\n\n    Prevent rabbit from raising unexpected exceptions\n    \n    Publishing a message using the kombu connection autoretry method may\n    allow exceptions from the py-amqp library to be raised up to the\n    application. This does not conform to the documented oslo.messaging\n    API.\n    \n    Enhance the try except block to capture any exception and translate it\n    into a MessageDeliveryFailure.\n    \n    There are a few cases where exceptions will be raised during autoretry\n    publishing: recoverable connection or channel errors, and\n    non-recoverable connection or channel errors.\n    \n    autoretry will only retry if the error is recoverable. Non recoverable\n    errors are re-raised immediately regardless of the retry count.\n    \n    In the case of a recoverable error it seems unlikely that retrying\n    either the connection or the channel yet again is going to get us\n    anywhere, so in this case we simply clean up the channel state, log an\n    error and fail the operation.\n    \n    In the case of non-recoverable error we are out of luck (think\n    authentication failure) - further retrying will not help.  Best we can\n    do is clean up state and log the heck out of it.\n    \n    Change-Id: I2f65d2ee19a8c3e9a323b30404abbf0cbb45a216\n    Closes-Bug: #1705351\n    Closes-Bug: #1707160\n", 
            "date_created": "2017-08-22 16:44:38.731771+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/oslo.messaging 5.31.0 release.", 
            "date_created": "2017-09-06 08:27:39.725203+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}