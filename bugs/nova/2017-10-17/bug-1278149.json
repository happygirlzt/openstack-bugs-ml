{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:04:22.652128+00:00", 
    "description": "Minesweeper CI is seeing the following Tempest suites fail due to errors during performing rescue operations. \n\ntempest.api.compute.servers.test_server_rescue.ServerRescueTestJSON\ntempest.api.compute.v3.servers.test_server_rescue.ServerRescueTestXML\ntempest.api.compute.v3.servers.test_server_rescue.ServerRescueV3Test\n\nError message seen in the nova cpu log is:\n\nTraceback (most recent call last):\n  File \"/opt/stack/oslo.messaging/oslo/messaging/_executors/base.py\", line 36, in _dispatch\n    incoming.reply(self.callback(incoming.ctxt, incoming.message))\n  File \"/opt/stack/oslo.messaging/oslo/messaging/rpc/dispatcher.py\", line 134, in __call__\n    return self._dispatch(endpoint, method, ctxt, args)\n  File \"/opt/stack/oslo.messaging/oslo/messaging/rpc/dispatcher.py\", line 104, in _dispatch\n    result = getattr(endpoint, method)(ctxt, **new_args)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 356, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    payload)\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 240, in decorated_function\n    pass\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 226, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 291, in decorated_function\n    function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2731, in rescue_instance\n    reason=_(\"Driver Error: %s\") % unicode(e))\nInstanceNotRescuable: Instance 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0 cannot be rescued: Driver Error: can't set attribute\n\nFull logs for a run that saw this error is available here: http://208.91.1.172//logs/nova/72125/1/", 
    "tags": [
        "minesweeper", 
        "vmware"
    ], 
    "importance": "Critical", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1278149", 
    "owner": "https://api.launchpad.net/1.0/~garyk", 
    "id": 1278149, 
    "index": 176, 
    "openned": "2014-02-09 18:36:42.183543+00:00", 
    "created": "2014-02-09 18:36:42.183543+00:00", 
    "title": "VMware: InstanceNotRescuable hit during rescue tempest tests", 
    "comments": [
        {
            "content": "Minesweeper CI is seeing 3 Tempest failures due to errors during performing rescue operations. Message seen is:\n\nTraceback (most recent call last):\n  File \"/opt/stack/oslo.messaging/oslo/messaging/_executors/base.py\", line 36, in _dispatch\n    incoming.reply(self.callback(incoming.ctxt, incoming.message))\n  File \"/opt/stack/oslo.messaging/oslo/messaging/rpc/dispatcher.py\", line 134, in __call__\n    return self._dispatch(endpoint, method, ctxt, args)\n  File \"/opt/stack/oslo.messaging/oslo/messaging/rpc/dispatcher.py\", line 104, in _dispatch\n    result = getattr(endpoint, method)(ctxt, **new_args)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 356, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    payload)\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 240, in decorated_function\n    pass\n  File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 68, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 226, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 291, in decorated_function\n    function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2731, in rescue_instance\n    reason=_(\"Driver Error: %s\") % unicode(e))\nInstanceNotRescuable: Instance 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0 cannot be rescued: Driver Error: can't set attribute\n\nFull logs for a run that saw this error is available here: http://208.91.1.172//logs/nova/72125/1/", 
            "date_created": "2014-02-09 18:36:42.183543+00:00", 
            "author": "https://api.launchpad.net/1.0/~rhsu"
        }, 
        {
            "content": "What's interesting is something is causing the InstanceNotRescuable fault to mask the deeper fault in vmops.py ... this could make field diagnostics very difficult. We should invest some time in another patch to address that problem. Here's the important part of the log files:\n\n2014-02-08 14:27:04.706 DEBUG nova.virt.vmwareapi.vmops [req-725a0ee2-276d-4252-97dd-8e360e657226 ServerRescueTestXML-107000062 ServerRescueTestXML-601874270] [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0] Powered off the VM power_off /opt/stack/nova/nova/virt/vmwareapi/vmops.py:1152\n2014-02-08 14:27:04.708 ERROR nova.compute.manager [req-725a0ee2-276d-4252-97dd-8e360e657226 ServerRescueTestXML-107000062 ServerRescueTestXML-601874270] [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0] Error trying to Rescue Instance\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0] Traceback (most recent call last):\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0]   File \"/opt/stack/nova/nova/compute/manager.py\", line 2725, in rescue_instance\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0]     rescue_image_meta, admin_password)\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0]   File \"/opt/stack/nova/nova/virt/vmwareapi/driver.py\", line 670, in rescue\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0]     _vmops.rescue(context, instance, network_info, image_meta)\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0]   File \"/opt/stack/nova/nova/virt/vmwareapi/vmops.py\", line 1087, in rescue\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0]     r_instance['name'] = r_instance['name'] + self._rescue_suffix\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0]   File \"/opt/stack/nova/nova/objects/base.py\", line 388, in __setitem__\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0]     setattr(self, name, value)\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0] AttributeError: can't set attribute\n2014-02-08 14:27:04.708 24360 TRACE nova.compute.manager [instance: 3f317fe3-1777-4f0d-a60a-f2370d9b2fb0] \n2014-02-08 14:27:04.710 24360 DEBUG oslo.messaging._drivers.amqpdriver [-] MSG_ID is b979f498fc1547a0bfff17b862ad0777 _send /opt/stack/oslo.messaging/oslo/messaging/_drivers/amqpdriver.py:358", 
            "date_created": "2014-02-10 03:22:47.649980+00:00", 
            "author": "https://api.launchpad.net/1.0/~hartsock"
        }, 
        {
            "content": "Root cause is here:\n* https://github.com/openstack/nova/blob/master/nova/virt/vmwareapi/vmops.py#L1087\n\nSome rule about treatment of instance objects must have just recently changed. The vmwareapi/vmops.py file is the only code in Nova that does a deep copy of instance and then attempts to mutate the copy. We may have to rewrite any methods that assumed deep copy and mutate was okay ... or we will have to find and revert the change that made this strategy fail. \n\nMore on this later.", 
            "date_created": "2014-02-10 03:41:21.864491+00:00", 
            "author": "https://api.launchpad.net/1.0/~hartsock"
        }, 
        {
            "content": "The bug is marked as critical as it is breaking minesweeper", 
            "date_created": "2014-02-10 08:17:56.059890+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "https://review.openstack.org/#/c/72143/", 
            "date_created": "2014-02-10 08:35:58.558110+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/72285\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9bb9a77e41b009cb940e98feda666dd8d806c862\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9bb9a77e41b009cb940e98feda666dd8d806c862\nAuthor: Gary Kotton <email address hidden>\nDate:   Sun Feb 9 23:51:50 2014 -0800\n\n    VMware: fix instance rescue bug\n    \n    Commit I6448cb929e9afce814d0580eada91b8fd37befa3 added object support\n    to the rescue operations. This exposed a bug in the VMware driver\n    which was caught by the minesweeper. A rescue instance is named\n    '<instance-uuid>-rescue'. In the past this name was updated on the\n    instance, now it is passed as a parameter to the spawn method.\n    \n    Change-Id: I633614c6c634d41a32a9b1b70d941e9bfdcadedd\n    Closes-bug: #1278149\n", 
            "date_created": "2014-02-11 02:17:18.593195+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-05 13:06:48.255269+00:00"
}