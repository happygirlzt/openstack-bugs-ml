{
    "status": "Fix Released", 
    "last_updated": "2017-10-04 17:40:54.289638+00:00", 
    "description": "If nova list API is called with filter as empty regex pattern like below:\n    http://<host-ip>/compute/v2.1/servers?name=\"\"\n\nit fails at db layer with below error and returns 500 InternalServerError\nto user:\n\n  InternalError: (1139, u\"Got error 'empty (sub)expression' from regexp\")\n\n\nLooks like the issue is there for every query parameter which is using below\nregex parameter types defined in parameter_types.py:\n\n    common_query_regex_param\n\n\n\nReproduction steps:\n\nCurrent nova master:\ncommit 2761b7fc40366644f611cb994342c5387f7fc6a1\nMerge: bd37c64 8c44be5\nAuthor: Jenkins <email address hidden>\nDate:   Tue Sep 19 02:58:27 2017 +0000\n\n    Merge \"Updated from global requirements\"\n\ndevstack:\ncommit 6c87f363a1255270a3711b3fe7a065cc693164b9\nMerge: f60babc 1d141da\nAuthor: Jenkins <email address hidden>\nDate:   Tue Sep 19 02:07:16 2017 +0000\n\n    Merge \"Feature flag on tempest conf to notify enabled LDAP\"\n\n\n1] nova list API:\n\ncurl -g -i -X GET http://10.232.48.201/compute/v2.1/servers?name=\"\" \n-H \"OpenStack-API-Version: compute 2.53\" -H \"User-Agent: python-novaclient\" \n-H \"Accept: application/json\" -H \"X-OpenStack-Nova-API-Version: 2.53\" \n-H \"X-Auth-Token: 2e403dfaae4a4d7fbcf0a9fc4f97d8e4\"\n\nHTTP/1.1 500 Internal Server Error\nDate: Fri, 15 Sep 2017 10:34:39 GMT\nServer: Apache/2.4.18 (Ubuntu)\nOpenStack-API-Version: compute 2.53\nX-OpenStack-Nova-API-Version: 2.53\nVary: OpenStack-API-Version,X-OpenStack-Nova-API-Version\nContent-Type: application/json; charset=UTF-8\nContent-Length: 199\nx-openstack-request-id: req-85ae3592-3726-4e95-8bb9-9a9204dd7e68\nx-compute-request-id: req-85ae3592-3726-4e95-8bb9-9a9204dd7e68\nConnection: close\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'oslo_db.exception.DBError'>\", \"code\": 500}}\n\n\nNova-API logs:\n\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters [None req-85ae3592-3726-4e95-8bb9-9a9204dd7e68 admin admin] \nDBAPIError exception wrapped from (pymysql.err.InternalError) (1139, u\"Got error 'empty (sub)expression' from regexp\") [SQL: u'SELECT anon_1.instances_created_at AS anon_1_instances_created_at,\nanon_1.instances_updated_at AS anon_1_instances_updated_at, anon_1.instances_deleted_at AS anon_1_instances_deleted_at, anon_1.instances_deleted AS anon_1_instances_deleted, anon_1.\ninstances_id AS anon_1_instances_id, anon_1.instances_user_id AS anon_1_instances_user_id, anon_1.instances_project_id AS anon_1_instances_project_id, anon_1.instances_image_ref AS anon_\n1_instances_image_ref, anon_1.instances_kernel_id AS anon_1_instances_kernel_id, anon_1.instances_ramdisk_id AS anon_1_instances_ramdisk_id, anon_1.instances_hostname AS anon_1_instanc\nes_hostname, anon_1.instances_launch_index AS anon_1_instances_launch_index, anon_1.instances_key_name AS anon_1_instances_key_name, anon_1.instances_key_data AS anon_1_instances_k\ney_data, anon_1.instances_power_state AS anon_1_instances_power_state, ano\nn_1.instances_vm_state AS anon_1_instances_vm_state, anon_1.instances_task_state AS anon_1_instances_task_state, anon_1.instances_memory_mb AS anon_1_instances_memory_mb, anon_1.i\nnstances_vcpus AS anon_1_instances_vcpus, anon_1.instances_root_gb AS anon_1_instances_root_gb, anon_1.instances_ephemeral_gb AS anon_1_instances_ephemeral_gb, anon_1.instances_ephe\nmeral_key_uuid AS anon_1_instances_ephemeral_key_uuid, anon_1.instances_host AS anon_1_instances_host, anon_1.instances_node AS anon_1_instances_node, anon_1.instances_instance_type\n_id AS anon_1_instances_instance_type_id, anon_1.instances_user_data AS anon_1_instances_user_data, anon_1.instances_reservation_id AS anon_1_instances_reservation_id, anon_1.instances_lau\nnched_at AS anon_1_instances_launched_at, anon_1.instances_terminated_at AS anon_1_instances_terminated_at, anon_1.instances_availability_zone AS anon_1_instances_availability\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: _zone, anon_1.instances_display_name AS anon_1_instances_display_name, anon_1.instances_display_description AS anon_1_in\nstances_display_description, anon_1.instances_launched_on AS anon_1_instances_launched_on, anon_1.instances_locked AS anon_1_instances_locked, anon_1.instances_locked_by AS anon_1_insta\nnces_locked_by, anon_1.instances_os_type AS anon_1_instances_os_type, anon_1.instances_architecture AS anon_1_instances_architecture, anon_1.instances_vm_mode AS anon_1_instances_vm_\nmode, anon_1.instances_uuid AS anon_1_instances_uuid, anon_1.instances_root_device_name AS anon_1_instances_root_device_name, anon_1.instances_default_ephemeral_device AS anon_1_i\nnstances_default_ephemeral_device, anon_1.instances_default_swap_device AS anon_1_instances_default_swap_device, anon_1.instances_config_drive AS anon_1_instances_config_drive, anon_1.i\nnstances_access_ip_v4 AS anon_1_instances_access_ip_v4, anon_1.instances_access_ip_v6 AS anon_1_instances_access_ip_v6, anon_1.instances_auto_disk_config AS anon_1_instances_auto_disk_co\nnfig, anon_1.instances_progress AS anon_1_instances_progress, anon_1.instances_shutdown_terminate AS anon_1_instances_shutdown_terminate, anon_1.instances_disable_terminate AS anon_1_in\nstances_disable_terminate, anon_1.instances_cell_name AS anon_1_instances_cell_name, anon_1.instances_cleaned AS anon_1_instances_cleaned, security_groups_1.created_at AS security_groups_1\n_created_at, security_groups_1.updated_at AS security_groups_1_updated_at, security_groups_1.deleted_at AS security_groups_1_deleted_at, security_groups_1.deleted AS security_groups_1_delete\nd, security_groups_1.id AS security_groups_1_id, security_groups_1.name AS security_groups_1_name, security_groups_1.description AS security_groups_1_description, security_groups_1.user_id AS sec\nurity_groups_1_user_id, security_groups_1.project_id AS security_groups_1_project_id, instance_info_caches_1.created_at AS instance_info_caches_1_created_at, instance_info_caches_1.updated_at A\nS instance_info_caches_1_updated_at, instance_info_caches_1.\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: deleted_at AS instance_info_caches_1_deleted_at, instance_info_caches_1.deleted AS instance_info_caches_1_deleted, instance_in\nfo_caches_1.id AS instance_info_caches_1_id, instance_info_caches_1.network_info AS instance_info_caches_1_network_info, instance_info_caches_1.instance_uuid AS instance_info_caches_1_instance_\nuuid \\nFROM (SELECT instances.created_at AS instances_created_at, instances.updated_at AS instances_updated_at, instances.deleted_at AS instances_deleted_at, instances.deleted AS instances_deleted, in\nstances.id AS instances_id, instances.user_id AS instances_user_id, instances.project_id AS instances_project_id, instances.image_ref AS instances_image_ref, instances.kernel_id AS instances_kernel_id, insta\nnces.ramdisk_id AS instances_ramdisk_id, instances.hostname AS instances_hostname, instances.launch_index AS instances_launch_index, instances.key_name AS instances_key_name, instances.key_data\nAS instances_key_data, instances.power_state AS instances_power_state, instances.vm_state AS instances_vm_state, instances.task_state AS instances_task_state, instances.memory_mb AS instances_me\nmory_mb, instances.vcpus AS instances_vcpus, instances.root_gb AS insta\nnces_root_gb, instances.ephemeral_gb AS instances_ephemeral_gb, instances.ephemeral_key_uuid AS instances_ephemeral_key_uuid, instances.host AS instances_host, instances.node AS instances_node,\ninstances.instance_type_id AS instances_instance_type_id, instances.user_data AS instances_user_data, instances.reservation_id AS instances_reservation_id, instances.launched_at AS instances_launched_\nat, instances.terminated_at AS instances_terminated_at, instances.availability_zone AS instances_availability_zone, instances.display_name AS instances_display_name, instances.display_description AS insta\nnces_display_description, instances.launched_on AS instances_launched_on, instances.locked AS instances_locked, instances.locked_by AS instances_locked_by, instances.os_type AS instances_os_type, inst\nances.architecture AS instances_architecture, instances.vm_mode A\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: S instances_vm_mode, instances.uuid AS instances_uuid, instances.root_device_name AS instances_root_device_name, instances.default\n_ephemeral_device AS instances_default_ephemeral_device, instances.default_swap_device AS instances_default_swap_device, instances.config_drive AS instances_config_drive, instances.access_ip_v4 AS i\nnstances_access_ip_v4, instances.access_ip_v6 AS instances_access_ip_v6, instances.auto_disk_config AS instances_auto_disk_config, instances.progress AS instances_progress, instances.shutdown_terminat\ne AS instances_shutdown_terminate, instances.disable_terminate AS instances_disable_terminate, instances.cell_name AS instances_cell_name, instances.cleaned AS instances_cleaned \\nFROM instances \\n\nWHERE instances.deleted = %(deleted_1)s AND (instances.vm_state != %(vm_state_1)s OR instances.vm_state IS NULL) AND instances.project_id = %(project_id_1)s AND (instances.display_name \nREGEXP %(display_name_1)s) ORDER BY instances.created_at DESC, instances.id DESC \\n LIMIT %(param_1)s) AS anon_1 LEFT OUTER JOIN (security_group_instance_association AS security_group_instance_association_1 \nINNER JOIN security_groups AS security_groups_1 ON security_groups_1.id = security_group_instance_association_1.security_group_id AND security_group_instance_association_1.deleted = %(deleted_2)s AND \nsecurity_groups_1.deleted = %(deleted_3)s) ON security_group_instance_association_1.instance_uuid = anon_1.instances_uuid AND anon_1.instances_deleted = %(deleted_4)s LEFT OUTER JOIN instance_info_caches \nAS instance_info_caches_1 ON instance_info_caches_1.instance_uuid = anon_1.instances_uuid ORDER BY anon_1.instances_created_at DESC, anon_1.instances_id DESC'] [parameters: {u'deleted_3': 0, u'\ndisplay_name_1': u'', u'deleted_4': 0, u'param_1': 1000, u'deleted_2': 0, u'deleted_1': 0, u'vm_state_1': 'soft-delete', u'project_id_1': u'038a2813bce843e1a49a512701f17ddf'}]: InternalError:\n(1139, u\"Got error 'empty (sub)expression' from regexp\")\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters Traceback (most recent call last):\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1182, in _execute_context\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     context)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 470, in do_execute\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     cursor.execute(statement, parameters)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/cursors.py\", line 166, in execute\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     result = self._query(query)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/cursors.py\", line 322, in _query\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     conn.query(q)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 856, in query\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     self._affected_rows = self._read_query_result(unbuffered=unbuffered)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1057, in _read_query_result\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     result.read()\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1340, in read\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     first_packet = self.connection._read_packet()\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1014, in _read_packet\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     packet.check_error()\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 393, in check_error\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     err.raise_mysql_exception(self._data)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/err.py\", line 107, in raise_mysql_exception\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     raise errorclass(errno, errval)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters InternalError: (1139, u\"Got error 'empty (sub)expression' from regexp\")\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters", 
    "tags": [
        "api"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1718877", 
    "owner": "https://api.launchpad.net/1.0/~dinesh-bhor", 
    "id": 1718877, 
    "index": 11, 
    "openned": "2017-09-22 08:33:22.276921+00:00", 
    "created": "2017-09-22 08:33:22.276921+00:00", 
    "title": "nova-api returns 500 error(DBError) if nova list API is called with filters with empty string", 
    "comments": [
        {
            "content": "If nova list API is called with filter as empty regex pattern like below:\n    http://<host-ip>/compute/v2.1/servers?name=\"\"\n\nit fails at db layer with below error and returns 500 InternalServerError\nto user:\n\n  InternalError: (1139, u\"Got error 'empty (sub)expression' from regexp\")\n\n\nLooks like the issue is there for every query parameter which is using below\nregex parameter types defined in parameter_types.py:\n\n    common_query_regex_param\n\n\n\nReproduction steps:\n\nCurrent nova master:\ncommit 2761b7fc40366644f611cb994342c5387f7fc6a1\nMerge: bd37c64 8c44be5\nAuthor: Jenkins <email address hidden>\nDate:   Tue Sep 19 02:58:27 2017 +0000\n\n    Merge \"Updated from global requirements\"\n\ndevstack:\ncommit 6c87f363a1255270a3711b3fe7a065cc693164b9\nMerge: f60babc 1d141da\nAuthor: Jenkins <email address hidden>\nDate:   Tue Sep 19 02:07:16 2017 +0000\n\n    Merge \"Feature flag on tempest conf to notify enabled LDAP\"\n\n\n1] nova list API:\n\ncurl -g -i -X GET http://10.232.48.201/compute/v2.1/servers?name=\"\" \n-H \"OpenStack-API-Version: compute 2.53\" -H \"User-Agent: python-novaclient\" \n-H \"Accept: application/json\" -H \"X-OpenStack-Nova-API-Version: 2.53\" \n-H \"X-Auth-Token: 2e403dfaae4a4d7fbcf0a9fc4f97d8e4\"\n\nHTTP/1.1 500 Internal Server Error\nDate: Fri, 15 Sep 2017 10:34:39 GMT\nServer: Apache/2.4.18 (Ubuntu)\nOpenStack-API-Version: compute 2.53\nX-OpenStack-Nova-API-Version: 2.53\nVary: OpenStack-API-Version,X-OpenStack-Nova-API-Version\nContent-Type: application/json; charset=UTF-8\nContent-Length: 199\nx-openstack-request-id: req-85ae3592-3726-4e95-8bb9-9a9204dd7e68\nx-compute-request-id: req-85ae3592-3726-4e95-8bb9-9a9204dd7e68\nConnection: close\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<class 'oslo_db.exception.DBError'>\", \"code\": 500}}\n\n\nNova-API logs:\n\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters [None req-85ae3592-3726-4e95-8bb9-9a9204dd7e68 admin admin] \nDBAPIError exception wrapped from (pymysql.err.InternalError) (1139, u\"Got error 'empty (sub)expression' from regexp\") [SQL: u'SELECT anon_1.instances_created_at AS anon_1_instances_created_at,\nanon_1.instances_updated_at AS anon_1_instances_updated_at, anon_1.instances_deleted_at AS anon_1_instances_deleted_at, anon_1.instances_deleted AS anon_1_instances_deleted, anon_1.\ninstances_id AS anon_1_instances_id, anon_1.instances_user_id AS anon_1_instances_user_id, anon_1.instances_project_id AS anon_1_instances_project_id, anon_1.instances_image_ref AS anon_\n1_instances_image_ref, anon_1.instances_kernel_id AS anon_1_instances_kernel_id, anon_1.instances_ramdisk_id AS anon_1_instances_ramdisk_id, anon_1.instances_hostname AS anon_1_instanc\nes_hostname, anon_1.instances_launch_index AS anon_1_instances_launch_index, anon_1.instances_key_name AS anon_1_instances_key_name, anon_1.instances_key_data AS anon_1_instances_k\ney_data, anon_1.instances_power_state AS anon_1_instances_power_state, ano\nn_1.instances_vm_state AS anon_1_instances_vm_state, anon_1.instances_task_state AS anon_1_instances_task_state, anon_1.instances_memory_mb AS anon_1_instances_memory_mb, anon_1.i\nnstances_vcpus AS anon_1_instances_vcpus, anon_1.instances_root_gb AS anon_1_instances_root_gb, anon_1.instances_ephemeral_gb AS anon_1_instances_ephemeral_gb, anon_1.instances_ephe\nmeral_key_uuid AS anon_1_instances_ephemeral_key_uuid, anon_1.instances_host AS anon_1_instances_host, anon_1.instances_node AS anon_1_instances_node, anon_1.instances_instance_type\n_id AS anon_1_instances_instance_type_id, anon_1.instances_user_data AS anon_1_instances_user_data, anon_1.instances_reservation_id AS anon_1_instances_reservation_id, anon_1.instances_lau\nnched_at AS anon_1_instances_launched_at, anon_1.instances_terminated_at AS anon_1_instances_terminated_at, anon_1.instances_availability_zone AS anon_1_instances_availability\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: _zone, anon_1.instances_display_name AS anon_1_instances_display_name, anon_1.instances_display_description AS anon_1_in\nstances_display_description, anon_1.instances_launched_on AS anon_1_instances_launched_on, anon_1.instances_locked AS anon_1_instances_locked, anon_1.instances_locked_by AS anon_1_insta\nnces_locked_by, anon_1.instances_os_type AS anon_1_instances_os_type, anon_1.instances_architecture AS anon_1_instances_architecture, anon_1.instances_vm_mode AS anon_1_instances_vm_\nmode, anon_1.instances_uuid AS anon_1_instances_uuid, anon_1.instances_root_device_name AS anon_1_instances_root_device_name, anon_1.instances_default_ephemeral_device AS anon_1_i\nnstances_default_ephemeral_device, anon_1.instances_default_swap_device AS anon_1_instances_default_swap_device, anon_1.instances_config_drive AS anon_1_instances_config_drive, anon_1.i\nnstances_access_ip_v4 AS anon_1_instances_access_ip_v4, anon_1.instances_access_ip_v6 AS anon_1_instances_access_ip_v6, anon_1.instances_auto_disk_config AS anon_1_instances_auto_disk_co\nnfig, anon_1.instances_progress AS anon_1_instances_progress, anon_1.instances_shutdown_terminate AS anon_1_instances_shutdown_terminate, anon_1.instances_disable_terminate AS anon_1_in\nstances_disable_terminate, anon_1.instances_cell_name AS anon_1_instances_cell_name, anon_1.instances_cleaned AS anon_1_instances_cleaned, security_groups_1.created_at AS security_groups_1\n_created_at, security_groups_1.updated_at AS security_groups_1_updated_at, security_groups_1.deleted_at AS security_groups_1_deleted_at, security_groups_1.deleted AS security_groups_1_delete\nd, security_groups_1.id AS security_groups_1_id, security_groups_1.name AS security_groups_1_name, security_groups_1.description AS security_groups_1_description, security_groups_1.user_id AS sec\nurity_groups_1_user_id, security_groups_1.project_id AS security_groups_1_project_id, instance_info_caches_1.created_at AS instance_info_caches_1_created_at, instance_info_caches_1.updated_at A\nS instance_info_caches_1_updated_at, instance_info_caches_1.\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: deleted_at AS instance_info_caches_1_deleted_at, instance_info_caches_1.deleted AS instance_info_caches_1_deleted, instance_in\nfo_caches_1.id AS instance_info_caches_1_id, instance_info_caches_1.network_info AS instance_info_caches_1_network_info, instance_info_caches_1.instance_uuid AS instance_info_caches_1_instance_\nuuid \\nFROM (SELECT instances.created_at AS instances_created_at, instances.updated_at AS instances_updated_at, instances.deleted_at AS instances_deleted_at, instances.deleted AS instances_deleted, in\nstances.id AS instances_id, instances.user_id AS instances_user_id, instances.project_id AS instances_project_id, instances.image_ref AS instances_image_ref, instances.kernel_id AS instances_kernel_id, insta\nnces.ramdisk_id AS instances_ramdisk_id, instances.hostname AS instances_hostname, instances.launch_index AS instances_launch_index, instances.key_name AS instances_key_name, instances.key_data\nAS instances_key_data, instances.power_state AS instances_power_state, instances.vm_state AS instances_vm_state, instances.task_state AS instances_task_state, instances.memory_mb AS instances_me\nmory_mb, instances.vcpus AS instances_vcpus, instances.root_gb AS insta\nnces_root_gb, instances.ephemeral_gb AS instances_ephemeral_gb, instances.ephemeral_key_uuid AS instances_ephemeral_key_uuid, instances.host AS instances_host, instances.node AS instances_node,\ninstances.instance_type_id AS instances_instance_type_id, instances.user_data AS instances_user_data, instances.reservation_id AS instances_reservation_id, instances.launched_at AS instances_launched_\nat, instances.terminated_at AS instances_terminated_at, instances.availability_zone AS instances_availability_zone, instances.display_name AS instances_display_name, instances.display_description AS insta\nnces_display_description, instances.launched_on AS instances_launched_on, instances.locked AS instances_locked, instances.locked_by AS instances_locked_by, instances.os_type AS instances_os_type, inst\nances.architecture AS instances_architecture, instances.vm_mode A\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: S instances_vm_mode, instances.uuid AS instances_uuid, instances.root_device_name AS instances_root_device_name, instances.default\n_ephemeral_device AS instances_default_ephemeral_device, instances.default_swap_device AS instances_default_swap_device, instances.config_drive AS instances_config_drive, instances.access_ip_v4 AS i\nnstances_access_ip_v4, instances.access_ip_v6 AS instances_access_ip_v6, instances.auto_disk_config AS instances_auto_disk_config, instances.progress AS instances_progress, instances.shutdown_terminat\ne AS instances_shutdown_terminate, instances.disable_terminate AS instances_disable_terminate, instances.cell_name AS instances_cell_name, instances.cleaned AS instances_cleaned \\nFROM instances \\n\nWHERE instances.deleted = %(deleted_1)s AND (instances.vm_state != %(vm_state_1)s OR instances.vm_state IS NULL) AND instances.project_id = %(project_id_1)s AND (instances.display_name \nREGEXP %(display_name_1)s) ORDER BY instances.created_at DESC, instances.id DESC \\n LIMIT %(param_1)s) AS anon_1 LEFT OUTER JOIN (security_group_instance_association AS security_group_instance_association_1 \nINNER JOIN security_groups AS security_groups_1 ON security_groups_1.id = security_group_instance_association_1.security_group_id AND security_group_instance_association_1.deleted = %(deleted_2)s AND \nsecurity_groups_1.deleted = %(deleted_3)s) ON security_group_instance_association_1.instance_uuid = anon_1.instances_uuid AND anon_1.instances_deleted = %(deleted_4)s LEFT OUTER JOIN instance_info_caches \nAS instance_info_caches_1 ON instance_info_caches_1.instance_uuid = anon_1.instances_uuid ORDER BY anon_1.instances_created_at DESC, anon_1.instances_id DESC'] [parameters: {u'deleted_3': 0, u'\ndisplay_name_1': u'', u'deleted_4': 0, u'param_1': 1000, u'deleted_2': 0, u'deleted_1': 0, u'vm_state_1': 'soft-delete', u'project_id_1': u'038a2813bce843e1a49a512701f17ddf'}]: InternalError:\n(1139, u\"Got error 'empty (sub)expression' from regexp\")\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters Traceback (most recent call last):\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1182, in _execute_context\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     context)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 470, in do_execute\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     cursor.execute(statement, parameters)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/cursors.py\", line 166, in execute\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     result = self._query(query)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/cursors.py\", line 322, in _query\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     conn.query(q)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 856, in query\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     self._affected_rows = self._read_query_result(unbuffered=unbuffered)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1057, in _read_query_result\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     result.read()\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1340, in read\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     first_packet = self.connection._read_packet()\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 1014, in _read_packet\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     packet.check_error()\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/connections.py\", line 393, in check_error\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     err.raise_mysql_exception(self._data)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters   File \"/usr/local/lib/python2.7/dist-packages/pymysql/err.py\", line 107, in raise_mysql_exception\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters     raise errorclass(errno, errval)\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters InternalError: (1139, u\"Got error 'empty (sub)expression' from regexp\")\nSep 15 16:04:40 dbopenstack-VirtualBox <email address hidden>[989]: ERROR oslo_db.sqlalchemy.exc_filters", 
            "date_created": "2017-09-22 08:33:22.276921+00:00", 
            "author": "https://api.launchpad.net/1.0/~dinesh-bhor"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/506585", 
            "date_created": "2017-09-22 10:28:21.814811+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/506585\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=0cc94bfd5934e793cb8d739e132b52fa40bcddb0\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0cc94bfd5934e793cb8d739e132b52fa40bcddb0\nAuthor: Dinesh Bhor <email address hidden>\nDate:   Tue Sep 19 14:56:01 2017 +0530\n\n    Fix 500 if list servers called with empty regex pattern\n    \n    If nova list API is called with empty regex pattern like below:\n        http://<host-ip>/compute/v2.1/servers?name=\"\"\n    \n    it fails at db layer and returns 500 InternalServerError.\n    \n    Empty string('') is a valid regex for re.compile [1] so nova-api fails\n    to catch it at schema layer and it is passed to databse for searching.\n    Database fails to search it with \"REGEXP %(display_name_1)s)\" and\n    'display_name_1' as u'' in sql query which leads to below error:\n    \n    InternalError: (1139, u\"Got error 'empty (sub)expression' from regexp\")\n    \n    This issue is there for every query parameter which is using below\n    regex parameter types defined in parameter_types.py:\n        common_query_regex_param\n    \n    This patch fixes this issue by rejecting the request with 400 if the\n    provided filter regex is empty string. If user is intending to filter\n    something, user must pass something to the filter, it cannot be a empty\n    string.\n    \n    [1] https://github.com/openstack/nova/blob/16.0.0/nova/api/validation/validators.py#L40\n    \n    Closes-Bug: #1718877\n    Change-Id: I3f6fa04dc7267279964e8e5dd2a790b997a40e4e\n", 
            "date_created": "2017-09-22 17:36:34.514965+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/pike\nReview: https://review.openstack.org/506754", 
            "date_created": "2017-09-22 19:05:23.875721+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/506760", 
            "date_created": "2017-09-22 19:32:36.890221+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/506754\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=6538175c08f127c20e72e1d347af3eb3d54d6838\nSubmitter: Jenkins\nBranch:    stable/pike\n\ncommit 6538175c08f127c20e72e1d347af3eb3d54d6838\nAuthor: Dinesh Bhor <email address hidden>\nDate:   Tue Sep 19 14:56:01 2017 +0530\n\n    Fix 500 if list servers called with empty regex pattern\n    \n    If nova list API is called with empty regex pattern like below:\n        http://<host-ip>/compute/v2.1/servers?name=\"\"\n    \n    it fails at db layer and returns 500 InternalServerError.\n    \n    Empty string('') is a valid regex for re.compile [1] so nova-api fails\n    to catch it at schema layer and it is passed to databse for searching.\n    Database fails to search it with \"REGEXP %(display_name_1)s)\" and\n    'display_name_1' as u'' in sql query which leads to below error:\n    \n    InternalError: (1139, u\"Got error 'empty (sub)expression' from regexp\")\n    \n    This issue is there for every query parameter which is using below\n    regex parameter types defined in parameter_types.py:\n        common_query_regex_param\n    \n    This patch fixes this issue by rejecting the request with 400 if the\n    provided filter regex is empty string. If user is intending to filter\n    something, user must pass something to the filter, it cannot be a empty\n    string.\n    \n    [1] https://github.com/openstack/nova/blob/16.0.0/nova/api/validation/validators.py#L40\n    \n    Closes-Bug: #1718877\n    Change-Id: I3f6fa04dc7267279964e8e5dd2a790b997a40e4e\n    (cherry picked from commit 0cc94bfd5934e793cb8d739e132b52fa40bcddb0)\n", 
            "date_created": "2017-09-28 07:32:07.926138+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/506760\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=befcda5b2149492cf6b5c7856def238fbb9079d8\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit befcda5b2149492cf6b5c7856def238fbb9079d8\nAuthor: Dinesh Bhor <email address hidden>\nDate:   Tue Sep 19 14:56:01 2017 +0530\n\n    Fix 500 if list servers called with empty regex pattern\n    \n    If nova list API is called with empty regex pattern like below:\n        http://<host-ip>/compute/v2.1/servers?name=\"\"\n    \n    it fails at db layer and returns 500 InternalServerError.\n    \n    Empty string('') is a valid regex for re.compile [1] so nova-api fails\n    to catch it at schema layer and it is passed to databse for searching.\n    Database fails to search it with \"REGEXP %(display_name_1)s)\" and\n    'display_name_1' as u'' in sql query which leads to below error:\n    \n    InternalError: (1139, u\"Got error 'empty (sub)expression' from regexp\")\n    \n    This issue is there for every query parameter which is using below\n    regex parameter types defined in parameter_types.py:\n        common_query_regex_param\n    \n    This patch fixes this issue by rejecting the request with 400 if the\n    provided filter regex is empty string. If user is intending to filter\n    something, user must pass something to the filter, it cannot be a empty\n    string.\n    \n    [1] https://github.com/openstack/nova/blob/16.0.0/nova/api/validation/validators.py#L40\n    \n    Closes-Bug: #1718877\n    Change-Id: I3f6fa04dc7267279964e8e5dd2a790b997a40e4e\n    (cherry picked from commit 0cc94bfd5934e793cb8d739e132b52fa40bcddb0)\n    (cherry picked from commit 6538175c08f127c20e72e1d347af3eb3d54d6838)\n", 
            "date_created": "2017-10-04 17:40:53.799618+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-09-22 17:36:32.011025+00:00"
}