{
    "status": "Invalid", 
    "last_updated": "2014-01-06 23:51:32.166357+00:00", 
    "description": "2013-05-06 21:08:11.060 TRACE nova Traceback (most recent call last):\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/bin/nova-compute\", line 9, in <module>\n2013-05-06 21:08:11.060 TRACE nova     load_entry_point('nova==2013.2.a531.g89463d8', 'console_scripts', 'nova-compute')()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/cmd/compute.py\", line 65, in main\n2013-05-06 21:08:11.060 TRACE nova     service.wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 690, in wait\n2013-05-06 21:08:11.060 TRACE nova     _launcher.wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 210, in wait\n2013-05-06 21:08:11.060 TRACE nova     super(ServiceLauncher, self).wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 180, in wait\n2013-05-06 21:08:11.060 TRACE nova     service.wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2013-05-06 21:08:11.060 TRACE nova     return self._exit_event.wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2013-05-06 21:08:11.060 TRACE nova     return hubs.get_hub().switch()\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2013-05-06 21:08:11.060 TRACE nova     return self.greenlet.switch()\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2013-05-06 21:08:11.060 TRACE nova     result = function(*args, **kwargs)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 148, in run_server\n2013-05-06 21:08:11.060 TRACE nova     server.start()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 430, in start\n2013-05-06 21:08:11.060 TRACE nova     self.manager.init_host()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/compute/manager.py\", line 620, in init_host\n2013-05-06 21:08:11.060 TRACE nova     self.host)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/conductor/api.py\", line 406, in instance_get_all_by_host\n2013-05-06 21:08:11.060 TRACE nova     context, host, columns_to_join=columns_to_join)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 310, in instance_get_all_by_host\n2013-05-06 21:08:11.060 TRACE nova     return self.call(context, msg, version='1.47')\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/proxy.py\", line 86, in call\n2013-05-06 21:08:11.060 TRACE nova     return rpc.call(context, real_topic, msg, timeout)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/__init__.py\", line 140, in call\n2013-05-06 21:08:11.060 TRACE nova     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/impl_kombu.py\", line 798, in call\n2013-05-06 21:08:11.060 TRACE nova     rpc_amqp.get_connection_pool(conf, Connection))\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 615, in call\n2013-05-06 21:08:11.060 TRACE nova     rv = list(rv)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 564, in __iter__\n2013-05-06 21:08:11.060 TRACE nova     raise result\n2013-05-06 21:08:11.060 TRACE nova RemoteError: Remote error: AMQPConnectionException (503, u\"COMMAND_INVALID - second 'channel.open' seen\", (20, 10), 'Channel.open')\n2013-05-06 21:08:11.060 TRACE nova [u'Traceback (most recent call last):\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 439, in _process_data\\n    ctxt.reply(rval, None, connection_pool=se\nlf.connection_pool)\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 272, in reply\\n    reply, failure, ending, log_failure)\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\",\n line 250, in msg_reply\\n    conn.direct_send(msg_id, rpc_common.serialize_msg(msg))\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 152, in __exit__\\n    self._done()\\n', u'  File \"/opt/st\nack/nova/nova/openstack/common/rpc/amqp.py\", line 141, in _done\\n    self.connection.reset()\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/impl_kombu.py\", line 596, in reset\\n    self.channel = self.con\nnection.channel()\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/kombu/connection.py\", line 99, in channel\\n    return self.transport.create_channel(self.connection)\\n', u'  File \"/usr/local/lib/python2.7/d\nist-packages/kombu/transport/pyamqplib.py\", line 197, in create_channel\\n    return connection.channel()\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/kombu/transport/pyamqplib.py\", line 130, in channel\\n\n   return Channel(self, channel_id)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/amqplib/client_0_8/channel.py\", line 82, in __init__\\n    self._x_open()\\n', u'  File \"/usr/local/lib/python2.7/dist-packag\nes/amqplib/client_0_8/channel.py\", line 471, in _x_open\\n    (20, 11),    # Channel.open_ok\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/amqplib/client_0_8/abstract_channel.py\", line 89, in wait\\n    self\n.channel_id, allowed_methods)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/amqplib/client_0_8/connection.py\", line 218, in _wait_method\\n    self.wait()\\n', u'  File \"/usr/local/lib/python2.7/dist-package\ns/amqplib/client_0_8/abstract_channel.py\", line 105, in wait\\n    return amqp_method(self, args)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/amqplib/client_0_8/connection.py\", line 367, in _close\\n    ra\nise AMQPConnectionException(reply_code, reply_text, (class_id, method_id))\\n', u'AMQPConnectionException: (503, u\"COMMAND_INVALID - second \\'channel.open\\' seen\", (20, 10), \\'Channel.open\\')\\n'].", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1177184", 
    "owner": "None", 
    "id": 1177184, 
    "index": 3381, 
    "openned": "2013-05-07 04:13:47.309562+00:00", 
    "created": "2013-05-07 04:13:47.309562+00:00", 
    "title": "nova crashes on start if 503 AMQPConnectionException", 
    "comments": [
        {
            "content": "2013-05-06 21:08:11.060 TRACE nova Traceback (most recent call last):\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/bin/nova-compute\", line 9, in <module>\n2013-05-06 21:08:11.060 TRACE nova     load_entry_point('nova==2013.2.a531.g89463d8', 'console_scripts', 'nova-compute')()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/cmd/compute.py\", line 65, in main\n2013-05-06 21:08:11.060 TRACE nova     service.wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 690, in wait\n2013-05-06 21:08:11.060 TRACE nova     _launcher.wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 210, in wait\n2013-05-06 21:08:11.060 TRACE nova     super(ServiceLauncher, self).wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 180, in wait\n2013-05-06 21:08:11.060 TRACE nova     service.wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2013-05-06 21:08:11.060 TRACE nova     return self._exit_event.wait()\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2013-05-06 21:08:11.060 TRACE nova     return hubs.get_hub().switch()\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2013-05-06 21:08:11.060 TRACE nova     return self.greenlet.switch()\n2013-05-06 21:08:11.060 TRACE nova   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2013-05-06 21:08:11.060 TRACE nova     result = function(*args, **kwargs)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 148, in run_server\n2013-05-06 21:08:11.060 TRACE nova     server.start()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/service.py\", line 430, in start\n2013-05-06 21:08:11.060 TRACE nova     self.manager.init_host()\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/compute/manager.py\", line 620, in init_host\n2013-05-06 21:08:11.060 TRACE nova     self.host)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/conductor/api.py\", line 406, in instance_get_all_by_host\n2013-05-06 21:08:11.060 TRACE nova     context, host, columns_to_join=columns_to_join)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 310, in instance_get_all_by_host\n2013-05-06 21:08:11.060 TRACE nova     return self.call(context, msg, version='1.47')\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/proxy.py\", line 86, in call\n2013-05-06 21:08:11.060 TRACE nova     return rpc.call(context, real_topic, msg, timeout)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/__init__.py\", line 140, in call\n2013-05-06 21:08:11.060 TRACE nova     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/impl_kombu.py\", line 798, in call\n2013-05-06 21:08:11.060 TRACE nova     rpc_amqp.get_connection_pool(conf, Connection))\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 615, in call\n2013-05-06 21:08:11.060 TRACE nova     rv = list(rv)\n2013-05-06 21:08:11.060 TRACE nova   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 564, in __iter__\n2013-05-06 21:08:11.060 TRACE nova     raise result\n2013-05-06 21:08:11.060 TRACE nova RemoteError: Remote error: AMQPConnectionException (503, u\"COMMAND_INVALID - second 'channel.open' seen\", (20, 10), 'Channel.open')\n2013-05-06 21:08:11.060 TRACE nova [u'Traceback (most recent call last):\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 439, in _process_data\\n    ctxt.reply(rval, None, connection_pool=se\nlf.connection_pool)\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 272, in reply\\n    reply, failure, ending, log_failure)\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\",\n line 250, in msg_reply\\n    conn.direct_send(msg_id, rpc_common.serialize_msg(msg))\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 152, in __exit__\\n    self._done()\\n', u'  File \"/opt/st\nack/nova/nova/openstack/common/rpc/amqp.py\", line 141, in _done\\n    self.connection.reset()\\n', u'  File \"/opt/stack/nova/nova/openstack/common/rpc/impl_kombu.py\", line 596, in reset\\n    self.channel = self.con\nnection.channel()\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/kombu/connection.py\", line 99, in channel\\n    return self.transport.create_channel(self.connection)\\n', u'  File \"/usr/local/lib/python2.7/d\nist-packages/kombu/transport/pyamqplib.py\", line 197, in create_channel\\n    return connection.channel()\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/kombu/transport/pyamqplib.py\", line 130, in channel\\n\n   return Channel(self, channel_id)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/amqplib/client_0_8/channel.py\", line 82, in __init__\\n    self._x_open()\\n', u'  File \"/usr/local/lib/python2.7/dist-packag\nes/amqplib/client_0_8/channel.py\", line 471, in _x_open\\n    (20, 11),    # Channel.open_ok\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/amqplib/client_0_8/abstract_channel.py\", line 89, in wait\\n    self\n.channel_id, allowed_methods)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/amqplib/client_0_8/connection.py\", line 218, in _wait_method\\n    self.wait()\\n', u'  File \"/usr/local/lib/python2.7/dist-package\ns/amqplib/client_0_8/abstract_channel.py\", line 105, in wait\\n    return amqp_method(self, args)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/amqplib/client_0_8/connection.py\", line 367, in _close\\n    ra\nise AMQPConnectionException(reply_code, reply_text, (class_id, method_id))\\n', u'AMQPConnectionException: (503, u\"COMMAND_INVALID - second \\'channel.open\\' seen\", (20, 10), \\'Channel.open\\')\\n'].", 
            "date_created": "2013-05-07 04:13:47.309562+00:00", 
            "author": "https://api.launchpad.net/1.0/~arosen"
        }, 
        {
            "content": "I don't think we should let the service crash on this.  It should loop around trying to connect.  The fix may be most appropriate in the rpc backend, though.", 
            "date_created": "2013-05-08 15:15:24.779453+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "I looked and both the qpid and kombu drivers *attempt* to sit in a loop and attempt to connect until successful.  Something is obviously breaking in this process, though, and appears to be specific to the kombu driver.", 
            "date_created": "2013-05-08 15:19:23.289882+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "Russell, should this be confirmed for Oslo then?", 
            "date_created": "2013-07-09 21:26:10.385008+00:00", 
            "author": "https://api.launchpad.net/1.0/~bnemec"
        }, 
        {
            "content": "If this affects oslo.messaging, associate it with that project so we can fix it there.", 
            "date_created": "2014-01-06 23:51:31.681728+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }
    ], 
    "closed": "2013-05-08 15:19:32.090738+00:00"
}