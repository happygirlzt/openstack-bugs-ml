{
    "status": "Confirmed", 
    "last_updated": "2017-10-03 19:44:52.307747+00:00", 
    "description": "Description\n===================\nNova version: master\nVirt driver: VCDriver\n\n\n\nSteps to reproduce\n=====================\n1. Nova boot an instance.\n2. Cinder create a volume.\n3. Attach volume to the instance.\n4. After attached success,  using nova image-create command, create a snapshot for the instance.\n5. Rebuild the instance with snapshot image.\n\nIn nova-compute, error info:\n2016-03-30 12:16:14.801 9290 DEBUG oslo_vmware.exceptions [-] Fault GenericVmConfigFault not matched. get_fault_class /usr/lib/python2.7/site-packages/oslo_vmware/exceptions.py:250\n2016-03-30 12:16:14.801 9290 ERROR oslo_vmware.common.loopingcall [-] in fixed duration looping call\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall Traceback (most recent call last):\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall   File \"/usr/lib/python2.7/site-packages/oslo_vmware/common/loopingcall.py\", line 76, in _inner\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall     self.f(*self.args, **self.kw)\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall   File \"/usr/lib/python2.7/site-packages/oslo_vmware/api.py\", line 417, in _poll_task\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall     raise task_ex\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall VMwareDriverException: Disk '/vmfs/volumes/546a3532-ca1f27f1-e66a-1458d04cf670/volume-dbbdd17d-bb5c-4804-9d30-a6bd8a96eca3/volume-dbbdd17d-bb5c-4804-9d30-a6bd8a96eca3.vmdk' cannot be opened for writing. It might be shared with some other VM.\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall\n2016-03-30 12:16:14.802 9290 ERROR nova.compute.manager [req-b0c16cc2-fd52-4c85-9ff9-c67ff68ee410 4412e38ec9814b96a03e63097ec51f1a 8f75187cd29f4715881f450646fc6e08 - - -] [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05] Setting instance vm_state to ERROR\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05] Traceback (most recent call last):\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6418, in _error_out_instance_on_exception\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     yield\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 3087, in rebuild_instance\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     self._rebuild_default_impl(**kwargs)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2934, in _rebuild_default_impl\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     block_device_info=new_block_device_info)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/driver.py\", line 481, in spawn\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     admin_password, network_info, block_device_info)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/vmops.py\", line 683, in spawn\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     vm_util.power_on_instance(self._session, instance, vm_ref=vm_ref)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/vm_util.py\", line 1394, in power_on_instance\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     session._wait_for_task(poweron_task)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/driver.py\", line 681, in _wait_for_task\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     return self.wait_for_task(task_ref)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/oslo_vmware/api.py\", line 380, in wait_for_task\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     return evt.wait()\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 121, in wait\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     return hubs.get_hub().switch()\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 294, in switch\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     return self.greenlet.switch()\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/oslo_vmware/common/loopingcall.py\", line 76, in _inner\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     self.f(*self.args, **self.kw)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/oslo_vmware/api.py\", line 417, in _poll_task\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     raise task_ex\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05] VMwareDriverException: Disk '/vmfs/volumes/546a3532-ca1f27f1-e66a-1458d04cf670/volume-dbbdd17d-bb5c-4804-9d30-a6bd8a96eca3/volume-dbbdd17d-bb5c-4804-9d30-a6bd8a96eca3.vmdk' cannot be opened for writing. It might be shared with some other VM.\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]", 
    "tags": [
        "rebuild", 
        "vmware"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1563684", 
    "owner": "None", 
    "id": 1563684, 
    "index": 4497, 
    "openned": "2016-03-30 06:35:47.071757+00:00", 
    "created": "2016-03-30 06:35:47.071757+00:00", 
    "title": "VMware: rebuild an instance failed", 
    "comments": [
        {
            "content": "Description\n===================\nNova version: master\nVirt driver: VCDriver\n\n\n\nSteps to reproduce\n=====================\n1. Nova boot an instance.\n2. Cinder create a volume.\n3. Attach volume to the instance.\n4. After attached success,  using nova image-create command, create a snapshot for the instance.\n5. Rebuild the instance with snapshot image.\n\nIn nova-compute, error info:\n2016-03-30 12:16:14.801 9290 DEBUG oslo_vmware.exceptions [-] Fault GenericVmConfigFault not matched. get_fault_class /usr/lib/python2.7/site-packages/oslo_vmware/exceptions.py:250\n2016-03-30 12:16:14.801 9290 ERROR oslo_vmware.common.loopingcall [-] in fixed duration looping call\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall Traceback (most recent call last):\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall   File \"/usr/lib/python2.7/site-packages/oslo_vmware/common/loopingcall.py\", line 76, in _inner\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall     self.f(*self.args, **self.kw)\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall   File \"/usr/lib/python2.7/site-packages/oslo_vmware/api.py\", line 417, in _poll_task\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall     raise task_ex\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall VMwareDriverException: Disk '/vmfs/volumes/546a3532-ca1f27f1-e66a-1458d04cf670/volume-dbbdd17d-bb5c-4804-9d30-a6bd8a96eca3/volume-dbbdd17d-bb5c-4804-9d30-a6bd8a96eca3.vmdk' cannot be opened for writing. It might be shared with some other VM.\n2016-03-30 12:16:14.801 9290 TRACE oslo_vmware.common.loopingcall\n2016-03-30 12:16:14.802 9290 ERROR nova.compute.manager [req-b0c16cc2-fd52-4c85-9ff9-c67ff68ee410 4412e38ec9814b96a03e63097ec51f1a 8f75187cd29f4715881f450646fc6e08 - - -] [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05] Setting instance vm_state to ERROR\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05] Traceback (most recent call last):\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 6418, in _error_out_instance_on_exception\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     yield\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 3087, in rebuild_instance\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     self._rebuild_default_impl(**kwargs)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2934, in _rebuild_default_impl\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     block_device_info=new_block_device_info)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/driver.py\", line 481, in spawn\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     admin_password, network_info, block_device_info)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/vmops.py\", line 683, in spawn\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     vm_util.power_on_instance(self._session, instance, vm_ref=vm_ref)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/vm_util.py\", line 1394, in power_on_instance\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     session._wait_for_task(poweron_task)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/nova/virt/vmwareapi/driver.py\", line 681, in _wait_for_task\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     return self.wait_for_task(task_ref)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/oslo_vmware/api.py\", line 380, in wait_for_task\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     return evt.wait()\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 121, in wait\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     return hubs.get_hub().switch()\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 294, in switch\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     return self.greenlet.switch()\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/oslo_vmware/common/loopingcall.py\", line 76, in _inner\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     self.f(*self.args, **self.kw)\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]   File \"/usr/lib/python2.7/site-packages/oslo_vmware/api.py\", line 417, in _poll_task\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]     raise task_ex\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05] VMwareDriverException: Disk '/vmfs/volumes/546a3532-ca1f27f1-e66a-1458d04cf670/volume-dbbdd17d-bb5c-4804-9d30-a6bd8a96eca3/volume-dbbdd17d-bb5c-4804-9d30-a6bd8a96eca3.vmdk' cannot be opened for writing. It might be shared with some other VM.\n2016-03-30 12:16:14.802 9290 TRACE nova.compute.manager [instance: e338fd04-859f-4fa4-8f1d-cd2e297b0c05]", 
            "date_created": "2016-03-30 06:35:47.071757+00:00", 
            "author": "https://api.launchpad.net/1.0/~hellochosen"
        }, 
        {
            "content": "Could you please let us know if that issue is also reproducible on the previous stable version, ie. Liberty ?\n", 
            "date_created": "2016-03-30 13:39:32.921457+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "@Sylvain, I also test in Kilo, it can reproduced.  For Liberty, I had not tested, maybe the issue can reproduced.", 
            "date_created": "2016-03-30 13:54:23.585524+00:00", 
            "author": "https://api.launchpad.net/1.0/~hellochosen"
        }, 
        {
            "content": "vipin can you take a look?", 
            "date_created": "2016-03-30 14:22:37.128480+00:00", 
            "author": "https://api.launchpad.net/1.0/~tjones-i"
        }, 
        {
            "content": "@Slvain - this patch most probably address this - https://review.openstack.org/#/c/218639/. So can you please review.", 
            "date_created": "2016-03-31 04:00:39.322779+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "\nThere are no currently open reviews on this bug, changing\nthe status back to the previous state and unassigning. If\nthere are active reviews related to this bug, please include\nlinks in comments.\n", 
            "date_created": "2017-06-23 12:32:08.029693+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "\nThere are no currently open reviews on this bug, changing\nthe status back to the previous state and unassigning. If\nthere are active reviews related to this bug, please include\nlinks in comments.\n", 
            "date_created": "2017-06-23 12:32:49.982631+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "\nThere are no currently open reviews on this bug, changing\nthe status back to the previous state and unassigning. If\nthere are active reviews related to this bug, please include\nlinks in comments.\n", 
            "date_created": "2017-06-23 12:33:26.730443+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}