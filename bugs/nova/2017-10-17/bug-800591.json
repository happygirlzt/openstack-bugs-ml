{
    "status": "Invalid", 
    "last_updated": "2011-06-28 14:08:28.796389+00:00", 
    "description": "Hi, \nI've a server running nova-volumes and a compute-node. Both servers are running Ubuntu 10.04 LTS.\nThe compute-node has open-iscsi package installed on it.\n\nWhen I run an euca-attach volume for an instance, it works fine.\nNow, If I try to attache another volume to another instance, i've the following trace into nova-compute.log : \nhttp://paste.openstack.org/\n\nThe first time I try to attach it, there is no error, but the line : \n\n2011-06-22 11:49:28,807 AUDIT nova.compute.manager [AX678B9WGP8DERIYVTP5 nuage-and-co nuage-and-co] instance 136: attaching volume 10 to \\/dev\\/sdg\n\n\nWhen I check the volume attachment via euca-describe volumes : \nVOLUME\tvol-0000000a\t 50\t\tnova\tavailable (nuage, nova-cc1, None, None)\t2011-06-22T09:47:42Z\n\nSo it remains available. So I try a second time, but then I've the iscsi error that you can see into my paste.\nIf I look at the portal : \n\n\niSCSI Transport Class version 2.0-870\nversion 2.0-871\nTarget: iqn.2010-10.org.openstack:volume-00000007\n\tCurrent Portal: 172.16.40.244:3260,1\n\tPersistent Portal: 172.16.40.244:3260,1\n\t\t**********\n\t\tInterface:\n\t\t**********\n\t\tIface Name: default\n\t\tIface Transport: tcp\n\t\tIface Initiatorname: iqn.1993-08.org.debian:01:a82929197c4b\n\t\tIface IPaddress: 172.16.40.247\n\t\tIface HWaddress: (null)\n\t\tIface Netdev: (null)\n\t\tSID: 2\n\t\tiSCSI Connection State: LOGGED IN\n\t\tiSCSI Session State: LOGGED_IN\n\t\tInternal iscsid Session State: NO CHANGE\n\t\t************************\n\t\tNegotiated iSCSI params:\n\t\t************************\n\t\tHeaderDigest: None\n\t\tDataDigest: None\n\t\tMaxRecvDataSegmentLength: 262144\n\t\tMaxXmitDataSegmentLength: 8192\n\t\tFirstBurstLength: 65536\n\t\tMaxBurstLength: 262144\n\t\tImmediateData: Yes\n\t\tInitialR2T: Yes\n\t\tMaxOutstandingR2T: 1\n\t\t************************\n\t\tAttached SCSI devices:\n\t\t************************\n\t\tHost Number: 1\tState: running\n\t\tscsi1 Channel 00 Id 0 Lun: 0\n\t\t\tAttached scsi disk sda\t\tState: running\n\n\n\nAnd the discovery mode returns the following paths : \n\nroot@nova-cn1:~# iscsiadm -m discovery -t st -p 172.16.40.244\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-00000004\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-00000004\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-00000004\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-00000007\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-00000007\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-00000007\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-00000009\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-00000009\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-00000009\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n\n\n\nThanks", 
    "tags": [
        "attachment", 
        "compute", 
        "iscsi", 
        "volume"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/800591", 
    "owner": "None", 
    "id": 800591, 
    "index": 3443, 
    "openned": "2011-06-22 09:57:31.299819+00:00", 
    "created": "2011-06-22 09:57:31.299819+00:00", 
    "title": "Unable to attache more than one volume to a compute-node", 
    "comments": [
        {
            "content": "Hi, \nI've a server running nova-volumes and a compute-node. Both servers are running Ubuntu 10.04 LTS.\nThe compute-node has open-iscsi package installed on it.\n\nWhen I run an euca-attach volume for an instance, it works fine.\nNow, If I try to attache another volume to another instance, i've the following trace into nova-compute.log : \nhttp://paste.openstack.org/\n\nThe first time I try to attach it, there is no error, but the line : \n\n2011-06-22 11:49:28,807 AUDIT nova.compute.manager [AX678B9WGP8DERIYVTP5 nuage-and-co nuage-and-co] instance 136: attaching volume 10 to \\/dev\\/sdg\n\n\nWhen I check the volume attachment via euca-describe volumes : \nVOLUME\tvol-0000000a\t 50\t\tnova\tavailable (nuage, nova-cc1, None, None)\t2011-06-22T09:47:42Z\n\nSo it remains available. So I try a second time, but then I've the iscsi error that you can see into my paste.\nIf I look at the portal : \n\n\niSCSI Transport Class version 2.0-870\nversion 2.0-871\nTarget: iqn.2010-10.org.openstack:volume-00000007\n\tCurrent Portal: 172.16.40.244:3260,1\n\tPersistent Portal: 172.16.40.244:3260,1\n\t\t**********\n\t\tInterface:\n\t\t**********\n\t\tIface Name: default\n\t\tIface Transport: tcp\n\t\tIface Initiatorname: iqn.1993-08.org.debian:01:a82929197c4b\n\t\tIface IPaddress: 172.16.40.247\n\t\tIface HWaddress: (null)\n\t\tIface Netdev: (null)\n\t\tSID: 2\n\t\tiSCSI Connection State: LOGGED IN\n\t\tiSCSI Session State: LOGGED_IN\n\t\tInternal iscsid Session State: NO CHANGE\n\t\t************************\n\t\tNegotiated iSCSI params:\n\t\t************************\n\t\tHeaderDigest: None\n\t\tDataDigest: None\n\t\tMaxRecvDataSegmentLength: 262144\n\t\tMaxXmitDataSegmentLength: 8192\n\t\tFirstBurstLength: 65536\n\t\tMaxBurstLength: 262144\n\t\tImmediateData: Yes\n\t\tInitialR2T: Yes\n\t\tMaxOutstandingR2T: 1\n\t\t************************\n\t\tAttached SCSI devices:\n\t\t************************\n\t\tHost Number: 1\tState: running\n\t\tscsi1 Channel 00 Id 0 Lun: 0\n\t\t\tAttached scsi disk sda\t\tState: running\n\n\n\nAnd the discovery mode returns the following paths : \n\nroot@nova-cn1:~# iscsiadm -m discovery -t st -p 172.16.40.244\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-00000004\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-00000004\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-00000004\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-00000004\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-00000007\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-00000007\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-00000007\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-00000007\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-00000009\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-00000009\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-00000009\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-00000009\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n\n\n\nThanks", 
            "date_created": "2011-06-22 09:57:31.299819+00:00", 
            "author": "https://api.launchpad.net/1.0/~razique"
        }, 
        {
            "content": "Sorry,\nhere is the good paste : \nhttp://paste.openstack.org/show/1733/", 
            "date_created": "2011-06-22 10:00:39.344544+00:00", 
            "author": "https://api.launchpad.net/1.0/~razique"
        }, 
        {
            "content": "Ok, after I ran an analyse, I figured that due to the iscsi multipathing, during the discovery, the target uses instances's public ip as an iscsi path  : \n\n192.168.122.1:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.77:3260,1 iqn.2010-10.org.openstack:volume-0000000a <---- FLOATING IP\n172.16.40.244:3260,1 iqn.2010-10.org.openstack:volume-0000000a \n172.16.40.76:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n10.0.1.1:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.245:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n169.254.169.254:3260,1 iqn.2010-10.org.openstack:volume-0000000a\n172.16.40.78:3260,1 iqn.2010-10.org.openstack:volume-0000000a <----- FLOATING IP\n\ntheses ip are used during the iscsi login : \n'iscsiadm: Could not login to [iface: default, target: iqn.2010-10.org.openstack:volume-0000000a, portal: 172.16.40.77,3260\n\nBut it won't work since this IP is incorrect ; is it possible to exclude floating ips as paths from the iscsi target ?", 
            "date_created": "2011-06-28 12:17:33.519110+00:00", 
            "author": "https://api.launchpad.net/1.0/~razique"
        }, 
        {
            "content": "I figured it out!\nYou need to dedicate a network for the iscsi traffic, if you want the multipathing; or set explicitely the exact ip adress you would like to use  : \n--iscsi_ip_prefix=$cloud_ip or $whatever\ndo no forget to set it on the compute-node(s)' conf and on the server which runs the nova-volume service ", 
            "date_created": "2011-06-28 13:56:20.782247+00:00", 
            "author": "https://api.launchpad.net/1.0/~razique"
        }
    ], 
    "closed": "2011-06-28 14:08:27.791237+00:00"
}