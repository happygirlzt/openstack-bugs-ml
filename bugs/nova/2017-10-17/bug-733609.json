{
    "status": "Fix Released", 
    "last_updated": "2011-04-15 08:34:32.203092+00:00", 
    "description": "Tested trunk on Revision no 790.\n\nIf I start a new instance, it fails to spawn.\nDescribeInstance status - Failed to spawn\n\nnova-compute.log\n-------------------------\n2011-03-11 15:56:56,283 AUDIT nova.compute.manager [UEGXDCVTAY-IA6K1ILRO admin admin] instance 1: starting...\n2011-03-11 15:56:56,399 DEBUG nova.rpc [-] Making asynchronous call... from (pid=17161) call /home/tpatil/recent/nova/nova/rpc.py:314\n2011-03-11 15:56:56,399 DEBUG nova.rpc [-] MSG_ID is 5af3fe3eb20c47f5869fe3099c45c145 from (pid=17161) call /home/tpatil/recent/nova/nova/rpc.py:317\n2011-03-11 15:56:56,683 DEBUG nova.rpc [-] Making asynchronous call... from (pid=17161) call /home/tpatil/recent/nova/nova/rpc.py:314\n2011-03-11 15:56:56,684 DEBUG nova.rpc [-] MSG_ID is 5879905adc35407da03777f6bd77818a from (pid=17161) call /home/tpatil/recent/nova/nova/rpc.py:317\n2011-03-11 15:56:57,103 DEBUG nova.virt.libvirt_conn [-] instance instance-00000001: starting toXML method from (pid=17161) to_xml /home/tpatil/recent/nova/nova/virt/libvirt_conn.py:679\n2011-03-11 15:56:57,224 DEBUG nova.virt.libvirt_conn [-] instance instance-00000001: finished toXML method from (pid=17161) to_xml /home/tpatil/recent/nova/nova/virt/libvirt_conn.py:748\n2011-03-11 15:56:57,264 INFO nova [-] called setup_basic_filtering in nwfilter\n2011-03-11 15:56:57,264 INFO nova [-] ensuring static filters\n2011-03-11 15:56:57,424 INFO nova [-] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x96a1cec>\n2011-03-11 15:56:57,424 INFO nova [-] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x96a1a8c>\n2011-03-11 15:56:57,438 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,446 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,454 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,460 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,466 DEBUG nova.utils [-] Running cmd (subprocess): sudo ip6tables-save -t filter from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,473 DEBUG nova.utils [-] Running cmd (subprocess): sudo ip6tables-restore from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,479 DEBUG nova.utils [-] Result was 2 from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:161\n2011-03-11 15:56:57,479 DEBUG nova.utils [-] ['sudo', 'ip6tables-restore'] failed. Retrying. from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:178\n2011-03-11 15:56:58,085 DEBUG nova.utils [-] Running cmd (subprocess): sudo ip6tables-restore from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:58,085 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/exception.py\", line 120, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/virt/libvirt_conn.py\", line 407, in spawn\n(nova.exception): TRACE:     self.firewall_driver.prepare_instance_filter(instance)\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/virt/libvirt_conn.py\", line 1252, in prepare_instance_filter\n(nova.exception): TRACE:     self.iptables.apply()\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/utils.py\", line 524, in inner\n(nova.exception): TRACE:     return f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/network/linux_net.py\", line 302, in apply\n(nova.exception): TRACE:     attempts=5)\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/utils.py\", line 153, in execute\n(nova.exception): TRACE:     stdout=stdout, stderr=stderr, env=env)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/green/subprocess.py\", line 25, in __init__\n(nova.exception): TRACE:     subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n(nova.exception): TRACE:   File \"/usr/lib/python2.6/subprocess.py\", line 626, in __init__\n(nova.exception): TRACE:     errread, errwrite) = self._get_handles(stdin, stdout, stderr)\n(nova.exception): TRACE:   File \"/usr/lib/python2.6/subprocess.py\", line 983, in _get_handles\n(nova.exception): TRACE:     c2pwrite = stdout.fileno()\n(nova.exception): TRACE: AttributeError: 'str' object has no attribute 'fileno'\n(nova.exception): TRACE:\n2011-03-11 15:56:58,087 ERROR nova.compute.manager [UEGXDCVTAY-IA6K1ILRO admin admin] instance 1: Failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/home/tpatil/recent/nova/nova/compute/manager.py\", line 213, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/home/tpatil/recent/nova/nova/exception.py\", line 126, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: 'str' object has no attribute 'fileno'", 
    "tags": [], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/733609", 
    "owner": "https://api.launchpad.net/1.0/~soren", 
    "id": 733609, 
    "index": 372, 
    "openned": "2011-03-12 00:06:01.513068+00:00", 
    "created": "2011-03-12 00:06:01.513068+00:00", 
    "title": "Failed to spawn an instance :  AttributeError: 'str' object has no attribute 'fileno'", 
    "comments": [
        {
            "content": "Tested trunk on Revision no 790.\n\nIf I start a new instance, it fails to spawn.\nDescribeInstance status - Failed to spawn\n\nnova-compute.log\n-------------------------\n2011-03-11 15:56:56,283 AUDIT nova.compute.manager [UEGXDCVTAY-IA6K1ILRO admin admin] instance 1: starting...\n2011-03-11 15:56:56,399 DEBUG nova.rpc [-] Making asynchronous call... from (pid=17161) call /home/tpatil/recent/nova/nova/rpc.py:314\n2011-03-11 15:56:56,399 DEBUG nova.rpc [-] MSG_ID is 5af3fe3eb20c47f5869fe3099c45c145 from (pid=17161) call /home/tpatil/recent/nova/nova/rpc.py:317\n2011-03-11 15:56:56,683 DEBUG nova.rpc [-] Making asynchronous call... from (pid=17161) call /home/tpatil/recent/nova/nova/rpc.py:314\n2011-03-11 15:56:56,684 DEBUG nova.rpc [-] MSG_ID is 5879905adc35407da03777f6bd77818a from (pid=17161) call /home/tpatil/recent/nova/nova/rpc.py:317\n2011-03-11 15:56:57,103 DEBUG nova.virt.libvirt_conn [-] instance instance-00000001: starting toXML method from (pid=17161) to_xml /home/tpatil/recent/nova/nova/virt/libvirt_conn.py:679\n2011-03-11 15:56:57,224 DEBUG nova.virt.libvirt_conn [-] instance instance-00000001: finished toXML method from (pid=17161) to_xml /home/tpatil/recent/nova/nova/virt/libvirt_conn.py:748\n2011-03-11 15:56:57,264 INFO nova [-] called setup_basic_filtering in nwfilter\n2011-03-11 15:56:57,264 INFO nova [-] ensuring static filters\n2011-03-11 15:56:57,424 INFO nova [-] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x96a1cec>\n2011-03-11 15:56:57,424 INFO nova [-] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x96a1a8c>\n2011-03-11 15:56:57,438 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t filter from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,446 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,454 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-save -t nat from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,460 DEBUG nova.utils [-] Running cmd (subprocess): sudo iptables-restore from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,466 DEBUG nova.utils [-] Running cmd (subprocess): sudo ip6tables-save -t filter from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,473 DEBUG nova.utils [-] Running cmd (subprocess): sudo ip6tables-restore from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:57,479 DEBUG nova.utils [-] Result was 2 from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:161\n2011-03-11 15:56:57,479 DEBUG nova.utils [-] ['sudo', 'ip6tables-restore'] failed. Retrying. from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:178\n2011-03-11 15:56:58,085 DEBUG nova.utils [-] Running cmd (subprocess): sudo ip6tables-restore from (pid=17161) execute /home/tpatil/recent/nova/nova/utils.py:148\n2011-03-11 15:56:58,085 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/exception.py\", line 120, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/virt/libvirt_conn.py\", line 407, in spawn\n(nova.exception): TRACE:     self.firewall_driver.prepare_instance_filter(instance)\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/virt/libvirt_conn.py\", line 1252, in prepare_instance_filter\n(nova.exception): TRACE:     self.iptables.apply()\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/utils.py\", line 524, in inner\n(nova.exception): TRACE:     return f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/network/linux_net.py\", line 302, in apply\n(nova.exception): TRACE:     attempts=5)\n(nova.exception): TRACE:   File \"/home/tpatil/recent/nova/nova/utils.py\", line 153, in execute\n(nova.exception): TRACE:     stdout=stdout, stderr=stderr, env=env)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/green/subprocess.py\", line 25, in __init__\n(nova.exception): TRACE:     subprocess_orig.Popen.__init__(self, args, 0, *argss, **kwds)\n(nova.exception): TRACE:   File \"/usr/lib/python2.6/subprocess.py\", line 626, in __init__\n(nova.exception): TRACE:     errread, errwrite) = self._get_handles(stdin, stdout, stderr)\n(nova.exception): TRACE:   File \"/usr/lib/python2.6/subprocess.py\", line 983, in _get_handles\n(nova.exception): TRACE:     c2pwrite = stdout.fileno()\n(nova.exception): TRACE: AttributeError: 'str' object has no attribute 'fileno'\n(nova.exception): TRACE:\n2011-03-11 15:56:58,087 ERROR nova.compute.manager [UEGXDCVTAY-IA6K1ILRO admin admin] instance 1: Failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/home/tpatil/recent/nova/nova/compute/manager.py\", line 213, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/home/tpatil/recent/nova/nova/exception.py\", line 126, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: 'str' object has no attribute 'fileno'", 
            "date_created": "2011-03-12 00:06:01.513068+00:00", 
            "author": "https://api.launchpad.net/1.0/~tpatil"
        }, 
        {
            "content": "It seems that there are two problems.\n\n1. retry logic of utils.execute has some problem.\n2. ip6tables does not have sg-fallback rule.\n\nPlease review attached patch.\n", 
            "date_created": "2011-03-14 06:48:19.308225+00:00", 
            "author": "https://api.launchpad.net/1.0/~iida-koji"
        }
    ], 
    "closed": "2011-04-15 08:34:30.873347+00:00"
}