{
    "status": "Fix Released", 
    "last_updated": "2017-06-08 21:52:15.995493+00:00", 
    "description": "A mechanism to validate query parameters using json schema was added in the following series:\n\n    https://review.openstack.org/#/q/topic:bp/consistent-query-parameters-validation\n\nThe resulting error messages aren't very user friendly though. For example, if you pass an invalid limit to os-keypairs list, you used to get a custom message rather than the obscure message generated by json schema.\n\nBefore:\n\n    webob.exc.HTTPBadRequest: Invalid input received: limit must be an integer\n\nAfter:\n\n    nova.exception.ValidationError: Invalid input for query parameters 0. Value: abc. u'abc' does not match '^[0-9]*$'\n\nThe exception raised also changed, which may be problematic for API consumers.\n\nWe probably need another layer to transform these generated messages into something more user friendly, and perhaps consider raising HTTPBadRequest again with the nicer error message.", 
    "tags": [
        "api"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1655710", 
    "owner": "https://api.launchpad.net/1.0/~xuhj", 
    "id": 1655710, 
    "index": 4729, 
    "openned": "2017-01-11 17:03:10.932541+00:00", 
    "created": "2017-01-11 17:03:10.932541+00:00", 
    "title": "Query parameter validation using json schema - error messages", 
    "comments": [
        {
            "content": "A mechanism to validate query parameters using json schema was added in the following series:\n\n    https://review.openstack.org/#/q/topic:bp/consistent-query-parameters-validation\n\nThe resulting error messages aren't very user friendly though. For example, if you pass an invalid limit to os-keypairs list, you used to get a custom message rather than the obscure message generated by json schema.\n\nBefore:\n\n    webob.exc.HTTPBadRequest: Invalid input received: limit must be an integer\n\nAfter:\n\n    nova.exception.ValidationError: Invalid input for query parameters 0. Value: abc. u'abc' does not match '^[0-9]*$'\n\nThe exception raised also changed, which may be problematic for API consumers.\n\nWe probably need another layer to transform these generated messages into something more user friendly, and perhaps consider raising HTTPBadRequest again with the nicer error message.", 
            "date_created": "2017-01-11 17:03:10.932541+00:00", 
            "author": "https://api.launchpad.net/1.0/~diana-clarke"
        }, 
        {
            "content": "\"The exception raised also changed, which may be problematic for API consumers.\"\n\nDo you still get a 400 response from the API?  I'm assuming you do, in which case I think that's OK.", 
            "date_created": "2017-01-11 17:06:32.450161+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "\"Do you still get a 400 response from the API? I'm assuming you do, in which case I think that's OK.\"\n\nYes, silly me. For some reason I was thinking this was the exception you would see from the python-novaclient Python API.", 
            "date_created": "2017-01-11 17:23:25.350291+00:00", 
            "author": "https://api.launchpad.net/1.0/~diana-clarke"
        }, 
        {
            "content": "yea, at least \"Invalid input for query parameters 0\" confuse the API user. I guess the \"0\" is due to the query parameters is converted to array.\n", 
            "date_created": "2017-01-12 03:16:15.298941+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }, 
        {
            "content": "yes, pdb shows seems jsonschema/_validators.py\n\ndef items(validator, items, instance, schema):\n\nthis function will add item index (0 in this case) into path and we will report it ", 
            "date_created": "2017-01-13 09:20:29.945545+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "{'__cause__': None, 'parent': None, 'relative_path': deque(['limit', 1]), 'relative_schema_path': deque(['properties', 'limit', 'items', 'pattern']), 'instance': u'-2', 'schema_path': deque(['properties', 'limit', 'items', 'pattern']), 'validator': 'pattern', 'context': [], 'path': deque(['limit', 1]), 'message': \"u'-2' does not match '^[0-9]*$'\", 'schema': {'pattern': '^[0-9]*$', 'minimum': 0, 'type': ['integer', 'string']}, 'cause': None, 'validator_value': '^[0-9]*$'}\n\n\nuse this query\ncurl -g -i -X GET http://192.168.122.82:8774/v2.1/os-keypairs?limit=1\\&limit=-2 \n\nso can we check whether 'items' in schema path then print path[-2] ?", 
            "date_created": "2017-01-13 09:36:31.541432+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/465785", 
            "date_created": "2017-05-18 02:34:54.159049+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/465785\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=5e51fed4a0f75ec6c97cd2582d89584b9364ccfc\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5e51fed4a0f75ec6c97cd2582d89584b9364ccfc\nAuthor: He Jie Xu <email address hidden>\nDate:   Thu May 18 10:52:54 2017 +0800\n\n    Correct the error message for query parameter validation\n    \n    Currently the error message returned by failed query parameter validation\n    didn't include correct parameter name. This patch correct that.\n    \n    Change-Id: Ifd0b37084709c2728749b5b7b317f304b0488269\n    Closes-Bug: #1655710\n", 
            "date_created": "2017-05-19 05:17:10.026384+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b2 development milestone.", 
            "date_created": "2017-06-08 21:52:15.252233+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-05-19 05:17:07.010982+00:00"
}