{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:02:48.543850+00:00", 
    "description": "Disabling/enabling hosts ends with 400 response, but in logs i see 'Setting host cc to disabled' and the request is then forwarded to nova-compute.\n\nHere are the steps.\n\nFirst I'm making the following request:\n\nPUT os-hosts/cc with body {\"status\" : \"disable\"}\n\nIn the nova-api.log I see my request\n\n2012-10-03 11:48:59 INFO nova.api.openstack.wsgi [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] PUT http://localhost:8774/v1.1/4674d940971f4532a8747baf1af30d9b/os-hosts/cc?ignore_awful_caching1349257739\n2012-10-03 11:48:59 AUDIT nova.api.openstack.compute.contrib.hosts [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] Setting host cc to disabled.\n2012-10-03 11:48:59 DEBUG nova.rpc.amqp [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] Making asynchronous call on compute.cc ... from (pid=16703) multicall /usr/lib/python2.7/dist-packages/nova/rpc/amqp.py:326\n2012-10-03 11:48:59 DEBUG nova.rpc.amqp [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] MSG_ID is 2bc447466a644e37bf9ec1c20ac51757 from (pid=16703) multicall /usr/lib/python2.7/dist-packages/nova/rpc/amqp.py:329\n2012-10-03 11:49:00 INFO nova.api.openstack.wsgi [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] HTTP exception thrown: None\n2012-10-03 11:49:00 INFO nova.api.openstack.wsgi [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] http://localhost:8774/v1.1/4674d940971f4532a8747baf1af30d9b/os-hosts/cc?ignore_awful_caching1349257739 returned with HTTP 400\n\nThen in nova-compute.log i see\n\n2012-10-03 11:48:59 DEBUG nova.rpc.amqp [-] received {u'_context_roles': [u'admin'], u'_msg_id': u'2bc447466a644e37bf9ec1c20ac51757', u'_context_read_deleted': u'no', u'_context_request_id': u'req-66e9dcf9-19c4-41de-8232-32834137f04d', u'args': {u'enabled': False}, u'_context_auth_token': '<SANITIZED>', u'_context_is_admin': True, u'_context_project_id': u'4674d940971f4532a8747baf1af30d9b', u'_context_timestamp': u'2012-10-03T09:48:59.977461', u'_context_user_id': u'941cdd94696e474a951d5ed112d4d4c9', u'method': u'set_host_enabled', u'_context_remote_address': u'127.0.0.1'} from (pid=17768) _safe_log /usr/lib/python2.7/dist-packages/nova/rpc/common.py:160\n2012-10-03 11:48:59 DEBUG nova.rpc.amqp [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] unpacked context: {'user_id': u'941cdd94696e474a951d5ed112d4d4c9', 'roles': [u'admin'], 'timestamp': '2012-10-03T09:48:59.977461', 'auth_token': '<SANITIZED>', 'remote_address': u'127.0.0.1', 'is_admin': True, 'request_id': u'req-66e9dcf9-19c4-41de-8232-32834137f04d', 'project_id': u'4674d940971f4532a8747baf1af30d9b', 'read_deleted': u'no'} from (pid=17768) _safe_log /usr/lib/python2.7/dist-packages/nova/rpc/common.py:160\n\nbut host's status doesn't get changed.\n\nMy version is 2012.1.1-9", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1060884", 
    "owner": "https://api.launchpad.net/1.0/~markmc", 
    "id": 1060884, 
    "index": 3089, 
    "openned": "2012-10-03 11:04:59.307029+00:00", 
    "created": "2012-10-03 11:04:59.307029+00:00", 
    "title": "Disabling/enabling host via API returns HTTP 400 Bad Request", 
    "comments": [
        {
            "content": "Disabling/enabling hosts ends with 400 response, but in logs i see 'Setting host cc to disabled' and the request is then forwarded to nova-compute.\n\nHere are the steps, I'm making the following request.\n\nPUT os-hosts/cc with body {\"status\" : \"disable\"}\n\nIn the nova-api.log I see my request\n\n2012-10-03 11:48:59 INFO nova.api.openstack.wsgi [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] PUT http://localhost:8774/v1.1/4674d940971f4532a8747baf1af30d9b/os-hosts/cc?ignore_awful_caching1349257739\n2012-10-03 11:48:59 AUDIT nova.api.openstack.compute.contrib.hosts [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] Setting host cc to disabled.\n2012-10-03 11:48:59 DEBUG nova.rpc.amqp [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] Making asynchronous call on compute.cc ... from (pid=16703) multicall /usr/lib/python2.7/dist-packages/nova/rpc/amqp.py:326\n2012-10-03 11:48:59 DEBUG nova.rpc.amqp [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] MSG_ID is 2bc447466a644e37bf9ec1c20ac51757 from (pid=16703) multicall /usr/lib/python2.7/dist-packages/nova/rpc/amqp.py:329\n2012-10-03 11:49:00 INFO nova.api.openstack.wsgi [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] HTTP exception thrown: None\n2012-10-03 11:49:00 INFO nova.api.openstack.wsgi [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] http://localhost:8774/v1.1/4674d940971f4532a8747baf1af30d9b/os-hosts/cc?ignore_awful_caching1349257739 returned with HTTP 400\n\nThen in nova-compute.log i see \n\n2012-10-03 11:48:59 DEBUG nova.rpc.amqp [-] received {u'_context_roles': [u'admin'], u'_msg_id': u'2bc447466a644e37bf9ec1c20ac51757', u'_context_read_deleted': u'no', u'_context_request_id': u'req-66e9dcf9-19c4-41de-8232-32834137f04d', u'args': {u'enabled': False}, u'_context_auth_token': '<SANITIZED>', u'_context_is_admin': True, u'_context_project_id': u'4674d940971f4532a8747baf1af30d9b', u'_context_timestamp': u'2012-10-03T09:48:59.977461', u'_context_user_id': u'941cdd94696e474a951d5ed112d4d4c9', u'method': u'set_host_enabled', u'_context_remote_address': u'127.0.0.1'} from (pid=17768) _safe_log /usr/lib/python2.7/dist-packages/nova/rpc/common.py:160\n2012-10-03 11:48:59 DEBUG nova.rpc.amqp [req-66e9dcf9-19c4-41de-8232-32834137f04d 941cdd94696e474a951d5ed112d4d4c9 4674d940971f4532a8747baf1af30d9b] unpacked context: {'user_id': u'941cdd94696e474a951d5ed112d4d4c9', 'roles': [u'admin'], 'timestamp': '2012-10-03T09:48:59.977461', 'auth_token': '<SANITIZED>', 'remote_address': u'127.0.0.1', 'is_admin': True, 'request_id': u'req-66e9dcf9-19c4-41de-8232-32834137f04d', 'project_id': u'4674d940971f4532a8747baf1af30d9b', 'read_deleted': u'no'} from (pid=17768) _safe_log /usr/lib/python2.7/dist-packages/nova/rpc/common.py:160\n\nbut host status is not changed. \n\nMy version is 2012.1.1-9", 
            "date_created": "2012-10-03 11:04:59.307029+00:00", 
            "author": "https://api.launchpad.net/1.0/~wijet-b"
        }, 
        {
            "content": "bug #1086798 needs to be fixed first", 
            "date_created": "2012-12-05 13:50:12.622318+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "With the libvirt diver and latest grizzly, I'm seeing:\n\n $> nova host-update --status disable f17\n ERROR: Bad request (HTTP 400) (Request-ID: req-f746e6c4-e8fe-492d-837d-441b91161181)\n $> nova host-update --maintenance enable f17\n ERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-c75dfe3e-cddb-42b2-a761-2a44576e0886)\n $> nova  host-action --action reboot f17\n ERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-b80718eb-ea22-4a5d-9d5a-8db71b9dc348)\n\n", 
            "date_created": "2012-12-05 15:04:29.436981+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Fix will make it:\n\n $ nova host-update --status disable f17\nERROR: Virt driver does not implement host disabled status. (HTTP 501) (Request-ID: req-b1329b90-f32a-450d-a5c7-0608db3a767b)\n $ nova host-update --maintenance enable f17\nERROR: Virt driver does not implement host maintenance mode. (HTTP 501) (Request-ID: req-e609759a-d788-4025-b99d-29c10c0c1d0c)\n $ nova host-action --action reboot f17\nERROR: Virt driver does not implement host power management. (HTTP 501) (Request-ID: req-158c6dec-725b-4a4a-ac32-384fb95ba91d)\n", 
            "date_created": "2012-12-05 15:27:23.446776+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/17565", 
            "date_created": "2012-12-05 23:14:22.984756+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/17565\nCommitted: http://github.com/openstack/nova/commit/1dc6c806b32044420bf17d3076dd712185b7ac07\nSubmitter: Jenkins\nBranch:    master\n\ncommit 1dc6c806b32044420bf17d3076dd712185b7ac07\nAuthor: Mark McLoughlin <email address hidden>\nDate:   Wed Dec 5 23:13:37 2012 +0000\n\n    Fix handling of unimplemented host actions\n    \n    Fixes bug #1060884\n    \n    Host actions like enable/disable, maintenance mode and power management\n    are not implemented in most virt drivers.\n    \n    In the case of set_host_enabled() in the libvirt driver, we have a no-op\n    implementation. In other cases we have an implementation which raises\n    NotImplementedError. Since the default implementation is to do this, we\n    should just remove the redundant methods from the drivers which don't\n    actually implement these actions. This ensures NotImplementedError is\n    consistently raised.\n    \n    On the API side, rather than looking at the return value of these\n    methods to determine whether they're implemented, we should just catch\n    NotImplementedError and return a sensible error message.\n    \n    In order to do this, we need to ensure the NotImplementedError is\n    properly deserialized from the RemoteError which will encapsualte\n    it. The fix for bug #1086798 ensures this happens.\n    \n    Finally, add some tests to make sure we properly respond with 501\n    when the virt driver doesn't implement these actions.\n    \n    Change-Id: I2d4fc51a4b16d5230e61bde75915142ea450557d\n", 
            "date_created": "2012-12-11 17:43:25.109782+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-01-09 10:21:06.632712+00:00"
}