{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:13:00.008730+00:00", 
    "description": "If you are using a qcow iamge with an lxc container, starting a lxc container will lead to a kernel oops (attached below), this is due to the nbd being disconnected while the lxc container is still running.\n\nFeb  4 15:10:58 homer kernel: [ 2483.980180] Kernel BUG at ffffffff811c50b4 [verbose debug info unavailable]\nFeb  4 15:10:58 homer kernel: [ 2483.982652] Modules linked in: ebt_arp(F) ebt_ip(F) veth(F) xt_conntrack(F) xt_nat(F) openvswitch ip6table_filter(F) ip6_tables(F) ebtable_nat(F) ebtables(F) xt_state(F) ipt_REJECT(F) xt_CHECKSUM(F) iptable_mangle(F) xt_tc\npudp(F) iptable_filter(F) ipt_MASQUERADE(F) iptable_nat(F) nf_conntrack_ipv4(F) nf_defrag_ipv4(F) nf_nat_ipv4(F) nf_nat(F) nf_conntrack(F) ip_tables(F) x_tables(F) bridge(F) stp(F) llc(F) ib_iser rdma_cm ib_addr iw_cm ib_cm ib_sa ib_mad ib_core iscsi_tcp(\nF) libiscsi_tcp(F) libiscsi(F) scsi_transport_iscsi(F) nfsd(F) auth_rpcgss(F) nfs_acl(F) nfs(F) lockd(F) sunrpc(F) fscache(F) dm_crypt(F) arc4(F) rt2800pci rt2800lib snd_hda_codec_hdmi rt2x00pci snd_hda_codec_realtek rt2x00lib snd_hda_intel mac80211 snd_h\nda_codec kvm_amd snd_hwdep(F) cfg80211 kvm snd_pcm(F) snd_page_alloc(F) eeprom_93cx6<4>[ 2484.001668] CPU 0 \nFeb  4 15:10:58 homer kernel: [ 2484.007849] RIP: 0010:[<ffffffff811c50b4>]  [<ffffffff811c50b4>] submit_bh+0x154/0x1e0\nFeb  4 15:10:58 homer kernel: [ 2484.014575] RAX: 0000000000040005 RBX: ffff88006cdbdb60 RCX: 0000000000000019\nFeb  4 15:10:58 homer kernel: [ 2484.021599] RBP: ffff8800cf925aa0 R08: 000000000a000020 R09: 0000000000000000\nFeb  4 15:10:58 homer kernel: [ 2484.028831] R13: ffff880067b5a400 R14: 0000000000005bc8 R15: ffff8801dfb9ec00\nFeb  4 15:10:58 homer kernel: [ 2484.036334] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nFeb  4 15:10:58 homer kernel: [ 2484.044179] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nFeb  4 15:10:58 homer kernel: [ 2484.052237] Process init (pid: 10006, threadinfo ffff8800cf924000, task ffff8801df86dd00)\nFeb  4 15:10:58 homer kernel: [ 2484.060569]  ffff88006cdbdb60 0000000000000411 ffff880067b5a400 0000000000005bc8\nFeb  4 15:10:58 homer kernel: [ 2484.069418]  ffff8800cf925ad0 ffffffff811c6263 ffff8800cf925b18 ffffffff812526e8\nFeb  4 15:10:58 homer kernel: [ 2484.078454]  [<ffffffff811c61d7>] __sync_dirty_buffer+0x57/0xd0\nFeb  4 15:10:58 homer kernel: [ 2484.087813]  [<ffffffff812526e8>] ext4_commit_super+0x198/0x230\nFeb  4 15:10:58 homer kernel: [ 2484.097368]  [<ffffffff81253914>] ext4_error_inode+0x64/0x120\nFeb  4 15:10:58 homer kernel: [ 2484.107094]  [<ffffffff811ca0f7>] ? bio_put+0x97/0xc0\nFeb  4 15:10:58 homer kernel: [ 2484.116986]  [<ffffffff8123bf53>] ext4_find_entry+0x323/0x4e0\nFeb  4 15:10:58 homer kernel: [ 2484.127088]  [<ffffffff8123c162>] ext4_lookup+0x52/0x170\nFeb  4 15:10:58 homer kernel: [ 2484.137356]  [<ffffffff8119d278>] __lookup_hash+0x38/0x50\nFeb  4 15:10:58 homer kernel: [ 2484.147795]  [<ffffffff811a1c09>] path_lookupat+0x6b9/0x740\nFeb  4 15:10:58 homer kernel: [ 2484.158434]  [<ffffffff8117c531>] ? kmem_cache_alloc+0x31/0x130\nFeb  4 15:10:58 homer kernel: [ 2484.169290]  [<ffffffff811a1cc4>] filename_lookup+0x34/0xc0\nFeb  4 15:10:58 homer kernel: [ 2484.180358]  [<ffffffff813071ba>] ? apparmor_cred_prepare+0x3a/0x60\nFeb  4 15:10:58 homer kernel: [ 2484.191661]  [<ffffffff811922ec>] sys_faccessat+0x9c/0x1e0\nFeb  4 15:10:58 homer kernel: [ 2484.203168]  [<ffffffff81192448>] sys_access+0x18/0x20\nFeb  4 15:10:58 homer kernel: [ 2484.214875] Code: e4 a1 44 89 e0 41 5c 41 5d 41 5e 5d c3 66 2e 0f 1f 84 00 00 00 00 00 40 f6 c7 01 0f 84 14 ff ff ff f0 80 66 01 f7 e9 0a ff ff ff <0f> 0b 48 8b 53 70 c1 e0 09 41 f6 c5 01 89 43 30 89 42 08 75 9a \nFeb  4 15:10:58 homer kernel: [ 2484.234017]  RSP <ffff8800cf925a80>\nFeb  4 15:10:58 homer kernel: [ 2484.480951] block nbd3: Attempted send on closed socket", 
    "tags": [
        "lxc"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1115786", 
    "owner": "https://api.launchpad.net/1.0/~zulcss", 
    "id": 1115786, 
    "index": 3222, 
    "openned": "2013-02-05 01:11:02.611826+00:00", 
    "created": "2013-02-05 01:11:02.611826+00:00", 
    "title": "Starting a LXC Container can lead to a kernel oops", 
    "comments": [
        {
            "content": "If you are using a qcow iamge with an lxc container, starting a lxc container will lead to a kernel oops (attached below), this is due to the nbd being disconnected while the lxc container is still running.\n\nFeb  4 15:10:58 homer kernel: [ 2483.980180] Kernel BUG at ffffffff811c50b4 [verbose debug info unavailable]\nFeb  4 15:10:58 homer kernel: [ 2483.982652] Modules linked in: ebt_arp(F) ebt_ip(F) veth(F) xt_conntrack(F) xt_nat(F) openvswitch ip6table_filter(F) ip6_tables(F) ebtable_nat(F) ebtables(F) xt_state(F) ipt_REJECT(F) xt_CHECKSUM(F) iptable_mangle(F) xt_tc\npudp(F) iptable_filter(F) ipt_MASQUERADE(F) iptable_nat(F) nf_conntrack_ipv4(F) nf_defrag_ipv4(F) nf_nat_ipv4(F) nf_nat(F) nf_conntrack(F) ip_tables(F) x_tables(F) bridge(F) stp(F) llc(F) ib_iser rdma_cm ib_addr iw_cm ib_cm ib_sa ib_mad ib_core iscsi_tcp(\nF) libiscsi_tcp(F) libiscsi(F) scsi_transport_iscsi(F) nfsd(F) auth_rpcgss(F) nfs_acl(F) nfs(F) lockd(F) sunrpc(F) fscache(F) dm_crypt(F) arc4(F) rt2800pci rt2800lib snd_hda_codec_hdmi rt2x00pci snd_hda_codec_realtek rt2x00lib snd_hda_intel mac80211 snd_h\nda_codec kvm_amd snd_hwdep(F) cfg80211 kvm snd_pcm(F) snd_page_alloc(F) eeprom_93cx6<4>[ 2484.001668] CPU 0 \nFeb  4 15:10:58 homer kernel: [ 2484.007849] RIP: 0010:[<ffffffff811c50b4>]  [<ffffffff811c50b4>] submit_bh+0x154/0x1e0\nFeb  4 15:10:58 homer kernel: [ 2484.014575] RAX: 0000000000040005 RBX: ffff88006cdbdb60 RCX: 0000000000000019\nFeb  4 15:10:58 homer kernel: [ 2484.021599] RBP: ffff8800cf925aa0 R08: 000000000a000020 R09: 0000000000000000\nFeb  4 15:10:58 homer kernel: [ 2484.028831] R13: ffff880067b5a400 R14: 0000000000005bc8 R15: ffff8801dfb9ec00\nFeb  4 15:10:58 homer kernel: [ 2484.036334] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nFeb  4 15:10:58 homer kernel: [ 2484.044179] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nFeb  4 15:10:58 homer kernel: [ 2484.052237] Process init (pid: 10006, threadinfo ffff8800cf924000, task ffff8801df86dd00)\nFeb  4 15:10:58 homer kernel: [ 2484.060569]  ffff88006cdbdb60 0000000000000411 ffff880067b5a400 0000000000005bc8\nFeb  4 15:10:58 homer kernel: [ 2484.069418]  ffff8800cf925ad0 ffffffff811c6263 ffff8800cf925b18 ffffffff812526e8\nFeb  4 15:10:58 homer kernel: [ 2484.078454]  [<ffffffff811c61d7>] __sync_dirty_buffer+0x57/0xd0\nFeb  4 15:10:58 homer kernel: [ 2484.087813]  [<ffffffff812526e8>] ext4_commit_super+0x198/0x230\nFeb  4 15:10:58 homer kernel: [ 2484.097368]  [<ffffffff81253914>] ext4_error_inode+0x64/0x120\nFeb  4 15:10:58 homer kernel: [ 2484.107094]  [<ffffffff811ca0f7>] ? bio_put+0x97/0xc0\nFeb  4 15:10:58 homer kernel: [ 2484.116986]  [<ffffffff8123bf53>] ext4_find_entry+0x323/0x4e0\nFeb  4 15:10:58 homer kernel: [ 2484.127088]  [<ffffffff8123c162>] ext4_lookup+0x52/0x170\nFeb  4 15:10:58 homer kernel: [ 2484.137356]  [<ffffffff8119d278>] __lookup_hash+0x38/0x50\nFeb  4 15:10:58 homer kernel: [ 2484.147795]  [<ffffffff811a1c09>] path_lookupat+0x6b9/0x740\nFeb  4 15:10:58 homer kernel: [ 2484.158434]  [<ffffffff8117c531>] ? kmem_cache_alloc+0x31/0x130\nFeb  4 15:10:58 homer kernel: [ 2484.169290]  [<ffffffff811a1cc4>] filename_lookup+0x34/0xc0\nFeb  4 15:10:58 homer kernel: [ 2484.180358]  [<ffffffff813071ba>] ? apparmor_cred_prepare+0x3a/0x60\nFeb  4 15:10:58 homer kernel: [ 2484.191661]  [<ffffffff811922ec>] sys_faccessat+0x9c/0x1e0\nFeb  4 15:10:58 homer kernel: [ 2484.203168]  [<ffffffff81192448>] sys_access+0x18/0x20\nFeb  4 15:10:58 homer kernel: [ 2484.214875] Code: e4 a1 44 89 e0 41 5c 41 5d 41 5e 5d c3 66 2e 0f 1f 84 00 00 00 00 00 40 f6 c7 01 0f 84 14 ff ff ff f0 80 66 01 f7 e9 0a ff ff ff <0f> 0b 48 8b 53 70 c1 e0 09 41 f6 c5 01 89 43 30 89 42 08 75 9a \nFeb  4 15:10:58 homer kernel: [ 2484.234017]  RSP <ffff8800cf925a80>\nFeb  4 15:10:58 homer kernel: [ 2484.480951] block nbd3: Attempted send on closed socket", 
            "date_created": "2013-02-05 01:11:02.611826+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "I guess we can workaround it in userland, but I'd think that kernel should not OOPS anyway, so there might be a kernel issue to fix as well.", 
            "date_created": "2013-02-05 09:37:04.382224+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/21217", 
            "date_created": "2013-02-05 15:05:13.193041+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/21217\nCommitted: http://github.com/openstack/nova/commit/00f66513690153125713fa4c48907387d8321b4a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 00f66513690153125713fa4c48907387d8321b4a\nAuthor: Chuck Short <email address hidden>\nDate:   Tue Feb 5 08:54:01 2013 -0600\n\n    lxc: Clean up namespace mounts\n    \n    5f697f64e5c445ba1b62c82d9167fd6b9c7256d2 introduced a regression\n    when using lxc containers with qcow2 and qemu-nbd.\n    \n    When removing the rootfs from the host namespace, it would\n    terminate the qemu-nbd process as well. This would cause\n    the kernel too oops under Ubuntu 13.04. Since the underlying\n    device thtat the libvirt_lxc process disapears.\n    \n    To get around this we just clean up the host namespace if the\n    instance is powered-on. When the instance terminates it will\n    teardown the whole container.\n    \n    This fixes LP: #1115786\n    \n    Change-Id: I98bec2338cb455dbd277295ab36767149e05634c\n    Signed-off-by: Chuck Short <email address hidden>\n", 
            "date_created": "2013-02-07 05:57:40.327436+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-02-21 08:57:01.206443+00:00"
}