{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:56:05.069112+00:00", 
    "description": "'<nosharedpages/>' in xml is not recognized by libvirt. We should modify \"nosharedpages\" to \"nosharepages\".\n\nBecause:\n[root@nail-SBCJ-5-3-3 libvirt]# virsh list\n Id    Name                           State\n----------------------------------------------------\n 2     instance-00000002              running\n 7     instance-00000007              running\n\n[root@nail-SBCJ-5-3-3 libvirt]# \n[root@nail-SBCJ-5-3-3 libvirt]# \n[root@nail-SBCJ-5-3-3 libvirt]# virsh dumpxml 7\n<domain type='kvm' id='7'>\n  <name>instance-00000007</name>\n  <uuid>dda65962-5d55-403a-bdf3-462a17563a74</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"2015.1.0-1.1.44\"/>\n      <nova:name>hanrong5</nova:name>\n      <nova:creationTime>2015-06-29 07:30:51</nova:creationTime>\n      <nova:flavor name=\"hanrong\">\n        <nova:memory>100</nova:memory>\n        <nova:disk>10</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"84ee57c242ca41f09d8a833adc2e2583\">admin</nova:user>\n        <nova:project uuid=\"e35fbf4375b346519d86e2200047ad0e\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"e164982b-e53a-4beb-bc69-f660643dce87\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>102400</memory>\n  <currentMemory unit='KiB'>102400</currentMemory>\n  <memoryBacking>\n    <nosharepages/>\n  </memoryBacking>\n  <vcpu placement='static' cpuset='0-3,8-11'>1</vcpu>\n  <cputune>\n    <shares>1024</shares>\n  </cputune>\n  <resource>\n    <partition>/machine</partition>\n  </resource>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>Fedora Project</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2015.1.0-1.1.44</entry>\n      <entry name='serial'>52c08ef4-27eb-422d-a840-7de43ca69827</entry>\n      <entry name='uuid'>dda65962-5d55-403a-bdf3-462a17563a74</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='i686' machine='pc-i440fx-2.2'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic eoi='on'/>\n  </features>\n  <cpu mode='host-model'>\n    <model fallback='allow'/>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-system-x86_64</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/var/lib/nova/instances/dda65962-5d55-403a-bdf3-462a17563a74/disk'/>\n      <backingStore type='file' index='1'>\n        <format type='raw'/>\n        <source file='/var/lib/nova/instances/_base/bc3b6a5811a9095948b287f8e145dd833eb4779c'/>\n        <backingStore/>\n      </backingStore>\n      <target dev='vda' bus='virtio'/>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <alias name='usb0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'>\n      <alias name='pci.0'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:61:0b:a9'/>\n      <source bridge='qbr2f305d6a-81'/>\n      <dpdk use='false' port='0'/>\n      <target dev='tap2f305d6a-81'/>\n      <model type='virtio'/>\n      <alias name='net0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/var/lib/nova/instances/dda65962-5d55-403a-bdf3-462a17563a74/console.log'/>\n      <target port='0'/>\n      <alias name='serial0'/>\n    </serial>\n    <serial type='pty'>\n      <source path='/dev/pts/6'/>\n      <target port='1'/>\n      <alias name='serial1'/>\n    </serial>\n    <console type='file'>\n      <source path='/var/lib/nova/instances/dda65962-5d55-403a-bdf3-462a17563a74/console.log'/>\n      <target type='serial' port='0'/>\n      <alias name='serial0'/>\n    </console>\n    <input type='tablet' bus='usb'>\n      <alias name='input0'/>\n    </input>\n    <input type='mouse' bus='ps2'/>\n    <input type='keyboard' bus='ps2'/>\n    <graphics type='vnc' port='5901' autoport='yes' listen='0.0.0.0' keymap='en-us'>\n      <listen type='address' address='0.0.0.0'/>\n    </graphics>\n    <video>\n      <model type='cirrus' vram='16384' heads='1'/>\n      <alias name='video0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </video>\n    <memballoon model='virtio'>\n      <stats period='10'/>\n      <alias name='balloon0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n    </memballoon>\n  </devices>\n</domain>", 
    "tags": [
        "in-stable-kilo"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1469634", 
    "owner": "None", 
    "id": 1469634, 
    "index": 1770, 
    "openned": "2015-06-29 08:25:32.157480+00:00", 
    "created": "2015-06-29 08:25:32.157480+00:00", 
    "title": "'<nosharedpages/>' in xml is not recognized by libvirt.", 
    "comments": [
        {
            "content": "'<nosharedpages/>' in xml is not recognized by libvirt. We should modify \"nosharedpages\" to \"nosharepages\".\n\nBecause:\n[root@nail-SBCJ-5-3-3 libvirt]# virsh list\n Id    Name                           State\n----------------------------------------------------\n 2     instance-00000002              running\n 7     instance-00000007              running\n\n[root@nail-SBCJ-5-3-3 libvirt]# \n[root@nail-SBCJ-5-3-3 libvirt]# \n[root@nail-SBCJ-5-3-3 libvirt]# virsh dumpxml 7\n<domain type='kvm' id='7'>\n  <name>instance-00000007</name>\n  <uuid>dda65962-5d55-403a-bdf3-462a17563a74</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"2015.1.0-1.1.44\"/>\n      <nova:name>hanrong5</nova:name>\n      <nova:creationTime>2015-06-29 07:30:51</nova:creationTime>\n      <nova:flavor name=\"hanrong\">\n        <nova:memory>100</nova:memory>\n        <nova:disk>10</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"84ee57c242ca41f09d8a833adc2e2583\">admin</nova:user>\n        <nova:project uuid=\"e35fbf4375b346519d86e2200047ad0e\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"e164982b-e53a-4beb-bc69-f660643dce87\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>102400</memory>\n  <currentMemory unit='KiB'>102400</currentMemory>\n  <memoryBacking>\n    <nosharepages/>\n  </memoryBacking>\n  <vcpu placement='static' cpuset='0-3,8-11'>1</vcpu>\n  <cputune>\n    <shares>1024</shares>\n  </cputune>\n  <resource>\n    <partition>/machine</partition>\n  </resource>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>Fedora Project</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2015.1.0-1.1.44</entry>\n      <entry name='serial'>52c08ef4-27eb-422d-a840-7de43ca69827</entry>\n      <entry name='uuid'>dda65962-5d55-403a-bdf3-462a17563a74</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='i686' machine='pc-i440fx-2.2'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic eoi='on'/>\n  </features>\n  <cpu mode='host-model'>\n    <model fallback='allow'/>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-system-x86_64</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/var/lib/nova/instances/dda65962-5d55-403a-bdf3-462a17563a74/disk'/>\n      <backingStore type='file' index='1'>\n        <format type='raw'/>\n        <source file='/var/lib/nova/instances/_base/bc3b6a5811a9095948b287f8e145dd833eb4779c'/>\n        <backingStore/>\n      </backingStore>\n      <target dev='vda' bus='virtio'/>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <alias name='usb0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'>\n      <alias name='pci.0'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:61:0b:a9'/>\n      <source bridge='qbr2f305d6a-81'/>\n      <dpdk use='false' port='0'/>\n      <target dev='tap2f305d6a-81'/>\n      <model type='virtio'/>\n      <alias name='net0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/var/lib/nova/instances/dda65962-5d55-403a-bdf3-462a17563a74/console.log'/>\n      <target port='0'/>\n      <alias name='serial0'/>\n    </serial>\n    <serial type='pty'>\n      <source path='/dev/pts/6'/>\n      <target port='1'/>\n      <alias name='serial1'/>\n    </serial>\n    <console type='file'>\n      <source path='/var/lib/nova/instances/dda65962-5d55-403a-bdf3-462a17563a74/console.log'/>\n      <target type='serial' port='0'/>\n      <alias name='serial0'/>\n    </console>\n    <input type='tablet' bus='usb'>\n      <alias name='input0'/>\n    </input>\n    <input type='mouse' bus='ps2'/>\n    <input type='keyboard' bus='ps2'/>\n    <graphics type='vnc' port='5901' autoport='yes' listen='0.0.0.0' keymap='en-us'>\n      <listen type='address' address='0.0.0.0'/>\n    </graphics>\n    <video>\n      <model type='cirrus' vram='16384' heads='1'/>\n      <alias name='video0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </video>\n    <memballoon model='virtio'>\n      <stats period='10'/>\n      <alias name='balloon0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n    </memballoon>\n  </devices>\n</domain>", 
            "date_created": "2015-06-29 08:25:32.157480+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "Although this '<nosharedpages/>' is not occured in libvirt.xml, but the code is not correct.\n\nclass LibvirtConfigGuestMemoryBacking(LibvirtConfigObject):\n\n    def __init__(self, **kwargs):\n        super(LibvirtConfigGuestMemoryBacking, self).__init__(\n            root_name=\"memoryBacking\", **kwargs)\n\n        self.hugepages = []\n        self.sharedpages = True\n        self.locked = False\n\n    def format_dom(self):\n        root = super(LibvirtConfigGuestMemoryBacking, self).format_dom()\n\n        if self.hugepages:\n            hugepages = etree.Element(\"hugepages\")\n            for item in self.hugepages:\n                hugepages.append(item.format_dom())\n            root.append(hugepages)\n        if not self.sharedpages:\n            root.append(etree.Element(\"nosharepages\"))\n        if self.locked:\n            root.append(etree.Element(\"locked\"))\n\n        return root", 
            "date_created": "2015-06-29 08:28:29.206092+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "if not self.sharedpages:\n            root.append(etree.Element(\"nosharedpages\"))\n\nshould be modified by:\n\nif not self.sharedpages:\n            root.append(etree.Element(\"nosharepages\"))", 
            "date_created": "2015-06-29 08:29:12.112656+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "Hmm based on the libvirt source this seems to be valid:\r\n---\r\nalder:libvirt tony8129$ git grep -l nosharedpages \r\nbalder:libvirt tony8129$ git grep -l nosharepages \r\ndocs/formatdomain.html.in\r\ndocs/schemas/domaincommon.rng\r\nsrc/conf/domain_conf.c\r\nsrc/conf/domain_conf.h\r\nsrc/qemu/qemu_command.c\r\ntests/qemuargv2xmltest.c\r\ntests/qemuxml2argvdata/qemuxml2argv-nosharepages.xml\r\ntests/qemuxml2argvtest.c\r\ntests/qemuxml2xmltest.c\r\nbalder:libvirt tony8129$ git describe\r\nv1.2.17-rc1-19-g04597f8\r\n---", 
            "date_created": "2015-07-01 02:13:50.969644+00:00", 
            "author": "https://api.launchpad.net/1.0/~o-tony"
        }, 
        {
            "content": "Change abandoned by Rong Han (<email address hidden>) on branch: master\nReview: https://review.openstack.org/197480\nReason: duplicate", 
            "date_created": "2015-07-01 10:19:31.177508+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Rong Han (<email address hidden>) on branch: master\nReview: https://review.openstack.org/197486\nReason: duplicate", 
            "date_created": "2015-07-01 10:20:48.783109+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Solving an inconsistency: The bug is 'In Progress' but without an assignee. I set the status back to the last known status before the change to 'In Progress'. \n\nFeel free to assign the bug to yourself. If you do so, please set it to 'In Progress'.", 
            "date_created": "2015-07-14 15:01:59.910362+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": " https://review.openstack.org/#/c/197398/\n\nthe code is commited, but this relationship has not been displayed.", 
            "date_created": "2015-07-17 03:21:46.511410+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "So, I abandoned my commited code :https://review.openstack.org/197486.\n\nbecause it is the same as https://review.openstack.org/#/c/197398/", 
            "date_created": "2015-07-17 03:23:17.375288+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "Tony Breeds had committed review\nhttps://review.openstack.org/#/c/197398/", 
            "date_created": "2015-07-17 03:26:01.016844+00:00", 
            "author": "https://api.launchpad.net/1.0/~lyanchih"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/197398\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=366ed498497cc08983cf067f908d97fb72f894ab\nSubmitter: Jenkins\nBranch:    master\n\ncommit 366ed498497cc08983cf067f908d97fb72f894ab\nAuthor: Tony Breeds <email address hidden>\nDate:   Wed Jul 1 12:18:05 2015 +1000\n\n    libvirt: Correct domxml node name.\n    \n    It seems that the wrong (possibly old?) domain xml node is used.\n    \n    The libvirt ssource shows:\n    balder:libvirt$ git grep -l nosharedpages\n    balder:libvirt$ git grep -l nosharepages\n    docs/formatdomain.html.in\n    docs/schemas/domaincommon.rng\n    src/conf/domain_conf.c\n    src/conf/domain_conf.h\n    src/qemu/qemu_command.c\n    tests/qemuargv2xmltest.c\n    tests/qemuxml2argvdata/qemuxml2argv-nosharepages.xml\n    tests/qemuxml2argvtest.c\n    tests/qemuxml2xmltest.c\n    balder:libvirt$ git describe\n    v1.2.17-rc1-19-g04597f8\n    ---\n    \n    Use the correct node name.\n    \n    Change-Id: I87b7700d15bad49f474c54da110418eaf67214dc\n    Closes-Bug: 1469634\n", 
            "date_created": "2015-07-17 04:11:49.455272+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-07-28 09:09:37.603334+00:00"
}