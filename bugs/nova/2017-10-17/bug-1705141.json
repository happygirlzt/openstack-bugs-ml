{
    "status": "Fix Released", 
    "last_updated": "2017-08-09 02:00:49.848347+00:00", 
    "description": "http://logs.openstack.org/99/471899/25/check/gate-grenade-dsvm-neutron-ubuntu-xenial/3f9a9e3/logs/new/screen-n-cond.txt.gz?level=TRACE#_2017-07-18_22_04_39_026\n\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager Traceback (most recent call last):\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 920, in schedule_and_build_instances\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     instance_uuids)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 624, in _schedule_instances\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     request_spec, instance_uuids)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/utils.py\", line 464, in wrapped\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return func(*args, **kwargs)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/client/__init__.py\", line 52, in select_destinations\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     instance_uuids)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/client/__init__.py\", line 37, in __run_method\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return getattr(self.instance, __name)(*args, **kwargs)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/client/query.py\", line 33, in select_destinations\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     instance_uuids)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/rpcapi.py\", line 136, in select_destinations\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return cctxt.call(ctxt, 'select_destinations', **msg_args)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 169, in call\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     retry=self.retry)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 123, in _send\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     timeout=timeout, retry=retry)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 578, in send\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     retry=retry)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 569, in _send\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     raise result\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager TypeError: 'NoneType' object is not iterable\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager Traceback (most recent call last):\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 153, in _process_incoming\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     res = self.dispatcher.dispatch(message)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     result = func(ctxt, **new_args)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 225, in inner\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return func(*args, **kwargs)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/manager.py\", line 114, in select_destinations\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     alloc_reqs, p_sums = res\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager TypeError: 'NoneType' object is not iterable\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22in%20select_destinations%5C%22%20AND%20message%3A%5C%22alloc_reqs%2C%20p_sums%20%3D%20res%5C%22%20AND%20message%3A%5C%22TypeError%3A%20'NoneType'%20object%20is%20not%20iterable%5C%22%20AND%20tags%3A%5C%22screen-n-cond.txt%5C%22&from=7d", 
    "tags": [
        "placement", 
        "scheduler"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1705141", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1705141, 
    "index": 2106, 
    "openned": "2017-07-18 23:46:19.513679+00:00", 
    "created": "2017-07-18 23:46:19.513679+00:00", 
    "title": "select_destinations results in 'TypeError: 'NoneType' object is not iterable' if get_allocation_candidates fails to connect to Placement", 
    "comments": [
        {
            "content": "http://logs.openstack.org/99/471899/25/check/gate-grenade-dsvm-neutron-ubuntu-xenial/3f9a9e3/logs/new/screen-n-cond.txt.gz?level=TRACE#_2017-07-18_22_04_39_026\n\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager Traceback (most recent call last):\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 920, in schedule_and_build_instances\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     instance_uuids)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/conductor/manager.py\", line 624, in _schedule_instances\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     request_spec, instance_uuids)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/utils.py\", line 464, in wrapped\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return func(*args, **kwargs)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/client/__init__.py\", line 52, in select_destinations\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     instance_uuids)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/client/__init__.py\", line 37, in __run_method\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return getattr(self.instance, __name)(*args, **kwargs)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/client/query.py\", line 33, in select_destinations\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     instance_uuids)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/rpcapi.py\", line 136, in select_destinations\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return cctxt.call(ctxt, 'select_destinations', **msg_args)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 169, in call\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     retry=self.retry)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 123, in _send\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     timeout=timeout, retry=retry)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 578, in send\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     retry=retry)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 569, in _send\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     raise result\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager TypeError: 'NoneType' object is not iterable\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager Traceback (most recent call last):\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 153, in _process_incoming\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     res = self.dispatcher.dispatch(message)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     result = func(ctxt, **new_args)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 225, in inner\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     return func(*args, **kwargs)\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager   File \"/opt/stack/new/nova/nova/scheduler/manager.py\", line 114, in select_destinations\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager     alloc_reqs, p_sums = res\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager TypeError: 'NoneType' object is not iterable\n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n2017-07-18 22:04:39.026 32126 ERROR nova.conductor.manager \n\nhttp://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22in%20select_destinations%5C%22%20AND%20message%3A%5C%22alloc_reqs%2C%20p_sums%20%3D%20res%5C%22%20AND%20message%3A%5C%22TypeError%3A%20'NoneType'%20object%20is%20not%20iterable%5C%22%20AND%20tags%3A%5C%22screen-n-cond.txt%5C%22&from=7d", 
            "date_created": "2017-07-18 23:46:19.513679+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "This is during a grenade run. It looks like this could maybe happen if the safe_connect decorator handles a keystone endpoint/auth failure and returns None.", 
            "date_created": "2017-07-19 00:05:38.419948+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Yup that's exactly what happened:\n\nhttp://logs.openstack.org/99/471899/25/check/gate-grenade-dsvm-neutron-ubuntu-xenial/3f9a9e3/logs/new/screen-n-sch.txt.gz#_2017-07-18_22_04_39_022\n\n2017-07-18 22:04:39.022 31224 WARNING nova.scheduler.client.report [req-4d9d9061-72b6-414b-a759-e89eeaa1c24c tempest-ServersTestManualDisk-1849630423 tempest-ServersTestManualDisk-1849630423] Placement API service is not responding.: ConnectFailure: Unable to establish connection to http://10.0.1.195/placement/allocation_candidates?resources=MEMORY_MB%3A64%2CVCPU%3A1: ('Connection aborted.', BadStatusLine(\"''\",))\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server [req-4d9d9061-72b6-414b-a759-e89eeaa1c24c tempest-ServersTestManualDisk-1849630423 tempest-ServersTestManualDisk-1849630423] Exception during message handling: TypeError: 'NoneType' object is not iterable\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 153, in _process_incoming\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 213, in dispatch\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 183, in _do_dispatch\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 225, in inner\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server     return func(*args, **kwargs)\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/nova/nova/scheduler/manager.py\", line 114, in select_destinations\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server     alloc_reqs, p_sums = res\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server TypeError: 'NoneType' object is not iterable\n2017-07-18 22:04:39.022 31224 ERROR oslo_messaging.rpc.server ", 
            "date_created": "2017-07-19 00:06:16.808158+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/484988", 
            "date_created": "2017-07-19 00:10:51.015009+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/484988\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=dcde535f957e2eb4b8bfddd48d6f19eef05ad4f9\nSubmitter: Jenkins\nBranch:    master\n\ncommit dcde535f957e2eb4b8bfddd48d6f19eef05ad4f9\nAuthor: Matt Riedemann <email address hidden>\nDate:   Tue Jul 18 20:08:57 2017 -0400\n\n    Handle None returned from get_allocation_candidates due to connect failure\n    \n    The get_allocation_candidates method is decorated with the safe_connect\n    decorator that handles any failures trying to connect to the Placement\n    service. If keystoneauth raises an exception, safe_connect will log it\n    and return None. The select_destinations() method in the SchedulerManager\n    needs to handle the None case so it doesn't assume a tuple is coming back\n    which would result in a TypeError.\n    \n    Change-Id: Iffd72f51f25a9e874eaacf374d80794675236ac1\n    Closes-Bug: #1705141\n", 
            "date_created": "2017-07-20 10:53:01.655787+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b3 development milestone.", 
            "date_created": "2017-07-28 07:40:15.811772+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-07-20 10:52:59.808246+00:00"
}