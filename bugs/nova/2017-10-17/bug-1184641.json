{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:38:32.174892+00:00", 
    "description": "How to reproduce:\n- 1 (controller) node running all required services except nova-compute, compute_driver parameter not defined in nova.conf\n- 1 (compute) node running nova-compte with compute_driver = libvirt.LibvirtDriver and libvirt_type = lxc\n- Boot an instance\n\nOn the instance:\nchecking http://169.254.169.254/20090404/instanceid\nfailed 1/20: up 10299.50. iid had '<html>\n <head>\n  <title>500 Internal Server Error</title>\n </head>\n <body>\n  <h1>500 Internal Server Error</h1>\n  Remote metadata server experienced an internal server error.<br /><br />\n\n\n\n </body>\n</html>'\nfailed 2/20: up 10301.92. iid had '<html>\n <head>\n  <title>500 Internal Server Error</title>\n </head>\n <body>\n  <h1>500 Internal Server Error</h1>\n  Remote metadata server experienced an internal server error.<br /><br />\n\n\n\n </body>\n</html>'\n\n\nIn the nova-api logs:\n\n2013-05-27 15:02:10.760 ERROR nova.api.metadata.handler [req-b6588700-4d5a-4ee3-84ad-c4be03cf0e62 None None] Failed to get metadata for instance id: 8d64ef04-8161-4e93-a387-93f519cadd65\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler Traceback (most recent call last):\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 183, in _handle_instance_id_request\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     remote_address)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 90, in get_metadata_by_instance_id\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     instance_id, address)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/base.py\", line 417, in get_metadata_by_instance_id\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     return InstanceMetadata(instance, address)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/base.py\", line 118, in __init__\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     self.mappings = _format_instance_mapping(capi, ctxt, instance)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/base.py\", line 423, in _format_instance_mapping\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     return block_device.instance_block_mapping(instance, bdms)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/block_device.py\", line 98, in instance_block_mapping\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     if driver.compute_driver_matches('xenapi.XenAPIDriver'):\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/virt/driver.py\", line 967, in compute_driver_matches\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     return CONF.compute_driver.endswith(match)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler AttributeError: 'NoneType' object has no attribute 'endswith'\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler", 
    "tags": [], 
    "importance": "Low", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1184641", 
    "owner": "https://api.launchpad.net/1.0/~simon-pasquier", 
    "id": 1184641, 
    "index": 875, 
    "openned": "2013-05-27 15:13:01.493678+00:00", 
    "created": "2013-05-27 15:13:01.493678+00:00", 
    "title": "metadata service throws error 500 when compute_driver is not set", 
    "comments": [
        {
            "content": "How to reproduce:\n- 1 (controller) node running all required services except nova-compute, compute_driver parameter not defined in nova.conf\n- 1 (compute) node running nova-compte with compute_driver = libvirt.LibvirtDriver and libvirt_type = lxc\n- Boot an instance\n\nOn the instance:\nchecking http://169.254.169.254/20090404/instanceid\nfailed 1/20: up 10299.50. iid had '<html>\n <head>\n  <title>500 Internal Server Error</title>\n </head>\n <body>\n  <h1>500 Internal Server Error</h1>\n  Remote metadata server experienced an internal server error.<br /><br />\n\n\n\n </body>\n</html>'\nfailed 2/20: up 10301.92. iid had '<html>\n <head>\n  <title>500 Internal Server Error</title>\n </head>\n <body>\n  <h1>500 Internal Server Error</h1>\n  Remote metadata server experienced an internal server error.<br /><br />\n\n\n\n </body>\n</html>'\n\n\nIn the nova-api logs:\n\n2013-05-27 15:02:10.760 ERROR nova.api.metadata.handler [req-b6588700-4d5a-4ee3-84ad-c4be03cf0e62 None None] Failed to get metadata for instance id: 8d64ef04-8161-4e93-a387-93f519cadd65\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler Traceback (most recent call last):\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 183, in _handle_instance_id_request\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     remote_address)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/handler.py\", line 90, in get_metadata_by_instance_id\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     instance_id, address)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/base.py\", line 417, in get_metadata_by_instance_id\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     return InstanceMetadata(instance, address)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/base.py\", line 118, in __init__\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     self.mappings = _format_instance_mapping(capi, ctxt, instance)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/api/metadata/base.py\", line 423, in _format_instance_mapping\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     return block_device.instance_block_mapping(instance, bdms)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/block_device.py\", line 98, in instance_block_mapping\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     if driver.compute_driver_matches('xenapi.XenAPIDriver'):\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler   File \"/opt/stack/nova/nova/virt/driver.py\", line 967, in compute_driver_matches\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler     return CONF.compute_driver.endswith(match)\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler AttributeError: 'NoneType' object has no attribute 'endswith'\n2013-05-27 15:02:10.760 TRACE nova.api.metadata.handler", 
            "date_created": "2013-05-27 15:13:01.493678+00:00", 
            "author": "https://api.launchpad.net/1.0/~simon-pasquier"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/30630", 
            "date_created": "2013-05-27 15:23:28.580500+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/30843", 
            "date_created": "2013-05-29 08:15:37.209938+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/30843\nCommitted: http://github.com/openstack/nova/commit/fa5079c257c00b8b56138233aca5755c54db9143\nSubmitter: Jenkins\nBranch:    master\n\ncommit fa5079c257c00b8b56138233aca5755c54db9143\nAuthor: Simon Pasquier <email address hidden>\nDate:   Mon May 27 17:17:11 2013 +0200\n\n    Verify that CONF.compute_driver is defined\n    \n    The compute_driver parameter is a mandatory parameter only for nodes\n    running the Nova compute service. However Other Nova services like\n    Nova API actually call the compute_driver_matches() function.\n    \n    Change-Id: Iac7cd46c6bdb4268cfbc650dcde0c95e69545f04\n    Fixes: bug #1184641\n", 
            "date_created": "2013-05-29 10:08:07.104936+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/grizzly\nReview: https://review.openstack.org/39045", 
            "date_created": "2013-07-29 09:44:16.133137+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/39045\nCommitted: http://github.com/openstack/nova/commit/5f12da37dd229f7afe596d4b0e9741834bf8ddaa\nSubmitter: Jenkins\nBranch:    stable/grizzly\n\ncommit 5f12da37dd229f7afe596d4b0e9741834bf8ddaa\nAuthor: Simon Pasquier <email address hidden>\nDate:   Mon May 27 17:17:11 2013 +0200\n\n    Verify that CONF.compute_driver is defined\n    \n    The compute_driver parameter is a mandatory parameter only for nodes\n    running the Nova compute service. However Other Nova services like\n    Nova API actually call the compute_driver_matches() function.\n    \n    Change-Id: Iac7cd46c6bdb4268cfbc650dcde0c95e69545f04\n    Fixes: bug #1184641\n    (cherry picked from commit fa5079c257c00b8b56138233aca5755c54db9143)\n", 
            "date_created": "2013-07-31 08:00:31.029227+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-05-29 10:36:01.690842+00:00"
}