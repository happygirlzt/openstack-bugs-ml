{
    "status": "Invalid", 
    "last_updated": "2015-08-02 23:29:03.241667+00:00", 
    "description": "1. Delete instance failed, the task_state stay on deleting  and can not revert to none.\n\n[root@opencos_114_222 ~(keystone_admin)]# nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| bc177a3d-edf8-4d24-b991-f945a2a44389 | 1    | ERROR  | deleting   | Running     | net1=192.168.0.3 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n\n2. The log is as follows:\n2014-12-01 18:43:26.319 3817 INFO nova.compute.manager [-] [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Service started deleting the instance during the previous run, but did not finish. Restarting the deletion now.\n2014-12-01 18:43:26.596 3817 AUDIT nova.compute.manager [req-dc183820-078a-4098-a7a2-50bbd598e90d None None] [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Terminating instance\n2014-12-01 18:43:26.619 3817 INFO nova.virt.libvirt.driver [-] [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Instance destroyed successfully.\n2014-12-01 18:43:27.773 3817 ERROR nova.compute.manager [-] [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Failed to complete a deletion\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Traceback (most recent call last):\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 886, in _init_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     self._delete_instance(context, instance, bdms, quotas)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/hooks.py\", line 103, in inner\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     rv = f(*args, **kwargs)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2312, in _delete_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     quotas.rollback()\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     six.reraise(self.type_, self.value, self.tb)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2284, in _delete_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     self._shutdown_instance(context, db_inst, bdms)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2222, in _shutdown_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     requested_networks)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     six.reraise(self.type_, self.value, self.tb)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2212, in _shutdown_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     block_device_info)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 967, in destroy\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     destroy_disks)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1046, in cleanup\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     volume_meta['properties'] = self._get_volume_metadata(context, connection_info)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 3082, in _get_volume_metadata\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     raise exception.InvalidBDMVolume(id=volume_id)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] InvalidBDMVolume: Block Device Mapping is Invalid: failed to get volume 0facade0-26d8-4aa8-9367-01f11f8a761b.\n\n3. The exception of InvalidBDMVolume is not handled when it is raised.", 
    "tags": [
        "in-stable-icehouse"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1397794", 
    "owner": "None", 
    "id": 1397794, 
    "index": 6567, 
    "openned": "2014-12-01 03:10:30.593899+00:00", 
    "created": "2014-12-01 03:10:30.593899+00:00", 
    "title": "Delete instance failed, the task_state stay on deleting  and can not revert to none,  because the InvalidBDMVolume exception is not handled.", 
    "comments": [
        {
            "content": "1. Delete instance failed, the task_state stay on deleting  and can not revert to none.\n\n[root@opencos_114_222 ~(keystone_admin)]# nova list\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks         |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n| bc177a3d-edf8-4d24-b991-f945a2a44389 | 1    | ERROR  | deleting   | Running     | net1=192.168.0.3 |\n+--------------------------------------+------+--------+------------+-------------+------------------+\n\n2. The log is as follows:\n2014-12-01 18:43:26.319 3817 INFO nova.compute.manager [-] [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Service started deleting the instance during the previous run, but did not finish. Restarting the deletion now.\n2014-12-01 18:43:26.596 3817 AUDIT nova.compute.manager [req-dc183820-078a-4098-a7a2-50bbd598e90d None None] [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Terminating instance\n2014-12-01 18:43:26.619 3817 INFO nova.virt.libvirt.driver [-] [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Instance destroyed successfully.\n2014-12-01 18:43:27.773 3817 ERROR nova.compute.manager [-] [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Failed to complete a deletion\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] Traceback (most recent call last):\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 886, in _init_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     self._delete_instance(context, instance, bdms, quotas)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/hooks.py\", line 103, in inner\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     rv = f(*args, **kwargs)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2312, in _delete_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     quotas.rollback()\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     six.reraise(self.type_, self.value, self.tb)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2284, in _delete_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     self._shutdown_instance(context, db_inst, bdms)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2222, in _shutdown_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     requested_networks)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     six.reraise(self.type_, self.value, self.tb)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2212, in _shutdown_instance\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     block_device_info)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 967, in destroy\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     destroy_disks)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1046, in cleanup\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     volume_meta['properties'] = self._get_volume_metadata(context, connection_info)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 3082, in _get_volume_metadata\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389]     raise exception.InvalidBDMVolume(id=volume_id)\n2014-12-01 18:43:27.773 3817 TRACE nova.compute.manager [instance: bc177a3d-edf8-4d24-b991-f945a2a44389] InvalidBDMVolume: Block Device Mapping is Invalid: failed to get volume 0facade0-26d8-4aa8-9367-01f11f8a761b.\n\n3. The exception of InvalidBDMVolume is not handled when it is raised.", 
            "date_created": "2014-12-01 03:10:30.593899+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "Icehouse 1.3", 
            "date_created": "2014-12-01 03:13:14.313307+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }, 
        {
            "content": "we can recurring this problem In the following order.\n\n1. [root@lxlconductor1 ~(keystone_admin)]# nova migrate hanrong6\n\n2. [root@lxlconductor1 ~(keystone_admin)]# nova list\n+--------------------------------------+----------+---------------+------------+-------------+-------------------+\n| ID                                   | Name     | Status        | Task State | Power State | Networks          |\n+--------------------------------------+----------+---------------+------------+-------------+-------------------+\n| 592dea03-a688-45e3-9718-9a9819bca781 | hanrong6 | VERIFY_RESIZE | -          | Running     | test=192.168.0.34 |\n+--------------------------------------+----------+---------------+------------+-------------+-------------------+\n\n3.  [root@lxlconductor1 ~(keystone_admin)]# nova delete hanrong6\n\n4. [root@lxlconductor1 ~(keystone_admin)]# nova list\n+--------------------------------------+----------+---------------+------------+-------------+-------------------+\n| ID                                   | Name     | Status        | Task State | Power State | Networks          |\n+--------------------------------------+----------+---------------+------------+-------------+-------------------+\n| 592dea03-a688-45e3-9718-9a9819bca781 | hanrong6 | VERIFY_RESIZE | deleting   | Running     | test=192.168.0.34 |\n+--------------------------------------+----------+---------------+------------+-------------+-------------------+\n\n5. error log:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 346, in fire_timers\n    timer()\n  File \"/usr/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 194, in main\n    result = function(*args, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/nova/openstack/common/service.py\", line 486, in run_service\n    service.start()\n  File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 166, in start\n    self.manager.init_host()\n  File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1152, in init_host\n    self._destroy_evacuated_instances(context)\n  File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 796, in _destroy_evacuated_instances\n    bdi, destroy_disks)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 971, in destroy\n    destroy_disks)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1050, in cleanup\n    volume_meta['properties'] = self._get_volume_metadata(context, connection_info)\n  File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 3086, in _get_volume_metadata\n    raise exception.InvalidBDMVolume(id=volume_id)\nInvalidBDMVolume: Block Device Mapping is Invalid: failed to get volume b2c5786b-ea14-4f0d-a22a-9942fb2e6ba0.\n\n", 
            "date_created": "2014-12-25 00:58:44.752461+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanrong"
        }
    ], 
    "closed": "2014-12-05 01:19:35.317862+00:00"
}