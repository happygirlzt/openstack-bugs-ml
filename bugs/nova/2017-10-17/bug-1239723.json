{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:27:49.101197+00:00", 
    "description": "curl -i http://127.0.0.1:8774/v2/28e0a231507c4dff846cbc4dd6cd814c/servers -X POST -H \"X-Auth-Project-Id: demo\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: <TOKEN>\" -d '{\"server\": {\"name\": \"server\", \"imageRef\": \"bb3048da-0cca-474f-9f05-e04bf176520c\", \"flavorRef\": \"42\", \"max_count\": 1, \"min_count\": 1, \"security_groups\": {\"name\": \"sec\"}}}'\nHTTP/1.1 500 Internal Server Error\nContent-Length: 128\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-87686a62-a4c0-4c46-b873-ff24f87d94e4\nDate: Mon, 14 Oct 2013 14:41:44 GMT\n\n{\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}\n\nI have modified the curl command from the 'nova --debug boot server --flavor 42 --image cirros-0.3.1-x86_64-uec --security-group sec' \n\nand changed the \n \"security_groups\": [{\"name\": \"sec\"}]\n part to \n\"security_groups\": {\"name\": \"sec\"}\n\nWhen the nova-api gets a dict instead of list of dict causes a 500 response.\n\n2013-10-14 14:41:43.437 ERROR nova.api.openstack [req-87686a62-a4c0-4c46-b873-ff24f87d94e4 demo demo] Caught error: 'unicode' object has no attribute 'get'\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack Traceback (most recent call last):\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 119, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1296, in send\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1260, in call_application\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 571, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/routes/middleware.py\", line 131, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 917, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     content_type, body, accept)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 976, in _process_stack\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 1057, in dispatch\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 779, in create\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     if sg.get('name')]\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack AttributeError: 'unicode' object has no attribute 'get'\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack\n\nThe  '\"security_groups\": \"foo\"' also causes 500 response.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1239723", 
    "owner": "https://api.launchpad.net/1.0/~sdague", 
    "id": 1239723, 
    "index": 3649, 
    "openned": "2013-10-14 14:50:04.389782+00:00", 
    "created": "2013-10-14 14:50:04.389782+00:00", 
    "title": "500 response on booting a server with dict security group argument", 
    "comments": [
        {
            "content": "curl -i http://127.0.0.1:8774/v2/28e0a231507c4dff846cbc4dd6cd814c/servers -X POST -H \"X-Auth-Project-Id: demo\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: <TOKEN>\" -d '{\"server\": {\"name\": \"server\", \"imageRef\": \"bb3048da-0cca-474f-9f05-e04bf176520c\", \"flavorRef\": \"42\", \"max_count\": 1, \"min_count\": 1, \"security_groups\": {\"name\": \"sec\"}}}'\nHTTP/1.1 500 Internal Server Error\nContent-Length: 128\nContent-Type: application/json; charset=UTF-8\nX-Compute-Request-Id: req-87686a62-a4c0-4c46-b873-ff24f87d94e4\nDate: Mon, 14 Oct 2013 14:41:44 GMT\n\n{\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}\n\nI have modified the curl command from the 'nova --debug boot server --flavor 42 --image cirros-0.3.1-x86_64-uec --security-group sec' \n\nand changed the \n \"security_groups\": [{\"name\": \"sec\"}]\n part to \n\"security_groups\": {\"name\": \"sec\"}\n\nWhen the nova-api gets a dict instead of list of dict causes a 500 response.\n\n2013-10-14 14:41:43.437 ERROR nova.api.openstack [req-87686a62-a4c0-4c46-b873-ff24f87d94e4 demo demo] Caught error: 'unicode' object has no attribute 'get'\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack Traceback (most recent call last):\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 119, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1296, in send\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/request.py\", line 1260, in call_application\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 571, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/routes/middleware.py\", line 131, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 144, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 130, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/usr/lib/python2.7/site-packages/webob/dec.py\", line 195, in call_func\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 917, in __call__\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     content_type, body, accept)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 976, in _process_stack\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 1057, in dispatch\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 779, in create\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack     if sg.get('name')]\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack AttributeError: 'unicode' object has no attribute 'get'\n2013-10-14 14:41:43.437 22092 TRACE nova.api.openstack\n\nThe  '\"security_groups\": \"foo\"' also causes 500 response.", 
            "date_created": "2013-10-14 14:50:04.389782+00:00", 
            "author": "https://api.launchpad.net/1.0/~afazekas"
        }, 
        {
            "content": "Attlia,\n\nwhat is the reason behind changing\n \"security_groups\": [{\"name\": \"sec\"}]\n part to\n\"security_groups\": {\"name\": \"sec\"}\n or\n\"security_groups\": \"foo\"\n\nDo we claim anywhere (in documentation) that it should work?\n\nthanks,\ndims", 
            "date_created": "2013-10-14 15:59:26.938756+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "dims,  if we don't say it should work, we shouldn't stacktrace and return a 500 error, right?", 
            "date_created": "2013-10-15 00:16:38.895756+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "right, it should not return with 500,  OS in similar cases returns with 400.", 
            "date_created": "2015-03-23 14:47:52.641143+00:00", 
            "author": "https://api.launchpad.net/1.0/~afazekas"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/167220", 
            "date_created": "2015-03-24 13:35:52.047510+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/167220\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8f67bf1ea1a470175280cc204451c6fc1552c1dd\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8f67bf1ea1a470175280cc204451c6fc1552c1dd\nAuthor: Sean Dague <email address hidden>\nDate:   Tue Mar 24 09:26:00 2015 -0400\n\n    don't 500 on invalid security group format\n    \n    Fix a user reported issue with invalid security group format causing\n    Nova to throw a 500 error (never a good thing). This provides some\n    minimal validation of the security group in the v2 API to return a 400\n    instead of a 500 on garbage input.\n    \n    It does not break string freeze because this uses the same string as\n    the validator for jsonschema. We aren't nearly as helpful about what's\n    wrong with the secgroup format, that comes with v2.1.\n    \n    Test case is added for both v2 and v2.1 on the v2 endpoint (which\n    passed previously). There is some copy and paste in the test case, but\n    that's intentional for now until we figure out which pieces of the\n    samples_base classes are really useful in other tests (and that we\n    seem to keep wanting in other tests), and will be refactored later.\n    \n    Change-Id: I3fec08df09a7705e5c882d3ef29d9c4e620781fc\n    Closes-Bug: #1239723\n", 
            "date_created": "2015-03-24 20:08:50.055104+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-04-10 09:20:46.928589+00:00"
}