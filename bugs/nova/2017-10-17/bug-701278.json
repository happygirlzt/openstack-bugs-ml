{
    "status": "Fix Released", 
    "last_updated": "2011-02-07 14:04:26.571393+00:00", 
    "description": "Using the packages from trunk, when I try to launch a new instance (currently using UEC Maverick 10.10 image), I get the following error in nova-compute.log  \n\n#####\nroot@wayne01:~# euca-describe-instances \nRESERVATION     r-ebeqxq2b      dubproj\nINSTANCE        i-1     ami-iihfbgaq    192.168.0.3     192.168.0.3     pending mykey (dubproj, wayne01)        0               m1.tiny 2011-01-10 17:08:13\nroot@wayne01:~# tail -100 /var/log/nova/nova-compute.log \n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] report_interval : 10 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] scheduler_manager : nova.scheduler.manager.SchedulerManager from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] helpshort : None from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] sql_connection : mysql://root:nova@10.127.35.119/nova from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] auth_token_ttl : 3600 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] rabbit_port : 5672 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] host : wayne01 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] volume_manager : nova.volume.manager.VolumeManager from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] rabbit_max_retries : 12 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] vpn_image_id : ami-cloudpipe from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] logfile : None from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] db_backend : sqlalchemy from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] compute_manager : nova.compute.manager.ComputeManager from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] rabbit_virtual_host : / from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] sql_retry_interval : 10 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] state_path : /var/lib/nova from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] sql_idle_timeout : 3600 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] glance_host : 127.0.0.1 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] default_image : ami-11111 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] control_exchange : nova from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] aws_secret_access_key : admin from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] s3_host : 10.127.35.119 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] periodic_interval : 60 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] enable_new_services : True from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] fake_network : False from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] network_topic : network from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.virt.libvirt_conn 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] Connecting to libvirt: qemu:///system from MainProcess (pid=5925) _get_connection /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:144\n(nova.compute.manager 2011.1-LOCALBRANCH:LOCALREVISION): AUDIT [E8L0FA5W3465LYXOJANG dub dubproj] instance 1: starting...\n(nova.virt.libvirt_conn 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] instance instance-00000001: starting toXML method from MainProcess (pid=5925) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:544\n(nova.virt.libvirt_conn 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] instance instance-00000001: starting toXML method from MainProcess (pid=5925) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:547\n(nova.virt.libvirt_conn 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] instance instance-00000001: finished toXML method from MainProcess (pid=5925) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:590\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] called setup_basic_filtering in nwfilter\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] ensuring static filters\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x3f79b50>\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x3f793d0>\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] new_filter: # Generated by iptables-save v1.4.4 on Mon Jan 10 11:08:16 2011\n*filter\n:INPUT ACCEPT [83340:65595339]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [72152:31420948]\n:nova-ipv4-fallback - [0:0]\n:nova-local - [0:0]\n:nova-inst-1 - [0:0]\n:nova-sg-1 - [0:0]\n-A nova-ipv4-fallback -j DROP\n-A FORWARD -j nova-local\n-A nova-local -d 192.168.0.3 -j nova-inst-1\n-A nova-inst-1 -m state --state INVALID -j DROP\n-A nova-inst-1 -m state --state ESTABLISHED,RELATED -j ACCEPT\n-A nova-inst-1 -j nova-sg-1\n-A nova-inst-1 -s 192.168.0.1 -p udp --sport 67 --dport 68\n-A nova-inst-1 -j nova-ipv4-fallback\n-A nova-sg-1 -p icmp -s 0.0.0.0/0 -m icmp --icmp_type -1/-1 -j ACCEPT\n-A nova-sg-1 -p tcp -s 0.0.0.0/0 --dport 22 -j ACCEPT\n-A INPUT -i virbr0 -p udp -m udp --dport 53 -j ACCEPT \n-A INPUT -i virbr0 -p tcp -m tcp --dport 53 -j ACCEPT \n-A INPUT -i virbr0 -p udp -m udp --dport 67 -j ACCEPT \n-A INPUT -i virbr0 -p tcp -m tcp --dport 67 -j ACCEPT \n-A FORWARD -o br100 -j ACCEPT \n-A FORWARD -i br100 -j ACCEPT \n-A FORWARD -d 192.168.0.2/32 -p udp -m udp --dport 1194 -j ACCEPT \n-A FORWARD -d 192.168.122.0/24 -o virbr0 -m state --state RELATED,ESTABLISHED -j ACCEPT \n-A FORWARD -s 192.168.122.0/24 -i virbr0 -j ACCEPT \n-A FORWARD -i virbr0 -o virbr0 -j ACCEPT \n-A FORWARD -o virbr0 -j REJECT --reject-with icmp-port-unreachable \n-A FORWARD -i virbr0 -j REJECT --reject-with icmp-port-unreachable \nCOMMIT\n# Completed on Mon Jan 10 11:08:16 2011\n\n(nova.exception 2011.1-LOCALBRANCH:LOCALREVISION): ERROR [N/A] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 82, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 367, in spawn\n(nova.exception): TRACE:     self.firewall_driver.prepare_instance_filter(instance)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 1009, in prepare_instance_filter\n(nova.exception): TRACE:     self.apply_ruleset()\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 1016, in apply_ruleset\n(nova.exception): TRACE:     process_input='\\n'.join(new_filter))\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 144, in execute\n(nova.exception): TRACE:     cmd=cmd)\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: sudo iptables-restore\n(nova.exception): TRACE: Exit code: 2\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: \"iptables-restore v1.4.4: unknown option `--icmp_type'\\nError occurred at line: 18\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n(nova.exception): TRACE: \n(nova.compute.manager 2011.1-LOCALBRANCH:LOCALREVISION): ERROR [E8L0FA5W3465LYXOJANG dub dubproj] instance 1: Failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 191, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 88, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: Unexpected error while running command.\n(nova.compute.manager): TRACE: Command: sudo iptables-restore\n(nova.compute.manager): TRACE: Exit code: 2\n(nova.compute.manager): TRACE: Stdout: ''\n(nova.compute.manager): TRACE: Stderr: \"iptables-restore v1.4.4: unknown option `--icmp_type'\\nError occurred at line: 18\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n(nova.compute.manager): TRACE: \nlibvir: QEMU error : Domain not found: no domain with matching name 'instance-00000001'\n\n#####\n\nI am seeing this behavior on 10.04, and 10.10.  Here is the information on the iptables versions:\n\n10.04\n-----\nroot@wayne01:~# dpkg -l | grep iptables\nii  iptables                        1.4.4-2ubuntu2                                  administration tools for packet filtering an\n\n10.10\n-----\nroot@wayne07:~# dpkg -l | grep iptables\nii  iptables                        1.4.4-2ubuntu3                                  administration tools for packet filtering an\n\n#####\n\nI tried to upgrade to iptables 1.4.10-1ubuntu1, with one additional dependency (libnfnetlink0), and the issue is still valid.\n\n#####\n\nCheers", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/701278", 
    "owner": "https://api.launchpad.net/1.0/~soren", 
    "id": 701278, 
    "index": 3259, 
    "openned": "2011-01-10 23:01:22.858328+00:00", 
    "created": "2011-01-10 23:01:22.858328+00:00", 
    "title": "iptables is failing when lauching instances ", 
    "comments": [
        {
            "content": "Using the packages from trunk, when I try to launch a new instance (currently using UEC Maverick 10.10 image), I get the following error in nova-compute.log  \n\n#####\nroot@wayne01:~# euca-describe-instances \nRESERVATION     r-ebeqxq2b      dubproj\nINSTANCE        i-1     ami-iihfbgaq    192.168.0.3     192.168.0.3     pending mykey (dubproj, wayne01)        0               m1.tiny 2011-01-10 17:08:13\nroot@wayne01:~# tail -100 /var/log/nova/nova-compute.log \n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] report_interval : 10 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] scheduler_manager : nova.scheduler.manager.SchedulerManager from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] helpshort : None from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] sql_connection : mysql://root:nova@10.127.35.119/nova from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] auth_token_ttl : 3600 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] rabbit_port : 5672 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] host : wayne01 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] volume_manager : nova.volume.manager.VolumeManager from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] rabbit_max_retries : 12 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] vpn_image_id : ami-cloudpipe from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] logfile : None from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] db_backend : sqlalchemy from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] compute_manager : nova.compute.manager.ComputeManager from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] rabbit_virtual_host : / from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] sql_retry_interval : 10 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] state_path : /var/lib/nova from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] sql_idle_timeout : 3600 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] glance_host : 127.0.0.1 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] default_image : ami-11111 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] control_exchange : nova from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] aws_secret_access_key : admin from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] s3_host : 10.127.35.119 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] periodic_interval : 60 from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] enable_new_services : True from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] fake_network : False from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] network_topic : network from MainProcess (pid=5925) serve /usr/lib/pymodules/python2.6/nova/service.py:236\n(nova.virt.libvirt_conn 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] Connecting to libvirt: qemu:///system from MainProcess (pid=5925) _get_connection /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:144\n(nova.compute.manager 2011.1-LOCALBRANCH:LOCALREVISION): AUDIT [E8L0FA5W3465LYXOJANG dub dubproj] instance 1: starting...\n(nova.virt.libvirt_conn 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] instance instance-00000001: starting toXML method from MainProcess (pid=5925) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:544\n(nova.virt.libvirt_conn 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] instance instance-00000001: starting toXML method from MainProcess (pid=5925) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:547\n(nova.virt.libvirt_conn 2011.1-LOCALBRANCH:LOCALREVISION): DEBUG [N/A] instance instance-00000001: finished toXML method from MainProcess (pid=5925) to_xml /usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py:590\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] called setup_basic_filtering in nwfilter\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] ensuring static filters\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x3f79b50>\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] <nova.db.sqlalchemy.models.SecurityGroupIngressRule object at 0x3f793d0>\n(nova.root 2011.1-LOCALBRANCH:LOCALREVISION): INFO [N/A] new_filter: # Generated by iptables-save v1.4.4 on Mon Jan 10 11:08:16 2011\n*filter\n:INPUT ACCEPT [83340:65595339]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [72152:31420948]\n:nova-ipv4-fallback - [0:0]\n:nova-local - [0:0]\n:nova-inst-1 - [0:0]\n:nova-sg-1 - [0:0]\n-A nova-ipv4-fallback -j DROP\n-A FORWARD -j nova-local\n-A nova-local -d 192.168.0.3 -j nova-inst-1\n-A nova-inst-1 -m state --state INVALID -j DROP\n-A nova-inst-1 -m state --state ESTABLISHED,RELATED -j ACCEPT\n-A nova-inst-1 -j nova-sg-1\n-A nova-inst-1 -s 192.168.0.1 -p udp --sport 67 --dport 68\n-A nova-inst-1 -j nova-ipv4-fallback\n-A nova-sg-1 -p icmp -s 0.0.0.0/0 -m icmp --icmp_type -1/-1 -j ACCEPT\n-A nova-sg-1 -p tcp -s 0.0.0.0/0 --dport 22 -j ACCEPT\n-A INPUT -i virbr0 -p udp -m udp --dport 53 -j ACCEPT \n-A INPUT -i virbr0 -p tcp -m tcp --dport 53 -j ACCEPT \n-A INPUT -i virbr0 -p udp -m udp --dport 67 -j ACCEPT \n-A INPUT -i virbr0 -p tcp -m tcp --dport 67 -j ACCEPT \n-A FORWARD -o br100 -j ACCEPT \n-A FORWARD -i br100 -j ACCEPT \n-A FORWARD -d 192.168.0.2/32 -p udp -m udp --dport 1194 -j ACCEPT \n-A FORWARD -d 192.168.122.0/24 -o virbr0 -m state --state RELATED,ESTABLISHED -j ACCEPT \n-A FORWARD -s 192.168.122.0/24 -i virbr0 -j ACCEPT \n-A FORWARD -i virbr0 -o virbr0 -j ACCEPT \n-A FORWARD -o virbr0 -j REJECT --reject-with icmp-port-unreachable \n-A FORWARD -i virbr0 -j REJECT --reject-with icmp-port-unreachable \nCOMMIT\n# Completed on Mon Jan 10 11:08:16 2011\n\n(nova.exception 2011.1-LOCALBRANCH:LOCALREVISION): ERROR [N/A] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 82, in _wrap\n(nova.exception): TRACE:     return f(*args, **kw)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 367, in spawn\n(nova.exception): TRACE:     self.firewall_driver.prepare_instance_filter(instance)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 1009, in prepare_instance_filter\n(nova.exception): TRACE:     self.apply_ruleset()\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/libvirt_conn.py\", line 1016, in apply_ruleset\n(nova.exception): TRACE:     process_input='\\n'.join(new_filter))\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/utils.py\", line 144, in execute\n(nova.exception): TRACE:     cmd=cmd)\n(nova.exception): TRACE: ProcessExecutionError: Unexpected error while running command.\n(nova.exception): TRACE: Command: sudo iptables-restore\n(nova.exception): TRACE: Exit code: 2\n(nova.exception): TRACE: Stdout: ''\n(nova.exception): TRACE: Stderr: \"iptables-restore v1.4.4: unknown option `--icmp_type'\\nError occurred at line: 18\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n(nova.exception): TRACE: \n(nova.compute.manager 2011.1-LOCALBRANCH:LOCALREVISION): ERROR [E8L0FA5W3465LYXOJANG dub dubproj] instance 1: Failed to spawn\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/compute/manager.py\", line 191, in run_instance\n(nova.compute.manager): TRACE:     self.driver.spawn(instance_ref)\n(nova.compute.manager): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/exception.py\", line 88, in _wrap\n(nova.compute.manager): TRACE:     raise Error(str(e))\n(nova.compute.manager): TRACE: Error: Unexpected error while running command.\n(nova.compute.manager): TRACE: Command: sudo iptables-restore\n(nova.compute.manager): TRACE: Exit code: 2\n(nova.compute.manager): TRACE: Stdout: ''\n(nova.compute.manager): TRACE: Stderr: \"iptables-restore v1.4.4: unknown option `--icmp_type'\\nError occurred at line: 18\\nTry `iptables-restore -h' or 'iptables-restore --help' for more information.\\n\"\n(nova.compute.manager): TRACE: \nlibvir: QEMU error : Domain not found: no domain with matching name 'instance-00000001'\n\n#####\n\nI am seeing this behavior on 10.04, and 10.10.  Here is the information on the iptables versions:\n\n10.04\n-----\nroot@wayne01:~# dpkg -l | grep iptables\nii  iptables                        1.4.4-2ubuntu2                                  administration tools for packet filtering an\n\n10.10\n-----\nroot@wayne07:~# dpkg -l | grep iptables\nii  iptables                        1.4.4-2ubuntu3                                  administration tools for packet filtering an\n\n#####\n\nI tried to upgrade to iptables 1.4.10-1ubuntu1, with one additional dependency (libnfnetlink0), and the issue is still valid.\n\n#####\n\nCheers", 
            "date_created": "2011-01-10 23:01:22.858328+00:00", 
            "author": "https://api.launchpad.net/1.0/~wayne-walls"
        }, 
        {
            "content": "Perhaps iptables-restore doesn't automatically load modules like iptables does. We're certainly not using any exotic netfilter modules, and I've tested this on Ubuntu 10.10.", 
            "date_created": "2011-01-11 09:30:11.437541+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "Nope, that's not it at all.", 
            "date_created": "2011-01-11 10:13:47.975423+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }
    ], 
    "closed": "2011-02-07 14:04:25.050757+00:00"
}