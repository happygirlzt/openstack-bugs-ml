{
    "status": "Confirmed", 
    "last_updated": "2017-06-27 15:55:40.218762+00:00", 
    "description": "Steps to reproduce\n===================\n\n1, launch a boot from volume instance named bfv1\n2, attach a volume (blank-volume1) to instance bfv1\n3, take a snapshot on bfv1 and a new image bfv1-snap1 created\n4, launch another boot from image instance named bfi1\n4, rebuild bfi1 from bfv1-snap1 failed\n5, error log is as follow\n\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     executor_callback))\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     executor_callback)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 142, in inner\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return func(*args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 89, in wrapped\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     payload)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 72, in wrapped\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 350, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance=instance)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 323, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 400, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 378, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 366, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2709, in rebuild_instance\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     bdms, recreate, on_shared_storage, preserve_ephemeral)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2748, in _do_rebuild_instance_with_claim\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     self._do_rebuild_instance(*args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2857, in _do_rebuild_instance\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     self._rebuild_default_impl(**kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2629, in _rebuild_default_impl\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     block_device_info=new_block_device_info)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2562, in spawn\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     admin_pass=admin_password)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2988, in _create_image\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     instance, size, fallback_from_host)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 6427, in _try_fetch_image_cache\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     size=size)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 240, in cache\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     *args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 835, in create_image\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     self.driver.import_image(base, self.rbd_name)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/storage/rbd_utils.py\", line 313, in import_image\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     utils.execute('rbd', 'import', *args)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/utils.py\", line 390, in execute\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return processutils.execute(*cmd, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 275, in execute\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     cmd=sanitized_cmd)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher ProcessExecutionError: Unexpected error while running command.\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Command: rbd import --pool openstack-00 /var/lib/nova/instances/_base/9c73eb8ef590d6639ef72dfd807b4d8c7c4c45d9 cc83293e-afc7-4251-bd89-c8dc1d607ff3_disk --image-format=2 --id admin --conf /etc/ceph/ceph.conf\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Exit code: 25\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Stdout: u''\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Stderr: u\"2016-05-23 07:40:43.707197 7f9ba29d17c0 -1 asok(0xba8500) AdminSocketConfigObs::init: failed: AdminSocket::bind_and_listen: failed to bind the UNIX domain socket to '/var/run/ceph/rbd-131697.asok': (13) Permission denied\\nrbd: unable to get size of file/block device\\n\\rImporting image: 0% complete...failed.\\nrbd: import failed: (25) Inappropriate ioctl for device\\n\"\n\nEnvironment\n============\n\u00a0* os: centos7\n\u00a0* openstack: stable/liberty\n * storage: ceph rbd\n\nI looked at the master code and it have the same bug.", 
    "tags": [
        "ceph", 
        "openstack-version.liberty", 
        "rebuild", 
        "volumes"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1584630", 
    "owner": "None", 
    "id": 1584630, 
    "index": 7500, 
    "openned": "2016-05-23 07:51:22.702458+00:00", 
    "created": "2016-05-23 07:51:22.702458+00:00", 
    "title": "rebuild don't respect image's block device mapping propertries", 
    "comments": [
        {
            "content": "Steps to reproduce\n===================\n\n1, launch a boot from volume instance named bfv1\n2, attach a volume (blank-volume1) to instance bfv1\n3, take a snapshot on bfv1 and a new image bfv1-snap1 created\n4, launch another boot from image instance named bfi1\n4, rebuild bfi1 from bfv1-snap1 failed\n5, error log is as follow\n\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     executor_callback))\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     executor_callback)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 142, in inner\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return func(*args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 89, in wrapped\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     payload)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 72, in wrapped\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 350, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     LOG.warning(msg, e, instance=instance)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 323, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 400, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 378, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 195, in __exit__\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 366, in decorated_function\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2709, in rebuild_instance\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     bdms, recreate, on_shared_storage, preserve_ephemeral)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2748, in _do_rebuild_instance_with_claim\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     self._do_rebuild_instance(*args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2857, in _do_rebuild_instance\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     self._rebuild_default_impl(**kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 2629, in _rebuild_default_impl\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     block_device_info=new_block_device_info)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2562, in spawn\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     admin_pass=admin_password)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 2988, in _create_image\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     instance, size, fallback_from_host)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 6427, in _try_fetch_image_cache\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     size=size)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 240, in cache\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     *args, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py\", line 835, in create_image\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     self.driver.import_image(base, self.rbd_name)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/storage/rbd_utils.py\", line 313, in import_image\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     utils.execute('rbd', 'import', *args)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/utils.py\", line 390, in execute\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     return processutils.execute(*cmd, **kwargs)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_concurrency/processutils.py\", line 275, in execute\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher     cmd=sanitized_cmd)\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher ProcessExecutionError: Unexpected error while running command.\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Command: rbd import --pool openstack-00 /var/lib/nova/instances/_base/9c73eb8ef590d6639ef72dfd807b4d8c7c4c45d9 cc83293e-afc7-4251-bd89-c8dc1d607ff3_disk --image-format=2 --id admin --conf /etc/ceph/ceph.conf\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Exit code: 25\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Stdout: u''\n2016-05-23 07:40:44.064 136993 ERROR oslo_messaging.rpc.dispatcher Stderr: u\"2016-05-23 07:40:43.707197 7f9ba29d17c0 -1 asok(0xba8500) AdminSocketConfigObs::init: failed: AdminSocket::bind_and_listen: failed to bind the UNIX domain socket to '/var/run/ceph/rbd-131697.asok': (13) Permission denied\\nrbd: unable to get size of file/block device\\n\\rImporting image: 0% complete...failed.\\nrbd: import failed: (25) Inappropriate ioctl for device\\n\"\n\n\nEnvironment\n============\n * os: centos7\n * openstack: stable/liberty\n\nI looked at the master code and it have the same bug.", 
            "date_created": "2016-05-23 07:51:22.702458+00:00", 
            "author": "https://api.launchpad.net/1.0/~ljjjustin"
        }, 
        {
            "content": "\nShould we replace all origin volume by new volume provided from image block_device_mapping attribute?", 
            "date_created": "2016-07-12 07:26:00.210205+00:00", 
            "author": "https://api.launchpad.net/1.0/~zehua"
        }, 
        {
            "content": "Automatically discovered version liberty in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 15:55:38.766514+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}