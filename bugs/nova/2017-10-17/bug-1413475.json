{
    "status": "Fix Released", 
    "last_updated": "2015-12-03 21:35:02.221343+00:00", 
    "description": "If the host added using aggregate to slave host in Xenserver environments, \n\nnova-compute does not start because cannot get aggregate metadata information.\n\nnova-compute trying to call xenapi's _join_slave method to get host information, \n\nthen db query api called by aggregate_get_by_host function and returns the aggregate object.\n\nFinally, xenapi's client session object returns the aggregate's metadetails but the aggregate object does not have\n\nmetadetails information.\n\nI think we should use \"metadata\" instead \"metadetails'.\n\nThe error messages are below.\n\n2015-01-21 07:40:35.308 2473 CRITICAL nova [req-c98c0fb9-7b47-4100-81c7-a6061410b680 None None] AttributeError: 'Aggregate' object has no attribute 'metadetails'\n2015-01-21 07:40:35.308 2473 TRACE nova Traceback (most recent call last):\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/bin/nova-compute\", line 10, in <module>\n2015-01-21 07:40:35.308 2473 TRACE nova     sys.exit(main())\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/cmd/compute.py\", line 72, in main\n2015-01-21 07:40:35.308 2473 TRACE nova     db_allowed=CONF.conductor.use_local)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 274, in create\n2015-01-21 07:40:35.308 2473 TRACE nova     db_allowed=db_allowed)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 147, in __init__\n2015-01-21 07:40:35.308 2473 TRACE nova     self.manager = manager_class(host=self.host, *args, **kwargs)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 605, in __init__\n2015-01-21 07:40:35.308 2473 TRACE nova     self.driver = driver.load_compute_driver(self.virtapi, compute_driver)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/virt/driver.py\", line 1300, in load_compute_driver\n2015-01-21 07:40:35.308 2473 TRACE nova     virtapi)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/importutils.py\", line 50, in import_object_ns\n2015-01-21 07:40:35.308 2473 TRACE nova     return import_class(import_value)(*args, **kwargs)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 156, in __init__\n2015-01-21 07:40:35.308 2473 TRACE nova     self._session = session.XenAPISession(url, username, password)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/client/session.py\", line 87, in __init__\n2015-01-21 07:40:35.308 2473 TRACE nova     self.host_uuid = self._get_host_uuid()\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/client/session.py\", line 143, in _get_host_uuid\n2015-01-21 07:40:35.308 2473 TRACE nova     return aggr.metadetails[CONF.host]\n2015-01-21 07:40:35.308 2473 TRACE nova AttributeError: 'Aggregate' object has no attribute 'metadetails'\n2015-01-21 07:40:35.308 2473 TRACE nova", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1413475", 
    "owner": "https://api.launchpad.net/1.0/~johngarbutt", 
    "id": 1413475, 
    "index": 1499, 
    "openned": "2015-01-22 05:19:10.574481+00:00", 
    "created": "2015-01-22 05:19:10.574481+00:00", 
    "title": "cannot get aggregate metadata information when nova-compute starts using xen", 
    "comments": [
        {
            "content": "If the host added using aggregate to slave host in Xenserver environments, \n\nnova-compute does not start because cannot get aggregate metadata information.\n\nnova-compute trying to call xenapi's _join_slave method to get host information, \n\nthen db query api called by aggregate_get_by_host function and returns the aggregate object.\n\nFinally, xenapi's client session object returns the aggregate's metadetails but the aggregate object does not have\n\nmetadetails information.\n\nI think we should use \"metadata\" instead \"metadetails'.\n\nThe error messages are below.\n\n2015-01-21 07:40:35.308 2473 CRITICAL nova [req-c98c0fb9-7b47-4100-81c7-a6061410b680 None None] AttributeError: 'Aggregate' object has no attribute 'metadetails'\n2015-01-21 07:40:35.308 2473 TRACE nova Traceback (most recent call last):\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/bin/nova-compute\", line 10, in <module>\n2015-01-21 07:40:35.308 2473 TRACE nova     sys.exit(main())\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/cmd/compute.py\", line 72, in main\n2015-01-21 07:40:35.308 2473 TRACE nova     db_allowed=CONF.conductor.use_local)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 274, in create\n2015-01-21 07:40:35.308 2473 TRACE nova     db_allowed=db_allowed)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 147, in __init__\n2015-01-21 07:40:35.308 2473 TRACE nova     self.manager = manager_class(host=self.host, *args, **kwargs)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 605, in __init__\n2015-01-21 07:40:35.308 2473 TRACE nova     self.driver = driver.load_compute_driver(self.virtapi, compute_driver)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/virt/driver.py\", line 1300, in load_compute_driver\n2015-01-21 07:40:35.308 2473 TRACE nova     virtapi)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/importutils.py\", line 50, in import_object_ns\n2015-01-21 07:40:35.308 2473 TRACE nova     return import_class(import_value)(*args, **kwargs)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 156, in __init__\n2015-01-21 07:40:35.308 2473 TRACE nova     self._session = session.XenAPISession(url, username, password)\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/client/session.py\", line 87, in __init__\n2015-01-21 07:40:35.308 2473 TRACE nova     self.host_uuid = self._get_host_uuid()\n2015-01-21 07:40:35.308 2473 TRACE nova   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/client/session.py\", line 143, in _get_host_uuid\n2015-01-21 07:40:35.308 2473 TRACE nova     return aggr.metadetails[CONF.host]\n2015-01-21 07:40:35.308 2473 TRACE nova AttributeError: 'Aggregate' object has no attribute 'metadetails'\n2015-01-21 07:40:35.308 2473 TRACE nova", 
            "date_created": "2015-01-22 05:19:10.574481+00:00", 
            "author": "https://api.launchpad.net/1.0/~lkhysy"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/156126", 
            "date_created": "2015-02-16 05:15:53.947607+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/156126\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=2aa7862b57eed2c32c189d6830bc8afa55df1001\nSubmitter: Jenkins\nBranch:    master\n\ncommit 2aa7862b57eed2c32c189d6830bc8afa55df1001\nAuthor: lkhysy <email address hidden>\nDate:   Mon Feb 16 14:00:32 2015 +0900\n\n    Xenapi: Handle missing aggregate metadata on startup\n    \n    If the host added using aggregate function to slave host in\n    Xenserver environments, nova-compute does not start\n    because cannot get aggregate metadata information.\n    \n    Co-authored-by: John Haan <email address hidden>\n    Co-authored-by: Yoon Doyoul <email address hidden>\n    Co-authored-by: Michael Still <email address hidden>\n    \n    Change-Id: Idc979d7b3a974f7f9f61e6cd3485bd7a7e0879ea\n    Closes-Bug: 1413475\n", 
            "date_created": "2015-11-24 14:07:09.190421+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.0.0.0b1 development milestone.", 
            "date_created": "2015-12-02 16:18:31.375525+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ], 
    "closed": "2015-12-03 21:34:59.311808+00:00"
}