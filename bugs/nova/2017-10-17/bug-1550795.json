{
    "status": "Fix Released", 
    "last_updated": "2016-03-03 16:18:19.765763+00:00", 
    "description": "1. Nova version\n\ncommit ce5a2fb419f999bec0fb2c67413387c8b67a691a\n\n2. Deserialized traceback as captured in log as received by messaging\n\nTraceback (most recent call last):\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 143, in _dispatch_and_reply\n    executor_callback))\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 189, in _dispatch\n    executor_callback)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n    result = func(ctxt, **new_args)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/exception.py\", line 110, in wrapped\n    payload)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n    self.force_reraise()\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/exception.py\", line 89, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 413, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 391, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n    self.force_reraise()\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 379, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 5281, in check_can_live_migrate_source\n    block_device_info)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/virt/xenapi/driver.py\", line 530, in check_can_live_migrate_source\n    dest_check_data)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 2419, in check_can_live_migrate_source\n    \"VM.assert_can_migrate\", vm_ref, dest_check_data)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 2524, in _call_live_migrate_command\n    vdi_map, vif_map, options)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 210, in call_xenapi\n    return session.xenapi_request(method, args)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n    result = _parse_result(getattr(self, methodname)(*full_params))\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1224, in __call__\n    return self.__send(self.__name, args)\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1572, in __request\n    allow_none=self.__allow_none)\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1085, in dumps\n    data = m.dumps(params)\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 632, in dumps\n    dump(v, write)\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 652, in __dump\n    raise TypeError, \"cannot marshal %s objects\" % type(value)\nTypeError: cannot marshal <class 'oslo_versionedobjects.fields.CoercedDict'> objects\n\n3. Reproduction steps\n\n* nova boot bug-xmlrpc_marshall_exception\n* nova live-migration --block-migrate bug-xmlrpc_marshall_exception", 
    "tags": [
        "live-migration", 
        "xenserver"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1550795", 
    "owner": "https://api.launchpad.net/1.0/~coreywright", 
    "id": 1550795, 
    "index": 1891, 
    "openned": "2016-02-27 21:17:52.801475+00:00", 
    "created": "2016-02-27 21:17:52.801475+00:00", 
    "title": "live migration with block migration on Xen produces 'cannot marshal' exception", 
    "comments": [
        {
            "content": "1. Nova version\n\ncommit ce5a2fb419f999bec0fb2c67413387c8b67a691a\n\n2. Deserialized traceback as captured in log as received by messaging\n\nTraceback (most recent call last):\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 143, in _dispatch_and_reply\n    executor_callback))\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 189, in _dispatch\n    executor_callback)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n    result = func(ctxt, **new_args)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/exception.py\", line 110, in wrapped\n    payload)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n    self.force_reraise()\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/exception.py\", line 89, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 413, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 391, in decorated_function\n    kwargs['instance'], e, sys.exc_info())\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n    self.force_reraise()\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n    six.reraise(self.type_, self.value, self.tb)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 379, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 5281, in check_can_live_migrate_source\n    block_device_info)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/virt/xenapi/driver.py\", line 530, in check_can_live_migrate_source\n    dest_check_data)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 2419, in check_can_live_migrate_source\n    \"VM.assert_can_migrate\", vm_ref, dest_check_data)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/virt/xenapi/vmops.py\", line 2524, in _call_live_migrate_command\n    vdi_map, vif_map, options)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/nova/virt/xenapi/client/session.py\", line 210, in call_xenapi\n    return session.xenapi_request(method, args)\n  File \"/opt/rackstack/rackstack.532.2/nova/lib/python2.7/site-packages/XenAPI.py\", line 133, in xenapi_request\n    result = _parse_result(getattr(self, methodname)(*full_params))\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1224, in __call__\n    return self.__send(self.__name, args)\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1572, in __request\n    allow_none=self.__allow_none)\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1085, in dumps\n    data = m.dumps(params)\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 632, in dumps\n    dump(v, write)\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 652, in __dump\n    raise TypeError, \"cannot marshal %s objects\" % type(value)\nTypeError: cannot marshal <class 'oslo_versionedobjects.fields.CoercedDict'> objects\n\n3. Reproduction steps\n\n* nova boot bug-xmlrpc_marshall_exception\n* nova live-migration --block-migrate bug-xmlrpc_marshall_exception", 
            "date_created": "2016-02-27 21:17:52.801475+00:00", 
            "author": "https://api.launchpad.net/1.0/~coreywright"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/285741", 
            "date_created": "2016-02-27 21:31:18.447436+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/285741\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=387329a959b4980d74541a5ddf6b54deab9fe957\nSubmitter: Jenkins\nBranch:    master\n\ncommit 387329a959b4980d74541a5ddf6b54deab9fe957\nAuthor: Corey Wright <email address hidden>\nDate:   Fri Feb 26 00:24:48 2016 -0600\n\n    Do not pass call_xenapi unmarshallable type\n    \n    Convert xmlrpc-unmarshallable CoercedDict from DictOfStringsField\n    object field to marshallable built-in dict.\n    \n    Upstream commit f710f709 changed migrate_send_data to a\n    DictOfStringsField in the XenapiLiveMigrateData object, which produces\n    a CoercedDict, and upstream commit 69e01758 changed the handling of\n    migrate_send_data in the xenapi virt driver, but didn't guard against\n    migrate_send_data from being passed to xmlrpc, by way of XenAPI, as\n    the unmarshallable CoercedDict, so convert to a standard dict.\n    \n    Technically, migrate_send_data is a nullable object field and can\n    produce None, but that's invalid at this point in the code as the\n    XenAPI commands VM.assert_can_migrate and VM.migrate_send require it,\n    so throw an InvalidParameterValue exception and correct the unit tests\n    with incorrect test data (ie block_migration=True, but\n    migrate_send_data=None) that are accidentally triggering this\n    exception.\n    \n    Change-Id: Ia28f9af8087dd45e9159264c3510637f6cf24be1\n    Closes-Bug: #1550795\n", 
            "date_created": "2016-02-29 16:27:34.070363+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.0.0.0b3 development milestone.", 
            "date_created": "2016-03-03 16:18:18.818768+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }
    ], 
    "closed": "2016-02-29 16:27:31.965128+00:00"
}