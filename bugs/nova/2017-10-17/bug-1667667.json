{
    "status": "In Progress", 
    "last_updated": "2017-05-16 08:51:52.234267+00:00", 
    "description": "How to reproduce it:\n\nTwo images, one of them with with hw_disk_bus=scsi and hw_scsi_model=virtio-scsi properties:\n\n$ glance image-show 48888bbf-ddbf-4ede-a30f-b5b4a8e68876\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | 79b4436412283bb63c2cba4ac796bcd9     |\n| container_format | bare                                 |\n| created_at       | 2017-02-24T08:45:48Z                 |\n| disk_format      | qcow2                                |\n| id               | 48888bbf-ddbf-4ede-a30f-b5b4a8e68876 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | cirros-0.3.4-i386-disk               |\n| owner            | 277132bf94b040f0842bd66d71a0d574     |\n| protected        | False                                |\n| size             | 12506112                             |\n| status           | active                               |\n| tags             | []                                   |\n| updated_at       | 2017-02-24T08:45:52Z                 |\n| virtual_size     | None                                 |\n| visibility       | public                               |\n+------------------+--------------------------------------+\n\n$ glance image-show 8ce9540e-a802-4e39-a1b4-20cbff14ec18\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | 79b4436412283bb63c2cba4ac796bcd9     |\n| container_format | bare                                 |\n| created_at       | 2017-02-24T09:07:44Z                 |\n| disk_format      | qcow2                                |\n| hw_disk_bus      | scsi                                 |\n| hw_scsi_model    | virtio-scsi                          |\n| id               | 8ce9540e-a802-4e39-a1b4-20cbff14ec18 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | cirros-scsi                          |\n| owner            | bd560276f6bd48219ddcd7c9fb245ec1     |\n| protected        | False                                |\n| size             | 12506112                             |\n| status           | active                               |\n| tags             | []                                   |\n| updated_at       | 2017-02-24T09:07:45Z                 |\n| virtual_size     | None                                 |\n| visibility       | shared                               |\n+------------------+--------------------------------------+\n\n$ nova boot --flavor m1.small --image 48888bbf-ddbf-4ede-a30f-b5b4a8e68876 vm1\n$ virsh dumpxml instance-00000003 | grep '.*target.*bus'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<target dev='vda' bus='virtio'/>\n\n$ nova rebuild vm1 cirros-scsi\n$ nova show vm1 | grep image\n| image                                | cirros-scsi (8ce9540e-a802-4e39-a1b4-20cbff14ec18)\n$ virsh dumpxml instance-00000003 | grep '.*target.*bus'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<target dev='vda' bus='virtio'/>\n\nThe problem is that despite property hw_disk_bus set on cirros-scsi (8ce9540e-a802-4e39-a1b4-20cbff14ec18), 'virtio' (and vda) is not replaced in the instance's XML file.\n\nThe expected result IMO should be like a normal boot from this image:\n\n$ nova boot --flavor m1.small --image 8ce9540e-a802-4e39-a1b4-20cbff14ec18 vm2\n$ virsh dumpxml instance-00000004 | grep '.*target.*bus'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<target dev='sda' bus='scsi'/>", 
    "tags": [
        "image", 
        "libvirt", 
        "rebuild", 
        "scsi"
    ], 
    "importance": "Low", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1667667", 
    "owner": "https://api.launchpad.net/1.0/~falseuser", 
    "id": 1667667, 
    "index": 2158, 
    "openned": "2017-02-24 12:13:41.784446+00:00", 
    "created": "2017-02-24 12:13:41.784446+00:00", 
    "title": "Rebuilding instance ignores image's property hw_disk_bus", 
    "comments": [
        {
            "content": "How to reproduce it:\n\nTwo images, one of them with with hw_disk_bus=scsi and hw_scsi_model=virtio-scsi properties:\n\n$ glance image-show 48888bbf-ddbf-4ede-a30f-b5b4a8e68876 \n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | 79b4436412283bb63c2cba4ac796bcd9     |\n| container_format | bare                                 |\n| created_at       | 2017-02-24T08:45:48Z                 |\n| disk_format      | qcow2                                |\n| id               | 48888bbf-ddbf-4ede-a30f-b5b4a8e68876 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | cirros-0.3.4-i386-disk               |\n| owner            | 277132bf94b040f0842bd66d71a0d574     |\n| protected        | False                                |\n| size             | 12506112                             |\n| status           | active                               |\n| tags             | []                                   |\n| updated_at       | 2017-02-24T08:45:52Z                 |\n| virtual_size     | None                                 |\n| visibility       | public                               |\n+------------------+--------------------------------------+\n\n$ glance image-show 8ce9540e-a802-4e39-a1b4-20cbff14ec18\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | 79b4436412283bb63c2cba4ac796bcd9     |\n| container_format | bare                                 |\n| created_at       | 2017-02-24T09:07:44Z                 |\n| disk_format      | qcow2                                |\n| hw_disk_bus      | scsi                                 |\n| hw_scsi_model    | virtio-scsi                          |\n| id               | 8ce9540e-a802-4e39-a1b4-20cbff14ec18 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | cirros-scsi                          |\n| owner            | bd560276f6bd48219ddcd7c9fb245ec1     |\n| protected        | False                                |\n| size             | 12506112                             |\n| status           | active                               |\n| tags             | []                                   |\n| updated_at       | 2017-02-24T09:07:45Z                 |\n| virtual_size     | None                                 |\n| visibility       | shared                               |\n+------------------+--------------------------------------+\n\n\n$ nova boot --flavor m1.small --image 48888bbf-ddbf-4ede-a30f-b5b4a8e68876 vm1\n$ virsh dumpxml instance-00000003 | grep '.*target.*bus'\n      <target dev='vda' bus='virtio'/>\n\n$ nova rebuild vm1 cirros-scsi \n$ stack@devstack-adam:~/devstack$ nova show vm1 | grep image\n| image                                | cirros-scsi (8ce9540e-a802-4e39-a1b4-20cbff14ec18)\n$ virsh dumpxml instance-00000003 | grep '.*target.*bus'\n      <target dev='vda' bus='virtio'/>\n\nThe problem is that despite property hw_disk_bus set on cirros-scsi (8ce9540e-a802-4e39-a1b4-20cbff14ec18), 'virtio' (and vda) is not replaced in the instance's XML file.\n\nThe expected result IMO should be like a normal boot from this image:\n\n$ nova boot --flavor m1.small --image 8ce9540e-a802-4e39-a1b4-20cbff14ec18 vm2\n$ virsh dumpxml instance-00000004 | grep '.*target.*bus'\n      <target dev='sda' bus='scsi'/>", 
            "date_created": "2017-02-24 12:13:41.784446+00:00", 
            "author": "https://api.launchpad.net/1.0/~adam-kijak"
        }, 
        {
            "content": "The issue appears in also in reverse direction:\nfrom image with 'hw_disk_bus; property  to image without properties.\n\nThe result is that after rebuild an instance is still configured with scsi despite lack of properties on destination image.\n\nAgain, IMO the result should be the same as freshly spawned VM.", 
            "date_created": "2017-02-27 14:54:03.073406+00:00", 
            "author": "https://api.launchpad.net/1.0/~adam-kijak"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/464991", 
            "date_created": "2017-05-16 08:51:51.865635+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}