{
    "status": "In Progress", 
    "last_updated": "2017-09-01 09:03:00.676336+00:00", 
    "description": "If an instance is booted using a bootable volume and then the volume is swapped with a non-bootable volume, it is possible to reboot the instance along with all the data from the previous volume intact.\nBut, if the instance is deleted so that the non-bootable volume becomes available; then it is not possible to boot a new instance using the non-bootable volume unless its Bootable flag is set to True explicitly by the user.\n\nSteps to reproduce:\n\n1. Create a bootable volume.\ncinder create 1 --name lvm_bootable --image-id ab18becb-1262-45da-a1c0-053759a182da\n\n2. Create a non-bootable volume.\ncinder create 1 --name lvm_non_bootable\n\n3. Note the Bootable flag of both the volumes by using cinder list command.\ncinder list\n\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n| ID | Status | Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n| 15acd26a-37a2-48c0-8936-6537e8f8c99a | available | lvm_non_bootable | 1 | lvmdriver-1 | false | |\n| 636978d3-ef65-4c01-9fa6-fb338b1ed2d0 | available | lvm_bootable | 1 | lvmdriver-1 | true | |\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n\n4. Boot an instance using the bootable volume.\nnova boot test1 --flavor 1 --boot-volume 636978d3-ef65-4c01-9fa6-fb338b1ed2d0\n\n5. Swap the bootable volume with the non-bootable volume.\nnova volume-update test1 636978d3-ef65-4c01-9fa6-fb338b1ed2d0 15acd26a-37a2-48c0-8936-6537e8f8c99a\n\n6. Reboot the instance.\nnova reboot test1\n\n7. Note that the Bootable flag of the non-bootable volume is still set to False.\ncinder list\n\n+--------------------------------------+-----------+------------------+------+-------------+----------+--------------------------------------+\n| ID | Status | Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+------------------+------+-------------+----------+--------------------------------------+\n| 15acd26a-37a2-48c0-8936-6537e8f8c99a | in-use | lvm_non_bootable | 1 | lvmdriver-1 | false | d46f50f9-7be3-4e8d-8673-a5fece60184c |\n| 636978d3-ef65-4c01-9fa6-fb338b1ed2d0 | available | lvm_bootable | 1 | lvmdriver-1 | true | |\n+--------------------------------------+-----------+------------------+------+-------------+----------+--------------------------------------+\n\n8. Delete the instance created in step 4 so that the non-bootable volume becomes available.\n\n9. Try to boot another instance using the non-bootable volume.\nnova boot test2 --flavor 1 --boot-volume 15acd26a-37a2-48c0-8936-6537e8f8c99a\n\nERROR (BadRequest): Block Device 15acd26a-37a2-48c0-8936-6537e8f8c99a is not bootable. (HTTP 400) (Request-ID: req-f26cdfba-8d41-4034-a094-27ba944b37e0)\n\nPossible solutions:\n\n1. Non-bootable volumes should not be allowed to swap with any other bootable volume.\n\n2. Bootable flag of the non-bootable volume should be set to True in the code after volume swap so that it can be used to boot an instance when available.\n\n3. Explicitly setting Bootable flag of the available non-bootable volume after volume swapping, if required to boot an instance.", 
    "tags": [
        "volumes"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1642492", 
    "owner": "https://api.launchpad.net/1.0/~bhagyashri-shewale", 
    "id": 1642492, 
    "index": 2117, 
    "openned": "2016-11-17 07:31:44.229250+00:00", 
    "created": "2016-11-17 07:31:44.229250+00:00", 
    "title": "Swapping volume does not change non-bootable volume's 'Bootable' flag to True", 
    "comments": [
        {
            "content": "If an instance is booted using a bootable volume and then the volume is swapped with a non-bootable volume, it is possible to reboot the instance along with all the data from the previous volume intact.\nBut, if the instance is deleted so that the non-bootable volume becomes available; then it is not possible to boot a new instance using the non-bootable volume unless its Bootable flag is set to True explicitly by the user.\n\nThe expected behaviour should be such that the Bootable flag of non-bootable volume must be set to True after successful volume swapping.\n\nSteps to reproduce:\n\n1. Create a bootable volume.\ncinder create 1 --name lvm_bootable --image-id ab18becb-1262-45da-a1c0-053759a182da\n\n2. Create a non-bootable volume.\ncinder create 1 --name lvm_non_bootable\n\n3. Note the Bootable flag of both the volumes by using cinder list command.\ncinder list\n\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n| ID                                   | Status    | Name             | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n| 15acd26a-37a2-48c0-8936-6537e8f8c99a | available | lvm_non_bootable | 1    | lvmdriver-1 | false    |             |\n| 636978d3-ef65-4c01-9fa6-fb338b1ed2d0 | available | lvm_bootable     | 1    | lvmdriver-1 | true     |             |\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n\n4. Boot an instance using the bootable volume.\nnova boot test1 --flavor 1 --boot-volume 636978d3-ef65-4c01-9fa6-fb338b1ed2d0\n\n5. Swap the bootable volume with the non-bootable volume.\nnova volume-update test1 636978d3-ef65-4c01-9fa6-fb338b1ed2d0 15acd26a-37a2-48c0-8936-6537e8f8c99a\n\n6. Reboot the instance.\nnova reboot test1\n\n7. Note that the Bootable flag of the non-bootable volume is still set to False.\ncinder list\n\n+--------------------------------------+-----------+------------------+------+-------------+----------+--------------------------------------+\n| ID                                   | Status    | Name             | Size | Volume Type | Bootable | Attached to                          |\n+--------------------------------------+-----------+------------------+------+-------------+----------+--------------------------------------+\n| 15acd26a-37a2-48c0-8936-6537e8f8c99a | in-use    | lvm_non_bootable | 1    | lvmdriver-1 | false    | d46f50f9-7be3-4e8d-8673-a5fece60184c |\n| 636978d3-ef65-4c01-9fa6-fb338b1ed2d0 | available | lvm_bootable     | 1    | lvmdriver-1 | true     |                                      |\n+--------------------------------------+-----------+------------------+------+-------------+----------+--------------------------------------+\n\n8. Delete the instance created in step 4 so that the non-bootable volume becomes available.\n\n9. Try to boot another instance using the non-bootable volume.\nnova boot test2 --flavor 1 --boot-volume 15acd26a-37a2-48c0-8936-6537e8f8c99a\n\nERROR (BadRequest): Block Device 15acd26a-37a2-48c0-8936-6537e8f8c99a is not bootable. (HTTP 400) (Request-ID: req-f26cdfba-8d41-4034-a094-27ba944b37e0)\n\n10. Change to Bootable flag of 'lvm_non_bootable' explicitly.\ncinder set-bootable 15acd26a-37a2-48c0-8936-6537e8f8c99a True\n\n11. Verify the Bootable flag using cinder list command.\ncinder list\n\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n| ID                                   | Status    | Name             | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n| 15acd26a-37a2-48c0-8936-6537e8f8c99a | available | lvm_non_bootable | 1    | lvmdriver-1 | true     |             |\n| 636978d3-ef65-4c01-9fa6-fb338b1ed2d0 | available | lvm_bootable     | 1    | lvmdriver-1 | true     |             |\n+--------------------------------------+-----------+------------------+------+-------------+----------+-------------+\n\n12. Boot an instance using 'lvm_non_bootable' now.\nnova boot test_nb --flavor 1 --boot-volume 15acd26a-37a2-48c0-8936-6537e8f8c99a\n\n13. Verify that the new instance is created successfully and is up and running.\nnova list\n\n+--------------------------------------+---------+--------+------------+-------------+-------------------------------------------------------+\n| ID                                   | Name    | Status | Task State | Power State | Networks                                              |\n+--------------------------------------+---------+--------+------------+-------------+-------------------------------------------------------+\n| 3d841c14-69cc-404d-9c34-211d17c5efa4 | test_nb | ACTIVE | -          | Running     | private=2001:db8:8000:0:f816:3eff:fe84:253c, 10.0.0.6 |\n+--------------------------------------+---------+--------+------------+-------------+-------------------------------------------------------+", 
            "date_created": "2016-11-17 07:31:44.229250+00:00", 
            "author": "https://api.launchpad.net/1.0/~hussainchachuliya"
        }, 
        {
            "content": "I am just curious how does it even work to boot a VM from a non-bootable volume. Anyway, the first approach sounds the most reasonable to me as the most consistent one.", 
            "date_created": "2016-11-19 15:53:27.100495+00:00", 
            "author": "https://api.launchpad.net/1.0/~mszankin"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/407346", 
            "date_created": "2016-12-06 06:49:22.906805+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "If do so then what is impact on existing instance ? I mean if non bootable volume is swapped then that instance can be accessed without any issue ? and new non bootable volume can be used?\n\nIf so then stopping non bootable volume swap, will change the instance usage if someone using it that way. \n\nI do not have running env as of now. i will update on this once have. till then if you have tried those scenario pleas update. ", 
            "date_created": "2017-09-01 09:03:00.201643+00:00", 
            "author": "https://api.launchpad.net/1.0/~ghanshyammann"
        }
    ]
}