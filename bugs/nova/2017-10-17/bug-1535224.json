{
    "status": "Confirmed", 
    "last_updated": "2017-08-28 11:21:50.315221+00:00", 
    "description": "[Summary]\nmeta data of nova instance with case sensitive has problem when deleting\n\n[Topo]\ndevstack all-in-one node\n\n[Description and expect result]\ncan delete case sensitive meta one by one\n\n[Reproduceable or not]\nreproduceable \n\n[Recreate Steps]\n1) set 4 metas for an instance, if ignore case, they have same string:\nstack@45-59:~/devstack$ nova meta inst set abc=1 Abc=2 ABc=3 ABC=4\nstack@45-59:~/devstack$ nova show inst\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | 45-59                                                          |\n| OS-EXT-SRV-ATTR:hostname             | inst                                                           |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | 45-59                                                          |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | 13716aa6-6110-4b26-9eb4-71f053c14b3d                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | 4c1870c0-520c-4423-8a6b-72e1839eeb76                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-wc29hykh                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                       |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2016-01-18T15:34:42.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2016-01-18T15:34:31Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 8b5dd2a2c67716f40b65b8796dcb25c62f7522764e2dc7f9ff88ea7b       |\n| id                                   | c2f19b32-cf99-4f6f-b9aa-fcf7246ff189                           |\n| image                                | cirros-0.3.4-x86_64-uec (03ada996-9688-471f-ab8c-a9cc18175e2e) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {\"abc\": \"1\", \"Abc\": \"2\", \"ABC\": \"3\", \"ABc\": \"4\"}               |\n| name                                 | inst                                                           |\n| net1 network                         | 1.0.0.3                                                        |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | e88840d981e2457595baed077ed2aac8                               |\n| updated                              | 2016-01-18T15:43:48Z                                           |\n| user_id                              | 9d619f44512a4289a670332300f1089c                               |\n+--------------------------------------+----------------------------------------------------------------+\n\n2) if delete one of them, all are deleted:        >>>>>>>>ISSUE\nstack@45-59:~/devstack$ nova meta inst delete abc\nstack@45-59:~/devstack$ nova show inst\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | 45-59                                                          |\n| OS-EXT-SRV-ATTR:hostname             | inst                                                           |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | 45-59                                                          |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | 13716aa6-6110-4b26-9eb4-71f053c14b3d                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | 4c1870c0-520c-4423-8a6b-72e1839eeb76                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-wc29hykh                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                       |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2016-01-18T15:34:42.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2016-01-18T15:34:31Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 8b5dd2a2c67716f40b65b8796dcb25c62f7522764e2dc7f9ff88ea7b       |\n| id                                   | c2f19b32-cf99-4f6f-b9aa-fcf7246ff189                           |\n| image                                | cirros-0.3.4-x86_64-uec (03ada996-9688-471f-ab8c-a9cc18175e2e) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {}                                                             |\n| name                                 | inst                                                           |\n| net1 network                         | 1.0.0.3                                                        |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | e88840d981e2457595baed077ed2aac8                               |\n| updated                              | 2016-01-18T15:43:48Z                                           |\n| user_id                              | 9d619f44512a4289a670332300f1089c                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@45-59:~/devstack$ \n\n[Configration]\nreproduceable bug, no need\n\n[logs]\nreproduceable bug, no need\n\n[Root cause anlyze or debug inf]\nreproduceable bug\n\n[Attachment]\nNone", 
    "tags": [
        "db"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1535224", 
    "owner": "https://api.launchpad.net/1.0/~ratailor", 
    "id": 1535224, 
    "index": 4430, 
    "openned": "2016-01-18 08:29:59.663305+00:00", 
    "created": "2016-01-18 08:29:59.663305+00:00", 
    "title": "meta data of nova instance with case sensitive has problem when deleting", 
    "comments": [
        {
            "content": "[Summary]\nmeta data of nova instance with case sensitive has problem when deleting\n\n[Topo]\ndevstack all-in-one node\n\n[Description and expect result]\ncan delete case sensitive meta one by one\n\n[Reproduceable or not]\nreproduceable \n\n[Recreate Steps]\n1) set 4 metas for an instance, if ignore case, they have same string:\nstack@45-59:~/devstack$ nova meta inst set abc=1 Abc=2 ABc=3 ABC=4\nstack@45-59:~/devstack$ nova show inst\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | 45-59                                                          |\n| OS-EXT-SRV-ATTR:hostname             | inst                                                           |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | 45-59                                                          |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | 13716aa6-6110-4b26-9eb4-71f053c14b3d                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | 4c1870c0-520c-4423-8a6b-72e1839eeb76                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-wc29hykh                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                       |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2016-01-18T15:34:42.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2016-01-18T15:34:31Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 8b5dd2a2c67716f40b65b8796dcb25c62f7522764e2dc7f9ff88ea7b       |\n| id                                   | c2f19b32-cf99-4f6f-b9aa-fcf7246ff189                           |\n| image                                | cirros-0.3.4-x86_64-uec (03ada996-9688-471f-ab8c-a9cc18175e2e) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {\"abc\": \"1\", \"Abc\": \"2\", \"ABC\": \"3\", \"ABc\": \"4\"}               |\n| name                                 | inst                                                           |\n| net1 network                         | 1.0.0.3                                                        |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | e88840d981e2457595baed077ed2aac8                               |\n| updated                              | 2016-01-18T15:43:48Z                                           |\n| user_id                              | 9d619f44512a4289a670332300f1089c                               |\n+--------------------------------------+----------------------------------------------------------------+\n\n2) if delete one of them, all are deleted:        >>>>>>>>ISSUE\nstack@45-59:~/devstack$ nova meta inst delete abc\nstack@45-59:~/devstack$ nova show inst\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-SRV-ATTR:host                 | 45-59                                                          |\n| OS-EXT-SRV-ATTR:hostname             | inst                                                           |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | 45-59                                                          |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                              |\n| OS-EXT-SRV-ATTR:kernel_id            | 13716aa6-6110-4b26-9eb4-71f053c14b3d                           |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                              |\n| OS-EXT-SRV-ATTR:ramdisk_id           | 4c1870c0-520c-4423-8a6b-72e1839eeb76                           |\n| OS-EXT-SRV-ATTR:reservation_id       | r-wc29hykh                                                     |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                       |\n| OS-EXT-SRV-ATTR:user_data            | -                                                              |\n| OS-EXT-STS:power_state               | 1                                                              |\n| OS-EXT-STS:task_state                | -                                                              |\n| OS-EXT-STS:vm_state                  | active                                                         |\n| OS-SRV-USG:launched_at               | 2016-01-18T15:34:42.000000                                     |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| config_drive                         | True                                                           |\n| created                              | 2016-01-18T15:34:31Z                                           |\n| flavor                               | m1.tiny (1)                                                    |\n| hostId                               | 8b5dd2a2c67716f40b65b8796dcb25c62f7522764e2dc7f9ff88ea7b       |\n| id                                   | c2f19b32-cf99-4f6f-b9aa-fcf7246ff189                           |\n| image                                | cirros-0.3.4-x86_64-uec (03ada996-9688-471f-ab8c-a9cc18175e2e) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {}                                                             |\n| name                                 | inst                                                           |\n| net1 network                         | 1.0.0.3                                                        |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | ACTIVE                                                         |\n| tenant_id                            | e88840d981e2457595baed077ed2aac8                               |\n| updated                              | 2016-01-18T15:43:48Z                                           |\n| user_id                              | 9d619f44512a4289a670332300f1089c                               |\n+--------------------------------------+----------------------------------------------------------------+\nstack@45-59:~/devstack$ \n\n[Configration]\nreproduceable bug, no need\n\n[logs]\nreproduceable bug, no need\n\n[Root cause anlyze or debug inf]\nreproduceable bug\n\n[Attachment]\nNone", 
            "date_created": "2016-01-18 08:29:59.663305+00:00", 
            "author": "https://api.launchpad.net/1.0/~hgangwx"
        }, 
        {
            "content": "Bug skimming result\n===================\nI could reproduce it on master (mitaka) with a devstack single node.\n=> CONFIRMED\n\nNova version\n------------\n    $ git log --oneline -1\n    8ffca40 Imported Translations from Zanata\n    \nSteps to reproduce\n------------------\n   $ nova boot bug1535224 --image cirros-0.3.4-x86_64-uec --flavor m1.tiny\n   $ nova meta bug1535224 set abc=1 Abc=2 ABc=3 ABC=4 foo=bar\n   $ nova meta bug1535224_2 delete abc\n\nPreanalysis\n-----------\nThe REST API gets the correct info to delete the metadata:\n    [...] INFO nova.osapi_compute.wsgi.server [...]\n    192.168.122.214 \"DELETE \n    /v2.1/2cec396e517f4fddb2837eadd824f866/servers/\n    faa394f5-7890-44ae-a729-4823106cc7df/metadata/abc HTTP/1.1\" \n    status: 204 len: 274 time: 0.2725191\n\nThe controllers below use case sensitive dicts as data structures.\n\nTherefore I assume the issue on the database layer.\n\nIf you have questions, I'm available in the IRC channel #openstack-nova\nunder the name \"markus_z\".", 
            "date_created": "2016-01-22 14:41:08.007009+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Correction to #1:\n\n> $ nova meta bug1535224_2 delete abc\n\nshould be:\n\n$ nova meta bug1535224 delete abc", 
            "date_created": "2016-01-22 14:42:08.445147+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "very similar to this one is bug 1538011", 
            "date_created": "2016-01-27 10:59:25.322975+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "Dear Pallavi,\n\nCould I take this bug ahead?\n\nI am proposing fix for this bug, in case you want to work on this bug, feel free to -1 my patch.\nThank you!!", 
            "date_created": "2016-02-26 10:50:20.861079+00:00", 
            "author": "https://api.launchpad.net/1.0/~ranasheel2000"
        }, 
        {
            "content": "This issue is fixed by changing way of deleting metadata entry form database.\nCurrently it uses key to delete database entry but as key can be duplicate.\nFor ex, abc and ABC.\n\nSo, I am implementing id instead of key to fix this issue as id will always be unique.\n\nRefer below for use case run after fix:\n\n[root@localhost sqlalchemy(keystone_admin)]#   nova show c943dfed-8572-4591-a0fd-58e87bd8c92e\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                   |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| OS-EXT-SRV-ATTR:host                 | compute2                                                 |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | compute2                                                 |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000000c                                        |\n| OS-EXT-STS:power_state               | 1                                                        |\n| OS-EXT-STS:task_state                | -                                                        |\n| OS-EXT-STS:vm_state                  | active                                                   |\n| OS-SRV-USG:launched_at               | 2016-02-26T09:50:16.000000                               |\n| OS-SRV-USG:terminated_at             | -                                                        |\n| accessIPv4                           |                                                          |\n| accessIPv6                           |                                                          |\n| config_drive                         |                                                          |\n| created                              | 2016-02-26T09:04:10Z                                     |\n| flavor                               | m1.tiny (1)                                              |\n| hostId                               | 290549584beced55981bf511efdd80645db00691d2f03078c45af029 |\n| id                                   | c943dfed-8572-4591-a0fd-58e87bd8c92e                     |\n| image                                | cirros (26923212-117c-4abb-9364-97e6535d99c6)            |\n| key_name                             | -                                                        |\n| metadata                             | {\"abc\": \"123\", \"ABC\": \"123\"}                             |\n| mynet network                        | 192.168.56.6                                             |\n| name                                 | test10                                                   |\n| os-extended-volumes:volumes_attached | []                                                       |\n| progress                             | 0                                                        |\n| security_groups                      | default                                                  |\n| status                               | ACTIVE                                                   |\n| tenant_id                            | 164284aebd574d77b5dafe8bac16c07e                         |\n| updated                              | 2016-02-26T10:04:25Z                                     |\n| user_id                              | 535413b8790d4e97a714e37f1f76e979                         |\n+--------------------------------------+----------------------------------------------------------+\n[root@localhost sqlalchemy(keystone_admin)]# nova meta c943dfed-8572-4591-a0fd-58e87bd8c92e delete ABC=123\n[root@localhost sqlalchemy(keystone_admin)]#   nova show c943dfed-8572-4591-a0fd-58e87bd8c92e\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                   |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| OS-EXT-SRV-ATTR:host                 | compute2                                                 |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | compute2                                                 |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000000c                                        |\n| OS-EXT-STS:power_state               | 1                                                        |\n| OS-EXT-STS:task_state                | -                                                        |\n| OS-EXT-STS:vm_state                  | active                                                   |\n| OS-SRV-USG:launched_at               | 2016-02-26T09:50:16.000000                               |\n| OS-SRV-USG:terminated_at             | -                                                        |\n| accessIPv4                           |                                                          |\n| accessIPv6                           |                                                          |\n| config_drive                         |                                                          |\n| created                              | 2016-02-26T09:04:10Z                                     |\n| flavor                               | m1.tiny (1)                                              |\n| hostId                               | 290549584beced55981bf511efdd80645db00691d2f03078c45af029 |\n| id                                   | c943dfed-8572-4591-a0fd-58e87bd8c92e                     |\n| image                                | cirros (26923212-117c-4abb-9364-97e6535d99c6)            |\n| key_name                             | -                                                        |\n| metadata                             | {\"abc\": \"123\"}  \n\n\n\nStill abc: 123 is visible under metadata.", 
            "date_created": "2016-02-26 10:52:53.601675+00:00", 
            "author": "https://api.launchpad.net/1.0/~ranasheel2000"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/285222", 
            "date_created": "2016-02-26 10:58:45.162499+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I've -1'ed this proposed fix because this is part of a larger issue of how to handle metadata keys across the board. I've also marked this as a duplicate to the bug filed where we are currently attempting to figure out how to solve this problem.", 
            "date_created": "2016-02-29 19:12:28.673640+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "Removed duplicate status to the other bug as that was specifically with aggregate metadata, although the root problem is the same. The fix for this will be similar, but the tests will need to cover different scenarios. The current solution is to case fold in the sqlachemy api so you would only ever create \"abc\" even if you tried to create multiple metadata keys, ABC aBc abc, etc.", 
            "date_created": "2016-02-29 21:50:39.451596+00:00", 
            "author": "https://api.launchpad.net/1.0/~auggy"
        }, 
        {
            "content": "Dear Augustina Ragwitz,\n\nAre we done with approach finalization..(I did not see any final confirmation on http://lists.openstack.org/pipermail/openstack-dev/2016-February/087404.html)\n\nAs per above comment it seems we are following API folding approach during metadata creation time itself..\nCould you please confirm so that i could go ahead with fix?\n\nAlso are we planning micro version for this?", 
            "date_created": "2016-03-03 07:47:37.598548+00:00", 
            "author": "https://api.launchpad.net/1.0/~ranasheel2000"
        }, 
        {
            "content": "Ohk got confirmation on https://bugs.launchpad.net/nova/+bug/1538011 - comment#14\n\n\"Augustina Ragwitz (auggy) wrote on 2016-02-29:\nPer discussion, current fix strategy is to casefold in sqlalchemy/api.py and force keys to all lower case.\"\n\nI will share patch same way for this bug...\n\nThanks!!", 
            "date_created": "2016-03-03 07:52:05.030093+00:00", 
            "author": "https://api.launchpad.net/1.0/~ranasheel2000"
        }, 
        {
            "content": "Change abandoned by Sheel Rana (<email address hidden>) on branch: master\nReview: https://review.openstack.org/285222\nReason: Its been decided not to fix this..so closing this...", 
            "date_created": "2016-05-07 18:45:39.851903+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "@Sheel Rana,\nCan you give more details on why it is decided not to fix this?\nI went through the comments on the patch and didn't find the reason.\n", 
            "date_created": "2016-05-20 16:34:52.310285+00:00", 
            "author": "https://api.launchpad.net/1.0/~anusha-unnam"
        }, 
        {
            "content": "is this bug closed or can i work on it??", 
            "date_created": "2016-10-17 09:03:41.058936+00:00", 
            "author": "https://api.launchpad.net/1.0/~surbhisarda"
        }
    ]
}