{
    "status": "Invalid", 
    "last_updated": "2017-03-06 11:04:58.032969+00:00", 
    "description": "I am setting up OpenStack Ocata as HA deployment on Ubuntu 16.04. and I am confronted with a heavy blocker. I have set up Keystone, Glance, Nova, Neutron and Horizon. I am able to create and spawn a VM, but it does not boot.\n\nThe block device is created and available in my Ceph cluster. Libvirt gives me only:\nMar  2 17:09:11 os-compute01 virtlogd[3218]: End of file while reading data: Input/output error\n\nThe instances folder located under \"/var/lib/nova/instances\" contains a folder for the VM, but it contains only the empty file \"console.log\" and NO \"libvirt.xml\". Another strange thing is that \"console.log\" is owned by root:root. Under Newton the file is owned by libvirt-qemu:kvm.\n\nI have tried to correct the ownership manaully and copied the VM specification file from \"/etc/libvirt/qemu/instance-*.xml\" to \"/var/lib/nova/instancs/[VM-UUID]/libvirt.xml\". After rebooting the VM the console.log is owned by root:root again and the VM does not boot.\n\nThere seems to be problem in the current Ocata release of Nova.\n\nAny hints how to workaround or fix the problem?\n\nThis is my nova.conf on os-compute01:\n[DEFAULT]\ncompute_monitors = cpu.virt_driver\ndebug = true\nfirewall_driver = nova.virt.firewall.NoopFirewallDriver\nhost = os-compute01\ninstance_usage_audit = true\ninstance_usage_audit_period = hour\nnotify_on_state_change = vm_and_task_state\ninstances_path = $state_path/instances\nlinuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver\nlog_dir = /var/log/nova\nmemcached_servers = os-memcache:11211\nmy_ip = 10.30.200.111\nnotification_driver = messagingv2\nresume_guests_state_on_host_boot = true\nstate_path = /var/lib/nova\ntransport_url = rabbit://nova:SECRET@os-rabbit01:5672,nova:SECRET@os-rabbit02:5672/openstack\nuse_neutron = true\n\n[api]\nauth_strategy = keystone\n\n[cache]\nenabled = true\nbackend = oslo_cache.memcache_pool\nmemcache_servers = os-memcache:11211\n\n[cinder]\ncatalog_info = volumev2:cinderv2:internalURL\n\n[conductor]\nuse_local = false\n\n[glance]\napi_servers = http://os-image:9292\n\n[keystone_authtoken]\nauth_type = password\nauth_uri = http://os-identity:5000\nauth_url = http://os-identity:35357\nmemcached_servers = os-memcache:11211\npassword = SECRET\nproject_domain_name = default\nproject_name = service\nservice_token_roles_required = true\nuser_domain_name = default\nusername = nova\n\n[neutron]\nauth_type = password\nauth_uri = http://os-identity:5000\nauth_url = http://os-identity:35357\npassword = SECRET\nproject_domain_name = default\nproject_name = service\nregion_name = RegionOne\nurl = http://os-network:9696\nuser_domain_name = default\nusername = neutron\n\n[oslo_concurrency]\nlock_path = /var/lock/nova\n\n[oslo_messaging_rabbit]\namqp_durable_queues = true\nrabbit_ha_queues = true\nrabbit_retry_backoff = 2\nrabbit_retry_interval = 1\n\n[placement]\nauth_type = password\nauth_uri = http://os-identity:5000\nauth_url = http://os-identity:35357\nusername = placement\npassword = SECRET\nuser_domain_name = default\nproject_name = service\nproject_domain_name = default\nos_interface = internal\nos_region_name = RegionOne\n\n[vnc]\nenabled = true\nnovncproxy_base_url = https://os-cloud.materna.com:6080/vnc_auto.html\nvncserver_listen = 0.0.0.0\nvncserver_proxyclient_address = $my_ip\n\nand my nova-compute.conf:\n[DEFAULT]\ncompute_driver = libvirt.LibvirtDriver\n\n[libvirt]\ncpu_mode = custom\ncpu_model = SandyBridge\ndisk_cachemodes=\"network=writeback\"\nhw_disk_discard = unmap\nimages_rbd_ceph_conf = /etc/ceph/ceph.conf\nimages_rbd_pool = vms\nimages_type = rbd\ninject_key = false\ninject_partition = -2\ninject_password = false\nrbd_secret_uuid = SECRET\nrbd_user = cinder\nvirt_type = kvm", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1669503", 
    "owner": "None", 
    "id": 1669503, 
    "index": 7975, 
    "openned": "2017-03-02 16:23:47.400320+00:00", 
    "created": "2017-03-02 16:23:47.400320+00:00", 
    "title": "[Libvirt] VM does not boot in Ocata (libvirt.xml missing, wrong owner for console.log)", 
    "comments": [
        {
            "content": "I am setting up OpenStack Ocata as HA deployment on Ubuntu 16.04. and I am confronted with a heavy blocker. I have set up Keystone, Glance, Nova, Neutron and Horizon. I am able to create and spawn a VM, but it does not boot.\n\nThe block device is created and available in my Ceph cluster. Libvirt gives me only:\nMar  2 17:09:11 os-compute01 virtlogd[3218]: End of file while reading data: Input/output error\n\nThe instances folder located under \"/var/lib/nova/instances\" contains a folder for the VM, but it contains only the empty file \"console.log\" and NO \"libvirt.xml\". Another strange thing is that \"console.log\" is owned by root:root. Under Newton the file is owned by libvirt-qemu:kvm.\n\nI have tried to correct the ownership manaully and copied the VM specification file from \"/etc/libvirt/qemu/instance-*.xml\" to \"/var/lib/nova/instancs/[VM-UUID]/libvirt.xml\". After rebooting the VM the console.log is owned by root:root again and the VM does not boot.\n\nThere seems to be problem in the current Ocata release of Nova.\n\nAny hints how to workaround or fix the problem?\n\nThis is my nova.conf on os-compute01:\n[DEFAULT]\ncompute_monitors = cpu.virt_driver\ndebug = true\nfirewall_driver = nova.virt.firewall.NoopFirewallDriver\nhost = os-compute01\ninstance_usage_audit = true\ninstance_usage_audit_period = hour\nnotify_on_state_change = vm_and_task_state\ninstances_path = $state_path/instances\nlinuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver\nlog_dir = /var/log/nova\nmemcached_servers = os-memcache:11211\nmy_ip = 10.30.200.111\nnotification_driver = messagingv2\nresume_guests_state_on_host_boot = true\nstate_path = /var/lib/nova\ntransport_url = rabbit://nova:SECRET@os-rabbit01:5672,nova:SECRET@os-rabbit02:5672/openstack\nuse_neutron = true\n\n[api]\nauth_strategy = keystone\n\n[cache]\nenabled = true\nbackend = oslo_cache.memcache_pool\nmemcache_servers = os-memcache:11211\n\n[cinder]\ncatalog_info = volumev2:cinderv2:internalURL\n\n[conductor]\nuse_local = false\n\n[glance]\napi_servers = http://os-image:9292\n\n[keystone_authtoken]\nauth_type = password\nauth_uri = http://os-identity:5000\nauth_url = http://os-identity:35357\nmemcached_servers = os-memcache:11211\npassword = SECRET\nproject_domain_name = default\nproject_name = service\nservice_token_roles_required = true\nuser_domain_name = default\nusername = nova\n\n[neutron]\nauth_type = password\nauth_uri = http://os-identity:5000\nauth_url = http://os-identity:35357\npassword = SECRET\nproject_domain_name = default\nproject_name = service\nregion_name = RegionOne\nurl = http://os-network:9696\nuser_domain_name = default\nusername = neutron\n\n[oslo_concurrency]\nlock_path = /var/lock/nova\n\n[oslo_messaging_rabbit]\namqp_durable_queues = true\nrabbit_ha_queues = true\nrabbit_retry_backoff = 2\nrabbit_retry_interval = 1\n\n[placement]\nauth_type = password\nauth_uri = http://os-identity:5000\nauth_url = http://os-identity:35357\nusername = placement\npassword = SECRET\nuser_domain_name = default\nproject_name = service\nproject_domain_name = default\nos_interface = internal\nos_region_name = RegionOne\n\n[vnc]\nenabled = true\nnovncproxy_base_url = https://os-cloud.materna.com:6080/vnc_auto.html\nvncserver_listen = 0.0.0.0\nvncserver_proxyclient_address = $my_ip\n\nand my nova-compute.conf:\n[DEFAULT]\ncompute_driver = libvirt.LibvirtDriver\n\n[libvirt]\ncpu_mode = custom\ncpu_model = SandyBridge\ndisk_cachemodes=\"network=writeback\"\nhw_disk_discard = unmap\nimages_rbd_ceph_conf = /etc/ceph/ceph.conf\nimages_rbd_pool = vms\nimages_type = rbd\ninject_key = false\ninject_partition = -2\ninject_password = false\nrbd_secret_uuid = SECRET\nrbd_user = cinder\nvirt_type = kvm", 
            "date_created": "2017-03-02 16:23:47.400320+00:00", 
            "author": "https://api.launchpad.net/1.0/~cfiehe"
        }, 
        {
            "content": "Have a look here:\nhttps://ask.openstack.org/en/question/103598/libvirt-end-of-file-while-reading-data-inputoutput-error-in-ocata-vm-does-not-boot/", 
            "date_created": "2017-03-03 05:13:36.933863+00:00", 
            "author": "https://api.launchpad.net/1.0/~cfiehe"
        }, 
        {
            "content": "There is another strange thing. I am on Ubuntu 16.04.\n\n$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 16.04.2 LTS\nRelease:        16.04\nCodename:       xenial\n\nWhen I create a VM a corresponding xml file gets created in /etc/libvirt/qemu/instance-[id].xml:\n\n<!--\nWARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE\nOVERWRITTEN AND LOST. Changes to this xml configuration should be made using:\n  virsh edit instance-0000003c\nor other application using the libvirt API.\n-->\n\n<domain type='kvm'>\n  <name>instance-0000003c</name>\n  <uuid>7151c8b7-1ea5-4701-bb79-b482d9e253b8</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"15.0.0\"/>\n      <nova:name>test-vm01</nova:name>\n      <nova:creationTime>2017-03-03 08:58:02</nova:creationTime>\n      <nova:flavor name=\"mat.medium\">\n        <nova:memory>4096</nova:memory>\n        <nova:disk>20</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"17aafbe8a8754c2a8e4de9dc1f0643dc\">admin</nova:user>\n        <nova:project uuid=\"53eed6212bd54ff5acc4ad110e9899ac\">demo</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"6112eee2-4bbb-450d-b132-e8b0fdaf03f2\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>4194304</memory>\n  <currentMemory unit='KiB'>4194304</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <cputune>\n    <shares>1024</shares>\n  </cputune>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>15.0.0</entry>\n      <entry name='serial'>3b3fc34f-f5f8-6258-950b-284758b6d5ce</entry>\n      <entry name='uuid'>7151c8b7-1ea5-4701-bb79-b482d9e253b8</entry>\n      <entry name='family'>Virtual Machine</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-zesty'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu mode='custom' match='exact'>\n    <model fallback='allow'>SandyBridge</model>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='network' device='disk'>\n      <driver name='qemu' type='raw' cache='writeback' discard='unmap'/>\n      <auth username='cinder'>\n        <secret type='ceph' uuid='e5479084-e43e-4a1e-959a-b9989f02e632'/>\n      </auth>\n      <source protocol='rbd' name='vms/7151c8b7-1ea5-4701-bb79-b482d9e253b8_disk'>\n        <host name='10.30.200.141' port='6789'/>\n        <host name='10.30.200.142' port='6789'/>\n        <host name='10.30.200.143' port='6789'/>\n      </source>\n      <target dev='sda' bus='scsi'/>\n      <address type='drive' controller='0' bus='0' target='0' unit='0'/>\n    </disk>\n    <controller type='scsi' index='0' model='virtio-scsi'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </controller>\n    <controller type='usb' index='0' model='piix3-uhci'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <interface type='bridge'>\n      <mac address='02:05:69:29:af:e1'/>\n      <source bridge='qbr5663b508-00'/>\n      <target dev='tap5663b508-00'/>\n      <model type='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n    <serial type='pty'>\n      <log file='/var/lib/nova/instances/7151c8b7-1ea5-4701-bb79-b482d9e253b8/console.log' append='off'/>\n      <target port='0'/>\n    </serial>\n    <console type='pty'>\n      <log file='/var/lib/nova/instances/7151c8b7-1ea5-4701-bb79-b482d9e253b8/console.log' append='off'/>\n      <target type='serial' port='0'/>\n    </console>\n    <input type='tablet' bus='usb'>\n      <address type='usb' bus='0' port='1'/>\n    </input>\n    <input type='mouse' bus='ps2'/>\n    <input type='keyboard' bus='ps2'/>\n    <graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0' keymap='en-us'>\n      <listen type='address' address='0.0.0.0'/>\n    </graphics>\n    <video>\n      <model type='cirrus' vram='16384' heads='1' primary='yes'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </video>\n    <memballoon model='virtio'>\n      <stats period='10'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n    </memballoon>\n  </devices>\n</domain>\n\nHave a look to:\n...\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-zesty'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n...\n\nThe machine does not look to be right. It says \"machine='pc-i440fx-zesty\", but should it not be \"machine='pc-i440fx-xenial\"?\n\n\n", 
            "date_created": "2017-03-03 09:03:19.435311+00:00", 
            "author": "https://api.launchpad.net/1.0/~cfiehe"
        }, 
        {
            "content": "I have found a solution. Adding the following configuration to my nova-compute.cong solved the issue:\n\n[libvirt]\nhw_machine_type = \"x86_64=pc-i440fx-xenial,i686=pc-i440fx-xenial\"\n", 
            "date_created": "2017-03-06 10:53:02.802936+00:00", 
            "author": "https://api.launchpad.net/1.0/~cfiehe"
        }, 
        {
            "content": "There is alreay an open issue regarding the empty console.xml:\nhttps://bugs.launchpad.net/ubuntu/+source/libvirt/+bug/1667033", 
            "date_created": "2017-03-06 11:04:57.554270+00:00", 
            "author": "https://api.launchpad.net/1.0/~cfiehe"
        }
    ], 
    "closed": "2017-03-06 10:53:16.525887+00:00"
}