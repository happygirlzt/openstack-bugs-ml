{
    "status": "Invalid", 
    "last_updated": "2014-03-12 00:50:20.415784+00:00", 
    "description": "1) initially setup an all-in-one node that stores instance from an OpenIndiana ZFS sharnfs - works fine; (mount nfs on /var/lib/nova/instances)\n2) start 2nd compute node to join the above node, with its own nfs storage, it works fine; (mounted a separate nfs on /var/lib/nova/instances)\n3) but when changed 2nd node to mount the 1st node's shared nfs (with rw and root access), and start the instance, there seems to be some lock issue that cause permission denied:\n\n(the set up of the nodes were according the to the \"migration configuration\" from the Grizzly admin guide (except that the shared nfs not running on the 1st node, but rather on an nfs share external to both nodes)\n\nerror from /var/lib/nova/nova-compute.log:\n\n_________________________________________\n\n\n013-07-11 10:17:45.204 AUDIT nova.compute.manager [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a\n80-fc46-4d67-ac51-7c3200494e37] Starting instance...\n2013-07-11 10:17:45.532 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Attempting claim: memory 4096 MB, disk 40 GB, VCPUs 2\n2013-07-11 10:17:45.533 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Total Memory: 32173 MB, used: 31232 MB\n2013-07-11 10:17:45.534 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Memory limit: 48259 MB, free: 17027 MB\n2013-07-11 10:17:45.534 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Total Disk: 400 GB, used: 210 GB\n2013-07-11 10:17:45.534 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Disk limit not specified, defaulting to unlimited\n2013-07-11 10:17:45.535 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Total CPU: 16 VCPUs, used: 24 VCPUs\n2013-07-11 10:17:45.535 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] CPU limit not specified, defaulting to unlimited\n2013-07-11 10:17:45.536 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Claim successful\n2013-07-11 10:18:21.587 INFO nova.virt.libvirt.driver [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8\na4a80-fc46-4d67-ac51-7c3200494e37] Creating image\n2013-07-11 10:18:21.643 ERROR nova.compute.manager [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a\n80-fc46-4d67-ac51-7c3200494e37] Instance failed to spawn\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Traceback (most recent call last):\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line \n1103, in _spawn\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     block_device_info)\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", l\nine 1521, in spawn\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     admin_pass=admin_password)\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", l\nine 1807, in _create_image\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     project_id=instance['project_id'])\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.\npy\", line 158, in cache\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     *args, **kwargs)\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.\npy\", line 268, in create_image\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     copy_qcow2_image(base, self.path, size)\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils\n.py\", line 221, in inner\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     with lock:\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils\n.py\", line 75, in __enter__\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     self.lockfile = open(self.fname, 'w')\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] IOError: [Errno 13] Permission denied: '/var/lib/nova/instances/locks/no\nva-_var_lib_nova_instances__base_d999ce594902d400ad6dd53cde02760823176f48'\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] \n2013-07-11 10:18:21.820 AUDIT nova.compute.manager [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a\n80-fc46-4d67-ac51-7c3200494e37] Terminating instance\n2013-07-11 10:18:36.123 5035 ERROR nova.virt.libvirt.driver [-] [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] During wait destroy, instance disappeared.\n2013-07-11 10:18:36.261 ERROR nova.virt.libvirt.vif [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4\na80-fc46-4d67-ac51-7c3200494e37] Failed while unplugging vif\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Traceback (most recent call last):\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/vif.py\", lin\ne 442, in unplug_ovs_hybrid\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     utils.execute('brctl', 'delif', br_name, v1_name, run_as_root=True)\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 239, in e\nxecute\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     cmd=' '.join(cmd))\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] ProcessExecutionError: Unexpected error while running command.\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf brctl delif qbr2723\ne4a7-a3 qvb2723e4a7-a3\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Exit code: 1\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Stdout: ''\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Stderr: 'interface qvb2723e4a7-a3 does not exist!\\n'\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] \n2013-07-11 10:18:36.265 INFO nova.virt.libvirt.driver [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8\na4a80-fc46-4d67-ac51-7c3200494e37] Deleting instance files /var/lib/nova/instances/1e8a4a80-fc46-4d67-ac51-7c3200494e37\n2013-07-11 10:18:36.606 ERROR nova.compute.manager [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a\n80-fc46-4d67-ac51-7c3200494e37] Error: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 848, in _run_instance\\n \n   set_access_ip=set_access_ip)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1107, in _spawn\\n    LOG.exception(_(\\'Instance failed to spawn\\'), \ninstance=instance)\\n', '  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\\n    self.gen.next()\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.p\ny\", line 1103, in _spawn\\n    block_device_info)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1521, in spawn\\n    admin_pass=admin_password)\\\nn', '  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1807, in _create_image\\n    project_id=instance[\\'project_id\\'])\\n', '  File \"/usr/lib/python2.7\n/dist-packages/nova/virt/libvirt/imagebackend.py\", line 158, in cache\\n    *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", lin\ne 268, in create_image\\n    copy_qcow2_image(base, self.path, size)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 221, in inner\\n    wi\nth lock:\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 75, in __enter__\\n    self.lockfile = open(self.fname, \\'w\\')\\n', \"IOError: [Err\nno 13] Permission denied: '/var/lib/nova/instances/locks/nova-_var_lib_nova_instances__base_d999ce594902d400ad6dd53cde02760823176f48'\\n\"]", 
    "tags": [
        "compute", 
        "libvirt", 
        "ops"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1200439", 
    "owner": "None", 
    "id": 1200439, 
    "index": 5103, 
    "openned": "2013-07-12 00:51:56.508962+00:00", 
    "created": "2013-07-12 00:51:56.508962+00:00", 
    "title": "2nd compute node can not start instances from shared nfs ", 
    "comments": [
        {
            "content": "1) initially setup an all-in-one node that stores instance from an OpenIndiana ZFS sharnfs - works fine; (mount nfs on /var/lib/nova/instances)\n2) start 2nd compute node to join the above node, with its own nfs storage, it works fine; (mounted a separate nfs on /var/lib/nova/instances)\n3) but when changed 2nd node to mount the 1st node's shared nfs (with rw and root access), and start the instance, there seems to be some lock issue that cause permission denied:\n\n(the set up of the nodes were according the to the \"migration configuration\" from the Grizzly admin guide (except that the shared nfs not running on the 1st node, but rather on an nfs share external to both nodes)\n\nerror from /var/lib/nova/nova-compute.log:\n\n_________________________________________\n\n\n013-07-11 10:17:45.204 AUDIT nova.compute.manager [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a\n80-fc46-4d67-ac51-7c3200494e37] Starting instance...\n2013-07-11 10:17:45.532 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Attempting claim: memory 4096 MB, disk 40 GB, VCPUs 2\n2013-07-11 10:17:45.533 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Total Memory: 32173 MB, used: 31232 MB\n2013-07-11 10:17:45.534 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Memory limit: 48259 MB, free: 17027 MB\n2013-07-11 10:17:45.534 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Total Disk: 400 GB, used: 210 GB\n2013-07-11 10:17:45.534 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Disk limit not specified, defaulting to unlimited\n2013-07-11 10:17:45.535 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Total CPU: 16 VCPUs, used: 24 VCPUs\n2013-07-11 10:17:45.535 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] CPU limit not specified, defaulting to unlimited\n2013-07-11 10:17:45.536 AUDIT nova.compute.claims [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a8\n0-fc46-4d67-ac51-7c3200494e37] Claim successful\n2013-07-11 10:18:21.587 INFO nova.virt.libvirt.driver [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8\na4a80-fc46-4d67-ac51-7c3200494e37] Creating image\n2013-07-11 10:18:21.643 ERROR nova.compute.manager [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a\n80-fc46-4d67-ac51-7c3200494e37] Instance failed to spawn\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Traceback (most recent call last):\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line \n1103, in _spawn\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     block_device_info)\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", l\nine 1521, in spawn\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     admin_pass=admin_password)\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", l\nine 1807, in _create_image\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     project_id=instance['project_id'])\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.\npy\", line 158, in cache\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     *args, **kwargs)\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.\npy\", line 268, in create_image\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     copy_qcow2_image(base, self.path, size)\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils\n.py\", line 221, in inner\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     with lock:\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils\n.py\", line 75, in __enter__\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     self.lockfile = open(self.fname, 'w')\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] IOError: [Errno 13] Permission denied: '/var/lib/nova/instances/locks/no\nva-_var_lib_nova_instances__base_d999ce594902d400ad6dd53cde02760823176f48'\n2013-07-11 10:18:21.643 5035 TRACE nova.compute.manager [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] \n2013-07-11 10:18:21.820 AUDIT nova.compute.manager [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a\n80-fc46-4d67-ac51-7c3200494e37] Terminating instance\n2013-07-11 10:18:36.123 5035 ERROR nova.virt.libvirt.driver [-] [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] During wait destroy, instance disappeared.\n2013-07-11 10:18:36.261 ERROR nova.virt.libvirt.vif [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4\na80-fc46-4d67-ac51-7c3200494e37] Failed while unplugging vif\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Traceback (most recent call last):\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/vif.py\", lin\ne 442, in unplug_ovs_hybrid\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     utils.execute('brctl', 'delif', br_name, v1_name, run_as_root=True)\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 239, in e\nxecute\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37]     cmd=' '.join(cmd))\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] ProcessExecutionError: Unexpected error while running command.\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Command: sudo nova-rootwrap /etc/nova/rootwrap.conf brctl delif qbr2723\ne4a7-a3 qvb2723e4a7-a3\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Exit code: 1\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Stdout: ''\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] Stderr: 'interface qvb2723e4a7-a3 does not exist!\\n'\n2013-07-11 10:18:36.261 5035 TRACE nova.virt.libvirt.vif [instance: 1e8a4a80-fc46-4d67-ac51-7c3200494e37] \n2013-07-11 10:18:36.265 INFO nova.virt.libvirt.driver [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8\na4a80-fc46-4d67-ac51-7c3200494e37] Deleting instance files /var/lib/nova/instances/1e8a4a80-fc46-4d67-ac51-7c3200494e37\n2013-07-11 10:18:36.606 ERROR nova.compute.manager [req-6268bffe-cc09-47ed-a173-bb681645e34f 24477163d7ca46a38b9d45360a395d59 8db3509086494bc3a0a5174c26392bb1] [instance: 1e8a4a\n80-fc46-4d67-ac51-7c3200494e37] Error: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 848, in _run_instance\\n \n   set_access_ip=set_access_ip)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1107, in _spawn\\n    LOG.exception(_(\\'Instance failed to spawn\\'), \ninstance=instance)\\n', '  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\\n    self.gen.next()\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.p\ny\", line 1103, in _spawn\\n    block_device_info)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1521, in spawn\\n    admin_pass=admin_password)\\\nn', '  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1807, in _create_image\\n    project_id=instance[\\'project_id\\'])\\n', '  File \"/usr/lib/python2.7\n/dist-packages/nova/virt/libvirt/imagebackend.py\", line 158, in cache\\n    *args, **kwargs)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", lin\ne 268, in create_image\\n    copy_qcow2_image(base, self.path, size)\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 221, in inner\\n    wi\nth lock:\\n', '  File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/lockutils.py\", line 75, in __enter__\\n    self.lockfile = open(self.fname, \\'w\\')\\n', \"IOError: [Err\nno 13] Permission denied: '/var/lib/nova/instances/locks/nova-_var_lib_nova_instances__base_d999ce594902d400ad6dd53cde02760823176f48'\\n\"]", 
            "date_created": "2013-07-12 00:51:56.508962+00:00", 
            "author": "https://api.launchpad.net/1.0/~suibin"
        }, 
        {
            "content": "Can you please confirm that the \"locks\" subdirectory for /var/lib/nova/instances exists and has permissions that allow files to be created by the nova user? Perhaps try using \"touch\" to test?\n\nThanks.", 
            "date_created": "2013-08-04 08:04:25.914867+00:00", 
            "author": "https://api.launchpad.net/1.0/~mikal"
        }, 
        {
            "content": "here is the permission on /var/lib/nova/instances/locks:\ndrwxr-xr-x+ 2 nova nova 37 Jul 23 14:05 locks\n\nthe files permissions in locks sub-directory  are \nrw-r--r--", 
            "date_created": "2013-08-05 15:34:17.982727+00:00", 
            "author": "https://api.launchpad.net/1.0/~suibin"
        }, 
        {
            "content": "I am having this same issue. Just upgraded a working Folsom environment to Grizzly. Everything is working great on my main node, however the 2nd node cannot create or migrate VM's receiving the same error accessing files in the locks directory. I have tried to adjust permissions on the directory with no luck. Did you solve this problem? Is there something I'm overlooking?\n\nThanks!", 
            "date_created": "2013-09-10 05:40:58.115090+00:00", 
            "author": "https://api.launchpad.net/1.0/~jeremy-brisko"
        }, 
        {
            "content": "One thing I've seen before (working with installing rpms via yum on RHEL/CentOS/Fedora type systems) and following the admin guide is that if the database migration logs anything and the log files don't exist, they will get created by the root user and then when you run the nova services the nova user (created by the rpms) doesn't have write access to the log files and it bombs out.  I've seen that on other components too like glance and keystone.", 
            "date_created": "2013-10-08 13:24:05.628222+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Ownership has changed. Check these two directories:\n\n/var/lib/nova/instances\n/var/log/nova\n\nYou can fix this by changing ownership to nova.nova. \ne.g.: # chown nova.nova /var/log/nova/nova-manage.log\n\nIn my case I've noticed that nova-manage.log had 0 bytes and root owned it. My locks dir was also belonging to root as well.\n\nCredits to mriedem for the tip.", 
            "date_created": "2013-10-08 13:41:23.778646+00:00", 
            "author": "https://api.launchpad.net/1.0/~rafaelfolco"
        }, 
        {
            "content": "I can not seem to be able to set both my \"control + compute\" and \"2nd compute\" nodes' \"/var/lib/nova/instances\" to nova:nova simultaneously. For example, (by tailing /var/log/nova/nova-compute):\nif I set my 2nd compute to nova:nova; the 1st node will be automatically set to \"libvirt-qemu:mvm\"; if I set the 1st node to \"nova:nova\", the 2nd node becomes \"113:119\" (this is the ownership from the nfs share), by itself.\n\nAs a result, when I start an instance, I can only start the instance on the node with \"nova:nova\"ownership, but the other node will give complaints about \"permission denied\", then the instance will start on the \"nova:nova\" ownership node.\n\nI am pretty sure this is a permission thing. But can anyone share your set up on the ownerships on a shared instance folder, on the compute nodes and on the nfs shares (I am using OpenIndiana sharifs as nfs storage.)?", 
            "date_created": "2013-11-11 01:19:33.485463+00:00", 
            "author": "https://api.launchpad.net/1.0/~suibin"
        }
    ], 
    "closed": "2014-03-12 00:50:17.703738+00:00"
}