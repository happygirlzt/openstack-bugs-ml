{
    "status": "Fix Released", 
    "last_updated": "2014-05-24 04:34:32.791546+00:00", 
    "description": "Reverting a resize of an instance with an attached volume results in the instance changing to ERROR status.\n\n- to reproduce:\n\nnova boot --image {image_id} --flavor 1 myvm\ncinder create --display-name myvol 1\nnova volume-attach myvm myvol auto\nnova resize myvm 2\n# wait for VERIFY_RESIZE\nnova resize-revert myvm\n\n- error message in nova:\n\n'NoneType' object has no attribute 'to_dict'\n\nstack trace:\n\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 258, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 2843, in finish_revert_resize\n    block_device_info, power_on)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4651, in finish_revert_migration\n    block_device_info, power_on)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 3235, in _create_domain_and_network\n    {'connection_info': jsonutils.dumps(connection_info)})\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 416, in block_device_mapping_update\n    context, bdm_id, values)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/conductor/api.py\", line 186, in block_device_mapping_update\n    context, values, create=False)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/conductor/rpcapi.py\", line 258, in block_device_mapping_update_or_create\n    values=values, create=create)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/rpcclient.py\", line 85, in call\n    return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/rpcclient.py\", line 63, in _invoke\n    return cast_or_call(ctxt, msg, **self.kwargs)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/proxy.py\", line 126, in call\n    result = rpc.call(context, real_topic, msg, timeout)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/__init__.py\", line 139, in call\n    return _get_impl().call(CONF, context, topic, msg, timeout)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/impl_kombu.py\", line 816, in call\n    rpc_amqp.get_connection_pool(conf, Connection))\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/amqp.py\", line 572, in call\n    rv = multicall(conf, context, topic, msg, timeout, connection_pool)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/amqp.py\", line 558, in multicall\n    pack_context(msg, context)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/amqp.py\", line 308, in pack_context\n    for (key, value) in context.to_dict().iteritems()])", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1322786", 
    "owner": "None", 
    "id": 1322786, 
    "index": 6138, 
    "openned": "2014-05-24 01:43:17.089144+00:00", 
    "created": "2014-05-24 01:43:17.089144+00:00", 
    "title": "Revert resize failed when vm with volume attached", 
    "comments": [
        {
            "content": "Reverting a resize of an instance with an attached volume results in the instance changing to ERROR status.\n\n- to reproduce:\n\nnova boot --image {image_id} --flavor 1 myvm\ncinder create --display-name myvol 1\nnova volume-attach myvm myvol auto\nnova resize myvm 2\n# wait for VERIFY_RESIZE\nnova resize-revert myvm\n\n- error message in nova:\n\n'NoneType' object has no attribute 'to_dict'\n\nstack trace:\n\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 258, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 2843, in finish_revert_resize\n    block_device_info, power_on)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 4651, in finish_revert_migration\n    block_device_info, power_on)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 3235, in _create_domain_and_network\n    {'connection_info': jsonutils.dumps(connection_info)})\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/compute/manager.py\", line 416, in block_device_mapping_update\n    context, bdm_id, values)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/conductor/api.py\", line 186, in block_device_mapping_update\n    context, values, create=False)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/conductor/rpcapi.py\", line 258, in block_device_mapping_update_or_create\n    values=values, create=create)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/rpcclient.py\", line 85, in call\n    return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/rpcclient.py\", line 63, in _invoke\n    return cast_or_call(ctxt, msg, **self.kwargs)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/proxy.py\", line 126, in call\n    result = rpc.call(context, real_topic, msg, timeout)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/__init__.py\", line 139, in call\n    return _get_impl().call(CONF, context, topic, msg, timeout)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/impl_kombu.py\", line 816, in call\n    rpc_amqp.get_connection_pool(conf, Connection))\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/amqp.py\", line 572, in call\n    rv = multicall(conf, context, topic, msg, timeout, connection_pool)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/amqp.py\", line 558, in multicall\n    pack_context(msg, context)\n  File \"/opt/openstack/nova/lib/python2.7/site-packages/nova/openstack/common/rpc/amqp.py\", line 308, in pack_context\n    for (key, value) in context.to_dict().iteritems()])", 
            "date_created": "2014-05-24 01:43:17.089144+00:00", 
            "author": "https://api.launchpad.net/1.0/~dwding"
        }, 
        {
            "content": "ok seems this has been fixed in icehouse. how can I close it?", 
            "date_created": "2014-05-24 02:04:14.343110+00:00", 
            "author": "https://api.launchpad.net/1.0/~dwding"
        }
    ], 
    "closed": "2014-05-24 04:34:30.598890+00:00"
}