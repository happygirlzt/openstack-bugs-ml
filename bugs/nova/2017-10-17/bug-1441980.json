{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:55:53.314437+00:00", 
    "description": "In my environment, nova version is 2014.1.3, use nova-network vlan mode.\n\nWhen creating an instance use VLAN manager, the instance get network info from VIF, like the bridge name.\nIf bridge name and vlan id not found in the cluster, in network_util.get_vlanid_and_vswitch_for_portgroup returns None, \nbut in function ensure_vlan_bridge, there are two variables accepting None value. \nso it raise TypeError: 'NoneType' object is not iterable.\n\n2015-04-09 03:34:20.399 9891 ERROR nova.compute.manager [req-5c2cef4b-e0b7-4adf-a48d-8fc19d53ed64 4fdbdb45ea224242b9c983a4d80ae639 188a8948c92d47099be6bddf09782e1f] [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a] Instance failed to spawn\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a] Traceback (most recent call last):\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1737, in _spawn\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     block_device_info)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 632, in spawn\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     admin_password, network_info, block_device_info)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 301, in spawn\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     vif_infos = _get_vif_infos()\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 291, in _get_vif_infos\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     self._is_neutron)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vif.py\", line 153, in get_network_ref\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     create_vlan=create_vlan)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vif.py\", line 86, in ensure_vlan_bridge\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     pg_vlanid, pg_vswitch = _get_pg_info(session, bridge, cluster)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a] TypeError: 'NoneType' object is not iterable\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]\n\n\nShould give a return value in network_util.get_vlanid_and_vswitch_for_portgroup when port group not found in ESXi host,\nOr raise an exception ?", 
    "tags": [
        "low-hanging-fruit", 
        "vmware"
    ], 
    "importance": "Low", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1441980", 
    "owner": "https://api.launchpad.net/1.0/~diana-clarke", 
    "id": 1441980, 
    "index": 1677, 
    "openned": "2015-04-09 06:24:49.497722+00:00", 
    "created": "2015-04-09 06:24:49.497722+00:00", 
    "title": "When port group not found in ESXi , get TypeError: 'NoneType' object is not iterable", 
    "comments": [
        {
            "content": "In my environment, nova version is 2014.1.3, use nova-network vlan mode.\n\nWhen creating an instance use VLAN manager, the instance get network info from VIF, like the bridge name.\nIf bridge name and vlan id not found in the cluster, in network_util.get_vlanid_and_vswitch_for_portgroup returns None, \nbut in function ensure_vlan_bridge, there are two variables accepting None value. \nso it raise TypeError: 'NoneType' object is not iterable.\n\n2015-04-09 03:34:20.399 9891 ERROR nova.compute.manager [req-5c2cef4b-e0b7-4adf-a48d-8fc19d53ed64 4fdbdb45ea224242b9c983a4d80ae639 188a8948c92d47099be6bddf09782e1f] [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a] Instance failed to spawn\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a] Traceback (most recent call last):\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1737, in _spawn\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     block_device_info)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 632, in spawn\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     admin_password, network_info, block_device_info)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 301, in spawn\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     vif_infos = _get_vif_infos()\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vmops.py\", line 291, in _get_vif_infos\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     self._is_neutron)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vif.py\", line 153, in get_network_ref\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     create_vlan=create_vlan)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/vif.py\", line 86, in ensure_vlan_bridge\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]     pg_vlanid, pg_vswitch = _get_pg_info(session, bridge, cluster)\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a] TypeError: 'NoneType' object is not iterable\n2015-04-09 03:34:20.399 9891 TRACE nova.compute.manager [instance: 37da5bc7-0a23-4a81-8cf6-cf5cefe5851a]\n\n\nShould give a return value in network_util.get_vlanid_and_vswitch_for_portgroup when port group not found in ESXi host,\nOr raise an exception ?", 
            "date_created": "2015-04-09 06:24:49.497722+00:00", 
            "author": "https://api.launchpad.net/1.0/~hellochosen"
        }, 
        {
            "content": "Review: https://review.openstack.org/#/c/193910/", 
            "date_created": "2015-06-21 22:14:39.207575+00:00", 
            "author": "https://api.launchpad.net/1.0/~diana-clarke"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/193910\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=92148ce9fac723426ea40c9f0bd845f696ac75f9\nSubmitter: Jenkins\nBranch:    master\n\ncommit 92148ce9fac723426ea40c9f0bd845f696ac75f9\nAuthor: Diana Clarke <email address hidden>\nDate:   Sun Jun 21 17:42:24 2015 -0400\n\n    VMware: Handle port group not found case\n    \n    Return None for both vlanid & vswitch if port group not found.\n    \n    Change-Id: I54af3716db587cbe51d11ba2eb2d52fd85af2d30\n    Closes-Bug: #1441980\n", 
            "date_created": "2015-07-09 04:45:28.215237+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-07-28 09:09:16.700712+00:00"
}