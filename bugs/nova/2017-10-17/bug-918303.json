{
    "status": "Invalid", 
    "last_updated": "2012-07-17 15:14:02.035992+00:00", 
    "description": "While testing the support for Xen in Nova Diablo, I ran into an issue with Xenserver 5.6 SP2 : when using VHD images, the glance plugin try to create a temporary disk under the local SR, and use a default value of '/var/run/sr-mount'. However, with LVM based SR, this directory does not exist. Here is the log on nova-compute :\n2012-01-11 11:22:55,114 WARNING nova.virt.xenapi [-] Task [Async.host.call_plugin] OpaqueRef:0c995ea8-ecd3-959c-5178-5e1784f1c571 status: failure    ['XENAP\nI_PLUGIN_EXCEPTION', 'download_vhd', 'OSError', \"[Errno 2] No such file or directory: '/var/run/sr-mount/45274cf4-1e20-d1a5-9f4e-5ddf7cd082f1/tmpYMuI4B'\"]\n2012-01-11 11:22:55,115 ERROR nova.virt.xenapi.vmops [-] instance 29: Failed to spawn\n(nova.virt.xenapi.vmops): TRACE: Traceback (most recent call last):\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 148, in spawn\n(nova.virt.xenapi.vmops): TRACE:     vdis = self._create_disks(context, instance)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 142, in _create_disks\n(nova.virt.xenapi.vmops): TRACE:     disk_image_type)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vm_utils.py\", line 424, in fetch_image\n(nova.virt.xenapi.vmops): TRACE:     session, instance, image, image_type)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vm_utils.py\", line 457, in _fetch_image_glance_vhd\n(nova.virt.xenapi.vmops): TRACE:     result = session.wait_for_task(task, instance_id)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi_conn.py\", line 438, in wait_for_task\n(nova.virt.xenapi.vmops): TRACE:     return done.wait()\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/event.py\", line 116, in wait\n(nova.virt.xenapi.vmops): TRACE:     return hubs.get_hub().switch()\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/hubs/hub.py\", line 177, in switch\n(nova.virt.xenapi.vmops): TRACE:     return self.greenlet.switch()\n(nova.virt.xenapi.vmops): TRACE: Failure: ['XENAPI_PLUGIN_EXCEPTION', 'download_vhd', 'OSError', \"[Errno 2] No such file or directory: '/var/run/sr-mount/45\n274cf4-1e20-d1a5-9f4e-5ddf7cd082f1/tmpYMuI4B'\"]\n\n\nI verified the following:\n\non ext3 :\n[root@xenserver-1 ~]# ls /var/run/sr-mount\n56a38ca3-c603-ca1b-7d8b-9f9e4c768eba 6ee1296c-20df-d6d6-a7e5-9fc520898f76\n[root@xenserver-1 ~]# mount\n/dev/sda1 on / type ext3 (rw)\nnone on /proc type proc (rw)\nnone on /sys type sysfs (rw)\nnone on /dev/pts type devpts (rw)\nnone on /dev/shm type tmpfs (rw)\n/opt/xensource/packages/iso/XenCenter.iso on /var/xen/xc-install type iso9660 (ro,loop=/dev/loop0)\nnone on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)\nsunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)\n/dev/mapper/XSLocalEXT--56a38ca3--c603--ca1b--7d8b--9f9e4c768eba-56a38ca3--c603--ca1b--7d8b--9f9e4c768eba on /var/run/sr-mount/56a38ca3-c603-ca1b-7d8b-9f9e4c768eba type ext3 (rw)\n\non the LVM installation, you get :\n\n[root@xenserver-2 ~]# ls /var/run/sr-mount\nls: /var/run/sr-mount: No such file or directory\n\n[root@xenserver-2 ~]# mount\n/dev/sda1 on / type ext3 (rw)\nnone on /proc type proc (rw)\nnone on /sys type sysfs (rw)\nnone on /dev/pts type devpts (rw)\nnone on /dev/shm type tmpfs (rw)\n/opt/xensource/packages/iso/XenCenter.iso on /var/xen/xc-install type iso9660 (ro,loop=/dev/loop0)\nnone on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)\nsunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)\n\n", 
    "tags": [
        "xenserver"
    ], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/918303", 
    "owner": "None", 
    "id": 918303, 
    "index": 2718, 
    "openned": "2012-01-18 17:19:47.008299+00:00", 
    "created": "2012-01-18 17:19:47.008299+00:00", 
    "title": "nova-compute does not support LVM based Xenserver installations", 
    "comments": [
        {
            "content": "While testing the support for Xen in Nova Diablo, I ran into an issue with Xenserver 5.6 SP2 : when using VHD images, the glance plugin try to create a temporary disk under the local SR, and use a default value of '/var/run/sr-mount'. However, with LVM based SR, this directory does not exist. Here is the log on nova-compute :\n2012-01-11 11:22:55,114 WARNING nova.virt.xenapi [-] Task [Async.host.call_plugin] OpaqueRef:0c995ea8-ecd3-959c-5178-5e1784f1c571 status: failure    ['XENAP\nI_PLUGIN_EXCEPTION', 'download_vhd', 'OSError', \"[Errno 2] No such file or directory: '/var/run/sr-mount/45274cf4-1e20-d1a5-9f4e-5ddf7cd082f1/tmpYMuI4B'\"]\n2012-01-11 11:22:55,115 ERROR nova.virt.xenapi.vmops [-] instance 29: Failed to spawn\n(nova.virt.xenapi.vmops): TRACE: Traceback (most recent call last):\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 148, in spawn\n(nova.virt.xenapi.vmops): TRACE:     vdis = self._create_disks(context, instance)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vmops.py\", line 142, in _create_disks\n(nova.virt.xenapi.vmops): TRACE:     disk_image_type)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vm_utils.py\", line 424, in fetch_image\n(nova.virt.xenapi.vmops): TRACE:     session, instance, image, image_type)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi/vm_utils.py\", line 457, in _fetch_image_glance_vhd\n(nova.virt.xenapi.vmops): TRACE:     result = session.wait_for_task(task, instance_id)\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/virt/xenapi_conn.py\", line 438, in wait_for_task\n(nova.virt.xenapi.vmops): TRACE:     return done.wait()\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/event.py\", line 116, in wait\n(nova.virt.xenapi.vmops): TRACE:     return hubs.get_hub().switch()\n(nova.virt.xenapi.vmops): TRACE:   File \"/usr/lib/pymodules/python2.6/eventlet/hubs/hub.py\", line 177, in switch\n(nova.virt.xenapi.vmops): TRACE:     return self.greenlet.switch()\n(nova.virt.xenapi.vmops): TRACE: Failure: ['XENAPI_PLUGIN_EXCEPTION', 'download_vhd', 'OSError', \"[Errno 2] No such file or directory: '/var/run/sr-mount/45\n274cf4-1e20-d1a5-9f4e-5ddf7cd082f1/tmpYMuI4B'\"]\n\n\nI verified the following:\n\non ext3 :\n[root@xenserver-1 ~]# ls /var/run/sr-mount\n56a38ca3-c603-ca1b-7d8b-9f9e4c768eba 6ee1296c-20df-d6d6-a7e5-9fc520898f76\n[root@xenserver-1 ~]# mount\n/dev/sda1 on / type ext3 (rw)\nnone on /proc type proc (rw)\nnone on /sys type sysfs (rw)\nnone on /dev/pts type devpts (rw)\nnone on /dev/shm type tmpfs (rw)\n/opt/xensource/packages/iso/XenCenter.iso on /var/xen/xc-install type iso9660 (ro,loop=/dev/loop0)\nnone on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)\nsunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)\n/dev/mapper/XSLocalEXT--56a38ca3--c603--ca1b--7d8b--9f9e4c768eba-56a38ca3--c603--ca1b--7d8b--9f9e4c768eba on /var/run/sr-mount/56a38ca3-c603-ca1b-7d8b-9f9e4c768eba type ext3 (rw)\n\non the LVM installation, you get :\n\n[root@xenserver-2 ~]# ls /var/run/sr-mount\nls: /var/run/sr-mount: No such file or directory\n\n[root@xenserver-2 ~]# mount\n/dev/sda1 on / type ext3 (rw)\nnone on /proc type proc (rw)\nnone on /sys type sysfs (rw)\nnone on /dev/pts type devpts (rw)\nnone on /dev/shm type tmpfs (rw)\n/opt/xensource/packages/iso/XenCenter.iso on /var/xen/xc-install type iso9660 (ro,loop=/dev/loop0)\nnone on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)\nsunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)\n\n", 
            "date_created": "2012-01-18 17:19:47.008299+00:00", 
            "author": "https://api.launchpad.net/1.0/~jemartin"
        }, 
        {
            "content": "This is a good question. I think all features are supported on EXT.\n\nI know that certain features are not supported with LVM:\nhttps://blueprints.launchpad.net/nova/+spec/fast-cloning-for-xenserver\n\nNot sure I know were to find a definitive list on what is supported in each storage mode.\n\nCertainly, operations on the VHD files are unlikely to work in LVM mode.", 
            "date_created": "2012-03-09 15:08:32.632373+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "This is add designed, but the documentation is very sketching (working on that right now).\n\nIt would be quite a lot of work to support LVM, and indeed much of it should probably happen in XenServer it-self.\n\nI would say this is more of a blueprint than a bug.\n\nIs there any reason you want to use LVM?", 
            "date_created": "2012-07-05 15:14:52.805110+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "The docs have been updated, making this as invalid.\nYou can launch VMs, but you will have to make CoW=false.", 
            "date_created": "2012-07-17 15:12:06.505464+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Forgot to say:\n- Feel free to add a blueprint to look at supporting more SR types\n- I am actually working with XenServer devs on getting a better API to make it possible to write this once with support for all SR types, but no promises I am afraid", 
            "date_created": "2012-07-17 15:14:01.385942+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }
    ], 
    "closed": "2012-07-17 15:12:28.956068+00:00"
}