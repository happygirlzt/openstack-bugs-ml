{
    "status": "Incomplete", 
    "last_updated": "2017-09-29 11:44:27.903641+00:00", 
    "description": "Following nova unit tests are failing, when running with testtools using below command.\n\n$ python -m testtools.run nova.tests.unit.test_wsgi\n\n[1] nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_two_servers\n[2] nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_ssl_server\n[3] nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_app_using_ipv6_and_ssl\n\nTraceback is similar caused by the SSLError, CertificateError. It's because hostname doesn't match one from cert, sample:\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n\u00a0\u00a0\u00a0\u00a0Traceback (most recent call last):\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0File \"nova/tests/unit/test_wsgi.py\", line 278, in test_two_servers\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0verify=os.path.join(SSL_CERT_DIR, 'ca.crt'), data='PING')\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 112, in post\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return request('post', url, data=data, json=json, **kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 58, in request\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return session.request(method=method, url=url, **kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 508, in request\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resp = self.send(prep, **send_kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 618, in send\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0r = adapter.send(request, **kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/requests/adapters.py\", line 506, in send\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0raise SSLError(e, request=request)\n\u00a0\u00a0\u00a0\u00a0requests.exceptions.SSLError: HTTPSConnectionPool(host='127.0.0.1', port=38499): Max retries exceeded with url: / (Caused by SSLError(CertificateError(\"hostname '127.0.0.1' doesn't match either of 'localhost', 'ip6-localhost'\",),))", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1720062", 
    "owner": "None", 
    "id": 1720062, 
    "index": 2237, 
    "openned": "2017-09-28 06:24:17.256750+00:00", 
    "created": "2017-09-28 06:24:17.256750+00:00", 
    "title": "Nova unit tests are failing ", 
    "comments": [
        {
            "content": "Following nova unit tests are failing, when running with below command.\n\n$ python -m testtools.run nova.tests.unit.test_wsgi\n\n[1] nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_two_servers\n[2] nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_ssl_server\n[3] nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_app_using_ipv6_and_ssl\n\nTraceback is similar caused by the SSLError, CertificateError. It's because hostname doesn't match one from cert, sample:\n\n\nCaptured traceback:\n~~~~~~~~~~~~~~~~~~~\n    Traceback (most recent call last):\n      File \"nova/tests/unit/test_wsgi.py\", line 278, in test_two_servers\n        verify=os.path.join(SSL_CERT_DIR, 'ca.crt'), data='PING')\n      File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 112, in post\n        return request('post', url, data=data, json=json, **kwargs)\n      File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 58, in request\n        return session.request(method=method, url=url, **kwargs)\n      File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 508, in request\n        resp = self.send(prep, **send_kwargs)\n      File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 618, in send\n        r = adapter.send(request, **kwargs)\n      File \"/usr/lib/python2.7/site-packages/requests/adapters.py\", line 506, in send\n        raise SSLError(e, request=request)\n    requests.exceptions.SSLError: HTTPSConnectionPool(host='127.0.0.1', port=38499): Max retries exceeded with url: / (Caused by SSLError(CertificateError(\"hostname '127.0.0.1' doesn't match either of 'localhost', 'ip6-localhost'\",),))", 
            "date_created": "2017-09-28 06:24:17.256750+00:00", 
            "author": "https://api.launchpad.net/1.0/~ratailor"
        }, 
        {
            "content": "What version of nova are you using?  How did you construct your test environment?\n\nThat issues is related to pyOpenSSL and should be resolved by https://review.openstack.org/#/c/489078/ which has already meregd", 
            "date_created": "2017-09-28 22:37:44.341762+00:00", 
            "author": "https://api.launchpad.net/1.0/~o-tony"
        }, 
        {
            "content": "Hi Tony,\n\nI have installed latest master today and tried on that. Still I am getting the same error.\n\nFYI I have captured the traceback again.\n\n\n[stack@devstack-master ~]$ python -m testtools.run nova.tests.unit.test_wsgi\nTests running...\n======================================================================\nERROR: nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_app_using_ipv6_and_ssl\n----------------------------------------------------------------------\npythonlogging:'': {{{\n2017-09-29 11:43:05,109 INFO [nova.wsgi] fake_ssl listening on ::1:45321\n2017-09-29 11:43:05,113 INFO [nova.fake_ssl.wsgi.server] (22144) wsgi starting up on https://[::1]:45321\n2017-09-29 11:43:05,128 ERROR [urllib3.connection] Certificate did not match expected hostname: ::1. Certificate: {'subjectAltName': [('DNS', 'localhost'), ('DNS', 'ip6-localhost'), ('IP Address', '127.0.0.1'), ('IP Address', '::1')], 'subject': ((('commonName', u'*'),),)}\n}}}\n\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/tests/unit/test_wsgi.py\", line 329, in test_app_using_ipv6_and_ssl\n    verify=os.path.join(SSL_CERT_DIR, 'ca.crt'))\n  File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 72, in get\n    return request('get', url, params=params, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 58, in request\n    return session.request(method=method, url=url, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 508, in request\n    resp = self.send(prep, **send_kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 618, in send\n    r = adapter.send(request, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/adapters.py\", line 506, in send\n    raise SSLError(e, request=request)\nrequests.exceptions.SSLError: HTTPSConnectionPool(host='::1', port=45321): Max retries exceeded with url: / (Caused by SSLError(CertificateError(\"hostname '::1' doesn't match either of 'localhost', 'ip6-localhost'\",),))\n======================================================================\nERROR: nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_ssl_server\n----------------------------------------------------------------------\npythonlogging:'': {{{\n2017-09-29 11:43:05,161 INFO [nova.wsgi] fake_ssl listening on 127.0.0.1:35614\n2017-09-29 11:43:05,164 INFO [nova.fake_ssl.wsgi.server] (22144) wsgi starting up on https://127.0.0.1:35614\n2017-09-29 11:43:05,178 ERROR [urllib3.connection] Certificate did not match expected hostname: 127.0.0.1. Certificate: {'subjectAltName': [('DNS', 'localhost'), ('DNS', 'ip6-localhost'), ('IP Address', '127.0.0.1'), ('IP Address', '::1')], 'subject': ((('commonName', u'*'),),)}\n}}}\n\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/tests/unit/test_wsgi.py\", line 254, in test_ssl_server\n    verify=os.path.join(SSL_CERT_DIR, 'ca.crt'), data='PING')\n  File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 112, in post\n    return request('post', url, data=data, json=json, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 58, in request\n    return session.request(method=method, url=url, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 508, in request\n    resp = self.send(prep, **send_kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 618, in send\n    r = adapter.send(request, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/adapters.py\", line 506, in send\n    raise SSLError(e, request=request)\nrequests.exceptions.SSLError: HTTPSConnectionPool(host='127.0.0.1', port=35614): Max retries exceeded with url: / (Caused by SSLError(CertificateError(\"hostname '127.0.0.1' doesn't match either of 'localhost', 'ip6-localhost'\",),))\n======================================================================\nERROR: nova.tests.unit.test_wsgi.TestWSGIServerWithSSL.test_two_servers\n----------------------------------------------------------------------\npythonlogging:'': {{{\n2017-09-29 11:43:05,194 INFO [nova.wsgi] fake_ssl listening on 127.0.0.1:37090\n2017-09-29 11:43:05,195 INFO [nova.wsgi] fake listening on 127.0.0.1:33449\n2017-09-29 11:43:05,196 INFO [nova.fake_ssl.wsgi.server] (22144) wsgi starting up on https://127.0.0.1:37090\n2017-09-29 11:43:05,197 INFO [nova.fake.wsgi.server] (22144) wsgi starting up on http://127.0.0.1:33449\n2017-09-29 11:43:05,212 ERROR [urllib3.connection] Certificate did not match expected hostname: 127.0.0.1. Certificate: {'subjectAltName': [('DNS', 'localhost'), ('DNS', 'ip6-localhost'), ('IP Address', '127.0.0.1'), ('IP Address', '::1')], 'subject': ((('commonName', u'*'),),)}\n}}}\n\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/tests/unit/test_wsgi.py\", line 278, in test_two_servers\n    verify=os.path.join(SSL_CERT_DIR, 'ca.crt'), data='PING')\n  File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 112, in post\n    return request('post', url, data=data, json=json, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/api.py\", line 58, in request\n    return session.request(method=method, url=url, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 508, in request\n    resp = self.send(prep, **send_kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/sessions.py\", line 618, in send\n    r = adapter.send(request, **kwargs)\n  File \"/usr/lib/python2.7/site-packages/requests/adapters.py\", line 506, in send\n    raise SSLError(e, request=request)\nrequests.exceptions.SSLError: HTTPSConnectionPool(host='127.0.0.1', port=37090): Max retries exceeded with url: / (Caused by SSLError(CertificateError(\"hostname '127.0.0.1' doesn't match either of 'localhost', 'ip6-localhost'\",),))\n\nRan 19 tests in 0.718s\nFAILED (failures=3)\n\n", 
            "date_created": "2017-09-29 11:44:27.414414+00:00", 
            "author": "https://api.launchpad.net/1.0/~ratailor"
        }
    ]
}