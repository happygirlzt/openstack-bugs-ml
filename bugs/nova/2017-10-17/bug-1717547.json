{
    "status": "In Progress", 
    "last_updated": "2017-10-04 13:31:53.920314+00:00", 
    "description": "Description:\n\nWhen creating a snapshot of a server using the nova API, failure occurs if the image contains the metadata property \"version\". It seems like image metadata is passed as an argument to _create_v2 (nova/image/glance.py) which is then passed to call (nova/image/glance.py) as kwargs. The function already takes in context, method, and version arguments, so it seems that any of these metadata properties would cause the snapshot to fail.\n\nOpenStack version : Pike\nNova API version : 2.1\n\nSteps to reporduce:\n\n1. Create an image with metadata property \"version\"\n2. Launch an server using this image\n3. Try to create a server snapshot of the server you just launched \n\nimage used:\n+------------------+----------------------------------------------------------------------------+\n| Field            | Value                                                                      |\n+------------------+----------------------------------------------------------------------------+\n| checksum         | d19875d33815bd8c49fe39829b1df924                                           |\n| container_format | bare                                                                       |\n| created_at       | 2017-09-05T15:57:24Z                                                       |\n| disk_format      | raw                                                                        |\n| file             | /v2/images/c7f76154-dd99-4102-afe2-662a4fcaba7b/file                       |\n| id               | c7f76154-dd99-4102-afe2-662a4fcaba7b                                       |\n| min_disk         | 0                                                                          |\n| min_ram          | 0                                                                          |\n| name             | ubuntu-16.04-amd64_2                                                       |\n| owner            | 71cea55297f94953b33b2a2549d72a95                                           |\n| properties       | architecture='amd64', direct_url='rbd://8838dc54-c385-4949-9624-1cf3911320 |\n|                  | 1d/images/c7f76154-dd99-4102-afe2-662a4fcaba7b/snap',                      |\n|                  | distribution='Ubuntu', family='Linux', username='ubuntu', version='16.04'  |\n| protected        | False                                                                      |\n| schema           | /v2/schemas/image                                                          |\n| size             | 2361393152                                                                 |\n| status           | active                                                                     |\n| tags             |                                                                            |\n| updated_at       | 2017-09-14T21:10:44Z                                                       |\n| virtual_size     | None                                                                       |\n| visibility       | public                                                                     |\n+------------------+----------------------------------------------------------------------------+\nExpected result:\nsuccesfully create server snapshot\n\nActual result:\n\nlogs:\n\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions [req-eea1ec3c-a500-4006-ab4d-00a05a6b4f33 f25d972f420840e48163a55bf5713bf6 c657c15a0a13435bbe2c323c732d4e4f - 0e46d3ad069b4f0e85bf594de38fbe0e 0e46d3ad069b4f0e85bf594de38fbe0e] Unexpected exception in API method: TypeError: call() got multiple values for keyword argument 'version'\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 336, in wrapped\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/openstack/common.py\", line 356, in inner\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py\", line 999, in _action_create_image\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     extra_properties=metadata)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/compute/api.py\", line 208, in _wrapped\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return fn(self, context, instance, *args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/compute/api.py\", line 148, in inner\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return f(self, context, instance, *args, **kw)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/compute/api.py\", line 2684, in snapshot\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     extra_properties=extra_properties)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/compute/api.py\", line 2754, in _create_image\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return self.image_api.create(context, image_meta)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/image/api.py\", line 108, in create\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return session.create(context, image_info, data=data)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/image/glance.py\", line 390, in create\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     data, force_activate)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/image/glance.py\", line 467, in _create_v2\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     context, 2, 'create', **sent_service_image_meta)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions TypeError: call() got multiple values for keyword argument 'version'\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions\n<type 'exceptions.TypeError'>", 
    "tags": [
        "low-hanging-fruit", 
        "openstack-version.pike", 
        "snapshot"
    ], 
    "importance": "Low", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1717547", 
    "owner": "https://api.launchpad.net/1.0/~priyad", 
    "id": 1717547, 
    "index": 2235, 
    "openned": "2017-09-15 15:56:38.228243+00:00", 
    "created": "2017-09-15 15:56:38.228243+00:00", 
    "title": "Creating snapshot fails when image metadata has version field", 
    "comments": [
        {
            "content": "\nWhen creating a snapshot of a server using the nova API, failure occurs if the image contains the metadata property \"version\". It seems like image metadata is passed as an argument to _create_v2 (nova/image/glance.py) which is then passed to call (nova/image/glance.py) as kwargs. The function already takes in context, method, and version arguments, so it seems that any of these metadata properties would cause the snapshot to fail.\n\nOpenStack version : Pike\nNova API version : 2.1\n\nimage used:\n+------------------+----------------------------------------------------------------------------+\n| Field            | Value                                                                      |\n+------------------+----------------------------------------------------------------------------+\n| checksum         | d19875d33815bd8c49fe39829b1df924                                           |\n| container_format | bare                                                                       |\n| created_at       | 2017-09-05T15:57:24Z                                                       |\n| disk_format      | raw                                                                        |\n| file             | /v2/images/c7f76154-dd99-4102-afe2-662a4fcaba7b/file                       |\n| id               | c7f76154-dd99-4102-afe2-662a4fcaba7b                                       |\n| min_disk         | 0                                                                          |\n| min_ram          | 0                                                                          |\n| name             | ubuntu-16.04-amd64_2                                                       |\n| owner            | 71cea55297f94953b33b2a2549d72a95                                           |\n| properties       | architecture='amd64', direct_url='rbd://8838dc54-c385-4949-9624-1cf3911320 |\n|                  | 1d/images/c7f76154-dd99-4102-afe2-662a4fcaba7b/snap',                      |\n|                  | distribution='Ubuntu', family='Linux', username='ubuntu', version='16.04'  |\n| protected        | False                                                                      |\n| schema           | /v2/schemas/image                                                          |\n| size             | 2361393152                                                                 |\n| status           | active                                                                     |\n| tags             |                                                                            |\n| updated_at       | 2017-09-14T21:10:44Z                                                       |\n| virtual_size     | None                                                                       |\n| visibility       | public                                                                     |\n+------------------+----------------------------------------------------------------------------+\nlogs:\n\n\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions [req-eea1ec3c-a500-4006-ab4d-00a05a6b4f33 f25d972f420840e48163a55bf5713bf6 c657c15a0a13435bbe2c323c732d4e4f - 0e46d3ad069b4f0e85bf594de38fbe0e 0e46d3ad069b4f0e85bf594de38fbe0e] Unexpected exception in API method: TypeError: call() got multiple values for keyword argument 'version'\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 336, in wrapped\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/openstack/common.py\", line 356, in inner\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py\", line 999, in _action_create_image\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     extra_properties=metadata)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/compute/api.py\", line 208, in _wrapped\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return fn(self, context, instance, *args, **kwargs)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/compute/api.py\", line 148, in inner\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return f(self, context, instance, *args, **kw)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/compute/api.py\", line 2684, in snapshot\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     extra_properties=extra_properties)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/compute/api.py\", line 2754, in _create_image\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return self.image_api.create(context, image_meta)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/image/api.py\", line 108, in create\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     return session.create(context, image_info, data=data)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/image/glance.py\", line 390, in create\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     data, force_activate)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions   File \"/var/lib/kolla/venv/local/lib/python2.7/site-packages/nova/image/glance.py\", line 467, in _create_v2\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions     context, 2, 'create', **sent_service_image_meta)\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions TypeError: call() got multiple values for keyword argument 'version'\n2017-09-14 19:57:53.486 27 ERROR nova.api.openstack.extensions \n<type 'exceptions.TypeError'>", 
            "date_created": "2017-09-15 15:56:38.228243+00:00", 
            "author": "https://api.launchpad.net/1.0/~doucet-girard"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/508533", 
            "date_created": "2017-09-29 14:48:44.195526+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ]
}