{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:11:46.054967+00:00", 
    "description": "branch: master\ncommit: ee955d272ab4eef2e8371f2e460454058ce7e46c\n\nThis happens sometimes when I restart nova-conductor and nova-compute services. The notification via rabbitmq is enabled in nova. \nIs this the same cause of bug https://bugs.launchpad.net/nova/+bug/785816?\n\n\nnova-conductor trace is here:\n\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp\n2013-02-06 19:21:20,250.250 ERROR nova.openstack.common.rpc.amqp [req-6c4474a3-ea95-4b40-9edb-a131c9a32aee None None] Exception during message handling\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/conductor/manager.py\", line 93, in instance_get_all_by_host\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return jsonutils.to_primitive(result)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/openstack/common/jsonutils.py\", line 97, in to_primitive\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     level=level))\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/openstack/common/jsonutils.py\", line 108, in to_primitive\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return to_primitive(dict(value.iteritems()),\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/db/sqlalchemy/models.py\", line 102, in iteritems\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     local = dict(self)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/db/sqlalchemy/models.py\", line 91, in next\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return n, getattr(self, n)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 168, in __get__\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return self.impl.get(instance_state(instance),dict_)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 453, in get\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     value = self.callable_(state, passive)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 481, in _load_for_state\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     (mapperutil.state_str(state), self.key)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp DetachedInstanceError: Parent instance <Instance at 0x443ba10> is not bound to a Session; lazy load operation of attribute 'system_metadata' cannot proceed", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1117232", 
    "owner": "https://api.launchpad.net/1.0/~wenhao-x", 
    "id": 1117232, 
    "index": 4649, 
    "openned": "2013-02-06 11:29:27.918177+00:00", 
    "created": "2013-02-06 11:29:27.918177+00:00", 
    "title": "lazy load operation of attribute 'system_metadata' cannot proceed", 
    "comments": [
        {
            "content": "branch: master\ncommit: ee955d272ab4eef2e8371f2e460454058ce7e46c\n\nThis happens sometimes when I restart nova-conductor and nova-compute services.\nIs this the same cause of bug https://bugs.launchpad.net/nova/+bug/785816?\n\nThe trace is here:\n\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp\n2013-02-06 19:21:20,250.250 ERROR nova.openstack.common.rpc.amqp [req-6c4474a3-ea95-4b40-9edb-a131c9a32aee None None] Exception during message handling\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/conductor/manager.py\", line 93, in instance_get_all_by_host\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return jsonutils.to_primitive(result)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/openstack/common/jsonutils.py\", line 97, in to_primitive\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     level=level))\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/openstack/common/jsonutils.py\", line 108, in to_primitive\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return to_primitive(dict(value.iteritems()),\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/db/sqlalchemy/models.py\", line 102, in iteritems\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     local = dict(self)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/home/wenhao/workspace/openstack/nova/nova/db/sqlalchemy/models.py\", line 91, in next\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return n, getattr(self, n)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 168, in __get__\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     return self.impl.get(instance_state(instance),dict_)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/attributes.py\", line 453, in get\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     value = self.callable_(state, passive)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp   File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/strategies.py\", line 481, in _load_for_state\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp     (mapperutil.state_str(state), self.key)\n2013-02-06 19:21:20,250.250 31860 TRACE nova.openstack.common.rpc.amqp DetachedInstanceError: Parent instance <Instance at 0x443ba10> is not bound to a Session; lazy load operation of attribute 'system_metadata' cannot proceed", 
            "date_created": "2013-02-06 11:29:27.918177+00:00", 
            "author": "https://api.launchpad.net/1.0/~wenhao-x"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/21298", 
            "date_created": "2013-02-06 11:55:27.730603+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/21298\nCommitted: http://github.com/openstack/nova/commit/ecb1f61412cbeb074ebd8ba5a123e2a55821c148\nSubmitter: Jenkins\nBranch:    master\n\ncommit ecb1f61412cbeb074ebd8ba5a123e2a55821c148\nAuthor: Wenhao Xu <email address hidden>\nDate:   Wed Feb 6 19:49:38 2013 +0800\n\n    Fix lazy load 'system_metadata' failed problem.\n    \n    When using lazy load of SQLAlchemy, parent instance may have\n    a problem not bouding to a session object and fail the lazy loading\n    system_metadata.\n    Using joinedload to eagly load the system_metadata in\n    _instance_get_all_query to fix the problem.\n    \n    Fixes: bug 1117232\n    Change-Id: Id24ca534f6eb57167aee22aca12c1274c90baf3c\n", 
            "date_created": "2013-02-07 22:40:09.967380+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-02-21 08:54:56.912248+00:00"
}