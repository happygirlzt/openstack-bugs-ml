{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 09:49:31.223924+00:00", 
    "description": "After updating devstack I can no longer list floating ips.\n\nsteps:\n\n1) install essex devstack (master branch)\n2) create a collection of floating ips (default)\n3) login as a non-admin user (demo is created by default)\n4) click on floating ips\n5) click allocate\n\nExpected:\n\nafter step 4 you should see a blank list, after step 5 you should see a single ip\n\nActual:\n\nAllocation seemed to succeed but horizon reported in both step 4/5:\n\n   Error: Error fetching floating ips: The server has either erred or is incapable of performing the requested operation.\n\n---\n\nIf I look at nova-api I see an error that nova is (improperly) attempting to check for admin-ness.  Members of a project should be able to list IPs for their project.\n\n2011-12-10 14:39:55,358 ERROR nova.api.openstack.v2 [58258ebc-16ac-4d87-8026-a1ddafb7d13f jesse 11] Caught error: Remote error: AdminRequired User does not have admin privileges\n[u'Traceback (most recent call last):\\n', u'  File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 620, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/opt/stack/nova/nova/network/manager.py\", line 434, in get_floating_ips_by_project\\n    context.project_id)\\n', u'  File \"/opt/stack/nova/nova/db/api.py\", line 294, in floating_ip_get_all_by_project\\n    return IMPL.floating_ip_get_all_by_project(context, project_id)\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 113, in wrapper\\n    return f(*args, **kwargs)\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 616, in floating_ip_get_all_by_project\\n    return _floating_ip_get_all(context).\\\\\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 94, in wrapper\\n    raise exception.AdminRequired()\\n', u'AdminRequired: User does not have admin privileges\\n'].\n(nova.api.openstack.v2): TRACE: Traceback (most recent call last):\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/v2/__init__.py\", line 61, in __call__\n(nova.api.openstack.v2): TRACE:     return req.get_response(self.application)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack.v2): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack.v2): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 212, in __call__\n(nova.api.openstack.v2): TRACE:     return self._forward_request(env, start_response, proxy_headers)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 344, in _forward_request\n(nova.api.openstack.v2): TRACE:     return self.app(env, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack.v2): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack.v2): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 499, in __call__\n(nova.api.openstack.v2): TRACE:     response = req.get_response(self.application)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack.v2): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack.v2): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack.v2): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack.v2): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack.v2): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 567, in __call__\n(nova.api.openstack.v2): TRACE:     action_result = self.dispatch(request, action, args)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 599, in dispatch\n(nova.api.openstack.v2): TRACE:     return controller_method(req=request, **action_args)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/v2/contrib/floating_ips.py\", line 75, in index\n(nova.api.openstack.v2): TRACE:     floating_ips = self.network_api.get_floating_ips_by_project(context)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/network/api.py\", line 51, in get_floating_ips_by_project\n(nova.api.openstack.v2): TRACE:     {'method': 'get_floating_ips_by_project'})\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/rpc/__init__.py\", line 45, in call\n(nova.api.openstack.v2): TRACE:     return get_impl().call(context, topic, msg)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 747, in call\n(nova.api.openstack.v2): TRACE:     rv = list(rv)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 715, in __iter__\n(nova.api.openstack.v2): TRACE:     raise result", 
    "tags": [
        "in-milestone-proposed"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/902626", 
    "owner": "https://api.launchpad.net/1.0/~jakedahn", 
    "id": 902626, 
    "index": 2682, 
    "openned": "2011-12-10 20:47:54.251047+00:00", 
    "created": "2011-12-10 20:47:54.251047+00:00", 
    "title": "floating ip list fails for non-admin users", 
    "comments": [
        {
            "content": "After updating devstack I can no longer list floating ips.\n\nsteps:\n\n1) install essex devstack (master branch)\n2) create a collection of floating ips (default)\n3) login as a non-admin user (demo is created by default)\n4) click on floating ips\n5) click allocate\n\nExpected:\n\nafter step 4 you should see a blank list, after step 5 you should see a single ip\n\nActual:\n\nAllocation seemed to succeed but horizon reported in both step 4/5:\n\n   Error: Error fetching floating ips: The server has either erred or is incapable of performing the requested operation.\n\n---\n\nIf I look at nova-api I see an error that nova is (improperly) attempting to check for admin-ness.  Members of a project should be able to list IPs for their project.\n\n2011-12-10 14:39:55,358 ERROR nova.api.openstack.v2 [58258ebc-16ac-4d87-8026-a1ddafb7d13f jesse 11] Caught error: Remote error: AdminRequired User does not have admin privileges\n[u'Traceback (most recent call last):\\n', u'  File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 620, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/opt/stack/nova/nova/network/manager.py\", line 434, in get_floating_ips_by_project\\n    context.project_id)\\n', u'  File \"/opt/stack/nova/nova/db/api.py\", line 294, in floating_ip_get_all_by_project\\n    return IMPL.floating_ip_get_all_by_project(context, project_id)\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 113, in wrapper\\n    return f(*args, **kwargs)\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 616, in floating_ip_get_all_by_project\\n    return _floating_ip_get_all(context).\\\\\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 94, in wrapper\\n    raise exception.AdminRequired()\\n', u'AdminRequired: User does not have admin privileges\\n'].\n(nova.api.openstack.v2): TRACE: Traceback (most recent call last):\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/v2/__init__.py\", line 61, in __call__\n(nova.api.openstack.v2): TRACE:     return req.get_response(self.application)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack.v2): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack.v2): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 212, in __call__\n(nova.api.openstack.v2): TRACE:     return self._forward_request(env, start_response, proxy_headers)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 344, in _forward_request\n(nova.api.openstack.v2): TRACE:     return self.app(env, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack.v2): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack.v2): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 499, in __call__\n(nova.api.openstack.v2): TRACE:     response = req.get_response(self.application)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack.v2): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack.v2): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack.v2): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack.v2): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack.v2): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 567, in __call__\n(nova.api.openstack.v2): TRACE:     action_result = self.dispatch(request, action, args)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 599, in dispatch\n(nova.api.openstack.v2): TRACE:     return controller_method(req=request, **action_args)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/api/openstack/v2/contrib/floating_ips.py\", line 75, in index\n(nova.api.openstack.v2): TRACE:     floating_ips = self.network_api.get_floating_ips_by_project(context)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/network/api.py\", line 51, in get_floating_ips_by_project\n(nova.api.openstack.v2): TRACE:     {'method': 'get_floating_ips_by_project'})\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/rpc/__init__.py\", line 45, in call\n(nova.api.openstack.v2): TRACE:     return get_impl().call(context, topic, msg)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 747, in call\n(nova.api.openstack.v2): TRACE:     rv = list(rv)\n(nova.api.openstack.v2): TRACE:   File \"/opt/stack/nova/nova/rpc/impl_kombu.py\", line 715, in __iter__\n(nova.api.openstack.v2): TRACE:     raise result", 
            "date_created": "2011-12-10 20:47:54.251047+00:00", 
            "author": "https://api.launchpad.net/1.0/~anotherjesse"
        }, 
        {
            "content": "Seems to be a side effect of https://github.com/openstack/nova/commit/c40ee5cfe75e8b1209dc53fc7eb2097812efa54e\n\nline 616 calls _floating_ip_get_all which requires admin\n\nWe could either send a context_elevated or redo the way the call is made", 
            "date_created": "2011-12-10 21:00:02.206692+00:00", 
            "author": "https://api.launchpad.net/1.0/~anotherjesse"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/2345\nCommitted: http://github.com/openstack/nova/commit/369050f3a3f82460825edd23079f8f35334bdf14\nSubmitter: Jenkins\nBranch:    master\n\n status fixcommitted\n done\n\ncommit 369050f3a3f82460825edd23079f8f35334bdf14\nAuthor: jakedahn <email address hidden>\nDate:   Wed Dec 14 16:04:46 2011 -0800\n\n    Bug 902626\n    \n    Fixing typo which breaks floating_ip_get_all_by_project.\n    \n    Change-Id: Ic586455b202ece5a9fb61e78d243502069d39242\n", 
            "date_created": "2011-12-15 00:31:12+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/2359\nCommitted: http://github.com/openstack/nova/commit/b25d1375d52e01418af6faeea2939b23498b2fb9\nSubmitter: Jenkins\nBranch:    milestone-proposed\n\n tag in-milestone-proposed\n done\n\ncommit b25d1375d52e01418af6faeea2939b23498b2fb9\nAuthor: jakedahn <email address hidden>\nDate:   Wed Dec 14 16:04:46 2011 -0800\n\n    Bug 902626\n    \n    Fixing typo which breaks floating_ip_get_all_by_project.\n    \n    Change-Id: Ic586455b202ece5a9fb61e78d243502069d39242\n", 
            "date_created": "2011-12-15 13:36:54+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }
    ], 
    "closed": "2011-12-15 13:55:07.820487+00:00"
}