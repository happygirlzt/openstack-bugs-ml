{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:05:59.420593+00:00", 
    "description": "When libvirtd is not running on a compute node - compute manager still reporting host status as \":-)\".\n \n[30 Minutes after stopping libvirtd]\n\nnova-manage service list:\nBinary           Host                                 Zone             Status     State Updated_At\nnova-cert        camel-nova.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\nnova-scheduler   camel-nova.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\nnova-volume      camel-nova.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\nnova-network     camel-nova.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\nnova-compute     camel-vdsa.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\n\nCompute.log:\n2012-06-10 11:27:25 DEBUG nova.virt.libvirt.connection [-] Connection to libvirt broke from (pid=11618) _test_connection /usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py:318\n2012-06-10 11:27:25 DEBUG nova.virt.libvirt.connection [-] Connecting to libvirt: qemu:///system from (pid=11618) _get_connection /usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py:297\n2012-06-10 11:27:25 ERROR nova.manager [-] Error during ComputeManager.update_available_resource: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory\n2012-06-10 11:27:25 TRACE nova.manager Traceback (most recent call last):\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/manager.py\", line 155, in periodic_tasks\n2012-06-10 11:27:25 TRACE nova.manager     task(self, context)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2403, in update_available_resource\n2012-06-10 11:27:25 TRACE nova.manager     self.driver.update_available_resource(context, self.host)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1907, in update_available_resource\n2012-06-10 11:27:25 TRACE nova.manager     'vcpus_used': self.get_vcpu_used(),\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1731, in get_vcpu_used\n2012-06-10 11:27:25 TRACE nova.manager     for dom_id in self._conn.listDomainsID():\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 304, in _get_connection\n2012-06-10 11:27:25 TRACE nova.manager     self._connect, self.uri, self.read_only)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 147, in proxy_call\n2012-06-10 11:27:25 TRACE nova.manager     rv = execute(f,*args,**kwargs)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 76, in tworker\n2012-06-10 11:27:25 TRACE nova.manager     rv = meth(*args,**kwargs)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 343, in _connect\n2012-06-10 11:27:25 TRACE nova.manager     return libvirt.openAuth(uri, auth, 0)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib64/python2.6/site-packages/libvirt.py\", line 102, in openAuth\n2012-06-10 11:27:25 TRACE nova.manager     if ret is None:raise libvirtError('virConnectOpenAuth() failed')\n2012-06-10 11:27:25 TRACE nova.manager libvirtError: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory\n2012-06-10 11:27:25 TRACE nova.manager \n2012-06-10 11:27:25 DEBUG nova.manager [-] Running periodic task ComputeManager._poll_rebooting_instances from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:152\n2012-06-10 11:27:25 DEBUG nova.manager [-] Skipping ComputeManager._cleanup_running_deleted_instances, 13 ticks left until next run from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:147\n2012-06-10 11:27:25 DEBUG nova.manager [-] Running periodic task ComputeManager._heal_instance_info_cache from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:152\n2012-06-10 11:27:25 DEBUG nova.rpc.amqp [-] Making asynchronous call on network ... from (pid=11618) multicall /usr/lib/python2.6/site-packages/nova/rpc/amqp.py:321\n2012-06-10 11:27:25 DEBUG nova.rpc.amqp [-] MSG_ID is aebead13017b4ec7b38c769861de9c7c from (pid=11618) multicall /usr/lib/python2.6/site-packages/nova/rpc/amqp.py:324\n2012-06-10 11:27:25 DEBUG nova.manager [-] Skipping ComputeManager._run_image_cache_manager_pass, 34 ticks left until next run from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:147\n2012-06-10 11:27:25 DEBUG nova.manager [-] Running periodic task ComputeManager._reclaim_queued_deletes from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:152\n2012-06-10 11:27:25 DEBUG nova.compute.manager [-] FLAGS.reclaim_instance_interval <= 0, skipping... from (pid=11618) _reclaim_queued_deletes /usr/lib/python2.6/site-packages/nova/compute/manager.py:2380\n2012-06-10 11:27:25 DEBUG nova.manager [-] Running periodic task ComputeManager._report_driver_status from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:152\n2012-06-10 11:27:25 INFO nova.compute.manager [-] Updating host status\n2012-06-10 11:27:25 DEBUG nova.virt.libvirt.connection [-] Updating host stats from (pid=11618) update_status /usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py:2475\n\nScheduler.log\n2012-06-10 11:27:25 DEBUG nova.rpc.amqp [-] received {u'_context_roles': [u'admin'], u'_context_request_id': u'req-2ad3e69b-8745-42ca-a52b-a7da8782a2c4', u'_context_read_deleted': u'no', u'args': {u'service_name': u'compute', u'host': u'camel-vdsa.xyz.com', u'capabilities': {u'disk_available': 31, u'vcpus_used': 0, u'hypervisor_type': u'QEMU', u'disk_total': 120, u'host_memory_free': 15411, u'vcpus': 8, u'disk_used': 89, u'host_memory_total': 15951, u'hypervisor_version': 12001, u'cpu_info': {u'arch': u'x86_64', u'model': u'Penryn', u'vendor': u'Intel', u'features': [u'dca', u'pdcm', u'xtpr', u'tm2', u'est', u'vmx', u'ds_cpl', u'monitor', u'dtes64', u'pbe', u'tm', u'ht', u'ss', u'acpi', u'ds', u'vme'], u'topology': {u'cores': u'4', u'threads': u'1', u'sockets': u'2'}}}}, u'_context_auth_token': '<SANITIZED>', u'_context_is_admin': True, u'_context_project_id': None, u'_context_timestamp': u'2012-06-10T08:27:25.490477', u'_context_user_id': None, u'method': u'update_service_capabilities', u'_context_remote_address': None} from (pid=8515) _safe_log /usr/lib/python2.6/site-packages/nova/rpc/common.py:160\n2012-06-10 11:27:25 DEBUG nova.rpc.amqp [req-2ad3e69b-8745-42ca-a52b-a7da8782a2c4 None None] unpacked context: {'user_id': None, 'roles': [u'admin'], 'timestamp': '2012-06-10T08:27:25.490477', 'auth_token': '<SANITIZED>', 'remote_address': None, 'is_admin': True, 'request_id': u'req-2ad3e69b-8745-42ca-a52b-a7da8782a2c4', 'project_id': None, 'read_deleted': u'no'} from (pid=8515) _safe_log /usr/lib/python2.6/site-packages/nova/rpc/common.py:160\n2012-06-10 11:27:25 DEBUG nova.scheduler.host_manager [req-2ad3e69b-8745-42ca-a52b-a7da8782a2c4 None None] Received compute service update from camel-vdsa.qa.lab.tlv.redhat.com. from (pid=8515) update_service_capabilities /usr/lib/python2.6/site-packages/nova/scheduler/host_manager.py:273", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1011087", 
    "owner": "https://api.launchpad.net/1.0/~dims-v", 
    "id": 1011087, 
    "index": 4140, 
    "openned": "2012-06-10 08:39:22.865892+00:00", 
    "created": "2012-06-10 08:39:22.865892+00:00", 
    "title": "Compute service state is beeing reported as ':-)' while libvirtd is not running.", 
    "comments": [
        {
            "content": "When libvirtd is not running on a compute node - compute manager still reporting host status as \":-)\".\n \n[30 Minutes after stopping libvirtd]\n\nnova-manage service list:\nBinary           Host                                 Zone             Status     State Updated_At\nnova-cert        camel-nova.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\nnova-scheduler   camel-nova.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\nnova-volume      camel-nova.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\nnova-network     camel-nova.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\nnova-compute     camel-vdsa.xyz.com     nova             enabled    :-)   2012-06-10 08:29:40\n\nCompute.log:\n2012-06-10 11:27:25 DEBUG nova.virt.libvirt.connection [-] Connection to libvirt broke from (pid=11618) _test_connection /usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py:318\n2012-06-10 11:27:25 DEBUG nova.virt.libvirt.connection [-] Connecting to libvirt: qemu:///system from (pid=11618) _get_connection /usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py:297\n2012-06-10 11:27:25 ERROR nova.manager [-] Error during ComputeManager.update_available_resource: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory\n2012-06-10 11:27:25 TRACE nova.manager Traceback (most recent call last):\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/manager.py\", line 155, in periodic_tasks\n2012-06-10 11:27:25 TRACE nova.manager     task(self, context)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2403, in update_available_resource\n2012-06-10 11:27:25 TRACE nova.manager     self.driver.update_available_resource(context, self.host)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1907, in update_available_resource\n2012-06-10 11:27:25 TRACE nova.manager     'vcpus_used': self.get_vcpu_used(),\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1731, in get_vcpu_used\n2012-06-10 11:27:25 TRACE nova.manager     for dom_id in self._conn.listDomainsID():\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 304, in _get_connection\n2012-06-10 11:27:25 TRACE nova.manager     self._connect, self.uri, self.read_only)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 147, in proxy_call\n2012-06-10 11:27:25 TRACE nova.manager     rv = execute(f,*args,**kwargs)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 76, in tworker\n2012-06-10 11:27:25 TRACE nova.manager     rv = meth(*args,**kwargs)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 343, in _connect\n2012-06-10 11:27:25 TRACE nova.manager     return libvirt.openAuth(uri, auth, 0)\n2012-06-10 11:27:25 TRACE nova.manager   File \"/usr/lib64/python2.6/site-packages/libvirt.py\", line 102, in openAuth\n2012-06-10 11:27:25 TRACE nova.manager     if ret is None:raise libvirtError('virConnectOpenAuth() failed')\n2012-06-10 11:27:25 TRACE nova.manager libvirtError: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory\n2012-06-10 11:27:25 TRACE nova.manager \n2012-06-10 11:27:25 DEBUG nova.manager [-] Running periodic task ComputeManager._poll_rebooting_instances from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:152\n2012-06-10 11:27:25 DEBUG nova.manager [-] Skipping ComputeManager._cleanup_running_deleted_instances, 13 ticks left until next run from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:147\n2012-06-10 11:27:25 DEBUG nova.manager [-] Running periodic task ComputeManager._heal_instance_info_cache from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:152\n2012-06-10 11:27:25 DEBUG nova.rpc.amqp [-] Making asynchronous call on network ... from (pid=11618) multicall /usr/lib/python2.6/site-packages/nova/rpc/amqp.py:321\n2012-06-10 11:27:25 DEBUG nova.rpc.amqp [-] MSG_ID is aebead13017b4ec7b38c769861de9c7c from (pid=11618) multicall /usr/lib/python2.6/site-packages/nova/rpc/amqp.py:324\n2012-06-10 11:27:25 DEBUG nova.manager [-] Skipping ComputeManager._run_image_cache_manager_pass, 34 ticks left until next run from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:147\n2012-06-10 11:27:25 DEBUG nova.manager [-] Running periodic task ComputeManager._reclaim_queued_deletes from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:152\n2012-06-10 11:27:25 DEBUG nova.compute.manager [-] FLAGS.reclaim_instance_interval <= 0, skipping... from (pid=11618) _reclaim_queued_deletes /usr/lib/python2.6/site-packages/nova/compute/manager.py:2380\n2012-06-10 11:27:25 DEBUG nova.manager [-] Running periodic task ComputeManager._report_driver_status from (pid=11618) periodic_tasks /usr/lib/python2.6/site-packages/nova/manager.py:152\n2012-06-10 11:27:25 INFO nova.compute.manager [-] Updating host status\n2012-06-10 11:27:25 DEBUG nova.virt.libvirt.connection [-] Updating host stats from (pid=11618) update_status /usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py:2475\n\nScheduler.log\n2012-06-10 11:27:25 DEBUG nova.rpc.amqp [-] received {u'_context_roles': [u'admin'], u'_context_request_id': u'req-2ad3e69b-8745-42ca-a52b-a7da8782a2c4', u'_context_read_deleted': u'no', u'args': {u'service_name': u'compute', u'host': u'camel-vdsa.xyz.com', u'capabilities': {u'disk_available': 31, u'vcpus_used': 0, u'hypervisor_type': u'QEMU', u'disk_total': 120, u'host_memory_free': 15411, u'vcpus': 8, u'disk_used': 89, u'host_memory_total': 15951, u'hypervisor_version': 12001, u'cpu_info': {u'arch': u'x86_64', u'model': u'Penryn', u'vendor': u'Intel', u'features': [u'dca', u'pdcm', u'xtpr', u'tm2', u'est', u'vmx', u'ds_cpl', u'monitor', u'dtes64', u'pbe', u'tm', u'ht', u'ss', u'acpi', u'ds', u'vme'], u'topology': {u'cores': u'4', u'threads': u'1', u'sockets': u'2'}}}}, u'_context_auth_token': '<SANITIZED>', u'_context_is_admin': True, u'_context_project_id': None, u'_context_timestamp': u'2012-06-10T08:27:25.490477', u'_context_user_id': None, u'method': u'update_service_capabilities', u'_context_remote_address': None} from (pid=8515) _safe_log /usr/lib/python2.6/site-packages/nova/rpc/common.py:160\n2012-06-10 11:27:25 DEBUG nova.rpc.amqp [req-2ad3e69b-8745-42ca-a52b-a7da8782a2c4 None None] unpacked context: {'user_id': None, 'roles': [u'admin'], 'timestamp': '2012-06-10T08:27:25.490477', 'auth_token': '<SANITIZED>', 'remote_address': None, 'is_admin': True, 'request_id': u'req-2ad3e69b-8745-42ca-a52b-a7da8782a2c4', 'project_id': None, 'read_deleted': u'no'} from (pid=8515) _safe_log /usr/lib/python2.6/site-packages/nova/rpc/common.py:160\n2012-06-10 11:27:25 DEBUG nova.scheduler.host_manager [req-2ad3e69b-8745-42ca-a52b-a7da8782a2c4 None None] Received compute service update from camel-vdsa.qa.lab.tlv.redhat.com. from (pid=8515) update_service_capabilities /usr/lib/python2.6/site-packages/nova/scheduler/host_manager.py:273", 
            "date_created": "2012-06-10 08:39:22.865892+00:00", 
            "author": "https://api.launchpad.net/1.0/~davidnaori3"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/8439", 
            "date_created": "2012-06-12 07:14:20.925987+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/17299", 
            "date_created": "2012-12-02 03:54:19.774194+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/17299\nCommitted: http://github.com/openstack/nova/commit/0e85ba136e3c1c2f81f5ed7d594020539100939d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0e85ba136e3c1c2f81f5ed7d594020539100939d\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Sat Dec 1 22:53:34 2012 -0500\n\n    Add notifications when libvirtd goes down\n    \n    During driver status update from periodic tasks, if we find that\n    the libvirtd is down then we should send send notifications and\n    log an error.\n    \n    Fixes LP #1011087\n    \n    Change-Id: I447f24e4ac719d2d550810509f72be6f270ce326\n", 
            "date_created": "2012-12-04 05:30:37.170259+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-01-09 10:24:57.793545+00:00"
}