{
    "status": "Invalid", 
    "last_updated": "2017-01-03 15:08:20.293829+00:00", 
    "description": "Description\n===========\n\nI get an error after upgrade half of my cluster. Can't place any VMs.\n\"RemoteError: Remote error: IncompatibleObjectVersion Version 2.1 of InstanceList is not supported\"\n\nSteps to reproduce\n==================\n\n1) Install 4 nodes with mitaka\n2) Disable 2 nodes (1 api controller and 1 compute): nova service-disable\n3) Upgrade to newton on the disable nodes\n4) compute=mitaka to [upgrade_levels]\n5) db sync\n6) Start newton\n7) Try to place any VMs, it will fail\n8) See nova-compute.log on the mitaka nodes\n\nExpected result\n===============\n\nSuccessful upgrade one half of cluster, then another half\n\nActual result\n=============\n\nNova can't place any VMs.\n\nCompute logs:\n\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task [req-41e6df10-b33b-47f5-be0c-86793cbcae6e - - - - -] Error during ComputeManager._sync_scheduler_instance_info\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task Traceback (most recent call last):\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_service/periodic_task.py\", line 220, in run_periodic_tasks\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     task(self, context)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1637, in _sync_scheduler_instance_info\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     use_slave=True)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 177, in wrapper\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     args, kwargs)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/conductor/rpcapi.py\", line 236, in object_class_action_versions\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     args=args, kwargs=kwargs)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py\", line 169, in call\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     retry=self.retry)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py\", line 97, in _send\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     timeout=timeout, retry=retry)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 464, in send\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     retry=retry)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 455, in _send\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     raise result\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task RemoteError: Remote error: IncompatibleObjectVersion Version 2.1 of InstanceList is not supported\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\\n', u'  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 185, in _dispatch\\n', u'  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\\n    :param incoming: incoming message\\n', u'  File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 92, in object_class_action_versions\\n    objname, object_versions[objname])\\n', u'  File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 374, in obj_class_from_name\\n    supported=latest_ver)\\n', u'IncompatibleObjectVersion: Version 2.1 of InstanceList is not supported\\n'].\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task\n\nnova-conductor:\n\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher [req-7a6eccb3-ade3-4c9f-b6f2-1588f9eb7ed0 - - - - -] Exception during message handling: Version 2.1 of InstanceList is not supported\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 185, in _dispatch\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher     :param incoming: incoming message\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 92, in object_class_action_versions\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher     objname, object_versions[objname])\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 374, in obj_class_from_name\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher     supported=latest_ver)\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher IncompatibleObjectVersion: Version 2.1 of InstanceList is not supported\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher\n2016-12-23 08:01:00.491 9958 ERROR oslo_messaging._drivers.common [req-7a6eccb3-ade3-4c9f-b6f2-1588f9eb7ed0 - - - - -] Returning exception Version 2.1 of InstanceList is not supported to caller\n2016-12-23 08:01:00.492 9958 ERROR oslo_messaging._drivers.common [req-7a6eccb3-ade3-4c9f-b6f2-1588f9eb7ed0 - - - - -] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\\n', '  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 185, in _dispatch\\n', '  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\\n    :param incoming: incoming message\\n', '  File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 92, in object_class_action_versions\\n    objname, object_versions[objname])\\n', '  File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 374, in obj_class_from_name\\n    supported=latest_ver)\\n', 'IncompatibleObjectVersion: Version 2.1 of InstanceList is not supported\\n']\n\nEnvironment\n===========\n\nCentOS Linux 7 (Core) 3.10.0-514.2.2.el7.x86_64 #1 SMP Tue Dec 6 23:06:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\nmitaka nodes:\ncompute:\npython2-novaclient-3.3.2-1.el7.noarch\nopenstack-nova-compute-13.1.2-1.el7.noarch\npython-nova-13.1.2-1.el7.noarch\nopenstack-nova-common-13.1.2-1.el7.noarch\n\ncontoller:\nopenstack-nova-scheduler-13.1.2-1.el7.noarch\nopenstack-nova-conductor-13.1.2-1.el7.noarch\nnova-solver-compute-lib-2016.2-2.noarch\npython-nova-13.1.2-1.el7.noarch\nopenstack-nova-api-13.1.2-1.el7.noarch\nnovameter-2016.2-3.noarch\nopenstack-nova-common-13.1.2-1.el7.noarch\nopenstack-nova-console-13.1.2-1.el7.noarch\npython2-novaclient-3.3.2-1.el7.noarch\nopenstack-nova-novncproxy-13.1.2-1.el7.noarch\n\nnetonw nodes:\ncompute:\npython2-novaclient-3.3.2-1.el7.noarch\npython-nova-14.0.2-1.el7.noarch\nopenstack-nova-common-14.0.2-1.el7.noarch\nopenstack-nova-compute-14.0.2-1.el7.noarch\n\ncontroller:\nopenstack-nova-common-14.0.2-1.el7.noarch\nopenstack-nova-console-14.0.2-1.el7.noarch\nnovameter-2016.2-3.noarch\nopenstack-nova-conductor-14.0.2-1.el7.noarch\nopenstack-nova-novncproxy-14.0.2-1.el7.noarch\nopenstack-nova-api-14.0.2-1.el7.noarch\nopenstack-nova-scheduler-14.0.2-1.el7.noarch\npython2-novaclient-3.3.2-1.el7.noarch\nnova-solver-compute-lib-2016.2-2.noarch\npython-nova-14.0.2-1.el7.noarch", 
    "tags": [
        "unified-objects", 
        "upgrades"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1652233", 
    "owner": "None", 
    "id": 1652233, 
    "index": 7859, 
    "openned": "2016-12-23 07:06:09.168167+00:00", 
    "created": "2016-12-23 07:06:09.168167+00:00", 
    "title": "mitaka is incompatible with newton - IncompatibleObjectVersion Version 2.1 of InstanceList is not supported", 
    "comments": [
        {
            "content": "Description\n===========\n\nI get an error after upgrade half of my cluster. Can't place any VMs.\n\"RemoteError: Remote error: IncompatibleObjectVersion Version 2.1 of InstanceList is not supported\"\n\nSteps to reproduce\n==================\n\n1) Install 4 nodes with mitaka\n2) Disable 2 nodes (1 api controller and 1 compute): nova service-disable\n3) Upgrade to newton on disable nodes\n4) compute=mitaka to [upgrade_levels]\n5) db sync\n6) Start newton\n7) Try to place any VMs, it fill fail\n8) see nova-compute.log on the mitaka nodes\n\nExpected result\n===============\n\nSuccessful upgrade one half of cluster, then another half\n\nActual result\n=============\n\nNova can't place any VMs.\n\nCompute logs:\n\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task [req-41e6df10-b33b-47f5-be0c-86793cbcae6e - - - - -] Error during ComputeManager._sync_scheduler_instance_info\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task Traceback (most recent call last):\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_service/periodic_task.py\", line 220, in run_periodic_tasks\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     task(self, context)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 1637, in _sync_scheduler_instance_info\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     use_slave=True)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 177, in wrapper\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     args, kwargs)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/nova/conductor/rpcapi.py\", line 236, in object_class_action_versions\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     args=args, kwargs=kwargs)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py\", line 169, in call\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     retry=self.retry)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py\", line 97, in _send\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     timeout=timeout, retry=retry)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 464, in send\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     retry=retry)\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 455, in _send\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task     raise result\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task RemoteError: Remote error: IncompatibleObjectVersion Version 2.1 of InstanceList is not supported\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\\n', u'  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 185, in _dispatch\\n', u'  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\\n    :param incoming: incoming message\\n', u'  File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 92, in object_class_action_versions\\n    objname, object_versions[objname])\\n', u'  File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 374, in obj_class_from_name\\n    supported=latest_ver)\\n', u'IncompatibleObjectVersion: Version 2.1 of InstanceList is not supported\\n'].\n2016-12-23 07:26:11.434 15392 ERROR oslo_service.periodic_task\n\n\nnova-conductor:\n\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher [req-7a6eccb3-ade3-4c9f-b6f2-1588f9eb7ed0 - - - - -] Exception during message handling: Version 2.1 of InstanceList is not supported\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 185, in _dispatch\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher     :param incoming: incoming message\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 92, in object_class_action_versions\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher     objname, object_versions[objname])\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 374, in obj_class_from_name\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher     supported=latest_ver)\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher IncompatibleObjectVersion: Version 2.1 of InstanceList is not supported\n2016-12-23 08:01:00.489 9958 ERROR oslo_messaging.rpc.dispatcher\n2016-12-23 08:01:00.491 9958 ERROR oslo_messaging._drivers.common [req-7a6eccb3-ade3-4c9f-b6f2-1588f9eb7ed0 - - - - -] Returning exception Version 2.1 of InstanceList is not supported to caller\n2016-12-23 08:01:00.492 9958 ERROR oslo_messaging._drivers.common [req-7a6eccb3-ade3-4c9f-b6f2-1588f9eb7ed0 - - - - -] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 138, in _dispatch_and_reply\\n', '  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 185, in _dispatch\\n', '  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 127, in _do_dispatch\\n    :param incoming: incoming message\\n', '  File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 92, in object_class_action_versions\\n    objname, object_versions[objname])\\n', '  File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 374, in obj_class_from_name\\n    supported=latest_ver)\\n', 'IncompatibleObjectVersion: Version 2.1 of InstanceList is not supported\\n']\n\n\nEnvironment\n===========\n\nCentOS Linux 7 (Core) 3.10.0-514.2.2.el7.x86_64 #1 SMP Tue Dec 6 23:06:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\nmitaka nodes:\ncompute:\npython2-novaclient-3.3.2-1.el7.noarch\nopenstack-nova-compute-13.1.2-1.el7.noarch\npython-nova-13.1.2-1.el7.noarch\nopenstack-nova-common-13.1.2-1.el7.noarch\n\ncontoller:\nopenstack-nova-scheduler-13.1.2-1.el7.noarch\nopenstack-nova-conductor-13.1.2-1.el7.noarch\nnova-solver-compute-lib-2016.2-2.noarch\npython-nova-13.1.2-1.el7.noarch\nopenstack-nova-api-13.1.2-1.el7.noarch\nnovameter-2016.2-3.noarch\nopenstack-nova-common-13.1.2-1.el7.noarch\nopenstack-nova-console-13.1.2-1.el7.noarch\npython2-novaclient-3.3.2-1.el7.noarch\nopenstack-nova-novncproxy-13.1.2-1.el7.noarch\n\nnetonw nodes:\ncompute:\npython2-novaclient-3.3.2-1.el7.noarch\npython-nova-14.0.2-1.el7.noarch\nopenstack-nova-common-14.0.2-1.el7.noarch\nopenstack-nova-compute-14.0.2-1.el7.noarch\n\ncontroller:\nopenstack-nova-common-14.0.2-1.el7.noarch\nopenstack-nova-console-14.0.2-1.el7.noarch\nnovameter-2016.2-3.noarch\nopenstack-nova-conductor-14.0.2-1.el7.noarch\nopenstack-nova-novncproxy-14.0.2-1.el7.noarch\nopenstack-nova-api-14.0.2-1.el7.noarch\nopenstack-nova-scheduler-14.0.2-1.el7.noarch\npython2-novaclient-3.3.2-1.el7.noarch\nnova-solver-compute-lib-2016.2-2.noarch\npython-nova-14.0.2-1.el7.noarch", 
            "date_created": "2016-12-23 07:06:09.168167+00:00", 
            "author": "https://api.launchpad.net/1.0/~gunph1ld"
        }, 
        {
            "content": "Your nova-conductor node/service is still running mitaka code, correct? And do you have upgrade_levels set to anything in the nova.conf on the host that's running the nova-conductor service?", 
            "date_created": "2016-12-29 20:49:21.135532+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Oh I guess you have mitaka and newton controllers, so nova-conductor services are running both versions, I'm not sure if that's going to work unless you've set [upgrade_levels]compute=mitaka in both places and restarted nova-conductor.\n\nDan Smith is really the person to ask about this but he's out until next week.", 
            "date_created": "2016-12-29 20:52:21.911915+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Matt, thanks for the answer. This is my 4th step in the \"Reproduce list\":\n\n\"4) compute=mitaka to [upgrade_levels]\"", 
            "date_created": "2016-12-30 06:12:27.140640+00:00", 
            "author": "https://api.launchpad.net/1.0/~gunph1ld"
        }, 
        {
            "content": "Yeah, mixed-version controllers isn't supported. We've made some progress towards being able to support it in master, but it's definitely not going to work in mitaka/newton.\n\nYou have to upgrade your controllers simultaneously (well, most critically, your conductor services), and then you can have any mix of versions among your computes that you want.", 
            "date_created": "2017-01-03 15:08:02.352125+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }
    ], 
    "closed": "2017-01-03 15:08:17.546201+00:00"
}