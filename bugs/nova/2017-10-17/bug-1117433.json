{
    "status": "Invalid", 
    "last_updated": "2013-02-27 00:20:19.275504+00:00", 
    "description": "Important note: this occurred post-upgrade from essex to folsom. I'm using the CentOS packages provided by EPEL.\n\nsteps:\n\n1) obtain an auth-token\n\ncurl -H 'Content-Type: application/json' -d '{ \"auth\": {\"tenantName\": \"Development\", \"passwordCredentials\": {\"username\": \"jenkins\", \"password\": \"*****\"} } }' http://10.0.80.15:5000/v2.0/tokens\n\"access\": {\"token\": {\"expires\": \"2013-02-07T15:23:49Z\", \"id\": \"e3d266a113a64558801537830b01001d\", \"tenant\": {\"enabled\": true, \"description\": \"The developer group\", \"name\": \"Development\", \"id\": \"62b31fa8598a443487d99a79b6ba5547\"}}, \"serviceCatalog\": [{\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:8774/v2/62b31fa8598a443487d99a79b6ba5547\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:8774/v2/62b31fa8598a443487d99a79b6ba5547\", \"id\": \"bb7fa36c03bf48589b87109509bfacb0\", \"publicURL\": \"http://10.0.80.15:8774/v2/62b31fa8598a443487d99a79b6ba5547\"}], \"endpoints_links\": [], \"type\": \"compute\", \"name\": \"nova\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:9292/v1\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:9292/v1\", \"id\": \"a1560797b76d45209af5820c72edf0c3\", \"publicURL\": \"http://10.0.80.15:9292/v1\"}], \"endpoints_links\": [], \"type\": \"image\", \"name\": \"glance\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:8776/v1/62b31fa8598a443487d99a79b6ba5547\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:8776/v1/62b31fa8598a443487d99a79b6ba5547\", \"id\": \"214577425ac8411ea114f5d0285d2814\", \"publicURL\": \"http://10.0.80.15:8776/v1/62b31fa8598a443487d99a79b6ba5547\"}], \"endpoints_links\": [], \"type\": \"volume\", \"name\": \"volume\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:8773/services/Admin\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:8773/services/Cloud\", \"id\": \"8d0f2bbbd729465eaf92964c728a60db\", \"publicURL\": \"http://10.0.80.15:8773/services/Cloud\"}], \"endpoints_links\": [], \"type\": \"ec2\", \"name\": \"ec2\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:8080/\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:8080/v1/AUTH_62b31fa8598a443487d99a79b6ba5547\", \"id\": \"8ab8b4cddd224f8facba3bcaf909b323\", \"publicURL\": \"http://10.0.80.15:8080/v1/AUTH_62b31fa8598a443487d99a79b6ba5547\"}], \"endpoints_links\": [], \"type\": \"object-store\", \"name\": \"swift\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:35357/v2.0\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:5000/v2.0\", \"id\": \"1e030df055e54aa2bde029f30a50c79d\", \"publicURL\": \"http://10.0.80.15:5000/v2.0\"}], \"endpoints_links\": [], \"type\": \"identity\", \"name\": \"keystone\"}], \"user\": {\"username\": \"jenkins\", \"roles_links\": [], \"id\": \"f80bbe2743b74f92a85ba61e8f93e62c\", \"roles\": [], \"name\": \"jenkins\"}}}\n\n2) attempt to list servers for a tenant\n\ncurl -v -H 'X-Auth-Token: e3d266a113a64558801537830b01001d'\n\nExpected:\n\nA list of servers for the Development tenant.\n\nActual:\n\nReply from server:\nhttp://10.0.80.15:8774/v2/2201915216d143038d65f61e323caf15/servers\n* About to connect() to 10.0.80.15 port 8774 (#0)\n*   Trying 10.0.80.15...\n* connected\n* Connected to 10.0.80.15 (10.0.80.15) port 8774 (#0)\n> GET /v2/2201915216d143038d65f61e323caf15/servers HTTP/1.1\n> User-Agent: curl/7.24.0 (x86_64-apple-darwin12.0) libcurl/7.24.0 OpenSSL/0.9.8r zlib/1.2.5\n> Host: 10.0.80.15:8774\n> Accept: */*\n> X-Auth-Token: e3d266a113a64558801537830b01001d\n>\n< HTTP/1.1 500 Internal Server Error\n< Content-Length: 128\n< Content-Type: application/json; charset=UTF-8\n< Date: Wed, 06 Feb 2013 15:24:38 GMT\n<\n* Connection #0 to host 10.0.80.15 left intact\n{\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}* Closing connection #0\n\nStack trace:\n\n2013-02-05 16:01:31 6291 ERROR nova.api.openstack [-] Caught error: u'project_id'\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack Traceback (most recent call last):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/__init__.py\", line 78, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/request.py\", line 1053, in get_response\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/request.py\", line 1022, in call_application\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 159, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/keystone/middleware/auth_token.py\", line 278, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 147, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 208, in call_func\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/api/auth.py\", line 117, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     service_catalog=service_catalog)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/context.py\", line 70, in __init__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     self.is_admin = policy.check_is_admin(self.roles)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/policy.py\", line 115, in check_is_admin\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     exception.PolicyNotAuthorized, action=action)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 125, in enforce\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     if not _BRAIN.check(match_list, target_dict, credentials_dict):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01,1           Top\n2013-02-05 16:01:31 6291 ERROR nova.api.openstack [-] Caught error: u'project_id'\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack Traceback (most recent call last):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/__init__.py\", line 78, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/request.py\", line 1053, in get_response\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/request.py\", line 1022, in call_application\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 159, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/keystone/middleware/auth_token.py\", line 278, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 147, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 208, in call_func\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/api/auth.py\", line 117, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     service_catalog=service_catalog)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/context.py\", line 70, in __init__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     self.is_admin = policy.check_is_admin(self.roles)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/policy.py\", line 115, in check_is_admin\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     exception.PolicyNotAuthorized, action=action)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 125, in enforce\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     if not _BRAIN.check(match_list, target_dict, credentials_dict):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 300, in _check_generic\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     match = match % target_dict\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack KeyError: u'project_id'\n\nThis may be a config problem on my end, but regardless this error is pretty obfuscated. I've tracked it down to an empty target_dict being passed in to _check_generic via the policy.is_admin check. It does directly seem to be related to my policy.json for the nova service, which has the following default_rule:\n\n\u00a0\u00a0\u00a0\u00a0\"admin_or_owner\":  [[\"role:admin\"], [\"project_id:%(project_id)s\"]],\n\u00a0\u00a0\u00a0\u00a0\"default\": [[\"rule:admin_or_owner\"]],\n\nChanging project_id:%(project_id)s to any other key causes that to be raised as the KeyError. Removing the secondary part of admin_or_owner causes:\n\nERROR: Policy doesn't allow compute:get_instance_faults to be performed. (HTTP 403) (Request-ID: req-b61ab676-a9c4-4530-916b-73f5f33211b2)\n\nMy full policy.json:\n\n{\n\u00a0\u00a0\u00a0\u00a0\"admin_or_owner\":  [[\"role:admin\"], [\"project_id:%(project_id)s\"]],\n\u00a0\u00a0\u00a0\u00a0\"default\": [[\"rule:admin_or_owner\"]],\n\n\u00a0\u00a0\u00a0\u00a0\"compute:create\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute:create:attach_network\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute:create:attach_volume\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute:get_all\": [],\n\n\u00a0\u00a0\u00a0\u00a0\"admin_api\": [[\"role:admin\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:accounts\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:pause\": [[\"rule:admin_or_owner\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:unpause\": [[\"rule:admin_or_owner\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:suspend\": [[\"rule:admin_or_owner\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:resume\": [[\"rule:admin_or_owner\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:lock\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:unlock\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:resetNetwork\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:injectNetworkInfo\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:createBackup\": [[\"rule:admin_or_owner\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:migrateLive\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:admin_actions:migrate\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:aggregates\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:certificates\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:cloudpipe\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:console_output\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:consoles\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:createserverext\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:deferred_delete\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:disk_config\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:extended_server_attributes\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:extended_status\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:flavorextradata\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:flavorextraspecs\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:flavormanage\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:floating_ip_dns\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:floating_ip_pools\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:floating_ips\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:hosts\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:keypairs\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:multinic\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:networks\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:quotas\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:rescue\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:security_groups\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:server_action_list\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:server_diagnostics\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:simple_tenant_usage:show\": [[\"rule:admin_or_owner\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:simple_tenant_usage:list\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:users\": [[\"rule:admin_api\"]],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:virtual_interfaces\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:virtual_storage_arrays\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:volumes\": [],\n\u00a0\u00a0\u00a0\u00a0\"compute_extension:volumetypes\": [],\n\n\u00a0\u00a0\u00a0\u00a0\"volume:create\": [],\n\u00a0\u00a0\u00a0\u00a0\"volume:get_all\": [],\n\u00a0\u00a0\u00a0\u00a0\"volume:get_volume_metadata\": [],\n\u00a0\u00a0\u00a0\u00a0\"volume:get_snapshot\": [],\n\u00a0\u00a0\u00a0\u00a0\"volume:get_all_snapshots\": [],\n\n\u00a0\u00a0\u00a0\u00a0\"network:get_all_networks\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_network\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:delete_network\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:disassociate_network\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_vifs_by_instance\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:allocate_for_instance\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:deallocate_for_instance\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:validate_networks\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_instance_uuids_by_ip_filter\": [],\n\n\u00a0\u00a0\u00a0\u00a0\"network:get_floating_ip\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_floating_ip_pools\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_floating_ip_by_address\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_floating_ips_by_project\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_floating_ips_by_fixed_address\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:allocate_floating_ip\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:deallocate_floating_ip\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:associate_floating_ip\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:disassociate_floating_ip\": [],\n\n\u00a0\u00a0\u00a0\u00a0\"network:get_fixed_ip\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:add_fixed_ip_to_instance\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:remove_fixed_ip_from_instance\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:add_network_to_project\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_instance_nw_info\": [],\n\n\u00a0\u00a0\u00a0\u00a0\"network:get_dns_domains\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:add_dns_entry\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:modify_dns_entry\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:delete_dns_entry\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_dns_entries_by_address\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:get_dns_entries_by_name\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:create_private_dns_domain\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:create_public_dns_domain\": [],\n\u00a0\u00a0\u00a0\u00a0\"network:delete_dns_domain\": []\n}", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1117433", 
    "owner": "None", 
    "id": 1117433, 
    "index": 4651, 
    "openned": "2013-02-06 15:41:28.977057+00:00", 
    "created": "2013-02-06 15:41:28.977057+00:00", 
    "title": "non-admin users raise KeyError u'project_id'", 
    "comments": [
        {
            "content": "steps:\n\n1) obtain an auth-token\n\ncurl -H 'Content-Type: application/json' -d '{ \"auth\": {\"tenantName\": \"Development\", \"passwordCredentials\": {\"username\": \"jenkins\", \"password\": \"*****\"} } }' http://10.0.80.15:5000/v2.0/tokens\n\"access\": {\"token\": {\"expires\": \"2013-02-07T15:23:49Z\", \"id\": \"e3d266a113a64558801537830b01001d\", \"tenant\": {\"enabled\": true, \"description\": \"The developer group\", \"name\": \"Development\", \"id\": \"62b31fa8598a443487d99a79b6ba5547\"}}, \"serviceCatalog\": [{\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:8774/v2/62b31fa8598a443487d99a79b6ba5547\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:8774/v2/62b31fa8598a443487d99a79b6ba5547\", \"id\": \"bb7fa36c03bf48589b87109509bfacb0\", \"publicURL\": \"http://10.0.80.15:8774/v2/62b31fa8598a443487d99a79b6ba5547\"}], \"endpoints_links\": [], \"type\": \"compute\", \"name\": \"nova\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:9292/v1\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:9292/v1\", \"id\": \"a1560797b76d45209af5820c72edf0c3\", \"publicURL\": \"http://10.0.80.15:9292/v1\"}], \"endpoints_links\": [], \"type\": \"image\", \"name\": \"glance\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:8776/v1/62b31fa8598a443487d99a79b6ba5547\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:8776/v1/62b31fa8598a443487d99a79b6ba5547\", \"id\": \"214577425ac8411ea114f5d0285d2814\", \"publicURL\": \"http://10.0.80.15:8776/v1/62b31fa8598a443487d99a79b6ba5547\"}], \"endpoints_links\": [], \"type\": \"volume\", \"name\": \"volume\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:8773/services/Admin\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:8773/services/Cloud\", \"id\": \"8d0f2bbbd729465eaf92964c728a60db\", \"publicURL\": \"http://10.0.80.15:8773/services/Cloud\"}], \"endpoints_links\": [], \"type\": \"ec2\", \"name\": \"ec2\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:8080/\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:8080/v1/AUTH_62b31fa8598a443487d99a79b6ba5547\", \"id\": \"8ab8b4cddd224f8facba3bcaf909b323\", \"publicURL\": \"http://10.0.80.15:8080/v1/AUTH_62b31fa8598a443487d99a79b6ba5547\"}], \"endpoints_links\": [], \"type\": \"object-store\", \"name\": \"swift\"}, {\"endpoints\": [{\"adminURL\": \"http://10.0.80.15:35357/v2.0\", \"region\": \"nyc02\", \"internalURL\": \"http://10.0.80.15:5000/v2.0\", \"id\": \"1e030df055e54aa2bde029f30a50c79d\", \"publicURL\": \"http://10.0.80.15:5000/v2.0\"}], \"endpoints_links\": [], \"type\": \"identity\", \"name\": \"keystone\"}], \"user\": {\"username\": \"jenkins\", \"roles_links\": [], \"id\": \"f80bbe2743b74f92a85ba61e8f93e62c\", \"roles\": [], \"name\": \"jenkins\"}}}\n\n2) attempt to list servers for a tenant\n\ncurl -v -H 'X-Auth-Token: e3d266a113a64558801537830b01001d' \n\nExpected:\n\nA list of servers for the Development tenant.\n\nActual:\n\nReply from server:\nhttp://10.0.80.15:8774/v2/2201915216d143038d65f61e323caf15/servers\n* About to connect() to 10.0.80.15 port 8774 (#0)\n*   Trying 10.0.80.15...\n* connected\n* Connected to 10.0.80.15 (10.0.80.15) port 8774 (#0)\n> GET /v2/2201915216d143038d65f61e323caf15/servers HTTP/1.1\n> User-Agent: curl/7.24.0 (x86_64-apple-darwin12.0) libcurl/7.24.0 OpenSSL/0.9.8r zlib/1.2.5\n> Host: 10.0.80.15:8774\n> Accept: */*\n> X-Auth-Token: e3d266a113a64558801537830b01001d\n> \n< HTTP/1.1 500 Internal Server Error\n< Content-Length: 128\n< Content-Type: application/json; charset=UTF-8\n< Date: Wed, 06 Feb 2013 15:24:38 GMT\n< \n* Connection #0 to host 10.0.80.15 left intact\n{\"computeFault\": {\"message\": \"The server has either erred or is incapable of performing the requested operation.\", \"code\": 500}}* Closing connection #0\n\nStack trace:\n\n2013-02-05 16:01:31 6291 ERROR nova.api.openstack [-] Caught error: u'project_id'\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack Traceback (most recent call last):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/__init__.py\", line 78, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/request.py\", line 1053, in get_response\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/request.py\", line 1022, in call_application\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 159, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/keystone/middleware/auth_token.py\", line 278, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 147, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 208, in call_func\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/api/auth.py\", line 117, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     service_catalog=service_catalog)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/context.py\", line 70, in __init__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     self.is_admin = policy.check_is_admin(self.roles)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/policy.py\", line 115, in check_is_admin\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     exception.PolicyNotAuthorized, action=action)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 125, in enforce\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     if not _BRAIN.check(match_list, target_dict, credentials_dict):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n                                                                                                                                                      1,1           Top\n2013-02-05 16:01:31 6291 ERROR nova.api.openstack [-] Caught error: u'project_id'\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack Traceback (most recent call last):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/__init__.py\", line 78, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/request.py\", line 1053, in get_response\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/request.py\", line 1022, in call_application\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 159, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/keystone/middleware/auth_token.py\", line 278, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 147, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/WebOb-1.0.8-py2.6.egg/webob/dec.py\", line 208, in call_func\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/api/auth.py\", line 117, in __call__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     service_catalog=service_catalog)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/context.py\", line 70, in __init__\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     self.is_admin = policy.check_is_admin(self.roles)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/policy.py\", line 115, in check_is_admin\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     exception.PolicyNotAuthorized, action=action)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 125, in enforce\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     if not _BRAIN.check(match_list, target_dict, credentials_dict):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 260, in _check_rule\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return brain.check(new_match_list, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 204, in check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     for item in and_list]):\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 184, in _check\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     return func(self, match_kind, match_value, target_dict, cred_dict)\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/policy.py\", line 300, in _check_generic\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack     match = match % target_dict\n2013-02-05 16:01:31 6291 TRACE nova.api.openstack KeyError: u'project_id'\n\nThis may be a config problem on my end, but regardless this error is pretty obfuscated. I've tracked it down to an empty target_dict being passed in to _check_generic via the policy.is_admin check. It does directly seem to be related to my policy.json for the nova service, which has the following default_rule:\n\n    \"admin_or_owner\":  [[\"role:admin\"], [\"project_id:%(project_id)s\"]],\n    \"default\": [[\"rule:admin_or_owner\"]],\n\nChanging project_id:%(project_id)s to any other key causes that to be raised as the KeyError. Removing the secondary part of admin_or_owner causes:\n\nERROR: Policy doesn't allow compute:get_instance_faults to be performed. (HTTP 403) (Request-ID: req-b61ab676-a9c4-4530-916b-73f5f33211b2)\n\nMy full policy.json:\n\n{\n    \"admin_or_owner\":  [[\"role:admin\"], [\"project_id:%(project_id)s\"]],\n    \"default\": [[\"rule:admin_or_owner\"]],\n\n\n    \"compute:create\": [],\n    \"compute:create:attach_network\": [],\n    \"compute:create:attach_volume\": [],\n    \"compute:get_all\": [],\n\n\n    \"admin_api\": [[\"role:admin\"]],\n    \"compute_extension:accounts\": [[\"rule:admin_api\"]],\n    \"compute_extension:admin_actions\": [[\"rule:admin_api\"]],\n    \"compute_extension:admin_actions:pause\": [[\"rule:admin_or_owner\"]],\n    \"compute_extension:admin_actions:unpause\": [[\"rule:admin_or_owner\"]],\n    \"compute_extension:admin_actions:suspend\": [[\"rule:admin_or_owner\"]],\n    \"compute_extension:admin_actions:resume\": [[\"rule:admin_or_owner\"]],\n    \"compute_extension:admin_actions:lock\": [[\"rule:admin_api\"]],\n    \"compute_extension:admin_actions:unlock\": [[\"rule:admin_api\"]],\n    \"compute_extension:admin_actions:resetNetwork\": [[\"rule:admin_api\"]],\n    \"compute_extension:admin_actions:injectNetworkInfo\": [[\"rule:admin_api\"]],\n    \"compute_extension:admin_actions:createBackup\": [[\"rule:admin_or_owner\"]],\n    \"compute_extension:admin_actions:migrateLive\": [[\"rule:admin_api\"]],\n    \"compute_extension:admin_actions:migrate\": [[\"rule:admin_api\"]],\n    \"compute_extension:aggregates\": [[\"rule:admin_api\"]],\n    \"compute_extension:certificates\": [],\n    \"compute_extension:cloudpipe\": [[\"rule:admin_api\"]],\n    \"compute_extension:console_output\": [],\n    \"compute_extension:consoles\": [],\n    \"compute_extension:createserverext\": [],\n    \"compute_extension:deferred_delete\": [],\n    \"compute_extension:disk_config\": [],\n    \"compute_extension:extended_server_attributes\": [[\"rule:admin_api\"]],\n    \"compute_extension:extended_status\": [],\n    \"compute_extension:flavorextradata\": [],\n    \"compute_extension:flavorextraspecs\": [],\n    \"compute_extension:flavormanage\": [[\"rule:admin_api\"]],\n    \"compute_extension:floating_ip_dns\": [],\n    \"compute_extension:floating_ip_pools\": [],\n    \"compute_extension:floating_ips\": [],\n    \"compute_extension:hosts\": [[\"rule:admin_api\"]],\n    \"compute_extension:keypairs\": [],\n    \"compute_extension:multinic\": [],\n    \"compute_extension:networks\": [[\"rule:admin_api\"]],\n    \"compute_extension:quotas\": [],\n    \"compute_extension:rescue\": [],\n    \"compute_extension:security_groups\": [],\n    \"compute_extension:server_action_list\": [[\"rule:admin_api\"]],\n    \"compute_extension:server_diagnostics\": [[\"rule:admin_api\"]],\n    \"compute_extension:simple_tenant_usage:show\": [[\"rule:admin_or_owner\"]],\n    \"compute_extension:simple_tenant_usage:list\": [[\"rule:admin_api\"]],\n    \"compute_extension:users\": [[\"rule:admin_api\"]],\n    \"compute_extension:virtual_interfaces\": [],\n    \"compute_extension:virtual_storage_arrays\": [],\n    \"compute_extension:volumes\": [],\n    \"compute_extension:volumetypes\": [],\n\n\n    \"volume:create\": [],\n    \"volume:get_all\": [],\n    \"volume:get_volume_metadata\": [],\n    \"volume:get_snapshot\": [],\n    \"volume:get_all_snapshots\": [],\n\n\n    \"network:get_all_networks\": [],\n    \"network:get_network\": [],\n    \"network:delete_network\": [],\n    \"network:disassociate_network\": [],\n    \"network:get_vifs_by_instance\": [],\n    \"network:allocate_for_instance\": [],\n    \"network:deallocate_for_instance\": [],\n    \"network:validate_networks\": [],\n    \"network:get_instance_uuids_by_ip_filter\": [],\n\n    \"network:get_floating_ip\": [],\n    \"network:get_floating_ip_pools\": [],\n    \"network:get_floating_ip_by_address\": [],\n    \"network:get_floating_ips_by_project\": [],\n    \"network:get_floating_ips_by_fixed_address\": [],\n    \"network:allocate_floating_ip\": [],\n    \"network:deallocate_floating_ip\": [],\n    \"network:associate_floating_ip\": [],\n    \"network:disassociate_floating_ip\": [],\n\n    \"network:get_fixed_ip\": [],\n    \"network:add_fixed_ip_to_instance\": [],\n    \"network:remove_fixed_ip_from_instance\": [],\n    \"network:add_network_to_project\": [],\n    \"network:get_instance_nw_info\": [],\n\n    \"network:get_dns_domains\": [],\n    \"network:add_dns_entry\": [],\n    \"network:modify_dns_entry\": [],\n    \"network:delete_dns_entry\": [],\n    \"network:get_dns_entries_by_address\": [],\n    \"network:get_dns_entries_by_name\": [],\n    \"network:create_private_dns_domain\": [],\n    \"network:create_public_dns_domain\": [],\n    \"network:delete_dns_domain\": []\n}", 
            "date_created": "2013-02-06 15:41:28.977057+00:00", 
            "author": "https://api.launchpad.net/1.0/~crayz"
        }, 
        {
            "content": "I doubt this is a correct workaround, but a simple try/catch for the KeyError in _check_generic resolved this issue for me.", 
            "date_created": "2013-02-06 17:10:19.479198+00:00", 
            "author": "https://api.launchpad.net/1.0/~crayz"
        }, 
        {
            "content": "it looks like you need context_is_admin your policy.json file:\n\nI think you should replace your admin_or_owner lines with the lines from the default file in folsom:\n\n  \"context_is_admin\":  [[\"role:admin\"]],\n  \"admin_or_owner\":  [[\"is_admin:True\"], [\"project_id:%(project_id)s\"]],\n", 
            "date_created": "2013-02-27 00:20:07.497269+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ], 
    "closed": "2013-02-27 00:20:17.535721+00:00"
}