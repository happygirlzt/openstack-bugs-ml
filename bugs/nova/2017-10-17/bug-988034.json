{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:19:07.609288+00:00", 
    "description": "2012-04-24 20:09:19 ERROR nova.rpc.amqp [req-0c7d42c0-ce49-44c6-98fb-cad674b902c2 04458e4341404f609270b48ad40c1087 49e8978cba5b4e00917fd134eccd6e21] Exception during message handling\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line 556, in deallocate_for_instance\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     vif, project_id)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line 628, in update_dhcp\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     self.driver.kill_dhcp(dev)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 655, in kill_dhcp\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     _execute('kill', '-9', pid, run_as_root=True)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 812, in _execute\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     return utils.execute(*cmd, **kwargs)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n2012-04-24 20:09:19 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Command: sudo nova-rootwrap kill -9 26037\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Exit code: 99\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Stdout: 'Unauthorized command: kill -9 26037\\n'\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Stderr: ''", 
    "tags": [
        "in-stable-essex"
    ], 
    "importance": "High", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/988034", 
    "owner": "https://api.launchpad.net/1.0/~somikbehera", 
    "id": 988034, 
    "index": 666, 
    "openned": "2012-04-24 21:13:22.184621+00:00", 
    "created": "2012-04-24 21:13:22.184621+00:00", 
    "title": "Quantum Network Manager - not clearing ips", 
    "comments": [
        {
            "content": "2012-04-24 20:09:19 ERROR nova.rpc.amqp [req-0c7d42c0-ce49-44c6-98fb-cad674b902c2 04458e4341404f609270b48ad40c1087 49e8978cba5b4e00917fd134eccd6e21] Exception during message handling\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line 556, in deallocate_for_instance\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     vif, project_id)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line 628, in update_dhcp\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     self.driver.kill_dhcp(dev)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 655, in kill_dhcp\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     _execute('kill', '-9', pid, run_as_root=True)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 812, in _execute\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     return utils.execute(*cmd, **kwargs)\n2012-04-24 20:09:19 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n2012-04-24 20:09:19 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n2012-04-24 20:09:19 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Command: sudo nova-rootwrap kill -9 26037\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Exit code: 99\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Stdout: 'Unauthorized command: kill -9 26037\\n'\n2012-04-24 20:09:19 TRACE nova.rpc.amqp Stderr: ''", 
            "date_created": "2012-04-24 21:13:22.184621+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Am I missing something, or is this a nova bug?  If so, you'll want to file it against nova rather than quantum.", 
            "date_created": "2012-04-24 21:23:05.169438+00:00", 
            "author": "https://api.launchpad.net/1.0/~maru"
        }, 
        {
            "content": "There also doesn't seem to be much in the way of information to aid in reproducing the problem.  The sequence of events that led up to the bug would be helpful for whoever ends up fixing it.", 
            "date_created": "2012-04-24 21:24:12.164223+00:00", 
            "author": "https://api.launchpad.net/1.0/~maru"
        }, 
        {
            "content": "I'm not sure how the traceback is related, but this may be similar to the\nissue I ran into while giving the demo at the openstack conference :)\n\nBrad, I think you were look at this, right?\n\nDan\n\nOn Tue, Apr 24, 2012 at 2:24 PM, Maru Newby <email address hidden> wrote:\n\n> There also doesn't seem to be much in the way of information to aid in\n> reproducing the problem.  The sequence of events that led up to the bug\n> would be helpful for whoever ends up fixing it.\n>\n> --\n> You received this bug notification because you are a member of Netstack\n> Core Developers, which is subscribed to quantum.\n> https://bugs.launchpad.net/bugs/988034\n>\n> Title:\n>  Quantum Network Manager - not clearing ips\n>\n> Status in OpenStack Quantum (virtual network service):\n>  New\n>\n> Bug description:\n>  2012-04-24 20:09:19 ERROR nova.rpc.amqp\n> [req-0c7d42c0-ce49-44c6-98fb-cad674b902c2 04458e4341404f609270b48ad40c1087\n> 49e8978cba5b4e00917fd134eccd6e21] Exception during message handling\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Traceback (most recent call last):\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in\n> _process_data\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     rval =\n> node_func(context=ctxt, **node_args)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line\n> 556, in deallocate_for_instance\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     vif, project_id)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line\n> 628, in update_dhcp\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     self.driver.kill_dhcp(dev)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 655, in\n> kill_dhcp\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     _execute('kill', '-9', pid,\n> run_as_root=True)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 812, in\n> _execute\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     return utils.execute(*cmd,\n> **kwargs)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected\n> error while running command.\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Command: sudo nova-rootwrap kill\n> -9 26037\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Exit code: 99\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Stdout: 'Unauthorized command:\n> kill -9 26037\\n'\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Stderr: ''\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/quantum/+bug/988034/+subscriptions\n>\n\n\n\n-- \n~~~~~~~~~~~~~~~~~~~~~~~~~~~\nDan Wendlandt\nNicira, Inc: www.nicira.com\ntwitter: danwendlandt\n~~~~~~~~~~~~~~~~~~~~~~~~~~~\n", 
            "date_created": "2012-04-24 21:33:22+00:00", 
            "author": "https://api.launchpad.net/1.0/~danwent"
        }, 
        {
            "content": "Review coming shortly..", 
            "date_created": "2012-04-24 21:42:49.255686+00:00", 
            "author": "https://api.launchpad.net/1.0/~bgh"
        }, 
        {
            "content": "It's taken from nova.network.  It's a thing that occurs when using OVS.", 
            "date_created": "2012-04-24 21:52:14.652656+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Any news on this? It renders quantum kinda useless.", 
            "date_created": "2012-04-30 20:21:21.055085+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Hi Endre, can you try out this patch and confirm it solves your issue: https://review.openstack.org/#/c/6949/1 ? ", 
            "date_created": "2012-05-01 01:41:08.907181+00:00", 
            "author": "https://api.launchpad.net/1.0/~danwent"
        }, 
        {
            "content": "Doesn't seem to free up still when I destroy the instances.\nSo I go in and try to manually cleanup fixed ip's for the 2 networks: \n\n+---------------------+---------------------+------------+---------+------+--------------+------------+-------------+-----------+--------+----------+----------------------+------+\n| created_at          | updated_at          | deleted_at | deleted | id   | address      | network_id | instance_id | allocated | leased | reserved | virtual_interface_id | host |\n+---------------------+---------------------+------------+---------+------+--------------+------------+-------------+-----------+--------+----------+----------------------+------+\n| 2012-04-30 12:40:50 | 2012-05-02 11:39:12 | NULL       |       0 | 1297 | 172.16.65.16 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:39:12 | NULL       |       0 | 1298 | 172.16.65.17 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:39:12 | NULL       |       0 | 1299 | 172.16.65.18 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:08:38 | NULL       |       0 | 1300 | 172.16.65.19 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:07:56 | NULL       |       0 | 1301 | 172.16.65.20 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:11:05 | NULL       |       0 | 1302 | 172.16.65.21 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:11:05 | NULL       |       0 | 1303 | 172.16.65.22 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:49 | NULL       |       0 | 1304 | 172.16.65.23 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:49 | NULL       |       0 | 1305 | 172.16.65.24 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:48 | NULL       |       0 | 1306 | 172.16.65.25 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:49 | NULL       |       0 | 1307 | 172.16.65.26 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:49 | NULL       |       0 | 1308 | 172.16.65.27 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:32:45 | NULL       |       0 | 1309 | 172.16.65.28 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:32:44 | NULL       |       0 | 1310 | 172.16.65.29 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:32:44 | NULL       |       0 | 1311 | 172.16.65.30 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:32:44 | NULL       |       0 | 1312 | 172.16.65.31 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:37:21 | NULL       |       0 | 1313 | 172.16.65.16 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:37:21 | NULL       |       0 | 1314 | 172.16.65.17 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:37:48 | NULL       |       0 | 1315 | 172.16.65.18 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:07:50 | NULL       |       0 | 1316 | 172.16.65.19 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:07:50 | NULL       |       0 | 1317 | 172.16.65.20 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:10:46 | NULL       |       0 | 1318 | 172.16.65.21 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:10:47 | NULL       |       0 | 1319 | 172.16.65.22 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:23:49 | NULL       |       0 | 1320 | 172.16.65.23 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:24:21 | NULL       |       0 | 1321 | 172.16.65.24 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:24:22 | NULL       |       0 | 1322 | 172.16.65.25 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:24:22 | NULL       |       0 | 1323 | 172.16.65.26 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:24:22 | NULL       |       0 | 1324 | 172.16.65.27 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:25:22 | NULL       |       0 | 1325 | 172.16.65.28 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:25:22 | NULL       |       0 | 1326 | 172.16.65.29 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:25:22 | NULL       |       0 | 1327 | 172.16.65.30 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:25:22 | NULL       |       0 | 1328 | 172.16.65.31 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n+---------------------+---------------------+------------+---------+------+--------------+------------+-------------+-----------+--------+----------+----------------------+------+\n\n\nAll looks ok right?\n\nThen I start 2-4 instances in the given network (8) and terminate them:\n\nmysql> select * from fixed_ips where network_id = '7' or network_id = 8;\n+---------------------+---------------------+------------+---------+------+--------------+------------+-------------+-----------+--------+----------+----------------------+------+\n| created_at          | updated_at          | deleted_at | deleted | id   | address      | network_id | instance_id | allocated | leased | reserved | virtual_interface_id | host |\n+---------------------+---------------------+------------+---------+------+--------------+------------+-------------+-----------+--------+----------+----------------------+------+\n| 2012-04-30 12:40:50 | 2012-05-02 11:43:29 | NULL       |       0 | 1297 | 172.16.65.16 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:43:28 | NULL       |       0 | 1298 | 172.16.65.17 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:43:28 | NULL       |       0 | 1299 | 172.16.65.18 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:43:53 | NULL       |       0 | 1300 | 172.16.65.19 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:07:56 | NULL       |       0 | 1301 | 172.16.65.20 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:11:05 | NULL       |       0 | 1302 | 172.16.65.21 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:11:05 | NULL       |       0 | 1303 | 172.16.65.22 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:49 | NULL       |       0 | 1304 | 172.16.65.23 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:49 | NULL       |       0 | 1305 | 172.16.65.24 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:48 | NULL       |       0 | 1306 | 172.16.65.25 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:49 | NULL       |       0 | 1307 | 172.16.65.26 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:24:49 | NULL       |       0 | 1308 | 172.16.65.27 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:32:45 | NULL       |       0 | 1309 | 172.16.65.28 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:32:44 | NULL       |       0 | 1310 | 172.16.65.29 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:32:44 | NULL       |       0 | 1311 | 172.16.65.30 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 12:40:50 | 2012-05-02 11:32:44 | NULL       |       0 | 1312 | 172.16.65.31 |          7 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:42:50 | NULL       |       0 | 1313 | 172.16.65.16 |          8 |         111 |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:42:50 | NULL       |       0 | 1314 | 172.16.65.17 |          8 |         113 |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:42:50 | NULL       |       0 | 1315 | 172.16.65.18 |          8 |         110 |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:42:50 | NULL       |       0 | 1316 | 172.16.65.19 |          8 |         112 |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:07:50 | NULL       |       0 | 1317 | 172.16.65.20 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:10:46 | NULL       |       0 | 1318 | 172.16.65.21 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:10:47 | NULL       |       0 | 1319 | 172.16.65.22 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:23:49 | NULL       |       0 | 1320 | 172.16.65.23 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:24:21 | NULL       |       0 | 1321 | 172.16.65.24 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:24:22 | NULL       |       0 | 1322 | 172.16.65.25 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:24:22 | NULL       |       0 | 1323 | 172.16.65.26 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:24:22 | NULL       |       0 | 1324 | 172.16.65.27 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:25:22 | NULL       |       0 | 1325 | 172.16.65.28 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:25:22 | NULL       |       0 | 1326 | 172.16.65.29 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:25:22 | NULL       |       0 | 1327 | 172.16.65.30 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n| 2012-04-30 19:57:05 | 2012-05-02 11:25:22 | NULL       |       0 | 1328 | 172.16.65.31 |          8 |        NULL |         0 |      0 |        0 |                 NULL | NULL |\n+---------------------+---------------------+------------+---------+------+--------------+------------+-------------+-----------+--------+----------+----------------------+------+\n\n\n\nmysql> select id, deleted from instances where id >= 110 and id <= 113;\n+-----+---------+\n| id  | deleted |\n+-----+---------+\n| 110 |       1 |\n| 111 |       1 |\n| 112 |       1 |\n| 113 |       1 |\n+-----+---------+\n\n\n\n\nSo something is still messing up and this is making quantum quite useless since it doesn't free ips.\n", 
            "date_created": "2012-05-02 11:47:46.384389+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Can you try this patch - https://review.openstack.org/#/c/6949/\n\nand let us know if that resolves your issue? Also, in the above example, did you try the patch above and it still doesn't release your ips?", 
            "date_created": "2012-05-03 21:09:14.898987+00:00", 
            "author": "https://api.launchpad.net/1.0/~somikbehera"
        }, 
        {
            "content": "I tried the first patch yes, no positive feedback there.\n\n2012/5/3 Somik Behera <email address hidden>\n\n> Can you try this patch - https://review.openstack.org/#/c/6949/\n>\n> and let us know if that resolves your issue? Also, in the above example,\n> did you try the patch above and it still doesn't release your ips?\n>\n> --\n> You received this bug notification because you are subscribed to the bug\n> report.\n> https://bugs.launchpad.net/bugs/988034\n>\n> Title:\n>  Quantum Network Manager - not clearing ips\n>\n> Status in OpenStack Quantum (virtual network service):\n>   In Progress\n>\n> Bug description:\n>  2012-04-24 20:09:19 ERROR nova.rpc.amqp\n> [req-0c7d42c0-ce49-44c6-98fb-cad674b902c2 04458e4341404f609270b48ad40c1087\n> 49e8978cba5b4e00917fd134eccd6e21] Exception during message handling\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Traceback (most recent call last):\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in\n> _process_data\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     rval =\n> node_func(context=ctxt, **node_args)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line\n> 556, in deallocate_for_instance\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     vif, project_id)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line\n> 628, in update_dhcp\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     self.driver.kill_dhcp(dev)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 655, in\n> kill_dhcp\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     _execute('kill', '-9', pid,\n> run_as_root=True)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 812, in\n> _execute\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     return utils.execute(*cmd,\n> **kwargs)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected\n> error while running command.\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Command: sudo nova-rootwrap kill\n> -9 26037\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Exit code: 99\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Stdout: 'Unauthorized command:\n> kill -9 26037\\n'\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Stderr: ''\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/quantum/+bug/988034/+subscriptions\n>\n", 
            "date_created": "2012-05-03 21:16:42+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Isn't that the same as before?\nDen 1. mai 2012 03:50 skrev \"dan wendlandt\" <email address hidden>\nf\u00f8lgende:\n\n> Hi Endre, can you try out this patch and confirm it solves your issue:\n> https://review.openstack.org/#/c/6949/1 ?\n>\n> --\n> You received this bug notification because you are subscribed to the bug\n> report.\n> https://bugs.launchpad.net/bugs/988034\n>\n> Title:\n>  Quantum Network Manager - not clearing ips\n>\n> Status in OpenStack Quantum (virtual network service):\n>  In Progress\n>\n> Bug description:\n>  2012-04-24 20:09:19 ERROR nova.rpc.amqp\n> [req-0c7d42c0-ce49-44c6-98fb-cad674b902c2 04458e4341404f609270b48ad40c1087\n> 49e8978cba5b4e00917fd134eccd6e21] Exception during message handling\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Traceback (most recent call last):\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in\n> _process_data\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     rval =\n> node_func(context=ctxt, **node_args)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line\n> 556, in deallocate_for_instance\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     vif, project_id)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line\n> 628, in update_dhcp\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     self.driver.kill_dhcp(dev)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 655, in\n> kill_dhcp\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     _execute('kill', '-9', pid,\n> run_as_root=True)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 812, in\n> _execute\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     return utils.execute(*cmd,\n> **kwargs)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected\n> error while running command.\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Command: sudo nova-rootwrap kill\n> -9 26037\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Exit code: 99\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Stdout: 'Unauthorized command:\n> kill -9 26037\\n'\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Stderr: ''\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/quantum/+bug/988034/+subscriptions\n>\n", 
            "date_created": "2012-05-03 22:20:54+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "The new patch has an additional fix to allow the default manager to clean up the ips in the DB as well, so its got an additional fix that was in my environment.", 
            "date_created": "2012-05-03 22:32:55.585525+00:00", 
            "author": "https://api.launchpad.net/1.0/~somikbehera"
        }, 
        {
            "content": "Yeah, after replacing my manager.py file it now seems to be ok.", 
            "date_created": "2012-05-04 08:16:02.325317+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Great! Glad to hear that. Did you just replace the manager.py from the patch link above or did you pull a certain version from the Quantum trunk?", 
            "date_created": "2012-05-04 16:58:31.275218+00:00", 
            "author": "https://api.launchpad.net/1.0/~somikbehera"
        }, 
        {
            "content": "I just replaced it. By the way can you take a look at my other bug reported\nwhere it doesn't setup .conf files for dnsmasq?\n\n2012/5/4 Somik Behera <email address hidden>\n\n> Great! Glad to hear that. Did you just replace the manager.py from the\n> patch link above or did you pull a certain version from the Quantum\n> trunk?\n>\n> --\n> You received this bug notification because you are subscribed to the bug\n> report.\n> https://bugs.launchpad.net/bugs/988034\n>\n> Title:\n>  Quantum Network Manager - not clearing ips\n>\n> Status in OpenStack Quantum (virtual network service):\n>   In Progress\n>\n> Bug description:\n>  2012-04-24 20:09:19 ERROR nova.rpc.amqp\n> [req-0c7d42c0-ce49-44c6-98fb-cad674b902c2 04458e4341404f609270b48ad40c1087\n> 49e8978cba5b4e00917fd134eccd6e21] Exception during message handling\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Traceback (most recent call last):\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in\n> _process_data\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     rval =\n> node_func(context=ctxt, **node_args)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line\n> 556, in deallocate_for_instance\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     vif, project_id)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/quantum/manager.py\", line\n> 628, in update_dhcp\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     self.driver.kill_dhcp(dev)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 655, in\n> kill_dhcp\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     _execute('kill', '-9', pid,\n> run_as_root=True)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/network/linux_net.py\", line 812, in\n> _execute\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     return utils.execute(*cmd,\n> **kwargs)\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp   File\n> \"/usr/lib/python2.6/site-packages/nova/utils.py\", line 243, in execute\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp     cmd=' '.join(cmd))\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp ProcessExecutionError: Unexpected\n> error while running command.\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Command: sudo nova-rootwrap kill\n> -9 26037\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Exit code: 99\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Stdout: 'Unauthorized command:\n> kill -9 26037\\n'\n>  2012-04-24 20:09:19 TRACE nova.rpc.amqp Stderr: ''\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/quantum/+bug/988034/+subscriptions\n>\n", 
            "date_created": "2012-05-04 17:06:48+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Is there any news on this? Quantum is rendered useless at the moment.", 
            "date_created": "2012-05-13 16:42:33.637576+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Fix has been committed to Nova trunk - https://review.openstack.org/#/c/6949/", 
            "date_created": "2012-05-17 05:19:58.427401+00:00", 
            "author": "https://api.launchpad.net/1.0/~somikbehera"
        }, 
        {
            "content": "I replaced my nova.network.quantum > manager and nova_ipam_lib files with the ones from upstream - restarted components and it works gloriously!", 
            "date_created": "2012-05-21 08:32:00.511584+00:00", 
            "author": "https://api.launchpad.net/1.0/~endre-karlson"
        }, 
        {
            "content": "Fix proposed to branch: stable/essex\nReview: https://review.openstack.org/7970", 
            "date_created": "2012-05-31 10:49:27.386614+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/7970\nCommitted: http://github.com/openstack/nova/commit/3426030d3524e4e38c5843be0b9515805b67b04f\nSubmitter: Jenkins\nBranch:    stable/essex\n\ncommit 3426030d3524e4e38c5843be0b9515805b67b04f\nAuthor: Somik Behera <email address hidden>\nDate:   Mon Apr 30 17:43:14 2012 -0700\n\n    Fix bug 988034 - Quantum Network Manager - not clearing ips\n    \n    Added a line in nova_ipam_lib.QuantumNovaIPAMLib init\n    method to ensure we clean up IPs and explanation of whats\n    going on.\n    \n    Also, nuked release_fixed_ip as that is not\n    needed in QuantumManager anymore.\n    \n    Change-Id: I3971b4d4c464ce68ba9370c9f5d8ca7840e0a72a\n", 
            "date_created": "2012-06-13 21:49:19.373671+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-05-23 12:58:21.611869+00:00"
}