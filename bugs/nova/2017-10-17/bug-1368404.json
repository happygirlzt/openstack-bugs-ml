{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:55:51.274714+00:00", 
    "description": "Some uncaught libvirt errors may result in instances being set to ERROR state and is causing sporadic gate failures. This can happen for any of the code paths that use _destroy().  Here is a recent example of a failed resize:\n\n[req-06dd4908-382e-455e-854e-e4d42a4bf62b TestServerAdvancedOps-724416891 TestServerAdvancedOps-711228572] [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d] Setting instance vm_state to ERROR\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d] Traceback (most recent call last):\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 5902, in _error_out_instance_on_exception\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     yield\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 3658, in resize_instance\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     timeout, retry_interval)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 5468, in migrate_disk_and_power_off\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     self.power_off(instance, timeout, retry_interval)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2400, in power_off\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     self._destroy(instance)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 998, in _destroy\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     timer.start(interval=0.5).wait()\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     return hubs.get_hub().switch()\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 293, in switch\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     return self.greenlet.switch()\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/openstack/common/loopingcall.py\", line 81, in _inner\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     self.f(*self.args, **self.kw)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 971, in _wait_for_destroy\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     dom_info = self.get_info(instance)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 3922, in get_info\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     dom_info = virt_dom.info()\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     rv = execute(f, *args, **kwargs)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     six.reraise(c, e, tb)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     rv = meth(*args, **kwargs)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 1068, in info\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     if ret is None: raise libvirtError ('virDomainGetInfo() failed', dom=self)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d] libvirtError: Domain not found: no domain with matching uuid '525f4f95-f631-4fbb-a884-20c37711fb0d' (instance-00000097)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]", 
    "tags": [
        "libvirt"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1368404", 
    "owner": "https://api.launchpad.net/1.0/~hanlind", 
    "id": 1368404, 
    "index": 1604, 
    "openned": "2014-09-11 20:22:28.023906+00:00", 
    "created": "2014-09-11 20:22:28.023906+00:00", 
    "title": "Uncaught 'libvirtError: Domain not found' errors during destroy", 
    "comments": [
        {
            "content": "Some uncaught libvirt errors may result in instances being set to ERROR state and is causing sporadic gate failures. This can happen for any of the code paths that use _destroy().  Here is a recent example of a failed resize:\n\n[req-06dd4908-382e-455e-854e-e4d42a4bf62b TestServerAdvancedOps-724416891 TestServerAdvancedOps-711228572] [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d] Setting instance vm_state to ERROR\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d] Traceback (most recent call last):\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 5902, in _error_out_instance_on_exception\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     yield\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/compute/manager.py\", line 3658, in resize_instance\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     timeout, retry_interval)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 5468, in migrate_disk_and_power_off\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     self.power_off(instance, timeout, retry_interval)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 2400, in power_off\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     self._destroy(instance)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 998, in _destroy\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     timer.start(interval=0.5).wait()\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     return hubs.get_hub().switch()\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 293, in switch\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     return self.greenlet.switch()\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/openstack/common/loopingcall.py\", line 81, in _inner\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     self.f(*self.args, **self.kw)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 971, in _wait_for_destroy\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     dom_info = self.get_info(instance)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/opt/stack/new/nova/nova/virt/libvirt/driver.py\", line 3922, in get_info\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     dom_info = virt_dom.info()\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     rv = execute(f, *args, **kwargs)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     six.reraise(c, e, tb)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     rv = meth(*args, **kwargs)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 1068, in info\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]     if ret is None: raise libvirtError ('virDomainGetInfo() failed', dom=self)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d] libvirtError: Domain not found: no domain with matching uuid '525f4f95-f631-4fbb-a884-20c37711fb0d' (instance-00000097)\n2014-09-05 01:08:37.123 26984 TRACE nova.compute.manager [instance: 525f4f95-f631-4fbb-a884-20c37711fb0d]", 
            "date_created": "2014-09-11 20:22:28.023906+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanlind"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/120912", 
            "date_created": "2014-09-11 21:12:11.093113+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/120912\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c860280a92c2d0e32897d71aa4c6f083ee13345c\nSubmitter: Jenkins\nBranch:    master\n\ncommit c860280a92c2d0e32897d71aa4c6f083ee13345c\nAuthor: Hans Lindgren <email address hidden>\nDate:   Thu Sep 11 17:32:19 2014 +0200\n\n    Make sure libvirt VIR_ERR_NO_DOMAIN errors are handled correctly\n    \n    Some libvirt VIR_ERR_NO_DOMAIN errors leak outside of the libvirt\n    driver, which may result in instances being set to ERROR state.\n    \n    Make sure such errors are either ignored (during destroy) or\n    otherwise turned into InstanceNotFound errors.\n    \n    Change-Id: I0ac2989062247a05162825760367488f4f90bd04\n    Closes-Bug: #1368404\n", 
            "date_created": "2014-09-16 00:37:51.636867+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-10-01 07:38:33.580735+00:00"
}