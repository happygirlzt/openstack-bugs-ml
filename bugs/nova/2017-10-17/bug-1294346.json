{
    "status": "Fix Released", 
    "last_updated": "2014-09-22 22:23:59.485188+00:00", 
    "description": "With the following set in /etc/nova/nova.conf:\n\nsecurity_group_api=neutron\n\nYou can view security groups and rules that have been created in Neutron with nova secgroup-* commands.\n\nIf you create a Neutron Security Group rule with a different protocol though, nova secgroup-* calls fail with a 500 and a lot of stack trace in /var/log/nova/nova-api-os-compute.log:\n\n<snip>\n014-03-18 20:23:46.599 25278 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/security_groups.py\", line 215, in _format_security_group_rule\n2014-03-18 20:23:46.599 25278 TRACE nova.api.openstack     sg_rule['from_port'] = rule['from_port']\n2014-03-18 20:23:46.599 25278 TRACE nova.api.openstack KeyError: 'from_port'\n2014-03-18 20:23:46.599 25278 TRACE nova.api.openstack\n2014-03-18 20:23:46.600 25278 INFO nova.api.openstack [req-507402d7-788e-413a-a005-b852e1b7efa2 3d0524290859416f886f49a2973ab616 1be2c0f9589d4822856a9ac2e16f0406] http://10.240.0.100:8774/v2/1be2c0f9589d4822856a9ac2e16f0406/os-security-groups returned with HTTP 500\n2014-03-18 20:23:46.601 25278 INFO nova.osapi_compute.wsgi.server [req-507402d7-788e-413a-a005-b852e1b7efa2 3d0524290859416f886f49a2973ab616 1be2c0f9589d4822856a9ac2e16f0406] 10.240.0.100 \"GET /v2/1be2c0f9589d4822856a9ac2e16f0406/os-security-groups HTTP/1.1\" status: 500 len: 335 time: 0.0474379\n\nTo recreate:\n\n# Test nova secgroup-list works\n\nnova secgroup-list\n+--------------------------------------+-------------+-------------+\n| Id                                   | Name        | Description |\n+--------------------------------------+-------------+-------------+\n| ebfd4f04-00f7-459e-8f5b-e6f03aa2fec9 | default     | default     |\n+--------------------------------------+-------------+-------------+\n\n\n# Add rule with a different protocol\n\nneutron security-group-rule-create --direction ingress --protocol 50 --remote-ip-prefix 0.0.0.0/0 ebfd4f04-00f7-459e-8f5b-e6f03aa2fec9\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | d98e83cf-2aab-4eec-89ed-f9aa4d00d57b |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | 50                                   |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | ebfd4f04-00f7-459e-8f5b-e6f03aa2fec9 |\n| tenant_id         | 1be2c0f9589d4822856a9ac2e16f0406     |\n+-------------------+--------------------------------------+\n\n# Test\nneutron security-group-list # works\nnova secgroup-list # now errors\n\n# Delete rule\n\nneutron security-group-rule-delete d98e83cf-2aab-4eec-89ed-f9aa4d00d57b\nDeleted security_group_rule: d98e83cf-2aab-4eec-89ed-f9aa4d00d57b\n\n# Test nova again\n\nnova secgroup-list\n+--------------------------------------+-------------+-------------+\n| Id                                   | Name        | Description |\n+--------------------------------------+-------------+-------------+\n| ebfd4f04-00f7-459e-8f5b-e6f03aa2fec9 | default     | default     |\n+--------------------------------------+-------------+-------------+", 
    "tags": [
        "havana-backport-potential", 
        "in-stable-havana", 
        "network"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1294346", 
    "owner": "https://api.launchpad.net/1.0/~arosen", 
    "id": 1294346, 
    "index": 1440, 
    "openned": "2014-03-18 20:40:56.401346+00:00", 
    "created": "2014-03-18 20:40:56.401346+00:00", 
    "title": "When creating Neutron Security Group Rules with a Protocol other than TCP/UDP/ICMP, breaks nova secgroup-* calls ", 
    "comments": [
        {
            "content": "With the following set in /etc/nova/nova.conf:\n\nsecurity_group_api=neutron\n\nYou can view security groups and rules that have been created in Neutron with nova secgroup-* commands.\n\nIf you create a Neutron Security Group rule with a different protocol though, nova secgroup-* calls fail with a 500 and a lot of stack trace in /var/log/nova/nova-api-os-compute.log:\n\n<snip>\n014-03-18 20:23:46.599 25278 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/compute/contrib/security_groups.py\", line 215, in _format_security_group_rule\n2014-03-18 20:23:46.599 25278 TRACE nova.api.openstack     sg_rule['from_port'] = rule['from_port']\n2014-03-18 20:23:46.599 25278 TRACE nova.api.openstack KeyError: 'from_port'\n2014-03-18 20:23:46.599 25278 TRACE nova.api.openstack\n2014-03-18 20:23:46.600 25278 INFO nova.api.openstack [req-507402d7-788e-413a-a005-b852e1b7efa2 3d0524290859416f886f49a2973ab616 1be2c0f9589d4822856a9ac2e16f0406] http://10.240.0.100:8774/v2/1be2c0f9589d4822856a9ac2e16f0406/os-security-groups returned with HTTP 500\n2014-03-18 20:23:46.601 25278 INFO nova.osapi_compute.wsgi.server [req-507402d7-788e-413a-a005-b852e1b7efa2 3d0524290859416f886f49a2973ab616 1be2c0f9589d4822856a9ac2e16f0406] 10.240.0.100 \"GET /v2/1be2c0f9589d4822856a9ac2e16f0406/os-security-groups HTTP/1.1\" status: 500 len: 335 time: 0.0474379\n\nTo recreate:\n\n# Test nova secgroup-list works\n\nnova secgroup-list\n+--------------------------------------+-------------+-------------+\n| Id                                   | Name        | Description |\n+--------------------------------------+-------------+-------------+\n| ebfd4f04-00f7-459e-8f5b-e6f03aa2fec9 | default     | default     |\n+--------------------------------------+-------------+-------------+\n\n\n# Add rule with a different protocol\n\nneutron security-group-rule-create --direction ingress --protocol 50 --remote-ip-prefix 0.0.0.0/0 ebfd4f04-00f7-459e-8f5b-e6f03aa2fec9\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | d98e83cf-2aab-4eec-89ed-f9aa4d00d57b |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | 50                                   |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | ebfd4f04-00f7-459e-8f5b-e6f03aa2fec9 |\n| tenant_id         | 1be2c0f9589d4822856a9ac2e16f0406     |\n+-------------------+--------------------------------------+\n\n# Test\nneutron security-group-list # works\nnova secgroup-list # now errors\n\n# Delete rule\n\nneutron security-group-rule-delete d98e83cf-2aab-4eec-89ed-f9aa4d00d57b\nDeleted security_group_rule: d98e83cf-2aab-4eec-89ed-f9aa4d00d57b\n\n# Test nova again\n\nnova secgroup-list\n+--------------------------------------+-------------+-------------+\n| Id                                   | Name        | Description |\n+--------------------------------------+-------------+-------------+\n| ebfd4f04-00f7-459e-8f5b-e6f03aa2fec9 | default     | default     |\n+--------------------------------------+-------------+-------------+", 
            "date_created": "2014-03-18 20:40:56.401346+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/81432", 
            "date_created": "2014-03-19 04:21:28.002310+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/81432\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=3ad414597043979b8d73c17c05e666cff33a9b88\nSubmitter: Jenkins\nBranch:    master\n\ncommit 3ad414597043979b8d73c17c05e666cff33a9b88\nAuthor: Aaron Rosen <email address hidden>\nDate:   Tue Mar 18 21:14:35 2014 -0700\n\n    Fix KeyError if neutron security group is not TCP/UDP/ICMP and no ports\n    \n    Previously, if a neutron security group rule was created that was not\n    TCP/UDP/ICMP and did not contain a port_range_min/max retrieving it from\n    nova-api would result in a KeyError in nova-api. This patch resolves\n    this issue.\n    \n    Change-Id: I6284a7a8690aec9509b63f7cbd18812e09ef3fdd\n    Closes-bug: #1294346\n", 
            "date_created": "2014-03-20 15:29:40.094133+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/havana\nReview: https://review.openstack.org/91228", 
            "date_created": "2014-04-30 02:42:08.740909+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/91228\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a3a955507d9d4b3e2688847fe45f88a26be3e8cc\nSubmitter: Jenkins\nBranch:    stable/havana\n\ncommit a3a955507d9d4b3e2688847fe45f88a26be3e8cc\nAuthor: Aaron Rosen <email address hidden>\nDate:   Tue Mar 18 21:14:35 2014 -0700\n\n    Fix KeyError if neutron security group is not TCP/UDP/ICMP and no ports\n    \n    Previously, if a neutron security group rule was created that was not\n    TCP/UDP/ICMP and did not contain a port_range_min/max retrieving it from\n    nova-api would result in a KeyError in nova-api. This patch resolves\n    this issue.\n    \n    Change-Id: I6284a7a8690aec9509b63f7cbd18812e09ef3fdd\n    Closes-bug: #1294346\n    (cherry picked from commit 3ad414597043979b8d73c17c05e666cff33a9b88)\n", 
            "date_created": "2014-05-08 19:21:51.842690+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-31 19:05:53.298190+00:00"
}