{
    "status": "Confirmed", 
    "last_updated": "2017-10-16 12:25:43.623845+00:00", 
    "description": "I have setup a fresh OpenStack HA Pike environment on Ubuntu 16.04.3. Live migration has been enabled and works so far. As storage backend I am using Ceph v12.2.0 (Luminous). When you attach a secondary volume to a vm and try to live migrate the vm to another host, it fails with the following exception:\n\n2017-09-07 08:30:46.621 3246 ERROR nova.virt.libvirt.driver [req-832fc6c9-4d8e-46f8-94be-95cb5c7a4114 dddfba8e02f746799a6408a523e6cd25 ed2d2efd86dd40e7a45491d8502318d3 - default default] [instance: 414e8bc1-0b85-4e7f-8897-74b416b9caf8] Live Migration failure: unsupported configuration: Target device drive address 0:0:0 does not match source 0:0:1: libvirtError: unsupported configuration: Target device drive address 0:0:0 does not match source 0:0:1\n2017-09-07 08:30:47.293 3246 ERROR nova.virt.libvirt.driver [req-832fc6c9-4d8e-46f8-94be-95cb5c7a4114 dddfba8e02f746799a6408a523e6cd25 ed2d2efd86dd40e7a45491d8502318d3 - default default] [instance: 414e8bc1-0b85-4e7f-8897-74b416b9caf8] Migration operation has aborted\n\nWhen you (not live) migrate the corresponding vm with the attached volume, migration succeeds. When you launch the vm from a bootable volume, migration and live migration succeeds in both cases. Only live migration with an additional attached volume fails. Because of Ceph RDB volumes, migration does not require \"Block migration\".\n\nCompute node:\n$ pip list | grep -E 'nova|cinder'\nnova (16.0.0)\npython-cinderclient (3.1.0)\npython-novaclient (9.1.0)\n\nController node:\n$ pip list | grep -E 'nova|cinder'\ncinder (11.0.0)\nnova (16.0.0)\npython-cinderclient (3.1.0)\npython-novaclient (9.1.0)\n\n$ ceph --version\nceph version 12.2.0 (32ce2a3ae5239ee33d6150705cdb24d43bab910c) luminous (rc)\n\nIs this a normal behaviour?", 
    "tags": [
        "ceph", 
        "cinder", 
        "live-migration", 
        "volumes"
    ], 
    "importance": "Low", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1715569", 
    "owner": "https://api.launchpad.net/1.0/~tssurya", 
    "id": 1715569, 
    "index": 2231, 
    "openned": "2017-09-07 07:25:33.265421+00:00", 
    "created": "2017-09-07 07:25:33.265421+00:00", 
    "title": "Live migration fails with an attached non-bootable Cinder volume (Pike)", 
    "comments": [
        {
            "content": "I have setup a fresh OpenStack HA Pike environment on Ubuntu 16.04.3. Live migration has been enabled and works so far. As storage backend I am using Ceph v12.2.0 (Luminous). When you attach a secondary volume to a vm and try to live migrate the vm to another host, it fails with the following exception:\n\n2017-09-07 08:30:46.621 3246 ERROR nova.virt.libvirt.driver [req-832fc6c9-4d8e-46f8-94be-95cb5c7a4114 dddfba8e02f746799a6408a523e6cd25 ed2d2efd86dd40e7a45491d8502318d3 - default default] [instance: 414e8bc1-0b85-4e7f-8897-74b416b9caf8] Live Migration failure: unsupported configuration: Target device drive address 0:0:0 does not match source 0:0:1: libvirtError: unsupported configuration: Target device drive address 0:0:0 does not match source 0:0:1\n2017-09-07 08:30:47.293 3246 ERROR nova.virt.libvirt.driver [req-832fc6c9-4d8e-46f8-94be-95cb5c7a4114 dddfba8e02f746799a6408a523e6cd25 ed2d2efd86dd40e7a45491d8502318d3 - default default] [instance: 414e8bc1-0b85-4e7f-8897-74b416b9caf8] Migration operation has aborted\n\nWhen you (not live) migrate the corresponding vm with the attached volume, migration succeeds. When you launch the vm from a bootable volume, migration and live migration succeeds in both cases. Only live migration with an additional attached volume fails. Because of Ceph RDB volumes, migration does not require \"Block migration\".\n\nCompute node:\n$ pip list | grep -E 'nova|cinder'\nnova (16.0.0)\npython-cinderclient (3.1.0)\npython-novaclient (9.1.0)\n\nController node:\n$ pip list | grep -E 'nova|cinder'\ncinder (11.0.0)\nnova (16.0.0)\npython-cinderclient (3.1.0)\npython-novaclient (9.1.0)\n\n$ ceph --version\nceph version 12.2.0 (32ce2a3ae5239ee33d6150705cdb24d43bab910c) luminous (rc)\n\nIs this a normal behaviour?", 
            "date_created": "2017-09-07 07:25:33.265421+00:00", 
            "author": "https://api.launchpad.net/1.0/~cfiehe"
        }, 
        {
            "content": "This is the corresponding libvirt configuration file of the vm.\n\n#############################\ninstance-00000030.xml\n#############################\n<!--\nWARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE\nOVERWRITTEN AND LOST. Changes to this xml configuration should be made using:\n  virsh edit instance-00000030\nor other application using the libvirt API.\n-->\n\n<domain type='kvm'>\n  <name>instance-00000030</name>\n  <uuid>58538546-09f7-4efb-abe1-4eaf008fe756</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"16.0.0\"/>\n      <nova:name>test-vm02</nova:name>\n      <nova:creationTime>2017-09-07 06:59:17</nova:creationTime>\n      <nova:flavor name=\"m1.small\">\n        <nova:memory>2048</nova:memory>\n        <nova:disk>20</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"dddfba8e02f746799a6408a523e6cd25\">admin</nova:user>\n        <nova:project uuid=\"ed2d2efd86dd40e7a45491d8502318d3\">demo</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"b2b7cfc7-ce74-421d-98a9-79768f36e5e1\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>2097152</memory>\n  <currentMemory unit='KiB'>2097152</currentMemory>\n  <vcpu placement='static'>1</vcpu>\n  <cputune>\n    <shares>1024</shares>\n  </cputune>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>16.0.0</entry>\n      <entry name='serial'>74bf283c-f6a8-c600-0293-894b59a50724</entry>\n      <entry name='uuid'>58538546-09f7-4efb-abe1-4eaf008fe756</entry>\n      <entry name='family'>Virtual Machine</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-xenial'>hvm</type>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu mode='custom' match='exact' check='partial'>\n    <model fallback='allow'>SandyBridge</model>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'>\n    <timer name='pit' tickpolicy='delay'/>\n    <timer name='rtc' tickpolicy='catchup'/>\n    <timer name='hpet' present='no'/>\n  </clock>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/kvm-spice</emulator>\n    <disk type='network' device='disk'>\n      <driver name='qemu' type='raw' cache='none' discard='unmap'/>\n      <auth username='cinder'>\n        <secret type='ceph' uuid='e5479084-e43e-4a1e-959a-b9989f02e632'/>\n      </auth>\n      <source protocol='rbd' name='vms/58538546-09f7-4efb-abe1-4eaf008fe756_disk'>\n        <host name='10.30.200.141' port='6789'/>\n        <host name='10.30.200.142' port='6789'/>\n        <host name='10.30.200.143' port='6789'/>\n      </source>\n      <target dev='sda' bus='scsi'/>\n      <address type='drive' controller='0' bus='0' target='0' unit='0'/>\n    </disk>\n    <disk type='network' device='disk'>\n      <driver name='qemu' type='raw' cache='writeback' discard='unmap'/>\n      <auth username='cinder'>\n        <secret type='ceph' uuid='e5479084-e43e-4a1e-959a-b9989f02e632'/>\n      </auth>\n      <source protocol='rbd' name='volumes/volume-208ea468-b937-42fd-a1f3-167212a84357'>\n        <host name='10.30.200.141' port='6789'/>\n        <host name='10.30.200.142' port='6789'/>\n        <host name='10.30.200.143' port='6789'/>\n      </source>\n      <target dev='sdb' bus='scsi'/>\n      <serial>208ea468-b937-42fd-a1f3-167212a84357</serial>\n      <address type='drive' controller='0' bus='0' target='0' unit='1'/>\n    </disk>\n    <controller type='scsi' index='0' model='virtio-scsi'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </controller>\n    <controller type='usb' index='0' model='piix3-uhci'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <interface type='bridge'>\n      <mac address='02:05:69:7e:5d:2e'/>\n      <source bridge='qbracefe15a-cb'/>\n      <target dev='tapacefe15a-cb'/>\n      <model type='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n    <serial type='pty'>\n      <log file='/var/lib/nova/instances/58538546-09f7-4efb-abe1-4eaf008fe756/console.log' append='off'/>\n      <target port='0'/>\n    </serial>\n    <console type='pty'>\n      <log file='/var/lib/nova/instances/58538546-09f7-4efb-abe1-4eaf008fe756/console.log' append='off'/>\n      <target type='serial' port='0'/>\n    </console>\n    <input type='tablet' bus='usb'>\n      <address type='usb' bus='0' port='1'/>\n    </input>\n    <input type='mouse' bus='ps2'/>\n    <input type='keyboard' bus='ps2'/>\n    <graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0' keymap='en-us'>\n      <listen type='address' address='0.0.0.0'/>\n    </graphics>\n    <video>\n      <model type='cirrus' vram='16384' heads='1' primary='yes'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </video>\n    <memballoon model='virtio'>\n      <stats period='10'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n    </memballoon>\n  </devices>\n</domain>", 
            "date_created": "2017-09-07 07:33:39.041460+00:00", 
            "author": "https://api.launchpad.net/1.0/~cfiehe"
        }, 
        {
            "content": "I am also having this problem with ocata", 
            "date_created": "2017-10-05 23:24:10.602244+00:00", 
            "author": "https://api.launchpad.net/1.0/~jomlowe"
        }
    ]
}