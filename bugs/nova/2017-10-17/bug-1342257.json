{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:48:24.497260+00:00", 
    "description": "We have seen a crash in the cells booting process with the following traceback:\n\n2014-07-15 01:00:07.688 3070 CRITICAL nova [req-badc12a2-4ad9-4209-bcd4-f2429e134820 None] DBError: (1030, 'Got error 28 from storage engine')\n2014-07-15 01:00:07.688 3070 TRACE nova Traceback (most recent call last):\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/current/nova/bin/nova-cells\", line 13, in <module>\n2014-07-15 01:00:07.688 3070 TRACE nova     sys.exit(main())\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/cmd/cells.py\", line 45, in main\n2014-07-15 01:00:07.688 3070 TRACE nova     manager=CONF.cells.manager)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/service.py\", line 275, in create\n2014-07-15 01:00:07.688 3070 TRACE nova     db_allowed=db_allowed)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/service.py\", line 148, in __init__\n2014-07-15 01:00:07.688 3070 TRACE nova     self.manager = manager_class(host=self.host, *args, **kwargs)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/cells/manager.py\", line 90, in __init__\n2014-07-15 01:00:07.688 3070 TRACE nova     self.state_manager = cell_state_manager()\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/cells/state.py\", line 161, in __new__\n2014-07-15 01:00:07.688 3070 TRACE nova     return CellStateManagerDB(cell_state_cls)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/cells/state.py\", line 174, in __init__\n2014-07-15 01:00:07.688 3070 TRACE nova     self._cell_data_sync(force=True)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 325, in inner\n2014-07-15 01:00:07.688 3070 TRACE nova     return f(*args, **kwargs)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/cells/state.py\", line 436, in _cell_data_sync\n2014-07-15 01:00:07.688 3070 TRACE nova     db_cells = self.db.cell_get_all(ctxt)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/api.py\", line 1599, in cell_get_all\n2014-07-15 01:00:07.688 3070 TRACE nova     return IMPL.cell_get_all(context)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/api.py\", line 93, in __getattr__\n2014-07-15 01:00:07.688 3070 TRACE nova     return getattr(self._db_api, key)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/api.py\", line 85, in _db_api\n2014-07-15 01:00:07.688 3070 TRACE nova     backend_mapping=_BACKEND_MAPPING)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/openstack/common/db/api.py\", line 128, in __init__\n2014-07-15 01:00:07.688 3070 TRACE nova     self._load_backend()\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/openstack/common/db/api.py\", line 143, in _load_backend\n2014-07-15 01:00:07.688 3070 TRACE nova     self._backend = backend_mod.get_backend()\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/api.py\", line 42, in get_backend\n2014-07-15 01:00:07.688 3070 TRACE nova     return API()\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/api.py\", line 75, in __init__\n2014-07-15 01:00:07.688 3070 TRACE nova     self._launch_monitor()\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/api.py\", line 89, in _launch_monitor\n2014-07-15 01:00:07.688 3070 TRACE nova     self._check_schema()\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/api.py\", line 56, in inner\n2014-07-15 01:00:07.688 3070 TRACE nova     result = f(*args, **kwargs)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/api.py\", line 81, in _check_schema\n2014-07-15 01:00:07.688 3070 TRACE nova     schema = conn.get_schema()\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/connection.py\", line 186, in get_schema\n2014-07-15 01:00:07.688 3070 TRACE nova     tables = self._get_tables()\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/connection.py\", line 169, in _get_tables\n2014-07-15 01:00:07.688 3070 TRACE nova     columns = self._get_columns(table_name)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/connection.py\", line 159, in _get_columns\n2014-07-15 01:00:07.688 3070 TRACE nova     cursor = self.execute('DESCRIBE %s' % name)\n2014-07-15 01:00:07.688 3070 TRACE nova   File \"/opt/rackstack/863.0/nova/lib/python2.6/site-packages/nova/db/mysqldb/connection.py\", line 79, in inner\n2014-07-15 01:00:07.688 3070 TRACE nova     raise db_exc.DBError(e)\n2014-07-15 01:00:07.688 3070 TRACE nova DBError: (1030, 'Got error 28 from storage engine')\n2014-07-15 01:00:07.688 3070 TRACE nova\n\nSince this is a DB issue it seems the process should at the very least retry.", 
    "tags": [
        "cells"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1342257", 
    "owner": "https://api.launchpad.net/1.0/~christopher-lefelhoc", 
    "id": 1342257, 
    "index": 3953, 
    "openned": "2014-07-15 18:07:06.520505+00:00", 
    "created": "2014-07-15 18:07:06.520505+00:00", 
    "title": "Nova cells can die unexpectedly on boot due to db failure", 
    "comments": [
        {
            "content": "We have seen a crash in the cells booting process with the following traceback:", 
            "date_created": "2014-07-15 18:07:06.520505+00:00", 
            "author": "https://api.launchpad.net/1.0/~christopher-lefelhoc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/107168", 
            "date_created": "2014-07-15 20:38:11.010772+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/107168\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=b9afab4d44e91e87634d85a0867664876baf880a\nSubmitter: Jenkins\nBranch:    master\n\ncommit b9afab4d44e91e87634d85a0867664876baf880a\nAuthor: Christopher Lefelhocz <email address hidden>\nDate:   Tue Jul 15 15:05:58 2014 -0500\n\n    Fix nova cells exiting on db failure at launch\n    \n    We have seen cases where db errors at launch can cause cell\n    services to exit without retrying.  The service shouldn't\n    exit __init__ much like it doesn't later by handling\n    this type of exceptions.  We'll wait an hour and\n    then give up.\n    \n    Change-Id: I24c9eb811d50d1fa6a5e4a5f595ebf68ded3b7b5\n    Closes-Bug: 1342257\n", 
            "date_created": "2014-07-24 14:11:06.825963+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-09-05 09:53:12.844072+00:00"
}