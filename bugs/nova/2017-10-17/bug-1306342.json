{
    "status": "Invalid", 
    "last_updated": "2014-05-21 18:30:41.532030+00:00", 
    "description": "Hi there,\n\nI am unable to launch any instance after recent yum upgrade(10 April). I have installed icehouse on CentOS-6.5.\n\nDashboard:\n\nMessage: Virtual Interface creation failed\nCode: 500\nDetails\nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 296, in decorated_function return function(self, context, *args, **kwargs) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2073, in run_instance do_run_instance() File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 249, in inner return f(*args, **kwargs) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2072, in do_run_instance legacy_bdm_in_spec) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1205, in _run_instance notify(\"error\", fault=e) # notify that build failed File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__ six.reraise(self.type_, self.value, self.tb) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1189, in _run_instance instance, image_meta, legacy_bdm_in_spec) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1333, in _build_instance network_info.wait(do_raise=False) File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__ six.reraise(self.type_, self.value, self.tb) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1309, in _build_instance set_access_ip=set_access_ip) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 399, in decorated_function return function(self, context, *args, **kwargs) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1721, in _spawn LOG.exception(_('Instance failed to spawn'), instance=instance) File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__ six.reraise(self.type_, self.value, self.tb) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1718, in _spawn block_device_info) File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2251, in spawn block_device_info) File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 3654, in _create_domain_and_network raise exception.VirtualInterfaceCreateException()\n\napi.log:\n\n2014-04-11 10:38:36.383 6386 ERROR nova.api.openstack.wsgi [-] Exception handling resource: multi() got an unexpected keyword argument 'body'\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi Traceback (most recent call last):\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 983, in _process_stack\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi     action_result = self.dispatch(meth, request, action_args)\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 1070, in dispatch\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi     return method(req=request, **action_args)\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi TypeError: multi() got an unexpected keyword argument 'body'\n\n\ncompute.log:\n\n2014-04-11 10:38:32.869 17049 ERROR nova.compute.manager [req-7c8f2ee8-f957-4f1e-b188-2f136fcb7cdb 1cfbc71fddb848668295a2bb1895dfda 9f03371fd9fb4ef8ba5760a3ae1021ba] [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c] Instance failed to spawn\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c] Traceback (most recent call last):\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1718, in _spawn\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]     block_device_info)\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2251, in spawn\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]     block_device_info)\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 3654, in _create_domain_and_network\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]     raise exception.VirtualInterfaceCreateException()\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c] VirtualInterfaceCreateException: Virtual Interface creation failed\n\n\nRegards,\nBoon Lee\n\n[root@controller nova]# rpm -qa | grep openstack\nopenstack-nova-console-2014.1-0.12.rc1.el6.noarch\nopenstack-nova-scheduler-2014.1-0.12.rc1.el6.noarch\nopenstack-utils-2013.2-3.el6.noarch\nopenstack-selinux-0.1.3-2.el6ost.noarch\nopenstack-dashboard-2014.1-0.14.rc2.el6.noarch\nopenstack-nova-conductor-2014.1-0.12.rc1.el6.noarch\nopenstack-glance-2014.1-0.5.rc1.el6.noarch\nopenstack-nova-common-2014.1-0.12.rc1.el6.noarch\nopenstack-neutron-2014.1-0.13.rc1.el6.noarch\nopenstack-neutron-openvswitch-2014.1-0.13.rc1.el6.noarch\nopenstack-nova-api-2014.1-0.12.rc1.el6.noarch\nopenstack-keystone-2014.1-0.7.rc1.el6.noarch\nopenstack-nova-cert-2014.1-0.12.rc1.el6.noarch\npython-django-openstack-auth-1.1.5-1.el6.noarch\nopenstack-nova-novncproxy-2014.1-0.12.rc1.el6.noarch\n\n\n-----------------------------------\nBuilt: 2014-04-10T22:07:30 00:00\ngit SHA: 289c27051a4cccca84ce52f872013b77b2411c59\nURL: http://docs.openstack.org/trunk/install-guide/install/yum/content/launch-instance.html\nsource File: file:/home/jenkins/workspace/openstack-install-deploy-guide-fedora/doc/install-guide/ch_launch-instance.xml\nxml:id: launch-instance", 
    "tags": [
        "libvirt", 
        "network"
    ], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1306342", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1306342, 
    "index": 3879, 
    "openned": "2014-04-11 03:10:13.631876+00:00", 
    "created": "2014-04-11 02:57:38.837227+00:00", 
    "title": "Icehouse on CentOS - launch instance failed with nova", 
    "comments": [
        {
            "content": "Hi there,\n\nI am unable to launch any instance after recent yum upgrade(10 April). I have installed icehouse on CentOS-6.5.\n\nDashboard:\n\nMessage: Virtual Interface creation failed\nCode: 500\nDetails\nFile \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 296, in decorated_function return function(self, context, *args, **kwargs) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2073, in run_instance do_run_instance() File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 249, in inner return f(*args, **kwargs) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 2072, in do_run_instance legacy_bdm_in_spec) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1205, in _run_instance notify(\"error\", fault=e) # notify that build failed File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__ six.reraise(self.type_, self.value, self.tb) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1189, in _run_instance instance, image_meta, legacy_bdm_in_spec) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1333, in _build_instance network_info.wait(do_raise=False) File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__ six.reraise(self.type_, self.value, self.tb) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1309, in _build_instance set_access_ip=set_access_ip) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 399, in decorated_function return function(self, context, *args, **kwargs) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1721, in _spawn LOG.exception(_('Instance failed to spawn'), instance=instance) File \"/usr/lib/python2.6/site-packages/nova/openstack/common/excutils.py\", line 68, in __exit__ six.reraise(self.type_, self.value, self.tb) File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1718, in _spawn block_device_info) File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2251, in spawn block_device_info) File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 3654, in _create_domain_and_network raise exception.VirtualInterfaceCreateException()\n\napi.log:\n\n2014-04-11 10:38:36.383 6386 ERROR nova.api.openstack.wsgi [-] Exception handling resource: multi() got an unexpected keyword argument 'body'\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi Traceback (most recent call last):\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 983, in _process_stack\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi     action_result = self.dispatch(meth, request, action_args)\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi   File \"/usr/lib/python2.6/site-packages/nova/api/openstack/wsgi.py\", line 1070, in dispatch\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi     return method(req=request, **action_args)\n2014-04-11 10:38:36.383 6386 TRACE nova.api.openstack.wsgi TypeError: multi() got an unexpected keyword argument 'body'\n\n\ncompute.log:\n\n2014-04-11 10:38:32.869 17049 ERROR nova.compute.manager [req-7c8f2ee8-f957-4f1e-b188-2f136fcb7cdb 1cfbc71fddb848668295a2bb1895dfda 9f03371fd9fb4ef8ba5760a3ae1021ba] [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c] Instance failed to spawn\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c] Traceback (most recent call last):\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1718, in _spawn\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]     block_device_info)\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2251, in spawn\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]     block_device_info)\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 3654, in _create_domain_and_network\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c]     raise exception.VirtualInterfaceCreateException()\n2014-04-11 10:38:32.869 17049 TRACE nova.compute.manager [instance: 45a6f90d-3c76-4740-bacb-f3ea73c1b78c] VirtualInterfaceCreateException: Virtual Interface creation failed\n\n\nRegards,\nBoon Lee\n\n[root@controller nova]# rpm -qa | grep openstack\nopenstack-nova-console-2014.1-0.12.rc1.el6.noarch\nopenstack-nova-scheduler-2014.1-0.12.rc1.el6.noarch\nopenstack-utils-2013.2-3.el6.noarch\nopenstack-selinux-0.1.3-2.el6ost.noarch\nopenstack-dashboard-2014.1-0.14.rc2.el6.noarch\nopenstack-nova-conductor-2014.1-0.12.rc1.el6.noarch\nopenstack-glance-2014.1-0.5.rc1.el6.noarch\nopenstack-nova-common-2014.1-0.12.rc1.el6.noarch\nopenstack-neutron-2014.1-0.13.rc1.el6.noarch\nopenstack-neutron-openvswitch-2014.1-0.13.rc1.el6.noarch\nopenstack-nova-api-2014.1-0.12.rc1.el6.noarch\nopenstack-keystone-2014.1-0.7.rc1.el6.noarch\nopenstack-nova-cert-2014.1-0.12.rc1.el6.noarch\npython-django-openstack-auth-1.1.5-1.el6.noarch\nopenstack-nova-novncproxy-2014.1-0.12.rc1.el6.noarch\n\n\n-----------------------------------\nBuilt: 2014-04-10T22:07:30 00:00\ngit SHA: 289c27051a4cccca84ce52f872013b77b2411c59\nURL: http://docs.openstack.org/trunk/install-guide/install/yum/content/launch-instance.html\nsource File: file:/home/jenkins/workspace/openstack-install-deploy-guide-fedora/doc/install-guide/ch_launch-instance.xml\nxml:id: launch-instance", 
            "date_created": "2014-04-11 02:57:38.837227+00:00", 
            "author": "https://api.launchpad.net/1.0/~eupub"
        }, 
        {
            "content": "Boon,\n\nThis is very likely a bug either in packaging or in the code, rather than a problem in the manuals. I'm going to send this to the nova project.", 
            "date_created": "2014-04-11 03:10:02.588126+00:00", 
            "author": "https://api.launchpad.net/1.0/~fifieldt"
        }, 
        {
            "content": "Hi Tom,\n\nI fixed the problem by updating neutron.conf at controller to include neutron-nova interactions config which is missing at Open vSwitch OVS plugin - configure controller node\n\n# openstack-config --set /etc/neutron/neutron.conf DEFAULT \\\n  notify_nova_on_port_status_changes True\n# openstack-config --set /etc/neutron/neutron.conf DEFAULT \\\n  notify_nova_on_port_data_changes True\n# openstack-config --set /etc/neutron/neutron.conf DEFAULT \\\n  nova_url http://controller:8774/v2\n# openstack-config --set /etc/neutron/neutron.conf DEFAULT \\\n  nova_admin_username nova\n# openstack-config --set /etc/neutron/neutron.conf DEFAULT \\\n  nova_admin_tenant_id SERVICE_TENANT_ID\n# openstack-config --set /etc/neutron/neutron.conf DEFAULT \\\n  nova_admin_password NOVA_PASS\n# openstack-config --set /etc/neutron/neutron.conf DEFAULT \\\n  nova_admin_auth_url http://controller:35357/v2.0\n\nAfter adding these, the problem went away. FYI.\n\nRegards,\nBoon Lee", 
            "date_created": "2014-04-14 00:56:18.328024+00:00", 
            "author": "https://api.launchpad.net/1.0/~eupub"
        }, 
        {
            "content": "The same problem is fixed when I create br-eth1 in my controller node in ovs. ", 
            "date_created": "2014-04-22 11:46:50.791919+00:00", 
            "author": "https://api.launchpad.net/1.0/~trinath-somanchi"
        }, 
        {
            "content": "Solution #2 didn't work for me but workaround from RDO worked: http://openstack.redhat.com/Workarounds\n\nEdit /etc/nova/nova.conf\nvif_plugging_is_fatal:  false\nvif_plugging_timeout: 0\n\n...but I'm struggling to understand why?\n\nRgds,\nS", 
            "date_created": "2014-04-24 07:20:02.037068+00:00", 
            "author": "https://api.launchpad.net/1.0/~callmeseb"
        }, 
        {
            "content": "This is setting making vif_plugging_is_fatal=False makes it work:\n\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/virt/libvirt/driver.py#n3716\n\nBefore the timeout / vif plugging event code, any cleanup failures are wrapped and swallowed:\n\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/virt/libvirt/driver.py#n3707\n\nWith the eventlet timeout block, if the domain isn't running and libvirt pukes on that, the libvirtError isn't swallowed as before and you get the libvirtError up the stack rather than the VirtualInterfaceCreateException.\n\nFWIW I'm setting vif_plugging_is_fatal=False in my deployment but leaving the default 5 minute timeout.  This way if it does fail, the reliability is no worse off than it was between nova and neutron in Havana.\n\nI'll push a fix to wrap the libvirtError in that timeout case though.", 
            "date_created": "2014-05-20 20:13:02.000478+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Sorry, I went on a bit of a tangent with the eventlet timeout and the libvirt error on a non-running domain, I'm seeing that in a migration flow when finish_migration is called, the bug reported here is for spawn.\n\nThis is probably what you're seeing on spawn when it times out:\n\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/virt/libvirt/driver.py#n3636\n\nAnd changing the flag makes it a no-op so you don't get the exception.", 
            "date_created": "2014-05-20 21:12:28.209312+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/94476", 
            "date_created": "2014-05-20 21:20:08.132415+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This might be useful if you're on Icehouse: https://review.openstack.org/#/c/89870/", 
            "date_created": "2014-05-20 21:29:13.036209+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I've moved the resize/migrate from stopped instance issue with the neutron timeout to new bug 1321872.", 
            "date_created": "2014-05-21 18:29:53.061632+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Marking this bug as invalid since it's a configuration failure, nova/neutron have to be configured correctly for event callbacks during spawn with the libvirt driver.", 
            "date_created": "2014-05-21 18:30:40.168353+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ], 
    "closed": "2014-05-21 18:29:59.652449+00:00"
}