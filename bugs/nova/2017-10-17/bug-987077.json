{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:37:16.105346+00:00", 
    "description": "System: Ubuntu 11.10, x86. Python 2.7.2+. Nova commit: f8aa96679552935e22bc47851a30e712beadd629\nRunning \"./run_tests.sh -c\" crashes on the coverage report generation step with:\n\nRunning PEP8 and HACKING compliance check...\nERROR: import 'import memcache' failed: No module named memcache\nERROR: import 'import memcache' failed: No module named memcache\nERROR: import 'import rabbit' failed: No module named rabbit\nERROR: import 'import win32console as win' failed: No module named win32console\nERROR: import 'import win32console' failed: No module named win32console\nERROR: import 'import pywintypes' failed: No module named pywintypes\nERROR: import 'import qpid' failed: No module named qpid\nERROR: import 'from nova.rpc import impl_qpid' failed: No module named qpid.messaging\nERROR: import 'import qpid.messaging' failed: No module named qpid.messaging\nERROR: import 'import qpid.messaging.exceptions' failed: No module named qpid.messaging.exceptions\nERROR: import 'import memcache' failed: No module named memcache\nERROR: import 'import memcache' failed: No module named memcache\nERROR: import 'import ldap' failed: No module named ldap\nERROR: import 'import bpython' failed: No module named bpython\nERROR: import 'import IPython' failed: No module named IPython\nERROR: import 'import XenAPI' failed: No module named XenAPI\nERROR: import 'import win32com.client' failed: No module named win32com.client\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nERROR: import 'import pluginlib_nova as pluginlib' failed: No module named XenAPI\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nERROR: import 'import xenstore' failed: No module named XenAPIPlugin\nERROR: import 'import XenAPI' failed: No module named XenAPI\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nERROR: import 'import XenAPI' failed: No module named XenAPI\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nERROR: import 'import pluginlib_nova as pluginlib' failed: No module named XenAPI\ntools/hacking.py:122: DeprecationWarning: the md5 module is deprecated; use hashlib instead\n  __import__(mod, globals(), locals(), [], -1)\n\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nGenerating coverage report in covhtml/\nTraceback (most recent call last):\n  File \"/opt/stack/nova/.venv/bin/coverage\", line 9, in <module>\n    load_entry_point('coverage==3.5.1', 'console_scripts', 'coverage')()\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/cmdline.py\", line 657, in main\n    status = CoverageScript().command_line(argv)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/cmdline.py\", line 549, in command_line\n    directory=options.directory, **report_args)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/control.py\", line 599, in html_report\n    reporter.report(morfs, config=self.config)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/html.py\", line 83, in report\n    self.report_files(self.html_file, morfs, config, config.html_dir)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/report.py\", line 86, in report_files\n    report_fn(cu, self.coverage._analyze(cu))\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/html.py\", line 198, in html_file\n    self.write_html(html_path, html)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/html.py\", line 103, in write_html\n    write_encoded(fname, html, 'ascii', 'xmlcharrefreplace')\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/backward.py\", line 137, in write_encoded\n    f.write(text.decode('utf8'))\n  File \"/opt/stack/nova/.venv/lib/python2.7/encodings/utf_8.py\", line 16, in decode\n    return codecs.utf_8_decode(input, errors, True)\nUnicodeDecodeError: 'utf8' codec can't decode byte 0xe9 in position 28308: invalid continuation byte", 
    "tags": [
        "coverage", 
        "tests"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/987077", 
    "owner": "https://api.launchpad.net/1.0/~renier-h", 
    "id": 987077, 
    "index": 539, 
    "openned": "2012-04-23 03:07:58.732113+00:00", 
    "created": "2012-04-23 03:07:58.732113+00:00", 
    "title": "Coverage report generation crashes with UnicodeDecodeError", 
    "comments": [
        {
            "content": "System: Ubuntu 11.10, x86. Python 2.7.2+. Nova commit: f8aa96679552935e22bc47851a30e712beadd629\nRunning \"./run_tests.sh -c\" crashes on the coverage report generation step with:\n\nRunning PEP8 and HACKING compliance check...\nERROR: import 'import memcache' failed: No module named memcache\nERROR: import 'import memcache' failed: No module named memcache\nERROR: import 'import rabbit' failed: No module named rabbit\nERROR: import 'import win32console as win' failed: No module named win32console\nERROR: import 'import win32console' failed: No module named win32console\nERROR: import 'import pywintypes' failed: No module named pywintypes\nERROR: import 'import qpid' failed: No module named qpid\nERROR: import 'from nova.rpc import impl_qpid' failed: No module named qpid.messaging\nERROR: import 'import qpid.messaging' failed: No module named qpid.messaging\nERROR: import 'import qpid.messaging.exceptions' failed: No module named qpid.messaging.exceptions\nERROR: import 'import memcache' failed: No module named memcache\nERROR: import 'import memcache' failed: No module named memcache\nERROR: import 'import ldap' failed: No module named ldap\nERROR: import 'import bpython' failed: No module named bpython\nERROR: import 'import IPython' failed: No module named IPython\nERROR: import 'import XenAPI' failed: No module named XenAPI\nERROR: import 'import win32com.client' failed: No module named win32com.client\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nERROR: import 'import pluginlib_nova as pluginlib' failed: No module named XenAPI\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nERROR: import 'import xenstore' failed: No module named XenAPIPlugin\nERROR: import 'import XenAPI' failed: No module named XenAPI\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nERROR: import 'import XenAPI' failed: No module named XenAPI\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nERROR: import 'import pluginlib_nova as pluginlib' failed: No module named XenAPI\ntools/hacking.py:122: DeprecationWarning: the md5 module is deprecated; use hashlib instead\n  __import__(mod, globals(), locals(), [], -1)\n\nERROR: import 'import XenAPIPlugin' failed: No module named XenAPIPlugin\nGenerating coverage report in covhtml/\nTraceback (most recent call last):\n  File \"/opt/stack/nova/.venv/bin/coverage\", line 9, in <module>\n    load_entry_point('coverage==3.5.1', 'console_scripts', 'coverage')()\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/cmdline.py\", line 657, in main\n    status = CoverageScript().command_line(argv)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/cmdline.py\", line 549, in command_line\n    directory=options.directory, **report_args)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/control.py\", line 599, in html_report\n    reporter.report(morfs, config=self.config)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/html.py\", line 83, in report\n    self.report_files(self.html_file, morfs, config, config.html_dir)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/report.py\", line 86, in report_files\n    report_fn(cu, self.coverage._analyze(cu))\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/html.py\", line 198, in html_file\n    self.write_html(html_path, html)\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/html.py\", line 103, in write_html\n    write_encoded(fname, html, 'ascii', 'xmlcharrefreplace')\n  File \"/opt/stack/nova/.venv/local/lib/python2.7/site-packages/coverage/backward.py\", line 137, in write_encoded\n    f.write(text.decode('utf8'))\n  File \"/opt/stack/nova/.venv/lib/python2.7/encodings/utf_8.py\", line 16, in decode\n    return codecs.utf_8_decode(input, errors, True)\nUnicodeDecodeError: 'utf8' codec can't decode byte 0xe9 in position 28308: invalid continuation byte", 
            "date_created": "2012-04-23 03:07:58.732113+00:00", 
            "author": "https://api.launchpad.net/1.0/~renier-h"
        }, 
        {
            "content": "Even though we are passing --cover-package to nose (in run_tests.sh), it collects data on everything (seems this option is only to filter report output, not data collection). Problem is that when we use the coverage script directly to generate the report, we don't pass any report filtering option to it, so it goes and tries to generate report on all the data collected.\n\nIt happens that feedparser, used by nova/tests/api/openstack/compute/test_versions.py uses drv_libxml2 (python xml parser-- if installed on the system) and this file has a bad utf-8 character in it. So when coverage is generating the html report for this file, it crashes trying to decode parts of the file into utf8.\n\nThis problem is actually fixed upstream in the coverage tool, but this has not been put in an official release yet (see https://bitbucket.org/ned/coveragepy/issue/157/chokes-on-source-files-with-non-utf-8).\n\nSolution seems to be to add filtering to the direct coverage tool call in run_tests.sh. After I did this in my working dir, things ran fine generating the right nova coverage reports. Putting a patch together on this.\n\n", 
            "date_created": "2012-04-24 01:59:40.802584+00:00", 
            "author": "https://api.launchpad.net/1.0/~renier-h"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/6750", 
            "date_created": "2012-04-24 11:58:54.939423+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/6750\nCommitted: http://github.com/openstack/nova/commit/bcb53dfc6a149f94b4509ce90f89120b526f5582\nSubmitter: Jenkins\nBranch:    master\n\ncommit bcb53dfc6a149f94b4509ce90f89120b526f5582\nAuthor: Renier Morales <email address hidden>\nDate:   Mon Apr 23 22:36:19 2012 -0400\n\n    Scope coverage report generation to nova module.\n    \n    Coverage report generation was not using --include filters.\n    This resulted in generating a report that included all external\n    dependencies. Some of these may include problematic characters for\n    utf8 decoding. In the odd case this was found, coverage would fail\n    with a UnicodeDecodeError.\n    \n    Fixes bug #987077.\n    \n    Change-Id: I276698e65ac1037972209a406058168433cd826b\n", 
            "date_created": "2012-04-25 07:09:21.453430+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-05-23 13:12:24.719140+00:00"
}