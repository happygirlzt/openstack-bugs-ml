{
    "status": "Fix Released", 
    "last_updated": "2015-04-01 14:26:40.958479+00:00", 
    "description": "These can be seen all over the unit test logs. At least some of them are caused by tests failing to mock calls to conductor api method build_instances(), which is spawning new threads to handle such builds. The timeouts happen when calls to scheduler gets no reply within the configured rpc timeout of 60 secs.\n\nThis is not actually causing any test failures but makes debugging harder since errors show up randomly in logs.\n\nA typical error looks like this:\n\nTraceback (most recent call last):\n\u00a0\u00a0File \"nova/conductor/manager.py\", line 614, in build_instances\n\u00a0\u00a0\u00a0\u00a0request_spec, filter_properties)\n\u00a0\u00a0File \"nova/scheduler/client/__init__.py\", line 49, in select_destinations\n\u00a0\u00a0\u00a0\u00a0context, request_spec, filter_properties)\n\u00a0\u00a0File \"nova/scheduler/client/__init__.py\", line 35, in __run_method\n\u00a0\u00a0\u00a0\u00a0return getattr(self.instance, __name)(*args, **kwargs)\n\u00a0\u00a0File \"nova/scheduler/client/query.py\", line 34, in select_destinations\n\u00a0\u00a0\u00a0\u00a0context, request_spec, filter_properties)\n\u00a0\u00a0File \"nova/scheduler/rpcapi.py\", line 107, in select_destinations\n\u00a0\u00a0\u00a0\u00a0request_spec=request_spec, filter_properties=filter_properties)\n\u00a0\u00a0File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo/messaging/rpc/client.py\", line 152, in call\n\u00a0\u00a0\u00a0\u00a0retry=self.retry)\n\u00a0\u00a0File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo/messaging/transport.py\", line 90, in _send\n\u00a0\u00a0\u00a0\u00a0timeout=timeout, retry=retry)\n\u00a0\u00a0File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_fake.py\", line 194, in send\n\u00a0\u00a0\u00a0\u00a0return self._send(target, ctxt, message, wait_for_reply, timeout)\n\u00a0\u00a0File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_fake.py\", line 186, in _send\n\u00a0\u00a0\u00a0\u00a0'No reply on topic %s' % target.topic)\nMessagingTimeout: No reply on topic scheduler\nWARNING [nova.scheduler.driver] Setting instance to ERROR state.\n\nThen followed by an attempt to set the instance to ERROR state, which fails since the instance does not exist in the database.\n\nTraceback (most recent call last):\n\u00a0\u00a0File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 455, in fire_timers\n\u00a0\u00a0\u00a0\u00a0timer()\n\u00a0\u00a0File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 58, in __call__\n\u00a0\u00a0\u00a0\u00a0cb(*args, **kw)\n\u00a0\u00a0File \"nova/utils.py\", line 949, in wrapper\n\u00a0\u00a0\u00a0\u00a0return func(*args, **kwargs)\n\u00a0\u00a0File \"nova/conductor/manager.py\", line 618, in build_instances\n\u00a0\u00a0\u00a0\u00a0instance.uuid, request_spec)\n\u00a0\u00a0File \"nova/scheduler/driver.py\", line 67, in handle_schedule_error\n\u00a0\u00a0\u00a0\u00a0'task_state': None})\n\u00a0\u00a0File \"nova/db/api.py\", line 746, in instance_update_and_get_original\n\u00a0\u00a0\u00a0\u00a0columns_to_join=columns_to_join)\n\u00a0\u00a0File \"nova/db/sqlalchemy/api.py\", line 143, in wrapper\n\u00a0\u00a0\u00a0\u00a0return f(*args, **kwargs)\n\u00a0\u00a0File \"nova/db/sqlalchemy/api.py\", line 2282, in instance_update_and_get_original\n\u00a0\u00a0\u00a0\u00a0columns_to_join=columns_to_join)\n\u00a0\u00a0File \"nova/db/sqlalchemy/api.py\", line 2320, in _instance_update\n\u00a0\u00a0\u00a0\u00a0columns_to_join=columns_to_join)\n\u00a0\u00a0File \"nova/db/sqlalchemy/api.py\", line 1713, in _instance_get_by_uuid\n\u00a0\u00a0\u00a0\u00a0raise exception.InstanceNotFound(instance_id=uuid)", 
    "tags": [
        "testing"
    ], 
    "importance": "Low", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1371587", 
    "owner": "None", 
    "id": 1371587, 
    "index": 1391, 
    "openned": "2014-09-19 12:48:41.412439+00:00", 
    "created": "2014-09-19 12:48:41.412439+00:00", 
    "title": "MessagingTimeout errors in unit tests", 
    "comments": [
        {
            "content": "These can be seen all over the unit test logs. At least some of them are caused by tests failing to mock calls to conductor api method create_instances(), which is spawning new threads to handle such creations. The timeouts happen when calls to scheduler gets no reply within the configured rpc timeout of 60 secs.\n\nThis is not actually causing any test failures but makes debugging harder since errors show up randomly in logs.\n\nA typical error looks like this:\n\nTraceback (most recent call last):\n  File \"nova/conductor/manager.py\", line 614, in build_instances\n    request_spec, filter_properties)\n  File \"nova/scheduler/client/__init__.py\", line 49, in select_destinations\n    context, request_spec, filter_properties)\n  File \"nova/scheduler/client/__init__.py\", line 35, in __run_method\n    return getattr(self.instance, __name)(*args, **kwargs)\n  File \"nova/scheduler/client/query.py\", line 34, in select_destinations\n    context, request_spec, filter_properties)\n  File \"nova/scheduler/rpcapi.py\", line 107, in select_destinations\n    request_spec=request_spec, filter_properties=filter_properties)\n  File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo/messaging/rpc/client.py\", line 152, in call\n    retry=self.retry)\n  File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo/messaging/transport.py\", line 90, in _send\n    timeout=timeout, retry=retry)\n  File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_fake.py\", line 194, in send\n    return self._send(target, ctxt, message, wait_for_reply, timeout)\n  File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_fake.py\", line 186, in _send\n    'No reply on topic %s' % target.topic)\nMessagingTimeout: No reply on topic scheduler\nWARNING [nova.scheduler.driver] Setting instance to ERROR state.\n\nThen followed by an attempt to set the instance to ERROR state, which fails since the instance does not exist in the database.\n\nTraceback (most recent call last):\n  File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 455, in fire_timers\n    timer()\n  File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 58, in __call__\n    cb(*args, **kw)\n  File \"nova/utils.py\", line 949, in wrapper\n    return func(*args, **kwargs)\n  File \"nova/conductor/manager.py\", line 618, in build_instances\n    instance.uuid, request_spec)\n  File \"nova/scheduler/driver.py\", line 67, in handle_schedule_error\n    'task_state': None})\n  File \"nova/db/api.py\", line 746, in instance_update_and_get_original\n    columns_to_join=columns_to_join)\n  File \"nova/db/sqlalchemy/api.py\", line 143, in wrapper\n    return f(*args, **kwargs)\n  File \"nova/db/sqlalchemy/api.py\", line 2282, in instance_update_and_get_original\n    columns_to_join=columns_to_join)\n  File \"nova/db/sqlalchemy/api.py\", line 2320, in _instance_update\n    columns_to_join=columns_to_join)\n  File \"nova/db/sqlalchemy/api.py\", line 1713, in _instance_get_by_uuid\n    raise exception.InstanceNotFound(instance_id=uuid)", 
            "date_created": "2014-09-19 12:48:41.412439+00:00", 
            "author": "https://api.launchpad.net/1.0/~hanlind"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/122726", 
            "date_created": "2014-09-19 13:08:44.708509+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Sean Dague (<email address hidden>) on branch: master\nReview: https://review.openstack.org/122726\nReason: This review is > 4 weeks without comment, and failed Jenkins the last time it was checked. We are abandoning this for now. Feel free to reactivate the review by pressing the restore button and leaving a 'recheck' comment to get fresh test results.", 
            "date_created": "2014-11-20 15:21:44.513992+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "patch was abandoned, confirmed we are still seeing this, but only seeing this twice in subunit_log", 
            "date_created": "2014-12-10 21:52:57.762261+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "but not seeing any unit tests take longer then 30 seconds", 
            "date_created": "2014-12-10 21:55:02.269023+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "I believe we actually addressed this upstream with new oslo.messaging release", 
            "date_created": "2015-04-01 14:26:40.469298+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2015-04-01 14:26:22.970778+00:00"
}