{
    "status": "Fix Released", 
    "last_updated": "2016-09-02 01:13:12.670531+00:00", 
    "description": "This happens when user tries to create a new network with a duplicate vlan ID:\n\nvagrant@ubuntu:~/devstack$ nova network-list\n+--------------------------------------+---------+-------------+\n| ID                                   | Label   | Cidr        |\n+--------------------------------------+---------+-------------+\n| a16f1896-da4c-4978-9776-0b6368129b07 | private | 10.0.0.0/24 |\n+--------------------------------------+---------+-------------+\n\nvagrant@ubuntu:~/devstack$ nova network-show  a16f1896-da4c-4978-9776-0b6368129b07 \n+---------------------+--------------------------------------+\n| Property            | Value                                \n+---------------------+--------------------------------------+\n| bridge              | br100                                   \n| bridge_interface    | eth1                            \n| broadcast           | 10.0.0.255                           \n| cidr                | 10.0.0.0/24                          \n| cidr_v6             | -                                    \n| created_at          | 2015-02-10T05:52:41.000000           \n| deleted             | False                                \n| deleted_at          | -                                    \n| dhcp_server         | 10.0.0.1                             \n| dhcp_start          | 10.0.0.3                             \n| dns1                | 8.8.4.4                              \n| dns2                | -                                    \n| enable_dhcp         | True                                 \n| gateway             | 10.0.0.1                             \n| gateway_v6          | -                                    \n| host                | -                                    \n| id                  | a16f1896-da4c-4978-9776-0b6368129b07 \n| injected            | False                                \n| label               | private                              \n| mtu                 | -                                    \n| multi_host          | False                                \n| netmask             | 255.255.255.0                        \n| netmask_v6          | -                                    \n| priority            | -                                    \n| project_id          | -                                    \n| rxtx_base           | -                                    \n| share_address       | False                                \n| updated_at          | -                                    \n| vlan                | 100                                  \n| vpn_private_address | 10.0.0.2                             \n| vpn_public_address  | -                                    \n| vpn_public_port     | 1000                                 \n+---------------------+--------------------------------------+\n\n\nvagrant@ubuntu:~/devstack$ nova network-create --fixed-range-v4 20.0.0.0/24 --vlan 100 vlan100\nERROR (Conflict): There was a conflict when trying to complete your request. (HTTP 409) (Request-ID: req-634ac773-3fc7-4013-a319-69fbd4f1cca3)\n\nContrary to other conflict such as subnet conflict, nova returns a clearer error message.", 
    "tags": [
        "api"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1420112", 
    "owner": "https://api.launchpad.net/1.0/~siva-radhakrishnan", 
    "id": 1420112, 
    "index": 1525, 
    "openned": "2015-02-10 06:07:37.561479+00:00", 
    "created": "2015-02-10 06:07:37.561479+00:00", 
    "title": "Nova doesn't show enough error message when creating a new network with a duplicate vlan ID.", 
    "comments": [
        {
            "content": "This happens when user tries to create a new network with a duplicate vlan ID:\n\nvagrant@ubuntu:~/devstack$ nova network-list\n+--------------------------------------+---------+-------------+\n| ID                                   | Label   | Cidr        |\n+--------------------------------------+---------+-------------+\n| a16f1896-da4c-4978-9776-0b6368129b07 | private | 10.0.0.0/24 |\n+--------------------------------------+---------+-------------+\n\nvagrant@ubuntu:~/devstack$ nova network-show  a16f1896-da4c-4978-9776-0b6368129b07 \n+---------------------+--------------------------------------+\n| Property            | Value                                \n+---------------------+--------------------------------------+\n| bridge              | br100                                   \n| bridge_interface    | eth1                            \n| broadcast           | 10.0.0.255                           \n| cidr                | 10.0.0.0/24                          \n| cidr_v6             | -                                    \n| created_at          | 2015-02-10T05:52:41.000000           \n| deleted             | False                                \n| deleted_at          | -                                    \n| dhcp_server         | 10.0.0.1                             \n| dhcp_start          | 10.0.0.3                             \n| dns1                | 8.8.4.4                              \n| dns2                | -                                    \n| enable_dhcp         | True                                 \n| gateway             | 10.0.0.1                             \n| gateway_v6          | -                                    \n| host                | -                                    \n| id                  | a16f1896-da4c-4978-9776-0b6368129b07 \n| injected            | False                                \n| label               | private                              \n| mtu                 | -                                    \n| multi_host          | False                                \n| netmask             | 255.255.255.0                        \n| netmask_v6          | -                                    \n| priority            | -                                    \n| project_id          | -                                    \n| rxtx_base           | -                                    \n| share_address       | False                                \n| updated_at          | -                                    \n| vlan                | 100                                  \n| vpn_private_address | 10.0.0.2                             \n| vpn_public_address  | -                                    \n| vpn_public_port     | 1000                                 \n+---------------------+--------------------------------------+\n\n\nvagrant@ubuntu:~/devstack$ nova network-create --fixed-range-v4 20.0.0.0/24 --vlan 100 vlan100\nERROR (Conflict): There was a conflict when trying to complete your request. (HTTP 409) (Request-ID: req-634ac773-3fc7-4013-a319-69fbd4f1cca3)\n\nContrary to other conflict such as subnet conflict, nova returns a clearer error message.", 
            "date_created": "2015-02-10 06:07:37.561479+00:00", 
            "author": "https://api.launchpad.net/1.0/~kahou82"
        }, 
        {
            "content": "@Kahou, can you see errors / stack traces in any of the nova logs? can you please upload them to this bug? Which version of Nova? Are you using Nova Network? (and no Neutron just to confirm).", 
            "date_created": "2015-02-10 15:06:06.812598+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Looks like you have assigned this to yourself, if you are going to provide a fix/review, please switch it back to \"Confirmed\"", 
            "date_created": "2015-02-10 15:06:59.921366+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "@Davanum, I am using devstack from the master branch and it is a nova network.\n\nBelow is the stack trace from nova-net:\n\n2015-02-10 08:34:09.180 ERROR oslo_messaging.rpc.dispatcher [req-8b1e1d6e-c0d8-49d2-b371-c9e8b3095c84 admin admin] Exception during message handling: Detect\ned existing vlan with id 100\nTraceback (most recent call last):\n\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 412, in _object_dispatch\n    return getattr(target, method)(context, *args, **kwargs)\n\n  File \"/opt/stack/nova/nova/objects/base.py\", line 206, in wrapper\n    return fn(self, ctxt, *args, **kwargs)\n\n  File \"/opt/stack/nova/nova/objects/network.py\", line 177, in create\n    db_network = db.network_create_safe(context, updates)\n\n  File \"/opt/stack/nova/nova/db/api.py\", line 973, in network_create_safe\n    return IMPL.network_create_safe(context, values)\n\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 125, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2743, in network_create_safe\n    raise exception.DuplicateVlan(vlan=values['vlan'])\n\nDuplicateVlan: Detected existing vlan with id 100\n\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _\ndispatch_and_reply\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _\ndispatch\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _\ndo_dispatch\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 2068, in create_networks\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     self, context, vpn=True, **kwargs)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 1207, in create_networks\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     return self._do_create_networks(context, **kwargs)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/network/manager.py\", line 1380, in _do_create_networks\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     net.create()\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/base.py\", line 191, in wrapper\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     ctxt, self, fn.__name__, args, kwargs)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 370, in object_action\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     objmethod=objmethod, args=args, kwargs=kwargs)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     retry=self.retry)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 417,\n in send\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     retry=retry)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 408,\n in _send\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     raise result\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher DuplicateVlan_Remote: Detected existing vlan with id 100\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/manager.py\", line 412, in _object_dispatch\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     return getattr(target, method)(context, *args, **kwargs)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/base.py\", line 206, in wrapper\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     return fn(self, ctxt, *args, **kwargs)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/objects/network.py\", line 177, in create\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     db_network = db.network_create_safe(context, updates)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/db/api.py\", line 973, in network_create_safe\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     return IMPL.network_create_safe(context, values)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 125, in wrapper\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     return f(*args, **kwargs)\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2743, in network_create_safe\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher     raise exception.DuplicateVlan(vlan=values['vlan'])\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher DuplicateVlan: Detected existing vlan with id 100\n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.180 TRACE oslo_messaging.rpc.dispatcher \n2015-02-10 08:34:09.182 ERROR oslo_messaging._drivers.common [req-8b1e1d6e-c0d8-49d2-b371-c9e8b3095c84 admin admin] Returning exception Detected existing vl\nan with id 100\nTraceback (most recent call last):\n\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 412, in _object_dispatch\n    return getattr(target, method)(context, *args, **kwargs)\n\n  File \"/opt/stack/nova/nova/objects/base.py\", line 206, in wrapper\n    return fn(self, ctxt, *args, **kwargs)\n\n  File \"/opt/stack/nova/nova/objects/network.py\", line 177, in create\n    db_network = db.network_create_safe(context, updates)\n\n  File \"/opt/stack/nova/nova/db/api.py\", line 973, in network_create_safe\n    return IMPL.network_create_safe(context, values)\n\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 125, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2743, in network_create_safe\n    raise exception.DuplicateVlan(vlan=values['vlan'])\n\nDuplicateVlan: Detected existing vlan with id 100\n to caller\n2015-02-10 08:34:09.182 ERROR oslo_messaging._drivers.common [req-8b1e1d6e-c0d8-49d2-b371-c9e8b3095c84 admin admin] ['Traceback (most recent call last):\\n',\n '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', '  File \"/\nusr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n', '  File \"/usr/local/lib/python2.\n7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\\n    result = func(ctxt, **new_args)\\n', '  File \"/opt/stack/nova/nova/network/\nmanager.py\", line 2068, in create_networks\\n    self, context, vpn=True, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1207, in crea\nte_networks\\n    return self._do_create_networks(context, **kwargs)\\n', '  File \"/opt/stack/nova/nova/network/manager.py\", line 1380, in _do_create_networks\n\\n    net.create()\\n', '  File \"/opt/stack/nova/nova/objects/base.py\", line 191, in wrapper\\n    ctxt, self, fn.__name__, args, kwargs)\\n', '  File \"/opt/st\nack/nova/nova/conductor/rpcapi.py\", line 370, in object_action\\n    objmethod=objmethod, args=args, kwargs=kwargs)\\n', '  File \"/usr/local/lib/python2.7/dis\nt-packages/oslo_messaging/rpc/client.py\", line 156, in call\\n    retry=self.retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/transp\nort.py\", line 90, in _send\\n    timeout=timeout, retry=retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", li\nne 417, in send\\n    retry=retry)\\n', '  File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py\", line 408, in _send\\n    raise \nresult\\n', 'DuplicateVlan_Remote: Detected existing vlan with id 100\\nTraceback (most recent call last):\\n\\n  File \"/opt/stack/nova/nova/conductor/manager.p\ny\", line 412, in _object_dispatch\\n    return getattr(target, method)(context, *args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/objects/base.py\", line 206, \nin wrapper\\n    return fn(self, ctxt, *args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/objects/network.py\", line 177, in create\\n    db_network = db.network\n_create_safe(context, updates)\\n\\n  File \"/opt/stack/nova/nova/db/api.py\", line 973, in network_create_safe\\n    return IMPL.network_create_safe(context, va\nlues)\\n\\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 125, in wrapper\\n    return f(*args, **kwargs)\\n\\n  File \"/opt/stack/nova/nova/db/sqlalche\nmy/api.py\", line 2743, in network_create_safe\\n    raise exception.DuplicateVlan(vlan=values[\\'vlan\\'])\\n\\nDuplicateVlan: Detected existing vlan with id 100\n\\n\\n']\n", 
            "date_created": "2015-02-10 17:26:21.728930+00:00", 
            "author": "https://api.launchpad.net/1.0/~kahou82"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/154698", 
            "date_created": "2015-02-10 22:45:36.316300+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Kahou Lei (<email address hidden>) on branch: master\nReview: https://review.openstack.org/154698", 
            "date_created": "2015-02-11 23:17:32.127217+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/155105", 
            "date_created": "2015-02-11 23:32:14.574989+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/155105\nReason: This patch is very old and appears to not be active any more. I am therefore abandoning it to keep the nova review queue sane. Feel free to restore the change when you're actively working on it again.", 
            "date_created": "2016-01-21 10:09:36.123387+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/339253", 
            "date_created": "2016-07-07 22:06:40.157942+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/339253\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=4caabaf864f9bec62c4a78c7e9c4dc31ea5ef063\nSubmitter: Jenkins\nBranch:    master\n\ncommit 4caabaf864f9bec62c4a78c7e9c4dc31ea5ef063\nAuthor: Sivasathurappan Radhakrishnan <email address hidden>\nDate:   Thu Jul 7 21:58:32 2016 +0000\n\n    Provide more duplicate VLAN network error info\n    \n    When user tries to create a network which VLAN ID is already\n    used by another network, Network object will throw a DuplicateVlan\n    exception. However, when the exception get propagate to the API level,\n    it is only treated as a regular exception. This fix is to treat Duplicate\n    Vlan exception as a special exception (similar to DuplicateCidr) so that\n    users know more about what kind of duplicated setting they configured.\n    \n    Change-Id: Ib2f7bc90957d4ae5647adbbda05a87195549374d\n    Closes-Bug: #1420112\n    Co-Authored-By: kahou Lei<email address hidden>\n", 
            "date_created": "2016-08-30 12:58:21.488778+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0b3 development milestone.", 
            "date_created": "2016-09-02 01:13:11.652957+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-08-30 12:58:18.257196+00:00"
}