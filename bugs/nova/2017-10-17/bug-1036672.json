{
    "status": "Invalid", 
    "last_updated": "2014-09-04 18:12:48.084737+00:00", 
    "description": "Steps to reproduce:\n\n1. Create project and network\n2. Spawn instance\n3. Delete instance\n4. Delete project and network\n5. Create same network\n6. Create project\n7. Spawn instance\n\nAffected releases: OpenStack Essex\n\nDescription:\n\nYou are unable to spawn instance with network that was previosly deleted and recreated. Instance get ERROR state and in nova-compute.log you will see this error:\n\n2012-08-13 19:47:38 nova.compute.manager: ERROR [req-51fc575d-6e0f-482e-8087-7fcacfd72af4 0d2d8dab9f9d415986d28505ed4861bb b833a8f1094b4815b50ddcc21b2b6423] Instance failed to spawn\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a] Traceback (most recent call last):\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 598, in _spawn\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     self._legacy_nw_info(network_info), block_device_info)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     return f(*args, **kw)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 919, in spawn\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     block_device_info=block_device_info)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1539, in to_xml\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     rescue, block_device_info)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1422, in _prepare_xml_info\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     nics.append(self.vif_driver.plug(instance, network, mapping))\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/vif.py\", line 99, in plug\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     return self._get_configurations(network, mapping)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/vif.py\", line 69, in _get_configurations\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     'ip_address': mapping['ips'][0]['ip'],\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a] IndexError: list index out of range\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]", 
    "tags": [
        "compute", 
        "network"
    ], 
    "importance": "Medium", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1036672", 
    "owner": "None", 
    "id": 1036672, 
    "index": 3012, 
    "openned": "2012-08-14 13:51:57.426013+00:00", 
    "created": "2012-08-14 13:51:57.426013+00:00", 
    "title": "Unable to spawn instance after I delete and create same network", 
    "comments": [
        {
            "content": "Steps to reproduce:\n\n1. Create project and network\n2. Spawn instance\n3. Delete instance\n4. Delete project and network\n5. Create same network\n6. Create project\n7. Spawn instance\n\nAffected releases: OpenStack Essex\n\nDescription:\n\nYou are unable to spawn instance with network that was previosly deleted and recreated. Instance get ERROR state and in nova-compute.log you will see this error:\n\n2012-08-13 19:47:38 nova.compute.manager: ERROR [req-51fc575d-6e0f-482e-8087-7fcacfd72af4 0d2d8dab9f9d415986d28505ed4861bb b833a8f1094b4815b50ddcc21b2b6423] Instance failed to spawn\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a] Traceback (most recent call last):\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 598, in _spawn\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     self._legacy_nw_info(network_info), block_device_info)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 114, in wrapped\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     return f(*args, **kw)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 919, in spawn\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     block_device_info=block_device_info)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1539, in to_xml\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     rescue, block_device_info)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/connection.py\", line 1422, in _prepare_xml_info\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     nics.append(self.vif_driver.plug(instance, network, mapping))\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/vif.py\", line 99, in plug\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     return self._get_configurations(network, mapping)\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/vif.py\", line 69, in _get_configurations\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]     'ip_address': mapping['ips'][0]['ip'],\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a] IndexError: list index out of range\n2012-08-13 19:47:38 TRACE nova.compute.manager [instance: f6531b3d-9764-48b8-b36f-695c8f06480a]", 
            "date_created": "2012-08-14 13:51:57.426013+00:00", 
            "author": "https://api.launchpad.net/1.0/~bfilippov"
        }, 
        {
            "content": "While deallocation, nova-network log looks like:\n\n2012-08-13 17:22:32 DEBUG nova.network.manager [req-ead1ceef-fe4d-4a52-984c-0649226673b0 f3dc44870a8240a0b1af0a6de7a0e9b9 9b43eb4f9f02484e83f85efd3f6df73a] floating IP deallocation for instance |7| from (pid=260\n4) deallocate_for_instance /usr/lib/python2.6/site-packages/nova/network/manager.py:353\n2012-08-13 17:22:32 DEBUG nova.network.manager [req-ead1ceef-fe4d-4a52-984c-0649226673b0 f3dc44870a8240a0b1af0a6de7a0e9b9 9b43eb4f9f02484e83f85efd3f6df73a] network deallocation for instance |7| from (pid=2604) d\neallocate_for_instance /usr/lib/python2.6/site-packages/nova/network/manager.py:930\n2012-08-13 17:22:32 ERROR nova.rpc.amqp [req-ead1ceef-fe4d-4a52-984c-0649226673b0 f3dc44870a8240a0b1af0a6de7a0e9b9 9b43eb4f9f02484e83f85efd3f6df73a] Exception during message handling\n2012-08-13 17:22:32 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/rpc/amqp.py\", line 253, in _process_data\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 257, in wrapped\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 379, in deallocate_for_instance\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     super(FloatingIP, self).deallocate_for_instance(context, **kwargs)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 257, in wrapped\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     return func(self, context, *args, **kwargs)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 934, in deallocate_for_instance\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     **kwargs)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 230, in deallocate_fixed_ip\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     network = self._get_network_by_id(context, fixed_ip['network_id'])\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/network/manager.py\", line 1550, in _get_network_by_id\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     return self.db.network_get(context, network_id)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/db/api.py\", line 755, in network_get\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     return IMPL.network_get(context, network_id)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 120, in wrapper\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     return f(*args, **kwargs)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/db/sqlalchemy/api.py\", line 1933, in network_get\n2012-08-13 17:22:32 TRACE nova.rpc.amqp     raise exception.NetworkNotFound(network_id=network_id)\n2012-08-13 17:22:32 TRACE nova.rpc.amqp NetworkNotFound: Network 7 could not be found.\n2012-08-13 17:22:32 TRACE nova.rpc.amqp \n", 
            "date_created": "2012-08-14 14:49:13.997664+00:00", 
            "author": "https://api.launchpad.net/1.0/~aababilov"
        }, 
        {
            "content": "Please see my comment (last) on this bug \n\nhttps://bugs.launchpad.net/nova/+bug/1017633", 
            "date_created": "2012-08-14 15:28:09.470942+00:00", 
            "author": "https://api.launchpad.net/1.0/~rsokolkov"
        }, 
        {
            "content": "Is this still happen?", 
            "date_created": "2014-07-14 06:48:33.683953+00:00", 
            "author": "https://api.launchpad.net/1.0/~h-tanizawa"
        }, 
        {
            "content": "really old invalid bug", 
            "date_created": "2014-09-04 18:12:47.341238+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2014-09-04 18:12:41.217206+00:00"
}