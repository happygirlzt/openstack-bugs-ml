{
    "status": "Opinion", 
    "last_updated": "2016-05-17 16:11:47.782728+00:00", 
    "description": "I re-created a flavor that is the same 'flavorid' on before and after.\n\nAfter re-creation, the flavor value of the instance, that created by the 'flavorid', was changed to the new flavor value.\n\nCurrently, the flavor value of the instance is refer to 'flavorid'. In this case, it should be refer to 'id', not 'flavorid'.\n\nIn database scheme, id is really unique but flavorid is perform the conflict.\n\nLogs are here:\n\nadmin@host:~$ nova show vm1\n+--------------------------------------+----------------------------------------------------------------------+\n| Property                             | Value                                                                |\n+--------------------------------------+----------------------------------------------------------------------+\n| NET1 network                         | 10.0.10.100                                                          |\n| OS-DCF:diskConfig                    | MANUAL                                                               |\n| OS-EXT-AZ:availability_zone          | nova                                                                 |\n| OS-EXT-SRV-ATTR:host                 | host1                                                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | host1                                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000018                                                    |\n| OS-EXT-STS:power_state               | 1                                                                    |\n| OS-EXT-STS:task_state                | -                                                                    |\n| OS-EXT-STS:vm_state                  | active                                                               |\n| OS-SRV-USG:launched_at               | 2014-05-16T20:18:02.000000                                           |\n| OS-SRV-USG:terminated_at             | -                                                                    |\n| accessIPv4                           |                                                                      |\n| accessIPv6                           |                                                                      |\n| config_drive                         |                                                                      |\n| created                              | 2014-05-16T20:17:37Z                                                 |\n| flavor                               | m1.test (10)                                                         |    <- original\n| hostId                               | 852bf49aacad06f83e406fe230f1e30e8f0ec73e1f142a5900a602be             |\n| id                                   | bbd0b20d-2ab8-414a-8663-0288e2775013                                 |\n| image                                | cirros (87a7ff8d-178c-4072-a57b-1d9817bbb70a)                        |\n| key_name                             | -                                                                    |\n| metadata                             | {}                                                                   |\n| name                                 | vm1                                                                  |\n| os-extended-volumes:volumes_attached | []                                                                   |\n| progress                             | 0                                                                    |\n| security_groups                      | default, default                                                     |\n| status                               | ACTIVE                                                               |\n| tenant_id                            | 177be698aaa4431aaf41c8012d597e7d                                     |\n| updated                              | 2014-05-16T20:18:02Z                                                 |\n| user_id                              | bea0bdab5dfa4f99a1cbd0a8532df3c5                                     |\n+--------------------------------------+----------------------------------------------------------------------+\ngadmin@gtestcompute-172-16-227-7:~$ nova flavor-delete 10\n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+                                                                                                                \n| ID | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |                                                                                                                    \n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+                                                                                                                    \n| 10 | m1.test | 1200      | 12   | 0         |      | 8     | 1.0         | True      |                                                                                                                    \n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+\nadmin@host:~$ nova flavor-create m2.test 10 1200 12 8\n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+\n| 10 | m2.test | 1200      | 12   | 0         |      | 8     | 1.0         | True      |\n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+\nadmin@host:~$ nova show vm1\n+--------------------------------------+----------------------------------------------------------------------+\n| Property                             | Value                                                                |\n+--------------------------------------+----------------------------------------------------------------------+\n| NET1 network                         | 10.0.10.100                                                          |\n| OS-DCF:diskConfig                    | MANUAL                                                               |\n| OS-EXT-AZ:availability_zone          | nova                                                                 |\n| OS-EXT-SRV-ATTR:host                 | host1                                                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | host1                                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000018                                                    |\n| OS-EXT-STS:power_state               | 1                                                                    |\n| OS-EXT-STS:task_state                | -                                                                    |\n| OS-EXT-STS:vm_state                  | active                                                               |\n| OS-SRV-USG:launched_at               | 2014-05-16T20:18:02.000000                                           |\n| OS-SRV-USG:terminated_at             | -                                                                    |\n| accessIPv4                           |                                                                      |\n| accessIPv6                           |                                                                      |\n| config_drive                         |                                                                      |\n| created                              | 2014-05-16T20:17:37Z                                                 |\n| flavor                               | g2.test (10)                                                         |    <- flavor is CHANGED to incorrect value!\n| hostId                               | 852bf49aacad06f83e406fe230f1e30e8f0ec73e1f142a5900a602be             |\n| id                                   | bbd0b20d-2ab8-414a-8663-0288e2775013                                 |\n| image                                | cirros (87a7ff8d-178c-4072-a57b-1d9817bbb70a)                        |\n| key_name                             | -                                                                    |\n| metadata                             | {}                                                                   |\n| name                                 | vm1                                                                  |\n| os-extended-volumes:volumes_attached | []                                                                   |\n| progress                             | 0                                                                    |\n| security_groups                      | default, default                                                     |\n| status                               | ACTIVE                                                               |\n| tenant_id                            | 177be698aaa4431aaf41c8012d597e7d                                     |\n| updated                              | 2014-05-16T20:18:02Z                                                 |\n| user_id                              | bea0bdab5dfa4f99a1cbd0a8532df3c5                                     |\n+--------------------------------------+----------------------------------------------------------------------+\n\nmysql> SELECT id,flavorid,name,deleted FROM instance_types WHERE name LIKE '%.test';\n+----+----------+---------+---------+\n| id | flavorid | name    | deleted |\n+----+----------+---------+---------+\n|  6 | 10       | g1.test |       6 |\n|  7 | 10       | g2.test |       0 |\n+----+----------+---------+---------+", 
    "tags": [
        "api"
    ], 
    "importance": "Wishlist", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1320754", 
    "owner": "None", 
    "id": 1320754, 
    "index": 2807, 
    "openned": "2014-05-19 05:17:34.644798+00:00", 
    "created": "2014-05-19 05:17:34.644798+00:00", 
    "title": "flavor-recreate-bug", 
    "comments": [
        {
            "content": "I re-created a flavor that is the same 'flavorid' on before and after.\n\nAfter re-creation, the flavor value of the instance, that created by the 'flavorid', was changed to the new flavor value.\n\nCurrently, the flavor value of the instance is refer to 'flavorid'. In this case, it should be refer to 'id', not 'flavorid'.\n\nIn database scheme, id is really unique but flavorid is perform the conflict.\n\nLogs are here:\n\nadmin@host:~$ nova show vm1\n+--------------------------------------+----------------------------------------------------------------------+\n| Property                             | Value                                                                |\n+--------------------------------------+----------------------------------------------------------------------+\n| NET1 network                         | 10.0.10.100                                                          |\n| OS-DCF:diskConfig                    | MANUAL                                                               |\n| OS-EXT-AZ:availability_zone          | nova                                                                 |\n| OS-EXT-SRV-ATTR:host                 | host1                                                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | host1                                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000018                                                    |\n| OS-EXT-STS:power_state               | 1                                                                    |\n| OS-EXT-STS:task_state                | -                                                                    |\n| OS-EXT-STS:vm_state                  | active                                                               |\n| OS-SRV-USG:launched_at               | 2014-05-16T20:18:02.000000                                           |\n| OS-SRV-USG:terminated_at             | -                                                                    |\n| accessIPv4                           |                                                                      |\n| accessIPv6                           |                                                                      |\n| config_drive                         |                                                                      |\n| created                              | 2014-05-16T20:17:37Z                                                 |\n| flavor                               | m1.test (10)                                                         |    <- original\n| hostId                               | 852bf49aacad06f83e406fe230f1e30e8f0ec73e1f142a5900a602be             |\n| id                                   | bbd0b20d-2ab8-414a-8663-0288e2775013                                 |\n| image                                | cirros (87a7ff8d-178c-4072-a57b-1d9817bbb70a)                        |\n| key_name                             | -                                                                    |\n| metadata                             | {}                                                                   |\n| name                                 | vm1                                                                  |\n| os-extended-volumes:volumes_attached | []                                                                   |\n| progress                             | 0                                                                    |\n| security_groups                      | default, default                                                     |\n| status                               | ACTIVE                                                               |\n| tenant_id                            | 177be698aaa4431aaf41c8012d597e7d                                     |\n| updated                              | 2014-05-16T20:18:02Z                                                 |\n| user_id                              | bea0bdab5dfa4f99a1cbd0a8532df3c5                                     |\n+--------------------------------------+----------------------------------------------------------------------+\ngadmin@gtestcompute-172-16-227-7:~$ nova flavor-delete 10\n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+                                                                                                                \n| ID | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |                                                                                                                    \n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+                                                                                                                    \n| 10 | m1.test | 1200      | 12   | 0         |      | 8     | 1.0         | True      |                                                                                                                    \n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+\nadmin@host:~$ nova flavor-create m2.test 10 1200 12 8\n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+\n| 10 | m2.test | 1200      | 12   | 0         |      | 8     | 1.0         | True      |\n+----+---------+-----------+------+-----------+------+-------+-------------+-----------+\nadmin@host:~$ nova show vm1\n+--------------------------------------+----------------------------------------------------------------------+\n| Property                             | Value                                                                |\n+--------------------------------------+----------------------------------------------------------------------+\n| NET1 network                         | 10.0.10.100                                                          |\n| OS-DCF:diskConfig                    | MANUAL                                                               |\n| OS-EXT-AZ:availability_zone          | nova                                                                 |\n| OS-EXT-SRV-ATTR:host                 | host1                                                                |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | host1                                                                |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000018                                                    |\n| OS-EXT-STS:power_state               | 1                                                                    |\n| OS-EXT-STS:task_state                | -                                                                    |\n| OS-EXT-STS:vm_state                  | active                                                               |\n| OS-SRV-USG:launched_at               | 2014-05-16T20:18:02.000000                                           |\n| OS-SRV-USG:terminated_at             | -                                                                    |\n| accessIPv4                           |                                                                      |\n| accessIPv6                           |                                                                      |\n| config_drive                         |                                                                      |\n| created                              | 2014-05-16T20:17:37Z                                                 |\n| flavor                               | g2.test (10)                                                         |    <- flavor is CHANGED to incorrect value!\n| hostId                               | 852bf49aacad06f83e406fe230f1e30e8f0ec73e1f142a5900a602be             |\n| id                                   | bbd0b20d-2ab8-414a-8663-0288e2775013                                 |\n| image                                | cirros (87a7ff8d-178c-4072-a57b-1d9817bbb70a)                        |\n| key_name                             | -                                                                    |\n| metadata                             | {}                                                                   |\n| name                                 | vm1                                                                  |\n| os-extended-volumes:volumes_attached | []                                                                   |\n| progress                             | 0                                                                    |\n| security_groups                      | default, default                                                     |\n| status                               | ACTIVE                                                               |\n| tenant_id                            | 177be698aaa4431aaf41c8012d597e7d                                     |\n| updated                              | 2014-05-16T20:18:02Z                                                 |\n| user_id                              | bea0bdab5dfa4f99a1cbd0a8532df3c5                                     |\n+--------------------------------------+----------------------------------------------------------------------+\n\nmysql> SELECT id,flavorid,name,deleted FROM instance_types WHERE name LIKE '%.test';\n+----+----------+---------+---------+\n| id | flavorid | name    | deleted |\n+----+----------+---------+---------+\n|  6 | 10       | g1.test |       6 |\n|  7 | 10       | g2.test |       0 |\n+----+----------+---------+---------+", 
            "date_created": "2014-05-19 05:17:34.644798+00:00", 
            "author": "https://api.launchpad.net/1.0/~yohei-matsuhashi"
        }, 
        {
            "content": "I have looked at this bug, and it seems that a possible solution might be to prevent a user from deleting a flavor that is in use.  This is because it may cause problems as described above or resize problems.  What is your opinion on it?", 
            "date_created": "2014-06-17 15:12:53.620520+00:00", 
            "author": "https://api.launchpad.net/1.0/~thang-pham"
        }, 
        {
            "content": "I would like to change parameters of the flavor, but nova flavor-update is not implemented yet. So I tried to re-create the flavor.\n\nI have two suggestions:\n1. prevent to delete a flavor while still in use. I agree with your solution.\n2. implement flavor-update api", 
            "date_created": "2014-06-23 12:58:06.067028+00:00", 
            "author": "https://api.launchpad.net/1.0/~yohei-matsuhashi"
        }, 
        {
            "content": "I don't think you can have a flavor update api because it would make references from running servers to the flavor invalid. Looks like the fundamental problem is that there are some references to flavorid which should actually be to the unique id from InstanceType table instead\n\n", 
            "date_created": "2014-06-24 06:09:23.282578+00:00", 
            "author": "https://api.launchpad.net/1.0/~cyeoh-0"
        }, 
        {
            "content": "So after having had a better look I think this is pretty hard to fix and will probably require an API change (probably backwards incompatible) to do so.\n\nInternally we're good about always referencing the unique instance type id. So deletions and creations of flavors are fine. Servers always refer to the flavor that they were created with.\n\nHowever we have this fake \"flavor id\" which is not unique in the instancetypes and we translate that back and forth when talking about flavor types with the client of the API. And the only way we communicate with client about flavors is this key which is not unique over time.\n\nThe long term solution is to change the interface so we only use a unique id through the API (probably a UUID). But thats a long term API change for the flavors API", 
            "date_created": "2014-06-24 06:25:35.424925+00:00", 
            "author": "https://api.launchpad.net/1.0/~cyeoh-0"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/107505", 
            "date_created": "2014-07-16 21:25:09.801225+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This is potential improve for api when we have micro-version.", 
            "date_created": "2014-08-05 05:42:54.257164+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }, 
        {
            "content": "Change abandoned by Thang Pham (<email address hidden>) on branch: master\nReview: https://review.openstack.org/107505\nReason: Abandoning patch, since there is no clean way to keep a unique flavor around via flavorid until we make an API change to support it.", 
            "date_created": "2014-09-23 19:10:50.334150+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This wishlist bug has been open a year without any activity. I'm going to move it to \"Opinion / Wishlist\", which is an easily-obtainable queue of older requests that have come on. \n\nIn case you want to work on that, consider writing a blueprints [1] and spec [2]. I'll recommend to read [3] if not yet done. The effort to implement the requested feature is then driven only by the blueprint (and spec).\n\nReferences:\n[1] https://blueprints.launchpad.net/nova/\n[2] https://github.com/openstack/nova-specs\n[3] https://wiki.openstack.org/wiki/Blueprints", 
            "date_created": "2016-05-17 16:11:47.273894+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ], 
    "closed": "2016-05-17 16:11:21.025111+00:00"
}