{
    "status": "Opinion", 
    "last_updated": "2017-08-02 20:49:38.156619+00:00", 
    "description": "KeystoneAuth doesn't use a default cafile, this causes problems when generating a local CA or self signed CA with HTTPS enabled endpoints. Even though the CA can be installed locally, keystone auth will still fail ssl verification.\n\n=================\n2017-04-03 00:54:49.305 545 DEBUG oslo_messaging._drivers.amqpdriver [-] received reply msg_id: bb9ce702f5864adf8e4720d2304fcb2a __call__ /usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py:346\n2017-04-03 00:54:49.337 545 DEBUG cinderclient.v2.client [req-7cb00c0e-be3d-4e25-b369-fd8aecbae803 7106629bf3b440a79030d327abd0747e 2aeed525cd4e4f329b0567be30d3aa6c - default default] REQ: curl -g -i -X GET https://openstack.local.net:8776/v2/2aeed525cd4e4f329b0567be30d3aa6c/volumes/ef828539-027c-4daa-9c96-19d2f3cd51e3 -H \"X-Service-Token: {SHA1}77aedd00ae7642ecf44c452749b8b3ed6f45330d\" -H \"User-Agent: python-cinderclient\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}a91d7c21ef9f2401ffbe691355000e7bcc9d390c\" _http_log_request /usr/lib/python2.7/site-packages/keystoneauth1/session.py:347\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions [req-7cb00c0e-be3d-4e25-b369-fd8aecbae803 7106629bf3b440a79030d327abd0747e 2aeed525cd4e4f329b0567be30d3aa6c - default default] Unexpected exception in API method\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/volumes.py\", line 338, in create\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     volume_id, device)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 204, in inner\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return function(self, context, instance, *args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 152, in inner\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return f(self, context, instance, *args, **kw)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 3772, in attach_volume\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     disk_bus, device_type)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 3715, in _attach_volume\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     volume_bdm.destroy()\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     self.force_reraise()\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 3711, in _attach_volume\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     self._check_attach_and_reserve_volume(context, volume_id, instance)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 3693, in _check_attach_and_reserve_volume\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     volume = self.volume_api.get(context, volume_id)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 177, in wrapper\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     _reraise(exception.CinderConnectionFailed(reason=err_msg))\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 231, in _reraise\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     six.reraise(type(desired_exc), desired_exc, sys.exc_info()[2])\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 173, in wrapper\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     res = method(self, ctx, *args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 195, in wrapper\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     res = method(self, ctx, volume_id, *args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 239, in get\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     item = cinderclient(context).volumes.get(volume_id)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/v2/volumes.py\", line 277, in get\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return self._get(\"/volumes/%s\" % volume_id, \"volume\")\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/base.py\", line 314, in _get\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     resp, body = self.api.client.get(url)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/client.py\", line 171, in get\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return self._cs_request(url, 'GET', **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/client.py\", line 162, in _cs_request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return self.request(url, method, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/client.py\", line 148, in request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/keystoneauth1/adapter.py\", line 380, in request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     resp = super(LegacyJsonAdapter, self).request(*args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/keystoneauth1/adapter.py\", line 148, in request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return self.session.request(url, method, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/positional/__init__.py\", line 101, in inner\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return wrapped(*args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 616, in request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     resp = send(**kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 678, in _send_request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     raise exceptions.SSLError(msg)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions CinderConnectionFailed: Connection to cinder host failed: SSL exception connecting to https://openstack.local.nunet.net:8776/v2/2aeed525cd4e4f329b0567be30d3aa6c/volumes/ef828539-027c-4daa-9c96-19d2f3cd51e3: (\"bad handshake: Error([('SSL routines', 'SSL3_GET_SERVER_CERTIFICATE', 'certificate verify failed')],)\",)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions\n\n====================", 
    "tags": [], 
    "importance": "Wishlist", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1678686", 
    "owner": "https://api.launchpad.net/1.0/~sean-mccully", 
    "id": 1678686, 
    "index": 3133, 
    "openned": "2017-04-03 02:24:54.643501+00:00", 
    "created": "2017-04-03 02:12:02.174624+00:00", 
    "title": "keystoneauth doesn't use a default cafile", 
    "comments": [
        {
            "content": "KeystoneAuth doens't use a default cafile, this causes problems when generating a local CA or self signed CA with HTTPS enabled endpoints. Even though the CA can be installed locally, keystone auth will still fail ssl verification. \n\n\n=================\n2017-04-03 00:54:49.305 545 DEBUG oslo_messaging._drivers.amqpdriver [-] received reply msg_id: bb9ce702f5864adf8e4720d2304fcb2a __call__ /usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py:346\n2017-04-03 00:54:49.337 545 DEBUG cinderclient.v2.client [req-7cb00c0e-be3d-4e25-b369-fd8aecbae803 7106629bf3b440a79030d327abd0747e 2aeed525cd4e4f329b0567be30d3aa6c - default default] REQ: curl -g -i -X GET https://openstack.local.net:8776/v2/2aeed525cd4e4f329b0567be30d3aa6c/volumes/ef828539-027c-4daa-9c96-19d2f3cd51e3 -H \"X-Service-Token: {SHA1}77aedd00ae7642ecf44c452749b8b3ed6f45330d\" -H \"User-Agent: python-cinderclient\" -H \"Accept: application/json\" -H \"X-Auth-Token: {SHA1}a91d7c21ef9f2401ffbe691355000e7bcc9d390c\" _http_log_request /usr/lib/python2.7/site-packages/keystoneauth1/session.py:347\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions [req-7cb00c0e-be3d-4e25-b369-fd8aecbae803 7106629bf3b440a79030d327abd0747e 2aeed525cd4e4f329b0567be30d3aa6c - default default] Unexpected exception in API method\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/volumes.py\", line 338, in create\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     volume_id, device)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 204, in inner\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return function(self, context, instance, *args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 152, in inner\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return f(self, context, instance, *args, **kw)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 3772, in attach_volume\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     disk_bus, device_type)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 3715, in _attach_volume\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     volume_bdm.destroy()\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     self.force_reraise()\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 3711, in _attach_volume\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     self._check_attach_and_reserve_volume(context, volume_id, instance)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 3693, in _check_attach_and_reserve_volume\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     volume = self.volume_api.get(context, volume_id)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 177, in wrapper\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     _reraise(exception.CinderConnectionFailed(reason=err_msg))\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 231, in _reraise\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     six.reraise(type(desired_exc), desired_exc, sys.exc_info()[2])\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 173, in wrapper\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     res = method(self, ctx, *args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 195, in wrapper\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     res = method(self, ctx, volume_id, *args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/nova/volume/cinder.py\", line 239, in get\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     item = cinderclient(context).volumes.get(volume_id)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/v2/volumes.py\", line 277, in get\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return self._get(\"/volumes/%s\" % volume_id, \"volume\")\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/base.py\", line 314, in _get\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     resp, body = self.api.client.get(url)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/client.py\", line 171, in get\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return self._cs_request(url, 'GET', **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/client.py\", line 162, in _cs_request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return self.request(url, method, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/cinderclient/client.py\", line 148, in request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/keystoneauth1/adapter.py\", line 380, in request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     resp = super(LegacyJsonAdapter, self).request(*args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/keystoneauth1/adapter.py\", line 148, in request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return self.session.request(url, method, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/positional/__init__.py\", line 101, in inner\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     return wrapped(*args, **kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 616, in request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     resp = send(**kwargs)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 678, in _send_request\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions     raise exceptions.SSLError(msg)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions CinderConnectionFailed: Connection to cinder host failed: SSL exception connecting to https://openstack.local.nunet.net:8776/v2/2aeed525cd4e4f329b0567be30d3aa6c/volumes/ef828539-027c-4daa-9c96-19d2f3cd51e3: (\"bad handshake: Error([('SSL routines', 'SSL3_GET_SERVER_CERTIFICATE', 'certificate verify failed')],)\",)\n2017-04-03 00:54:49.442 545 ERROR nova.api.openstack.extensions\n\n====================", 
            "date_created": "2017-04-03 02:12:02.174624+00:00", 
            "author": "https://api.launchpad.net/1.0/~sean-mccully"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/452585", 
            "date_created": "2017-04-03 02:22:01.710085+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Is it worthwhile to consider finding openssl's default paths if the current proposed method not available? \n\nOr just not provide this if it isn't available?\n\nhttps://docs.python.org/2/library/ssl.html#ssl.SSLContext.set_default_verify_paths", 
            "date_created": "2017-04-03 14:53:17.084184+00:00", 
            "author": "https://api.launchpad.net/1.0/~sean-mccully"
        }, 
        {
            "content": "Sean, well, you could get them with:\n\nimport ssl\nssl.get_default_verify_paths().openssl_cafile\n\nas opposed to using the set_.* function.\n\nCurrently, the default CA bundle is the same as the one for python-requests, since it's what keystoneauth's session uses. And it's using some default already: http://docs.python-requests.org/en/master/user/advanced/#ca-certificates\n\nSo you might want to discuss this in the mailing list, since this might change the behavior of a LOT of OpenStack services, since most use keystoneauth's sessions.", 
            "date_created": "2017-04-06 06:37:41.560435+00:00", 
            "author": "https://api.launchpad.net/1.0/~juan-osorio-robles"
        }, 
        {
            "content": "Juan et al,\n\nRight so \"python-requests\" bundles Mozilla CA Bundle, but this creates a problem when working with a CA not in Mozilla's default Bundle (i.e. self created CA). \n\nThe current method of passing the cabundle via config options works well until it's not being used. Which is the result of this bug, proposed solution changes the CA Bundle to be used by default to the system CA bundle which is where any CA not in Mozilla's default CA would be stored. This alleviates the need for requiring os-cacert to be passed via every requests. Which is troublesome since this auth library is used so frequently. Which the problem as I see it, is that this alleviates the need to constantly fight these types of bugs every time they creep up. \n\nPython's SSL library calls libssl to get the default path (at compile time) for the CA bundle. If this is not available or not accurate it will search through several well known locations for a CABundle cert or file system path. This covers the major distro and uses cases where this software is intended to run. \n\nFinally it will fallback to the Mozilla CA Bundle used by requests when being run on Client Machines (OS X, Windows, etc.) or some unknown OS.\n\n", 
            "date_created": "2017-04-09 17:09:11.468198+00:00", 
            "author": "https://api.launchpad.net/1.0/~sean-mccully"
        }, 
        {
            "content": "Automatically unassigning due to inactivity.", 
            "date_created": "2017-08-02 20:49:34.852521+00:00", 
            "author": "https://api.launchpad.net/1.0/~lbragstad"
        }
    ], 
    "closed": "2017-04-10 14:01:29.500959+00:00"
}