{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:00:06.758975+00:00", 
    "description": "Right now, when we overrun a quota, we get an ugly stack trace in (at least) nova-api's log:\n\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack Traceback (most recent call last):\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 119, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 545, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 917, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     content_type, body, accept)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 976, in _process_stack\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 1057, in dispatch\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 1248, in _action_resize\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return self._resize(req, id, flavor_ref, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 1113, in _resize\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     self.compute_api.resize(context, instance, flavor_id, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 198, in wrapped\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 188, in inner\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return function(self, context, instance, *args, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 215, in _wrapped\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return fn(self, context, instance, *args, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 169, in inner\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return f(self, context, instance, *args, **kw)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 2304, in resize\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     resource=resource)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack TooManyInstances: Quota exceeded for ram: Requested 51137, but already used 128 of 51200 ram\n\n\nSee this example for more:\n\nhttp://logs.openstack.org/23/49623/3/check/check-tempest-devstack-vm-full/b0d348a/logs/screen-n-api.txt.gz?level=TRACE\n\n\nThis happens a lot, clearly multiple times per every tempest run:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJAbWVzc2FnZTpcIlRvb01hbnlJbnN0YW5jZXM6IFF1b3RhIGV4Y2VlZGVkIGZvciByYW1cIiIsImZpZWxkcyI6W10sIm9mZnNldCI6MCwidGltZWZyYW1lIjoiODY0MDAiLCJncmFwaG1vZGUiOiJjb3VudCIsInRpbWUiOnsidXNlcl9pbnRlcnZhbCI6MH0sInN0YW1wIjoxMzgwOTA5MzQ3MjQ3fQ==", 
    "tags": [
        "api", 
        "testing"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1235389", 
    "owner": "https://api.launchpad.net/1.0/~jichenjc", 
    "id": 1235389, 
    "index": 1016, 
    "openned": "2013-10-04 18:05:12.519666+00:00", 
    "created": "2013-10-04 18:05:12.519666+00:00", 
    "title": "Quota violations should not cause a stacktrace in the logs", 
    "comments": [
        {
            "content": "Right now, when we overrun a quota, we get an ugly stack trace in (at least) nova-api's log:\n\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack Traceback (most recent call last):\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/__init__.py\", line 119, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return req.get_response(self.application)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1296, in send\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     application, catch_exc_info=False)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/request.py\", line 1260, in call_application\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/python-keystoneclient/keystoneclient/middleware/auth_token.py\", line 545, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return self.app(env, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/lib/python2.7/dist-packages/routes/middleware.py\", line 131, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 144, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return resp(environ, start_response)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 130, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/usr/local/lib/python2.7/dist-packages/webob/dec.py\", line 195, in call_func\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 917, in __call__\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     content_type, body, accept)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 976, in _process_stack\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/wsgi.py\", line 1057, in dispatch\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return method(req=request, **action_args)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 1248, in _action_resize\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return self._resize(req, id, flavor_ref, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/api/openstack/compute/servers.py\", line 1113, in _resize\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     self.compute_api.resize(context, instance, flavor_id, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 198, in wrapped\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 188, in inner\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return function(self, context, instance, *args, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 215, in _wrapped\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return fn(self, context, instance, *args, **kwargs)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 169, in inner\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     return f(self, context, instance, *args, **kw)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack   File \"/opt/stack/new/nova/nova/compute/api.py\", line 2304, in resize\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack     resource=resource)\n2013-10-04 16:23:43.711 24241 TRACE nova.api.openstack TooManyInstances: Quota exceeded for ram: Requested 51137, but already used 128 of 51200 ram\n\n\nSee this example for more:\n\nhttp://logs.openstack.org/23/49623/3/check/check-tempest-devstack-vm-full/b0d348a/logs/screen-n-api.txt.gz?level=TRACE\n\n\nThis happens a lot, clearly multiple times per every tempest run:\n\nhttp://logstash.openstack.org/#eyJzZWFyY2giOiJAbWVzc2FnZTpcIlRvb01hbnlJbnN0YW5jZXM6IFF1b3RhIGV4Y2VlZGVkIGZvciByYW1cIiIsImZpZWxkcyI6W10sIm9mZnNldCI6MCwidGltZWZyYW1lIjoiODY0MDAiLCJncmFwaG1vZGUiOiJjb3VudCIsInRpbWUiOnsidXNlcl9pbnRlcnZhbCI6MH0sInN0YW1wIjoxMzgwOTA5MzQ3MjQ3fQ==", 
            "date_created": "2013-10-04 18:05:12.519666+00:00", 
            "author": "https://api.launchpad.net/1.0/~danms"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/60438", 
            "date_created": "2013-12-06 07:47:06.199255+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/60438\nCommitted: http://github.com/openstack/nova/commit/a7885385fb34f7040684343deed040d302dbbfea\nSubmitter: Jenkins\nBranch:    master\n\ncommit a7885385fb34f7040684343deed040d302dbbfea\nAuthor: jichen <email address hidden>\nDate:   Fri Dec 6 10:29:51 2013 -0500\n\n    Quota violations should not cause a stacktrace in the logs\n    \n    Don't show exception logs in api log for resize operations\n    if the resize operations lead to quota violations\n    \n    Change-Id: Ia101c599908c7652cc07fa4c7e7f1b057943e031\n    Closes-Bug: #1235389\n", 
            "date_created": "2013-12-10 18:54:51.258412+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-01-22 16:16:48.735275+00:00"
}