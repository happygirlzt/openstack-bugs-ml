{
    "status": "In Progress", 
    "last_updated": "2017-06-27 15:58:31.893953+00:00", 
    "description": "Description\n===========\n\nWhen an instance task state is RESIZE_MIGRATED or RESIZE_FINISH, delete the instance will hint an error,\nI found some problems with the code, because my flavor contains vram and instance at a special task state, a TypeError or an  AttributeError will throw out.\n\nDelete when instance at resize_migrated task state, AttributeError will throw out.\nDelete when instance at resize_finish task state, TypeError will throw out.\n\nSteps to reproduce\n==================\n1.create an instance use flavor1,names server1\n2.resize it but not resize confirm.\n3.delete the instance quickly.\n4.you can run \" nova resize service1 flavor2 && sleep 2.0 && nova delete server1 \".\n\nJust delete the instance quickly\n\nWhen resize an instance, its task state will go through None => resize_migrating => resize_migrated => resize_finish => None, the purpose of sleep is to catch the target state\uff0cresize_migrated or resize_finish.\n\nEnvironment\n===========\n\nRDO Newton\nDevStack (master=pike)\n\nLogs & Configs\n==============\n\n\u00a0Traceback (most recent call last):\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n\u00a0\u00a0\u00a0\u00a0\u00a0return f(*args, **kwargs)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py\", line 914, in delete\n\u00a0\u00a0\u00a0\u00a0\u00a0self._delete(req.environ['nova.context'], req, id)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py\", line 768, in _delete\n\u00a0\u00a0\u00a0\u00a0\u00a0self.compute_api.delete(context, instance)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 166, in inner\n\u00a0\u00a0\u00a0\u00a0\u00a0return function(self, context, instance, *args, **kwargs)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 173, in _wrapped\n\u00a0\u00a0\u00a0\u00a0\u00a0return fn(self, context, instance, *args, **kwargs)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 147, in inner\n\u00a0\u00a0\u00a0\u00a0\u00a0return f(self, context, instance, *args, **kw)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2048, in delete\n\u00a0\u00a0\u00a0\u00a0\u00a0self._delete_instance(context, instance)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2039, in _delete_instance\n\u00a0\u00a0\u00a0\u00a0\u00a0task_state=task_states.DELETING)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1815, in _delete\n\u00a0\u00a0\u00a0\u00a0\u00a0quotas.rollback()\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n\u00a0\u00a0\u00a0\u00a0\u00a0self.force_reraise()\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n\u00a0\u00a0\u00a0\u00a0\u00a0six.reraise(self.type_, self.value, self.tb)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1735, in _delete\n\u00a0\u00a0\u00a0\u00a0\u00a0project_id, user_id)\n\u00a0\u00a0\u00a0File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1878, in _create_reservations\n\u00a0\u00a0\u00a0\u00a0\u00a0instance_memory_mb = old_flavor.memory_mb + vram_mb\n\u00a0TypeError: unsupported operand type(s) for +: 'int' and 'unicode'\n\n\nOR\n\n\n\nTraceback (most recent call last):\n   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n     return f(*args, **kwargs)\n   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py\", line 914, in delete\n     self._delete(req.environ['nova.context'], req, id)\n   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py\", line 768, in _delete\n     self.compute_api.delete(context, instance)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 166, in inner\n     return function(self, context, instance, *args, **kwargs)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 173, in _wrapped\n     return fn(self, context, instance, *args, **kwargs)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 147, in inner\n     return f(self, context, instance, *args, **kw)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2048, in delete\n     self._delete_instance(context, instance)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2039, in _delete_instance\n     task_state=task_states.DELETING)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1815, in _delete\n     quotas.rollback()\n   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n     self.force_reraise()\n   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n     six.reraise(self.type_, self.value, self.tb)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1735, in _delete\n     project_id, user_id)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1876, in _create_reservations\n     instance_vcpus = old_flavor.vcpus\n AttributeError: 'NoneType' object has no attribute 'vcpus'", 
    "tags": [
        "compute", 
        "openstack-version.newton"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1689289", 
    "owner": "https://api.launchpad.net/1.0/~falseuser", 
    "id": 1689289, 
    "index": 8109, 
    "openned": "2017-05-08 12:02:33.180769+00:00", 
    "created": "2017-05-08 12:02:33.180769+00:00", 
    "title": "can not delete an instance when resizing", 
    "comments": [
        {
            "content": "Description\n===========\n\nWhen an instance task state is RESIZE_MIGRATED or RESIZE_FINISH, delete the instance will hint an error,\nI found some problems with the code, because my flavor contains vram, a TypeError Thrown out.\n\n\nSteps to reproduce\n==================\n1.create an instance use flavor1,names server1\n2.resize it but not resize confirm.\n3.delete the instance quickly.\n4.you can run \" nova resize service1 flavor2 && sleep 2.0 && nova delete server1 \".\n\nJust delete the instance quickly\n\nWhen resize an instance, its task state will go through None => resize_migrating => resize_migrated => resize_finish => None, the purpose of sleep is to catch the target state\uff0cresize_migrated or resize_finish.\n\nEnvironment\n===========\n\nRDO Newton\n\nLogs & Configs\n==============\n\n Traceback (most recent call last):\n   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/extensions.py\", line 338, in wrapped\n     return f(*args, **kwargs)\n   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py\", line 914, in delete\n     self._delete(req.environ['nova.context'], req, id)\n   File \"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py\", line 768, in _delete\n     self.compute_api.delete(context, instance)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 166, in inner\n     return function(self, context, instance, *args, **kwargs)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 173, in _wrapped\n     return fn(self, context, instance, *args, **kwargs)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 147, in inner\n     return f(self, context, instance, *args, **kw)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2048, in delete\n     self._delete_instance(context, instance)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 2039, in _delete_instance\n     task_state=task_states.DELETING)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1815, in _delete\n     quotas.rollback()\n   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n     self.force_reraise()\n   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n     six.reraise(self.type_, self.value, self.tb)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1735, in _delete\n     project_id, user_id)\n   File \"/usr/lib/python2.7/site-packages/nova/compute/api.py\", line 1878, in _create_reservations\n     instance_memory_mb = old_flavor.memory_mb + vram_mb\n TypeError: unsupported operand type(s) for +: 'int' and 'unicode'", 
            "date_created": "2017-05-08 12:02:33.180769+00:00", 
            "author": "https://api.launchpad.net/1.0/~falseuser"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/463466", 
            "date_created": "2017-05-09 05:41:17.646325+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Automatically discovered version newton in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 15:58:30.206321+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}