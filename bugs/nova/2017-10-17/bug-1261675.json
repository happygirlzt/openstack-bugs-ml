{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:03:06.857823+00:00", 
    "description": "When creating a snapshot from a VM instance, following error appears in Nova compute log:\n\n 2013-12-17 10:39:47.943 28210 ERROR nova.openstack.common.rpc.amqp [req-3a82cad9-3213-47e8-8a42-0f6e2a75008a a2eecc1caf5f40c5ab50405b68730c20 e255029e4a614ed1a5412192db588e74] Exception during message handling\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 353, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 90, in wrapped\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 73, in wrapped\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 243, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     pass\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 229, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 271, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 258, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 319, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     % image_id, instance=instance)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 309, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     *args, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2293, in snapshot_instance\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     task_states.IMAGE_SNAPSHOT)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2324, in _snapshot_instance\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     update_task_state)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1399, in snapshot\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     snapshot_backend.snapshot_extract(out_path, image_format)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 531, in snapshot_extract\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     images.convert_image(snap, target, out_format)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/images.py\", line 179, in convert_image\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     utils.execute(*cmd, run_as_root=run_as_root)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 177, in execute\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return processutils.execute(*cmd, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py\", line 178, in execute\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     cmd=' '.join(cmd))\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Command: qemu-img convert -O qcow2 rbd:instances/instance-0000000f_disk /var/lib/nova/instances/snapshots/tmp63tXq0/b916d3ca7fbe46cba4ca7ce5e0138ee9\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Exit code: 1\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Stdout: ''\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Stderr: \"qemu-img: error connecting\\nqemu-img: Could not open 'rbd:instances/instance-0000000f_disk': Operation not supported\\nqemu-img: Could not open 'rbd:instances/instance-0000000f_disk'\\n\"", 
    "tags": [
        "rbd", 
        "snapshot"
    ], 
    "importance": "Undecided", 
    "heat": 28, 
    "link": "https://bugs.launchpad.net/nova/+bug/1261675", 
    "owner": "https://api.launchpad.net/1.0/~pavel-kirpichyov", 
    "id": 1261675, 
    "index": 5657, 
    "openned": "2013-12-17 09:57:32.738458+00:00", 
    "created": "2013-12-17 09:57:32.738458+00:00", 
    "title": "Unable to snapshot an instance with ephemeral RBD", 
    "comments": [
        {
            "content": "When creating a snapshot from a VM instance, following error appears in Nova compute log:\n\n 2013-12-17 10:39:47.943 28210 ERROR nova.openstack.common.rpc.amqp [req-3a82cad9-3213-47e8-8a42-0f6e2a75008a a2eecc1caf5f40c5ab50405b68730c20 e255029e4a614ed1a5412192db588e74] Exception during message handling\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 353, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 90, in wrapped\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 73, in wrapped\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 243, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     pass\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 229, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 271, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 258, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 319, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     % image_id, instance=instance)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 309, in decorated_function\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     *args, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2293, in snapshot_instance\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     task_states.IMAGE_SNAPSHOT)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2324, in _snapshot_instance\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     update_task_state)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1399, in snapshot\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     snapshot_backend.snapshot_extract(out_path, image_format)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/imagebackend.py\", line 531, in snapshot_extract\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     images.convert_image(snap, target, out_format)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/images.py\", line 179, in convert_image\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     utils.execute(*cmd, run_as_root=run_as_root)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 177, in execute\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     return processutils.execute(*cmd, **kwargs)\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/processutils.py\", line 178, in execute\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp     cmd=' '.join(cmd))\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp ProcessExecutionError: Unexpected error while running command.\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Command: qemu-img convert -O qcow2 rbd:instances/instance-0000000f_disk /var/lib/nova/instances/snapshots/tmp63tXq0/b916d3ca7fbe46cba4ca7ce5e0138ee9\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Exit code: 1\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Stdout: ''\n2013-12-17 10:39:47.943 28210 TRACE nova.openstack.common.rpc.amqp Stderr: \"qemu-img: error connecting\\nqemu-img: Could not open 'rbd:instances/instance-0000000f_disk': Operation not supported\\nqemu-img: Could not open 'rbd:instances/instance-0000000f_disk'\\n\"", 
            "date_created": "2013-12-17 09:57:32.738458+00:00", 
            "author": "https://api.launchpad.net/1.0/~pavel-kirpichyov"
        }, 
        {
            "content": "https://review.openstack.org/#/c/62592", 
            "date_created": "2013-12-17 11:49:04.193815+00:00", 
            "author": "https://api.launchpad.net/1.0/~pavel-kirpichyov"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/62592\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9e7e8daa66f0c05ac7ce3927562d246baf70067f\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9e7e8daa66f0c05ac7ce3927562d246baf70067f\nAuthor: Pavel Kirpichyov <email address hidden>\nDate:   Tue Dec 17 13:47:57 2013 +0200\n\n    Pass rbd_user id and conf path  as part of RBD URI for qemu-img\n    \n    Unlike rados.py, qemu-img does not use id from CEPH_ARGS and has to be\n    given a ceph user id and conf path explicitly in RBD URI\n    \n    Closes-Bug: #1261675\n    Change-Id: I9226515f2a860ed45d12012fd5b6bc7e842f6d32\n", 
            "date_created": "2014-01-17 15:35:03.519164+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-01-22 16:20:58.508004+00:00"
}