{
    "status": "Won't Fix", 
    "last_updated": "2015-08-20 13:37:46.697852+00:00", 
    "description": "In an environment with more than one hypervisor type including QEMU and\ndocker, when creating a container server, the request can be wrongly\nscheduled to a QEMU hypervisor.\n\nI test it in Juno and there is the same bug in Kilo.\n\nFor example,  there is two compute node, one hypervisor is docker (node A-172), anther one hypervisor is QEMU(node B-168).\n\nI can create a docker server which uses docker image \"tutum/wordpress\" in a QEMU node(node B-168).\nIn this case it ignores the parameter \u201cimage\" whether is match the hypervisor type, finally this server\nboot failed with \"no bootable device\".\n\nI'm not sure is there any other parameter for QEMU,  docker and Xen hypervisor should check.\n\nMy step is following:\n\n[root@ ~(keystone_admin)]# glance image-show tutum/wordpress\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | bab44a59a74878dd953c4ae5242f7c7c     |\n| container_format | docker                               |\n| created_at       | 2015-02-02T07:00:47                  |\n| deleted          | False                                |\n| disk_format      | raw                                  |\n| id               | b8e12702-3fd1-4847-b018-ac8ba6edead7 |\n| is_public        | True                                 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | tutum/wordpress                      |\n| owner            | 09291698b9ff44728493252e67fc6ee5     |\n| protected        | False                                |\n| size             | 517639680                            |\n| status           | active                               |\n| updated_at       | 2015-02-02T07:02:15                  |\n+------------------+--------------------------------------+\n\n[root@ ~(keystone_admin)]# nova boot --flavor 2 --image tutum/wordpress --key-name key1 --nic net-id=2510a249-1665-4184-afc8-62a2eccf6c3b --availability-zone xxx:B-168 test-image-168\n\n2015-03-02 01:55:12.239 2857 WARNING nova.virt.disk.vfs.guestfs [-] Failed to close augeas aug_close: do_aug_close: y\nou must call 'aug-init' first to initialize Augeas\n2015-03-02 01:55:12.274 2857 DEBUG nova.virt.disk.api [-] Unable to mount image /var/lib/nova/instances/e799cc70-2e9f\n-44da-9ebd-0f55ddc7cd13/disk with error Error mounting /var/lib/nova/instances/e799cc70-2e9f-44da-9ebd-0f55ddc7cd13/d\nisk with libguestfs (mount_options: /dev/sda on / (options: ''): mount: /dev/sda is write-protected, mounting read-on\nly\nmount: unknown filesystem type '(null)'). Cannot resize. is_image_partitionless /usr/lib/python2.7/site-packages/nova\n/virt/disk/api.py:218\n\n2015-03-02 01:55:12.276 2857 DEBUG nova.virt.libvirt.driver [-] [instance: e799cc70-2e9f-44da-9ebd-0f55ddc7cd13] Star\nt _get_guest_xml network_info=[VIF({'profile': {}, 'ovs_interfaceid': u'563e9d58-9d41-4700-b4f2-a56a6ecfcefe', 'netwo\nrk': Network({'bridge': 'br-int', 'subnets': [Subnet({'ips': [FixedIP({'meta': {}, 'version': 4, 'type': 'fixed', 'fl\noating_ips': [], 'address': u'10.0.0.45'})], 'version': 4, 'meta': {'dhcp_server': u'10.0.0.3'}, 'dns': [], 'routes':\n\u00a0[], 'cidr': u'10.0.0.0/24', 'gateway': IP({'meta': {}, 'version': 4, 'type': 'gateway', 'address': u'10.0.0.1'})})],\n\u00a0'meta': {'injected': False, 'tenant_id': u'3cf2410b5f554653a93796982657984b'}, 'id': u'2510a249-1665-4184-afc8-62a2e\nccf6c3b', 'label': u'private'}), 'devname': u'tap563e9d58-9d', 'vnic_type': u'normal', 'qbh_params': None, 'meta': {}\n, 'details': {u'port_filter': True, u'ovs_hybrid_plug': True}, 'address': u'fa:16:3e:d9:b3:1f', 'active': False, 'typ\ne': u'ovs', 'id': u'563e9d58-9d41-4700-b4f2-a56a6ecfcefe', 'qbg_params': None})] disk_info={'disk_bus': 'virtio', 'cd\nrom_bus': 'ide', 'mapping': {'disk': {'bus': 'virtio', 'boot_index': '1', 'type': 'disk', 'dev': u'vda'}, 'root': {'b\nus': 'virtio', 'boot_index': '1', 'type': 'disk', 'dev': u'vda'}}} image_meta={u'status': u'active', u'deleted': Fals\ne, u'container_format': u'docker', u'min_ram': 0, u'updated_at': u'2015-02-02T07:02:15.000000', u'min_disk': 0, u'own\ner': u'09291698b9ff44728493252e67fc6ee5', u'is_public': True, u'deleted_at': None, u'properties': {}, u'size': 517639\n680, u'name': u'tutum/wordpress', u'checksum': u'bab44a59a74878dd953c4ae5242f7c7c', u'created_at': u'2015-02-02T07:00\n:47.000000', u'disk_format': u'raw', u'id': u'b8e12702-3fd1-4847-b018-ac8ba6edead7'} rescue=None block_device_info={'\nblock_device_mapping': [], 'root_device_name': u'/dev/vda', 'ephemerals': [], 'swap': None} _get_guest_xml /usr/lib/p\nython2.7/site-packages/nova/virt/libvirt/driver.py:4147\n\n2015-03-02 01:55:17.616 2857 DEBUG nova.compute.manager [-] [instance: e799cc70-2e9f-44da-9ebd-0f55ddc7cd13] Checking\n\u00a0state _get_power_state /usr/lib/python2.7/site-packages/nova/compute/manager.py:1156", 
    "tags": [
        "juno-backport-potential"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1427098", 
    "owner": "None", 
    "id": 1427098, 
    "index": 6720, 
    "openned": "2015-03-02 08:02:44.801745+00:00", 
    "created": "2015-03-02 08:02:44.801745+00:00", 
    "title": "Container servers are wrongly scheduled to non-docker hypervisor", 
    "comments": [
        {
            "content": "I'm test create server in Juno RDO environment, and I check the code of Kilo version.\n\nIn a environment with different hypervisor, such as QEMU, docker and Xen etc, Create server is not check the hypervisor type with some import parameters.\n\nFor example,  there is two compute node, one hypervisor is docker (node A-172), anther one hypervisor is QEMU(node B-168).\n\nI can create a docker server which uses docker image \"tutum/wordpress\" in a QEMU node(node B-168).\nIn this case it ignores the parameter \u201cimage\" whether is match the hypervisor type, finally this server\nboot failed with \"no bootable device\".\n\nI'm not sure is there any other parameter for QEMU,  docker and Xen hypervisor should check.\n\nMy step is following:\n\n[root@ ~(keystone_admin)]# glance image-show tutum/wordpress\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | bab44a59a74878dd953c4ae5242f7c7c     |\n| container_format | docker                               |\n| created_at       | 2015-02-02T07:00:47                  |\n| deleted          | False                                |\n| disk_format      | raw                                  |\n| id               | b8e12702-3fd1-4847-b018-ac8ba6edead7 |\n| is_public        | True                                 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | tutum/wordpress                      |\n| owner            | 09291698b9ff44728493252e67fc6ee5     |\n| protected        | False                                |\n| size             | 517639680                            |\n| status           | active                               |\n| updated_at       | 2015-02-02T07:02:15                  |\n+------------------+--------------------------------------+\n\n\n[root@ ~(keystone_admin)]# nova boot --flavor 2 --image tutum/wordpress --key-name key1 --nic net-id=2510a249-1665-4184-afc8-62a2eccf6c3b --availability-zone xxx:B-168 test-image-168\n\n2015-03-02 01:55:12.239 2857 WARNING nova.virt.disk.vfs.guestfs [-] Failed to close augeas aug_close: do_aug_close: y\nou must call 'aug-init' first to initialize Augeas\n2015-03-02 01:55:12.274 2857 DEBUG nova.virt.disk.api [-] Unable to mount image /var/lib/nova/instances/e799cc70-2e9f\n-44da-9ebd-0f55ddc7cd13/disk with error Error mounting /var/lib/nova/instances/e799cc70-2e9f-44da-9ebd-0f55ddc7cd13/d\nisk with libguestfs (mount_options: /dev/sda on / (options: ''): mount: /dev/sda is write-protected, mounting read-on\nly\nmount: unknown filesystem type '(null)'). Cannot resize. is_image_partitionless /usr/lib/python2.7/site-packages/nova\n/virt/disk/api.py:218\n\n2015-03-02 01:55:12.276 2857 DEBUG nova.virt.libvirt.driver [-] [instance: e799cc70-2e9f-44da-9ebd-0f55ddc7cd13] Star\nt _get_guest_xml network_info=[VIF({'profile': {}, 'ovs_interfaceid': u'563e9d58-9d41-4700-b4f2-a56a6ecfcefe', 'netwo\nrk': Network({'bridge': 'br-int', 'subnets': [Subnet({'ips': [FixedIP({'meta': {}, 'version': 4, 'type': 'fixed', 'fl\noating_ips': [], 'address': u'10.0.0.45'})], 'version': 4, 'meta': {'dhcp_server': u'10.0.0.3'}, 'dns': [], 'routes':\n [], 'cidr': u'10.0.0.0/24', 'gateway': IP({'meta': {}, 'version': 4, 'type': 'gateway', 'address': u'10.0.0.1'})})],\n 'meta': {'injected': False, 'tenant_id': u'3cf2410b5f554653a93796982657984b'}, 'id': u'2510a249-1665-4184-afc8-62a2e\nccf6c3b', 'label': u'private'}), 'devname': u'tap563e9d58-9d', 'vnic_type': u'normal', 'qbh_params': None, 'meta': {}\n, 'details': {u'port_filter': True, u'ovs_hybrid_plug': True}, 'address': u'fa:16:3e:d9:b3:1f', 'active': False, 'typ\ne': u'ovs', 'id': u'563e9d58-9d41-4700-b4f2-a56a6ecfcefe', 'qbg_params': None})] disk_info={'disk_bus': 'virtio', 'cd\nrom_bus': 'ide', 'mapping': {'disk': {'bus': 'virtio', 'boot_index': '1', 'type': 'disk', 'dev': u'vda'}, 'root': {'b\nus': 'virtio', 'boot_index': '1', 'type': 'disk', 'dev': u'vda'}}} image_meta={u'status': u'active', u'deleted': Fals\ne, u'container_format': u'docker', u'min_ram': 0, u'updated_at': u'2015-02-02T07:02:15.000000', u'min_disk': 0, u'own\ner': u'09291698b9ff44728493252e67fc6ee5', u'is_public': True, u'deleted_at': None, u'properties': {}, u'size': 517639\n680, u'name': u'tutum/wordpress', u'checksum': u'bab44a59a74878dd953c4ae5242f7c7c', u'created_at': u'2015-02-02T07:00\n:47.000000', u'disk_format': u'raw', u'id': u'b8e12702-3fd1-4847-b018-ac8ba6edead7'} rescue=None block_device_info={'\nblock_device_mapping': [], 'root_device_name': u'/dev/vda', 'ephemerals': [], 'swap': None} _get_guest_xml /usr/lib/p\nython2.7/site-packages/nova/virt/libvirt/driver.py:4147\n\n2015-03-02 01:55:17.616 2857 DEBUG nova.compute.manager [-] [instance: e799cc70-2e9f-44da-9ebd-0f55ddc7cd13] Checking\n state _get_power_state /usr/lib/python2.7/site-packages/nova/compute/manager.py:1156", 
            "date_created": "2015-03-02 08:02:44.801745+00:00", 
            "author": "https://api.launchpad.net/1.0/~hs-chen"
        }, 
        {
            "content": "Addressed by: https://review.openstack.org/161566\n    create container servers ignore container_format whether match hypervisor", 
            "date_created": "2015-03-05 06:59:45.100249+00:00", 
            "author": "https://api.launchpad.net/1.0/~hs-chen"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/163260", 
            "date_created": "2015-03-11 02:04:58.494735+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Matt Riedemann (<email address hidden>) on branch: stable/juno\nReview: https://review.openstack.org/161566\nReason: This should be proposed to master if at all.  No response from the author in months so dropping it.", 
            "date_created": "2015-08-05 21:37:44.421618+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "docker is not in the nova tree any more, so this is no longer in scope for nova.", 
            "date_created": "2015-08-20 13:37:06.768092+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Change abandoned by John Garbutt (<email address hidden>) on branch: master\nReview: https://review.openstack.org/163260\nReason: given docker is no longer in tree, and this patch has not been worked on recently, I am going to abandon this patch now.", 
            "date_created": "2015-08-20 13:37:46.153742+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-08-20 13:37:16.746811+00:00"
}