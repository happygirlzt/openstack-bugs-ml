{
    "status": "Invalid", 
    "last_updated": "2015-03-16 02:12:06.769835+00:00", 
    "description": "======UPDATE=============\n\nGot some more information on that problem:\nWhat happened was something like this, not entirely sure about all sequences:\n- create VM1 from image, do something with VM1, create snapshot of VM1\n- create VM2 from snapshot, stop VM1, do something with VM2, create snapshot of VM2\n- create VM3 from snapshot, stop VM2, delete snapshot of VM2\n\nSo the situation was this: There's a VM created from a snapshot and the snapshot image was deleted. Creating a snapshot in that situation was impossible and resulted in the stacktrace\n\n\n=======ORIGINAL=============\n\n\nI've got an Openstack setup with one controller node (glance, keystone, horizon, nova-* (except nova-compute)) and three compute nodes. I wanted to create a snapshot of a vm running on one of the compute nodes, by using the option in the horizon dashboard.\n\nWhat happens is that the snapshot gets listed as a snapshot, but with the status queued. And from there on nothing happens anymore.\n\nIn the nova-compute.log on the compute host I can see these entries:\n2012-07-25 12:45:56 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 253, in _process_data\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 183, in decorated_function\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     sys.exc_info())\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     self.gen.next()\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 177, in decorated_function\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 952, in snapshot_instance\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     self.driver.snapshot(context, instance_ref, image_id)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 714, in snapshot\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     image_file)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 306, in update\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     _reraise_translated_image_exception(image_id)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 304, in update\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     image_meta = client.update_image(image_id, image_meta, data)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/client.py\", line 195, in update_image\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     res = self.do_request(\"PUT\", \"/images/%s\" % image_id, body, headers)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 58, in wrapped\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return func(self, *args, **kwargs)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 420, in do_request\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     headers=headers)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 75, in wrapped\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return func(self, method, url, body, headers)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 547, in _do_request\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     raise exception.Invalid(res.read())\n2012-07-25 12:45:56 TRACE nova.rpc.amqp Invalid: Data supplied was not valid.\n2012-07-25 12:45:56 TRACE nova.rpc.amqp Details: 400 Bad Request\n2012-07-25 12:45:56 TRACE nova.rpc.amqp\n2012-07-25 12:45:56 TRACE nova.rpc.amqp The server could not comply with the request since it is either malformed or otherwise incorrect.\n2012-07-25 12:45:56 TRACE nova.rpc.amqp\n2012-07-25 12:45:56 TRACE nova.rpc.amqp  Failed to update image metadata. Got error: Data supplied was not valid. Details: 400 Bad Request  The server could not comply with the request since it is either malformed or otherwise incorrect.   Failed to update image metadata. Got error: Data supplied was not valid. Details: Invalid container format 'None' for image.\n\nI checked with the api.log of glance and found these entries:\n\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images] Failed to update image metadata. Got error: Data supplied was not valid.\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images] Details: 400 Bad Request\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images]\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images] The server could not comply with the request since it is either malformed or otherwise incorrect.\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images]\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images]  Failed to update image metadata. Got error: Data supplied was not valid. Details: Invalid container format 'None' for image.\n\nAny idea what's going wrong here?", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1028871", 
    "owner": "https://api.launchpad.net/1.0/~bcwaldon", 
    "id": 1028871, 
    "index": 2979, 
    "openned": "2012-08-24 00:00:46.546239+00:00", 
    "created": "2012-07-25 11:51:43.333788+00:00", 
    "title": "Snapshot not created with any container_format column", 
    "comments": [
        {
            "content": "I've got an Openstack setup with one controller node (glance, keystone, horizon, nova-* (except nova-compute)) and three compute nodes. I wanted to create a snapshot of a vm running on one of the compute nodes, by using the option in the horizon dashboard.\n\nWhat happens is that the snapshot gets listed as a snapshot, but with the status queued. And from there on nothing happens anymore.\n\nIn the nova-compute.log on the compute host I can see these entries:\n2012-07-25 12:45:56 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 253, in _process_data\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 183, in decorated_function\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     sys.exc_info())\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     self.gen.next()\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 177, in decorated_function\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return function(self, context, instance_uuid, *args, **kwargs)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 952, in snapshot_instance\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     self.driver.snapshot(context, instance_ref, image_id)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 114, in wrapped\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return f(*args, **kw)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/connection.py\", line 714, in snapshot\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     image_file)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 306, in update\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     _reraise_translated_image_exception(image_id)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/image/glance.py\", line 304, in update\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     image_meta = client.update_image(image_id, image_meta, data)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/client.py\", line 195, in update_image\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     res = self.do_request(\"PUT\", \"/images/%s\" % image_id, body, headers)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 58, in wrapped\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return func(self, *args, **kwargs)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 420, in do_request\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     headers=headers)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 75, in wrapped\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     return func(self, method, url, body, headers)\n2012-07-25 12:45:56 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/glance/common/client.py\", line 547, in _do_request\n2012-07-25 12:45:56 TRACE nova.rpc.amqp     raise exception.Invalid(res.read())\n2012-07-25 12:45:56 TRACE nova.rpc.amqp Invalid: Data supplied was not valid.\n2012-07-25 12:45:56 TRACE nova.rpc.amqp Details: 400 Bad Request\n2012-07-25 12:45:56 TRACE nova.rpc.amqp \n2012-07-25 12:45:56 TRACE nova.rpc.amqp The server could not comply with the request since it is either malformed or otherwise incorrect.\n2012-07-25 12:45:56 TRACE nova.rpc.amqp \n2012-07-25 12:45:56 TRACE nova.rpc.amqp  Failed to update image metadata. Got error: Data supplied was not valid. Details: 400 Bad Request  The server could not comply with the request since it is either malformed or otherwise incorrect.   Failed to update image metadata. Got error: Data supplied was not valid. Details: Invalid container format 'None' for image.\n\nI checked with the api.log of glance and found these entries:\n\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images] Failed to update image metadata. Got error: Data supplied was not valid.\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images] Details: 400 Bad Request\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images] \n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images] The server could not comply with the request since it is either malformed or otherwise incorrect.\n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images] \n2012-07-25 13:13:22 2371    ERROR [glance.api.v1.images]  Failed to update image metadata. Got error: Data supplied was not valid. Details: Invalid container format 'None' for image.  \n\nAny idea what's going wrong here?", 
            "date_created": "2012-07-25 11:51:43.333788+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Hi guys, this came from here: https://answers.launchpad.net/glance/+question/204133", 
            "date_created": "2012-07-25 11:52:14.799291+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "I'm not sure where that's stemming from but it deserves further investigation. In general snapshotting works, so this may be an edge case somewhere.", 
            "date_created": "2012-08-13 19:29:03.231004+00:00", 
            "author": "https://api.launchpad.net/1.0/~gabriel-hurley"
        }, 
        {
            "content": "Got some more information on that problem:\nWhat happened was something like this, not entirely sure about all sequences:\n- create VM1 from image, do something with VM1, create snapshot of VM1\n- create VM2 from snapshot, stop VM1, do something with VM2, create snapshot of VM2\n- create VM3 from snapshot, stop VM2, delete snapshot of VM2\n\nSo the situation was this: There's a VM created from a snapshot and the snapshot image was deleted. Creating a snapshot in that situation was impossible and resulted in the stacktrace", 
            "date_created": "2012-08-14 09:27:29.421850+00:00", 
            "author": "https://api.launchpad.net/1.0/~mx-chilly"
        }, 
        {
            "content": "Hmmm... I'm not certain what the appropriate fix for that is.. I'm gonna defer this to RC1 since it's quite the edge-case.", 
            "date_created": "2012-08-14 23:57:47.415590+00:00", 
            "author": "https://api.launchpad.net/1.0/~gabriel-hurley"
        }, 
        {
            "content": "I was able to reproduce this by doing the following:\r\n\r\n1. create instance A\r\n2. create snapshot A from instance A\r\n3. launch instance B from snapshot A\r\n4. delete snapshot A\r\n5. create snapshot B from instance B\r\n\r\nThis results in a queued snapshot in Glance which will never resolve and can only be deleted.\r\n\r\nHowever, I don't think this is a horizon bug, really. I presume this is just as possible through the clients, CLIs, etc. since that's all Horizon is doing. Can anyone confirm that?\r\n\r\nMoreover, does anyone have suggestions on where this should be fixed?", 
            "date_created": "2012-08-24 00:04:01.757449+00:00", 
            "author": "https://api.launchpad.net/1.0/~gabriel-hurley"
        }, 
        {
            "content": "The right way to fix this is to break the tie between Nova and Glance. When an instance is built Nova should store a copy of the necessary metadata - Nova can then refer back to that copy when a snapshot is created from that instance.", 
            "date_created": "2012-08-30 20:35:24.899850+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "There doesn't appear to be anything for Horizon to do here that isn't a kludge. Brian's suggestion sounds reasonable to me.", 
            "date_created": "2012-09-07 18:17:56.967488+00:00", 
            "author": "https://api.launchpad.net/1.0/~gabriel-hurley"
        }, 
        {
            "content": "The core of the problem is that data is going away and Nova doesn't know what the hell to do without it. This isn't a Glance bug either. I'll fix this for Nova in Grizzly.", 
            "date_created": "2012-09-11 18:33:28.003618+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "Marking this issue as invalid, as it is filed against Folsom, and has not been updated in over a year and a half. If you believe this to be in error, please update this issue.", 
            "date_created": "2014-06-05 02:19:19.782739+00:00", 
            "author": "https://api.launchpad.net/1.0/~jshepher"
        }, 
        {
            "content": "This issue still in icehouse, please update this issue as soon as possible.", 
            "date_created": "2015-03-16 02:12:05.472038+00:00", 
            "author": "https://api.launchpad.net/1.0/~aronivicki"
        }
    ], 
    "closed": "2014-06-05 02:19:29.574017+00:00"
}