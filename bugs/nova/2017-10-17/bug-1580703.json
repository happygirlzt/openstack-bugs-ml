{
    "status": "Invalid", 
    "last_updated": "2016-07-08 10:55:18.829470+00:00", 
    "description": "While trying to set up nova-compute with an Ironic driver and keystone V3 I got an error\n\"Expecting to find domain in project - the server could not comply with the request since it is either malformed or otherwise incorrect. The client is assumed to be in error\"\n\n\n/etc/nova/nova.conf\n[ironic]\napi_endpoint = http://<ip>:6385/v1\nadmin_tenant_name = <project>\nadmin_url = http://<ip>:35357/v3\nadmin_password = <pwd>\nadmin_username = <user>\n\n\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/nova/virt/ironic/client_wrapper.py\", line 143, in call\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     return self._multi_getattr(client, method)(*args, **kwargs)\n....\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/v3/base.py\", line 167, in get_auth_ref\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     authenticated=False, log=False, **rkwargs)\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 572, in post\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     return self.request(url, 'POST', **kwargs)\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/positional/__init__.py\", line 94, in inner\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     return func(*args, **kwargs)\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 467, in request\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     raise exceptions.from_response(resp, method, url)\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service BadRequest: Expecting to find domain in project - the server could not comply with the request since it is either malformed or otherwise incorrect. The client is assumed to be in error. (HTTP 400) (Request-ID: req-7548130b-6d89-4c30-b3e5-643b2155f921)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1580703", 
    "owner": "None", 
    "id": 1580703, 
    "index": 7474, 
    "openned": "2016-05-11 17:27:44.025130+00:00", 
    "created": "2016-05-11 17:27:44.025130+00:00", 
    "title": "Ironic client wrapper is unable to use keystone V3", 
    "comments": [
        {
            "content": "While trying to set up nova-compute with an Ironic driver and keystone V3 I got an error\n\"Expecting to find domain in project - the server could not comply with the request since it is either malformed or otherwise incorrect. The client is assumed to be in error\"\n\n\n/etc/nova/nova.conf\n[ironic]\napi_endpoint = http://<ip>:6385/v1\nadmin_tenant_name = <project>\nadmin_url = http://<ip>:35357/v3\nadmin_password = <pwd>\nadmin_username = <user>\n\n\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/nova/virt/ironic/client_wrapper.py\", line 143, in call\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     return self._multi_getattr(client, method)(*args, **kwargs)\n....\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/keystoneauth1/identity/v3/base.py\", line 167, in get_auth_ref\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     authenticated=False, log=False, **rkwargs)\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 572, in post\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     return self.request(url, 'POST', **kwargs)\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/positional/__init__.py\", line 94, in inner\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     return func(*args, **kwargs)\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service   File \"/usr/lib/python2.7/site-packages/keystoneauth1/session.py\", line 467, in request\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service     raise exceptions.from_response(resp, method, url)\n2016-05-11 17:20:40.529 6628 ERROR oslo_service.service BadRequest: Expecting to find domain in project - the server could not comply with the request since it is either malformed or otherwise incorrect. The client is assumed to be in error. (HTTP 400) (Request-ID: req-7548130b-6d89-4c30-b3e5-643b2155f921)", 
            "date_created": "2016-05-11 17:27:44.025130+00:00", 
            "author": "https://api.launchpad.net/1.0/~framin"
        }, 
        {
            "content": "I just needed to setup keystone v2 in an Ironic section.\n\nStill, V2 is marked as 'Deprecated' in Keystone.", 
            "date_created": "2016-05-13 00:15:41.854286+00:00", 
            "author": "https://api.launchpad.net/1.0/~framin"
        }, 
        {
            "content": "I'm running Mitaka and I also have this same issue.\nIt looks like a bug in \"nova.virt.ironic.client_wrapper\"\n\nWhen I change the ironic section to the correct Keystone v3 auth style, e.g.:\n\n------\n[ironic]\napi_endpoint=http://IRONIC_API:6385\n\nauth_url = http://CONTROLLER:35357\nauth_type = password\nproject_domain_name = default\nuser_domain_name = DOMAIN\nregion_name = RegionOne\nproject_name = service\nusername=ironic\npassword=<PASS>\n------\n\nIt gives me the following errors in the ironic-api.log:\n2016-07-07 17:08:33.789 499721 INFO keystonemiddleware.auth_token [-] Rejecting request\n2016-07-07 17:08:33.790 499721 INFO ironic_api [-] <IP> \"GET /v1/nodes/detail HTTP/1.1\" status: 401  len: 240 time: 0.0011439\n\nAnd in nova.log:\n2016-07-07 17:10:10.164 2028865 WARNING nova.virt.ironic.client_wrapper [req-64d69a49-caad-41ae-aca6-a623020154d9 - - - - -] Error contacting Ironic server for 'node.list'. Attempt 1 of 61\n2016-07-07 17:10:12.172 2028865 WARNING nova.virt.ironic.client_wrapper [req-64d69a49-caad-41ae-aca6-a623020154d9 - - - - -] Error contacting Ironic server for 'node.list'. Attempt 2 of 61\n2016-07-07 17:10:14.179 2028865 WARNING nova.virt.ironic.client_wrapper [req-64d69a49-caad-41ae-aca6-a623020154d9 - - - - -] Error contacting Ironic server for 'node.list'. Attempt 3 of 61\n2016-07-07 17:10:16.188 2028865 WARNING nova.virt.ironic.client_wrapper [req-64d69a49-caad-41ae-aca6-a623020154d9 - - - - -] Error contacting Ironic server for 'node.list'. Attempt 4 of 61\n\n\nWhen I use the CLI and authenticate by hand, I get correct results with \"ironic node-list\"\nSo my assumption is that ironc <> keystone v3 works fine.\n\nSo I tried using a token instead, grab it manually and changed the nova.conf as follows:\n----\n[ironic]\napi_endpoint=http://IRONIC_API:6385\nadmin_auth_token = <TOKEN_UUID>\nadmin_username=ironic\nadmin_password=<PASS>\nadmin_url=http://CONTROLLER:35357/v3\nadmin_tenant_name=service\n----\nIt works perfectly. \n\nHowever, without the \"admin_auth_token\" I get the following errors (exactly like sergiiF) in nova.log:\n2016-07-07 17:17:21.956 2030397 ERROR oslo_service.periodic_task BadRequest: Expecting to find domain in project - the server could not comply with the request since it is either malformed or otherwise incorrect. The client is assumed to be in error. (HTTP 400) (Request-ID: req-c629803f-56bf-42e0-89a9-758a908dda1f)\n\n\n", 
            "date_created": "2016-07-07 15:22:07.084327+00:00", 
            "author": "https://api.launchpad.net/1.0/~midekra"
        }, 
        {
            "content": "What I have for ironic section is:\n[ironic]\napi_endpoint = http://<ironic-ip>:6385/v1\nadmin_tenant_name = <tenant>\nadmin_username = <user>\nadmin_password = <password>\nadmin_url = http://<keystone-ip>:35357/v2.0\n\nI wasn't able to get it using documentation. I just set up stand alone devstack environment, and then looked through the config files.\n", 
            "date_created": "2016-07-07 20:58:24.526783+00:00", 
            "author": "https://api.launchpad.net/1.0/~framin"
        }, 
        {
            "content": "If I use the above, I'm getting the following error:\nUnauthorized: The request you have made requires authentication. (HTTP 401) (Request-ID: req-aa8e9897-07ef-4b39-a0a9-0c1be3649f3f)\n\nDid you configured keystone v2 seperately? \nI created v2 endpoints and a curl gives me:\ncurl http://CONTROLLER:35357 | python -mjson.tool\n\n{\n    \"versions\": {\n        \"values\": [\n            {\n                \"id\": \"v3.6\",\n                \"links\": [\n                    {\n                        \"href\": \"http://CONTROLLER:35357/v3/\",\n                        \"rel\": \"self\"\n                    }\n                ],\n                \"media-types\": [\n                    {\n                        \"base\": \"application/json\",\n                        \"type\": \"application/vnd.openstack.identity-v3+json\"\n                    }\n                ],\n                \"status\": \"stable\",\n                \"updated\": \"2016-04-04T00:00:00Z\"\n            },\n            {\n                \"id\": \"v2.0\",\n                \"links\": [\n                    {\n                        \"href\": \"http://CONTROLLER:35357/v2.0/\",\n                        \"rel\": \"self\"\n                    },\n                    {\n                        \"href\": \"http://docs.openstack.org/\",\n                        \"rel\": \"describedby\",\n                        \"type\": \"text/html\"\n                    }\n                ],\n                \"media-types\": [\n                    {\n                        \"base\": \"application/json\",\n                        \"type\": \"application/vnd.openstack.identity-v2.0+json\"\n                    }\n                ],\n                \"status\": \"stable\",\n                \"updated\": \"2014-04-17T00:00:00Z\"\n            }\n        ]\n    }\n}\n\nSo it seems both v2 and v3 are running.\nAre you using \"service\" as admin_tenant_name?", 
            "date_created": "2016-07-08 08:01:59.209927+00:00", 
            "author": "https://api.launchpad.net/1.0/~midekra"
        }, 
        {
            "content": "Found a workaround and posted a new bugreport:\nhttps://bugs.launchpad.net/nova/+bug/1600187", 
            "date_created": "2016-07-08 10:55:17.603200+00:00", 
            "author": "https://api.launchpad.net/1.0/~midekra"
        }
    ], 
    "closed": "2016-05-13 00:14:40.845217+00:00"
}