{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:37:26.267624+00:00", 
    "description": "Hi, from my investigation it seems that altering a table from innodb causes problems if the table has registered foreign keys. There is further information about the problem on this random blog [1].\n\nI came across the bug while working with a fresh devstack (master branch) install on a precise vm.\n\n1. http://www.xaprb.com/blog/2006/08/22/mysqls-error-1025-explained/\n\nCommand failed, please check log for more info\n2012-04-30 14:34:40 CRITICAL nova [-] (OperationalError) (1025, \"Error on rename of './nova/#sql-67f4_40' to './nova/dns_domains' (errno: 150)\") 'ALTER TABLE dns_domains Engine=InnoDB' ()\n2012-04-30 14:34:40 TRACE nova Traceback (most recent call last):\n2012-04-30 14:34:40 TRACE nova   File \"/usr/local/bin/nova-manage\", line 7, in <module>\n2012-04-30 14:34:40 TRACE nova     execfile(__file__)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1754, in <module>\n2012-04-30 14:34:40 TRACE nova     main()\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1741, in main\n2012-04-30 14:34:40 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1106, in sync\n2012-04-30 14:34:40 TRACE nova     return migration.db_sync(version)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 30, in db_sync\n2012-04-30 14:34:40 TRACE nova     return IMPL.db_sync(version=version)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 83, in db_sync\n2012-04-30 14:34:40 TRACE nova     return versioning_api.upgrade(get_engine(), repository, version)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2012-04-30 14:34:40 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2012-04-30 14:34:40 TRACE nova   File \"<string>\", line 2, in _migrate\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 39, in patched_with_engine\n2012-04-30 14:34:40 TRACE nova     return f(*a, **kw)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 366, in _migrate\n2012-04-30 14:34:40 TRACE nova     schema.runchange(ver, change, changeset.step)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 91, in runchange\n2012-04-30 14:34:40 TRACE nova     change.run(self.engine, step)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/script/py.py\", line 145, in run\n2012-04-30 14:34:40 TRACE nova     script_func(engine)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migrate_repo/versions/086_set_engine_mysql_innodb.py\", line 33, in upgrade\n2012-04-30 14:34:40 TRACE nova     migrate_engine.execute(\"ALTER TABLE dns_domains Engine=InnoDB\")\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2297, in execute\n2012-04-30 14:34:40 TRACE nova     return connection.execute(statement, *multiparams, **params)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1405, in execute\n2012-04-30 14:34:40 TRACE nova     params)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1582, in _execute_text\n2012-04-30 14:34:40 TRACE nova     statement, parameters\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1646, in _execute_context\n2012-04-30 14:34:40 TRACE nova     context)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_context\n2012-04-30 14:34:40 TRACE nova     context)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 330, in do_execute\n2012-04-30 14:34:40 TRACE nova     cursor.execute(statement, parameters)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\n2012-04-30 14:34:40 TRACE nova     self.errorhandler(self, exc, value)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n2012-04-30 14:34:40 TRACE nova     raise errorclass, errorvalue\n2012-04-30 14:34:40 TRACE nova OperationalError: (OperationalError) (1025, \"Error on rename of './nova/#sql-67f4_40' to './nova/dns_domains' (errno: 150)\") 'ALTER TABLE dns_domains Engine=InnoDB' ()\n2012-04-30 14:34:40 TRACE nova", 
    "tags": [], 
    "importance": "Low", 
    "heat": 20, 
    "link": "https://bugs.launchpad.net/nova/+bug/991672", 
    "owner": "None", 
    "id": 991672, 
    "index": 546, 
    "openned": "2012-04-30 04:46:21.304453+00:00", 
    "created": "2012-04-30 04:46:21.304453+00:00", 
    "title": "migration 86 fails when database table dns_domains is already InnoDB", 
    "comments": [
        {
            "content": "Hi, from my investigation it seems that altering a table from innodb causes problems if the table has registered foreign keys. There is further information about the problem on this random blog [1].\n\nI came across the bug while working with a fresh devstack (master branch) install on a precise vm.\n\n1. http://www.xaprb.com/blog/2006/08/22/mysqls-error-1025-explained/\n\nCommand failed, please check log for more info\n2012-04-30 14:34:40 CRITICAL nova [-] (OperationalError) (1025, \"Error on rename of './nova/#sql-67f4_40' to './nova/dns_domains' (errno: 150)\") 'ALTER TABLE dns_domains Engine=InnoDB' ()\n2012-04-30 14:34:40 TRACE nova Traceback (most recent call last):\n2012-04-30 14:34:40 TRACE nova   File \"/usr/local/bin/nova-manage\", line 7, in <module>\n2012-04-30 14:34:40 TRACE nova     execfile(__file__)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1754, in <module>\n2012-04-30 14:34:40 TRACE nova     main()\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1741, in main\n2012-04-30 14:34:40 TRACE nova     fn(*fn_args, **fn_kwargs)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/bin/nova-manage\", line 1106, in sync\n2012-04-30 14:34:40 TRACE nova     return migration.db_sync(version)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/nova/db/migration.py\", line 30, in db_sync\n2012-04-30 14:34:40 TRACE nova     return IMPL.db_sync(version=version)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 83, in db_sync\n2012-04-30 14:34:40 TRACE nova     return versioning_api.upgrade(get_engine(), repository, version)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 186, in upgrade\n2012-04-30 14:34:40 TRACE nova     return _migrate(url, repository, version, upgrade=True, err=err, **opts)\n2012-04-30 14:34:40 TRACE nova   File \"<string>\", line 2, in _migrate\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migration.py\", line 39, in patched_with_engine\n2012-04-30 14:34:40 TRACE nova     return f(*a, **kw)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/api.py\", line 366, in _migrate\n2012-04-30 14:34:40 TRACE nova     schema.runchange(ver, change, changeset.step)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/schema.py\", line 91, in runchange\n2012-04-30 14:34:40 TRACE nova     change.run(self.engine, step)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/migrate/versioning/script/py.py\", line 145, in run\n2012-04-30 14:34:40 TRACE nova     script_func(engine)\n2012-04-30 14:34:40 TRACE nova   File \"/opt/stack/nova/nova/db/sqlalchemy/migrate_repo/versions/086_set_engine_mysql_innodb.py\", line 33, in upgrade\n2012-04-30 14:34:40 TRACE nova     migrate_engine.execute(\"ALTER TABLE dns_domains Engine=InnoDB\")\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 2297, in execute\n2012-04-30 14:34:40 TRACE nova     return connection.execute(statement, *multiparams, **params)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1405, in execute\n2012-04-30 14:34:40 TRACE nova     params)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1582, in _execute_text\n2012-04-30 14:34:40 TRACE nova     statement, parameters\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1646, in _execute_context\n2012-04-30 14:34:40 TRACE nova     context)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_context\n2012-04-30 14:34:40 TRACE nova     context)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 330, in do_execute\n2012-04-30 14:34:40 TRACE nova     cursor.execute(statement, parameters)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\n2012-04-30 14:34:40 TRACE nova     self.errorhandler(self, exc, value)\n2012-04-30 14:34:40 TRACE nova   File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n2012-04-30 14:34:40 TRACE nova     raise errorclass, errorvalue\n2012-04-30 14:34:40 TRACE nova OperationalError: (OperationalError) (1025, \"Error on rename of './nova/#sql-67f4_40' to './nova/dns_domains' (errno: 150)\") 'ALTER TABLE dns_domains Engine=InnoDB' ()\n2012-04-30 14:34:40 TRACE nova", 
            "date_created": "2012-04-30 04:46:21.304453+00:00", 
            "author": "https://api.launchpad.net/1.0/~russell-sim"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/6913", 
            "date_created": "2012-04-30 04:57:20.711824+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/6913\nCommitted: http://github.com/openstack/nova/commit/5f2eab36345b2e2ac5ca72843c7dc69d35c106da\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5f2eab36345b2e2ac5ca72843c7dc69d35c106da\nAuthor: Russell Sim <email address hidden>\nDate:   Mon Apr 30 14:48:15 2012 +1000\n\n    Fix InnoDB migration bug in migrate script 86.\n    \n    Fixes bug 991672\n    \n    Only change tables that aren't already InnoDB.  Attempting to migrate\n    an InnoDB table to InnoDB will causes an obscure \"Error on rename\"\n    error if the table has foreign key relationships.\n    \n    Change-Id: I7bd5c964da851a8dd9cc0a6af3f93c07786b6781\n", 
            "date_created": "2012-04-30 21:56:35.358494+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "is it will release in folsom or already been release in essex seem like im still getting the error as per today. ", 
            "date_created": "2012-07-24 19:53:05.167369+00:00", 
            "author": "https://api.launchpad.net/1.0/~fenris"
        }, 
        {
            "content": "$ sudo nova-manage db sync\n2012-07-25 00:43:30 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.migration' from '/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/migration.pyc'> from (pid=13097) __get_backend /usr/lib/python2.7/dist-packages/nova/utils.py:658\n2012-07-25 00:43:30 WARNING nova.utils [-] /usr/lib/python2.7/dist-packages/sqlalchemy/pool.py:639: SADeprecationWarning: The 'listeners' argument to Pool (and create_engine()) is deprecated.  Use event.listen().\n  Pool.__init__(self, creator, **kw)\n\n2012-07-25 00:43:30 WARNING nova.utils [-] /usr/lib/python2.7/dist-packages/sqlalchemy/pool.py:145: SADeprecationWarning: Pool.add_listener is deprecated.  Use event.listen()\n  self.add_listener(l)", 
            "date_created": "2012-07-24 19:54:49.666090+00:00", 
            "author": "https://api.launchpad.net/1.0/~fenris"
        }, 
        {
            "content": "I am also getting the same error as Khairul Aizat. ", 
            "date_created": "2012-07-25 05:51:13.961650+00:00", 
            "author": "https://api.launchpad.net/1.0/~fawadkhaliq"
        }, 
        {
            "content": "I have also same problem and i could not find any solution..\n", 
            "date_created": "2012-08-08 07:09:41.554487+00:00", 
            "author": "https://api.launchpad.net/1.0/~shahkalpan09"
        }
    ], 
    "closed": "2012-05-23 13:12:42.120817+00:00"
}