{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:13:47.897338+00:00", 
    "description": "2014-01-29 13:53:33.676 11460 WARNING nova.virt.vmwareapi.driver [-] Task [EnterMaintenanceMode_Task] (returnval){\n   value = \"task-16575\"\n   _type = \"Task\"\n } status: error The operation is not allowed in the current state.\n2014-01-29 13:53:33.735 11460 ERROR nova.openstack.common.rpc.amqp [req-6f322278-1678-4d67-a13f-14cdf15540f8 1046177891a84835b30a1560373055bf 2d7cc2bff7f44dd8aa09c9b64108ee90] Exception during message handling\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     **args)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 90, in wrapped\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     payload)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 73, in wrapped\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 3255, in host_maintenance_mode\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return self.driver.host_maintenance_mode(host, mode)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 353, in host_maintenance_mode\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return self._host.host_maintenance_mode(host, mode)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/host.py\", line 76, in host_maintenance_mode\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     self._session._wait_for_task(host, host_task)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 898, in _wait_for_task\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     ret_val = done.wait()\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return hubs.get_hub().switch()\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return self.greenlet.switch()\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp NovaException: The operation is not allowed in the current state.\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp\n2014-01-29 13:53:33.745 11460 ERROR nova.openstack.common.rpc.common [req-6f322278-1678-4d67-a13f-14cdf15540f8 1046177891a84835b30a1560373055bf 2d7cc2bff7f44dd8aa09c9b64108ee90] Returning exception The operation is not allowed in the current state. to caller\n2014-01-29 13:53:33.746 11460 ERROR nova.openstack.common.rpc.common [req-6f322278-1678-4d67-a13f-14cdf15540f8 1046177891a84835b30a1560373055bf 2d7cc2bff7f44dd8aa09c9b64108ee90] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\\n    **args)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\\n    result = getattr(proxyobj, method)(ctxt, **kwargs)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 90, in wrapped\\n    payload)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 73, in wrapped\\n    return f(self, context, *args, **kw)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 3255, in host_maintenance_mode\\n    return self.driver.host_maintenance_mode(host, mode)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 353, in host_maintenance_mode\\n    return self._host.host_maintenance_mode(host, mode)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/host.py\", line 76, in host_maintenance_mode\\n    self._session._wait_for_task(host, host_task)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 898, in _wait_for_task\\n    ret_val = done.wait()\\n', '  File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\\n    return hubs.get_hub().switch()\\n', '  File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 177, in switch\\n    return self.greenlet.switch()\\n', 'NovaException: The operation is not allowed in the current state.\\n']\n2014-01-29 13:53:38.675 11460 WARNING nova.virt.vmwareapi.driver [-] Task [EnterMaintenanceMode_Task] (returnval){\n   value = \"task-16575\"\n   _type = \"Task\"\n } status: error The operation is not allowed in the current state.", 
    "tags": [
        "havana-backport-potential", 
        "vmware"
    ], 
    "importance": "High", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1274129", 
    "owner": "https://api.launchpad.net/1.0/~garyk", 
    "id": 1274129, 
    "index": 1381, 
    "openned": "2014-01-29 14:16:13.648271+00:00", 
    "created": "2014-01-29 14:16:13.648271+00:00", 
    "title": "host-update --maintenance enable regression for vmware VCDriver", 
    "comments": [
        {
            "content": "2014-01-29 13:53:33.676 11460 WARNING nova.virt.vmwareapi.driver [-] Task [EnterMaintenanceMode_Task] (returnval){\n   value = \"task-16575\"\n   _type = \"Task\"\n } status: error The operation is not allowed in the current state.\n2014-01-29 13:53:33.735 11460 ERROR nova.openstack.common.rpc.amqp [req-6f322278-1678-4d67-a13f-14cdf15540f8 1046177891a84835b30a1560373055bf 2d7cc2bff7f44dd8aa09c9b64108ee90] Exception during message handling\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     **args)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 90, in wrapped\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     payload)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 73, in wrapped\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 3255, in host_maintenance_mode\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return self.driver.host_maintenance_mode(host, mode)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 353, in host_maintenance_mode\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return self._host.host_maintenance_mode(host, mode)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/host.py\", line 76, in host_maintenance_mode\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     self._session._wait_for_task(host, host_task)\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 898, in _wait_for_task\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     ret_val = done.wait()\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return hubs.get_hub().switch()\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp     return self.greenlet.switch()\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp NovaException: The operation is not allowed in the current state.\n2014-01-29 13:53:33.735 11460 TRACE nova.openstack.common.rpc.amqp\n2014-01-29 13:53:33.745 11460 ERROR nova.openstack.common.rpc.common [req-6f322278-1678-4d67-a13f-14cdf15540f8 1046177891a84835b30a1560373055bf 2d7cc2bff7f44dd8aa09c9b64108ee90] Returning exception The operation is not allowed in the current state. to caller\n2014-01-29 13:53:33.746 11460 ERROR nova.openstack.common.rpc.common [req-6f322278-1678-4d67-a13f-14cdf15540f8 1046177891a84835b30a1560373055bf 2d7cc2bff7f44dd8aa09c9b64108ee90] ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\\n    **args)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\\n    result = getattr(proxyobj, method)(ctxt, **kwargs)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 90, in wrapped\\n    payload)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/exception.py\", line 73, in wrapped\\n    return f(self, context, *args, **kw)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 3255, in host_maintenance_mode\\n    return self.driver.host_maintenance_mode(host, mode)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 353, in host_maintenance_mode\\n    return self._host.host_maintenance_mode(host, mode)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/host.py\", line 76, in host_maintenance_mode\\n    self._session._wait_for_task(host, host_task)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/vmwareapi/driver.py\", line 898, in _wait_for_task\\n    ret_val = done.wait()\\n', '  File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\\n    return hubs.get_hub().switch()\\n', '  File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 177, in switch\\n    return self.greenlet.switch()\\n', 'NovaException: The operation is not allowed in the current state.\\n']\n2014-01-29 13:53:38.675 11460 WARNING nova.virt.vmwareapi.driver [-] Task [EnterMaintenanceMode_Task] (returnval){\n   value = \"task-16575\"\n   _type = \"Task\"\n } status: error The operation is not allowed in the current state.", 
            "date_created": "2014-01-29 14:16:13.648271+00:00", 
            "author": "https://api.launchpad.net/1.0/~divakar-padiyar-nandavar"
        }, 
        {
            "content": "On execution of nova host-update compute-01 --maintenance enable I see that it errors out with VMwareVCDriver and other side effect of this is that it puts the first host in the Cluster in the maintenance mode.    Better to mark this operation in VMwareVCDriver as NotImplemented to avoid this side effect until a permanent solution is added.", 
            "date_created": "2014-01-30 09:15:43.587141+00:00", 
            "author": "https://api.launchpad.net/1.0/~divakar-padiyar-nandavar"
        }, 
        {
            "content": "Hi,\nThe problem occurs when there is more than one host in the cluster\nThanks\nGary", 
            "date_created": "2014-02-09 14:14:24.287696+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "These operations are unable to supported with the cluster. Following your suggestion they will be NotImplemented. The work around would be for the administrator to set them accordingly in the VC.", 
            "date_created": "2014-02-09 14:38:58.178883+00:00", 
            "author": "https://api.launchpad.net/1.0/~garyk"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/72143", 
            "date_created": "2014-02-09 14:46:58.206877+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/72143\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c815ce12bae083d15de1695fa63ca729091dce72\nSubmitter: Jenkins\nBranch:    master\n\ncommit c815ce12bae083d15de1695fa63ca729091dce72\nAuthor: Gary Kotton <email address hidden>\nDate:   Sun Feb 9 06:39:40 2014 -0800\n\n    VMware: bug fix for host operations when using VMwareVCDriver\n    \n    Currently the driver does not have a mapping between a Nova 'host'\n    and a VMware 'cluster'. A host operation would update the state of\n    one of the hosts in one of the configured clusters.\n    \n    The solution is for the driver to raise a NotImplemented exception.\n    \n    Change-Id: Idd78020374a6fe2d34bf8d860c30e2ed8c719903\n    Closes-bug: #1274129\n", 
            "date_created": "2014-03-20 02:57:44.080426+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-31 19:04:18.553036+00:00"
}