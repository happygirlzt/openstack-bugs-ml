{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:44:04.947259+00:00", 
    "description": "If you run nova shelve api in nova-cell environment It throws following error:\n\nNova cell (n-cell-child) Logs:\n\n2014-07-06 23:57:13.445 ERROR nova.cells.messaging [req-a689a1a1-4634-4634-974a-7343b5554f46 admin admin] Error processing message locally: save() got an unexpected keyword argument 'expected_task_state'\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging Traceback (most recent call last):\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/cells/messaging.py\", line 200, in _process_locally\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     resp_value = self.msg_runner._process_message_locally(self)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/cells/messaging.py\", line 1287, in _process_message_locally\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return fn(message, **message.method_kwargs)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/cells/messaging.py\", line 700, in run_compute_api_method\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return fn(message.ctxt, *args, **method_info['method_kwargs'])\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/compute/api.py\", line 192, in wrapped\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return func(self, context, target, *args, **kwargs)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/compute/api.py\", line 182, in inner\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return function(self, context, instance, *args, **kwargs)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/compute/api.py\", line 163, in inner\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return f(self, context, instance, *args, **kw)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/compute/api.py\", line 2458, in shelve\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     instance.save(expected_task_state=[None])\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging TypeError: save() got an unexpected keyword argument 'expected_task_state'\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging\n\nNova compute log:\n\n2014-07-07 00:05:19.084 ERROR oslo.messaging.rpc.dispatcher [req-9539189d-239b-4e74-8aea-8076740\n31c2f admin admin] Exception during message handling: 'NoneType' object is not iterable\nTraceback (most recent call last):\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _\ndispatch_and_reply\n\u00a0\u00a0\u00a0\u00a0incoming.message))\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _\ndispatch\n\u00a0\u00a0\u00a0\u00a0return self._do_dispatch(endpoint, method, ctxt, args)\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _\ndo_dispatch\n\u00a0\u00a0\u00a0\u00a0result = getattr(endpoint, method)(ctxt, **new_args)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/conductor/manager.py\", line 351, in notify_usage_exists\n\u00a0\u00a0\u00a0\u00a0system_metadata, extra_usage_info)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/utils.py\", line 250, in notify_usage_exists\n\u00a0\u00a0\u00a0\u00a0ignore_missing_network_data)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/notifications.py\", line 285, in bandwidth_usage\n\u00a0\u00a0\u00a0\u00a0macs = [vif['address'] for vif in nw_info]\n\nTypeError: 'NoneType' object is not iterable\n\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dis\nt-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 280, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 266, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 330, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 308, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 296, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 3847, in shelve_instance\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     self.conductor_api.notify_usage_exists(\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/api.py\", line 206, in notify_usage_exists\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     system_metadata, extra_usage_info)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 320, in notify_usage_exists\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     extra_usage_info=extra_usage_info_p)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     retry=self.retry)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 401, in send\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     retry=retry)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 392, in _send\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     raise result\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher TypeError: 'NoneType' object is not iterable\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/manager.py\", line 351, in notify_usage_exists\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     system_metadata, extra_usage_info)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/utils.py\", line 250, in notify_usage_exists\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     ignore_missing_network_data)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/notifications.py\", line 285, in bandwidth_usage\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     macs = [vif['address'] for vif in nw_info]\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher TypeError: 'NoneType' object is not iterable\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.093 ERROR oslo.messaging._drivers.common [req-9539189d-239b-4e74-8aea-807674031c2f admin admin] Returning exception 'NoneType' object is not iterable\nTraceback (most recent call last):\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n\u00a0\u00a0\u00a0\u00a0incoming.message))\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n\u00a0\u00a0\u00a0\u00a0return self._do_dispatch(endpoint, method, ctxt, args)\n\n\u00a0\u00a0File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n\u00a0\u00a0\u00a0\u00a0result = getattr(endpoint, method)(ctxt, **new_args)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/conductor/manager.py\", line 351, in notify_usage_exists\n\u00a0\u00a0\u00a0\u00a0system_metadata, extra_usage_info)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/compute/utils.py\", line 250, in notify_usage_exists\n\u00a0\u00a0\u00a0\u00a0ignore_missing_network_data)\n\n\u00a0\u00a0File \"/opt/stack/nova/nova/notifications.py\", line 285, in bandwidth_usage\n\u00a0\u00a0\u00a0\u00a0macs = [vif['address'] for vif in nw_info]\n\nTypeError: 'NoneType' object is not iterable\n\u00a0to caller\n\n\n\nShelve api is failing in nova-cell environment because the compute_api shelve/unshelve\nmethods expect an Instance object, but cell is still passing the sqlalchemy form.\n\nAlso 'info_cache' and 'metadata' are not present in instance-object and shelve requires these\nproperties to be present in Instance object.", 
    "tags": [
        "icehouse-backport-potential", 
        "in-stable-icehouse", 
        "ntt"
    ], 
    "importance": "Undecided", 
    "heat": 38, 
    "link": "https://bugs.launchpad.net/nova/+bug/1338451", 
    "owner": "https://api.launchpad.net/1.0/~abhijeet-malawade", 
    "id": 1338451, 
    "index": 6246, 
    "openned": "2014-07-07 07:23:06.740444+00:00", 
    "created": "2014-07-07 07:23:06.740444+00:00", 
    "title": "shelve api does not work in the nova-cell environment", 
    "comments": [
        {
            "content": "If you run nova shelve api in nova-cell environment It throws following error:\n\nNova cell (n-cell-child) Logs:\n\n2014-07-06 23:57:13.445 ERROR nova.cells.messaging [req-a689a1a1-4634-4634-974a-7343b5554f46 admin admin] Error processing message locally: save() got an unexpected keyword argument 'expected_task_state'\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging Traceback (most recent call last):\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/cells/messaging.py\", line 200, in _process_locally\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     resp_value = self.msg_runner._process_message_locally(self)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/cells/messaging.py\", line 1287, in _process_message_locally\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return fn(message, **message.method_kwargs)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/cells/messaging.py\", line 700, in run_compute_api_method\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return fn(message.ctxt, *args, **method_info['method_kwargs'])\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/compute/api.py\", line 192, in wrapped\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return func(self, context, target, *args, **kwargs)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/compute/api.py\", line 182, in inner\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return function(self, context, instance, *args, **kwargs)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/compute/api.py\", line 163, in inner\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     return f(self, context, instance, *args, **kw)\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging   File \"/opt/stack/nova/nova/compute/api.py\", line 2458, in shelve\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging     instance.save(expected_task_state=[None])\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging TypeError: save() got an unexpected keyword argument 'expected_task_state'\n2014-07-06 23:57:13.445 TRACE nova.cells.messaging\n\n\nNova compute log:\n\n2014-07-07 00:05:19.084 ERROR oslo.messaging.rpc.dispatcher [req-9539189d-239b-4e74-8aea-8076740\n31c2f admin admin] Exception during message handling: 'NoneType' object is not iterable\nTraceback (most recent call last):\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _\ndispatch_and_reply\n    incoming.message))\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _\ndispatch\n    return self._do_dispatch(endpoint, method, ctxt, args)\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _\ndo_dispatch\n    result = getattr(endpoint, method)(ctxt, **new_args)\n\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 351, in notify_usage_exists\n    system_metadata, extra_usage_info)\n\n  File \"/opt/stack/nova/nova/compute/utils.py\", line 250, in notify_usage_exists\n    ignore_missing_network_data)\n\n  File \"/opt/stack/nova/nova/notifications.py\", line 285, in bandwidth_usage\n    macs = [vif['address'] for vif in nw_info]\n\nTypeError: 'NoneType' object is not iterable\n\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dis\nt-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     payload)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 280, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     pass\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 266, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 330, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 308, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/openstack/common/excutils.py\", line 82, in __exit__\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 296, in decorated_function\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 3847, in shelve_instance\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     self.conductor_api.notify_usage_exists(\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/api.py\", line 206, in notify_usage_exists\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     system_metadata, extra_usage_info)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 320, in notify_usage_exists\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     extra_usage_info=extra_usage_info_p)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     retry=self.retry)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     timeout=timeout, retry=retry)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 401, in send\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     retry=retry)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 392, in _send\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     raise result\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher TypeError: 'NoneType' object is not iterable\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/conductor/manager.py\", line 351, in notify_usage_exists\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     system_metadata, extra_usage_info)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/utils.py\", line 250, in notify_usage_exists\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     ignore_missing_network_data)\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/notifications.py\", line 285, in bandwidth_usage\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher     macs = [vif['address'] for vif in nw_info]\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher TypeError: 'NoneType' object is not iterable\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.084 TRACE oslo.messaging.rpc.dispatcher\n2014-07-07 00:05:19.093 ERROR oslo.messaging._drivers.common [req-9539189d-239b-4e74-8aea-807674031c2f admin admin] Returning exception 'NoneType' object is not iterable\nTraceback (most recent call last):\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\n    incoming.message))\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\n    return self._do_dispatch(endpoint, method, ctxt, args)\n\n  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\n    result = getattr(endpoint, method)(ctxt, **new_args)\n\n  File \"/opt/stack/nova/nova/conductor/manager.py\", line 351, in notify_usage_exists\n    system_metadata, extra_usage_info)\n\n  File \"/opt/stack/nova/nova/compute/utils.py\", line 250, in notify_usage_exists\n    ignore_missing_network_data)\n\n  File \"/opt/stack/nova/nova/notifications.py\", line 285, in bandwidth_usage\n    macs = [vif['address'] for vif in nw_info]\n\nTypeError: 'NoneType' object is not iterable\n to caller\n\n \nShelve api is failing in nova-cell environment because the compute_api shelve/unshelve \nmethods expect an Instance object, but cell is still passing the sqlalchemy form.\n\nAlso 'info_cache' and 'metadata' are not present in instance-object and shelve requires these\nproperties to be present in Instance object.", 
            "date_created": "2014-07-07 07:23:06.740444+00:00", 
            "author": "https://api.launchpad.net/1.0/~abhijeet-malawade"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/105112", 
            "date_created": "2014-07-07 10:29:37.895136+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/105112\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=9d4b49c542e2076c8a572d1e8c6d50e255efe087\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9d4b49c542e2076c8a572d1e8c6d50e255efe087\nAuthor: Abhijeet Malawade <email address hidden>\nDate:   Wed Jul 2 08:03:31 2014 -0700\n\n    shelve doesn't work on nova-cells environment\n    \n    The compute_api shelve/unshelve methods expect an Instance object,\n    but cell is still passing the sqlalchemy form.\n    So adding shelve/unshelve to the list of methods that will receive an\n    Instance object when using nova-cell.\n    \n    When shelving instance with nova-cell environment,\n    instance object needs to contain 'metadata' and 'info_cache'.\n    So fetching the same from databse and adding it to\n    instance object before calling shelve/unshelve methods.\n    \n    Closes-Bug: #1338451\n    Change-Id: Ia31b33c9a1d347f15d3e0a67fa31ef6b25a7407a\n", 
            "date_created": "2014-07-16 17:27:47.747206+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/107612", 
            "date_created": "2014-07-17 09:30:44.053112+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/107612\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=e7d20879b2d4ef5261d0f85c520a63451b628eeb\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit e7d20879b2d4ef5261d0f85c520a63451b628eeb\nAuthor: Abhijeet Malawade <email address hidden>\nDate:   Wed Jul 2 08:03:31 2014 -0700\n\n    shelve doesn't work on nova-cells environment\n    \n    The compute_api shelve/unshelve methods expect an Instance object,\n    but cell is still passing the sqlalchemy form.\n    So adding shelve/unshelve to the list of methods that will receive an\n    Instance object when using nova-cell.\n    \n    When shelving instance with nova-cell environment,\n    instance object needs to contain 'metadata' and 'info_cache'.\n    So fetching the same from databse and adding it to\n    instance object before calling shelve/unshelve methods.\n    \n    Conflicts:\n        nova/cells/messaging.py\n    \n    Closes-Bug: #1338451\n    Change-Id: Ia31b33c9a1d347f15d3e0a67fa31ef6b25a7407a\n    (cherry picked from commit 9d4b49c542e2076c8a572d1e8c6d50e255efe087)\n", 
            "date_created": "2014-08-15 16:47:35.944935+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-07-23 15:00:39.557726+00:00"
}