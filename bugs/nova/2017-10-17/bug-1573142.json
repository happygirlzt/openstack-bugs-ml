{
    "status": "Invalid", 
    "last_updated": "2016-05-06 19:22:04.391997+00:00", 
    "description": "The information in the addresses dict for a server with a neutron floating ip is misleading. Here is an example:\n\n 'addresses': {u'openstackci-network1': [{u'OS-EXT-IPS-MAC:mac_addr': u'fa:16:3e:d7:d1:c2',\n                                          u'OS-EXT-IPS:type': u'fixed',\n                                          u'addr': u'10.0.1.24',\n                                          u'version': 4},\n                                         {u'OS-EXT-IPS-MAC:mac_addr': u'fa:16:3e:d7:d1:c2',\n                                          u'OS-EXT-IPS:type': u'floating',\n                                          u'addr': u'172.99.106.118',\n                                          u'version': 4}]},\n\nThis is incorrect. The neutron networks on this cloud are:\n\n| 405abfcc-77dc-49b2-a271-139619ac9b26 | openstackjenkins-network1 | a47910bc-f649-45db-98ec-e2421c413f4e 10.0.1.0/24 |\n| 7004a83a-13d3-4dcd-8cf5-52af1ace4cae | GATEWAY_NET               | cf785ee0-6cc9-4712-be3d-0bf6c86cf455             |\n\n\nThe floating IP does not come from openstackci-network1 - it comes from GATEWAY_NET. But in the nova addresses dict, the floating IP is showing up as a member of the list of addresses from openstackci-network1. It should really look like this:\n\n 'addresses': {u'openstackci-network1': [{u'OS-EXT-IPS-MAC:mac_addr': u'fa:16:3e:d7:d1:c2',\n                                          u'OS-EXT-IPS:type': u'fixed',\n                                          u'addr': u'10.0.1.24',\n                                          u'version': 4}],\n                         {u'GATEWAY_NET': [{u'OS-EXT-IPS-MAC:mac_addr': u'fa:16:3e:d7:d1:c2',\n                                          u'OS-EXT-IPS:type': u'floating',\n                                          u'addr': u'172.99.106.118',\n                                          u'version': 4}]},", 
    "tags": [
        "api", 
        "network", 
        "neutron"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1573142", 
    "owner": "None", 
    "id": 1573142, 
    "index": 1997, 
    "openned": "2016-04-21 17:01:04.852760+00:00", 
    "created": "2016-04-21 17:01:04.852760+00:00", 
    "title": "proxied neutron network information is incorrect/confusing", 
    "comments": [
        {
            "content": "The information in the addresses dict for a server with a neutron floating ip is misleading. Here is an example:\n\n 'addresses': {u'openstackci-network1': [{u'OS-EXT-IPS-MAC:mac_addr': u'fa:16:3e:d7:d1:c2',\n                                          u'OS-EXT-IPS:type': u'fixed',\n                                          u'addr': u'10.0.1.24',\n                                          u'version': 4},\n                                         {u'OS-EXT-IPS-MAC:mac_addr': u'fa:16:3e:d7:d1:c2',\n                                          u'OS-EXT-IPS:type': u'floating',\n                                          u'addr': u'172.99.106.118',\n                                          u'version': 4}]},\n\nThis is incorrect. The neutron networks on this cloud are:\n\n| 405abfcc-77dc-49b2-a271-139619ac9b26 | openstackjenkins-network1 | a47910bc-f649-45db-98ec-e2421c413f4e 10.0.1.0/24 |\n| 7004a83a-13d3-4dcd-8cf5-52af1ace4cae | GATEWAY_NET               | cf785ee0-6cc9-4712-be3d-0bf6c86cf455             |\n\n\nThe floating IP does not come from openstackci-network1 - it comes from GATEWAY_NET. But in the nova addresses dict, the floating IP is showing up as a member of the list of addresses from openstackci-network1. It should really look like this:\n\n 'addresses': {u'openstackci-network1': [{u'OS-EXT-IPS-MAC:mac_addr': u'fa:16:3e:d7:d1:c2',\n                                          u'OS-EXT-IPS:type': u'fixed',\n                                          u'addr': u'10.0.1.24',\n                                          u'version': 4}],\n                         {u'GATEWAY_NET': [{u'OS-EXT-IPS-MAC:mac_addr': u'fa:16:3e:d7:d1:c2',\n                                          u'OS-EXT-IPS:type': u'floating',\n                                          u'addr': u'172.99.106.118',\n                                          u'version': 4}]},", 
            "date_created": "2016-04-21 17:01:04.852760+00:00", 
            "author": "https://api.launchpad.net/1.0/~mordred"
        }, 
        {
            "content": "To see this for yourself:\n\ncreate a VM on a cloud that supports floating IPs\nattach a floating IP to the VM\nget the server dict (GET /servers/{id})\nrun 'neutron net-list'\n\nYou should see the difference", 
            "date_created": "2016-04-21 17:04:30.579654+00:00", 
            "author": "https://api.launchpad.net/1.0/~mordred"
        }, 
        {
            "content": "This is the code that generates the addresses dict shown above:\n\nhttps://github.com/openstack/nova/blob/897cb7c2d3f1a50f69ddd2ccbfb00a915feae0fa/nova/api/openstack/common.py#L326\n\nIt's coming from the instance network info cache, which is (re)built in the neutronv2 API here after adding a floating IP:\n\nhttps://github.com/openstack/nova/blob/897cb7c2d3f1a50f69ddd2ccbfb00a915feae0fa/nova/network/neutronv2/api.py#L1662\n\nAnd this is where we should be building the list if floating IPs as part of building the nw info cache:\n\nhttps://github.com/openstack/nova/blob/897cb7c2d3f1a50f69ddd2ccbfb00a915feae0fa/nova/network/neutronv2/api.py#L1565\n\nI wonder if something is going wrong here:\n\nhttps://github.com/openstack/nova/blob/897cb7c2d3f1a50f69ddd2ccbfb00a915feae0fa/nova/network/neutronv2/api.py#L1754\n\nIs your floating IP port on a subnet in the GATEWAY_NET network?\n\nCan you dump the nw info cache from the DB when you hit this?  e.g.:\n\nselect network_info from nova.instance_info_caches where instance_uuid=<your instance uuid>;", 
            "date_created": "2016-04-23 14:25:09.326756+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Hey Matt!\n\nYes - floating ip is on a subnet in the GATEWAY_NET network. (this is true across all of the clouds I have access to that use floating ips)\n\nI do not have any access to dbs in these - the example in question comes from the OpenStack Innovation Center cloud - so one of the RAX folks who runs that might have db access.", 
            "date_created": "2016-04-24 15:29:04.646689+00:00", 
            "author": "https://api.launchpad.net/1.0/~mordred"
        }, 
        {
            "content": "Apparently my simple devstack doesn't have a floating IP pool setup with a separate network to test this out.  I fiddled with networking docs on trying to get that setup in devstack but failed.", 
            "date_created": "2016-05-06 15:06:50.685847+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I think I got it. I have two networks when I start devstack + neutron + ovs, public and private. public is the external network. I created a floating IP on that public network. I booted a server on the private network. Then I associate the floating IP (on public) to the server, and when listing the server details it's only showing the private network, but has the floating IP address in it.\n\nThe relevant part of the server GET response:\n\n\"addresses\": {\n   \"private\":[\n      {\n         \"OS-EXT-IPS-MAC:mac_addr\":\"fa:16:3e:0f:26:79\",\n         \"version\":6,\n         \"addr\":\"fd89:5721:7b:0:f816:3eff:fe0f:2679\",\n         \"OS-EXT-IPS:type\":\"fixed\"\n      },\n      {\n         \"OS-EXT-IPS-MAC:mac_addr\":\"fa:16:3e:0f:26:79\",\n         \"version\":4,\n         \"addr\":\"10.0.0.3\",\n         \"OS-EXT-IPS:type\":\"fixed\"\n      },\n      {\n         \"OS-EXT-IPS-MAC:mac_addr\":\"fa:16:3e:0f:26:79\",\n         \"version\":4,\n         \"addr\":\"172.24.4.5\",\n         \"OS-EXT-IPS:type\":\"floating\"\n      }\n   ]\n}\n\nThis is the floating IP:\n\nstack@test:~$ neutron floatingip-show 3a177df2-dd55-4b84-8cb6-68e9c747c14b\n+---------------------+--------------------------------------+\n| Field               | Value                                |\n+---------------------+--------------------------------------+\n| description         |                                      |\n| dns_domain          |                                      |\n| dns_name            |                                      |\n| fixed_ip_address    | 10.0.0.3                             |\n| floating_ip_address | 172.24.4.5                           |\n| floating_network_id | 6291254a-6252-4315-be34-42d4e1965bc9 |\n| id                  | 3a177df2-dd55-4b84-8cb6-68e9c747c14b |\n| port_id             | 8f3feade-402c-49fc-8068-6a294f975b9e |\n| router_id           | 2f62223e-abd0-4c3c-b527-a8aeab7f4f10 |\n| status              | ACTIVE                               |\n| tenant_id           | 7d691fd8463e436592621c2b61001520     |\n+---------------------+--------------------------------------+\n\nAnd we can see that the floating IP is on the public network, not the private network:\n\nstack@test:~$ neutron net-list\n+--------------------------------------+---------+--------------------------------------------------------+\n| id                                   | name    | subnets                                                |\n+--------------------------------------+---------+--------------------------------------------------------+\n| 6291254a-6252-4315-be34-42d4e1965bc9 | public  | 8d7bae6b-b45d-4c5e-a54d-e954664c8f34 172.24.4.0/24     |\n|                                      |         | e1f14ed0-d41e-4e3a-bbae-d02b6a680010 2001:db8::/64     |\n| 39702d92-27b7-4b4b-b62e-4980f9d8f59e | private | 0ada4808-e650-4819-956f-a3704f59e2ab fd89:5721:7b::/64 |\n|                                      |         | 2ac179bb-ae71-4137-907d-6fac5758e169 10.0.0.0/24       |\n+--------------------------------------+---------+--------------------------------------------------------+\n", 
            "date_created": "2016-05-06 15:51:28.984041+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Also note the mac is overwritten each time in that dict.", 
            "date_created": "2016-05-06 15:52:36.748352+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Also, this is the instance_info_caches.network_info for the above instance:\n\n[\n   {\n      \"profile\":{\n\n      },\n      \"ovs_interfaceid\":\"8f3feade-402c-49fc-8068-6a294f975b9e\",\n      \"preserve_on_delete\":false,\n      \"network\":{\n         \"bridge\":\"br-int\",\n         \"subnets\":[\n            {\n               \"ips\":[\n                  {\n                     \"meta\":{\n\n                     },\n                     \"version\":6,\n                     \"type\":\"fixed\",\n                     \"floating_ips\":[\n\n                     ],\n                     \"address\":\"fd89:5721:7b:0:f816:3eff:fe0f:2679\"\n                  }\n               ],\n               \"version\":6,\n               \"meta\":{\n                  \"dhcp_server\":\"fd89:5721:7b:0:f816:3eff:fe32:8a20\"\n               },\n               \"dns\":[\n\n               ],\n               \"routes\":[\n\n               ],\n               \"cidr\":\"fd89:5721:7b::/64\",\n               \"gateway\":{\n                  \"meta\":{\n\n                  },\n                  \"version\":6,\n                  \"type\":\"gateway\",\n                  \"address\":\"fd89:5721:7b::1\"\n               }\n            },\n            {\n               \"ips\":[\n                  {\n                     \"meta\":{\n\n                     },\n                     \"version\":4,\n                     \"type\":\"fixed\",\n                     \"floating_ips\":[\n                        {\n                           \"meta\":{\n\n                           },\n                           \"version\":4,\n                           \"type\":\"floating\",\n                           \"address\":\"172.24.4.5\"\n                        }\n                     ],\n                     \"address\":\"10.0.0.3\"\n                  }\n               ],\n               \"version\":4,\n               \"meta\":{\n                  \"dhcp_server\":\"10.0.0.2\"\n               },\n               \"dns\":[\n\n               ],\n               \"routes\":[\n\n               ],\n               \"cidr\":\"10.0.0.0/24\",\n               \"gateway\":{\n                  \"meta\":{\n\n                  },\n                  \"version\":4,\n                  \"type\":\"gateway\",\n                  \"address\":\"10.0.0.1\"\n               }\n            }\n         ],\n         \"meta\":{\n            \"injected\":false,\n            \"tenant_id\":\"7e01723ee451404ab536591bcb8b8ac2\",\n            \"mtu\":1450\n         },\n         \"id\":\"39702d92-27b7-4b4b-b62e-4980f9d8f59e\",\n         \"label\":\"private\"\n      },\n      \"devname\":\"tap8f3feade-40\",\n      \"vnic_type\":\"normal\",\n      \"qbh_params\":null,\n      \"meta\":{\n\n      },\n      \"details\":{\n         \"port_filter\":true,\n         \"ovs_hybrid_plug\":true\n      },\n      \"address\":\"fa:16:3e:0f:26:79\",\n      \"active\":true,\n      \"type\":\"ovs\",\n      \"id\":\"8f3feade-402c-49fc-8068-6a294f975b9e\",\n      \"qbg_params\":null\n   }\n]", 
            "date_created": "2016-05-06 17:23:07.156158+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Hmm:\n\nstack@test:~$ neutron port-list -- --device_id f9bc7b39-ce32-4989-8fda-2d8f21e6532f\n+--------------------------------------+------+-------------------+-------------------------------------------------------------------------------------------------+\n| id                                   | name | mac_address       | fixed_ips                                                                                       |\n+--------------------------------------+------+-------------------+-------------------------------------------------------------------------------------------------+\n| 8f3feade-402c-49fc-8068-6a294f975b9e |      | fa:16:3e:0f:26:79 | {\"subnet_id\": \"2ac179bb-ae71-4137-907d-6fac5758e169\", \"ip_address\": \"10.0.0.3\"}                 |\n|                                      |      |                   | {\"subnet_id\": \"0ada4808-e650-4819-956f-a3704f59e2ab\", \"ip_address\":                             |\n|                                      |      |                   | \"fd89:5721:7b:0:f816:3eff:fe0f:2679\"}                                                           |\n+--------------------------------------+------+-------------------+-------------------------------------------------------------------------------------------------+", 
            "date_created": "2016-05-06 17:54:43.250961+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "When looking at the floating IP details in neutron:\n\nstack@test:~$ neutron floatingip-show 3a177df2-dd55-4b84-8cb6-68e9c747c14b\n+---------------------+--------------------------------------+\n| Field               | Value                                |\n+---------------------+--------------------------------------+\n| description         |                                      |\n| dns_domain          |                                      |\n| dns_name            |                                      |\n| fixed_ip_address    | 10.0.0.3                             |\n| floating_ip_address | 172.24.4.5                           |\n| floating_network_id | 6291254a-6252-4315-be34-42d4e1965bc9 |\n| id                  | 3a177df2-dd55-4b84-8cb6-68e9c747c14b |\n| port_id             | 8f3feade-402c-49fc-8068-6a294f975b9e |\n| router_id           | 2f62223e-abd0-4c3c-b527-a8aeab7f4f10 |\n| status              | ACTIVE                               |\n| tenant_id           | 7d691fd8463e436592621c2b61001520     |\n+---------------------+--------------------------------------+\n\nIt's on the public network (6291254a-6252-4315-be34-42d4e1965bc9) and it's associated with port id 8f3feade-402c-49fc-8068-6a294f975b9e. And this is the port:\n\nstack@test:~$ neutron port-show 8f3feade-402c-49fc-8068-6a294f975b9e\n+-----------------------+-----------------------------------------------------------------------------------------------------------+\n| Field                 | Value                                                                                                     |\n+-----------------------+-----------------------------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                                                      |\n| allowed_address_pairs |                                                                                                           |\n| binding:host_id       | test                                                                                                      |\n| binding:profile       | {}                                                                                                        |\n| binding:vif_details   | {\"port_filter\": true, \"ovs_hybrid_plug\": true}                                                            |\n| binding:vif_type      | ovs                                                                                                       |\n| binding:vnic_type     | normal                                                                                                    |\n| created_at            | 2016-05-06T15:38:36                                                                                       |\n| description           |                                                                                                           |\n| device_id             | f9bc7b39-ce32-4989-8fda-2d8f21e6532f                                                                      |\n| device_owner          | compute:None                                                                                              |\n| dns_name              |                                                                                                           |\n| extra_dhcp_opts       |                                                                                                           |\n| fixed_ips             | {\"subnet_id\": \"2ac179bb-ae71-4137-907d-6fac5758e169\", \"ip_address\": \"10.0.0.3\"}                           |\n|                       | {\"subnet_id\": \"0ada4808-e650-4819-956f-a3704f59e2ab\", \"ip_address\": \"fd89:5721:7b:0:f816:3eff:fe0f:2679\"} |\n| id                    | 8f3feade-402c-49fc-8068-6a294f975b9e                                                                      |\n| mac_address           | fa:16:3e:0f:26:79                                                                                         |\n| name                  |                                                                                                           |\n| network_id            | 39702d92-27b7-4b4b-b62e-4980f9d8f59e                                                                      |\n| port_security_enabled | True                                                                                                      |\n| security_groups       | bd18c7e0-4747-4038-9850-bbeaf74df110                                                                      |\n| status                | ACTIVE                                                                                                    |\n| tenant_id             | 7d691fd8463e436592621c2b61001520                                                                          |\n| updated_at            | 2016-05-06T15:38:42                                                                                       |\n+-----------------------+-----------------------------------------------------------------------------------------------------------+\n\n\nAnd there are two fixed IPs on that and 10.0.0.3 is the one associated with the floating IP.\n\nWhen we're iterating over the ports for the instance when building the nw info cache, we call this method:\n\nhttps://github.com/openstack/nova/blob/b256cae8e204fbbf6f3d40f5f4d47013be018a6d/nova/network/neutronv2/api.py#L1606\n\nWhich calls _get_floating_ips_by_fixed_and_port:\n\nhttps://github.com/openstack/nova/blob/b256cae8e204fbbf6f3d40f5f4d47013be018a6d/nova/network/neutronv2/api.py#L1510\n\nSo that just lists the floating IPs by fixed IP and port ID, which would be 10.0.0.3 and 8f3feade-402c-49fc-8068-6a294f975b9e respectively. On the command line:\n\nstack@test:~$ neutron floatingip-list -- --fixed_ip_address=10.0.0.3 --port_id=8f3feade-402c-49fc-8068-6a294f975b9e\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| id                                   | fixed_ip_address | floating_ip_address | port_id                              |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| 3a177df2-dd55-4b84-8cb6-68e9c747c14b | 10.0.0.3         | 172.24.4.5          | 8f3feade-402c-49fc-8068-6a294f975b9e |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n\nSo that's our floating IP, yay!\n\nSo that gets us back here:\n\nhttps://github.com/openstack/nova/blob/b256cae8e204fbbf6f3d40f5f4d47013be018a6d/nova/network/neutronv2/api.py#L1606\n\nWhere we associate the floating IP with the fixed IP in the model:\n\n    def _nw_info_get_ips(self, client, port):\n        network_IPs = []\n        for fixed_ip in port['fixed_ips']:\n            fixed = network_model.FixedIP(address=fixed_ip['ip_address'])\n            floats = self._get_floating_ips_by_fixed_and_port(\n                client, fixed_ip['ip_address'], port['id'])\n            for ip in floats:\n                fip = network_model.IP(address=ip['floating_ip_address'],\n                                       type='floating')\n                fixed.add_floating_ip(fip)\n            network_IPs.append(fixed)\n        return network_IPs\n\nSo we then pass that into this method to get subnets:\n\nhttps://github.com/openstack/nova/blob/b256cae8e204fbbf6f3d40f5f4d47013be018a6d/nova/network/neutronv2/api.py#L1619\n\n    def _nw_info_get_subnets(self, context, port, network_IPs):\n        subnets = self._get_subnets_from_port(context, port)\n        for subnet in subnets:\n            subnet['ips'] = [fixed_ip for fixed_ip in network_IPs\n                             if fixed_ip.is_in_subnet(subnet)]\n        return subnets\n\nThat gets the fixed_ips from the port, which for our port is:\n\n| fixed_ips             | {\"subnet_id\": \"2ac179bb-ae71-4137-907d-6fac5758e169\", \"ip_address\": \"10.0.0.3\"}                           |\n|                       | {\"subnet_id\": \"0ada4808-e650-4819-956f-a3704f59e2ab\", \"ip_address\": \"fd89:5721:7b:0:f816:3eff:fe0f:2679\"} |\n\n\nFrom the command line:\n\nstack@test:~$ neutron subnet-list -- --id 2ac179bb-ae71-4137-907d-6fac5758e169 0ada4808-e650-4819-956f-a3704f59e2ab\n+--------------------------------------+---------------------+-------------------+---------------------------------------------------------------------------+\n| id                                   | name                | cidr              | allocation_pools                                                          |\n+--------------------------------------+---------------------+-------------------+---------------------------------------------------------------------------+\n| 0ada4808-e650-4819-956f-a3704f59e2ab | ipv6-private-subnet | fd89:5721:7b::/64 | {\"start\": \"fd89:5721:7b::2\", \"end\": \"fd89:5721:7b:0:ffff:ffff:ffff:ffff\"} |\n| 2ac179bb-ae71-4137-907d-6fac5758e169 | private-subnet      | 10.0.0.0/24       | {\"start\": \"10.0.0.2\", \"end\": \"10.0.0.254\"}                                |\n+--------------------------------------+---------------------+-------------------+---------------------------------------------------------------------------+\n\nNotice that those are both on subnets for the private network.\n\nstack@test:~$ neutron subnet-show 0ada4808-e650-4819-956f-a3704f59e2ab\n+-------------------+---------------------------------------------------------------------------+\n| Field             | Value                                                                     |\n+-------------------+---------------------------------------------------------------------------+\n| allocation_pools  | {\"start\": \"fd89:5721:7b::2\", \"end\": \"fd89:5721:7b:0:ffff:ffff:ffff:ffff\"} |\n| cidr              | fd89:5721:7b::/64                                                         |\n| created_at        | 2016-04-27T15:51:53                                                       |\n| description       |                                                                           |\n| dns_nameservers   |                                                                           |\n| enable_dhcp       | True                                                                      |\n| gateway_ip        | fd89:5721:7b::1                                                           |\n| host_routes       |                                                                           |\n| id                | 0ada4808-e650-4819-956f-a3704f59e2ab                                      |\n| ip_version        | 6                                                                         |\n| ipv6_address_mode | slaac                                                                     |\n| ipv6_ra_mode      | slaac                                                                     |\n| name              | ipv6-private-subnet                                                       |\n| network_id        | 39702d92-27b7-4b4b-b62e-4980f9d8f59e                                      |\n| subnetpool_id     |                                                                           |\n| tenant_id         | 7e01723ee451404ab536591bcb8b8ac2                                          |\n| updated_at        | 2016-04-27T15:51:53                                                       |\n+-------------------+---------------------------------------------------------------------------+\nstack@test:~$ neutron subnet-show 2ac179bb-ae71-4137-907d-6fac5758e169\n+-------------------+--------------------------------------------+\n| Field             | Value                                      |\n+-------------------+--------------------------------------------+\n| allocation_pools  | {\"start\": \"10.0.0.2\", \"end\": \"10.0.0.254\"} |\n| cidr              | 10.0.0.0/24                                |\n| created_at        | 2016-04-27T15:51:51                        |\n| description       |                                            |\n| dns_nameservers   |                                            |\n| enable_dhcp       | True                                       |\n| gateway_ip        | 10.0.0.1                                   |\n| host_routes       |                                            |\n| id                | 2ac179bb-ae71-4137-907d-6fac5758e169       |\n| ip_version        | 4                                          |\n| ipv6_address_mode |                                            |\n| ipv6_ra_mode      |                                            |\n| name              | private-subnet                             |\n| network_id        | 39702d92-27b7-4b4b-b62e-4980f9d8f59e       |\n| subnetpool_id     |                                            |\n| tenant_id         | 7e01723ee451404ab536591bcb8b8ac2           |\n| updated_at        | 2016-04-27T15:51:51                        |\n+-------------------+--------------------------------------------+\nstack@test:~$\nstack@test:~$ neutron net-list\n+--------------------------------------+---------+--------------------------------------------------------+\n| id                                   | name    | subnets                                                |\n+--------------------------------------+---------+--------------------------------------------------------+\n| 39702d92-27b7-4b4b-b62e-4980f9d8f59e | private | 0ada4808-e650-4819-956f-a3704f59e2ab fd89:5721:7b::/64 |\n|                                      |         | 2ac179bb-ae71-4137-907d-6fac5758e169 10.0.0.0/24       |\n| 6291254a-6252-4315-be34-42d4e1965bc9 | public  | 8d7bae6b-b45d-4c5e-a54d-e954664c8f34 172.24.4.0/24     |\n|                                      |         | e1f14ed0-d41e-4e3a-bbae-d02b6a680010 2001:db8::/64     |\n+--------------------------------------+---------+--------------------------------------------------------+\n\n\nSo in the instance nw info cache, the floating IP is listed with the fixed IP that's on the subnet that's on the private network, so even though the floating IP was created against the public network, it's not listed because we look it up via the related fixed IP, not the network.", 
            "date_created": "2016-05-06 18:58:39.354701+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "This might be working as designed, from what I can tell. Nova starts building the nw_info cache list from the ports, so nova goes ports->subnets->fixed_ips->floating_ips. I'm not sure if or how we should change the nw info cache to represent this differently.\n\nNote that listing the floating IPs via the nova API is correct, it shows the associated server and public network:\n\nstack@test:~$ nova floating-ip-list\n+--------------------------------------+------------+--------------------------------------+----------+--------+\n| Id                                   | IP         | Server Id                            | Fixed IP | Pool   |\n+--------------------------------------+------------+--------------------------------------+----------+--------+\n| 3a177df2-dd55-4b84-8cb6-68e9c747c14b | 172.24.4.5 | f9bc7b39-ce32-4989-8fda-2d8f21e6532f | 10.0.0.3 | public |\n+--------------------------------------+------------+--------------------------------------+----------+--------+\n\nAnd when listing interfaces, it only shows the port and it's fixed IPs:\n\nstack@test:~$ nova interface-list floating-test-1\n+------------+--------------------------------------+--------------------------------------+---------------------------------------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses                                | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+---------------------------------------------+-------------------+\n| ACTIVE     | 8f3feade-402c-49fc-8068-6a294f975b9e | 39702d92-27b7-4b4b-b62e-4980f9d8f59e | 10.0.0.3,fd89:5721:7b:0:f816:3eff:fe0f:2679 | fa:16:3e:0f:26:79 |\n+------------+--------------------------------------+--------------------------------------+---------------------------------------------+-------------------+\n\nWhich are on the private network.", 
            "date_created": "2016-05-06 19:16:36.956501+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "While I agree this is confusing, I'm going to mark it invalid since it seems to be doing what's intended, although the model doesn't represent it all that well. Since I can use nova floating-ip-list and get the proper info for the server, it seems OK.\n\nRe-open if you disagree.", 
            "date_created": "2016-05-06 19:22:03.686890+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ], 
    "closed": "2016-05-06 19:21:10.971637+00:00"
}