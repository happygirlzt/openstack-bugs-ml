{
    "status": "Invalid", 
    "last_updated": "2015-10-16 13:03:25.270563+00:00", 
    "description": "API fails during live migration with a 500 internal server error.\n\nhttps://127.0.0.1:8774/v2/8c87f173ba7c47cbb4f57eebe85479c1/servers/d53b954a-7323-4d88-a5fc-14c0672a704e/action\n{\n    \"os-migrateLive\": {\n        \"host\": \"8231E2D_109EFCT\",\n        \"block_migration\": false,\n        \"disk_over_commit\": false\n    }\n}\n\nThe correct error should be 400 BadRequest as the error raise should be RemoteError, not a MigrationError\n\nNova-api logs:\n\nMigrationError(u'Migration error: Remote error:error message)\n[u'Traceback (most recent call last):\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\\n    result = func(ctxt, **new_args)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 89, in wrapped\\n    payload)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 352, in decorated_function\\n    LOG.warning(msg, e, instance=instance)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 325, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', u'   \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 89, in wrapped\\n    payload)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 402, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 380, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 368, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5023, in check_can_live_migrate_destination\\n    block_migration, disk_over_commit)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'   \nraise exception.MigrationError(reason=six.text_type(ex))\\n'", 
    "tags": [
        "api", 
        "compute", 
        "live-migration"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1504666", 
    "owner": "https://api.launchpad.net/1.0/~lmtaylor", 
    "id": 1504666, 
    "index": 7068, 
    "openned": "2015-10-09 20:12:01.572454+00:00", 
    "created": "2015-10-09 20:12:01.572454+00:00", 
    "title": "RemoteError not properly caught during live migraion", 
    "comments": [
        {
            "content": "API fails during live migration with a 500 internal server error.\n\nhttps://127.0.0.1:8774/v2/8c87f173ba7c47cbb4f57eebe85479c1/servers/d53b954a-7323-4d88-a5fc-14c0672a704e/action\n{\n    \"os-migrateLive\": {\n        \"host\": \"8231E2D_109EFCT\",\n        \"block_migration\": false,\n        \"disk_over_commit\": false\n    }\n}\n\nThe correct error should be 400 BadRequest as the error raise should be RemoteError, not a MigrationError\n\nNova-api logs:\n\nMigrationError(u'Migration error: Remote error:error message)\n[u'Traceback (most recent call last):\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\\n    executor_callback))\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\\n    executor_callback)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 129, in _do_dispatch\\n    result = func(ctxt, **new_args)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 89, in wrapped\\n    payload)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 352, in decorated_function\\n    LOG.warning(msg, e, instance=instance)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 325, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', u'   \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 89, in wrapped\\n    payload)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/exception.py\", line 72, in wrapped\\n    return f(self, context, *args, **kw)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 402, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 380, in decorated_function\\n    kwargs[\\'instance\\'], e, sys.exc_info())\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 368, in decorated_function\\n    return function(self, context, *args, **kwargs)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/nova/compute/manager.py\", line 5023, in check_can_live_migrate_destination\\n    block_migration, disk_over_commit)\\n', u'  \nFile \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 119, in __exit__\\n    six.reraise(self.type_, self.value, self.tb)\\n', u'   \nraise exception.MigrationError(reason=six.text_type(ex))\\n'", 
            "date_created": "2015-10-09 20:12:01.572454+00:00", 
            "author": "https://api.launchpad.net/1.0/~lmtaylor"
        }, 
        {
            "content": "@Lauren Taylor:\n\n> The correct error should be 400 BadRequest as the error raise should\n> be RemoteError, not a MigrationError\n\nCould you please explain a little bit more to me why this should be \na \"BadRequest\" error with an HTTP status code 400? Is that a general \nrule or did the user provide wrong input parameters to the request?\nDoes the nova-compute logs of source and target node have more infos \nwhat failed exactly during the live-migration?", 
            "date_created": "2015-10-12 12:46:50.204937+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "The logs indicate the original exception is a 'NoValidHost', which is then wrapped in a 'RemoteError' followed by a 'MigrationError'.\nHaving a non-valid host (bad input parameter of host) should return an HTTP code of 400, rather than the 500 it currently returns now.", 
            "date_created": "2015-10-13 20:52:47.263456+00:00", 
            "author": "https://api.launchpad.net/1.0/~lmtaylor"
        }, 
        {
            "content": "There is no error. Made a mistake in debugging. Canceling this bug.", 
            "date_created": "2015-10-16 13:03:24.688910+00:00", 
            "author": "https://api.launchpad.net/1.0/~lmtaylor"
        }
    ], 
    "closed": "2015-10-16 13:02:14.288662+00:00"
}