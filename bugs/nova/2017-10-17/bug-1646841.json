{
    "status": "In Progress", 
    "last_updated": "2017-06-27 15:56:37.824347+00:00", 
    "description": "it's newton release version code, not 100% percent reproducable, but very likely \n\nstep1) boot instance\nstep2) restart compute service\nstep3) right after compute service start, resize the instance booted at step 1\n\n\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 87, in _object_dispatch\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return getattr(target, method)(*args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 226, in wrapper\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return fn(self, *args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/objects/instance.py\", line 748, in save\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     columns_to_join=_expected_cols(expected_attrs))\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 838, in instance_update_and_get_original\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     expected=expected)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 169, in wrapper\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return f(*args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_db/api.py\", line 151, in wrapper\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     ectxt.value = e.inner_exc\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_db/api.py\", line 139, in wrapper\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return f(*args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 240, in wrapped\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return f(context, *args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2635, in instance_update_and_get_original\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     context, instance_uuid, values, expected, original=instance_ref))\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2771, in _instance_update\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     raise exc(**exc_props)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server UnexpectedTaskStateError: Conflict updating instance f8c68d7b-1234-4c99-a5c7-c5f18f203513. Expected: {'task_state': [u'resize_prep']}. Actual: {'task_state': None}", 
    "tags": [
        "compute", 
        "openstack-version.newton", 
        "resize"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1646841", 
    "owner": "https://api.launchpad.net/1.0/~jichenjc", 
    "id": 1646841, 
    "index": 7833, 
    "openned": "2016-12-02 13:45:51.419046+00:00", 
    "created": "2016-12-02 13:45:51.419046+00:00", 
    "title": " UnexpectedTaskStateError: Conflict updating instance xxxx Expected: {'task_state': [u'resize_prep']}. Actual: {'task_state': None}", 
    "comments": [
        {
            "content": "it's newton release version code, not 100% percent reproducable, but very likely \n\nstep1) boot instance\nstep2) restart compute service\nstep3) right after compute service start, resize the instance booted at step 1\n\n\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 87, in _object_dispatch\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return getattr(target, method)(*args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 226, in wrapper\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return fn(self, *args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/objects/instance.py\", line 748, in save\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     columns_to_join=_expected_cols(expected_attrs))\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 838, in instance_update_and_get_original\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     expected=expected)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 169, in wrapper\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return f(*args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_db/api.py\", line 151, in wrapper\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     ectxt.value = e.inner_exc\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_db/api.py\", line 139, in wrapper\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return f(*args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 240, in wrapped\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     return f(context, *args, **kwargs)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2635, in instance_update_and_get_original\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     context, instance_uuid, values, expected, original=instance_ref))\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2771, in _instance_update\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server     raise exc(**exc_props)\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server\n2016-12-02 13:41:22.265 36087 ERROR oslo_messaging.rpc.server UnexpectedTaskStateError: Conflict updating instance f8c68d7b-1234-4c99-a5c7-c5f18f203513. Expected: {'task_state': [u'resize_prep']}. Actual: {'task_state': None}", 
            "date_created": "2016-12-02 13:45:51.419046+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "no clue yet, maybe it's because compute node status might be changed between API layer set task state and init function of compute layer", 
            "date_created": "2016-12-02 13:47:31.110909+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "2016-12-02 20:30:37.299 28333 DEBUG nova.compute.manager [req-35a8b9f0-f515-4c01-bd83-8cc0b3a59403 - - - - -] [instance: 7a31c72f-6f9a-4c94-9719-1c3ccb6ed117] Instance in transitional state resize_prep at start-up clearing task state _init_instance /usr/lib/python2.7/site-packages/nova/compute/manager.py:840\n\nwith debug on, I think I can confirm this is a race condition, the init process wrongly think the status is transitional , actually it's API layer just modified", 
            "date_created": "2016-12-02 20:33:53.725998+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/oslo_db/api.py\", line 139, in wrapper\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server     return f(*args, **kwargs)\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 240, in wrapped\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server     return f(context, *args, **kwargs)\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2635, in instance_update_and_get_original\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server     context, instance_uuid, values, expected, original=instance_ref))\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2771, in _instance_update\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server     raise exc(**exc_props)\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server\n2016-12-02 21:08:50.605 24224 ERROR oslo_messaging.rpc.server UnexpectedTaskStateError: Conflict updating instance b8cb5d2e-2e61-45af-ab5a-bfe2d78b5ca0. Expected: {'task_state': [u'image_snapshot_pending']}. Actual: {'task_state': None}\n\n2016-12-02 21:08:21.867 24224 DEBUG nova.compute.manager [req-4edf093f-c870-4933-bc8d-17f69149597d - - - - -] [instance: b8cb5d2e-2e61-45af-ab5a-bfe2d78b5ca0] Instance in transitional state image_snapshot_pending at start-up clearing task state _init_instance /usr/lib/python2.7/site-packages/nova/compute/manager.py:826\n\n\nmore than snapshoting....\n\n\nseems ", 
            "date_created": "2016-12-02 21:11:05.004769+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/406977", 
            "date_created": "2016-12-05 14:06:04.958393+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I also got same error https://bugs.launchpad.net/nova/+bug/1669924", 
            "date_created": "2017-03-17 05:25:48.503135+00:00", 
            "author": "https://api.launchpad.net/1.0/~sajuptpm"
        }, 
        {
            "content": "not similar error, i am getting this error from nova.cells.messaging", 
            "date_created": "2017-03-17 05:44:13.750958+00:00", 
            "author": "https://api.launchpad.net/1.0/~sajuptpm"
        }, 
        {
            "content": "Automatically discovered version newton in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 15:56:37.291745+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ]
}