{
    "status": "Expired", 
    "last_updated": "2017-08-23 04:17:45.566472+00:00", 
    "description": "Description\n===========\n\nOne of my environment I have configured my vCenter to listen on non default port ( eg: 1400 ). By default vCenter will listen on 443. In this Instances are failed to boot. From the log I came to copy of images from glance to datastore which happens through the ESXi servers fails because ESXi servers are Listening on default port. Image copying method creating the URL which uses the port of vCenter not the ESXi host.\n\nSteps to reproduce\n==================\n* Configure vCenter to listen on port 1400 ( other than 443 )\n* Boot a instance\n\nExpected result\n===============\nInstance launch should be successful\n\nActual result\n=============\nBut instance launch will fail with below error\n\n2016-07-01 05:10:04.480 29447 DEBUG oslo_vmware.rw_handles [req-e12d5f3a-fa5f-44f3-9c5b-7350a9760c20 33f0250cb0db41a8a17bf240b81406b7 63fcf407f5bc492996c3a9afc93f7b42] Creating HTTP connection to write to file with size = 18808832 and URL = https://1.1.2.3:1400/folder/vmware_temp/d22ddfc3-7fbd-42b9-82e5-f45b0e7313ec/8b33e6a9-2da4-46df-8c7a-71d70bbbb0e4/tmp-sparse.vmdk?dsName=ds-37&dcPath=ha-datacenter. _create_write_connection /opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/oslo_vmware/rw_handles.py:126\n\n....\n\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [req-e12d5f3a-fa5f-44f3-9c5b-7350a9760c20 33f0250cb0db41a8a17bf240b81406b7 63fcf407f5bc492996c3a9afc93f7b42] [instance: d7f6f84c-024d-481e-b41d-5f416ff94305] Instance failed to spawn\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305] Traceback (most recent call last):\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/compute/manager.py\", line 2220, in _build_resources\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     yield resources\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/compute/manager.py\", line 2066, in _build_and_run_instance\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     block_device_info=block_device_info)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/hp_driver.py\", line 66, in spawn\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     power_on=False)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/vmops.py\", line 751, in spawn\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self._fetch_image_if_missing(context, vi)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/vmops.py\", line 614, in _fetch_image_if_missing\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     image_fetch(context, vi, tmp_image_ds_loc)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/vmops.py\", line 405, in _fetch_image_as_file\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     cookies=cookies)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/images.py\", line 236, in fetch_image\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     host, port, dc_name, ds_name, cookies, file_path, file_size)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/oslo_vmware/rw_handles.py\", line 272, in __init__\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     ssl_thumbprint=thumbprint)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/oslo_vmware/rw_handles.py\", line 142, in _create_write_connection\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     conn.endheaders()\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/usr/lib/python2.7/httplib.py\", line 997, in endheaders\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self._send_output(message_body)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/usr/lib/python2.7/httplib.py\", line 850, in _send_output\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self.send(msg)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/usr/lib/python2.7/httplib.py\", line 812, in send\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self.connect()\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/urllib3/connection.py\", line 217, in connect\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     conn = self._new_conn()\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/urllib3/connection.py\", line 146, in _new_conn\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self, \"Failed to establish a new connection: %s\" % e)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305] NewConnectionError: <urllib3.connection.VerifiedHTTPSConnection object at 0x7fa775d72b10>: Failed to establish a new connection: [Errno 110] ETIMEDOUT\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]\n\nIn this URL\nhttps://1.1.2.3:1400/folder/vmware_temp/d22ddfc3-7fbd-42b9-82e5-f45b0e7313ec/8b33e6a9-2da4-46df-8c7a-71d70bbbb0e4/tmp-sparse.vmdk?dsName=ds-37&dcPath=ha-datacenter\n\n1.1.2.3 is ESXi host ipaddress\n1400 is vCenter Listening port", 
    "tags": [
        "vmware"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1600710", 
    "owner": "None", 
    "id": 1600710, 
    "index": 4579, 
    "openned": "2016-07-11 08:16:58.385528+00:00", 
    "created": "2016-07-11 08:16:58.385528+00:00", 
    "title": "Failed to launch instance in vcenter configured with non default port", 
    "comments": [
        {
            "content": "Description\n===========\n\nOne of my environment I have configured my vCenter to listen on non default port ( eg: 1400 ). By default vCenter will listen on 443. In this Instances are failed to boot. From the log I came to copy of images from glance to datastore which happens through the ESXi servers fails because ESXi servers are Listening on default port. Image copying method creating the URL which uses the port of vCenter not the ESXi host.\n\nSteps to reproduce\n==================\n* Configure vCenter to listen on port 1400 ( other than 443 )\n* Boot a instance\n\nExpected result\n===============\nInstance launch should be successful \n\nActual result\n=============\nBut instance launch will fail with below error\n\n2016-07-01 05:10:04.480 29447 DEBUG oslo_vmware.rw_handles [req-e12d5f3a-fa5f-44f3-9c5b-7350a9760c20 33f0250cb0db41a8a17bf240b81406b7 63fcf407f5bc492996c3a9afc93f7b42] Creating HTTP connection to write to file with size = 18808832 and URL = https://1.1.2.3:1400/folder/vmware_temp/d22ddfc3-7fbd-42b9-82e5-f45b0e7313ec/8b33e6a9-2da4-46df-8c7a-71d70bbbb0e4/tmp-sparse.vmdk?dsName=ds-37&dcPath=ha-datacenter. _create_write_connection /opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/oslo_vmware/rw_handles.py:126\n\n....\n\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [req-e12d5f3a-fa5f-44f3-9c5b-7350a9760c20 33f0250cb0db41a8a17bf240b81406b7 63fcf407f5bc492996c3a9afc93f7b42] [instance: d7f6f84c-024d-481e-b41d-5f416ff94305] Instance failed to spawn\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305] Traceback (most recent call last):\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/compute/manager.py\", line 2220, in _build_resources\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     yield resources\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/compute/manager.py\", line 2066, in _build_and_run_instance\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     block_device_info=block_device_info)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/hp_driver.py\", line 66, in spawn\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     power_on=False)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/vmops.py\", line 751, in spawn\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self._fetch_image_if_missing(context, vi)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/vmops.py\", line 614, in _fetch_image_if_missing\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     image_fetch(context, vi, tmp_image_ds_loc)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/vmops.py\", line 405, in _fetch_image_as_file\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     cookies=cookies)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/nova/virt/vmwareapi/images.py\", line 236, in fetch_image\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     host, port, dc_name, ds_name, cookies, file_path, file_size)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/oslo_vmware/rw_handles.py\", line 272, in __init__\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     ssl_thumbprint=thumbprint)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/oslo_vmware/rw_handles.py\", line 142, in _create_write_connection\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     conn.endheaders()\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/usr/lib/python2.7/httplib.py\", line 997, in endheaders\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self._send_output(message_body)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/usr/lib/python2.7/httplib.py\", line 850, in _send_output\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self.send(msg)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/usr/lib/python2.7/httplib.py\", line 812, in send\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self.connect()\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/urllib3/connection.py\", line 217, in connect\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     conn = self._new_conn()\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]   File \"/opt/stack/venv/nova-20160628T001806Z/lib/python2.7/site-packages/urllib3/connection.py\", line 146, in _new_conn\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305]     self, \"Failed to establish a new connection: %s\" % e)\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305] NewConnectionError: <urllib3.connection.VerifiedHTTPSConnection object at 0x7fa775d72b10>: Failed to establish a new connection: [Errno 110] ETIMEDOUT\n2016-07-01 05:12:11.757 29447 ERROR nova.compute.manager [instance: d7f6f84c-024d-481e-b41d-5f416ff94305] \n\n\nIn this URL  \nhttps://1.1.2.3:1400/folder/vmware_temp/d22ddfc3-7fbd-42b9-82e5-f45b0e7313ec/8b33e6a9-2da4-46df-8c7a-71d70bbbb0e4/tmp-sparse.vmdk?dsName=ds-37&dcPath=ha-datacenter\n\n1.1.2.3 is ESXi host ipaddress\n1440 is vCenter Listening port", 
            "date_created": "2016-07-11 08:16:58.385528+00:00", 
            "author": "https://api.launchpad.net/1.0/~jjohnsonkoilraj"
        }, 
        {
            "content": "Which version/release of nova are you using? master (newton)? mitaka, liberty, other?", 
            "date_created": "2016-07-12 17:08:09.854903+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "What's the value of the host_port option in the [vmware] section of nova.conf?", 
            "date_created": "2016-07-12 17:09:25.281323+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Release newton & mitaka. \n\n[vmware] \nhost_port=1400\n\nI have corrected the typo in bug description.", 
            "date_created": "2016-07-13 20:57:13.060763+00:00", 
            "author": "https://api.launchpad.net/1.0/~jjohnsonkoilraj"
        }, 
        {
            "content": "https://review.openstack.org/#/c/135625/ change introduced way to copy images through ESXi host to datastore. ", 
            "date_created": "2016-07-13 21:06:07.852325+00:00", 
            "author": "https://api.launchpad.net/1.0/~jjohnsonkoilraj"
        }, 
        {
            "content": "Fix proposed to branch: stable/mitaka\nReview: https://review.openstack.org/341816", 
            "date_created": "2016-07-13 21:44:47.529559+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/342786", 
            "date_created": "2016-07-15 12:55:12.590203+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Matt Riedemann (<email address hidden>) on branch: stable/mitaka\nReview: https://review.openstack.org/341816", 
            "date_created": "2016-10-15 13:56:41.661966+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/342786\nReason: This patch has been sitting unchanged for more than 12 weeks. I am therefore going to abandon it to keep the nova review queue sane. Please feel free to restore the change if you're still working on it.", 
            "date_created": "2016-12-11 23:14:47.210187+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "\nThere are no currently open reviews on this bug, changing\nthe status back to the previous state and unassigning. If\nthere are active reviews related to this bug, please include\nlinks in comments.\n", 
            "date_created": "2017-06-23 12:46:48.049228+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2017-08-23 04:17:41.735320+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2017-08-23 04:17:42.714042+00:00"
}