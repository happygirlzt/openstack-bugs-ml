{
    "status": "Invalid", 
    "last_updated": "2014-07-10 22:59:02.982437+00:00", 
    "description": "HP/Lefthand storage requires password-interactive authentication. (The Windows command-line tool can generate an encrypted hash of the user-password, but even with that there is no provision for saving a public key to the SAN.)\n\nThere are several workarounds in various places on the net for faking keyboard-interactive with paramiko. Without a workaround, any attempt to create or remove a volume results in:\n2012-08-01 10:25:53 TRACE nova.rpc.amqp BadAuthenticationType: Bad authentication type (allowed_types=['publickey', 'keyboard-interactive'])\n\nFull trace:\n2012-08-01 10:25:53 INFO nova.volume.manager [req-d03338a9-9115-48a3-8dfc-35cdfcdc15a7 3bf04474f3294b319ace534f930939b0 1d0e530882654962aed9ae9fd122c178] volume volume-00000002: creating\n2012-08-01 10:25:53 DEBUG nova.volume.manager [req-d03338a9-9115-48a3-8dfc-35cdfcdc15a7 3bf04474f3294b319ace534f930939b0 1d0e530882654962aed9ae9fd122c178] volume volume-00000002: creating lv of size 10G from (pid=2799) create_volume /usr/lib/python2.7/dist-packages/nova/volume/manager.py:120\n2012-08-01 10:25:53 ERROR nova.rpc.amqp [req-d03338a9-9115-48a3-8dfc-35cdfcdc15a7 3bf04474f3294b319ace534f930939b0 1d0e530882654962aed9ae9fd122c178] Exception during message handling\n2012-08-01 10:25:53 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 253, in _process_data\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/manager.py\", line 138, in create_volume\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     volume_ref['id'], {'status': 'error'})\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     self.gen.next()\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/manager.py\", line 122, in create_volume\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     model_update = self.driver.create_volume(volume_ref)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 565, in create_volume\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     self._cliq_run_xml(\"createVolume\", cliq_args)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 450, in _cliq_run_xml\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     (out, _err) = self._cliq_run(verb, cliq_args)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 445, in _cliq_run\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     return self._run_ssh(cmd)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 126, in _run_ssh\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     ssh = self._connect_to_ssh()\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 103, in _connect_to_ssh\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     password=FLAGS.san_password)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/paramiko/client.py\", line 332, in connect\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     self._auth(username, password, pkey, key_filenames, allow_agent, look_for_keys)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/paramiko/client.py\", line 493, in _auth\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     raise saved_exception\n2012-08-01 10:25:53 TRACE nova.rpc.amqp BadAuthenticationType: Bad authentication type (allowed_types=['publickey', 'keyboard-interactive'])", 
    "tags": [
        "drivers", 
        "iscsi", 
        "lefthand", 
        "san", 
        "volume"
    ], 
    "importance": "Medium", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1031807", 
    "owner": "None", 
    "id": 1031807, 
    "index": 2994, 
    "openned": "2012-09-07 21:27:46.396301+00:00", 
    "created": "2012-08-01 14:54:51.494223+00:00", 
    "title": "nova.volume.san.HpSanISCSIDriver can't ssh to HP/Lefthand Units", 
    "comments": [
        {
            "content": "HP/Lefthand storage requires password-interactive authentication. (The Windows command-line tool can generate an encrypted hash of the user-password, but even with that there is no provision for saving a public key to the SAN.)\n\nThere are several workarounds in various places on the net for faking keyboard-interactive with paramiko. Without a workaround, any attempt to create or remove a volume results in:\n2012-08-01 10:25:53 TRACE nova.rpc.amqp BadAuthenticationType: Bad authentication type (allowed_types=['publickey', 'keyboard-interactive'])\n\nFull trace:\n2012-08-01 10:25:53 INFO nova.volume.manager [req-d03338a9-9115-48a3-8dfc-35cdfcdc15a7 3bf04474f3294b319ace534f930939b0 1d0e530882654962aed9ae9fd122c178] volume volume-00000002: creating\n2012-08-01 10:25:53 DEBUG nova.volume.manager [req-d03338a9-9115-48a3-8dfc-35cdfcdc15a7 3bf04474f3294b319ace534f930939b0 1d0e530882654962aed9ae9fd122c178] volume volume-00000002: creating lv of size 10G from (pid=2799) create_volume /usr/lib/python2.7/dist-packages/nova/volume/manager.py:120\n2012-08-01 10:25:53 ERROR nova.rpc.amqp [req-d03338a9-9115-48a3-8dfc-35cdfcdc15a7 3bf04474f3294b319ace534f930939b0 1d0e530882654962aed9ae9fd122c178] Exception during message handling\n2012-08-01 10:25:53 TRACE nova.rpc.amqp Traceback (most recent call last):\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/rpc/amqp.py\", line 253, in _process_data\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     rval = node_func(context=ctxt, **node_args)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/manager.py\", line 138, in create_volume\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     volume_ref['id'], {'status': 'error'})\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     self.gen.next()\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/manager.py\", line 122, in create_volume\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     model_update = self.driver.create_volume(volume_ref)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 565, in create_volume\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     self._cliq_run_xml(\"createVolume\", cliq_args)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 450, in _cliq_run_xml\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     (out, _err) = self._cliq_run(verb, cliq_args)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 445, in _cliq_run\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     return self._run_ssh(cmd)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 126, in _run_ssh\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     ssh = self._connect_to_ssh()\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/volume/san.py\", line 103, in _connect_to_ssh\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     password=FLAGS.san_password)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/paramiko/client.py\", line 332, in connect\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     self._auth(username, password, pkey, key_filenames, allow_agent, look_for_keys)\n2012-08-01 10:25:53 TRACE nova.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/paramiko/client.py\", line 493, in _auth\n2012-08-01 10:25:53 TRACE nova.rpc.amqp     raise saved_exception\n2012-08-01 10:25:53 TRACE nova.rpc.amqp BadAuthenticationType: Bad authentication type (allowed_types=['publickey', 'keyboard-interactive'])", 
            "date_created": "2012-08-01 14:54:51.494223+00:00", 
            "author": "https://api.launchpad.net/1.0/~r-launchpad-sigkill-net"
        }, 
        {
            "content": "I am testing in cinder devstack Folsom. create volume works fine for me.  attach volume need some workaround. detach volume only works using nova command line\r\n\r\n\r\nvolume_driver=nova.volume.san.HpSanISCSIDriver\r\nsan_ip=10.10.xx.xx\r\nsan_password=xxxxx\r\nsan_ssh_port=16022\r\nsan_login=xxxx\r\nsan_clustername=CloudCluster1\r\nsan_thin_provision=true\r\nsan_is_local=false\r\n", 
            "date_created": "2012-10-02 21:27:14.932151+00:00", 
            "author": "https://api.launchpad.net/1.0/~gloria-gu"
        }, 
        {
            "content": "to test your setting...without openstack, run ssh command directly to see if you can access the lefthand cliq, for example, \r\n\r\nssh -p 16022 -l <user> <left hand ip>\r\n\r\nmake sure you can do that first on the openstack system.", 
            "date_created": "2012-10-02 21:31:45.842987+00:00", 
            "author": "https://api.launchpad.net/1.0/~gloria-gu"
        }, 
        {
            "content": "Gloria, one point of clarification; you stated you're testing with devstack/cinder, however you call out your cinder.conf file as:\n\nvolume_driver=nova.volume.san.HpSanISCSIDriver\nsan_ip=10.10.xx.xx\nsan_password=xxxxx\nsan_ssh_port=16022\nsan_login=xxxx\nsan_clustername=CloudCluster1\nsan_thin_provision=true\nsan_is_local=false\n\n\nNot sure how this is set up, but it should be volume_driver=cinder.volume.san.HpSanISCSIDriver.\n", 
            "date_created": "2012-10-02 21:48:07.017803+00:00", 
            "author": "https://api.launchpad.net/1.0/~john-griffith"
        }, 
        {
            "content": "This driver works fine in both nova-volumes and cinder. Make sure your configuration is correct. Could you paste your configuration and give more details of how you have it set up?", 
            "date_created": "2012-10-04 23:39:58.805596+00:00", 
            "author": "https://api.launchpad.net/1.0/~rnirmal"
        }, 
        {
            "content": "That commandline test uses keyboard-interactive. (Run -vvv when you connect to a Lefthand unit and you'll see it. Or look at the first line of the trace I posted.) Also note that Lefthand is rebranded HP with customized software (and, theoretically, more capabilities.) If the driver supported keyboard-interactive, it would be trivial to extend it to support the lefthand units. \n\n(Unrelated, but as far as adding key management or standard password auth, I've already sent the suggestion to the lefthand software people. Right now they are more interested in core enhancements like erroring drives that can't be written to instead of showing green until it gets SMART errors..)", 
            "date_created": "2012-10-05 14:32:19.301328+00:00", 
            "author": "https://api.launchpad.net/1.0/~dismc"
        }, 
        {
            "content": "Here's the dump from connecting on the command line. As you've mentioned it only supports publickey,keyboard-interactive.\n\ndebug1: Authentications that can continue: publickey,keyboard-interactive\ndebug3: start over, passed a different list publickey,keyboard-interactive\ndebug3: preferred gssapi-keyex,gssapi-with-mic,publickey,keyboard-interactive,password\ndebug3: authmethod_lookup publickey\ndebug3: remaining preferred: keyboard-interactive,password\ndebug3: authmethod_is_enabled publickey\ndebug1: Next authentication method: publickey\ndebug1: Offering public key: /home/xxx/.ssh/id_rsa\ndebug3: send_pubkey_test\ndebug2: we sent a publickey packet, wait for reply\ndebug1: Authentications that can continue: publickey,keyboard-interactive\ndebug1: Trying private key: /home/xxx/.ssh/id_dsa\ndebug3: no such identity: /home/xxx/.ssh/id_dsa\ndebug2: we did not send a packet, disable method\ndebug3: authmethod_lookup keyboard-interactive\ndebug3: remaining preferred: password\ndebug3: authmethod_is_enabled keyboard-interactive\ndebug1: Next authentication method: keyboard-interactive\ndebug2: userauth_kbdint\ndebug2: we sent a keyboard-interactive packet, wait for reply\n\n\nThat's the exact same server I can connect to using the existing driver. The only variable now seems to be the version of python-paramiko you may be running. I'm running version \"1.7.7.1\" and it does support a best effort keyboard-interactive. I believe support was added since version 1.5.\n\nAlso here's the version of Cliq I've tested this against -> \"SAN/iQ Command Line Interface, v9.5.00.1215\"\n", 
            "date_created": "2012-10-05 15:19:52.889176+00:00", 
            "author": "https://api.launchpad.net/1.0/~rnirmal"
        }, 
        {
            "content": "Grizzly has no nova-volume anymore", 
            "date_created": "2012-12-13 11:02:03.723045+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }
    ], 
    "closed": "2012-12-13 11:02:05.710875+00:00"
}