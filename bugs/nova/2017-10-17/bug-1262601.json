{
    "status": "Won't Fix", 
    "last_updated": "2014-03-13 14:01:14.765549+00:00", 
    "description": "Can't do \"resize\" to instance (at least to bigger flavor) on shared storage using XenServer as hypervisor.\nAdditionaly, if fails to \"resize\", VM is crashed too, I don't get a way to restore it in OpenStack. In XenServer VM is running, but by different name:\n\nBefore - instance-00000031\nAfter - instance-00000031-orig\n\n2013-12-19 12:41:20.549 7888 ERROR nova.compute.manager [req-618c5498-3a38-4a34-a763-07e2c0c2cdeb 9ffbc08b941540c69a804ecfa4d3dc4e 76619aca43f841e0bed1a3b89ce8b426] [instance: e6903021-bdee-4f59-ad31-6cc686851eaa] Setting instance vm_state to ERROR\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa] Traceback (most recent call last):\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 4967, in _error_out_instance_on_exception\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     yield\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3021, in resize_instance\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     block_device_info)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 284, in migrate_disk_and_power_off\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     dest, instance_type, block_device_info)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 939, in migrate_disk_and_power_off\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     context, instance, dest, vm_ref, sr_path)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 882, in _migrate_disk_resizing_up\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     self._migrate_vhd(instance, vdi_uuid, dest, sr_path, seq_num)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 770, in _migrate_vhd\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     raise exception.MigrationError(reason=msg)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa] MigrationError: Migration error: Failed to transfer vhd to new host\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]\n2013-12-19 12:41:20.956 7888 ERROR nova.openstack.common.rpc.amqp [req-618c5498-3a38-4a34-a763-07e2c0c2cdeb 9ffbc08b941540c69a804ecfa4d3dc4e 76619aca43f841e0bed1a3b89ce8b426] Exception during message handling\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 353, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 90, in wrapped\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 73, in wrapped\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 243, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     pass\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 229, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 294, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 271, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 258, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3021, in resize_instance\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 284, in migrate_disk_and_power_off\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     dest, instance_type, block_device_info)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 939, in migrate_disk_and_power_off\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     context, instance, dest, vm_ref, sr_path)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 882, in _migrate_disk_resizing_up\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     self._migrate_vhd(instance, vdi_uuid, dest, sr_path, seq_num)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 770, in _migrate_vhd\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     raise exception.MigrationError(reason=msg)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp MigrationError: Migration error: Failed to transfer vhd to new host\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [
        "nova", 
        "resize", 
        "xenserver"
    ], 
    "importance": "Wishlist", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1262601", 
    "owner": "None", 
    "id": 1262601, 
    "index": 2732, 
    "openned": "2013-12-19 10:48:28.805863+00:00", 
    "created": "2013-12-19 10:48:28.805863+00:00", 
    "title": "Can't do 'resize' on shared storage", 
    "comments": [
        {
            "content": "Can't do \"resize\" to instance (at least to bigger flavor) on shared storage using XenServer as hypervisor.\nAdditionaly, if fails to \"resize\", VM is crashed too, I don't get a way to restore it in OpenStack. In XenServer VM is running, but by different name:\n\nBefore - instance-00000031\nAfter - instance-00000031-orig\n\n2013-12-19 12:41:20.549 7888 ERROR nova.compute.manager [req-618c5498-3a38-4a34-a763-07e2c0c2cdeb 9ffbc08b941540c69a804ecfa4d3dc4e 76619aca43f841e0bed1a3b89ce8b426] [instance: e6903021-bdee-4f59-ad31-6cc686851eaa] Setting instance vm_state to ERROR\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa] Traceback (most recent call last):\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 4967, in _error_out_instance_on_exception\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     yield\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3021, in resize_instance\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     block_device_info)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 284, in migrate_disk_and_power_off\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     dest, instance_type, block_device_info)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 939, in migrate_disk_and_power_off\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     context, instance, dest, vm_ref, sr_path)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 882, in _migrate_disk_resizing_up\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     self._migrate_vhd(instance, vdi_uuid, dest, sr_path, seq_num)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 770, in _migrate_vhd\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]     raise exception.MigrationError(reason=msg)\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa] MigrationError: Migration error: Failed to transfer vhd to new host\n2013-12-19 12:41:20.549 7888 TRACE nova.compute.manager [instance: e6903021-bdee-4f59-ad31-6cc686851eaa]\n2013-12-19 12:41:20.956 7888 ERROR nova.openstack.common.rpc.amqp [req-618c5498-3a38-4a34-a763-07e2c0c2cdeb 9ffbc08b941540c69a804ecfa4d3dc4e 76619aca43f841e0bed1a3b89ce8b426] Exception during message handling\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 353, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 90, in wrapped\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 73, in wrapped\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 243, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     pass\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 229, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 294, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     function(self, context, *args, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 271, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     e, sys.exc_info())\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 258, in decorated_function\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     return function(self, context, *args, **kwargs)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 3021, in resize_instance\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     block_device_info)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/driver.py\", line 284, in migrate_disk_and_power_off\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     dest, instance_type, block_device_info)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 939, in migrate_disk_and_power_off\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     context, instance, dest, vm_ref, sr_path)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 882, in _migrate_disk_resizing_up\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     self._migrate_vhd(instance, vdi_uuid, dest, sr_path, seq_num)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/virt/xenapi/vmops.py\", line 770, in _migrate_vhd\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp     raise exception.MigrationError(reason=msg)\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp MigrationError: Migration error: Failed to transfer vhd to new host\n2013-12-19 12:41:20.956 7888 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2013-12-19 10:48:28.805863+00:00", 
            "author": "https://api.launchpad.net/1.0/~martins-k"
        }, 
        {
            "content": "As shared SR I used NFS, and similar problem was there: https://ask.openstack.org/en/question/4303/instance-resizing-not-working-with-xenserver-62/\n\nSolution with ssh helps for me.", 
            "date_created": "2014-01-16 12:59:38.650458+00:00", 
            "author": "https://api.launchpad.net/1.0/~martins-k"
        }, 
        {
            "content": "Yeah, most features break when not using local storage as your SR.\n\nIf you want shared storage, use Cinder volumes, and boot from volume.\n\nAs such, this is a feature request, or a bug for better error handling.", 
            "date_created": "2014-01-29 15:35:36.117287+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }, 
        {
            "content": "Sorry, I don't see this as something we should support.\n\nIf you have a fix, I am cool with that, but its a very complicated bit of code, I would rather make simpler not more complex, for just an edge case.", 
            "date_created": "2014-03-13 14:01:13.687759+00:00", 
            "author": "https://api.launchpad.net/1.0/~johngarbutt"
        }
    ], 
    "closed": "2014-03-13 14:00:36.469656+00:00"
}