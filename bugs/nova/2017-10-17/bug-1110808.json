{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:08:55.593996+00:00", 
    "description": "A scheduler failure will lead to no instance fault being generated and nova-scheduler will print a traceback like the following:\n\n2013-01-30 13:39:24.407 WARNING nova.scheduler.driver [req-be42dcd9-3b2f-4a96-b20c-b8c04251f534 demo demo] [instance: 85354e08-e9e8-4f93-82c2-0e372271f4f8] Setting instance to ERROR state.\n2013-01-30 13:39:24.453 WARNING nova.scheduler.manager [req-be42dcd9-3b2f-4a96-b20c-b8c04251f534 demo demo] Failed to schedule_run_instance: sequence index must be integer, not 'str'\n2013-01-30 13:39:24.454 ERROR nova.openstack.common.rpc.amqp [req-be42dcd9-3b2f-4a96-b20c-b8c04251f534 demo demo] Exception during message handling2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 121, in run_instance2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     context, ex, request_spec)2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     self.gen.next()2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 109, in run_instance2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     requested_networks, is_first_time, filter_properties)2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 88, in schedule_run_instance2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     request_spec)\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/driver.py\", line 69, in handle_schedule_error2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     new_ref, ex, sys.exc_info())2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/utils.py\", line 58, in add_instance_fault_from_exc\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     'instance_uuid': instance['uuid'],2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp TypeError: sequence index must be integer, not 'str'2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp \n\nThis is due to a recent change (https://review.openstack.org/#/c/19950/) which changed the compute/utils.py:add_instance_fault_from_exc to take a mandatory parameter \"conductor\", but there are two calls in scheduler that were not modified:\n\nhttps://github.com/openstack/nova/blob/master/nova/scheduler/manager.py#L192\nhttps://github.com/openstack/nova/blob/master/nova/scheduler/driver.py#L68\n\nthis should probably be fixed to add conductor as an optional kwarg and to use db if it is not specified. Alternatively a new method could be added that doesn't use the conductor.", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1110808", 
    "owner": "https://api.launchpad.net/1.0/~danms", 
    "id": 1110808, 
    "index": 948, 
    "openned": "2013-01-30 21:40:53.441766+00:00", 
    "created": "2013-01-30 21:40:53.441766+00:00", 
    "title": "Errors in scheduler do not set instance fault", 
    "comments": [
        {
            "content": "A scheduler failure will lead to no instance fault being generated and nova-scheduler will print a traceback like the following:\n\n2013-01-30 13:39:24.407 WARNING nova.scheduler.driver [req-be42dcd9-3b2f-4a96-b20c-b8c04251f534 demo demo] [instance: 85354e08-e9e8-4f93-82c2-0e372271f4f8] Setting instance to ERROR state.\n2013-01-30 13:39:24.453 WARNING nova.scheduler.manager [req-be42dcd9-3b2f-4a96-b20c-b8c04251f534 demo demo] Failed to schedule_run_instance: sequence index must be integer, not 'str'\n2013-01-30 13:39:24.454 ERROR nova.openstack.common.rpc.amqp [req-be42dcd9-3b2f-4a96-b20c-b8c04251f534 demo demo] Exception during message handling2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 276, in _process_data2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 133, in dispatch2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 121, in run_instance2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     context, ex, request_spec)2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     self.gen.next()2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/manager.py\", line 109, in run_instance2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     requested_networks, is_first_time, filter_properties)2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/filter_scheduler.py\", line 88, in schedule_run_instance2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     request_spec)\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/scheduler/driver.py\", line 69, in handle_schedule_error2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     new_ref, ex, sys.exc_info())2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp   File \"/opt/stack/nova/nova/compute/utils.py\", line 58, in add_instance_fault_from_exc\n2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp     'instance_uuid': instance['uuid'],2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp TypeError: sequence index must be integer, not 'str'2013-01-30 13:39:24.454 TRACE nova.openstack.common.rpc.amqp \n\nThis is due to a recent change (https://review.openstack.org/#/c/19950/) which changed the compute/utils.py:add_instance_fault_from_exc to take a mandatory parameter \"conductor\", but there are two calls in scheduler that were not modified:\n\nhttps://github.com/openstack/nova/blob/master/nova/scheduler/manager.py#L192\nhttps://github.com/openstack/nova/blob/master/nova/scheduler/driver.py#L68\n\nthis should probably be fixed to add conductor as an optional kwarg and to use db if it is not specified. Alternatively a new method could be added that doesn't use the conductor.", 
            "date_created": "2013-01-30 21:40:53.441766+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/20843", 
            "date_created": "2013-01-30 23:27:34.038011+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/20843\nCommitted: http://github.com/openstack/nova/commit/57154884c47143bfd6101d4b758d5e8d45966622\nSubmitter: Jenkins\nBranch:    master\n\ncommit 57154884c47143bfd6101d4b758d5e8d45966622\nAuthor: Dan Smith <email address hidden>\nDate:   Wed Jan 30 18:22:45 2013 -0500\n\n    Make scheduler modules pass conductor to add_instance_fault\n    \n    The add_instance_fault_from_exc() method was recently changed to\n    take a conductor to avoid direct database access. The scheduler was\n    not updated for this, and thus was not passing it in a couple of\n    cases.\n    \n    This makes those calls pass a conductor LocalAPI, resulting in direct\n    database access (which is desired from the scheduler). The tests that\n    one might have thought would catch this didn't because they mock out\n    the method itself. This fixes those and adds two tests that exercise\n    the add_instance_fault path all the way down to the DB API, which\n    would have caught it in the first place.\n    \n    Fixes bug 1110808\n    \n    Change-Id: If1c2988487d408a39fdf4080541f58f6bdac216c\n", 
            "date_created": "2013-01-31 03:17:23.744490+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-02-21 08:50:50.908364+00:00"
}