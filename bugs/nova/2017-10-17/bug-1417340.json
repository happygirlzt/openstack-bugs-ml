{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:21:45.838765+00:00", 
    "description": "The hypervisor statistics reported through nova hypervisor-stats is wrong if there are other nova services running on the compute node, output below:\n\n$ nova hypervisor-stats\n+----------------------+-------+\n| Property             | Value |\n+----------------------+-------+\n| count                | 5     |\n| current_workload     | 0     |\n| disk_available_least | 395   |\n| free_disk_gb         | 455   |\n| free_ram_mb          | 34160 |\n| local_gb             | 455   |\n| local_gb_used        | 0     |\n| memory_mb            | 39920 |\n| memory_mb_used       | 5760  |\n| running_vms          | 15    |\n| vcpus                | 20    |\n| vcpus_used           | 15    |\n+----------------------+-------+\n\nBut i only have 3 instances launched, and 1 hypervisor with 4 vcpus... seems like the result is multiplied by 5.\n\n$ nova hypervisor-list\n+----+---------------------+\n| ID | Hypervisor hostname |\n+----+---------------------+\n| 1  | holly               |\n+----+---------------------+\n\n$ nova hypervisor-show 1\n+---------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                  | Value                                                                                                                                                                                                                                                                                                                                                                   |\n+---------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| cpu_info_arch             | x86_64                                                                                                                                                                                                                                                                                                                                                                  |\n| cpu_info_features         | [\"pge\", \"clflush\", \"sep\", \"syscall\", \"vme\", \"dtes64\", \"tsc\", \"xsave\", \"vmx\", \"xtpr\", \"cmov\", \"ssse3\", \"est\", \"pat\", \"monitor\", \"lm\", \"msr\", \"nx\", \"fxsr\", \"tm\", \"sse4.1\", \"pae\", \"acpi\", \"de\", \"mmx\", \"osxsave\", \"cx8\", \"mce\", \"mtrr\", \"ht\", \"pse\", \"lahf_lm\", \"pdcm\", \"mca\", \"apic\", \"sse\", \"ds\", \"pni\", \"tm2\", \"sse2\", \"ss\", \"pbe\", \"fpu\", \"cx16\", \"pse36\", \"ds_cpl\"] |\n| cpu_info_model            | Penryn                                                                                                                                                                                                                                                                                                                                                                  |\n| cpu_info_topology_cores   | 4                                                                                                                                                                                                                                                                                                                                                                       |\n| cpu_info_topology_sockets | 1                                                                                                                                                                                                                                                                                                                                                                       |\n| cpu_info_topology_threads | 1                                                                                                                                                                                                                                                                                                                                                                       |\n| cpu_info_vendor           | Intel                                                                                                                                                                                                                                                                                                                                                                   |\n| current_workload          | 0                                                                                                                                                                                                                                                                                                                                                                       |\n| disk_available_least      | 79                                                                                                                                                                                                                                                                                                                                                                      |\n| free_disk_gb              | 91                                                                                                                                                                                                                                                                                                                                                                      |\n| free_ram_mb               | 6832                                                                                                                                                                                                                                                                                                                                                                    |\n| host_ip                   | 192.168.70.11                                                                                                                                                                                                                                                                                                                                                           |\n| hypervisor_hostname       | holly                                                                                                                                                                                                                                                                                                                                                                   |\n| hypervisor_type           | QEMU                                                                                                                                                                                                                                                                                                                                                                    |\n| hypervisor_version        | 2000000                                                                                                                                                                                                                                                                                                                                                                 |\n| id                        | 1                                                                                                                                                                                                                                                                                                                                                                       |\n| local_gb                  | 91                                                                                                                                                                                                                                                                                                                                                                      |\n| local_gb_used             | 0                                                                                                                                                                                                                                                                                                                                                                       |\n| memory_mb                 | 7984                                                                                                                                                                                                                                                                                                                                                                    |\n| memory_mb_used            | 1152                                                                                                                                                                                                                                                                                                                                                                    |\n| running_vms               | 3                                                                                                                                                                                                                                                                                                                                                                       |\n| service_disabled_reason   | -                                                                                                                                                                                                                                                                                                                                                                       |\n| service_host              | holly                                                                                                                                                                                                                                                                                                                                                                   |\n| service_id                | 5                                                                                                                                                                                                                                                                                                                                                                       |\n| state                     | up                                                                                                                                                                                                                                                                                                                                                                      |\n| status                    | enabled                                                                                                                                                                                                                                                                                                                                                                 |\n| vcpus                     | 4                                                                                                                                                                                                                                                                                                                                                                       |\n| vcpus_used                | 3                                                                                                                                                                                                                                                                                                                                                                       |\n+---------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+", 
    "tags": [
        "compute", 
        "low-hanging-fruit"
    ], 
    "importance": "High", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1417340", 
    "owner": "https://api.launchpad.net/1.0/~liyingjun", 
    "id": 1417340, 
    "index": 1682, 
    "openned": "2015-02-03 01:37:51.896784+00:00", 
    "created": "2015-02-03 01:37:51.896784+00:00", 
    "title": "Wrong hypervisor statistics reported", 
    "comments": [
        {
            "content": "The hypervisor statistics reported through nova hypervisor-stats is wrong, output below:\n\n$ nova hypervisor-stats\n+----------------------+-------+\n| Property             | Value |\n+----------------------+-------+\n| count                | 5     |\n| current_workload     | 0     |\n| disk_available_least | 395   |\n| free_disk_gb         | 455   |\n| free_ram_mb          | 34160 |\n| local_gb             | 455   |\n| local_gb_used        | 0     |\n| memory_mb            | 39920 |\n| memory_mb_used       | 5760  |\n| running_vms          | 15    |\n| vcpus                | 20    |\n| vcpus_used           | 15    |\n+----------------------+-------+\n\nBut i only have 3 instances launched, and 1 hypervisor with 4 vcpus... seems like the result is multiplied by 5.\n\n$ nova hypervisor-list\n+----+---------------------+\n| ID | Hypervisor hostname |\n+----+---------------------+\n| 1  | holly               |\n+----+---------------------+\n\n$ nova hypervisor-show 1\n+---------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                  | Value                                                                                                                                                                                                                                                                                                                                                                   |\n+---------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| cpu_info_arch             | x86_64                                                                                                                                                                                                                                                                                                                                                                  |\n| cpu_info_features         | [\"pge\", \"clflush\", \"sep\", \"syscall\", \"vme\", \"dtes64\", \"tsc\", \"xsave\", \"vmx\", \"xtpr\", \"cmov\", \"ssse3\", \"est\", \"pat\", \"monitor\", \"lm\", \"msr\", \"nx\", \"fxsr\", \"tm\", \"sse4.1\", \"pae\", \"acpi\", \"de\", \"mmx\", \"osxsave\", \"cx8\", \"mce\", \"mtrr\", \"ht\", \"pse\", \"lahf_lm\", \"pdcm\", \"mca\", \"apic\", \"sse\", \"ds\", \"pni\", \"tm2\", \"sse2\", \"ss\", \"pbe\", \"fpu\", \"cx16\", \"pse36\", \"ds_cpl\"] |\n| cpu_info_model            | Penryn                                                                                                                                                                                                                                                                                                                                                                  |\n| cpu_info_topology_cores   | 4                                                                                                                                                                                                                                                                                                                                                                       |\n| cpu_info_topology_sockets | 1                                                                                                                                                                                                                                                                                                                                                                       |\n| cpu_info_topology_threads | 1                                                                                                                                                                                                                                                                                                                                                                       |\n| cpu_info_vendor           | Intel                                                                                                                                                                                                                                                                                                                                                                   |\n| current_workload          | 0                                                                                                                                                                                                                                                                                                                                                                       |\n| disk_available_least      | 79                                                                                                                                                                                                                                                                                                                                                                      |\n| free_disk_gb              | 91                                                                                                                                                                                                                                                                                                                                                                      |\n| free_ram_mb               | 6832                                                                                                                                                                                                                                                                                                                                                                    |\n| host_ip                   | 192.168.70.11                                                                                                                                                                                                                                                                                                                                                           |\n| hypervisor_hostname       | holly                                                                                                                                                                                                                                                                                                                                                                   |\n| hypervisor_type           | QEMU                                                                                                                                                                                                                                                                                                                                                                    |\n| hypervisor_version        | 2000000                                                                                                                                                                                                                                                                                                                                                                 |\n| id                        | 1                                                                                                                                                                                                                                                                                                                                                                       |\n| local_gb                  | 91                                                                                                                                                                                                                                                                                                                                                                      |\n| local_gb_used             | 0                                                                                                                                                                                                                                                                                                                                                                       |\n| memory_mb                 | 7984                                                                                                                                                                                                                                                                                                                                                                    |\n| memory_mb_used            | 1152                                                                                                                                                                                                                                                                                                                                                                    |\n| running_vms               | 3                                                                                                                                                                                                                                                                                                                                                                       |\n| service_disabled_reason   | -                                                                                                                                                                                                                                                                                                                                                                       |\n| service_host              | holly                                                                                                                                                                                                                                                                                                                                                                   |\n| service_id                | 5                                                                                                                                                                                                                                                                                                                                                                       |\n| state                     | up                                                                                                                                                                                                                                                                                                                                                                      |\n| status                    | enabled                                                                                                                                                                                                                                                                                                                                                                 |\n| vcpus                     | 4                                                                                                                                                                                                                                                                                                                                                                       |\n| vcpus_used                | 3                                                                                                                                                                                                                                                                                                                                                                       |\n+---------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+", 
            "date_created": "2015-02-03 01:37:51.896784+00:00", 
            "author": "https://api.launchpad.net/1.0/~liyingjun"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/152372", 
            "date_created": "2015-02-03 02:37:20.651222+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/152372\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=968275f1efe27821fab0b949353ddd7e6fcec583\nSubmitter: Jenkins\nBranch:    master\n\ncommit 968275f1efe27821fab0b949353ddd7e6fcec583\nAuthor: liyingjun <email address hidden>\nDate:   Tue Feb 3 10:11:29 2015 +0800\n\n    Fixes logic in compute_node_statistics\n    \n    The filter is wrong in compute_node_statistics, currently, if there\n    are other nova services in the compute node, the statistics will be\n    caculated multiplied by services count, because it didn't filter\n    out the nova-compute services. Fix the bug by adding a filter\n    'models.Service.binary == \"nova-compute\"' in query.\n    \n    Change-Id: Icc16e92e61594e8700608006f56c45d424d1edf9\n    Closes-bug: #1417340\n", 
            "date_created": "2015-02-18 07:39:59.899101+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-03-20 07:37:33.058695+00:00"
}