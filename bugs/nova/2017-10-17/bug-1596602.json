{
    "status": "Fix Released", 
    "last_updated": "2016-09-02 01:15:32.451699+00:00", 
    "description": "Description\n===========\nAttempted to take a snapshot of a suspended server through the CLI, but the command failed. (Nova log stack trace appended below)\n\nSteps to reproduce\n==================\n1. Created a server instance:\n   $ nova boot --image <image> --flavor m1.tiny snapshotvm\n2. Suspended the server:\n   $ openstack server suspend <instance>\n3. Attempt to create server snapshot:\n   $ nova image-create snapshotvm snapshotimage --poll\n\nExpected result\n===============\nExpected to have a snapshot of my instance created in the image list.\n\nActual result\n=============\nReceived following error output from the image create command:\n\n# nova image-create snapshotvm snapshotimage --poll\n\nServer snapshotting... 25% complete\nERROR (NotFound): Image not found. (HTTP 404) (Request-ID: req-4670eba3-a0d5-4814-b0a8-4aba37a1dd3a)\n\nEnvironment\n===========\n1. Running from master level of Openstack\n\n2. Using KVM virtualization on Ubuntu 14.04:\n# kvm --version\nQEMU emulator version 2.0.0 (Debian 2.0.0+dfsg-2ubuntu1.24), Copyright (c) 2003-2008 Fabrice Bellard\n\n2. Which storage type did you use?\n   LVM\n\n3. Which networking type did you use?\n   Neutron\n\n\n\n2016-06-27 15:04:21.361 10781 INFO nova.compute.manager [req-f393be05-96c2-4d52-bfc1-0c5b644c553e d672d690e856437196a748ebc85abb41 b9b13412e4fd4fd6a6016368b720309e - - -] [instance: ab71489a-0716-404b-808a-165f2a85af74] Successfully reverted task state from image_uploading on failure for instance.\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server [req-f393be05-96c2-4d52-bfc1-0c5b644c553e d672d690e856437196a748ebc85abb41 b9b13412e4fd4fd6a6016368b720309e - - -] Exception during message handling\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/exception.py\", line 104, in wrapped\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     payload)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/exception.py\", line 83, in wrapped\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 183, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     LOG.warning(msg, e, instance=instance)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 152, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 211, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 199, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 259, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     instance=instance)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 249, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     *args, **kwargs)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 2983, in snapshot_instance\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     task_states.IMAGE_SNAPSHOT)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 3013, in _snapshot_instance\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     update_task_state)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1549, in snapshot\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     image_file)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/api.py\", line 130, in update\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     purge_props=purge_props)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 694, in update\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     _reraise_translated_image_exception(image_id)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 1019, in _reraise_translated_image_exception\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(new_exc, None, exc_trace)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 692, in update\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     image = self._update_v2(context, sent_service_image_meta, data)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 702, in _update_v2\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     context, 2, 'update', **sent_service_image_meta)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 174, in call\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     result = getattr(client.images, method)(*args, **kwargs)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/glanceclient/v2/images.py\", line 264, in update\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     raise TypeError(encodeutils.exception_to_unicode(e))\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server TypeError: Unable to set 'kernel_id' to 'None'. Reason: None is not of type u'string'\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server \n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server Failed validating u'type' in schema[u'additionalProperties']:\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     {u'type': u'string'}\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server \n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server On instance['kernel_id']:\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     None\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1596602", 
    "owner": "https://api.launchpad.net/1.0/~mfedosin", 
    "id": 1596602, 
    "index": 4564, 
    "openned": "2016-07-27 17:02:12.242325+00:00", 
    "created": "2016-06-27 16:21:34.559524+00:00", 
    "title": "Instance Snapshot failure: 'Unable to set 'kernel_id' to 'None'. Reason: None is not of type u'string''", 
    "comments": [
        {
            "content": "Description\n===========\nAttempted to take a snapshot of a suspended server through the CLI, but the command failed. (Nova log stack trace appended below)\n\nSteps to reproduce\n==================\n1. Created a server instance:\n   $ nova boot --image <image> --flavor m1.tiny snapshotvm\n2. Suspended the server:\n   $ openstack server suspend <instance>\n3. Attempt to create server snapshot:\n   $ nova image-create snapshotvm snapshotimage --poll\n\nExpected result\n===============\nExpected to have a snapshot of my instance created in the image list.\n\nActual result\n=============\nReceived following error output from the image create command:\n\n# nova image-create snapshotvm snapshotimage --poll\n\nServer snapshotting... 25% complete\nERROR (NotFound): Image not found. (HTTP 404) (Request-ID: req-4670eba3-a0d5-4814-b0a8-4aba37a1dd3a)\n\nEnvironment\n===========\n1. Running from master level of Openstack\n\n2. Using KVM virtualization on Ubuntu 14.04:\n# kvm --version\nQEMU emulator version 2.0.0 (Debian 2.0.0+dfsg-2ubuntu1.24), Copyright (c) 2003-2008 Fabrice Bellard\n\n2. Which storage type did you use?\n   LVM\n\n3. Which networking type did you use?\n   Neutron\n\n\n\n2016-06-27 15:04:21.361 10781 INFO nova.compute.manager [req-f393be05-96c2-4d52-bfc1-0c5b644c553e d672d690e856437196a748ebc85abb41 b9b13412e4fd4fd6a6016368b720309e - - -] [instance: ab71489a-0716-404b-808a-165f2a85af74] Successfully reverted task state from image_uploading on failure for instance.\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server [req-f393be05-96c2-4d52-bfc1-0c5b644c553e d672d690e856437196a748ebc85abb41 b9b13412e4fd4fd6a6016368b720309e - - -] Exception during message handling\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server Traceback (most recent call last):\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 133, in _process_incoming\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 150, in dispatch\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 121, in _do_dispatch\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/exception.py\", line 104, in wrapped\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     payload)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/exception.py\", line 83, in wrapped\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     return f(self, context, *args, **kw)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 183, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     LOG.warning(msg, e, instance=instance)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 152, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 211, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     kwargs['instance'], e, sys.exc_info())\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 199, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     return function(self, context, *args, **kwargs)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 259, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     instance=instance)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 221, in __exit__\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     self.force_reraise()\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 197, in force_reraise\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(self.type_, self.value, self.tb)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 249, in decorated_function\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     *args, **kwargs)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 2983, in snapshot_instance\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     task_states.IMAGE_SNAPSHOT)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\", line 3013, in _snapshot_instance\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     update_task_state)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 1549, in snapshot\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     image_file)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/api.py\", line 130, in update\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     purge_props=purge_props)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 694, in update\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     _reraise_translated_image_exception(image_id)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 1019, in _reraise_translated_image_exception\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     six.reraise(new_exc, None, exc_trace)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 692, in update\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     image = self._update_v2(context, sent_service_image_meta, data)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 702, in _update_v2\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     context, 2, 'update', **sent_service_image_meta)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/nova/image/glance.py\", line 174, in call\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     result = getattr(client.images, method)(*args, **kwargs)\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server   File \"/opt/bbc/openstack-11.0-master/nova/local/lib/python2.7/site-packages/glanceclient/v2/images.py\", line 264, in update\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     raise TypeError(encodeutils.exception_to_unicode(e))\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server TypeError: Unable to set 'kernel_id' to 'None'. Reason: None is not of type u'string'\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server \n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server Failed validating u'type' in schema[u'additionalProperties']:\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     {u'type': u'string'}\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server \n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server On instance['kernel_id']:\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server     None\n2016-06-27 15:04:21.364 10781 ERROR oslo_messaging.rpc.server", 
            "date_created": "2016-06-27 16:21:34.559524+00:00", 
            "author": "https://api.launchpad.net/1.0/~bvanhav"
        }, 
        {
            "content": "", 
            "date_created": "2016-06-27 16:21:34.559524+00:00", 
            "author": "https://api.launchpad.net/1.0/~bvanhav"
        }, 
        {
            "content": "This is the failure:\n\nUnable to set 'kernel_id' to 'None'. Reason: None is not of type u'string'\n\nI think there is a duplicate bug for this, checking.", 
            "date_created": "2016-06-27 21:47:08.830224+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Are you sure this is master of nova? Can you post the commit hash of the nova code you're running?", 
            "date_created": "2016-06-27 21:48:30.277924+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Bug 1592808 is the duplicate I'm thinking of.", 
            "date_created": "2016-06-27 21:51:06.338830+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I checked my code base and https://review.openstack.org/#/c/329981 is included in my Openstack instance. So this is a separate problem from Bug 1592808.", 
            "date_created": "2016-06-28 12:31:42.104524+00:00", 
            "author": "https://api.launchpad.net/1.0/~bvanhav"
        }, 
        {
            "content": "Talking with Mike Fedosin on IRC it sounds like this might be a known issue in python-glanceclient.", 
            "date_created": "2016-06-28 14:59:13.784723+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Rerouted to python-glanceclient at request of Mike Fedosin.", 
            "date_created": "2016-06-28 15:12:42.484916+00:00", 
            "author": "https://api.launchpad.net/1.0/~bvanhav"
        }, 
        {
            "content": "OK so now I get this, the problem isn't in the image properties, the problem is in the metadata that nova tells glance to use to create the image, which is based in part on the instance's values, e.g.:\n\nmysql> select kernel_id,ramdisk_id from nova.instances where uuid='e4bbbbd3-49be-4a44-9969-088c8f3b36ca';\n+-----------+------------+\n| kernel_id | ramdisk_id |\n+-----------+------------+\n|           |            |\n+-----------+------------+\n1 row in set (0.00 sec)\n", 
            "date_created": "2016-07-16 02:38:54.946008+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "https://github.com/openstack/nova/blob/47358449d359a287d21426b4e1f18479a4d1fd36/nova/compute/api.py#L867-L868", 
            "date_created": "2016-07-16 02:42:13.973117+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "We don't fail in the openstack CI system because for the libvirt driver, devstack uses a cirros image that has kernel_id and ramdisk_id properties set:\n\nhttps://github.com/openstack-dev/devstack/blob/master/stackrc#L647", 
            "date_created": "2016-07-16 07:40:26.328791+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "http://lists.openstack.org/pipermail/openstack-dev/2016-July/099386.html", 
            "date_created": "2016-07-16 08:11:14.173767+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "This should be fixed by https://review.openstack.org/#/c/335152/.", 
            "date_created": "2016-07-16 12:59:14.629540+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "https://review.openstack.org/#/c/335152/ doesn't fix this.", 
            "date_created": "2016-07-20 20:33:05.919246+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "We also talked about this with mfedosin in Nova IRC here:\n\nhttp://eavesdrop.openstack.org/irclogs/%23openstack-nova/%23openstack-nova.2016-06-28.log.html", 
            "date_created": "2016-07-20 20:36:54.963791+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "mfedosin pointed out this change which might be impacting this:\n\nhttps://review.openstack.org/#/c/229560/", 
            "date_created": "2016-07-20 20:39:59.325826+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "https://review.openstack.org/#/c/229560/ looks to only not validate schema for the GETs\n\nI think the issue is that we are setting None for kernel and ramdisk prop values and the default schema (that you are using as per paste) expects a string. So, we should change https://review.openstack.org/#/c/329981/4/nova/image/glance.py@850 to '' (null string) rather than a python None.\n\nThoughts?", 
            "date_created": "2016-07-20 23:59:32.412884+00:00", 
            "author": "https://api.launchpad.net/1.0/~nikhil-komawar"
        }, 
        {
            "content": "I'm not able to reproduce this with devstack.\n\nI booted an instance with a full disk image (no kernel_id or ramdisk_id properties set):\n\nstack@list:~/devstack$ nova show e150bbb2-037a-4255-ba34-995aa2fb6709\n+--------------------------------------+-----------------------------------------------------------------+\n| Property                             | Value                                                           |\n+--------------------------------------+-----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                          |\n| OS-EXT-AZ:availability_zone          | nova                                                            |\n| OS-EXT-SRV-ATTR:host                 | list                                                            |\n| OS-EXT-SRV-ATTR:hostname             | full-disk-img                                                   |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | list                                                            |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000001                                               |\n| OS-EXT-SRV-ATTR:kernel_id            |                                                                 |\n| OS-EXT-SRV-ATTR:launch_index         | 0                                                               |\n| OS-EXT-SRV-ATTR:ramdisk_id           |                                                                 |\n| OS-EXT-SRV-ATTR:reservation_id       | r-royqzdyj                                                      |\n| OS-EXT-SRV-ATTR:root_device_name     | /dev/vda                                                        |\n| OS-EXT-SRV-ATTR:user_data            | -                                                               |\n| OS-EXT-STS:power_state               | 1                                                               |\n| OS-EXT-STS:task_state                | -                                                               |\n| OS-EXT-STS:vm_state                  | active                                                          |\n| OS-SRV-USG:launched_at               | 2016-07-23T15:28:26.000000                                      |\n| OS-SRV-USG:terminated_at             | -                                                               |\n| accessIPv4                           |                                                                 |\n| accessIPv6                           |                                                                 |\n| config_drive                         | True                                                            |\n| created                              | 2016-07-23T15:28:17Z                                            |\n| description                          | -                                                               |\n| flavor                               | m1.tiny (1)                                                     |\n| hostId                               | efd1c8cdb0ef1070c1f74cff9704179f6211c7ab7f183b788b8a6a19        |\n| host_status                          | UP                                                              |\n| id                                   | e150bbb2-037a-4255-ba34-995aa2fb6709                            |\n| image                                | cirros-0.3.4-x86_64-disk (49e684da-66c3-44f3-b4c8-37b71693b6f1) |\n| key_name                             | -                                                               |\n| locked                               | False                                                           |\n| metadata                             | {}                                                              |\n| name                                 | full-disk-img                                                   |\n| os-extended-volumes:volumes_attached | []                                                              |\n| progress                             | 0                                                               |\n| public network                       | 2001:db8::8, 172.24.4.12                                        |\n| security_groups                      | default                                                         |\n| status                               | ACTIVE                                                          |\n| tags                                 | []                                                              |\n| tenant_id                            | 50083aa7e21c4ddd8d20d779a177b8e5                                |\n| updated                              | 2016-07-23T15:34:57Z                                            |\n| user_id                              | 72e107ec178a4ec799ab93ce5aa44c67                                |\n+--------------------------------------+-----------------------------------------------------------------+\nstack@list:~/devstack$\n\n\nstack@list:~/devstack$ glance image-show 49e684da-66c3-44f3-b4c8-37b71693b6f1\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | ee1eca47dc88f4879d8a229cc70a07c6     |\n| container_format | bare                                 |\n| created_at       | 2016-07-23T15:26:42Z                 |\n| disk_format      | qcow2                                |\n| id               | 49e684da-66c3-44f3-b4c8-37b71693b6f1 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | cirros-0.3.4-x86_64-disk             |\n| owner            | 50083aa7e21c4ddd8d20d779a177b8e5     |\n| protected        | False                                |\n| size             | 13287936                             |\n| status           | active                               |\n| tags             | []                                   |\n| updated_at       | 2016-07-23T15:26:43Z                 |\n| virtual_size     | None                                 |\n| visibility       | public                               |\n+------------------+--------------------------------------+\n\n\nI verified there is no kernel_id or ramdisk_id set for the instance in the DB:\n\nmysql> select kernel_id,ramdisk_id from nova.instances where uuid='e150bbb2-037a-4255-ba34-995aa2fb6709';\n+-----------+------------+\n| kernel_id | ramdisk_id |\n+-----------+------------+\n|           |            |\n+-----------+------------+\n1 row in set (0.00 sec)\n\n\nAnd I was able to snapshot the instance:\n\nstack@list:~/devstack$ nova image-create --poll --show e150bbb2-037a-4255-ba34-995aa2fb6709 full-disk-img-snapshot\n\nServer snapshotting... 100% complete\nFinished\n+-------------------------+--------------------------------------+\n| Property                | Value                                |\n+-------------------------+--------------------------------------+\n| OS-EXT-IMG-SIZE:size    | 22085632                             |\n| created                 | 2016-07-23T15:33:41Z                 |\n| id                      | 759c4c0f-21fa-4eb2-b3d2-5cf1cd434335 |\n| metadata base_image_ref | 49e684da-66c3-44f3-b4c8-37b71693b6f1 |\n| metadata image_location | snapshot                             |\n| metadata image_state    | available                            |\n| metadata image_type     | snapshot                             |\n| metadata instance_uuid  | e150bbb2-037a-4255-ba34-995aa2fb6709 |\n| metadata kernel_id      | -                                    |\n| metadata owner_id       | 50083aa7e21c4ddd8d20d779a177b8e5     |\n| metadata ramdisk_id     | -                                    |\n| metadata user_id        | 72e107ec178a4ec799ab93ce5aa44c67     |\n| minDisk                 | 1                                    |\n| minRam                  | 0                                    |\n| name                    | full-disk-img-snapshot               |\n| progress                | 100                                  |\n| server                  | e150bbb2-037a-4255-ba34-995aa2fb6709 |\n| status                  | ACTIVE                               |\n| updated                 | 2016-07-23T15:33:46Z                 |\n+-------------------------+--------------------------------------+\nstack@list:~/devstack$\nstack@list:~/devstack$ nova image-list\nWARNING: Command image-list is deprecated and will be removed after Nova 15.0.0 is released. Use python-glanceclient or openstackclient instead.\n+--------------------------------------+---------------------------------+--------+--------------------------------------+\n| ID                                   | Name                            | Status | Server                               |\n+--------------------------------------+---------------------------------+--------+--------------------------------------+\n| 49e684da-66c3-44f3-b4c8-37b71693b6f1 | cirros-0.3.4-x86_64-disk        | ACTIVE |                                      |\n| d941313a-177a-498e-b9fb-d031f8055cf6 | cirros-0.3.4-x86_64-uec         | ACTIVE |                                      |\n| 5ba6907f-81b6-4610-8d1c-8e7b6321e7f5 | cirros-0.3.4-x86_64-uec-kernel  | ACTIVE |                                      |\n| 28fa5e52-f6d3-4240-a180-7276b04827a2 | cirros-0.3.4-x86_64-uec-ramdisk | ACTIVE |                                      |\n| 759c4c0f-21fa-4eb2-b3d2-5cf1cd434335 | full-disk-img-snapshot          | ACTIVE | e150bbb2-037a-4255-ba34-995aa2fb6709 |\n+--------------------------------------+---------------------------------+--------+--------------------------------------+\n\n\nI was able to do this with python-glanceclient 2.1.0 and python-glanceclient 2.2.0 (so before and after the schema fix in the client for this bug).\n\nThis is the version of nova:\n\nstack@list:/opt/stack/nova$ git log -1\ncommit 8f5c2c0447886c6a2877ea9ca6484045d5597dd9\nMerge: 8e51a65 c2dd3cd\nAuthor: Jenkins <email address hidden>\nDate:   Thu Jul 7 15:40:40 2016 +0000\n\n    Merge \"Quota changes for the nova-manage quota_usage_refresh command\"\n", 
            "date_created": "2016-07-23 15:38:29.300324+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I also have a devstack patch up to use a full disk image for our default config and see if I can reproduce it in the CI system:\n\nhttps://review.openstack.org/#/c/346420/", 
            "date_created": "2016-07-23 15:42:51.946249+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Hmm, when we update the snapshot image (and upload the snapshot), why do we specify version 1 when constructing the client?\n\nhttps://github.com/openstack/nova/blob/3f8076acdc7756b8a5f0f16d4885a47cb001483e/nova/image/glance.py#L406", 
            "date_created": "2016-07-23 16:39:21.556427+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Ignore comment 19, I was looking at the wrong GlanceImageService in nova.image.glance.", 
            "date_created": "2016-07-23 16:46:13.461033+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Related bug: https://bugs.launchpad.net/python-glanceclient/+bug/1447193", 
            "date_created": "2016-07-23 18:22:29.485485+00:00", 
            "author": "https://api.launchpad.net/1.0/~nikhil-komawar"
        }, 
        {
            "content": "Another related bug: https://bugs.launchpad.net/glance/+bug/1447215", 
            "date_created": "2016-07-23 18:28:02.569019+00:00", 
            "author": "https://api.launchpad.net/1.0/~nikhil-komawar"
        }, 
        {
            "content": "I missed the part where the schema allows type: [\"null\", \"string\"]\n\nIf that's set, I think it should work and also from the above two bug reports, it should be expected to work the way it is suggested in the latest schema.", 
            "date_created": "2016-07-23 18:29:03.702965+00:00", 
            "author": "https://api.launchpad.net/1.0/~nikhil-komawar"
        }, 
        {
            "content": "Any updates here?", 
            "date_created": "2016-07-27 02:24:40.388744+00:00", 
            "author": "https://api.launchpad.net/1.0/~nikhil-komawar"
        }, 
        {
            "content": "So the problem it looks like is we don't deploy this file:\n\nhttps://raw.githubusercontent.com/openstack/glance/master/etc/schema-image.json\n\nTo /etc/glance/ on our glance-api (controller) nodes. That defines the schema for kernel_id and ramdisk_id (among other things). It's deployed with devstack which is why we don't see issues in the upstream CI:\n\nhttp://logs.openstack.org/77/335277/1/check/gate-tempest-dsvm-full/de259ec/logs/etc/glance/schema-image.json.txt.gz\n\nThe schema we have in our cloud is this:\n\nhttp://paste.openstack.org/show/542625/\n\nWith:\n\n   \"additionalProperties\":{\n      \"type\":\"string\"\n   },\n\nSo if you pass kernel_id and ramdisk_id, they must not be None, but that's what nova sends:\n\nhttps://github.com/openstack/nova/blob/3f8076acdc7756b8a5f0f16d4885a47cb001483e/nova/image/glance.py#L844\n\nBasically the glance API, or the image schema at least, is completely configurable and nova isn't using the schema from glance to tell what properties it can and can't set in the image body on the request to glance.\n\nSo this is a bug in nova now to use the schema from glance.\n", 
            "date_created": "2016-07-27 17:01:56.427447+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "For this specific bug with kernel_id and ramdisk_id, the easiest fix is to just not provide them if they are not set, so continue here:\n\nhttps://github.com/openstack/nova/blob/master/nova/image/glance.py#L852", 
            "date_created": "2016-07-27 17:10:46.967696+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/347971\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=2f2b0e954d7738c2bf49a48a708cc0ce2b19e726\nSubmitter: Jenkins\nBranch:    master\n\ncommit 2f2b0e954d7738c2bf49a48a708cc0ce2b19e726\nAuthor: Mike Fedosin <email address hidden>\nDate:   Wed Jul 27 20:34:41 2016 +0300\n\n    Don't set empty kernel_id and ramdisk_id to glance image\n    \n    In some cases, if 'allow_additional_properties' option is\n    disabled in Glance, 'kernel_id' and 'ramdisk_id' are considered\n    the usual properties and cannot have None values. So it's better\n    always omit these props and never send them to Glance if they are\n    empty.\n    \n    Change-Id: I3dd2a3f39d31a79c86bdbe7b656d42c20c560af3\n    Closes-bug: #1596602\n", 
            "date_created": "2016-07-27 22:41:40.977677+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0b3 development milestone.", 
            "date_created": "2016-09-02 01:15:31.739085+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-07-27 22:41:38.009685+00:00"
}