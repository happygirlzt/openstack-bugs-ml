{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:26:01.529102+00:00", 
    "description": "When applying an IP address filter to a servers query, the IP address\nfiltering is manually applied in the compute API against the servers that are\nretrieved from the DB.\n\nThe problem is when a limit is supplied; in this case, the IP address filter\nis only applied to the page of servers that are returned from the DB. For\nexample, assume that you have 3 instances that match a given IP address filter\nand that those instances are returned from the DB in the 5th, 20th, and 100th\npositions. If you supply this IP address filter with a limit of 10, then only\na single server is returned (the one in the 5th position). In this case, all\n3 instances should have been returned.\n\nA simple example (note that I manually added --limit to the CLI):\n\n* List all 3 serves:\n\n $ nova list --sort display_name:asc\n +--------------------------------------+-----------+------------------+\n | ID                                   | Name      | Networks         |\n +--------------------------------------+-----------+------------------+\n | 65515d56-6103-43dd-ac58-238baabda422 | Instance1 | private=10.0.0.2 |\n | c9ab681f-e930-4e4e-814d-d6f1cf084480 | Instance2 | private=10.0.0.3 |\n | f1d6d9ef-e31d-46b5-86a2-da34b45007b0 | Instance3 | private=10.0.0.4 |\n +--------------------------------------+-----------+------------------+\n\n* Limit the list to a page size of 1:\n \n $ nova list --sort display_name:asc --limit 1\n +--------------------------------------+-----------+------------------+\n | ID                                   | Name      | Networks         |\n +--------------------------------------+-----------+------------------+\n | 65515d56-6103-43dd-ac58-238baabda422 | Instance1 | private=10.0.0.2 |\n +--------------------------------------+-----------+------------------+\n\n* Supply only an IP address filter:\n\n $ nova list --sort display_name:asc --ip 10.0.0.3\n +--------------------------------------+-----------+------------------+\n | ID                                   | Name      | Networks         |\n +--------------------------------------+-----------+------------------+\n | c9ab681f-e930-4e4e-814d-d6f1cf084480 | Instance2 | private=10.0.0.3 |\n +--------------------------------------+-----------+------------------+\n\n* Supply both an IP address filter and a limit (should show a single server):\n\n $ nova list --sort display_name:asc --ip 10.0.0.3 --limit 1\n +----+------+----------+\n | ID | Name | Networks |\n +----+------+----------+\n +----+------+----------+", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1417649", 
    "owner": "https://api.launchpad.net/1.0/~kaufer", 
    "id": 1417649, 
    "index": 6685, 
    "openned": "2015-02-03 16:24:19.189965+00:00", 
    "created": "2015-02-03 16:24:19.189965+00:00", 
    "title": "IP filtering is not accurate when used with limit", 
    "comments": [
        {
            "content": "When applying an IP address filter to a servers query, the IP address\nfiltering is manually applied in the compute API against the servers that are\nretrieved from the DB.\n\nThe problem is when a limit is supplied; in this case, the IP address filter\nis only applied to the page of servers that are returned from the DB. For\nexample, assume that you have 3 instances that match a given IP address filter\nand that those instances are returned from the DB in the 5th, 20th, and 100th\npositions. If you supply this IP address filter with a limit of 10, then only\na single server is returned (the one in the 5th position). In this case, all\n3 instances should have been returned.\n\nA simple example (note that I manually added --limit to the CLI):\n\n* List all 3 serves:\n\n $ nova list --sort display_name:asc\n +--------------------------------------+-----------+------------------+\n | ID                                   | Name      | Networks         |\n +--------------------------------------+-----------+------------------+\n | 65515d56-6103-43dd-ac58-238baabda422 | Instance1 | private=10.0.0.2 |\n | c9ab681f-e930-4e4e-814d-d6f1cf084480 | Instance2 | private=10.0.0.3 |\n | f1d6d9ef-e31d-46b5-86a2-da34b45007b0 | Instance3 | private=10.0.0.4 |\n +--------------------------------------+-----------+------------------+\n\n* Limit the list to a page size of 1:\n \n $ nova list --sort display_name:asc --limit 1\n +--------------------------------------+-----------+------------------+\n | ID                                   | Name      | Networks         |\n +--------------------------------------+-----------+------------------+\n | 65515d56-6103-43dd-ac58-238baabda422 | Instance1 | private=10.0.0.2 |\n +--------------------------------------+-----------+------------------+\n\n* Supply only an IP address filter:\n\n $ nova list --sort display_name:asc --ip 10.0.0.3\n +--------------------------------------+-----------+------------------+\n | ID                                   | Name      | Networks         |\n +--------------------------------------+-----------+------------------+\n | c9ab681f-e930-4e4e-814d-d6f1cf084480 | Instance2 | private=10.0.0.3 |\n +--------------------------------------+-----------+------------------+\n\n* Supply both an IP address filter and a limit (should show a single server):\n\n $ nova list --sort display_name:asc --ip 10.0.0.3 --limit 1\n +----+------+----------+\n | ID | Name | Networks |\n +----+------+----------+\n +----+------+----------+", 
            "date_created": "2015-02-03 16:24:19.189965+00:00", 
            "author": "https://api.launchpad.net/1.0/~kaufer"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/152614", 
            "date_created": "2015-02-03 16:54:38.506459+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/152614\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=b6970bbaf786fe0610eb78c1063fc952d48e1a1c\nSubmitter: Jenkins\nBranch:    master\n\ncommit b6970bbaf786fe0610eb78c1063fc952d48e1a1c\nAuthor: Steven Kaufer <email address hidden>\nDate:   Tue Feb 3 16:27:46 2015 +0000\n\n    IP filtering is not accurate when used with limit\n    \n    When applying an IP address filter to a servers query, the IP address\n    filtering is manually applied in the compute API against the servers that are\n    retrieved from the DB.\n    \n    The problem is when a limit is supplied; in this case, the IP address filter\n    is only applied to the page of servers that are returned from the DB. For\n    example, assume that you have 3 instances that match a given IP address filter\n    and that those instances are returned from the DB in the 5th, 20th, and 100th\n    positions. If you supply this IP address filter with a limit of 10, then only\n    a single server is returned (the one in the 5th position). In this case, all\n    3 instances should have been returned.\n    \n    This patch set fixes this by removing the limit from the DB query (if an IP\n    address filter is supplied) and manually limiting the servers as the IP\n    address filter is being applied.\n    \n    Alternative solutions that were not chosen:\n    * Moving the IP address filtering into the DB: Too complex since the network\n      information is cached in the DB as a JSON object\n    * Determining server UUIDs that match the IP address filter and then using\n      those as a DB UUID filter: This solution was originally implemented but\n      deemed to expensive, see commit I455f6ab4acdecacc5152b11a183027f933dc4475\n    \n    DocImpact\n    Closes-bug: 1417649\n    \n    Change-Id: I6cb9feb77cf563d7aa7c3d4d2ce7e4a3e939a0bc\n", 
            "date_created": "2015-02-13 21:47:08.195453+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-03-20 07:43:48.677748+00:00"
}