{
    "status": "Invalid", 
    "last_updated": "2014-09-17 12:37:57.676482+00:00", 
    "description": "From https://github.com/openstack/nova/commit/3b1f7c55c10eec9d438a7d147aba1124b5ff9452:\n\n\"This patch removes the check in the API that prevented having block devices without 'device_name' and makes the compute manager capable of guessing those names.\"\n\nThe patch doesn't seem to work on 'nova boot' however.\n\nREQ: curl -i http://IP:8774/v2/549d075f78c045e984bb03e62f6ba91c/os-volumes_boot -X POST -H \"X-Auth-Project-Id: admin\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: REDACTED\" -d '{\"server\": {\"name\": \"chuckle\", \"imageRef\": \"61ecd9fb-58c3-42ea-9dde-65d33b7f4fce\", \"block_device_mapping\": [{\"volume_size\": \"5\", \"volume_id\": \"b7a47460-94a7-4bf6-8b83-99a50a223f35\", \"delete_on_termination\": \"1\"}], \"flavorRef\": \"9\", \"max_count\": 1, \"min_count\": 1, \"personality\": [{\"path\": \"/etc/guest_info\", \"contents\": \"W0RFRkFVTFRdCmd1ZXN0X2lkPTVjYWY4MzEyLTg5MjAtNGUwYi04NDRkLTVjM2I3NDYxOTA1ZApz\\nZXJ2aWNlX3R5cGU9bXlzcWwKdGVuYW50X2lkPTU0OWQwNzVmNzhjMDQ1ZTk4NGJiMDNlNjJmNmJh\\nOTFjCg==\\n\"}]}}'\n\nResults in (on n-api):\n\n2013-10-29 22:53:09.620 DEBUG nova.api.openstack.wsgi [req-eaa95da5-78c8-4bf3-b5b4-7c382420b82c admin admin] Action: 'create', body: {\"server\": {\"name\": \"chuckle\", \"imageRef\": \"61ecd9fb-58c3-42ea-9dde-65d33b7f4fce\", \"block_device_mapping\": [{\"volume_size\": \"5\", \"volume_id\": \"b7a47460-94a7-4bf6-8b83-99a50a223f35\", \"delete_on_termination\": \"1\"}], \"flavorRef\": \"9\", \"max_count\": 1, \"min_count\": 1, \"personality\": [{\"path\": \"/etc/guest_info\", \"contents\": \"W0RFRkFVTFRdCmd1ZXN0X2lkPTVjYWY4MzEyLTg5MjAtNGUwYi04NDRkLTVjM2I3NDYxOTA1ZApz\\nZXJ2aWNlX3R5cGU9bXlzcWwKdGVuYW50X2lkPTU0OWQwNzVmNzhjMDQ1ZTk4NGJiMDNlNjJmNmJh\\nOTFjCg==\\n\"}]}} from (pid=25304) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:940\n2013-10-29 22:53:09.620 DEBUG nova.api.openstack.wsgi [req-eaa95da5-78c8-4bf3-b5b4-7c382420b82c admin admin] Calling method <bound method Controller.create of <nova.api.openstack.compute.servers.Controller object at 0x318ccd0>> from (pid=25304) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:941\n2013-10-29 22:53:09.622 INFO nova.api.openstack.wsgi [req-eaa95da5-78c8-4bf3-b5b4-7c382420b82c admin admin] HTTP exception thrown: Block Device Mapping is Invalid: Device name empty or too long.\n2013-10-29 22:53:09.623 DEBUG nova.api.openstack.wsgi [req-eaa95da5-78c8-4bf3-b5b4-7c382420b82c admin admin] Returning 400 to user: Block Device Mapping is Invalid: Device name empty or too long. from (pid=25304) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1203\n\nThe check being performed is located at https://github.com/openstack/nova/blob/f10b93b2930a0e82eb994c9d7429213f134cd955/nova/api/openstack/compute/servers.py#L833\n\nIf the check is amended to resemble https://github.com/openstack/nova/blob/308bba10f621513c2f99b0b6bc83ff5320970f78/nova/block_device.py#L117-L118, it seems to work.\n\nI'd submit a patch-set, but the test at https://github.com/openstack/nova/blob/f10b93b2930a0e82eb994c9d7429213f134cd955/nova/tests/api/openstack/compute/test_servers.py#L2432-L2444 seems to indicate this validation is/was quite purposeful, causing me some trepidation.", 
    "tags": [
        "volumes"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1246189", 
    "owner": "None", 
    "id": 1246189, 
    "index": 5516, 
    "openned": "2013-10-30 05:19:07.605981+00:00", 
    "created": "2013-10-30 05:19:07.605981+00:00", 
    "title": "nova boot with a block-device-mapping void of a device_path fails", 
    "comments": [
        {
            "content": "From https://github.com/openstack/nova/commit/3b1f7c55c10eec9d438a7d147aba1124b5ff9452:\n\n\"This patch removes the check in the API that prevented having block devices without 'device_name' and makes the compute manager capable of guessing those names.\"\n\nThe patch doesn't seem to work on 'nova boot' however.\n\nREQ: curl -i http://IP:8774/v2/549d075f78c045e984bb03e62f6ba91c/os-volumes_boot -X POST -H \"X-Auth-Project-Id: admin\" -H \"User-Agent: python-novaclient\" -H \"Content-Type: application/json\" -H \"Accept: application/json\" -H \"X-Auth-Token: REDACTED\" -d '{\"server\": {\"name\": \"chuckle\", \"imageRef\": \"61ecd9fb-58c3-42ea-9dde-65d33b7f4fce\", \"block_device_mapping\": [{\"volume_size\": \"5\", \"volume_id\": \"b7a47460-94a7-4bf6-8b83-99a50a223f35\", \"delete_on_termination\": \"1\"}], \"flavorRef\": \"9\", \"max_count\": 1, \"min_count\": 1, \"personality\": [{\"path\": \"/etc/guest_info\", \"contents\": \"W0RFRkFVTFRdCmd1ZXN0X2lkPTVjYWY4MzEyLTg5MjAtNGUwYi04NDRkLTVjM2I3NDYxOTA1ZApz\\nZXJ2aWNlX3R5cGU9bXlzcWwKdGVuYW50X2lkPTU0OWQwNzVmNzhjMDQ1ZTk4NGJiMDNlNjJmNmJh\\nOTFjCg==\\n\"}]}}'\n\nResults in (on n-api):\n\n2013-10-29 22:53:09.620 DEBUG nova.api.openstack.wsgi [req-eaa95da5-78c8-4bf3-b5b4-7c382420b82c admin admin] Action: 'create', body: {\"server\": {\"name\": \"chuckle\", \"imageRef\": \"61ecd9fb-58c3-42ea-9dde-65d33b7f4fce\", \"block_device_mapping\": [{\"volume_size\": \"5\", \"volume_id\": \"b7a47460-94a7-4bf6-8b83-99a50a223f35\", \"delete_on_termination\": \"1\"}], \"flavorRef\": \"9\", \"max_count\": 1, \"min_count\": 1, \"personality\": [{\"path\": \"/etc/guest_info\", \"contents\": \"W0RFRkFVTFRdCmd1ZXN0X2lkPTVjYWY4MzEyLTg5MjAtNGUwYi04NDRkLTVjM2I3NDYxOTA1ZApz\\nZXJ2aWNlX3R5cGU9bXlzcWwKdGVuYW50X2lkPTU0OWQwNzVmNzhjMDQ1ZTk4NGJiMDNlNjJmNmJh\\nOTFjCg==\\n\"}]}} from (pid=25304) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:940\n2013-10-29 22:53:09.620 DEBUG nova.api.openstack.wsgi [req-eaa95da5-78c8-4bf3-b5b4-7c382420b82c admin admin] Calling method <bound method Controller.create of <nova.api.openstack.compute.servers.Controller object at 0x318ccd0>> from (pid=25304) _process_stack /opt/stack/nova/nova/api/openstack/wsgi.py:941\n2013-10-29 22:53:09.622 INFO nova.api.openstack.wsgi [req-eaa95da5-78c8-4bf3-b5b4-7c382420b82c admin admin] HTTP exception thrown: Block Device Mapping is Invalid: Device name empty or too long.\n2013-10-29 22:53:09.623 DEBUG nova.api.openstack.wsgi [req-eaa95da5-78c8-4bf3-b5b4-7c382420b82c admin admin] Returning 400 to user: Block Device Mapping is Invalid: Device name empty or too long. from (pid=25304) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1203\n\nThe check being performed is located at https://github.com/openstack/nova/blob/f10b93b2930a0e82eb994c9d7429213f134cd955/nova/api/openstack/compute/servers.py#L833\n\nIf the check is amended to resemble https://github.com/openstack/nova/blob/308bba10f621513c2f99b0b6bc83ff5320970f78/nova/block_device.py#L117-L118, it seems to work.\n\nI'd submit a patch-set, but the test at https://github.com/openstack/nova/blob/f10b93b2930a0e82eb994c9d7429213f134cd955/nova/tests/api/openstack/compute/test_servers.py#L2432-L2444 seems to indicate this validation is/was quite purposeful, causing me some trepidation.", 
            "date_created": "2013-10-30 05:19:07.605981+00:00", 
            "author": "https://api.launchpad.net/1.0/~amcrn"
        }, 
        {
            "content": "I recall that the validation you mention was only removed for block_device_mapping_v2 while leaving the old extension with the same restrictions.\n\nYou can update your request to use BDMv2 (check the example in https://github.com/openstack/nova/blob/master/doc/api_samples/os-block-device-mapping-v2-boot/server-post-req.json) and it should work without specifying the device name (you have to specify the boot_index=0).\n\nIf this solves your problem I'd avoid changing the old BDM extension as it has been removed in v3 and BDMv2 will be the default for attaching volumes on boot.", 
            "date_created": "2013-11-18 20:39:29.107550+00:00", 
            "author": "https://api.launchpad.net/1.0/~xqueralt-deactivatedaccount"
        }
    ], 
    "closed": "2014-09-17 12:37:54.777917+00:00"
}