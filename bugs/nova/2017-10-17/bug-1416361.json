{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:26:56.773676+00:00", 
    "description": "If instance is booted from a volume, Nova won't allow to resize the instance down, despite the fact root disk (ephemeral) is not even used:\n\nhttp://paste.openstack.org/show/164108/\n\nmalor@ubuntu:~/devstack$ nova resize --poll demo m1.tiny\n\nServer resizing... 100% complete\nFinished\n\nbut in nova-compute.log:\n\n2015-01-30 11:06:14.535 ERROR oslo.messaging.rpc.dispatcher [req-c788c8b2-d953-4f7f-962c-afca7ad41ff7 demo demo] Exception during message handling: Resize error: Unable to resize disk down.\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 137, in _dispatch_and_reply\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 180, in _dispatch\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 126, in _do_dispatch\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     payload)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 296, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     pass\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 281, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 346, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 269, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     migration.instance_uuid, exc_info=True)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 255, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 324, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 312, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 3851, in resize_instance\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     self.instance_events.clear_events_for_instance(instance)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/contextlib.py\", line 35, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     self.gen.throw(type, value, traceback)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 6183, in _error_out_instance_on_exception\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     raise error.inner_exception\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher ResizeError: Resize error: Unable to resize disk down.", 
    "tags": [
        "migration", 
        "volumes"
    ], 
    "importance": "High", 
    "heat": 18, 
    "link": "https://bugs.launchpad.net/nova/+bug/1416361", 
    "owner": "None", 
    "id": 1416361, 
    "index": 1680, 
    "openned": "2015-01-30 11:14:59.259956+00:00", 
    "created": "2015-01-30 11:14:59.259956+00:00", 
    "title": "Nova doesn't allow to resize down an instance booted from a volume", 
    "comments": [
        {
            "content": "If instance is booted from a volume, Nova won't allow to resize the instance down, despite the fact root disk (ephemeral) is not even used:\n\n2015-01-30 11:06:14.535 ERROR oslo.messaging.rpc.dispatcher [req-c788c8b2-d953-4f7f-962c-afca7ad41ff7 demo demo] Exception during message handling: Resize error: Unable to resize disk down.\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher Traceback (most recent call last):\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 137, in _dispatch_and_reply\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     incoming.message))\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 180, in _dispatch\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return self._do_dispatch(endpoint, method, ctxt, args)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 126, in _do_dispatch\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     result = getattr(endpoint, method)(ctxt, **new_args)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     payload)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/exception.py\", line 71, in wrapped\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return f(self, context, *args, **kw)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 296, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     pass\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 281, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 346, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 269, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     migration.instance_uuid, exc_info=True)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 255, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 324, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     kwargs['instance'], e, sys.exc_info())\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 82, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     six.reraise(self.type_, self.value, self.tb)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 312, in decorated_function\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     return function(self, context, *args, **kwargs)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 3851, in resize_instance\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     self.instance_events.clear_events_for_instance(instance)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/usr/lib/python2.7/contextlib.py\", line 35, in __exit__\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     self.gen.throw(type, value, traceback)\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher   File \"/opt/stack/nova/nova/compute/manager.py\", line 6183, in _error_out_instance_on_exception\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher     raise error.inner_exception\n2015-01-30 11:06:14.535 TRACE oslo.messaging.rpc.dispatcher ResizeError: Resize error: Unable to resize disk down.", 
            "date_created": "2015-01-30 11:14:59.259956+00:00", 
            "author": "https://api.launchpad.net/1.0/~rpodolyaka"
        }, 
        {
            "content": "The code responsible for validating resize operations:\n\nhttps://github.com/openstack/nova/blob/stable/juno/nova/compute/api.py#L2506 \nhttps://github.com/openstack/nova/blob/stable/juno/nova/virt/libvirt/driver.py#L5866", 
            "date_created": "2015-02-03 01:00:44.675443+00:00", 
            "author": "https://api.launchpad.net/1.0/~ianunruh"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/152964", 
            "date_created": "2015-02-04 16:05:41.708645+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Changing to High because this actually produces a bad return: the user sees success even though nothing happened.", 
            "date_created": "2015-03-11 16:56:29.717098+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Resize is a cast, and it looks like when this fails in the driver it raises an exception back to the compute manager which should set the instance vm_state back to 'ACTIVE' and then raise another ResizeError exception which the compute manager should handle.  The migration record should go to 'ERROR' status and there should be an instance fault recorded with the instance before the compute manager exits.  So the instance is back in ACTIVE status on failure (which is good so the user doesn't have to open a support request to their admin to get the state changed back to ACTIVE via reset-state API), but they'd have to get the instance faults to see what failed and why.", 
            "date_created": "2015-03-27 14:09:55.751181+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/152964\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8e1be7c05a4cbcc189c47b76d46024cbc7e9655e\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8e1be7c05a4cbcc189c47b76d46024cbc7e9655e\nAuthor: Mike Durnosvistov <email address hidden>\nDate:   Wed Feb 4 17:59:30 2015 +0200\n\n    libvirt: Resize down an instance booted from a volume\n    \n    When we boot instance from volume, it doesn't use root disk and\n    we should provide the possibility to resize down this instance.\n    This patch allows to change the size down of the instance\n    booted from volume.\n    \n    Also this patch got rid of duplicate code in test-cases.\n    \n    Closes-Bug: #1416361\n    Change-Id: I0f890de69d268218d44a6ab4117a5c69cf6fbf8f\n", 
            "date_created": "2015-03-27 15:18:18.201408+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-04-10 09:19:31.557678+00:00"
}