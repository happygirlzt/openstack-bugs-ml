{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:34:14.864405+00:00", 
    "description": "using the latest snapshots from jenkins i receive the following traceback (from nova-compute) when i try to start a new instance. not sure what's wrong at the moment. using xen with libvirt (if this matters).\n\n\n2012-02-25 14:45:50 ERROR nova.compute.manager [-] [instance: 0be67df3-12b4-432f-8555-961a746b0ae0] Instance failed network setup\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 560, in _allocate_network\n(nova.compute.manager): TRACE:     requested_networks=requested_networks)\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/api.py\", line 172, in allocate_for_instance\n(nova.compute.manager): TRACE:     return network_model.NetworkInfo.hydrate(nw_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/model.py\", line 262, in hydrate\n(nova.compute.manager): TRACE:     return NetworkInfo([VIF.hydrate(vif) for vif in network_info])\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/model.py\", line 240, in hydrate\n(nova.compute.manager): TRACE:     vif = VIF(**vif)\n(nova.compute.manager): TRACE: TypeError: __init__() keywords must be strings\n(nova.compute.manager): TRACE: \n2012-02-25 14:45:50 ERROR nova.rpc.common [-] Exception during message handling\n(nova.rpc.common): TRACE: Traceback (most recent call last):\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/rpc/amqp.py\", line 250, in _process_data\n(nova.rpc.common): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 112, in wrapped\n(nova.rpc.common): TRACE:     return f(*args, **kw)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 180, in decorated_function\n(nova.rpc.common): TRACE:     sys.exc_info())\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n(nova.rpc.common): TRACE:     self.gen.next()\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 174, in decorated_function\n(nova.rpc.common): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 649, in run_instance\n(nova.rpc.common): TRACE:     self._run_instance(context, instance_uuid, **kwargs)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 452, in _run_instance\n(nova.rpc.common): TRACE:     self._set_instance_error_state(context, instance_uuid)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n(nova.rpc.common): TRACE:     self.gen.next()\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 425, in _run_instance\n(nova.rpc.common): TRACE:     requested_networks)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 560, in _allocate_network\n(nova.rpc.common): TRACE:     requested_networks=requested_networks)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/api.py\", line 172, in allocate_for_instance\n(nova.rpc.common): TRACE:     return network_model.NetworkInfo.hydrate(nw_info)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/model.py\", line 262, in hydrate\n(nova.rpc.common): TRACE:     return NetworkInfo([VIF.hydrate(vif) for vif in network_info])\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/model.py\", line 240, in hydrate\n(nova.rpc.common): TRACE:     vif = VIF(**vif)\n(nova.rpc.common): TRACE: TypeError: __init__() keywords must be strings\n(nova.rpc.common): TRACE: \n\n\nnova-network looks good, the ip address got assigned:\n\n\n2012-02-25 14:50:40 DEBUG nova.network.manager [req-73f13147-514b-4950-8d23-62b52da22038 berendt bb9beb5446db45b2a1e09dc6fef154df] floating IP allocation for instance |14| from (pid=4897) allocate_for_instance /usr/lib64/python2.6/site-packages/nova/network/manager.py:289\n2012-02-25 14:50:40 DEBUG nova.network.manager [req-73f13147-514b-4950-8d23-62b52da22038 berendt bb9beb5446db45b2a1e09dc6fef154df] network allocations for instance |14| from (pid=4897) allocate_for_instance /usr/lib64/python2.6/site-packages/nova/network/manager.py:872\n2012-02-25 14:50:40 DEBUG nova.network.manager [req-73f13147-514b-4950-8d23-62b52da22038 berendt bb9beb5446db45b2a1e09dc6fef154df] networks retrieved for instance |14|: |[<nova.db.sqlalchemy.models.Network object at 0x2e5d990>]| from (pid=4897) allocate_for_instance /usr/lib64/python2.6/site-packages/nova/network/manager.py:878\n\ni receive an ip address for the new instance in nova-br0.conf:\n\n02:16:3e:39:13:e4,testing009.novalocal,10.0.0.2\n\nnova.conf: (br0 manually created on top of interface eth0)\n\n\n--verbose\n--network_manager=nova.network.manager.FlatDHCPManager\n--dhcpbridge_flagfile=/etc/nova/nova.conf\n--dhcpbridge=/usr/bin/nova-dhcpbridge\n--force_dhcp_release\n--public_interface=br0\n--flat_network_bridge=br0\n--sql_connection=mysql://nova:testing@192.168.23.66/nova\n--libvirt_type=xen\n--instance_name_template=instance-%08x\n--api_paste_config=/etc/nova/api-paste.ini\n--image_service=nova.image.glance.GlanceImageService\n--rabbit_host=192.168.23.66\n--rabbit_password=testing\n--glance_api_servers=192.168.23.66:9292\n--connection_type=libvirt\n--firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver\n--instances_path=/var/lib/nova/instances\n--state_path=/var/lib/nova\n--vlan_interface=br0\n--my_ip=192.168.23.67\n\n\ncall for my network:\n\nnova-manage network create --label=public --fixed_range_v4=10.0.0.0/24 --num_networks=1 --network_size=256 --bridge=br0 --bridge_interface=eth0 --dns1=4.4.4.4 --dns2=8.8.8.8\n\n\nbr0 receives an ip address:\n\n\n4: br0: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN \n    link/ether 00:14:0b:44:20:91 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.1/24 brd 10.0.0.255 scope global br0\n    inet 192.168.23.67/24 brd 192.168.23.255 scope global br0\n    inet6 fe80::214:bff:fe44:2091/64 scope link \n       valid_lft forever preferred_lft forever\n\n\ndnsmasq is running:\n\n\n 4406 ?        S      0:00 dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/var/lib/nova/networks/nova-br0.pid --listen-address=10.0.0.1 --except-interface=lo --dhcp-range=10.0.0.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/var/lib/nova/networks/nova-br0.conf --dhcp-script=/usr/bin/nova-dhcpbridge --leasefile-ro\n 4407 ?        S      0:00 dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/var/lib/nova/networks/nova-br0.pid --listen-address=10.0.0.1 --except-interface=lo --dhcp-range=10.0.0.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/var/lib/nova/networks/nova-br0.conf --dhcp-script=/usr/bin/nova-dhcpbridge --leasefile-ro", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/940941", 
    "owner": "https://api.launchpad.net/1.0/~berendt", 
    "id": 940941, 
    "index": 3889, 
    "openned": "2012-02-25 13:53:35.250514+00:00", 
    "created": "2012-02-25 13:53:35.250514+00:00", 
    "title": "spawning of instance failed during network setup: error in method hydrate in nova/network/model.py", 
    "comments": [
        {
            "content": "using the latest snapshots from jenkins i receive the following traceback (from nova-compute) when i try to start a new instance. not sure what's wrong at the moment. using xen with libvirt (if this matters).\n\n\n2012-02-25 14:45:50 ERROR nova.compute.manager [-] [instance: 0be67df3-12b4-432f-8555-961a746b0ae0] Instance failed network setup\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 560, in _allocate_network\n(nova.compute.manager): TRACE:     requested_networks=requested_networks)\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/api.py\", line 172, in allocate_for_instance\n(nova.compute.manager): TRACE:     return network_model.NetworkInfo.hydrate(nw_info)\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/model.py\", line 262, in hydrate\n(nova.compute.manager): TRACE:     return NetworkInfo([VIF.hydrate(vif) for vif in network_info])\n(nova.compute.manager): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/model.py\", line 240, in hydrate\n(nova.compute.manager): TRACE:     vif = VIF(**vif)\n(nova.compute.manager): TRACE: TypeError: __init__() keywords must be strings\n(nova.compute.manager): TRACE: \n2012-02-25 14:45:50 ERROR nova.rpc.common [-] Exception during message handling\n(nova.rpc.common): TRACE: Traceback (most recent call last):\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/rpc/amqp.py\", line 250, in _process_data\n(nova.rpc.common): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/exception.py\", line 112, in wrapped\n(nova.rpc.common): TRACE:     return f(*args, **kw)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 180, in decorated_function\n(nova.rpc.common): TRACE:     sys.exc_info())\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n(nova.rpc.common): TRACE:     self.gen.next()\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 174, in decorated_function\n(nova.rpc.common): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 649, in run_instance\n(nova.rpc.common): TRACE:     self._run_instance(context, instance_uuid, **kwargs)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 452, in _run_instance\n(nova.rpc.common): TRACE:     self._set_instance_error_state(context, instance_uuid)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n(nova.rpc.common): TRACE:     self.gen.next()\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 425, in _run_instance\n(nova.rpc.common): TRACE:     requested_networks)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/compute/manager.py\", line 560, in _allocate_network\n(nova.rpc.common): TRACE:     requested_networks=requested_networks)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/api.py\", line 172, in allocate_for_instance\n(nova.rpc.common): TRACE:     return network_model.NetworkInfo.hydrate(nw_info)\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/model.py\", line 262, in hydrate\n(nova.rpc.common): TRACE:     return NetworkInfo([VIF.hydrate(vif) for vif in network_info])\n(nova.rpc.common): TRACE:   File \"/usr/lib64/python2.6/site-packages/nova/network/model.py\", line 240, in hydrate\n(nova.rpc.common): TRACE:     vif = VIF(**vif)\n(nova.rpc.common): TRACE: TypeError: __init__() keywords must be strings\n(nova.rpc.common): TRACE: \n\n\nnova-network looks good, the ip address got assigned:\n\n\n2012-02-25 14:50:40 DEBUG nova.network.manager [req-73f13147-514b-4950-8d23-62b52da22038 berendt bb9beb5446db45b2a1e09dc6fef154df] floating IP allocation for instance |14| from (pid=4897) allocate_for_instance /usr/lib64/python2.6/site-packages/nova/network/manager.py:289\n2012-02-25 14:50:40 DEBUG nova.network.manager [req-73f13147-514b-4950-8d23-62b52da22038 berendt bb9beb5446db45b2a1e09dc6fef154df] network allocations for instance |14| from (pid=4897) allocate_for_instance /usr/lib64/python2.6/site-packages/nova/network/manager.py:872\n2012-02-25 14:50:40 DEBUG nova.network.manager [req-73f13147-514b-4950-8d23-62b52da22038 berendt bb9beb5446db45b2a1e09dc6fef154df] networks retrieved for instance |14|: |[<nova.db.sqlalchemy.models.Network object at 0x2e5d990>]| from (pid=4897) allocate_for_instance /usr/lib64/python2.6/site-packages/nova/network/manager.py:878\n\ni receive an ip address for the new instance in nova-br0.conf:\n\n02:16:3e:39:13:e4,testing009.novalocal,10.0.0.2\n\nnova.conf: (br0 manually created on top of interface eth0)\n\n\n--verbose\n--network_manager=nova.network.manager.FlatDHCPManager\n--dhcpbridge_flagfile=/etc/nova/nova.conf\n--dhcpbridge=/usr/bin/nova-dhcpbridge\n--force_dhcp_release\n--public_interface=br0\n--flat_network_bridge=br0\n--sql_connection=mysql://nova:testing@192.168.23.66/nova\n--libvirt_type=xen\n--instance_name_template=instance-%08x\n--api_paste_config=/etc/nova/api-paste.ini\n--image_service=nova.image.glance.GlanceImageService\n--rabbit_host=192.168.23.66\n--rabbit_password=testing\n--glance_api_servers=192.168.23.66:9292\n--connection_type=libvirt\n--firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver\n--instances_path=/var/lib/nova/instances\n--state_path=/var/lib/nova\n--vlan_interface=br0\n--my_ip=192.168.23.67\n\n\ncall for my network:\n\nnova-manage network create --label=public --fixed_range_v4=10.0.0.0/24 --num_networks=1 --network_size=256 --bridge=br0 --bridge_interface=eth0 --dns1=4.4.4.4 --dns2=8.8.8.8\n\n\nbr0 receives an ip address:\n\n\n4: br0: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN \n    link/ether 00:14:0b:44:20:91 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.1/24 brd 10.0.0.255 scope global br0\n    inet 192.168.23.67/24 brd 192.168.23.255 scope global br0\n    inet6 fe80::214:bff:fe44:2091/64 scope link \n       valid_lft forever preferred_lft forever\n\n\ndnsmasq is running:\n\n\n 4406 ?        S      0:00 dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/var/lib/nova/networks/nova-br0.pid --listen-address=10.0.0.1 --except-interface=lo --dhcp-range=10.0.0.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/var/lib/nova/networks/nova-br0.conf --dhcp-script=/usr/bin/nova-dhcpbridge --leasefile-ro\n 4407 ?        S      0:00 dnsmasq --strict-order --bind-interfaces --conf-file= --domain=novalocal --pid-file=/var/lib/nova/networks/nova-br0.pid --listen-address=10.0.0.1 --except-interface=lo --dhcp-range=10.0.0.2,static,120s --dhcp-lease-max=256 --dhcp-hostsfile=/var/lib/nova/networks/nova-br0.conf --dhcp-script=/usr/bin/nova-dhcpbridge --leasefile-ro", 
            "date_created": "2012-02-25 13:53:35.250514+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "tested with tarball nova-2012.1~e4~20120225.12927.tar.gz\t (git revision 2172e49e8359a62182f58d94d2a9c465a85d9a95)", 
            "date_created": "2012-02-25 14:37:53.696854+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "Looks like it is a problem with the used python version (python-2.6.0-8.14.1) on SLES11 SP1 (and SLES11 SP2 uses 2.6.0, too).\n\nStarting with Python 2.6.5 it's possible to use unicode strings (u'foobar') as keyword arguments (http://bugs.python.org/issue4978). Before Python 2.6.5 using unicode strings as keyword arguments throw an exception (TypeError: __init__() keywords must be strings).\n\nThe network_model.NetworkInfo.hydrate method is called with a variable nw_info which contains a lot of unicode strings. So my suggestion for the moment is that it's a problem with Python < 2.6.5.\n\nI think nothing to fix here. I'll open a service request and ask if SUSE can backport the patch for the Python issue 4978.\n\nYou can test it with the following code:\n\n>>> def foobar(**kwargs):\n...     print \"lalala\"\n... \n\n>>> foobar(**{'blar': '1234'})\nlalala\n>>> foobar(**{u'blar': '1234'})\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: foobar() keywords must be strings", 
            "date_created": "2012-02-25 23:21:23.738590+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/4544", 
            "date_created": "2012-02-26 01:42:43.191690+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "i think we should not set Python >= 2.6.5 as a minimum requirement for running OpenStack Compute (or at least to run nova-network)  if there is at least one enterprise distribution using Python < 2.6.5. i think RHEL5 is also using Python < 2.6.5, not sure about RHEL6.", 
            "date_created": "2012-02-26 01:46:08.768617+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/4544\nCommitted: http://github.com/openstack/nova/commit/81a1b0a15ad5b0a656bd56d9f87715a8707f986e\nSubmitter: Jenkins\nBranch:    master\n\ncommit 81a1b0a15ad5b0a656bd56d9f87715a8707f986e\nAuthor: Christian Berendt <email address hidden>\nDate:   Sun Feb 26 02:39:08 2012 +0100\n\n    make nova-network usable with Python < 2.6.5\n    \n    there is in issue in Python < 2.6.5 with using unicode strings as\n    keyword arguemnts. see http://bugs.python.org/issue4978 for details.\n    \n    because several not-yet-outdated enterprise distributions are using\n    Python < 2.6.5 the unicode strings in the keys of the dictionaries in\n    used as keyword arguments nova/network/model.py should be converted.\n    \n    fixes bug 940941\n    \n    Change-Id: Ib1d9955677e228fce6cc8e17fddc780d1a839d84\n", 
            "date_created": "2012-02-27 21:20:26.976418+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-02-29 10:37:26.441277+00:00"
}