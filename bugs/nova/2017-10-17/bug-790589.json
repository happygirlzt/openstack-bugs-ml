{
    "status": "Fix Released", 
    "last_updated": "2011-09-22 13:09:31.981179+00:00", 
    "description": "On specifying the -o <source_group_name>  or --source-group=<source_group_name> option with euca-authorize, the traffic from the source group specified should be authorized and a corresponding rule entry be created in iptables. Currently this does not seem to be the case.\n\nSteps to Test:-\n1) Launch one VM instance\n2) Associate floating ip address, say '10.2.3.96' to the VM instance\n3) Add security group, say 'icmpgroup'\n\n    $euca-add-group icmpgroup -d \"test group\"\n\n4) Add rule to allow access from 10.2.3.0/24 for ICMP for icmpgroup security group\n\n    $euca-authorize -P icmp -t -1:-1  -s 10.2.3.0/24  icmpgroup\n\n5) Add rule by specifying icmpgroup security group using -o parameter to allow access to default group\n\n    $euca-authorize -P icmp -t -1:-1 -o icmpgroup default\n\n6) check if everything is added properly or now using euca-describe-groups\n\n    root@ubuntu-openstack-network-api-server:/home/tpatil# euca-describe-groups\n    GROUP   admin   default default\n    PERMISSION      admin   default ALLOWS  icmp    -1      -1      GRPNAME icmpgroup\n    GROUP   admin   icmpgroup       test group\n    PERMISSION      admin   icmpgroup       ALLOWS  icmp    -1      -1      FROM    CIDR    10.2.3.0/24\nIt looks good till now.\n\n7) Try to ping to the VM instance using floating ip address 10.2.3.96.\n    Ping is NOT successful.\n\nTo verify if icmp rule is added properly or not, I checked the iptables on the compute node and found out that the icmp rules wasn't added.\nCompute node iptables\n-----------------------------------\n\nroot@ubuntu-openstack-compute-01:~# iptables -n -L\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nnova-compute-INPUT  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\nnova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0\nnova-compute-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nnova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0\nnova-compute-OUTPUT  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-compute-FORWARD (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-compute-INPUT (1 references)\ntarget     prot opt source               destination\n\nChain nova-compute-OUTPUT (1 references)\ntarget     prot opt source               destination\n\nChain nova-compute-inst-260 (1 references)\ntarget     prot opt source               destination\nDROP       all  --  0.0.0.0/0            0.0.0.0/0           state INVALID\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED\nACCEPT     udp  --  10.0.0.1             0.0.0.0/0           udp spt:67 dpt:68\nACCEPT     all  --  10.0.0.0/27          0.0.0.0/0\nnova-compute-sg-fallback  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-compute-local (1 references)\ntarget     prot opt source               destination\nnova-compute-inst-260  all  --  0.0.0.0/0            10.0.0.4\n\nChain nova-compute-sg-fallback (1 references)\ntarget     prot opt source               destination\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-filter-top (2 references)\ntarget     prot opt source               destination\nnova-compute-local  all  --  0.0.0.0/0            0.0.0.0/0", 
    "tags": [], 
    "importance": "High", 
    "heat": 32, 
    "link": "https://bugs.launchpad.net/nova/+bug/790589", 
    "owner": "https://api.launchpad.net/1.0/~soren", 
    "id": 790589, 
    "index": 412, 
    "openned": "2011-05-31 10:38:09.979242+00:00", 
    "created": "2011-05-31 10:38:09.979242+00:00", 
    "title": "'source-group' option in euca-authorize does not function", 
    "comments": [
        {
            "content": "On specifying the -o <source_group_name>  or --source-group=<source_group_name> option with euca-authorize, the traffic from the source group specified should be authorized and a corresponding rule entry be created in iptables. Currently this does not seem to be the case.\n\nSteps to Test:-\n1) Launch one VM instance\n2) Associate floating ip address, say '10.2.3.96' to the VM instance\n3) Add security group, say 'icmpgroup'\n\n    $euca-add-group icmpgroup -d \"test group\"\n\n4) Add rule to allow access from 10.2.3.0/24 for ICMP for icmpgroup security group\n\n    $euca-authorize -P icmp -t -1:-1  -s 10.2.3.0/24  icmpgroup\n\n5) Add rule by specifying icmpgroup security group using -o parameter to allow access to default group\n\n    $euca-authorize -P icmp -t -1:-1 -o icmpgroup default\n\n6) check if everything is added properly or now using euca-describe-groups\n\n    root@ubuntu-openstack-network-api-server:/home/tpatil# euca-describe-groups\n    GROUP   admin   default default\n    PERMISSION      admin   default ALLOWS  icmp    -1      -1      GRPNAME icmpgroup\n    GROUP   admin   icmpgroup       test group\n    PERMISSION      admin   icmpgroup       ALLOWS  icmp    -1      -1      FROM    CIDR    10.2.3.0/24\nIt looks good till now.\n\n7) Try to ping to the VM instance using floating ip address 10.2.3.96.\n    Ping is NOT successful.\n\nTo verify if icmp rule is added properly or not, I checked the iptables on the compute node and found out that the icmp rules wasn't added.\nCompute node iptables\n-----------------------------------\n\nroot@ubuntu-openstack-compute-01:~# iptables -n -L\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nnova-compute-INPUT  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\nnova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0\nnova-compute-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nnova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0\nnova-compute-OUTPUT  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-compute-FORWARD (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-compute-INPUT (1 references)\ntarget     prot opt source               destination\n\nChain nova-compute-OUTPUT (1 references)\ntarget     prot opt source               destination\n\nChain nova-compute-inst-260 (1 references)\ntarget     prot opt source               destination\nDROP       all  --  0.0.0.0/0            0.0.0.0/0           state INVALID\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED\nACCEPT     udp  --  10.0.0.1             0.0.0.0/0           udp spt:67 dpt:68\nACCEPT     all  --  10.0.0.0/27          0.0.0.0/0\nnova-compute-sg-fallback  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-compute-local (1 references)\ntarget     prot opt source               destination\nnova-compute-inst-260  all  --  0.0.0.0/0            10.0.0.4\n\nChain nova-compute-sg-fallback (1 references)\ntarget     prot opt source               destination\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-filter-top (2 references)\ntarget     prot opt source               destination\nnova-compute-local  all  --  0.0.0.0/0            0.0.0.0/0", 
            "date_created": "2011-05-31 10:38:09.979242+00:00", 
            "author": "https://api.launchpad.net/1.0/~rohitk"
        }, 
        {
            "content": "I've experience this issue as well. It's not just with floating IPs. If you have --allow_project_net_traffic=false VMs in the same project cannot talk to each other unless explicitly allowed by IP, even on their DHCP assigned addresses. It appears to be the same issue (source group chain is not applied)", 
            "date_created": "2011-06-16 14:57:27.583500+00:00", 
            "author": "https://api.launchpad.net/1.0/~kbringard"
        }
    ], 
    "closed": "2011-09-22 13:09:30.747198+00:00"
}