{
    "status": "Invalid", 
    "last_updated": "2013-02-26 23:05:52.255204+00:00", 
    "description": "Some instances don't get deleted after I shut them down. They are actually still running. \n\nIn nova-compute.log i see the following error \n\n\n./nova-compute.log.2:2013-01-07 12:46:48 INFO nova.compute.manager [req-b317e8d1-c0a4-4780-bf38-44a8e61c9e78 3abc796d9c544d039fe7d5b90b206a30 e466feaf9a58472a86989156edc9acf4] check_instance_lock: arguments: |<nova.compute.manager.ComputeManager object at 0x1deb0d0>| |<nova.rpc.amqp.RpcContext object at 0x46e7cd0>| |c2d827e9-6863-49a7-ad57-576d051f6423|\n./nova-compute.log.2-2013-01-07 12:46:54 ERROR nova.manager [-] Error during ComputeManager._heal_instance_info_cache: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager Traceback (most recent call last):\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/manager.py\", line 155, in periodic_tasks\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     task(self, context)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2225, in _heal_instance_info_cache\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     context, self.host)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 578, in instance_get_all_by_host\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return IMPL.instance_get_all_by_host(context, host)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 102, in wrapper\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return f(*args, **kwargs)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1515, in instance_get_all_by_host\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return _instance_get_all_query(context).filter_by(host=host).all()\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2115, in all\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return list(self)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2227, in __iter__\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return self._execute_and_instances(context)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2240, in _execute_and_instances\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     close_with_result=True)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2231, in _connection_from_session\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     **kw)\n\nIm using nova-compute 2012.1.1-9. I assume that I need to somehow increase QueuePool to fix this issue, how can I do that?", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1097796", 
    "owner": "None", 
    "id": 1097796, 
    "index": 4570, 
    "openned": "2013-01-09 15:00:50.902657+00:00", 
    "created": "2013-01-09 15:00:50.902657+00:00", 
    "title": "Instances are stuck in deleting task", 
    "comments": [
        {
            "content": "Some instances don't get deleted after I shut them down. They are actually still running. \n\nIn nova-compute.log i see the following error \n\n\n./nova-compute.log.2:2013-01-07 12:46:48 INFO nova.compute.manager [req-b317e8d1-c0a4-4780-bf38-44a8e61c9e78 3abc796d9c544d039fe7d5b90b206a30 e466feaf9a58472a86989156edc9acf4] check_instance_lock: arguments: |<nova.compute.manager.ComputeManager object at 0x1deb0d0>| |<nova.rpc.amqp.RpcContext object at 0x46e7cd0>| |c2d827e9-6863-49a7-ad57-576d051f6423|\n./nova-compute.log.2-2013-01-07 12:46:54 ERROR nova.manager [-] Error during ComputeManager._heal_instance_info_cache: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager Traceback (most recent call last):\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/manager.py\", line 155, in periodic_tasks\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     task(self, context)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 2225, in _heal_instance_info_cache\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     context, self.host)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 578, in instance_get_all_by_host\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return IMPL.instance_get_all_by_host(context, host)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 102, in wrapper\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return f(*args, **kwargs)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1515, in instance_get_all_by_host\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return _instance_get_all_query(context).filter_by(host=host).all()\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2115, in all\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return list(self)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2227, in __iter__\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     return self._execute_and_instances(context)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2240, in _execute_and_instances\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     close_with_result=True)\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2231, in _connection_from_session\n./nova-compute.log.2-2013-01-07 12:46:54 TRACE nova.manager     **kw)\n\nIm using nova-compute 2012.1.1-9. I assume that I need to somehow increase QueuePool to fix this issue, how can I do that?", 
            "date_created": "2013-01-09 15:00:50.902657+00:00", 
            "author": "https://api.launchpad.net/1.0/~wijet-b"
        }, 
        {
            "content": "Unfortunately you can't do it via a configuration option, but you should be able to manually add it to sqlalchemy/session.py\n\nFor example:\n\ndiff --git a/nova/db/sqlalchemy/session.py b/nova/db/sqlalchemy/session.py\nindex 3f20632..23c3367 100644\n--- a/nova/db/sqlalchemy/session.py\n+++ b/nova/db/sqlalchemy/session.py\n@@ -99,6 +99,7 @@ def get_engine():\n\n         engine_args = {\n             \"pool_recycle\": FLAGS.sql_idle_timeout,\n+            \"pool_size\": 20,\n             \"echo\": False,\n             'convert_unicode': True,\n         }", 
            "date_created": "2013-02-26 23:05:36.972804+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ], 
    "closed": "2013-02-26 23:05:50.775457+00:00"
}