{
    "status": "Fix Released", 
    "last_updated": "2017-06-08 21:53:16.519877+00:00", 
    "description": "When there is no tags in the system and user uses \"nova list --not-tags xxx\",\nHTTP 500 will return:\n\nroot@SZX1000291918:/var/log/nova# nova list --not-tags 123\n/usr/local/lib/python2.7/dist-packages/novaclient/client.py:278: UserWarning: The 'tenant_id' argument is deprecated in Ocata and its use may result in errors in future releases. As 'project_id' is provided, the 'tenant_id' argument will be ignored.\n  warnings.warn(msg)\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.IndexError'> (HTTP 500) (Request-ID: req-225940e7-1976-4ec9-8970-a8c2b4b103ea)\n\n\nnova-api Logs:\n2017-04-14 09:34:29.952 111211 DEBUG oslo_db.sqlalchemy.engines [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] MySQL server mode set to STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION _check_effective_sql_mode /usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/engines.py:260\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] Unexpected exception in API method\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 336, in wrapped\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 181, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 181, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 167, in detail\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     servers = self._get_servers(req, is_detail=True)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 310, in _get_servers\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     sort_keys=sort_keys, sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2572, in get_all\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2657, in _get_instances_by_filters_all_cells\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2688, in _get_instances_by_filters\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     expected_attrs=fields, sort_keys=sort_keys, sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 184, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     result = fn(cls, context, *args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 1220, in get_by_filters\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     use_slave=use_slave, sort_keys=sort_keys, sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 236, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 1204, in _get_by_filters_impl\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     sort_keys=sort_keys, sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/api.py\", line 763, in instance_get_all_by_filters_sort\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 180, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 281, in wrapped\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return f(context, *args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2211, in instance_get_all_by_filters_sort\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     first_tag = tags.pop(0)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions IndexError: pop from empty list\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions\n2017-04-14 09:34:29.958 111211 INFO nova.api.openstack.wsgi [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.IndexError'>\n2017-04-14 09:34:29.959 111211 DEBUG nova.api.openstack.wsgi [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.IndexError'> __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1041\n2017-04-14 09:34:29.960 111211 INFO nova.osapi_compute.wsgi.server [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] 10.229.45.145 \"GET /v2.1/servers/detail?not-tags=123 HTTP/1.1\" status: 500 len: 563 time: 0.1029530", 
    "tags": [
        "api", 
        "cells", 
        "in-stable-ocata", 
        "newton-backport-potential", 
        "ocata-backport-potential"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1682693", 
    "owner": "https://api.launchpad.net/1.0/~zhengzhenyu", 
    "id": 1682693, 
    "index": 2066, 
    "openned": "2017-04-14 01:43:43.046372+00:00", 
    "created": "2017-04-14 01:43:43.046372+00:00", 
    "title": "tags and not-tags cannot work properly", 
    "comments": [
        {
            "content": "When there is no tags in the system and user uses \"nova list --not-tags xxx\",\nHTTP 500 will return:\n\nroot@SZX1000291918:/var/log/nova# nova list --not-tags 123\n/usr/local/lib/python2.7/dist-packages/novaclient/client.py:278: UserWarning: The 'tenant_id' argument is deprecated in Ocata and its use may result in errors in future releases. As 'project_id' is provided, the 'tenant_id' argument will be ignored.\n  warnings.warn(msg)\nERROR (ClientException): Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.IndexError'> (HTTP 500) (Request-ID: req-225940e7-1976-4ec9-8970-a8c2b4b103ea)\n\n\nnova-api Logs:\n2017-04-14 09:34:29.952 111211 DEBUG oslo_db.sqlalchemy.engines [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] MySQL server mode set to STRICT_TRANS_TABLES,STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION _check_effective_sql_mode /usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/engines.py:260\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] Unexpected exception in API method\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions Traceback (most recent call last):\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/extensions.py\", line 336, in wrapped\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 181, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 181, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 167, in detail\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     servers = self._get_servers(req, is_detail=True)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 310, in _get_servers\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     sort_keys=sort_keys, sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2572, in get_all\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2657, in _get_instances_by_filters_all_cells\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 2688, in _get_instances_by_filters\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     expected_attrs=fields, sort_keys=sort_keys, sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 184, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     result = fn(cls, context, *args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 1220, in get_by_filters\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     use_slave=use_slave, sort_keys=sort_keys, sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 236, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/instance.py\", line 1204, in _get_by_filters_impl\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     sort_keys=sort_keys, sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/api.py\", line 763, in instance_get_all_by_filters_sort\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     sort_dirs=sort_dirs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 180, in wrapper\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return f(*args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 281, in wrapped\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     return f(context, *args, **kwargs)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions   File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 2211, in instance_get_all_by_filters_sort\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions     first_tag = tags.pop(0)\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions IndexError: pop from empty list\n2017-04-14 09:34:29.955 111211 ERROR nova.api.openstack.extensions\n2017-04-14 09:34:29.958 111211 INFO nova.api.openstack.wsgi [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.IndexError'>\n2017-04-14 09:34:29.959 111211 DEBUG nova.api.openstack.wsgi [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.IndexError'> __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1041\n2017-04-14 09:34:29.960 111211 INFO nova.osapi_compute.wsgi.server [req-225940e7-1976-4ec9-8970-a8c2b4b103ea f9e4d94bbfbd4cf1b774108650faa855 d4fd94accf2a4718b2ec8100e4e2e5f1 - default default] 10.229.45.145 \"GET /v2.1/servers/detail?not-tags=123 HTTP/1.1\" status: 500 len: 563 time: 0.1029530", 
            "date_created": "2017-04-14 01:43:43.046372+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhengzhenyu"
        }, 
        {
            "content": "In http://git.openstack.org/cgit/openstack/nova/tree/nova/db/sqlalchemy/api.py#n2150\nwe did copied the filters dict\nin http://git.openstack.org/cgit/openstack/nova/tree/nova/db/sqlalchemy/api.py#n2188 and\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/db/sqlalchemy/api.py#n2209\nwe pop the first tag in tags to do SQL query, as we didn't do deep copy, the\n\"tags\" or \"not-tags\" key will be still in filters dict but the value has been removed,\nas we loop through every cell, Error will happen, and also, the result is incorrect.", 
            "date_created": "2017-04-14 03:57:58.773414+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhengzhenyu"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/456872", 
            "date_created": "2017-04-14 09:25:13.287003+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/457103", 
            "date_created": "2017-04-17 00:51:22.959850+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Kevin, would it be possible to post the actual error message from the logs instead of the returned 500 error? Thanks!", 
            "date_created": "2017-04-17 15:49:35.578616+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Related fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/457335", 
            "date_created": "2017-04-17 19:19:11.017754+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/457336", 
            "date_created": "2017-04-17 19:19:25.096465+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/newton\nReview: https://review.openstack.org/457353", 
            "date_created": "2017-04-17 20:31:49.340736+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/457103\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=01dd1a05a213c0cbd0097188418cabe915291c8d\nSubmitter: Jenkins\nBranch:    master\n\ncommit 01dd1a05a213c0cbd0097188418cabe915291c8d\nAuthor: Matt Riedemann <email address hidden>\nDate:   Sun Apr 16 20:45:25 2017 -0400\n\n    Add regression test for server filtering by tags bug 1682693\n    \n    There was a latent bug in the DB API code such that when we\n    process filters when listing instances, the various tags\n    filters have their values popped out of the filters dict and\n    the values (which are lists) for the filter also have the\n    first item in the list popped out to build the query.\n    \n    This latent bug was exposed in Newton when we started listing\n    instances in the API from both cell0 and the main cell database,\n    because the query to cell0 would pop an item and then it\n    would not be in the 2nd query to the main cell database. If we\n    only had one tag in the filter list, we get an IndexError on\n    the 2nd pop() call.\n    \n    Note that we also use the build_requests table in the API to\n    list instances, but there would not be any tagged servers in\n    that table since a server has to be ACTIVE before you can tag it,\n    and build_requests only exist until the instance is put into a\n    cell and starts building there (so it won't be ACTIVE yet).\n    \n    Change-Id: I65bdfadd406368775c794ee4d8a16302a8a134bc\n    Related-Bug: #1682693\n", 
            "date_created": "2017-04-18 01:46:12.081240+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/456872\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c4820305d2f9ee8d62bcc708baf3fa6dfe7ca960\nSubmitter: Jenkins\nBranch:    master\n\ncommit c4820305d2f9ee8d62bcc708baf3fa6dfe7ca960\nAuthor: Kevin_Zheng <email address hidden>\nDate:   Fri Apr 14 11:57:59 2017 +0800\n\n    Use deepcopy when process filters in db api\n    \n    In db API when we process filters, we didn't\n    use deepcopy. In cases of \"tags\" and \"not-tags\"\n    we used pop to get the first tag, filtered out\n    results, and then joined with other tags for\n    later filtering. When we did pop(), the original\n    value was deleted, the key \"tags\"/\"not-tags\" remains.\n    \n    In the cell scenario, both single cell(we will\n    query cell0 and the other cell) and multicell,\n    as we have to query all the cells in a loop and\n    the tags list in the filter will keep popping,\n    this will lead to either a HTTP 500 error(popping\n    from an empty list) or incorrect result(when\n    number of tags in the list is larger than cell\n    number, no HTTP 500 will show, but the filter\n    results for each cell will be different as\n    each loop will pop one tag).\n    \n    closes-bug: #1682693\n    \n    Change-Id: Ia2738dd0c7d1842b68c83d0a9e75e26b2f8d492a\n", 
            "date_created": "2017-04-18 03:49:52.015557+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/457335\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c9620d57c84378c6187485d571e60e9da3eb9737\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit c9620d57c84378c6187485d571e60e9da3eb9737\nAuthor: Matt Riedemann <email address hidden>\nDate:   Sun Apr 16 20:45:25 2017 -0400\n\n    Add regression test for server filtering by tags bug 1682693\n    \n    There was a latent bug in the DB API code such that when we\n    process filters when listing instances, the various tags\n    filters have their values popped out of the filters dict and\n    the values (which are lists) for the filter also have the\n    first item in the list popped out to build the query.\n    \n    This latent bug was exposed in Newton when we started listing\n    instances in the API from both cell0 and the main cell database,\n    because the query to cell0 would pop an item and then it\n    would not be in the 2nd query to the main cell database. If we\n    only had one tag in the filter list, we get an IndexError on\n    the 2nd pop() call.\n    \n    Note that we also use the build_requests table in the API to\n    list instances, but there would not be any tagged servers in\n    that table since a server has to be ACTIVE before you can tag it,\n    and build_requests only exist until the instance is put into a\n    cell and starts building there (so it won't be ACTIVE yet).\n    \n    Change-Id: I65bdfadd406368775c794ee4d8a16302a8a134bc\n    Related-Bug: #1682693\n    (cherry picked from commit 01dd1a05a213c0cbd0097188418cabe915291c8d)\n", 
            "date_created": "2017-04-20 14:38:35.490373+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/457336\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=01ffbdf8be1cec567ccebb1d9dcb1b390cfaa31a\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit 01ffbdf8be1cec567ccebb1d9dcb1b390cfaa31a\nAuthor: Kevin_Zheng <email address hidden>\nDate:   Fri Apr 14 11:57:59 2017 +0800\n\n    Use deepcopy when process filters in db api\n    \n    In db API when we process filters, we didn't\n    use deepcopy. In cases of \"tags\" and \"not-tags\"\n    we used pop to get the first tag, filtered out\n    results, and then joined with other tags for\n    later filtering. When we did pop(), the original\n    value was deleted, the key \"tags\"/\"not-tags\" remains.\n    \n    In the cell scenario, both single cell(we will\n    query cell0 and the other cell) and multicell,\n    as we have to query all the cells in a loop and\n    the tags list in the filter will keep popping,\n    this will lead to either a HTTP 500 error(popping\n    from an empty list) or incorrect result(when\n    number of tags in the list is larger than cell\n    number, no HTTP 500 will show, but the filter\n    results for each cell will be different as\n    each loop will pop one tag).\n    \n    closes-bug: #1682693\n    \n    Change-Id: Ia2738dd0c7d1842b68c83d0a9e75e26b2f8d492a\n    (cherry picked from commit c4820305d2f9ee8d62bcc708baf3fa6dfe7ca960)\n", 
            "date_created": "2017-04-25 03:50:52.303288+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/457353\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=6d1ce4cf5cfa9525dfde14bd55b94e86f5e548c1\nSubmitter: Jenkins\nBranch:    stable/newton\n\ncommit 6d1ce4cf5cfa9525dfde14bd55b94e86f5e548c1\nAuthor: Kevin_Zheng <email address hidden>\nDate:   Fri Apr 14 11:57:59 2017 +0800\n\n    Use deepcopy when process filters in db api\n    \n    In db API when we process filters, we didn't\n    use deepcopy. In cases of \"tags\" and \"not-tags\"\n    we used pop to get the first tag, filtered out\n    results, and then joined with other tags for\n    later filtering. When we did pop(), the original\n    value was deleted, the key \"tags\"/\"not-tags\" remains.\n    \n    In the cell scenario, both single cell(we will\n    query cell0 and the other cell) and multicell,\n    as we have to query all the cells in a loop and\n    the tags list in the filter will keep popping,\n    this will lead to either a HTTP 500 error(popping\n    from an empty list) or incorrect result(when\n    number of tags in the list is larger than cell\n    number, no HTTP 500 will show, but the filter\n    results for each cell will be different as\n    each loop will pop one tag).\n    \n    closes-bug: #1682693\n    \n    Conflicts:\n          nova/tests/functional/regressions/test_bug_1682693.py\n    \n    NOTE(mriedem): The conflict on the functional regression test\n    is due to I65bdfadd406368775c794ee4d8a16302a8a134bc not being\n    backported to Newton. That was not backported simply because it\n    relies on too many fixtures to stub out a real cells environment\n    that trying to get it to work in Newton is not worth it. This\n    fix is still unit tested which is sufficient.\n    \n    Change-Id: Ia2738dd0c7d1842b68c83d0a9e75e26b2f8d492a\n    (cherry picked from commit c4820305d2f9ee8d62bcc708baf3fa6dfe7ca960)\n    (cherry picked from commit 01ffbdf8be1cec567ccebb1d9dcb1b390cfaa31a)\n", 
            "date_created": "2017-04-26 21:29:05.309791+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.4 release.", 
            "date_created": "2017-05-08 22:10:18.959191+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.6 release.", 
            "date_created": "2017-05-08 22:25:49.451763+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0b2 development milestone.", 
            "date_created": "2017-06-08 21:53:16.117330+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-04-18 03:49:48.135476+00:00"
}