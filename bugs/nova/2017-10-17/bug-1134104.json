{
    "status": "Fix Released", 
    "last_updated": "2013-03-06 07:49:07.543183+00:00", 
    "description": "I'm using stable folsom and testing it.\nI have add resize_confirm_window=60 to nova.conf, and it is enabled.\nmy testcase is:\n2013-01-28 08:20:27,172 INFO ========= running test case test_resize_auto_confirm =========\n2013-01-28 08:20:27,442 INFO the selected flavor is 8(xtiny.c: vcpus 1, ecus_per_vcpu 1, ram 2048)\n2013-01-28 08:20:27,938 INFO removing floating IP 114.113.199.245 from server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:20:36,149 INFO resizing server a658f85e-8430-4889-8339-bf4cabe639ef: flavor 11 to flavor 8\n2013-01-28 08:21:07,476 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resized, the status is VERIFY_RESIZE\n2013-01-28 08:21:07,477 INFO adding floating IP 114.113.199.245 to server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:21:15,151 INFO now the availability zone of the server is nova11\n2013-01-28 08:21:15,151 INFO waiting for auto confirming resize for server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:27:12,611 INFO server a658f85e-8430-4889-8339-bf4cabe639ef auto confirming resize done\n2013-01-28 08:27:17,709 INFO ========= running test case test_resize_server =========\n2013-01-28 08:27:17,982 INFO the selected flavor is 12(small.a: vcpus 2, ecus_per_vcpu 2, ram 2048)\n2013-01-28 08:27:18,747 INFO removing floating IP 114.113.199.245 from server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:27:29,662 INFO resizing server a658f85e-8430-4889-8339-bf4cabe639ef: flavor 8 to flavor 12\n2013-01-28 08:28:06,077 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resized, the status is VERIFY_RESIZE\n2013-01-28 08:28:06,077 INFO adding floating IP 114.113.199.245 to server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:28:13,819 INFO now the availability zone of the server is nova11\n2013-01-28 08:28:13,820 INFO confirming resize for server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:28:19,282 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resize confirmed\n2013-01-28 08:28:24,383 INFO ========= running test case test_revert_resize =========\n2013-01-28 08:28:24,557 INFO the selected flavor is 13(small.b: vcpus 2, ecus_per_vcpu 2, ram 4096)\n2013-01-28 08:28:26,309 INFO removing floating IP 114.113.199.245 from server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:28:36,559 INFO resizing server a658f85e-8430-4889-8339-bf4cabe639ef: flavor 12 to flavor 13\n2013-01-28 08:29:09,791 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resized, the status is VERIFY_RESIZE\n2013-01-28 08:29:09,792 INFO adding floating IP 114.113.199.245 to server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:29:17,859 INFO now the availability zone of the server is nova11\n2013-01-28 08:29:17,860 INFO reverting resize for server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:29:54,074 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resize reverted\n\nFAIL [94.799s]: test_revert_resize (nvs_server.NVSServerTestCases)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/qatest/jenkins-nvs/workspace/cloud-autotest-nvs/nvs_utils.py\", line 668, in _test_case\n    return func(*args, **kwargs)\n  File \"/home/qatest/jenkins-nvs/workspace/cloud-autotest-nvs/nvs_server.py\", line 196, in test_revert_resize\n    server['server']['flavor']['id']))\nAssertionError: after reverting, the flavor of server a658f85e-8430-4889-8339-bf4cabe639ef not changed to 12 (it is 8)\n\nIt seems like revert to a wrong flavor, this issue occurs at least two times with this case, but it's a probabilistic issue.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1134104", 
    "owner": "None", 
    "id": 1134104, 
    "index": 4714, 
    "openned": "2013-02-27 08:57:12.289447+00:00", 
    "created": "2013-02-27 08:57:12.289447+00:00", 
    "title": "instance is reverted to a wrong flavor after resizing several times", 
    "comments": [
        {
            "content": "I'm using stable folsom and testing it.\nI have add resize_confirm_window=60 to nova.conf, and it is enabled.\nmy testcase is:\n2013-01-28 08:20:27,172 INFO ========= running test case test_resize_auto_confirm =========\n2013-01-28 08:20:27,442 INFO the selected flavor is 8(xtiny.c: vcpus 1, ecus_per_vcpu 1, ram 2048)\n2013-01-28 08:20:27,938 INFO removing floating IP 114.113.199.245 from server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:20:36,149 INFO resizing server a658f85e-8430-4889-8339-bf4cabe639ef: flavor 11 to flavor 8\n2013-01-28 08:21:07,476 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resized, the status is VERIFY_RESIZE\n2013-01-28 08:21:07,477 INFO adding floating IP 114.113.199.245 to server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:21:15,151 INFO now the availability zone of the server is nova11\n2013-01-28 08:21:15,151 INFO waiting for auto confirming resize for server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:27:12,611 INFO server a658f85e-8430-4889-8339-bf4cabe639ef auto confirming resize done\n2013-01-28 08:27:17,709 INFO ========= running test case test_resize_server =========\n2013-01-28 08:27:17,982 INFO the selected flavor is 12(small.a: vcpus 2, ecus_per_vcpu 2, ram 2048)\n2013-01-28 08:27:18,747 INFO removing floating IP 114.113.199.245 from server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:27:29,662 INFO resizing server a658f85e-8430-4889-8339-bf4cabe639ef: flavor 8 to flavor 12\n2013-01-28 08:28:06,077 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resized, the status is VERIFY_RESIZE\n2013-01-28 08:28:06,077 INFO adding floating IP 114.113.199.245 to server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:28:13,819 INFO now the availability zone of the server is nova11\n2013-01-28 08:28:13,820 INFO confirming resize for server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:28:19,282 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resize confirmed\n2013-01-28 08:28:24,383 INFO ========= running test case test_revert_resize =========\n2013-01-28 08:28:24,557 INFO the selected flavor is 13(small.b: vcpus 2, ecus_per_vcpu 2, ram 4096)\n2013-01-28 08:28:26,309 INFO removing floating IP 114.113.199.245 from server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:28:36,559 INFO resizing server a658f85e-8430-4889-8339-bf4cabe639ef: flavor 12 to flavor 13\n2013-01-28 08:29:09,791 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resized, the status is VERIFY_RESIZE\n2013-01-28 08:29:09,792 INFO adding floating IP 114.113.199.245 to server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:29:17,859 INFO now the availability zone of the server is nova11\n2013-01-28 08:29:17,860 INFO reverting resize for server a658f85e-8430-4889-8339-bf4cabe639ef\n2013-01-28 08:29:54,074 INFO server a658f85e-8430-4889-8339-bf4cabe639ef resize reverted\n\nFAIL [94.799s]: test_revert_resize (nvs_server.NVSServerTestCases)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/qatest/jenkins-nvs/workspace/cloud-autotest-nvs/nvs_utils.py\", line 668, in _test_case\n    return func(*args, **kwargs)\n  File \"/home/qatest/jenkins-nvs/workspace/cloud-autotest-nvs/nvs_server.py\", line 196, in test_revert_resize\n    server['server']['flavor']['id']))\nAssertionError: after reverting, the flavor of server a658f85e-8430-4889-8339-bf4cabe639ef not changed to 12 (it is 8)\n\nIt seems like revert to a wrong flavor, this issue occurs at least two times with this case, but it's a probabilistic issue.", 
            "date_created": "2013-02-27 08:57:12.289447+00:00", 
            "author": "https://api.launchpad.net/1.0/~hzwangpan"
        }, 
        {
            "content": "I have checked the nova DB, and found three records of this uuid in migrations table, the status of first one is \"confirmed\", but the second one is \"reverted\"(the expected is \"confirmed\"), and the third one is \"error\"(auto-confirm periodic task find the instance vm_state is 'active', not 'resized', so it was changed to \"error\"), and I found the first migration is confirmed TWO times.(so this may be a race condition problem)", 
            "date_created": "2013-02-27 09:06:36.585891+00:00", 
            "author": "https://api.launchpad.net/1.0/~hzwangpan"
        }, 
        {
            "content": "can you try this with grizzly please?", 
            "date_created": "2013-03-04 14:57:28.819855+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }, 
        {
            "content": "Hi Chuck, I will ask our QA to run a regression test with Grizzly.", 
            "date_created": "2013-03-05 02:19:30.859174+00:00", 
            "author": "https://api.launchpad.net/1.0/~hzwangpan"
        }, 
        {
            "content": "Our QA has run the same testcase with grizzly(master branch on github) more than 20 times, this bug doesn't emerge, so I close it now, and if this bug reappears later in grizzly with more fully tests, I will reopen it.", 
            "date_created": "2013-03-06 07:48:51.209151+00:00", 
            "author": "https://api.launchpad.net/1.0/~hzwangpan"
        }
    ], 
    "closed": "2013-03-06 07:49:04.864502+00:00"
}