{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:40:59.599606+00:00", 
    "description": "During spawn, if a local volume for the backing block device fails to be created, the cleanup operation for the volume can fail with a \"UnboundLocalError: local variable 'disk_name' referenced before assignment\" error.\n\nThe fix is to assign to disk_name earlier and check for None before running cleanup.\n\nLogs:\n\n2013-05-16 13:40:34.521 ERROR nova.virt.powervm.blockdev [req-5bf9faeb-d14e-45d9-afc5-6c9e90e82257 4e06f68d356744f1a4e832e3c154c1d9 b3b27607effe4cc6a284ae4278d67a2a] Could not create logical volume. No space left on any volume group.\n2013-05-16 13:40:34.522 ERROR nova.virt.powervm.blockdev [req-5bf9faeb-d14e-45d9-afc5-6c9e90e82257 4e06f68d356744f1a4e832e3c154c1d9 b3b27607effe4cc6a284ae4278d67a2a] Error while creating logical volume from image. Will attempt cleanup.\n2013-05-16 13:40:34.523 ERROR nova.virt.powervm.blockdev [req-5bf9faeb-d14e-45d9-afc5-6c9e90e82257 4e06f68d356744f1a4e832e3c154c1d9 b3b27607effe4cc6a284ae4278d67a2a] Error while attempting cleanup of failed deploy to logical volume.\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev Traceback (most recent call last):\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 309, in create_volume_from_image\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev     self.delete_volume(disk_name)\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev UnboundLocalError: local variable 'disk_name' referenced before assignment\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev\n2013-05-16 13:40:34.525 ERROR nova.virt.powervm.operator [req-5bf9faeb-d14e-45d9-afc5-6c9e90e82257 4e06f68d356744f1a4e832e3c154c1d9 b3b27607effe4cc6a284ae4278d67a2a] PowerVM image creation failed: No space left on any volume group\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator Traceback (most recent call last):\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 345, in _create_image\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     context, instance, image_id)\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 313, in create_volume_from_image\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     LOG.exception(msg)\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     self.gen.next()\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 299, in create_volume_from_image\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     disk_name = self._create_logical_volume(size)\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 450, in _create_logical_volume\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     raise exception.PowerVMNoSpaceLeftOnVolumeGroup()\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator PowerVMNoSpaceLeftOnVolumeGroup: No space left on any volume group\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator", 
    "tags": [
        "powervm"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1180955", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1180955, 
    "index": 4929, 
    "openned": "2013-05-16 19:14:01.873248+00:00", 
    "created": "2013-05-16 19:14:01.873248+00:00", 
    "title": "powervm error'd local volume cleanup fails", 
    "comments": [
        {
            "content": "During spawn, if a local volume for the backing block device fails to be created, the cleanup operation for the volume can fail with a \"UnboundLocalError: local variable 'disk_name' referenced before assignment\" error.\n\nThe fix is to assign to disk_name earlier and check for None before running cleanup.\n\nLogs:\n\n2013-05-16 13:40:34.521 ERROR nova.virt.powervm.blockdev [req-5bf9faeb-d14e-45d9-afc5-6c9e90e82257 4e06f68d356744f1a4e832e3c154c1d9 b3b27607effe4cc6a284ae4278d67a2a] Could not create logical volume. No space left on any volume group.\n2013-05-16 13:40:34.522 ERROR nova.virt.powervm.blockdev [req-5bf9faeb-d14e-45d9-afc5-6c9e90e82257 4e06f68d356744f1a4e832e3c154c1d9 b3b27607effe4cc6a284ae4278d67a2a] Error while creating logical volume from image. Will attempt cleanup.\n2013-05-16 13:40:34.523 ERROR nova.virt.powervm.blockdev [req-5bf9faeb-d14e-45d9-afc5-6c9e90e82257 4e06f68d356744f1a4e832e3c154c1d9 b3b27607effe4cc6a284ae4278d67a2a] Error while attempting cleanup of failed deploy to logical volume.\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev Traceback (most recent call last):\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 309, in create_volume_from_image\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev     self.delete_volume(disk_name)\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev UnboundLocalError: local variable 'disk_name' referenced before assignment\n2013-05-16 13:40:34.523 18061 TRACE nova.virt.powervm.blockdev\n2013-05-16 13:40:34.525 ERROR nova.virt.powervm.operator [req-5bf9faeb-d14e-45d9-afc5-6c9e90e82257 4e06f68d356744f1a4e832e3c154c1d9 b3b27607effe4cc6a284ae4278d67a2a] PowerVM image creation failed: No space left on any volume group\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator Traceback (most recent call last):\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/operator.py\", line 345, in _create_image\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     context, instance, image_id)\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 313, in create_volume_from_image\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     LOG.exception(msg)\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     self.gen.next()\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 299, in create_volume_from_image\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     disk_name = self._create_logical_volume(size)\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator   File \"/usr/lib/python2.6/site-packages/nova/virt/powervm/blockdev.py\", line 450, in _create_logical_volume\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator     raise exception.PowerVMNoSpaceLeftOnVolumeGroup()\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator PowerVMNoSpaceLeftOnVolumeGroup: No space left on any volume group\n2013-05-16 13:40:34.525 18061 TRACE nova.virt.powervm.operator", 
            "date_created": "2013-05-16 19:14:01.873248+00:00", 
            "author": "https://api.launchpad.net/1.0/~locke105"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/29991", 
            "date_created": "2013-05-21 20:35:50.136438+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/29991\nCommitted: http://github.com/openstack/nova/commit/6ea7df2cbcdca6c9be0c44d2436e24549c499297\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6ea7df2cbcdca6c9be0c44d2436e24549c499297\nAuthor: Matt Riedemann <email address hidden>\nDate:   Tue May 21 13:33:19 2013 -0700\n\n    Fix UnboundLocalError in powervm lvm cleanup code\n    \n    During spawn, if a local volume for the backing block device fails to\n    be created, the cleanup operation for the volume can fail with a\n    \"UnboundLocalError: local variable 'disk_name' referenced before\n    assignment\" error.\n    \n    The fix is to assign to disk_name earlier and check for None before\n    running cleanup.\n    \n    This patch also adds tests to cover the failure case.\n    \n    Fixes bug 1180955\n    \n    Change-Id: I0f32df1586d7bd87eccb674fec2a9597b1ce351d\n", 
            "date_created": "2013-05-23 17:48:28.618101+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-05-29 10:35:37.554796+00:00"
}