{
    "status": "Fix Released", 
    "last_updated": "2010-10-25 20:14:36.104763+00:00", 
    "description": "Keypairs were stored in LDAP for historical reasons (in nova 0.1, LDAP was the only persistent datastore)\n\nNow that we've got a more solid datastore, it would be nice to move them to where the rest of the non-user data resides.\n\nStoring the keys in LDAP added complexity and brittleness to the code (since we had to add a custom LDAP schema, and LDAP seems to throw exceptions 0.5% of the time when we launch instances:\n\nERROR:root:instance i-1470: Failed to spawn\nTraceback (most recent call last):\n File \"/srv/cloud/nova/nova/compute/manager.py\", line 86, in run_instance\n   yield self.driver.spawn(instance_ref)\n File \"/usr/local/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 821, in _inlineCallbacks\n   result = result.throwExceptionIntoGenerator(g)\n File \"/usr/local/lib/python2.6/dist-packages/twisted/python/failure.py\", line 338, in throwExceptionIntoGenerator\n   return g.throw(self.type, self.value, self.tb)\n File \"/srv/cloud/nova/nova/virt/libvirt_conn.py\", line 217, in spawn\n   yield self._create_image(instance, xml)\n File \"/usr/local/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 823, in _inlineCallbacks\n   result = g.send(result)\n File \"/srv/cloud/nova/nova/virt/libvirt_conn.py\", line 267, in _create_image\n   project = manager.AuthManager().get_project(inst['project_id'])\n File \"/srv/cloud/nova/nova/auth/manager.py\", line 484, in get_project\n   with self.driver() as drv:\n File \"/srv/cloud/nova/nova/auth/ldapdriver.py\", line 82, in __enter__\n   self.conn.simple_bind_s(FLAGS.ldap_user_dn, FLAGS.ldap_password)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 207, in simple_bind_s\n   return self.result(msgid,all=1,timeout=self.timeout)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 436, in result\n   res_type,res_data,res_msgid = self.result2(msgid,all,timeout)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 440, in result2\n   res_type, res_data, res_msgid, srv_ctrls = self.result3(msgid,all,timeout)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 446, in result3\n   ldap_result = self._ldap_call(self._l.result3,msgid,all,timeout)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 96, in _ldap_call\n   result = func(*args,**kwargs)\nSERVER_DOWN: {'desc': \"Can't contact LDAP server\"}", 
    "tags": [], 
    "importance": "Low", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/637805", 
    "owner": "None", 
    "id": 637805, 
    "index": 35, 
    "openned": "2010-09-14 06:09:59.802061+00:00", 
    "created": "2010-09-14 06:09:59.802061+00:00", 
    "title": "keypairs shouldn't be in LDAP", 
    "comments": [
        {
            "content": "Keypairs were stored in LDAP for historical reasons (in nova 0.1, LDAP was the only persistent datastore)\n\nNow that we've got a more solid datastore, it would be nice to move them to where the rest of the non-user data resides.\n\nStoring the keys in LDAP added complexity and brittleness to the code (since we had to add a custom LDAP schema, and LDAP seems to throw exceptions 0.5% of the time when we launch instances:\n\nERROR:root:instance i-1470: Failed to spawn\nTraceback (most recent call last):\n File \"/srv/cloud/nova/nova/compute/manager.py\", line 86, in run_instance\n   yield self.driver.spawn(instance_ref)\n File \"/usr/local/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 821, in _inlineCallbacks\n   result = result.throwExceptionIntoGenerator(g)\n File \"/usr/local/lib/python2.6/dist-packages/twisted/python/failure.py\", line 338, in throwExceptionIntoGenerator\n   return g.throw(self.type, self.value, self.tb)\n File \"/srv/cloud/nova/nova/virt/libvirt_conn.py\", line 217, in spawn\n   yield self._create_image(instance, xml)\n File \"/usr/local/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 823, in _inlineCallbacks\n   result = g.send(result)\n File \"/srv/cloud/nova/nova/virt/libvirt_conn.py\", line 267, in _create_image\n   project = manager.AuthManager().get_project(inst['project_id'])\n File \"/srv/cloud/nova/nova/auth/manager.py\", line 484, in get_project\n   with self.driver() as drv:\n File \"/srv/cloud/nova/nova/auth/ldapdriver.py\", line 82, in __enter__\n   self.conn.simple_bind_s(FLAGS.ldap_user_dn, FLAGS.ldap_password)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 207, in simple_bind_s\n   return self.result(msgid,all=1,timeout=self.timeout)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 436, in result\n   res_type,res_data,res_msgid = self.result2(msgid,all,timeout)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 440, in result2\n   res_type, res_data, res_msgid, srv_ctrls = self.result3(msgid,all,timeout)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 446, in result3\n   ldap_result = self._ldap_call(self._l.result3,msgid,all,timeout)\n File \"/usr/lib/python2.6/dist-packages/ldap/ldapobject.py\", line 96, in _ldap_call\n   result = func(*args,**kwargs)\nSERVER_DOWN: {'desc': \"Can't contact LDAP server\"}", 
            "date_created": "2010-09-14 06:09:59.802061+00:00", 
            "author": "https://api.launchpad.net/1.0/~anotherjesse"
        }, 
        {
            "content": "Setting to confirmed, as I've run into this myself.", 
            "date_created": "2010-09-14 14:30:19.295965+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }
    ], 
    "closed": "2010-10-25 20:14:35.555484+00:00"
}