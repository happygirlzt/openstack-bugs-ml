{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 08:48:11.361495+00:00", 
    "description": "When migrate vm on hyperV, command fails with the following error:\n\n2013-10-25 03:35:40.299 12396 ERROR nova.openstack.common.rpc.amqp [req-b542e0fd-74f5-4e53-889c-48a3b44e2887 3a75a18c8b60480d9369b25ab06519b3 0d44e4afd3d448c6acf0089df2dc7658] Exception during message handling\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\amqp.py\", line 461, in _process_data\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\dispatcher.py\", line 172, in dispatch\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 90, in wrapped\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 73, in wrapped\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 4103, in live_migration\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     block_migration, migrate_data)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\driver.py\", line 118, in live_migration\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     block_migration, migrate_data)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationops.py\", line 44, in wrapper\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     return function(self, *args, **kwds)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationops.py\", line 76, in live_migration\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     recover_method(context, instance_ref, dest, block_migration)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationops.py\", line 69, in live_migration\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     dest)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationutils.py\", line 231, in live_migrate_vm\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     disk_paths = self._get_physical_disk_paths(vm_name)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationutils.py\", line 114, in _get_physical_disk_paths\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     ide_paths = self._vmutils.get_controller_volume_paths(ide_ctrl_path)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmutils.py\", line 553, in get_controller_volume_paths\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     \"parent\": controller_path})\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\wmi.py\", line 1009, in query\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     return [ _wmi_object (obj, instance_of, fields) for obj in self._raw_query(wql) ]\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\win32com\\client\\util.py\", line 84, in next\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     return _get_good_object_(self._iter_.next(), resultCLSID = self.resultCLSID)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp com_error: (-2147217385, 'OLE error 0x80041017', None, None)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp", 
    "tags": [
        "hyper-v"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1246592", 
    "owner": "https://api.launchpad.net/1.0/~yahongdu", 
    "id": 1246592, 
    "index": 1294, 
    "openned": "2013-10-31 05:46:56.008089+00:00", 
    "created": "2013-10-31 05:46:56.008089+00:00", 
    "title": "Nova live migration failed due to OLE error", 
    "comments": [
        {
            "content": "When migrate vm on hyperV, command fails with the following error:\n\n2013-10-25 03:35:40.299 12396 ERROR nova.openstack.common.rpc.amqp [req-b542e0fd-74f5-4e53-889c-48a3b44e2887 3a75a18c8b60480d9369b25ab06519b3 0d44e4afd3d448c6acf0089df2dc7658] Exception during message handling\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\amqp.py\", line 461, in _process_data\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     **args)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\openstack\\common\\rpc\\dispatcher.py\", line 172, in dispatch\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 90, in wrapped\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     payload)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\exception.py\", line 73, in wrapped\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     return f(self, context, *args, **kw)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\compute\\manager.py\", line 4103, in live_migration\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     block_migration, migrate_data)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\driver.py\", line 118, in live_migration\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     block_migration, migrate_data)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationops.py\", line 44, in wrapper\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     return function(self, *args, **kwds)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationops.py\", line 76, in live_migration\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     recover_method(context, instance_ref, dest, block_migration)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationops.py\", line 69, in live_migration\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     dest)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationutils.py\", line 231, in live_migrate_vm\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     disk_paths = self._get_physical_disk_paths(vm_name)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\livemigrationutils.py\", line 114, in _get_physical_disk_paths\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     ide_paths = self._vmutils.get_controller_volume_paths(ide_ctrl_path)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\nova\\virt\\hyperv\\vmutils.py\", line 553, in get_controller_volume_paths\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     \"parent\": controller_path})\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\wmi.py\", line 1009, in query\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     return [ _wmi_object (obj, instance_of, fields) for obj in self._raw_query(wql) ]\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp   File \"C:\\Program Files (x86)\\IBM\\SmartCloud Entry\\Hyper-V Agent\\Python27\\lib\\site-packages\\win32com\\client\\util.py\", line 84, in next\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp     return _get_good_object_(self._iter_.next(), resultCLSID = self.resultCLSID)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp com_error: (-2147217385, 'OLE error 0x80041017', None, None)\n2013-10-25 03:35:40.299 12396 TRACE nova.openstack.common.rpc.amqp", 
            "date_created": "2013-10-31 05:46:56.008089+00:00", 
            "author": "https://api.launchpad.net/1.0/~yahongdu"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/54677", 
            "date_created": "2013-10-31 06:05:51.484084+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Hi, can you please post the log on paste.openstack.org and paste the link here?\nIt's really hard to read the logs inside of a bug description.\n\nAt a first glance, it looks like it fails when attaching the iSCSI volumes.\nCan you please confirm if there are issues with live migration in case of instances with local storage only?\n\nBeside that we need some additional context:\n\n-OpenStack version\n-Hyper-V version\n-iSCSI volume solution used\n\n\n", 
            "date_created": "2013-10-31 14:12:07.338438+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexpilotti"
        }, 
        {
            "content": "Just saw the fix proposed for review, no need for additional data anymore to triage the bug. Thanks.", 
            "date_created": "2013-10-31 14:23:23.088242+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexpilotti"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/54677\nCommitted: http://github.com/openstack/nova/commit/e74ceb68e1642d773f2ad0c655e6354f7a7fb362\nSubmitter: Jenkins\nBranch:    master\n\ncommit e74ceb68e1642d773f2ad0c655e6354f7a7fb362\nAuthor: DuYaHong <email address hidden>\nDate:   Thu Oct 31 13:56:08 2013 +0800\n\n    Fix OLE error for HyperV\n    \n    When run live-migration on HyperV, an OLE error\n    will occur. This is because we use wrong WQL\n    sentence when we try to query table\n    'Msvm_ResourceAllocationSettingData'.\n    \n    This commit fixes the wrong WQL sentence.\n    \n    Closes-Bug: #1246592\n    \n    Change-Id: Iabb4096002a5be1fb930b077fbf5ef734893c258\n", 
            "date_created": "2013-11-11 16:17:49.585392+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/havana\nReview: https://review.openstack.org/55961", 
            "date_created": "2013-11-12 03:50:56.258585+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/55961\nCommitted: http://github.com/openstack/nova/commit/d5409f210fb1f4d9e290c08e8b7e5e08eb82fad1\nSubmitter: Jenkins\nBranch:    stable/havana\n\ncommit d5409f210fb1f4d9e290c08e8b7e5e08eb82fad1\nAuthor: DuYaHong <email address hidden>\nDate:   Thu Oct 31 13:56:08 2013 +0800\n\n    Fix OLE error for HyperV\n    \n    When run live-migration on HyperV, an OLE error\n    will occur. This is because we use wrong WQL\n    sentence when we try to query table\n    'Msvm_ResourceAllocationSettingData'.\n    \n    This commit fixes the wrong WQL sentence.\n    \n    Closes-Bug: #1246592\n    \n    Change-Id: Iabb4096002a5be1fb930b077fbf5ef734893c258\n    (cherry picked from commit e74ceb68e1642d773f2ad0c655e6354f7a7fb362)\n", 
            "date_created": "2013-12-04 23:21:03.175458+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-12-04 10:04:33.541339+00:00"
}