{
    "status": "Expired", 
    "last_updated": "2015-05-04 04:17:21.635140+00:00", 
    "description": "I'm running 2014.2.1 on CentOS7. 1 controller and 5 compute nodes are deployed using packstack.\n\nWhenever I reboot the controller node, some of nova-compute services report state=XXX even after 60 minutes after reboot completed and controller node is up and running again:\n\n[root@juno1 ~(keystone_admin)]# nova-manage service list\nBinary           Host                                 Zone             Status     State Updated_At\nnova-consoleauth juno1                                internal         enabled    :-)   2014-12-19 13:17:48\nnova-scheduler   juno1                                internal         enabled    :-)   2014-12-19 13:17:47\nnova-conductor   juno1                                internal         enabled    :-)   2014-12-19 13:17:47\nnova-cert        juno1                                internal         enabled    :-)   2014-12-19 13:17:48\nnova-compute     juno4                                nova             enabled    XXX   2014-12-19 12:26:56\nnova-compute     juno5                                nova             enabled    :-)   2014-12-19 13:17:47\nnova-compute     juno6                                nova             enabled    :-)   2014-12-19 13:17:46\nnova-compute     juno3                                nova             enabled    :-)   2014-12-19 13:17:46\nnova-compute     juno2                                nova             enabled    XXX   2014-12-19 12:21:52\n\nHere is the chunk of nova-compute log from juno4:\n\n2014-12-19 15:46:02.082 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:02.083 5193 ERROR oslo.messaging._drivers.impl_rabbit [-] Failed to consume message from queue: Socket closed\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit Traceback (most recent call last):\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 655, in ensure\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return method()\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 735, in _consume\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return self.connection.drain_events(timeout=timeout)\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/connection.py\", line 281, in drain_events\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return self.transport.drain_events(self.connection, **kwargs)\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/transport/pyamqp.py\", line 94, in drain_events\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return connection.drain_events(**kwargs)\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/connection.py\", line 299, in drain_events\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     chanmap, None, timeout=timeout,\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/connection.py\", line 362, in _wait_multiple\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     channel, method_sig, args, content = read_timeout(timeout)\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/connection.py\", line 333, in read_timeout\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return self.method_reader.read_method()\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/method_framing.py\", line 189, in read_method\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     raise m\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit IOError: Socket closed\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit \n2014-12-19 15:46:02.084 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:03.084 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:03.096 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:03.105 5193 ERROR oslo.messaging._drivers.impl_rabbit [-] AMQP server on 9.167.185.90:5672 is unreachable: [Errno 111] ECONNREFUSED. Trying again in 1 seconds.\n2014-12-19 15:46:03.105 5193 ERROR oslo.messaging._drivers.impl_rabbit [-] AMQP server on 9.167.185.90:5672 is unreachable: [Errno 111] ECONNREFUSED. Trying again in 1 seconds.\n2014-12-19 15:46:04.106 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:04.106 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:05.106 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:05.116 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:05.157 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connected to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:05.159 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connected to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:33.229 5193 AUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\n2014-12-19 15:46:33.781 5193 ERROR oslo.messaging._drivers.impl_rabbit [-] Failed to publish message to topic 'conductor': [Errno 104] Connection reset by peer\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit Traceback (most recent call last):\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 655, in ensure\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     return method()\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 752, in _publish\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     publisher = cls(self.conf, self.channel, topic=topic, **kwargs)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 378, in __init__\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     **options)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 326, in __init__\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.reconnect(channel)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 334, in reconnect\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     routing_key=self.routing_key)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/messaging.py\", line 83, in __init__\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.revive(self._channel)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/messaging.py\", line 214, in revive\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.declare()\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/messaging.py\", line 100, in declare\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.exchange.declare()\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/entity.py\", line 163, in declare\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     nowait=nowait, passive=passive,\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/channel.py\", line 613, in exchange_declare\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self._send_method((40, 10), args)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/abstract_channel.py\", line 56, in _send_method\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.channel_id, method_sig, args, content,\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/method_framing.py\", line 221, in write_method\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     write_frame(1, channel, payload)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/transport.py\", line 177, in write_frame\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     frame_type, channel, size, payload, 0xce,\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/eventlet/greenio.py\", line 359, in sendall\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     tail = self.send(data, flags)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/eventlet/greenio.py\", line 342, in send\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     total_sent += fd.send(data[total_sent:], flags)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit error: [Errno 104] Connection reset by peer\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit \n2014-12-19 15:46:33.782 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:34.782 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:34.796 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connected to AMQP server on 9.167.185.90:5672\n\nI see, that nova-compute lost AMQ connection with controller node because of reboot, but then connection was established again after reboot completed.\nI also can manage running instances on that compute node and see correct instance states.\n\nThe problem can be solved if I do: systemctl restart openstack-nova-compute on nodes with XXX state. After that I see expected :-)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1404241", 
    "owner": "None", 
    "id": 1404241, 
    "index": 6604, 
    "openned": "2014-12-19 13:32:48.656688+00:00", 
    "created": "2014-12-19 13:32:48.656688+00:00", 
    "title": "nova-compute state not updated", 
    "comments": [
        {
            "content": "I'm running 2014.2.1 on CentOS7. 1 controller and 5 compute nodes are deployed using packstack.\n\nWhenever I reboot the controller node, some of nova-compute services report state=XXX even after 60 minutes after reboot completed and controller node is up and running again:\n\n[root@juno1 ~(keystone_admin)]# nova-manage service list\nBinary           Host                                 Zone             Status     State Updated_At\nnova-consoleauth juno1                                internal         enabled    :-)   2014-12-19 13:17:48\nnova-scheduler   juno1                                internal         enabled    :-)   2014-12-19 13:17:47\nnova-conductor   juno1                                internal         enabled    :-)   2014-12-19 13:17:47\nnova-cert        juno1                                internal         enabled    :-)   2014-12-19 13:17:48\nnova-compute     juno4                                nova             enabled    XXX   2014-12-19 12:26:56\nnova-compute     juno5                                nova             enabled    :-)   2014-12-19 13:17:47\nnova-compute     juno6                                nova             enabled    :-)   2014-12-19 13:17:46\nnova-compute     juno3                                nova             enabled    :-)   2014-12-19 13:17:46\nnova-compute     juno2                                nova             enabled    XXX   2014-12-19 12:21:52\n\nHere is the chunk of nova-compute log from juno4:\n\n2014-12-19 15:46:02.082 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:02.083 5193 ERROR oslo.messaging._drivers.impl_rabbit [-] Failed to consume message from queue: Socket closed\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit Traceback (most recent call last):\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 655, in ensure\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return method()\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 735, in _consume\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return self.connection.drain_events(timeout=timeout)\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/connection.py\", line 281, in drain_events\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return self.transport.drain_events(self.connection, **kwargs)\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/transport/pyamqp.py\", line 94, in drain_events\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return connection.drain_events(**kwargs)\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/connection.py\", line 299, in drain_events\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     chanmap, None, timeout=timeout,\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/connection.py\", line 362, in _wait_multiple\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     channel, method_sig, args, content = read_timeout(timeout)\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/connection.py\", line 333, in read_timeout\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     return self.method_reader.read_method()\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/method_framing.py\", line 189, in read_method\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit     raise m\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit IOError: Socket closed\n2014-12-19 15:46:02.083 5193 TRACE oslo.messaging._drivers.impl_rabbit \n2014-12-19 15:46:02.084 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:03.084 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:03.096 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:03.105 5193 ERROR oslo.messaging._drivers.impl_rabbit [-] AMQP server on 9.167.185.90:5672 is unreachable: [Errno 111] ECONNREFUSED. Trying again in 1 seconds.\n2014-12-19 15:46:03.105 5193 ERROR oslo.messaging._drivers.impl_rabbit [-] AMQP server on 9.167.185.90:5672 is unreachable: [Errno 111] ECONNREFUSED. Trying again in 1 seconds.\n2014-12-19 15:46:04.106 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:04.106 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:05.106 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:05.116 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:05.157 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connected to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:05.159 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connected to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:33.229 5193 AUDIT nova.compute.resource_tracker [-] Auditing locally available compute resources\n2014-12-19 15:46:33.781 5193 ERROR oslo.messaging._drivers.impl_rabbit [-] Failed to publish message to topic 'conductor': [Errno 104] Connection reset by peer\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit Traceback (most recent call last):\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 655, in ensure\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     return method()\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 752, in _publish\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     publisher = cls(self.conf, self.channel, topic=topic, **kwargs)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 378, in __init__\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     **options)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 326, in __init__\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.reconnect(channel)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/oslo/messaging/_drivers/impl_rabbit.py\", line 334, in reconnect\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     routing_key=self.routing_key)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/messaging.py\", line 83, in __init__\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.revive(self._channel)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/messaging.py\", line 214, in revive\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.declare()\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/messaging.py\", line 100, in declare\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.exchange.declare()\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/kombu/entity.py\", line 163, in declare\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     nowait=nowait, passive=passive,\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/channel.py\", line 613, in exchange_declare\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self._send_method((40, 10), args)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/abstract_channel.py\", line 56, in _send_method\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     self.channel_id, method_sig, args, content,\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/method_framing.py\", line 221, in write_method\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     write_frame(1, channel, payload)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/amqp/transport.py\", line 177, in write_frame\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     frame_type, channel, size, payload, 0xce,\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/eventlet/greenio.py\", line 359, in sendall\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     tail = self.send(data, flags)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit   File \"/usr/lib/python2.7/site-packages/eventlet/greenio.py\", line 342, in send\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit     total_sent += fd.send(data[total_sent:], flags)\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit error: [Errno 104] Connection reset by peer\n2014-12-19 15:46:33.781 5193 TRACE oslo.messaging._drivers.impl_rabbit \n2014-12-19 15:46:33.782 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Delaying reconnect for 1.0 seconds...\n2014-12-19 15:46:34.782 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connecting to AMQP server on 9.167.185.90:5672\n2014-12-19 15:46:34.796 5193 INFO oslo.messaging._drivers.impl_rabbit [-] Connected to AMQP server on 9.167.185.90:5672\n\nI see, that nova-compute lost AMQ connection with controller node because of reboot, but then connection was established again after reboot completed.\nI also can manage running instances on that compute node and see correct instance states.\n\nThe problem can be solved if I do: systemctl restart openstack-nova-compute on nodes with XXX state. After that I see expected :-)", 
            "date_created": "2014-12-19 13:32:48.656688+00:00", 
            "author": "https://api.launchpad.net/1.0/~scsnow"
        }, 
        {
            "content": "", 
            "date_created": "2014-12-19 13:32:48.656688+00:00", 
            "author": "https://api.launchpad.net/1.0/~scsnow"
        }, 
        {
            "content": "It sounds like there may be an issue in oslo.messaging with reconnecting", 
            "date_created": "2014-12-23 01:40:29.112474+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "If it's oslo issue why it affects only nova-compute service, while neutron's l2 agents running on the same compute nodes report correct state.", 
            "date_created": "2014-12-23 08:40:53.435540+00:00", 
            "author": "https://api.launchpad.net/1.0/~scsnow"
        }, 
        {
            "content": "http://docs.openstack.org/openstack-ops/content/maintenance.html\n\n\"Also, in practice, the nova-compute services on the compute nodes do not always reconnect cleanly to rabbitmq hosted on the controller when it comes back up after a long reboot; a restart on the nova services on the compute nodes is required.\"", 
            "date_created": "2015-02-02 12:29:00.109524+00:00", 
            "author": "https://api.launchpad.net/1.0/~scsnow"
        }, 
        {
            "content": "I'm almost sure that this bug doesn't exists anymore since oslo.msg 1.5 or 1.6", 
            "date_created": "2015-02-27 16:22:45.915753+00:00", 
            "author": "https://api.launchpad.net/1.0/~sileht"
        }, 
        {
            "content": "Which version of oslo.messaging exhibits this issue?", 
            "date_created": "2015-03-02 18:20:26.776077+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }, 
        {
            "content": "[root@juno1 api_tests]# rpm -qa | grep oslo\npython-oslo-config-1.4.0-1.el7.centos.noarch\npython-oslo-vmware-0.6.0-1.el7.centos.noarch\npython-oslo-i18n-1.0.0-1.el7.centos.noarch\npython-oslo-rootwrap-1.3.0.0-1.el7.centos.noarch\npython-oslo-utils-1.0.0-1.el7.centos.noarch\npython-oslo-db-1.0.2-2.el7.centos.noarch\npython-oslo-messaging-1.4.1-3.el7.centos.noarch\npython-oslo-sphinx-1.1-2.el7.centos.noarch\npython-oslo-serialization-0.3.0-1.el7.centos.noarch", 
            "date_created": "2015-03-04 10:53:45.346092+00:00", 
            "author": "https://api.launchpad.net/1.0/~scsnow"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2015-05-04 04:17:18.132227+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2015-05-04 04:17:19.063656+00:00"
}