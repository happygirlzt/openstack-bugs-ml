{
    "status": "Fix Released", 
    "last_updated": "2015-11-19 21:48:10.109752+00:00", 
    "description": "Currently, the code in the PciDevTracker.__init__() method of nova/pci/manager.py reads:\n\n```\n    def __init__(self, node_id=None):                                                                                                                                                       \n        \"\"\"Create a pci device tracker.                                                                                                                                                     \n                                                                                                                                                                                            \n        If a node_id is passed in, it will fetch pci devices information                                                                                                                    \n        from database, otherwise, it will create an empty devices list                                                                                                                      \n        and the resource tracker will update the node_id information later.                                                                                                                 \n        \"\"\"                                                                                                                                                                                 \n                                                                                                                                                                                            \n        super(PciDevTracker, self).__init__()                                                                                                                                               \n        self.stale = {}                                                                                                                                                                     \n        self.node_id = node_id                                                                                                                                                              \n        self.stats = stats.PciDeviceStats()                                                                                                                                                 \n        if node_id:                                                                                                                                                                         \n            self.pci_devs = list(                                                                                                                                                           \n                objects.PciDeviceList.get_by_compute_node(context, node_id))                                                                                                                \n        else:                                                                                                                                                                               \n            self.pci_devs = []                                                                                                                                                              \n        self._initial_instance_usage()                  \n```\n\nThe problem is that in the call to `objects.PciDeviceList.get_by_compute_node(context, node_id)`, there is no local value for the 'context' parameter, so as a result, the context module defined in the imports is what is passed.\n\nInstead, the parameter should be changed to `context.get_admin_context()`.", 
    "tags": [
        "pci-passthrough"
    ], 
    "importance": "Low", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1408480", 
    "owner": "https://api.launchpad.net/1.0/~ed-leafe", 
    "id": 1408480, 
    "index": 1480, 
    "openned": "2015-01-07 22:32:57.666143+00:00", 
    "created": "2015-01-07 22:32:57.666143+00:00", 
    "title": "PciDevTracker passes context module instead of instance", 
    "comments": [
        {
            "content": "Currently, the code in the PciDevTracker.__init__() method of nova/pci/manager.py reads:\n\n```\n    def __init__(self, node_id=None):                                                                                                                                                       \n        \"\"\"Create a pci device tracker.                                                                                                                                                     \n                                                                                                                                                                                            \n        If a node_id is passed in, it will fetch pci devices information                                                                                                                    \n        from database, otherwise, it will create an empty devices list                                                                                                                      \n        and the resource tracker will update the node_id information later.                                                                                                                 \n        \"\"\"                                                                                                                                                                                 \n                                                                                                                                                                                            \n        super(PciDevTracker, self).__init__()                                                                                                                                               \n        self.stale = {}                                                                                                                                                                     \n        self.node_id = node_id                                                                                                                                                              \n        self.stats = stats.PciDeviceStats()                                                                                                                                                 \n        if node_id:                                                                                                                                                                         \n            self.pci_devs = list(                                                                                                                                                           \n                objects.PciDeviceList.get_by_compute_node(context, node_id))                                                                                                                \n        else:                                                                                                                                                                               \n            self.pci_devs = []                                                                                                                                                              \n        self._initial_instance_usage()                  \n```\n\nThe problem is that in the call to `objects.PciDeviceList.get_by_compute_node(context, node_id)`, there is no local value for the 'context' parameter, so as a result, the context module defined in the imports is what is passed.\n\nInstead, the parameter should be changed to `context.get_admin_context()`.", 
            "date_created": "2015-01-07 22:32:57.666143+00:00", 
            "author": "https://api.launchpad.net/1.0/~ed-leafe"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/145619", 
            "date_created": "2015-01-07 22:59:43.943981+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/145619\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=50ee9dd76e8955dd57e5a7318be023c76c462f67\nSubmitter: Jenkins\nBranch:    master\n\ncommit 50ee9dd76e8955dd57e5a7318be023c76c462f67\nAuthor: EdLeafe <email address hidden>\nDate:   Mon Jan 12 15:56:21 2015 +0000\n\n    Pass correct context to get_by_compute_node()\n    \n    A recent change to the PciDevTracker class allowed for the passing of\n    the compute node ID to the __init__() method, where\n    PciDevsList.get_by_compute_node() was called with a 'context' parameter,\n    which wasn't defined, resulting in the imported context module being\n    passed instead.\n    \n    This change requires that the context be passed in to the __init__() for\n    the PciDevTracker class, and that that be used to create the\n    PciDevsList. The existing import of the context module is no longer\n    needed in the pci/manager.py file, so the conflict is no longer a\n    problem. The only place in the code that currently instantiates a\n    PciDevTracker object is in the ResourceTracker, so that has been updated\n    to pass in the context. A unit test to check for context has also been\n    added.\n    \n    Change-Id: Id136eabacb00e4381c03f12d8484fc90a5eb48b1\n    Closes-Bug: #1408480\n", 
            "date_created": "2015-03-13 07:43:12.095187+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/173225", 
            "date_created": "2015-04-14 09:12:27.685390+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "While this is Low by itself, it is required for Juno backport of bug 1415768", 
            "date_created": "2015-04-15 10:56:58.298283+00:00", 
            "author": "https://api.launchpad.net/1.0/~apevec"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/173225\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=cfce73b36a3afe4e8be889faf3f5ec78bd19c0c7\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit cfce73b36a3afe4e8be889faf3f5ec78bd19c0c7\nAuthor: EdLeafe <email address hidden>\nDate:   Mon Jan 12 15:56:21 2015 +0000\n\n    Pass correct context to get_by_compute_node()\n    \n    A recent change to the PciDevTracker class allowed for the passing of\n    the compute node ID to the __init__() method, where\n    PciDevsList.get_by_compute_node() was called with a 'context' parameter,\n    which wasn't defined, resulting in the imported context module being\n    passed instead.\n    \n    This change requires that the context be passed in to the __init__() for\n    the PciDevTracker class, and that that be used to create the\n    PciDevsList. The existing import of the context module is no longer\n    needed in the pci/manager.py file, so the conflict is no longer a\n    problem. The only place in the code that currently instantiates a\n    PciDevTracker object is in the ResourceTracker, so that has been updated\n    to pass in the context. A unit test to check for context has also been\n    added.\n    \n    (cherry picked from commit 50ee9dd76e8955dd57e5a7318be023c76c462f67)\n    \n    Conflicts:\n    \tnova/compute/resource_tracker.py\n    \tnova/tests/pci/test_pci_manager.py\n    \n    Closes-Bug: #1408480\n    Change-Id: Id136eabacb00e4381c03f12d8484fc90a5eb48b1\n", 
            "date_created": "2015-04-16 12:02:17.304558+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-03-20 07:40:50.777805+00:00"
}