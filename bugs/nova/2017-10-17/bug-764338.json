{
    "status": "Invalid", 
    "last_updated": "2011-04-18 08:44:16.869030+00:00", 
    "description": "Summary:\nWhen creating a range of floating IP to assign  as Public IPs to instances in a project using the nova-manage floating create command, the nova.floating_ips 'project_id' column isn't being updated with the project name.\nThis gives the following error message when associating an address to an instance which is subsequently fixed if you manually update the project_id column in floating_ips table:\n\nNotFound: No floating ip for address 172.241.0.3\n\n\n\nScenario:\nUser (admin): kevinj\nProject: myproject\nHost: nova-api\n\nSteps to recreate:\n1. Create the public IP address range for this host:\n\nsudo nova-manage floating create nova-api 172.241.0.0/25\n\n2. Spin an instance up:\n\neuca-describe-instances \nRESERVATION\tr-lcfi0zfs\tmyproject\tdefault\nINSTANCE\ti-00000003\tami-33baf2c6\t10.0.0.3\t10.0.0.3\trunning\topenstack (myproject, nova-api)\t0\t\tm1.tiny\t2011-04-18T07:46:24Z\tnova\t\t\n\n3. Associate the floating public IP\neuca-associate-address -i i-00000003 172.241.0.3\nNotFound: No floating ip for address 172.241.0.3\n\n\n4. Table dump\nmysql> select * from floating_ips where project_id is null LIMIT 5;\n+---------------------+------------+------------+---------+-----+-------------+-------------+------------+----------+\n| created_at          | updated_at | deleted_at | deleted | id  | address     | fixed_ip_id | project_id | host     |\n+---------------------+------------+------------+---------+-----+-------------+-------------+------------+----------+\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 769 | 172.241.0.0 |        NULL | NULL       | nova-api |\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 770 | 172.241.0.1 |        NULL | NULL       | nova-api |\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 771 | 172.241.0.2 |        NULL | NULL       | nova-api |\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 772 | 172.241.0.3 |        NULL | NULL       | nova-api |\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 773 | 172.241.0.4 |        NULL | NULL       | nova-api |\n+---------------------+------------+------------+---------+-----+-------------+-------------+------------+----------+\n5 rows in set (0.00 sec)\n\nnova-api.log\n2011-04-18 08:48:54,579 DEBUG nova.auth.manager [-] signature: PUlDa/hdYGgaZkffoVPlHyOFVaeV/KafZtwREWWapGY= from (pid=1484) authenticate /usr/lib/pymodules/python2.6/nova/auth/manager.py:316\n2011-04-18 08:48:54,607 AUDIT nova.api [3JMPU5-VCSMULNZRBXL6 kevinj myproject] Authenticated Request For kevinj:myproject)\n2011-04-18 08:48:54,608 DEBUG nova.api [-] action: AssociateAddress from (pid=1484) __call__ /usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py:216\n2011-04-18 08:48:54,609 DEBUG nova.api [-] arg: InstanceId              val: i-00000003 from (pid=1484) __call__ /usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py:218\n2011-04-18 08:48:54,609 DEBUG nova.api [-] arg: PublicIp                val: 172.241.0.3 from (pid=1484) __call__ /usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py:218\n2011-04-18 08:48:54,625 AUDIT nova.api.cloud [3JMPU5-VCSMULNZRBXL6 kevinj myproject] Associate address 172.241.0.3 to instance i-00000003\n2011-04-18 08:48:54,781 INFO nova.api [3JMPU5-VCSMULNZRBXL6 kevinj myproject] NotFound raised: No floating ip for address 172.241.0.3\n2011-04-18 08:48:54,782 ERROR nova.api [3JMPU5-VCSMULNZRBXL6 kevinj myproject] NotFound: No floating ip for address 172.241.0.3\n2011-04-18 08:48:54,782 INFO nova.api [3JMPU5-VCSMULNZRBXL6 kevinj myproject] 0.241214s 172.241.0.101 GET /services/Cloud/ CloudController:AssociateAddress 400 [Boto/1.9b (linux2)] text/plain text/xml\n\nnova-manage.log\n2011-04-18 08:52:01,634 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2553) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 08:52:01,740 CRITICAL nova [-] No floating ip for address 172.241.0.0\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1122, in <module>\n(nova): TRACE:     main()\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1111, in main\n(nova): TRACE:     fn(*argv)\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 496, in delete\n(nova): TRACE:     str(address))\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 250, in floating_ip_destroy\n(nova): TRACE:     return IMPL.floating_ip_destroy(context, address)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 109, in wrapper\n(nova): TRACE:     return f(*args, **kwargs)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 502, in floating_ip_destroy\n(nova): TRACE:     session=session)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 109, in wrapper\n(nova): TRACE:     return f(*args, **kwargs)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 567, in floating_ip_get_by_address\n(nova): TRACE:     raise exception.NotFound('No floating ip for address %s' % address)\n(nova): TRACE: NotFound: No floating ip for address 172.241.0.0\n(nova): TRACE:\n2011-04-18 09:00:06,854 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2674) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:00:26,938 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2685) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:00:34,181 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2693) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:22,444 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2709) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:27,238 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2718) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:29,479 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2726) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:46,162 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2737) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:54,310 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2756) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/764338", 
    "owner": "None", 
    "id": 764338, 
    "index": 3388, 
    "openned": "2011-04-18 08:12:25.401305+00:00", 
    "created": "2011-04-18 08:12:25.401305+00:00", 
    "title": "nova-manage floating create not filling in project_id", 
    "comments": [
        {
            "content": "Summary:\nWhen creating a range of floating IP to assign  as Public IPs to instances in a project using the nova-manage floating create command, the nova.floating_ips 'project_id' column isn't being updated with the project name.\nThis gives the following error message when associating an address to an instance which is subsequently fixed if you manually update the project_id column in floating_ips table:\n\nNotFound: No floating ip for address 172.241.0.3\n\n\n\nScenario:\nUser (admin): kevinj\nProject: myproject\nHost: nova-api\n\nSteps to recreate:\n1. Create the public IP address range for this host:\n\nsudo nova-manage floating create nova-api 172.241.0.0/25\n\n2. Spin an instance up:\n\neuca-describe-instances \nRESERVATION\tr-lcfi0zfs\tmyproject\tdefault\nINSTANCE\ti-00000003\tami-33baf2c6\t10.0.0.3\t10.0.0.3\trunning\topenstack (myproject, nova-api)\t0\t\tm1.tiny\t2011-04-18T07:46:24Z\tnova\t\t\n\n3. Associate the floating public IP\neuca-associate-address -i i-00000003 172.241.0.3\nNotFound: No floating ip for address 172.241.0.3\n\n\n4. Table dump\nmysql> select * from floating_ips where project_id is null LIMIT 5;\n+---------------------+------------+------------+---------+-----+-------------+-------------+------------+----------+\n| created_at          | updated_at | deleted_at | deleted | id  | address     | fixed_ip_id | project_id | host     |\n+---------------------+------------+------------+---------+-----+-------------+-------------+------------+----------+\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 769 | 172.241.0.0 |        NULL | NULL       | nova-api |\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 770 | 172.241.0.1 |        NULL | NULL       | nova-api |\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 771 | 172.241.0.2 |        NULL | NULL       | nova-api |\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 772 | 172.241.0.3 |        NULL | NULL       | nova-api |\n| 2011-04-18 08:05:52 | NULL       | NULL       |       0 | 773 | 172.241.0.4 |        NULL | NULL       | nova-api |\n+---------------------+------------+------------+---------+-----+-------------+-------------+------------+----------+\n5 rows in set (0.00 sec)\n\nnova-api.log\n2011-04-18 08:48:54,579 DEBUG nova.auth.manager [-] signature: PUlDa/hdYGgaZkffoVPlHyOFVaeV/KafZtwREWWapGY= from (pid=1484) authenticate /usr/lib/pymodules/python2.6/nova/auth/manager.py:316\n2011-04-18 08:48:54,607 AUDIT nova.api [3JMPU5-VCSMULNZRBXL6 kevinj myproject] Authenticated Request For kevinj:myproject)\n2011-04-18 08:48:54,608 DEBUG nova.api [-] action: AssociateAddress from (pid=1484) __call__ /usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py:216\n2011-04-18 08:48:54,609 DEBUG nova.api [-] arg: InstanceId              val: i-00000003 from (pid=1484) __call__ /usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py:218\n2011-04-18 08:48:54,609 DEBUG nova.api [-] arg: PublicIp                val: 172.241.0.3 from (pid=1484) __call__ /usr/lib/pymodules/python2.6/nova/api/ec2/__init__.py:218\n2011-04-18 08:48:54,625 AUDIT nova.api.cloud [3JMPU5-VCSMULNZRBXL6 kevinj myproject] Associate address 172.241.0.3 to instance i-00000003\n2011-04-18 08:48:54,781 INFO nova.api [3JMPU5-VCSMULNZRBXL6 kevinj myproject] NotFound raised: No floating ip for address 172.241.0.3\n2011-04-18 08:48:54,782 ERROR nova.api [3JMPU5-VCSMULNZRBXL6 kevinj myproject] NotFound: No floating ip for address 172.241.0.3\n2011-04-18 08:48:54,782 INFO nova.api [3JMPU5-VCSMULNZRBXL6 kevinj myproject] 0.241214s 172.241.0.101 GET /services/Cloud/ CloudController:AssociateAddress 400 [Boto/1.9b (linux2)] text/plain text/xml\n\nnova-manage.log\n2011-04-18 08:52:01,634 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2553) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 08:52:01,740 CRITICAL nova [-] No floating ip for address 172.241.0.0\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1122, in <module>\n(nova): TRACE:     main()\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 1111, in main\n(nova): TRACE:     fn(*argv)\n(nova): TRACE:   File \"/usr/bin/nova-manage\", line 496, in delete\n(nova): TRACE:     str(address))\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/api.py\", line 250, in floating_ip_destroy\n(nova): TRACE:     return IMPL.floating_ip_destroy(context, address)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 109, in wrapper\n(nova): TRACE:     return f(*args, **kwargs)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 502, in floating_ip_destroy\n(nova): TRACE:     session=session)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 109, in wrapper\n(nova): TRACE:     return f(*args, **kwargs)\n(nova): TRACE:   File \"/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.py\", line 567, in floating_ip_get_by_address\n(nova): TRACE:     raise exception.NotFound('No floating ip for address %s' % address)\n(nova): TRACE: NotFound: No floating ip for address 172.241.0.0\n(nova): TRACE:\n2011-04-18 09:00:06,854 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2674) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:00:26,938 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2685) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:00:34,181 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2693) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:22,444 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2709) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:27,238 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2718) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:29,479 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2726) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:46,162 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2737) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427\n2011-04-18 09:01:54,310 DEBUG nova.utils [-] backend <module 'nova.db.sqlalchemy.api' from '/usr/lib/pymodules/python2.6/nova/db/sqlalchemy/api.pyc'> from (pid=2756) __get_backend /usr/lib/pymodules/python2.6/nova/utils.py:427", 
            "date_created": "2011-04-18 08:12:25.401305+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "Forgot to add the workaround:\n\nmysql> update floating_ips set project_id=\"myproject\";\nQuery OK, 128 rows affected (0.00 sec)\nRows matched: 128  Changed: 128  Warnings: 0\n\nmysql> \\q\nBye\neuca-associate-address -i i-00000003 172.241.0.3\nADDRESS\t172.241.0.3\ti-00000003\n", 
            "date_created": "2011-04-18 08:14:40.611875+00:00", 
            "author": "https://api.launchpad.net/1.0/~kevin-linuxservices"
        }, 
        {
            "content": "project_id isn't supposed to be set by default.  There is a command to associate an ip with a project.  It is called euca-allocate-address.  That will assign an ip to your project.  Then you should be able to associate the address like you are attempting above.", 
            "date_created": "2011-04-18 08:44:15.995348+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ], 
    "closed": "2011-04-18 08:42:47.124165+00:00"
}