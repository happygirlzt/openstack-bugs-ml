{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 11:57:20.257620+00:00", 
    "description": "It was discovered during:\n\nstack@DevStackOSDomU:~/tempest$ nosetests tempest.api.compute.images.test_images_oneserver:ImagesOneServerTestXML.test_create_delete_image\n\n[req-8593dd23-7383-49db-bad8-ac2e6fc41984 ImagesOneServerTestXML1808487469-user ImagesOneServerTestXML807215939-tenant] Exception during message han\n\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 421, in _process_data\n    **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n    result = getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    event_type, level, payload)\n  File \"/opt/stack/nova/nova/exception.py\", line 76, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 241, in decorated_function\n    pass\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 227, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 269, in decorated_function\n    e, sys.exc_info())\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 256, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2160, in snapshot_instance\n    update_task_state)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 204, in snapshot\n    self._vmops.snapshot(context, instance, image_id, update_task_state)\n  File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 762, in snapshot\n    image_id)\n  File \"/opt/stack/nova/nova/virt/xenapi/image/glance.py\", line 68, in upload_image\n    self._call_glance_plugin(session, 'upload_vhd', params)\n  File \"/opt/stack/nova/nova/virt/xenapi/image/glance.py\", line 37, in _call_glance_plugin\n    'glance', fn, CONF.glance_num_retries, pick_glance, **params)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 762, in call_plugin_serialized_with_retry\n    return self.call_plugin_serialized(plugin, fn, *args, **kwargs)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 747, in call_plugin_serialized\n    rv = self.call_plugin(plugin, fn, params)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 743, in call_plugin\n    host, plugin, fn, args)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 798, in _unwrap_plugin_exceptions\n    return func(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 229, in __call__\n    return self.__send(self.__name, args)\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 133, in xenapi_request\n    result = _parse_result(getattr(self, methodname)(*full_params))\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 203, in _parse_result\n    raise Failure(result['ErrorDescription'])\nFailure: ['XENAPI_PLUGIN_FAILURE', 'upload_vhd', 'TypeError', \"make_subprocess() got an unexpected keyword argument 'env'\"]", 
    "tags": [
        "xenserver"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1216267", 
    "owner": "https://api.launchpad.net/1.0/~mate-lakat", 
    "id": 1216267, 
    "index": 1190, 
    "openned": "2013-08-24 09:49:30.591259+00:00", 
    "created": "2013-08-24 09:49:30.591259+00:00", 
    "title": "image upload - make_subprocess issue", 
    "comments": [
        {
            "content": "It was discovered during:\n\nstack@DevStackOSDomU:~/tempest$ nosetests tempest.api.compute.images.test_images_oneserver:ImagesOneServerTestXML.test_create_delete_image\n\n[req-8593dd23-7383-49db-bad8-ac2e6fc41984 ImagesOneServerTestXML1808487469-user ImagesOneServerTestXML807215939-tenant] Exception during message han\n\nTraceback (most recent call last):\n  File \"/opt/stack/nova/nova/openstack/common/rpc/amqp.py\", line 421, in _process_data\n    **args)\n  File \"/opt/stack/nova/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n    result = getattr(proxyobj, method)(ctxt, **kwargs)\n  File \"/opt/stack/nova/nova/exception.py\", line 88, in wrapped\n    event_type, level, payload)\n  File \"/opt/stack/nova/nova/exception.py\", line 76, in wrapped\n    return f(self, context, *args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 241, in decorated_function\n    pass\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 227, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 269, in decorated_function\n    e, sys.exc_info())\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 256, in decorated_function\n    return function(self, context, *args, **kwargs)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 2160, in snapshot_instance\n    update_task_state)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 204, in snapshot\n    self._vmops.snapshot(context, instance, image_id, update_task_state)\n  File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 762, in snapshot\n    image_id)\n  File \"/opt/stack/nova/nova/virt/xenapi/image/glance.py\", line 68, in upload_image\n    self._call_glance_plugin(session, 'upload_vhd', params)\n  File \"/opt/stack/nova/nova/virt/xenapi/image/glance.py\", line 37, in _call_glance_plugin\n    'glance', fn, CONF.glance_num_retries, pick_glance, **params)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 762, in call_plugin_serialized_with_retry\n    return self.call_plugin_serialized(plugin, fn, *args, **kwargs)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 747, in call_plugin_serialized\n    rv = self.call_plugin(plugin, fn, params)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 743, in call_plugin\n    host, plugin, fn, args)\n  File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 798, in _unwrap_plugin_exceptions\n    return func(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 229, in __call__\n    return self.__send(self.__name, args)\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 133, in xenapi_request\n    result = _parse_result(getattr(self, methodname)(*full_params))\n  File \"/usr/local/lib/python2.7/dist-packages/XenAPI.py\", line 203, in _parse_result\n    raise Failure(result['ErrorDescription'])\nFailure: ['XENAPI_PLUGIN_FAILURE', 'upload_vhd', 'TypeError', \"make_subprocess() got an unexpected keyword argument 'env'\"]", 
            "date_created": "2013-08-24 09:49:30.591259+00:00", 
            "author": "https://api.launchpad.net/1.0/~mate-lakat"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/43580", 
            "date_created": "2013-08-24 09:58:24.178218+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This bug was caused by this commit:\n\n  https://review.openstack.org/#/c/31898/", 
            "date_created": "2013-08-24 10:00:44.274693+00:00", 
            "author": "https://api.launchpad.net/1.0/~mate-lakat"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/43580\nCommitted: http://github.com/openstack/nova/commit/36be3145c76d185ecabac20c4df145b7f46f67b1\nSubmitter: Jenkins\nBranch:    master\n\ncommit 36be3145c76d185ecabac20c4df145b7f46f67b1\nAuthor: Mate Lakat <email address hidden>\nDate:   Sat Aug 24 10:51:09 2013 +0100\n\n    Add env to make_subprocess\n    \n    Due to a previous commit, a client of make_subprocess is making a call\n    with an env parameter. As make_subprocess does not have such a\n    parameter, image upload fails. This patch adds the env keyword argument\n    to make_subprocess, and use that in the Popen call.\n    \n    Fixes bug 1216267\n    \n    Change-Id: I8098b484067b54c15fe95f2bf84c5890db7ebcb3\n", 
            "date_created": "2013-08-28 14:49:23.025754+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-09-05 15:40:17.162644+00:00"
}