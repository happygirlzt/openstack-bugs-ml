{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:21:47.805325+00:00", 
    "description": "After remove a stopped service for nova-compute, then I can't restart it again. The error as below\n\n\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 145, in wait\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     x.wait()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 47, in wait\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 173, in wait\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 293, in switch\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 212, in main\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/service.py\", line 492, in run_service\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     service.start()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 181, in start\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 1181, in pre_start_hook\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 6058, in update_available_resource\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 342, in update_available_resource\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self._update_available_resource(context, resources)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 431, in inner\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 396, in _update_available_resource\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     self._sync_compute_node(context, resources)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 417, in _sync_compute_node\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     self._create(context, resources)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 466, in _create\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     values)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/conductor/api.py\", line 170, in compute_node_create\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self._manager.compute_node_create(context, values)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 271, in compute_node_create\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return cctxt.call(context, 'compute_node_create', values=values)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     retry=self.retry)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     timeout=timeout, retry=retry)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 408, in send\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     retry=retry)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 399, in _send\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     raise result\n\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup RemoteError: Remote error: DBDuplicateEntry (IntegrityError) (1062, \"Duplicate entry 'hp-pc-hp-pc' for key 'uniq_compute_nodes0host0hypervisor_hostname'\") 'INSERT INTO compute_nodes (created_at, updated_at, deleted_at, deleted, service_id, host, vcpus, memory_mb, local_gb, vcpus_used, memory_mb_used, local_gb_used, hypervisor_type, hypervisor_version, hypervisor_hostname, free_ram_mb, free_disk_gb, current_workload, running_vms, cpu_info, disk_available_least, host_ip, supported_instances, metrics, pci_stats, extra_resources, stats, numa_topology) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2015, 2, 5, 3, 9, 3, 245004), None, None, 0, 6, 'hp-pc', 8, 7920, 45, 0, 512, 0, 'QEMU', 2000000, 'hp-pc', 7408, 45, 0, 0, '{\"vendor\": \"Intel\", \"model\": \"Nehalem\", \"arch\": \"x86_64\", \"features\": [\"pge\", \"clflush\", \"sep\", \"syscall\", \"vme\", \"dtes64\", \"tsc\", \"vmx\", \"xtpr\", \"cmov\", \"ssse3\", \"est\", \"pat\", \"monitor\", \"smx\", \"lm\", \"msr\", \"nx\", \"fxsr\", \"tm\", \"sse4.1\", \"pae\", \"sse4.2\", \"acpi\", \"de\", \"mmx\", \"cx8\", \"mce\", \"mtrr\", \"rdtscp\", \"ht\", \"pse\", \"lahf_lm\", \"pdcm\", \"mca\", \"apic\", \"sse\", \"ds\", \"pni\", \"tm2\", \"sse2\", \"ss\", \"pbe\", \"fpu\", \"cx16\", \"pse36\", \"ds_cpl\", \"popcnt\"], \"topology\": {\"cores\": 4, \"threads\": 2, \"sockets\": 1}}', 34, '10.238.154.76', '[[\"alpha\", \"qemu\", \"hvm\"], [\"armv7l\", \"qemu\", \"hvm\"], [\"cris\", \"qemu\", \"hvm\"], [\"i686\", \"qemu\", \"hvm\"], [\"i686\", \"kvm\", \"hvm\"], [\"lm32\", \"qemu\", \"hvm\"], [\"m68k\", \"qemu\", \"hvm\"], [\"microblaze\", \"qemu\", \"hvm\"], [\"microblazeel\", \"qemu\", \"hvm\"], [\"mips\", \"qemu\", \"hvm\"], [\"mipsel\", \"qemu\", \"hvm\"], [\"mips64\", \"qemu\", \"hvm\"], [\"mips64el\", \"qemu\", \"hvm\"], [\"ppc\", \"qemu\", \"hvm\"], [\"ppc64\", \"qemu\", \"hvm\"], [\"ppcemb\", \"qemu\", \"hvm\"], [\"s390x\", \"qemu\", \"hvm\"], [\"sh4\", \"qemu\", \"hvm\"], [\"sh4eb\", \"qemu\", \"hvm\"], [\"sparc\", \"qemu\", \"hvm\"], [\"sparc64\", \"qemu\", \"hvm\"], [\"unicore32\", \"qemu\", \"hvm\"], [\"x86_64\", \"qemu\", \"hvm\"], [\"x86_64\", \"kvm\", \"hvm\"], [\"xtensa\", \"qemu\", \"hvm\"], [\"xtensaeb\", \"qemu\", \"hvm\"]]', '[]', '[]', None, '{}', '{\"nova_object.version\": \"1.2\", \"nova_object.changes\": [\"cells\"], \"nova_object.name\": \"NUMATopology\", \"nova_object.data\": {\"cells\": [{\"nova_object.version\": \"1.2\", \"nova_object.changes\": [\"cpu_usage\", \"memory_usage\", \"cpuset\", \"pinned_cpus\", \"siblings\", \"memory\", \"mempages\", \"id\"], \"nova_object.name\": \"NUMACell\", \"nova_object.data\": {\"cpu_usage\": 0, \"memory_usage\": 0, \"cpuset\": [0, 1, 2, 3, 4, 5, 6, 7], \"pinned_cpus\": [], \"siblings\": [[0, 1], [6, 7], [2, 4], [3, 5]], \"memory\": 7920, \"mempages\": [], \"id\": 0}, \"nova_object.namespace\": \"nova\"}]}, \"nova_object.namespace\": \"nova\"}')\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup [u'Traceback (most recent call last):\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\\n    incoming.message))\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\\n    return self._do_dispatch(endpoint, method, ctxt, args)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\\n    result = getattr(endpoint, method)(ctxt, **new_args)\\n', u'  File \"/opt/stack/nova/nova/conductor/manager.py\", line 313, in compute_node_create\\n    result = self.db.compute_node_create(context, values)\\n', u'  File \"/opt/stack/nova/nova/db/api.py\", line 247, in compute_node_create\\n    return IMPL.compute_node_create(context, values)\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 128, in wrapper\\n    return f(*args, **kwargs)\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 599, in compute_node_create\\n    compute_node_ref.save()\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/models.py\", line 82, in save\\n    super(NovaBase, self).save(session=session)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/models.py\", line 48, in save\\n    session.flush()\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1919, in flush\\n    self._flush(objects)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 2037, in _flush\\n    transaction.rollback(_capture_exception=True)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\\n    compat.reraise(exc_type, exc_value, exc_tb)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 2001, in _flush\\n    flush_context.execute()\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 372, in execute\\n    rec.execute(self)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 526, in execute\\n    uow\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py\", line 65, in save_obj\\n    mapper, table, insert)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py\", line 602, in _emit_insert_statements\\n    execute(statement, params)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 729, in execute\\n    return meth(self, multiparams, params)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 322, in _execute_on_connection\\n    return connection._execute_clauseelement(self, multiparams, params)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 826, in _execute_clauseelement\\n    compiled_sql, distilled_params\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 958, in _execute_context\\n    context)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1155, in _handle_dbapi_exception\\n    util.raise_from_cause(newraise, exc_info)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/compat.py\", line 199, in raise_from_cause\\n    reraise(type(exception), exception, tb=exc_tb)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 951, in _execute_context\\n    context)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 436, in do_execute\\n    cursor.execute(statement, parameters)\\n', u'  File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\\n    self.errorhandler(self, exc, value)\\n', u'  File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\\n    raise errorclass, errorvalue\\n', u'DBDuplicateEntry: (IntegrityError) (1062, \"Duplicate entry \\'hp-pc-hp-pc\\' for key \\'uniq_compute_nodes0host0hypervisor_hostname\\'\") \\'INSERT INTO compute_nodes (created_at, updated_at, deleted_at, deleted, service_id, host, vcpus, memory_mb, local_gb, vcpus_used, memory_mb_used, local_gb_used, hypervisor_type, hypervisor_version, hypervisor_hostname, free_ram_mb, free_disk_gb, current_workload, running_vms, cpu_info, disk_available_least, host_ip, supported_instances, metrics, pci_stats, extra_resources, stats, numa_topology) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)\\' (datetime.datetime(2015, 2, 5, 3, 9, 3, 245004), None, None, 0, 6, \\'hp-pc\\', 8, 7920, 45, 0, 512, 0, \\'QEMU\\', 2000000, \\'hp-pc\\', 7408, 45, 0, 0, \\'{\"vendor\": \"Intel\", \"model\": \"Nehalem\", \"arch\": \"x86_64\", \"features\": [\"pge\", \"clflush\", \"sep\", \"syscall\", \"vme\", \"dtes64\", \"tsc\", \"vmx\", \"xtpr\", \"cmov\", \"ssse3\", \"est\", \"pat\", \"monitor\", \"smx\", \"lm\", \"msr\", \"nx\", \"fxsr\", \"tm\", \"sse4.1\", \"pae\", \"sse4.2\", \"acpi\", \"de\", \"mmx\", \"cx8\", \"mce\", \"mtrr\", \"rdtscp\", \"ht\", \"pse\", \"lahf_lm\", \"pdcm\", \"mca\", \"apic\", \"sse\", \"ds\", \"pni\", \"tm2\", \"sse2\", \"ss\", \"pbe\", \"fpu\", \"cx16\", \"pse36\", \"ds_cpl\", \"popcnt\"], \"topology\": {\"cores\": 4, \"threads\": 2, \"sockets\": 1}}\\', 34, \\'10.238.154.76\\', \\'[[\"alpha\", \"qemu\", \"hvm\"], [\"armv7l\", \"qemu\", \"hvm\"], [\"cris\", \"qemu\", \"hvm\"], [\"i686\", \"qemu\", \"hvm\"], [\"i686\", \"kvm\", \"hvm\"], [\"lm32\", \"qemu\", \"hvm\"], [\"m68k\", \"qemu\", \"hvm\"], [\"microblaze\", \"qemu\", \"hvm\"], [\"microblazeel\", \"qemu\", \"hvm\"], [\"mips\", \"qemu\", \"hvm\"], [\"mipsel\", \"qemu\", \"hvm\"], [\"mips64\", \"qemu\", \"hvm\"], [\"mips64el\", \"qemu\", \"hvm\"], [\"ppc\", \"qemu\", \"hvm\"], [\"ppc64\", \"qemu\", \"hvm\"], [\"ppcemb\", \"qemu\", \"hvm\"], [\"s390x\", \"qemu\", \"hvm\"], [\"sh4\", \"qemu\", \"hvm\"], [\"sh4eb\", \"qemu\", \"hvm\"], [\"sparc\", \"qemu\", \"hvm\"], [\"sparc64\", \"qemu\", \"hvm\"], [\"unicore32\", \"qemu\", \"hvm\"], [\"x86_64\", \"qemu\", \"hvm\"], [\"x86_64\", \"kvm\", \"hvm\"], [\"xtensa\", \"qemu\", \"hvm\"], [\"xtensaeb\", \"qemu\", \"hvm\"]]\\', \\'[]\\', \\'[]\\', None, \\'{}\\', \\'{\"nova_object.version\": \"1.2\", \"nova_object.changes\": [\"cells\"], \"nova_object.name\": \"NUMATopology\", \"nova_object.data\": {\"cells\": [{\"nova_object.version\": \"1.2\", \"nova_object.changes\": [\"cpu_usage\", \"memory_usage\", \"cpuset\", \"pinned_cpus\", \"siblings\", \"memory\", \"mempages\", \"id\"], \"nova_object.name\": \"NUMACell\", \"nova_object.data\": {\"cpu_usage\": 0, \"memory_usage\": 0, \"cpuset\": [0, 1, 2, 3, 4, 5, 6, 7], \"pinned_cpus\": [], \"siblings\": [[0, 1], [6, 7], [2, 4], [3, 5]], \"memory\": 7920, \"mempages\": [], \"id\": 0}, \"nova_object.namespace\": \"nova\"}]}, \"nova_object.namespace\": \"nova\"}\\')\\n'].\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup", 
    "tags": [], 
    "importance": "High", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1418298", 
    "owner": "https://api.launchpad.net/1.0/~xuhj", 
    "id": 1418298, 
    "index": 1686, 
    "openned": "2015-02-05 03:06:21.326075+00:00", 
    "created": "2015-02-05 03:06:21.326075+00:00", 
    "title": "After service deleted, the corresponding compute-node can't restart again", 
    "comments": [
        {
            "content": "After remove a stopped service for nova-compute, then I can't restart it again. The error as below\n\n\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 145, in wait\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     x.wait()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 47, in wait\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 173, in wait\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 121, in wait\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 293, in switch\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 212, in main\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/service.py\", line 492, in run_service\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     service.start()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 181, in start\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 1181, in pre_start_hook\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 6058, in update_available_resource\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 342, in update_available_resource\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self._update_available_resource(context, resources)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 431, in inner\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 396, in _update_available_resource\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     self._sync_compute_node(context, resources)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 417, in _sync_compute_node\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     self._create(context, resources)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/resource_tracker.py\", line 466, in _create\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     values)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/conductor/api.py\", line 170, in compute_node_create\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return self._manager.compute_node_create(context, values)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/conductor/rpcapi.py\", line 271, in compute_node_create\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     return cctxt.call(context, 'compute_node_create', values=values)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/client.py\", line 152, in call\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     retry=self.retry)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/transport.py\", line 90, in _send\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     timeout=timeout, retry=retry)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 408, in send\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     retry=retry)\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/_drivers/amqpdriver.py\", line 399, in _send\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup     raise result\n\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup RemoteError: Remote error: DBDuplicateEntry (IntegrityError) (1062, \"Duplicate entry 'hp-pc-hp-pc' for key 'uniq_compute_nodes0host0hypervisor_hostname'\") 'INSERT INTO compute_nodes (created_at, updated_at, deleted_at, deleted, service_id, host, vcpus, memory_mb, local_gb, vcpus_used, memory_mb_used, local_gb_used, hypervisor_type, hypervisor_version, hypervisor_hostname, free_ram_mb, free_disk_gb, current_workload, running_vms, cpu_info, disk_available_least, host_ip, supported_instances, metrics, pci_stats, extra_resources, stats, numa_topology) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2015, 2, 5, 3, 9, 3, 245004), None, None, 0, 6, 'hp-pc', 8, 7920, 45, 0, 512, 0, 'QEMU', 2000000, 'hp-pc', 7408, 45, 0, 0, '{\"vendor\": \"Intel\", \"model\": \"Nehalem\", \"arch\": \"x86_64\", \"features\": [\"pge\", \"clflush\", \"sep\", \"syscall\", \"vme\", \"dtes64\", \"tsc\", \"vmx\", \"xtpr\", \"cmov\", \"ssse3\", \"est\", \"pat\", \"monitor\", \"smx\", \"lm\", \"msr\", \"nx\", \"fxsr\", \"tm\", \"sse4.1\", \"pae\", \"sse4.2\", \"acpi\", \"de\", \"mmx\", \"cx8\", \"mce\", \"mtrr\", \"rdtscp\", \"ht\", \"pse\", \"lahf_lm\", \"pdcm\", \"mca\", \"apic\", \"sse\", \"ds\", \"pni\", \"tm2\", \"sse2\", \"ss\", \"pbe\", \"fpu\", \"cx16\", \"pse36\", \"ds_cpl\", \"popcnt\"], \"topology\": {\"cores\": 4, \"threads\": 2, \"sockets\": 1}}', 34, '10.238.154.76', '[[\"alpha\", \"qemu\", \"hvm\"], [\"armv7l\", \"qemu\", \"hvm\"], [\"cris\", \"qemu\", \"hvm\"], [\"i686\", \"qemu\", \"hvm\"], [\"i686\", \"kvm\", \"hvm\"], [\"lm32\", \"qemu\", \"hvm\"], [\"m68k\", \"qemu\", \"hvm\"], [\"microblaze\", \"qemu\", \"hvm\"], [\"microblazeel\", \"qemu\", \"hvm\"], [\"mips\", \"qemu\", \"hvm\"], [\"mipsel\", \"qemu\", \"hvm\"], [\"mips64\", \"qemu\", \"hvm\"], [\"mips64el\", \"qemu\", \"hvm\"], [\"ppc\", \"qemu\", \"hvm\"], [\"ppc64\", \"qemu\", \"hvm\"], [\"ppcemb\", \"qemu\", \"hvm\"], [\"s390x\", \"qemu\", \"hvm\"], [\"sh4\", \"qemu\", \"hvm\"], [\"sh4eb\", \"qemu\", \"hvm\"], [\"sparc\", \"qemu\", \"hvm\"], [\"sparc64\", \"qemu\", \"hvm\"], [\"unicore32\", \"qemu\", \"hvm\"], [\"x86_64\", \"qemu\", \"hvm\"], [\"x86_64\", \"kvm\", \"hvm\"], [\"xtensa\", \"qemu\", \"hvm\"], [\"xtensaeb\", \"qemu\", \"hvm\"]]', '[]', '[]', None, '{}', '{\"nova_object.version\": \"1.2\", \"nova_object.changes\": [\"cells\"], \"nova_object.name\": \"NUMATopology\", \"nova_object.data\": {\"cells\": [{\"nova_object.version\": \"1.2\", \"nova_object.changes\": [\"cpu_usage\", \"memory_usage\", \"cpuset\", \"pinned_cpus\", \"siblings\", \"memory\", \"mempages\", \"id\"], \"nova_object.name\": \"NUMACell\", \"nova_object.data\": {\"cpu_usage\": 0, \"memory_usage\": 0, \"cpuset\": [0, 1, 2, 3, 4, 5, 6, 7], \"pinned_cpus\": [], \"siblings\": [[0, 1], [6, 7], [2, 4], [3, 5]], \"memory\": 7920, \"mempages\": [], \"id\": 0}, \"nova_object.namespace\": \"nova\"}]}, \"nova_object.namespace\": \"nova\"}')\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup [u'Traceback (most recent call last):\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 134, in _dispatch_and_reply\\n    incoming.message))\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 177, in _dispatch\\n    return self._do_dispatch(endpoint, method, ctxt, args)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo/messaging/rpc/dispatcher.py\", line 123, in _do_dispatch\\n    result = getattr(endpoint, method)(ctxt, **new_args)\\n', u'  File \"/opt/stack/nova/nova/conductor/manager.py\", line 313, in compute_node_create\\n    result = self.db.compute_node_create(context, values)\\n', u'  File \"/opt/stack/nova/nova/db/api.py\", line 247, in compute_node_create\\n    return IMPL.compute_node_create(context, values)\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 128, in wrapper\\n    return f(*args, **kwargs)\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 599, in compute_node_create\\n    compute_node_ref.save()\\n', u'  File \"/opt/stack/nova/nova/db/sqlalchemy/models.py\", line 82, in save\\n    super(NovaBase, self).save(session=session)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/models.py\", line 48, in save\\n    session.flush()\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1919, in flush\\n    self._flush(objects)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 2037, in _flush\\n    transaction.rollback(_capture_exception=True)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\\n    compat.reraise(exc_type, exc_value, exc_tb)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 2001, in _flush\\n    flush_context.execute()\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 372, in execute\\n    rec.execute(self)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 526, in execute\\n    uow\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py\", line 65, in save_obj\\n    mapper, table, insert)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py\", line 602, in _emit_insert_statements\\n    execute(statement, params)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 729, in execute\\n    return meth(self, multiparams, params)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py\", line 322, in _execute_on_connection\\n    return connection._execute_clauseelement(self, multiparams, params)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 826, in _execute_clauseelement\\n    compiled_sql, distilled_params\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 958, in _execute_context\\n    context)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1155, in _handle_dbapi_exception\\n    util.raise_from_cause(newraise, exc_info)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/compat.py\", line 199, in raise_from_cause\\n    reraise(type(exception), exception, tb=exc_tb)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 951, in _execute_context\\n    context)\\n', u'  File \"/usr/local/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 436, in do_execute\\n    cursor.execute(statement, parameters)\\n', u'  File \"/usr/lib/python2.7/dist-packages/MySQLdb/cursors.py\", line 174, in execute\\n    self.errorhandler(self, exc, value)\\n', u'  File \"/usr/lib/python2.7/dist-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\\n    raise errorclass, errorvalue\\n', u'DBDuplicateEntry: (IntegrityError) (1062, \"Duplicate entry \\'hp-pc-hp-pc\\' for key \\'uniq_compute_nodes0host0hypervisor_hostname\\'\") \\'INSERT INTO compute_nodes (created_at, updated_at, deleted_at, deleted, service_id, host, vcpus, memory_mb, local_gb, vcpus_used, memory_mb_used, local_gb_used, hypervisor_type, hypervisor_version, hypervisor_hostname, free_ram_mb, free_disk_gb, current_workload, running_vms, cpu_info, disk_available_least, host_ip, supported_instances, metrics, pci_stats, extra_resources, stats, numa_topology) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)\\' (datetime.datetime(2015, 2, 5, 3, 9, 3, 245004), None, None, 0, 6, \\'hp-pc\\', 8, 7920, 45, 0, 512, 0, \\'QEMU\\', 2000000, \\'hp-pc\\', 7408, 45, 0, 0, \\'{\"vendor\": \"Intel\", \"model\": \"Nehalem\", \"arch\": \"x86_64\", \"features\": [\"pge\", \"clflush\", \"sep\", \"syscall\", \"vme\", \"dtes64\", \"tsc\", \"vmx\", \"xtpr\", \"cmov\", \"ssse3\", \"est\", \"pat\", \"monitor\", \"smx\", \"lm\", \"msr\", \"nx\", \"fxsr\", \"tm\", \"sse4.1\", \"pae\", \"sse4.2\", \"acpi\", \"de\", \"mmx\", \"cx8\", \"mce\", \"mtrr\", \"rdtscp\", \"ht\", \"pse\", \"lahf_lm\", \"pdcm\", \"mca\", \"apic\", \"sse\", \"ds\", \"pni\", \"tm2\", \"sse2\", \"ss\", \"pbe\", \"fpu\", \"cx16\", \"pse36\", \"ds_cpl\", \"popcnt\"], \"topology\": {\"cores\": 4, \"threads\": 2, \"sockets\": 1}}\\', 34, \\'10.238.154.76\\', \\'[[\"alpha\", \"qemu\", \"hvm\"], [\"armv7l\", \"qemu\", \"hvm\"], [\"cris\", \"qemu\", \"hvm\"], [\"i686\", \"qemu\", \"hvm\"], [\"i686\", \"kvm\", \"hvm\"], [\"lm32\", \"qemu\", \"hvm\"], [\"m68k\", \"qemu\", \"hvm\"], [\"microblaze\", \"qemu\", \"hvm\"], [\"microblazeel\", \"qemu\", \"hvm\"], [\"mips\", \"qemu\", \"hvm\"], [\"mipsel\", \"qemu\", \"hvm\"], [\"mips64\", \"qemu\", \"hvm\"], [\"mips64el\", \"qemu\", \"hvm\"], [\"ppc\", \"qemu\", \"hvm\"], [\"ppc64\", \"qemu\", \"hvm\"], [\"ppcemb\", \"qemu\", \"hvm\"], [\"s390x\", \"qemu\", \"hvm\"], [\"sh4\", \"qemu\", \"hvm\"], [\"sh4eb\", \"qemu\", \"hvm\"], [\"sparc\", \"qemu\", \"hvm\"], [\"sparc64\", \"qemu\", \"hvm\"], [\"unicore32\", \"qemu\", \"hvm\"], [\"x86_64\", \"qemu\", \"hvm\"], [\"x86_64\", \"kvm\", \"hvm\"], [\"xtensa\", \"qemu\", \"hvm\"], [\"xtensaeb\", \"qemu\", \"hvm\"]]\\', \\'[]\\', \\'[]\\', None, \\'{}\\', \\'{\"nova_object.version\": \"1.2\", \"nova_object.changes\": [\"cells\"], \"nova_object.name\": \"NUMATopology\", \"nova_object.data\": {\"cells\": [{\"nova_object.version\": \"1.2\", \"nova_object.changes\": [\"cpu_usage\", \"memory_usage\", \"cpuset\", \"pinned_cpus\", \"siblings\", \"memory\", \"mempages\", \"id\"], \"nova_object.name\": \"NUMACell\", \"nova_object.data\": {\"cpu_usage\": 0, \"memory_usage\": 0, \"cpuset\": [0, 1, 2, 3, 4, 5, 6, 7], \"pinned_cpus\": [], \"siblings\": [[0, 1], [6, 7], [2, 4], [3, 5]], \"memory\": 7920, \"mempages\": [], \"id\": 0}, \"nova_object.namespace\": \"nova\"}]}, \"nova_object.namespace\": \"nova\"}\\')\\n'].\n2015-02-05 11:09:03.302 TRACE nova.openstack.common.threadgroup", 
            "date_created": "2015-02-05 03:06:21.326075+00:00", 
            "author": "https://api.launchpad.net/1.0/~xuhj"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/153123", 
            "date_created": "2015-02-05 03:09:48.747484+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/153123\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=2db4a1accb78536cf0606addf9ca79938b408542\nSubmitter: Jenkins\nBranch:    master\n\ncommit 2db4a1accb78536cf0606addf9ca79938b408542\nAuthor: He Jie Xu <email address hidden>\nDate:   Thu Feb 5 10:57:27 2015 +0800\n\n    Update unique constraint of compute_nodes with deleted column\n    \n    After a service deleted, the corresponding compute node entry will be\n    soft-deleted also. But we can't startup this compute node again, because\n    when create new entry for this compute node, the current compute_nodes table's\n    unique constraint was violated.\n    \n    This patch adds 'deleted' column into unique constraint to fix this problem.\n    \n    Change-Id: I71ca360df629a4df71892e8595d3ef1707f8d115\n    Closes-Bug: #1418298\n", 
            "date_created": "2015-03-20 00:24:12.598548+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-03-20 07:37:36.643442+00:00"
}