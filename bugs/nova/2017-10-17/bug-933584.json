{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:16:15.684748+00:00", 
    "description": "I hit an error while doing some testing.  The error is Qpid saying that it doesn't know how to encode an object of a particular type.  I will submit a patch to fix this.\n\n\n2012-02-16 11:12:19,837 ERROR nova.rpc.common [-] Exception during message handling\n(nova.rpc.common): TRACE: Traceback (most recent call last):\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/amqp.py\", line 249, in _process_data\n(nova.rpc.common): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 239, in wrapped\n(nova.rpc.common): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 294, in allocate_for_instance\n(nova.rpc.common): TRACE:     **kwargs)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 239, in wrapped\n(nova.rpc.common): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 871, in allocate_for_instance\n(nova.rpc.common): TRACE:     requested_networks=requested_networks)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 200, in _allocate_fixed_ips\n(nova.rpc.common): TRACE:     'args': {'network_ref': network}})\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/__init__.py\", line 69, in call\n(nova.rpc.common): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 500, in call\n(nova.rpc.common): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/amqp.py\", line 332, in call\n(nova.rpc.common): TRACE:     rv = multicall(context, topic, msg, timeout, connection_pool)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/amqp.py\", line 326, in multicall\n(nova.rpc.common): TRACE:     conn.topic_send(topic, msg)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 443, in topic_send\n(nova.rpc.common): TRACE:     self.publisher_send(TopicPublisher, topic, msg)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 420, in publisher_send\n(nova.rpc.common): TRACE:     return self.ensure(_connect_error, _publisher_send)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 341, in ensure\n(nova.rpc.common): TRACE:     return method(*args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 418, in _publisher_send\n(nova.rpc.common): TRACE:     publisher.send(msg)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 233, in send\n(nova.rpc.common): TRACE:     self.sender.send(msg)\n(nova.rpc.common): TRACE:   File \"<string>\", line 6, in send\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 862, in send\n(nova.rpc.common): TRACE:     self.sync()\n(nova.rpc.common): TRACE:   File \"<string>\", line 6, in sync\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 873, in sync\n(nova.rpc.common): TRACE:     if not self._ewait(lambda: self.acked >= mno, timeout=timeout):\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 787, in _ewait\n(nova.rpc.common): TRACE:     result = self.session._ewait(lambda: self.error or predicate(), timeout)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 554, in _ewait\n(nova.rpc.common): TRACE:     result = self.connection._ewait(lambda: self.error or predicate(), timeout)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 197, in _ewait\n(nova.rpc.common): TRACE:     self.check_error()\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 190, in check_error\n(nova.rpc.common): TRACE:     raise self.error\n(nova.rpc.common): TRACE: InternalError: Traceback (most recent call last):\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/driver.py\", line 507, in dispatch\n(nova.rpc.common): TRACE:     self.engine.dispatch()\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/driver.py\", line 811, in dispatch\n(nova.rpc.common): TRACE:     self.process(ssn)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/driver.py\", line 1046, in process\n(nova.rpc.common): TRACE:     self.send(snd, msg)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/driver.py\", line 1257, in send\n(nova.rpc.common): TRACE:     body = enc(msg.content)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/message.py\", line 28, in encode\n(nova.rpc.common): TRACE:     sc.write_primitive(type, x)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 73, in write_primitive\n(nova.rpc.common): TRACE:     getattr(self, \"write_%s\" % type.NAME)(v)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 257, in write_map\n(nova.rpc.common): TRACE:     sc.write(string.joinfields(map(self._write_map_elem, m.keys(), m.values()), \"\"))\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 250, in _write_map_elem\n(nova.rpc.common): TRACE:     sc.write_primitive(type, v)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 73, in write_primitive\n(nova.rpc.common): TRACE:     getattr(self, \"write_%s\" % type.NAME)(v)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 257, in write_map\n(nova.rpc.common): TRACE:     sc.write(string.joinfields(map(self._write_map_elem, m.keys(), m.values()), \"\"))\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 246, in _write_map_elem\n(nova.rpc.common): TRACE:     type = self.encoding(v)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 59, in encoding\n(nova.rpc.common): TRACE:     raise CodecException(\"no encoding for %r\" % obj)\n(nova.rpc.common): TRACE: CodecException: no encoding for <nova.db.sqlalchemy.models.Network object at 0x670b5d0>\n(nova.rpc.common): TRACE: \n(nova.rpc.common): TRACE:", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/933584", 
    "owner": "https://api.launchpad.net/1.0/~russellb", 
    "id": 933584, 
    "index": 2760, 
    "openned": "2012-02-16 16:49:41.099257+00:00", 
    "created": "2012-02-16 16:49:41.099257+00:00", 
    "title": "Qpid error while creating an instance", 
    "comments": [
        {
            "content": "I hit an error while doing some testing.  The error is Qpid saying that it doesn't know how to encode an object of a particular type.  I will submit a patch to fix this.\n\n\n2012-02-16 11:12:19,837 ERROR nova.rpc.common [-] Exception during message handling\n(nova.rpc.common): TRACE: Traceback (most recent call last):\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/amqp.py\", line 249, in _process_data\n(nova.rpc.common): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 239, in wrapped\n(nova.rpc.common): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 294, in allocate_for_instance\n(nova.rpc.common): TRACE:     **kwargs)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 239, in wrapped\n(nova.rpc.common): TRACE:     return func(self, context, *args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 871, in allocate_for_instance\n(nova.rpc.common): TRACE:     requested_networks=requested_networks)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/network/manager.py\", line 200, in _allocate_fixed_ips\n(nova.rpc.common): TRACE:     'args': {'network_ref': network}})\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/__init__.py\", line 69, in call\n(nova.rpc.common): TRACE:     return _get_impl().call(context, topic, msg, timeout)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 500, in call\n(nova.rpc.common): TRACE:     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/amqp.py\", line 332, in call\n(nova.rpc.common): TRACE:     rv = multicall(context, topic, msg, timeout, connection_pool)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/amqp.py\", line 326, in multicall\n(nova.rpc.common): TRACE:     conn.topic_send(topic, msg)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 443, in topic_send\n(nova.rpc.common): TRACE:     self.publisher_send(TopicPublisher, topic, msg)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 420, in publisher_send\n(nova.rpc.common): TRACE:     return self.ensure(_connect_error, _publisher_send)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 341, in ensure\n(nova.rpc.common): TRACE:     return method(*args, **kwargs)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 418, in _publisher_send\n(nova.rpc.common): TRACE:     publisher.send(msg)\n(nova.rpc.common): TRACE:   File \"/home/rbryant/src/nova/nova/rpc/impl_qpid.py\", line 233, in send\n(nova.rpc.common): TRACE:     self.sender.send(msg)\n(nova.rpc.common): TRACE:   File \"<string>\", line 6, in send\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 862, in send\n(nova.rpc.common): TRACE:     self.sync()\n(nova.rpc.common): TRACE:   File \"<string>\", line 6, in sync\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 873, in sync\n(nova.rpc.common): TRACE:     if not self._ewait(lambda: self.acked >= mno, timeout=timeout):\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 787, in _ewait\n(nova.rpc.common): TRACE:     result = self.session._ewait(lambda: self.error or predicate(), timeout)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 554, in _ewait\n(nova.rpc.common): TRACE:     result = self.connection._ewait(lambda: self.error or predicate(), timeout)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 197, in _ewait\n(nova.rpc.common): TRACE:     self.check_error()\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/endpoints.py\", line 190, in check_error\n(nova.rpc.common): TRACE:     raise self.error\n(nova.rpc.common): TRACE: InternalError: Traceback (most recent call last):\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/driver.py\", line 507, in dispatch\n(nova.rpc.common): TRACE:     self.engine.dispatch()\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/driver.py\", line 811, in dispatch\n(nova.rpc.common): TRACE:     self.process(ssn)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/driver.py\", line 1046, in process\n(nova.rpc.common): TRACE:     self.send(snd, msg)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/driver.py\", line 1257, in send\n(nova.rpc.common): TRACE:     body = enc(msg.content)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/messaging/message.py\", line 28, in encode\n(nova.rpc.common): TRACE:     sc.write_primitive(type, x)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 73, in write_primitive\n(nova.rpc.common): TRACE:     getattr(self, \"write_%s\" % type.NAME)(v)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 257, in write_map\n(nova.rpc.common): TRACE:     sc.write(string.joinfields(map(self._write_map_elem, m.keys(), m.values()), \"\"))\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 250, in _write_map_elem\n(nova.rpc.common): TRACE:     sc.write_primitive(type, v)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 73, in write_primitive\n(nova.rpc.common): TRACE:     getattr(self, \"write_%s\" % type.NAME)(v)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 257, in write_map\n(nova.rpc.common): TRACE:     sc.write(string.joinfields(map(self._write_map_elem, m.keys(), m.values()), \"\"))\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 246, in _write_map_elem\n(nova.rpc.common): TRACE:     type = self.encoding(v)\n(nova.rpc.common): TRACE:   File \"/usr/lib/python2.7/site-packages/qpid/codec010.py\", line 59, in encoding\n(nova.rpc.common): TRACE:     raise CodecException(\"no encoding for %r\" % obj)\n(nova.rpc.common): TRACE: CodecException: no encoding for <nova.db.sqlalchemy.models.Network object at 0x670b5d0>\n(nova.rpc.common): TRACE: \n(nova.rpc.common): TRACE:", 
            "date_created": "2012-02-16 16:49:41.099257+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/4246", 
            "date_created": "2012-02-16 18:13:23.669154+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/4258", 
            "date_created": "2012-02-16 23:03:00.118656+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/4246\nCommitted: http://github.com/openstack/nova/commit/068f31c6cd3eff68f08ee597f7296e4f6e47388f\nSubmitter: Jenkins\nBranch:    master\n\ncommit 068f31c6cd3eff68f08ee597f7296e4f6e47388f\nAuthor: Russell Bryant <email address hidden>\nDate:   Thu Feb 16 14:39:10 2012 -0500\n\n    Don't send a SQLAlchemy model over rpc.\n    \n    Fix bug 933584.\n    \n    I noticed this when Qpid blew up because it didn't know how to serialize\n    a SQLAlchemy model.  Fix it by making it only consist of primitive types\n    before sending it.\n    \n    Change-Id: I63eb4bbabdb75fa7b277428bbd1aa2c2e1383383\n", 
            "date_created": "2012-02-16 23:31:43.793559+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/4258\nCommitted: http://github.com/openstack/nova/commit/c8c9a87b240b562d334c6875a1dd7614d4ae58d5\nSubmitter: Jenkins\nBranch:    master\n\ncommit c8c9a87b240b562d334c6875a1dd7614d4ae58d5\nAuthor: Russell Bryant <email address hidden>\nDate:   Thu Feb 16 15:52:16 2012 -0500\n\n    Add RPC serialization checking, fix exposed problems.\n    \n    Related to bug 933584.\n    \n    In this bug, I hit a case where some code tried to send a SQLAlchemy\n    model over rpc, which failed since it couldn't be serialized by Qpid.\n    This patch adds a simple serialization check to the fake RPC driver\n    using json.  It also fixes problems that were exposed by adding this\n    check.\n    \n    If json can't serialize a message sent through the fake RPC\n    driver, it will raise TypeError, causing unit tests to fail.  18 unit\n    tests failed with the check in place, but it was due to only 2 places\n    in the compute API.\n    \n    Change-Id: I63f3077c0fa35097d4f5d2c485f4e48eede2c751\n", 
            "date_created": "2012-02-16 23:53:05.122984+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-02-29 10:30:10.818175+00:00"
}