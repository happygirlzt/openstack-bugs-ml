{
    "status": "Fix Released", 
    "last_updated": "2017-01-27 00:52:25.998652+00:00", 
    "description": "http://logs.openstack.org/27/408727/3/check/gate-tempest-dsvm-cells-ubuntu-xenial/e788689/logs/screen-n-cell-child.txt.gz?level=TRACE\n\n2016-12-09 21:25:50.743 23726 ERROR nova Traceback (most recent call last):\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/usr/local/bin/nova-cells\", line 10, in <module>\n2016-12-09 21:25:50.743 23726 ERROR nova     sys.exit(main())\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cmd/cells.py\", line 43, in main\n2016-12-09 21:25:50.743 23726 ERROR nova     manager='nova.cells.manager.CellsManager')\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/service.py\", line 228, in create\n2016-12-09 21:25:50.743 23726 ERROR nova     periodic_interval_max=periodic_interval_max)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/service.py\", line 101, in __init__\n2016-12-09 21:25:50.743 23726 ERROR nova     self.manager = manager_class(host=self.host, *args, **kwargs)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/manager.py\", line 82, in __init__\n2016-12-09 21:25:50.743 23726 ERROR nova     self.state_manager = cell_state_manager()\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 146, in __new__\n2016-12-09 21:25:50.743 23726 ERROR nova     return CellStateManagerDB(cell_state_cls)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 162, in __init__\n2016-12-09 21:25:50.743 23726 ERROR nova     self._cell_data_sync(force=True)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n2016-12-09 21:25:50.743 23726 ERROR nova     return f(*args, **kwargs)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 453, in _cell_data_sync\n2016-12-09 21:25:50.743 23726 ERROR nova     self._update_our_capacity(ctxt)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 285, in _update_our_capacity\n2016-12-09 21:25:50.743 23726 ERROR nova     _get_compute_hosts()\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 279, in _get_compute_hosts\n2016-12-09 21:25:50.743 23726 ERROR nova     free_disk = compute.free_disk_gb * 1024\n2016-12-09 21:25:50.743 23726 ERROR nova TypeError: unsupported operand type(s) for *: 'NoneType' and 'int'\n2016-12-09 21:25:50.743 23726 ERROR nova", 
    "tags": [
        "cells"
    ], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1648983", 
    "owner": "https://api.launchpad.net/1.0/~int32bit", 
    "id": 1648983, 
    "index": 2129, 
    "openned": "2016-12-10 15:35:09.466543+00:00", 
    "created": "2016-12-10 15:35:09.466543+00:00", 
    "title": "cells v1: error when reporting child cell capacity: 'TypeError: unsupported operand type(s) for *: 'NoneType' and 'int''", 
    "comments": [
        {
            "content": "http://logs.openstack.org/27/408727/3/check/gate-tempest-dsvm-cells-ubuntu-xenial/e788689/logs/screen-n-cell-child.txt.gz?level=TRACE\n\n2016-12-09 21:25:50.743 23726 ERROR nova Traceback (most recent call last):\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/usr/local/bin/nova-cells\", line 10, in <module>\n2016-12-09 21:25:50.743 23726 ERROR nova     sys.exit(main())\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cmd/cells.py\", line 43, in main\n2016-12-09 21:25:50.743 23726 ERROR nova     manager='nova.cells.manager.CellsManager')\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/service.py\", line 228, in create\n2016-12-09 21:25:50.743 23726 ERROR nova     periodic_interval_max=periodic_interval_max)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/service.py\", line 101, in __init__\n2016-12-09 21:25:50.743 23726 ERROR nova     self.manager = manager_class(host=self.host, *args, **kwargs)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/manager.py\", line 82, in __init__\n2016-12-09 21:25:50.743 23726 ERROR nova     self.state_manager = cell_state_manager()\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 146, in __new__\n2016-12-09 21:25:50.743 23726 ERROR nova     return CellStateManagerDB(cell_state_cls)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 162, in __init__\n2016-12-09 21:25:50.743 23726 ERROR nova     self._cell_data_sync(force=True)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/usr/local/lib/python2.7/dist-packages/oslo_concurrency/lockutils.py\", line 271, in inner\n2016-12-09 21:25:50.743 23726 ERROR nova     return f(*args, **kwargs)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 453, in _cell_data_sync\n2016-12-09 21:25:50.743 23726 ERROR nova     self._update_our_capacity(ctxt)\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 285, in _update_our_capacity\n2016-12-09 21:25:50.743 23726 ERROR nova     _get_compute_hosts()\n2016-12-09 21:25:50.743 23726 ERROR nova   File \"/opt/stack/new/nova/nova/cells/state.py\", line 279, in _get_compute_hosts\n2016-12-09 21:25:50.743 23726 ERROR nova     free_disk = compute.free_disk_gb * 1024\n2016-12-09 21:25:50.743 23726 ERROR nova TypeError: unsupported operand type(s) for *: 'NoneType' and 'int'\n2016-12-09 21:25:50.743 23726 ERROR nova", 
            "date_created": "2016-12-10 15:35:09.466543+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "I'm not really sure what the root cause is, but I think the most direct way is to check the value whether is None or not.", 
            "date_created": "2016-12-11 05:11:52.113874+00:00", 
            "author": "https://api.launchpad.net/1.0/~int32bit"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/409501\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=58bf5d005394d2b31bab9e8971e765c35974ca07\nSubmitter: Jenkins\nBranch:    master\n\ncommit 58bf5d005394d2b31bab9e8971e765c35974ca07\nAuthor: int32bit <email address hidden>\nDate:   Sun Dec 11 15:08:45 2016 +0800\n\n    Fix error if free_disk_gb is None in CellStateManager\n    \n    The field 'free_disk_gb' in Objects.ComputeNode can be nullable.\n    In CellStateManager._get_compute_hosts, we compute free_disk_mb\n    by 'free_disk_gb * 1024'. If the free_disk_gb is None, it will raise\n    a TypeError exception because None type can't multiply by an integer.\n    We should check this value, and if it's None, we just let it return\n    zero.\n    \n    Closes-Bug: #1648983\n    \n    Change-Id: I558d544ff838807c1d605cb5ed8d0e0fa97ab00e\n", 
            "date_created": "2016-12-19 17:37:45.450880+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 15.0.0.0b3 development milestone.", 
            "date_created": "2017-01-27 00:52:24.936849+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-12-19 17:37:42.735656+00:00"
}