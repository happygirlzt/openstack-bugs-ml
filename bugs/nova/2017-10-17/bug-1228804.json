{
    "status": "Expired", 
    "last_updated": "2016-07-05 09:43:50.288607+00:00", 
    "description": "Current compute api doesn't have precheck for  compute service before performing action on instance . If the compute service isn't available, for example like the compute host is down. and stop/start instance will lead to keep instance' task_state with 'powering-off'/'powering-on' without raising exception. \nThese actions include  stop/start, pause/unpause suspend/resume\nWe need raise exception to report compute service is not available as below:\n\n[root@guochbo-10-7-0-151 ~]# nova start test1\nERROR: Compute service of guochbo-10-7-0-151.sce.cn.ibm.com is unavailable at this time. (HTTP 400) (Request-ID: req-282b4ee7-8920-43e7-8ce7-40bc2330fc49)", 
    "tags": [
        "api"
    ], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1228804", 
    "owner": "None", 
    "id": 1228804, 
    "index": 5378, 
    "openned": "2013-09-22 08:54:40.127202+00:00", 
    "created": "2013-09-22 08:54:40.127202+00:00", 
    "title": "Need  raise exception  when performing action on instance if compute service is down", 
    "comments": [
        {
            "content": "Current compute api doesn't have precheck for  compute service before stop/start instance . If the compute service isn't available, for example like the compute host is down or  compute service can't connect to controller . This lead to keep instance' task_state with 'powering-off'/'powering-on'  forever without raising exception.   The instance can't be stopped/started even the compute service is available again .", 
            "date_created": "2013-09-22 08:54:40.127202+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "This can be reproduced as follow steps:\n\n1)nova show gcb_test_222\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| status                               | ACTIVE                                                   |\n| updated                              | 2013-09-21T03:45:52Z                                     |\n| OS-EXT-STS:task_state                | None                                                     |\n| OS-EXT-SRV-ATTR:host                 | kvm-installer-222                                        |\n| key_name                             | None                                                     |\n| image                                | cirros-Image (c2fdf54f-4978-4ee9-af0e-d1e0d5db2631)      |\n| hostId                               | b605c007b2a5de389a65a645d88d708b82745b4706361d9ef18bf410 |\n| OS-EXT-STS:vm_state                  | active                                                   |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000038                                        |\n| OS-SRV-USG:launched_at               | 2013-09-20T22:45:53.555626                               |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | kvm-installer-222                                        |\n| flavor                               | m1.tiny (1)                                              |\n| id                                   | 7677f07e-f5f4-42ee-a5d1-f1dbcddab769                     |\n| security_groups                      | [{u'name': u'default'}]                                  |\n| OS-SRV-USG:terminated_at             | None                                                     |\n| user_id                              | d02e0752613142da90387adcc7cf2664                         |\n| name                                 | gcb_test_222                                             |\n| created                              | 2013-09-21T03:45:49Z                                     |\n| tenant_id                            | 6db20e01ef6f42f18cbebb56f70ebed3                         |\n| OS-DCF:diskConfig                    | MANUAL                                                   |\n| metadata                             | {}                                                       |\n| os-extended-volumes:volumes_attached | []                                                       |\n| accessIPv4                           |                                                          |\n| accessIPv6                           |                                                          |\n| net1 network                         | 10.0.2.7                                                 |\n| progress                             | 0                                                        |\n| OS-EXT-STS:power_state               | 1                                                        |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| config_drive                         |                                                          |\n+--------------------------------------+----------------------------------------------------------+\n2)nova availability-zone-list\n+---------------------------------+----------------------------------------+\n| Name                            | Status                                 |\n+---------------------------------+----------------------------------------+\n| internal                        | available                              |\n| |- vapp-0823-kvm-controller-226 |                                        |\n| | |- nova-cert                  | enabled :-) 2013-09-21T03:49:11.078833 |\n| | |- nova-conductor             | enabled :-) 2013-09-21T03:49:10.851063 |\n| | |- nova-consoleauth           | enabled :-) 2013-09-21T03:49:10.693941 |\n| | |- nova-scheduler             | enabled :-) 2013-09-21T03:49:10.844385 |\n| | |- nova-console               | enabled :-) 2013-09-21T03:49:11.431072 |\n| | |- nova-cells                 | enabled :-) 2013-09-21T03:49:11.945337 |\n| nova                            | available                              |\n| |- kvm-installer-221            |                                        |\n| | |- nova-compute               | enabled :-) 2013-09-21T03:49:08.087701 |\n| |- kvm-installer-222            |                                        |\n| | |- nova-compute               | enabled XXX 2013-09-21T03:47:32.943466 |\n+---------------------------------+----------------------------------------+\n3)nova stop  gcb_test_222\n4)nova show gcb_test_222\n+--------------------------------------+----------------------------------------------------------+\n| Property                             | Value                                                    |\n+--------------------------------------+----------------------------------------------------------+\n| status                               | ACTIVE                                                   |\n| updated                              | 2013-09-21T03:51:10Z                                     |\n| OS-EXT-STS:task_state                | powering-off                                             |\n| OS-EXT-SRV-ATTR:host                 | kvm-installer-222                                        |\n| key_name                             | None                                                     |\n| image                                | cirros-Image (c2fdf54f-4978-4ee9-af0e-d1e0d5db2631)      |\n| hostId                               | b605c007b2a5de389a65a645d88d708b82745b4706361d9ef18bf410 |\n| OS-EXT-STS:vm_state                  | active                                                   |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000038                                        |\n| OS-SRV-USG:launched_at               | 2013-09-20T22:45:53.555626                               |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | kvm-installer-222                                        |\n| flavor                               | m1.tiny (1)                                              |\n| id                                   | 7677f07e-f5f4-42ee-a5d1-f1dbcddab769                     |\n| security_groups                      | [{u'name': u'default'}]                                  |\n| OS-SRV-USG:terminated_at             | None                                                     |\n| user_id                              | d02e0752613142da90387adcc7cf2664                         |\n| name                                 | gcb_test_222                                             |\n| created                              | 2013-09-21T03:45:49Z                                     |\n| tenant_id                            | 6db20e01ef6f42f18cbebb56f70ebed3                         |\n| OS-DCF:diskConfig                    | MANUAL                                                   |\n| metadata                             | {}                                                       |\n| os-extended-volumes:volumes_attached | []                                                       |\n| accessIPv4                           |                                                          |\n| accessIPv6                           |                                                          |\n| net1 network                         | 10.0.2.7                                                 |\n| progress                             | 0                                                        |\n| OS-EXT-STS:power_state               | 1                                                        |\n| OS-EXT-AZ:availability_zone          | nova                                                     |\n| config_drive                         |                                                          |\n+--------------------------------------+----------------------------------------------------------+\n5)nova stop gcb_test_222\nERROR: Instance 7677f07e-f5f4-42ee-a5d1-f1dbcddab769 in task_state powering-off. Cannot stop while the instance is in this state. \n(HTTP 400) (Request-ID: req-a51eb10b-c034-4ff0-afa5-3e996b812b75)", 
            "date_created": "2013-09-22 09:00:31.768740+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/47733", 
            "date_created": "2013-09-22 09:07:14.581968+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I think this bug  does confusing user . If the compute service is unavailable , but user don't know about this . Because ,nova list\nalways  return the old instance state ,  start/stop one instance  without any exception ,just change the task_state .\n\n@ Russel , Chris, GuoHui\nI would like to get suggestion from you to move on  :),  and find a best fit soluton for the bug . \nI just posted a patch , move the check logic into  nova/compute/api.py ,  we can easily  apply the check to other actions like pause,\nThis time is  closer to compute driver rpc call than last patch ( in  api),  I tested it  as follow,  \n\n[root@guochbo-10-7-0-151 /]# nova list\n+--------------------------------------+-------+--------+------------+-------------+-------------------+\n| ID                                   | Name  | Status | Task State | Power State | Networks          |\n+--------------------------------------+-------+--------+------------+-------------+-------------------+\n| 6340fef6-5dfa-45c1-8aad-eed80d7c0217 | test1 | ACTIVE | None       | Running     | network1=10.0.1.3 |\n| 0ff75f64-01d6-4b1f-bec8-0edfc3417b48 | test2 | ACTIVE | None       | Running     | network1=10.0.1.4 |\n+--------------------------------------+-------+--------+------------+-------------+-------------------+\n[root@guochbo-10-7-0-151 /]# service openstack-nova-compute stop\nStopping openstack-nova-compute:                           [  OK  ]\n[root@guochbo-10-7-0-151 /]# nova stop test1\nERROR: Compute service of guochbo-10-7-0-151.sce.cn.ibm.com is unavailable at this time. (HTTP 400) (Request-ID: req-a192800e-eaf6-470a-bd4a-5aacd8c5227f)\n\n1) Is this  way OK for you  ?  I still need more work to modify  other  unittest  to fit the chanage , but  I will hold on until  I get the right direction .\n2) Any suggestion about the bug ?\nThanks in advance.", 
            "date_created": "2013-09-25 10:06:17.604005+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/54237", 
            "date_created": "2013-10-29 06:32:36.860445+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "pre-flight isn't an effective way to solve this, as it has race conditions. Need to detect the situation and cater for it there.", 
            "date_created": "2013-11-13 03:15:42.145408+00:00", 
            "author": "https://api.launchpad.net/1.0/~lifeless"
        }, 
        {
            "content": "Rober,\nI agree with you .  We need figure out the  place of check . Any idea about the place ?", 
            "date_created": "2013-11-13 04:45:10.858904+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "Need a mechanism to handle our instances' status and operations on them when compute service is down. \r\nThis is not a bug fix can handle this ,", 
            "date_created": "2013-11-23 03:13:25.566601+00:00", 
            "author": "https://api.launchpad.net/1.0/~glongwave"
        }, 
        {
            "content": "I think you want to look at what this blueprint is doing:\n\nhttps://blueprints.launchpad.net/nova/+spec/recover-stuck-state", 
            "date_created": "2013-12-05 17:30:36.723216+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "\nThis is an automated cleanup. This bug report has been closed because it\nis older than 18 months and there is no open code change to fix this.\nAfter this time it is unlikely that the circumstances which lead to\nthe observed issue can be reproduced.\n\nIf you can reproduce the bug, please:\n* reopen the bug report (set to status \"New\")\n* AND add the detailed steps to reproduce the issue (if applicable)\n* AND leave a comment \"CONFIRMED FOR: <RELEASE_NAME>\"\n  Only still supported release names are valid (LIBERTY, MITAKA, OCATA, NEWTON).\n  Valid example: CONFIRMED FOR: LIBERTY\n", 
            "date_created": "2016-07-05 09:43:49.871799+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ], 
    "closed": "2016-07-05 09:43:46.940937+00:00"
}