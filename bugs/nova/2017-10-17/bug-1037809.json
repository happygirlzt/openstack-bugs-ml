{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:44:14.663886+00:00", 
    "description": "There exists a window between a server create is done and when the host is assigned by the scheduler that a request to get the vnc console will result in a 500 error.\n\nAn exception similar to this will be seen in the logs:\n\n2012-08-16 21:42:43 TRACE nova.api.openstack Traceback (most recent call last):\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/__init__.py\", line 78, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return req.get_response(self.application)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/request.py\", line 1053, in get_response\n2012-08-16 21:42:43 TRACE nova.api.openstack     application, catch_exc_info=False)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/request.py\", line 1022, in call_application\n2012-08-16 21:42:43 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 159, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/keystone-2012.2-py2.6.egg/keystone/middleware/auth_token.py\", line 213, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return self.app(env, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 159, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 159, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/Routes-1.13-py2.6.egg/routes/middleware.py\", line 131, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 159, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 147, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 208, in call_func\n2012-08-16 21:42:43 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/wsgi.py\", line 864, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     content_type, body, accept)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/wsgi.py\", line 912, in _process_stack\n2012-08-16 21:42:43 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/wsgi.py\", line 1000, in dispatch\n2012-08-16 21:42:43 TRACE nova.api.openstack     return method(req=request, **action_args)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/compute/contrib/consoles.py\", line 48, in get_vnc_console\n2012-08-16 21:42:43 TRACE nova.api.openstack     console_type)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/compute/api.py\", line 120, in wrapped\n2012-08-16 21:42:43 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/compute/api.py\", line 1631, in get_vnc_console\n2012-08-16 21:42:43 TRACE nova.api.openstack     instance=instance, console_type=console_type)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/compute/rpcapi.py\", line 254, in get_vnc_console\n2012-08-16 21:42:43 TRACE nova.api.openstack     topic=_compute_topic(self.topic, ctxt, None, instance),\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/compute/rpcapi.py\", line 48, in _compute_topic\n2012-08-16 21:42:43 TRACE nova.api.openstack     'Instance %s') % instance['uuid'])\n2012-08-16 21:42:43 TRACE nova.api.openstack NovaException: Unable to find host for Instance 1a3f3a81-fd2f-4a99-b446-5e03216fe045", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1037809", 
    "owner": "https://api.launchpad.net/1.0/~russellb", 
    "id": 1037809, 
    "index": 3016, 
    "openned": "2012-08-16 21:48:42.909181+00:00", 
    "created": "2012-08-16 21:48:42.909181+00:00", 
    "title": "get_vnc_console returns 500 error if called before host is assigned", 
    "comments": [
        {
            "content": "There exists a window between a server create is done and when the host is assigned by the scheduler that a request to get the vnc console will result in a 500 error.\n\nAn exception similar to this will be seen in the logs:\n\n2012-08-16 21:42:43 TRACE nova.api.openstack Traceback (most recent call last):\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/__init__.py\", line 78, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return req.get_response(self.application)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/request.py\", line 1053, in get_response\n2012-08-16 21:42:43 TRACE nova.api.openstack     application, catch_exc_info=False)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/request.py\", line 1022, in call_application\n2012-08-16 21:42:43 TRACE nova.api.openstack     app_iter = application(self.environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 159, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/keystone-2012.2-py2.6.egg/keystone/middleware/auth_token.py\", line 213, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return self.app(env, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 159, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 159, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/Routes-1.13-py2.6.egg/routes/middleware.py\", line 131, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     response = self.app(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 159, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     return resp(environ, start_response)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 147, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     resp = self.call_func(req, *args, **self.kwargs)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/webob/dec.py\", line 208, in call_func\n2012-08-16 21:42:43 TRACE nova.api.openstack     return self.func(req, *args, **kwargs)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/wsgi.py\", line 864, in __call__\n2012-08-16 21:42:43 TRACE nova.api.openstack     content_type, body, accept)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/wsgi.py\", line 912, in _process_stack\n2012-08-16 21:42:43 TRACE nova.api.openstack     action_result = self.dispatch(meth, request, action_args)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/wsgi.py\", line 1000, in dispatch\n2012-08-16 21:42:43 TRACE nova.api.openstack     return method(req=request, **action_args)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/api/openstack/compute/contrib/consoles.py\", line 48, in get_vnc_console\n2012-08-16 21:42:43 TRACE nova.api.openstack     console_type)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/compute/api.py\", line 120, in wrapped\n2012-08-16 21:42:43 TRACE nova.api.openstack     return func(self, context, target, *args, **kwargs)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/compute/api.py\", line 1631, in get_vnc_console\n2012-08-16 21:42:43 TRACE nova.api.openstack     instance=instance, console_type=console_type)\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/compute/rpcapi.py\", line 254, in get_vnc_console\n2012-08-16 21:42:43 TRACE nova.api.openstack     topic=_compute_topic(self.topic, ctxt, None, instance),\n2012-08-16 21:42:43 TRACE nova.api.openstack   File \"/home/johannes/openstack/nova/trunk/nova/compute/rpcapi.py\", line 48, in _compute_topic\n2012-08-16 21:42:43 TRACE nova.api.openstack     'Instance %s') % instance['uuid'])\n2012-08-16 21:42:43 TRACE nova.api.openstack NovaException: Unable to find host for Instance 1a3f3a81-fd2f-4a99-b446-5e03216fe045", 
            "date_created": "2012-08-16 21:48:42.909181+00:00", 
            "author": "https://api.launchpad.net/1.0/~johannes.erdfelt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/11574", 
            "date_created": "2012-08-17 19:25:03.006649+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/11574\nCommitted: http://github.com/openstack/nova/commit/fa16d173938b30af4e1cc6b312a75b12aff6c424\nSubmitter: Jenkins\nBranch:    master\n\ncommit fa16d173938b30af4e1cc6b312a75b12aff6c424\nAuthor: Russell Bryant <email address hidden>\nDate:   Fri Aug 17 15:21:36 2012 -0400\n\n    Fix get_vnc_console race.\n    \n    There exists a window between a server create is done and when the host\n    is assigned by the scheduler that a request to get the vnc console will\n    result in a 500 error.\n    \n    This patch adds a check in the compute API to ensure that the instance\n    has a host assigned before try to execute a rpc on the compute node.\n    If not, it raises InstanceNotReady (which translates to a 409 in the\n    OS API).\n    \n    Fix bug 1037809.\n    \n    Change-Id: I3f5af90d57ae84f98f787e14ccb66f1841ac0c6d\n", 
            "date_created": "2012-08-17 20:14:26.094980+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-09-19 06:38:40.789071+00:00"
}