{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:02:05.008743+00:00", 
    "description": "After this bug:\n\nhttps://bugs.launchpad.net/nova/+bug/1008622\n\nwas fixed, the image id is no longer required when booting from volume. Unfortunately this is not true when using xenapi. This is the stack trace I get when I omit --image with the nova cli:\n\n2012-12-07 22:11:34 ERROR nova.utils [req-352d2d70-e44e-485b-9248-63c7bf9689fd demo demo] [instance: c572084d-77dd-4016-8630-ceff6507575a] Failed to spawn, rolling back\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a] Traceback (most recent call last):\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 388, in spawn2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]     disk_image_type = determine_disk_image_type_step(undo_mgr)\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 133, in inner\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]     rv = f(*args, **kwargs)2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 268, in determine_disk_image_type_step\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]     return vm_utils.determine_disk_image_type(image_meta)\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 1253, in determine_disk_image_type2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]     disk_format = image_meta['disk_format']\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a] KeyError: 'disk_format'\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]2012-12-07 22:11:35 ERROR nova.compute.manager [req-352d2d70-e44e-485b-9248-63c7bf9689fd demo demo] [instance: c572084d-77dd-4016-8630-ceff6507575a] Instance failed to spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a] Traceback (most recent call last):2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/compute/manager.py\", line 875, in _spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     block_device_info)2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 171, in spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     admin_password, network_info, block_device_info)2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 407, in spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     undo_mgr.rollback_and_reraise(msg=msg, instance=instance)\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/utils.py\", line 1150, in rollback_and_reraise2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     self._rollback()\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     self.gen.next()2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 388, in spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     disk_image_type = determine_disk_image_type_step(undo_mgr)2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 133, in inner\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     rv = f(*args, **kwargs)2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 268, in determine_disk_image_type_step\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     return vm_utils.determine_disk_image_type(image_meta)\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 1253, in determine_disk_image_type\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     disk_format = image_meta['disk_format']\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a] KeyError: 'disk_format'\n\nThis happens on trunk.", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1087869", 
    "owner": "https://api.launchpad.net/1.0/~armando-migliaccio", 
    "id": 1087869, 
    "index": 901, 
    "openned": "2012-12-07 22:57:36.269358+00:00", 
    "created": "2012-12-07 22:57:36.269358+00:00", 
    "title": "KeyError: 'disk_format' when booting from volume and xenapi", 
    "comments": [
        {
            "content": "After this bug:\n\nhttps://bugs.launchpad.net/nova/+bug/1008622\n\nwas fixed, the image id is no longer required when booting from volume. Unfortunately this is not true when using xenapi. This is the stack trace I get when I omit --image with the nova cli:\n\n2012-12-07 22:11:34 ERROR nova.utils [req-352d2d70-e44e-485b-9248-63c7bf9689fd demo demo] [instance: c572084d-77dd-4016-8630-ceff6507575a] Failed to spawn, rolling back\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a] Traceback (most recent call last):\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 388, in spawn2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]     disk_image_type = determine_disk_image_type_step(undo_mgr)\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 133, in inner\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]     rv = f(*args, **kwargs)2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 268, in determine_disk_image_type_step\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]     return vm_utils.determine_disk_image_type(image_meta)\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 1253, in determine_disk_image_type2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]     disk_format = image_meta['disk_format']\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a] KeyError: 'disk_format'\n2012-12-07 22:11:34 27613 TRACE nova.utils [instance: c572084d-77dd-4016-8630-ceff6507575a]2012-12-07 22:11:35 ERROR nova.compute.manager [req-352d2d70-e44e-485b-9248-63c7bf9689fd demo demo] [instance: c572084d-77dd-4016-8630-ceff6507575a] Instance failed to spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a] Traceback (most recent call last):2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/compute/manager.py\", line 875, in _spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     block_device_info)2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/driver.py\", line 171, in spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     admin_password, network_info, block_device_info)2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 407, in spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     undo_mgr.rollback_and_reraise(msg=msg, instance=instance)\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/utils.py\", line 1150, in rollback_and_reraise2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     self._rollback()\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     self.gen.next()2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 388, in spawn\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     disk_image_type = determine_disk_image_type_step(undo_mgr)2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 133, in inner\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     rv = f(*args, **kwargs)2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vmops.py\", line 268, in determine_disk_image_type_step\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     return vm_utils.determine_disk_image_type(image_meta)\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]   File \"/opt/stack/nova/nova/virt/xenapi/vm_utils.py\", line 1253, in determine_disk_image_type\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a]     disk_format = image_meta['disk_format']\n2012-12-07 22:11:35 27613 TRACE nova.compute.manager [instance: c572084d-77dd-4016-8630-ceff6507575a] KeyError: 'disk_format'\n\nThis happens on trunk.", 
            "date_created": "2012-12-07 22:57:36.269358+00:00", 
            "author": "https://api.launchpad.net/1.0/~armando-migliaccio"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/17814", 
            "date_created": "2012-12-11 00:08:21.064834+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/17814\nCommitted: http://github.com/openstack/nova/commit/5019de6bed0751d3dd7f5a626940d839b91a1c3a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5019de6bed0751d3dd7f5a626940d839b91a1c3a\nAuthor: Armando Migliaccio <email address hidden>\nDate:   Mon Dec 10 23:58:45 2012 +0000\n\n    Allow xenapi to work with empty image metadata\n    \n    Also, add a number of tests for unit coverage\n    of the boot from volume feature.\n    \n    Fixes bug #1087869\n    \n    Change-Id: I7160e8c3b3d0ecd55a0ee0a66c512595bc25fb43\n", 
            "date_created": "2012-12-14 16:49:09.195253+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-01-09 10:20:15.774609+00:00"
}