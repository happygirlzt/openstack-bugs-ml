{
    "status": "Opinion", 
    "last_updated": "2017-08-03 14:30:20.345114+00:00", 
    "description": "When a flavor is defined like:\n\n+----------------------------+--------------------------------------------------------------------+\n| Field                      | Value                                                              |\n+----------------------------+--------------------------------------------------------------------+\n| OS-FLV-DISABLED:disabled   | False                                                              |\n| OS-FLV-EXT-DATA:ephemeral  | 0                                                                  |\n| access_project_ids         | None                                                               |\n| disk                       | 0                                                                  |\n| id                         | 2f41a9c0-f194-4925-81d2-b62a3c07435a                               |\n| name                       | test2                                                              |\n| os-flavor-access:is_public | True                                                               |\n| properties                 | resources:DISK_GB='0', resources:MEMORY_MB='0', resources:VCPU='0' |\n| ram                        | 256                                                                |\n| rxtx_factor                | 1.0                                                                |\n| swap                       |                                                                    |\n| vcpus                      | 1                                                                  |\n+----------------------------+--------------------------------------------------------------------+\n\nThen it will disable all the standard resources, and pop them from the resources dictionary here:\n\nhttps://github.com/openstack/nova/blob/57cd38d1fdc4d6b3439a8374e4713baf0b207184/nova/scheduler/utils.py#L141\n\nthe resources dictionary is then empty but nova still tries to use it to make a request to the placements API. This results in a error message like:\n\nERROR nova.scheduler.client.report [None req-030ec9a7-4299-47e0-bd38-b9d40721c210 admin admin] Failed to retrieve allocation candidates from placement API for filters {}. Got 400: <htm\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:  <head>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:   <title>400 Bad Request</title>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:  </head>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:  <body>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:   <h1>400 Bad Request</h1>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:   The server could not comply with the request since it is either malformed or otherwise incorrect.<br /><br />\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]: Badly formed resources parameter. Expected resources query string parameter in form: ?resources=VCPU:2,MEMORY_MB:1024. Got: empty string.\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:  </body>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]: </html>.\n\nNova should catch the case when the flavor has removed all filters and provide a more useful error message to indicate what the operator as done wrong.", 
    "tags": [
        "placement"
    ], 
    "importance": "Wishlist", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1708424", 
    "owner": "None", 
    "id": 1708424, 
    "index": 3153, 
    "openned": "2017-08-03 10:23:36.695222+00:00", 
    "created": "2017-08-03 10:23:36.695222+00:00", 
    "title": "When a flavor has resource extra_specs disabling all standard fields, nova tries to make a request to the placements API with no resources", 
    "comments": [
        {
            "content": "When a flavor is defined like:\n\n+----------------------------+--------------------------------------------------------------------+\n| Field                      | Value                                                              |\n+----------------------------+--------------------------------------------------------------------+\n| OS-FLV-DISABLED:disabled   | False                                                              |\n| OS-FLV-EXT-DATA:ephemeral  | 0                                                                  |\n| access_project_ids         | None                                                               |\n| disk                       | 0                                                                  |\n| id                         | 2f41a9c0-f194-4925-81d2-b62a3c07435a                               |\n| name                       | test2                                                              |\n| os-flavor-access:is_public | True                                                               |\n| properties                 | resources:DISK_GB='0', resources:MEMORY_MB='0', resources:VCPU='0' |\n| ram                        | 256                                                                |\n| rxtx_factor                | 1.0                                                                |\n| swap                       |                                                                    |\n| vcpus                      | 1                                                                  |\n+----------------------------+--------------------------------------------------------------------+\n\nThen it will disable all the standard resources, and pop them from the resources dictionary here:\n\nhttps://github.com/openstack/nova/blob/57cd38d1fdc4d6b3439a8374e4713baf0b207184/nova/scheduler/utils.py#L141\n\nthe resources dictionary is then empty but nova still tries to use it to make a request to the placements API. This results in a error message like:\n\nERROR nova.scheduler.client.report [None req-030ec9a7-4299-47e0-bd38-b9d40721c210 admin admin] Failed to retrieve allocation candidates from placement API for filters {}. Got 400: <htm\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:  <head>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:   <title>400 Bad Request</title>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:  </head>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:  <body>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:   <h1>400 Bad Request</h1>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:   The server could not comply with the request since it is either malformed or otherwise incorrect.<br /><br />\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]: Badly formed resources parameter. Expected resources query string parameter in form: ?resources=VCPU:2,MEMORY_MB:1024. Got: empty string.\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]:  </body>\nAug 03 12:40:11 qa-cld-m1-neo4 nova-scheduler[4057]: </html>.\n\nNova should catch the case when the flavor has removed all filters and provide a more useful error message to indicate what the operator as done wrong.", 
            "date_created": "2017-08-03 10:23:36.695222+00:00", 
            "author": "https://api.launchpad.net/1.0/~sambetts"
        }, 
        {
            "content": "So, this really seems like going out of the way to break the system. A better error message would be fine if it was submitted, but this is very unlikely to hit in the real world.", 
            "date_created": "2017-08-03 14:30:06.792542+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2017-08-03 14:29:16.884241+00:00"
}