{
    "status": "Invalid", 
    "last_updated": "2012-07-18 14:12:21.428562+00:00", 
    "description": "Description: \n\nDeletion of Volume when corresponding Volume Snapshot exists, is throwing 'Bad Request Exception'. As Volume and Volume Snapshot are two independant entities once volume Snapshotting is completed, We do not expect Volume Snapshot to be dependant on Volume i.e, deletion of Volume should not be restricted when its Snapshot exists.\n\nSteps to Reproduce:\n\n1. Create a Volume 'V'.\n2. Wait till it reaches 'available' state.\n3. Create a Volume Snapshot 'VS' using the volume ID of 'V'.\n4. Wait till Volume Snapshot reaches 'available' state.\n5. Delete Volume'V'.\n\nExpected Result:\nVolume Should be deleted and responce code 200 should be returned.\n\nActual Result:\n'Bad Request' Exception is raised and 400 code is returned, saying \" ERROR: Invalid volume: Volume still has 1 dependent snapshots (HTTP 400)\"\n\nLOG:\n\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova --debug volume-create 1 --display_name test\nconnect: (127.0.0.1, 5000)\nsend: 'POST /v2.0/tokens HTTP/1.1\\r\\nHost: 127.0.0.1:5000\\r\\nContent-Length: 100\\r\\ncontent-type: application/json\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n{\"auth\": {\"tenantName\": \"demo\", \"passwordCredentials\": {\"username\": \"demo\", \"password\": \"muralik\"}}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: Content-Type: application/json\nheader: Vary: X-Auth-Token\nheader: Content-Length: 2158\nheader: Date: Wed, 04 Jul 2012 11:19:48 GMT\nconnect: (10.233.52.237, 8776)\nsend: u'POST /v1/b7dfbec65e69454b823cdbb78737f629/volumes HTTP/1.1\\r\\nHost: 10.233.52.237:8776\\r\\nContent-Length: 118\\r\\nx-auth-project-id: demo\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nx-auth-token: 5e94c311eba74e04bec816c487fd5102\\r\\nuser-agent: python-novaclient\\r\\ncontent-type: application/json\\r\\n\\r\\n{\"volume\": {\"snapshot_id\": null, \"display_name\": \"test\", \"volume_type\": null, \"display_description\": null, \"size\": 1}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: X-Compute-Request-Id: req-5efa112e-b1e3-4aae-95bd-8d6ad71e8a96\nheader: Content-Type: application/json\nheader: Content-Length: 296\nheader: Date: Wed, 04 Jul 2012 11:19:48 GMT\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova volume-list\n+--------------------------------------+-----------+--------------------+------+-------------+-------------+\n| ID                                   | Status    | Display Name       | Size | Volume Type | Attached to |\n+--------------------------------------+-----------+--------------------+------+-------------+-------------+\n| 1f7a9697-ba0b-4de7-9ed0-cae2c5a043b9 | available | Volume-86145667609 | 1    | None        |             |\n| ef911f29-764f-449e-b7f0-6cc2052a6d1a | available | test               | 1    | None        |             |\n+--------------------------------------+-----------+--------------------+------+-------------+-------------+\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova --debug volume-snapshot-create ef911f29-764f-449e-b7f0-6cc2052a6d1a --display_name test\nconnect: (127.0.0.1, 5000)\nsend: 'POST /v2.0/tokens HTTP/1.1\\r\\nHost: 127.0.0.1:5000\\r\\nContent-Length: 100\\r\\ncontent-type: application/json\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n{\"auth\": {\"tenantName\": \"demo\", \"passwordCredentials\": {\"username\": \"demo\", \"password\": \"muralik\"}}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: Content-Type: application/json\nheader: Vary: X-Auth-Token\nheader: Content-Length: 2158\nheader: Date: Wed, 04 Jul 2012 11:20:44 GMT\nconnect: (10.233.52.237, 8776)\nsend: u'POST /v1/b7dfbec65e69454b823cdbb78737f629/snapshots HTTP/1.1\\r\\nHost: 10.233.52.237:8776\\r\\nContent-Length: 136\\r\\nx-auth-project-id: demo\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nx-auth-token: a222bcf66c7543e99dbf977bd57c83f8\\r\\nuser-agent: python-novaclient\\r\\ncontent-type: application/json\\r\\n\\r\\n{\"snapshot\": {\"display_name\": \"test\", \"force\": false, \"display_description\": null, \"volume_id\": \"ef911f29-764f-449e-b7f0-6cc2052a6d1a\"}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: X-Compute-Request-Id: req-764dfd27-7670-4646-8d30-7c0b1f44b995\nheader: Content-Type: application/json\nheader: Content-Length: 243\nheader: Date: Wed, 04 Jul 2012 11:20:47 GMT\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova volume-snapshot-list\n+--------------------------------------+--------------------------------------+-----------+------------------------+------+\n| ID                                   | Volume ID                            | Status    | Display Name           | Size |\n+--------------------------------------+--------------------------------------+-----------+------------------------+------+\n| 447dae19-106d-4bdb-a42b-fef4014a052b | ef911f29-764f-449e-b7f0-6cc2052a6d1a | available | test                   | 1    |\n| 58274e07-19c7-4949-ac84-1c7ab7cace44 | 1f7a9697-ba0b-4de7-9ed0-cae2c5a043b9 | available | VolumeSnap-39898493105 | 1    |\n+--------------------------------------+--------------------------------------+-----------+------------------------+------+\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova --debug volume-delete ef911f29-764f-449e-b7f0-6cc2052a6d1a\nconnect: (127.0.0.1, 5000)\nsend: 'POST /v2.0/tokens HTTP/1.1\\r\\nHost: 127.0.0.1:5000\\r\\nContent-Length: 100\\r\\ncontent-type: application/json\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n{\"auth\": {\"tenantName\": \"demo\", \"passwordCredentials\": {\"username\": \"demo\", \"password\": \"muralik\"}}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: Content-Type: application/json\nheader: Vary: X-Auth-Token\nheader: Content-Length: 2158\nheader: Date: Wed, 04 Jul 2012 11:21:14 GMT\nconnect: (10.233.52.237, 8776)\nsend: u'GET /v1/b7dfbec65e69454b823cdbb78737f629/volumes/ef911f29-764f-449e-b7f0-6cc2052a6d1a HTTP/1.1\\r\\nHost: 10.233.52.237:8776\\r\\nx-auth-project-id: demo\\r\\nx-auth-token: f7a7296e264e4098a827cb03b3435c4d\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: X-Compute-Request-Id: req-87886ca3-f697-47d7-bad2-d26262d23b51\nheader: Content-Type: application/json\nheader: Content-Length: 290\nheader: Date: Wed, 04 Jul 2012 11:21:14 GMT\nsend: u'DELETE /v1/b7dfbec65e69454b823cdbb78737f629/volumes/ef911f29-764f-449e-b7f0-6cc2052a6d1a HTTP/1.1\\r\\nHost: 10.233.52.237:8776\\r\\nx-auth-project-id: demo\\r\\nx-auth-token: f7a7296e264e4098a827cb03b3435c4d\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n'\nreply: 'HTTP/1.1 400 \\r\\n'\nheader: Content-Length: 98\nheader: Content-Type: application/json; charset=UTF-8\nheader: X-Compute-Request-Id: req-e34e2858-e61a-45ce-9d14-a827d0d901ff\nheader: Date: Wed, 04 Jul 2012 11:21:14 GMT\nDEBUG (shell:459) Invalid volume: Volume still has 1 dependent snapshots (HTTP 400) (Request-ID: req-e34e2858-e61a-45ce-9d14-a827d0d901ff)\nTraceback (most recent call last):\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 456, in main\n    OpenStackComputeShell().main(sys.argv[1:])\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 392, in main\n    args.func(self.cs, args)\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/shell.py\", line 940, in do_volume_delete\n    volume.delete()\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/volumes.py\", line 34, in delete\n    self.manager.delete(self)\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/volumes.py\", line 89, in delete\n    self._delete(\"/volumes/%s\" % base.getid(volume))\n  File \"/opt/stack/python-novaclient/novaclient/base.py\", line 158, in _delete\n    resp, body = self.api.client.delete(url)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 160, in delete\n    return self._cs_request(url, 'DELETE', **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 139, in _cs_request\n    **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 121, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 115, in request\n    raise exceptions.from_response(resp, body)\nBadRequest: Invalid volume: Volume still has 1 dependent snapshots (HTTP 400) (Request-ID: req-e34e2858-e61a-45ce-9d14-a827d0d901ff)\nERROR: Invalid volume: Volume still has 1 dependent snapshots (HTTP 400) (Request-ID: req-e34e2858-e61a-45ce-9d14-a827d0d901ff)\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$", 
    "tags": [
        "volume"
    ], 
    "importance": "Undecided", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/1020816", 
    "owner": "None", 
    "id": 1020816, 
    "index": 4186, 
    "openned": "2012-07-04 06:05:34.524394+00:00", 
    "created": "2012-07-04 06:05:34.524394+00:00", 
    "title": "Deletion of Volume when corresponding Volume Snapshot exists, is throwing 'Bad Request Exception'", 
    "comments": [
        {
            "content": "Description: \n\nDeletion of Volume when corresponding Volume Snapshot exists, is throwing 'Bad Request Exception'. As Volume and Volume Snapshot are two independant entities once volume Snapshotting is completed, We do not expect Volume Snapshot to be dependant on Volume i.e, deletion of Volume should not be restricted when its Snapshot exists.\n\nSteps to Reproduce:\n\n1. Create a Volume 'V'.\n2. Wait till it reaches 'available' state.\n3. Create a Volume Snapshot 'VS' using the volume ID of 'V'.\n4. Wait till Volume Snapshot reaches 'available' state.\n5. Delete Volume'V'.\n\nExpected Result:\nVolume Should be deleted and responce code 200 should be returned.\n\nActual Result:\n'Bad Request' Exception is raised and 400 code is returned, saying \" ERROR: Invalid volume: Volume still has 1 dependent snapshots (HTTP 400)\"\n\nLOG:\n\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova --debug volume-create 1 --display_name test\nconnect: (127.0.0.1, 5000)\nsend: 'POST /v2.0/tokens HTTP/1.1\\r\\nHost: 127.0.0.1:5000\\r\\nContent-Length: 100\\r\\ncontent-type: application/json\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n{\"auth\": {\"tenantName\": \"demo\", \"passwordCredentials\": {\"username\": \"demo\", \"password\": \"muralik\"}}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: Content-Type: application/json\nheader: Vary: X-Auth-Token\nheader: Content-Length: 2158\nheader: Date: Wed, 04 Jul 2012 11:19:48 GMT\nconnect: (10.233.52.237, 8776)\nsend: u'POST /v1/b7dfbec65e69454b823cdbb78737f629/volumes HTTP/1.1\\r\\nHost: 10.233.52.237:8776\\r\\nContent-Length: 118\\r\\nx-auth-project-id: demo\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nx-auth-token: 5e94c311eba74e04bec816c487fd5102\\r\\nuser-agent: python-novaclient\\r\\ncontent-type: application/json\\r\\n\\r\\n{\"volume\": {\"snapshot_id\": null, \"display_name\": \"test\", \"volume_type\": null, \"display_description\": null, \"size\": 1}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: X-Compute-Request-Id: req-5efa112e-b1e3-4aae-95bd-8d6ad71e8a96\nheader: Content-Type: application/json\nheader: Content-Length: 296\nheader: Date: Wed, 04 Jul 2012 11:19:48 GMT\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova volume-list\n+--------------------------------------+-----------+--------------------+------+-------------+-------------+\n| ID                                   | Status    | Display Name       | Size | Volume Type | Attached to |\n+--------------------------------------+-----------+--------------------+------+-------------+-------------+\n| 1f7a9697-ba0b-4de7-9ed0-cae2c5a043b9 | available | Volume-86145667609 | 1    | None        |             |\n| ef911f29-764f-449e-b7f0-6cc2052a6d1a | available | test               | 1    | None        |             |\n+--------------------------------------+-----------+--------------------+------+-------------+-------------+\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova --debug volume-snapshot-create ef911f29-764f-449e-b7f0-6cc2052a6d1a --display_name test\nconnect: (127.0.0.1, 5000)\nsend: 'POST /v2.0/tokens HTTP/1.1\\r\\nHost: 127.0.0.1:5000\\r\\nContent-Length: 100\\r\\ncontent-type: application/json\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n{\"auth\": {\"tenantName\": \"demo\", \"passwordCredentials\": {\"username\": \"demo\", \"password\": \"muralik\"}}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: Content-Type: application/json\nheader: Vary: X-Auth-Token\nheader: Content-Length: 2158\nheader: Date: Wed, 04 Jul 2012 11:20:44 GMT\nconnect: (10.233.52.237, 8776)\nsend: u'POST /v1/b7dfbec65e69454b823cdbb78737f629/snapshots HTTP/1.1\\r\\nHost: 10.233.52.237:8776\\r\\nContent-Length: 136\\r\\nx-auth-project-id: demo\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nx-auth-token: a222bcf66c7543e99dbf977bd57c83f8\\r\\nuser-agent: python-novaclient\\r\\ncontent-type: application/json\\r\\n\\r\\n{\"snapshot\": {\"display_name\": \"test\", \"force\": false, \"display_description\": null, \"volume_id\": \"ef911f29-764f-449e-b7f0-6cc2052a6d1a\"}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: X-Compute-Request-Id: req-764dfd27-7670-4646-8d30-7c0b1f44b995\nheader: Content-Type: application/json\nheader: Content-Length: 243\nheader: Date: Wed, 04 Jul 2012 11:20:47 GMT\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova volume-snapshot-list\n+--------------------------------------+--------------------------------------+-----------+------------------------+------+\n| ID                                   | Volume ID                            | Status    | Display Name           | Size |\n+--------------------------------------+--------------------------------------+-----------+------------------------+------+\n| 447dae19-106d-4bdb-a42b-fef4014a052b | ef911f29-764f-449e-b7f0-6cc2052a6d1a | available | test                   | 1    |\n| 58274e07-19c7-4949-ac84-1c7ab7cace44 | 1f7a9697-ba0b-4de7-9ed0-cae2c5a043b9 | available | VolumeSnap-39898493105 | 1    |\n+--------------------------------------+--------------------------------------+-----------+------------------------+------+\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$ nova --debug volume-delete ef911f29-764f-449e-b7f0-6cc2052a6d1a\nconnect: (127.0.0.1, 5000)\nsend: 'POST /v2.0/tokens HTTP/1.1\\r\\nHost: 127.0.0.1:5000\\r\\nContent-Length: 100\\r\\ncontent-type: application/json\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n{\"auth\": {\"tenantName\": \"demo\", \"passwordCredentials\": {\"username\": \"demo\", \"password\": \"muralik\"}}}'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: Content-Type: application/json\nheader: Vary: X-Auth-Token\nheader: Content-Length: 2158\nheader: Date: Wed, 04 Jul 2012 11:21:14 GMT\nconnect: (10.233.52.237, 8776)\nsend: u'GET /v1/b7dfbec65e69454b823cdbb78737f629/volumes/ef911f29-764f-449e-b7f0-6cc2052a6d1a HTTP/1.1\\r\\nHost: 10.233.52.237:8776\\r\\nx-auth-project-id: demo\\r\\nx-auth-token: f7a7296e264e4098a827cb03b3435c4d\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n'\nreply: 'HTTP/1.1 200 OK\\r\\n'\nheader: X-Compute-Request-Id: req-87886ca3-f697-47d7-bad2-d26262d23b51\nheader: Content-Type: application/json\nheader: Content-Length: 290\nheader: Date: Wed, 04 Jul 2012 11:21:14 GMT\nsend: u'DELETE /v1/b7dfbec65e69454b823cdbb78737f629/volumes/ef911f29-764f-449e-b7f0-6cc2052a6d1a HTTP/1.1\\r\\nHost: 10.233.52.237:8776\\r\\nx-auth-project-id: demo\\r\\nx-auth-token: f7a7296e264e4098a827cb03b3435c4d\\r\\naccept-encoding: gzip, deflate\\r\\naccept: application/json\\r\\nuser-agent: python-novaclient\\r\\n\\r\\n'\nreply: 'HTTP/1.1 400 \\r\\n'\nheader: Content-Length: 98\nheader: Content-Type: application/json; charset=UTF-8\nheader: X-Compute-Request-Id: req-e34e2858-e61a-45ce-9d14-a827d0d901ff\nheader: Date: Wed, 04 Jul 2012 11:21:14 GMT\nDEBUG (shell:459) Invalid volume: Volume still has 1 dependent snapshots (HTTP 400) (Request-ID: req-e34e2858-e61a-45ce-9d14-a827d0d901ff)\nTraceback (most recent call last):\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 456, in main\n    OpenStackComputeShell().main(sys.argv[1:])\n  File \"/opt/stack/python-novaclient/novaclient/shell.py\", line 392, in main\n    args.func(self.cs, args)\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/shell.py\", line 940, in do_volume_delete\n    volume.delete()\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/volumes.py\", line 34, in delete\n    self.manager.delete(self)\n  File \"/opt/stack/python-novaclient/novaclient/v1_1/volumes.py\", line 89, in delete\n    self._delete(\"/volumes/%s\" % base.getid(volume))\n  File \"/opt/stack/python-novaclient/novaclient/base.py\", line 158, in _delete\n    resp, body = self.api.client.delete(url)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 160, in delete\n    return self._cs_request(url, 'DELETE', **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 139, in _cs_request\n    **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 121, in _time_request\n    resp, body = self.request(url, method, **kwargs)\n  File \"/opt/stack/python-novaclient/novaclient/client.py\", line 115, in request\n    raise exceptions.from_response(resp, body)\nBadRequest: Invalid volume: Volume still has 1 dependent snapshots (HTTP 400) (Request-ID: req-e34e2858-e61a-45ce-9d14-a827d0d901ff)\nERROR: Invalid volume: Volume still has 1 dependent snapshots (HTTP 400) (Request-ID: req-e34e2858-e61a-45ce-9d14-a827d0d901ff)\nmuralik@ubuntu:~/tempest_raj/tempest_3july/tempest/tempest/tests/compute$", 
            "date_created": "2012-07-04 06:05:34.524394+00:00", 
            "author": "https://api.launchpad.net/1.0/~rajalakshmi-ganesan"
        }, 
        {
            "content": "Because LVM volume snapshot dependant on source volume, so ....", 
            "date_created": "2012-07-05 08:08:46.589351+00:00", 
            "author": "https://api.launchpad.net/1.0/~zrzhit"
        }, 
        {
            "content": "Looks like this is the expected behaviour\n\nSee also bug #968700", 
            "date_created": "2012-07-18 14:12:11.809240+00:00", 
            "author": "https://api.launchpad.net/1.0/~markmc"
        }
    ], 
    "closed": "2012-07-18 14:12:19.839873+00:00"
}