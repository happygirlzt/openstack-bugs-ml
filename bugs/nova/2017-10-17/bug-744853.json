{
    "status": "Invalid", 
    "last_updated": "2011-08-11 23:16:40.016080+00:00", 
    "description": "(Nova version 2011.1) When I use a SQLite database, all is good and I'm able to manage instances with euca-xxx commands.\nBut when I try to use a MySQL database, all euca-xxx commands respond:\n    Warning: failed to parse error message from AWS: <unknown>:1:0: syntax error\n    EC2ResponseError: 403 Forbidden\n    403 Forbidden\n    Access was denied to this resource.\n\nThe problem doesn't comes from the novarc file because Nova works well when I use a SQlite database.\n\n[root]# cat novarc\n    NOVA_KEY_DIR=$(pushd $(dirname $BASH_SOURCE)>/dev/null; pwd; popd>/dev/null)\n    export EC2_ACCESS_KEY=\"9b71a6f8-817f-48c1-94ea-2e330ec34f2d:admin\"\n    export EC2_SECRET_KEY=\"eb726d1c-0e4a-41a9-8439-a4381b341967\"\n    export EC2_URL=\"http://172.31.70.21:8773/services/Cloud\"\n    export S3_URL=\"http://172.31.70.21:3333\"\n    export EC2_USER_ID=42 # nova does not use user id, but bundling requires it\n    export EC2_PRIVATE_KEY=${NOVA_KEY_DIR}/pk.pem\n    export EC2_CERT=${NOVA_KEY_DIR}/cert.pem\n    export NOVA_CERT=${NOVA_KEY_DIR}/cacert.pem\n    export EUCALYPTUS_CERT=${NOVA_CERT} # euca-bundle-image seems to require this set\n    alias ec2-bundle-image=\"ec2-bundle-image --cert ${EC2_CERT} --privatekey ${EC2_PRIVATE_KEY} --user 42 --ec2cert ${NOVA_CERT}\"\n    alias ec2-upload-bundle=\"ec2-upload-bundle -a ${EC2_ACCESS_KEY} -s ${EC2_SECRET_KEY} --url ${S3_URL} --ec2cert ${NOVA_CERT}\"\n    export CLOUD_SERVERS_API_KEY=\"9b71a6f8-817f-48c1-94ea-2e330ec34f2d\"\n    export CLOUD_SERVERS_USERNAME=\"admin\"\n    export CLOUD_SERVERS_URL=\"http://172.31.70.21:8774/v1.0/\"\n\n[root]# cat bin/nova.conf \n    --verbose\n    --nodeamon\n    --cc_host=172.31.70.21\n    --s3_host=172.31.70.21\n    --rabbit_host=172.31.70.21\n    --ec2_url=http://172.31.70.21:8773/services/Cloud\n    --sql_connection=mysql://root:xxxx@172.31.70.21/nova\n    --routing_source_ip=172.31.70.21\n    --auth_driver=nova.auth.dbdriver.DbDriver\n    --libvirt_type=kvm\n    --network_manager=nova.network.manager.FlatManager\n    --fixed_range=192.168.122.0/8\n    --flat_network_bridge=virbr0\n    --network_size=200\n\n[root]# tail api.log\n    2011-03-29 11:24:09,661 DEBUG nova.auth.manager [-] Looking up user: '9b71a6f8-817f-48c1-94ea-2e330ec34f2d' from MainProcess (pid=1371) authenticate /data/OpenStackNova/nova/auth/manager.py:259\n    2011-03-29 11:24:09,661 DEBUG nova.auth.manager [-] Looking up user: '9b71a6f8-817f-48c1-94ea-2e330ec34f2d' from MainProcess (pid=1371) authenticate /data/OpenStackNova/nova/auth/manager.py:259\n    2011-03-29 11:24:09,663 AUDIT nova.api [-] Authentication Failure: No user for access key 9b71a6f8-817f-48c1-94ea-2e330ec34f2d\n    2011-03-29 11:24:09,663 AUDIT nova.api [-] Authentication Failure: No user for access key 9b71a6f8-817f-48c1-94ea-2e330ec34f2d\n    2011-03-29 11:24:09,664 INFO nova.api [-] X.Xs 172.31.70.21 GET / None:None 403 [Boto/1.9b (linux2)] text/plain text/html\n    2011-03-29 11:24:09,664 INFO nova.api [-] X.Xs 172.31.70.21 GET / None:None 403 [Boto/1.9b (linux2)] text/plain text/html\n\nIn the api.log file, you can see\n     No user for access key 9b71a6f8-817f-48c1-94ea-2e330ec34f2d\nbut this access_key exists in my MySQL database as reported below:\n\n[root]# mysql -pxxxx nova\nmysql> select id,name,access_key from users;\n+-------+------+--------------------------------------+\n| id    | name | access_key                           |\n+-------+------+--------------------------------------+\n| admin | NULL | 9b71a6f8-817f-48c1-94ea-2e330ec34f2d |\n+-------+------+--------------------------------------+", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/744853", 
    "owner": "None", 
    "id": 744853, 
    "index": 3358, 
    "openned": "2011-03-29 09:24:24.757781+00:00", 
    "created": "2011-03-29 09:24:24.757781+00:00", 
    "title": "euca-xxx commands : EC2ResponseError: 403 Forbidden", 
    "comments": [
        {
            "content": "(Nova version 2011.1) When I use a SQLite database, all is good and I'm able to manage instances with euca-xxx commands.\nBut when I try to use a MySQL database, all euca-xxx commands respond:\n    Warning: failed to parse error message from AWS: <unknown>:1:0: syntax error\n    EC2ResponseError: 403 Forbidden\n    403 Forbidden\n    Access was denied to this resource.\n\nThe problem doesn't comes from the novarc file because Nova works well when I use a SQlite database.\n\n[root]# cat novarc\n    NOVA_KEY_DIR=$(pushd $(dirname $BASH_SOURCE)>/dev/null; pwd; popd>/dev/null)\n    export EC2_ACCESS_KEY=\"9b71a6f8-817f-48c1-94ea-2e330ec34f2d:admin\"\n    export EC2_SECRET_KEY=\"eb726d1c-0e4a-41a9-8439-a4381b341967\"\n    export EC2_URL=\"http://172.31.70.21:8773/services/Cloud\"\n    export S3_URL=\"http://172.31.70.21:3333\"\n    export EC2_USER_ID=42 # nova does not use user id, but bundling requires it\n    export EC2_PRIVATE_KEY=${NOVA_KEY_DIR}/pk.pem\n    export EC2_CERT=${NOVA_KEY_DIR}/cert.pem\n    export NOVA_CERT=${NOVA_KEY_DIR}/cacert.pem\n    export EUCALYPTUS_CERT=${NOVA_CERT} # euca-bundle-image seems to require this set\n    alias ec2-bundle-image=\"ec2-bundle-image --cert ${EC2_CERT} --privatekey ${EC2_PRIVATE_KEY} --user 42 --ec2cert ${NOVA_CERT}\"\n    alias ec2-upload-bundle=\"ec2-upload-bundle -a ${EC2_ACCESS_KEY} -s ${EC2_SECRET_KEY} --url ${S3_URL} --ec2cert ${NOVA_CERT}\"\n    export CLOUD_SERVERS_API_KEY=\"9b71a6f8-817f-48c1-94ea-2e330ec34f2d\"\n    export CLOUD_SERVERS_USERNAME=\"admin\"\n    export CLOUD_SERVERS_URL=\"http://172.31.70.21:8774/v1.0/\"\n\n[root]# cat bin/nova.conf \n    --verbose\n    --nodeamon\n    --cc_host=172.31.70.21\n    --s3_host=172.31.70.21\n    --rabbit_host=172.31.70.21\n    --ec2_url=http://172.31.70.21:8773/services/Cloud\n    --sql_connection=mysql://root:xxxx@172.31.70.21/nova\n    --routing_source_ip=172.31.70.21\n    --auth_driver=nova.auth.dbdriver.DbDriver\n    --libvirt_type=kvm\n    --network_manager=nova.network.manager.FlatManager\n    --fixed_range=192.168.122.0/8\n    --flat_network_bridge=virbr0\n    --network_size=200\n\n[root]# tail api.log\n    2011-03-29 11:24:09,661 DEBUG nova.auth.manager [-] Looking up user: '9b71a6f8-817f-48c1-94ea-2e330ec34f2d' from MainProcess (pid=1371) authenticate /data/OpenStackNova/nova/auth/manager.py:259\n    2011-03-29 11:24:09,661 DEBUG nova.auth.manager [-] Looking up user: '9b71a6f8-817f-48c1-94ea-2e330ec34f2d' from MainProcess (pid=1371) authenticate /data/OpenStackNova/nova/auth/manager.py:259\n    2011-03-29 11:24:09,663 AUDIT nova.api [-] Authentication Failure: No user for access key 9b71a6f8-817f-48c1-94ea-2e330ec34f2d\n    2011-03-29 11:24:09,663 AUDIT nova.api [-] Authentication Failure: No user for access key 9b71a6f8-817f-48c1-94ea-2e330ec34f2d\n    2011-03-29 11:24:09,664 INFO nova.api [-] X.Xs 172.31.70.21 GET / None:None 403 [Boto/1.9b (linux2)] text/plain text/html\n    2011-03-29 11:24:09,664 INFO nova.api [-] X.Xs 172.31.70.21 GET / None:None 403 [Boto/1.9b (linux2)] text/plain text/html\n\nIn the api.log file, you can see\n     No user for access key 9b71a6f8-817f-48c1-94ea-2e330ec34f2d\nbut this access_key exists in my MySQL database as reported below:\n\n[root]# mysql -pxxxx nova\nmysql> select id,name,access_key from users;\n+-------+------+--------------------------------------+\n| id    | name | access_key                           |\n+-------+------+--------------------------------------+\n| admin | NULL | 9b71a6f8-817f-48c1-94ea-2e330ec34f2d |\n+-------+------+--------------------------------------+", 
            "date_created": "2011-03-29 09:24:24.757781+00:00", 
            "author": "https://api.launchpad.net/1.0/~philippe-berthault-deactivatedaccount"
        }, 
        {
            "content": "Hmm, that should work... Looks like MySQL is not even queried ? Could you enable tracing on the MySQL side to make sure you receive a request, and see why that request would fail ?", 
            "date_created": "2011-03-30 08:46:45.039701+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "You're right. Nothing in logs for me. Mysql is not queried.", 
            "date_created": "2011-04-01 20:17:10.077282+00:00", 
            "author": "https://api.launchpad.net/1.0/~jguermonprez"
        }, 
        {
            "content": "So your nova.conf is apparently ignored. How do you start the nova-* components ? At first glance bin/nova.conf sounds like a bad location for nova.conf.", 
            "date_created": "2011-04-04 09:47:12.838752+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Le 04/04/2011 11:47, Thierry Carrez a \u00e9crit :\n> So your nova.conf is apparently ignored. How do you start the nova-*\n> components ? At first glance bin/nova.conf sounds like a bad location\n> for nova.conf.\n>\n>    \n\nI start manually nova-xxx components from the directory where is \ninstalled nova.\n\n         [root]# cd nova\n         [root]# nova-api --logfile=api.log 2>/dev/null &\n         [root]# nova-objectstore --logfile=objectstore.log 2>/dev/null &\n         [root]# nova-compute --logfile=compute.log 2>/dev/null &\n         [root]# nova-network --logfile=network.log 2>/dev/null &\n         [root]# nova-scheduler --logfile=scheduler.log 2>/dev/null &\n\nThe nova/bin directory is in my PATH so I have no need to specify the \npath of nova-xxx commands.\n\n", 
            "date_created": "2011-04-04 10:18:29+00:00", 
            "author": "https://api.launchpad.net/1.0/~philippe-berthault-deactivatedaccount"
        }, 
        {
            "content": "You should probably specify the \"--flagfile=/path/to/nova.conf\" argument as well, otherwise I suspect it's not finding it (which would explain why your sql_connection argument is ignored)", 
            "date_created": "2011-04-04 11:56:57.732982+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Problem seems to be solved for us :\nApparently there was no project associated with the current user because his project had been created before that the mysql database was up and running. \nAfter having recreate the project, generate the zipfile and source the novarc file,we were able to use the euca-xxx commands without errors.\n", 
            "date_created": "2011-04-04 12:03:20.545886+00:00", 
            "author": "https://api.launchpad.net/1.0/~jguermonprez"
        }, 
        {
            "content": "Thank you very much.\n\nIt's OK with the --flagfile option.\n\n\nLe 04/04/2011 13:56, Thierry Carrez a \u00e9crit :\n> You should probably specify the \"--flagfile=/path/to/nova.conf\" argument\n> as well, otherwise I suspect it's not finding it (which would explain\n> why your sql_connection argument is ignored)\n>\n>    \n\n", 
            "date_created": "2011-04-04 12:47:56+00:00", 
            "author": "https://api.launchpad.net/1.0/~philippe-berthault-deactivatedaccount"
        }
    ], 
    "closed": "2011-04-04 12:25:41.261687+00:00"
}