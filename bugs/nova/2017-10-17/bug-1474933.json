{
    "status": "Invalid", 
    "last_updated": "2015-07-27 19:56:45.895682+00:00", 
    "description": "Using the kilo rpms - openstack-nova-compute-2015.1.0-3.el7.noarch\n\nIf the rabbit_password (set in [Default] section - this is how the Ansible role I am using sets it) includes a slash character - \"/\" - then the service fails to start.\n\nIn the log - /var/log/nova/nova-compute.log\nthe following error is seen:-\n\nCRITICAL nova [req-72c0fe29-f2d6-4164-95de-e9e8f50fa7bc - - - - -] ValueError: invalid literal for int() with base 10: 'prefix'\n\nwhere prefix is the first part of the password - ie\n  rabbit_password = 'prefix/suffix'\n\nTraceback enclosed below.\n\nIf the Rabbit password is changed to not include a / then the service starts up OK\n\nThis could have security implications, but I am not currently flagging it as a security issue....\n\n2015-07-15 16:28:50.824 9670 TRACE nova Traceback (most recent call last):\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/bin/nova-compute\", line 10, in <module>\n2015-07-15 16:28:50.824 9670 TRACE nova     sys.exit(main())\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/cmd/compute.py\", line 72, in main\n2015-07-15 16:28:50.824 9670 TRACE nova     db_allowed=CONF.conductor.use_local)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 277, in create\n2015-07-15 16:28:50.824 9670 TRACE nova     db_allowed=db_allowed)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 157, in __init__\n2015-07-15 16:28:50.824 9670 TRACE nova     self.conductor_api.wait_until_ready(context.get_admin_context())\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/conductor/api.py\", line 292, in wait_until_ready\n2015-07-15 16:28:50.824 9670 TRACE nova     timeout=timeout)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/baserpc.py\", line 62, in ping\n2015-07-15 16:28:50.824 9670 TRACE nova     return cctxt.call(context, 'ping', arg=arg_p)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-07-15 16:28:50.824 9670 TRACE nova     retry=self.retry)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-07-15 16:28:50.824 9670 TRACE nova     timeout=timeout, retry=retry)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 350, in send\n2015-07-15 16:28:50.824 9670 TRACE nova     retry=retry)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 312, in _send\n2015-07-15 16:28:50.824 9670 TRACE nova     msg.update({'_reply_q': self._get_reply_q()})\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 283, in _get_reply_q\n2015-07-15 16:28:50.824 9670 TRACE nova     conn = self._get_connection(rpc_amqp.PURPOSE_LISTEN)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 274, in _get_connection\n2015-07-15 16:28:50.824 9670 TRACE nova     purpose=purpose)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqp.py\", line 121, in __init__\n2015-07-15 16:28:50.824 9670 TRACE nova     self.connection = connection_pool.create(purpose)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqp.py\", line 93, in create\n2015-07-15 16:28:50.824 9670 TRACE nova     return self.connection_cls(self.conf, self.url, purpose)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/impl_rabbit.py\", line 664, in __init__\n2015-07-15 16:28:50.824 9670 TRACE nova     heartbeat=self.driver_conf.heartbeat_timeout_threshold)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/kombu/connection.py\", line 180, in __init__\n2015-07-15 16:28:50.824 9670 TRACE nova     params.update(parse_url(hostname))\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/kombu/utils/url.py\", line 34, in parse_url\n2015-07-15 16:28:50.824 9670 TRACE nova     scheme, host, port, user, password, path, query = _parse_url(url)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/kombu/utils/url.py\", line 22, in _parse_url\n2015-07-15 16:28:50.824 9670 TRACE nova     port = scheme != 'mongodb' and parts.port or None\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib64/python2.7/urlparse.py\", line 112, in port\n2015-07-15 16:28:50.824 9670 TRACE nova     port = int(port, 10)", 
    "tags": [
        "compute", 
        "configuration"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1474933", 
    "owner": "None", 
    "id": 1474933, 
    "index": 6917, 
    "openned": "2015-07-15 16:35:54.809310+00:00", 
    "created": "2015-07-15 16:35:54.809310+00:00", 
    "title": "Nova compute interprets rabbitmq passwords", 
    "comments": [
        {
            "content": "Using the kilo rpms - openstack-nova-compute-2015.1.0-3.el7.noarch\n\nIf the rabbit_password (set in [Default] section - this is how the Ansible role I am using sets it) includes a slash character - \"/\" - then the service fails to start.\n\nIn the log - /var/log/nova/nova-compute.log\nthe following error is seen:-\n\nCRITICAL nova [req-72c0fe29-f2d6-4164-95de-e9e8f50fa7bc - - - - -] ValueError: invalid literal for int() with base 10: 'prefix'\n\nwhere prefix is the first part of the password - ie\n  rabbit_password = 'prefix/suffix'\n\nTraceback enclosed below.\n\nIf the Rabbit password is changed to not include a / then the service starts up OK\n\nThis could have security implications, but I am not currently flagging it as a security issue....\n\n2015-07-15 16:28:50.824 9670 TRACE nova Traceback (most recent call last):\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/bin/nova-compute\", line 10, in <module>\n2015-07-15 16:28:50.824 9670 TRACE nova     sys.exit(main())\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/cmd/compute.py\", line 72, in main\n2015-07-15 16:28:50.824 9670 TRACE nova     db_allowed=CONF.conductor.use_local)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 277, in create\n2015-07-15 16:28:50.824 9670 TRACE nova     db_allowed=db_allowed)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/service.py\", line 157, in __init__\n2015-07-15 16:28:50.824 9670 TRACE nova     self.conductor_api.wait_until_ready(context.get_admin_context())\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/conductor/api.py\", line 292, in wait_until_ready\n2015-07-15 16:28:50.824 9670 TRACE nova     timeout=timeout)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/nova/baserpc.py\", line 62, in ping\n2015-07-15 16:28:50.824 9670 TRACE nova     return cctxt.call(context, 'ping', arg=arg_p)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py\", line 156, in call\n2015-07-15 16:28:50.824 9670 TRACE nova     retry=self.retry)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py\", line 90, in _send\n2015-07-15 16:28:50.824 9670 TRACE nova     timeout=timeout, retry=retry)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 350, in send\n2015-07-15 16:28:50.824 9670 TRACE nova     retry=retry)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 312, in _send\n2015-07-15 16:28:50.824 9670 TRACE nova     msg.update({'_reply_q': self._get_reply_q()})\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 283, in _get_reply_q\n2015-07-15 16:28:50.824 9670 TRACE nova     conn = self._get_connection(rpc_amqp.PURPOSE_LISTEN)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 274, in _get_connection\n2015-07-15 16:28:50.824 9670 TRACE nova     purpose=purpose)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqp.py\", line 121, in __init__\n2015-07-15 16:28:50.824 9670 TRACE nova     self.connection = connection_pool.create(purpose)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqp.py\", line 93, in create\n2015-07-15 16:28:50.824 9670 TRACE nova     return self.connection_cls(self.conf, self.url, purpose)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/impl_rabbit.py\", line 664, in __init__\n2015-07-15 16:28:50.824 9670 TRACE nova     heartbeat=self.driver_conf.heartbeat_timeout_threshold)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/kombu/connection.py\", line 180, in __init__\n2015-07-15 16:28:50.824 9670 TRACE nova     params.update(parse_url(hostname))\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/kombu/utils/url.py\", line 34, in parse_url\n2015-07-15 16:28:50.824 9670 TRACE nova     scheme, host, port, user, password, path, query = _parse_url(url)\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib/python2.7/site-packages/kombu/utils/url.py\", line 22, in _parse_url\n2015-07-15 16:28:50.824 9670 TRACE nova     port = scheme != 'mongodb' and parts.port or None\n2015-07-15 16:28:50.824 9670 TRACE nova   File \"/usr/lib64/python2.7/urlparse.py\", line 112, in port\n2015-07-15 16:28:50.824 9670 TRACE nova     port = int(port, 10)", 
            "date_created": "2015-07-15 16:35:54.809310+00:00", 
            "author": "https://api.launchpad.net/1.0/~nigel-r"
        }, 
        {
            "content": "Any idea why there's a mongodb in your trace? Can you please post more of your nova.conf?", 
            "date_created": "2015-07-16 01:40:58.571908+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "No idea where mongodb comes into it - not using it anywhere in this test bed.  However the context in the trace looks as though there is a decision being made based on whether nova is using it, rather than actually involving mongodb.\n\nI have attached the complete nova.conf other than the passwords (which were generated using openssl rand -base64 15 ) \n\nThis is a fresh installation of Openstack kilo done for learning purposes onto a freshish Centos 7 install.  The other components are on VMware VMs, this is on a physical blade.  Deployment is being done using the ansible roles available at https://github.com/dguerri\n\nThe nova compute config is simply\n\n[libvirt]\nvirt_type = kvm\n", 
            "date_created": "2015-07-16 10:31:14.110419+00:00", 
            "author": "https://api.launchpad.net/1.0/~nigel-r"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/203309", 
            "date_created": "2015-07-18 02:31:17.562868+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Should have marked invalid only in Nova as the correct fix is in oslo.messaging", 
            "date_created": "2015-07-18 02:31:54.402363+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "https://review.openstack.org/203309", 
            "date_created": "2015-07-18 02:32:00.673716+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/203309\nCommitted: https://git.openstack.org/cgit/openstack/oslo.messaging/commit/?id=adcd0807d66ef58649d245a3231738ed698fdeb2\nSubmitter: Jenkins\nBranch:    master\n\ncommit adcd0807d66ef58649d245a3231738ed698fdeb2\nAuthor: Davanum Srinivas <email address hidden>\nDate:   Fri Jul 17 22:25:48 2015 -0400\n\n    Allow a forward slash as a part of the user/password\n    \n    quote method has a safe parameter which is set to '/' so when\n    the end user has a / in the rabbit_password then we end up leaving\n    that in the url which ends up looking like:\n    \n    amqp://stackrabbit:pass/word@10.0.0.9:5672//\n    \n    Which is clearly invalid, so we should set safe parameter to '' which\n    allows the url to be constructed properly (see transport.py\n    TransportURL.__str__ method works this work)\n    \n    Closes-Bug: #1474933\n    Change-Id: I14fb54440d0925f3676e18d13182ed0fa9c34ca2\n", 
            "date_created": "2015-07-22 17:27:05.750161+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-07-18 02:31:26.655840+00:00"
}