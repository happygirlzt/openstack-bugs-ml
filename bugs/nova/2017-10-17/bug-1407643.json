{
    "status": "Expired", 
    "last_updated": "2016-07-05 09:56:01.211579+00:00", 
    "description": "https://blueprints.launchpad.net/nova/+spec/quota-instance-resource added a number of resource managment capabilites via extra_specs foe libvirt - but at least one of these causes VMs to fail on devstcak with Neutron (so I'm guessing that they aren't covered in Tempest ?)\n\n\nOn a devstack system with Neutron Networking:\n\nnova flavor-key m1.tiny set quota:vif_inbound_average=10240000\nubuntu@devstack-forced-shutdown:/mnt/devstack$ nova boot --image  02985e98-a163-4ce9-afb8-098c41c6573c --flavor 1 phil.limit\n +--------------------------------------+----------------------------------------------------------------+\n | Property                             | Value                                                          |\n +--------------------------------------+----------------------------------------------------------------+\n | OS-DCF:diskConfig                    | MANUAL                                                         |\n | OS-EXT-AZ:availability_zone          | nova                                                           |\n | OS-EXT-SRV-ATTR:host                 | -                                                              |\n | OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                              |\n | OS-EXT-SRV-ATTR:instance_name        | instance-00000003                                              |\n | OS-EXT-STS:power_state               | 0                                                              |\n | OS-EXT-STS:task_state                | scheduling                                                     |\n | OS-EXT-STS:vm_state                  | building                                                       |\n | OS-SRV-USG:launched_at               | -                                                              |\n | OS-SRV-USG:terminated_at             | -                                                              |\n | accessIPv4                           |                                                                |\n | accessIPv6                           |                                                                |\n | adminPass                            | 3SrCw22q8Prz                                                   |\n | config_drive                         |                                                                |\n | created                              | 2015-01-05T11:21:10Z                                           |\n | flavor                               | m1.tiny (1)                                                    |\n | hostId                               |                                                                |\n | id                                   | 72c953c8-9bd3-4e94-8fbb-db54f77509b7                           |\n | image                                | cirros-0.3.2-x86_64-uec (02985e98-a163-4ce9-afb8-098c41c6573c) |\n | key_name                             | -                                                              |\n | metadata                             | {}                                                             |\n | name                                 | phil.limit                                                     |\n | os-extended-volumes:volumes_attached | []                                                             |\n | progress                             | 0                                                              |\n | security_groups                      | default                                                        |\n | status                               | BUILD                                                          |\n | tenant_id                            | 0c1ece771f3f43958d010dfbfba52b83                               |\n | updated                              | 2015-01-05T11:21:10Z                                           |\n | user_id                              | b311b86b7fe2424e89508d1af73260ec                               |\n +--------------------------------------+----------------------------------------------------------------+\n\nubuntu@devstack-forced-shutdown:/mnt/devstack$ nova list \n +--------------------------------------+------------+--------+------------+-------------+-------------------+\n | ID                                   | Name       | Status | Task State | Power State | Networks          |\n +--------------------------------------+------------+--------+------------+-------------+-------------------+\n | 72c953c8-9bd3-4e94-8fbb-db54f77509b7 | phil.limit | ERROR  | -          | NOSTATE     | public=172.24.4.4 | \n +--------------------------------------+------------+--------+------------+-------------+-------------------+\n\nStack trace on nova-compute shows:\n\n2015-01-05 11:46:46.598 ERROR nova.virt.libvirt.driver [-] Error launching a defined domain with XML: <domain type='qemu'>\n  <name>instance-00000004</name>\n  <uuid>07fe9d59-cfe0-4937-b6c1-aead2cd2e23d</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"2015.1\"/>\n      <nova:name>phil.limit</nova:name>\n      <nova:creationTime>2015-01-05 11:46:43</nova:creationTime>\n      <nova:flavor name=\"m1.tiny\">\n        <nova:memory>512</nova:memory>\n        <nova:disk>1</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"b311b86b7fe2424e89508d1af73260ec\">admin</nova:user>\n        <nova:project uuid=\"0c1ece771f3f43958d010dfbfba52b83\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"02985e98-a163-4ce9-afb8-098c41c6573c\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>524288</memory>\n  <currentMemory unit='KiB'>524288</currentMemory>\n  <vcpu placement='static' cpuset='0-3'>1</vcpu>\n  <cputune>\n    <quota>10000</quota>\n  </cputune>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2015.1</entry>\n      <entry name='serial'>45537be9-b863-443c-955a-5f5df1744a17</entry>\n      <entry name='uuid'>07fe9d59-cfe0-4937-b6c1-aead2cd2e23d</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-trusty'>hvm</type>\n    <kernel>/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/kernel</kernel>\n    <initrd>/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/ramdisk</initrd>\n    <cmdline>root=/dev/vda console=tty0 console=ttyS0 no_timer_check</cmdline>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'/>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-system-x86_64</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/disk'/>\n      <target dev='vda' bus='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <controller type='ide' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:a6:d9:61'/>\n      <source bridge='qbr146d0450-48'/>\n      <bandwidth>\n        <inbound average='10240000'/>\n      </bandwidth>\n      <target dev='tap146d0450-48'/>\n      <model type='virtio'/>\n      <driver name='qemu'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/console.log'/>\n      <target port='0'/>\n    </serial>\n    <serial type='pty'>\n      <target port='1'/>\n    </serial>\n    <console type='file'>\n      <source path='/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/console.log'/>\n      <target type='serial' port='0'/>\n    </console>\n    <input type='mouse' bus='ps2'/>\n    <input type='keyboard' bus='ps2'/>\n    <graphics type='vnc' port='-1' autoport='yes' listen='127.0.0.1' keymap='en-us'>\n      <listen type='address' address='127.0.0.1'/>\n    </graphics>\n    <video>\n      <model type='cirrus' vram='9216' heads='1'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </video>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n      <stats period='10'/>\n    </memballoon>\n  </devices>\n</domain>\n\n2015-01-05 11:46:46.599 ERROR nova.compute.manager [-] [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] Instance failed to spawn\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] Traceback (most recent call last):\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/compute/manager.py\", line 2289, in _build_resources\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     yield resources\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/compute/manager.py\", line 2159, in _build_and_run_instance\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     flavor=flavor)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/virt/libvirt/driver.py\", line 2389, in spawn\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     block_device_info=block_device_info)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/virt/libvirt/driver.py\", line 4268, in _create_domain_and_network\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     power_on=power_on)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/virt/libvirt/driver.py\", line 4201, in _create_domain\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     LOG.error(err)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/oslo/utils/excutils.py\", line 82, in __exit__\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/virt/libvirt/driver.py\", line 4191, in _create_domain\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     domain.createWithFlags(launch_flags)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     rv = execute(f, *args, **kwargs)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     six.reraise(c, e, tb)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     rv = meth(*args, **kwargs)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] libvirtError: internal error: cannot set bandwidth limits on tap146d0450-48\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] \n2015-01-05 11:46:46.600 AUDIT nova.compute.manager [req-f4737d92-6989-462a-9767-d614b3114679 admin admin] [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] Terminating instance\n2015-01-05 11:46:46.613 INFO nova.virt.libvirt.driver [-] [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] Instance destroyed successfully.", 
    "tags": [
        "libvirt", 
        "quotas"
    ], 
    "importance": "Undecided", 
    "heat": 26, 
    "link": "https://bugs.launchpad.net/nova/+bug/1407643", 
    "owner": "None", 
    "id": 1407643, 
    "index": 6625, 
    "openned": "2015-01-05 12:03:48.887047+00:00", 
    "created": "2015-01-05 12:03:48.887047+00:00", 
    "title": "Setting network bandwidth quota in extra_specs causes a VM creation to fail in devstack", 
    "comments": [
        {
            "content": "https://blueprints.launchpad.net/nova/+spec/quota-instance-resource added a number of resource managment capabilites via extra_specs foe libvirt - but at least one of these causes VMs to fail on devstcak with Neutron (so I'm guessing that they aren't covered in Tempest ?)\n\n\nOn a devstack system with Neutron Networking:\n\nnova flavor-key m1.tiny set quota:vif_inbound_average=10240000\nubuntu@devstack-forced-shutdown:/mnt/devstack$ nova boot --image  02985e98-a163-4ce9-afb8-098c41c6573c --flavor 1 phil.limit\n +--------------------------------------+----------------------------------------------------------------+\n | Property                             | Value                                                          |\n +--------------------------------------+----------------------------------------------------------------+\n | OS-DCF:diskConfig                    | MANUAL                                                         |\n | OS-EXT-AZ:availability_zone          | nova                                                           |\n | OS-EXT-SRV-ATTR:host                 | -                                                              |\n | OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                              |\n | OS-EXT-SRV-ATTR:instance_name        | instance-00000003                                              |\n | OS-EXT-STS:power_state               | 0                                                              |\n | OS-EXT-STS:task_state                | scheduling                                                     |\n | OS-EXT-STS:vm_state                  | building                                                       |\n | OS-SRV-USG:launched_at               | -                                                              |\n | OS-SRV-USG:terminated_at             | -                                                              |\n | accessIPv4                           |                                                                |\n | accessIPv6                           |                                                                |\n | adminPass                            | 3SrCw22q8Prz                                                   |\n | config_drive                         |                                                                |\n | created                              | 2015-01-05T11:21:10Z                                           |\n | flavor                               | m1.tiny (1)                                                    |\n | hostId                               |                                                                |\n | id                                   | 72c953c8-9bd3-4e94-8fbb-db54f77509b7                           |\n | image                                | cirros-0.3.2-x86_64-uec (02985e98-a163-4ce9-afb8-098c41c6573c) |\n | key_name                             | -                                                              |\n | metadata                             | {}                                                             |\n | name                                 | phil.limit                                                     |\n | os-extended-volumes:volumes_attached | []                                                             |\n | progress                             | 0                                                              |\n | security_groups                      | default                                                        |\n | status                               | BUILD                                                          |\n | tenant_id                            | 0c1ece771f3f43958d010dfbfba52b83                               |\n | updated                              | 2015-01-05T11:21:10Z                                           |\n | user_id                              | b311b86b7fe2424e89508d1af73260ec                               |\n +--------------------------------------+----------------------------------------------------------------+\n\nubuntu@devstack-forced-shutdown:/mnt/devstack$ nova list \n +--------------------------------------+------------+--------+------------+-------------+-------------------+\n | ID                                   | Name       | Status | Task State | Power State | Networks          |\n +--------------------------------------+------------+--------+------------+-------------+-------------------+\n | 72c953c8-9bd3-4e94-8fbb-db54f77509b7 | phil.limit | ERROR  | -          | NOSTATE     | public=172.24.4.4 | \n +--------------------------------------+------------+--------+------------+-------------+-------------------+\n\nStack trace on nova-compute shows:\n\n2015-01-05 11:46:46.598 ERROR nova.virt.libvirt.driver [-] Error launching a defined domain with XML: <domain type='qemu'>\n  <name>instance-00000004</name>\n  <uuid>07fe9d59-cfe0-4937-b6c1-aead2cd2e23d</uuid>\n  <metadata>\n    <nova:instance xmlns:nova=\"http://openstack.org/xmlns/libvirt/nova/1.0\">\n      <nova:package version=\"2015.1\"/>\n      <nova:name>phil.limit</nova:name>\n      <nova:creationTime>2015-01-05 11:46:43</nova:creationTime>\n      <nova:flavor name=\"m1.tiny\">\n        <nova:memory>512</nova:memory>\n        <nova:disk>1</nova:disk>\n        <nova:swap>0</nova:swap>\n        <nova:ephemeral>0</nova:ephemeral>\n        <nova:vcpus>1</nova:vcpus>\n      </nova:flavor>\n      <nova:owner>\n        <nova:user uuid=\"b311b86b7fe2424e89508d1af73260ec\">admin</nova:user>\n        <nova:project uuid=\"0c1ece771f3f43958d010dfbfba52b83\">admin</nova:project>\n      </nova:owner>\n      <nova:root type=\"image\" uuid=\"02985e98-a163-4ce9-afb8-098c41c6573c\"/>\n    </nova:instance>\n  </metadata>\n  <memory unit='KiB'>524288</memory>\n  <currentMemory unit='KiB'>524288</currentMemory>\n  <vcpu placement='static' cpuset='0-3'>1</vcpu>\n  <cputune>\n    <quota>10000</quota>\n  </cputune>\n  <sysinfo type='smbios'>\n    <system>\n      <entry name='manufacturer'>OpenStack Foundation</entry>\n      <entry name='product'>OpenStack Nova</entry>\n      <entry name='version'>2015.1</entry>\n      <entry name='serial'>45537be9-b863-443c-955a-5f5df1744a17</entry>\n      <entry name='uuid'>07fe9d59-cfe0-4937-b6c1-aead2cd2e23d</entry>\n    </system>\n  </sysinfo>\n  <os>\n    <type arch='x86_64' machine='pc-i440fx-trusty'>hvm</type>\n    <kernel>/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/kernel</kernel>\n    <initrd>/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/ramdisk</initrd>\n    <cmdline>root=/dev/vda console=tty0 console=ttyS0 no_timer_check</cmdline>\n    <boot dev='hd'/>\n    <smbios mode='sysinfo'/>\n  </os>\n  <features>\n    <acpi/>\n    <apic/>\n  </features>\n  <cpu>\n    <topology sockets='1' cores='1' threads='1'/>\n  </cpu>\n  <clock offset='utc'/>\n  <on_poweroff>destroy</on_poweroff>\n  <on_reboot>restart</on_reboot>\n  <on_crash>destroy</on_crash>\n  <devices>\n    <emulator>/usr/bin/qemu-system-x86_64</emulator>\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='qcow2' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/disk'/>\n      <target dev='vda' bus='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n    <disk type='file' device='cdrom'>\n      <driver name='qemu' type='raw' cache='none'/>\n      <source file='/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/disk.config'/>\n      <target dev='hdd' bus='ide'/>\n      <readonly/>\n      <address type='drive' controller='0' bus='1' target='0' unit='1'/>\n    </disk>\n    <controller type='usb' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\n    </controller>\n    <controller type='pci' index='0' model='pci-root'/>\n    <controller type='ide' index='0'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>\n    </controller>\n    <interface type='bridge'>\n      <mac address='fa:16:3e:a6:d9:61'/>\n      <source bridge='qbr146d0450-48'/>\n      <bandwidth>\n        <inbound average='10240000'/>\n      </bandwidth>\n      <target dev='tap146d0450-48'/>\n      <model type='virtio'/>\n      <driver name='qemu'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n    <serial type='file'>\n      <source path='/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/console.log'/>\n      <target port='0'/>\n    </serial>\n    <serial type='pty'>\n      <target port='1'/>\n    </serial>\n    <console type='file'>\n      <source path='/opt/stack/data/nova/instances/07fe9d59-cfe0-4937-b6c1-aead2cd2e23d/console.log'/>\n      <target type='serial' port='0'/>\n    </console>\n    <input type='mouse' bus='ps2'/>\n    <input type='keyboard' bus='ps2'/>\n    <graphics type='vnc' port='-1' autoport='yes' listen='127.0.0.1' keymap='en-us'>\n      <listen type='address' address='127.0.0.1'/>\n    </graphics>\n    <video>\n      <model type='cirrus' vram='9216' heads='1'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n    </video>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n      <stats period='10'/>\n    </memballoon>\n  </devices>\n</domain>\n\n2015-01-05 11:46:46.599 ERROR nova.compute.manager [-] [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] Instance failed to spawn\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] Traceback (most recent call last):\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/compute/manager.py\", line 2289, in _build_resources\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     yield resources\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/compute/manager.py\", line 2159, in _build_and_run_instance\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     flavor=flavor)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/virt/libvirt/driver.py\", line 2389, in spawn\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     block_device_info=block_device_info)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/virt/libvirt/driver.py\", line 4268, in _create_domain_and_network\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     power_on=power_on)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/virt/libvirt/driver.py\", line 4201, in _create_domain\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     LOG.error(err)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/oslo/utils/excutils.py\", line 82, in __exit__\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     six.reraise(self.type_, self.value, self.tb)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/mnt/stack/nova/nova/virt/libvirt/driver.py\", line 4191, in _create_domain\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     domain.createWithFlags(launch_flags)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 183, in doit\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 141, in proxy_call\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     rv = execute(f, *args, **kwargs)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 122, in execute\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     six.reraise(c, e, tb)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/local/lib/python2.7/dist-packages/eventlet/tpool.py\", line 80, in tworker\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     rv = meth(*args, **kwargs)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]   File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 896, in createWithFlags\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] libvirtError: internal error: cannot set bandwidth limits on tap146d0450-48\n2015-01-05 11:46:46.599 TRACE nova.compute.manager [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] \n2015-01-05 11:46:46.600 AUDIT nova.compute.manager [req-f4737d92-6989-462a-9767-d614b3114679 admin admin] [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] Terminating instance\n2015-01-05 11:46:46.613 INFO nova.virt.libvirt.driver [-] [instance: 07fe9d59-cfe0-4937-b6c1-aead2cd2e23d] Instance destroyed successfully.", 
            "date_created": "2015-01-05 12:03:48.887047+00:00", 
            "author": "https://api.launchpad.net/1.0/~philip-day"
        }, 
        {
            "content": "If you simply follow the example from spec https://review.openstack.org/#/c/22104/ and set vif_inbound_average=10240000 you end up with Nova exception:\n\nTRACE nova.compute.manager [instance: f5d8e54f-6067-4f64-8c5a-57caf7278f6a]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\nTRACE nova.compute.manager [instance: f5d8e54f-6067-4f64-8c5a-57caf7278f6a] libvirtError: internal error: cannot set bandwidth limits on vnet0\n\nand equivalent libvirtd:\n2015-01-17 08:53:01.833+0000: 11399: info : libvirt version: 1.2.2\n2015-01-17 08:53:01.833+0000: 11399: error : qemuMonitorIO:656 : internal error: End of file from monitor\n2015-01-17 08:56:05.151+0000: 11402: error : virCommandWait:2399 : internal error: Child process (/sbin/tc class add dev vnet0 parent 1: classid 1:1 htb rate 10240000kbps) unexpected exit status 1: Illegal \"rate\"\n< - - SNIP - - >\n2015-01-17 08:56:05.151+0000: 11402: error : qemuNetworkIfaceConnect:396 : internal error: cannot set bandwidth limits on vnet0\n\n\nIn above you can see \"rate 10240000kbps\" which is 10240000kbps = 10Gbps = 1250MBps\nNow reading tc manual you can find: TC store rates as a 32-bit unsigned integer in bps internally, so we can specify a max rate of 4294967295 bps.\nThis means that max rate TC allows is 4294967295bps = 4095Mbps = 4Gbps = 511MBps\nI could create VMs with  vif_inbound_average which was lower than TC max limit. \n\n\nSo the problem here is that vif_inbound_average exceeds the TC max rate limit.\nIMHO this is what we can do:\n# Example from spec https://review.openstack.org/#/c/22104/ is misleading and this should be clarified in some official Nova docs.\n# There are existing Nova tests which use 10240000 value in tests/unit/virt/libvirt/test_config.py, this also should be changed. These are the config tests only but again may be misleading example.", 
            "date_created": "2015-01-17 10:28:35.363411+00:00", 
            "author": "https://api.launchpad.net/1.0/~radoslaw-smigielski"
        }, 
        {
            "content": "I have met this problem too, thanks Radoslaw Smigielski (radoslaw-smigielski)  for giving the clue.", 
            "date_created": "2015-04-07 03:11:52.964807+00:00", 
            "author": "https://api.launchpad.net/1.0/~luogangyi"
        }, 
        {
            "content": "Just push a change to \"OpenStack Cloud Administrator Guide\" which better explains the network quota values and includes real life example  which work,  https://review.openstack.org/#/c/172926/ .\n", 
            "date_created": "2015-04-13 14:09:15.506187+00:00", 
            "author": "https://api.launchpad.net/1.0/~radoslaw-smigielski"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/173467", 
            "date_created": "2015-04-14 18:54:33.210031+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Do you at least get an instance fault tied to the instance when this fails so the user can try to figure out what was wrong with their boot request?", 
            "date_created": "2015-09-02 23:49:42.618105+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/173467\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=7882551b3b76fb8b99441f32bb8652e9f1bad1ea\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7882551b3b76fb8b99441f32bb8652e9f1bad1ea\nAuthor: Radoslaw Smigielski <email address hidden>\nDate:   Tue Apr 14 20:40:46 2015 +0200\n\n    New sensible network bandwidth quota values in Nova tests\n    \n    Class LibvirtConfigGuestInterfaceTest contains tests of network\n    bandwidth quota set by Nova flavors. These tests has artificial values\n    exceeding max allowed and supported by libvirtd/tc (Linux traffic\n    control utility) values, 2^32 kbps. It happens that people just for\n    testing copy/paste these values and run into a problem reported\n    as bug #1407643.\n    \n    Change-Id: Icbe698b30afe43cfcdd122c775b59af5a50a8741\n    Related-bug: #1407643\n", 
            "date_created": "2015-09-08 20:31:33.885336+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Cleanup\n=======\n\nThere are no open reviews for this bug report since more than 2 weeks.\nTo signal that to other contributors which might provide patches for\nthis bug, I switch the status from \"In Progress\" to \"Confirmed\" and\nremove the assignee.\nFeel free to add yourself as assignee and to push a review for it.\n\nIIUC there is a patch missing which raises an exception when it is\ndiscovered that the input value of ``quota:vif_inbound_average`` is\ninvalid (see comment #5).", 
            "date_created": "2016-03-11 15:00:10.850575+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }, 
        {
            "content": "\nThis is an automated cleanup. This bug report has been closed because it\nis older than 18 months and there is no open code change to fix this.\nAfter this time it is unlikely that the circumstances which lead to\nthe observed issue can be reproduced.\n\nIf you can reproduce the bug, please:\n* reopen the bug report (set to status \"New\")\n* AND add the detailed steps to reproduce the issue (if applicable)\n* AND leave a comment \"CONFIRMED FOR: <RELEASE_NAME>\"\n  Only still supported release names are valid (LIBERTY, MITAKA, OCATA, NEWTON).\n  Valid example: CONFIRMED FOR: LIBERTY\n", 
            "date_created": "2016-07-05 09:56:00.496027+00:00", 
            "author": "https://api.launchpad.net/1.0/~mzoeller"
        }
    ], 
    "closed": "2016-07-05 09:55:58.163501+00:00"
}