{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:12:38.908211+00:00", 
    "description": "Commit ID commit ef50dd412b3e0ab569c85abc1b3637ff0f3f819d (Essex Trunk)\n\nI got following error after rebooting nova-compute\n\n2012-01-25 15:56:35,731 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img info /opt/stack/nova/nova/..//instances/instance-00000001/disk from (pid=8788) debug /opt/stack/nova/nova/log.py:175\n2012-01-25 15:56:35,742 INFO nova.virt.libvirt_conn [-] Compute_service record updated for 356591-essex-k1\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()\n  File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/service.py\", line 88, in run_server\n    server.start()\n  File \"/opt/stack/nova/nova/service.py\", line 160, in start\n    self.manager.update_available_resource(ctxt)\n  File \"/opt/stack/nova/nova/exception.py\", line 126, in wrapped\n    return f(*args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1709, in update_available_resource\n    self.driver.update_available_resource(context, self.host)\n  File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1592, in update_available_resource\n    db.compute_node_update(ctxt, compute_node_ref[0]['id'], dic)\n  File \"/opt/stack/nova/nova/db/api.py\", line 191, in compute_node_update\n    return IMPL.compute_node_update(context, compute_id, values)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 101, in wrapper\n    return f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 513, in compute_node_update\n    _adjust_compute_node_values_for_utilization(context, values, session)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 490, in _adjust_compute_node_values_for_utilization\n    values.update(_get_host_utilization(context, host, ram_mb, disk_gb))\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 475, in _get_host_utilization\n    free_disk_gb -= instance.local_gb\nAttributeError: 'Instance' object has no attribute 'local_gb'\n\n_get_host_utilization uses local_gb\nhttps://github.com/openstack/nova/blob/master/nova/db/sqlalchemy/api.py#L475\n\nHowever local_gb is no longer in \nhttps://github.com/openstack/nova/blob/master/nova/db/sqlalchemy/models.py#L173\n( It looks local_gb is changed to root_gb)", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/921848", 
    "owner": "https://api.launchpad.net/1.0/~dtroyer", 
    "id": 921848, 
    "index": 3774, 
    "openned": "2012-01-25 22:06:43.891149+00:00", 
    "created": "2012-01-25 22:06:43.891149+00:00", 
    "title": "Restarting nova-compute faild beucase _get_host_utilization uses Intance.localgb which is not exist", 
    "comments": [
        {
            "content": "Commit ID commit ef50dd412b3e0ab569c85abc1b3637ff0f3f819d (Essex Trunk)\n\nI got following error after rebooting nova-compute\n\n2012-01-25 15:56:35,731 DEBUG nova.utils [-] Running cmd (subprocess): qemu-img info /opt/stack/nova/nova/..//instances/instance-00000001/disk from (pid=8788) debug /opt/stack/nova/nova/log.py:175\n2012-01-25 15:56:35,742 INFO nova.virt.libvirt_conn [-] Compute_service record updated for 356591-essex-k1\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()\n  File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/nova/nova/service.py\", line 88, in run_server\n    server.start()\n  File \"/opt/stack/nova/nova/service.py\", line 160, in start\n    self.manager.update_available_resource(ctxt)\n  File \"/opt/stack/nova/nova/exception.py\", line 126, in wrapped\n    return f(*args, **kw)\n  File \"/opt/stack/nova/nova/compute/manager.py\", line 1709, in update_available_resource\n    self.driver.update_available_resource(context, self.host)\n  File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1592, in update_available_resource\n    db.compute_node_update(ctxt, compute_node_ref[0]['id'], dic)\n  File \"/opt/stack/nova/nova/db/api.py\", line 191, in compute_node_update\n    return IMPL.compute_node_update(context, compute_id, values)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 101, in wrapper\n    return f(*args, **kwargs)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 513, in compute_node_update\n    _adjust_compute_node_values_for_utilization(context, values, session)\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 490, in _adjust_compute_node_values_for_utilization\n    values.update(_get_host_utilization(context, host, ram_mb, disk_gb))\n  File \"/opt/stack/nova/nova/db/sqlalchemy/api.py\", line 475, in _get_host_utilization\n    free_disk_gb -= instance.local_gb\nAttributeError: 'Instance' object has no attribute 'local_gb'\n\n_get_host_utilization uses local_gb\nhttps://github.com/openstack/nova/blob/master/nova/db/sqlalchemy/api.py#L475\n\nHowever local_gb is no longer in \nhttps://github.com/openstack/nova/blob/master/nova/db/sqlalchemy/models.py#L173\n( It looks local_gb is changed to root_gb)", 
            "date_created": "2012-01-25 22:06:43.891149+00:00", 
            "author": "https://api.launchpad.net/1.0/~nati-ueno"
        }, 
        {
            "content": "This bug is already fixed\nhttps://review.openstack.org/#change,3407", 
            "date_created": "2012-01-25 22:12:33.453991+00:00", 
            "author": "https://api.launchpad.net/1.0/~nati-ueno"
        }
    ], 
    "closed": "2012-02-29 10:25:25.181100+00:00"
}