{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:34:38.917887+00:00", 
    "description": "Since bug #1035426 was fixed, the CacheConcurrencyTestCase unit tests can fail with an exception like this:\n\nTraceback (most recent call last):\n\u00a0\u00a0File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n\u00a0\u00a0\u00a0\u00a0timer()\n\u00a0\u00a0File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/eventlet/hubs/timer.py\", line 56, in __call__\n\u00a0\u00a0\u00a0\u00a0cb(*args, **kw)\n\u00a0\u00a0File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/eventlet/greenthread.py\", line 192, in main\n\u00a0\u00a0\u00a0\u00a0result = function(*args, **kwargs)\n\u00a0\u00a0File \"/home/johannes/openstack/nova/trunk/nova/virt/libvirt/imagebackend.py\", line 126, in cache\n\u00a0\u00a0\u00a0\u00a0*args, **kwargs)\n\u00a0\u00a0File \"/home/johannes/openstack/nova/trunk/nova/virt/libvirt/imagebackend.py\", line 146, in create_image\n\u00a0\u00a0\u00a0\u00a0prepare_template(target=self.path, *args, **kwargs)\n\u00a0\u00a0File \"/home/johannes/openstack/nova/trunk/nova/utils.py\", line 732, in inner\n\u00a0\u00a0\u00a0\u00a0ensure_tree(local_lock_path)\n\u00a0\u00a0File \"/home/johannes/openstack/nova/trunk/nova/utils.py\", line 1305, in ensure_tree\n\u00a0\u00a0\u00a0\u00a0os.makedirs(path)\n\u00a0\u00a0File \"/home/johannes/virtualenvs/nova/lib/python2.6/os.py\", line 150, in makedirs\n\u00a0\u00a0\u00a0\u00a0makedirs(head, mode)\n\u00a0\u00a0File \"/home/johannes/virtualenvs/nova/lib/python2.6/os.py\", line 157, in makedirs\n\u00a0\u00a0\u00a0\u00a0mkdir(name, mode)\nOSError: [Errno 2] No such file or directory: 'nova.compute.manager'\n\nIt can also fail with similar exceptions in shutil.rmtree().\n\nThis is caused by a race condition in the unit test. Two greenthreads are spawned, and the changes to fix bug #1035426 will cause a race between the two threads either creating or deleting the tree.\n\nAn unrelated bug will cause the unit test to pass even if the above race condition and exception occur. This is because the greenthreads being tested are never waited on, causing the exceptions to be ignored.", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1052641", 
    "owner": "https://api.launchpad.net/1.0/~johannes.erdfelt", 
    "id": 1052641, 
    "index": 4370, 
    "openned": "2012-09-18 20:03:03.849939+00:00", 
    "created": "2012-09-18 20:03:03.849939+00:00", 
    "title": "No such file or directory: 'nova.compute.manager'", 
    "comments": [
        {
            "content": "Since bug #1035426 was fixed, the CacheConcurrencyTestCase unit tests can fail with an exception like this:\n\nTraceback (most recent call last):\n  File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 336, in fire_timers\n    timer()\n  File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/home/johannes/virtualenvs/nova/lib/python2.6/site-packages/eventlet/greenthread.py\", line 192, in main\n    result = function(*args, **kwargs)\n  File \"/home/johannes/openstack/nova/ohthree/nova/virt/libvirt/imagebackend.py\", line 126, in cache\n    *args, **kwargs)\n  File \"/home/johannes/openstack/nova/ohthree/nova/virt/libvirt/imagebackend.py\", line 146, in create_image\n    prepare_template(target=self.path, *args, **kwargs)\n  File \"/home/johannes/openstack/nova/ohthree/nova/utils.py\", line 732, in inner\n    ensure_tree(local_lock_path)\n  File \"/home/johannes/openstack/nova/ohthree/nova/utils.py\", line 1305, in ensure_tree\n    os.makedirs(path)\n  File \"/home/johannes/virtualenvs/nova/lib/python2.6/os.py\", line 150, in makedirs\n    makedirs(head, mode)\n  File \"/home/johannes/virtualenvs/nova/lib/python2.6/os.py\", line 157, in makedirs\n    mkdir(name, mode)\nOSError: [Errno 2] No such file or directory: 'nova.compute.manager'\n\nIt can also fail with similar exceptions in shutil.rmtree().\n\nThis is caused by a race condition in the unit test. Two greenthreads are spawned, and the changes to fix bug #1035426 will cause a race between the two threads either creating or deleting the tree.\n\nAn unrelated bug will cause the unit test to pass even if the above race condition and exception occur. This is because the greenthreads being tested are never waited on, causing the exceptions to be ignored.", 
            "date_created": "2012-09-18 20:03:03.849939+00:00", 
            "author": "https://api.launchpad.net/1.0/~johannes.erdfelt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/13226", 
            "date_created": "2012-09-18 20:07:35.165272+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/13226\nCommitted: http://github.com/openstack/nova/commit/6f2010ca086a1c770017643f631322d4734facd8\nSubmitter: Jenkins\nBranch:    master\n\ncommit 6f2010ca086a1c770017643f631322d4734facd8\nAuthor: Johannes Erdfelt <email address hidden>\nDate:   Tue Sep 18 20:03:53 2012 +0000\n\n    Fix race condition in CacheConcurrencyTestCase\n    \n    Fixes bug 1052641\n    \n    Recent changes made to fix bug 1035426 ended up creating a race\n    condition in the tests for CacheConcurrencyTestCase. Since two\n    greenthreads are used, the changes to utils.synchronized() can\n    cause a race where one thread is deleting the lock directory out\n    from under the other thread.\n    \n    An unrelated bug caused this race condition to be ignored since\n    the greenthreads were never waited on and as a result, the exceptions\n    never had a chance to be raised in the test case.\n    \n    Change-Id: I86b45414bbacd12bd3f5af323d26e0861c354ba8\n", 
            "date_created": "2012-09-19 04:56:08.195052+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-09-19 06:37:42.987790+00:00"
}