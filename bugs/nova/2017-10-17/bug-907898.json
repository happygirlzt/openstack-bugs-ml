{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 09:59:02.753966+00:00", 
    "description": "Using the latest nova Essex code with the FlatDHCPNetwork manager w/ MySQL. I'm seeing the following exceptions in nova-network.log after booting an instance:\n\n\n2011-12-22 19:58:33,227 ERROR nova.manager [f8b2fd9e-ce89-430a-a311-70ed3737c534 None None] Error during FlatDHCPManager._disassociate_stale_fixed_ips: (OperationalError) (1093, \"You can't specify target table 'fixed_ips' for update in FROM clause\") 'UPDATE fixed_ips SET updated_at=%s, instance_id=%s, leased=%s WHERE fixed_ips.id IN (SELECT fixed_ips.id \\nFROM fixed_ips INNER JOIN instances ON fixed_ips.instance_id = instances.id AND fixed_ips.deleted = %s INNER JOIN networks ON networks.id = fixed_ips.network_id \\nWHERE fixed_ips.updated_at < %s AND fixed_ips.instance_id IS NOT NULL AND fixed_ips.allocated = %s AND (instances.host = %s AND networks.multi_host = %s OR networks.host = %s))' (datetime.datetime(2011, 12, 22, 19, 58, 33, 218988), None, 0, 0, datetime.datetime(2011, 12, 22, 19, 48, 33, 216268), 0, 'nova1', 1, 'nova1')\n(nova.manager): TRACE: Traceback (most recent call last):\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/manager.py\", line 155, in periodic_tasks\n(nova.manager): TRACE:     task(self, context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 519, in _disassociate_stale_fixed_ips\n(nova.manager): TRACE:     time)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 391, in fixed_ip_disassociate_all_by_timeout\n(nova.manager): TRACE:     return IMPL.fixed_ip_disassociate_all_by_timeout(context, host, time)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 96, in wrapper\n(nova.manager): TRACE:     return f(*args, **kwargs)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 800, in fixed_ip_disassociate_all_by_timeout\n(nova.manager): TRACE:     synchronize_session='fetch')\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2313, in update\n(nova.manager): TRACE:     result = session.execute(update_stmt, params=self._params)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 724, in execute\n(nova.manager): TRACE:     clause, params or {})\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1191, in execute\n(nova.manager): TRACE:     params)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1271, in _execute_clauseelement\n(nova.manager): TRACE:     return self.__execute_context(context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1302, in __execute_context\n(nova.manager): TRACE:     context.parameters[0], context=context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1401, in _cursor_execute\n(nova.manager): TRACE:     context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1394, in _cursor_execute\n(nova.manager): TRACE:     context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 299, in do_execute\n(nova.manager): TRACE:     cursor.execute(statement, parameters)\n(nova.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/MySQLdb/cursors.py\", line 174, in execute\n(nova.manager): TRACE:     self.errorhandler(self, exc, value)\n(nova.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n(nova.manager): TRACE:     raise errorclass, errorvalue\n(nova.manager): TRACE: OperationalError: (OperationalError) (1093, \"You can't specify target table 'fixed_ips' for update in FROM clause\") 'UPDATE fixed_ips SET updated_at=%s, instance_id=%s, leased=%s WHERE fixed_ips.id IN (SELECT fixed_ips.id \\nFROM fixed_ips INNER JOIN instances ON fixed_ips.instance_id = instances.id AND fixed_ips.deleted = %s INNER JOIN networks ON networks.id = fixed_ips.network_id \\nWHERE fixed_ips.updated_at < %s AND fixed_ips.instance_id IS NOT NULL AND fixed_ips.allocated = %s AND (instances.host = %s AND networks.multi_host = %s OR networks.host = %s))' (datetime.datetime(2011, 12, 22, 19, 58, 33, 218988), None, 0, 0, datetime.datetime(2011, 12, 22, 19, 48, 33, 216268), 0, 'nova1', 1, 'nova1')", 
    "tags": [], 
    "importance": "High", 
    "heat": 10, 
    "link": "https://bugs.launchpad.net/nova/+bug/907898", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 907898, 
    "index": 545, 
    "openned": "2011-12-22 20:01:00.308679+00:00", 
    "created": "2011-12-22 20:01:00.308679+00:00", 
    "title": "You can't specify target table 'fixed_ips' for update", 
    "comments": [
        {
            "content": "Using the latest nova Essex code with the FlatDHCPNetwork manager w/ MySQL. I'm seeing the following exceptions in nova-network.log after booting an instance:\n\n\n2011-12-22 19:58:33,227 ERROR nova.manager [f8b2fd9e-ce89-430a-a311-70ed3737c534 None None] Error during FlatDHCPManager._disassociate_stale_fixed_ips: (OperationalError) (1093, \"You can't specify target table 'fixed_ips' for update in FROM clause\") 'UPDATE fixed_ips SET updated_at=%s, instance_id=%s, leased=%s WHERE fixed_ips.id IN (SELECT fixed_ips.id \\nFROM fixed_ips INNER JOIN instances ON fixed_ips.instance_id = instances.id AND fixed_ips.deleted = %s INNER JOIN networks ON networks.id = fixed_ips.network_id \\nWHERE fixed_ips.updated_at < %s AND fixed_ips.instance_id IS NOT NULL AND fixed_ips.allocated = %s AND (instances.host = %s AND networks.multi_host = %s OR networks.host = %s))' (datetime.datetime(2011, 12, 22, 19, 58, 33, 218988), None, 0, 0, datetime.datetime(2011, 12, 22, 19, 48, 33, 216268), 0, 'nova1', 1, 'nova1')\n(nova.manager): TRACE: Traceback (most recent call last):\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/manager.py\", line 155, in periodic_tasks\n(nova.manager): TRACE:     task(self, context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 519, in _disassociate_stale_fixed_ips\n(nova.manager): TRACE:     time)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 391, in fixed_ip_disassociate_all_by_timeout\n(nova.manager): TRACE:     return IMPL.fixed_ip_disassociate_all_by_timeout(context, host, time)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 96, in wrapper\n(nova.manager): TRACE:     return f(*args, **kwargs)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 800, in fixed_ip_disassociate_all_by_timeout\n(nova.manager): TRACE:     synchronize_session='fetch')\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/query.py\", line 2313, in update\n(nova.manager): TRACE:     result = session.execute(update_stmt, params=self._params)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 724, in execute\n(nova.manager): TRACE:     clause, params or {})\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1191, in execute\n(nova.manager): TRACE:     params)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1271, in _execute_clauseelement\n(nova.manager): TRACE:     return self.__execute_context(context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1302, in __execute_context\n(nova.manager): TRACE:     context.parameters[0], context=context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1401, in _cursor_execute\n(nova.manager): TRACE:     context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1394, in _cursor_execute\n(nova.manager): TRACE:     context)\n(nova.manager): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 299, in do_execute\n(nova.manager): TRACE:     cursor.execute(statement, parameters)\n(nova.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/MySQLdb/cursors.py\", line 174, in execute\n(nova.manager): TRACE:     self.errorhandler(self, exc, value)\n(nova.manager): TRACE:   File \"/usr/lib/pymodules/python2.7/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n(nova.manager): TRACE:     raise errorclass, errorvalue\n(nova.manager): TRACE: OperationalError: (OperationalError) (1093, \"You can't specify target table 'fixed_ips' for update in FROM clause\") 'UPDATE fixed_ips SET updated_at=%s, instance_id=%s, leased=%s WHERE fixed_ips.id IN (SELECT fixed_ips.id \\nFROM fixed_ips INNER JOIN instances ON fixed_ips.instance_id = instances.id AND fixed_ips.deleted = %s INNER JOIN networks ON networks.id = fixed_ips.network_id \\nWHERE fixed_ips.updated_at < %s AND fixed_ips.instance_id IS NOT NULL AND fixed_ips.allocated = %s AND (instances.host = %s AND networks.multi_host = %s OR networks.host = %s))' (datetime.datetime(2011, 12, 22, 19, 58, 33, 218988), None, 0, 0, datetime.datetime(2011, 12, 22, 19, 48, 33, 216268), 0, 'nova1', 1, 'nova1')", 
            "date_created": "2011-12-22 20:01:00.308679+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/2576", 
            "date_created": "2011-12-23 00:57:05.129554+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/2576\nCommitted: http://github.com/openstack/nova/commit/5cf93a39dc59f1040a5118bdc74a00cb3eb3163a\nSubmitter: Jenkins\nBranch:    master\n\ncommit 5cf93a39dc59f1040a5118bdc74a00cb3eb3163a\nAuthor: Dan Prince <email address hidden>\nDate:   Thu Dec 22 19:54:03 2011 -0500\n\n    Fixes LP bug #907898.\n    \n    Update DB api so that fixed_ip_disassociate_all_by_timeout uses two\n    separate commands (a query then an update). Fixes LP bug #907898.\n    \n    Change-Id: I60d7e7ba6bb3d3542ccf5b595d0c0de944e499a3\n", 
            "date_created": "2011-12-23 14:07:38.485054+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-01-25 09:53:16.558148+00:00"
}