{
    "status": "Invalid", 
    "last_updated": "2014-07-28 23:04:40.627864+00:00", 
    "description": "Running a stress test tool have uncover a race condition where the detachment of a device from an instance failed due to an exception error. The test was run using devstack with the latest Havana code.\n\nFrom the nova-compute log note that a request was issue to remove sdar. The device still exist after the remove request was completed. An exception occur when it trys to remove it for the second time:\n\n2013-06-19 14:57:24.236 DEBUG nova.storage.linuxscsi [-] Trying (1) to remove device /dev/sdar from (pid=43515) _wait_for_remove /opt/stack/nova/nova/storage/linuxscsi.py:72\n\n2013-06-19 14:57:24.236 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf tee -a /sys/bus/scsi/drivers/sd/1:0:0:21/delete from (pid=43515) execute /opt/stack/nova/nova/openstack/common/processutils.py:142\n\n2013-06-19 14:57:24.481 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf sginfo -r from (pid=43515) execute /opt/stack/nova/nova/openstack/common/processutils.py:142\n\n2013-06-19 14:57:24.905 DEBUG nova.storage.linuxscsi [-] ### devices: ['/dev/sdcg', '/dev/sdcf', '/dev/sdu', '/dev/sdt', '/dev/sdm', '/dev/sdl', '/dev/sdce', '/dev/sdcd', '/dev/sdcc', '/dev/sdcb', '/dev/sdg', '/dev/sdf', '/dev/sdca', '/dev/sdbz', '/dev/sdby', '/dev/sdbx', '/dev/sdbw', '/dev/sdbv', '/dev/sdbu', '/dev/sdbt', '/dev/sdbs', '/dev/sdbr', '/dev/sdbq', '/dev/sdbp', '/dev/sdbo', '/dev/sdbn', '/dev/sdbm', '/dev/sdbl', '/dev/sdbk', '/dev/sdbj', '/dev/sdbi', '/dev/sdbh', '/dev/sdbg', '/dev/sdbf', '/dev/sdbe', '/dev/sdbd', '/dev/sdbc', '/dev/sdbb', '/dev/sdba', '/dev/sdaz', '/dev/sday', '/dev/sdax', '/dev/sdaw', '/dev/sdav', '/dev/sdau', '/dev/sdat', '/dev/sdas', '/dev/sdar', '/dev/sdaq', '/dev/sdap', '/dev/sdao', '/dev/sdan', '/dev/sdak', '/dev/sdaj', '/dev/sdai', '/dev/sdah', '/dev/sdag', '/dev/sdaf', '/dev/sdae', '/dev/sdac', '/dev/sdaa', '/dev/sdz', '/dev/sdy', '/dev/sdx', '/dev/sdw', '/dev/sdv', '/dev/sds', '/dev/sdr', '/dev/sdq', '/dev/sdp', '/dev/sdo', '/dev/sdn', '/dev/sdk', '/dev/sdj', '/dev/sdi', '/dev/sdh', '/dev/sde', '/dev/sdd', '/dev/sdc', '/dev/sdb', '/dev/sda'] from (pid=43515) _wait_for_remove /opt/stack/nova/nova/storage/linuxscsi.py:82\n\n2013-06-19 14:57:25.004 DEBUG requests.packages.urllib3.connectionpool [-] \"POST /v1/fc4ee83b5ccf4b2dacd0a02ebd66c2a8/volumes/61be749a-68e3-4589-acbf-25eee64ef17d/action HTTP/1.1\" 200 211 from (pid=43515) _make_request /usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/connectionpool.py:289\n\n2013-06-19 14:57:26.236 DEBUG nova.storage.linuxscsi [-] Trying (1) to remove device /dev/sdar from (pid=43515) _wait_for_remove /opt/stack/nova/nova/storage/linuxscsi.py:72\n\n2013-06-19 14:57:26.236 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf tee -a /sys/bus/scsi/drivers/sd/1:0:0:21/delete from (pid=43515) execute /opt/stack/nova/nova/openstack/common/processutils.py:142\n2013-06-19 14:57:26.343 DEBUG nova.openstack.common.processutils [-] Result was 1 from (pid=43515) execute /opt/stack/nova/nova/openstack/common/processutils.py:167\n2013-06-19 14:57:26.344 ERROR nova.openstack.common.loopingcall [-] in fixed duration looping call\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Traceback (most recent call last):\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/openstack/common/loopingcall.py\", line 78, in _inner\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     self.f(*self.args, **self.kw)\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/storage/linuxscsi.py\", line 77, in _wait_for_remove\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     \"1\")\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/storage/linuxscsi.py\", line 31, in echo_scsi_command\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     utils.execute('tee', *args, **kwargs)\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/utils.py\", line 154, in execute\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     return processutils.execute(*cmd, **kwargs)\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/openstack/common/processutils.py\", line 173, in execute\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     cmd=' '.join(cmd))\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall ProcessExecutionError: Unexpected error while running command.\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Command: sudo nova-rootwrap /etc/nova/rootwrap.conf tee -a /sys/bus/scsi/drivers/sd/1:0:0:21/delete\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Exit code: 1\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Stdout: '1'\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Stderr: '/usr/bin/tee: /sys/bus/scsi/drivers/sd/1:0:0:21/delete: No such file or directory\\n'\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1192763", 
    "owner": "https://api.launchpad.net/1.0/~walter-boring", 
    "id": 1192763, 
    "index": 5039, 
    "openned": "2013-06-20 01:25:57.633322+00:00", 
    "created": "2013-06-20 01:25:57.633322+00:00", 
    "title": "Removing FC device causes exception preventing detachment completion", 
    "comments": [
        {
            "content": "Running a stress test tool have uncover a race condition where the detachment of a device from an instance failed due to an exception error. The test was run using devstack with the latest Havana code.\n\nFrom the nova-compute log note that a request was issue to remove sdar. The device still exist after the remove request was completed. An exception occur when it trys to remove it for the second time:\n\n2013-06-19 14:57:24.236 DEBUG nova.storage.linuxscsi [-] Trying (1) to remove device /dev/sdar from (pid=43515) _wait_for_remove /opt/stack/nova/nova/storage/linuxscsi.py:72\n\n2013-06-19 14:57:24.236 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf tee -a /sys/bus/scsi/drivers/sd/1:0:0:21/delete from (pid=43515) execute /opt/stack/nova/nova/openstack/common/processutils.py:142\n\n2013-06-19 14:57:24.481 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf sginfo -r from (pid=43515) execute /opt/stack/nova/nova/openstack/common/processutils.py:142\n\n2013-06-19 14:57:24.905 DEBUG nova.storage.linuxscsi [-] ### devices: ['/dev/sdcg', '/dev/sdcf', '/dev/sdu', '/dev/sdt', '/dev/sdm', '/dev/sdl', '/dev/sdce', '/dev/sdcd', '/dev/sdcc', '/dev/sdcb', '/dev/sdg', '/dev/sdf', '/dev/sdca', '/dev/sdbz', '/dev/sdby', '/dev/sdbx', '/dev/sdbw', '/dev/sdbv', '/dev/sdbu', '/dev/sdbt', '/dev/sdbs', '/dev/sdbr', '/dev/sdbq', '/dev/sdbp', '/dev/sdbo', '/dev/sdbn', '/dev/sdbm', '/dev/sdbl', '/dev/sdbk', '/dev/sdbj', '/dev/sdbi', '/dev/sdbh', '/dev/sdbg', '/dev/sdbf', '/dev/sdbe', '/dev/sdbd', '/dev/sdbc', '/dev/sdbb', '/dev/sdba', '/dev/sdaz', '/dev/sday', '/dev/sdax', '/dev/sdaw', '/dev/sdav', '/dev/sdau', '/dev/sdat', '/dev/sdas', '/dev/sdar', '/dev/sdaq', '/dev/sdap', '/dev/sdao', '/dev/sdan', '/dev/sdak', '/dev/sdaj', '/dev/sdai', '/dev/sdah', '/dev/sdag', '/dev/sdaf', '/dev/sdae', '/dev/sdac', '/dev/sdaa', '/dev/sdz', '/dev/sdy', '/dev/sdx', '/dev/sdw', '/dev/sdv', '/dev/sds', '/dev/sdr', '/dev/sdq', '/dev/sdp', '/dev/sdo', '/dev/sdn', '/dev/sdk', '/dev/sdj', '/dev/sdi', '/dev/sdh', '/dev/sde', '/dev/sdd', '/dev/sdc', '/dev/sdb', '/dev/sda'] from (pid=43515) _wait_for_remove /opt/stack/nova/nova/storage/linuxscsi.py:82\n\n2013-06-19 14:57:25.004 DEBUG requests.packages.urllib3.connectionpool [-] \"POST /v1/fc4ee83b5ccf4b2dacd0a02ebd66c2a8/volumes/61be749a-68e3-4589-acbf-25eee64ef17d/action HTTP/1.1\" 200 211 from (pid=43515) _make_request /usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/connectionpool.py:289\n\n2013-06-19 14:57:26.236 DEBUG nova.storage.linuxscsi [-] Trying (1) to remove device /dev/sdar from (pid=43515) _wait_for_remove /opt/stack/nova/nova/storage/linuxscsi.py:72\n\n2013-06-19 14:57:26.236 DEBUG nova.openstack.common.processutils [-] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf tee -a /sys/bus/scsi/drivers/sd/1:0:0:21/delete from (pid=43515) execute /opt/stack/nova/nova/openstack/common/processutils.py:142\n2013-06-19 14:57:26.343 DEBUG nova.openstack.common.processutils [-] Result was 1 from (pid=43515) execute /opt/stack/nova/nova/openstack/common/processutils.py:167\n2013-06-19 14:57:26.344 ERROR nova.openstack.common.loopingcall [-] in fixed duration looping call\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Traceback (most recent call last):\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/openstack/common/loopingcall.py\", line 78, in _inner\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     self.f(*self.args, **self.kw)\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/storage/linuxscsi.py\", line 77, in _wait_for_remove\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     \"1\")\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/storage/linuxscsi.py\", line 31, in echo_scsi_command\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     utils.execute('tee', *args, **kwargs)\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/utils.py\", line 154, in execute\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     return processutils.execute(*cmd, **kwargs)\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall   File \"/opt/stack/nova/nova/openstack/common/processutils.py\", line 173, in execute\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall     cmd=' '.join(cmd))\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall ProcessExecutionError: Unexpected error while running command.\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Command: sudo nova-rootwrap /etc/nova/rootwrap.conf tee -a /sys/bus/scsi/drivers/sd/1:0:0:21/delete\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Exit code: 1\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Stdout: '1'\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall Stderr: '/usr/bin/tee: /sys/bus/scsi/drivers/sd/1:0:0:21/delete: No such file or directory\\n'\n2013-06-19 14:57:26.344 TRACE nova.openstack.common.loopingcall", 
            "date_created": "2013-06-20 01:25:57.633322+00:00", 
            "author": "https://api.launchpad.net/1.0/~terry-gong"
        }, 
        {
            "content": "Is this bug still in progress?", 
            "date_created": "2014-07-28 18:23:52.763525+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "no progress on this bug in a long while, is this still valid?", 
            "date_created": "2014-07-28 18:24:55.376293+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "This bug isn't valid anymore.   ", 
            "date_created": "2014-07-28 23:04:28.199826+00:00", 
            "author": "https://api.launchpad.net/1.0/~walter-boring"
        }
    ], 
    "closed": "2014-07-28 23:04:37.794959+00:00"
}