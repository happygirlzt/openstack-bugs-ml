{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:37:12.179061+00:00", 
    "description": "There is an error in nova/scheduler/driver.py in method _live_migration_src_check making it impossible to have a working live migration for Xen instances using libvirt as management interface.\n\nThe power_state for a Xen instance can be power_state.BLOCKED, too, and the check in nova/scheduler/driver.py has to be completed if libvirt_type == 'xen'.\n\n---snip---\nfig:~ # xm list\nName                                        ID   Mem VCPUs      State   Time(s)\nDomain-0                                     0 126568    16     r-----   4842.2\ninstance-0000000d                            7   512     1     -b----     30.0\n\nfig:~ # ping -c 1 172.19.212.3\nPING 172.19.212.3 (172.19.212.3) 56(84) bytes of data.\n64 bytes from 172.19.212.3: icmp_seq=1 ttl=64 time=0.331 ms\n\n--- 172.19.212.3 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.331/0.331/0.331/0.000 ms\n\nos0006:~ # ./list.sh \n+--------------------------------------+------------+--------+----------------------+\n|                  ID                  |    Name    | Status |       Networks       |\n+--------------------------------------+------------+--------+----------------------+\n| d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 | testing200 | ACTIVE | console=172.19.212.3 |\n+--------------------------------------+------------+--------+----------------------+\n\n\nos0006:~ # ./nova.sh live-migration d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 plum.colo.b1-systems.de\nERROR: \n\n\n2012-04-19 12:18:57 ERROR nova.api.openstack.compute.contrib.admin_actions [req-b9a8235b-0bb4-4a41-8cef-e14b22299fa6 181fa4bf5a244420a48e2fbb28118dde b845890ccdc44640a97ff486a961858a] Live migration of instance d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 to host plum.colo.b1-systems.de failed\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions Traceback (most recent call last):\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/api/openstack/compute/contrib/admin_actions.py\", line 282, in _migrate_live\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     topic=FLAGS.compute_topic)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/scheduler/api.py\", line 72, in live_migration\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     _call_scheduler(\"live_migration\", context=context, params=params)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/scheduler/api.py\", line 40, in _call_scheduler\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     return rpc.call(context, queue, kwargs)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/rpc/__init__.py\", line 68, in call\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     return _get_impl().call(context, topic, msg, timeout)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/rpc/impl_kombu.py\", line 674, in call\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/rpc/amqp.py\", line 338, in call\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     rv = list(rv)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/rpc/amqp.py\", line 306, in __iter__\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     raise result\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions RemoteError: Remote error: InstanceNotRunning Instance d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 is not running.\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/scheduler/manager.py\", line 97, in _schedule\\n    context, ex, *args, **kwargs)\\n', u'  File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\\n    self.gen.next()\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/scheduler/manager.py\", line 92, in _schedule\\n    return driver_method(*args, **kwargs)\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/scheduler/driver.py\", line 213, in schedule_live_migration\\n    self._live_migration_src_check(context, instance_ref)\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/scheduler/driver.py\", line 252, in _live_migration_src_check\\n    instance_id=instance_ref[\\'uuid\\'])\\n', u'InstanceNotRunning: Instance d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 is not running.\\n'].\n---snap---", 
    "tags": [], 
    "importance": "Low", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/985587", 
    "owner": "https://api.launchpad.net/1.0/~berendt", 
    "id": 985587, 
    "index": 536, 
    "openned": "2012-04-19 11:38:58.155660+00:00", 
    "created": "2012-04-19 11:38:58.155660+00:00", 
    "title": "allow power state 'BLOCKED' for live migrations if using Xen by libvirt", 
    "comments": [
        {
            "content": "There is an error in nova/scheduler/driver.py in method _live_migration_src_check making it impossible to have a working live migration for Xen instances using libvirt as management interface.\n\nThe power_state for a Xen instance can be power_state.BLOCKED, too, and the check in nova/scheduler/driver.py has to be completed if libvirt_type == 'xen'.\n\n---snip---\nfig:~ # xm list\nName                                        ID   Mem VCPUs      State   Time(s)\nDomain-0                                     0 126568    16     r-----   4842.2\ninstance-0000000d                            7   512     1     -b----     30.0\n\nfig:~ # ping -c 1 172.19.212.3\nPING 172.19.212.3 (172.19.212.3) 56(84) bytes of data.\n64 bytes from 172.19.212.3: icmp_seq=1 ttl=64 time=0.331 ms\n\n--- 172.19.212.3 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.331/0.331/0.331/0.000 ms\n\nos0006:~ # ./list.sh \n+--------------------------------------+------------+--------+----------------------+\n|                  ID                  |    Name    | Status |       Networks       |\n+--------------------------------------+------------+--------+----------------------+\n| d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 | testing200 | ACTIVE | console=172.19.212.3 |\n+--------------------------------------+------------+--------+----------------------+\n\n\nos0006:~ # ./nova.sh live-migration d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 plum.colo.b1-systems.de\nERROR: \n\n\n2012-04-19 12:18:57 ERROR nova.api.openstack.compute.contrib.admin_actions [req-b9a8235b-0bb4-4a41-8cef-e14b22299fa6 181fa4bf5a244420a48e2fbb28118dde b845890ccdc44640a97ff486a961858a] Live migration of instance d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 to host plum.colo.b1-systems.de failed\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions Traceback (most recent call last):\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/api/openstack/compute/contrib/admin_actions.py\", line 282, in _migrate_live\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     topic=FLAGS.compute_topic)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/scheduler/api.py\", line 72, in live_migration\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     _call_scheduler(\"live_migration\", context=context, params=params)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/scheduler/api.py\", line 40, in _call_scheduler\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     return rpc.call(context, queue, kwargs)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/rpc/__init__.py\", line 68, in call\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     return _get_impl().call(context, topic, msg, timeout)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/rpc/impl_kombu.py\", line 674, in call\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     return rpc_amqp.call(context, topic, msg, timeout, Connection.pool)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/rpc/amqp.py\", line 338, in call\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     rv = list(rv)\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions   File \"/usr/lib64/python2.6/site-packages/nova/rpc/amqp.py\", line 306, in __iter__\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions     raise result\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions RemoteError: Remote error: InstanceNotRunning Instance d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 is not running.\n2012-04-19 12:18:57 TRACE nova.api.openstack.compute.contrib.admin_actions [u'Traceback (most recent call last):\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/scheduler/manager.py\", line 97, in _schedule\\n    context, ex, *args, **kwargs)\\n', u'  File \"/usr/lib64/python2.6/contextlib.py\", line 23, in __exit__\\n    self.gen.next()\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/scheduler/manager.py\", line 92, in _schedule\\n    return driver_method(*args, **kwargs)\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/scheduler/driver.py\", line 213, in schedule_live_migration\\n    self._live_migration_src_check(context, instance_ref)\\n', u'  File \"/usr/lib64/python2.6/site-packages/nova/scheduler/driver.py\", line 252, in _live_migration_src_check\\n    instance_id=instance_ref[\\'uuid\\'])\\n', u'InstanceNotRunning: Instance d0b576a7-f8cb-46af-898c-e9cf4b89b2c4 is not running.\\n'].\n---snap---", 
            "date_created": "2012-04-19 11:38:58.155660+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/6713", 
            "date_created": "2012-04-23 11:10:46.879154+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/6713\nCommitted: http://github.com/openstack/nova/commit/a72f25dba2cccbbcdd8c8927f0bc6199272b67ce\nSubmitter: Jenkins\nBranch:    master\n\ncommit a72f25dba2cccbbcdd8c8927f0bc6199272b67ce\nAuthor: Christian Berendt <email address hidden>\nDate:   Mon Apr 23 13:09:21 2012 +0200\n\n    allow power state \"BLOCKED\" for live migrations if using Xen by libvirt\n    \n    fixes bug 985587\n    \n    Change-Id: I7184dd639733a68f6b31e5e3e4311c7aa8d50220\n", 
            "date_created": "2012-04-25 19:02:45.623343+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-05-23 13:12:18.552599+00:00"
}