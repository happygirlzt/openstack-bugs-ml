{
    "status": "Fix Released", 
    "last_updated": "2015-04-30 09:11:23.670000+00:00", 
    "description": "After evacuated successfully, and restarting the failed host to get it back. User will run into below error.\n\n\n\n<179>Sep 23 01:48:35 node-1 nova-compute 2014-09-23 01:48:35.346 13206 ERROR nova.openstack.common.threadgroup [-] error removing image\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/service.py\", line 483, in run_service\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     service.start()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 163, in start\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1018, in init_host\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     self._destroy_evacuated_instances(context)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 712, in _destroy_evacuated_instances\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     bdi, destroy_disks)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 962, in destroy\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     destroy_disks, migrate_data)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1080, in cleanup\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     self._cleanup_rbd(instance)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1090, in _cleanup_rbd\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     LibvirtDriver._get_rbd_driver().cleanup_volumes(instance)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/rbd_utils.py\", line 238, in cleanup_volumes\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     self.rbd.RBD().remove(client.ioctx, volume)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/rbd.py\", line 300, in remove\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     raise make_ex(ret, 'error removing image')\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup ImageBusy: error removing image", 
    "tags": [
        "in-stable-icehouse", 
        "in-stable-juno", 
        "juno-backport-potential"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1385484", 
    "owner": "https://api.launchpad.net/1.0/~flwang", 
    "id": 1385484, 
    "index": 1643, 
    "openned": "2014-10-24 20:48:42.174443+00:00", 
    "created": "2014-10-24 20:48:42.174443+00:00", 
    "title": "Failed to start nova-compute after evacuate", 
    "comments": [
        {
            "content": "After evacuated successfully, and restarting the failed host to get it back. User will run into below error.\n\n\n\n<179>Sep 23 01:48:35 node-1 nova-compute 2014-09-23 01:48:35.346 13206 ERROR nova.openstack.common.threadgroup [-] error removing image\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/service.py\", line 483, in run_service\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     service.start()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 163, in start\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 1018, in init_host\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     self._destroy_evacuated_instances(context)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/compute/manager.py\", line 712, in _destroy_evacuated_instances\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     bdi, destroy_disks)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 962, in destroy\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     destroy_disks, migrate_data)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1080, in cleanup\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     self._cleanup_rbd(instance)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/driver.py\", line 1090, in _cleanup_rbd\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     LibvirtDriver._get_rbd_driver().cleanup_volumes(instance)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/nova/virt/libvirt/rbd_utils.py\", line 238, in cleanup_volumes\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     self.rbd.RBD().remove(client.ioctx, volume)\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.7/dist-packages/rbd.py\", line 300, in remove\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup     raise make_ex(ret, 'error removing image')\n2014-09-23 01:48:35.346 13206 TRACE nova.openstack.common.threadgroup ImageBusy: error removing image", 
            "date_created": "2014-10-24 20:48:42.174443+00:00", 
            "author": "https://api.launchpad.net/1.0/~flwang"
        }, 
        {
            "content": "This bug is related to https://launchpad.net/bugs/1249319 and https://launchpad.net/bugs/1340411", 
            "date_created": "2014-10-24 20:50:13.647059+00:00", 
            "author": "https://api.launchpad.net/1.0/~flwang"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/130905", 
            "date_created": "2014-10-24 23:58:48.123610+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/juno\nReview: https://review.openstack.org/131626", 
            "date_created": "2014-10-29 02:46:46.457696+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/130905\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=296d92bd44d1b8eb161f94f70cba5db4d17f8f65\nSubmitter: Jenkins\nBranch:    master\n\ncommit 296d92bd44d1b8eb161f94f70cba5db4d17f8f65\nAuthor: Fei Long Wang <email address hidden>\nDate:   Sat Oct 25 10:05:57 2014 +1300\n\n    Fix nova-compute start issue after evacuate\n    \n    After evacuated successfully, and restarting the failed\n    host to get it back, Nova will call init_host() and then\n    call method _destroy_evacuated_instances(). In method\n    _destroy_evacuated_instances(), nova will check again if\n    the storage is shared or not to decide if the storage\n    should be destroyed. Now nova is using temp file to check\n    if it's shared file system, but it's wrong for RBD case.\n    So Nova will attempt to delete the shared block storage,\n    which will fail since it's used by the new instance. This\n    patch fixes this issue and adds test cases for that.\n    \n    Closes-Bug: 1385484\n    \n    Change-Id: I71bb818f3c2930b3a2ddf1817dfd4bb61fae7e98\n", 
            "date_created": "2014-10-29 03:38:08.855253+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/131631", 
            "date_created": "2014-10-29 04:30:47.504603+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/131626\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=ce1d1dd3dda0097d97f0b23b01d18dc1e3a9569a\nSubmitter: Jenkins\nBranch:    stable/juno\n\ncommit ce1d1dd3dda0097d97f0b23b01d18dc1e3a9569a\nAuthor: Fei Long Wang <email address hidden>\nDate:   Sat Oct 25 10:05:57 2014 +1300\n\n    Fix nova-compute start issue after evacuate\n    \n    After evacuated successfully, and restarting the failed\n    host to get it back, Nova will call init_host() and then\n    call method _destroy_evacuated_instances(). In method\n    _destroy_evacuated_instances(), nova will check again if\n    the storage is shared or not to decide if the storage\n    should be destroyed. Now nova is using temp file to check\n    if it's shared file system, but it's wrong for RBD case.\n    So Nova will attempt to delete the shared block storage,\n    which will fail since it's used by the new instance. This\n    patch fixes this issue and adds test cases for that.\n    \n    Closes-Bug: 1385484\n    \n    Change-Id: I71bb818f3c2930b3a2ddf1817dfd4bb61fae7e98\n    (cherry picked from commit 296d92bd44d1b8eb161f94f70cba5db4d17f8f65)\n", 
            "date_created": "2014-11-17 11:52:52.740635+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/131631\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=fe289fb9fd19001eae1f3c2636301b055c0c8b8d\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit fe289fb9fd19001eae1f3c2636301b055c0c8b8d\nAuthor: Fei Long Wang <email address hidden>\nDate:   Sat Oct 25 10:05:57 2014 +1300\n\n    Fix nova-compute start issue after evacuate\n    \n    After evacuated successfully, and restarting the failed\n    host to get it back, Nova will call init_host() and then\n    call method _destroy_evacuated_instances(). In method\n    _destroy_evacuated_instances(), nova will check again if\n    the storage is shared or not to decide if the storage\n    should be destroyed. Now nova is using temp file to check\n    if it's shared file system, but it's wrong for RBD case.\n    So Nova will attempt to delete the shared block storage,\n    which will fail since it's used by the new instance. This\n    patch fixes this issue and adds test cases for that.\n    \n    Closes-Bug: 1385484\n    \n    Conflicts:\n            nova/tests/virt/libvirt/test_libvirt.py\n    \n    Change-Id: I71bb818f3c2930b3a2ddf1817dfd4bb61fae7e98\n    (cherry picked from commit 296d92bd44d1b8eb161f94f70cba5db4d17f8f65)\n    (cherry picked from commit ce1d1dd3dda0097d97f0b23b01d18dc1e3a9569a)\n", 
            "date_created": "2014-11-26 00:52:29.593741+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-12-18 19:59:34.106342+00:00"
}