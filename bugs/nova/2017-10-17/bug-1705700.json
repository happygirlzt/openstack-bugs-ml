{
    "status": "Expired", 
    "last_updated": "2017-09-27 04:17:53.575007+00:00", 
    "description": "Hi,\n\n$subj\n\n[#]> rpm -qi openstack-nova-common.noarch\nName        : openstack-nova-common\nEpoch       : 1\nVersion     : 15.0.0\nRelease     : 1.el7\n\nSTR:\n-configure 2x compute node with cinder storage and lvm back-ends;\n-crate bootable volume from image;\n-create instance and use bootable volume;\n-migrate volume from current node to another\n-try to perform live migration\n\nActual Result:\n-live migration fails:\n-------------------------\n2017-07-21 11:33:00.554 4552 ERROR nova.virt.libvirt.driver [req-792a37bf-3a2e-4976-84ad-cc308eb1ffbf - - - - -] [instance: 5dd0b6ab-8743-42a2-af7a-38f1fb10dedf] Live Migration failure: missing source information for device vda\n2017-07-21 11:33:00.599 4552 ERROR nova.virt.libvirt.driver [req-792a37bf-3a2e-4976-84ad-cc308eb1ffbf - - - - -] [instance: 5dd0b6ab-8743-42a2-af7a-38f1fb10dedf] Migration operation has aborted\n\n\nJul 21 11:33:00 compute-02 nova-compute: Traceback (most recent call last):\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 457, in fire_timers\nJul 21 11:33:00 compute-02 nova-compute: timer()\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 58, in __call__\nJul 21 11:33:00 compute-02 nova-compute: cb(*args, **kw)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 168, in _do_send\nJul 21 11:33:00 compute-02 nova-compute: waiter.switch(result)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 214, in main\nJul 21 11:33:00 compute-02 nova-compute: result = function(*args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/utils.py\", line 1087, in context_wrapper\nJul 21 11:33:00 compute-02 nova-compute: return func(*args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 6150, in _live_migration_operation\nJul 21 11:33:00 compute-02 nova-compute: instance=instance)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\nJul 21 11:33:00 compute-02 nova-compute: self.force_reraise()\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\nJul 21 11:33:00 compute-02 nova-compute: six.reraise(self.type_, self.value, self.tb)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 6143, in _live_migration_operation\nJul 21 11:33:00 compute-02 nova-compute: bandwidth=CONF.libvirt.live_migration_bandwidth)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 623, in migrate\nJul 21 11:33:00 compute-02 nova-compute: destination, params=params, flags=flags)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 186, in doit\nJul 21 11:33:00 compute-02 nova-compute: result = proxy_call(self._autowrap, f, *args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 144, in proxy_call\nJul 21 11:33:00 compute-02 nova-compute: rv = execute(f, *args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 125, in execute\nJul 21 11:33:00 compute-02 nova-compute: six.reraise(c, e, tb)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 83, in tworker\nJul 21 11:33:00 compute-02 nova-compute: rv = meth(*args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 1939, in migrateToURI3\nJul 21 11:33:00 compute-02 nova-compute: if ret == -1: raise libvirtError ('virDomainMigrateToURI3() failed', dom=self)\nJul 21 11:33:00 compute-02 nova-compute: libvirtError: missing source information for device vda\n-------------------------\n\nHere is disk description when instance was created\n--------------------------\n    <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source dev='/dev/disk/by-path/ip-10.30.30.101:3260-iscsi-iqn.2010-10.org.openstack:volume-fcc11b41-514e-4a91-a29e-4632c4f42648-lun-0'/>\n      <backingStore/>\n      <target dev='vda' bus='virtio'/>\n      <serial>4c0b28d5-fc0b-4907-b563-b47b521bc945</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n--------------------------\n\nHere is disk description during migration:\n--------------------------\n   <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source dev='/dev/disk/by-path/ip-10.30.30.101:3260-iscsi-iqn.2010-10.org.openstack:volume-fcc11b41-514e-4a91-a29e-4632c4f42648-lun-0'/>\n      <backingStore/>\n      <mirror type='file' file='/dev/disk/by-path/ip-10.30.30.100:3260-iscsi-iqn.2010-10.org.openstack:volume-7604d08d-e987-4c8d-9a9b-56f3258d5b60-lun-0' format='raw' job='copy'>\n        <format type='raw'/>\n        <source file='/dev/disk/by-path/ip-10.30.30.100:3260-iscsi-iqn.2010-10.org.openstack:volume-7604d08d-e987-4c8d-9a9b-56f3258d5b60-lun-0'/>\n      </mirror>\n      <target dev='vda' bus='virtio'/>\n      <serial>4c0b28d5-fc0b-4907-b563-b47b521bc945</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n--------------------------\n\nHere is disk description after the migration:\n--------------------------\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source file='/dev/disk/by-path/ip-10.30.30.100:3260-iscsi-iqn.2010-10.org.openstack:volume-7604d08d-e987-4c8d-9a9b-56f3258d5b60-lun-0'/>\n      <backingStore/>\n      <target dev='vda' bus='virtio'/>\n      <serial>4c0b28d5-fc0b-4907-b563-b47b521bc945</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n--------------------------\n\n\nHere is disk description after instance hard reboot:\n--------------------------\n    <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source dev='/dev/disk/by-path/ip-10.30.30.100:3260-iscsi-iqn.2010-10.org.openstack:volume-7604d08d-e987-4c8d-9a9b-56f3258d5b60-lun-0'/>\n      <backingStore/>\n      <target dev='vda' bus='virtio'/>\n      <serial>4c0b28d5-fc0b-4907-b563-b47b521bc945</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n--------------------------\n\nThe issue is caused by the fact that dist type is changed from 'block' to 'file' after volume migration. Please note that after hard reboot instance the xml description is fixed and live migration works.", 
    "tags": [
        "libvirt", 
        "live-migration", 
        "volumes"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1705700", 
    "owner": "None", 
    "id": 1705700, 
    "index": 2111, 
    "openned": "2017-07-21 12:36:56.800535+00:00", 
    "created": "2017-07-21 12:36:56.800535+00:00", 
    "title": "live migration does not work after volume migration", 
    "comments": [
        {
            "content": "Hi,\n\n$subj\n\n[#]> rpm -qi openstack-nova-common.noarch\nName        : openstack-nova-common\nEpoch       : 1\nVersion     : 15.0.0\nRelease     : 1.el7\n\nSTR:\n-configure 2x compute node with cinder storage and lvm back-ends;\n-crate bootable volume from image;\n-create instance and use bootable volume;\n-migrate volume from current node to another\n-try to perform live migration\n\nActual Result:\n-live migration fails:\n-------------------------\n2017-07-21 11:33:00.554 4552 ERROR nova.virt.libvirt.driver [req-792a37bf-3a2e-4976-84ad-cc308eb1ffbf - - - - -] [instance: 5dd0b6ab-8743-42a2-af7a-38f1fb10dedf] Live Migration failure: missing source information for device vda\n2017-07-21 11:33:00.599 4552 ERROR nova.virt.libvirt.driver [req-792a37bf-3a2e-4976-84ad-cc308eb1ffbf - - - - -] [instance: 5dd0b6ab-8743-42a2-af7a-38f1fb10dedf] Migration operation has aborted\n\n\nJul 21 11:33:00 compute-02 nova-compute: Traceback (most recent call last):\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 457, in fire_timers\nJul 21 11:33:00 compute-02 nova-compute: timer()\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 58, in __call__\nJul 21 11:33:00 compute-02 nova-compute: cb(*args, **kw)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/event.py\", line 168, in _do_send\nJul 21 11:33:00 compute-02 nova-compute: waiter.switch(result)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/greenthread.py\", line 214, in main\nJul 21 11:33:00 compute-02 nova-compute: result = function(*args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/utils.py\", line 1087, in context_wrapper\nJul 21 11:33:00 compute-02 nova-compute: return func(*args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 6150, in _live_migration_operation\nJul 21 11:33:00 compute-02 nova-compute: instance=instance)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\nJul 21 11:33:00 compute-02 nova-compute: self.force_reraise()\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\nJul 21 11:33:00 compute-02 nova-compute: six.reraise(self.type_, self.value, self.tb)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py\", line 6143, in _live_migration_operation\nJul 21 11:33:00 compute-02 nova-compute: bandwidth=CONF.libvirt.live_migration_bandwidth)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/nova/virt/libvirt/guest.py\", line 623, in migrate\nJul 21 11:33:00 compute-02 nova-compute: destination, params=params, flags=flags)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 186, in doit\nJul 21 11:33:00 compute-02 nova-compute: result = proxy_call(self._autowrap, f, *args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 144, in proxy_call\nJul 21 11:33:00 compute-02 nova-compute: rv = execute(f, *args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 125, in execute\nJul 21 11:33:00 compute-02 nova-compute: six.reraise(c, e, tb)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib/python2.7/site-packages/eventlet/tpool.py\", line 83, in tworker\nJul 21 11:33:00 compute-02 nova-compute: rv = meth(*args, **kwargs)\nJul 21 11:33:00 compute-02 nova-compute: File \"/usr/lib64/python2.7/site-packages/libvirt.py\", line 1939, in migrateToURI3\nJul 21 11:33:00 compute-02 nova-compute: if ret == -1: raise libvirtError ('virDomainMigrateToURI3() failed', dom=self)\nJul 21 11:33:00 compute-02 nova-compute: libvirtError: missing source information for device vda\n-------------------------\n\nHere is disk description when instance was created\n--------------------------\n    <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source dev='/dev/disk/by-path/ip-10.30.30.101:3260-iscsi-iqn.2010-10.org.openstack:volume-fcc11b41-514e-4a91-a29e-4632c4f42648-lun-0'/>\n      <backingStore/>\n      <target dev='vda' bus='virtio'/>\n      <serial>4c0b28d5-fc0b-4907-b563-b47b521bc945</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n--------------------------\n\nHere is disk description during migration:\n--------------------------\n   <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source dev='/dev/disk/by-path/ip-10.30.30.101:3260-iscsi-iqn.2010-10.org.openstack:volume-fcc11b41-514e-4a91-a29e-4632c4f42648-lun-0'/>\n      <backingStore/>\n      <mirror type='file' file='/dev/disk/by-path/ip-10.30.30.100:3260-iscsi-iqn.2010-10.org.openstack:volume-7604d08d-e987-4c8d-9a9b-56f3258d5b60-lun-0' format='raw' job='copy'>\n        <format type='raw'/>\n        <source file='/dev/disk/by-path/ip-10.30.30.100:3260-iscsi-iqn.2010-10.org.openstack:volume-7604d08d-e987-4c8d-9a9b-56f3258d5b60-lun-0'/>\n      </mirror>\n      <target dev='vda' bus='virtio'/>\n      <serial>4c0b28d5-fc0b-4907-b563-b47b521bc945</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n--------------------------\n\nHere is disk description after the migration:\n--------------------------\n    <disk type='file' device='disk'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source file='/dev/disk/by-path/ip-10.30.30.100:3260-iscsi-iqn.2010-10.org.openstack:volume-7604d08d-e987-4c8d-9a9b-56f3258d5b60-lun-0'/>\n      <backingStore/>\n      <target dev='vda' bus='virtio'/>\n      <serial>4c0b28d5-fc0b-4907-b563-b47b521bc945</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n--------------------------\n\n\nHere is disk description after instance hard reboot:\n--------------------------\n    <disk type='block' device='disk'>\n      <driver name='qemu' type='raw' cache='none' io='native'/>\n      <source dev='/dev/disk/by-path/ip-10.30.30.100:3260-iscsi-iqn.2010-10.org.openstack:volume-7604d08d-e987-4c8d-9a9b-56f3258d5b60-lun-0'/>\n      <backingStore/>\n      <target dev='vda' bus='virtio'/>\n      <serial>4c0b28d5-fc0b-4907-b563-b47b521bc945</serial>\n      <alias name='virtio-disk0'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\n    </disk>\n--------------------------\n\nThe issue is caused by the fact that dist type is changed from 'block' to 'file' after volume migration. Please note that after hard reboot instance the xml description is fixed and live migration works.", 
            "date_created": "2017-07-21 12:36:56.800535+00:00", 
            "author": "https://api.launchpad.net/1.0/~mamut"
        }, 
        {
            "content": "So, as per this report, it seems like 'block' as the disk type post-migration is not being retained.\n\nHere's a related (merged) patch that changed the disk type from 'file' to 'block' for block devices:\n\n  https://review.openstack.org/#/c/465205/: Use VIR_DOMAIN_BLOCK_REBASE_COPY_DEV when rebasing \n\n\n", 
            "date_created": "2017-07-24 13:44:59.858496+00:00", 
            "author": "https://api.launchpad.net/1.0/~kashyapc"
        }, 
        {
            "content": "Looks related to https://bugs.launchpad.net/nova/+bug/1691195 whose the fix was backported to Newton and Ocata.\n\nhttps://review.openstack.org/#/c/465205/", 
            "date_created": "2017-07-24 13:48:11.565621+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": "Just saw you were on 15.0.0, could you please upgrade your compute nodes to the latest stable Ocata release (at least >= 15.0.6) so you could tell us if the above bugfix (which was backported to ocata-15.0.6) fixes your problem ?\n\n", 
            "date_created": "2017-07-24 13:52:23.252950+00:00", 
            "author": "https://api.launchpad.net/1.0/~sylvain-bauza"
        }, 
        {
            "content": ">so you could tell us if the above bugfix (which was backported to ocata-15.0.6) fixes your problem? \n\nWorks like a charm after updating the packeges. Thank you! ", 
            "date_created": "2017-07-28 13:06:31.608139+00:00", 
            "author": "https://api.launchpad.net/1.0/~mamut"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2017-09-27 04:17:51.206358+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2017-09-27 04:17:51.682445+00:00"
}