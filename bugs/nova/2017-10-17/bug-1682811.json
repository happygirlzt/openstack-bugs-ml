{
    "status": "Won't Fix", 
    "last_updated": "2017-07-27 17:04:00.543512+00:00", 
    "description": "Additional scheduler_hints can be passed while creating a VM but if those additional scheduler_hints value is 'null' or 'dict' the create server call fails with 500 InternalServerError.\n\nSteps to reproduce:\n\nCommand:\n$ curl -g -i -X POST http://10.232.48.201:8774/v2.1/servers -H \"Accept: application/json\" -H \"User-Agent: python-novaclient\" -H \"OpenStack-API-Version: compute 2.41\" -H \"X-OpenStack-Nova-API-Version: 2.41\" -H \"X-Auth-Token: gAAAAABY7Jf4Qiwm2GKc-dsLiRVxK6-9CPHvk1Vu kRL6kVKItGetXrPUdLIhHtKebr4rSCAnK7VQTMI6v0LySvu3Cpu7e8y_7WSpELWp-Bfx5PEosbDh2UDsiJW7ib8jPEW5rcyQuDun5gDR9NbaugQ6UBcmKW1TMm9QZdTSI2npqyYJTVFuis\" -H \"Content-Type: application/json\" -d '{\"os:scheduler_hints\": {\"key\": null}, \"server\": {\"name\": \"instances1\", \"imageRef\": \"107f0481-754d-46a2-98a7-a26228c4280e\", \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1, \"networks\": \"auto\"}}'\n\nPlease note the scheduler_hints: {\"os:scheduler_hints\": {\"key\": null}\n\nOutput:\nHTTP/1.1 500 Internal Server Error\nOpenstack-Api-Version: compute 2.41\nX-Openstack-Nova-Api-Version: 2.41\nVary: OpenStack-API-Version\nVary: X-OpenStack-Nova-API-Version\nContent-Type: application/json; charset=UTF-8\nContent-Length: 194\nX-Compute-Request-Id: req-3c29eadc-20d0-4aef-b3c0-def9a51b0e64\nDate: Tue, 11 Apr 2017 08:47:26 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<type 'exceptions.ValueError'>\", \"code\": 500}}\n\n\nnova-api:\n\n2017-04-11 14:17:26.843 ERROR nova.api.openstack.extensions [req-3c29eadc-20d0-4aef\n-b3c0-def9a51b0e64 admin admin] Unexpected exception in API method\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions Traceback (most recent\ncall last):\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova\n/nova/api/openstack/extensions.py\", line 336, in wrapped\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return f(*args, **k\nwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova\n/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args,\n**kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova\n/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args,\n**kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 553, in create\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     **create_kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1671, in create\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1240, in _create_instance\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     key_pair)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1102, in _provision_instances\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     quotas.rollback()\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     self.force_reraise()\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1015, in _provision_instances\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     security_groups=security_groups)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/request_spec.py\", line 415, in from_components\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     spec_obj._from_hints(filter_properties.get('scheduler_hints', {}))\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/request_spec.py\", line 224, in _from_hints\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     for hint, value in hints_dict.items()}\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 72, in setter\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     field_value = field.coerce(self, name, value)\npython2.7/dist-packages/oslo_versionedobjects/fields.py\", line 640, in coerce\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     coerced_list.extend(value)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/fields.py\", line 1242, in extend\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     for index, item in enumerate(t)]\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/fields.py\", line 1222, in _coerce_item\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return self._element_type.coerce(self._obj, att_name, item)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/fields.py\", line 193, in coerce\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return self._null(obj, attr)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/fields.py\", line 171, in _null\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     raise ValueError(_(\"Field `%s' cannot be None\") % attr)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions ValueError: Field `scheduler_hints[[]][0]' cannot be None\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions\n2017-04-11 14:17:26.984 INFO nova.api.openstack.wsgi [req-3c29eadc-20d0-4aef-b3c0-def9a51b0e64 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.ValueError'>\n2017-04-11 14:17:26.985 DEBUG nova.api.openstack.wsgi [req-3c29eadc-20d0-4aef-b3c0-def9a51b0e64 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.ValueError'> from (pid=2056) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1041\n2017-04-11 14:17:26.986 INFO nova.osapi_compute.wsgi.server [req-3c29eadc-20d0-4aef-b3c0-def9a51b0e64 admin admin] 10.232.48.201 \"POST /v2.1/servers HTTP/1.1\" status: 500 len: 539 time: 1.1872978\n\n\nLatest commit:\ncommit ae637e70a72166067e09f3bbc3acb54e5d92771e\nMerge: 9e071f4 370820b\nAuthor: Jenkins <email address hidden>\nDate:   Fri Apr 14 01:38:43 2017 +0000\n\n    Merge \"Fix hypervisors api missing HostMappingNotFound handlers\"", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1682811", 
    "owner": "None", 
    "id": 1682811, 
    "index": 8068, 
    "openned": "2017-04-14 12:40:27.815629+00:00", 
    "created": "2017-04-14 12:40:27.815629+00:00", 
    "title": "nova boot apis raises 500 error if scheduler_hints additionalProperties value passed as 'null' or 'dict'", 
    "comments": [
        {
            "content": "Additional scheduler_hints can be passed while creating a VM but if those additional scheduler_hints value is 'null' or 'dict' the create server call fails with 500 InternalServerError.\n\nSteps to reproduce:\n\nCommand:\n$ curl -g -i -X POST http://10.232.48.201:8774/v2.1/servers -H \"Accept: application/json\" -H \"User-Agent: python-novaclient\" -H \"OpenStack-API-Version: compute 2.41\" -H \"X-OpenStack-Nova-API-Version: 2.41\" -H \"X-Auth-Token: gAAAAABY7Jf4Qiwm2GKc-dsLiRVxK6-9CPHvk1Vu kRL6kVKItGetXrPUdLIhHtKebr4rSCAnK7VQTMI6v0LySvu3Cpu7e8y_7WSpELWp-Bfx5PEosbDh2UDsiJW7ib8jPEW5rcyQuDun5gDR9NbaugQ6UBcmKW1TMm9QZdTSI2npqyYJTVFuis\" -H \"Content-Type: application/json\" -d '{\"os:scheduler_hints\": {\"key\": null}, \"server\": {\"name\": \"instances1\", \"imageRef\": \"107f0481-754d-46a2-98a7-a26228c4280e\", \"flavorRef\": \"1\", \"max_count\": 1, \"min_count\": 1, \"networks\": \"auto\"}}'\n\nPlease note the scheduler_hints: {\"os:scheduler_hints\": {\"key\": null}\n\nOutput:\nHTTP/1.1 500 Internal Server Error\nOpenstack-Api-Version: compute 2.41\nX-Openstack-Nova-Api-Version: 2.41\nVary: OpenStack-API-Version\nVary: X-OpenStack-Nova-API-Version\nContent-Type: application/json; charset=UTF-8\nContent-Length: 194\nX-Compute-Request-Id: req-3c29eadc-20d0-4aef-b3c0-def9a51b0e64\nDate: Tue, 11 Apr 2017 08:47:26 GMT\n\n{\"computeFault\": {\"message\": \"Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\\n<type 'exceptions.ValueError'>\", \"code\": 500}}\n\n\nnova-api:\n\n2017-04-11 14:17:26.843 ERROR nova.api.openstack.extensions [req-3c29eadc-20d0-4aef\n-b3c0-def9a51b0e64 admin admin] Unexpected exception in API method\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions Traceback (most recent\ncall last):\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova\n/nova/api/openstack/extensions.py\", line 336, in wrapped\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return f(*args, **k\nwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova\n/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args,\n**kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova\n/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args,\n**kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/validation/__init__.py\", line 108, in wrapper\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return func(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/api/openstack/compute/servers.py\", line 553, in create\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     **create_kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/hooks.py\", line 154, in inner\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     rv = f(*args, **kwargs)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1671, in create\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     check_server_group_quota=check_server_group_quota)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1240, in _create_instance\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     key_pair)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1102, in _provision_instances\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     quotas.rollback()\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     self.force_reraise()\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     six.reraise(self.type_, self.value, self.tb)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/compute/api.py\", line 1015, in _provision_instances\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     security_groups=security_groups)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/request_spec.py\", line 415, in from_components\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     spec_obj._from_hints(filter_properties.get('scheduler_hints', {}))\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/opt/stack/nova/nova/objects/request_spec.py\", line 224, in _from_hints\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     for hint, value in hints_dict.items()}\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/base.py\", line 72, in setter\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     field_value = field.coerce(self, name, value)\npython2.7/dist-packages/oslo_versionedobjects/fields.py\", line 640, in coerce\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     coerced_list.extend(value)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/fields.py\", line 1242, in extend\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     for index, item in enumerate(t)]\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/fields.py\", line 1222, in _coerce_item\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return self._element_type.coerce(self._obj, att_name, item)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/fields.py\", line 193, in coerce\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     return self._null(obj, attr)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions   File \"/usr/local/lib/python2.7/dist-packages/oslo_versionedobjects/fields.py\", line 171, in _null\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions     raise ValueError(_(\"Field `%s' cannot be None\") % attr)\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions ValueError: Field `scheduler_hints[[]][0]' cannot be None\n2017-04-11 14:17:26.843 TRACE nova.api.openstack.extensions\n2017-04-11 14:17:26.984 INFO nova.api.openstack.wsgi [req-3c29eadc-20d0-4aef-b3c0-def9a51b0e64 admin admin] HTTP exception thrown: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.ValueError'>\n2017-04-11 14:17:26.985 DEBUG nova.api.openstack.wsgi [req-3c29eadc-20d0-4aef-b3c0-def9a51b0e64 admin admin] Returning 500 to user: Unexpected API Error. Please report this at http://bugs.launchpad.net/nova/ and attach the Nova API log if possible.\n<type 'exceptions.ValueError'> from (pid=2056) __call__ /opt/stack/nova/nova/api/openstack/wsgi.py:1041\n2017-04-11 14:17:26.986 INFO nova.osapi_compute.wsgi.server [req-3c29eadc-20d0-4aef-b3c0-def9a51b0e64 admin admin] 10.232.48.201 \"POST /v2.1/servers HTTP/1.1\" status: 500 len: 539 time: 1.1872978\n\n\nLatest commit:\ncommit ae637e70a72166067e09f3bbc3acb54e5d92771e\nMerge: 9e071f4 370820b\nAuthor: Jenkins <email address hidden>\nDate:   Fri Apr 14 01:38:43 2017 +0000\n\n    Merge \"Fix hypervisors api missing HostMappingNotFound handlers\"", 
            "date_created": "2017-04-14 12:40:27.815629+00:00", 
            "author": "https://api.launchpad.net/1.0/~dinesh-bhor"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/457890", 
            "date_created": "2017-04-19 07:13:58.697883+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Dinesh Bhor (<email address hidden>) on branch: master\nReview: https://review.openstack.org/457890\nReason: Scheduler hints are deprecated", 
            "date_created": "2017-07-07 10:55:15.649735+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "There are no currently open reviews on this bug, changing the status back to the previous state and unassigning. If there are active reviews related to this bug, please include links in comments. ", 
            "date_created": "2017-07-24 15:39:46.552584+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2017-07-27 17:03:59.122102+00:00"
}