{
    "status": "Fix Released", 
    "last_updated": "2014-10-16 08:29:03.487805+00:00", 
    "description": "We had a temporary outage of Neutron, and many instances got stuck in this state. 'nova delete' on them does not work until nova-compute is forcibly restarted.\n\n+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                                                                                                                                      |\n+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                                                                                                                                     |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                                                                                                                                       |\n| OS-EXT-SRV-ATTR:host                 | ci-overcloud-novacompute1-4q2dbhdklrkq                                                                                                                                                                                     |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | ci-overcloud-novacompute1-4q2dbhdklrkq.novalocal                                                                                                                                                                           |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00003f80                                                                                                                                                                                                          |\n| OS-EXT-STS:power_state               | 1                                                                                                                                                                                                                          |\n| OS-EXT-STS:task_state                | deleting                                                                                                                                                                                                                   |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                                                                                      |\n| OS-SRV-USG:launched_at               | 2014-03-05T03:54:49.000000                                                                                                                                                                                                 |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                                                                                          |\n| accessIPv4                           |                                                                                                                                                                                                                            |\n| accessIPv6                           |                                                                                                                                                                                                                            |\n| config_drive                         |                                                                                                                                                                                                                            |\n| created                              | 2014-03-05T03:46:25Z                                                                                                                                                                                                       |\n| default-net network                  | 10.0.58.225                                                                                                                                                                                                                |\n| fault                                | {\"message\": \"Connection to neutron failed: Maximum attempts reached\", \"code\": 500, \"details\": \"  File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 253, in decorated_function |\n|                                      |     return function(self, context, *args, **kwargs)                                                                                                                                                                        |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 2038, in terminate_instance                                                                                               |\n|                                      |     do_terminate_instance(instance, bdms)                                                                                                                                                                                  |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\\\", line 249, in inner                                                                                                  |\n|                                      |     return f(*args, **kwargs)                                                                                                                                                                                              |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 2036, in do_terminate_instance                                                                                            |\n|                                      |     self._set_instance_error_state(context, instance['uuid'])                                                                                                                                                              |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\\\", line 68, in __exit__                                                                                                 |\n|                                      |     six.reraise(self.type_, self.value, self.tb)                                                                                                                                                                           |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 2026, in do_terminate_instance                                                                                            |\n|                                      |     reservations=reservations)                                                                                                                                                                                             |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/hooks.py\\\", line 103, in inner                                                                                                                       |\n|                                      |     rv = f(*args, **kwargs)                                                                                                                                                                                                |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 2005, in _delete_instance                                                                                                 |\n|                                      |     user_id=user_id)                                                                                                                                                                                                       |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\\\", line 68, in __exit__                                                                                                 |\n|                                      |     six.reraise(self.type_, self.value, self.tb)                                                                                                                                                                           |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 1975, in _delete_instance                                                                                                 |\n|                                      |     self._shutdown_instance(context, db_inst, bdms)                                                                                                                                                                        |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 1884, in _shutdown_instance                                                                                               |\n|                                      |     network_info = self._get_instance_nw_info(context, instance)                                                                                                                                                           |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 902, in _get_instance_nw_info                                                                                             |\n|                                      |     instance)                                                                                                                                                                                                              |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/network/api.py\\\", line 48, in wrapper                                                                                                                |\n|                                      |     res = f(self, context, *args, **kwargs)                                                                                                                                                                                |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/network/neutronv2/api.py\\\", line 445, in get_instance_nw_info                                                                                        |\n|                                      |     result = self._get_instance_nw_info(context, instance, networks)                                                                                                                                                       |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/network/neutronv2/api.py\\\", line 452, in _get_instance_nw_info                                                                                       |\n|                                      |     nw_info = self._build_network_info_model(context, instance, networks)                                                                                                                                                  |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/network/neutronv2/api.py\\\", line 1010, in _build_network_info_model                                                                                  |\n|                                      |     data = client.list_ports(**search_opts)                                                                                                                                                                                |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 112, in with_params                                                                                                  |\n|                                      |     ret = self.function(instance, *args, **kwargs)                                                                                                                                                                         |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 307, in list_ports                                                                                                   |\n|                                      |     **_params)                                                                                                                                                                                                             |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 1251, in list                                                                                                        |\n|                                      |     for r in self._pagination(collection, path, **params):                                                                                                                                                                 |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 1264, in _pagination                                                                                                 |\n|                                      |     res = self.get(path, params=params)                                                                                                                                                                                    |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 1237, in get                                                                                                         |\n|                                      |     headers=headers, params=params)                                                                                                                                                                                        |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 1229, in retry_request                                                                                               |\n|                                      |     raise exceptions.ConnectionFailed(reason=_(\\\"Maximum attempts reached\\\"))                                                                                                                                              |\n|                                      | \", \"created\": \"2014-03-05T04:22:04Z\"}                                                                                                                                                                                      |\n| flavor                               | h1.large (872d8f61-c45a-45c3-87da-466d9f0f241b)                                                                                                                                                                            |\n| hostId                               | 0bab209cc6f26a8d5c4bc76e3da39d4fa68e5fefc6e5c0eada7a90d2                                                                                                                                                                   |\n| id                                   | ae9c75e3-51d2-43a3-8b20-34375b4c72d3                                                                                                                                                                                       |\n| image                                | tripleo-precise-1393812840.template.openstack.org (114e4b92-567e-4348-9ed8-e88281104208)                                                                                                                                   |\n| key_name                             | -                                                                                                                                                                                                                          |\n| metadata                             | {}                                                                                                                                                                                                                         |\n| name                                 | tripleo-precise-tripleo-test-cloud-2125650.slave.openstack.org                                                                                                                                                             |\n| os-extended-volumes:volumes_attached | []                                                                                                                                                                                                                         |\n| security_groups                      | default, default                                                                                                                                                                                                           |\n| status                               | ERROR                                                                                                                                                                                                                      |\n| tenant_id                            | 64d2d3bc07084ef1accd4e3502909c77                                                                                                                                                                                           |\n| tripleo-bm-test network              | 192.168.1.78                                                                                                                                                                                                               |\n| updated                              | 2014-03-05T04:22:04Z                                                                                                                                                                                                       |\n| user_id                              | 35ef3ce265cb4a25b5303f3daa143f4e                                                                                                                                                                                           |\n+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+", 
    "tags": [
        "network"
    ], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1288392", 
    "owner": "https://api.launchpad.net/1.0/~arosen", 
    "id": 1288392, 
    "index": 3821, 
    "openned": "2014-03-05 19:29:49.411953+00:00", 
    "created": "2014-03-05 19:29:49.411953+00:00", 
    "title": "instances get stuck in ERROR/deleting when Neutron is unavailable", 
    "comments": [
        {
            "content": "We had a temporary outage of Neutron, and many instances got stuck in this state. 'nova delete' on them does not work until nova-compute is forcibly restarted.\n\n+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                                                                                                                                      |\n+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                                                                                                                                     |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                                                                                                                                       |\n| OS-EXT-SRV-ATTR:host                 | ci-overcloud-novacompute1-4q2dbhdklrkq                                                                                                                                                                                     |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | ci-overcloud-novacompute1-4q2dbhdklrkq.novalocal                                                                                                                                                                           |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00003f80                                                                                                                                                                                                          |\n| OS-EXT-STS:power_state               | 1                                                                                                                                                                                                                          |\n| OS-EXT-STS:task_state                | deleting                                                                                                                                                                                                                   |\n| OS-EXT-STS:vm_state                  | error                                                                                                                                                                                                                      |\n| OS-SRV-USG:launched_at               | 2014-03-05T03:54:49.000000                                                                                                                                                                                                 |\n| OS-SRV-USG:terminated_at             | -                                                                                                                                                                                                                          |\n| accessIPv4                           |                                                                                                                                                                                                                            |\n| accessIPv6                           |                                                                                                                                                                                                                            |\n| config_drive                         |                                                                                                                                                                                                                            |\n| created                              | 2014-03-05T03:46:25Z                                                                                                                                                                                                       |\n| default-net network                  | 10.0.58.225                                                                                                                                                                                                                |\n| fault                                | {\"message\": \"Connection to neutron failed: Maximum attempts reached\", \"code\": 500, \"details\": \"  File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 253, in decorated_function |\n|                                      |     return function(self, context, *args, **kwargs)                                                                                                                                                                        |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 2038, in terminate_instance                                                                                               |\n|                                      |     do_terminate_instance(instance, bdms)                                                                                                                                                                                  |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/openstack/common/lockutils.py\\\", line 249, in inner                                                                                                  |\n|                                      |     return f(*args, **kwargs)                                                                                                                                                                                              |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 2036, in do_terminate_instance                                                                                            |\n|                                      |     self._set_instance_error_state(context, instance['uuid'])                                                                                                                                                              |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\\\", line 68, in __exit__                                                                                                 |\n|                                      |     six.reraise(self.type_, self.value, self.tb)                                                                                                                                                                           |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 2026, in do_terminate_instance                                                                                            |\n|                                      |     reservations=reservations)                                                                                                                                                                                             |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/hooks.py\\\", line 103, in inner                                                                                                                       |\n|                                      |     rv = f(*args, **kwargs)                                                                                                                                                                                                |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 2005, in _delete_instance                                                                                                 |\n|                                      |     user_id=user_id)                                                                                                                                                                                                       |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/openstack/common/excutils.py\\\", line 68, in __exit__                                                                                                 |\n|                                      |     six.reraise(self.type_, self.value, self.tb)                                                                                                                                                                           |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 1975, in _delete_instance                                                                                                 |\n|                                      |     self._shutdown_instance(context, db_inst, bdms)                                                                                                                                                                        |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 1884, in _shutdown_instance                                                                                               |\n|                                      |     network_info = self._get_instance_nw_info(context, instance)                                                                                                                                                           |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/compute/manager.py\\\", line 902, in _get_instance_nw_info                                                                                             |\n|                                      |     instance)                                                                                                                                                                                                              |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/network/api.py\\\", line 48, in wrapper                                                                                                                |\n|                                      |     res = f(self, context, *args, **kwargs)                                                                                                                                                                                |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/network/neutronv2/api.py\\\", line 445, in get_instance_nw_info                                                                                        |\n|                                      |     result = self._get_instance_nw_info(context, instance, networks)                                                                                                                                                       |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/network/neutronv2/api.py\\\", line 452, in _get_instance_nw_info                                                                                       |\n|                                      |     nw_info = self._build_network_info_model(context, instance, networks)                                                                                                                                                  |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/nova/network/neutronv2/api.py\\\", line 1010, in _build_network_info_model                                                                                  |\n|                                      |     data = client.list_ports(**search_opts)                                                                                                                                                                                |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 112, in with_params                                                                                                  |\n|                                      |     ret = self.function(instance, *args, **kwargs)                                                                                                                                                                         |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 307, in list_ports                                                                                                   |\n|                                      |     **_params)                                                                                                                                                                                                             |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 1251, in list                                                                                                        |\n|                                      |     for r in self._pagination(collection, path, **params):                                                                                                                                                                 |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 1264, in _pagination                                                                                                 |\n|                                      |     res = self.get(path, params=params)                                                                                                                                                                                    |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 1237, in get                                                                                                         |\n|                                      |     headers=headers, params=params)                                                                                                                                                                                        |\n|                                      |   File \\\"/opt/stack/venvs/nova/local/lib/python2.7/site-packages/neutronclient/v2_0/client.py\\\", line 1229, in retry_request                                                                                               |\n|                                      |     raise exceptions.ConnectionFailed(reason=_(\\\"Maximum attempts reached\\\"))                                                                                                                                              |\n|                                      | \", \"created\": \"2014-03-05T04:22:04Z\"}                                                                                                                                                                                      |\n| flavor                               | h1.large (872d8f61-c45a-45c3-87da-466d9f0f241b)                                                                                                                                                                            |\n| hostId                               | 0bab209cc6f26a8d5c4bc76e3da39d4fa68e5fefc6e5c0eada7a90d2                                                                                                                                                                   |\n| id                                   | ae9c75e3-51d2-43a3-8b20-34375b4c72d3                                                                                                                                                                                       |\n| image                                | tripleo-precise-1393812840.template.openstack.org (114e4b92-567e-4348-9ed8-e88281104208)                                                                                                                                   |\n| key_name                             | -                                                                                                                                                                                                                          |\n| metadata                             | {}                                                                                                                                                                                                                         |\n| name                                 | tripleo-precise-tripleo-test-cloud-2125650.slave.openstack.org                                                                                                                                                             |\n| os-extended-volumes:volumes_attached | []                                                                                                                                                                                                                         |\n| security_groups                      | default, default                                                                                                                                                                                                           |\n| status                               | ERROR                                                                                                                                                                                                                      |\n| tenant_id                            | 64d2d3bc07084ef1accd4e3502909c77                                                                                                                                                                                           |\n| tripleo-bm-test network              | 192.168.1.78                                                                                                                                                                                                               |\n| updated                              | 2014-03-05T04:22:04Z                                                                                                                                                                                                       |\n| user_id                              | 35ef3ce265cb4a25b5303f3daa143f4e                                                                                                                                                                                           |\n+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+", 
            "date_created": "2014-03-05 19:29:49.411953+00:00", 
            "author": "https://api.launchpad.net/1.0/~clint-fewbar"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/80760", 
            "date_created": "2014-03-15 07:12:34.272370+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/80760\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c47900064f2f3b4384cfa3fd6fe21f452514fa36\nSubmitter: Jenkins\nBranch:    master\n\ncommit c47900064f2f3b4384cfa3fd6fe21f452514fa36\nAuthor: Aaron Rosen <email address hidden>\nDate:   Fri Mar 14 23:50:57 2014 -0700\n\n    Remove unneeded call to fetch network info on shutdown\n    \n    There is no reason to fetch the network_info from the network api on shutdown\n    since we can just pull it out of the local cache. There are probably other\n    places where this call to the network api call can be removed but this patch\n    just handles the case for shutdown.\n    \n    Note: the following test was removed 'test_terminate_no_fixed_ips' as\n    the call to the network api is no longer done so this test would be the\n    same as test_terminate_no_network.\n    \n    Closes-bug: #1288392\n    \n    Change-Id: Ifbf751739c215e566926719f481c03e2c064163a\n", 
            "date_created": "2014-04-17 02:40:51.096170+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Fix proposed to branch: stable/icehouse\nReview: https://review.openstack.org/89645", 
            "date_created": "2014-04-22 17:06:41.348038+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/89645\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=c816488776e19beac3da3f45d45c5773c0439146\nSubmitter: Jenkins\nBranch:    stable/icehouse\n\ncommit c816488776e19beac3da3f45d45c5773c0439146\nAuthor: Aaron Rosen <email address hidden>\nDate:   Fri Mar 14 23:50:57 2014 -0700\n\n    Remove unneeded call to fetch network info on shutdown\n    \n    There is no reason to fetch the network_info from the network api on shutdown\n    since we can just pull it out of the local cache. There are probably other\n    places where this call to the network api call can be removed but this patch\n    just handles the case for shutdown.\n    \n    Note: the following test was removed 'test_terminate_no_fixed_ips' as\n    the call to the network api is no longer done so this test would be the\n    same as test_terminate_no_network.\n    \n    Closes-bug: #1288392\n    \n    Change-Id: Ifbf751739c215e566926719f481c03e2c064163a\n    (cherry picked from commit c47900064f2f3b4384cfa3fd6fe21f452514fa36)\n", 
            "date_created": "2014-04-27 09:22:10.726690+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }
    ], 
    "closed": "2014-06-11 13:44:01.191173+00:00"
}