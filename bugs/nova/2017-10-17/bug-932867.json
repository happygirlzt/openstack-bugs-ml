{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:09:23.427279+00:00", 
    "description": "it possible to reuse the id of a deleted flavor but it's not possible to create a flavor with the name of a deleted one.\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create test 100 100 100 100\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-list\n+-----+-----------+-----------+------+----------+-------+-------------+\n|  ID |    Name   | Memory_MB | Swap | Local_GB | VCPUs | RXTX_Factor |\n+-----+-----------+-----------+------+----------+-------+-------------+\n| 100 | test      | 100       |      | 100      | 100   | 1.0         |\n| 2   | m1.small  | 2048      |      | 10       | 1     | 1.0         |\n| 3   | m1.medium | 4096      |      | 10       | 2     | 1.0         |\n| 4   | m1.large  | 8192      |      | 10       | 4     | 1.0         |\n| 5   | m1.xlarge | 16384     |      | 10       | 8     | 1.0         |\n+-----+-----------+-----------+------+----------+-------+-------------+\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-delete 100\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create test 100 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create testtest 100 100 100 100\n+-----+----------+-----------+------+----------+-------+-------------+\n|  ID |   Name   | Memory_MB | Swap | Local_GB | VCPUs | RXTX_Factor |\n+-----+----------+-----------+------+----------+-------+-------------+\n| 100 | testtest | 100       |      | 100      | 100   | 1           |\n+-----+----------+-----------+------+----------+-------+-------------+\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-delete 100\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create test 100 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create testtest 100 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create testtest 101 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create test 101 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\n\n\nthis is the stacktrace on nova-api:\n\n2012-02-15 17:26:16,932 ERROR nova.exception [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea 0f0bbc8563a44a6a880c0c1ad85d5e79] DB exception wrapped.\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line 103, in _wrap\n(nova.exception): TRACE:     return f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1400, in flush\n(nova.exception): TRACE:     self._flush(objects)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1481, in _flush\n(nova.exception): TRACE:     flush_context.execute()\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 302, in execute\n(nova.exception): TRACE:     rec.execute(self)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 446, in execute\n(nova.exception): TRACE:     uow\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 1887, in _save_obj\n(nova.exception): TRACE:     execute(statement, params)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1191, in execute\n(nova.exception): TRACE:     params)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1271, in _execute_clauseelement\n(nova.exception): TRACE:     return self.__execute_context(context)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1302, in __execute_context\n(nova.exception): TRACE:     context.parameters[0], context=context)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1401, in _cursor_execute\n(nova.exception): TRACE:     context)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1394, in _cursor_execute\n(nova.exception): TRACE:     context)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 299, in do_execute\n(nova.exception): TRACE:     cursor.execute(statement, parameters)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/MySQLdb/cursors.py\", line 174, in execute\n(nova.exception): TRACE:     self.errorhandler(self, exc, value)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n(nova.exception): TRACE:     raise errorclass, errorvalue\n(nova.exception): TRACE: IntegrityError: (IntegrityError) (1062, \"Duplicate entry 'test' for key 'instance_types_name_key'\") 'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, root_gb, ephemeral_gb, flavorid, swap, rxtx_factor, vcpu_weight) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2012, 2, 15, 16, 26, 16, 931158), None, None, 0, u'test', 100, 100, 100, 100, 101, 0, 1, None)\n(nova.exception): TRACE:\n2012-02-15 17:26:16,936 ERROR nova.compute.instance_types [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea 0f0bbc8563a44a6a880c0c1ad85d5e79] DB error: (IntegrityError) (1062, \"Duplicate entry 'test' for key 'instance_types_name_key'\") 'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, root_gb, ephemeral_gb, flavorid, swap, rxtx_factor, vcpu_weight) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2012, 2, 15, 16, 26, 16, 931158), None, None, 0, u'test', 100, 100, 100, 100, 101, 0, 1, None)\n\n2012-02-15 17:26:16,937 ERROR nova.api.openstack [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea 0f0bbc8563a44a6a880c0c1ad85d5e79] Caught error: Unable to create instance type\n(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 41, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 345, in __call__\n(nova.api.openstack): TRACE:     return self._forward_request(env, start_response, proxy_headers)\n(nova.api.openstack): TRACE:   File \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 608, in _forward_request\n(nova.api.openstack): TRACE:     return self.app(env, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 786, in __call__\n(nova.api.openstack): TRACE:     content_type, body, accept)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 834, in _process_stack\n(nova.api.openstack): TRACE:     action_result = self.dispatch(meth, request, action_args)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 910, in dispatch\n(nova.api.openstack): TRACE:     return method(req=request, **action_args)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/flavormanage.py\", line 71, in _create\n(nova.api.openstack): TRACE:     swap, rxtx_factor)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/compute/instance_types.py\", line 75, in create\n(nova.api.openstack): TRACE:     raise exception.InstanceTypeCreateFailed()\n(nova.api.openstack): TRACE: InstanceTypeCreateFailed: Unable to create instance type\n(nova.api.openstack): TRACE:", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/932867", 
    "owner": "https://api.launchpad.net/1.0/~bcwaldon", 
    "id": 932867, 
    "index": 581, 
    "openned": "2012-02-15 16:31:07.053187+00:00", 
    "created": "2012-02-15 16:31:07.053187+00:00", 
    "title": "creation of flavors with name of a deleted flavor is not possible", 
    "comments": [
        {
            "content": "it possible to reuse the id of a deleted flavor but it's not possible to create a flavor with the name of a deleted one.\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create test 100 100 100 100\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-list\n+-----+-----------+-----------+------+----------+-------+-------------+\n|  ID |    Name   | Memory_MB | Swap | Local_GB | VCPUs | RXTX_Factor |\n+-----+-----------+-----------+------+----------+-------+-------------+\n| 100 | test      | 100       |      | 100      | 100   | 1.0         |\n| 2   | m1.small  | 2048      |      | 10       | 1     | 1.0         |\n| 3   | m1.medium | 4096      |      | 10       | 2     | 1.0         |\n| 4   | m1.large  | 8192      |      | 10       | 4     | 1.0         |\n| 5   | m1.xlarge | 16384     |      | 10       | 8     | 1.0         |\n+-----+-----------+-----------+------+----------+-------+-------------+\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-delete 100\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create test 100 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create testtest 100 100 100 100\n+-----+----------+-----------+------+----------+-------+-------------+\n|  ID |   Name   | Memory_MB | Swap | Local_GB | VCPUs | RXTX_Factor |\n+-----+----------+-----------+------+----------+-------+-------------+\n| 100 | testtest | 100       |      | 100      | 100   | 1           |\n+-----+----------+-----------+------+----------+-------+-------------+\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-delete 100\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create test 100 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create testtest 100 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\n\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create testtest 101 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\nstack@devstack001:~/devstack$ nova --username admin --password testing flavor-create test 101 100 100 100\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\n\n\nthis is the stacktrace on nova-api:\n\n2012-02-15 17:26:16,932 ERROR nova.exception [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea 0f0bbc8563a44a6a880c0c1ad85d5e79] DB exception wrapped.\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line 103, in _wrap\n(nova.exception): TRACE:     return f(*args, **kwargs)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1400, in flush\n(nova.exception): TRACE:     self._flush(objects)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1481, in _flush\n(nova.exception): TRACE:     flush_context.execute()\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 302, in execute\n(nova.exception): TRACE:     rec.execute(self)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 446, in execute\n(nova.exception): TRACE:     uow\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 1887, in _save_obj\n(nova.exception): TRACE:     execute(statement, params)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1191, in execute\n(nova.exception): TRACE:     params)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1271, in _execute_clauseelement\n(nova.exception): TRACE:     return self.__execute_context(context)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1302, in __execute_context\n(nova.exception): TRACE:     context.parameters[0], context=context)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1401, in _cursor_execute\n(nova.exception): TRACE:     context)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1394, in _cursor_execute\n(nova.exception): TRACE:     context)\n(nova.exception): TRACE:   File \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 299, in do_execute\n(nova.exception): TRACE:     cursor.execute(statement, parameters)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/MySQLdb/cursors.py\", line 174, in execute\n(nova.exception): TRACE:     self.errorhandler(self, exc, value)\n(nova.exception): TRACE:   File \"/usr/lib/pymodules/python2.7/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n(nova.exception): TRACE:     raise errorclass, errorvalue\n(nova.exception): TRACE: IntegrityError: (IntegrityError) (1062, \"Duplicate entry 'test' for key 'instance_types_name_key'\") 'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, root_gb, ephemeral_gb, flavorid, swap, rxtx_factor, vcpu_weight) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2012, 2, 15, 16, 26, 16, 931158), None, None, 0, u'test', 100, 100, 100, 100, 101, 0, 1, None)\n(nova.exception): TRACE:\n2012-02-15 17:26:16,936 ERROR nova.compute.instance_types [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea 0f0bbc8563a44a6a880c0c1ad85d5e79] DB error: (IntegrityError) (1062, \"Duplicate entry 'test' for key 'instance_types_name_key'\") 'INSERT INTO instance_types (created_at, updated_at, deleted_at, deleted, name, memory_mb, vcpus, root_gb, ephemeral_gb, flavorid, swap, rxtx_factor, vcpu_weight) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)' (datetime.datetime(2012, 2, 15, 16, 26, 16, 931158), None, None, 0, u'test', 100, 100, 100, 100, 101, 0, 1, None)\n\n2012-02-15 17:26:16,937 ERROR nova.api.openstack [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea 0f0bbc8563a44a6a880c0c1ad85d5e79] Caught error: Unable to create instance type\n(nova.api.openstack): TRACE: Traceback (most recent call last):\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 41, in __call__\n(nova.api.openstack): TRACE:     return req.get_response(self.application)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack): TRACE:   File \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 345, in __call__\n(nova.api.openstack): TRACE:     return self._forward_request(env, start_response, proxy_headers)\n(nova.api.openstack): TRACE:   File \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 608, in _forward_request\n(nova.api.openstack): TRACE:     return self.app(env, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack): TRACE:     return resp(environ, start_response)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 786, in __call__\n(nova.api.openstack): TRACE:     content_type, body, accept)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 834, in _process_stack\n(nova.api.openstack): TRACE:     action_result = self.dispatch(meth, request, action_args)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 910, in dispatch\n(nova.api.openstack): TRACE:     return method(req=request, **action_args)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/api/openstack/compute/contrib/flavormanage.py\", line 71, in _create\n(nova.api.openstack): TRACE:     swap, rxtx_factor)\n(nova.api.openstack): TRACE:   File \"/opt/stack/nova/nova/compute/instance_types.py\", line 75, in create\n(nova.api.openstack): TRACE:     raise exception.InstanceTypeCreateFailed()\n(nova.api.openstack): TRACE: InstanceTypeCreateFailed: Unable to create instance type\n(nova.api.openstack): TRACE:", 
            "date_created": "2012-02-15 16:31:07.053187+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "Can you verify your db type and the version of nova that you are using?\n\nThis migration is supposed to remove that key:\n\nnova/db/sqlalchemy/migrate_repo/versions/076_remove_unique_constraints.py\n\nin my testing that constraint was called 'name' but it looks like for you it is called 'instance_types_name_key'\n\nwe might need to update migration 76 further.", 
            "date_created": "2012-02-15 17:05:14.677827+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Verified on latest nova trunk (db ver 77):\n\nroot@ravenas:~/devstack# nova flavor-create m2.4 24 128 5 1\n+----+------+-----------+------+----------+-------+-------------+\n| ID | Name | Memory_MB | Swap | Local_GB | VCPUs | RXTX_Factor |\n+----+------+-----------+------+----------+-------+-------------+\n| 24 | m2.4 | 128       |      | 5        | 1     | 1           |\n+----+------+-----------+------+----------+-------+-------------+\nroot@ravenas:~/devstack# nova flavor-delete 24\nroot@ravenas:~/devstack# nova flavor-create m2.4 24 128 5 1\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\nroot@ravenas:~/devstack# nova flavor-create m2.4 25 128 5 1\nERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500)\nroot@ravenas:~/devstack# nova flavor-create m2.5 24 128 5 1\n+----+------+-----------+------+----------+-------+-------------+\n| ID | Name | Memory_MB | Swap | Local_GB | VCPUs | RXTX_Factor |\n+----+------+-----------+------+----------+-------+-------------+\n| 24 | m2.5 | 128       |      | 5        | 1     | 1           |\n+----+------+-----------+------+----------+-------+-------------+\n", 
            "date_created": "2012-02-15 17:38:38.602574+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "I tested this on a fresh devstack environment. db version is 77 there.", 
            "date_created": "2012-02-15 19:55:40.838296+00:00", 
            "author": "https://api.launchpad.net/1.0/~berendt"
        }, 
        {
            "content": "So it looks like the constraint in my table is 'instance_types_name_key', but migration 76 tried to delete a constraint identified by 'name'. Vish, how did you figure out how to get a handle on the constraints when you originally wrote the migration?", 
            "date_created": "2012-02-15 23:03:33.689679+00:00", 
            "author": "https://api.launchpad.net/1.0/~bcwaldon"
        }, 
        {
            "content": "I just listed the names of the constraints in mysql by showing the table. I\nmany have misread it.\nOn Feb 15, 2012 3:10 PM, \"Brian Waldon\" <email address hidden> wrote:\n\n> So it looks like the constraint in my table is\n> 'instance_types_name_key', but migration 76 tried to delete a constraint\n> identified by 'name'. Vish, how did you figure out how to get a handle\n> on the constraints when you originally wrote the migration?\n>\n> --\n> You received this bug notification because you are subscribed to\n> OpenStack Compute (nova).\n> https://bugs.launchpad.net/bugs/932867\n>\n> Title:\n>  creation of flavors with name of a deleted flavor is not possible\n>\n> Status in OpenStack Compute (Nova):\n>  In Progress\n>\n> Bug description:\n>  it possible to reuse the id of a deleted flavor but it's not possible\n>  to create a flavor with the name of a deleted one.\n>\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n>  flavor-create test 100 100 100 100\n>\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n> flavor-list\n>  +-----+-----------+-----------+------+----------+-------+-------------+\n>  |  ID |    Name   | Memory_MB | Swap | Local_GB | VCPUs | RXTX_Factor |\n>  +-----+-----------+-----------+------+----------+-------+-------------+\n>  | 100 | test      | 100       |      | 100      | 100   | 1.0         |\n>  | 2   | m1.small  | 2048      |      | 10       | 1     | 1.0         |\n>  | 3   | m1.medium | 4096      |      | 10       | 2     | 1.0         |\n>  | 4   | m1.large  | 8192      |      | 10       | 4     | 1.0         |\n>  | 5   | m1.xlarge | 16384     |      | 10       | 8     | 1.0         |\n>  +-----+-----------+-----------+------+----------+-------+-------------+\n>\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n>  flavor-delete 100\n>\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n> flavor-create test 100 100 100 100\n>  ERROR: The server has either erred or is incapable of performing the\n> requested operation. (HTTP 500)\n>\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n> flavor-create testtest 100 100 100 100\n>  +-----+----------+-----------+------+----------+-------+-------------+\n>  |  ID |   Name   | Memory_MB | Swap | Local_GB | VCPUs | RXTX_Factor |\n>  +-----+----------+-----------+------+----------+-------+-------------+\n>  | 100 | testtest | 100       |      | 100      | 100   | 1           |\n>  +-----+----------+-----------+------+----------+-------+-------------+\n>\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n>  flavor-delete 100\n>\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n> flavor-create test 100 100 100 100\n>  ERROR: The server has either erred or is incapable of performing the\n> requested operation. (HTTP 500)\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n> flavor-create testtest 100 100 100 100\n>  ERROR: The server has either erred or is incapable of performing the\n> requested operation. (HTTP 500)\n>\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n> flavor-create testtest 101 100 100 100\n>  ERROR: The server has either erred or is incapable of performing the\n> requested operation. (HTTP 500)\n>  stack@devstack001:~/devstack$ nova --username admin --password testing\n> flavor-create test 101 100 100 100\n>  ERROR: The server has either erred or is incapable of performing the\n> requested operation. (HTTP 500)\n>\n>\n>  this is the stacktrace on nova-api:\n>\n>  2012-02-15 17:26:16,932 ERROR nova.exception\n> [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea\n> 0f0bbc8563a44a6a880c0c1ad85d5e79] DB exception wrapped.\n>  (nova.exception): TRACE: Traceback (most recent call last):\n>  (nova.exception): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line\n> 103, in _wrap\n>  (nova.exception): TRACE:     return f(*args, **kwargs)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1400, in\n> flush\n>  (nova.exception): TRACE:     self._flush(objects)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py\", line 1481, in\n> _flush\n>  (nova.exception): TRACE:     flush_context.execute()\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 302,\n> in execute\n>  (nova.exception): TRACE:     rec.execute(self)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py\", line 446,\n> in execute\n>  (nova.exception): TRACE:     uow\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/orm/mapper.py\", line 1887, in\n> _save_obj\n>  (nova.exception): TRACE:     execute(statement, params)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1191, in\n> execute\n>  (nova.exception): TRACE:     params)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1271, in\n> _execute_clauseelement\n>  (nova.exception): TRACE:     return self.__execute_context(context)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1302, in\n> __execute_context\n>  (nova.exception): TRACE:     context.parameters[0], context=context)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1401, in\n> _cursor_execute\n>  (nova.exception): TRACE:     context)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py\", line 1394, in\n> _cursor_execute\n>  (nova.exception): TRACE:     context)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py\", line 299,\n> in do_execute\n>  (nova.exception): TRACE:     cursor.execute(statement, parameters)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/pymodules/python2.7/MySQLdb/cursors.py\", line 174, in execute\n>  (nova.exception): TRACE:     self.errorhandler(self, exc, value)\n>  (nova.exception): TRACE:   File\n> \"/usr/lib/pymodules/python2.7/MySQLdb/connections.py\", line 36, in\n> defaulterrorhandler\n>  (nova.exception): TRACE:     raise errorclass, errorvalue\n>  (nova.exception): TRACE: IntegrityError: (IntegrityError) (1062,\n> \"Duplicate entry 'test' for key 'instance_types_name_key'\") 'INSERT INTO\n> instance_types (created_at, updated_at, deleted_at, deleted, name,\n> memory_mb, vcpus, root_gb, ephemeral_gb, flavorid, swap, rxtx_factor,\n> vcpu_weight) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)'\n> (datetime.datetime(2012, 2, 15, 16, 26, 16, 931158), None, None, 0,\n> u'test', 100, 100, 100, 100, 101, 0, 1, None)\n>  (nova.exception): TRACE:\n>  2012-02-15 17:26:16,936 ERROR nova.compute.instance_types\n> [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea\n> 0f0bbc8563a44a6a880c0c1ad85d5e79] DB error: (IntegrityError) (1062,\n> \"Duplicate entry 'test' for key 'instance_types_name_key'\") 'INSERT INTO\n> instance_types (created_at, updated_at, deleted_at, deleted, name,\n> memory_mb, vcpus, root_gb, ephemeral_gb, flavorid, swap, rxtx_factor,\n> vcpu_weight) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)'\n> (datetime.datetime(2012, 2, 15, 16, 26, 16, 931158), None, None, 0,\n> u'test', 100, 100, 100, 100, 101, 0, 1, None)\n>\n>  2012-02-15 17:26:16,937 ERROR nova.api.openstack\n> [req-7a175400-9aa5-4272-ac17-8fa66ebaf1f3 4599637aa20740d2a59a2621948bcdea\n> 0f0bbc8563a44a6a880c0c1ad85d5e79] Caught error: Unable to create instance\n> type\n>  (nova.api.openstack): TRACE: Traceback (most recent call last):\n>  (nova.api.openstack): TRACE:   File\n> \"/opt/stack/nova/nova/api/openstack/__init__.py\", line 41, in __call__\n>  (nova.api.openstack): TRACE:     return req.get_response(self.application)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in\n> get_response\n>  (nova.api.openstack): TRACE:     application, catch_exc_info=False)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in\n> call_application\n>  (nova.api.openstack): TRACE:     app_iter = application(self.environ,\n> start_response)\n>  (nova.api.openstack): TRACE:   File\n> \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 345, in\n> __call__\n>  (nova.api.openstack): TRACE:     return self._forward_request(env,\n> start_response, proxy_headers)\n>  (nova.api.openstack): TRACE:   File\n> \"/opt/stack/keystone/keystone/middleware/auth_token.py\", line 608, in\n> _forward_request\n>  (nova.api.openstack): TRACE:     return self.app(env, start_response)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n>  (nova.api.openstack): TRACE:     return resp(environ, start_response)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n>  (nova.api.openstack): TRACE:     return resp(environ, start_response)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n>  (nova.api.openstack): TRACE:     return resp(environ, start_response)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n>  (nova.api.openstack): TRACE:     response = self.app(environ,\n> start_response)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n>  (nova.api.openstack): TRACE:     return resp(environ, start_response)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n>  (nova.api.openstack): TRACE:     resp = self.call_func(req, *args,\n> **self.kwargs)\n>  (nova.api.openstack): TRACE:   File\n> \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n>  (nova.api.openstack): TRACE:     return self.func(req, *args, **kwargs)\n>  (nova.api.openstack): TRACE:   File\n> \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 786, in __call__\n>  (nova.api.openstack): TRACE:     content_type, body, accept)\n>  (nova.api.openstack): TRACE:   File\n> \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 834, in _process_stack\n>  (nova.api.openstack): TRACE:     action_result = self.dispatch(meth,\n> request, action_args)\n>  (nova.api.openstack): TRACE:   File\n> \"/opt/stack/nova/nova/api/openstack/wsgi.py\", line 910, in dispatch\n>  (nova.api.openstack): TRACE:     return method(req=request, **action_args)\n>  (nova.api.openstack): TRACE:   File\n> \"/opt/stack/nova/nova/api/openstack/compute/contrib/flavormanage.py\", line\n> 71, in _create\n>  (nova.api.openstack): TRACE:     swap, rxtx_factor)\n>  (nova.api.openstack): TRACE:   File\n> \"/opt/stack/nova/nova/compute/instance_types.py\", line 75, in create\n>  (nova.api.openstack): TRACE:     raise\n> exception.InstanceTypeCreateFailed()\n>  (nova.api.openstack): TRACE: InstanceTypeCreateFailed: Unable to create\n> instance type\n>  (nova.api.openstack): TRACE:\n>\n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/932867/+subscriptions\n>\n", 
            "date_created": "2012-02-16 01:31:07+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/4264", 
            "date_created": "2012-02-17 00:35:11.070050+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/4264\nCommitted: http://github.com/openstack/nova/commit/e35cc0baed1024cdf7663e144a28e06c1f4e5d2e\nSubmitter: Jenkins\nBranch:    master\n\ncommit e35cc0baed1024cdf7663e144a28e06c1f4e5d2e\nAuthor: Brian Waldon <email address hidden>\nDate:   Thu Feb 16 16:26:49 2012 -0800\n\n    Remove all uniqueness constraints in migration 76\n    \n    Fixes bug 932867\n    \n    Change-Id: I5b72af7c36cc07ee4f3e23566ed4e91c0c53b10b\n", 
            "date_created": "2012-02-17 16:26:28.186689+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-02-29 10:21:27.827208+00:00"
}