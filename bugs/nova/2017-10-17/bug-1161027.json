{
    "status": "Fix Released", 
    "last_updated": "2013-04-04 11:24:49.002840+00:00", 
    "description": "if /etc/nova/nova.conf includes the line:\n\ndhcp_domain = \"\"\n\nThen nova-network crashes, because --dhcp-domain= is not a valid argument to pass to dnsmasq. The following is seen in the logs under this circumstance:\n\n2013-03-27 11:49:26    DEBUG [nova.utils] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf env CONFIG_FILE=[\"/etc/nova/nova.conf\"] NETWORK_ID=1 dnsmasq --strict-order --bind-interfaces --conf-file= --domain= --pid-file=/opt/stack/grizzly/data/nova/networks/nova-br100.pid --listen-address=10.4.128.1 --except-interface=lo --dhcp-range=set:private,10.4.128.2,static,120s --dhcp-lease-max=4096 --dhcp-hostsfile=/opt/stack/grizzly/data/nova/networks/nova-br100.conf --dhcp-script=/opt/stack/grizzly/nova/bin/nova-dhcpbridge --leasefile-ro\n2013-03-27 11:49:27    DEBUG [nova.utils] Result was 1\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 346, in fire_timers\n    timer()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 147, in run_server\n    server.start()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 429, in start\n    self.manager.init_host()\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 1604, in init_host\n    super(FlatDHCPManager, self).init_host()\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 346, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 1619, in _setup_network_on_host\n    self.driver.update_dhcp(elevated, dev, network)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 938, in update_dhcp\n    _execute(*cmd, run_as_root=True)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 1141, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/utils.py\", line 239, in execute\n    cmd=' '.join(cmd))\nProcessExecutionError: Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf env CONFIG_FILE=[\"/etc/nova/nova.conf\"] NETWORK_ID=1 dnsmasq --strict-order --bind-interfaces --conf-file= --domain= --pid-file=/opt/stack/grizzly/data/nova/networks/nova-br100.pid --listen-address=10.4.128.1 --except-interface=lo --dhcp-range=set:private,10.4.128.2,static,120s --dhcp-lease-max=4096 --dhcp-hostsfile=/opt/stack/grizzly/data/nova/networks/nova-br100.conf --dhcp-script=/opt/stack/grizzly/nova/bin/nova-dhcpbridge --leasefile-ro\nExit code: 1\nStdout: ''\nStderr: '\\ndnsmasq: bad command line options: try --help\\n'\n2013-03-27 11:49:27 CRITICAL [nova] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf env CONFIG_FILE=[\"/etc/nova/nova.conf\"] NETWORK_ID=1 dnsmasq --strict-order --bind-interfaces --conf-file= --domain= --pid-file=/opt/stack/grizzly/data/nova/networks/nova-br100.pid --listen-address=10.4.128.1 --except-interface=lo --dhcp-range=set:private,10.4.128.2,static,120s --dhcp-lease-max=4096 --dhcp-hostsfile=/opt/stack/grizzly/data/nova/networks/nova-br100.conf --dhcp-script=/opt/stack/grizzly/nova/bin/nova-dhcpbridge --leasefile-ro\nExit code: 1\nStdout: ''\nStderr: '\\ndnsmasq: bad command line options: try --help\\n'\nTraceback (most recent call last):\n  File \"/usr/local/bin/nova-network\", line 7, in <module>\n    execfile(__file__)\n  File \"/opt/stack/grizzly/nova/bin/nova-network\", line 54, in <module>\n    service.wait()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 689, in wait\n    _launcher.wait()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 209, in wait\n    super(ServiceLauncher, self).wait()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 179, in wait\n    service.wait()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n    return self._exit_event.wait()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n    return hubs.get_hub().switch()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n    return self.greenlet.switch()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 147, in run_server\n    server.start()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 429, in start\n    self.manager.init_host()\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 1604, in init_host\n    super(FlatDHCPManager, self).init_host()\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 346, in init_host\n    self._setup_network_on_host(ctxt, network)  \n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 1619, in _setup_network_on_host\n    self.driver.update_dhcp(elevated, dev, network)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 938, in update_dhcp\n    restart_dhcp(context, dev, network_ref)\n  File \"/opt/stack/grizzly/nova/nova/openstack/common/lockutils.py\", line 242, in inner\n    retval = f(*args, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 1048, in restart_dhcp\n    _execute(*cmd, run_as_root=True)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 1141, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/utils.py\", line 239, in execute\n    cmd=' '.join(cmd))\nProcessExecutionError: Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf env CONFIG_FILE=[\"/etc/nova/nova.conf\"] NETWORK_ID=1 dnsmasq --strict-order --bind-interfaces --conf-file= --domain= --pid-file=/opt/stack/grizzly/data/nova/networks/nova-br100.pid --listen-address=10.4.128.1 --except-interface=lo --dhcp-range=set:private,10.4.128.2,static,120s --dhcp-lease-max=4096 --dhcp-hostsfile=/opt/stack/grizzly/data/nova/networks/nova-br100.conf --dhcp-script=/opt/stack/grizzly/nova/bin/nova-dhcpbridge --leasefile-ro\nExit code: 1\nStdout: ''\nStderr: '\\ndnsmasq: bad command line options: try --help\\n'", 
    "tags": [], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1161027", 
    "owner": "https://api.launchpad.net/1.0/~sdague", 
    "id": 1161027, 
    "index": 1042, 
    "openned": "2013-03-27 17:19:24.651578+00:00", 
    "created": "2013-03-27 17:19:24.651578+00:00", 
    "title": "nova-network crashes if dhcp_domain = ''", 
    "comments": [
        {
            "content": "if /etc/nova/nova.conf includes the line:\n\ndhcp_domain = \"\"\n\nThen nova-network crashes, because --dhcp-domain= is not a valid argument to pass to dnsmasq. The following is seen in the logs under this circumstance:\n\n2013-03-27 11:49:26    DEBUG [nova.utils] Running cmd (subprocess): sudo nova-rootwrap /etc/nova/rootwrap.conf env CONFIG_FILE=[\"/etc/nova/nova.conf\"] NETWORK_ID=1 dnsmasq --strict-order --bind-interfaces --conf-file= --domain= --pid-file=/opt/stack/grizzly/data/nova/networks/nova-br100.pid --listen-address=10.4.128.1 --except-interface=lo --dhcp-range=set:private,10.4.128.2,static,120s --dhcp-lease-max=4096 --dhcp-hostsfile=/opt/stack/grizzly/data/nova/networks/nova-br100.conf --dhcp-script=/opt/stack/grizzly/nova/bin/nova-dhcpbridge --leasefile-ro\n2013-03-27 11:49:27    DEBUG [nova.utils] Result was 1\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 346, in fire_timers\n    timer()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/timer.py\", line 56, in __call__\n    cb(*args, **kw)\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 147, in run_server\n    server.start()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 429, in start\n    self.manager.init_host()\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 1604, in init_host\n    super(FlatDHCPManager, self).init_host()\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 346, in init_host\n    self._setup_network_on_host(ctxt, network)\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 1619, in _setup_network_on_host\n    self.driver.update_dhcp(elevated, dev, network)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 938, in update_dhcp\n    _execute(*cmd, run_as_root=True)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 1141, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/utils.py\", line 239, in execute\n    cmd=' '.join(cmd))\nProcessExecutionError: Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf env CONFIG_FILE=[\"/etc/nova/nova.conf\"] NETWORK_ID=1 dnsmasq --strict-order --bind-interfaces --conf-file= --domain= --pid-file=/opt/stack/grizzly/data/nova/networks/nova-br100.pid --listen-address=10.4.128.1 --except-interface=lo --dhcp-range=set:private,10.4.128.2,static,120s --dhcp-lease-max=4096 --dhcp-hostsfile=/opt/stack/grizzly/data/nova/networks/nova-br100.conf --dhcp-script=/opt/stack/grizzly/nova/bin/nova-dhcpbridge --leasefile-ro\nExit code: 1\nStdout: ''\nStderr: '\\ndnsmasq: bad command line options: try --help\\n'\n2013-03-27 11:49:27 CRITICAL [nova] Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf env CONFIG_FILE=[\"/etc/nova/nova.conf\"] NETWORK_ID=1 dnsmasq --strict-order --bind-interfaces --conf-file= --domain= --pid-file=/opt/stack/grizzly/data/nova/networks/nova-br100.pid --listen-address=10.4.128.1 --except-interface=lo --dhcp-range=set:private,10.4.128.2,static,120s --dhcp-lease-max=4096 --dhcp-hostsfile=/opt/stack/grizzly/data/nova/networks/nova-br100.conf --dhcp-script=/opt/stack/grizzly/nova/bin/nova-dhcpbridge --leasefile-ro\nExit code: 1\nStdout: ''\nStderr: '\\ndnsmasq: bad command line options: try --help\\n'\nTraceback (most recent call last):\n  File \"/usr/local/bin/nova-network\", line 7, in <module>\n    execfile(__file__)\n  File \"/opt/stack/grizzly/nova/bin/nova-network\", line 54, in <module>\n    service.wait()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 689, in wait\n    _launcher.wait()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 209, in wait\n    super(ServiceLauncher, self).wait()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 179, in wait\n    service.wait()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n    return self._exit_event.wait()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n    return hubs.get_hub().switch()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n    return self.greenlet.switch()\n  File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n    result = function(*args, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 147, in run_server\n    server.start()\n  File \"/opt/stack/grizzly/nova/nova/service.py\", line 429, in start\n    self.manager.init_host()\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 1604, in init_host\n    super(FlatDHCPManager, self).init_host()\n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 346, in init_host\n    self._setup_network_on_host(ctxt, network)  \n  File \"/opt/stack/grizzly/nova/nova/network/manager.py\", line 1619, in _setup_network_on_host\n    self.driver.update_dhcp(elevated, dev, network)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 938, in update_dhcp\n    restart_dhcp(context, dev, network_ref)\n  File \"/opt/stack/grizzly/nova/nova/openstack/common/lockutils.py\", line 242, in inner\n    retval = f(*args, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 1048, in restart_dhcp\n    _execute(*cmd, run_as_root=True)\n  File \"/opt/stack/grizzly/nova/nova/network/linux_net.py\", line 1141, in _execute\n    return utils.execute(*cmd, **kwargs)\n  File \"/opt/stack/grizzly/nova/nova/utils.py\", line 239, in execute\n    cmd=' '.join(cmd))\nProcessExecutionError: Unexpected error while running command.\nCommand: sudo nova-rootwrap /etc/nova/rootwrap.conf env CONFIG_FILE=[\"/etc/nova/nova.conf\"] NETWORK_ID=1 dnsmasq --strict-order --bind-interfaces --conf-file= --domain= --pid-file=/opt/stack/grizzly/data/nova/networks/nova-br100.pid --listen-address=10.4.128.1 --except-interface=lo --dhcp-range=set:private,10.4.128.2,static,120s --dhcp-lease-max=4096 --dhcp-hostsfile=/opt/stack/grizzly/data/nova/networks/nova-br100.conf --dhcp-script=/opt/stack/grizzly/nova/bin/nova-dhcpbridge --leasefile-ro\nExit code: 1\nStdout: ''\nStderr: '\\ndnsmasq: bad command line options: try --help\\n'", 
            "date_created": "2013-03-27 17:19:24.651578+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/25543", 
            "date_created": "2013-03-27 17:32:24.574131+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/25543\nCommitted: http://github.com/openstack/nova/commit/8d68ed3583df6ced4b4c8b6d6bb3569e03992cfe\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8d68ed3583df6ced4b4c8b6d6bb3569e03992cfe\nAuthor: Sean Dague <email address hidden>\nDate:   Wed Mar 27 13:29:15 2013 -0400\n\n    always quote dhcp-domain, otherwise dnsmasq can fail to start\n    \n    the dnsmasq arg --dhcp-domain can't be passed to dnsmasq as empty\n    (i.e. --dhcp-domain= ) unlike many other arguments. If you do pass\n    it as empty, dnsmasq won't start, throwing a ProcessException which\n    then crashes the rest of nova-network.\n    \n    Fix this by quoting dhcp-domain so that empty domains are allowed.\n    \n    Fixed bug #1161027\n    \n    This was found by grenade upgrade testing\n    \n    Change-Id: Id24814339d8c8a709f5041f0aa98b10ba1e0e595\n", 
            "date_created": "2013-03-28 14:05:12.488829+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: milestone-proposed\nReview: https://review.openstack.org/25617", 
            "date_created": "2013-03-28 14:16:59.489637+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/25617\nCommitted: http://github.com/openstack/nova/commit/2a47b329da09e858c6dfe3c5860e2ee088a8a307\nSubmitter: Jenkins\nBranch:    milestone-proposed\n\ncommit 2a47b329da09e858c6dfe3c5860e2ee088a8a307\nAuthor: Sean Dague <email address hidden>\nDate:   Wed Mar 27 13:29:15 2013 -0400\n\n    always quote dhcp-domain, otherwise dnsmasq can fail to start\n    \n    the dnsmasq arg --dhcp-domain can't be passed to dnsmasq as empty\n    (i.e. --dhcp-domain= ) unlike many other arguments. If you do pass\n    it as empty, dnsmasq won't start, throwing a ProcessException which\n    then crashes the rest of nova-network.\n    \n    Fix this by quoting dhcp-domain so that empty domains are allowed.\n    \n    Fixed bug #1161027\n    \n    This was found by grenade upgrade testing\n    \n    Change-Id: Id24814339d8c8a709f5041f0aa98b10ba1e0e595\n    (cherry picked from commit 8d68ed3583df6ced4b4c8b6d6bb3569e03992cfe)\n", 
            "date_created": "2013-03-28 14:58:56.035812+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-03-28 14:58:54.449145+00:00"
}