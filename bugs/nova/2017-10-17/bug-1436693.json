{
    "status": "Fix Released", 
    "last_updated": "2015-10-15 08:58:00.361752+00:00", 
    "description": "When instance creation is finished incompletely by any reason, nova can't delete its instance.\nWhen an instance has no related record in instance_info_caches, \"nova delete\" bring error state.\n\nThe case we found:\n\n1) Create instance.\n$ nova boot --flavor 2 --image 17f667e4-b932-4a6c-a01c-478b69c0f8bd test1\n\n2) Some error occurred (maybe caused by network problem).\n$ nova list\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| ID                                   | Name  | Status | Task State | Power State | Networks |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| 2f677075-9d9c-4e1b-b483-74d79b31af26 | test1 | ERROR  |            | NOSTATE     |          |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n\n3) Try deleting the instance, but it is failed.\n$ nova delete 2f677075-9d9c-4e1b-b483-74d79b31af26\nRequest to delete server 2f677075-9d9c-4e1b-b483-74d79b31af26 has been accepted.\n\n$ nova list\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| ID                                   | Name  | Status | Task State | Power State | Networks |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| 2f677075-9d9c-4e1b-b483-74d79b31af26 | test1 | ERROR  | -          | NOSTATE     |          |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n\n$ nova show 2f677075-9d9c-4e1b-b483-74d79b31af26\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                      |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                     |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                       |\n| OS-EXT-STS:power_state               | 0                                                                                                          |\n| OS-EXT-STS:task_state                | -                                                                                                          |\n| OS-EXT-STS:vm_state                  | error                                                                                                      |\n| OS-SRV-USG:launched_at               | 2015-03-23T08:51:44.000000                                                                                 |\n| OS-SRV-USG:terminated_at             | -                                                                                                          |\n| accessIPv4                           |                                                                                                            |\n| accessIPv6                           |                                                                                                            |\n| config_drive                         | True                                                                                                       |\n| created                              | 2015-03-23T08:51:14Z                                                                                       |\n| fault                                | {\"message\": \"'NoneType' object has no attribute 'delete'\", \"code\": 500, \"created\": \"2015-03-23T08:58:23Z\"} |\n| flavor                               | m1.small (2)                                                                                               |\n| hostId                               | 1c3addc04df95d1f561280fe73da48c9f6c26526cc7d5cffc5cb6df0                                                   |\n| id                                   | 2f677075-9d9c-4e1b-b483-74d79b31af26                                                                       |\n| image                                | cirros-0.3.2-x86_64-uec (17f667e4-b932-4a6c-a01c-478b69c0f8bd)                                             |\n| key_name                             | -                                                                                                          |\n| metadata                             | {}                                                                                                         |\n| name                                 | test1                                                                                                      |\n| os-extended-volumes:volumes_attached | []                                                                                                         |\n| status                               | ERROR                                                                                                      |\n| tenant_id                            | 81ca9fe36f6443a1b329e1603189b975                                                                           |\n| updated                              | 2015-03-23T08:58:23Z                                                                                       |\n| user_id                              | 4aba7708df89454b8d4828260507f9ac                                                                           |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n\n4) Try force-deleting the instance, also it is failed.\n$ nova force-delete 2f677075-9d9c-4e1b-b483-74d79b31af26\n\n$ nova list\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| ID                                   | Name  | Status | Task State | Power State | Networks |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| 2f677075-9d9c-4e1b-b483-74d79b31af26 | test1 | ERROR  | -          | NOSTATE     |          |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n\n$ nova show 2f677075-9d9c-4e1b-b483-74d79b31af26\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                      |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                     |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                       |\n| OS-EXT-STS:power_state               | 0                                                                                                          |\n| OS-EXT-STS:task_state                | -                                                                                                          |\n| OS-EXT-STS:vm_state                  | error                                                                                                      |\n| OS-SRV-USG:launched_at               | 2015-03-23T08:51:44.000000                                                                                 |\n| OS-SRV-USG:terminated_at             | -                                                                                                          |\n| accessIPv4                           |                                                                                                            |\n| accessIPv6                           |                                                                                                            |\n| config_drive                         | True                                                                                                       |\n| created                              | 2015-03-23T08:51:14Z                                                                                       |\n| fault                                | {\"message\": \"'NoneType' object has no attribute 'delete'\", \"code\": 500, \"created\": \"2015-03-23T08:59:02Z\"} |\n| flavor                               | m1.small (2)                                                                                               |\n| hostId                               | 1c3addc04df95d1f561280fe73da48c9f6c26526cc7d5cffc5cb6df0                                                   |\n| id                                   | 2f677075-9d9c-4e1b-b483-74d79b31af26                                                                       |\n| image                                | cirros-0.3.2-x86_64-uec (17f667e4-b932-4a6c-a01c-478b69c0f8bd)                                             |\n| key_name                             | -                                                                                                          |\n| metadata                             | {}                                                                                                         |\n| name                                 | test1                                                                                                      |\n| os-extended-volumes:volumes_attached | []                                                                                                         |\n| status                               | ERROR                                                                                                      |\n| tenant_id                            | 81ca9fe36f6443a1b329e1603189b975                                                                           |\n| updated                              | 2015-03-23T08:59:02Z                                                                                       |\n| user_id                              | 4aba7708df89454b8d4828260507f9ac                                                                           |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n\n5) Checking databases, then info cache for the instance could not be found.\nmysql> select * from nova.instance_info_caches \n       where instance_uuid = '2f677075-9d9c-4e1b-b483-74d79b31af26';\nEmpty set (0.00 sec)\n\n\nWhen the instance has no related record in instance_info_caches, an error has occurred ('NoneType' object has no attribute).\nAs a result, nova can't delete the instance.\nThe root cause should be addressed radically (caused by the environment?), but any incomplete instance should be deletable by Nova.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 16, 
    "link": "https://bugs.launchpad.net/nova/+bug/1436693", 
    "owner": "https://api.launchpad.net/1.0/~yoshimatsu", 
    "id": 1436693, 
    "index": 4190, 
    "openned": "2015-03-26 06:36:15.035130+00:00", 
    "created": "2015-03-26 06:36:15.035130+00:00", 
    "title": "Unable to delete incomplete instance", 
    "comments": [
        {
            "content": "When instance creation is finished incompletely by any reason, nova can't delete its instance.\nWhen an instance has no related record in instance_info_caches, \"nova delete\" bring error state.\n\nThe case we found:\n\n1) Create instance.\n$ nova boot --flavor 2 --image 17f667e4-b932-4a6c-a01c-478b69c0f8bd test1\n\n2) Some error occurred (maybe caused by network problem).\n$ nova list\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| ID                                   | Name  | Status | Task State | Power State | Networks |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| 2f677075-9d9c-4e1b-b483-74d79b31af26 | test1 | ERROR  |            | NOSTATE     |          |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n\n3) Try deleting the instance, but it is failed.\n$ nova delete 2f677075-9d9c-4e1b-b483-74d79b31af26\nRequest to delete server 2f677075-9d9c-4e1b-b483-74d79b31af26 has been accepted.\n\n$ nova list\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| ID                                   | Name  | Status | Task State | Power State | Networks |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| 2f677075-9d9c-4e1b-b483-74d79b31af26 | test1 | ERROR  | -          | NOSTATE     |          |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n\n$ nova show 2f677075-9d9c-4e1b-b483-74d79b31af26\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                      |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                     |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                       |\n| OS-EXT-STS:power_state               | 0                                                                                                          |\n| OS-EXT-STS:task_state                | -                                                                                                          |\n| OS-EXT-STS:vm_state                  | error                                                                                                      |\n| OS-SRV-USG:launched_at               | 2015-03-23T08:51:44.000000                                                                                 |\n| OS-SRV-USG:terminated_at             | -                                                                                                          |\n| accessIPv4                           |                                                                                                            |\n| accessIPv6                           |                                                                                                            |\n| config_drive                         | True                                                                                                       |\n| created                              | 2015-03-23T08:51:14Z                                                                                       |\n| fault                                | {\"message\": \"'NoneType' object has no attribute 'delete'\", \"code\": 500, \"created\": \"2015-03-23T08:58:23Z\"} |\n| flavor                               | m1.small (2)                                                                                               |\n| hostId                               | 1c3addc04df95d1f561280fe73da48c9f6c26526cc7d5cffc5cb6df0                                                   |\n| id                                   | 2f677075-9d9c-4e1b-b483-74d79b31af26                                                                       |\n| image                                | cirros-0.3.2-x86_64-uec (17f667e4-b932-4a6c-a01c-478b69c0f8bd)                                             |\n| key_name                             | -                                                                                                          |\n| metadata                             | {}                                                                                                         |\n| name                                 | test1                                                                                                      |\n| os-extended-volumes:volumes_attached | []                                                                                                         |\n| status                               | ERROR                                                                                                      |\n| tenant_id                            | 81ca9fe36f6443a1b329e1603189b975                                                                           |\n| updated                              | 2015-03-23T08:58:23Z                                                                                       |\n| user_id                              | 4aba7708df89454b8d4828260507f9ac                                                                           |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n\n4) Try force-deleting the instance, also it is failed.\n$ nova force-delete 2f677075-9d9c-4e1b-b483-74d79b31af26\n\n$ nova list\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| ID                                   | Name  | Status | Task State | Power State | Networks |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n| 2f677075-9d9c-4e1b-b483-74d79b31af26 | test1 | ERROR  | -          | NOSTATE     |          |\n+--------------------------------------+-------+--------+------------+-------------+----------+\n\n$ nova show 2f677075-9d9c-4e1b-b483-74d79b31af26\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n| Property                             | Value                                                                                                      |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                                                                     |\n| OS-EXT-AZ:availability_zone          | nova                                                                                                       |\n| OS-EXT-STS:power_state               | 0                                                                                                          |\n| OS-EXT-STS:task_state                | -                                                                                                          |\n| OS-EXT-STS:vm_state                  | error                                                                                                      |\n| OS-SRV-USG:launched_at               | 2015-03-23T08:51:44.000000                                                                                 |\n| OS-SRV-USG:terminated_at             | -                                                                                                          |\n| accessIPv4                           |                                                                                                            |\n| accessIPv6                           |                                                                                                            |\n| config_drive                         | True                                                                                                       |\n| created                              | 2015-03-23T08:51:14Z                                                                                       |\n| fault                                | {\"message\": \"'NoneType' object has no attribute 'delete'\", \"code\": 500, \"created\": \"2015-03-23T08:59:02Z\"} |\n| flavor                               | m1.small (2)                                                                                               |\n| hostId                               | 1c3addc04df95d1f561280fe73da48c9f6c26526cc7d5cffc5cb6df0                                                   |\n| id                                   | 2f677075-9d9c-4e1b-b483-74d79b31af26                                                                       |\n| image                                | cirros-0.3.2-x86_64-uec (17f667e4-b932-4a6c-a01c-478b69c0f8bd)                                             |\n| key_name                             | -                                                                                                          |\n| metadata                             | {}                                                                                                         |\n| name                                 | test1                                                                                                      |\n| os-extended-volumes:volumes_attached | []                                                                                                         |\n| status                               | ERROR                                                                                                      |\n| tenant_id                            | 81ca9fe36f6443a1b329e1603189b975                                                                           |\n| updated                              | 2015-03-23T08:59:02Z                                                                                       |\n| user_id                              | 4aba7708df89454b8d4828260507f9ac                                                                           |\n+--------------------------------------+------------------------------------------------------------------------------------------------------------+\n\n5) Checking databases, then info cache for the instance could not be found.\nmysql> select * from nova.instance_info_caches \n       where instance_uuid = '2f677075-9d9c-4e1b-b483-74d79b31af26';\nEmpty set (0.00 sec)\n\n\nWhen the instance has no related record in instance_info_caches, an error has occurred ('NoneType' object has no attribute).\nAs a result, nova can't delete the instance.\nThe root cause should be addressed radically (caused by the environment?), but any incomplete instance should be deletable by Nova.", 
            "date_created": "2015-03-26 06:36:15.035130+00:00", 
            "author": "https://api.launchpad.net/1.0/~yoshimatsu"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/167905", 
            "date_created": "2015-03-26 06:45:34.150212+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "increase it since can't delete an error instance might be a bad user experience", 
            "date_created": "2015-03-30 16:03:18.792426+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/167905\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8d41d4fe558f0ea2999ef7b5712444de49b73053\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8d41d4fe558f0ea2999ef7b5712444de49b73053\nAuthor: Takenori Yoshimatsu <email address hidden>\nDate:   Thu Mar 26 15:42:06 2015 +0900\n\n    Avoid AttributeError at instance.info_cache.delete\n    \n    When the instance has no related record in instance_info_caches,\n    an error has occurred ('NoneType' object has no attribute).\n    As a result, nova can't delete the instance.\n    Such an incomplete instance, should be deletable by nova.\n    So the root cause might be addressed separately, but this\n    exception should be avoided and logged.\n    \n    Change-Id: Ie0bba032615d3da06cdd95b221beb37a9b8a377d\n    Closes-bug: #1436693\n", 
            "date_created": "2015-07-31 06:22:28.263940+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2015-09-03 11:44:49.491438+00:00"
}