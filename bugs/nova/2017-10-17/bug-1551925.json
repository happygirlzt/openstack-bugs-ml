{
    "status": "Fix Released", 
    "last_updated": "2016-07-26 20:19:48.643703+00:00", 
    "description": "This is seen in unit test runs:\n\nhttp://logs.openstack.org/59/284959/5/gate/gate-nova-python27/8ab5da7/console.html\n\n2016-03-01 14:54:26.205 | {1} nova.tests.unit.virt.test_virt_drivers.LibvirtConnTestCase.test_live_migration [0.190245s] ... ok\n2016-03-01 14:54:26.205 | \n2016-03-01 14:54:26.205 | Captured stderr:\n2016-03-01 14:54:26.206 | ~~~~~~~~~~~~~~~~\n2016-03-01 14:54:26.206 |     Traceback (most recent call last):\n2016-03-01 14:54:26.206 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 457, in fire_timers\n2016-03-01 14:54:26.206 |         timer()\n2016-03-01 14:54:26.206 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 58, in __call__\n2016-03-01 14:54:26.206 |         cb(*args, **kw)\n2016-03-01 14:54:26.206 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/greenthread.py\", line 214, in main\n2016-03-01 14:54:26.206 |         result = function(*args, **kwargs)\n2016-03-01 14:54:26.206 |       File \"nova/utils.py\", line 1160, in context_wrapper\n2016-03-01 14:54:26.206 |         return func(*args, **kwargs)\n2016-03-01 14:54:26.206 |       File \"nova/virt/libvirt/driver.py\", line 6088, in _live_migration_operation\n2016-03-01 14:54:26.207 |         instance=instance)\n2016-03-01 14:54:26.207 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-01 14:54:26.207 |         self.force_reraise()\n2016-03-01 14:54:26.207 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-01 14:54:26.207 |         six.reraise(self.type_, self.value, self.tb)\n2016-03-01 14:54:26.207 |       File \"nova/virt/libvirt/driver.py\", line 6014, in _live_migration_operation\n2016-03-01 14:54:26.207 |         serial_listen_addr = migrate_data.serial_listen_addr\n2016-03-01 14:54:26.207 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 67, in getter\n2016-03-01 14:54:26.207 |         self.obj_load_attr(name)\n2016-03-01 14:54:26.207 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 580, in obj_load_attr\n2016-03-01 14:54:26.207 |         _(\"Cannot load '%s' in the base class\") % attrname)\n2016-03-01 14:54:26.207 |     NotImplementedError: Cannot load 'serial_listen_addr' in the base class\n2016-03-01 14:54:26.208 |     \n\nThe error is squashed since the nova.tests.unit.virt.test_virt_drivers._VirtDriverTestCase that defines the test ignores NotImplementedError:\n\nhttps://github.com/openstack/nova/blob/9ab6840af64d6af58baf51040afe86a3324221e5/nova/tests/unit/virt/test_virt_drivers.py#L659\n\nThe code is unconditionally loading the attribute:\n\nhttps://github.com/openstack/nova/blob/1345d0fe1cad5093d49a58b6f0b7f4cb650f61d8/nova/virt/libvirt/driver.py#L5946\n\nBut the attribute is optional:\n\nhttps://github.com/openstack/nova/blob/1345d0fe1cad5093d49a58b6f0b7f4cb650f61d8/nova/objects/migrate_data.py#L124", 
    "tags": [
        "libvirt", 
        "live-migration", 
        "unified-objects"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1551925", 
    "owner": "https://api.launchpad.net/1.0/~mriedem", 
    "id": 1551925, 
    "index": 4468, 
    "openned": "2016-03-01 19:39:57.631176+00:00", 
    "created": "2016-03-01 19:39:57.631176+00:00", 
    "title": "NotImplementedError: Cannot load 'serial_listen_addr' in the base class", 
    "comments": [
        {
            "content": "This is seen in unit test runs:\n\nhttp://logs.openstack.org/59/284959/5/gate/gate-nova-python27/8ab5da7/console.html\n\n2016-03-01 14:54:26.205 | {1} nova.tests.unit.virt.test_virt_drivers.LibvirtConnTestCase.test_live_migration [0.190245s] ... ok\n2016-03-01 14:54:26.205 | \n2016-03-01 14:54:26.205 | Captured stderr:\n2016-03-01 14:54:26.206 | ~~~~~~~~~~~~~~~~\n2016-03-01 14:54:26.206 |     Traceback (most recent call last):\n2016-03-01 14:54:26.206 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/hubs/hub.py\", line 457, in fire_timers\n2016-03-01 14:54:26.206 |         timer()\n2016-03-01 14:54:26.206 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/hubs/timer.py\", line 58, in __call__\n2016-03-01 14:54:26.206 |         cb(*args, **kw)\n2016-03-01 14:54:26.206 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/eventlet/greenthread.py\", line 214, in main\n2016-03-01 14:54:26.206 |         result = function(*args, **kwargs)\n2016-03-01 14:54:26.206 |       File \"nova/utils.py\", line 1160, in context_wrapper\n2016-03-01 14:54:26.206 |         return func(*args, **kwargs)\n2016-03-01 14:54:26.206 |       File \"nova/virt/libvirt/driver.py\", line 6088, in _live_migration_operation\n2016-03-01 14:54:26.207 |         instance=instance)\n2016-03-01 14:54:26.207 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 220, in __exit__\n2016-03-01 14:54:26.207 |         self.force_reraise()\n2016-03-01 14:54:26.207 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 196, in force_reraise\n2016-03-01 14:54:26.207 |         six.reraise(self.type_, self.value, self.tb)\n2016-03-01 14:54:26.207 |       File \"nova/virt/libvirt/driver.py\", line 6014, in _live_migration_operation\n2016-03-01 14:54:26.207 |         serial_listen_addr = migrate_data.serial_listen_addr\n2016-03-01 14:54:26.207 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 67, in getter\n2016-03-01 14:54:26.207 |         self.obj_load_attr(name)\n2016-03-01 14:54:26.207 |       File \"/home/jenkins/workspace/gate-nova-python27/.tox/py27/local/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 580, in obj_load_attr\n2016-03-01 14:54:26.207 |         _(\"Cannot load '%s' in the base class\") % attrname)\n2016-03-01 14:54:26.207 |     NotImplementedError: Cannot load 'serial_listen_addr' in the base class\n2016-03-01 14:54:26.208 |     \n\nThe error is squashed since the nova.tests.unit.virt.test_virt_drivers._VirtDriverTestCase that defines the test ignores NotImplementedError:\n\nhttps://github.com/openstack/nova/blob/9ab6840af64d6af58baf51040afe86a3324221e5/nova/tests/unit/virt/test_virt_drivers.py#L659\n\nThe code is unconditionally loading the attribute:\n\nhttps://github.com/openstack/nova/blob/1345d0fe1cad5093d49a58b6f0b7f4cb650f61d8/nova/virt/libvirt/driver.py#L5946\n\nBut the attribute is optional:\n\nhttps://github.com/openstack/nova/blob/1345d0fe1cad5093d49a58b6f0b7f4cb650f61d8/nova/objects/migrate_data.py#L124", 
            "date_created": "2016-03-01 19:39:57.631176+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "http://logstash.openstack.org/#dashboard/file/logstash.json?query=message%3A%5C%22NotImplementedError%3A%20Cannot%20load%20'serial_listen_addr'%20in%20the%20base%20class%5C%22%20AND%20build_name%3A%5C%22gate-nova-python27%5C%22%20AND%20tags%3A%5C%22console%5C%22&from=7d", 
            "date_created": "2016-03-01 19:40:24.860190+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "'target_connect_addr' is also nullable but loaded in the _live_migration_operation method.", 
            "date_created": "2016-03-01 20:26:55.476427+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/286828", 
            "date_created": "2016-03-01 20:39:43.325627+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/290134", 
            "date_created": "2016-03-08 21:08:56.142489+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/286828\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=2e2732557a1f8ed38e2ee1b041670cc15ce74377\nSubmitter: Jenkins\nBranch:    master\n\ncommit 2e2732557a1f8ed38e2ee1b041670cc15ce74377\nAuthor: Matt Riedemann <email address hidden>\nDate:   Tue Mar 1 15:30:40 2016 -0500\n\n    libvirt: check for optional LibvirtLiveMigrateData attrs before loading\n    \n    The _live_migration_operation method is accessing the nullable\n    attributes 'serial_listen_addr' and 'target_connect_addr' on the\n    LibvirtLiveMigrateData object which might not be set on the object.\n    \n    Since they aren't lazy-loadable, this results in a NotImplementedError\n    if the attribute aren't set. This is fixed by adding conditional checks\n    in _live_migration_operation for the nullable attributes. Note that\n    bdms is nullable=False in the LiveMigrateDataObject and should be set\n    when the migrate_data object comes to the virt driver, so the test case\n    is updated in this case to fix the bdms attribute access.\n    \n    There was a test hitting this, but because the libvirt driver runs\n    _live_migration_operation in a thread, the error was just being\n    logged and the test would pass.\n    \n    So to fix that, the SpawnIsSynchronous fixture is used in the test\n    class to make the _live_migration_operation synchronous for that\n    test.\n    \n    However, that doesn't fully resolve the gap in the test because\n    of the @catch_notimplemented decorator used on the test case. That\n    is meant for virt drivers which don't implement the live_migration\n    method but it can also allow silent failures in object attribute\n    access from bubbling up as failures. So this change also removes\n    that decorator from the test case.\n    \n    Note that the tests themselves are pretty hacky in this case anyway\n    since while they are meant to be generic per virt driver, the\n    object passed down is LibvirtLiveMigrateData, which won't be\n    correct for xenapi, for example.\n    \n    Closes-Bug: #1551925\n    \n    Change-Id: I2744e99617d4e4834bb8372fa62dbad7686b1301\n", 
            "date_created": "2016-03-10 23:20:13.474531+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.0.0.0rc1 release candidate.", 
            "date_created": "2016-03-16 18:00:12.663764+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/290134\nReason: This code hasn't been updated in a long time, and is in merge conflict. I am going to abandon this review, but feel free to restore it if you're still working on this.", 
            "date_created": "2016-07-26 20:19:47.794907+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2016-03-10 23:20:10.236951+00:00"
}