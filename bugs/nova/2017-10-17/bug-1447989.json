{
    "status": "Invalid", 
    "last_updated": "2015-04-28 15:09:26.089970+00:00", 
    "description": "nova attached succeeded but when detach, after debug the nova manager reports error:\n\n> /usr/lib/python2.7/site-packages/nova/compute/manager.py(4927)detach_volume()\n-> self.volume_api.detach(context.elevated(), volume_id)\n\n--------Start--------\nInvalid input received: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400) (Request-ID: req-9a6619bc-01bd-4226-9904-45e1f571a5bb)\n--------End--------\n\nchecked in /var/log/cinder/api.log, it reports:\n\n--------Start--------\n2015-04-24 04:18:06.461 27284 ERROR cinder.api.openstack.wsgi [req-9a6619bc-01bd-4226-9904-45e1f571a5bb 486b55b3d6254105b08f1a449777507d 861703cfc7cf4f67a6a0049618b0865f - - -] Exception handling resource: detach_volume() takes exactly 3 arguments (4 given)\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n    executor_callback))\n\n  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n    executor_callback)\n\n  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n    result = func(ctxt, **new_args)\n\n  File \"/usr/lib/python2.7/site-packages/osprofiler/profiler.py\", line 105, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/cinder/volume/manager.py\", line 157, in ldo_inner1\n    return ldo_inner2(inst, context, volume_id, attachment_id, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 445, in inner\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/cinder/volume/manager.py\", line 156, in ldo_inner2\n    return f(*_args, **_kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/cinder/volume/manager.py\", line 897, in detach_volume\n    {'attach_status': 'error_detaching'})\n\n  File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/usr/lib/python2.7/site-packages/cinder/volume/manager.py\", line 892, in detach_volume\n    self.driver.detach_volume(context, volume, attachment)\n\n  File \"/usr/lib/python2.7/site-packages/osprofiler/profiler.py\", line 105, in wrapper\n    return f(*args, **kwargs)\n\nTypeError: detach_volume() takes exactly 3 arguments (4 given)\n--------End--------\n\nThe result is my detach volume always in \"detaching\" status, although the real status is already detached.\n[root@controller ~]# cinder list\n| b1baa918-5a4f-40fc-82ab-63a9aade0efc | detaching |      test-for-attach-1       |  1   | pvc:22ba67376ed3d811e4ba520000c9d2fb5c:dev4clstr base template |  false   |  \n\nI believe this is a bug that need to take care\n\n\n--------------------\n1. version:\n[root@controller ~]# rpm -aq | grep nova\nopenstack-nova-conductor-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-network-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-cells-2015.1-201504161438.ibm.el7.111.noarch\npython-novaclient-2.23.0-1.ibm.el7.noarch\nopenstack-nova-scheduler-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-novncproxy-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-objectstore-2015.1-201504161438.ibm.el7.111.noarch\npython-nova-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-api-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-console-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-compute-prereqs-2013.1-201503192011.ibm.2.ppc64\nopenstack-nova-compute-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-common-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-cert-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-2015.1-201504161438.ibm.el7.111.noarch\n\n2. logs:\nsee above", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1447989", 
    "owner": "None", 
    "id": 1447989, 
    "index": 6785, 
    "openned": "2015-04-24 09:25:19.989466+00:00", 
    "created": "2015-04-24 09:25:19.989466+00:00", 
    "title": "nova volume-detach volume failed due to arguments counts mismatch?", 
    "comments": [
        {
            "content": "nova attached succeeded but when detach, after debug the nova manager reports error:\n\n> /usr/lib/python2.7/site-packages/nova/compute/manager.py(4927)detach_volume()\n-> self.volume_api.detach(context.elevated(), volume_id)\n\n--------Start--------\nInvalid input received: The server could not comply with the request since it is either malformed or otherwise incorrect. (HTTP 400) (Request-ID: req-9a6619bc-01bd-4226-9904-45e1f571a5bb)\n--------End--------\n\nchecked in /var/log/cinder/api.log, it reports:\n\n--------Start--------\n2015-04-24 04:18:06.461 27284 ERROR cinder.api.openstack.wsgi [req-9a6619bc-01bd-4226-9904-45e1f571a5bb 486b55b3d6254105b08f1a449777507d 861703cfc7cf4f67a6a0049618b0865f - - -] Exception handling resource: detach_volume() takes exactly 3 arguments (4 given)\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n    executor_callback))\n\n  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n    executor_callback)\n\n  File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n    result = func(ctxt, **new_args)\n\n  File \"/usr/lib/python2.7/site-packages/osprofiler/profiler.py\", line 105, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/cinder/volume/manager.py\", line 157, in ldo_inner1\n    return ldo_inner2(inst, context, volume_id, attachment_id, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py\", line 445, in inner\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/cinder/volume/manager.py\", line 156, in ldo_inner2\n    return f(*_args, **_kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/cinder/volume/manager.py\", line 897, in detach_volume\n    {'attach_status': 'error_detaching'})\n\n  File \"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py\", line 85, in __exit__\n    six.reraise(self.type_, self.value, self.tb)\n\n  File \"/usr/lib/python2.7/site-packages/cinder/volume/manager.py\", line 892, in detach_volume\n    self.driver.detach_volume(context, volume, attachment)\n\n  File \"/usr/lib/python2.7/site-packages/osprofiler/profiler.py\", line 105, in wrapper\n    return f(*args, **kwargs)\n\nTypeError: detach_volume() takes exactly 3 arguments (4 given)\n--------End--------\n\nThe result is my detach volume always in \"detaching\" status, although the real status is already detached.\n[root@controller ~]# cinder list\n| b1baa918-5a4f-40fc-82ab-63a9aade0efc | detaching |      test-for-attach-1       |  1   | pvc:22ba67376ed3d811e4ba520000c9d2fb5c:dev4clstr base template |  false   |  \n\nI believe this is a bug that need to take care\n\n\n--------------------\n1. version:\n[root@controller ~]# rpm -aq | grep nova\nopenstack-nova-conductor-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-network-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-cells-2015.1-201504161438.ibm.el7.111.noarch\npython-novaclient-2.23.0-1.ibm.el7.noarch\nopenstack-nova-scheduler-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-novncproxy-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-objectstore-2015.1-201504161438.ibm.el7.111.noarch\npython-nova-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-api-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-console-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-compute-prereqs-2013.1-201503192011.ibm.2.ppc64\nopenstack-nova-compute-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-common-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-cert-2015.1-201504161438.ibm.el7.111.noarch\nopenstack-nova-2015.1-201504161438.ibm.el7.111.noarch\n\n2. logs:\nsee above", 
            "date_created": "2015-04-24 09:25:19.989466+00:00", 
            "author": "https://api.launchpad.net/1.0/~caimin"
        }, 
        {
            "content": "What's the volume backend you're using in cinder and the virt driver backend you're using in nova?\n\nIf this wasn't working, there would be several tempest tests that fail in the gate:\n\nhttp://git.openstack.org/cgit/openstack/tempest/tree/tempest/api/volume/test_volumes_actions.py#n62", 
            "date_created": "2015-04-28 14:51:52.071776+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "What version of python-cinderclient is being used?  And are you using cinder v1 or v2 API?\n\nThe nova compute manager code lines up fine with the volume API within nova which is a wrapper on cinderclient:\n\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/compute/manager.py?id=2015.1.0rc2#n4867\n\nhttp://git.openstack.org/cgit/openstack/nova/tree/nova/volume/cinder.py#n365", 
            "date_created": "2015-04-28 14:57:24.041531+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "How about not opening bugs against community nova for your busted out of tree driver, thanks.\n\nhttp://git.openstack.org/cgit/stackforge/powervc-driver/tree/cinder-powervc/powervc/volume/driver/powervc.py#n312", 
            "date_created": "2015-04-28 15:09:25.575116+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }
    ], 
    "closed": "2015-04-28 15:08:58.849609+00:00"
}