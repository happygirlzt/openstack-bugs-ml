{
    "status": "Fix Released", 
    "last_updated": "2017-06-16 17:19:20.345154+00:00", 
    "description": "In case Nova calculated live migration type by itself and it's a block live migration, it will not work if Xen is used because of invalid check in driver:\n\nhttps://github.com/openstack/nova/blob/dae13c5153a3aee25c8ded1cb154cc56a04cd7a2/nova/virt/xenapi/vmops.py#L2391\n\nBasically because here block_migration will be None and real value will be stored in migrate_data.block_migration", 
    "tags": [
        "in-stable-mitaka", 
        "live-migration", 
        "xenserver"
    ], 
    "importance": "High", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1557585", 
    "owner": "https://api.launchpad.net/1.0/~bob-ball", 
    "id": 1557585, 
    "index": 1900, 
    "openned": "2016-03-15 15:13:14.103638+00:00", 
    "created": "2016-03-15 15:13:14.103638+00:00", 
    "title": "Xenapi live-migration does not work at all now", 
    "comments": [
        {
            "content": "In case Nova calculated live migration type by itself and it's a block live migration, it will not work if Xen is used because of invalid check in driver:\n\nhttps://github.com/openstack/nova/blob/dae13c5153a3aee25c8ded1cb154cc56a04cd7a2/nova/virt/xenapi/vmops.py#L2391\n\nBasically because here block_migration will be None and real value will be stored in migrate_data.block_migration", 
            "date_created": "2016-03-15 15:13:14.103638+00:00", 
            "author": "https://api.launchpad.net/1.0/~pawel-koniszewski"
        }, 
        {
            "content": "Fix is up for review https://review.openstack.org/#/c/292937/", 
            "date_created": "2016-03-15 15:23:30.789650+00:00", 
            "author": "https://api.launchpad.net/1.0/~pawel-koniszewski"
        }, 
        {
            "content": "Related fix proposed to branch: master\nReview: https://review.openstack.org/293085", 
            "date_created": "2016-03-15 18:42:00.922743+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/293393\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=38738d79e0774cf71dfff8185330b1f45b64d9fc\nSubmitter: Jenkins\nBranch:    master\n\ncommit 38738d79e0774cf71dfff8185330b1f45b64d9fc\nAuthor: Bob Ball <email address hidden>\nDate:   Tue Mar 15 16:21:00 2016 +0000\n\n    xenapi: Fix the live-migrate aggregate check\n    \n    AggregateList now returns [] if the host is not in an\n    aggregate.  This was causing an IndexError in XenAPI.\n    \n    This change also replaces the AggregateHostNotFound exception,\n    which is not caught properly further up the stack, with the\n    MigrationPreCheckError as this is a suitable substitute since\n    the aggregate check is only part of the pre migration check.\n    \n    Probably introduced by Ibcb896b2eef673bce23491161ff394bcc87aa541\n    \n    Related-Bug: #1557585\n    Change-Id: Icacd3cbe065ee8598e5e5f03bd73463b95ed2f75\n", 
            "date_created": "2016-03-17 14:57:05.281911+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "I think the two changes we need to get into rc2 for mitaka are ready to go:\n\nhttps://review.openstack.org/#/c/293085/\n\nhttps://review.openstack.org/#/c/292937/", 
            "date_created": "2016-03-18 14:15:22.260339+00:00", 
            "author": "https://api.launchpad.net/1.0/~mriedem"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/293085\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=8e5188af4c5221faaa60b21fa9c35550a1380e9f\nSubmitter: Jenkins\nBranch:    master\n\ncommit 8e5188af4c5221faaa60b21fa9c35550a1380e9f\nAuthor: John Garbutt <email address hidden>\nDate:   Tue Mar 15 18:23:36 2016 +0000\n\n    xenapi: Fix up passing of sr_uuid_map\n    \n    Currently pre_live_migration breaks the chain of passing the migrate\n    data between the different driver calls.\n    \n    Also, the place that was using sr_uuid_map was not looking for it in the\n    migrate data object, where it now lives.\n    \n    Related-Bug: #1557585\n    Change-Id: I6f210d876816dc59325f3c36c75c2df5c880c61e\n", 
            "date_created": "2016-03-18 14:49:12.082638+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/292937\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=762605ca4c2ac990b53a50d8f2c52fc793e07c94\nSubmitter: Jenkins\nBranch:    master\n\ncommit 762605ca4c2ac990b53a50d8f2c52fc793e07c94\nAuthor: Pawel Koniszewski <email address hidden>\nDate:   Tue Mar 15 16:13:38 2016 +0100\n\n    xenapi: Fix when auto block_migration in the API\n    \n    When nova calculates live migration type it stores the calculated\n    type in migrate_data.block_migration. Because of that we really should\n    not use block_migration, because it might not be accurate in certain\n    cases.\n    \n    Closes-Bug: #1557585\n    Change-Id: I0796a4b9bfabb1b2132a8253963528a40b1fb680\n", 
            "date_created": "2016-03-18 14:55:54.205979+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: stable/mitaka\nReview: https://review.openstack.org/295216", 
            "date_created": "2016-03-21 11:25:16.917538+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Related fix proposed to branch: stable/mitaka\nReview: https://review.openstack.org/295217", 
            "date_created": "2016-03-21 11:25:27.996005+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/mitaka\nReview: https://review.openstack.org/295218", 
            "date_created": "2016-03-21 11:25:40.781442+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/295216\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=15372ef7cc42e43185aef3e8ec960436987970cf\nSubmitter: Jenkins\nBranch:    stable/mitaka\n\ncommit 15372ef7cc42e43185aef3e8ec960436987970cf\nAuthor: Bob Ball <email address hidden>\nDate:   Tue Mar 15 16:21:00 2016 +0000\n\n    xenapi: Fix the live-migrate aggregate check\n    \n    AggregateList now returns [] if the host is not in an\n    aggregate.  This was causing an IndexError in XenAPI.\n    \n    This change also replaces the AggregateHostNotFound exception,\n    which is not caught properly further up the stack, with the\n    MigrationPreCheckError as this is a suitable substitute since\n    the aggregate check is only part of the pre migration check.\n    \n    Probably introduced by Ibcb896b2eef673bce23491161ff394bcc87aa541\n    \n    Related-Bug: #1557585\n    Change-Id: Icacd3cbe065ee8598e5e5f03bd73463b95ed2f75\n    (cherry picked from commit 38738d79e0774cf71dfff8185330b1f45b64d9fc)\n", 
            "date_created": "2016-03-21 18:18:12.184994+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/295217\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=adaa9dee27279e6dda5d95750c626e620ce496a8\nSubmitter: Jenkins\nBranch:    stable/mitaka\n\ncommit adaa9dee27279e6dda5d95750c626e620ce496a8\nAuthor: John Garbutt <email address hidden>\nDate:   Tue Mar 15 18:23:36 2016 +0000\n\n    xenapi: Fix up passing of sr_uuid_map\n    \n    Currently pre_live_migration breaks the chain of passing the migrate\n    data between the different driver calls.\n    \n    Also, the place that was using sr_uuid_map was not looking for it in the\n    migrate data object, where it now lives.\n    \n    Related-Bug: #1557585\n    Change-Id: I6f210d876816dc59325f3c36c75c2df5c880c61e\n    (cherry picked from commit 8e5188af4c5221faaa60b21fa9c35550a1380e9f)\n", 
            "date_created": "2016-03-21 18:22:23.359746+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/295218\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=f0dc7dbb6823f15e3bad1e407c498b3ce0248665\nSubmitter: Jenkins\nBranch:    stable/mitaka\n\ncommit f0dc7dbb6823f15e3bad1e407c498b3ce0248665\nAuthor: Pawel Koniszewski <email address hidden>\nDate:   Tue Mar 15 16:13:38 2016 +0100\n\n    xenapi: Fix when auto block_migration in the API\n    \n    When nova calculates live migration type it stores the calculated\n    type in migrate_data.block_migration. Because of that we really should\n    not use block_migration, because it might not be accurate in certain\n    cases.\n    \n    Closes-Bug: #1557585\n    Change-Id: I0796a4b9bfabb1b2132a8253963528a40b1fb680\n    (cherry picked from commit 762605ca4c2ac990b53a50d8f2c52fc793e07c94)\n", 
            "date_created": "2016-03-21 18:22:52.846259+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.0.0.0rc2 release candidate.", 
            "date_created": "2016-03-24 16:05:40.042916+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/302578", 
            "date_created": "2016-04-07 07:47:27.943371+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/302578\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=a8ebbebd4ee0c3bb1452ea32f92e1588a6b35067\nSubmitter: Jenkins\nBranch:    master\n\ncommit 7105f888ee1f52d2a462fc0ece3130dc0d3d49f5\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Thu Mar 31 06:28:06 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: Ibe5d4d38834fbcb99c0332d3375659a21d94154e\n\ncommit 5de98cb2de2eca3d061488c55f96e6f7c9bc56a8\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Wed Mar 30 06:41:25 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: Ia46d661560b1141c1c1522c9477c510d28a0d0e7\n\ncommit a9d55427b6e8d2472088e3d40a8a5151ce408283\nAuthor: Moshe Levi <email address hidden>\nDate:   Wed Mar 23 10:59:04 2016 +0200\n\n    Fix detach SR-IOV when using LibvirtConfigGuestHostdevPCI\n    \n    This patch fixes an issue which was introduced by this\n    change If3edc1965c01a077eb61984a442e0d778d870d75.\n    Usually the vif config is of type LibvirtConfigGuestInterface,\n    but some vif use LibvirtConfigGuestHostdevPCI config\n    (e.g.  the ib_hostdev). The difference is that\n    LibvirtConfigGuestInterface keeps the pci address in source_dev\n    while LibvirtConfigGuestHostdevPCI has domain, bus, slot and\n    function, instead of relying on the vif config type we can take the\n    pci address for the neutron port.\n    \n    Closes-Bug: #1560860\n    \n    Change-Id: I62a7ff16f1c9c5da923451520fbeeabb5cc0c5c6\n    (cherry picked from commit f15d9a9693b19393fcde84cf4bc6f044d39ffdca)\n\ncommit 5b6ee702df7ad901f68bec2ed8d43b66aa6d98c1\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Tue Mar 29 06:37:30 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: Iad0e42a18bd3a7dcf216b4df17b9893e13382efe\n\ncommit 29042e06f7e570bd13607b62b997a6ae21db80c5\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Mon Mar 28 06:34:19 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: If159133a2e32c6ef53ba104751a3eb054a95b733\n\ncommit 3e9819dab8249ec9993b0b9874e80a78f2ed1754\nAuthor: Matt Riedemann <email address hidden>\nDate:   Sun Mar 27 19:31:32 2016 -0400\n\n    Update cells blacklist regex for test_server_basic_ops\n    \n    Tempest change 9bee3b92f1559cb604c8bd74dcca57805a85a97a\n    renamed a test in our blacklist so update the filter to\n    handle the old and new name.\n    \n    The Tempest team is hesitant to revert the change so we\n    should handle it ourselves and eventually move to using\n    test uuids for our blacklist, but there might need to\n    be work in devstack-gate for that first.\n    \n    Change-Id: Ibab3958044c21568d7fbbe0a298bb40bbbc20df3\n    Closes-Bug: #1562323\n    (cherry picked from commit e86b7fbb99de0c4cff6a9569f748bae1bde693a6)\n\ncommit c71c4e01b21da5b5b7cb262969e30d6a68b3c58a\nAuthor: Sylvain Bauza <email address hidden>\nDate:   Thu Mar 24 23:07:54 2016 +0100\n\n    Stop providing force_hosts to the scheduler for move ops\n    \n    Since now we provide the original RequestSpec for move operations (unshelve,\n    live-migrate and evacuate), it can also provide the original force_hosts/nodes\n    to the scheduler.\n    In that case, it means that if an admin was asking to boot an instance forcing\n    to an host, a later move operation could then give again the forced value and\n    then wouldn't permit to get a different destination which is an issue.\n    \n    TBH, that is not a problem for live-migrate and evacuate that do provide an\n    optional host value (which bypasses then the scheduler) but since unshelve\n    is not having this optional value, it would mean that we could only unshelve\n    an forced instance to the same host.\n    \n    Change-Id: I03c22ff757d0ee1da9d69fa48cc4bdd036e6b13f\n    Closes-Bug: #1561357\n    (cherry picked from commit 446d15568e00a483d909dc5c565d70baf29179ad)\n\ncommit 73e4fb189abe098f0058d173044708119785e494\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Thu Mar 24 06:31:09 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: Ide680eb6e11506d19cbaa549837a0ea448b9c401\n\ncommit ad3c069f69ca1ab2c1d9c6c18d762b7c26c5ad92\nAuthor: Pawel Koniszewski <email address hidden>\nDate:   Wed Mar 23 18:44:10 2016 +0100\n\n    Try to repopulate instance_group if it is None\n    \n    There are cases that we need to create new RequestSpect object and we\n    pass None for instance_group argument. It might cause server group\n    policies to be omitted during filtering phase. Therefore if\n    instance_group is None we should try to repopulate instance_group\n    basing on data that is in filter_properties.\n    \n    Change-Id: Id7e669e0a6db1ff1052c42006f1a141bdb8cdf29\n    Closes-Bug: #1561022\n    (cherry picked from commit 00efcf3a4171d270fc3a7b9b4a9230332aea81e6)\n\ncommit 9b98668465e326cde844a8b012e4a0eec6c2844c\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Wed Mar 23 06:29:56 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: I3be6855101c04f36b9c06a69d16876cdf6f00c62\n\ncommit c7eb823fe73e3db5dca48df5879db18cbab5bd8d\nAuthor: Sean Mooney <email address hidden>\nDate:   Fri Jan 22 17:00:36 2016 +0000\n\n    stop setting mtu when plugging vhost-user ports\n    \n    vhost-user is a userspace protocol to establish connectivity\n    between a virto-net frontend typically qemu and a\n    userspace virtio backend such as ovs with dpdk.\n    \n    vhost-user interfaces exist only in userspace from the host perspective\n    and are not represented in the linux networking stack as kernel netdevs.\n    As a result attempting to set the mtu on a vhost-user interface\n    using ifconfig or ip link will fail with a device not found error.\n    \n    - this change removes a call to _set_device_mtu when plugging\n      vhost-user interfaces.\n    - this change prevents the device not found error from occurring\n      which stopped vms booting with vhost-user interfaces\n      due to an uncaught exception resulting in a failure to set the\n      interface type in ovs.\n    - this change make creating vhost-user interface\n      an atomic action.\n    \n    This latent bug is only triggered when the mtu value is set to a\n    value other than 0 which was the default proir to mitaka.\n    \n    Change-Id: I2e17723d5052d57cd1557bd8a173c06ea0dcb2d4\n    Closes-Bug: #1533876\n    (cherry picked from commit adf7ba61dd73fe4bfffa20295be9a4b1006a1fe6)\n\ncommit a598793ad92057f685100d3b0f30cbc1aa597d38\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Tue Mar 22 06:29:59 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: Id73392e9f47d7ac891237869979d186386f34bfa\n\ncommit 23a202eee87a14b152e25eac1f9b6a0aa14a2bd3\nAuthor: Matthew Booth <email address hidden>\nDate:   Fri Mar 18 12:12:51 2016 +0000\n\n    Fix conversion of config disks to qcow2 during resize/migration\n    \n    finish_migration contains some code which converts raw disks to qcow2\n    when moving from a host which uses raw disks to a host which uses\n    qcow2 disks. This was erroneously also converted config disks, which\n    are hard-coded to be raw even when other disks are qcow2.\n    \n    This has always been broken, but it wasn't previously exposed because\n    a subsequent bug unconditionally overwrote the qcow2 config disk with\n    a new, raw one. Change I03e08fae97416ebe5cdedcf238a06d1b90203c5d\n    changed the order of these 2 events, so that the erroneously-converted\n    config drive was no longer overwritten, resulting in a qcow2 file\n    being presented to the instance as raw.\n    \n    This change explicitly filters out config disks from conversion.\n    \n    Change-Id: I6bf3cd4f9e0e152bf69732d9a17f93c86dedbd40\n    Closes-Bug: #1558343\n    (cherry picked from commit 29fb0aca1623eb0c4a565d728501667a4c5e8136)\n\ncommit f0dc7dbb6823f15e3bad1e407c498b3ce0248665\nAuthor: Pawel Koniszewski <email address hidden>\nDate:   Tue Mar 15 16:13:38 2016 +0100\n\n    xenapi: Fix when auto block_migration in the API\n    \n    When nova calculates live migration type it stores the calculated\n    type in migrate_data.block_migration. Because of that we really should\n    not use block_migration, because it might not be accurate in certain\n    cases.\n    \n    Closes-Bug: #1557585\n    Change-Id: I0796a4b9bfabb1b2132a8253963528a40b1fb680\n    (cherry picked from commit 762605ca4c2ac990b53a50d8f2c52fc793e07c94)\n\ncommit adaa9dee27279e6dda5d95750c626e620ce496a8\nAuthor: John Garbutt <email address hidden>\nDate:   Tue Mar 15 18:23:36 2016 +0000\n\n    xenapi: Fix up passing of sr_uuid_map\n    \n    Currently pre_live_migration breaks the chain of passing the migrate\n    data between the different driver calls.\n    \n    Also, the place that was using sr_uuid_map was not looking for it in the\n    migrate data object, where it now lives.\n    \n    Related-Bug: #1557585\n    Change-Id: I6f210d876816dc59325f3c36c75c2df5c880c61e\n    (cherry picked from commit 8e5188af4c5221faaa60b21fa9c35550a1380e9f)\n\ncommit 15372ef7cc42e43185aef3e8ec960436987970cf\nAuthor: Bob Ball <email address hidden>\nDate:   Tue Mar 15 16:21:00 2016 +0000\n\n    xenapi: Fix the live-migrate aggregate check\n    \n    AggregateList now returns [] if the host is not in an\n    aggregate.  This was causing an IndexError in XenAPI.\n    \n    This change also replaces the AggregateHostNotFound exception,\n    which is not caught properly further up the stack, with the\n    MigrationPreCheckError as this is a suitable substitute since\n    the aggregate check is only part of the pre migration check.\n    \n    Probably introduced by Ibcb896b2eef673bce23491161ff394bcc87aa541\n    \n    Related-Bug: #1557585\n    Change-Id: Icacd3cbe065ee8598e5e5f03bd73463b95ed2f75\n    (cherry picked from commit 38738d79e0774cf71dfff8185330b1f45b64d9fc)\n\ncommit 61b4dcc18ffe0c2b00ef9984af28b7294bcaf68d\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Mon Mar 21 06:29:57 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: Ife86c184c2b8971a18a278d68555d6d646792e25\n\ncommit e9804f545b97a3e84157a6cf74e8482cd9fafdc3\nAuthor: OpenStack Proposal Bot <email address hidden>\nDate:   Fri Mar 18 06:27:59 2016 +0000\n\n    Imported Translations from Zanata\n    \n    For more information about this automatic import see:\n    https://wiki.openstack.org/wiki/Translations/Infrastructure\n    \n    Change-Id: I50fa5f8d7efd9ef1638ec1fe31177d6210588638\n\ncommit a970127bf7d0de2328f8bdfe1f8201c3938b6d77\nAuthor: Thierry Carrez <email address hidden>\nDate:   Wed Mar 16 19:16:46 2016 +0100\n\n    Update .gitreview for stable/mitaka\n    \n    Change-Id: Ie60313913fdb70d6fbbdcceced621e14d2cf54eb\n", 
            "date_created": "2016-04-07 12:53:25.626519+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0b1 development milestone.", 
            "date_created": "2016-06-02 19:34:57.937435+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 14.0.0.0b1 development milestone.", 
            "date_created": "2016-06-02 19:35:13.355700+00:00", 
            "author": "https://api.launchpad.net/1.0/~dims-v"
        }
    ], 
    "closed": "2016-03-18 14:55:51.984942+00:00"
}