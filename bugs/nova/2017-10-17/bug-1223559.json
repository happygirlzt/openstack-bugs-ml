{
    "status": "Fix Released", 
    "last_updated": "2013-10-17 12:14:32.151180+00:00", 
    "description": "\nHavana3 is installed using Packstack on CentOS 6.4.\nNova-compute dies right after start with error \"NameError: global name '_' is not defined\".\n\nHere is the info:\n\n* /etc/nova/nova.conf:\npci_alias={\"name\":\"test\", \"product_id\":\"7190\", \"vendor_id\":\"8086\", \"device_type\":\"ACCEL\"}\n\npci_passthrough_whitelist=[{\"vendor_id\":\"8086\",\"product_id\":\"7190\"}]\n\n\n With that configuration, nova-compute fails with the following log:\n\n* /var/log/nova/compute.log:\n\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n    **args)\n\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n    result = getattr(proxyobj, method)(ctxt, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\", line 567, in object_action\n    result = getattr(objinst, objmethod)(context, *args, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 141, in wrapper\n    return fn(self, ctxt, *args, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\", line 242, in save\n    self._from_db_object(context, self, db_pci)\n\nNameError: global name '_' is not defined\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     x.wait()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 166, in wait\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 192, in main\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\", line 65, in run_service\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     service.start()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 164, in start\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 805, in pre_start_hook\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 4773, in update_available_resource\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 318, in update_available_resource\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self._sync_compute_node(context, resources)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 347, in _sync_compute_node\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self._update(context, resources, prune_stats=True)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 420, in _update\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self.pci_tracker.save(context)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/pci/pci_manager.py\", line 126, in save\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     dev.save(context)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 134, in wrapper\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     ctxt, self, fn.__name__, args, kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/conductor/rpcapi.py\", line 497, in object_action\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     objmethod=objmethod, args=args, kwargs=kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 85, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 63, in _invoke\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return cast_or_call(ctxt, msg, **self.kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/proxy.py\", line 126, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = rpc.call(context, real_topic, msg, timeout)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/__init__.py\", line 139, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/impl_qpid.py\", line 794, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     rpc_amqp.get_connection_pool(conf, Connection))\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 574, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     rv = list(rv)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 539, in __iter__\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     raise result\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup NameError: global name '_' is not defined\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     **args)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\", line 567, in object_action\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = getattr(objinst, objmethod)(context, *args, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 141, in wrapper\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return fn(self, ctxt, *args, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\", line 242, in save\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self._from_db_object(context, self, db_pci)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup NameError: global name '_' is not defined", 
    "tags": [
        "unified-objects"
    ], 
    "importance": "Undecided", 
    "heat": 22, 
    "link": "https://bugs.launchpad.net/nova/+bug/1223559", 
    "owner": "https://api.launchpad.net/1.0/~yongli-he", 
    "id": 1223559, 
    "index": 5336, 
    "openned": "2013-09-10 20:49:19.250376+00:00", 
    "created": "2013-09-10 20:49:19.250376+00:00", 
    "title": "PCI passthrough failing on extra_info", 
    "comments": [
        {
            "content": "\nHavana3 is installed using Packstack on CentOS 6.4.\nNova-compute dies right after start with error \"NameError: global name '_' is not defined\".\n\nHere is the info:\n\n* /etc/nova/nova.conf:\npci_alias={\"name\":\"test\", \"product_id\":\"7190\", \"vendor_id\":\"8086\", \"device_type\":\"ACCEL\"}\n\npci_passthrough_whitelist=[{\"vendor_id\":\"8086\",\"product_id\":\"7190\"}]\n\n\n With that configuration, nova-compute fails with the following log:\n\n* /var/log/nova/compute.log:\n\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n    **args)\n\n  File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n    result = getattr(proxyobj, method)(ctxt, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\", line 567, in object_action\n    result = getattr(objinst, objmethod)(context, *args, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 141, in wrapper\n    return fn(self, ctxt, *args, **kwargs)\n\n  File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\", line 242, in save\n    self._from_db_object(context, self, db_pci)\n\nNameError: global name '_' is not defined\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     x.wait()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 166, in wait\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 192, in main\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\", line 65, in run_service\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     service.start()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 164, in start\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 805, in pre_start_hook\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 4773, in update_available_resource\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 318, in update_available_resource\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self._sync_compute_node(context, resources)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 347, in _sync_compute_node\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self._update(context, resources, prune_stats=True)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 420, in _update\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self.pci_tracker.save(context)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/pci/pci_manager.py\", line 126, in save\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     dev.save(context)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 134, in wrapper\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     ctxt, self, fn.__name__, args, kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/conductor/rpcapi.py\", line 497, in object_action\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     objmethod=objmethod, args=args, kwargs=kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 85, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 63, in _invoke\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return cast_or_call(ctxt, msg, **self.kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/proxy.py\", line 126, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = rpc.call(context, real_topic, msg, timeout)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/__init__.py\", line 139, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/impl_qpid.py\", line 794, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     rpc_amqp.get_connection_pool(conf, Connection))\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 574, in call\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     rv = list(rv)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 539, in __iter__\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     raise result\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup NameError: global name '_' is not defined\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     **args)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\", line 567, in object_action\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = getattr(objinst, objmethod)(context, *args, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 141, in wrapper\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return fn(self, ctxt, *args, **kwargs)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\", line 242, in save\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self._from_db_object(context, self, db_pci)\n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup NameError: global name '_' is not defined", 
            "date_created": "2013-09-10 20:49:19.250376+00:00", 
            "author": "https://api.launchpad.net/1.0/~dkang"
        }, 
        {
            "content": "hi, David\ncould you paste the new trace to the bug ? (note it with the patch) that's close to the fix i think.\n\n\n\ndiff --git a/nova/objects/pci_device.py b/nova/objects/pci_device.py\nindex a83b8f3..d0a628a 100644\n--- a/nova/objects/pci_device.py\n+++ b/nova/objects/pci_device.py\n@@ -145,7 +145,7 @@ class PciDevice(base.NovaPersistentObject,\nbase.NovaObject):\n             if key != 'extra_info':\n                 pci_device[key] = db_dev[key]\n             else:\n-                extra_info = db_dev.get(\"extra_info\")\n+                extra_info = db_dev.get(\"extra_info\", '{}')\n                 pci_device.extra_info = jsonutils.loads(extra_info)\n         pci_device._context = context\n         pci_device.obj_reset_changes()\n\n\n-- \nRussell Bryant", 
            "date_created": "2013-09-11 11:42:02.668137+00:00", 
            "author": "https://api.launchpad.net/1.0/~yongli-he"
        }, 
        {
            "content": "might need to be this instead ...\n\n- extra_info = db_dev.get(\"extra_info\")\n+ extra_info = db_dev.get(\"extra_info\") or '{}'\n", 
            "date_created": "2013-09-11 13:23:29.305214+00:00", 
            "author": "https://api.launchpad.net/1.0/~russellb"
        }, 
        {
            "content": "\n\n----- Original Message -----\n> From: \"Russell Bryant\" <email address hidden>\n> To: <email address hidden>\n> Sent: Wednesday, September 11, 2013 6:23:29 AM\n> Subject: [Bug 1223559] Re: pci passthrough fails with \"NameError: global name '_' is not defined\"\n> might need to be this instead ...\n> \n> - extra_info = db_dev.get(\"extra_info\")\n> + extra_info = db_dev.get(\"extra_info\") or '{}'\n> \n> \n> ** Tags added: unified-objects\n> \n> --\n> You received this bug notification because you are subscribed to the\n> bug\n> report.\n> https://bugs.launchpad.net/bugs/1223559\n> \n> Title:\n> pci passthrough fails with \"NameError: global name '_' is not defined\"\n> \n> Status in OpenStack Compute (Nova):\n> New\n> \n> Bug description:\n> \n> Havana3 is installed using Packstack on CentOS 6.4.\n> Nova-compute dies right after start with error \"NameError: global name\n> '_' is not defined\".\n> \n> Here is the info:\n> \n> * /etc/nova/nova.conf:\n> pci_alias={\"name\":\"test\", \"product_id\":\"7190\", \"vendor_id\":\"8086\",\n> \"device_type\":\"ACCEL\"}\n> \n> pci_passthrough_whitelist=[{\"vendor_id\":\"8086\",\"product_id\":\"7190\"}]\n> \n> \n> With that configuration, nova-compute fails with the following log:\n> \n> * /var/log/nova/compute.log:\n> \n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 461, in _process_data\n> **args)\n> \n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\",\n> line 172, in dispatch\n> result = getattr(proxyobj, method)(ctxt, **kwargs)\n> \n> File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\",\n> line 567, in object_action\n> result = getattr(objinst, objmethod)(context, *args, **kwargs)\n> \n> File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> 141, in wrapper\n> return fn(self, ctxt, *args, **kwargs)\n> \n> File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\",\n> line 242, in save\n> self._from_db_object(context, self, db_pci)\n> \n> NameError: global name '_' is not defined\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> Traceback (most recent call last):\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\",\n> line 117, in wait\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> x.wait()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\",\n> line 49, in wait\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return self.thread.wait()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line\n> 166, in wait\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return self._exit_event.wait()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116,\n> in wait\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return hubs.get_hub().switch()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line\n> 177, in switch\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return self.greenlet.switch()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line\n> 192, in main\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> result = function(*args, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\",\n> line 65, in run_service\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> service.start()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 164, in\n> start\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self.manager.pre_start_hook()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line\n> 805, in pre_start_hook\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self.update_available_resource(nova.context.get_admin_context())\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line\n> 4773, in update_available_resource\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> rt.update_available_resource(context)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\",\n> line 246, in inner\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return f(*args, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 318, in update_available_resource\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self._sync_compute_node(context, resources)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 347, in _sync_compute_node\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self._update(context, resources, prune_stats=True)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 420, in _update\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self.pci_tracker.save(context)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/pci/pci_manager.py\", line\n> 126, in save\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> dev.save(context)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> 134, in wrapper\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> ctxt, self, fn.__name__, args, kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/conductor/rpcapi.py\", line\n> 497, in object_action\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> objmethod=objmethod, args=args, kwargs=kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 85, in\n> call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 63, in\n> _invoke\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return cast_or_call(ctxt, msg, **self.kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/proxy.py\",\n> line 126, in call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> result = rpc.call(context, real_topic, msg, timeout)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/__init__.py\",\n> line 139, in call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return _get_impl().call(CONF, context, topic, msg, timeout)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/impl_qpid.py\",\n> line 794, in call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> rpc_amqp.get_connection_pool(conf, Connection))\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 574, in call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> rv = list(rv)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 539, in __iter__\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> raise result\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> NameError: global name '_' is not defined\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> Traceback (most recent call last):\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 461, in _process_data\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> **args)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\",\n> line 172, in dispatch\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> result = getattr(proxyobj, method)(ctxt, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\",\n> line 567, in object_action\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> result = getattr(objinst, objmethod)(context, *args, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> 141, in wrapper\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return fn(self, ctxt, *args, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\",\n> line 242, in save\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self._from_db_object(context, self, db_pci)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> NameError: global name '_' is not defined\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/1223559/+subscriptions\n\n\n Now old bug is revived. \"NameError: global name '_' is not defined\"\n\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 117, in wait\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     x.wait()\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\", line 49, in wait\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 166, in wait\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116, in wait\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line 177, in switch\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line 192, in main\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\", line 65, in run_service\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     service.start()\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 164, in start\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     self.manager.pre_start_hook()\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 805, in pre_start_hook\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     self.update_available_resource(nova.context.get_admin_context())\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 4773, in update_available_resource\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     rt.update_available_resource(context)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\", line 246, in inner\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return f(*args, **kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 318, in update_available_resource\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     self._sync_compute_node(context, resources)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 347, in _sync_compute_node\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     self._update(context, resources, prune_stats=True)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\", line 420, in _update\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     self.pci_tracker.save(context)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/pci/pci_manager.py\", line 126, in save\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     dev.save(context)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 134, in wrapper\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     ctxt, self, fn.__name__, args, kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/conductor/rpcapi.py\", line 497, in object_action\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     objmethod=objmethod, args=args, kwargs=kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 85, in call\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 63, in _invoke\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return cast_or_call(ctxt, msg, **self.kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/proxy.py\", line 126, in call\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     result = rpc.call(context, real_topic, msg, timeout)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/__init__.py\", line 139, in call\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return _get_impl().call(CONF, context, topic, msg, timeout)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/impl_qpid.py\", line 794, in call\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     rpc_amqp.get_connection_pool(conf, Connection))\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 574, in call\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     rv = list(rv)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 539, in __iter__\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     raise result\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup NameError: global name '_' is not defined\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup \n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     **args)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup \n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     result = getattr(proxyobj, method)(ctxt, **kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup \n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\", line 567, in object_action\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     result = getattr(objinst, objmethod)(context, *args, **kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup \n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 141, in wrapper\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     return fn(self, ctxt, *args, **kwargs)\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup \n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\", line 248, in save\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup     for pci in db_list:\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup \n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\", line 154, in _from_db_object\n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup \n2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup NameError: global name '_' is not defined\n", 
            "date_created": "2013-09-11 14:07:52+00:00", 
            "author": "https://api.launchpad.net/1.0/~dkang"
        }, 
        {
            "content": "> From: \"David Kang\" <email address hidden>\n> To: <email address hidden>\n> Sent: Wednesday, September 11, 2013 10:07:52 AM\n> Subject: Re: [Bug 1223559] Re: pci passthrough fails with \"NameError: global name '_' is not defined\"\n> ----- Original Message -----\n> > From: \"Russell Bryant\" <email address hidden>\n> > To: <email address hidden>\n> > Sent: Wednesday, September 11, 2013 6:23:29 AM\n> > Subject: [Bug 1223559] Re: pci passthrough fails with \"NameError:\n> > global name '_' is not defined\"\n> > might need to be this instead ...\n> >\n> > - extra_info = db_dev.get(\"extra_info\")\n> > + extra_info = db_dev.get(\"extra_info\") or '{}'\n> >\n> >\n> > ** Tags added: unified-objects\n> >\n> > --\n> > You received this bug notification because you are subscribed to the\n> > bug\n> > report.\n> > https://bugs.launchpad.net/bugs/1223559\n> >\n> > Title:\n> > pci passthrough fails with \"NameError: global name '_' is not\n> > defined\"\n> >\n> > Status in OpenStack Compute (Nova):\n> > New\n> >\n> > Bug description:\n> >\n> > Havana3 is installed using Packstack on CentOS 6.4.\n> > Nova-compute dies right after start with error \"NameError: global\n> > name\n> > '_' is not defined\".\n> >\n> > Here is the info:\n> >\n> > * /etc/nova/nova.conf:\n> > pci_alias={\"name\":\"test\", \"product_id\":\"7190\", \"vendor_id\":\"8086\",\n> > \"device_type\":\"ACCEL\"}\n> >\n> > pci_passthrough_whitelist=[{\"vendor_id\":\"8086\",\"product_id\":\"7190\"}]\n> >\n> >\n> > With that configuration, nova-compute fails with the following log:\n> >\n> > * /var/log/nova/compute.log:\n> >\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> > line 461, in _process_data\n> > **args)\n> >\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\",\n> > line 172, in dispatch\n> > result = getattr(proxyobj, method)(ctxt, **kwargs)\n> >\n> > File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\",\n> > line 567, in object_action\n> > result = getattr(objinst, objmethod)(context, *args, **kwargs)\n> >\n> > File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> > 141, in wrapper\n> > return fn(self, ctxt, *args, **kwargs)\n> >\n> > File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\",\n> > line 242, in save\n> > self._from_db_object(context, self, db_pci)\n> >\n> > NameError: global name '_' is not defined\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > Traceback (most recent call last):\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\",\n> > line 117, in wait\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > x.wait()\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\",\n> > line 49, in wait\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return self.thread.wait()\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\",\n> > line\n> > 166, in wait\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return self._exit_event.wait()\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116,\n> > in wait\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return hubs.get_hub().switch()\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line\n> > 177, in switch\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return self.greenlet.switch()\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\",\n> > line\n> > 192, in main\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > result = function(*args, **kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\",\n> > line 65, in run_service\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > service.start()\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 164,\n> > in\n> > start\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > self.manager.pre_start_hook()\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\",\n> > line\n> > 805, in pre_start_hook\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > self.update_available_resource(nova.context.get_admin_context())\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\",\n> > line\n> > 4773, in update_available_resource\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > rt.update_available_resource(context)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\",\n> > line 246, in inner\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return f(*args, **kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> > line 318, in update_available_resource\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > self._sync_compute_node(context, resources)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> > line 347, in _sync_compute_node\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > self._update(context, resources, prune_stats=True)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> > line 420, in _update\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > self.pci_tracker.save(context)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/pci/pci_manager.py\",\n> > line\n> > 126, in save\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > dev.save(context)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> > 134, in wrapper\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > ctxt, self, fn.__name__, args, kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/conductor/rpcapi.py\",\n> > line\n> > 497, in object_action\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > objmethod=objmethod, args=args, kwargs=kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 85,\n> > in\n> > call\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 63,\n> > in\n> > _invoke\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return cast_or_call(ctxt, msg, **self.kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/proxy.py\",\n> > line 126, in call\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > result = rpc.call(context, real_topic, msg, timeout)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/__init__.py\",\n> > line 139, in call\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return _get_impl().call(CONF, context, topic, msg, timeout)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/impl_qpid.py\",\n> > line 794, in call\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > rpc_amqp.get_connection_pool(conf, Connection))\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> > line 574, in call\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > rv = list(rv)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> > line 539, in __iter__\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > raise result\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > NameError: global name '_' is not defined\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > Traceback (most recent call last):\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> > line 461, in _process_data\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > **args)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File\n> > \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\",\n> > line 172, in dispatch\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > result = getattr(proxyobj, method)(ctxt, **kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\",\n> > line 567, in object_action\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > result = getattr(objinst, objmethod)(context, *args, **kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> > 141, in wrapper\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > return fn(self, ctxt, *args, **kwargs)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\",\n> > line 242, in save\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > self._from_db_object(context, self, db_pci)\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > 2013-09-10 12:52:23.774 14749 TRACE\n> > nova.openstack.common.threadgroup\n> > NameError: global name '_' is not defined\n> >\n> > To manage notifications about this bug go to:\n> > https://bugs.launchpad.net/nova/+bug/1223559/+subscriptions\n> \n> \n> Now old bug is revived. \"NameError: global name '_' is not defined\"\n> \n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> Traceback (most recent call last):\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\",\n> line 117, in wait\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> x.wait()\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\",\n> line 49, in wait\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return self.thread.wait()\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line\n> 166, in wait\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return self._exit_event.wait()\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116,\n> in wait\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return hubs.get_hub().switch()\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line\n> 177, in switch\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return self.greenlet.switch()\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line\n> 192, in main\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> result = function(*args, **kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\",\n> line 65, in run_service\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> service.start()\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 164, in\n> start\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> self.manager.pre_start_hook()\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line\n> 805, in pre_start_hook\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> self.update_available_resource(nova.context.get_admin_context())\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line\n> 4773, in update_available_resource\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> rt.update_available_resource(context)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\",\n> line 246, in inner\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return f(*args, **kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 318, in update_available_resource\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> self._sync_compute_node(context, resources)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 347, in _sync_compute_node\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> self._update(context, resources, prune_stats=True)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 420, in _update\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> self.pci_tracker.save(context)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/pci/pci_manager.py\", line\n> 126, in save\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> dev.save(context)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> 134, in wrapper\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> ctxt, self, fn.__name__, args, kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/conductor/rpcapi.py\", line\n> 497, in object_action\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> objmethod=objmethod, args=args, kwargs=kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 85, in\n> call\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 63, in\n> _invoke\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return cast_or_call(ctxt, msg, **self.kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/proxy.py\",\n> line 126, in call\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> result = rpc.call(context, real_topic, msg, timeout)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/__init__.py\",\n> line 139, in call\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return _get_impl().call(CONF, context, topic, msg, timeout)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/impl_qpid.py\",\n> line 794, in call\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> rpc_amqp.get_connection_pool(conf, Connection))\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 574, in call\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> rv = list(rv)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 539, in __iter__\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> raise result\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> NameError: global name '_' is not defined\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> Traceback (most recent call last):\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 461, in _process_data\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> **args)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\",\n> line 172, in dispatch\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> result = getattr(proxyobj, method)(ctxt, **kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\",\n> line 567, in object_action\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> result = getattr(objinst, objmethod)(context, *args, **kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> 141, in wrapper\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> return fn(self, ctxt, *args, **kwargs)\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\",\n> line 248, in save\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> for pci in db_list:\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\",\n> line 154, in _from_db_object\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> 2013-09-11 07:06:41.728 26196 TRACE nova.openstack.common.threadgroup\n> NameError: global name '_' is not defined\n> \n> --\n> You received this bug notification because you are subscribed to the\n> bug\n> report.\n> https://bugs.launchpad.net/bugs/1223559\n> \n> Title:\n> PCI passthrough failing on extra_info\n> \n> Status in OpenStack Compute (Nova):\n> New\n> \n> Bug description:\n> \n> Havana3 is installed using Packstack on CentOS 6.4.\n> Nova-compute dies right after start with error \"NameError: global name\n> '_' is not defined\".\n> \n> Here is the info:\n> \n> * /etc/nova/nova.conf:\n> pci_alias={\"name\":\"test\", \"product_id\":\"7190\", \"vendor_id\":\"8086\",\n> \"device_type\":\"ACCEL\"}\n> \n> pci_passthrough_whitelist=[{\"vendor_id\":\"8086\",\"product_id\":\"7190\"}]\n> \n> \n> With that configuration, nova-compute fails with the following log:\n> \n> * /var/log/nova/compute.log:\n> \n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 461, in _process_data\n> **args)\n> \n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\",\n> line 172, in dispatch\n> result = getattr(proxyobj, method)(ctxt, **kwargs)\n> \n> File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\",\n> line 567, in object_action\n> result = getattr(objinst, objmethod)(context, *args, **kwargs)\n> \n> File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> 141, in wrapper\n> return fn(self, ctxt, *args, **kwargs)\n> \n> File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\",\n> line 242, in save\n> self._from_db_object(context, self, db_pci)\n> \n> NameError: global name '_' is not defined\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> Traceback (most recent call last):\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\",\n> line 117, in wait\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> x.wait()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/threadgroup.py\",\n> line 49, in wait\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return self.thread.wait()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line\n> 166, in wait\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return self._exit_event.wait()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/event.py\", line 116,\n> in wait\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return hubs.get_hub().switch()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/hubs/hub.py\", line\n> 177, in switch\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return self.greenlet.switch()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/eventlet/greenthread.py\", line\n> 192, in main\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> result = function(*args, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/service.py\",\n> line 65, in run_service\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> service.start()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/service.py\", line 164, in\n> start\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self.manager.pre_start_hook()\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line\n> 805, in pre_start_hook\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self.update_available_resource(nova.context.get_admin_context())\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line\n> 4773, in update_available_resource\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> rt.update_available_resource(context)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/lockutils.py\",\n> line 246, in inner\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return f(*args, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 318, in update_available_resource\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self._sync_compute_node(context, resources)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 347, in _sync_compute_node\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self._update(context, resources, prune_stats=True)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/compute/resource_tracker.py\",\n> line 420, in _update\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self.pci_tracker.save(context)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/pci/pci_manager.py\", line\n> 126, in save\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> dev.save(context)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> 134, in wrapper\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> ctxt, self, fn.__name__, args, kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/conductor/rpcapi.py\", line\n> 497, in object_action\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> objmethod=objmethod, args=args, kwargs=kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 85, in\n> call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return self._invoke(self.proxy.call, ctxt, method, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/rpcclient.py\", line 63, in\n> _invoke\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return cast_or_call(ctxt, msg, **self.kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/proxy.py\",\n> line 126, in call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> result = rpc.call(context, real_topic, msg, timeout)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/__init__.py\",\n> line 139, in call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return _get_impl().call(CONF, context, topic, msg, timeout)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/impl_qpid.py\",\n> line 794, in call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> rpc_amqp.get_connection_pool(conf, Connection))\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 574, in call\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> rv = list(rv)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 539, in __iter__\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> raise result\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> NameError: global name '_' is not defined\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> Traceback (most recent call last):\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\",\n> line 461, in _process_data\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> **args)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File\n> \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\",\n> line 172, in dispatch\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> result = getattr(proxyobj, method)(ctxt, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\",\n> line 567, in object_action\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> result = getattr(objinst, objmethod)(context, *args, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line\n> 141, in wrapper\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> return fn(self, ctxt, *args, **kwargs)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\",\n> line 242, in save\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> self._from_db_object(context, self, db_pci)\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> 2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup\n> NameError: global name '_' is not defined\n> \n> To manage notifications about this bug go to:\n> https://bugs.launchpad.net/nova/+bug/1223559/+subscriptions\n\n My previous reply didn't show my comments well.\nHere I send again.\n\n  Now old bug is revived. \"NameError: global name '_' is not defined\"\n\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/amqp.py\", line 461, in _process_data\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     **args)\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/openstack/common/rpc/dispatcher.py\", line 172, in dispatch\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = getattr(proxyobj, method)(ctxt, **kwargs)\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/conductor/manager.py\", line 567, in object_action\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     result = getattr(objinst, objmethod)(context, *args, **kwargs)\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/base.py\", line 141, in wrapper\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     return fn(self, ctxt, *args, **kwargs)\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup   File \"/usr/lib/python2.6/site-packages/nova/objects/pci_device.py\", line 242, in save\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup     self._from_db_object(context, self, db_pci)\n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup \n  2013-09-10 12:52:23.774 14749 TRACE nova.openstack.common.threadgroup NameError: global name '_' is not defined\n", 
            "date_created": "2013-09-11 21:34:05+00:00", 
            "author": "https://api.launchpad.net/1.0/~dkang"
        }, 
        {
            "content": "Yongli, we need below patch, I'm OOP today and have no time to fully test it. A quick check seems it works.\n\ndiff --git a/nova/objects/pci_device.py b/nova/objects/pci_device.py\nindex a83b8f3..b3ae328 100644\n--- a/nova/objects/pci_device.py\n+++ b/nova/objects/pci_device.py\n@@ -136,8 +136,8 @@ class PciDevice(base.NovaPersistentObject, base.NovaObject):\n\n     def __init__(self):\n         super(PciDevice, self).__init__()\n-        self.extra_info = {}\n         self.obj_reset_changes()\n+        self.extra_info = {}\n\n     @staticmethod\n     def _from_db_object(context, pci_device, db_dev):\n", 
            "date_created": "2013-09-11 22:47:35.999750+00:00", 
            "author": "https://api.launchpad.net/1.0/~yunhong-jiang"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/46464", 
            "date_created": "2013-09-13 09:52:37.135963+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/46464\nCommitted: http://github.com/openstack/nova/commit/0663778c531a69bf55ed8f88cd828febd69be44c\nSubmitter: Jenkins\nBranch:    master\n\ncommit 0663778c531a69bf55ed8f88cd828febd69be44c\nAuthor: He Yongli <email address hidden>\nDate:   Fri Sep 13 17:35:59 2013 +0800\n\n    pci passthrough fails while trying to decode extra_info\n    \n    pci device with empty extra_info should use null dict instead of\n    None. keep the init of extra_info to make db could access it.\n    \n    Closes-Bug: #1223559\n    \n    Change-Id: I2e57eb53dfd4f5168d52dc94c2057fc575458aee\n    Signed-off-by: Yongli He <email address hidden>\n", 
            "date_created": "2013-09-13 19:23:21.164342+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2013-10-03 08:01:15.365756+00:00"
}