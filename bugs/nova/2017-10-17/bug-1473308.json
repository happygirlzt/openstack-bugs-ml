{
    "status": "Fix Released", 
    "last_updated": "2017-06-16 17:44:25.502550+00:00", 
    "description": "version: \n2015.1.0\n\nquestion:\nNUMATopologyFilter raise exception and not continue filter next node when there is no wanted pagesize in current filtered host\n\nReproduce steps:\nThere are two compute nodes: Node1 and Node2 . \nNode1 has 2M and 4K page size, and  Node2 has 1G and 4K page size. \nset hw:mem_page_size=1048576 in flavor, and create an instance by using this flavor\n\nExpected result:\nNUMATopologyFilter returns Node2 to build instance\n\nActual result:\nNUMATopologyFilter raise this exception when NUMATopologyFilter filters Node1 and do not continue to filter Node2.\n\nException during message handling: Page size 1048576 is not supported by the host.\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 142, in inner\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     return func(*args, **kwargs)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/manager.py\", line 86, in select_destinations\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     filter_properties)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py\", line 67, in select_destinations\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     filter_properties)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py\", line 138, in _schedule\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     filter_properties, index=num)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/host_manager.py\", line 524, in get_filtered_hosts\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     hosts, filter_properties, index)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/filters.py\", line 78, in get_filtered_objects\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     list_objs = list(objs)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/filters.py\", line 44, in filter_all\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     if self._filter_one(obj, filter_properties):\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/filters/__init__.py\", line 27, in _filter_one\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     return self.host_passes(obj, filter_properties)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/filters/numa_topology_filter.py\", line 54, in host_passes\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     pci_stats=host_state.pci_stats))\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/hardware.py\", line 1048, in numa_fit_instance_to_host\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     host_cell, instance_cell, limits)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/hardware.py\", line 778, in _numa_fit_instance_cell\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     host_cell, instance_cell)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/hardware.py\", line 631, in _numa_cell_supports_pagesize_request\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     return verify_pagesizes(host_cell, inst_cell, [inst_cell.pagesize])\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/hardware.py\", line 621, in verify_pagesizes\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     if host_cell.can_fit_hugepages(pagesize, inst_cell_mem):\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/objects/numa.py\", line 144, in can_fit_hugepages\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     raise exception.MemoryPageSizeNotSupported(pagesize=pagesize)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher MemoryPageSizeNotSupported: Page size 1048576 is not supported by the host.", 
    "tags": [
        "kilo-backport-potential", 
        "liberty-backport-potential", 
        "libvirt", 
        "numa"
    ], 
    "importance": "Medium", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1473308", 
    "owner": "https://api.launchpad.net/1.0/~lyanchih", 
    "id": 1473308, 
    "index": 4293, 
    "openned": "2015-07-10 07:35:27.713507+00:00", 
    "created": "2015-07-10 07:35:27.713507+00:00", 
    "title": "NUMATopologyFilter raise exception and not continue filter next node when there is no wanted pagesize in current filtered host", 
    "comments": [
        {
            "content": "version: \n2015.1.0\n\nquestion:\nNUMATopologyFilter raise exception and not continue filter next node when there is no wanted pagesize in current filtered host\n\nReproduce steps:\nThere are two compute nodes: Node1 and Node2 . \nNode1 has 2M and 4K page size, and  Node2 has 1G and 4K page size. \nset hw:mem_page_size=1048576 in flavor, and create an instance by using this flavor\n\nExpected result:\nNUMATopologyFilter returns Node2 to build instance\n\nActual result:\nNUMATopologyFilter raise this exception when NUMATopologyFilter filters Node1 and do not continue to filter Node2.\n\nException during message handling: Page size 1048576 is not supported by the host.\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher Traceback (most recent call last):\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 142, in _dispatch_and_reply\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     executor_callback))\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 186, in _dispatch\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     executor_callback)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py\", line 130, in _do_dispatch\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     result = func(ctxt, **new_args)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py\", line 142, in inner\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     return func(*args, **kwargs)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/manager.py\", line 86, in select_destinations\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     filter_properties)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py\", line 67, in select_destinations\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     filter_properties)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py\", line 138, in _schedule\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     filter_properties, index=num)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/host_manager.py\", line 524, in get_filtered_hosts\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     hosts, filter_properties, index)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/filters.py\", line 78, in get_filtered_objects\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     list_objs = list(objs)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/filters.py\", line 44, in filter_all\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     if self._filter_one(obj, filter_properties):\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/filters/__init__.py\", line 27, in _filter_one\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     return self.host_passes(obj, filter_properties)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/scheduler/filters/numa_topology_filter.py\", line 54, in host_passes\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     pci_stats=host_state.pci_stats))\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/hardware.py\", line 1048, in numa_fit_instance_to_host\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     host_cell, instance_cell, limits)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/hardware.py\", line 778, in _numa_fit_instance_cell\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     host_cell, instance_cell)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/hardware.py\", line 631, in _numa_cell_supports_pagesize_request\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     return verify_pagesizes(host_cell, inst_cell, [inst_cell.pagesize])\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/virt/hardware.py\", line 621, in verify_pagesizes\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     if host_cell.can_fit_hugepages(pagesize, inst_cell_mem):\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher   File \"/usr/lib/python2.7/site-packages/nova/objects/numa.py\", line 144, in can_fit_hugepages\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher     raise exception.MemoryPageSizeNotSupported(pagesize=pagesize)\n2015-07-09 13:08:56.771 10446 TRACE oslo_messaging.rpc.dispatcher MemoryPageSizeNotSupported: Page size 1048576 is not supported by the host.", 
            "date_created": "2015-07-10 07:35:27.713507+00:00", 
            "author": "https://api.launchpad.net/1.0/~liu-lixiu"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/200630", 
            "date_created": "2015-07-10 17:06:22.936167+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by Michael Still (<email address hidden>) on branch: master\nReview: https://review.openstack.org/200630\nReason: This change has stalled. Please restore it when its ready for further review.", 
            "date_created": "2015-11-17 01:12:07.052715+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/200630\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=920586868daeef4367a5ea367e394d3fe3e572f5\nSubmitter: Jenkins\nBranch:    master\n\ncommit 920586868daeef4367a5ea367e394d3fe3e572f5\nAuthor: lyanchih <email address hidden>\nDate:   Fri Jul 10 17:03:31 2015 +0000\n\n    NUMATopologyFilter raise exception and not continue filter next node\n    \n    NUMATopologyFilter raise exception and not continue filter next node\n    when there is no wanted pagesize in current filtered host.\n    \n    Catch MemoryPageSizeNotSupported exception to prevent this exception\n    suspend procedure of filter hosts.\n    \n    Change-Id: Ice092c871beeca5de2fa6bbf274240f4db508008\n    Closes-Bug: 1473308\n", 
            "date_created": "2016-03-02 04:01:34.741085+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 13.0.0.0b3 development milestone.", 
            "date_created": "2016-03-03 16:18:20.717974+00:00", 
            "author": "https://api.launchpad.net/1.0/~doug-hellmann"
        }
    ], 
    "closed": "2016-03-02 04:01:32.710954+00:00"
}