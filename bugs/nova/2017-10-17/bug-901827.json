{
    "status": "Fix Released", 
    "last_updated": "2013-10-22 05:45:33.001106+00:00", 
    "description": "When we run instance with no enough memory state, it cause Uncaught exception.\n\n1. Such exception should be wrapped.\n2. We should check available memory when we launch new instance.\n\n2011-11-25 18:05:32,840 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE: File \"/opt/stack/nova/nova/exception.py\", line 98, in wrapped\n(nova.exception): TRACE: return f(*args, **kw)\n(nova.exception): TRACE: File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 606, in spawn\n(nova.exception): TRACE: domain = self._create_new_domain(xml)\n(nova.exception): TRACE: File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1217, in _create_new_domain\n(nova.exception): TRACE: domain.createWithFlags(launch_flags)\n(nova.exception): TRACE: File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 337, in createWithFlags\n(nova.exception): TRACE: if ret == 1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n(nova.exception): TRACE: libvirtError: internal error Process exited while reading console log output: char device redirected to /dev/pts/5\n(nova.exception): TRACE: Failed to allocate 536870912 B: Cannot allocate memory\n(nova.exception): TRACE: \n(nova.exception): TRACE: \n2011-11-25 18:05:32,956 ERROR nova.compute.manager [] Instance '98' failed to spawn. Is virtualization enabled in the BIOS? Details: internal error Process exited while reading console log output: char device redirected to /dev/pts/5\nFailed to allocate 536870912 B: Cannot allocate memory\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE: File \"/opt/stack/nova/nova/compute/manager.py\", line 424, in _run_instance\n(nova.compute.manager): TRACE: network_info, block_device_info)\n(nova.compute.manager): TRACE: File \"/opt/stack/nova/nova/exception.py\", line 129, in wrapped\n(nova.compute.manager): TRACE: raise Error(str(e))\n(nova.compute.manager): TRACE: Error: internal error Process exited while reading console log output: char device redirected to /dev/pts/5\n(nova.compute.manager): TRACE: Failed to allocate 536870912 B: Cannot allocate memory\n(nova.compute.manager): TRACE:", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/901827", 
    "owner": "None", 
    "id": 901827, 
    "index": 2681, 
    "openned": "2011-12-08 19:08:26.348163+00:00", 
    "created": "2011-12-08 19:08:26.348163+00:00", 
    "title": "Uncaught exception for create server with Cannot allocate memory", 
    "comments": [
        {
            "content": "When we run instance with no enough memory state, it cause Uncaught exception.\n\n1. Such exception should be wrapped.\n2. We should check available memory when we launch new instance.\n\n2011-11-25 18:05:32,840 ERROR nova.exception [-] Uncaught exception\n(nova.exception): TRACE: Traceback (most recent call last):\n(nova.exception): TRACE: File \"/opt/stack/nova/nova/exception.py\", line 98, in wrapped\n(nova.exception): TRACE: return f(*args, **kw)\n(nova.exception): TRACE: File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 606, in spawn\n(nova.exception): TRACE: domain = self._create_new_domain(xml)\n(nova.exception): TRACE: File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 1217, in _create_new_domain\n(nova.exception): TRACE: domain.createWithFlags(launch_flags)\n(nova.exception): TRACE: File \"/usr/lib/python2.7/dist-packages/libvirt.py\", line 337, in createWithFlags\n(nova.exception): TRACE: if ret == 1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n(nova.exception): TRACE: libvirtError: internal error Process exited while reading console log output: char device redirected to /dev/pts/5\n(nova.exception): TRACE: Failed to allocate 536870912 B: Cannot allocate memory\n(nova.exception): TRACE: \n(nova.exception): TRACE: \n2011-11-25 18:05:32,956 ERROR nova.compute.manager [] Instance '98' failed to spawn. Is virtualization enabled in the BIOS? Details: internal error Process exited while reading console log output: char device redirected to /dev/pts/5\nFailed to allocate 536870912 B: Cannot allocate memory\n(nova.compute.manager): TRACE: Traceback (most recent call last):\n(nova.compute.manager): TRACE: File \"/opt/stack/nova/nova/compute/manager.py\", line 424, in _run_instance\n(nova.compute.manager): TRACE: network_info, block_device_info)\n(nova.compute.manager): TRACE: File \"/opt/stack/nova/nova/exception.py\", line 129, in wrapped\n(nova.compute.manager): TRACE: raise Error(str(e))\n(nova.compute.manager): TRACE: Error: internal error Process exited while reading console log output: char device redirected to /dev/pts/5\n(nova.compute.manager): TRACE: Failed to allocate 536870912 B: Cannot allocate memory\n(nova.compute.manager): TRACE:", 
            "date_created": "2011-12-08 19:08:26.348163+00:00", 
            "author": "https://api.launchpad.net/1.0/~nati-ueno"
        }, 
        {
            "content": "I tried to reproduce the bug in Essex\nI tried to launch an instance when there is no available memory,am unable to create instance  as the instance is getting created in ERROR state.\nIt seems that bug got fixed in Essex.", 
            "date_created": "2012-04-19 08:49:59.883037+00:00", 
            "author": "https://api.launchpad.net/1.0/~shilpa-batchu"
        }, 
        {
            "content": "Got the same problem.VM went to error state and log shows Cannot allocate memory\n\n013-05-09 23:42:45.007 AUDIT nova.compute.manager [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Starting instance...\n2013-05-09 23:42:45.250 AUDIT nova.compute.claims [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Attempting claim: memory 8192 MB, disk 80 GB, VCPUs 4\n2013-05-09 23:42:45.251 AUDIT nova.compute.claims [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Total Memory: 11912 MB, used: 93696 MB\n2013-05-09 23:42:45.252 AUDIT nova.compute.claims [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Memory limit not specified, defaulting to unlimited\n2013-05-09 23:42:45.253 AUDIT nova.compute.claims [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Total Disk: 6 GB, used: 760 GB\n2013-05-09 23:42:45.253 AUDIT nova.compute.claims [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Disk limit not specified, defaulting to unlimited\n2013-05-09 23:42:45.254 AUDIT nova.compute.claims [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Total CPU: 8 VCPUs, used: 68 VCPUs\n2013-05-09 23:42:45.254 AUDIT nova.compute.claims [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] CPU limit not specified, defaulting to unlimited\n2013-05-09 23:42:45.255 AUDIT nova.compute.claims [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Claim successful\n2013-05-09 23:43:07.373 INFO nova.virt.libvirt.driver [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Creating image\n2013-05-09 23:43:07.538 INFO nova.virt.libvirt.firewall [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Called setup_basic_filtering in nwfilter\n2013-05-09 23:43:07.539 INFO nova.virt.libvirt.firewall [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Ensuring static filters\n2013-05-09 23:43:08.610 ERROR nova.compute.manager [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Instance failed to spawn\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Traceback (most recent call last):\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]   File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1043, in _spawn\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]     block_device_info)\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 1482, in spawn\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]     block_device_info)\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2370, in _create_domain_and_network\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]     domain = self._create_domain(xml, instance=instance)\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]   File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2331, in _create_domain\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]     domain.createWithFlags(launch_flags)\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]   File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 187, in doit\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]     result = proxy_call(self._autowrap, f, *args, **kwargs)\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]   File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 147, in proxy_call\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]     rv = execute(f,*args,**kwargs)\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]   File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 76, in tworker\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]     rv = meth(*args,**kwargs)\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]   File \"/usr/lib64/python2.6/site-packages/libvirt.py\", line 649, in createWithFlags\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]     if ret == -1: raise libvirtError ('virDomainCreateWithFlags() failed', dom=self)\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] libvirtError: internal error Process exited while reading console log output: char device redirected to /dev/pts/52\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Failed to allocate 8589934592 B: Cannot allocate memory\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]\n2013-05-09 23:43:08.610 5834 TRACE nova.compute.manager [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523]\n2013-05-09 23:43:13.062 ERROR nova.compute.manager [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] [instance: 768ecc43-9c3d-40b2-8aae-5ceeff319523] Error: ['Traceback (most recent call last):\\n', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 774, in _run_instance\\n    injected_files, admin_password)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/compute/manager.py\", line 1043, in _spawn\\n    block_device_info)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 1482, in spawn\\n    block_device_info)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2370, in _create_domain_and_network\\n    domain = self._create_domain(xml, instance=instance)\\n', '  File \"/usr/lib/python2.6/site-packages/nova/virt/libvirt/driver.py\", line 2331, in _create_domain\\n    domain.createWithFlags(launch_flags)\\n', '  File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 187, in doit\\n    result = proxy_call(self._autowrap, f, *args, **kwargs)\\n', '  File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 147, in proxy_call\\n    rv = execute(f,*args,**kwargs)\\n', '  File \"/usr/lib/python2.6/site-packages/eventlet/tpool.py\", line 76, in tworker\\n    rv = meth(*args,**kwargs)\\n', '  File \"/usr/lib64/python2.6/site-packages/libvirt.py\", line 649, in createWithFlags\\n    if ret == -1: raise libvirtError (\\'virDomainCreateWithFlags() failed\\', dom=self)\\n', 'libvirtError: internal error Process exited while reading console log output: char device redirected to /dev/pts/52\\nFailed to allocate 8589934592 B: \nCannot allocate memory\\n\\n']\n2013-05-09 23:43:13.989 ERROR nova.openstack.common.rpc.amqp [req-c9263db7-4a5a-46f0-9dec-83c685532d9e 67db0e01cd484add99ec9219874920b7 b8f3447eb2bf49499c9e7af2ca048be9] Exception during message handling\n\n", 
            "date_created": "2013-05-10 08:18:37.993771+00:00", 
            "author": "https://api.launchpad.net/1.0/~mathivathani-s"
        }
    ], 
    "closed": "2012-04-23 14:21:47.779284+00:00"
}