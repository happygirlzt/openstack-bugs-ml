{
    "status": "Expired", 
    "last_updated": "2017-08-27 04:18:47.794212+00:00", 
    "description": "I am running OpenStack Mitaka on CentOS7.1 with Citrix XenServer 6.5 Standard Edition. My XenServer host has been installed following software updates: XS65ESP1,XS65ESP1013 and XS65ESP1021. I Use Cloud-init to customize OpenStack instances by enabling force_config_drive configuration item. For CentOS and Ubuntu OS., Cloud-init works well, which can customize hostname, password and network address properly, but for windows OS.,Cloudbase-init works badly.\n\nI generate Windows Server 2012 R2 image according to this blog (url: https://www.citrix.com/blogs/2016/09/08/generating-images-for-xenserver-in-openstack/). Cloudbase-init version 0.9.9. Instance name in OpenStack is aaa2 and it's name in XenServer is aaa2-1.\n \nTaking a look on XenCenter connected to my XenServer, seems like config-2 vfat disk is\nworking fine, this is a print screen:\n|----------------------------------------------------------------------------------------------------------------------------\n|Position  Name         Description  SR                   Size   Read Only     Priority    Active  Device Path\n|0       aaa2-1        root       Local storage on xenserver   40G    No         0(Lowest)    Yes    /dev/xvda\n|3       config-2      configdrive  Local storage on xenserver   64M    Yes        0(Lowest)    Yes    /dev/xvdd          \n|----------------------------------------------------------------------------------------------------------------------------\n\nBut, I need reset administrator's password when login this instance( Windows prompts the user's password must be changed before signing in). After reseting password and logon, I find hostname and network address have not been customized according to the instance metadata. In Disk Management of Server Manager, vfat disk has not been listed.\n\nCloudbase-init log file contains this:\n\n........\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Looking for Config Drive vfat in partition get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:206\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Looking for Config Drive vfat in cdrom get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:206\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Irrelevant type vfat in cdrom location; get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:195\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Looking for Config Drive vfat in hdd get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:206\n\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.utils.windows.vfat [-] Could not retrieve label for VFAT drive path '\\\\\\\\.\\\\PHYSICALDRIVE0' is_vfat_drive c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\utils\\windows\\vfat.py:53\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.utils.windows.vfat [-] mlabel failed with error b\"init :: sector size (190) not a small power of two\\r\\nCannot initalize  '::'\\r\\nC:\\\\Program Files\\\\Cloudbase Solutions\\\\Cloudbase-Init\\\\bin\\\\mlabel: Cannot initialize drive\\r\\n\" is_vfat_drive c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\utils\\windows\\vfat.py:54\n\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Looking for Config Drive iso in partition get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:206\n........\n\n\nI checked the cloudbase-init configuration item carefully and found no errors. I have read several posts, they all don't mention above problem.\n\nThanks in advance for your help.", 
    "tags": [
        "openstack-version.mitaka", 
        "xenserver"
    ], 
    "importance": "Undecided", 
    "heat": 12, 
    "link": "https://bugs.launchpad.net/nova/+bug/1686056", 
    "owner": "None", 
    "id": 1686056, 
    "index": 8084, 
    "openned": "2017-04-25 09:41:00.819623+00:00", 
    "created": "2017-04-25 09:41:00.819623+00:00", 
    "title": "xenserver windows instance customize failed by cloudbase-init", 
    "comments": [
        {
            "content": "I am running OpenStack Mitaka on CentOS7.1 with Citrix XenServer 6.5 Standard Edition. My XenServer host has been installed following software updates: XS65ESP1,XS65ESP1013 and XS65ESP1021. I Use Cloud-init to customize OpenStack instances by enabling force_config_drive configuration item. For CentOS and Ubuntu OS., Cloud-init works well, which can customize hostname, password and network address properly, but for windows OS.,Cloudbase-init works badly.\n\nI generate Windows Server 2012 R2 image according to this blog (url: https://www.citrix.com/blogs/2016/09/08/generating-images-for-xenserver-in-openstack/). Cloudbase-init version 0.9.9. Instance name in OpenStack is aaa2 and it's name in XenServer is aaa2-1.\n \nTaking a look on XenCenter connected to my XenServer, seems like config-2 vfat disk is\nworking fine, this is a print screen:\n|----------------------------------------------------------------------------------------------------------------------------\n|Position  Name         Description  SR                   Size   Read Only     Priority    Active  Device Path\n|0       aaa2-1        root       Local storage on xenserver   40G    No         0(Lowest)    Yes    /dev/xvda\n|3       config-2      configdrive  Local storage on xenserver   64M    Yes        0(Lowest)    Yes    /dev/xvdd          \n|----------------------------------------------------------------------------------------------------------------------------\n\nBut, I need reset administrator's password when login this instance( Windows prompts the user's password must be changed before signing in). After reseting password and logon, I find hostname and network address have not been customized according to the instance metadata. In Disk Management of Server Manager, vfat disk has not been listed.\n\nCloudbase-init log file contains this:\n\n........\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Looking for Config Drive vfat in partition get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:206\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Looking for Config Drive vfat in cdrom get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:206\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Irrelevant type vfat in cdrom location; get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:195\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Looking for Config Drive vfat in hdd get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:206\n\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.utils.windows.vfat [-] Could not retrieve label for VFAT drive path '\\\\\\\\.\\\\PHYSICALDRIVE0' is_vfat_drive c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\utils\\windows\\vfat.py:53\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.utils.windows.vfat [-] mlabel failed with error b\"init :: sector size (190) not a small power of two\\r\\nCannot initalize  '::'\\r\\nC:\\\\Program Files\\\\Cloudbase Solutions\\\\Cloudbase-Init\\\\bin\\\\mlabel: Cannot initialize drive\\r\\n\" is_vfat_drive c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\utils\\windows\\vfat.py:54\n\n2017-04-08 03:49:05.560 1696 DEBUG cloudbaseinit.metadata.services.osconfigdrive.windows [-] Looking for Config Drive iso in partition get_config_drive_files c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\osconfigdrive\\windows.py:206\n........\n\n\nI checked the cloudbase-init configuration item carefully and found no errors. I have read several posts, they all don't mention above problem.\n\nThanks in advance for your help.", 
            "date_created": "2017-04-25 09:41:00.819623+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhoujm-cri"
        }, 
        {
            "content": "hi Jianming, \nCould you help to supply the full log file and configure files for the cloudbase-init? the vfat error on \"'\\\\\\\\.\\\\PHYSICALDRIVE0'\" should be expected. As PHYSICALDRIVE0 is the windows root partition; does it continue to test the next disk drive - PHYSICALDRIVE1?\n\n\nDid you checked if the metadata service is reachable? http://169.254.169.254/latest/meta-data \n\nI'd also suggest you disable cloudbase-init to fetch metadata from metadata_services by emptying the following item in cloudbase-init.unattend.conf.\nmetadata_services=\n", 
            "date_created": "2017-06-16 11:36:29.679864+00:00", 
            "author": "https://api.launchpad.net/1.0/~wjh-fresh"
        }, 
        {
            "content": "", 
            "date_created": "2017-06-21 09:30:38.945925+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhoujm-cri"
        }, 
        {
            "content": "", 
            "date_created": "2017-06-21 11:42:55.647790+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhoujm-cri"
        }, 
        {
            "content": "", 
            "date_created": "2017-06-21 11:42:57.880370+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhoujm-cri"
        }, 
        {
            "content": "I did not check the metadata service is reachable. I will accept your suggestion.", 
            "date_created": "2017-06-21 11:48:29.129831+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhoujm-cri"
        }, 
        {
            "content": "In my environment, it works well: the config drive is there and cloudbase-init can customize instance basing on the metadata.\n\n2017-06-22 06:07:17.134 1728 DEBUG cloudbaseinit.utils.windows.vfat [-] Obtained label information for drive '\\\\\\\\.\\\\PHYSICALDRIVE1': b' Volume label is config-2   \\r\\n' is_vfat_drive c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\utils\\windows\\vfat.py:50\n2017-06-22 06:07:17.134 1728 INFO cloudbaseinit.metadata.services.osconfigdrive.windows [-] Config Drive found on disk '\\\\\\\\.\\\\PHYSICALDRIVE1'\n2017-06-22 06:07:17.181 1728 DEBUG cloudbaseinit.metadata.services.configdrive [-] Metadata copied to folder: 'C:\\\\Windows\\\\TEMP\\\\tmpk2zpf80h' load c:\\program files\\cloudbase solutions\\cloudbase-init\\python\\lib\\site-packages\\cloudbaseinit\\metadata\\services\\configdrive.py:74\n\n\n2017-06-22 06:07:17.196 1728 INFO cloudbaseinit.utils.hostname [-] Setting hostname: testvm-2012-2", 
            "date_created": "2017-06-22 08:08:51.167824+00:00", 
            "author": "https://api.launchpad.net/1.0/~wjh-fresh"
        }, 
        {
            "content": "Note: In my test, I'm using the latest stable cloudbase-init v 0.9.11 and fully followed the blog (url: https://www.citrix.com/blogs/2016/09/08/generating-images-for-xenserver-in-openstack/). \n\nCould you help to double check if you can still reproduce this issue?\nPlease ensure the option of \"Run Sysprep to create a generallized image.\" is marked during setup cloudbase-init. If it's reproduced, it should be helpful to take a screen snapshot of the disk management page in the Windows Instance. The config_drive should not display in the volume list, but there should be an disk shows as \"Unknown\" and the size is 64 MB.\n\nDuring the OpenStack instance boot-up, cloudbase-init usually should create two log files. Beside the above posted log file - cloudbase-init.log, there should be another log file named as cloudbase-init-unattened.log generated by cloudbase-init which is executed by extending sysprep minisetup. Please check this log file also. Not sure if your problem is relative to sysprep.", 
            "date_created": "2017-06-22 08:57:27.626262+00:00", 
            "author": "https://api.launchpad.net/1.0/~wjh-fresh"
        }, 
        {
            "content": "Automatically discovered version mitaka in description. If this is incorrect, please update the description to include 'nova version: ...'", 
            "date_created": "2017-06-27 16:04:43.281838+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }, 
        {
            "content": "[Expired for OpenStack Compute (nova) because there has been no activity for 60 days.]", 
            "date_created": "2017-08-27 04:18:43.425306+00:00", 
            "author": "https://api.launchpad.net/1.0/~janitor"
        }
    ], 
    "closed": "2017-08-27 04:18:44.229000+00:00"
}