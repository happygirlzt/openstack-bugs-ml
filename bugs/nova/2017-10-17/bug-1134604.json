{
    "status": "Won't Fix", 
    "last_updated": "2014-09-17 11:56:12.709976+00:00", 
    "description": "We recently run out IP address in the subnet used for our instances and we had to extend out subnet from /24 to /23.\n\nWe edited /etc/nova/nova.conf, restared nova-network using /etc/init.d/nova-network restart.\n\"ifconfig bf100\" was showing correct (new) netmask so was \"nova-manage network list\"\n\nWhen new instances were about to use new range they failed to get IPs:\n\nOn compute node:\n2013-02-27 10:46:38 ERROR nova.compute.manager [req-xxxx xxxx xxxx] [instance: xxxx] Instance failed network setup\n\nAnd corresponding on our controller:\n2013-02-27 10:46:38 DEBUG nova.network.manager [req-xxxx xxxx xxxx] [instance: xxxx] networks retrieved for instance: |[<nova.db.sqlalchemy.models.Network object at 0x4997850>]| from (pid=2687) allocate_for_instance /usr/lib/python2.7/dist-packages/nova/network/manager.py:982\n2013-02-27 10:46:38 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 257, in wrapped\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     return func(self, context, *args, **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 320, in allocate_for_instance\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 257, in wrapped\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     return func(self, context, *args, **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 986, in allocate_for_instance\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     requested_networks=requested_networks)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 213, in _allocate_fixed_ips\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     vpn=vpn, address=address)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 1265, in allocate_fixed_ip\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     instance_ref['uuid'])\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 442, in fixed_ip_associate_pool\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     instance_uuid, host)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 111, in wrapper\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1089, in fixed_ip_associate_pool\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     raise exception.NoMoreFixedIps()\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp NoMoreFixedIps: Zero fixed ips available.\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp \n2013-02-27 10:46:38 ERROR nova.openstack.common.rpc.common [-] Returning exception Zero fixed ips available. to caller\n\nAfter some investigation we realised that fixed_ips table in nova DB only had IPs from the old range. We added new IPs using:\nINSERT INTO fixed_ips (created_at, deleted, allocated, leased, reserved, network_id, address) VALUES (CURDATE(), 0,0,0,0, 1, \"xx.xx.xx.xx\");\nwhich allowed our instances to get IPs from new range.\n\nOn compute node we are running:\nii  nova-common                      2012.2-0ubuntu5~cloud0                        OpenStack Compute - common files\nii  nova-compute                     2012.2-0ubuntu5~cloud0                        OpenStack Compute - compute node\nii  nova-compute-kvm                 2012.2-0ubuntu5~cloud0                        OpenStack Compute - compute node (KVM)\nii  python-nova                      2012.2-0ubuntu5~cloud0                        OpenStack Compute Python libraries\nii  python-novaclient                1:2.9.0-0ubuntu1~cloud0                       client library for OpenStack Compute API\n\nand on the controller:\nii  nova-api                         2012.2-0ubuntu5~cloud0                        OpenStack Compute - API frontend\nii  nova-cert                        2012.2-0ubuntu5~cloud0                        OpenStack Compute - certificate management\nii  nova-common                      2012.2-0ubuntu5~cloud0                        OpenStack Compute - common files\nii  nova-doc                         2012.2-0ubuntu5~cloud0                        OpenStack Compute - documentation\nii  nova-network                     2012.2-0ubuntu5~cloud0                        OpenStack Compute - Network manager\nii  nova-objectstore                 2012.2-0ubuntu5~cloud0                        OpenStack Compute - object store\nii  nova-scheduler                   2012.2-0ubuntu5~cloud0                        OpenStack Compute - virtual machine scheduler\nii  python-nova                      2012.2-0ubuntu5~cloud0                        OpenStack Compute Python libraries\nii  python-novaclient                1:2.9.0-0ubuntu1~cloud0                       client library for OpenStack Compute API\n\nBoth running:\nDescription:\tUbuntu 12.04.2 LTS\nRelease:\t12.04", 
    "tags": [
        "canonistack", 
        "network"
    ], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/1134604", 
    "owner": "None", 
    "id": 1134604, 
    "index": 4719, 
    "openned": "2013-02-27 17:48:41.676323+00:00", 
    "created": "2013-02-27 17:48:41.676323+00:00", 
    "title": "New IPs not available after subnet changes", 
    "comments": [
        {
            "content": "We recently run out IP address in the subnet used for our instances and we had to extend out subnet from /24 to /23.\n\nWe edited /etc/nova/nova.conf, restared nova-network using /etc/init.d/nova-network restart.\n\"ifconfig bf100\" was showing correct (new) netmask so was \"nova-manage network list\"\n\nWhen new instances were about to use new range they failed to get IPs:\n\nOn compute node:\n2013-02-27 10:46:38 ERROR nova.compute.manager [req-xxxx xxxx xxxx] [instance: xxxx] Instance failed network setup\n\nAnd corresponding on our controller:\n2013-02-27 10:46:38 DEBUG nova.network.manager [req-xxxx xxxx xxxx] [instance: xxxx] networks retrieved for instance: |[<nova.db.sqlalchemy.models.Network object at 0x4997850>]| from (pid=2687) allocate_for_instance /usr/lib/python2.7/dist-packages/nova/network/manager.py:982\n2013-02-27 10:46:38 ERROR nova.openstack.common.rpc.amqp [-] Exception during message handling\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp Traceback (most recent call last):\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/amqp.py\", line 275, in _process_data\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     rval = self.proxy.dispatch(ctxt, version, method, **args)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/openstack/common/rpc/dispatcher.py\", line 145, in dispatch\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     return getattr(proxyobj, method)(ctxt, **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 257, in wrapped\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     return func(self, context, *args, **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 320, in allocate_for_instance\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 257, in wrapped\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     return func(self, context, *args, **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 986, in allocate_for_instance\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     requested_networks=requested_networks)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 213, in _allocate_fixed_ips\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     vpn=vpn, address=address)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 1265, in allocate_fixed_ip\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     instance_ref['uuid'])\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/api.py\", line 442, in fixed_ip_associate_pool\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     instance_uuid, host)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 111, in wrapper\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     return f(*args, **kwargs)\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp   File \"/usr/lib/python2.7/dist-packages/nova/db/sqlalchemy/api.py\", line 1089, in fixed_ip_associate_pool\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp     raise exception.NoMoreFixedIps()\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp NoMoreFixedIps: Zero fixed ips available.\n2013-02-27 10:46:38 TRACE nova.openstack.common.rpc.amqp \n2013-02-27 10:46:38 ERROR nova.openstack.common.rpc.common [-] Returning exception Zero fixed ips available. to caller\n\nAfter some investigation we realised that fixed_ips table in nova DB only had IPs from the old range. We added new IPs using:\nINSERT INTO fixed_ips (created_at, deleted, allocated, leased, reserved, network_id, address) VALUES (CURDATE(), 0,0,0,0, 1, \"xx.xx.xx.xx\");\nwhich allowed our instances to get IPs from new range.\n\nOn compute node we are running:\nii  nova-common                      2012.2-0ubuntu5~cloud0                        OpenStack Compute - common files\nii  nova-compute                     2012.2-0ubuntu5~cloud0                        OpenStack Compute - compute node\nii  nova-compute-kvm                 2012.2-0ubuntu5~cloud0                        OpenStack Compute - compute node (KVM)\nii  python-nova                      2012.2-0ubuntu5~cloud0                        OpenStack Compute Python libraries\nii  python-novaclient                1:2.9.0-0ubuntu1~cloud0                       client library for OpenStack Compute API\n\nand on the controller:\nii  nova-api                         2012.2-0ubuntu5~cloud0                        OpenStack Compute - API frontend\nii  nova-cert                        2012.2-0ubuntu5~cloud0                        OpenStack Compute - certificate management\nii  nova-common                      2012.2-0ubuntu5~cloud0                        OpenStack Compute - common files\nii  nova-doc                         2012.2-0ubuntu5~cloud0                        OpenStack Compute - documentation\nii  nova-network                     2012.2-0ubuntu5~cloud0                        OpenStack Compute - Network manager\nii  nova-objectstore                 2012.2-0ubuntu5~cloud0                        OpenStack Compute - object store\nii  nova-scheduler                   2012.2-0ubuntu5~cloud0                        OpenStack Compute - virtual machine scheduler\nii  python-nova                      2012.2-0ubuntu5~cloud0                        OpenStack Compute Python libraries\nii  python-novaclient                1:2.9.0-0ubuntu1~cloud0                       client library for OpenStack Compute API\n\nBoth running:\nDescription:\tUbuntu 12.04.2 LTS\nRelease:\t12.04", 
            "date_created": "2013-02-27 17:48:41.676323+00:00", 
            "author": "https://api.launchpad.net/1.0/~jacekn"
        }, 
        {
            "content": "This bug is fairly old, is this still valid?", 
            "date_created": "2014-07-28 18:22:53.903681+00:00", 
            "author": "https://api.launchpad.net/1.0/~jogo"
        }, 
        {
            "content": "This is sort of working as designed. It might be nice to get rid of the static pre allocation of addresses, but we're not there yet.", 
            "date_created": "2014-09-17 11:56:04.086093+00:00", 
            "author": "https://api.launchpad.net/1.0/~sdague"
        }
    ], 
    "closed": "2014-09-17 11:56:10.103466+00:00"
}