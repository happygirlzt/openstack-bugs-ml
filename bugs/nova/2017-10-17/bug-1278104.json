{
    "status": "Fix Released", 
    "last_updated": "2014-04-17 09:08:07.453668+00:00", 
    "description": "Cannot create new instances because of an internal error. It seems like that the docker client returns None instead of a empty array if not a single container is started.\n\nUpdate:\nThe root cause for the issue is that the docker v1.8 rest API doesn't longer deliver the container list for v1.4 api calls. We must upgrade to >= 1.7 in order to make the docker driver working again.\n\nAdditional does docker not set the Content-Type correctly. The docker client expects that the Content-Type is application/json but it is plain/text. The parsing of the content will be skipped in this case.\nPlease see also: https://github.com/dotcloud/docker/pull/3974\n\nStacktrace:\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 821, in init_host\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     self._destroy_evacuated_instances(context)\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 532, in _destroy_evacuated_instances\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     local_instances = self._get_instances_on_driver(context, filters)\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 511, in _get_instances_on_driver\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     driver_instances = self.driver.list_instances()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/virt/docker/driver.py\", line 96, in list_instances\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     for container in self.docker.list_containers():\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup TypeError: 'NoneType' object is not iterable\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup", 
    "tags": [
        "docker"
    ], 
    "importance": "Undecided", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/1278104", 
    "owner": "https://api.launchpad.net/1.0/~daniel-kuffner", 
    "id": 1278104, 
    "index": 5800, 
    "openned": "2014-02-09 15:17:39.980937+00:00", 
    "created": "2014-02-09 15:17:39.980937+00:00", 
    "title": "Docker cannot start a new instance because of an internal error", 
    "comments": [
        {
            "content": "Cannot create new instances because of an internal error. It seems like that the docker client returns None instead of a empty array if not a single container is started. \n\n2014-02-09 15:01:44.077 ERROR nova.openstack.common.threadgroup [-] 'NoneType' object is not iterable\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup Traceback (most recent call last):\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 117, in wait\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     x.wait()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/threadgroup.py\", line 49, in wait\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     return self.thread.wait()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 168, in wait\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     return self._exit_event.wait()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     return hubs.get_hub().switch()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 187, in switch\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     return self.greenlet.switch()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 194, in main\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     result = function(*args, **kwargs)\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/openstack/common/service.py\", line 480, in run_service\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     service.start()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/service.py\", line 177, in start\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     self.manager.init_host()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 821, in init_host\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     self._destroy_evacuated_instances(context)\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 532, in _destroy_evacuated_instances\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     local_instances = self._get_instances_on_driver(context, filters)\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/compute/manager.py\", line 511, in _get_instances_on_driver\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     driver_instances = self.driver.list_instances()\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup   File \"/opt/stack/nova/nova/virt/docker/driver.py\", line 96, in list_instances\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup     for container in self.docker.list_containers():\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup TypeError: 'NoneType' object is not iterable\n2014-02-09 15:01:44.077 TRACE nova.openstack.common.threadgroup", 
            "date_created": "2014-02-09 15:17:39.980937+00:00", 
            "author": "https://api.launchpad.net/1.0/~daniel-kuffner"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/72147", 
            "date_created": "2014-02-09 15:26:42.191219+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/72147\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=423f344c59da1eecd7ab8bbb905abc1ff5948b14\nSubmitter: Jenkins\nBranch:    master\n\ncommit 423f344c59da1eecd7ab8bbb905abc1ff5948b14\nAuthor: Daniel Kuffner <email address hidden>\nDate:   Sun Feb 9 16:22:12 2014 +0100\n\n    Docker cannot start a new instance because of an internal error\n    \n    The root cause for the issue is that the Docker rest API does not\n    longer deliver the container list for v1.4 api calls.\n    The Docker API must be upgraded to 1.7.\n    \n    Docker API 1.7 is a good choice since that is the first docker version\n    which officially supports rhel/centos.\n    \n    In addition will docker client only parse json if the response needed\n    (to_json()) and this method will not catch json parse exception which makes\n    finding th eroot cause of a problem in the future easier.\n    \n    Change-Id: I53dfac5f09ee021c6ed4763f7f164206e8ab32ff\n    Closes-Bug: #1278104\n", 
            "date_created": "2014-02-11 03:03:43.256138+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2014-03-05 13:12:37.949466+00:00"
}