{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 10:54:32.107657+00:00", 
    "description": "I get a 500 error when calling get_console_output.\n\nI think the problem is permissions on the console output (again).\n\nThis patch is fairly recent, but I don't see why it would have broken anything.  Maybe the old XML selector code was broken, and so the patch fixed that but then exposed the failure to chmod:\nhttps://github.com/openstack/nova/commit/625c5e45db62c59691b16fadde464a192af3ac3f\n\nI think if we find one of the XML elements (which we are), we're skipping the chmod.\n\nHere's the permissions on the file:\n\nstack@openstack1:/opt/stack/nova$ ls -l /opt/stack/nova/instances/instance-00000005/console.log\n-rw-rw---- 1 libvirt-qemu kvm 0 2012-03-14 02:10 /opt/stack/nova/instances/instance-00000005/console.log\n\n---\n\n2012-03-14 11:35:29 DEBUG nova.rpc.amqp [req-3079f4b9-bf0f-4691-8e33-752ffbd5ae81 5e85278d16324d08957e9637fed9cb31 12827e8912574bebb583859c945e28b9] unpacked context: {'request_id': u'req-3079f4b9-bf0f-4691-8e33-752ffbd5ae81', 'user_id': u'5e85278d16324d08957e9637fed9cb31', 'roles': [u'Member', u'anotherrole'], 'timestamp': '2012-03-14T18:35:27.347856', 'is_admin': False, 'auth_token': u'41ec90b5cfce4345bee7e64c2ec1fc28', 'project_id': u'12827e8912574bebb583859c945e28b9', 'remote_address': u'192.168.2.99', 'read_deleted': u'no'} from (pid=22121) unpack_context /opt/stack/nova/nova/rpc/amqp.py:188\n2012-03-14 11:35:29 AUDIT nova.compute.manager [req-3079f4b9-bf0f-4691-8e33-752ffbd5ae81 5e85278d16324d08957e9637fed9cb31 12827e8912574bebb583859c945e28b9] Get console output for instance 45efea23-eda6-4cb3-b6ea-d3ddff37a6f5\n2012-03-14 11:35:30 ERROR nova.rpc.amqp [-] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 1622, in get_console_output\n(nova.rpc.amqp): TRACE:     output = self.driver.get_console_output(instance_ref)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 932, in get_console_output\n(nova.rpc.amqp): TRACE:     return libvirt_utils.load_file(path)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 223, in load_file\n(nova.rpc.amqp): TRACE:     with open(path, 'r+') as fp:\n(nova.rpc.amqp): TRACE: IOError: [Errno 13] Permission denied: '/opt/stack/nova/instances/instance-00000005/console.log'\n(nova.rpc.amqp): TRACE:\n2012-03-14 11:35:30 ERROR nova.rpc.amqp [-] Returning exception [Errno 13] Permission denied: '/opt/stack/nova/instances/instance-00000005/console.log' to caller\n2012-03-14 11:35:30 ERROR nova.rpc.amqp [-] ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\\n    return f(*args, **kw)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 177, in decorated_function\\n    sys.exc_info())\\n', '  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\\n    self.gen.next()\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 171, in decorated_function\\n    return function(self, context, instance_uuid, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 1622, in get_console_output\\n    output = self.driver.get_console_output(instance_ref)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\\n    return f(*args, **kw)\\n', '  File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 932, in get_console_output\\n    return libvirt_utils.load_file(path)\\n', '  File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 223, in load_file\\n    with open(path, \\'r+\\') as fp:\\n', \"IOError: [Errno 13] Permission denied: '/opt/stack/nova/instances/instance-00000005/console.log'\\n\"]", 
    "tags": [], 
    "importance": "High", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/955351", 
    "owner": "https://api.launchpad.net/1.0/~gandelman-a", 
    "id": 955351, 
    "index": 629, 
    "openned": "2012-03-14 18:44:16.169959+00:00", 
    "created": "2012-03-14 18:44:16.169959+00:00", 
    "title": "Permission denied when getting console output", 
    "comments": [
        {
            "content": "I get a 500 error when calling get_console_output.\n\nI think the problem is permissions on the console output (again).\n\nThis patch is fairly recent, but I don't see why it would have broken anything.  Maybe the old XML selector code was broken, and so the patch fixed that but then exposed the failure to chmod:\nhttps://github.com/openstack/nova/commit/625c5e45db62c59691b16fadde464a192af3ac3f\n\nI think if we find one of the XML elements (which we are), we're skipping the chmod.\n\nHere's the permissions on the file:\n\nstack@openstack1:/opt/stack/nova$ ls -l /opt/stack/nova/instances/instance-00000005/console.log\n-rw-rw---- 1 libvirt-qemu kvm 0 2012-03-14 02:10 /opt/stack/nova/instances/instance-00000005/console.log\n\n---\n\n2012-03-14 11:35:29 DEBUG nova.rpc.amqp [req-3079f4b9-bf0f-4691-8e33-752ffbd5ae81 5e85278d16324d08957e9637fed9cb31 12827e8912574bebb583859c945e28b9] unpacked context: {'request_id': u'req-3079f4b9-bf0f-4691-8e33-752ffbd5ae81', 'user_id': u'5e85278d16324d08957e9637fed9cb31', 'roles': [u'Member', u'anotherrole'], 'timestamp': '2012-03-14T18:35:27.347856', 'is_admin': False, 'auth_token': u'41ec90b5cfce4345bee7e64c2ec1fc28', 'project_id': u'12827e8912574bebb583859c945e28b9', 'remote_address': u'192.168.2.99', 'read_deleted': u'no'} from (pid=22121) unpack_context /opt/stack/nova/nova/rpc/amqp.py:188\n2012-03-14 11:35:29 AUDIT nova.compute.manager [req-3079f4b9-bf0f-4691-8e33-752ffbd5ae81 5e85278d16324d08957e9637fed9cb31 12827e8912574bebb583859c945e28b9] Get console output for instance 45efea23-eda6-4cb3-b6ea-d3ddff37a6f5\n2012-03-14 11:35:30 ERROR nova.rpc.amqp [-] Exception during message handling\n(nova.rpc.amqp): TRACE: Traceback (most recent call last):\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\n(nova.rpc.amqp): TRACE:     rval = node_func(context=ctxt, **node_args)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 177, in decorated_function\n(nova.rpc.amqp): TRACE:     sys.exc_info())\n(nova.rpc.amqp): TRACE:   File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\n(nova.rpc.amqp): TRACE:     self.gen.next()\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 171, in decorated_function\n(nova.rpc.amqp): TRACE:     return function(self, context, instance_uuid, *args, **kwargs)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/compute/manager.py\", line 1622, in get_console_output\n(nova.rpc.amqp): TRACE:     output = self.driver.get_console_output(instance_ref)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\n(nova.rpc.amqp): TRACE:     return f(*args, **kw)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 932, in get_console_output\n(nova.rpc.amqp): TRACE:     return libvirt_utils.load_file(path)\n(nova.rpc.amqp): TRACE:   File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 223, in load_file\n(nova.rpc.amqp): TRACE:     with open(path, 'r+') as fp:\n(nova.rpc.amqp): TRACE: IOError: [Errno 13] Permission denied: '/opt/stack/nova/instances/instance-00000005/console.log'\n(nova.rpc.amqp): TRACE:\n2012-03-14 11:35:30 ERROR nova.rpc.amqp [-] Returning exception [Errno 13] Permission denied: '/opt/stack/nova/instances/instance-00000005/console.log' to caller\n2012-03-14 11:35:30 ERROR nova.rpc.amqp [-] ['Traceback (most recent call last):\\n', '  File \"/opt/stack/nova/nova/rpc/amqp.py\", line 252, in _process_data\\n    rval = node_func(context=ctxt, **node_args)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\\n    return f(*args, **kw)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 177, in decorated_function\\n    sys.exc_info())\\n', '  File \"/usr/lib/python2.7/contextlib.py\", line 24, in __exit__\\n    self.gen.next()\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 171, in decorated_function\\n    return function(self, context, instance_uuid, *args, **kwargs)\\n', '  File \"/opt/stack/nova/nova/compute/manager.py\", line 1622, in get_console_output\\n    output = self.driver.get_console_output(instance_ref)\\n', '  File \"/opt/stack/nova/nova/exception.py\", line 114, in wrapped\\n    return f(*args, **kw)\\n', '  File \"/opt/stack/nova/nova/virt/libvirt/connection.py\", line 932, in get_console_output\\n    return libvirt_utils.load_file(path)\\n', '  File \"/opt/stack/nova/nova/virt/libvirt/utils.py\", line 223, in load_file\\n    with open(path, \\'r+\\') as fp:\\n', \"IOError: [Errno 13] Permission denied: '/opt/stack/nova/instances/instance-00000005/console.log'\\n\"]", 
            "date_created": "2012-03-14 18:44:16.169959+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/5371\nCommitted: http://github.com/openstack/nova/commit/9a40d6e714246b40b5b41f65197941fe29eb8ff1\nSubmitter: Jenkins\nBranch:    master\n\ncommit 9a40d6e714246b40b5b41f65197941fe29eb8ff1\nAuthor: Adam Gandelman <email address hidden>\nDate:   Wed Mar 14 14:49:23 2012 -0700\n\n    libvirt/connection.py: Set console.log permissions\n    \n    A required call to libvirt_utils.chown() was lost in\n    this weeks changes to get_console_output() for file\n    based console logs.\n    \n    Fixes bug 955351\n    \n    Change-Id: Ib8da92c1ff025f10a939c33b87495ffdef0d4da3\n", 
            "date_created": "2012-03-15 01:36:43.818584+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2012-03-20 08:42:24.320469+00:00"
}