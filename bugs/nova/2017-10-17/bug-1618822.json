{
    "status": "Fix Released", 
    "last_updated": "2017-09-16 17:05:10.045256+00:00", 
    "description": "when compute node is down, nova api can accept delete action and delete the instance\nthen during compute start up, periodic task will check whether the instance is deleted in api layer\n then performance actions\n\nsaw those logs because actually the info case is already deleted so it's a valid case and should not report this exception ,just a log info should be fine\n\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] Traceback (most recent call last):\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/network/base_api.py\", line 50, in update_instance_cache_with_nw_info\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     ic.save(update_cells=update_cells)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 197, in wrapper\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     ctxt, self, fn.__name__, args, kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/conductor/rpcapi.py\", line 242, in object_action\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     objmethod=objmethod, args=args, kwargs=kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     retry=self.retry)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py\", line 90, in _send\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     timeout=timeout, retry=retry)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\nages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     retry=retry)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 422, in _send\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     raise result\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] InstanceInfoCacheNotFound_Remote: Info cache for instance d6a78566-0f7d-4173-b35a-b45d2054ba71 could not be found.\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] Traceback (most recent call last):\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 447, in _object_dispatch\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     return getattr(target, method)(*args, **kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 213, in wrapper\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     return fn(self, *args, **kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/objects/instance_info_cache.py\", line 98, in save\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     {'network_info': nw_info_json})\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 857, in instance_info_cache_update\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     return IMPL.instance_info_cache_update(context, instance_uuid, values)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 216, in wrapper\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     return f(*args, **kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2684, in instance_info_cache_update\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     instance_uuid=instance_uuid)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] InstanceInfoCacheNotFound: Info cache for instance d6a78566-0f7d-4173-b35a-b45d2054ba71 could not be found.\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n\n\n\n\n2016-08-31 10:13:57.101 25191 WARNING nova.compute.manager [req-7801f16c-8845-4825-a18e-9806d142882c - - - - -] [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] Periodic cleanup failed to delete instance: Info cache for instance d6a78566-0f7d-4173-b35a-b45d2054ba71 could not be found.\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 447, in _object_dispatch\n    return getattr(target, method)(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 213, in wrapper\n    return fn(self, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/nova/objects/instance_info_cache.py\", line 98, in save\n    {'network_info': nw_info_json})\n\n  File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 857, in instance_info_cache_update\n    return IMPL.instance_info_cache_update(context, instance_uuid, values)\n\n  File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 216, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2684, in instance_info_cache_update\n    instance_uuid=instance_uuid)\n\nInstanceInfoCacheNotFound: Info cache for instance d6a78566-0f7d-4173-b35a-b45d2054ba71 could not be found.", 
    "tags": [], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/1618822", 
    "owner": "https://api.launchpad.net/1.0/~jichenjc", 
    "id": 1618822, 
    "index": 4611, 
    "openned": "2016-08-31 10:37:28.173718+00:00", 
    "created": "2016-08-31 10:37:28.173718+00:00", 
    "title": "downgrade the exception log in update_instance_cache_with_nw_info", 
    "comments": [
        {
            "content": "when compute node is down, nova api can accept delete action and delete the instance\nthen during compute start up, periodic task will check whether the instance is deleted in api layer\n then performance actions\n\nsaw those logs because actually the info case is already deleted so it's a valid case and should not report this exception ,just a log info should be fine\n\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] Traceback (most recent call last):\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/network/base_api.py\", line 50, in update_instance_cache_with_nw_info\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     ic.save(update_cells=update_cells)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 197, in wrapper\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     ctxt, self, fn.__name__, args, kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/conductor/rpcapi.py\", line 242, in object_action\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     objmethod=objmethod, args=args, kwargs=kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py\", line 158, in call\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     retry=self.retry)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py\", line 90, in _send\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     timeout=timeout, retry=retry)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\nages/oslo_messaging/_drivers/amqpdriver.py\", line 431, in send\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     retry=retry)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py\", line 422, in _send\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     raise result\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] InstanceInfoCacheNotFound_Remote: Info cache for instance d6a78566-0f7d-4173-b35a-b45d2054ba71 could not be found.\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] Traceback (most recent call last):\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 447, in _object_dispatch\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     return getattr(target, method)(*args, **kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 213, in wrapper\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     return fn(self, *args, **kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/objects/instance_info_cache.py\", line 98, in save\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     {'network_info': nw_info_json})\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 857, in instance_info_cache_update\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     return IMPL.instance_info_cache_update(context, instance_uuid, values)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 216, in wrapper\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     return f(*args, **kwargs)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]   File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2684, in instance_info_cache_update\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]     instance_uuid=instance_uuid)\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] InstanceInfoCacheNotFound: Info cache for instance d6a78566-0f7d-4173-b35a-b45d2054ba71 could not be found.\n2016-08-31 10:13:56.878 25191 ERROR nova.network.base_api [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71]\n\n\n\n\n2016-08-31 10:13:57.101 25191 WARNING nova.compute.manager [req-7801f16c-8845-4825-a18e-9806d142882c - - - - -] [instance: d6a78566-0f7d-4173-b35a-b45d2054ba71] Periodic cleanup failed to delete instance: Info cache for instance d6a78566-0f7d-4173-b35a-b45d2054ba71 could not be found.\nTraceback (most recent call last):\n\n  File \"/usr/lib/python2.7/site-packages/nova/conductor/manager.py\", line 447, in _object_dispatch\n    return getattr(target, method)(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py\", line 213, in wrapper\n    return fn(self, *args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/nova/objects/instance_info_cache.py\", line 98, in save\n    {'network_info': nw_info_json})\n\n  File \"/usr/lib/python2.7/site-packages/nova/db/api.py\", line 857, in instance_info_cache_update\n    return IMPL.instance_info_cache_update(context, instance_uuid, values)\n\n  File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 216, in wrapper\n    return f(*args, **kwargs)\n\n  File \"/usr/lib/python2.7/site-packages/nova/db/sqlalchemy/api.py\", line 2684, in instance_info_cache_update\n    instance_uuid=instance_uuid)\n\nInstanceInfoCacheNotFound: Info cache for instance d6a78566-0f7d-4173-b35a-b45d2054ba71 could not be found.", 
            "date_created": "2016-08-31 10:37:28.173718+00:00", 
            "author": "https://api.launchpad.net/1.0/~jichenjc"
        }, 
        {
            "content": "Fix proposed to branch: master\nReview: https://review.openstack.org/363585", 
            "date_created": "2016-08-31 11:12:39.081549+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Change abandoned by jichenjc (<email address hidden>) on branch: master\nReview: https://review.openstack.org/363585\nReason: we have another patch for this bug", 
            "date_created": "2016-12-02 19:21:51.941714+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/363585\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=ef85c99f5e5ba091b6711d76c88d50aa2dae6989\nSubmitter: Jenkins\nBranch:    master\n\ncommit ef85c99f5e5ba091b6711d76c88d50aa2dae6989\nAuthor: jichenjc <email address hidden>\nDate:   Sun Jul 31 21:42:01 2016 +0800\n\n    no instance info cache update if instance deleted\n    \n    Avoid instance info cache update if the instance is deleted,\n    as the deleted instance's info cache is already deleted in\n    db layer and it will report InstanceInfoCacheNotFound\n    exception and lead to a few exception logs in compute.\n    \n    Please note this is different to regular info cache and\n    lead to InstanceInfoCacheNotFound exception, it's in the\n    case when you first create the info cache after instance\n    delete and InstanceInfo is also deleted.\n    \n    Change-Id: I860e9e7c7ef458722135a21c6c5745f5519c56c4\n    Closes-Bug: 1618822\n", 
            "date_created": "2017-08-09 12:43:40.914922+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Fix proposed to branch: stable/ocata\nReview: https://review.openstack.org/492140", 
            "date_created": "2017-08-09 13:49:12.133260+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "This issue was fixed in the openstack/nova 16.0.0.0rc1 release candidate.", 
            "date_created": "2017-08-11 12:26:51.002750+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/492140\nCommitted: https://git.openstack.org/cgit/openstack/nova/commit/?id=db9cd37a591e4ebce1926556bc4ed8ef908439e4\nSubmitter: Jenkins\nBranch:    stable/ocata\n\ncommit db9cd37a591e4ebce1926556bc4ed8ef908439e4\nAuthor: jichenjc <email address hidden>\nDate:   Sun Jul 31 21:42:01 2016 +0800\n\n    no instance info cache update if instance deleted\n    \n    Avoid instance info cache update if the instance is deleted,\n    as the deleted instance's info cache is already deleted in\n    db layer and it will report InstanceInfoCacheNotFound\n    exception and lead to a few exception logs in compute.\n    \n    Please note this is different to regular info cache and\n    lead to InstanceInfoCacheNotFound exception, it's in the\n    case when you first create the info cache after instance\n    delete and InstanceInfo is also deleted.\n    \n    Change-Id: I860e9e7c7ef458722135a21c6c5745f5519c56c4\n    Closes-Bug: 1618822\n    (cherry picked from commit ef85c99f5e5ba091b6711d76c88d50aa2dae6989)\n", 
            "date_created": "2017-09-16 17:05:09.474774+00:00", 
            "author": "https://api.launchpad.net/1.0/~hudson-openstack"
        }
    ], 
    "closed": "2017-08-09 12:43:39.352176+00:00"
}