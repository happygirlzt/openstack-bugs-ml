{
    "status": "Fix Released", 
    "last_updated": "2010-10-25 20:01:21.503777+00:00", 
    "description": "When using InstallFest instructions on wiki, when I try to start an instance using euca-run-instance, i get:\n\n\nDEBUG:root:using _calc_signature_2\nDEBUG:root:query string: AWSAccessKeyId=1c711eda-1361-4f15-9e72-7c3c97cfadce%3Aantproj&Action=RunInstances&ImageId=ami-poil8qr8&InstanceType=m1.small&KernelId=ami-ekw1rvvn&MaxCount=1&MinCount=1&RamdiskId=ami-rwa7csro&SignatureMethod=HmacSHA20\nDEBUG:root:string_to_sign: POST\n127.0.0.1:8773\n/services/Cloud/\nAWSAccessKeyId=1c711eda-1361-4f15-9e72-7c3c97cfadce%3Aantproj&Action=RunInstances&ImageId=ami-poil8qr8&InstanceType=m1.small&KernelId=ami-ekw1rvvn&MaxCount=1&MinCount=1&RamdiskId=ami-rwa7csro&SignatureMethod=HmacSHA256&SignatureVersion=2&Tim0\nDEBUG:root:len(b64)=44\nDEBUG:root:base64 encoded digest: mOgB60QdxV1CQ9iKFwfXj3Gb7GceTN5aP6pREP2XM7g=\nDEBUG:root:user.secret: 669169e9-8975-4795-af7c-11bafcb95529\nDEBUG:root:expected_signature: mOgB60QdxV1CQ9iKFwfXj3Gb7GceTN5aP6pREP2XM7g=\nDEBUG:root:signature: mOgB60QdxV1CQ9iKFwfXj3Gb7GceTN5aP6pREP2XM7g=\nDEBUG:api:action: RunInstances\nDEBUG:api:arg: MaxCount         val: ['1']\nDEBUG:api:arg: MinCount         val: ['1']\nDEBUG:api:arg: ImageId          val: ['ami-poil8qr8']\nDEBUG:api:arg: KernelId         val: ['ami-ekw1rvvn']\nDEBUG:api:arg: RamdiskId                val: ['ami-rwa7csro']\nDEBUG:api:arg: InstanceType             val: ['m1.small']\nDEBUG:boto:Canonical: GET\n\n\nFri, 23 Jul 2010 15:19:17 GMT\n/_images/\nDEBUG:boto:Method: GET\nDEBUG:boto:Path: /_images/\nDEBUG:boto:Data:\nDEBUG:boto:Headers: {'Date': 'Fri, 23 Jul 2010 15:19:17 GMT', 'Content-Length': '0', 'Authorization': 'AWS 1c711eda-1361-4f15-9e72-7c3c97cfadce:antproj:NYkkNXRu6qB+ZfeNSukfGD3HV5k=', 'User-Agent': 'Boto/1.9b (linux2)'}\nDEBUG:boto:Host: 127.0.0.1:3333\nDEBUG:boto:establishing HTTP connection\nWARNING:root:400 POST /services/Cloud/ (127.0.0.1) 13.06ms\nUnhandled error in Deferred:\nTraceback (most recent call last):\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/api.py\", line 314, in post\n    self.execute(controller_name)\n  File \"/usr/lib/pymodules/python2.6/tornado/web.py\", line 774, in wrapper\n    return method(self, *args, **kwargs)\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/api.py\", line 292, in execute\n    d = request.send(context, **args)\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/api.py\", line 117, in send\n    d = defer.maybeDeferred(method, context, **args)\n--- <exception caught here> ---\n  File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 117, in maybeDeferred\n    result = f(*args, **kw)\n  File \"/usr/lib/pymodules/python2.6/nova/auth/rbac.py\", line 29, in wrapped_f\n    return f(self, context, *args, **kwargs)\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/cloud.py\", line 483, in run_instances\n    image = self._get_image(context, kwargs['image_id'])\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/cloud.py\", line 300, in _get_image\n    result = images.list(context, [image_id])\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/images.py\", line 70, in list\n    result = json.loads(response.read())\n  File \"/usr/lib/python2.6/json/__init__.py\", line 307, in loads\n    return _default_decoder.decode(s)\n  File \"/usr/lib/python2.6/json/decoder.py\", line 319, in decode\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n  File \"/usr/lib/python2.6/json/decoder.py\", line 338, in raw_decode\n    raise ValueError(\"No JSON object could be decoded\")\nexceptions.ValueError: No JSON object could be decoded", 
    "tags": [], 
    "importance": "Undecided", 
    "heat": 8, 
    "link": "https://bugs.launchpad.net/nova/+bug/609203", 
    "owner": "None", 
    "id": 609203, 
    "index": 3168, 
    "openned": "2010-07-23 15:26:27.040878+00:00", 
    "created": "2010-07-23 15:26:27.040878+00:00", 
    "title": "Error trying to start instance", 
    "comments": [
        {
            "content": "When using InstallFest instructions on wiki, when I try to start an instance using euca-run-instance, i get:\n\n\nDEBUG:root:using _calc_signature_2\nDEBUG:root:query string: AWSAccessKeyId=1c711eda-1361-4f15-9e72-7c3c97cfadce%3Aantproj&Action=RunInstances&ImageId=ami-poil8qr8&InstanceType=m1.small&KernelId=ami-ekw1rvvn&MaxCount=1&MinCount=1&RamdiskId=ami-rwa7csro&SignatureMethod=HmacSHA20\nDEBUG:root:string_to_sign: POST\n127.0.0.1:8773\n/services/Cloud/\nAWSAccessKeyId=1c711eda-1361-4f15-9e72-7c3c97cfadce%3Aantproj&Action=RunInstances&ImageId=ami-poil8qr8&InstanceType=m1.small&KernelId=ami-ekw1rvvn&MaxCount=1&MinCount=1&RamdiskId=ami-rwa7csro&SignatureMethod=HmacSHA256&SignatureVersion=2&Tim0\nDEBUG:root:len(b64)=44\nDEBUG:root:base64 encoded digest: mOgB60QdxV1CQ9iKFwfXj3Gb7GceTN5aP6pREP2XM7g=\nDEBUG:root:user.secret: 669169e9-8975-4795-af7c-11bafcb95529\nDEBUG:root:expected_signature: mOgB60QdxV1CQ9iKFwfXj3Gb7GceTN5aP6pREP2XM7g=\nDEBUG:root:signature: mOgB60QdxV1CQ9iKFwfXj3Gb7GceTN5aP6pREP2XM7g=\nDEBUG:api:action: RunInstances\nDEBUG:api:arg: MaxCount         val: ['1']\nDEBUG:api:arg: MinCount         val: ['1']\nDEBUG:api:arg: ImageId          val: ['ami-poil8qr8']\nDEBUG:api:arg: KernelId         val: ['ami-ekw1rvvn']\nDEBUG:api:arg: RamdiskId                val: ['ami-rwa7csro']\nDEBUG:api:arg: InstanceType             val: ['m1.small']\nDEBUG:boto:Canonical: GET\n\n\nFri, 23 Jul 2010 15:19:17 GMT\n/_images/\nDEBUG:boto:Method: GET\nDEBUG:boto:Path: /_images/\nDEBUG:boto:Data:\nDEBUG:boto:Headers: {'Date': 'Fri, 23 Jul 2010 15:19:17 GMT', 'Content-Length': '0', 'Authorization': 'AWS 1c711eda-1361-4f15-9e72-7c3c97cfadce:antproj:NYkkNXRu6qB+ZfeNSukfGD3HV5k=', 'User-Agent': 'Boto/1.9b (linux2)'}\nDEBUG:boto:Host: 127.0.0.1:3333\nDEBUG:boto:establishing HTTP connection\nWARNING:root:400 POST /services/Cloud/ (127.0.0.1) 13.06ms\nUnhandled error in Deferred:\nTraceback (most recent call last):\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/api.py\", line 314, in post\n    self.execute(controller_name)\n  File \"/usr/lib/pymodules/python2.6/tornado/web.py\", line 774, in wrapper\n    return method(self, *args, **kwargs)\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/api.py\", line 292, in execute\n    d = request.send(context, **args)\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/api.py\", line 117, in send\n    d = defer.maybeDeferred(method, context, **args)\n--- <exception caught here> ---\n  File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 117, in maybeDeferred\n    result = f(*args, **kw)\n  File \"/usr/lib/pymodules/python2.6/nova/auth/rbac.py\", line 29, in wrapped_f\n    return f(self, context, *args, **kwargs)\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/cloud.py\", line 483, in run_instances\n    image = self._get_image(context, kwargs['image_id'])\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/cloud.py\", line 300, in _get_image\n    result = images.list(context, [image_id])\n  File \"/usr/lib/pymodules/python2.6/nova/endpoint/images.py\", line 70, in list\n    result = json.loads(response.read())\n  File \"/usr/lib/python2.6/json/__init__.py\", line 307, in loads\n    return _default_decoder.decode(s)\n  File \"/usr/lib/python2.6/json/decoder.py\", line 319, in decode\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\n  File \"/usr/lib/python2.6/json/decoder.py\", line 338, in raw_decode\n    raise ValueError(\"No JSON object could be decoded\")\nexceptions.ValueError: No JSON object could be decoded", 
            "date_created": "2010-07-23 15:26:27.040878+00:00", 
            "author": "https://api.launchpad.net/1.0/~nik-martin-servercorps"
        }, 
        {
            "content": "If you're running trunk, this could be bug 607572.  Until that is fixed, the compute node can't retrieve an image from the objectstore.  The workaround which \"worked for me\" was to use direct filesystem access to retrieve the image (this assumes that everything's running on one machine):\n\n\ne.g. NOVA_COMPUTE_ARGS=\"--ca_path=${CA_DIR} --keys_path=${KEYS_PATH} --fake_users=1 ${NETWORK_ARGS} --images_path=${IMAGES_PATH} --use_s3=false --instances_path=${INSTANCES_PATH} --networks_path=${NETWORKS_PATH} --libvirt_xml_template=nova/compute/libvirt.xml.template --vpn_client_template=nova/cloudpipe/client.ovpn.template --credentials_template=/nova/auth/novarc.template\"\n\nThe important things there are --use_s3 and --instances_path\n\nI could write up some notes on how to bundle and launch an instance, but I've only ever got this working without a kernel and ramdisk.  i.e. this depends on ~justin-fathomdb/nova/raw-disk-images, and probably other patches also.  It might be that the bugs that prevented me from using kernel/ramdisk have now been fixed, but I haven't retried to try to figure it out!\n", 
            "date_created": "2010-07-23 18:17:05.270634+00:00", 
            "author": "https://api.launchpad.net/1.0/~justin-fathomdb"
        }, 
        {
            "content": "which Authorization header(AWSAccessKeyId) is validity?\n\n--------------------------------------------------------\n/nova/endpoint/images.py\ndef conn(context):\n    return boto.s3.connection.S3Connection (\n        aws_access_key_id=str('%s:%s' % (context.user.access, context.project.name)),\n        aws_secret_access_key=str(context.user.secret),\n\n--------------------------------------------------------\n/nova/virt/images.py\ndef _fetch_s3_image(image, path, user):\n    url = _image_url('%s/image' % image)\n\n    # This should probably move somewhere else, like e.g. a download_as\n    # method on User objects and at the same time get rewritten to use\n    # twisted web client.\n    headers = {}\n    headers['Date'] = time.strftime(\"%a, %d %b %Y %H:%M:%S GMT\", time.gmtime())\n\n    uri = '/' + url.partition('/')[2]\n    auth = signer.Signer(user.secret.encode()).s3_authorization(headers, 'GET', uri)\n    headers['Authorization'] = 'AWS %s:%s' % (user.access, auth)\n--------------------------------------------------------\n\n\nWhen I rewrite part of /images.py, I passed euca-run-instance.\nIt needs project.name\nheaders['Authorization'] = 'AWS %s:%s' % (user.access, auth)\n\u2192headers['Authorization'] = 'AWS %s:%s:%s' % (user.access, project.name, auth)\n", 
            "date_created": "2010-07-29 15:14:46.674821+00:00", 
            "author": "https://api.launchpad.net/1.0/~matsubarah"
        }, 
        {
            "content": "I believe this is fixed now (since a couple of days ago). Feel free to reopen or submit a new bug if you still are having problems.", 
            "date_created": "2010-07-29 19:08:39.567001+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "Hmmm, yes, you're probably right about the project name. Project is not defined in that function, though. Where did you get it from?", 
            "date_created": "2010-07-29 19:14:40.973748+00:00", 
            "author": "https://api.launchpad.net/1.0/~soren"
        }, 
        {
            "content": "I add next line to  libvirt_conn.py (_create_image method) .\r\n\r\nproject = manager.AuthManager().get_project(data['project_id'])\r\n\r\n\r\nAnd project  adds parameter to both _fetch_s3_image and _fetch. ", 
            "date_created": "2010-07-31 06:33:05.211243+00:00", 
            "author": "https://api.launchpad.net/1.0/~matsubarah"
        }, 
        {
            "content": "Thanks. I noticed the same bug today. There is a patch in. Should be in\ntrunk soon\n\nOn Jul 30, 2010 11:40 PM, \"hideharu matsubara\" <email address hidden>\nwrote:\n\nI add next line to  libvirt_conn.py (_create_image method) .\n\nproject = manager.AuthManager().get_project(data['project_id'])\n\n\nAnd project  adds parameter to both _fetch_s3_image and _fetch.\n\n\n-- \nError trying to start instance\nhttps://bugs.launchpad.net/bugs/609203\nYou received this bug not...\n", 
            "date_created": "2010-07-31 06:49:20+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }
    ], 
    "closed": "2010-10-25 20:01:20.431391+00:00"
}