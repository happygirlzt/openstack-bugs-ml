{
    "status": "Invalid", 
    "last_updated": "2010-07-22 18:02:19.148316+00:00", 
    "description": "On trunk, these have been appearing consistently:\n\n===============================================================================\n[FAIL]: nova.tests.network_unittest.NetworkTestCase.test_allocate_deallocate_ip\n\nTraceback (most recent call last):\n  File \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\", line 79, in test_allocate_deallocate_ip\n    self.assertEqual(False, is_in_project(address, \"project0\"))\ntwisted.trial.unittest.FailTest: not equal:\na = False\nb = True\n\n===============================================================================\n[FAIL]: nova.tests.network_unittest.NetworkTestCase.test_range_allocation\n\nTraceback (most recent call last):\n  File \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\", line 103, in test_range_allocation\n    self.assertEqual(False, is_in_project(address, \"project0\"))\ntwisted.trial.unittest.FailTest: not equal:\na = False\nb = True\n\n-------------------------------------------------------------------------------\nRan 80 tests in 24.274s\n\nFAILED (failures=2, successes=78)\n\nAssigning to myself...I'll try and track down the fix...", 
    "tags": [
        "tests"
    ], 
    "importance": "Undecided", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/608772", 
    "owner": "https://api.launchpad.net/1.0/~jaypipes", 
    "id": 608772, 
    "index": 3167, 
    "openned": "2010-07-22 14:24:20.830111+00:00", 
    "created": "2010-07-22 14:24:20.830111+00:00", 
    "title": "Failure in NetworkTestCase for range_allocation and  ", 
    "comments": [
        {
            "content": "On trunk, these have been appearing consistently:\n\n===============================================================================\n[FAIL]: nova.tests.network_unittest.NetworkTestCase.test_allocate_deallocate_ip\n\nTraceback (most recent call last):\n  File \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\", line 79, in test_allocate_deallocate_ip\n    self.assertEqual(False, is_in_project(address, \"project0\"))\ntwisted.trial.unittest.FailTest: not equal:\na = False\nb = True\n\n===============================================================================\n[FAIL]: nova.tests.network_unittest.NetworkTestCase.test_range_allocation\n\nTraceback (most recent call last):\n  File \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\", line 103, in test_range_allocation\n    self.assertEqual(False, is_in_project(address, \"project0\"))\ntwisted.trial.unittest.FailTest: not equal:\na = False\nb = True\n\n-------------------------------------------------------------------------------\nRan 80 tests in 24.274s\n\nFAILED (failures=2, successes=78)\n\nAssigning to myself...I'll try and track down the fix...", 
            "date_created": "2010-07-22 14:24:20.830111+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Hmm, something to do with gflags is broken it seems:\n\njpipes@serialcoder:~/repos/nova/bug608772$ python run_tests.py nova.tests.network_unittest.NetworkTestCase.test_allocate_deallocate_ip\nINFO:root:Flushing redis datastore\nnova.tests.network_unittest\n  NetworkTestCase\n    test_allocate_deallocate_ip ...                                      [FAIL]\n\n===============================================================================\n[FAIL]: nova.tests.network_unittest.NetworkTestCase.test_allocate_deallocate_ip\n\nTraceback (most recent call last):\n  File \"/home/jpipes/repos/nova/bug608772/nova/tests/network_unittest.py\", line 79, in test_allocate_deallocate_ip\n    self.assertEqual(False, is_in_project(address, \"project0\"))\ntwisted.trial.unittest.FailTest: not equal:\na = False\nb = True\n\n-------------------------------------------------------------------------------\nRan 1 tests in 0.756s\n\nFAILED (failures=1)\n\n$> cat run_tests.err.log \n\n\nDEBUG:root:Allocating IP 10.0.0.3 to project0\nDEBUG:root:FAKE NET: ifconfig vlan100\nDEBUG:root:FAKE NET: ifconfig br100\nDEBUG:root:Starting dnsmasq server for network with vlan 100\nDEBUG:root:FAKE NET: sudo dnsmasq --strict-order --bind-interfaces --conf-file= --pid-file=/home/jpipes/repos/nova/bug608772/networks/nova-100.pid --listen-address=10.0.0.1 --except-interface=lo --dhcp-range=10.0.0.3,static,600s --dhcp-hostsfile=/home/jpipes/repos/nova/bug608772/networks/nova-100.conf --dhcp-script=/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge --leasefile-ro\nDEBUG:root:FAKE NET: sudo iptables --delete FORWARD -d 10.0.0.2 -p udp --dport 1194 -j ACCEPT\nDEBUG:root:FAKE NET: sudo iptables -I FORWARD -d 10.0.0.2 -p udp --dport 1194 -j ACCEPT\nDEBUG:root:FAKE NET: sudo iptables --delete PREROUTING -t nat -d 127.0.0.1 -p udp --dport 1149 -j DNAT --to 10.0.0.2:1194\nDEBUG:root:FAKE NET: sudo iptables -I PREROUTING -t nat -d 127.0.0.1 -p udp --dport 1149 -j DNAT --to 10.0.0.2:1194\nDEBUG:root:Was allocated 10.0.0.3\nDEBUG:root:Result was 1\nDEBUG:root:ISSUE_IP: warning: no vendor libraries included\n, Traceback (most recent call last):\n  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 94, in <module>\n    sys.exit(main())\n  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 71, in main\n    flagfile = os.environ.get('FLAGFILE', FLAGS.dhcpbridge_flagfile)\n  File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 810, in __getattr__\n    raise AttributeError(name)\nAttributeError: dhcpbridge_flagfile\n \nDEBUG:root:Get Network By Address: 10.0.0.3\nDEBUG:root:Found 10.0.0.3 in project0\nDEBUG:root:Result was 1\nDEBUG:root:RELEASE_IP: warning: no vendor libraries included\n, Traceback (most recent call last):\n  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 94, in <module>\n    sys.exit(main())\n  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 71, in main\n    flagfile = os.environ.get('FLAGFILE', FLAGS.dhcpbridge_flagfile)\n  File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 810, in __getattr__\n    raise AttributeError(name)\nAttributeError: dhcpbridge_flagfile\n\nI've tried renaming the flagfile variable, moving it to different locations, etc.  No luck...", 
            "date_created": "2010-07-22 15:02:03.322786+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "strange. This is working in my clean author branch on Mac. Did I fix it by\naccident? Looks like the flag is defined somewhere wrong?\n\nOn Jul 22, 2010 11:10 AM, \"Jay Pipes\" <email address hidden> wrote:\n\nHmm, something to do with gflags is broken it seems:\n\njpipes@serialcoder:~/repos/nova/bug608772$ python run_tests.py\nnova.tests.network_unittest.NetworkTestCase.test_allocate_deallocate_ip\nINFO:root:Flushing redis datastore\n\nnova.tests.network_unittest\nNetworkTestCase\n   test_allocate_deallocate_ip ...\n [FAIL]\n\n\n===============================================================================\n[FAIL]: nova.tests....\n File \"/home/jpipes/repos/nova/bug608772/nova/tests/network_unittest.py\",\nline 79, in test_allocate_deallocate_ip\n\nself.assertEqual(False, is_in_project(address, \"project0\"))\ntwisted.trial.unittest.FailTest: not...\n-------------------------------------------------------------------------------\nRan 1 tests in 0.756s\n\nFAILED (failures=1)\n\n$> cat run_tests.err.log\n\n\nDEBUG:root:Allocating IP 10.0.0.3 to project0\nDEBUG:root:FAKE NET: ifconfig vlan100\nDEBUG:root:FAKE NET: ifconfig br100\nDEBUG:root:Starting dnsmasq server for network with vlan 100\nDEBUG:root:FAKE NET: sudo dnsmasq --strict-order --bind-interfaces\n--conf-file=\n--pid-file=/home/jpipes/repos/nova/bug608772/networks/nova-100.pid\n--listen-address=10.0.0.1 --except-interface=lo\n--dhcp-range=10.0.0.3,static,600s\n--dhcp-hostsfile=/home/jpipes/repos/nova/bug608772/networks/nova-100.conf\n--dhcp-script=/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\n--leasefile-ro\nDEBUG:root:FAKE NET: sudo iptables --delete FORWARD -d 10.0.0.2 -p udp\n--dport 1194 -j ACCEPT\nDEBUG:root:FAKE NET: sudo iptables -I FORWARD -d 10.0.0.2 -p udp --dport\n1194 -j ACCEPT\nDEBUG:root:FAKE NET: sudo iptables --delete PREROUTING -t nat -d 127.0.0.1\n-p udp --dport 1149 -j DNAT --to 10.0.0.2:1194\nDEBUG:root:FAKE NET: sudo iptables -I PREROUTING -t nat -d 127.0.0.1 -p udp\n--dport 1149 -j DNAT --to 10.0.0.2:1194\nDEBUG:root:Was allocated 10.0.0.3\nDEBUG:root:Result was 1\nDEBUG:root:ISSUE_IP: warning: no vendor libraries included\n, Traceback (most recent call last):\n File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 94, in\n<module>\n   sys.exit(main())\n File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 71, in\nmain\n   flagfile = os.environ.get('FLAGFILE', FLAGS.dhcpbridge_flagfile)\n File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 810, in __getattr__\n   raise AttributeError(name)\nAttributeError: dhcpbridge_flagfile\n\nDEBUG:root:Get Network By Address: 10.0.0.3\nDEBUG:root:Found 10.0.0.3 in project0\nDEBUG:root:Result was 1\nDEBUG:root:RELEASE_IP: warning: no vendor libraries included\n, Traceback (most recent call last):\n File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 94, in\n<module>\n   sys.exit(main())\n File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 71, in\nmain\n   flagfile = os.environ.get('FLAGFILE', FLAGS.dhcpbridge_flagfile)\n File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 810, in __getattr__\n   raise AttributeError(name)\nAttributeError: dhcpbridge_flagfile\n\nI've tried renaming the flagfile variable, moving it to different\nlocations, etc.  No luck...\n\n\n-- \nFailure in NetworkTestCase for range_allocation and\nhttps://bugs.launchpad.net/bugs/608772\nYo...\n", 
            "date_created": "2010-07-22 15:18:27+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "If I call default_flagfile() with no params (use defaults), I still get some weird name resolution errors:\n\nDEBUG:root:ISSUE_IP: warning: no vendor libraries included\n, DEBUG:root:Called add for mac 02:16:3e:0e:4e:f0 with ip 10.0.0.3 and hostname test-host on interface br100\nTraceback (most recent call last):\n  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 94, in <module>\n    sys.exit(main())\n  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 88, in main\n    globals()[action+'_lease'](mac, ip, hostname, interface)\n  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 47, in add_lease\n    network.lease_ip(ip)\nAttributeError: 'module' object has no attribute 'lease_ip'", 
            "date_created": "2010-07-22 15:22:28.905351+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Default flagfile with no params won't work. It needs the flagfile specified\n\nOn Jul 22, 2010 11:31 AM, \"Jay Pipes\" <email address hidden> wrote:\n\nIf I call default_flagfile() with no params (use defaults), I still get\nsome weird name resolution errors:\n\n\nDEBUG:root:ISSUE_IP: warning: no vendor libraries included\n, DEBUG:root:Called add for mac 02:16:3e:0e:4e:f0 with ip 10.0.0.3 and\nhostname test-host on interface br100\n\nTraceback (most recent call last):\n\nFile \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 94, in\n<module>\nsys.exit(ma...\n File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 88, in\nmain\n   globals()[action+'_lease'](mac, ip, hostname, interface)\n File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 47, in\nadd_lease\n   network.lease_ip(ip)\nAttributeError: 'module' object has no attribute 'lease_ip'\n\n\n-- \nFailure in NetworkTestCase for range_allocation and\nhttps://bugs.launchpad.net/bugs/608772\nYo...\n", 
            "date_created": "2010-07-22 15:43:05+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Sure it will.\n\nfrom /nova/utils.py:\n\ndef default_flagfile(filename='nova.conf'):\n    for arg in sys.argv:\n        if arg.find('flagfile') != -1:\n            break\n    else:\n        if not os.path.isabs(filename):\n            # turn relative filename into an absolute path\n            script_dir = os.path.dirname(inspect.stack()[-1][1])\n            filename = os.path.abspath(os.path.join(script_dir, filename))\n        if os.path.exists(filename):\n            sys.argv = sys.argv[:1] + ['--flagfile=%s' % filename] + sys.argv[1:]\n\nAnyway, I think it may have to do with Python sys.path, because when I print network, it shows I have the darn module loaded, but doesn't think there is a network.lease_ip attributes (which of course there is):\n\njpipes@serialcoder:~/repos/nova/bug608772$ TESTING=1 ./bin/nova-dhcpbridge add fake 127.0.0.1 serialcoder\nwarning: no vendor libraries included\nDEBUG:root:Called add for mac fake with ip 127.0.0.1 and hostname serialcoder on interface br0\n<module 'nova.compute.network' from '/usr/lib/pymodules/python2.6/nova/compute/network.py'>\nTraceback (most recent call last):\n  File \"./bin/nova-dhcpbridge\", line 89, in <module>\n    globals()[action+'_lease'](mac, ip, hostname, interface)\n  File \"./bin/nova-dhcpbridge\", line 48, in add_lease\n    network.lease_ip(ip)\nAttributeError: 'module' object has no attribute 'lease_ip'", 
            "date_created": "2010-07-22 16:08:50.065943+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Vish, didn't you move the flag definition? And didn't I recently see a patch\nthat removed an \"unused\" import from dhcpleasor? That import was probably to\nprovide access to the flag.\n\nJoshua\n\nOn Thu, Jul 22, 2010 at 8:43 AM, vishvananda <email address hidden> wrote:\n\n> Default flagfile with no params won't work. It needs the flagfile\n> specified\n>\n> On Jul 22, 2010 11:31 AM, \"Jay Pipes\" <email address hidden> wrote:\n>\n> If I call default_flagfile() with no params (use defaults), I still get\n> some weird name resolution errors:\n>\n>\n> DEBUG:root:ISSUE_IP: warning: no vendor libraries included\n> , DEBUG:root:Called add for mac 02:16:3e:0e:4e:f0 with ip 10.0.0.3 and\n> hostname test-host on interface br100\n>\n> Traceback (most recent call last):\n>\n> File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 94, in\n> <module>\n> sys.exit(ma...\n>  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 88, in\n> main\n>   globals()[action+'_lease'](mac, ip, hostname, interface)\n>  File \"/home/jpipes/repos/nova/bug608772/bin/nova-dhcpbridge\", line 47, in\n> add_lease\n>   network.lease_ip(ip)\n> AttributeError: 'module' object has no attribute 'lease_ip'\n>\n>\n> --\n> Failure in NetworkTestCase for range_allocation and\n> https://bugs.launchpad.net/bugs/608772\n> Yo...\n>\n> --\n> Failure in NetworkTestCase for range_allocation and\n> https://bugs.launchpad.net/bugs/608772\n> You received this bug notification because you are a member of Nova\n> Bugs, which is subscribed to OpenStack Compute (nova).\n>\n> Status in OpenStack Compute (Nova): New\n>\n> Bug description:\n> On trunk, these have been appearing consistently:\n>\n>\n> ===============================================================================\n> [FAIL]:\n> nova.tests.network_unittest.NetworkTestCase.test_allocate_deallocate_ip\n>\n> Traceback (most recent call last):\n>  File \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\",\n> line 79, in test_allocate_deallocate_ip\n>    self.assertEqual(False, is_in_project(address, \"project0\"))\n> twisted.trial.unittest.FailTest: not equal:\n> a = False\n> b = True\n>\n>\n> ===============================================================================\n> [FAIL]: nova.tests.network_unittest.NetworkTestCase.test_range_allocation\n>\n> Traceback (most recent call last):\n>  File \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\",\n> line 103, in test_range_allocation\n>    self.assertEqual(False, is_in_project(address, \"project0\"))\n> twisted.trial.unittest.FailTest: not equal:\n> a = False\n> b = True\n>\n>\n> -------------------------------------------------------------------------------\n> Ran 80 tests in 24.274s\n>\n> FAILED (failures=2, successes=78)\n>\n> Assigning to myself...I'll try and track down the fix...\n>\n>\n>\n", 
            "date_created": "2010-07-22 16:10:40+00:00", 
            "author": "https://api.launchpad.net/1.0/~joshua-mckenty"
        }, 
        {
            "content": "Anyway, a completely unmodified bin/nova-dhcpbridge gives errors in a clean branch:\n\njpipes@serialcoder:~/repos/nova/bug608772$ TESTING=1 ./bin/nova-dhcpbridge add fake 127.0.0.1 serialcoder\nwarning: no vendor libraries included\nTraceback (most recent call last):\n  File \"./bin/nova-dhcpbridge\", line 94, in <module>\n    sys.exit(main())\n  File \"./bin/nova-dhcpbridge\", line 71, in main\n    flagfile = os.environ.get('FLAGFILE', FLAGS.dhcpbridge_flagfile)\n  File \"/usr/lib/python2.6/dist-packages/gflags.py\", line 810, in __getattr__\n    raise AttributeError(name)\nAttributeError: dhcpbridge_flagfile\n\nSo, something is getting messed up in this file...I can run things like bin/nova-manage network restart (which also accesses nova.compule.network) just fine:\n\njpipes@serialcoder:~/repos/nova/bug608772$ ./bin/nova-manage network restart\nwarning: no vendor libraries included\n\nNot sure where those \"no vendor libraries included\" is coming from though...perhaps that is the issue?", 
            "date_created": "2010-07-22 16:12:27.998184+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "The no vendor libraries means it is using an old version of Nova that has\nvendor.py do you have two versions in your path?\n\nOn Jul 22, 2010 12:20 PM, \"Joshua McKenty\" <email address hidden> wrote:\n\nVish, didn't you move the flag definition? And didn't I recently see a patch\nthat removed an \"unused\" import from dhcpleasor? That import was probably to\nprovide access to the flag.\n\nJoshua\n\nOn Thu, Jul 22, 2010 at 8:43 AM, vishvananda <email address hidden>\nwrote:\n\n\n> Default flagfile with no params won't work. It needs the flagfile\n> specified\n>\n> On Jul 22, 2010...\n> --\n\n> Failure in NetworkTestCase for range_allocation and\n> https://bugs.launchpad.net/bugs/608772\n\n> You received this bug notification because you are a member of Nova\n> Bugs, which is subscribed to...\n\n> Traceback (most recent call last):\n\n> File \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\",\n> line 79, in test_allocat...\n\n> Traceback (most recent call last):\n\n> File \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\",\n> line 103, in test_range_...\n\n-- \nFailure in NetworkTestCase for range_allocation and\nhttps://bugs.launchpad.net/bugs/608772\n\nYou received this bug notification because you are a member of Nova\nBugs, which is subscribed to Ope...\n\nTraceback (most recent call last):\n\nFile \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\", line\n79, in test_allocate_d...\n\nTraceback (most recent call last):\n\nFile \"/home/jpipes/repos/nova/working/nova/tests/network_unittest.py\", line\n103, in test_range_all...\n", 
            "date_created": "2010-07-22 16:41:39+00:00", 
            "author": "https://api.launchpad.net/1.0/~vishvananda"
        }, 
        {
            "content": "Hmm, that might be it...I'm sure it's some silly paths thing I've messed up :)", 
            "date_created": "2010-07-22 17:18:41.108589+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "Marking Invalid.  Got paths resolved using virtualenv...really need to write a blog entry on this...", 
            "date_created": "2010-07-22 18:02:18.565013+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }
    ], 
    "closed": "2010-07-22 18:01:56.215277+00:00"
}