{
    "status": "Fix Released", 
    "last_updated": "2012-09-27 15:27:10.646834+00:00", 
    "description": "Hello,\n\nDescription: \n\tI'm using PERL's Net::Amazon::EC2 module to get information about foo volume. (http://search.cpan.org/~mallen/Net-Amazon-EC2-0.18/lib/Net/Amazon/EC2.pm#describe_volumes%28%params%29). Unfortunately it doesn't works due to 3x issues in DescribeVolumes EC2 API call. \n\nRelease: \n\tOpenStack Diablo 2011.3.1\n\nOS:\n\tRedHat EL6, packages from EPEL.\n\n-------------------------------------------------------------------------------\ncase/issue (1)\n-------------------------------------------------------------------------------\n\nDescription: VolumeID as scalar value doesn't works (ref. to array of hash works)\n\nCode:\n\tmy $aws = Net::Amazon::EC2->new (...);\n\tmy $vol = \"vol-00000008\";\n\tmy $rtn=$aws->ec2->describe_volumes(VolumeId => $vol);\n\nWhy: \n\tnova/api/ec2/cloud.py line 973 -> volume_id type is Unicode instead of expected List type\n\n\terror log:\n\t\tDEBUG nova.api [...] arg: VolumeId\t\tval: vol-00000008 from (pid=487) __call__ /usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py:242\n\t\tERROR nova.api [...] Unexpected error raised: Ec2 id v is unacceptable.\n\t\t(nova.api): TRACE: Traceback (most recent call last):\n\t\t(nova.api): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py\", line 348, in __call__\n\t\t(nova.api): TRACE:     result = api_request.invoke(context)\n\t\t(nova.api): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/apirequest.py\", line 78, in invoke\n\t\t(nova.api): TRACE:     result = method(context, **args)\n\t\t(nova.api): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/cloud.py\", line 973, in describe_volumes\n\t\t(nova.api): TRACE:     internal_id = ec2utils.ec2_id_to_id(ec2_id)\n\t\t(nova.api): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/ec2utils.py\", line 29, in ec2_id_to_id\n\t\t(nova.api): TRACE:     raise exception.InvalidEc2Id(ec2_id=ec2_id)\n\t\t(nova.api): TRACE: InvalidEc2Id: Ec2 id v is unacceptable.\n\t\t(nova.api): TRACE: \n\n\tcorrect behavior:\n\t\tDEBUG nova.api [...] action: DescribeVolumes from (pid=81627) __call__ /usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py:240\n\t\tDEBUG nova.api [...] arg: VolumeId.1\tval: vol-00000008 from (pid=81627) __call__ /usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py:242\n\n-------------------------------------------------------------------------------\ncase/issue (2)\n-------------------------------------------------------------------------------\n\nDescription: Response include empty item of attachmentSet -> Net::Amazon::EC2 parse it as one attachment with invalid data\n\nCode:\n\tmy $aws = Net::Amazon::EC2->new (...);\n\tmy $vol = \"vol-00000008\";\n\tmy @avol = ($vol);\n\tmy $p_avol = \\@avol;\n\tmy $rtn=$aws->ec2->describe_volumes(VolumeId => $p_avol);\n\n\tresponse:\n\t\t<DescribeVolumesResponse xmlns=\"http://ec2.amazonaws.com/doc/2009-11-30/\">\n\t\t\t<requestId>...</requestId>\n\t\n\t\t\t<volumeSet>\n\t\t\t\t<item>\n\t\t\t\t\t<status>available (nova, host1, None, None)</status>\n\t\t\t\t\t<availabilityZone>nova</availabilityZone>\t\n\t\t\t\t\t<displayName/>\n\t\t\t\t\t<volumeId>vol-00000008</volumeId>\n\t\t\t\t\t<displayDescription/>\n\t\t\t\t\t<attachmentSet>\n\t\t\t\t\t\t<item/>\n\t\t\t\t\t</attachmentSet>\n\t\t\t\t\t<snapshotId/>\n\t\t\t\t\t<createTime>2012-03-12T10:43:33Z</createTime>\n\t\t\t\t\t<size>15</size>\n\t\t\t\t</item>\n\t\t\t</volumeSet>\n\t\t</DescribeVolumesResponse>\n\n\terror message from Net::Amazon::EC2 (volume_id and other elements are missing in item element):\n\t\tAttribute (volume_id) does not pass the type constraint because: Validation failed for 'Str' with value undef at /usr/share/perl5/vendor_perl/Net/Amazon/EC2.pm line 2353\n\n\nWorkaround:\n\tnova/api/ec2/cloud.py line ~1008 \n\n\t\tif volume['attach_status'] == 'attached':\n\t\t\tv['attachmentSet'] = [{'attachTime': volume['attach_time'],\n\t\t\t'deleteOnTermination': False,\n\t\t\t'device': volume['mountpoint'],\n\t\t\t'instanceId': instance_ec2_id,\n\t\t\t'status': 'attached',\n\t\t\t'volumeId': v['volumeId']}]\n\t\t# don't set attachmentSet\n\t\t#else: \n\t\t#    v['attachmentSet'] = [{}]\n\n-------------------------------------------------------------------------------\ncase/issue (3)\n-------------------------------------------------------------------------------\n\nDescription: attachTime is NULL when some attachment exist + workaround from case (2)\n\nCode\n\tmy $aws = Net::Amazon::EC2->new (...);\n\tmy $vol = \"vol-00000008\";\n\tmy @avol = ($vol);\n\tmy $p_avol = \\@avol;\n\tmy $rtn=$aws->ec2->describe_volumes(VolumeId => $p_avol);\n\n\tresponse:\n\t\t<DescribeVolumesResponse xmlns=\"http://ec2.amazonaws.com/doc/2009-11-30/\">\n\t\t\t<requestId>...</requestId>\n\t\t\t<volumeSet>\n\t\t\t\t<item>\n\t\t\t\t\t<status>in-use (nova, host1, i-00000001[host1], /dev/sdf)</status>\n\t\t\t\t\t<availabilityZone>nova</availabilityZone>\n\t\t\t\t\t<displayName/>\n\t\t\t\t\t<volumeId>vol-00000008</volumeId>\n\t\t\t\t\t<displayDescription/>\n\t\t\t\t\t<attachmentSet>\n\t\t\t\t\t\t<item>\n\t\t\t\t\t\t\t<status>attached</status>\n\t\t\t\t\t\t\t<attachTime/>\n\t\t\t\t\t\t\t<instanceId>i-00000037</instanceId>\n\t\t\t\t\t\t\t<volumeId>vol-00000008</volumeId>\n\t\t\t\t\t\t\t<deleteOnTermination>false</deleteOnTermination>\n\t\t\t\t\t\t\t<device>/dev/sdf</device>\n\t\t\t\t\t\t</item>\n\t\t\t\t\t</attachmentSet>\n\t\t\t\t\t<snapshotId/>\n\t\t\t\t\t<createTime>2012-03-12T10:43:31Z</createTime>\n\t\t\t\t\t<size>15</size>\n\t\t\t\t</item>\n\t\t\t</volumeSet>\n\t\t</DescribeVolumesResponse>\n\n\terror message from Net::Amazon::EC2:\n\t\tAttribute (attach_time) does not pass the type constraint because: Validation failed for 'Str' with value HASH(0x3ce5d10) at /usr/share/perl5/vendor_perl/Net/Amazon/EC2.pm line 391\n\n\n\tSQL:\n\t\t[root@host1 nova]# mysql -u.... -p..... nova -e \"select attach_time,id from volumes;\"\n\t\t+-------------+----+\n\t\t| attach_time | id |\n\t\t+-------------+----+\n\t\t| NULL        |  1 |\n\t\t| NULL        |  2 |\n\t\t| NULL        |  3 |\n\t\t| NULL        |  4 |\n\t\t| NULL        |  5 |\n\t\t| NULL        |  6 |\n\t\t| NULL        |  7 |\n\t\t| NULL        |  8 |\n\t\t| NULL        |  9 |\n\t\t| NULL        | 10 |\n\t\t| NULL        | 11 |\n\t\t| NULL        | 12 |\n\t\t| NULL        | 13 |\n\t\t| NULL        | 14 |\n\t\t| NULL        | 15 |\n\t\t+-------------+----+", 
    "tags": [
        "ec2"
    ], 
    "importance": "Medium", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/960265", 
    "owner": "None", 
    "id": 960265, 
    "index": 2814, 
    "openned": "2012-03-20 14:44:29.395084+00:00", 
    "created": "2012-03-20 14:44:29.395084+00:00", 
    "title": "DescribeVolumes EC2 API issues", 
    "comments": [
        {
            "content": "Hello,\n\nDescription: \n\tI'm using PERL's Net::Amazon::EC2 module to get information about foo volume. (http://search.cpan.org/~mallen/Net-Amazon-EC2-0.18/lib/Net/Amazon/EC2.pm#describe_volumes%28%params%29). Unfortunately it doesn't works due to 3x issues in DescribeVolumes EC2 API call. \n\nRelease: \n\tOpenStack Diablo 2011.3.1\n\nOS:\n\tRedHat EL6, packages from EPEL.\n\n-------------------------------------------------------------------------------\ncase/issue (1)\n-------------------------------------------------------------------------------\n\nDescription: VolumeID as scalar value doesn't works (ref. to array of hash works)\n\nCode:\n\tmy $aws = Net::Amazon::EC2->new (...);\n\tmy $vol = \"vol-00000008\";\n\tmy $rtn=$aws->ec2->describe_volumes(VolumeId => $vol);\n\nWhy: \n\tnova/api/ec2/cloud.py line 973 -> volume_id type is Unicode instead of expected List type\n\n\terror log:\n\t\tDEBUG nova.api [...] arg: VolumeId\t\tval: vol-00000008 from (pid=487) __call__ /usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py:242\n\t\tERROR nova.api [...] Unexpected error raised: Ec2 id v is unacceptable.\n\t\t(nova.api): TRACE: Traceback (most recent call last):\n\t\t(nova.api): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py\", line 348, in __call__\n\t\t(nova.api): TRACE:     result = api_request.invoke(context)\n\t\t(nova.api): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/apirequest.py\", line 78, in invoke\n\t\t(nova.api): TRACE:     result = method(context, **args)\n\t\t(nova.api): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/cloud.py\", line 973, in describe_volumes\n\t\t(nova.api): TRACE:     internal_id = ec2utils.ec2_id_to_id(ec2_id)\n\t\t(nova.api): TRACE:   File \"/usr/lib/python2.6/site-packages/nova/api/ec2/ec2utils.py\", line 29, in ec2_id_to_id\n\t\t(nova.api): TRACE:     raise exception.InvalidEc2Id(ec2_id=ec2_id)\n\t\t(nova.api): TRACE: InvalidEc2Id: Ec2 id v is unacceptable.\n\t\t(nova.api): TRACE: \n\n\tcorrect behavior:\n\t\tDEBUG nova.api [...] action: DescribeVolumes from (pid=81627) __call__ /usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py:240\n\t\tDEBUG nova.api [...] arg: VolumeId.1\tval: vol-00000008 from (pid=81627) __call__ /usr/lib/python2.6/site-packages/nova/api/ec2/__init__.py:242\n\n-------------------------------------------------------------------------------\ncase/issue (2)\n-------------------------------------------------------------------------------\n\nDescription: Response include empty item of attachmentSet -> Net::Amazon::EC2 parse it as one attachment with invalid data\n\nCode:\n\tmy $aws = Net::Amazon::EC2->new (...);\n\tmy $vol = \"vol-00000008\";\n\tmy @avol = ($vol);\n\tmy $p_avol = \\@avol;\n\tmy $rtn=$aws->ec2->describe_volumes(VolumeId => $p_avol);\n\n\tresponse:\n\t\t<DescribeVolumesResponse xmlns=\"http://ec2.amazonaws.com/doc/2009-11-30/\">\n\t\t\t<requestId>...</requestId>\n\t\n\t\t\t<volumeSet>\n\t\t\t\t<item>\n\t\t\t\t\t<status>available (nova, host1, None, None)</status>\n\t\t\t\t\t<availabilityZone>nova</availabilityZone>\t\n\t\t\t\t\t<displayName/>\n\t\t\t\t\t<volumeId>vol-00000008</volumeId>\n\t\t\t\t\t<displayDescription/>\n\t\t\t\t\t<attachmentSet>\n\t\t\t\t\t\t<item/>\n\t\t\t\t\t</attachmentSet>\n\t\t\t\t\t<snapshotId/>\n\t\t\t\t\t<createTime>2012-03-12T10:43:33Z</createTime>\n\t\t\t\t\t<size>15</size>\n\t\t\t\t</item>\n\t\t\t</volumeSet>\n\t\t</DescribeVolumesResponse>\n\n\terror message from Net::Amazon::EC2 (volume_id and other elements are missing in item element):\n\t\tAttribute (volume_id) does not pass the type constraint because: Validation failed for 'Str' with value undef at /usr/share/perl5/vendor_perl/Net/Amazon/EC2.pm line 2353\n\n\nWorkaround:\n\tnova/api/ec2/cloud.py line ~1008 \n\n\t\tif volume['attach_status'] == 'attached':\n\t\t\tv['attachmentSet'] = [{'attachTime': volume['attach_time'],\n\t\t\t'deleteOnTermination': False,\n\t\t\t'device': volume['mountpoint'],\n\t\t\t'instanceId': instance_ec2_id,\n\t\t\t'status': 'attached',\n\t\t\t'volumeId': v['volumeId']}]\n\t\t# don't set attachmentSet\n\t\t#else: \n\t\t#    v['attachmentSet'] = [{}]\n\n-------------------------------------------------------------------------------\ncase/issue (3)\n-------------------------------------------------------------------------------\n\nDescription: attachTime is NULL when some attachment exist + workaround from case (2)\n\nCode\n\tmy $aws = Net::Amazon::EC2->new (...);\n\tmy $vol = \"vol-00000008\";\n\tmy @avol = ($vol);\n\tmy $p_avol = \\@avol;\n\tmy $rtn=$aws->ec2->describe_volumes(VolumeId => $p_avol);\n\n\tresponse:\n\t\t<DescribeVolumesResponse xmlns=\"http://ec2.amazonaws.com/doc/2009-11-30/\">\n\t\t\t<requestId>...</requestId>\n\t\t\t<volumeSet>\n\t\t\t\t<item>\n\t\t\t\t\t<status>in-use (nova, host1, i-00000001[host1], /dev/sdf)</status>\n\t\t\t\t\t<availabilityZone>nova</availabilityZone>\n\t\t\t\t\t<displayName/>\n\t\t\t\t\t<volumeId>vol-00000008</volumeId>\n\t\t\t\t\t<displayDescription/>\n\t\t\t\t\t<attachmentSet>\n\t\t\t\t\t\t<item>\n\t\t\t\t\t\t\t<status>attached</status>\n\t\t\t\t\t\t\t<attachTime/>\n\t\t\t\t\t\t\t<instanceId>i-00000037</instanceId>\n\t\t\t\t\t\t\t<volumeId>vol-00000008</volumeId>\n\t\t\t\t\t\t\t<deleteOnTermination>false</deleteOnTermination>\n\t\t\t\t\t\t\t<device>/dev/sdf</device>\n\t\t\t\t\t\t</item>\n\t\t\t\t\t</attachmentSet>\n\t\t\t\t\t<snapshotId/>\n\t\t\t\t\t<createTime>2012-03-12T10:43:31Z</createTime>\n\t\t\t\t\t<size>15</size>\n\t\t\t\t</item>\n\t\t\t</volumeSet>\n\t\t</DescribeVolumesResponse>\n\n\terror message from Net::Amazon::EC2:\n\t\tAttribute (attach_time) does not pass the type constraint because: Validation failed for 'Str' with value HASH(0x3ce5d10) at /usr/share/perl5/vendor_perl/Net/Amazon/EC2.pm line 391\n\n\n\tSQL:\n\t\t[root@host1 nova]# mysql -u.... -p..... nova -e \"select attach_time,id from volumes;\"\n\t\t+-------------+----+\n\t\t| attach_time | id |\n\t\t+-------------+----+\n\t\t| NULL        |  1 |\n\t\t| NULL        |  2 |\n\t\t| NULL        |  3 |\n\t\t| NULL        |  4 |\n\t\t| NULL        |  5 |\n\t\t| NULL        |  6 |\n\t\t| NULL        |  7 |\n\t\t| NULL        |  8 |\n\t\t| NULL        |  9 |\n\t\t| NULL        | 10 |\n\t\t| NULL        | 11 |\n\t\t| NULL        | 12 |\n\t\t| NULL        | 13 |\n\t\t| NULL        | 14 |\n\t\t| NULL        | 15 |\n\t\t+-------------+----+", 
            "date_created": "2012-03-20 14:44:29.395084+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaroslav-pulchart-4"
        }, 
        {
            "content": "This all should fixed in quantal, please re-open if they are not.\r\n\r\nRegards\r\nchuck", 
            "date_created": "2012-07-20 19:42:27.712277+00:00", 
            "author": "https://api.launchpad.net/1.0/~zulcss"
        }
    ], 
    "closed": "2012-08-16 07:35:15.914119+00:00"
}