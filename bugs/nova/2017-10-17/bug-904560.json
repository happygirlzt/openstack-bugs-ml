{
    "status": "Fix Released", 
    "last_updated": "2012-04-05 09:48:00.246071+00:00", 
    "description": "Using nova trunk revision ed1b801 with Libvirt.\n\nI'm now getting the following exception when booting an instance:\n\n==> /var/log/nova/nova-api.log <==\n\n2011-12-15 02:27:21,591 ERROR nova.api.openstack.v2 [23d65bde-8e94-41ef-8011-a44abbe19209 1 1] Caught error: Instance 654f3c5a-5782-4764-8e10-4f57167ce883 in vm_state building. Cannot wrapped_f while the instance is in this state.\n(nova.api.openstack.v2): TRACE: Traceback (most recent call last):\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/v2/__init__.py\", line 61, in __call__\n(nova.api.openstack.v2): TRACE:     return req.get_response(self.application)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack.v2): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack.v2): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/keystone/middleware/auth_token.py\", line 316, in __call__\n(nova.api.openstack.v2): TRACE:     return self._forward_request(env, start_response, proxy_headers)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/keystone/middleware/auth_token.py\", line 499, in _forward_request\n(nova.api.openstack.v2): TRACE:     return self.app(env, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack.v2): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack.v2): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 499, in __call__\n(nova.api.openstack.v2): TRACE:     response = req.get_response(self.application)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack.v2): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack.v2): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack.v2): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack.v2): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack.v2): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack.v2): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 567, in __call__\n(nova.api.openstack.v2): TRACE:     action_result = self.dispatch(request, action, args)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 599, in dispatch\n(nova.api.openstack.v2): TRACE:     return controller_method(req=request, **action_args)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 43, in new_f\n(nova.api.openstack.v2): TRACE:     ret = f(*args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/scheduler/api.py\", line 400, in new_f\n(nova.api.openstack.v2): TRACE:     return f(*args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/v2/servers.py\", line 693, in delete\n(nova.api.openstack.v2): TRACE:     self._delete(req.environ['nova.context'], id)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/v2/servers.py\", line 465, in _delete\n(nova.api.openstack.v2): TRACE:     self.compute_api.delete(context, instance)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 75, in inner\n(nova.api.openstack.v2): TRACE:     method=f.__name__)\n(nova.api.openstack.v2): TRACE: InstanceInvalidState: Instance 654f3c5a-5782-4764-8e10-4f57167ce883 in vm_state building. Cannot wrapped_f while the instance is in this state.\n(nova.api.openstack.v2): TRACE:", 
    "tags": [
        "in-milestone-proposed"
    ], 
    "importance": "Critical", 
    "heat": 6, 
    "link": "https://bugs.launchpad.net/nova/+bug/904560", 
    "owner": "https://api.launchpad.net/1.0/~dan-prince", 
    "id": 904560, 
    "index": 43, 
    "openned": "2011-12-15 02:34:26.932993+00:00", 
    "created": "2011-12-15 02:34:26.932993+00:00", 
    "title": "check_exit_code TypeError: argument of type 'bool' is not iterable", 
    "comments": [
        {
            "content": "Using nova trunk revision ed1b801 with Libvirt.\n\nI'm now getting the following exception when booting an instance:\n\n==> /var/log/nova/nova-api.log <==\n\n2011-12-15 02:27:21,591 ERROR nova.api.openstack.v2 [23d65bde-8e94-41ef-8011-a44abbe19209 1 1] Caught error: Instance 654f3c5a-5782-4764-8e10-4f57167ce883 in vm_state building. Cannot wrapped_f while the instance is in this state.\n(nova.api.openstack.v2): TRACE: Traceback (most recent call last):\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/v2/__init__.py\", line 61, in __call__\n(nova.api.openstack.v2): TRACE:     return req.get_response(self.application)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack.v2): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack.v2): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/keystone/middleware/auth_token.py\", line 316, in __call__\n(nova.api.openstack.v2): TRACE:     return self._forward_request(env, start_response, proxy_headers)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/keystone/middleware/auth_token.py\", line 499, in _forward_request\n(nova.api.openstack.v2): TRACE:     return self.app(env, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack.v2): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack.v2): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 499, in __call__\n(nova.api.openstack.v2): TRACE:     response = req.get_response(self.application)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1053, in get_response\n(nova.api.openstack.v2): TRACE:     application, catch_exc_info=False)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/request.py\", line 1022, in call_application\n(nova.api.openstack.v2): TRACE:     app_iter = application(self.environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack.v2): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/pymodules/python2.7/routes/middleware.py\", line 131, in __call__\n(nova.api.openstack.v2): TRACE:     response = self.app(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 159, in __call__\n(nova.api.openstack.v2): TRACE:     return resp(environ, start_response)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 147, in __call__\n(nova.api.openstack.v2): TRACE:     resp = self.call_func(req, *args, **self.kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/webob/dec.py\", line 208, in call_func\n(nova.api.openstack.v2): TRACE:     return self.func(req, *args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 567, in __call__\n(nova.api.openstack.v2): TRACE:     action_result = self.dispatch(request, action, args)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/wsgi.py\", line 599, in dispatch\n(nova.api.openstack.v2): TRACE:     return controller_method(req=request, **action_args)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/exception.py\", line 43, in new_f\n(nova.api.openstack.v2): TRACE:     ret = f(*args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/scheduler/api.py\", line 400, in new_f\n(nova.api.openstack.v2): TRACE:     return f(*args, **kwargs)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/v2/servers.py\", line 693, in delete\n(nova.api.openstack.v2): TRACE:     self._delete(req.environ['nova.context'], id)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/api/openstack/v2/servers.py\", line 465, in _delete\n(nova.api.openstack.v2): TRACE:     self.compute_api.delete(context, instance)\n(nova.api.openstack.v2): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/compute/api.py\", line 75, in inner\n(nova.api.openstack.v2): TRACE:     method=f.__name__)\n(nova.api.openstack.v2): TRACE: InstanceInvalidState: Instance 654f3c5a-5782-4764-8e10-4f57167ce883 in vm_state building. Cannot wrapped_f while the instance is in this state.\n(nova.api.openstack.v2): TRACE:", 
            "date_created": "2011-12-15 02:34:26.932993+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "More information in nova-network.log:\n\n(nova): TRACE: Traceback (most recent call last):\n(nova): TRACE:   File \"/usr/bin/nova-network\", line 49, in <module>\n(nova): TRACE:     service.wait()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 393, in wait\n(nova): TRACE:     _launcher.wait()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 113, in wait\n(nova): TRACE:     service.wait()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 166, in wait\n(nova): TRACE:     return self._exit_event.wait()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/eventlet/event.py\", line 116, in wait\n(nova): TRACE:     return hubs.get_hub().switch()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/eventlet/hubs/hub.py\", line 177, in switch\n(nova): TRACE:     return self.greenlet.switch()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/eventlet/greenthread.py\", line 192, in main\n(nova): TRACE:     result = function(*args, **kwargs)\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 83, in run_server\n(nova): TRACE:     server.start()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/service.py\", line 143, in start\n(nova): TRACE:     self.manager.init_host()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/manager.py\", line 1183, in init_host\n(nova): TRACE:     self.driver.ensure_metadata_ip()\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 445, in ensure_metadata_ip\n(nova): TRACE:     run_as_root=True, check_exit_code=False)\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/network/linux_net.py\", line 783, in _execute\n(nova): TRACE:     return utils.execute(*cmd, **kwargs)\n(nova): TRACE:   File \"/usr/lib/python2.7/dist-packages/nova/utils.py\", line 211, in execute\n(nova): TRACE:     if _returncode not in check_exit_code:\n(nova): TRACE: TypeError: argument of type 'bool' is not iterable\n(nova): TRACE: \n\n\n----\n\nLooks like commit ed1b801a2cc3691cdab6ca2ae95f7299a964d00f is the cause here. (utils.execute was changed there)", 
            "date_created": "2011-12-15 02:41:36.722054+00:00", 
            "author": "https://api.launchpad.net/1.0/~dan-prince"
        }, 
        {
            "content": "This is a critical issue that needs to be backported to essex2.", 
            "date_created": "2011-12-15 04:29:42.870765+00:00", 
            "author": "https://api.launchpad.net/1.0/~devcamcar"
        }, 
        {
            "content": "This actually doesn't currently affect essex-2, but will if we backport the fix for bug 887402.", 
            "date_created": "2011-12-15 09:28:20.037979+00:00", 
            "author": "https://api.launchpad.net/1.0/~ttx"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/2351\nCommitted: http://github.com/openstack/nova/commit/de815b7f4426134c93ce5910b3401bf036df211d\nSubmitter: Jenkins\nBranch:    master\n\n status fixcommitted\n done\n\ncommit de815b7f4426134c93ce5910b3401bf036df211d\nAuthor: Dan Prince <email address hidden>\nDate:   Wed Dec 14 22:16:25 2011 -0500\n\n    Update utils.execute so that check_exit_code handles booleans.\n    Fixes LP bug #904560.\n    \n    Change-Id: I5d09b65dade166763981dc6b248034d86ba217f1\n", 
            "date_created": "2011-12-15 14:37:11+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }, 
        {
            "content": "Reviewed:  https://review.openstack.org/2365\nCommitted: http://github.com/openstack/nova/commit/44955a1937ae25514bfe4ee5ccb561642681ab1c\nSubmitter: Jenkins\nBranch:    milestone-proposed\n\n tag in-milestone-proposed\n done\n\ncommit 44955a1937ae25514bfe4ee5ccb561642681ab1c\nAuthor: Dean Troyer <email address hidden>\nDate:   Tue Dec 13 19:05:21 2011 -0600\n\n    Fixes bug 887402\n    \n    Change utils.execute to accept a list or a single integer in\n    check_exit_code.\n    \n    In libvirt.disconnect_volume() return codes 0 and 255 are both valid\n    for logout/delete, where 255 is returned if the volume is already\n    disconnected.\n    \n    Also includes a fix by Dan Prince for a regression introduced by\n    the above fix (bug 904560)\n    \n    Change-Id: Icffeb0fe8269a02d95ac6ed180ba0bb9f458a6ed\n", 
            "date_created": "2011-12-15 17:36:26+00:00", 
            "author": "https://api.launchpad.net/1.0/~openstack-gerrit"
        }
    ], 
    "closed": "2011-12-15 18:02:41.190620+00:00"
}