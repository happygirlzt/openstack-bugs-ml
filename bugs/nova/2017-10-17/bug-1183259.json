{
    "status": "Fix Released", 
    "last_updated": "2014-05-29 06:24:53.303085+00:00", 
    "description": "If I create a flavor and then delete it and create it anew, the original name comes out in nova show and elsewhere.  I suspect that the DB query is lacking a \"(deleted=0)\"\n\nTo reproduce:\n OS_TENANT_NAME=admin nova flavor-create foo 1010 1024 10 1\n OS_TENANT_NAME=admin nova flavor-delete foo\n OS_TENANT_NAME=admin nova flavor-create bar 1010 2048 10 1\n nova boot --flavor=bar --image=$WHATEVER baz\n #See how the output says that the flavor is \"foo (1010)\"\n nova show baz <-- also says foo\n\nThis is using: 1:2013.1-0ubuntu2.1~cloud0", 
    "tags": [
        "canonical-webops", 
        "ops", 
        "prodstack"
    ], 
    "importance": "Low", 
    "heat": 26, 
    "link": "https://bugs.launchpad.net/nova/+bug/1183259", 
    "owner": "None", 
    "id": 1183259, 
    "index": 872, 
    "openned": "2013-05-23 09:03:15.977733+00:00", 
    "created": "2013-05-23 09:03:15.977733+00:00", 
    "title": "deleted (then replaced) flavors keep the old name in nova show", 
    "comments": [
        {
            "content": "If I create a flavor and then delete it and create it anew, the original name comes out in nova show and elsewhere.  I suspect that the DB query is lacking a \"(deleted=0)\"\n\nTo reproduce:\n OS_TENANT_NAME=admin nova flavor-create foo 1010 1024 10 1\n OS_TENANT_NAME=admin nova flavor-delete foo\n OS_TENANT_NAME=admin nova flavor-create bar 1010 2048 10 1\n nova boot --flavor=bar --image=$WHATEVER baz\n #See how the output says that the flavor is \"foo (1010)\"\n nova show baz <-- also says foo\n\nThis is using: 1:2013.1-0ubuntu2.1~cloud0", 
            "date_created": "2013-05-23 09:03:15.977733+00:00", 
            "author": "https://api.launchpad.net/1.0/~lamont"
        }, 
        {
            "content": "I cannot reproduce this bug with the latest git tree. The flavor used is \"bar\", as expected, and not \"foo\". Can you still reproduce this bug ?", 
            "date_created": "2013-07-22 08:51:38.445487+00:00", 
            "author": "https://api.launchpad.net/1.0/~cyril-roelandt"
        }, 
        {
            "content": "I can reproduce this problem in both folsom and grizzly:\n#nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| ID | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | extra_specs |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| 1 | m1.tiny | 512 | 0 | 0 | | 1 | 1.0 | True | {} |\n| 2 | m1.small | 2048 | 10 | 20 | | 1 | 1.0 | True | {} |\n| 3 | m1.medium | 4096 | 10 | 40 | | 2 | 1.0 | True | {} |\n| 4 | m1.large | 8192 | 10 | 80 | | 4 | 1.0 | True | {} |\n| 5 | m1.xlarge | 16384 | 10 | 160 | | 8 | 1.0 | True | {} |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n#nova flavor-delete 3\n\n# nova flavor-create newmedium 3 2048 15 2\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| ID | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | extra_specs |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| 3 | newmedium | 2048 | 15 | 0 | | 2 | 1 | True | {} |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n# nova flavor-list\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| ID | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | extra_specs |\n+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+-------------+\n| 1 | m1.tiny | 512 | 0 | 0 | | 1 | 1.0 | True | {} |\n| 2 | m1.small | 2048 | 10 | 20 | | 1 | 1.0 | True | {} |\n| 3 | newmedium | 2048 | 15 | 0 | | 2 | 1.0 | True | {} |\n| 4 | m1.large | 8192 | 10 | 80 | | 4 | 1.0 | True | {} |\n| 5 | m1.xlarge | 16384 | 10 | 160 | | 8 | 1.0 | True | {} |\n\n# nova boot --image 229ac0e5-1c38-44b1-a521-d41db8baf343 --flavor newmedium ros\n+-------------------------------------+----------------------------------------------------------+\n| Property | Value |\n+-------------------------------------+----------------------------------------------------------+\n| OS-DCF:diskConfig | MANUAL |\n| OS-EXT-SRV-ATTR:host | sco-vmw-13-fb |\n| OS-EXT-SRV-ATTR:hypervisor_hostname | sco-vmw-13-fb |\n| OS-EXT-SRV-ATTR:instance_name | instance-00000003 |\n| OS-EXT-STS:power_state | 0 |\n| OS-EXT-STS:task_state | scheduling |\n| OS-EXT-STS:vm_state | building |\n| accessIPv4 | |\n| accessIPv6 | |\n| adminPass | 7VcZJVCrGCux |\n| config_drive | |\n| created | 2013-07-26T11:22:02Z |\n| flavor | m1.medium |\n| hostId | d4356d97491fde4a9fe9906e04672663ff30c208752eeda6a8fd4767 |\n| id | 7a102098-3b0f-422e-9db2-0e0cf013957b |\n| image | Fedora.ova |\n| key_name | None |\n| metadata | {} |\n| name | ros |\n| progress | 0 |\n| security_groups | [{u'name': u'default'}] |\n| status | BUILD |\n| tenant_id | 6a322c1e077e44eab4dcadf9a452b46e |\n| updated | 2013-07-26T11:22:02Z |\n| user_id | 18c18022a1474250b36d489ecfacc004 |\n+-------------------------------------+----------------------------------------------------------+", 
            "date_created": "2013-08-01 13:29:56.053905+00:00", 
            "author": "https://api.launchpad.net/1.0/~yanhcdl"
        }, 
        {
            "content": "OK, I can reproduce this in Grizzly, but not in HEAD, so it must have been fixed at some point. It's quite a PITA to bisect and I have no idea which commit fixed this.  Do you need a backport to Grizzly ?", 
            "date_created": "2013-08-05 12:54:02.954335+00:00", 
            "author": "https://api.launchpad.net/1.0/~cyril-roelandt"
        }, 
        {
            "content": "def flavor_get_by_flavor_id(context, flavor_id, read_deleted):\n    \"\"\"Returns a dict describing specific flavor_id.\"\"\"\n    result = _instance_type_get_query(context, read_deleted=read_deleted).\\\n                        filter_by(flavorid=flavor_id).\\\n                        first()\n\nthe filter_by(flavorid=flavor_id) return different flavor sequence in grizzly and Head. I am not sure whether it's caused by this commit:\nhttps://github.com/openstack/nova/commit/64ce647003b110771331d3daf92980729bd3988e", 
            "date_created": "2013-08-23 13:41:06.245655+00:00", 
            "author": "https://api.launchpad.net/1.0/~zhouzlin"
        }, 
        {
            "content": "I could not reproduce this bug in the latest code upstream.  \n\n$ nova flavor-create test 10 1024 5 1\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n| 10 | test | 1024      | 5    | 0         |      | 1     | 1.0         | True      |\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n\n$ nova flavor-list \n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID                                   | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 0e1f3f32-f5c6-4009-bd14-bb41489c23db | m2.tiny   | 1024      | 4    | 0         | 512  | 1     | 1.0         | True      |\n| 1                                    | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |\n| 10                                   | test      | 1024      | 5    | 0         |      | 1     | 1.0         | True      |\n| 2                                    | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3                                    | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4                                    | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 42                                   | m1.nano   | 64        | 0    | 0         |      | 1     | 1.0         | True      |\n| 5                                    | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n| 84                                   | m1.micro  | 128       | 0    | 0         |      | 1     | 1.0         | True      |\n| ab03c186-0ae1-4a00-a5a2-bdceaf8a8174 | m2.small  | 1024      | 8    | 0         | 1024 | 1     | 1.0         | True      |\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n\n$ nova flavor-delete 10\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n| 10 | test | 1024      | 5    | 0         |      | 1     | 1.0         | True      |\n+----+------+-----------+------+-----------+------+-------+-------------+-----------+\n\n$ nova flavor-create new.test 10 1024 5 1\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID | Name     | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 10 | new.test | 1024      | 5    | 0         |      | 1     | 1.0         | True      |\n+----+----------+-----------+------+-----------+------+-------+-------------+-----------+\n\n$ nova flavor-list \n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID                                   | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n| 0e1f3f32-f5c6-4009-bd14-bb41489c23db | m2.tiny   | 1024      | 4    | 0         | 512  | 1     | 1.0         | True      |\n| 1                                    | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |\n| 10                                   | new.test  | 1024      | 5    | 0         |      | 1     | 1.0         | True      |\n| 2                                    | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 3                                    | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |\n| 4                                    | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 42                                   | m1.nano   | 64        | 0    | 0         |      | 1     | 1.0         | True      |\n| 5                                    | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n| 84                                   | m1.micro  | 128       | 0    | 0         |      | 1     | 1.0         | True      |\n| ab03c186-0ae1-4a00-a5a2-bdceaf8a8174 | m2.small  | 1024      | 8    | 0         | 1024 | 1     | 1.0         | True      |\n+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+\n\n$ nova boot --image precise-server-cloudimg-amd64 --flavor new.test test2\n+--------------------------------------+----------------------------------------------------------------------+\n| Property                             | Value                                                                |\n+--------------------------------------+----------------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                               |\n| OS-EXT-AZ:availability_zone          | nova                                                                 |\n| OS-EXT-SRV-ATTR:host                 | -                                                                    |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                                    |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000005                                                    |\n| OS-EXT-STS:power_state               | 0                                                                    |\n| OS-EXT-STS:task_state                | scheduling                                                           |\n| OS-EXT-STS:vm_state                  | building                                                             |\n| OS-SRV-USG:launched_at               | -                                                                    |\n| OS-SRV-USG:terminated_at             | -                                                                    |\n| accessIPv4                           |                                                                      |\n| accessIPv6                           |                                                                      |\n| adminPass                            | sywCc7qdEr4r                                                         |\n| config_drive                         |                                                                      |\n| created                              | 2014-03-24T17:29:31Z                                                 |\n| flavor                               | new.test (10)                                                        |\n| hostId                               |                                                                      |\n| id                                   | a8588352-4e8e-4f0a-883d-aa58955aab5d                                 |\n| image                                | precise-server-cloudimg-amd64 (4e6ce032-62ce-4b7c-9c80-1d9a97c53d29) |\n| key_name                             | -                                                                    |\n| metadata                             | {}                                                                   |\n| name                                 | test2                                                                |\n| os-extended-volumes:volumes_attached | []                                                                   |\n| progress                             | 0                                                                    |\n| security_groups                      | default                                                              |\n| status                               | BUILD                                                                |\n| tenant_id                            | aeb12bdc23bd458f9861d58da746f131                                     |\n| updated                              | 2014-03-24T17:29:31Z                                                 |\n| user_id                              | 47a6717a015c4bac99242136a5157869                                     |\n+--------------------------------------+----------------------------------------------------------------------+", 
            "date_created": "2014-03-24 17:33:15.975100+00:00", 
            "author": "https://api.launchpad.net/1.0/~thang-pham"
        }, 
        {
            "content": "Looks like this was fixed in icehouse, or havana. I'm marking this bug as fix released. If you are able to reproduce it in a supported version, please reopen.", 
            "date_created": "2014-05-29 06:24:44.775780+00:00", 
            "author": "https://api.launchpad.net/1.0/~fifieldt"
        }
    ], 
    "closed": "2014-05-29 06:24:50.886266+00:00"
}