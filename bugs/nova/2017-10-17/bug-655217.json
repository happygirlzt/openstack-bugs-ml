{
    "status": "Fix Released", 
    "last_updated": "2011-10-05 01:50:45.209340+00:00", 
    "description": "I tried to run VM with the docs, \nhttp://wiki.openstack.org/NovaInstall\nand\nhttp://github.com/vishvananda/novascript\nthe docs say using screen tools, but I tried with nohup and saved all the logs to files for error tracking.\n\nanyway, failed when runnig euca-run-instances.\n\nThe nova-compute log messages is as follows:\n===============================================\nlibvir: QEMU error : internal error process exited while connecting to monitor: chardev: opening backend \"file\" failed\nERROR:root:instance i-wt4mcqm1: Failed to spawn\nTraceback (most recent call last):\n  File \"/root/openstack/nova/nova/compute/manager.py\", line 86, in run_instance\n    yield self.driver.spawn(instance_ref)\n  File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 823, in _inlineCallbacks\n    result = g.send(result)\n  File \"/root/openstack/nova/nova/virt/libvirt_conn.py\", line 218, in spawn\n    yield self._conn.createXML(xml, 0)\n  File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1289, in createXML\n    if ret is None:raise libvirtError('virDomainCreateXML() failed', conn=self)\nlibvirtError: internal error process exited while connecting to monitor: chardev: opening backend \"file\" failed\n\n2010-10-06 00:13:04+0900 [-] (root): ERROR instance i-wt4mcqm1: Failed to spawn\n2010-10-06 00:13:04+0900 [-] Traceback (most recent call last):\n2010-10-06 00:13:04+0900 [-]   File \"/root/openstack/nova/nova/compute/manager.py\", line 86, in run_instance\n2010-10-06 00:13:04+0900 [-]     yield self.driver.spawn(instance_ref)\n2010-10-06 00:13:04+0900 [-]   File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 823, in _inlineCallbacks\n2010-10-06 00:13:04+0900 [-]     result = g.send(result)\n2010-10-06 00:13:04+0900 [-]   File \"/root/openstack/nova/nova/virt/libvirt_conn.py\", line 218, in spawn\n2010-10-06 00:13:04+0900 [-]     yield self._conn.createXML(xml, 0)\n2010-10-06 00:13:04+0900 [-]   File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1289, in createXML\n2010-10-06 00:13:04+0900 [-]     if ret is None:raise libvirtError('virDomainCreateXML() failed', conn=self)\n2010-10-06 00:13:04+0900 [-] libvirtError: internal error process exited while connecting to monitor: chardev: opening backend \"file\" failed\n2010-10-06 00:13:04+0900 [-]\nlibvir: QEMU error : Domain not found: no domain with matching name 'i-wt4mcqm1'\n2010-10-06 00:13:04+0900 [-] Unhandled error in Deferred:\n2010-10-06 00:13:04+0900 [-] Unhandled Error\n        Traceback (most recent call last):\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 307, in errback\n            self._startRunCallbacks(fail)\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 354, in _startRunCallbacks\n            self._runCallbacks()\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 371, in _runCallbacks\n            self.result = callback(self.result, *args, **kw)\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 879, in gotResult\n            _inlineCallbacks(r, g, deferred)\n        --- <exception caught here> ---\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 821, in _inlineCallbacks\n            result = result.throwExceptionIntoGenerator(g)\n          File \"/usr/lib/python2.6/dist-packages/twisted/python/failure.py\", line 338, in throwExceptionIntoGenerator\n            return g.throw(self.type, self.value, self.tb)\n          File \"/root/openstack/nova/nova/compute/manager.py\", line 98, in run_instance\n            self._update_state(context, instance_id)\n          File \"/root/openstack/nova/nova/compute/manager.py\", line 62, in _update_state\n            state = self.driver.get_info(instance_ref.name)['state']\n          File \"/root/openstack/nova/nova/virt/libvirt_conn.py\", line 334, in get_info\n            virt_dom = self._conn.lookupByName(instance_name)\n          File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1442, in lookupByName\n            if ret is None:raise libvirtError('virDomainLookupByName() failed', conn=self)\n        libvirt.libvirtError: Domain not found: no domain with matching name 'i-wt4mcqm1'\n===============================================\n\nand.. libvirt log is like this.\n===============================================\nroot@gagamels2:/var/log/libvirt/qemu# cat i-wt4mcqm1.log\nLC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/sbin:/sbin:/bin /usr/bin/kvm -S -M pc-0.12 -enable-kvm -m 512 -smp 1,sockets=1,cores=1,threads=1 -name i-wt4mcqm1 -uuid 61dd3ee4-c5e2-86de-d257-56696eb2463b -nographic -nodefaults -chardev socket,id=monitor,path=/var/lib/libvirt/qemu/i-wt4mcqm1.monitor,server,nowait -mon chardev=monitor,mode=readline -rtc base=utc -boot c -kernel /root/openstack/nova/nova/../instances/i-wt4mcqm1/kernel -initrd /root/openstack/nova/nova/../instances/i-wt4mcqm1/ramdisk -append 'root=/dev/vda1 console=ttyS0' -drive file=/root/openstack/nova/nova/../instances/i-wt4mcqm1/disk,if=none,id=drive-virtio-disk0,boot=on,format=raw -device virtio-blk-pci,bus=pci.0,addr=0x3,drive=drive-virtio-disk0,id=virtio-disk0 -device rtl8139,vlan=0,id=net0,mac=02:16:3e:02:4c:64,bus=pci.0,addr=0x2 -net tap,fd=63,vlan=0,name=hostnet0 -chardev file,id=serial0,path=/root/openstack/nova/nova/../instances/i-wt4mcqm1/console.log -device isa-serial,chardev=serial0 -usb -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x4\nchardev: opening backend \"file\" failed\n===============================================\n\nso I tried to run the kvm command directly in command line..\nbut errors like this.. and kvm didn't run.\n===============================================\nTUNGETIFF ioctl() failed: Bad file descriptor\nTUNSETOFFLOAD ioctl() failed: Bad file descriptor\nqemu: could not open disk image console=ttyS0: No such file or directory\n===============================================\n\nso I changed -append option \nfrom -append root=/dev/vda1 console=ttyS0\nto -append 'root=/dev/vda1 console=ttyS0'\nand tried again...\nso the messages \"qemu: could not open disk image console=ttyS0: No such file or directory\" disappeared...\n(but TUNGETIFF and TUNSETOFFLOAD related messages was still there.. \nI guess it is relaged with -net tap blabla option. am I wrong?)\nand It seemed that kvm was running..\n\nSo, I updated append option from $NOVA_DIR/nova/nova/virt/libvirt.qemu.xml.template  \nand restart all the nova modules..\n\nbut same errors again...\n\nI did search the bugs list about euca-run-instances problems, but my situation wasn't there.. \n\nWhat's wrong with my test and machine ?\nQEMU or KVM env?", 
    "tags": [], 
    "importance": "High", 
    "heat": 14, 
    "link": "https://bugs.launchpad.net/nova/+bug/655217", 
    "owner": "https://api.launchpad.net/1.0/~hisaki", 
    "id": 655217, 
    "index": 303, 
    "openned": "2010-10-05 16:10:12.497138+00:00", 
    "created": "2010-10-05 16:10:12.497138+00:00", 
    "title": "euca-run-instances fails to run VM", 
    "comments": [
        {
            "content": "I tried to run VM with the docs, \nhttp://wiki.openstack.org/NovaInstall\nand\nhttp://github.com/vishvananda/novascript\nthe docs say using screen tools, but I tried with nohup and saved all the logs to files for error tracking.\n\nanyway, failed when runnig euca-run-instances.\n\nThe nova-compute log messages is as follows:\n===============================================\nlibvir: QEMU error : internal error process exited while connecting to monitor: chardev: opening backend \"file\" failed\nERROR:root:instance i-wt4mcqm1: Failed to spawn\nTraceback (most recent call last):\n  File \"/root/openstack/nova/nova/compute/manager.py\", line 86, in run_instance\n    yield self.driver.spawn(instance_ref)\n  File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 823, in _inlineCallbacks\n    result = g.send(result)\n  File \"/root/openstack/nova/nova/virt/libvirt_conn.py\", line 218, in spawn\n    yield self._conn.createXML(xml, 0)\n  File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1289, in createXML\n    if ret is None:raise libvirtError('virDomainCreateXML() failed', conn=self)\nlibvirtError: internal error process exited while connecting to monitor: chardev: opening backend \"file\" failed\n\n2010-10-06 00:13:04+0900 [-] (root): ERROR instance i-wt4mcqm1: Failed to spawn\n2010-10-06 00:13:04+0900 [-] Traceback (most recent call last):\n2010-10-06 00:13:04+0900 [-]   File \"/root/openstack/nova/nova/compute/manager.py\", line 86, in run_instance\n2010-10-06 00:13:04+0900 [-]     yield self.driver.spawn(instance_ref)\n2010-10-06 00:13:04+0900 [-]   File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 823, in _inlineCallbacks\n2010-10-06 00:13:04+0900 [-]     result = g.send(result)\n2010-10-06 00:13:04+0900 [-]   File \"/root/openstack/nova/nova/virt/libvirt_conn.py\", line 218, in spawn\n2010-10-06 00:13:04+0900 [-]     yield self._conn.createXML(xml, 0)\n2010-10-06 00:13:04+0900 [-]   File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1289, in createXML\n2010-10-06 00:13:04+0900 [-]     if ret is None:raise libvirtError('virDomainCreateXML() failed', conn=self)\n2010-10-06 00:13:04+0900 [-] libvirtError: internal error process exited while connecting to monitor: chardev: opening backend \"file\" failed\n2010-10-06 00:13:04+0900 [-]\nlibvir: QEMU error : Domain not found: no domain with matching name 'i-wt4mcqm1'\n2010-10-06 00:13:04+0900 [-] Unhandled error in Deferred:\n2010-10-06 00:13:04+0900 [-] Unhandled Error\n        Traceback (most recent call last):\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 307, in errback\n            self._startRunCallbacks(fail)\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 354, in _startRunCallbacks\n            self._runCallbacks()\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 371, in _runCallbacks\n            self.result = callback(self.result, *args, **kw)\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 879, in gotResult\n            _inlineCallbacks(r, g, deferred)\n        --- <exception caught here> ---\n          File \"/usr/lib/python2.6/dist-packages/twisted/internet/defer.py\", line 821, in _inlineCallbacks\n            result = result.throwExceptionIntoGenerator(g)\n          File \"/usr/lib/python2.6/dist-packages/twisted/python/failure.py\", line 338, in throwExceptionIntoGenerator\n            return g.throw(self.type, self.value, self.tb)\n          File \"/root/openstack/nova/nova/compute/manager.py\", line 98, in run_instance\n            self._update_state(context, instance_id)\n          File \"/root/openstack/nova/nova/compute/manager.py\", line 62, in _update_state\n            state = self.driver.get_info(instance_ref.name)['state']\n          File \"/root/openstack/nova/nova/virt/libvirt_conn.py\", line 334, in get_info\n            virt_dom = self._conn.lookupByName(instance_name)\n          File \"/usr/lib/python2.6/dist-packages/libvirt.py\", line 1442, in lookupByName\n            if ret is None:raise libvirtError('virDomainLookupByName() failed', conn=self)\n        libvirt.libvirtError: Domain not found: no domain with matching name 'i-wt4mcqm1'\n===============================================\n\nand.. libvirt log is like this.\n===============================================\nroot@gagamels2:/var/log/libvirt/qemu# cat i-wt4mcqm1.log\nLC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/sbin:/sbin:/bin /usr/bin/kvm -S -M pc-0.12 -enable-kvm -m 512 -smp 1,sockets=1,cores=1,threads=1 -name i-wt4mcqm1 -uuid 61dd3ee4-c5e2-86de-d257-56696eb2463b -nographic -nodefaults -chardev socket,id=monitor,path=/var/lib/libvirt/qemu/i-wt4mcqm1.monitor,server,nowait -mon chardev=monitor,mode=readline -rtc base=utc -boot c -kernel /root/openstack/nova/nova/../instances/i-wt4mcqm1/kernel -initrd /root/openstack/nova/nova/../instances/i-wt4mcqm1/ramdisk -append 'root=/dev/vda1 console=ttyS0' -drive file=/root/openstack/nova/nova/../instances/i-wt4mcqm1/disk,if=none,id=drive-virtio-disk0,boot=on,format=raw -device virtio-blk-pci,bus=pci.0,addr=0x3,drive=drive-virtio-disk0,id=virtio-disk0 -device rtl8139,vlan=0,id=net0,mac=02:16:3e:02:4c:64,bus=pci.0,addr=0x2 -net tap,fd=63,vlan=0,name=hostnet0 -chardev file,id=serial0,path=/root/openstack/nova/nova/../instances/i-wt4mcqm1/console.log -device isa-serial,chardev=serial0 -usb -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x4\nchardev: opening backend \"file\" failed\n===============================================\n\nso I tried to run the kvm command directly in command line..\nbut errors like this.. and kvm didn't run.\n===============================================\nTUNGETIFF ioctl() failed: Bad file descriptor\nTUNSETOFFLOAD ioctl() failed: Bad file descriptor\nqemu: could not open disk image console=ttyS0: No such file or directory\n===============================================\n\nso I changed -append option \nfrom -append root=/dev/vda1 console=ttyS0\nto -append 'root=/dev/vda1 console=ttyS0'\nand tried again...\nso the messages \"qemu: could not open disk image console=ttyS0: No such file or directory\" disappeared...\n(but TUNGETIFF and TUNSETOFFLOAD related messages was still there.. \nI guess it is relaged with -net tap blabla option. am I wrong?)\nand It seemed that kvm was running..\n\nSo, I updated append option from $NOVA_DIR/nova/nova/virt/libvirt.qemu.xml.template  \nand restart all the nova modules..\n\nbut same errors again...\n\nI did search the bugs list about euca-run-instances problems, but my situation wasn't there.. \n\nWhat's wrong with my test and machine ?\nQEMU or KVM env?", 
            "date_created": "2010-10-05 16:10:12.497138+00:00", 
            "author": "https://api.launchpad.net/1.0/~gaeddongi"
        }, 
        {
            "content": "Hi Hisaki!  Assigning this bug to you since you graciously supplied a hopeful fix! :)  We'll review the merge proposal shortly.  Thanks!", 
            "date_created": "2010-10-06 14:29:49.404998+00:00", 
            "author": "https://api.launchpad.net/1.0/~jaypipes"
        }, 
        {
            "content": "To fix this problem you only need to to add write permissions to the directory structure created by novascript.\n\nIf you look at the /var/log/libvirt/qemu/instance-INSTANCE_ID.log you will see the error written in the last line. It's trying to create the console.log file but there is a problem with the permissions. Probably you are running the novascript as root in a folder with root only permissions.\n\n", 
            "date_created": "2010-10-13 00:25:20.049341+00:00", 
            "author": "https://api.launchpad.net/1.0/~mika-kohonen-1986"
        }, 
        {
            "content": "Executing the Nova script from within the /opt directory saved the permissions problem that Mika mentioned, I originally downloaded Nova in /root which may have caused the problem", 
            "date_created": "2010-12-15 12:27:01.923434+00:00", 
            "author": "https://api.launchpad.net/1.0/~ahmedelgamil"
        }, 
        {
            "content": "libvirt-qemu must have access to the nova/instances repository", 
            "date_created": "2011-06-05 09:45:14.389257+00:00", 
            "author": "https://api.launchpad.net/1.0/~alexis-letessier"
        }, 
        {
            "content": "I am having the same issue here. How can I give libvirt-qemu access to the nova/instances repository?", 
            "date_created": "2011-06-08 19:12:16.124752+00:00", 
            "author": "https://api.launchpad.net/1.0/~zachwass2000"
        }, 
        {
            "content": "is it write access for libvirt-qemu?", 
            "date_created": "2011-10-05 01:50:42.896522+00:00", 
            "author": "https://api.launchpad.net/1.0/~bayanzul"
        }
    ], 
    "closed": "2010-10-12 17:23:46.099190+00:00"
}